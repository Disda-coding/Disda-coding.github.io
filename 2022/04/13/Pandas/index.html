<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="简单记录一些笔记"><title>Pandas基础 | Disda</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/8.0.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.1/pure-min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.1/grids-responsive-min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/3.4.1/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"><meta name="generator" content="Hexo 6.0.0"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Pandas基础</h1><a id="logo" href="/.">Disda</a><p class="description">Disda’s Dairy</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-4-4"><div class="content_container"><div class="post"><h1 class="post-title">Pandas基础</h1><div class="post-content"><span id="more"></span>

<!-- toc -->

<ul>
<li><a href="#%E6%95%B0%E6%8D%AE%E8%AF%BB%E5%8F%96%E5%A4%84%E7%90%86">数据读取处理</a><ul>
<li><a href="#%E9%80%89%E6%8B%A9%E5%88%97">选择列</a></li>
<li><a href="#%E9%80%89%E6%8B%A9%E8%A1%8C">选择行</a></li>
</ul>
</li>
<li><a href="#%E6%95%B0%E6%8D%AE%E6%A0%BC%E5%BC%8F%E5%8C%96">数据格式化</a></li>
<li><a href="#%E6%97%A5%E6%9C%9F">日期</a></li>
<li><a href="#crud">CRUD</a><ul>
<li><a href="#%E5%88%97%E6%93%8D%E4%BD%9C">列操作</a></li>
<li><a href="#%E8%A1%8C%E6%93%8D%E4%BD%9C">行操作</a></li>
</ul>
<ul>
<li><a href="#create">Create</a></li>
<li><a href="#del">Del</a></li>
<li><a href="#update">Update</a></li>
<li><a href="#retrieve">Retrieve</a></li>
</ul>
</li>
<li><a href="#%E4%BF%9D%E5%AD%98%E6%96%87%E4%BB%B6">保存文件</a></li>
<li><a href="#tricks">Tricks</a></li>
<li><a href="#matplotlib">matplotlib</a></li>
<li><a href="#tips">Tips</a><ul>
<li><a href="#%E5%B1%8F%E8%94%BD%E6%8F%90%E9%86%92">屏蔽提醒</a></li>
<li><a href="#%E6%98%BE%E7%A4%BA%E4%B8%AD%E6%96%87">显示中文</a></li>
<li><a href="#%E5%85%B3%E4%BA%8Eiloc%E5%92%8C%E9%80%89%E6%8B%A9%E8%B5%8B%E5%80%BC%E5%A4%B1%E8%B4%A5%E9%97%AE%E9%A2%98">关于iloc和[]选择赋值失败问题</a></li>
</ul>
</li>
</ul>
<!-- tocstop -->

<h2><span id="数据读取处理">数据读取处理</span></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">iris = load_iris()</span><br><span class="line">lable = iris.feature_names</span><br><span class="line">target = iris.target</span><br><span class="line">feature = iris.data</span><br><span class="line">data = np.column_stack((feature,target))</span><br><span class="line">lable.append(<span class="string">&#x27;type&#x27;</span>)</span><br><span class="line">df = pd.DataFrame(data,columns=lable)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a.reshape(-<span class="number">1</span>,<span class="number">1</span>)</span><br><span class="line">a[:,np.newaxis]</span><br></pre></td></tr></table></figure>

<h3><span id="选择列">选择列</span></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tr.select_dtypes(include=[<span class="string">&#x27;int64&#x27;</span>,<span class="string">&#x27;float64&#x27;</span>])</span><br></pre></td></tr></table></figure>

<h3><span id="选择行">选择行</span></h3><ul>
<li>可以通过 “.”  来操作 <code>df.a</code></li>
<li>也可以通过 “[]” 来操作 <code>df[&#39;a&#39;]</code></li>
</ul>
<h2><span id="数据格式化">数据格式化</span></h2><ol>
<li>map、apply在用于Series时，对每一个值进行处理，两者并没有什么区别</li>
<li>apply不仅可以用于Series，还可以用于DataFrame；而map只能用于Series。</li>
<li>一般情况下，apply应用更广泛，尤其是自定义函数带多个参数时，建议使用apply。</li>
<li>applymap可以对多个Series进行操作，map和apply均不行。</li>
</ol>
<ul>
<li><p><strong>apply &#x2F;map&#x2F;applymap</strong>  函数（常用方法）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">cal_interval</span>(<span class="params">df,from_date,to_date</span>):</span><br><span class="line">    delta = <span class="number">1</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        f = datetime.datetime.strptime(df[from_date],<span class="string">&quot;%m/%d/%Y&quot;</span>)</span><br><span class="line">        t = datetime.datetime.strptime(df[to_date],<span class="string">&quot;%m/%d/%Y&quot;</span>)</span><br><span class="line">        delta = (t-f).days</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span> <span class="keyword">if</span> delta&lt;=<span class="number">0</span> <span class="keyword">else</span> delta</span><br><span class="line">  df[<span class="string">&#x27;d&#x27;</span>] = df.apply(cal_interval,axis=<span class="number">1</span>,args=[<span class="string">&#x27;Date Event Began&#x27;</span>,<span class="string">&#x27;Date of Restoration&#x27;</span>])</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">date = pd.period_range(start = <span class="string">&#x27;1990-02-01&#x27;</span>,periods=<span class="number">100</span>,freq=<span class="string">&#x27;D&#x27;</span>)</span><br><span class="line">df = pd.DataFrame(&#123;<span class="string">&#x27;date&#x27;</span>:date,<span class="string">&#x27;val&#x27;</span>:np.random.randn(<span class="built_in">len</span>(date)),<span class="string">&#x27;val2&#x27;</span>:np.random.randn(<span class="built_in">len</span>(date))&#125;)</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th align="right"></th>
<th align="right">date</th>
<th align="right">val</th>
<th>val2</th>
</tr>
</thead>
<tbody><tr>
<td align="right">0</td>
<td align="right">1990-02-01</td>
<td align="right">0.771114</td>
<td>0.223646</td>
</tr>
<tr>
<td align="right">1</td>
<td align="right">1990-02-02</td>
<td align="right">-0.630781</td>
<td>-1.231217</td>
</tr>
<tr>
<td align="right">2</td>
<td align="right">1990-02-03</td>
<td align="right">-0.435648</td>
<td>-1.324931</td>
</tr>
<tr>
<td align="right">3</td>
<td align="right">1990-02-04</td>
<td align="right">2.459657</td>
<td>1.195601</td>
</tr>
<tr>
<td align="right">4</td>
<td align="right">1990-02-05</td>
<td align="right">0.378009</td>
<td>2.207286</td>
</tr>
</tbody></table>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># apply默认是作用于列，要作用于行的话需要加上axis=1</span></span><br><span class="line">q2.apply(<span class="keyword">lambda</span> x:x.原价==x.实价,axis=<span class="number">1</span>)</span><br><span class="line"><span class="comment"># 保留两位小数（类型变成Object）</span></span><br><span class="line">df.val.apply(<span class="keyword">lambda</span> x: <span class="built_in">format</span>(x,<span class="string">&#x27;.2f&#x27;</span>))</span><br><span class="line"><span class="comment"># 或者</span></span><br><span class="line">df.val.apply(<span class="keyword">lambda</span> x: <span class="string">&#x27;&#123;:.2f&#125;&#x27;</span>.<span class="built_in">format</span>(x))</span><br><span class="line"><span class="comment"># 四舍五入保留两位小数</span></span><br><span class="line">df.val.<span class="built_in">round</span>(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 转为百分比，并保留2位小数 lambda 写法</span></span><br><span class="line">df.val.<span class="built_in">map</span>(<span class="keyword">lambda</span> x: <span class="string">&quot;&#123;:.2%&#125;&quot;</span>.<span class="built_in">format</span>(x))</span><br><span class="line"><span class="comment"># 或者</span></span><br><span class="line">q2_df[col].apply(<span class="keyword">lambda</span> x:<span class="built_in">format</span>(x,<span class="string">&#x27;.2%&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 正常函数写法（不推荐）</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">turn_percentage</span>(<span class="params">x</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;%.2f%%&#x27;</span> % (x * <span class="number">100</span>);</span><br><span class="line">df.val.apply(turn_percentage)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将获奖时间格式化为x月x日</span></span><br><span class="line">df.date.apply(<span class="keyword">lambda</span> x:x.strftime(<span class="string">&#x27;%m月%d日&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将Series中的数据和字符拼接</span></span><br><span class="line">df.val.apply(<span class="keyword">lambda</span> x: <span class="string">f&#x27;随机数： <span class="subst">&#123;x&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># applymap可以对多个Series进行操作</span></span><br><span class="line">df[[<span class="string">&#x27;val&#x27;</span>,<span class="string">&#x27;val1&#x27;</span>]].applymap(<span class="keyword">lambda</span> x:<span class="built_in">format</span>(x,<span class="string">&#x27;.2f&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 构建apply函数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">judge_state</span>(<span class="params">row</span>):</span><br><span class="line">    <span class="keyword">if</span> row[<span class="string">&#x27;Austin - EV&#x27;</span>] &lt;=<span class="number">0.01</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;Off&#x27;</span></span><br><span class="line">    <span class="keyword">elif</span> row[<span class="string">&#x27;Austin - EV&#x27;</span>]&gt;<span class="number">0.01</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;On&#x27;</span></span><br><span class="line"><span class="comment"># 应用apply函数</span></span><br><span class="line">df_Austin_ev = df.apply(judge_state,axis = <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># map传入字典 其余值均变为NaN</span></span><br><span class="line">df1 = pd.DataFrame(&#123;<span class="string">&#x27;A&#x27;</span>:[<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;c&#x27;</span>,<span class="string">&#x27;d&#x27;</span>]&#125;)</span><br><span class="line">df1.A=df1.A.<span class="built_in">map</span>(&#123;<span class="string">&#x27;a&#x27;</span>:<span class="string">&#x27;A&#x27;</span>,<span class="string">&#x27;b&#x27;</span>:<span class="string">&#x27;B&#x27;</span>&#125;) </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># df使用apply还可以传其他参</span></span><br><span class="line"><span class="keyword">import</span> statsmodels.api <span class="keyword">as</span> sm</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">regress</span>(<span class="params">data, yvar, xvars</span>):</span><br><span class="line">    Y = data[yvar]</span><br><span class="line">    X = data[xvars]</span><br><span class="line">    X[<span class="string">&#x27;intercept&#x27;</span>] = <span class="number">1.</span></span><br><span class="line">    result = sm.OLS(Y, X).fit()</span><br><span class="line">    <span class="keyword">return</span> result.params</span><br><span class="line">  </span><br><span class="line">by_year.apply(regress, <span class="string">&#x27;AAPL&#x27;</span>, [<span class="string">&#x27;SPX&#x27;</span>])</span><br></pre></td></tr></table></figure>
</li>
<li><p>groupby后的apply</p>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 数据是tg_id,month,q1-q96,求每个月q1-q96中最大的点</span></span><br><span class="line"><span class="comment"># 法1</span></span><br><span class="line">df.groupby([<span class="string">&#x27;tg_id&#x27;</span>,<span class="string">&#x27;month&#x27;</span>]).apply(<span class="keyword">lambda</span> x:<span class="built_in">max</span>(x.drop([<span class="string">&#x27;tg_id&#x27;</span>,<span class="string">&#x27;month&#x27;</span>],axis=<span class="number">1</span>).apply(<span class="keyword">lambda</span> x:<span class="built_in">max</span>(x))))</span><br><span class="line"><span class="comment"># 法 2</span></span><br><span class="line">df.groupby([<span class="string">&#x27;tg_id&#x27;</span>,<span class="string">&#x27;month&#x27;</span>]).apply(<span class="keyword">lambda</span> x:x.drop([<span class="string">&#x27;tg_id&#x27;</span>,<span class="string">&#x27;month&#x27;</span>],axis=<span class="number">1</span>).apply(<span class="keyword">lambda</span> x:<span class="built_in">max</span>(x,axis=<span class="number">1</span>))).reset_index().groupby([<span class="string">&#x27;tg_id&#x27;</span>,<span class="string">&#x27;month&#x27;</span>]).apply(<span class="keyword">lambda</span> x:x.drop([<span class="string">&#x27;tg_id&#x27;</span>,<span class="string">&#x27;month&#x27;</span>],axis=<span class="number">1</span>).apply(<span class="keyword">lambda</span> x:<span class="built_in">max</span>(x)))</span><br><span class="line"><span class="comment"># 法3</span></span><br><span class="line">val = [<span class="string">f&#x27;p<span class="subst">&#123;i&#125;</span>&#x27;</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">97</span>)]</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">cal_min</span>(<span class="params">df</span>):</span><br><span class="line">  <span class="keyword">return</span> df[val].<span class="built_in">min</span>().<span class="built_in">min</span>()</span><br><span class="line">q4.groupby([<span class="string">&#x27;tg_id&#x27;</span>,<span class="string">&#x27;month&#x27;</span>]).apply(cal_max)</span><br><span class="line"><span class="comment"># 法4</span></span><br><span class="line">q4.groupby([<span class="string">&#x27;tg_id&#x27;</span>,<span class="string">&#x27;month&#x27;</span>]).apply(<span class="keyword">lambda</span> x:x[val].<span class="built_in">max</span>().<span class="built_in">max</span>())</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<ul>
<li><p>将含有空白符的列转float</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df.a.replace(<span class="string">r&#x27;^\s*$&#x27;</span>, np.nan, regex=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure></li>
</ul>
<h2><span id="日期">日期</span></h2><ul>
<li>将日的数据转为以月为统计的数据</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 提取日期中的date</span></span><br><span class="line">df[<span class="string">&#x27;date&#x27;</span>].dt.date</span><br><span class="line"><span class="comment"># 重采样 统计</span></span><br><span class="line">df.resample(<span class="string">&#x27;D&#x27;</span>).count()</span><br><span class="line"><span class="comment">#重采样 逐个显示</span></span><br><span class="line">df.to_period(<span class="string">&quot;M&quot;</span>)</span><br><span class="line"><span class="comment"># 异形日期转换</span></span><br><span class="line">pd.to_datetime(work_index[<span class="string">&#x27;日期&#x27;</span>],<span class="built_in">format</span>=<span class="string">&#x27;%Y%m%d&#x27;</span>)</span><br><span class="line"><span class="comment"># 选择日期范围</span></span><br><span class="line">bz = [<span class="string">&#x27;2022-2-14&#x27;</span>,<span class="string">&#x27;2022-2-20&#x27;</span>]</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2><span id="crud">CRUD</span></h2><p>一般来说pandas操作都不会在原dataframe进行修改，通过inplace&#x3D;True可以实现就地修改。</p>
<h4><span id="列操作">列操作</span></h4>  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 重命名特定列名</span></span><br><span class="line">df.rename(columns=&#123;<span class="string">&#x27;A&#x27;</span>:<span class="string">&#x27;a&#x27;</span>&#125;,inplace=<span class="literal">True</span>)</span><br><span class="line"><span class="comment"># 重命名所有列名</span></span><br><span class="line">df.columns = [<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;c&#x27;</span>]</span><br><span class="line"><span class="comment"># 取出特定类型的列名</span></span><br><span class="line">obj_feature=df.dtypes[df.dtypes==<span class="string">&#x27;object&#x27;</span>].index</span><br><span class="line"><span class="comment"># 更新列的类型</span></span><br><span class="line">df[<span class="string">&#x27;金牌数&#x27;</span>] = df[<span class="string">&#x27;金牌数&#x27;</span>].astype(<span class="built_in">int</span>)</span><br><span class="line"><span class="comment"># 插入list</span></span><br><span class="line">df.a = df.a.astype(<span class="string">&#x27;list&#x27;</span>)</span><br><span class="line">df.iat[i,-<span class="number">1</span>] = <span class="built_in">list</span>(xxx)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">	li</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># 连接两个列</span></span><br><span class="line">df = pd.concat([tmp1,tmp3.to_frame(),tmp2],axis=<span class="number">1</span>,ignore_index=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 只取结果的交集</span></span><br><span class="line">pd.concat([df1,df4],axis=<span class="number">1</span>,join=<span class="string">&#x27;inner&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 只取包含 df1 索引的部分</span></span><br><span class="line">pd.concat([df1, df4], axis=<span class="number">1</span>).reindex(df1.index)</span><br><span class="line">pd.merge(df1,df4,left_index=<span class="literal">True</span>,right_index=<span class="literal">True</span>,how=<span class="string">&#x27;left&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 新增列</span></span><br><span class="line">df[<span class="string">&#x27;new col name&#x27;</span>]=<span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 插入列</span></span><br><span class="line">tmp3 = (df[<span class="string">&#x27;春节期间（除夕至初六）用电量&#x27;</span>]-df[<span class="string">&#x27;节前温度接近的一周用电量&#x27;</span>])/df[<span class="string">&#x27;节前温度接近的一周用电量&#x27;</span>]</span><br><span class="line">tmp1 = df.iloc[:,:<span class="number">1</span>]</span><br><span class="line">tmp2 = df.iloc[:,<span class="number">1</span>:]</span><br><span class="line">df = pd.concat([tmp1,tmp3.to_frame(),tmp2],axis=<span class="number">1</span>,ignore_index=<span class="literal">True</span>)</span><br><span class="line"><span class="comment"># 删除 df 的 7、8、9、10 列</span></span><br><span class="line">df.drop(df.columns[[<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>]], axis=<span class="number">1</span>,inplace=<span class="literal">True</span>)</span><br><span class="line"><span class="comment"># 提取第1，2，3，4列</span></span><br><span class="line">df.iloc[:,<span class="number">0</span>:<span class="number">4</span>] </span><br><span class="line">df.iloc[:,[<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]]</span><br><span class="line"><span class="comment"># 提取 金牌数、银牌数、铜牌数 三列</span></span><br><span class="line">df[[<span class="string">&#x27;金牌数&#x27;</span>,<span class="string">&#x27;银牌数&#x27;</span>,<span class="string">&#x27;铜牌数&#x27;</span>]]</span><br><span class="line"><span class="comment"># 提取全部列名中以 “数” 结尾的列</span></span><br><span class="line">df.loc[:, df.columns.<span class="built_in">str</span>.endswith(<span class="string">&#x27;数&#x27;</span>)]</span><br><span class="line"><span class="comment"># 改变列顺序</span></span><br><span class="line">df = df[[<span class="string">&#x27;A&#x27;</span>,<span class="string">&#x27;D&#x27;</span>,<span class="string">&#x27;B&#x27;</span>,<span class="string">&#x27;C&#x27;</span>]]</span><br><span class="line"><span class="comment"># 单一一列提前可以</span></span><br><span class="line">df.set_index(<span class="string">&#x27;a&#x27;</span>).reset_index()</span><br><span class="line"><span class="comment"># 按列排序</span></span><br><span class="line">df.<span class="built_in">max</span>(axis=<span class="number">1</span>)</span><br><span class="line"><span class="comment">#or</span></span><br><span class="line">df.<span class="built_in">max</span>(<span class="number">1</span>)</span><br><span class="line"><span class="comment"># 统计出现最多的</span></span><br><span class="line">tmp2 =df.groupby([<span class="string">&#x27;genreId&#x27;</span>]).agg(<span class="keyword">lambda</span> x:x.mode())</span><br><span class="line"><span class="comment"># 方法二</span></span><br><span class="line">df.groupby([<span class="string">&#x27;genreId&#x27;</span>,<span class="string">&#x27;contentRating&#x27;</span>]).count()[[<span class="string">&#x27;id&#x27;</span>]].idxmax(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4><span id="行操作">行操作</span></h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">	拼接行</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">	</span><br><span class="line"><span class="comment"># 查看含有空值的行</span></span><br><span class="line">df[df.isna().T.<span class="built_in">any</span>()]</span><br><span class="line"><span class="comment"># 连接两个df</span></span><br><span class="line">pd.concat([train,val],ignore_index=<span class="literal">True</span>)</span><br><span class="line"><span class="comment"># 等价于</span></span><br><span class="line">df = pd.concat([train,val]).reset_index()</span><br><span class="line"><span class="comment"># or</span></span><br><span class="line">train.append(val).reset_index()</span><br><span class="line"><span class="comment"># or</span></span><br><span class="line">train.append(val,ignore_index=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 根据 key 连接 left 和 right</span></span><br><span class="line">pd.merge(left, right, on=<span class="string">&#x27;key&#x27;</span>)</span><br><span class="line"><span class="comment"># 根据 key1 和 key2 连接 left 和 right</span></span><br><span class="line">pd.merge(left, right, on=[<span class="string">&#x27;key1&#x27;</span>, <span class="string">&#x27;key2&#x27;</span>])</span><br><span class="line"><span class="comment"># 根据left的key列和right的index合并</span></span><br><span class="line">pd.merge(left1, right1, left_on=<span class="string">&#x27;key&#x27;</span>, right_index=<span class="literal">True</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">how 可以设置</span></span><br><span class="line"><span class="string">	right、left: 左外，右外</span></span><br><span class="line"><span class="string">	outer、inner: 全外连接，内连接</span></span><br><span class="line"><span class="string">	</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">pd.merge(left, right, how=<span class="string">&#x27;left&#x27;</span>, on=[<span class="string">&#x27;key1&#x27;</span>, <span class="string">&#x27;key2&#x27;</span>])</span><br><span class="line"><span class="comment"># 重新产生数据</span></span><br><span class="line">left.join(right, on=[<span class="string">&#x27;key1&#x27;</span>, <span class="string">&#x27;key2&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 拼接 df1、df2、df3，同时新增一个索引（x、y、z）来区分不同的表数据来源</span></span><br><span class="line">pd.concat([df1, df2, df3], keys=[<span class="string">&#x27;x&#x27;</span>, <span class="string">&#x27;y&#x27;</span>, <span class="string">&#x27;z&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 插入行</span></span><br><span class="line">df = pd.DataFrame(&#123;<span class="string">&#x27;A&#x27;</span>:[<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">3</span>],<span class="string">&#x27;B&#x27;</span>:[<span class="number">2</span>,<span class="number">1</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">9</span>]&#125;)</span><br><span class="line">c = pd.DataFrame(&#123;<span class="string">&#x27;A&#x27;</span>:[<span class="number">5</span>],<span class="string">&#x27;B&#x27;</span>:[<span class="number">5</span>]&#125;)</span><br><span class="line">a = df.iloc[:<span class="number">2</span>,:]</span><br><span class="line">b = df.iloc[<span class="number">2</span>:,:]</span><br><span class="line">df = pd.concat([a,c,b])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除第一行</span></span><br><span class="line">df.drop(<span class="number">1</span>)</span><br><span class="line"><span class="comment"># 条件删除</span></span><br><span class="line">df.drop(df[df.金牌数&lt;<span class="number">20</span>].index)</span><br><span class="line">data =  data.drop(index = data[(data.ZH_Term_len == <span class="number">0</span>)].index.tolist())</span><br><span class="line"><span class="comment"># 提取倒数后三列的10-20行</span></span><br><span class="line">df.iloc[<span class="number">10</span>:<span class="number">20</span>,-<span class="number">3</span>:]</span><br><span class="line">df.loc[<span class="number">10</span>:<span class="number">20</span>, <span class="string">&#x27;总分&#x27;</span>:] </span><br><span class="line"><span class="comment"># 提取第 10 行 </span></span><br><span class="line"><span class="comment"># DataFrame格式</span></span><br><span class="line">a = df.loc[<span class="number">9</span>:<span class="number">9</span>]</span><br><span class="line"><span class="comment"># Series格式</span></span><br><span class="line">a = df.loc[<span class="number">9</span>,:]</span><br><span class="line"><span class="comment"># 提取第 10 行之后的全部行</span></span><br><span class="line">df.iloc[<span class="number">9</span>:,]</span><br><span class="line">df.iloc[<span class="number">9</span>:]</span><br><span class="line"><span class="comment"># 提取 0-50 行，间隔为 3</span></span><br><span class="line">df[:<span class="number">50</span>:<span class="number">3</span>]</span><br><span class="line"><span class="comment"># 提取 金牌数 不等于 10 的行</span></span><br><span class="line">df.loc[~(df[<span class="string">&#x27;金牌数&#x27;</span>] == <span class="number">10</span>)]</span><br><span class="line"><span class="comment"># 提取奇数行</span></span><br><span class="line">df[[i%<span class="number">2</span>==<span class="number">1</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(df.index))]]</span><br><span class="line"><span class="comment"># 提取 中国、美国、英国、日本、巴西 五行数据 且 金牌数小于30</span></span><br><span class="line">df.loc[(df[<span class="string">&#x27;金牌数&#x27;</span>] &lt; <span class="number">30</span>) &amp; (df[<span class="string">&#x27;国家奥委会&#x27;</span>].isin([<span class="string">&#x27;中国&#x27;</span>,<span class="string">&#x27;美国&#x27;</span>,<span class="string">&#x27;英国&#x27;</span>,<span class="string">&#x27;日本&#x27;</span>,<span class="string">&#x27;巴西&#x27;</span>]))]</span><br><span class="line"><span class="comment"># 包含某个字的行</span></span><br><span class="line">df[df.国家奥委会.<span class="built_in">str</span>.contains(<span class="string">&#x27;国&#x27;</span>)]</span><br><span class="line"><span class="comment"># 提取 第 0-2 行第 0-2 列</span></span><br><span class="line">df.iloc[<span class="number">0</span>:<span class="number">2</span>,<span class="number">0</span>:<span class="number">2</span>]</span><br><span class="line">df.iloc[<span class="number">0</span>:<span class="number">2</span>,[<span class="number">0</span>,<span class="number">1</span>]]</span><br><span class="line"><span class="comment"># 使用 query 提取 金牌数 + 银牌数 大于 15 的国家</span></span><br><span class="line">df.query(<span class="string">&#x27;金牌数+银牌数 &gt; 15&#x27;</span>)</span><br><span class="line"><span class="comment"># 使用 query 提取 金牌数 大于 金牌均值的国家</span></span><br><span class="line">gold_mean = df[<span class="string">&#x27;金牌数&#x27;</span>].mean()</span><br><span class="line">df.query(<span class="string">f&#x27;金牌数 &gt; <span class="subst">&#123;gold_mean&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="comment"># 指定位置插入行</span></span><br><span class="line">df1 = df.iloc[:<span class="number">1</span>, :]</span><br><span class="line">df2 = df.iloc[<span class="number">1</span>:, :]</span><br><span class="line">df3 = pd.DataFrame([[i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(df.columns))]], columns=df.columns)</span><br><span class="line">df_new = pd.concat([df1, df3, df2], ignore_index=<span class="literal">True</span>)</span><br><span class="line"><span class="comment"># 调整 顺序</span></span><br><span class="line">q4_df = q4_df.reindex([<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">22</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">17</span>, <span class="number">18</span>, <span class="number">19</span>, <span class="number">20</span>, <span class="number">21</span>]).reset_index()</span><br><span class="line"><span class="comment"># 可以调整列的顺序</span></span><br><span class="line">ans.reindex([<span class="string">&#x27;installs总数&#x27;</span>,<span class="string">&#x27;contentRating最多的类型&#x27;</span>,<span class="string">&#x27;contentRating最多类型百分比&#x27;</span>,<span class="string">&#x27;score平均分&#x27;</span>],axis=<span class="number">1</span>)</span><br><span class="line"><span class="comment"># 换顺序</span></span><br><span class="line">cpn_bz.iloc[[<span class="number">2</span>,<span class="number">3</span>]]=cpn_bz.iloc[[<span class="number">3</span>,<span class="number">2</span>]]</span><br></pre></td></tr></table></figure>

<h3><span id="create">Create</span></h3><ul>
<li>创建DataFrame</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用 list 生成</span></span><br><span class="line">nums = np.array([i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">31</span>)]).reshape(<span class="number">10</span>,<span class="number">3</span>)</span><br><span class="line">colu = [<span class="string">f&#x27;col_<span class="subst">&#123;i&#125;</span>&#x27;</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>)]</span><br><span class="line">inde = [<span class="string">f&#x27;row_<span class="subst">&#123;i&#125;</span>&#x27;</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>)]  </span><br><span class="line">pd.DataFrame(data=nums,index=Finde,columns=colu)</span><br><span class="line"><span class="comment"># 使用 dict 生成，索引自动生成</span></span><br><span class="line">hight = np.random.randint(<span class="number">158</span>,<span class="number">180</span>,<span class="number">10</span>)</span><br><span class="line">weight = np.random.randint(<span class="number">49</span>,<span class="number">75</span>,<span class="number">10</span>)</span><br><span class="line">pd.DataFrame(data=&#123;</span><br><span class="line">    <span class="string">&#x27;hight&#x27;</span>:hight,</span><br><span class="line">    <span class="string">&#x27;weight&#x27;</span>:weight,&#125;</span><br><span class="line">)      <span class="comment"># 这里没有设置索引，会自动生成</span></span><br><span class="line"><span class="comment"># 读取excel sheet_name默认是0，传入数字就是读取第x+1个sheet，传入字符串就是查找对于sheet的名字</span></span><br><span class="line">df = pd.read_excel(<span class="string">&#x27;data/2020年销售数据.xlsx&#x27;</span>,sheet_name=<span class="number">0</span>) </span><br><span class="line"><span class="comment"># 读取csv文件，默认编码utf-8，遇到中文乱码可以试试看gbk</span></span><br><span class="line">df = pd.read_csv(<span class="string">&#x27;data/2018年北京积分落户数据.csv&#x27;</span>,encoding=<span class="string">&#x27;gbk&#x27;</span>)  <span class="comment"># encoding参数指定数据的编码方式为utf-8</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3><span id="del">Del</span></h3><ul>
<li><p>删除某列的数据</p>
<ul>
<li><strong>axis</strong>：轴。0 或 ‘index’，表示按行删除；1或’columns’，表示按列删除。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># del 只能删一行</span></span><br><span class="line"><span class="keyword">del</span> df[<span class="string">&#x27;a&#x27;</span>]</span><br><span class="line"><span class="comment"># 等价于</span></span><br><span class="line">df.drop(<span class="string">&#x27;a&#x27;</span>,axis=<span class="number">1</span>,inplace=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure></li>
</ul>
<h3><span id="update">Update</span></h3><ul>
<li>where操作</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 如果一个国家的金牌数大于 30 则值为 是，反之为 否</span></span><br><span class="line">df[<span class="string">&#x27;金牌大于30&#x27;</span>]  = np.where(df[<span class="string">&#x27;金牌数&#x27;</span>] &gt; <span class="number">30</span>, <span class="string">&#x27;是&#x27;</span>, <span class="string">&#x27;否&#x27;</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li>更新索引</li>
</ul>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 索引从1开始</span></span><br><span class="line">df.set_index(x <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,df.shape[<span class="number">0</span>]+<span class="number">1</span>))</span><br><span class="line"><span class="comment"># 使用某列作为索引，默认删除该列 即drop=True</span></span><br><span class="line">df.set_index(<span class="string">&#x27;date&#x27;</span>)</span><br><span class="line"><span class="comment"># 修改索引名 如果是多个索引可以通过[]传入</span></span><br><span class="line">df.rename_axis(<span class="string">&#x27;日期&#x27;</span>)</span><br><span class="line"><span class="comment"># 指定多个索引</span></span><br><span class="line">df=df.set_index([<span class="string">&#x27;date&#x27;</span>,<span class="string">&#x27;val&#x27;</span>])</span><br><span class="line"><span class="comment"># 修改单个索引名</span></span><br><span class="line">df.rename_axis(index=&#123;<span class="string">&#x27;val&#x27;</span>:<span class="string">&#x27;v&#x27;</span>&#125;)</span><br><span class="line"><span class="comment"># 还原索引，使用pandas生成默认索引</span></span><br><span class="line">df.reset_index()</span><br><span class="line"><span class="comment"># 删除索引</span></span><br><span class="line">df.reset_index(drop=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li>replace</li>
</ul>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 将金牌数列的数字 0 替换为 无</span></span><br><span class="line">df[<span class="string">&#x27;金牌数&#x27;</span>].replace(<span class="number">0</span>,<span class="string">&#x27;无&#x27;</span>,inplace=<span class="literal">True</span>)</span><br><span class="line"><span class="comment">#同时替换 1将 无 替换为 缺失值 2将 0 替换为 None</span></span><br><span class="line">df.replace([<span class="string">&#x27;无&#x27;</span>,<span class="number">0</span>],[np.nan,<span class="string">&#x27;None&#x27;</span>],inplace = <span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Series中replace字符串部分需要加上.str. 支持链式编程</span></span><br><span class="line">df.employmentLength.<span class="built_in">str</span>.replace(<span class="string">&#x27;years&#x27;</span>,<span class="string">&#x27;&#x27;</span>).<span class="built_in">str</span>.replace(<span class="string">&#x27;+&#x27;</span>,<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># lambda 和 str</span></span><br><span class="line">df.price = df.price.<span class="built_in">str</span>.replace(<span class="string">&#x27;[$|,]&#x27;</span>,<span class="string">&#x27;&#x27;</span>).astype(<span class="string">&#x27;float&#x27;</span>)</span><br><span class="line"><span class="comment"># 等价于</span></span><br><span class="line">df.price = df.price.apply(<span class="keyword">lambda</span> x:x.replace(<span class="string">&#x27;$&#x27;</span>,<span class="string">&#x27;&#x27;</span>).replace(<span class="string">&#x27;,&#x27;</span>,<span class="string">&#x27;&#x27;</span>)).astype(<span class="string">&#x27;float&#x27;</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li>fill</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">bfill 从后面往前填充</span></span><br><span class="line"><span class="string">ffill 从前往后</span></span><br><span class="line"><span class="string">默认列方向填充0，1使用行方向</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 新增一列 最多奖牌数量 列，值为该国 金、银、铜 牌数量中最多的一个奖牌数量</span></span><br><span class="line">df[<span class="string">&#x27;最多奖牌数量&#x27;</span>] = df.bfill(<span class="number">1</span>)[[<span class="string">&quot;金牌数&quot;</span>, <span class="string">&quot;银牌数&quot;</span>,<span class="string">&#x27;铜牌数&#x27;</span>]].<span class="built_in">max</span>(<span class="number">1</span>)</span><br></pre></td></tr></table></figure>

<p>- </p>
<h3><span id="retrieve">Retrieve</span></h3><ul>
<li>随机返回n个样本</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df.sample(n)</span><br></pre></td></tr></table></figure>



<ul>
<li>pivot与groupby</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">pd.pivot_table(df2,values = [<span class="string">&#x27;奖牌类型&#x27;</span>],index = [<span class="string">&#x27;国家&#x27;</span>,<span class="string">&#x27;运动类别&#x27;</span>],aggfunc = <span class="string">&#x27;count&#x27;</span>)</span><br><span class="line"><span class="comment"># 等价于</span></span><br><span class="line">pd.DataFrame(df2.groupby([<span class="string">&#x27;国家&#x27;</span>,<span class="string">&#x27;运动类别&#x27;</span>]).count()[<span class="string">&#x27;奖牌类型&#x27;</span>])</span><br><span class="line"><span class="comment"># 等价于</span></span><br><span class="line">df2.groupby([<span class="string">&#x27;国家&#x27;</span>,<span class="string">&#x27;运动类别&#x27;</span>]).count()[[<span class="string">&#x27;奖牌类型&#x27;</span>]]</span><br><span class="line"></span><br><span class="line"><span class="comment"># groupby 联合 apply</span></span><br><span class="line">q2[<span class="string">&#x27;恋爱的男生比例&#x27;</span>] = df[df[<span class="string">&#x27;romantic&#x27;</span>]==<span class="string">&#x27;yes&#x27;</span>].groupby(<span class="string">&#x27;age&#x27;</span>).apply(<span class="keyword">lambda</span> x:x.sex==<span class="string">&#x27;M&#x27;</span>).groupby(<span class="string">&#x27;age&#x27;</span>).<span class="built_in">sum</span>()/q2_rom.groupby(<span class="string">&#x27;age&#x27;</span>).count()[<span class="string">&#x27;sex&#x27;</span>]</span><br><span class="line"><span class="comment"># 相当于在[]里面写条件</span></span><br><span class="line">df[df[<span class="string">&#x27;smoker&#x27;</span>]==<span class="string">&#x27;yes&#x27;</span>].groupby(<span class="string">&#x27;age区间&#x27;</span>).count()</span><br><span class="line"><span class="comment"># count和sum有区别，一个是计算bool后求和，一个在条件筛选后求个数</span></span><br><span class="line">df.groupby(<span class="string">&#x27;age区间&#x27;</span>).apply(<span class="keyword">lambda</span> x:x.smoker==<span class="string">&#x27;yes&#x27;</span>).groupby(<span class="string">&#x27;age区间&#x27;</span>).<span class="built_in">sum</span>()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 把groupby的元素取出来</span></span><br><span class="line">pieces = <span class="built_in">dict</span>(<span class="built_in">list</span>(df.groupby(<span class="string">&#x27;key1&#x27;</span>)))</span><br><span class="line">pieces[<span class="string">&#x27;b&#x27;</span>]</span><br><span class="line"><span class="comment"># groupby 使用字典</span></span><br><span class="line">by_column = people.groupby(mapping, axis=<span class="number">1</span>)</span><br><span class="line">by_column.<span class="built_in">sum</span>()</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<ul>
<li>unstack</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 计算前十名各国每日奖牌数量合计</span></span><br><span class="line"><span class="comment"># 注意：对于第一天没有数据的国家用0填充，其余时间的缺失值用上一日数据填充</span></span><br><span class="line">countries = df2.groupby(<span class="string">&#x27;国家&#x27;</span>).count().sort_values(<span class="string">&#x27;奖牌类型&#x27;</span>,ascending=<span class="literal">False</span>).head(<span class="number">10</span>).index.tolist()</span><br><span class="line">tmp = df2[df2[<span class="string">&#x27;国家&#x27;</span>].isin(countries)]</span><br><span class="line">tmp.groupby([<span class="string">&#x27;获奖时间&#x27;</span>,<span class="string">&#x27;国家&#x27;</span>]).count()[<span class="string">&#x27;奖牌类型&#x27;</span>].unstack().cumsum().fillna(<span class="number">0</span>)</span><br><span class="line"><span class="comment"># 对于两层的Series </span></span><br><span class="line">data = pd.Series(np.random.randn(<span class="number">9</span>),</span><br><span class="line">                 index=[[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;d&#x27;</span>],</span><br><span class="line">                        [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>]])</span><br><span class="line"><span class="comment"># 选第二个索引值的操作：</span></span><br><span class="line">data[:,<span class="number">2</span>]</span><br><span class="line"><span class="comment"># 等价于</span></span><br><span class="line">data.unstack().iloc[:,<span class="number">1</span>]</span><br></pre></td></tr></table></figure>

<ul>
<li>数据聚合</li>
</ul>
<table>
<thead>
<tr>
<th align="right">positionName</th>
<th align="right">companySize</th>
<th align="right">industryField</th>
<th align="right">financeStage</th>
<th align="right">companyLabelList</th>
<th align="right">firstType</th>
<th align="right">secondType</th>
<th align="right">thirdType</th>
<th align="right">createTime</th>
<th align="right">district</th>
<th align="right">salary</th>
<th align="right">workYear</th>
<th align="right">jobNature</th>
<th align="right">education</th>
<th align="right">positionAdvantage</th>
<th align="right">imState</th>
<th align="right">score</th>
<th align="right">matchScore</th>
<th align="right">famousCompany</th>
<th align="right">Hobby</th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td align="right">0</td>
<td align="right">数据分析</td>
<td align="right">50-150人</td>
<td align="right">移动互联网,电商</td>
<td align="right">A轮</td>
<td align="right">[‘绩效奖金’, ‘带薪年假’, ‘定期体检’, ‘弹性工作’]</td>
<td align="right">产品|需求|项目类</td>
<td align="right">数据分析</td>
<td align="right">数据分析</td>
<td align="right">2020&#x2F;3&#x2F;16 11:00</td>
<td align="right">余杭区</td>
<td align="right">37500</td>
<td align="right">1-3年</td>
<td align="right">全职</td>
<td align="right">本科</td>
<td align="right">五险一金、弹性工作、带薪年假、年度体检</td>
<td align="right">today</td>
<td align="right">233</td>
<td align="right">15.101875</td>
<td align="right">False</td>
<td>‘绩效奖金’</td>
</tr>
<tr>
<td align="right">0</td>
<td align="right">数据分析</td>
<td align="right">50-150人</td>
<td align="right">移动互联网,电商</td>
<td align="right">A轮</td>
<td align="right">[‘绩效奖金’, ‘带薪年假’, ‘定期体检’, ‘弹性工作’]</td>
<td align="right">产品|需求|项目类</td>
<td align="right">数据分析</td>
<td align="right">数据分析</td>
<td align="right">2020&#x2F;3&#x2F;16 11:00</td>
<td align="right">余杭区</td>
<td align="right">37500</td>
<td align="right">1-3年</td>
<td align="right">全职</td>
<td align="right">本科</td>
<td align="right">五险一金、弹性工作、带薪年假、年度体检</td>
<td align="right">today</td>
<td align="right">233</td>
<td align="right">15.101875</td>
<td align="right">False</td>
<td>‘带薪年假’</td>
</tr>
<tr>
<td align="right">0</td>
<td align="right">数据分析</td>
<td align="right">50-150人</td>
<td align="right">移动互联网,电商</td>
<td align="right">A轮</td>
<td align="right">[‘绩效奖金’, ‘带薪年假’, ‘定期体检’, ‘弹性工作’]</td>
<td align="right">产品|需求|项目类</td>
<td align="right">数据分析</td>
<td align="right">数据分析</td>
<td align="right">2020&#x2F;3&#x2F;16 11:00</td>
<td align="right">余杭区</td>
<td align="right">37500</td>
<td align="right">1-3年</td>
<td align="right">全职</td>
<td align="right">本科</td>
<td align="right">五险一金、弹性工作、带薪年假、年度体检</td>
<td align="right">today</td>
<td align="right">233</td>
<td align="right">15.101875</td>
<td align="right">False</td>
<td>‘定期体检’</td>
</tr>
<tr>
<td align="right">0</td>
<td align="right">数据分析</td>
<td align="right">50-150人</td>
<td align="right">移动互联网,电商</td>
<td align="right">A轮</td>
<td align="right">[‘绩效奖金’, ‘带薪年假’, ‘定期体检’, ‘弹性工作’]</td>
<td align="right">产品|需求|项目类</td>
<td align="right">数据分析</td>
<td align="right">数据分析</td>
<td align="right">2020&#x2F;3&#x2F;16 11:00</td>
<td align="right">余杭区</td>
<td align="right">37500</td>
<td align="right">1-3年</td>
<td align="right">全职</td>
<td align="right">本科</td>
<td align="right">五险一金、弹性工作、带薪年假、年度体检</td>
<td align="right">today</td>
<td align="right">233</td>
<td align="right">15.101875</td>
<td align="right">False</td>
<td>‘弹性工作’</td>
</tr>
<tr>
<td align="right">1</td>
<td align="right">数据建模</td>
<td align="right">150-500人</td>
<td align="right">电商</td>
<td align="right">B轮</td>
<td align="right">[‘年终奖金’, ‘做五休二’, ‘六险一金’, ‘子女福利’]</td>
<td align="right">开发|测试|运维类</td>
<td align="right">数据开发</td>
<td align="right">建模</td>
<td align="right">2020&#x2F;3&#x2F;16 11:08</td>
<td align="right">滨江区</td>
<td align="right">15000</td>
<td align="right">3-5年</td>
<td align="right">全职</td>
<td align="right">本科</td>
<td align="right">六险一金,定期体检,丰厚年终</td>
<td align="right">disabled</td>
<td align="right">176</td>
<td align="right">32.559414</td>
<td align="right">False</td>
<td>‘年终奖金’</td>
</tr>
</tbody></table>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">	分组</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># 分组，但不作为索引</span></span><br><span class="line">df.groupby(<span class="string">&quot;district&quot;</span>, as_index=<span class="literal">False</span>)[<span class="string">&#x27;salary&#x27;</span>].mean()</span><br><span class="line"><span class="comment"># 分组 pandas.core.series.Series 格式</span></span><br><span class="line">df.groupby(<span class="string">&quot;district&quot;</span>)[<span class="string">&#x27;salary&#x27;</span>].mean()</span><br><span class="line">df[<span class="string">&#x27;salary&#x27;</span>].groupby(df[<span class="string">&#x27;district&#x27;</span>]).mean() </span><br><span class="line"><span class="comment"># 分组 pandas.core.frame.DataFrame 格式</span></span><br><span class="line">df.groupby(<span class="string">&quot;district&quot;</span>)[<span class="string">&#x27;salary&#x27;</span>].mean().to_frame()</span><br><span class="line">df.groupby(<span class="string">&quot;district&quot;</span>)[[<span class="string">&#x27;salary&#x27;</span>]].mean()</span><br><span class="line">df[[<span class="string">&#x27;district&#x27;</span>,<span class="string">&#x27;salary&#x27;</span>]].groupby(<span class="string">&#x27;district&#x27;</span>).mean()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 相同的结果</span></span><br><span class="line">df[<span class="string">&#x27;salary&#x27;</span>].groupby([df[<span class="string">&#x27;workYear&#x27;</span>],</span><br><span class="line">                      df[<span class="string">&#x27;education&#x27;</span>]]).mean()</span><br><span class="line">df.groupby([<span class="string">&#x27;workYear&#x27;</span>, <span class="string">&#x27;education&#x27;</span>]).mean()[<span class="string">&#x27;salary&#x27;</span>]</span><br><span class="line">df.groupby([<span class="string">&#x27;workYear&#x27;</span>, <span class="string">&#x27;education&#x27;</span>])[<span class="string">&#x27;salary&#x27;</span>].mean()</span><br><span class="line">df.groupby([<span class="string">&#x27;workYear&#x27;</span>, <span class="string">&#x27;education&#x27;</span>])[<span class="string">&#x27;salary&#x27;</span>].agg(<span class="string">&#x27;mean&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># groupby 用字典</span></span><br><span class="line"><span class="comment">#将 score 和 matchScore 的和记为总分，与 salary 列同时进行分组，并查看结果</span></span><br><span class="line">df.groupby(&#123;<span class="string">&#x27;salary&#x27;</span>:<span class="string">&#x27;薪资&#x27;</span>,<span class="string">&#x27;score&#x27;</span>:<span class="string">&#x27;总分&#x27;</span>,<span class="string">&#x27;matchScore&#x27;</span>:<span class="string">&#x27;总分&#x27;</span>&#125;, axis=<span class="number">1</span>).<span class="built_in">sum</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 分组计算不同行政区，薪水的最小值、最大值和平均值</span></span><br><span class="line">df.groupby(<span class="string">&#x27;district&#x27;</span>)[<span class="string">&#x27;salary&#x27;</span>].agg([<span class="built_in">min</span>, <span class="built_in">max</span>, np.mean])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 对不同行政区进行分组，并统计薪水的均值、中位数、方差，以及得分的均值</span></span><br><span class="line">df.groupby(<span class="string">&#x27;district&#x27;</span>).agg(</span><br><span class="line">    &#123;<span class="string">&#x27;salary&#x27;</span>: [np.mean, np.median, np.std], <span class="string">&#x27;score&#x27;</span>: np.mean&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">#对不同岗位(positionName)进行分组，并统计其薪水(salary)中位数和得分(score)均值</span></span><br><span class="line">df.groupby(<span class="string">&#x27;positionName&#x27;</span>).agg(&#123;<span class="string">&#x27;salary&#x27;</span>: np.median, <span class="string">&#x27;score&#x27;</span>: np.mean&#125;)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">	统计每个区不同大小公司个数</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># 方式1：groupby</span></span><br><span class="line">df.groupby([<span class="string">&#x27;district&#x27;</span>,<span class="string">&#x27;companySize&#x27;</span>])[<span class="string">&#x27;companySize&#x27;</span>].count()</span><br><span class="line"><span class="comment"># 方式2：value_counts() 排序按照个数降序</span></span><br><span class="line">df.groupby(<span class="string">&quot;district&quot;</span>)[<span class="string">&#x27;companySize&#x27;</span>].value_counts()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看group的结果</span></span><br><span class="line">df.groupby([<span class="string">&quot;district&quot;</span>,<span class="string">&#x27;salary&#x27;</span>]).groups</span><br><span class="line"><span class="comment"># 将数据按照 district、salary 进行分组，并查看西湖区薪资为 30000 的工作</span></span><br><span class="line">df.groupby([<span class="string">&quot;district&quot;</span>,<span class="string">&#x27;salary&#x27;</span>]).get_group((<span class="string">&quot;西湖区&quot;</span>,<span class="number">30000</span>))</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">我们将会用到 transform 而不是 apply或者mean。 原因是， transform 将会保持 dataframe 矩阵的形状(shape)(就是行列数不变)而 apply 会改变矩阵的形状。</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># 在原数据框 df 新增一列，数值为该区的平均薪资水平</span></span><br><span class="line">df[<span class="string">&#x27;该区平均工资&#x27;</span>] = df[[<span class="string">&#x27;district&#x27;</span>,<span class="string">&#x27;salary&#x27;</span>]].groupby(by=<span class="string">&#x27;district&#x27;</span>).transform(<span class="string">&#x27;mean&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 计算各行政区的企业领域（industryField）包含电商的总数</span></span><br><span class="line">df.groupby(<span class="string">&#x27;district&#x27;</span>)[<span class="string">&quot;industryField&quot;</span>].apply(<span class="keyword">lambda</span> x: x.<span class="built_in">str</span>.contains(<span class="string">&#x27;电商&#x27;</span>).<span class="built_in">sum</span>())</span><br><span class="line"></span><br><span class="line"><span class="comment">#通过 positionName 的长度进行分组，并计算不同长度岗位名称的薪资均值</span></span><br><span class="line">df.set_index(<span class="string">&quot;positionName&quot;</span>).groupby(<span class="built_in">len</span>)[<span class="string">&#x27;salary&#x27;</span>].mean()</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">	where 等同于写在df[]中的条件</span></span><br><span class="line"><span class="string">	query 函数我类似sql语言中的where 相当于在df中写sql</span></span><br><span class="line"><span class="string">	filter 类似sql中groupby后的having</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># where</span></span><br><span class="line">work_index.where(work_index[<span class="string">&#x27;地市&#x27;</span>]==<span class="string">&#x27;厦门市&#x27;</span>)</span><br><span class="line"><span class="comment"># 等价于</span></span><br><span class="line">work_index.query(<span class="string">&#x27;地市==&quot;厦门市&quot;&#x27;</span>)</span><br><span class="line"><span class="comment"># 等价于</span></span><br><span class="line">work_index[work_index[<span class="string">&#x27;地市&#x27;</span>]==<span class="string">&#x27;厦门市&#x27;</span>]</span><br><span class="line"><span class="comment"># 等价于</span></span><br><span class="line">work_index.loc[work_index[<span class="string">&#x27;地市&#x27;</span>]==<span class="string">&#x27;厦门市&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提取平均工资小于 30000 的行政区的全部数据</span></span><br><span class="line">df.groupby(<span class="string">&#x27;district&#x27;</span>).<span class="built_in">filter</span>(<span class="keyword">lambda</span> x: x[<span class="string">&#x27;salary&#x27;</span>].mean() &lt; <span class="number">30000</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过匿名函数分组 根据 createTime 列，计算每天不同 行政区 新增的岗位数量</span></span><br><span class="line">pd.DataFrame(df.groupby([df.createTime.apply(<span class="keyword">lambda</span> x:x.day)])[</span><br><span class="line">             <span class="string">&#x27;district&#x27;</span>].value_counts()).rename_axis([<span class="string">&quot;发布日&quot;</span>, <span class="string">&quot;行政区&quot;</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过 df2 计算获得奖牌最多的运动员</span></span><br><span class="line">df2[<span class="string">&#x27;运动员&#x27;</span>].value_counts().sort_values(ascending=<span class="literal">False</span>).head(<span class="number">1</span>)</span><br><span class="line"><span class="comment">#等价于</span></span><br><span class="line">df.groupby(<span class="string">&#x27;运动员&#x27;</span>).count()[<span class="string">&#x27;奖牌类型&#x27;</span>].sort_values(ascending=<span class="literal">False</span>).head(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看各国在不同项目上的获奖牌情况</span></span><br><span class="line"><span class="comment"># 这里括号内要写df[]</span></span><br><span class="line">df2[<span class="string">&#x27;总奖牌数&#x27;</span>].groupby([df2[<span class="string">&#x27;国家&#x27;</span>],df2[<span class="string">&#x27;运动类别&#x27;</span>]]).count().to_frame()</span><br><span class="line"></span><br><span class="line">df2.groupby([<span class="string">&#x27;国家&#x27;</span>,<span class="string">&#x27;运动类别&#x27;</span>]).count()[<span class="string">&#x27;总奖牌数&#x27;</span>].to_frame()</span><br><span class="line">pd.pivot_table(df2,values = [<span class="string">&#x27;奖牌类型&#x27;</span>],index = [<span class="string">&#x27;国家&#x27;</span>,<span class="string">&#x27;运动类别&#x27;</span>],aggfunc = <span class="string">&#x27;count&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 按照列计算平均值</span></span><br><span class="line">df.mean(axis=<span class="string">&#x27;columns&#x27;</span>)</span><br><span class="line">df.mean(axis=<span class="number">1</span>) <span class="comment">#不是0，1是算每列的均值然后然后合并为一行</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 自定义函数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">myfunc</span>(<span class="params">x</span>):</span><br><span class="line">    <span class="keyword">return</span> x.<span class="built_in">max</span>()-x.mean()</span><br><span class="line"></span><br><span class="line">df.groupby(<span class="string">&#x27;district&#x27;</span>).agg(最低工资=(<span class="string">&#x27;salary&#x27;</span>, <span class="string">&#x27;min&#x27;</span>), 最高工资=(</span><br><span class="line">    <span class="string">&#x27;salary&#x27;</span>, <span class="string">&#x27;max&#x27;</span>), 平均工资=(<span class="string">&#x27;salary&#x27;</span>, <span class="string">&#x27;mean&#x27;</span>), 最大值与均值差值=(<span class="string">&#x27;salary&#x27;</span>, myfunc)).rename_axis([<span class="string">&quot;行政区&quot;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 计算 总分、高端人才得分、办学层次得分的最大最小值、中位数、均值</span></span><br><span class="line">df.agg(&#123;</span><br><span class="line">        <span class="string">&quot;总分&quot;</span>: [<span class="string">&quot;min&quot;</span>, <span class="string">&quot;max&quot;</span>, <span class="string">&quot;median&quot;</span>, <span class="string">&quot;mean&quot;</span>],</span><br><span class="line">        <span class="string">&quot;高端人才得分&quot;</span>: [<span class="string">&quot;min&quot;</span>, <span class="string">&quot;max&quot;</span>, <span class="string">&quot;median&quot;</span>, <span class="string">&quot;mean&quot;</span>],</span><br><span class="line">        <span class="string">&quot;办学层次得分&quot;</span>:[<span class="string">&quot;min&quot;</span>, <span class="string">&quot;max&quot;</span>, <span class="string">&quot;median&quot;</span>, <span class="string">&quot;mean&quot;</span>]&#125;)</span><br></pre></td></tr></table></figure>



<ul>
<li>查看数据信息</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看数据行列数</span></span><br><span class="line">df.shape</span><br><span class="line"><span class="comment"># 查看数据量</span></span><br><span class="line">df.size</span><br><span class="line"><span class="comment"># 查看 数值型 列的统计信息，计数、均值什么的</span></span><br><span class="line">df.describe()</span><br><span class="line"><span class="comment"># 查看 离散型 列的统计信息，计数、频率什么</span></span><br><span class="line">df.describe(include=[<span class="string">&#x27;O&#x27;</span>])</span><br><span class="line"><span class="comment"># 查看 全部 列的统计信息</span></span><br><span class="line">df.describe(include=<span class="string">&#x27;all&#x27;</span>)</span><br><span class="line"><span class="comment"># 去除重复的</span></span><br><span class="line">df[<span class="string">&#x27;a&#x27;</span>].unique()</span><br></pre></td></tr></table></figure>

<ul>
<li>查看统计数据</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看数据行列数</span></span><br><span class="line">df.shape</span><br><span class="line"><span class="comment"># 查看数据量</span></span><br><span class="line">df.size</span><br><span class="line"><span class="comment"># 查看 数值型 列的统计信息，计数、均值什么的</span></span><br><span class="line">df.describe()</span><br><span class="line"><span class="comment"># 查看 离散型 列的统计信息，计数、频率什么</span></span><br><span class="line">df.describe(include=[<span class="string">&#x27;O&#x27;</span>])</span><br><span class="line"><span class="comment"># 查看 全部 列的统计信息</span></span><br><span class="line">df.describe(include=<span class="string">&#x27;all&#x27;</span>)</span><br><span class="line"><span class="comment"># 计算 总分、高端人才得分、办学层次得分的最大最小值、中位数、均值</span></span><br><span class="line">df.agg(&#123;</span><br><span class="line">        <span class="string">&quot;总分&quot;</span>: [<span class="string">&quot;min&quot;</span>, <span class="string">&quot;max&quot;</span>, <span class="string">&quot;median&quot;</span>, <span class="string">&quot;mean&quot;</span>],</span><br><span class="line">        <span class="string">&quot;高端人才得分&quot;</span>: [<span class="string">&quot;min&quot;</span>, <span class="string">&quot;max&quot;</span>, <span class="string">&quot;median&quot;</span>, <span class="string">&quot;mean&quot;</span>],</span><br><span class="line">        <span class="string">&quot;办学层次得分&quot;</span>:[<span class="string">&quot;min&quot;</span>, <span class="string">&quot;max&quot;</span>, <span class="string">&quot;median&quot;</span>, <span class="string">&quot;mean&quot;</span>]&#125;)</span><br></pre></td></tr></table></figure>

<ul>
<li>查询</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查询</span></span><br><span class="line">df.query(<span class="string">&#x27;金牌数+银牌数 &gt; 15&#x27;</span>)</span><br><span class="line">df_01.loc[df_01[<span class="string">&#x27;行业（按行业大类）&#x27;</span>].isin([<span class="string">&#x27;工业&#x27;</span>,<span class="string">&#x27;建筑业&#x27;</span>])]</span><br><span class="line">df_01.loc[(df_01[<span class="string">&#x27;行业（按行业大类）&#x27;</span>]==<span class="string">&#x27;工业&#x27;</span>)|(df_01[<span class="string">&#x27;行业（按行业大类）&#x27;</span>]==<span class="string">&#x27;建筑业&#x27;</span>)]</span><br><span class="line">df_01[df_01[<span class="string">&#x27;行业（按行业大类）&#x27;</span>].<span class="built_in">str</span>.contains(<span class="string">&#x27;工业|建筑业&#x27;</span>)]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 提取全部列名中以 “数” 结尾的列</span></span><br><span class="line">df.loc[:, df.columns.<span class="built_in">str</span>.endswith(<span class="string">&#x27;数&#x27;</span>)]</span><br><span class="line"><span class="comment"># 提取第1，2，3，4列</span></span><br><span class="line">df.iloc[:,<span class="number">0</span>:<span class="number">4</span>] </span><br><span class="line">df.iloc[:,[<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]]</span><br></pre></td></tr></table></figure>

<ul>
<li>查询类型</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df4.select_dtypes(include=[<span class="string">&#x27;int&#x27;</span>,<span class="string">&#x27;float64&#x27;</span>])</span><br><span class="line">df4.select_dtypes(exclude=[<span class="string">&#x27;int&#x27;</span>,<span class="string">&#x27;float64&#x27;</span>])</span><br></pre></td></tr></table></figure>

<ul>
<li>数据展开</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 如果行A和行C存在[a,b,c]这样的列表，我们可以用</span></span><br><span class="line">df5.explode([<span class="string">&#x27;A&#x27;</span>,<span class="string">&#x27;C&#x27;</span>])</span><br></pre></td></tr></table></figure>

<ul>
<li>数据累加</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df[<span class="built_in">list</span>(<span class="string">&#x27;ABCD&#x27;</span>)].cumsum()</span><br><span class="line">df[<span class="built_in">list</span>(<span class="string">&#x27;ABCD&#x27;</span>)].cumsum(axis = <span class="number">1</span>)</span><br></pre></td></tr></table></figure>



<ul>
<li>按时间进行筛选</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">	一般来说可以把datetime作为索引，比较方便我们进行筛选操作</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># 将DateTime转成日期格式</span></span><br><span class="line">df[<span class="string">&#x27;DateTime&#x27;</span>] = pd.to_datetime(df[<span class="string">&#x27;DateTime&#x27;</span>])</span><br><span class="line"><span class="comment"># 将日期设为index</span></span><br><span class="line">df = df.set_index(<span class="string">&#x27;DateTime&#x27;</span>)</span><br><span class="line"><span class="comment"># 筛选从2019年3月1号到2019年3月10号整十天的数据</span></span><br><span class="line">df1 = df[<span class="string">&#x27;2019-03-01&#x27;</span>:<span class="string">&#x27;2019-03-10&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">	如果我们不想或者不好将datetime设置为索引，则可以使用如下方法</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># 设置开始时间</span></span><br><span class="line">from_date = df[<span class="string">&#x27;DATA_DATE&#x27;</span>]&gt;=<span class="string">&#x27;2021-01-01&#x27;</span></span><br><span class="line"><span class="comment"># 设置结束时间</span></span><br><span class="line">to_date = df[<span class="string">&#x27;DATA_DATE&#x27;</span>]&lt;=<span class="string">&#x27;2021-03-31&#x27;</span></span><br><span class="line"><span class="comment"># 筛选数据时间段</span></span><br><span class="line">df = df[from_date&amp;to_date]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 计算日期加减：</span></span><br><span class="line">beg = end - pd.Timedelta(days=<span class="number">6</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li>排序问题</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">df = pd.DataFrame(&#123;<span class="string">&#x27;A&#x27;</span>:[<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">3</span>],<span class="string">&#x27;B&#x27;</span>:[<span class="number">2</span>,<span class="number">1</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">9</span>]&#125;)</span><br><span class="line"><span class="comment"># 先按着A列的值升序，再按着B的顺序降序</span></span><br><span class="line">df.sort_values([<span class="string">&#x27;A&#x27;</span>,<span class="string">&#x27;B&#x27;</span>],ascending=[<span class="literal">True</span>,<span class="literal">False</span>])</span><br></pre></td></tr></table></figure>

<ul>
<li>对df进行自定义排序</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">	数据量小的情况</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">df = pd.DataFrame(&#123;<span class="string">&#x27;A&#x27;</span>:[<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">3</span>],<span class="string">&#x27;B&#x27;</span>:[<span class="number">2</span>,<span class="number">1</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">9</span>]&#125;)</span><br><span class="line"><span class="comment"># 将索引0和索引3的顺序对调</span></span><br><span class="line">indx = [<span class="number">3</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">0</span>,<span class="number">4</span>,<span class="number">5</span>]</span><br><span class="line"><span class="comment"># 如果index过长,可以通过.index获取</span></span><br><span class="line">df.index</span><br><span class="line"><span class="comment"># 使用reindex实现</span></span><br><span class="line">df.reindex(indx)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">	数据量大的情况</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment">#df[1:3] = df[3:1]</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># index 索引重排序</span></span><br><span class="line">frame.swaplevel(<span class="string">&#x27;key1&#x27;</span>, <span class="string">&#x27;key2&#x27;</span>)</span><br><span class="line"><span class="comment"># 对多个索引排序，按照名称</span></span><br><span class="line">frame.sort_index(level=<span class="number">1</span>)</span><br><span class="line"><span class="comment"># 按照索引值排序</span></span><br><span class="line">frame.sort_index()</span><br></pre></td></tr></table></figure>

<h2><span id="保存文件">保存文件</span></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 不保存索引</span></span><br><span class="line">data.to_csv(<span class="string">&quot;out.csv&quot;</span>,encoding = <span class="string">&#x27;utf_8_sig&#x27;</span>,index = <span class="literal">False</span>)</span><br><span class="line"><span class="comment"># 保存指定列</span></span><br><span class="line">data.to_csv(<span class="string">&quot;out.csv&quot;</span>,columns=[<span class="string">&#x27;positionName&#x27;</span>,<span class="string">&#x27;salary&#x27;</span>])</span><br><span class="line"><span class="comment"># 小数点</span></span><br><span class="line">mar.to_csv(<span class="string">&quot;2-1.csv&quot;</span>, index=<span class="literal">False</span>, float_format=<span class="string">&#x27;%.3f&#x27;</span>)</span><br></pre></td></tr></table></figure>



<h2><span id="tricks">Tricks</span></h2><ul>
<li>异常值分析</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 先看数据，后面na_values后期填写</span></span><br><span class="line">df = pd.read_csv(<span class="string">&#x27;xx.csv&#x27;</span>,na_values=[])</span><br><span class="line"><span class="comment"># 每个col去看它的unique()值是否有非法字符，如果有就添加到na_values中</span></span><br><span class="line"><span class="keyword">for</span> c <span class="keyword">in</span> df.columns:</span><br><span class="line">  <span class="built_in">print</span>(df[c].unique())</span><br><span class="line"><span class="comment"># 使用head和info查看数据 数值型的数据</span></span><br><span class="line">df.head()</span><br><span class="line">df.info()</span><br><span class="line"><span class="comment"># 如果发现数值数据却是object类型，则转为int/float</span></span><br><span class="line">df.a = df.a.astype(<span class="string">&#x27;int&#x27;</span>)</span><br><span class="line"><span class="comment"># 如果提示错误，则可以从错误提示中找到非法字符</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果是需要 条件替换的时候</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">15</span>):</span><br><span class="line">    mean = df[~(df[<span class="string">&#x27;v_&#x27;</span>+<span class="built_in">str</span>(i)]==<span class="number">0</span>)][<span class="string">&#x27;v_&#x27;</span>+<span class="built_in">str</span>(i)].mean()</span><br><span class="line">    indx = df[df[<span class="string">&#x27;v_&#x27;</span>+<span class="built_in">str</span>(i)]==<span class="number">0</span>].index.tolist()</span><br><span class="line">    df.loc[indx,<span class="string">&#x27;v_&#x27;</span>+<span class="built_in">str</span>(i)] = mean</span><br><span class="line">    <span class="comment"># 写成这样不行 因为取不到引用</span></span><br><span class="line">    df[df[<span class="string">&#x27;v_&#x27;</span>+<span class="built_in">str</span>(i)]==<span class="number">0</span>][<span class="string">&#x27;v_&#x27;</span>+<span class="built_in">str</span>(i)] = mean</span><br><span class="line">    <span class="comment">#使用loc可以取 但是[]不行</span></span><br><span class="line">    <span class="built_in">print</span>(df[~(df[<span class="string">&#x27;v_&#x27;</span>+<span class="built_in">str</span>(i)]==<span class="number">0</span>)].shape)</span><br></pre></td></tr></table></figure>



<ul>
<li>数据分析&amp;处理</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># isnull() is an alias for isna </span></span><br><span class="line"><span class="comment"># 计算缺失值</span></span><br><span class="line">df.isna().<span class="built_in">sum</span>().<span class="built_in">sum</span>()</span><br><span class="line"><span class="comment"># 每列有多少缺失值</span></span><br><span class="line">df.isnull().<span class="built_in">sum</span>()</span><br><span class="line"><span class="comment"># 查看缺失值</span></span><br><span class="line">df[df.isnull().T.<span class="built_in">any</span>() == <span class="literal">True</span>]</span><br><span class="line"><span class="comment"># 将评价人数列的缺失值，用整列的均值进行填充mean mode median</span></span><br><span class="line">df[<span class="string">&#x27;评价人数&#x27;</span>] = df[<span class="string">&#x27;评价人数&#x27;</span>].fillna(df[<span class="string">&#x27;评价人数&#x27;</span>].mean())</span><br><span class="line"><span class="comment"># 现在将评分列的缺失值，替换为上一个电影的评分</span></span><br><span class="line">df[<span class="string">&#x27;评分&#x27;</span>] = df[<span class="string">&#x27;评分&#x27;</span>].fillna(axis=<span class="number">0</span>,method=<span class="string">&#x27;ffill&#x27;</span>)</span><br><span class="line"><span class="comment"># 将评价人数列的缺失值，用上下数字的均值进行填充</span></span><br><span class="line">df[<span class="string">&#x27;评价人数&#x27;</span>] = df[<span class="string">&#x27;评价人数&#x27;</span>].fillna(df[<span class="string">&#x27;评价人数&#x27;</span>].interpolate())</span><br><span class="line"><span class="comment"># 在填充 “语言” 列的缺失值，要求根据 “国家/地区” 列的值进行填充</span></span><br><span class="line">df[<span class="string">&#x27;语言&#x27;</span>]=df.groupby(<span class="string">&#x27;国家/地区&#x27;</span>).语言.bfill()</span><br><span class="line"><span class="comment"># 查找重复值</span></span><br><span class="line">df[df.duplicated()]</span><br><span class="line"><span class="comment"># 查找指定列的重复值</span></span><br><span class="line">df[df.duplicated([<span class="string">&#x27;片名&#x27;</span>])]</span><br><span class="line"><span class="comment"># 删除全部的重复值</span></span><br><span class="line">df = df.drop_duplicates()</span><br><span class="line"><span class="comment"># 删除全部的重复值，但保留最后一次出现的值first/last/false</span></span><br><span class="line">df = df.drop_duplicates(keep = <span class="string">&#x27;last&#x27;</span>)</span><br><span class="line"><span class="comment"># 计算各省市出现的次数</span></span><br><span class="line">df.省市.value_counts()</span><br><span class="line"></span><br><span class="line"><span class="comment"># fillna 传字典</span></span><br><span class="line">pretreat=pretreat.fillna(&#123;<span class="string">&#x27;v_0&#x27;</span>:df_mean.v_0,</span><br><span class="line">          <span class="string">&#x27;v_1&#x27;</span>:df_mean.v_1,</span><br><span class="line">          <span class="string">&#x27;v_2&#x27;</span>:df_mean.v_2,</span><br><span class="line">          <span class="string">&#x27;v_3&#x27;</span>:df_mean.v_3,</span><br><span class="line">          <span class="string">&#x27;v_4&#x27;</span>:df_mean.v_4,</span><br><span class="line">          <span class="string">&#x27;v_5&#x27;</span>:df_mean.v_5,</span><br><span class="line">          <span class="string">&#x27;v_6&#x27;</span>:df_mean.v_6,</span><br><span class="line">          <span class="string">&#x27;v_7&#x27;</span>:df_mean.v_7,</span><br><span class="line">           <span class="string">&#x27;v_8&#x27;</span>:df_mean.v_8,</span><br><span class="line">          <span class="string">&#x27;v_9&#x27;</span>:df_mean.v_9,</span><br><span class="line">          <span class="string">&#x27;v_10&#x27;</span>:df_mean.v_10,</span><br><span class="line">          <span class="string">&#x27;v_11&#x27;</span>:df_mean.v_11,</span><br><span class="line">          <span class="string">&#x27;v_12&#x27;</span>:df_mean.v_12,</span><br><span class="line">          <span class="string">&#x27;v_13&#x27;</span>:df_mean.v_13,</span><br><span class="line">          <span class="string">&#x27;v_14&#x27;</span>:df_mean.v_14</span><br><span class="line">          &#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">	dropna: axis=1删除列，axis=0删除行</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># 删除整行缺失的数据，剩余缺失数据按0值进行填充</span></span><br><span class="line">df2 = df2.dropna(how=<span class="string">&#x27;all&#x27;</span>).fillna(<span class="number">0</span>)</span><br><span class="line"><span class="comment"># 删除某列为空的行</span></span><br><span class="line">df_initial.dropna(axis = <span class="number">0</span>, subset = [<span class="string">&#x27;客户ID&#x27;</span>], inplace = <span class="literal">True</span>)</span><br></pre></td></tr></table></figure>



<ul>
<li>哑变量操作</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">	哑变量操作</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">cate = df.columns[df.dtypes == <span class="string">&quot;object&quot;</span>].tolist() </span><br><span class="line"><span class="comment"># 或者自己指定想要成为哑变量的列</span></span><br><span class="line">cate = [<span class="string">&#x27;col1&#x27;</span>,<span class="string">&#x27;col2&#x27;</span>]</span><br><span class="line"><span class="keyword">for</span> c <span class="keyword">in</span> cate:</span><br><span class="line">    df = pd.concat([df,pd.get_dummies(df[c],prefix=<span class="built_in">str</span>(c))],axis=<span class="number">1</span>)</span><br><span class="line">    df.drop(c,axis=<span class="number">1</span>,inplace=<span class="literal">True</span>)</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 解决int不能哑变量问题，一行solution</span></span><br><span class="line">pd.get_dummies(df,columns=[<span class="string">&#x27;用电类别&#x27;</span>,<span class="string">&#x27;用电类别&#x27;</span>,<span class="string">&#x27;年&#x27;</span>,<span class="string">&#x27;月&#x27;</span>]).info()</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 或者</span></span><br><span class="line">data[[<span class="string">&#x27;holiday&#x27;</span>,<span class="string">&#x27;month&#x27;</span>,<span class="string">&#x27;dayofweek&#x27;</span>]] = data[[<span class="string">&#x27;holiday&#x27;</span>,<span class="string">&#x27;month&#x27;</span>,<span class="string">&#x27;dayofweek&#x27;</span>]].astype(<span class="string">&#x27;object&#x27;</span>)</span><br><span class="line">data = pd.get_dummies(data)</span><br></pre></td></tr></table></figure>

<ul>
<li>统计空值</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用apply实现</span></span><br><span class="line">df1 = pd.DataFrame(&#123;<span class="string">&#x27;A&#x27;</span>:[<span class="string">&#x27;A&#x27;</span>,<span class="string">&#x27;B&#x27;</span>,np.nan,np.nan],<span class="string">&#x27;B&#x27;</span>:[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,np.nan]&#125;)</span><br><span class="line">df1.apply(<span class="keyword">lambda</span> x:x.size - x.count())</span><br><span class="line"><span class="comment"># 使用isna、isnull实现</span></span><br><span class="line">df1.isna().<span class="built_in">sum</span>() <span class="comment">#isna()返回的是个bool类型的矩阵，进行加和运算True默认为1，False默认为0，因此可以通过sum()函数来统计</span></span><br><span class="line"><span class="comment"># 统计每个空值的比例</span></span><br><span class="line">df1.isna().mean() <span class="comment"># mean() 相当于 True的个数/sum()的个数</span></span><br></pre></td></tr></table></figure>

<ul>
<li>计算最近的数</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 通过abs来计算距离，然后通过sort_values来算最小的数</span></span><br><span class="line">df.val.apply(<span class="keyword">lambda</span> x:<span class="built_in">abs</span>(x-<span class="number">1</span>)).sort_values()</span><br></pre></td></tr></table></figure>

<h2><span id="matplotlib">matplotlib</span></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fig,axis = plt.subplots(figsize=(<span class="number">10</span>,<span class="number">8</span>))</span><br></pre></td></tr></table></figure>



<h2><span id="tips">Tips</span></h2><h3><span id="屏蔽提醒">屏蔽提醒</span></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> warnings</span><br><span class="line">warnings.filterwarnings(<span class="string">&#x27;ignore&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h3><span id="显示中文">显示中文</span></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># win设置中文</span></span><br><span class="line">plt.rcParams[<span class="string">&#x27;font.sans-serif&#x27;</span>]=[<span class="string">&#x27;SimHei&#x27;</span>] <span class="comment">#用来正常显示中文标签</span></span><br><span class="line">plt.rcParams[<span class="string">&#x27;axes.unicode_minus&#x27;</span>] = <span class="literal">False</span> <span class="comment">#用来正常显示负号</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># mac设置中文</span></span><br><span class="line">plt.rcParams[<span class="string">&#x27;font.family&#x27;</span>] = <span class="string">&#x27;Heiti TC&#x27;</span><span class="comment">#用来正常显示中文标签</span></span><br><span class="line">plt.rcParams[<span class="string">&#x27;axes.unicode_minus&#x27;</span>] = <span class="literal">False</span> <span class="comment">#用来正常显示负号</span></span><br></pre></td></tr></table></figure>

<h3><span id="关于iloc和选择赋值失败问题">关于iloc和[]选择赋值失败问题</span></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">df[<span class="string">&#x27;2018-07&#x27;</span>][<span class="string">&#x27;a&#x27;</span>] 取出数字，不能赋值</span><br><span class="line">df.loc[<span class="string">&#x27;2018-07&#x27;</span>][<span class="string">&#x27;a&#x27;</span>]</span><br><span class="line">df.iloc[<span class="number">10</span>,<span class="number">1</span>]</span><br><span class="line">df.iloc[<span class="number">1</span>][<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line">df.iloc[-<span class="number">31</span>:][<span class="string">&#x27;DailyElectricity&#x27;</span>]=<span class="number">0</span></span><br><span class="line">和</span><br><span class="line">df[-<span class="number">31</span>:][<span class="string">&#x27;DailyElectricity&#x27;</span>]=<span class="number">0</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;均不能改变原df</span></span><br><span class="line"><span class="string">因为他们仅仅是取出来的值，而不是引用&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 给一个Series赋值另外一个Series需要reset_index() （保证index相同）</span></span><br></pre></td></tr></table></figure>

<ul>
<li>Jupyter</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">np.add? <span class="comment"># 显示帮助</span></span><br><span class="line">np.add?? <span class="comment"># 显示源代码</span></span><br><span class="line"><span class="comment"># fsting用法 python&gt;=3.6</span></span><br><span class="line">number = <span class="number">7</span></span><br><span class="line"><span class="string">f&#x27;My lucky number is <span class="subst">&#123;number&#125;</span>&#x27;</span></span><br></pre></td></tr></table></figure>











</div></div><div id="container"></div><link rel="stylesheet" type="text/css" href="//unpkg.com/gitalk/dist/gitalk.css?v=0.0.0"><script type="text/javascript" src="//cdn.bootcss.com/blueimp-md5/2.10.0/js/md5.js?v=0.0.0"></script><script type="text/javascript" src="//unpkg.com/gitalk/dist/gitalk.min.js?v=0.0.0"></script><script>var gitalk = new Gitalk({
  clientID: 'd154fff64901622afbb6',
  clientSecret: '5b3f1d58c331b54703e4477e1f8fa1e42e9c1082',
  repo: 'Disda-coding.github.io',
  owner: 'Disda-coding',
  admin: ['Disda-coding'],
  id: md5(location.pathname),
  distractionFreeMode: false
})
gitalk.render('container')
</script></div></div><div class="pure-u-1 pure-u-md-4-4"><div id="footer">Copyright © 2023 <a href="/." rel="nofollow">Disda.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> </a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Disda.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><script type="text/javascript" src="/js/search.js?v=0.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
   search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" src="//lib.baomitu.com/clipboard.js/2.0.4/clipboard.min.js"></script><script type="text/javascript" src="//lib.baomitu.com/toastr.js/2.1.4/toastr.min.js"></script><link rel="stylesheet" href="//lib.baomitu.com/toastr.js/2.1.4/toastr.min.css"><script type="text/javascript" src="/js/copycode.js" successtext="复制成功!"></script><link rel="stylesheet" type="text/css" href="/css/copycode.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>